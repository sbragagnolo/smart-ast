base 64 content
base64aDXToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KDQoNCi8qKg0KICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcw0KICovDQpsaWJyYXJ5IFNhZmVNYXRoIHsNCiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMA0KICAgIHVpbnQgYyA9IGEgLyBiOw0KICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkDQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICBhc3NlcnQoYiA8PSBhKTsNCiAgICByZXR1cm4gYSAtIGI7DQogIH0NCg0KICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYyA+PSBhKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7DQogICAgaWYgKCFhc3NlcnRpb24pIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KfQ0KDQoNCi8qKg0KICogQHRpdGxlIEVSQzIwQmFzaWMNCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQ0KICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKi8NCmNvbnRyYWN0IEVSQzIwQmFzaWMgew0KICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsNCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7DQogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOw0KfQ0KDQoNCg0KDQovKioNCiAqIEB0aXRsZSBCYXNpYyB0b2tlbg0KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4gDQogKi8NCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7DQogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50Ow0KDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsNCg0KICAvKioNCiAgICogQGRldiBGaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjay4NCiAgICovDQogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsNCiAgICAgaWYobXNnLmRhdGEubGVuZ3RoIDwgc2l6ZSArIDQpIHsNCiAgICAgICB0aHJvdzsNCiAgICAgfQ0KICAgICBfOw0KICB9DQoNCiAgLyoqDQogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcw0KICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uDQogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLg0KICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHsNCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOw0KICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuDQogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuIA0KICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuDQogICovDQogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7DQogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogIH0NCg0KfQ0KDQoNCg0KDQovKioNCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UNCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQoNCg0KDQovKioNCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbg0KICoNCiAqIEBkZXYgSW1wbGVtYW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJ0IHRva2VuLg0KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wNCiAqLw0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBCYXNpY1Rva2VuLCBFUkMyMCB7DQoNCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOw0KDQoNCiAgLyoqDQogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcg0KICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tDQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bw0KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkDQogICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMyAqIDMyKSB7DQogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsNCg0KICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldA0KICAgIC8vIGlmIChfdmFsdWUgPiBfYWxsb3dhbmNlKSB0aHJvdzsNCg0KICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsNCiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7DQogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlYWhsZiBvZiBtc2cuc2VuZGVyLg0KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuDQogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuDQogICAqLw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB7DQoNCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYA0KICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90DQogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6DQogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5DQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsNCg0KICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhbiBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4NCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLg0KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4NCiAgICogQHJldHVybiBBIHVpbnQgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLg0KICAgKi8NCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgew0KICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICB9DQoNCn0NCg0KDQovKioNCiAqIEB0aXRsZSBMaW1pdGVkVHJhbnNmZXJUb2tlbg0KICogQGRldiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBkZWZpbmVzIHRoZSBnZW5lcmljIGludGVyZmFjZSBhbmQgdGhlIGltcGxlbWVudGF0aW9uIHRvIGxpbWl0IHRva2VuIA0KICogdHJhbnNmZXJhYmlsaXR5IGZvciBkaWZmZXJlbnQgZXZlbnRzLiBJdCBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGFzIGEgYmFzZSBjbGFzcyBmb3Igb3RoZXIgdG9rZW4gDQogKiBjb250cmFjdHMuIA0KICogTGltaXRlZFRyYW5zZmVyVG9rZW4gaGFzIGJlZW4gZGVzaWduZWQgdG8gYWxsb3cgZm9yIGRpZmZlcmVudCBsaW1pdGluZyBmYWN0b3JzLA0KICogdGhpcyBjYW4gYmUgYWNoaWV2ZWQgYnkgcmVjdXJzaXZlbHkgY2FsbGluZyBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoKSB1bnRpbCB0aGUgYmFzZSBjbGFzcyBpcyANCiAqIGhpdC4gRm9yIGV4YW1wbGU6DQogKiAgICAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsNCiAqICAgICAgIHJldHVybiBtaW4yNTYodW5sb2NrZWRUb2tlbnMsIHN1cGVyLnRyYW5zZmVyYWJsZVRva2Vucyhob2xkZXIsIHRpbWUpKTsNCiAqICAgICB9DQogKiBBIHdvcmtpbmcgZXhhbXBsZSBpcyBWZXN0ZWRUb2tlbi5zb2w6DQogKiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5L2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy90b2tlbi9WZXN0ZWRUb2tlbi5zb2wNCiAqLw0KDQpjb250cmFjdCBMaW1pdGVkVHJhbnNmZXJUb2tlbiBpcyBFUkMyMCB7DQoNCiAgLyoqDQogICAqIEBkZXYgQ2hlY2tzIHdoZXRoZXIgaXQgY2FuIHRyYW5zZmVyIG9yIG90aGVyd2lzZSB0aHJvd3MuDQogICAqLw0KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIsIHVpbnQgX3ZhbHVlKSB7DQogICBpZiAoX3ZhbHVlID4gdHJhbnNmZXJhYmxlVG9rZW5zKF9zZW5kZXIsIHVpbnQ2NChub3cpKSkgdGhyb3c7DQogICBfOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLg0KICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSB0b2tlbnMuDQogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuDQogICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIsIF92YWx1ZSkgew0KICAgIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLg0KICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgc2VuZCB0aGUgdG9rZW5zLg0KICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIHRva2Vucy4NCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLg0KICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKSB7DQogICAgc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBEZWZhdWx0IHRyYW5zZmVyYWJsZSB0b2tlbnMgZnVuY3Rpb24gcmV0dXJucyBhbGwgdG9rZW5zIGZvciBhIGhvbGRlciAobm8gbGltaXQpLg0KICAgKiBAZGV2IE92ZXJ3cml0aW5nIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGlzIHRoZSB3YXkgdG8gcHJvdmlkZSB0aGUgDQogICAqIHNwZWNpZmljIGxvZ2ljIGZvciBsaW1pdGluZyB0b2tlbiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGEgaG9sZGVyIG92ZXIgdGltZS4NCiAgICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOw0KICB9DQp9DQoNCg0KLyoqDQogKiBAdGl0bGUgVmVzdGVkIHRva2VuDQogKiBAZGV2IFRva2VucyB0aGF0IGNhbiBiZSB2ZXN0ZWQgZm9yIGEgZ3JvdXAgb2YgYWRkcmVzc2VzLg0KICovDQpjb250cmFjdCBWZXN0ZWRUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBMaW1pdGVkVHJhbnNmZXJUb2tlbiB7DQoNCiAgdWludDI1NiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTID0gMjA7DQoNCiAgc3RydWN0IFRva2VuR3JhbnQgew0KICAgIGFkZHJlc3MgZ3JhbnRlcjsgICAgIC8vIDIwIGJ5dGVzDQogICAgdWludDI1NiB2YWx1ZTsgICAgICAgLy8gMzIgYnl0ZXMNCiAgICB1aW50NjQgY2xpZmY7DQogICAgdWludDY0IHZlc3Rpbmc7DQogICAgdWludDY0IHN0YXJ0OyAgICAgICAgLy8gMyAqIDggPSAyNCBieXRlcw0KICAgIGJvb2wgcmV2b2thYmxlOw0KICAgIGJvb2wgYnVybnNPblJldm9rZTsgIC8vIDIgKiAxID0gMiBiaXRzPyBvciAyIGJ5dGVzPw0KICB9IC8vIHRvdGFsIDc4IGJ5dGVzID0gMyBzc3RvcmUgcGVyIG9wZXJhdGlvbiAoMzIgcGVyIHNzdG9yZSkNCg0KICBtYXBwaW5nIChhZGRyZXNzID0+IFRva2VuR3JhbnRbXSkgcHVibGljIGdyYW50czsNCg0KICBldmVudCBOZXdUb2tlbkdyYW50KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgZ3JhbnRJZCk7DQoNCiAgLyoqDQogICAqIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MNCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHRoZSB0b2tlbnMgd2lsbCBiZSBncmFudGVkIHRvLg0KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4NCiAgICogQHBhcmFtIF9zdGFydCB1aW50NjQgVGltZSBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudC4NCiAgICogQHBhcmFtIF9jbGlmZiB1aW50NjQgVGltZSBvZiB0aGUgY2xpZmYgcGVyaW9kLg0KICAgKiBAcGFyYW0gX3Zlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4NCiAgICovDQogIGZ1bmN0aW9uIGdyYW50VmVzdGVkVG9rZW5zKA0KICAgIGFkZHJlc3MgX3RvLA0KICAgIHVpbnQyNTYgX3ZhbHVlLA0KICAgIHVpbnQ2NCBfc3RhcnQsDQogICAgdWludDY0IF9jbGlmZiwNCiAgICB1aW50NjQgX3Zlc3RpbmcsDQogICAgYm9vbCBfcmV2b2thYmxlLA0KICAgIGJvb2wgX2J1cm5zT25SZXZva2UNCiAgKSBwdWJsaWMgew0KDQogICAgLy8gQ2hlY2sgZm9yIGRhdGUgaW5jb25zaXN0ZW5jaWVzIHRoYXQgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgYmVoYXZpb3INCiAgICBpZiAoX2NsaWZmIDwgX3N0YXJ0IHx8IF92ZXN0aW5nIDwgX2NsaWZmKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZiAodG9rZW5HcmFudHNDb3VudChfdG8pID4gTUFYX0dSQU5UU19QRVJfQUREUkVTUykgdGhyb3c7ICAgLy8gVG8gcHJldmVudCBhIHVzZXIgYmVpbmcgc3BhbW1lZCBhbmQgaGF2ZSBoaXMgYmFsYW5jZSBsb2NrZWQgKG91dCBvZiBnYXMgYXR0YWNrIHdoZW4gY2FsY3VsYXRpbmcgdmVzdGluZykuDQoNCiAgICB1aW50IGNvdW50ID0gZ3JhbnRzW190b10ucHVzaCgNCiAgICAgICAgICAgICAgICBUb2tlbkdyYW50KA0KICAgICAgICAgICAgICAgICAgX3Jldm9rYWJsZSA/IG1zZy5zZW5kZXIgOiAwLCAvLyBhdm9pZCBzdG9yaW5nIGFuIGV4dHJhIDIwIGJ5dGVzIHdoZW4gaXQgaXMgbm9uLXJldm9rYWJsZQ0KICAgICAgICAgICAgICAgICAgX3ZhbHVlLA0KICAgICAgICAgICAgICAgICAgX2NsaWZmLA0KICAgICAgICAgICAgICAgICAgX3Zlc3RpbmcsDQogICAgICAgICAgICAgICAgICBfc3RhcnQsDQogICAgICAgICAgICAgICAgICBfcmV2b2thYmxlLA0KICAgICAgICAgICAgICAgICAgX2J1cm5zT25SZXZva2UNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICk7DQoNCiAgICB0cmFuc2ZlcihfdG8sIF92YWx1ZSk7DQoNCiAgICBOZXdUb2tlbkdyYW50KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBjb3VudCAtIDEpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZlZCBhZGRyZXNzLg0KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIGhhdmUgaXRzIHRva2VucyByZXZva2VkLg0KICAgKiBAcGFyYW0gX2dyYW50SWQgVGhlIGlkIG9mIHRoZSB0b2tlbiBncmFudC4NCiAgICovDQogIGZ1bmN0aW9uIHJldm9rZVRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50IF9ncmFudElkKSBwdWJsaWMgew0KICAgIFRva2VuR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOw0KDQogICAgaWYgKCFncmFudC5yZXZva2FibGUpIHsgLy8gQ2hlY2sgaWYgZ3JhbnQgd2FzIHJldm9rYWJsZQ0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYgKGdyYW50LmdyYW50ZXIgIT0gbXNnLnNlbmRlcikgeyAvLyBPbmx5IGdyYW50ZXIgY2FuIHJldm9rZSBpdA0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgYWRkcmVzcyByZWNlaXZlciA9IGdyYW50LmJ1cm5zT25SZXZva2UgPyAweGRlYWQgOiBtc2cuc2VuZGVyOw0KDQogICAgdWludDI1NiBub25WZXN0ZWQgPSBub25WZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsNCg0KICAgIC8vIHJlbW92ZSBncmFudCBmcm9tIGFycmF5DQogICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07DQogICAgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXSA9IGdyYW50c1tfaG9sZGVyXVtncmFudHNbX2hvbGRlcl0ubGVuZ3RoLnN1YigxKV07DQogICAgZ3JhbnRzW19ob2xkZXJdLmxlbmd0aCAtPSAxOw0KDQogICAgYmFsYW5jZXNbcmVjZWl2ZXJdID0gYmFsYW5jZXNbcmVjZWl2ZXJdLmFkZChub25WZXN0ZWQpOw0KICAgIGJhbGFuY2VzW19ob2xkZXJdID0gYmFsYW5jZXNbX2hvbGRlcl0uc3ViKG5vblZlc3RlZCk7DQoNCiAgICBUcmFuc2ZlcihfaG9sZGVyLCByZWNlaXZlciwgbm9uVmVzdGVkKTsNCiAgfQ0KDQoNCiAgLyoqDQogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2VucyBvZiBhIGhvbGRlciBhdCBhIGdpdmVuIHRpbWUNCiAgICogQHBhcmFtIGhvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXINCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSBzcGVjaWZpYyB0aW1lLg0KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1Nikgew0KICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsNCg0KICAgIGlmIChncmFudEluZGV4ID09IDApIHJldHVybiBiYWxhbmNlT2YoaG9sZGVyKTsgLy8gc2hvcnRjdXQgZm9yIGhvbGRlciB3aXRob3V0IGdyYW50cw0KDQogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCB0aGUgZ3JhbnRzIHRoZSBob2xkZXIgaGFzLCBhbmQgYWRkIGFsbCBub24tdmVzdGVkIHRva2Vucw0KICAgIHVpbnQyNTYgbm9uVmVzdGVkID0gMDsNCiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBncmFudEluZGV4OyBpKyspIHsNCiAgICAgIG5vblZlc3RlZCA9IFNhZmVNYXRoLmFkZChub25WZXN0ZWQsIG5vblZlc3RlZFRva2VucyhncmFudHNbaG9sZGVyXVtpXSwgdGltZSkpOw0KICAgIH0NCg0KICAgIC8vIEJhbGFuY2UgLSB0b3RhbE5vblZlc3RlZCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhIGhvbGRlciBjYW4gdHJhbnNmZXIgYXQgYW55IGdpdmVuIHRpbWUNCiAgICB1aW50MjU2IHZlc3RlZFRyYW5zZmVyYWJsZSA9IFNhZmVNYXRoLnN1YihiYWxhbmNlT2YoaG9sZGVyKSwgbm9uVmVzdGVkKTsNCg0KICAgIC8vIFJldHVybiB0aGUgbWluaW11bSBvZiBob3cgbWFueSB2ZXN0ZWQgY2FuIHRyYW5zZmVyIGFuZCBvdGhlciB2YWx1ZQ0KICAgIC8vIGluIGNhc2UgdGhlcmUgYXJlIG90aGVyIGxpbWl0aW5nIHRyYW5zZmVyYWJpbGl0eSBmYWN0b3JzIChkZWZhdWx0IGlzIGJhbGFuY2VPZikNCiAgICByZXR1cm4gU2FmZU1hdGgubWluMjU2KHZlc3RlZFRyYW5zZmVyYWJsZSwgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQ2hlY2sgdGhlIGFtb3VudCBvZiBncmFudHMgdGhhdCBhbiBhZGRyZXNzIGhhcy4NCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGhvbGRlciBvZiB0aGUgZ3JhbnRzLg0KICAgKiBAcmV0dXJuIEEgdWludCByZXByZXNlbnRpbmcgdGhlIHRvdGFsIGFtb3VudCBvZiBncmFudHMuDQogICAqLw0KICBmdW5jdGlvbiB0b2tlbkdyYW50c0NvdW50KGFkZHJlc3MgX2hvbGRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCBpbmRleCkgew0KICAgIHJldHVybiBncmFudHNbX2hvbGRlcl0ubGVuZ3RoOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmYyB0aW1lLg0KICAgKiBAcGFyYW0gdG9rZW5zIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgZ3JhbnR0ZWQuDQogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkDQogICAqIEBwYXJhbSBzdGFydCB1aW50NjQgQSB0aW1lIHJlcHJlc2VudGluZyB0aGUgYmVnaW5pbmcgb2YgdGhlIGdyYW50DQogICAqIEBwYXJhbSBjbGlmZiB1aW50NjQgVGhlIGNsaWZmIHBlcmlvZC4NCiAgICogQHBhcmFtIHZlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4NCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnNvZiBhIHNwZWNpZiBncmFudC4NCiAgICogIHRyYW5zZmVyYWJsZVRva2Vucw0KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgXy8tLS0tLS0tLSAgIHZlc3RlZFRva2VucyByZWN0DQogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8NCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgXy8NCiAgICogICB8ICAgICAgICAgICAgICAgICAgIF8vDQogICAqICAgfCAgICAgICAgICAgICAgICAgXy8NCiAgICogICB8ICAgICAgICAgICAgICAgIC8NCiAgICogICB8ICAgICAgICAgICAgICAufA0KICAgKiAgIHwgICAgICAgICAgICAuICB8DQogICAqICAgfCAgICAgICAgICAuICAgIHwNCiAgICogICB8ICAgICAgICAuICAgICAgfA0KICAgKiAgIHwgICAgICAuICAgICAgICB8DQogICAqICAgfCAgICAuICAgICAgICAgIHwNCiAgICogICArPT09Kz09PT09PT09PT09Ky0tLS0tLS0tLSstLS0tLS0tLS0tPiB0aW1lDQogICAqICAgICAgU3RhcnQgICAgICAgQ2xpZnQgICAgVmVzdGluZw0KICAgKi8NCiAgZnVuY3Rpb24gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKA0KICAgIHVpbnQyNTYgdG9rZW5zLA0KICAgIHVpbnQyNTYgdGltZSwNCiAgICB1aW50MjU2IHN0YXJ0LA0KICAgIHVpbnQyNTYgY2xpZmYsDQogICAgdWludDI1NiB2ZXN0aW5nKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQ0KICAgIHsNCiAgICAgIC8vIFNob3J0Y3V0cyBmb3IgYmVmb3JlIGNsaWZmIGFuZCBhZnRlciB2ZXN0aW5nIGNhc2VzLg0KICAgICAgaWYgKHRpbWUgPCBjbGlmZikgcmV0dXJuIDA7DQogICAgICBpZiAodGltZSA+PSB2ZXN0aW5nKSByZXR1cm4gdG9rZW5zOw0KDQogICAgICAvLyBJbnRlcnBvbGF0ZSBhbGwgdmVzdGVkIHRva2Vucy4NCiAgICAgIC8vIEFzIGJlZm9yZSBjbGlmZiB0aGUgc2hvcnRjdXQgcmV0dXJucyAwLCB3ZSBjYW4gdXNlIGp1c3QgY2FsY3VsYXRlIGEgdmFsdWUNCiAgICAgIC8vIGluIHRoZSB2ZXN0aW5nIHJlY3QgKGFzIHNob3duIGluIGFib3ZlJ3MgZmlndXJlKQ0KDQogICAgICAvLyB2ZXN0ZWRUb2tlbnMgPSB0b2tlbnMgKiAodGltZSAtIHN0YXJ0KSAvICh2ZXN0aW5nIC0gc3RhcnQpDQogICAgICB1aW50MjU2IHZlc3RlZFRva2VucyA9IFNhZmVNYXRoLmRpdigNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNhZmVNYXRoLm11bCgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTYWZlTWF0aC5zdWIodGltZSwgc3RhcnQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTYWZlTWF0aC5zdWIodmVzdGluZywgc3RhcnQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOw0KDQogICAgICByZXR1cm4gdmVzdGVkVG9rZW5zOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgR2V0IGFsbCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmMgZ3JhbnQuDQogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuDQogICAqIEBwYXJhbSBfZ3JhbnRJZCBUaGUgaWQgb2YgdGhlIHRva2VuIGdyYW50Lg0KICAgKiBAcmV0dXJuIFJldHVybnMgYWxsIHRoZSB2YWx1ZXMgdGhhdCByZXByZXNlbnQgYSBUb2tlbkdyYW50KGFkZHJlc3MsIHZhbHVlLCBzdGFydCwgY2xpZmYsDQogICAqIHJldm9rYWJpbGl0eSwgYnVybnNPblJldm9rZSwgYW5kIHZlc3RpbmcpIHBsdXMgdGhlIHZlc3RlZCB2YWx1ZSBhdCB0aGUgY3VycmVudCB0aW1lLg0KICAgKi8NCiAgZnVuY3Rpb24gdG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgZ3JhbnRlciwgdWludDI1NiB2YWx1ZSwgdWludDI1NiB2ZXN0ZWQsIHVpbnQ2NCBzdGFydCwgdWludDY0IGNsaWZmLCB1aW50NjQgdmVzdGluZywgYm9vbCByZXZva2FibGUsIGJvb2wgYnVybnNPblJldm9rZSkgew0KICAgIFRva2VuR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOw0KDQogICAgZ3JhbnRlciA9IGdyYW50LmdyYW50ZXI7DQogICAgdmFsdWUgPSBncmFudC52YWx1ZTsNCiAgICBzdGFydCA9IGdyYW50LnN0YXJ0Ow0KICAgIGNsaWZmID0gZ3JhbnQuY2xpZmY7DQogICAgdmVzdGluZyA9IGdyYW50LnZlc3Rpbmc7DQogICAgcmV2b2thYmxlID0gZ3JhbnQucmV2b2thYmxlOw0KICAgIGJ1cm5zT25SZXZva2UgPSBncmFudC5idXJuc09uUmV2b2tlOw0KDQogICAgdmVzdGVkID0gdmVzdGVkVG9rZW5zKGdyYW50LCB1aW50NjQobm93KSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBHZXQgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4NCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuDQogICAqIEBwYXJhbSB0aW1lIFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQNCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZpYyBncmFudCBhdCBhIHNwZWNpZmljIHRpbWUuDQogICAqLw0KICBmdW5jdGlvbiB2ZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoDQogICAgICBncmFudC52YWx1ZSwNCiAgICAgIHVpbnQyNTYodGltZSksDQogICAgICB1aW50MjU2KGdyYW50LnN0YXJ0KSwNCiAgICAgIHVpbnQyNTYoZ3JhbnQuY2xpZmYpLA0KICAgICAgdWludDI1NihncmFudC52ZXN0aW5nKQ0KICAgICk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuDQogICAqIEBwYXJhbSBncmFudCBUb2tlbkdyYW50IFRoZSBncmFudCB0byBiZSBjaGVja2VkLg0KICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZA0KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZjIGdyYW50IG9uIHRoZSANCiAgICogcGFzc2VkIHRpbWUgZnJhbWUuDQogICAqLw0KICBmdW5jdGlvbiBub25WZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBncmFudC52YWx1ZS5zdWIodmVzdGVkVG9rZW5zKGdyYW50LCB0aW1lKSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGRhdGUgd2hlbiB0aGUgaG9sZGVyIGNhbiB0cmFzZmVyIGFsbCBpdHMgdG9rZW5zDQogICAqIEBwYXJhbSBob2xkZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyDQogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGRhdGUgb2YgdGhlIGxhc3QgdHJhbnNmZXJhYmxlIHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIGxhc3RUb2tlbklzVHJhbnNmZXJhYmxlRGF0ZShhZGRyZXNzIGhvbGRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ2NCBkYXRlKSB7DQogICAgZGF0ZSA9IHVpbnQ2NChub3cpOw0KICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IGdyYW50c1tob2xkZXJdLmxlbmd0aDsNCiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBncmFudEluZGV4OyBpKyspIHsNCiAgICAgIGRhdGUgPSBTYWZlTWF0aC5tYXg2NChncmFudHNbaG9sZGVyXVtpXS52ZXN0aW5nLCBkYXRlKTsNCiAgICB9DQogIH0NCn0NCg0KLy8gUVVFU1RJT05TIEZPUiBBVURJVE9SUzoNCi8vIC0gQ29uc2lkZXJpbmcgd2UgaW5oZXJpdCBmcm9tIFZlc3RlZFRva2VuLCBob3cgbXVjaCBkb2VzIHRoYXQgaGl0IGF0IG91ciBnYXMgcHJpY2U/DQovLyAtIEVuc3VyZSBtYXggc3VwcGx5IGlzIDEwMCwwMDAsMDAwDQovLyAtIEVuc3VyZSB0aGF0IGV2ZW4gaWYgbm90IHRvdGFsU3VwcGx5IGlzIHNvbGQsIHRva2VucyB3b3VsZCBzdGlsbCBiZSB0cmFuc2ZlcnJhYmxlIGFmdGVyICh3ZSB3aWxsIHVwIHRvIHRvdGFsU3VwcGx5IGJ5IGNyZWF0aW5nIGFkRXggdG9rZW5zKQ0KDQovLyB2ZXN0aW5nOiAzNjUgZGF5cywgMzY1IGRheXMgLyA0IHZlc3RpbmcNCg0KDQpjb250cmFjdCBBRFhUb2tlbiBpcyBWZXN0ZWRUb2tlbiB7DQogIC8vRklFTERTDQogIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJBZEV4IjsNCiAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiQURYIjsNCiAgdWludCBwdWJsaWMgZGVjaW1hbHMgPSA0Ow0KDQogIC8vQ09OU1RBTlRTDQogIC8vVGltZSBsaW1pdHMNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgU1RBR0VfT05FX1RJTUVfRU5EID0gMjQgaG91cnM7IC8vIGZpcnN0IGRheSBib251cw0KICB1aW50IHB1YmxpYyBjb25zdGFudCBTVEFHRV9UV09fVElNRV9FTkQgPSAxIHdlZWtzOyAvLyBmaXJzdCB3ZWVrIGJvbnVzDQogIHVpbnQgcHVibGljIGNvbnN0YW50IFNUQUdFX1RIUkVFX1RJTUVfRU5EID0gNCB3ZWVrczsNCiAgDQogIC8vIE11bHRpcGxpZXIgZm9yIHRoZSBkZWNpbWFscw0KICB1aW50IHByaXZhdGUgY29uc3RhbnQgREVDSU1BTFMgPSAxMDAwMDsNCg0KICAvL1ByaWNlcyBvZiBBRFgNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfU1RBTkRBUkQgICAgPSA5MDAqREVDSU1BTFM7IC8vIEFEWCByZWNlaXZlZCBwZXIgb25lIEVUSDsgTUFYX1NVUFBMWSAvICh2YWx1YXRpb24gLyBldGhQcmljZSkNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfU1RBR0VfT05FICAgPSBQUklDRV9TVEFOREFSRCAqIDEzMC8xMDA7IC8vIDFFVEggPSAzMCUgbW9yZSBBRFgNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfU1RBR0VfVFdPICAgPSBQUklDRV9TVEFOREFSRCAqIDExNS8xMDA7IC8vIDFFVEggPSAxNSUgbW9yZSBBRFgNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfU1RBR0VfVEhSRUUgPSBQUklDRV9TVEFOREFSRDsNCg0KICAvL0FEWCBUb2tlbiBMaW1pdHMNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgQUxMT0NfVEVBTSA9ICAgICAgICAgMTYwMDAwMDAqREVDSU1BTFM7IC8vIHRlYW0gKyBhZHZpc29ycw0KICB1aW50IHB1YmxpYyBjb25zdGFudCBBTExPQ19CT1VOVElFUyA9ICAgICAgMjAwMDAwMCpERUNJTUFMUzsNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgQUxMT0NfV0lOR1MgPSAgICAgICAgIDIwMDAwMDAqREVDSU1BTFM7DQogIHVpbnQgcHVibGljIGNvbnN0YW50IEFMTE9DX0NST1dEU0FMRSA9ICAgIDgwMDAwMDAwKkRFQ0lNQUxTOw0KICB1aW50IHB1YmxpYyBjb25zdGFudCBQUkVCVVlfUE9SVElPTl9NQVggPSAyMDAwMDAwMCpERUNJTUFMUzsgLy8gdGhpcyBpcyByZWR1bmRhbnRseSBtb3JlIHRoYW4gd2hhdCB3aWxsIGJlIHByZS1zb2xkDQogIA0KICAvL0FTU0lHTkVEIElOIElOSVRJQUxJWkFUSU9ODQogIC8vU3RhcnQgYW5kIGVuZCB0aW1lcw0KICB1aW50IHB1YmxpYyBwdWJsaWNTdGFydFRpbWU7IC8vIFRpbWUgaW4gc2Vjb25kcyBwdWJsaWMgY3Jvd2QgZnVuZCBzdGFydHMuDQogIHVpbnQgcHVibGljIHByaXZhdGVTdGFydFRpbWU7IC8vIFRpbWUgaW4gc2Vjb25kcyB3aGVuIHByZS1idXkgY2FuIHB1cmNoYXNlIHVwIHRvIDMxMjUwIEVUSCB3b3J0aCBvZiBBRFg7DQogIHVpbnQgcHVibGljIHB1YmxpY0VuZFRpbWU7IC8vIFRpbWUgaW4gc2Vjb25kcyBjcm93ZHNhbGUgZW5kcw0KICB1aW50IHB1YmxpYyBoYXJkY2FwSW5FdGg7DQoNCiAgLy9TcGVjaWFsIEFkZHJlc3Nlcw0KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ0FkZHJlc3M7IC8vIEFkZHJlc3MgdG8gd2hpY2ggYWxsIGV0aGVyIGZsb3dzLg0KICBhZGRyZXNzIHB1YmxpYyBhZGV4VGVhbUFkZHJlc3M7IC8vIEFkZHJlc3MgdG8gd2hpY2ggQUxMT0NfVEVBTSwgQUxMT0NfQk9VTlRJRVMsIEFMTE9DX1dJTkdTIGlzICh1bHRpbWF0ZWx5KSBzZW50IHRvLg0KICBhZGRyZXNzIHB1YmxpYyBvd25lckFkZHJlc3M7IC8vIEFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IG93bmVyLiBDYW4gaGFsdCB0aGUgY3Jvd2RzYWxlLg0KICBhZGRyZXNzIHB1YmxpYyBwcmVCdXkxOyAvLyBBZGRyZXNzIHVzZWQgYnkgcHJlLWJ1eQ0KICBhZGRyZXNzIHB1YmxpYyBwcmVCdXkyOyAvLyBBZGRyZXNzIHVzZWQgYnkgcHJlLWJ1eQ0KICBhZGRyZXNzIHB1YmxpYyBwcmVCdXkzOyAvLyBBZGRyZXNzIHVzZWQgYnkgcHJlLWJ1eQ0KICB1aW50IHB1YmxpYyBwcmVCdXlQcmljZTE7IC8vIHByaWNlIGZvciBwcmUtYnV5DQogIHVpbnQgcHVibGljIHByZUJ1eVByaWNlMjsgLy8gcHJpY2UgZm9yIHByZS1idXkNCiAgdWludCBwdWJsaWMgcHJlQnV5UHJpY2UzOyAvLyBwcmljZSBmb3IgcHJlLWJ1eQ0KDQogIC8vUnVubmluZyB0b3RhbHMNCiAgdWludCBwdWJsaWMgZXRoZXJSYWlzZWQ7IC8vIFRvdGFsIEV0aGVyIHJhaXNlZC4NCiAgdWludCBwdWJsaWMgQURYU29sZDsgLy8gVG90YWwgQURYIGNyZWF0ZWQNCiAgdWludCBwdWJsaWMgcHJlYnV5UG9ydGlvblRvdGFsOyAvLyBUb3RhbCBvZiBUb2tlbnMgcHVyY2hhc2VkIGJ5IHByZS1idXkuIE5vdCB0byBleGNlZWQgUFJFQlVZX1BPUlRJT05fTUFYLg0KICANCiAgLy9ib29sZWFucw0KICBib29sIHB1YmxpYyBoYWx0ZWQ7IC8vIGhhbHRzIHRoZSBjcm93ZCBzYWxlIGlmIHRydWUuDQoNCiAgLy8gTU9ESUZJRVJTDQogIC8vSXMgY3VycmVudGx5IGluIHRoZSBwZXJpb2QgYWZ0ZXIgdGhlIHByaXZhdGUgc3RhcnQgdGltZSBhbmQgYmVmb3JlIHRoZSBwdWJsaWMgc3RhcnQgdGltZS4NCiAgbW9kaWZpZXIgaXNfcHJlX2Nyb3dkZnVuZF9wZXJpb2QoKSB7DQogICAgaWYgKG5vdyA+PSBwdWJsaWNTdGFydFRpbWUgfHwgbm93IDwgcHJpdmF0ZVN0YXJ0VGltZSkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIC8vSXMgY3VycmVudGx5IHRoZSBjcm93ZGZ1bmQgcGVyaW9kDQogIG1vZGlmaWVyIGlzX2Nyb3dkZnVuZF9wZXJpb2QoKSB7DQogICAgaWYgKG5vdyA8IHB1YmxpY1N0YXJ0VGltZSkgdGhyb3c7DQogICAgaWYgKGlzQ3Jvd2RmdW5kQ29tcGxldGVkKCkpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICAvLyBJcyBjb21wbGV0ZWQNCiAgbW9kaWZpZXIgaXNfY3Jvd2RmdW5kX2NvbXBsZXRlZCgpIHsNCiAgICBpZiAoIWlzQ3Jvd2RmdW5kQ29tcGxldGVkKCkpIHRocm93Ow0KICAgIF87DQogIH0NCiAgZnVuY3Rpb24gaXNDcm93ZGZ1bmRDb21wbGV0ZWQoKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgaWYgKG5vdyA+IHB1YmxpY0VuZFRpbWUgfHwgQURYU29sZCA+PSBBTExPQ19DUk9XRFNBTEUgfHwgZXRoZXJSYWlzZWQgPj0gaGFyZGNhcEluRXRoKSByZXR1cm4gdHJ1ZTsNCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICAvL01heSBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIgYWRkcmVzcw0KICBtb2RpZmllciBvbmx5X293bmVyKCkgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyQWRkcmVzcykgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIC8vTWF5IG9ubHkgYmUgY2FsbGVkIGlmIHRoZSBjcm93ZGZ1bmQgaGFzIG5vdCBiZWVuIGhhbHRlZA0KICBtb2RpZmllciBpc19ub3RfaGFsdGVkKCkgew0KICAgIGlmIChoYWx0ZWQpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICAvLyBFVkVOVFMNCiAgZXZlbnQgUHJlQnV5KHVpbnQgX2Ftb3VudCk7DQogIGV2ZW50IEJ1eShhZGRyZXNzIGluZGV4ZWQgX3JlY2lwaWVudCwgdWludCBfYW1vdW50KTsNCg0KICAvLyBJbml0aWFsaXphdGlvbiBjb250cmFjdCBhc3NpZ25zIGFkZHJlc3Mgb2YgY3Jvd2RmdW5kIGNvbnRyYWN0IGFuZCBlbmQgdGltZS4NCiAgZnVuY3Rpb24gQURYVG9rZW4oDQogICAgYWRkcmVzcyBfbXVsdGlzaWcsDQogICAgYWRkcmVzcyBfYWRleFRlYW0sDQogICAgdWludCBfcHVibGljU3RhcnRUaW1lLA0KICAgIHVpbnQgX3ByaXZhdGVTdGFydFRpbWUsDQogICAgdWludCBfaGFyZGNhcEluRXRoLA0KICAgIGFkZHJlc3MgX3ByZWJ1eTEsIHVpbnQgX3ByZUJ1eVByaWNlMSwNCiAgICBhZGRyZXNzIF9wcmVidXkyLCB1aW50IF9wcmVCdXlQcmljZTIsDQogICAgYWRkcmVzcyBfcHJlYnV5MywgdWludCBfcHJlQnV5UHJpY2UzDQogICkgew0KICAgIG93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7DQogICAgcHVibGljU3RhcnRUaW1lID0gX3B1YmxpY1N0YXJ0VGltZTsNCiAgICBwcml2YXRlU3RhcnRUaW1lID0gX3ByaXZhdGVTdGFydFRpbWU7DQogICAgcHVibGljRW5kVGltZSA9IF9wdWJsaWNTdGFydFRpbWUgKyA0IHdlZWtzOw0KICAgIG11bHRpc2lnQWRkcmVzcyA9IF9tdWx0aXNpZzsNCiAgICBhZGV4VGVhbUFkZHJlc3MgPSBfYWRleFRlYW07DQoNCiAgICBoYXJkY2FwSW5FdGggPSBfaGFyZGNhcEluRXRoOw0KDQogICAgcHJlQnV5MSA9IF9wcmVidXkxOw0KICAgIHByZUJ1eVByaWNlMSA9IF9wcmVCdXlQcmljZTE7DQogICAgcHJlQnV5MiA9IF9wcmVidXkyOw0KICAgIHByZUJ1eVByaWNlMiA9IF9wcmVCdXlQcmljZTI7DQogICAgcHJlQnV5MyA9IF9wcmVidXkzOw0KICAgIHByZUJ1eVByaWNlMyA9IF9wcmVCdXlQcmljZTM7DQoNCiAgICBiYWxhbmNlc1thZGV4VGVhbUFkZHJlc3NdICs9IEFMTE9DX0JPVU5USUVTOw0KICAgIGJhbGFuY2VzW2FkZXhUZWFtQWRkcmVzc10gKz0gQUxMT0NfV0lOR1M7DQoNCiAgICBiYWxhbmNlc1tvd25lckFkZHJlc3NdICs9IEFMTE9DX1RFQU07DQoNCiAgICBiYWxhbmNlc1tvd25lckFkZHJlc3NdICs9IEFMTE9DX0NST1dEU0FMRTsNCiAgfQ0KDQogIC8vIFRyYW5zZmVyIGFtb3VudCBvZiB0b2tlbnMgZnJvbSBzZW5kZXIgYWNjb3VudCB0byByZWNpcGllbnQuDQogIC8vIE9ubHkgY2FsbGFibGUgYWZ0ZXIgdGhlIGNyb3dkIGZ1bmQgaXMgY29tcGxldGVkDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkNCiAgew0KICAgIGlmIChfdG8gPT0gbXNnLnNlbmRlcikgcmV0dXJuOyAvLyBuby1vcCwgYWxsb3cgZXZlbiBkdXJpbmcgY3Jvd2RzYWxlLCBpbiBvcmRlciB0byB3b3JrIGFyb3VuZCB1c2luZyBncmFudFZlc3RlZFRva2VucygpIHdoaWxlIGluIGNyb3dkc2FsZQ0KICAgIGlmICghaXNDcm93ZGZ1bmRDb21wbGV0ZWQoKSkgdGhyb3c7DQogICAgc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgLy8gVHJhbnNmZXIgYW1vdW50IG9mIHRva2VucyBmcm9tIGEgc3BlY2lmaWVkIGFkZHJlc3MgdG8gYSByZWNpcGllbnQuDQogIC8vIFRyYW5zZmVyIGFtb3VudCBvZiB0b2tlbnMgZnJvbSBzZW5kZXIgYWNjb3VudCB0byByZWNpcGllbnQuDQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpDQogICAgaXNfY3Jvd2RmdW5kX2NvbXBsZXRlZA0KICB7DQogICAgc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogIH0NCg0KICAvL2NvbnN0YW50IGZ1bmN0aW9uIHJldHVybnMgdGhlIGN1cnJlbnQgQURYIHByaWNlLg0KICBmdW5jdGlvbiBnZXRQcmljZVJhdGUoKQ0KICAgICAgY29uc3RhbnQNCiAgICAgIHJldHVybnMgKHVpbnQgb19yYXRlKQ0KICB7DQogICAgICB1aW50IGRlbHRhID0gU2FmZU1hdGguc3ViKG5vdywgcHVibGljU3RhcnRUaW1lKTsNCg0KICAgICAgaWYgKGRlbHRhID4gU1RBR0VfVFdPX1RJTUVfRU5EKSByZXR1cm4gUFJJQ0VfU1RBR0VfVEhSRUU7DQogICAgICBpZiAoZGVsdGEgPiBTVEFHRV9PTkVfVElNRV9FTkQpIHJldHVybiBQUklDRV9TVEFHRV9UV087DQoNCiAgICAgIHJldHVybiAoUFJJQ0VfU1RBR0VfT05FKTsNCiAgfQ0KDQogIC8vIGNhbGN1bGF0ZXMgd21vdW50IG9mIEFEWCB3ZSBnZXQsIGdpdmVuIHRoZSB3ZWkgYW5kIHRoZSByYXRlcyB3ZSd2ZSBkZWZpbmVkIHBlciAxIGV0aA0KICBmdW5jdGlvbiBjYWxjQW1vdW50KHVpbnQgX3dlaSwgdWludCBfcmF0ZSkgDQogICAgY29uc3RhbnQNCiAgICByZXR1cm5zICh1aW50KSANCiAgew0KICAgIHJldHVybiBTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKF93ZWksIF9yYXRlKSwgMSBldGhlcik7DQogIH0gDQogIA0KICAvLyBHaXZlbiB0aGUgcmF0ZSBvZiBhIHB1cmNoYXNlIGFuZCB0aGUgcmVtYWluaW5nIHRva2VucyBpbiB0aGlzIHRyYW5jaGUsIGl0DQogIC8vIHdpbGwgdGhyb3cgaWYgdGhlIHNhbGUgd291bGQgdGFrZSBpdCBwYXN0IHRoZSBsaW1pdCBvZiB0aGUgdHJhbmNoZS4NCiAgLy8gUmV0dXJucyBgYW1vdW50YCBpbiBzY29wZSBhcyB0aGUgbnVtYmVyIG9mIEFEWCB0b2tlbnMgdGhhdCBpdCB3aWxsIHB1cmNoYXNlLg0KICBmdW5jdGlvbiBwcm9jZXNzUHVyY2hhc2UodWludCBfcmF0ZSwgdWludCBfcmVtYWluaW5nKQ0KICAgIGludGVybmFsDQogICAgcmV0dXJucyAodWludCBvX2Ftb3VudCkNCiAgew0KICAgIG9fYW1vdW50ID0gY2FsY0Ftb3VudChtc2cudmFsdWUsIF9yYXRlKTsNCg0KICAgIGlmIChvX2Ftb3VudCA+IF9yZW1haW5pbmcpIHRocm93Ow0KICAgIGlmICghbXVsdGlzaWdBZGRyZXNzLnNlbmQobXNnLnZhbHVlKSkgdGhyb3c7DQoNCiAgICBiYWxhbmNlc1tvd25lckFkZHJlc3NdID0gYmFsYW5jZXNbb3duZXJBZGRyZXNzXS5zdWIob19hbW91bnQpOw0KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uYWRkKG9fYW1vdW50KTsNCg0KICAgIEFEWFNvbGQgKz0gb19hbW91bnQ7DQogICAgZXRoZXJSYWlzZWQgKz0gbXNnLnZhbHVlOw0KICB9DQoNCiAgLy9TcGVjaWFsIEZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBieSBwcmUtYnV5IGFuZCBvbmx5IGR1cmluZyB0aGUgcHJlLWNyb3dkc2FsZSBwZXJpb2QuDQogIGZ1bmN0aW9uIHByZUJ1eSgpDQogICAgcGF5YWJsZQ0KICAgIGlzX3ByZV9jcm93ZGZ1bmRfcGVyaW9kDQogICAgaXNfbm90X2hhbHRlZA0KICB7DQogICAgLy8gUHJlLWJ1eSBwYXJ0aWNpcGFudHMgd291bGQgZ2V0IHRoZSBmaXJzdC1kYXkgcHJpY2UsIGFzIHdlbGwgYXMgYSBib251cyBvZiB2ZXN0ZWQgdG9rZW5zDQogICAgdWludCBwcmljZVZlc3RlZCA9IDA7DQoNCiAgICBpZiAobXNnLnNlbmRlciA9PSBwcmVCdXkxKSBwcmljZVZlc3RlZCA9IHByZUJ1eVByaWNlMTsNCiAgICBpZiAobXNnLnNlbmRlciA9PSBwcmVCdXkyKSBwcmljZVZlc3RlZCA9IHByZUJ1eVByaWNlMjsNCiAgICBpZiAobXNnLnNlbmRlciA9PSBwcmVCdXkzKSBwcmljZVZlc3RlZCA9IHByZUJ1eVByaWNlMzsNCg0KICAgIGlmIChwcmljZVZlc3RlZCA9PSAwKSB0aHJvdzsNCg0KICAgIHVpbnQgYW1vdW50ID0gcHJvY2Vzc1B1cmNoYXNlKFBSSUNFX1NUQUdFX09ORSArIHByaWNlVmVzdGVkLCBTYWZlTWF0aC5zdWIoUFJFQlVZX1BPUlRJT05fTUFYLCBwcmVidXlQb3J0aW9uVG90YWwpKTsNCiAgICBncmFudFZlc3RlZFRva2Vucyhtc2cuc2VuZGVyLCBjYWxjQW1vdW50KG1zZy52YWx1ZSwgcHJpY2VWZXN0ZWQpLCANCiAgICAgIHVpbnQ2NChub3cpLCB1aW50NjQobm93KSArIDkxIGRheXMsIHVpbnQ2NChub3cpICsgMzY1IGRheXMsIA0KICAgICAgZmFsc2UsIGZhbHNlDQogICAgKTsNCiAgICBwcmVidXlQb3J0aW9uVG90YWwgKz0gYW1vdW50Ow0KICAgIFByZUJ1eShhbW91bnQpOw0KICB9DQoNCiAgLy9EZWZhdWx0IGZ1bmN0aW9uIGNhbGxlZCBieSBzZW5kaW5nIEV0aGVyIHRvIHRoaXMgYWRkcmVzcyB3aXRoIG5vIGFyZ3VtZW50cy4NCiAgLy9SZXN1bHRzIGluIGNyZWF0aW9uIG9mIG5ldyBBRFggVG9rZW5zIGlmIHRyYW5zYWN0aW9uIHdvdWxkIG5vdCBleGNlZWQgaGFyZCBsaW1pdCBvZiBBRFggVG9rZW4uDQogIGZ1bmN0aW9uKCkNCiAgICBwYXlhYmxlDQogICAgaXNfY3Jvd2RmdW5kX3BlcmlvZA0KICAgIGlzX25vdF9oYWx0ZWQNCiAgew0KICAgIHVpbnQgYW1vdW50ID0gcHJvY2Vzc1B1cmNoYXNlKGdldFByaWNlUmF0ZSgpLCBTYWZlTWF0aC5zdWIoQUxMT0NfQ1JPV0RTQUxFLCBBRFhTb2xkKSk7DQogICAgQnV5KG1zZy5zZW5kZXIsIGFtb3VudCk7DQogIH0NCg0KICAvLyBUbyBiZSBjYWxsZWQgYXQgdGhlIGVuZCBvZiBjcm93ZGZ1bmQgcGVyaW9kDQogIC8vIFdBUk5JTkc6IHRyYW5zZmVyKCksIHdoaWNoIGlzIGNhbGxlZCBieSBncmFudFZlc3RlZFRva2VucygpLCB3YW50cyBhIG1pbmltdW0gbWVzc2FnZSBsZW5ndGgNCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWQoYWRkcmVzcyBfYWRleFRlYW1BZGRyZXNzLCBhZGRyZXNzIF9hZGV4RnVuZEFkZHJlc3MpDQogICAgaXNfY3Jvd2RmdW5kX2NvbXBsZXRlZA0KICAgIG9ubHlfb3duZXINCiAgICBpc19ub3RfaGFsdGVkDQogIHsNCiAgICAvLyBHcmFudCB0b2tlbnMgcHJlLWFsbG9jYXRlZCBmb3IgdGhlIHRlYW0NCiAgICBncmFudFZlc3RlZFRva2VucygNCiAgICAgIF9hZGV4VGVhbUFkZHJlc3MsIEFMTE9DX1RFQU0sDQogICAgICB1aW50NjQobm93KSwgdWludDY0KG5vdykgKyA5MSBkYXlzICwgdWludDY0KG5vdykgKyAzNjUgZGF5cywgDQogICAgICBmYWxzZSwgZmFsc2UNCiAgICApOw0KDQogICAgLy8gR3JhbnQgdG9rZW5zIHRoYXQgcmVtYWluIGFmdGVyIGNyb3dkc2FsZSB0byB0aGUgQWRFeCBmdW5kLCB2ZXN0ZWQgZm9yIDIgeWVhcnMNCiAgICBncmFudFZlc3RlZFRva2VucygNCiAgICAgIF9hZGV4RnVuZEFkZHJlc3MsIGJhbGFuY2VzW293bmVyQWRkcmVzc10sDQogICAgICB1aW50NjQobm93KSwgdWludDY0KG5vdykgKyAxODIgZGF5cyAsIHVpbnQ2NChub3cpICsgNzMwIGRheXMsIA0KICAgICAgZmFsc2UsIGZhbHNlDQogICAgKTsNCiAgfQ0KDQogIC8vTWF5IGJlIHVzZWQgYnkgb3duZXIgb2YgY29udHJhY3QgdG8gaGFsdCBjcm93ZHNhbGUgYW5kIG5vIGxvbmdlciBleGNlcHQgZXRoZXIuDQogIGZ1bmN0aW9uIHRvZ2dsZUhhbHQoYm9vbCBfaGFsdGVkKQ0KICAgIG9ubHlfb3duZXINCiAgew0KICAgIGhhbHRlZCA9IF9oYWx0ZWQ7DQogIH0NCg0KICAvL2ZhaWxzYWZlIGRyYWluDQogIGZ1bmN0aW9uIGRyYWluKCkNCiAgICBvbmx5X293bmVyDQogIHsNCiAgICBpZiAoIW93bmVyQWRkcmVzcy5zZW5kKHRoaXMuYmFsYW5jZSkpIHRocm93Ow0KICB9DQp9'