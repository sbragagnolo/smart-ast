base 64 content
base64aRCToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4yOw0KDQpjb250cmFjdCBTYWZlTWF0aCB7DQogIC8vaW50ZXJuYWxzDQoNCiAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKiBiOw0KICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjPj1hICYmIGM+PWIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7DQogICAgaWYgKCFhc3NlcnRpb24pIHRocm93Ow0KICB9DQp9DQoNCi8qKg0KICogRVJDIDIwIHRva2VuDQogKg0KICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKi8NCmNvbnRyYWN0IFRva2VuIHsNCg0KICAgIC8vLyBAcmV0dXJuIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMNCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KSB7fQ0KDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZA0KICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHt9DQoNCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgDQogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudA0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykge30NCg0KICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYA0KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcg0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7fQ0KDQogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfYWRkcmAgdG8gc3BlbmQgYF92YWx1ZWAgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHdlaSB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXINCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHt9DQoNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50DQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykge30NCg0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOw0KDQp9DQoNCi8qKg0KICogRVJDIDIwIHRva2VuDQogKg0KICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKi8NCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4gew0KDQogICAgLyoqDQogICAgICogUmV2aWV3ZWQ6DQogICAgICogLSBJbnRlcmdlciBvdmVyZmxvdyA9IE9LLCBjaGVja2VkDQogICAgICovDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgLy9EZWZhdWx0IGFzc3VtZXMgdG90YWxTdXBwbHkgY2FuJ3QgYmUgb3ZlciBtYXggKDJeMjU2IC0gMSkuDQogICAgICAgIC8vSWYgeW91ciB0b2tlbiBsZWF2ZXMgb3V0IHRvdGFsU3VwcGx5IGFuZCBjYW4gaXNzdWUgbW9yZSB0b2tlbnMgYXMgdGltZSBnb2VzIG9uLCB5b3UgbmVlZCB0byBjaGVjayBpZiBpdCBkb2Vzbid0IHdyYXAuDQogICAgICAgIC8vUmVwbGFjZSB0aGUgaWYgd2l0aCB0aGlzIG9uZSBpbnN0ZWFkLg0KICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7DQogICAgICAgIC8vaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7DQogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7DQogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsNCiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgLy9zYW1lIGFzIGFib3ZlLiBSZXBsYWNlIHRoaXMgbGluZSB3aXRoIHRoZSBmb2xsb3dpbmcgaWYgeW91IHdhbnQgdG8gcHJvdGVjdCBhZ2FpbnN0IHdyYXBwaW5nIHVpbnRzLg0KICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsNCiAgICAgICAgLy9pZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgew0KICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7DQogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgew0KICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7DQogICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgICB9DQoNCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7DQoNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7DQoNCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsNCg0KfQ0KDQoNCi8qKg0KICogQXJjYWRlIENpdHkgY3Jvd2RzYWxlIGNyb3dkc2FsZSBjb250cmFjdC4NCiAqDQogKiBTZWN1cml0eSBjcml0ZXJpYSBldmFsdWF0ZWQgYWdhaW5zdCBodHRwOi8vZXRoZXJldW0uc3RhY2tleGNoYW5nZS5jb20vcXVlc3Rpb25zLzg1NTEvbWV0aG9kb2xvZ2ljYWwtc2VjdXJpdHktcmV2aWV3LW9mLWEtc21hcnQtY29udHJhY3QNCiAqDQogKg0KICovDQpjb250cmFjdCBBUkNUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBTYWZlTWF0aCB7DQoNCiAgICBzdHJpbmcgcHVibGljIG5hbWUgPSAiQXJjYWRlIFRva2VuIjsNCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJBUkMiOw0KICAgIHVpbnQgcHVibGljIGRlY2ltYWxzID0gMTg7DQogICAgdWludCBwdWJsaWMgc3RhcnRCbG9jazsgLy9jcm93ZHNhbGUgc3RhcnQgYmxvY2sgKHNldCBpbiBjb25zdHJ1Y3RvcikNCiAgICB1aW50IHB1YmxpYyBlbmRCbG9jazsgLy9jcm93ZHNhbGUgZW5kIGJsb2NrIChzZXQgaW4gY29uc3RydWN0b3IpDQoNCiAgICAvLyBJbml0aWFsIG11bHRpc2lnIGFkZHJlc3MgKHNldCBpbiBjb25zdHJ1Y3RvcikNCiAgICAvLyBBbGwgZGVwb3NpdGVkIEVUSCB3aWxsIGJlIGluc3RhbnRseSBmb3J3YXJkZWQgdG8gdGhpcyBhZGRyZXNzLg0KICAgIC8vIEFkZHJlc3MgaXMgYSBtdWx0aXNpZyB3YWxsZXQuDQogICAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWcgPSAweDA7DQoNCiAgICBhZGRyZXNzIHB1YmxpYyBmb3VuZGVyID0gMHgwOw0KICAgIGFkZHJlc3MgcHVibGljIGRldmVsb3BlciA9IDB4MDsNCiAgICBhZGRyZXNzIHB1YmxpYyByZXdhcmRzID0gMHgwOw0KICAgIGJvb2wgcHVibGljIHJld2FyZEFkZHJlc3Nlc1NldCA9IGZhbHNlOw0KDQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXIgPSAweDA7DQogICAgYm9vbCBwdWJsaWMgbWFya2V0YWN0aXZlID0gZmFsc2U7DQoNCiAgICB1aW50IHB1YmxpYyBldGhlckNhcCA9IDY3MjAwMCAqIDEwKioxODsgLy9tYXggYW1vdW50IHJhaXNlZCBkdXJpbmcgY3Jvd2RzYWxlICg4LjVNIFVTRCB3b3J0aCBvZiBldGhlciB3aWxsIGJlIG1lYXN1cmVkIHdpdGggYSBtb3ZpbmcgYXZlcmFnZSBtYXJrZXQgcHJpY2UgYXQgYmVnaW5uaW5nIG9mIHRoZSBjcm93ZHNhbGUpDQogICAgdWludCBwdWJsaWMgcmV3YXJkc0FsbG9jYXRpb24gPSAyOyAvLzIlIHRva2VucyBhbGxvY2F0ZWQgcG9zdC1jcm93ZHNhbGUgZm9yIHN3YXJtIHJld2FyZHMNCiAgICB1aW50IHB1YmxpYyBkZXZlbG9wZXJBbGxvY2F0aW9uID0gNiA7IC8vNiUgb2YgdG9rZW4gc3VwcGx5IGFsbG9jYXRlZCBwb3N0LWNyb3dkc2FsZSBmb3IgdGhlIGRldmVsb3BlciBmdW5kDQogICAgdWludCBwdWJsaWMgZm91bmRlckFsbG9jYXRpb24gPSA4OyAvLzglIG9mIHRva2VuIHN1cHBseSBhbGxvY2F0ZWQgcG9zdC1jcm93ZHNhbGUgZm9yIHRoZSBmb3VuZGVyIGFsbG9jYXRpb24NCiAgICBib29sIHB1YmxpYyBhbGxvY2F0ZWQgPSBmYWxzZTsgLy90aGlzIHdpbGwgY2hhbmdlIHRvIHRydWUgd2hlbiB0aGUgcmV3YXJkcyBhcmUgYWxsb2NhdGVkDQogICAgdWludCBwdWJsaWMgcHJlc2FsZVRva2VuU3VwcGx5ID0gMDsgLy90aGlzIHdpbGwga2VlcCB0cmFjayBvZiB0aGUgdG9rZW4gc3VwcGx5IGNyZWF0ZWQgZHVyaW5nIHRoZSBjcm93ZHNhbGUNCiAgICB1aW50IHB1YmxpYyBwcmVzYWxlRXRoZXJSYWlzZWQgPSAwOyAvL3RoaXMgd2lsbCBrZWVwIHRyYWNrIG9mIHRoZSBFdGhlciByYWlzZWQgZHVyaW5nIHRoZSBjcm93ZHNhbGUNCiAgICBib29sIHB1YmxpYyBoYWx0ZWQgPSBmYWxzZTsgLy90aGUgZm91bmRlciBhZGRyZXNzIGNhbiBzZXQgdGhpcyB0byB0cnVlIHRvIGhhbHQgdGhlIGNyb3dkc2FsZSBkdWUgdG8gZW1lcmdlbmN5DQogICAgZXZlbnQgQnV5KGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXRoLCB1aW50IGZidCk7DQoNCiAgICBmdW5jdGlvbiBBUkNUb2tlbihhZGRyZXNzIG11bHRpc2lnSW5wdXQsIHVpbnQgc3RhcnRCbG9ja0lucHV0LCB1aW50IGVuZEJsb2NrSW5wdXQpIHsNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgICAgICBtdWx0aXNpZyA9IG11bHRpc2lnSW5wdXQ7DQoNCiAgICAgICAgc3RhcnRCbG9jayA9IHN0YXJ0QmxvY2tJbnB1dDsNCiAgICAgICAgZW5kQmxvY2sgPSBlbmRCbG9ja0lucHV0Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldFJld2FyZEFkZHJlc3NlcyhhZGRyZXNzIGZvdW5kZXJJbnB1dCwgYWRkcmVzcyBkZXZlbG9wZXJJbnB1dCwgYWRkcmVzcyByZXdhcmRzSW5wdXQpew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7DQogICAgICAgIGlmIChyZXdhcmRBZGRyZXNzZXNTZXQpIHRocm93Ow0KICAgICAgICBmb3VuZGVyID0gZm91bmRlcklucHV0Ow0KICAgICAgICBkZXZlbG9wZXIgPSBkZXZlbG9wZXJJbnB1dDsNCiAgICAgICAgcmV3YXJkcyA9IHJld2FyZHNJbnB1dDsNCiAgICAgICAgcmV3YXJkQWRkcmVzc2VzU2V0ID0gdHJ1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwcmljZSgpIGNvbnN0YW50IHJldHVybnModWludCkgew0KICAgICAgICByZXR1cm4gdGVzdFByaWNlKGJsb2NrLm51bWJlcik7ICAgICAgICANCiAgICB9DQoNCiAgICAvLyBwcmljZSgpIGV4cG9zZWQgZm9yIHVuaXQgdGVzdHMNCiAgICBmdW5jdGlvbiB0ZXN0UHJpY2UodWludCBibG9ja051bWJlcikgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7DQogICAgICAgIGlmIChibG9ja051bWJlcj49c3RhcnRCbG9jayAmJiBibG9ja051bWJlcjxzdGFydEJsb2NrKzI1MCkgcmV0dXJuIDEyNTsgLy9wb3dlciBob3VyDQogICAgICAgIGlmIChibG9ja051bWJlcjxzdGFydEJsb2NrIHx8IGJsb2NrTnVtYmVyPmVuZEJsb2NrKSByZXR1cm4gNzU7IC8vZGVmYXVsdCBwcmljZQ0KICAgICAgICByZXR1cm4gNzUgKyA0KihlbmRCbG9jayAtIGJsb2NrTnVtYmVyKS8oZW5kQmxvY2sgLSBzdGFydEJsb2NrICsgMSkqMzQvNDsgLy9jcm93ZHNhbGUgcHJpY2UNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBNYWluIHRva2VuIGJ1eSBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqIFNlY3VyaXR5IHJldmlldw0KICAgICAqDQogICAgICogLSBJbnRlZ2VyIG1hdGg6IG9rIC0gdXNpbmcgU2FmZU1hdGgNCiAgICAgKg0KICAgICAqIC0gaGFsdCBmbGFnIGFkZGVkIC0gb2sNCiAgICAgKg0KICAgICAqIEFwcGxpY2FibGUgdGVzdHM6DQogICAgICoNCiAgICAgKiAtIFRlc3QgaGFsdGluZywgYnV5aW5nLCBhbmQgZmFpbGluZw0KICAgICAqIC0gVGVzdCBidXlpbmcgb24gYmVoYWxmIG9mIGEgcmVjaXBpZW50DQogICAgICogLSBUZXN0IGJ1eQ0KICAgICAqIC0gVGVzdCB1bmhhbHRpbmcsIGJ1eWluZywgYW5kIHN1Y2NlZWRpbmcNCiAgICAgKiAtIFRlc3QgYnV5aW5nIGFmdGVyIHRoZSBzYWxlIGVuZHMNCiAgICAgKg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJ1eVJlY2lwaWVudChhZGRyZXNzIHJlY2lwaWVudCkgew0KICAgICAgICBpZiAoYmxvY2subnVtYmVyPHN0YXJ0QmxvY2sgfHwgYmxvY2subnVtYmVyPmVuZEJsb2NrIHx8IHNhZmVBZGQocHJlc2FsZUV0aGVyUmFpc2VkLG1zZy52YWx1ZSk+ZXRoZXJDYXAgfHwgaGFsdGVkKSB0aHJvdzsNCiAgICAgICAgdWludCB0b2tlbnMgPSBzYWZlTXVsKG1zZy52YWx1ZSwgcHJpY2UoKSk7DQogICAgICAgIGJhbGFuY2VzW3JlY2lwaWVudF0gPSBzYWZlQWRkKGJhbGFuY2VzW3JlY2lwaWVudF0sIHRva2Vucyk7DQogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgdG9rZW5zKTsNCiAgICAgICAgcHJlc2FsZUV0aGVyUmFpc2VkID0gc2FmZUFkZChwcmVzYWxlRXRoZXJSYWlzZWQsIG1zZy52YWx1ZSk7DQoNCiAgICAgICAgaWYgKCFtdWx0aXNpZy5zZW5kKG1zZy52YWx1ZSkpIHRocm93OyAvL2ltbWVkaWF0ZWx5IHNlbmQgRXRoZXIgdG8gbXVsdGlzaWcgYWRkcmVzcw0KDQogICAgICAgIC8vIGlmIGV0aGVyQ2FwIGlzIHJlYWNoZWQgLSBhY3RpdmF0ZSB0aGUgbWFya2V0DQogICAgICAgIGlmIChwcmVzYWxlRXRoZXJSYWlzZWQgPT0gZXRoZXJDYXAgJiYgIW1hcmtldGFjdGl2ZSl7DQogICAgICAgICAgICBtYXJrZXRhY3RpdmUgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgQnV5KHJlY2lwaWVudCwgbXNnLnZhbHVlLCB0b2tlbnMpOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2V0IHVwIGZvdW5kZXIgYWRkcmVzcyB0b2tlbiBiYWxhbmNlLg0KICAgICAqDQogICAgICogYWxsb2NhdGVCb3VudHlBbmRFY29zeXN0ZW1Ub2tlbnMoKSBtdXN0IGJlIGNhbGxkIGZpcnN0Lg0KICAgICAqDQogICAgICogU2VjdXJpdHkgcmV2aWV3DQogICAgICoNCiAgICAgKiAtIEludGVnZXIgbWF0aDogb2sgLSBvbmx5IGNhbGxlZCBvbmNlIHdpdGggZml4ZWQgcGFyYW1ldGVycw0KICAgICAqDQogICAgICogQXBwbGljYWJsZSB0ZXN0czoNCiAgICAgKg0KICAgICAqIC0gVGVzdCBib3VudHkgYW5kIGVjb3N5c3RlbSBhbGxvY2F0aW9uDQogICAgICogLSBUZXN0IGJvdW50eSBhbmQgZWNvc3lzdGVtIGFsbG9jYXRpb24gdHdpY2UNCiAgICAgKg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGFsbG9jYXRlVG9rZW5zKCkgew0KICAgICAgICAvLyBtYWtlIHN1cmUgZm91bmRlci9kZXZlbG9wZXIvcmV3YXJkcyBhZGRyZXNzZXMgYXJlIGNvbmZpZ3VyZWQNCiAgICAgICAgaWYoZm91bmRlciA9PSAweDAgfHwgZGV2ZWxvcGVyID09IDB4MCB8fCByZXdhcmRzID09IDB4MCkgdGhyb3c7DQogICAgICAgIC8vIG93bmVyL2ZvdW5kZXIvZGV2ZWxvcGVyL3Jld2FyZHMgYWRkcmVzc2VzIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24NCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIgJiYgbXNnLnNlbmRlciAhPSBmb3VuZGVyICYmIG1zZy5zZW5kZXIgIT0gZGV2ZWxvcGVyICYmIG1zZy5zZW5kZXIgIT0gcmV3YXJkcyApIHRocm93Ow0KICAgICAgICAvLyBpdCBzaG91bGQgb25seSBjb250aW51ZSBpZiBlbmRCbG9jayBoYXMgcGFzc2VkIE9SIHByZXNhbGVFdGhlclJhaXNlZCBoYXMgcmVhY2hlZCB0aGUgY2FwDQogICAgICAgIGlmIChibG9jay5udW1iZXIgPD0gZW5kQmxvY2sgJiYgcHJlc2FsZUV0aGVyUmFpc2VkIDwgZXRoZXJDYXApIHRocm93Ow0KICAgICAgICBpZiAoYWxsb2NhdGVkKSB0aHJvdzsNCiAgICAgICAgcHJlc2FsZVRva2VuU3VwcGx5ID0gdG90YWxTdXBwbHk7DQogICAgICAgIC8vIHRvdGFsIHRva2VuIGFsbG9jYXRpb25zIGFkZCB1cCB0byAxNiUgb2YgdG90YWwgY29pbnMsIHNvIGZvcm11bGEgaXMgcmV3YXJkPWFsbG9jYXRpb25faW5fcGVyY2VudC84NCAuDQogICAgICAgIGJhbGFuY2VzW2ZvdW5kZXJdID0gc2FmZUFkZChiYWxhbmNlc1tmb3VuZGVyXSwgcHJlc2FsZVRva2VuU3VwcGx5ICogZm91bmRlckFsbG9jYXRpb24gLyA4NCApOw0KICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVBZGQodG90YWxTdXBwbHksIHByZXNhbGVUb2tlblN1cHBseSAqIGZvdW5kZXJBbGxvY2F0aW9uIC8gODQpOw0KICAgICAgICANCiAgICAgICAgYmFsYW5jZXNbZGV2ZWxvcGVyXSA9IHNhZmVBZGQoYmFsYW5jZXNbZGV2ZWxvcGVyXSwgcHJlc2FsZVRva2VuU3VwcGx5ICogZGV2ZWxvcGVyQWxsb2NhdGlvbiAvIDg0KTsNCiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBwcmVzYWxlVG9rZW5TdXBwbHkgKiBkZXZlbG9wZXJBbGxvY2F0aW9uIC8gODQpOw0KICAgICAgICANCiAgICAgICAgYmFsYW5jZXNbcmV3YXJkc10gPSBzYWZlQWRkKGJhbGFuY2VzW3Jld2FyZHNdLCBwcmVzYWxlVG9rZW5TdXBwbHkgKiByZXdhcmRzQWxsb2NhdGlvbiAvIDg0KTsNCiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBwcmVzYWxlVG9rZW5TdXBwbHkgKiByZXdhcmRzQWxsb2NhdGlvbiAvIDg0KTsNCg0KICAgICAgICBhbGxvY2F0ZWQgPSB0cnVlOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogRW1lcmdlbmN5IFN0b3AgY3Jvd2RzYWxlLg0KICAgICAqDQogICAgICogIEFwcGxpY2FibGUgdGVzdHM6DQogICAgICoNCiAgICAgKiAtIFRlc3QgdW5oYWx0aW5nLCBidXlpbmcsIGFuZCBzdWNjZWVkaW5nDQogICAgICovDQogICAgZnVuY3Rpb24gaGFsdCgpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIhPWZvdW5kZXIgJiYgbXNnLnNlbmRlciAhPSBkZXZlbG9wZXIpIHRocm93Ow0KICAgICAgICBoYWx0ZWQgPSB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHVuaGFsdCgpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIhPWZvdW5kZXIgJiYgbXNnLnNlbmRlciAhPSBkZXZlbG9wZXIpIHRocm93Ow0KICAgICAgICBoYWx0ZWQgPSBmYWxzZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBFUkMgMjAgU3RhbmRhcmQgVG9rZW4gaW50ZXJmYWNlIHRyYW5zZmVyIGZ1bmN0aW9uDQogICAgICoNCiAgICAgKiBQcmV2ZW50IHRyYW5zZmVycyB1bnRpbCB0b2tlbiBzYWxlIGlzIG92ZXIuDQogICAgICoNCiAgICAgKiBBcHBsaWNhYmxlIHRlc3RzOg0KICAgICAqDQogICAgICogLSBUZXN0IHRyYW5zZmVyIGFmdGVyIHJlc3RyaWN0ZWQgcGVyaW9kDQogICAgICogLSBUZXN0IHRyYW5zZmVyIGFmdGVyIG1hcmtldCBhY3RpdmF0ZWQNCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoYmxvY2subnVtYmVyIDw9IGVuZEJsb2NrICYmIG1hcmtldGFjdGl2ZSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEVSQyAyMCBTdGFuZGFyZCBUb2tlbiBpbnRlcmZhY2UgdHJhbnNmZXIgZnVuY3Rpb24NCiAgICAgKg0KICAgICAqIFByZXZlbnQgdHJhbnNmZXJzIHVudGlsIHRva2VuIHNhbGUgaXMgb3Zlci4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8PSBlbmRCbG9jayAmJiBtYXJrZXRhY3RpdmUgPT0gZmFsc2UpIHRocm93Ow0KICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRGlyZWN0IGRlcG9zaXRzIGJ1eXMgdG9rZW5zDQogICAgICovDQogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsNCiAgICAgICAgYnV5UmVjaXBpZW50KG1zZy5zZW5kZXIpOw0KICAgIH0NCg0KfQ=='