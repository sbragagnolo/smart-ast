base 64 content
base64aRKTagger_1_00
	^'Y29udHJhY3QgQVJLDQp7DQogICAgICAgDQogICAgYWRkcmVzcyBvd25lcjsNCiAgICBhZGRyZXNzIGNvbnRyb2xsZXI7DQogICAgYm9vbCBtdXRlOw0KICAgIHN0cmluZ1tdIGNvbXBhbmllczsNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGNvbXBhbnlJbmRleDsNCiAgICBhZGRyZXNzW10gY29tcGFueVdhbGxldDsNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOw0KICAgIG1hcHBpbmcgKHVpbnQgPT4gQm90KSAgYm90czsNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnRbXSkgIGJvdE93bmVyczsgICAgICANCiAgICBtYXBwaW5nICh1aW50ID0+IE1hcmtldEJpbGwpICBNYXJrZXRCaWxsczsNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnRbXSkgIEJ1eWVyc0JpbGxzOw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludFtdKSAgU2VsbGVyc0JpbGxzOw0KICAgIG1hcHBpbmcgKHVpbnQgPT4gU3RhdHMpICBjeWNsZTsNCiAgICB1aW50W10gIGxhc3RQcmljZTsNCiAgICB1aW50IHRvdENvbXBhbmllczsNCg0KICAgIGxvZ1tdIGxvZ3M7DQoNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIFRPUzsNCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgYmFuOw0KICAgIHVpbnRbMjBdICBsaXN0ZWQ7ICANCiAgICB1aW50IGNvaW5JbmRleDsgICAgICANCiAgICBtYXBwaW5nICh1aW50ID0+IENvaW4pIGNvaW5zOw0KICAgIG1hcHBpbmcgKHVpbnQgPT4gQ29pbikgdHJhc2g7DQogICAgQVJLQ29udHJvbGxlcl8xXzAwIGNvbnRyb2w7DQoNCiAgICBzdHJ1Y3QgbG9new0KICAgIGFkZHJlc3MgYWRtaW47DQogICAgc3RyaW5nIGFjdGlvbjsNCiAgICBhZGRyZXNzIGFkZHI7DQogICAgfQ0KDQogICAgc3RydWN0IE1hcmtldEJpbGwgew0KICAgIHVpbnQgc2VsbGVyZGF0YTsNCiAgICB1aW50IGJ1eWVyZGF0YTsNCiAgICB1aW50IHByb2R1Y3Q7DQogICAgdWludCBpbmRleDsNCiAgICB1aW50IGNvc3Q7DQogICAgdWludCBibG9jazsNCiAgICB9DQogICAgDQogICAgc3RydWN0IENvaW4gew0KICAgIGFkZHJlc3MgY29pbk93bmVyOw0KICAgIHN0cmluZyBkYXRhOw0KICAgIHN0cmluZyBtaW5lOyAgICAgIA0KICAgIHVpbnQgY29pblR5cGU7DQogICAgdWludCBwbGF0ZjsNCiAgICBzdHJpbmcgYWR2Ow0KICAgIHVpbnQgYmxvY2s7DQogICAgfQ0KICANCiAgICBzdHJ1Y3QgQm90IHsNCiAgICBhZGRyZXNzIG93bmVyOw0KICAgIHN0cmluZyBpbmZvOyAgICAgICAgICAgICAgDQogICAgdWludCBjb3N0Ow0KICAgIHVpbnQgbmJpbGxzOyANCiAgICBtYXBwaW5nICh1aW50ID0+IHVpbnQpIGJpbGxzOw0KICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgc2FsZXM7DQogICAgfQ0KDQoNCiAgICBtYXBwaW5nICh1aW50ID0+IHVpbnQpICBoYWR2Ow0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgIG1pbmVyOw0KDQogICAgdWludCB0b3RCT1RTOw0KICAgIHVpbnQgc2VsbGluZzsNCiAgICB1aW50IG5NYmlsbHM7DQogICAgdWludCB0b3RhbDsNCiAgICB1aW50IGNsYWltZWQ7DQogICAgdWludCBib3VudHk7DQogICANCiAgICBzdHJ1Y3QgU3RhdHN7DQogICAgdWludCBzb2xkOw0KICAgIHVpbnQgY3VycmVudFNlbGxlcjsNCiAgICB9DQoNCiAgICAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIEFSSygpIHtvd25lcj1tc2cuc2VuZGVyO30gICAgICAgIA0KDQogICAgICAgIGZ1bmN0aW9uIGluaXRTdGF0cyhzdHJpbmcgc3RyLGFkZHJlc3MgYWQsdWludCBhKXsNCg0KICAgICAgICAgICBpZihtc2cuc2VuZGVyPT1vd25lcil7DQogICAgICAgICAgIA0KICAgICAgICAgICAgICBpZihjb21wYW5pZXMubGVuZ3RoPT0wKXsNCg0KICAgICAgICAgICAgICAgICBjb2luSW5kZXg9MDsNCiAgICAgICAgICAgICAgICAgdG90Qk9UUz0xMDAwMDsNCiAgICAgICAgICAgICAgICAgc2VsbGluZz0xOw0KICAgICAgICAgICAgICAgICBjbGFpbWVkPTA7ICAgICAgIA0KICAgICAgICAgICAgICAgICBuTWJpbGxzPTE7DQogICAgICAgICAgICAgICAgIHRvdGFsPTA7DQogICAgICAgICAgICAgICAgIGJvdW50eT0yNTAwOw0KICAgICAgICAgICAgICAgICBtdXRlPWZhbHNlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICBmb3IodWludCB6PTA7ejwyMDt6KyspeyAgICAgIA0KICAgICAgICAgICAgICAgICAgICBjeWNsZVt6XT1TdGF0cyh7c29sZDowLGN1cnJlbnRTZWxsZXI6MX0pOyAgIA0KICAgICAgICAgICAgICAgICAgICBpZih6PDcpe2xhc3RQcmljZS5wdXNoKGEpO30NCiAgICAgICAgICAgICAgICAgICAgbGlzdGVkW3pdPTA7ICAgICAgICANCiAgICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICAgY29tcGFueUluZGV4W21zZy5zZW5kZXJdPTE7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgDQogICAgICAgICAgICAgIGlmKGNvbXBhbmllcy5sZW5ndGg8Mil7DQogICAgICAgICAgICAgICAgIGNvbXBhbmllcy5wdXNoKHN0cik7DQogICAgICAgICAgICAgICAgIGNvbXBhbnlXYWxsZXQucHVzaChhZCk7DQogICAgICAgICAgICAgIH1lbHNle2lmKGFkPT1vd25lciljb21wYW5pZXNbMF09c3RyO30NCiAgICAgICAgICAgICAgDQogICAgICAgICAgICAgIGlmKGE9PTMzMyl7b3duZXI9YWQ7bG9ncy5wdXNoKGxvZyhvd25lciwic2V0T3duZXIiLGFkKSk7fSAgICAgICAgICAgICAgDQogICAgICAgICAgIH0NCg0KICAgICAgICB9DQoNCiAgICAgICAgDQogDQoNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ29pbihzdHJpbmcgZGF0LHVpbnQgdHlwLHVpbnQgcGx0ZixzdHJpbmcgbWluLHN0cmluZyBidXllckJpbGwsYWRkcmVzcyBvd24pIHJldHVybnMoYm9vbCl7DQogICAgICAgIGNvaW5JbmRleCsrOw0KICAgICAgICBjb2luc1tjb2luSW5kZXhdPSBDb2luKHtjb2luT3duZXIgOiBvd24sZGF0YSA6IGRhdCxtaW5lIDogbWluLGNvaW5UeXBlIDogdHlwLHBsYXRmOiBwbHRmLGFkdiA6ICIiLGJsb2NrIDogYmxvY2subnVtYmVyfSk7DQogICAgICAgIA0KICAgICAgICBsaXN0ZWRbdHlwXSsrOw0KICAgICAgICBsaXN0ZWRbcGx0Zl0rKzsNCg0KICAgICAgICBhZG1pbmlzdHJhdGlvbigyLGJ1eWVyQmlsbCxjb2luSW5kZXgsbGFzdFByaWNlWzJdLG1zZy5zZW5kZXIpOw0KICAgICAgICBjb250cm9sLnB1c2hDb2luKGNvaW5JbmRleCxvd24sZGF0KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgIA0KICAgICAgICBmdW5jdGlvbiB1cGR0KHVpbnQgaSxzdHJpbmcgZGF0YSx1aW50IHR5cCx1aW50IHBsdGYsc3RyaW5nIG1pbixzdHJpbmcgYnV5ZXJCaWxsLGFkZHJlc3Mgb3duKSAgcmV0dXJucyhib29sKXsNCiAgICAgICAgaWYoY29pbnNbaV0uY29pbk93bmVyIT1tc2cuc2VuZGVyKXRocm93OyAgICAgICAgICANCiAgICAgICAgY29pbnNbaV0uZGF0YT1kYXRhOw0KICAgICAgICBjb2luc1tpXS5jb2luVHlwZT10eXA7DQogICAgICAgIGNvaW5zW2ldLnBsYXRmPXBsdGY7DQogICAgICAgIGNvaW5zW2ldLm1pbmU9bWluOw0KICAgICAgICBjb2luc1tpXS5jb2luT3duZXI9b3duOw0KICAgICAgICBhZG1pbmlzdHJhdGlvbigzLGJ1eWVyQmlsbCxpLGxhc3RQcmljZVszXSxtc2cuc2VuZGVyKTsNCiAgICAgICAgcmV0dXJuIHRydWU7ICAgICAgICANCiAgICAgICAgfQ0KICAgDQoNCg0KICAgICAgICBmdW5jdGlvbiBzZXRBZHYodWludCBpLHN0cmluZyBkYXRhLHN0cmluZyBidXllckJpbGwpIHJldHVybnMoYm9vbCl7ICAgICAgICANCiAgICAgICAgY29pbnNbaV0uYWR2PWRhdGE7ICAgDQogICAgICAgIGFkbWluaXN0cmF0aW9uKDQsYnV5ZXJCaWxsLGksbGFzdFByaWNlWzRdLG1zZy5zZW5kZXIpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgDQogICAgICAgIGZ1bmN0aW9uIHNldEhvbWVBZHYodWludCBpLHN0cmluZyBidXllckJpbGwpIHJldHVybnMoYm9vbCl7ICAgICAgIA0KICAgICAgICBoYWR2W2N5Y2xlWzVdLnNvbGRdPWk7DQogICAgICAgIGFkbWluaXN0cmF0aW9uKDUsYnV5ZXJCaWxsLGksbGFzdFByaWNlWzVdLG1zZy5zZW5kZXIpOyAgDQogICAgICAgIHJldHVybiB0cnVlOyAgICAgICAgIA0KICAgICAgICB9DQogICAgICANCiAgICAgICAgZnVuY3Rpb24gYWRtaW5pc3RyYXRpb24odWludCB0aXBvLHN0cmluZyBidXllckJpbGwsdWludCBpbmRleCx1aW50IGMsYWRkcmVzcyBvd24pIHByaXZhdGV7DQogICAgICAgDQogICAgICAgICAgICAgICAgaWYoIShjb21wYW55SW5kZXhbb3duXT4wKSlyZWdpc3RlckNvbXBhbnkob3duLGJ1eWVyQmlsbCk7DQogICAgICAgICAgICAgICAgdWludCB1PWN5Y2xlW3RpcG9dLmN1cnJlbnRTZWxsZXI7DQogICAgICAgICAgICAgICAgaWYoIWJhbltvd25dKXtiYWxhbmNlc1tib3RzW3VdLm93bmVyXSs9Yzt9ZWxzZXtiYWxhbmNlc1tvd25lcl0rPWM7fQ0KICAgICAgICAgICAgICAgIGJhbGFuY2VzW293bl0rPW1zZy52YWx1ZS1jOw0KICAgICAgICAgICAgICAgIHJlZ2lzdGVyQmlsbCh1LGJvdHNbdV0ub3duZXIsb3duLHRpcG8saW5kZXgsYyk7ICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIH0NCg0KDQogICAgICAgIGZ1bmN0aW9uIHNldEJvdW50eShhZGRyZXNzIGEsc3RyaW5nIGRhdGEsdWludCBhbW91bnQpew0KICAgICAgICAgICBpZigobXNnLnNlbmRlcj09b3duZXIpJiYoYm91bnR5PmFtb3VudCkpew0KICAgICAgICAgICAgICBmb3IodWludCBqPTA7ajxhbW91bnQ7aisrKXsNCiAgICAgICAgICAgICAgYm90c1tzZWxsaW5nXSA9IEJvdChhLCIiLDAsMCk7DQogICAgICAgICAgICAgIGJvdE93bmVyc1thXS5wdXNoKHNlbGxpbmcpOw0KICAgICAgICAgICAgICByZWdpc3RlckNvbXBhbnkoYSxkYXRhKTsNCiAgICAgICAgICAgICAgdG90Qk9UUysrOw0KICAgICAgICAgICAgICBzZWxsaW5nKys7DQogICAgICAgICAgICAgIGJvdW50eS0tOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgZnVuY3Rpb24gYm90T25TYWxlKHVpbnQgaSx1aW50IGMpIHtpZigobXNnLnNlbmRlciE9Ym90c1tpXS5vd25lcil8fChzZWxsaW5nPD10b3RCT1RTKXx8KCFUT1NbbXNnLnNlbmRlcl0pKXRocm93O2JvdHNbaV0uY29zdD1jO30NCg0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gYnV5Qk9UeCh1aW50IGksc3RyaW5nIGJ1eWVyYmlsbCxzdHJpbmcgYnV5ZXJJbmZvLGFkZHJlc3MgYnV5ZXJ3YWxsZXQsdWludCBhbW91bnQpIHJldHVybnMgKGJvb2wpew0KICAgICAgICAgaWYoKGFtb3VudDwxKXx8KGk+MTUwMDApfHwoKGFtb3VudD4xKSYmKChzZWxsaW5nK2Ftb3VudCs5OTk+dG90Qk9UUyl8fChzZWxsaW5nPDQwMCkpKSl0aHJvdzsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYWRkcmVzcyBzZWxsc05vdzsNCiAgICAgICAgICAgICAgICBhZGRyZXNzIGhvbGRlcjsNCiAgICAgICAgICAgICAgICB1aW50IHNlbGw7DQogICAgICAgICAgICAgICAgdWludCBjdXJyZW50U2VsbGVyOw0KICAgICAgICAgICAgICAgIHVpbnQgYzsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZighKGNvbXBhbnlJbmRleFtidXllcndhbGxldF0+MCkpcmVnaXN0ZXJDb21wYW55KGJ1eWVyd2FsbGV0LGJ1eWVyYmlsbCk7DQoNCiAgICAgICAgICAgICAgICBpZigobWluZXJbbXNnLnNlbmRlcl0pJiYoY2xhaW1lZDwyNTAwKSl7DQogICAgICAgICAgICAgICAgY3VycmVudFNlbGxlcj1jeWNsZVswXS5jdXJyZW50U2VsbGVyOw0KICAgICAgICAgICAgICAgIHNlbGxzTm93PWJvdHNbY3VycmVudFNlbGxlcl0ub3duZXI7DQogICAgICAgICAgICAgICAgYz1sYXN0UHJpY2VbMF07DQogICAgICAgICAgICAgICAgY2xhaW1lZCsrOw0KICAgICAgICAgICAgICAgIHRvdEJPVFMrKzsNCiAgICAgICAgICAgICAgICBtaW5lclttc2cuc2VuZGVyXT1mYWxzZTsNCiAgICAgICAgICAgICAgICBob2xkZXI9b3duZXI7DQogICAgICAgICAgICAgICAgc2VsbD1zZWxsaW5nOw0KICAgICAgICAgICAgICAgICAgICAgLy9iYWxhbmNlc1tib3RzW2N1cnJlbnRTZWxsZXJdLm93bmVyXSs9bXNnLnZhbHVlOw0KICAgICAgICAgICAgICAgIGlmKCFiYW5bYm90c1tjdXJyZW50U2VsbGVyXS5vd25lcl0pe2JhbGFuY2VzW2JvdHNbY3VycmVudFNlbGxlcl0ub3duZXJdKz1jO31lbHNle2JhbGFuY2VzW293bmVyXSs9Yzt9DQogICAgICAgICAgICAgICAgICAgICAvL2JhbGFuY2VzW2JvdHNbY3VycmVudFNlbGxlcl0ub3duZXJdKz1jOw0KICAgICAgICAgICAgICAgICAgICAgLy9iYWxhbmNlc1ttc2cuc2VuZGVyXSs9KG1zZy52YWx1ZS1jKTsNCiAgICAgICAgICAgICAgICBzZWxsaW5nKys7DQogICAgICAgICAgICAgICAgYm90c1tzZWxsXSA9IEJvdChidXllcndhbGxldCxidXllckluZm8sMCwwKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCg0KICAgICAgICAgICAgICAgIGlmKHNlbGxpbmc+dG90Qk9UUyl7DQogICAgICAgICAgICAgICAgaWYoYm90c1tpXS5jb3N0PT0wKXRocm93Ow0KICAgICAgICAgICAgICAgIGN1cnJlbnRTZWxsZXI9Y3ljbGVbMF0uY3VycmVudFNlbGxlcjsNCiAgICAgICAgICAgICAgICBzZWxsc05vdz1ib3RzW2N1cnJlbnRTZWxsZXJdLm93bmVyOw0KICAgICAgICAgICAgICAgIGhvbGRlcj1ib3RzW2ldLm93bmVyOw0KICAgICAgICAgICAgICAgIHNlbGw9aTsNCiAgICAgICAgICAgICAgICBjPWJvdHNbaV0uY29zdCtsYXN0UHJpY2VbMF07DQogICAgICAgICAgICAgICAgbW92ZShpLGJ1eWVyd2FsbGV0KTsNCiAgICAgICAgICAgICAgICAgICAJCSAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKCFiYW5bc2VsbHNOb3ddKXtiYWxhbmNlc1tzZWxsc05vd10rPWxhc3RQcmljZVswXTt9ZWxzZXtiYWxhbmNlc1tvd25lcl0rPWxhc3RQcmljZVswXTt9DQogICAgICAgICANCiAgICAgICAgICAgICAgICByZWdpc3RlckJpbGwoaSxob2xkZXIsc2VsbHNOb3csNixzZWxsLGMtbGFzdFByaWNlWzBdKTsgICAgICAgICAgICAgICAgICAgCQkNCiAgICAgICAgICAgICAgICBsYXN0UHJpY2VbbGFzdFByaWNlLmxlbmd0aCsrXT1jLWxhc3RQcmljZVswXTsNCiAgICAgICAgICAgICAgICAgICAJCQ0KICAgICAgICAgICAgICAgIH1lbHNlew0KDQogICAgICAgICAgICAgICAgYz1sYXN0UHJpY2VbNl0qYW1vdW50Ow0KICAgICAgICAgICAgICAgIGJhbGFuY2VzW293bmVyXSs9bXNnLnZhbHVlOyANCiAgICAgICAgICAgICAgICBjdXJyZW50U2VsbGVyPXNlbGxpbmc7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYW1vdW50PjEpe3NlbGw9YW1vdW50KzEwMDAwMDt9ZWxzZXtzZWxsPXNlbGxpbmc7fQ0KICAgICAgICAgICAgICAgIHNlbGxzTm93PW93bmVyOw0KICAgICAgICAgICAgICAgIGZvcih1aW50IGo9MDtqPGFtb3VudDtqKyspew0KICAgICAgICAgICAgICAgIGJvdHNbc2VsbGluZytqXSA9IEJvdChidXllcndhbGxldCxidXllckluZm8sMCwwKTsNCiAgICAgICAgICAgICAgICBib3RPd25lcnNbYnV5ZXJ3YWxsZXRdLnB1c2goc2VsbGluZytqKTsNCiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHNlbGxpbmcrPWFtb3VudDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHNlbGxzTm93IT1vd25lcilib3RPd25lcnNbYnV5ZXJ3YWxsZXRdLnB1c2goc2VsbCk7DQogICAgICAgICAgICAgICAgcmVnaXN0ZXJCaWxsKGN1cnJlbnRTZWxsZXIsc2VsbHNOb3csYnV5ZXJ3YWxsZXQsMCxzZWxsLGMpOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgIA0KDQogICAgICAgZnVuY3Rpb24gbW92ZSh1aW50IGluZGV4LGFkZHJlc3Mgd2FsbGV0KSBwcml2YXRlIHJldHVybnMgKHVpbnRbXSl7DQoNCiAgICAgICAgdWludFtdIGw9Ym90T3duZXJzW2JvdHNbaW5kZXhdLm93bmVyXTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICB1aW50IGxsPWwubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgZm9yKHVpbnQgaj0wO2o8bGw7aisrKXsNCiAgICAgICAgICBpZihsW2pdPT1pbmRleCl7DQogICAgICAgICAgICAgIGlmKGo8bGwtMSlsW2pdPWxbbGwtMV07DQogICAgICAgICAgICAgIGRlbGV0ZSBsW2xsLTFdO2o9bGw7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGJvdE93bmVyc1tib3RzW2luZGV4XS5vd25lcl09bDsNCiAgICAgICAgYm90T3duZXJzW2JvdHNbaW5kZXhdLm93bmVyXS5sZW5ndGgtLTsNCiAgICAgICAgYm90c1tpbmRleF0ub3duZXI9d2FsbGV0Ow0KICAgICAgICBib3RzW2luZGV4XS5jb3N0PTA7DQoNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlQk9UQmlsbGluZ0luZm8odWludCBpbmRleCxzdHJpbmcgZGF0YSxhZGRyZXNzIHdhbGxldCxzdHJpbmcgaW5mbyxzdHJpbmcgYnV5ZXJiaWxsLHVpbnQgdXBkYXRldHlwZSkgcmV0dXJucyhib29sKXsNCiAgICAgICAgICAgICAgIA0KICAgICAgICBpZigoaW5kZXg+dG90Qk9UUyl8fChtc2cuc2VuZGVyIT1ib3RzW2luZGV4XS5vd25lcikpdGhyb3c7DQogICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgdWludCB0PTE7DQogICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgY3M9Ym90c1tjeWNsZVsxXS5jdXJyZW50U2VsbGVyXS5vd25lcjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKGJvdHNbaW5kZXhdLm93bmVyIT13YWxsZXQpew0KDQogICAgICAgICAgICAgICAgICAgICAgIGlmKCEoY29tcGFueUluZGV4W3dhbGxldF0+MCkpcmVnaXN0ZXJDb21wYW55KHdhbGxldCxkYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgYm90T3duZXJzW3dhbGxldF0ucHVzaChpbmRleCk7IA0KICAgICAgICAgICAgICAgICAgICAgICBtb3ZlKGluZGV4LHdhbGxldCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHVwZGF0ZXR5cGUhPTEpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgdD1jb21wYW55SW5kZXhbbXNnLnNlbmRlcl0rMTAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJDb21wYW55KG1zZy5zZW5kZXIsZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RDb21wYW5pZXMtLTsNCiAgICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgIGlmKHVwZGF0ZXR5cGUhPTIpYm90c1tpbmRleF0uaW5mbz1pbmZvOw0KICAgICAgICAgICAgICAgICBpZighYmFuW2NzXSl7YmFsYW5jZXNbY3NdKz1sYXN0UHJpY2VbMV07fWVsc2V7YmFsYW5jZXNbb3duZXJdKz1sYXN0UHJpY2VbMV07fSAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICByZWdpc3RlckJpbGwoY3ljbGVbMV0uY3VycmVudFNlbGxlcixjcyxtc2cuc2VuZGVyLHQsaW5kZXgsbGFzdFByaWNlWzFdKTsgICAgDQogICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJFeHRlcm5hbEJpbGwodWludCBiaSxhZGRyZXNzIHNlbGxzTm93LGFkZHJlc3MgYnV5ZXJ3YWxsZXQsdWludCB0aXBvLHVpbnQgc2VsbCx1aW50IGMpew0KICAgICAgICBpZihtc2cuc2VuZGVyIT1jb250cm9sbGVyKXRocm93Ow0KICAgICAgICByZWdpc3RlckJpbGwoYmksc2VsbHNOb3csYnV5ZXJ3YWxsZXQsdGlwbyxzZWxsLGMpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJCaWxsKHVpbnQgYmksYWRkcmVzcyBzZWxsc05vdyxhZGRyZXNzIGJ1eWVyd2FsbGV0LHVpbnQgdGlwbyx1aW50IHNlbGwsdWludCBjKSBwcml2YXRlew0KICAgICAgICAgDQogICAgICAgICBpZigobXNnLnZhbHVlPGMpfHwobXV0ZSl8fCghVE9TW2J1eWVyd2FsbGV0XSkpdGhyb3c7DQogICAgICAgICBCb3QgYj1ib3RzW2JpXTsNCiAgICAgICAgIHVpbnQgc2VsbGVySW5kZXg7dWludCBidXllckluZGV4Ow0KICAgICAgICAgaWYodGlwbz4xMDApe3NlbGxlckluZGV4PXRpcG8tMTAwO2J1eWVySW5kZXg9c2VsbGVySW5kZXg7dGlwbz0xO31lbHNle3NlbGxlckluZGV4PWNvbXBhbnlJbmRleFtzZWxsc05vd107YnV5ZXJJbmRleD1jb21wYW55SW5kZXhbYnV5ZXJ3YWxsZXRdO30NCiAgICAgICAgDQogICAgICAgICAgTWFya2V0QmlsbHNbbk1iaWxsc109TWFya2V0QmlsbChzZWxsZXJJbmRleCxidXllckluZGV4LHRpcG8sc2VsbCxjLGJsb2NrLm51bWJlcik7DQogICAgICAgDQogICAgICAgICAgICAgICAgYi5iaWxsc1tiLm5iaWxscysxXT1uTWJpbGxzOw0KICAgICAgICAgICAgICAgIGIubmJpbGxzKys7DQogICAgICAgICAgICAgICAgYi5zYWxlc1t0aXBvXSsrOyAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBCdXllcnNCaWxsc1tidXllcndhbGxldF1bQnV5ZXJzQmlsbHNbYnV5ZXJ3YWxsZXRdLmxlbmd0aCsrXT1uTWJpbGxzOw0KICAgICAgICAgICAgICAgIFNlbGxlcnNCaWxsc1tzZWxsc05vd11bU2VsbGVyc0JpbGxzW3NlbGxzTm93XS5sZW5ndGgrK109bk1iaWxsczsNCiAgICAgICAgICAgICAgICBuTWJpbGxzKys7DQogICAgICAgICAgICAgICAgaWYoc2VsbHNOb3chPW93bmVyKXsNCiAgICAgICAgICAgICAgICB0b3RhbCs9YzsNCiAgICAgICAgICAgICAgICBpZih0aXBvIT02KXsNCiAgICAgICAgICAgICAgICBjeWNsZVt0aXBvXS5zb2xkKys7DQogICAgICAgICAgICAgICAgY3ljbGVbdGlwb10uY3VycmVudFNlbGxlcisrOw0KICAgICAgICAgICAgICAgIGlmKChjeWNsZVt0aXBvXS5jdXJyZW50U2VsbGVyPnRvdEJPVFMpfHwoY3ljbGVbdGlwb10uY3VycmVudFNlbGxlcj49c2VsbGluZykpY3ljbGVbdGlwb10uY3VycmVudFNlbGxlcj0xO30NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoY2xhaW1lZDw9MjUwMCltaW5lcltibG9jay5jb2luYmFzZV09dHJ1ZTsNCiAgICAgICAgfQ0KDQogICANCiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJDb21wYW55KGFkZHJlc3Mgd2FsLHN0cmluZyBkYXRhKSBwcml2YXRleyAgICAgICAgDQogICAgICAgIGNvbXBhbnlXYWxsZXRbY29tcGFueVdhbGxldC5sZW5ndGgrK109d2FsOw0KICAgICAgICBjb21wYW55SW5kZXhbd2FsXT1jb21wYW5pZXMubGVuZ3RoOw0KICAgICAgICBjb21wYW5pZXNbY29tcGFuaWVzLmxlbmd0aCsrXT1kYXRhOw0KICAgICAgICB0b3RDb21wYW5pZXMrKzsNCiAgICAgICAgfQ0KICANCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIG11dGVNZShib29sIG0pew0KICAgICAgICBpZigobXNnLnNlbmRlcj09b3duZXIpfHwobXNnLnNlbmRlcj09Y29udHJvbGxlcikpbXV0ZT1tOw0KICAgICAgICB9DQogICAgICAgICAgIA0KICAgICANCiAgICAgICAgZnVuY3Rpb24gdG90Qk9UcygpIGNvbnN0YW50IHJldHVybnModWludCx1aW50LHVpbnQsdWludCx1aW50KSB7cmV0dXJuICAodG90Qk9UUyxjbGFpbWVkLHNlbGxpbmcsY29tcGFuaWVzLmxlbmd0aCx0b3RDb21wYW5pZXMpOyB9DQogICAgICANCg0KICAgICAgICBmdW5jdGlvbiBnZXRCb3RCaWxsaW5nSW5kZXgodWludCBpLHVpbnQgYmkpICBjb25zdGFudCByZXR1cm5zICh1aW50KXsNCiAgICAgICAgcmV0dXJuIGJvdHNbaV0uYmlsbHNbYmldOw0KICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBnZXRCaWxsKHVpbnQgaSx1aW50IGJpKWNvbnN0YW50IHJldHVybnModWludCx1aW50LHVpbnQsdWludCx1aW50LHVpbnQpew0KICAgICAgICBNYXJrZXRCaWxsIGI9TWFya2V0QmlsbHNbaV07DQogICAgICAgIHJldHVybiAoYi5zZWxsZXJkYXRhLGIuYnV5ZXJkYXRhLGIucHJvZHVjdCxiLmluZGV4LGIuY29zdCxiLmJsb2NrKTsNCiAgICAgICAgfQ0KICAgICAgICANCg0KICAgICAgICBmdW5jdGlvbiBnZXROZXh0U2VsbGVyQk9UZGF0YSh1aW50IGN5YykgY29uc3RhbnQgcmV0dXJucyAodWludCx1aW50LHN0cmluZyl7cmV0dXJuIChjeWNsZVtjeWNdLmN1cnJlbnRTZWxsZXIsY3ljbGVbY3ljXS5zb2xkLGNvbXBhbmllc1tjb21wYW55SW5kZXhbYm90c1tjeWNsZVtjeWNdLmN1cnJlbnRTZWxsZXJdLm93bmVyXV0pO30NCiAgIA0KICAgICAgICBmdW5jdGlvbiBnZXRCb3QodWludCBpKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzLHN0cmluZyx1aW50LHVpbnQpew0KICAgICAgICBCb3QgQj1ib3RzW2ldOw0KICAgICAgICByZXR1cm4gKEIub3duZXIsQi5pbmZvLEIuY29zdCxCLm5iaWxscyk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBnZXRPd25lZEJvdChhZGRyZXNzIG93bix1aW50IGJpbmRleCkgY29uc3RhbnQgcmV0dXJucyh1aW50KXtyZXR1cm4gYm90T3duZXJzW293bl1bYmluZGV4XTt9DQogICAgICANCiAgDQogICAgICAgIGZ1bmN0aW9uIGdldEJvdFN0YXRzKHVpbnQgaSx1aW50IGopIGNvbnN0YW50IHJldHVybnMgKHVpbnQpew0KICAgICAgICBCb3QgQj1ib3RzW2ldOw0KICAgICAgICByZXR1cm4gQi5zYWxlc1tqXTt9DQoNCg0KICAgICAgICBmdW5jdGlvbiBnZXRGdWxsQ29tcGFueShhZGRyZXNzIHcsdWludCBpKSBjb25zdGFudCByZXR1cm5zIChzdHJpbmcsdWludCxib29sLHVpbnQsdWludCxzdHJpbmcsYWRkcmVzcyl7cmV0dXJuIChjb21wYW5pZXNbY29tcGFueUluZGV4W3ddXSxib3RPd25lcnNbd10ubGVuZ3RoLG1pbmVyW3ddLGJhbGFuY2VzW3ddLHRoaXMuYmFsYW5jZSxjb21wYW5pZXNbaV0sY29tcGFueVdhbGxldFtpXSk7fQ0KDQoNCiAgICAgICAgZnVuY3Rpb24gZ2V0QWN0b3JCaWxsWGRldGFpbChhZGRyZXNzIHcsdWludCBpLGJvb2wgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50LHVpbnQpe2lmKHdobyl7cmV0dXJuIChTZWxsZXJzQmlsbHNbd11baV0sU2VsbGVyc0JpbGxzW3ddLmxlbmd0aCk7fWVsc2V7cmV0dXJuIChCdXllcnNCaWxsc1t3XVtpXSxCdXllcnNCaWxsc1t3XS5sZW5ndGgpO319DQoNCiAgDQogICAgICAgIGZ1bmN0aW9uIGdldEhvbWVhZHZJbmRleCh1aW50IGluZCkgY29uc3RhbnQgcmV0dXJucyAodWludCl7cmV0dXJuIGhhZHZbaW5kXTt9DQoNCiAgICAgICAgZnVuY3Rpb24gZ2V0TGFzdFByaWNlKHVpbnQgaSkgY29uc3RhbnQgcmV0dXJucyAodWludCx1aW50LHVpbnQsdWludCx1aW50KXtyZXR1cm4gKGxhc3RQcmljZVtpXSxsYXN0UHJpY2VbbGFzdFByaWNlLmxlbmd0aC0xXSxzZWxsaW5nLG5NYmlsbHMsdG90YWwpO30NCg0KICAgICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlcihhZGRyZXNzIGEpIHJldHVybnMoYm9vbCl7aWYobXNnLnNlbmRlciE9b3duZXIpdGhyb3c7Y29udHJvbGxlcj1hO2NvbnRyb2w9QVJLQ29udHJvbGxlcl8xXzAwKGEpO2xvZ3MucHVzaChsb2cob3duZXIsInNldENlbnNvcmVyIixhKSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gcmVhZExvZyh1aW50IGkpY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzLHN0cmluZyxhZGRyZXNzKXtsb2cgbD1sb2dzW2ldO3JldHVybihsLmFkbWluLGwuYWN0aW9uLGwuYWRkcik7fQ0KICAgIA0KDQogICAgICAgIGZ1bmN0aW9uIGNlbnNvcnNoaXAodWludCBpLGJvb2wgYixib29sIGMpIHJldHVybnMoYm9vbCl7DQogICAgICAgIGlmKG1zZy5zZW5kZXIhPWNvbnRyb2xsZXIpdGhyb3c7DQogICAgICAgIGlmKGMpe2NvaW5zW2ldPUNvaW4oe2NvaW5Pd25lciA6IDB4MCxkYXRhIDogIkNlbnNvcmVkIixtaW5lIDogIiIsY29pblR5cGUgOiAwLHBsYXRmOiAwLGFkdiA6ICIiLGJsb2NrIDogMH0pO31lbHNlew0KICAgICAgICBpZihiKXsNCiAgICAgICAgdHJhc2hbaV09Y29pbnNbaV07DQogICAgICAgIGNvaW5zW2ldPUNvaW4oe2NvaW5Pd25lciA6IDB4MCxkYXRhIDogIkNlbnNvcmVkIixtaW5lIDogIiIsY29pblR5cGUgOiAwLHBsYXRmOiAwLGFkdiA6ICIiLGJsb2NrIDogMH0pOw0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgY29pbnNbaV09dHJhc2hbaV07DQogICAgICAgIH19DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCg0KICAgICAgICBmdW5jdGlvbiBzZXRQcmljZSh1aW50IGksdWludCBqKSByZXR1cm5zKGJvb2wpe2lmKG1zZy5zZW5kZXIhPWNvbnRyb2xsZXIpdGhyb3c7aWYoaTw3KWxhc3RQcmljZVtpXT1qOyByZXR1cm4gdHJ1ZTt9ICAgDQogICAgICAgICANCg0KICAgICAgICBmdW5jdGlvbiBhY2NlcHRUT1MoYWRkcmVzcyBhLGJvb2wgYikgIHJldHVybnMoYm9vbCl7DQogICAgICAgIGlmKGIpaWYoIWJhblttc2cuc2VuZGVyXSl7VE9TW21zZy5zZW5kZXJdPXRydWU7YmFuW21zZy5zZW5kZXJdPWZhbHNlO30NCiAgICAgICAgaWYobXNnLnNlbmRlcj09Y29udHJvbGxlcil7VE9TW2FdPWI7aWYoIWIpYmFuW2FdPXRydWU7bG9ncy5wdXNoKGxvZyhjb250cm9sbGVyLCJzZXRUT1MiLGEpKTsgcmV0dXJuIHRydWU7fQ0KICAgICAgICB9DQoNCg0KICAgICAgICBmdW5jdGlvbiBnZXRUT1MoYWRkcmVzcyBhKWNvbnN0YW50IHJldHVybnMoYm9vbCkge3JldHVybiBUT1NbYV07fQ0KDQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBvd25zKGFkZHJlc3MgYSkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7cmV0dXJuIGJvdE93bmVyc1thXS5sZW5ndGg+MDt9DQoNCg0KICAgICAgICBmdW5jdGlvbiBnZXRDb2luKHVpbnQgbikgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyxzdHJpbmcsdWludCx1aW50LHN0cmluZyxzdHJpbmcpIHsNCiAgICAgICAgQ29pbiBjID0gY29pbnNbbl07DQogICAgICAgIHJldHVybiAoYy5jb2luT3duZXIsYy5kYXRhLGMuY29pblR5cGUsYy5wbGF0ZixjLm1pbmUsYy5hZHYpOyAgIA0KICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgZnVuY3Rpb24gVHJhc2godWludCBuKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzLHN0cmluZyx1aW50LHVpbnQsc3RyaW5nLHN0cmluZykgew0KICAgICAgICBpZigobXNnLnNlbmRlciE9Y29udHJvbGxlcikmJighKGdldE93bmVkQm90KG1zZy5zZW5kZXIsMCk+MCkpKSAgICAgIA0KICAgICAgICBDb2luIGMgPSB0cmFzaFtuXTsgICANCiAgICAgICAgcmV0dXJuIChjLmNvaW5Pd25lcixjLmRhdGEsYy5jb2luVHlwZSxjLnBsYXRmLGMubWluZSxjLmFkdik7IA0KICAgICAgICB9DQoNCiAgICAgICANCiAgICAgICAgZnVuY3Rpb24gZ2V0Q29pblN0YXRzKHVpbnQgaSkgY29uc3RhbnQgcmV0dXJucyAodWludCx1aW50KXsNCiAgICAgICAgcmV0dXJuIChsaXN0ZWRbaV0sY29pbkluZGV4KTsgICANCiAgICAgICAgfQ0KICAgICAgIA0KDQogICAgICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCl7DQogICAgICAgIGlmKCFUT1NbbXNnLnNlbmRlcl0pdGhyb3c7DQogICAgICAgIHVpbnQgdD1iYWxhbmNlc1ttc2cuc2VuZGVyXTsNCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl09MDsNCiAgICAgICAgaWYoIShtc2cuc2VuZGVyLnNlbmQodCkpKXRocm93Ow0KICAgICAgICB9DQoNCg0KICAgICAgICBmdW5jdGlvbiAoKXt0aHJvdzt9DQoNCiB9DQoNCg0KDQoNCg0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQpjb250cmFjdCBBUktDb250cm9sbGVyXzFfMDAgew0KICAgIC8qIENvbnN0cnVjdG9yICovDQogICAgQVJLIEFyazsNCg0KICAgIGV2ZW50IENvaW5TZW50KHVpbnQgaW5kZXhlZCBpZCxhZGRyZXNzIGZyb20sc3RyaW5nIG5hbWUpOw0KDQogICAgYWRkcmVzcyBvd25lcjsNCiAgICBhZGRyZXNzIFNvdXJjZTsNCg0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKWFkbWluaXN0cmF0b3I7DQogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpbW9kdWxlOw0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBzdHJpbmcpYWRtaW5OYW1lOw0KDQogICAgbWFwcGluZyh1aW50ID0+IGJvb2wpcmVzdG9yZTsNCg0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQogICAgbG9nW10gbG9nczsNCg0KICAgIHN0cnVjdCBsb2d7DQogICAgYWRkcmVzcyBhZG1pbjsNCiAgICBzdHJpbmcgd2hhdDsNCiAgICB1aW50IGlkOw0KICAgIGFkZHJlc3MgYTsNCiAgICB9DQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCiAgICANCiAgICBmdW5jdGlvbiBBUktDb250cm9sbGVyXzFfMDAoKSB7DQogICAgb3duZXI9bXNnLnNlbmRlcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZXRPd25lcihhZGRyZXNzIGEsc3RyaW5nIG5hbWUpIHsNCiAgICBpZihtc2cuc2VuZGVyPT1vd25lcilvd25lcj1hOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGJhbihhZGRyZXNzIGEpIHJldHVybnMoYm9vbCl7DQogICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldEFkbWluaXN0cmF0b3IoYWRkcmVzcyBhLHN0cmluZyBuYW1lLGJvb2wgeWVzbm8pIHsNCiAgICBpZihpc01vZHVsZShtc2cuc2VuZGVyKSl7DQogICAgYWRtaW5pc3RyYXRvclthXT15ZXNubzsNCiAgICBhZG1pbk5hbWVbYV09bmFtZTsNCiAgICANCiAgICBpZihtc2cuc2VuZGVyPT1vd25lcilsb2dzLnB1c2gobG9nKG1zZy5zZW5kZXIsInNldEFkbWluIiwwLGEpKTsNCiAgICBpZihtc2cuc2VuZGVyIT1vd25lcilsb2dzLnB1c2gobG9nKG1zZy5zZW5kZXIsIm1vZHVsZVNldEFkbWluIiwwLGEpKTsNCiAgICANCiAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0TW9kdWxlKGFkZHJlc3MgYSxib29sIHllc25vKSB7DQogICAgaWYoIWlzTW9kdWxlKG1zZy5zZW5kZXIpKXRocm93Ow0KICAgIG1vZHVsZVthXT15ZXNubzsNCiAgICBsb2dzLnB1c2gobG9nKG93bmVyLCJzZXRNb2R1bGUiLDAsYSkpOw0KDQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0UHJpY2UodWludCBpLHVpbnQgail7DQogICAgaWYoKCFpc01vZHVsZShtc2cuc2VuZGVyKSl8fChpPjYpKXRocm93Ow0KICAgIEFyay5zZXRQcmljZShpLGopOw0KICAgIGxvZ3MucHVzaChsb2cobXNnLnNlbmRlciwic2V0UHJpY2UiLGksbXNnLnNlbmRlcikpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldFRPUyhhZGRyZXNzIGEsYm9vbCBiKXsNCiAgICBpZighaXNNb2R1bGUobXNnLnNlbmRlcikpdGhyb3c7DQogICAgQXJrLmFjY2VwdFRPUyhhLGIpOw0KICAgIH0NCg0KICAgIA0KICAgIGZ1bmN0aW9uIHNldFNvdXJjZShhZGRyZXNzIGEpIHsNCiAgICBpZihtc2cuc2VuZGVyIT1vd25lcil0aHJvdzsNCiAgICBBcms9QVJLKGEpOyAgICANCiAgICBTb3VyY2U9YTsNCiAgICBsb2dzLnB1c2gobG9nKG1zZy5zZW5kZXIsInNldFNvdXJjZSIsMCxhKSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0QVJLb3duZXIoYWRkcmVzcyBhKSB7DQogICAgaWYobXNnLnNlbmRlciE9b3duZXIpdGhyb3c7DQogICAgQXJrLmluaXRTdGF0cygiIixhLDMzMyk7DQogICAgbG9ncy5wdXNoKGxvZyhtc2cuc2VuZGVyLCJzZXRBUktvd25lciIsMCwweDApKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiByZXN0b3JlSXRlbSh1aW50IGkpew0KICAgIGlmKGlzQWRtaW4obXNnLnNlbmRlcil8fGlzTW9kdWxlKG1zZy5zZW5kZXIpKXsNCiAgICBBcmsuY2Vuc29yc2hpcChpLGZhbHNlLGZhbHNlKTsNCiAgICBsb2dzLnB1c2gobG9nKG1zZy5zZW5kZXIsInJlc3RvcmUiLGksMHgwKSk7DQogICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFwcGx5Q2Vuc29yc2hpcCh1aW50IGkpew0KICAgIGlmKCFpc0FkbWluKG1zZy5zZW5kZXIpKXRocm93Ow0KICAgIEFyay5jZW5zb3JzaGlwKGksdHJ1ZSxmYWxzZSk7DQogICAgbG9ncy5wdXNoKGxvZyhtc2cuc2VuZGVyLCJjZW5zb3IiLGksMHgwKSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGVsZXRlQ29pbih1aW50IGkpew0KICAgIGlmKCFpc01vZHVsZShtc2cuc2VuZGVyKSl0aHJvdzsNCiAgICBBcmsuY2Vuc29yc2hpcChpLHRydWUsdHJ1ZSk7DQogICAgbG9ncy5wdXNoKGxvZyhtc2cuc2VuZGVyLCJjZW5zb3IiLGksMHgwKSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcmVnaXN0ZXJFeHRlcm5hbEJpbGwodWludCBiaSxhZGRyZXNzIHNlbGxzTm93LGFkZHJlc3MgYnV5ZXJ3YWxsZXQsdWludCB0aXBvLHVpbnQgc2VsbCx1aW50IGMpIHByaXZhdGV7DQogICAgaWYoIWlzTW9kdWxlKG1zZy5zZW5kZXIpKXRocm93Ow0KICAgIEFyay5yZWdpc3RlckV4dGVybmFsQmlsbChiaSxzZWxsc05vdyxidXllcndhbGxldCx0aXBvLHNlbGwsYyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHVzaENvaW4odWludCBpLGFkZHJlc3MgYSxzdHJpbmcgcykgcmV0dXJucyhib29sKXsNCiAgICBpZihtc2cuc2VuZGVyIT1Tb3VyY2UpdGhyb3c7DQogICAgQ29pblNlbnQoaSxhLHMpOw0KICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGlzQWRtaW4oYWRkcmVzcyBhKWNvbnN0YW50IHJldHVybnMoYm9vbCl7DQogICAgYm9vbCBiPWZhbHNlOw0KICAgIGlmKChhPT1vd25lcil8fChhZG1pbmlzdHJhdG9yW2FdKSliPXRydWU7DQogICAgcmV0dXJuIGI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gaXNNb2R1bGUoYWRkcmVzcyBhKWNvbnN0YW50IHJldHVybnMoYm9vbCl7DQogICAgYm9vbCBiPWZhbHNlOw0KICAgIGlmKChhPT1vd25lcil8fChtb2R1bGVbYV0pKWI9dHJ1ZTsNCiAgICByZXR1cm4gYjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRBZG1pbk5hbWUoYWRkcmVzcyBhKWNvbnN0YW50IHJldHVybnMoc3RyaW5nKXsNCiAgICByZXR1cm4gYWRtaW5OYW1lW2FdOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldFNvdXJjZSgpY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKXsNCiAgICByZXR1cm4gU291cmNlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlYWRMb2codWludCBpKWNvbnN0YW50IHJldHVybnMoc3RyaW5nLGFkZHJlc3Msc3RyaW5nLHVpbnQsYWRkcmVzcyl7DQogICAgbG9nIGw9bG9nc1tpXTsNCiAgICByZXR1cm4oZ2V0QWRtaW5OYW1lKGwuYWRtaW4pLGwuYWRtaW4sbC53aGF0LGwuaWQsbC5hKTsNCiAgICB9DQogICAgDQoNCn0NCg0KDQoNCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KDQpjb250cmFjdCBBUktUYWdnZXJfMV8wMCB7DQogICAgLyogQ29uc3RydWN0b3IgKi8NCiAgICBBUksgQXJrOw0KDQogICAgYWRkcmVzcyBvd25lcjsNCg0KICAgIHN0cmluZ1tdIGxhc3RUYWdzOw0KICAgIG1hcHBpbmcgKHN0cmluZyA9PiB1aW50W10pIHRhZ2dlZDsNCg0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQogICAgbG9nW10gbG9nczsNCg0KICAgIHN0cnVjdCBsb2d7DQogICAgYWRkcmVzcyBhZG1pbjsNCiAgICBzdHJpbmcgYWN0aW9uOw0KICAgIGFkZHJlc3MgYWRkcjsNCiAgICB9DQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIGZ1bmN0aW9uIEFSS1RhZ2dlcl8xXzAwKCkgew0KICAgIG93bmVyPW1zZy5zZW5kZXI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBhKSB7DQogICAgaWYobXNnLnNlbmRlciE9b3duZXIpdGhyb3c7DQogICAgb3duZXI9YTsNCiAgICBsb2dzLnB1c2gobG9nKG93bmVyLCJzZXRPd25lciIsYSkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldFNvdXJjZShhZGRyZXNzIGEpIHsNCiAgICBpZihtc2cuc2VuZGVyIT1vd25lcil0aHJvdzsNCiAgICBBcms9QVJLKGEpOw0KICAgIGxvZ3MucHVzaChsb2cob3duZXIsInNldFNvdXJjZSIsYSkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlYWRMb2codWludCBpKWNvbnN0YW50IHJldHVybnMoYWRkcmVzcyxzdHJpbmcsYWRkcmVzcyl7DQogICAgbG9nIGw9bG9nc1tpXTsNCiAgICByZXR1cm4obC5hZG1pbixsLmFjdGlvbixsLmFkZHIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldExhc3RUYWcodWludCBpKSBjb25zdGFudCByZXR1cm5zKHN0cmluZyB0YWcpew0KICAgIHJldHVybiBsYXN0VGFnc1tpXTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhZGRUYWcodWludCBpLHN0cmluZyB0YWcpe3RhZ2dlZFt0YWddW3RhZ2dlZFt0YWddLmxlbmd0aCsrXT1pO2xhc3RUYWdzW2xhc3RUYWdzLmxlbmd0aCsrXT10YWc7fQ0KDQogICAgZnVuY3Rpb24gZ2V0VGFnKHN0cmluZyB0YWcsdWludCBpKSBjb25zdGFudCByZXR1cm5zKHVpbnQsdWludCl7cmV0dXJuICh0YWdnZWRbdGFnXVtpXSx0YWdnZWRbdGFnXS5sZW5ndGgpO30NCg0KDQp9'