base 64 content
base64adsharesToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLyoqDQogKiBAdGl0bGUgRVJDMjBCYXNpYw0KICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlDQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqLw0KY29udHJhY3QgRVJDMjBCYXNpYyB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQp9DQoNCi8qKg0KICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcw0KICovDQpsaWJyYXJ5IFNhZmVNYXRoIHsNCiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMA0KICAgIHVpbnQgYyA9IGEgLyBiOw0KICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkDQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICBhc3NlcnQoYiA8PSBhKTsNCiAgICByZXR1cm4gYSAtIGI7DQogIH0NCg0KICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYyA+PSBhKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQogIA0KICAvKioNCiAgICogQmFzZWQgb24gaHR0cDovL3d3dy5jb2RlY29kZXguY29tL3dpa2kvQ2FsY3VsYXRlX2FuX2ludGVnZXJfc3F1YXJlX3Jvb3QNCiAgICovDQogIGZ1bmN0aW9uIHNxcnQodWludCBudW0pIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICBpZiAoMCA9PSBudW0pIHsgLy8gQXZvaWQgemVybyBkaXZpZGUgDQogICAgICByZXR1cm4gMDsgDQogICAgfSAgIA0KICAgIHVpbnQgbiA9IChudW0gLyAyKSArIDE7ICAgICAgLy8gSW5pdGlhbCBlc3RpbWF0ZSwgbmV2ZXIgbG93ICANCiAgICB1aW50IG4xID0gKG4gKyAobnVtIC8gbikpIC8gMjsgIA0KICAgIHdoaWxlIChuMSA8IG4pIHsgIA0KICAgICAgbiA9IG4xOyAgDQogICAgICBuMSA9IChuICsgKG51bSAvIG4pKSAvIDI7ICANCiAgICB9ICANCiAgICByZXR1cm4gbjsgIA0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7DQogICAgaWYgKCFhc3NlcnRpb24pIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KfQ0KDQovKioNCiAqIEB0aXRsZSBCYXNpYyB0b2tlbg0KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4gDQogKi8NCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7DQogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50Ow0KDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsNCg0KICAvKioNCiAgICogQGRldiBGaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjay4NCiAgICovDQogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsNCiAgICAgaWYobXNnLmRhdGEubGVuZ3RoIDwgc2l6ZSArIDQpIHsNCiAgICAgICB0aHJvdzsNCiAgICAgfQ0KICAgICBfOw0KICB9DQoNCiAgLyoqDQogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcw0KICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uDQogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLg0KICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHsNCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOw0KICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuDQogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuIA0KICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuDQogICovDQogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7DQogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogIH0NCg0KfQ0KDQovKioNCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UNCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQovKioNCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbg0KICoNCiAqIEBkZXYgSW1wbGVtYW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJ0IHRva2VuLg0KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wNCiAqLw0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBCYXNpY1Rva2VuLCBFUkMyMCB7DQoNCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOw0KDQogIC8qKg0KICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXINCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQ0KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8NCiAgICogQHBhcmFtIF92YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZA0KICAgKi8NCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgew0KICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07DQoNCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQNCiAgICAvLyBpZiAoX3ZhbHVlID4gX2FsbG93YW5jZSkgdGhyb3c7DQoNCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsNCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7DQogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOw0KICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWFobGYgb2YgbXNnLnNlbmRlci4NCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLg0KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50Lg0KICAgKi8NCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgew0KDQogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2ANCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdA0KICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOg0KICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQ0KICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgdGhyb3c7DQoNCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYW4gYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuDQogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4NCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuDQogICAqIEByZXR1cm4gQSB1aW50IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpYmxlIGZvciB0aGUgc3BlbmRlci4NCiAgICovDQogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsNCiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgfQ0KDQp9DQoNCi8qKg0KICogQHRpdGxlIEFkc2hhcmVzIElDTyB0b2tlbg0KICogDQogKiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2Fkc2hhcmVzL2ljbw0KICoNCiAqLw0KY29udHJhY3QgQWRzaGFyZXNUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsNCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsNCg0KICAgIC8vIG1ldGFkYXRhDQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkFkc2hhcmVzIFRva2VuIjsNCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJBRFNUIjsNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDA7DQogICAgDQogICAgLy8gY3Jvd2RzYWxlIHBhcmFtZXRlcnMNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCB0b2tlbkNyZWF0aW9uTWluID0gMTAwMDAwMDA7DQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgdG9rZW5QcmljZU1pbiA9IDAuMDAwNCBldGhlcjsNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCB0cmFkZVNwcmVhZEludmVydCA9IDUwOyAvLyAyJQ0KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IGNyb3dkc2FsZUVuZExvY2tUaW1lID0gMSB3ZWVrczsNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBmdW5kaW5nVW5sb2NrUGVyaW9kID0gMSB3ZWVrczsNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBmdW5kaW5nVW5sb2NrRnJhY3Rpb25JbnZlcnQgPSAxMDA7IC8vIDEgJQ0KICAgIA0KICAgIC8vIGNvbnRydWN0b3IgcGFyYW1ldGVycw0KICAgIHVpbnQgcHVibGljIGNyb3dkc2FsZVN0YXJ0QmxvY2s7DQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXIxOw0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyMjsNCiAgICBhZGRyZXNzIHB1YmxpYyB3aXRoZHJhd0FkZHJlc3M7IC8vIG11bHRpLXNpZyB3YWxsZXQgdGhhdCB3aWxsIHJlY2VpdmUgZXRoZXINCg0KICAgIA0KICAgIC8vIGNvbnRyYWN0IHN0YXRlDQogICAgYm9vbCBwdWJsaWMgbWluRnVuZGluZ1JlYWNoZWQ7DQogICAgdWludCBwdWJsaWMgY3Jvd2RzYWxlRW5kRGVjbGFyYXRpb25UaW1lID0gMDsNCiAgICB1aW50IHB1YmxpYyBmdW5kaW5nVW5sb2NrVGltZSA9IDA7ICANCiAgICB1aW50IHB1YmxpYyB1bmxvY2tlZEJhbGFuY2UgPSAwOyAgDQogICAgdWludCBwdWJsaWMgd2l0aGRyYXduQmFsYW5jZSA9IDA7DQogICAgYm9vbCBwdWJsaWMgaXNIYWx0ZWQgPSBmYWxzZTsNCg0KICAgIC8vIGV2ZW50cw0KICAgIGV2ZW50IExvZ0J1eShhZGRyZXNzIGluZGV4ZWQgd2hvLCB1aW50IHRva2VucywgdWludCBwdXJjaGFzZVZhbHVlLCB1aW50IHN1cHBseUFmdGVyKTsNCiAgICBldmVudCBMb2dTZWxsKGFkZHJlc3MgaW5kZXhlZCB3aG8sIHVpbnQgdG9rZW5zLCB1aW50IHNhbGVWYWx1ZSwgdWludCBzdXBwbHlBZnRlcik7DQogICAgZXZlbnQgTG9nV2l0aGRyYXcodWludCBhbW91bnQpOw0KICAgIGV2ZW50IExvZ0Nyb3dkc2FsZUVuZChib29sIGNvbXBsZXRlZCk7ICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIEBkZXYgQ2hlY2tzIGlmIGZ1bmRpbmcgaXMgYWN0aXZlDQogICAgICovDQogICAgbW9kaWZpZXIgZnVuZGluZ0FjdGl2ZSgpIHsNCiAgICAgIC8vIE5vdCB5ZXQgc3RhcnRlZA0KICAgICAgaWYgKGJsb2NrLm51bWJlciA8IGNyb3dkc2FsZVN0YXJ0QmxvY2spIHsNCiAgICAgICAgdGhyb3c7DQogICAgICB9DQogICAgICAvLyBBbHJlYWR5IGVuZGVkDQogICAgICBpZiAoY3Jvd2RzYWxlRW5kRGVjbGFyYXRpb25UaW1lID4gMCAmJiBibG9jay50aW1lc3RhbXAgPiBjcm93ZHNhbGVFbmREZWNsYXJhdGlvblRpbWUgKyBjcm93ZHNhbGVFbmRMb2NrVGltZSkgew0KICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICBfOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiBvbmUgb2YgdGhlIG93bmVycy4gDQogICAgICovDQogICAgbW9kaWZpZXIgb25seU93bmVyKCkgew0KICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIxICYmIG1zZy5zZW5kZXIgIT0gb3duZXIyKSB7DQogICAgICAgIHRocm93Ow0KICAgICAgfQ0KICAgICAgXzsNCiAgICB9DQogICAgDQogICAgLy8gY29uc3RydWN0b3INCiAgICBmdW5jdGlvbiBBZHNoYXJlc1Rva2VuIChhZGRyZXNzIF9vd25lcjEsIGFkZHJlc3MgX293bmVyMiwgYWRkcmVzcyBfd2l0aGRyYXdBZGRyZXNzLCB1aW50IF9jcm93ZHNhbGVTdGFydEJsb2NrKQ0KICAgIHsNCiAgICAgICAgb3duZXIxID0gX293bmVyMTsNCiAgICAgICAgb3duZXIyID0gX293bmVyMjsNCiAgICAgICAgd2l0aGRyYXdBZGRyZXNzID0gX3dpdGhkcmF3QWRkcmVzczsNCiAgICAgICAgY3Jvd2RzYWxlU3RhcnRCbG9jayA9IF9jcm93ZHNhbGVTdGFydEJsb2NrOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIG5vdCB5ZXQgdW5sb2NrZWQgYmFsYW5jZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGdldExvY2tlZEJhbGFuY2UoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQgbG9ja2VkQmFsYW5jZSkgew0KICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlLnN1Yih1bmxvY2tlZEJhbGFuY2UpOw0KICAgICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIEBkZXYgQ2FsY3VsYXRlcyBob3cgbWFueSB0b2tlbnMgb25lIGNhbiBidXkgZm9yIHNwZWNpZmllZCB2YWx1ZQ0KICAgICAqIEByZXR1cm4gQW1vdW50IG9mIHRva2VucyBvbmUgd2lsbCByZWNlaXZlIGFuZCBwdXJjaGFzZSB2YWx1ZSB3aXRob3V0IHJlbWFpbmRlci4gDQogICAgICovDQogICAgZnVuY3Rpb24gZ2V0QnV5UHJpY2UodWludCBfYmlkVmFsdWUpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5Db3VudCwgdWludCBwdXJjaGFzZVZhbHVlKSB7DQoNCiAgICAgICAgLy8gVG9rZW4gcHJpY2UgZm9ybXVsYSBpcyB0d29mb2xkLiBXZSBoYXZlIGZsYXQgcHJpY2luZyBiZWxvdyB0b2tlbkNyZWF0aW9uTWluLCANCiAgICAgICAgLy8gYW5kIGFib3ZlIHRoYXQgcHJpY2UgbGluYXJseSBpbmNyZWFzZXMgd2l0aCBzdXBwbHkuIA0KDQogICAgICAgIHVpbnQgZmxhdFRva2VuQ291bnQ7DQogICAgICAgIHVpbnQgc3RhcnRTdXBwbHk7DQogICAgICAgIHVpbnQgbGluZWFyQmlkVmFsdWU7DQogICAgICAgIA0KICAgICAgICBpZih0b3RhbFN1cHBseSA8IHRva2VuQ3JlYXRpb25NaW4pIHsNCiAgICAgICAgICAgIHVpbnQgbWF4RmxhdFRva2VuQ291bnQgPSBfYmlkVmFsdWUuZGl2KHRva2VuUHJpY2VNaW4pOw0KICAgICAgICAgICAgLy8gZW50aXJlIHB1cmNoYXNlIGluIGZsYXQgcHJpY2luZw0KICAgICAgICAgICAgaWYodG90YWxTdXBwbHkuYWRkKG1heEZsYXRUb2tlbkNvdW50KSA8PSB0b2tlbkNyZWF0aW9uTWluKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIChtYXhGbGF0VG9rZW5Db3VudCwgbWF4RmxhdFRva2VuQ291bnQubXVsKHRva2VuUHJpY2VNaW4pKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZsYXRUb2tlbkNvdW50ID0gdG9rZW5DcmVhdGlvbk1pbi5zdWIodG90YWxTdXBwbHkpOw0KICAgICAgICAgICAgbGluZWFyQmlkVmFsdWUgPSBfYmlkVmFsdWUuc3ViKGZsYXRUb2tlbkNvdW50Lm11bCh0b2tlblByaWNlTWluKSk7DQogICAgICAgICAgICBzdGFydFN1cHBseSA9IHRva2VuQ3JlYXRpb25NaW47DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBmbGF0VG9rZW5Db3VudCA9IDA7DQogICAgICAgICAgICBsaW5lYXJCaWRWYWx1ZSA9IF9iaWRWYWx1ZTsNCiAgICAgICAgICAgIHN0YXJ0U3VwcGx5ID0gdG90YWxTdXBwbHk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFNvbHZlcyBxdWFkcmF0aWMgZXF1YXRpb24gdG8gY2FsY3VsYXRlIG1heGltdW0gdG9rZW4gY291bnQgdGhhdCBjYW4gYmUgcHVyY2hhc2VkDQogICAgICAgIHVpbnQgY3VycmVudFByaWNlID0gdG9rZW5QcmljZU1pbi5tdWwoc3RhcnRTdXBwbHkpLmRpdih0b2tlbkNyZWF0aW9uTWluKTsNCiAgICAgICAgdWludCBkZWx0YSA9ICgyICogc3RhcnRTdXBwbHkpLm11bCgyICogc3RhcnRTdXBwbHkpLmFkZChsaW5lYXJCaWRWYWx1ZS5tdWwoNCAqIDEgKiAyICogc3RhcnRTdXBwbHkpLmRpdihjdXJyZW50UHJpY2UpKTsNCg0KICAgICAgICB1aW50IGxpbmVhclRva2VuQ291bnQgPSBkZWx0YS5zcXJ0KCkuc3ViKDIgKiBzdGFydFN1cHBseSkuZGl2KDIpOw0KICAgICAgICB1aW50IGxpbmVhckF2Z1ByaWNlID0gY3VycmVudFByaWNlLmFkZCgoc3RhcnRTdXBwbHkrbGluZWFyVG9rZW5Db3VudCsxKS5tdWwodG9rZW5QcmljZU1pbikuZGl2KHRva2VuQ3JlYXRpb25NaW4pKS5kaXYoMik7DQogICAgICAgIA0KICAgICAgICAvLyBkb3VibGUgY2hlY2sgdG8gZWxpbWluYXRlIHJvdW5kaW5nIGVycm9ycw0KICAgICAgICBsaW5lYXJUb2tlbkNvdW50ID0gbGluZWFyQmlkVmFsdWUgLyBsaW5lYXJBdmdQcmljZTsNCiAgICAgICAgbGluZWFyQXZnUHJpY2UgPSBjdXJyZW50UHJpY2UuYWRkKChzdGFydFN1cHBseStsaW5lYXJUb2tlbkNvdW50KzEpLm11bCh0b2tlblByaWNlTWluKS5kaXYodG9rZW5DcmVhdGlvbk1pbikpLmRpdigyKTsNCiAgICAgICAgDQogICAgICAgIHB1cmNoYXNlVmFsdWUgPSBsaW5lYXJUb2tlbkNvdW50Lm11bChsaW5lYXJBdmdQcmljZSkuYWRkKGZsYXRUb2tlbkNvdW50Lm11bCh0b2tlblByaWNlTWluKSk7DQogICAgICAgIHJldHVybiAoDQogICAgICAgICAgICBmbGF0VG9rZW5Db3VudCArIGxpbmVhclRva2VuQ291bnQsDQogICAgICAgICAgICBwdXJjaGFzZVZhbHVlDQogICAgICAgICk7DQogICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBAZGV2IENhbGN1bGF0ZXMgYXZlcmFnZSB0b2tlbiBwcmljZSBmb3Igc2FsZSBvZiBzcGVjaWZpZWQgdG9rZW4gY291bnQNCiAgICAgKiBAcmV0dXJuIFRvdGFsIHZhbHVlIHJlY2VpdmVkIGZvciBnaXZlbiBzYWxlIHNpemUuIA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGdldFNlbGxQcmljZSh1aW50IF9hc2tTaXplVG9rZW5zKSBjb25zdGFudCByZXR1cm5zICh1aW50IHNhbGVWYWx1ZSkgew0KICAgICAgICANCiAgICAgICAgdWludCBmbGF0VG9rZW5Db3VudDsNCiAgICAgICAgdWludCBsaW5lYXJUb2tlbk1pbjsNCiAgICAgICAgDQogICAgICAgIGlmKHRvdGFsU3VwcGx5IDw9IHRva2VuQ3JlYXRpb25NaW4pIHsNCiAgICAgICAgICAgIHJldHVybiB0b2tlblByaWNlTWluICogX2Fza1NpemVUb2tlbnM7DQogICAgICAgIH0NCiAgICAgICAgaWYodG90YWxTdXBwbHkuc3ViKF9hc2tTaXplVG9rZW5zKSA8IHRva2VuQ3JlYXRpb25NaW4pIHsNCiAgICAgICAgICAgIGZsYXRUb2tlbkNvdW50ID0gdG9rZW5DcmVhdGlvbk1pbiAtIHRvdGFsU3VwcGx5LnN1YihfYXNrU2l6ZVRva2Vucyk7DQogICAgICAgICAgICBsaW5lYXJUb2tlbk1pbiA9IHRva2VuQ3JlYXRpb25NaW47DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBmbGF0VG9rZW5Db3VudCA9IDA7DQogICAgICAgICAgICBsaW5lYXJUb2tlbk1pbiA9IHRvdGFsU3VwcGx5LnN1YihfYXNrU2l6ZVRva2Vucyk7DQogICAgICAgIH0NCiAgICAgICAgdWludCBsaW5lYXJUb2tlbkNvdW50ID0gX2Fza1NpemVUb2tlbnMgLSBmbGF0VG9rZW5Db3VudDsNCiAgICAgICAgDQogICAgICAgIHVpbnQgbWluUHJpY2UgPSAobGluZWFyVG9rZW5NaW4pLm11bCh0b2tlblByaWNlTWluKS5kaXYodG9rZW5DcmVhdGlvbk1pbik7DQogICAgICAgIHVpbnQgbWF4UHJpY2UgPSAodG90YWxTdXBwbHkrMSkubXVsKHRva2VuUHJpY2VNaW4pLmRpdih0b2tlbkNyZWF0aW9uTWluKTsNCiAgICAgICAgDQogICAgICAgIHVpbnQgbGluZWFyQXZlcmFnZVByaWNlID0gbWluUHJpY2UuYWRkKG1heFByaWNlKS5kaXYoMik7DQogICAgICAgIHJldHVybiBsaW5lYXJBdmVyYWdlUHJpY2UubXVsKGxpbmVhclRva2VuQ291bnQpLmFkZChmbGF0VG9rZW5Db3VudC5tdWwodG9rZW5QcmljZU1pbikpOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBEZWZhdWx0IGZ1bmN0aW9uIGNhbGxlZCBieSBzZW5kaW5nIEV0aGVyIHRvIHRoaXMgYWRkcmVzcyB3aXRoIG5vIGFyZ3VtZW50cy4NCiAgICAgKiBAZGV2IEJ1eSB0b2tlbnMgd2l0aCBtYXJrZXQgb3JkZXINCiAgICAgKi8NCiAgICBmdW5jdGlvbigpIHBheWFibGUgZnVuZGluZ0FjdGl2ZQ0KICAgIHsNCiAgICAgICAgYnV5TGltaXQoMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGKTsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQGRldiBCdXkgdG9rZW5zIHdpdGhvdXQgcHJpY2UgbGltaXQNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBidXkoKSBwYXlhYmxlIGV4dGVybmFsIGZ1bmRpbmdBY3RpdmUgew0KICAgICAgICBidXlMaW1pdCgweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYpOyAgICANCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQGRldiBCdXkgdG9rZW5zIHdpdGggbGltaXQgbWF4aW11bSBhdmVyYWdlIHByaWNlDQogICAgICogQHBhcmFtIF9tYXhQcmljZSBNYXhpbXVtIHByaWNlIHVzZXIgd2FudCB0byBwYXkgZm9yIG9uZSB0b2tlbg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJ1eUxpbWl0KHVpbnQgX21heFByaWNlKSBwYXlhYmxlIHB1YmxpYyBmdW5kaW5nQWN0aXZlIHsNCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gdG9rZW5QcmljZU1pbik7DQogICAgICAgIGFzc2VydCghaXNIYWx0ZWQpOw0KICAgICAgICANCiAgICAgICAgdWludCBib3VnaHRUb2tlbnM7DQogICAgICAgIHVpbnQgYXZlcmFnZVByaWNlOw0KICAgICAgICB1aW50IHB1cmNoYXNlVmFsdWU7DQogICAgICAgIA0KICAgICAgICAoYm91Z2h0VG9rZW5zLCBwdXJjaGFzZVZhbHVlKSA9IGdldEJ1eVByaWNlKG1zZy52YWx1ZSk7DQogICAgICAgIGlmKGJvdWdodFRva2VucyA9PSAwKSB7IA0KICAgICAgICAgICAgLy8gYmlkIHRvIHNtYWxsLCByZXR1cm4gZXRoZXIgYW5kIGFib3J0DQogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7DQogICAgICAgICAgICByZXR1cm47IA0KICAgICAgICB9DQogICAgICAgIGF2ZXJhZ2VQcmljZSA9IHB1cmNoYXNlVmFsdWUuZGl2KGJvdWdodFRva2Vucyk7DQogICAgICAgIGlmKGF2ZXJhZ2VQcmljZSA+IF9tYXhQcmljZSkgeyANCiAgICAgICAgICAgIC8vIHByaWNlIHRvbyBoaWdoLCByZXR1cm4gZXRoZXIgYW5kIGFib3J0DQogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7DQogICAgICAgICAgICByZXR1cm47IA0KICAgICAgICB9DQogICAgICAgIGFzc2VydChhdmVyYWdlUHJpY2UgPj0gdG9rZW5QcmljZU1pbik7DQogICAgICAgIGFzc2VydChwdXJjaGFzZVZhbHVlIDw9IG1zZy52YWx1ZSk7DQogICAgICAgIA0KICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChib3VnaHRUb2tlbnMpOw0KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChib3VnaHRUb2tlbnMpOw0KICAgICAgICANCiAgICAgICAgaWYoIW1pbkZ1bmRpbmdSZWFjaGVkICYmIHRvdGFsU3VwcGx5ID49IHRva2VuQ3JlYXRpb25NaW4pIHsNCiAgICAgICAgICAgIG1pbkZ1bmRpbmdSZWFjaGVkID0gdHJ1ZTsNCiAgICAgICAgICAgIGZ1bmRpbmdVbmxvY2tUaW1lID0gYmxvY2sudGltZXN0YW1wOw0KICAgICAgICAgICAgLy8gdGhpcy5iYWxhbmNlIGNvbnRhaW5zIGV0aGVyIHNlbnQgaW4gdGhpcyBtZXNzYWdlDQogICAgICAgICAgICB1bmxvY2tlZEJhbGFuY2UgKz0gdGhpcy5iYWxhbmNlLnN1Yihtc2cudmFsdWUpLmRpdih0cmFkZVNwcmVhZEludmVydCk7DQogICAgICAgIH0NCiAgICAgICAgaWYobWluRnVuZGluZ1JlYWNoZWQpIHsNCiAgICAgICAgICAgIHVubG9ja2VkQmFsYW5jZSArPSBwdXJjaGFzZVZhbHVlLmRpdih0cmFkZVNwcmVhZEludmVydCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIExvZ0J1eShtc2cuc2VuZGVyLCBib3VnaHRUb2tlbnMsIHB1cmNoYXNlVmFsdWUsIHRvdGFsU3VwcGx5KTsNCiAgICAgICAgDQogICAgICAgIGlmKG1zZy52YWx1ZSA+IHB1cmNoYXNlVmFsdWUpIHsNCiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobXNnLnZhbHVlLnN1YihwdXJjaGFzZVZhbHVlKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQGRldiBTZWxsIHRva2VucyB3aXRob3V0IGxpbWl0IG9uIHByaWNlDQogICAgICogQHBhcmFtIF90b2tlbkNvdW50IEFtb3VudCBvZiB0b2tlbnMgdXNlciB3YW50cyB0byBzZWxsDQogICAgICovDQogICAgZnVuY3Rpb24gc2VsbCh1aW50IF90b2tlbkNvdW50KSBleHRlcm5hbCBmdW5kaW5nQWN0aXZlIHsNCiAgICAgICAgc2VsbExpbWl0KF90b2tlbkNvdW50LCAwKTsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQGRldiBTZWxsIHRva2VucyB3aXRoIGxpbWl0IG9uIG1pbmltdW0gYXZlcmFnZSBwcmljZXByaWNlDQogICAgICogQHBhcmFtIF90b2tlbkNvdW50IEFtb3VudCBvZiB0b2tlbnMgdXNlciB3YW50cyB0byBzZWxsDQogICAgICogQHBhcmFtIF9taW5QcmljZSBNaW5pbXVtIHByaWNlIHVzZXIgd2FudHMgdG8gcmVjZWl2ZSBmb3Igb25lIHRva2VuDQogICAgICovDQogICAgZnVuY3Rpb24gc2VsbExpbWl0KHVpbnQgX3Rva2VuQ291bnQsIHVpbnQgX21pblByaWNlKSBwdWJsaWMgZnVuZGluZ0FjdGl2ZSB7DQogICAgICAgIHJlcXVpcmUoX3Rva2VuQ291bnQgPiAwKTsNCg0KICAgICAgICBhc3NlcnQoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3Rva2VuQ291bnQpOw0KICAgICAgICANCiAgICAgICAgdWludCBzYWxlVmFsdWUgPSBnZXRTZWxsUHJpY2UoX3Rva2VuQ291bnQpOw0KICAgICAgICB1aW50IGF2ZXJhZ2VQcmljZSA9IHNhbGVWYWx1ZS5kaXYoX3Rva2VuQ291bnQpOw0KICAgICAgICBhc3NlcnQoYXZlcmFnZVByaWNlID49IHRva2VuUHJpY2VNaW4pOw0KICAgICAgICBpZihtaW5GdW5kaW5nUmVhY2hlZCkgew0KICAgICAgICAgICAgYXZlcmFnZVByaWNlIC09IGF2ZXJhZ2VQcmljZS5kaXYodHJhZGVTcHJlYWRJbnZlcnQpOw0KICAgICAgICAgICAgc2FsZVZhbHVlIC09IHNhbGVWYWx1ZS5kaXYodHJhZGVTcHJlYWRJbnZlcnQpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZihhdmVyYWdlUHJpY2UgPCBfbWluUHJpY2UpIHsNCiAgICAgICAgICAgIC8vIHByaWNlIHRvbyBoaWdoLCBhYm9ydA0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIC8vIG5vdCBlbm91Z2ggZXRoZXIgZm9yIGJ1eWJhY2sNCiAgICAgICAgYXNzZXJ0KHNhbGVWYWx1ZSA8PSB0aGlzLmJhbGFuY2UpOw0KICAgICAgICAgIA0KICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdG9rZW5Db3VudCk7DQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF90b2tlbkNvdW50KTsNCiAgICAgICAgDQogICAgICAgIExvZ1NlbGwobXNnLnNlbmRlciwgX3Rva2VuQ291bnQsIHNhbGVWYWx1ZSwgdG90YWxTdXBwbHkpOw0KICAgICAgICANCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihzYWxlVmFsdWUpOw0KICAgIH0gICANCiAgICANCiAgICAvKioNCiAgICAgKiBAZGV2IFVubG9jayBmdW5kcyBmb3Igd2l0aGRyYXdhbC4gT25seSAxJSBjYW4gYmUgdW5sb2NrZWQgd2Vla2x5Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHVubG9ja0Z1bmRzKCkgZXh0ZXJuYWwgb25seU93bmVyIGZ1bmRpbmdBY3RpdmUgew0KICAgICAgICBhc3NlcnQobWluRnVuZGluZ1JlYWNoZWQpOw0KICAgICAgICBhc3NlcnQoYmxvY2sudGltZXN0YW1wID49IGZ1bmRpbmdVbmxvY2tUaW1lKTsNCiAgICAgICAgDQogICAgICAgIHVpbnQgdW5sb2NrZWRBbW91bnQgPSBnZXRMb2NrZWRCYWxhbmNlKCkuZGl2KGZ1bmRpbmdVbmxvY2tGcmFjdGlvbkludmVydCk7DQogICAgICAgIHVubG9ja2VkQmFsYW5jZSArPSB1bmxvY2tlZEFtb3VudDsNCiAgICAgICAgYXNzZXJ0KGdldExvY2tlZEJhbGFuY2UoKSA+IDApOw0KICAgICAgICANCiAgICAgICAgZnVuZGluZ1VubG9ja1RpbWUgKz0gZnVuZGluZ1VubG9ja1BlcmlvZDsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQGRldiBXaXRoZHJhdyBmdW5kcy4gT25seSB1bmxvY2tlZCBmdW5kcyBjYW4gYmUgd2l0aGRyYXduLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnVuZHModWludCBfdmFsdWUpIGV4dGVybmFsIG9ubHlPd25lciBmdW5kaW5nQWN0aXZlIG9ubHlQYXlsb2FkU2l6ZSgzMikgew0KICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSB1bmxvY2tlZEJhbGFuY2UpOw0KICAgICAgICBhc3NlcnQobWluRnVuZGluZ1JlYWNoZWQpOw0KICAgICAgICAgICAgIA0KICAgICAgICB1bmxvY2tlZEJhbGFuY2UgLT0gX3ZhbHVlOw0KICAgICAgICB3aXRoZHJhd25CYWxhbmNlICs9IF92YWx1ZTsNCiAgICAgICAgTG9nV2l0aGRyYXcoX3ZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIHdpdGhkcmF3QWRkcmVzcy50cmFuc2ZlcihfdmFsdWUpOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBAZGV2IERlY2xhcmVzIHRoYXQgY3Jvd2RzYWxlIGlzIGFib3V0IHRvIGVuZC4gVXNlcnMgaGF2ZSBvbmUgd2VlayB0byBkZWNpZGUgaWYgdGhlIHdhbnQgdG8ga2VlcCB0b2tlbiBvciBzZWxsIHRoZW0gdG8gY29udHJhY3QuDQogICAgICovDQogICAgZnVuY3Rpb24gZGVjbGFyZUNyb3dkc2FsZUVuZCgpIGV4dGVybmFsIG9ubHlPd25lciBmdW5kaW5nQWN0aXZlIHsNCiAgICAgICAgYXNzZXJ0KG1pbkZ1bmRpbmdSZWFjaGVkKTsNCiAgICAgICAgYXNzZXJ0KGNyb3dkc2FsZUVuZERlY2xhcmF0aW9uVGltZSA9PSAwKTsNCiAgICAgICAgDQogICAgICAgIGNyb3dkc2FsZUVuZERlY2xhcmF0aW9uVGltZSA9IGJsb2NrLnRpbWVzdGFtcDsNCiAgICAgICAgTG9nQ3Jvd2RzYWxlRW5kKGZhbHNlKTsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQGRldiBDYW4gYmUgY2FsbGVkIG9uZSB3ZWVrIGFmdGVyIGluaXRpYWwgZGVjbGFyYXRpb24uIFdpdGhkcmF3cyBldGhlciBhbmQgc3RvcHMgdHJhZGluZy4gVG9rZW5zIHJlbWFpbiBpbiBjaXJjdWxhdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb25maXJtQ3Jvd2RzYWxlRW5kKCkgZXh0ZXJuYWwgb25seU93bmVyIHsNCiAgICAgICAgYXNzZXJ0KGNyb3dkc2FsZUVuZERlY2xhcmF0aW9uVGltZSA+IDAgJiYgYmxvY2sudGltZXN0YW1wID4gY3Jvd2RzYWxlRW5kRGVjbGFyYXRpb25UaW1lICsgY3Jvd2RzYWxlRW5kTG9ja1RpbWUpOw0KICAgICAgICANCiAgICAgICAgTG9nQ3Jvd2RzYWxlRW5kKHRydWUpOw0KICAgICAgICB3aXRoZHJhd0FkZHJlc3MudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQGRldiBIYWx0cyBjcm93ZHNhbGUuIENhbiBvbmx5IGJlIGNhbGxlZCBiZWZvcmUgbWluaW11bUZ1bmRpbmcgaXMgcmVhY2hlZC4gDQogICAgICogQGRldiBXaGVuIGNvbnRyYWN0IGlzIGhhbHRlZCBubyBvbmUgY2FuIGJ1eSBuZXcgdG9rZW5zLCBidXQgY2FuIHNlbGwgdGhlbSBiYWNrIHRvIGNvbnRyYWN0Lg0KICAgICAqIEBkZXYgRnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgaWYgbWluaW11bSBmdW5kaW5nIHRhcmdldCBpc24ndCByZWFjaGVkIGZvciBleHRlbmRlZCBwZXJpb2Qgb2YgdGltZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGhhbHRDcm93ZHNhbGUoKSBleHRlcm5hbCBvbmx5T3duZXIgZnVuZGluZ0FjdGl2ZSB7DQogICAgICAgIGFzc2VydCghbWluRnVuZGluZ1JlYWNoZWQpOw0KICAgICAgICBpc0hhbHRlZCA9ICFpc0hhbHRlZDsNCiAgICB9DQp9'