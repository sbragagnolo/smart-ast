base 64 content
base64aragonTokenSale
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQpjb250cmFjdCBFUkMyMCB7DQogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOw0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOw0KICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7DQp9DQoNCg0KY29udHJhY3QgU2FmZU1hdGggew0KICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICBhc3NlcnQoYiA+IDApOw0KICAgIHVpbnQgYyA9IGEgLyBiOw0KICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiIDw9IGEpOw0KICAgIHJldHVybiBhIC0gYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7DQogICAgaWYgKCFhc3NlcnRpb24pIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KfQ0KY29udHJhY3QgQXBwcm92ZUFuZENhbGxSZWNlaXZlciB7DQogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9kYXRhKTsNCn0NCg0KY29udHJhY3QgQ29udHJvbGxlZCB7DQogICAgLy8vIEBub3RpY2UgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyb2xsZXIgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsDQogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcg0KICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgdGhyb3c7IF87IH0NCg0KICAgIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7DQoNCiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgeyBjb250cm9sbGVyID0gbXNnLnNlbmRlcjt9DQoNCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgVGhlIG5ldyBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdA0KICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgb25seUNvbnRyb2xsZXIgew0KICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7DQogICAgfQ0KfQ0KY29udHJhY3QgQWJzdHJhY3RTYWxlIHsNCiAgZnVuY3Rpb24gc2FsZUZpbmFsaXplZCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOw0KfQ0KDQpjb250cmFjdCBTYWxlV2FsbGV0IHsNCiAgLy8gUHVibGljIHZhcmlhYmxlcw0KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZzsNCiAgdWludCBwdWJsaWMgZmluYWxCbG9jazsNCiAgQWJzdHJhY3RTYWxlIHB1YmxpYyB0b2tlblNhbGU7DQoNCiAgLy8gQGRldiBDb25zdHJ1Y3RvciBpbml0aWFsaXplcyBwdWJsaWMgdmFyaWFibGVzDQogIC8vIEBwYXJhbSBfbXVsdGlzaWcgVGhlIGFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBmdW5kcw0KICAvLyBAcGFyYW0gX2ZpbmFsQmxvY2sgQmxvY2sgYWZ0ZXIgd2hpY2ggdGhlIG11bHRpc2lnIGNhbiByZXF1ZXN0IHRoZSBmdW5kcw0KICBmdW5jdGlvbiBTYWxlV2FsbGV0KGFkZHJlc3MgX211bHRpc2lnLCB1aW50IF9maW5hbEJsb2NrLCBhZGRyZXNzIF90b2tlblNhbGUpIHsNCiAgICBtdWx0aXNpZyA9IF9tdWx0aXNpZzsNCiAgICBmaW5hbEJsb2NrID0gX2ZpbmFsQmxvY2s7DQogICAgdG9rZW5TYWxlID0gQWJzdHJhY3RTYWxlKF90b2tlblNhbGUpOw0KICB9DQoNCiAgLy8gQGRldiBSZWNlaXZlIGFsbCBzZW50IGZ1bmRzIHdpdGhvdXQgYW55IGZ1cnRoZXIgbG9naWMNCiAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUge30NCg0KICAvLyBAZGV2IFdpdGhkcmF3IGZ1bmN0aW9uIHNlbmRzIGFsbCB0aGUgZnVuZHMgdG8gdGhlIHdhbGxldCBpZiBjb25kaXRpb25zIGFyZSBjb3JyZWN0DQogIGZ1bmN0aW9uIHdpdGhkcmF3KCkgcHVibGljIHsNCiAgICBpZiAobXNnLnNlbmRlciAhPSBtdWx0aXNpZykgdGhyb3c7ICAgICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IHRoZSBtdWx0aXNpZyBjYW4gcmVxdWVzdCBpdA0KICAgIGlmIChibG9jay5udW1iZXIgPiBmaW5hbEJsb2NrKSByZXR1cm4gZG9XaXRoZHJhdygpOyAgICAgIC8vIEFsbG93IGFmdGVyIHRoZSBmaW5hbCBibG9jaw0KICAgIGlmICh0b2tlblNhbGUuc2FsZUZpbmFsaXplZCgpKSByZXR1cm4gZG9XaXRoZHJhdygpOyAgICAgIC8vIEFsbG93IHdoZW4gc2FsZSBpcyBmaW5hbGl6ZWQNCiAgfQ0KDQogIGZ1bmN0aW9uIGRvV2l0aGRyYXcoKSBpbnRlcm5hbCB7DQogICAgaWYgKCFtdWx0aXNpZy5zZW5kKHRoaXMuYmFsYW5jZSkpIHRocm93Ow0KICB9DQp9DQoNCmNvbnRyYWN0IENvbnRyb2xsZXIgew0KICAgIC8vLyBAbm90aWNlIENhbGxlZCB3aGVuIGBfb3duZXJgIHNlbmRzIGV0aGVyIHRvIHRoZSBNaW5pTWUgVG9rZW4gY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMNCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzDQogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHJldHVybnMoYm9vbCk7DQoNCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQ0KICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkDQogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2Zlcg0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXINCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXINCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyDQogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOw0KDQogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlDQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsDQogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbA0KICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KQ0KICAgICAgICByZXR1cm5zKGJvb2wpOw0KfQ0KDQpjb250cmFjdCBBTlBsYWNlaG9sZGVyIGlzIENvbnRyb2xsZXIgew0KICBhZGRyZXNzIHB1YmxpYyBzYWxlOw0KICBBTlQgcHVibGljIHRva2VuOw0KDQogIGZ1bmN0aW9uIEFOUGxhY2Vob2xkZXIoYWRkcmVzcyBfc2FsZSwgYWRkcmVzcyBfYW50KSB7DQogICAgc2FsZSA9IF9zYWxlOw0KICAgIHRva2VuID0gQU5UKF9hbnQpOw0KICB9DQoNCiAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIG5ldHdvcmspIHB1YmxpYyB7DQogICAgaWYgKG1zZy5zZW5kZXIgIT0gc2FsZSkgdGhyb3c7DQogICAgdG9rZW4uY2hhbmdlQ29udHJvbGxlcihuZXR3b3JrKTsNCiAgICBzdWljaWRlKG5ldHdvcmspOw0KICB9DQoNCiAgLy8gSW4gYmV0d2VlbiB0aGUgc2FsZSBhbmQgdGhlIG5ldHdvcmsuIERlZmF1bHQgc2V0dGluZ3MgZm9yIGFsbG93aW5nIHRva2VuIHRyYW5zZmVycy4NCiAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgdGhyb3c7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQoNCiAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCn0NCg0KDQoNCg0KY29udHJhY3QgTWluaU1lVG9rZW4gaXMgRVJDMjAsIENvbnRyb2xsZWQgew0KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgLy9UaGUgVG9rZW4ncyBuYW1lOiBlLmcuIERpZ2l4REFPIFRva2Vucw0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgICAgICAgICAgICAgLy9OdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQNCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZS5nLiBSRVANCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnTU1UXzAuMSc7IC8vQW4gYXJiaXRyYXJ5IHZlcnNpb25pbmcgc2NoZW1lDQoNCg0KICAgIC8vLyBAZGV2IGBDaGVja3BvaW50YCBpcyB0aGUgc3RydWN0dXJlIHRoYXQgYXR0YWNoZXMgYSBibG9jayBudW1iZXIgdG8gYQ0KICAgIC8vLyAgZ2l2ZW4gdmFsdWUsIHRoZSBibG9jayBudW1iZXIgYXR0YWNoZWQgaXMgdGhlIG9uZSB0aGF0IGxhc3QgY2hhbmdlZCB0aGUNCiAgICAvLy8gIHZhbHVlDQogICAgc3RydWN0ICBDaGVja3BvaW50IHsNCg0KICAgICAgICAvLyBgZnJvbUJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIHZhbHVlIHdhcyBnZW5lcmF0ZWQgZnJvbQ0KICAgICAgICB1aW50MTI4IGZyb21CbG9jazsNCg0KICAgICAgICAvLyBgdmFsdWVgIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYmxvY2sgbnVtYmVyDQogICAgICAgIHVpbnQxMjggdmFsdWU7DQogICAgfQ0KDQogICAgLy8gYHBhcmVudFRva2VuYCBpcyB0aGUgVG9rZW4gYWRkcmVzcyB0aGF0IHdhcyBjbG9uZWQgdG8gcHJvZHVjZSB0aGlzIHRva2VuOw0KICAgIC8vICBpdCB3aWxsIGJlIDB4MCBmb3IgYSB0b2tlbiB0aGF0IHdhcyBub3QgY2xvbmVkDQogICAgTWluaU1lVG9rZW4gcHVibGljIHBhcmVudFRva2VuOw0KDQogICAgLy8gYHBhcmVudFNuYXBTaG90QmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgZnJvbSB0aGUgUGFyZW50IFRva2VuIHRoYXQgd2FzDQogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgQ2xvbmUgVG9rZW4NCiAgICB1aW50IHB1YmxpYyBwYXJlbnRTbmFwU2hvdEJsb2NrOw0KDQogICAgLy8gYGNyZWF0aW9uQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgQ2xvbmUgVG9rZW4gd2FzIGNyZWF0ZWQNCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkJsb2NrOw0KDQogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcw0KICAgIC8vICBjb250cmFjdCB3aGVuIHRoZSBiYWxhbmNlIGNoYW5nZXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBjaGFuZ2UNCiAgICAvLyAgb2NjdXJyZWQgaXMgYWxzbyBpbmNsdWRlZCBpbiB0aGUgbWFwDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDaGVja3BvaW50W10pIGJhbGFuY2VzOw0KDQogICAgLy8gYGFsbG93ZWRgIHRyYWNrcyBhbnkgZXh0cmEgdHJhbnNmZXIgcmlnaHRzIGFzIGluIGFsbCBFUkMyMCB0b2tlbnMNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7DQoNCiAgICAvLyBUcmFja3MgdGhlIGhpc3Rvcnkgb2YgdGhlIGB0b3RhbFN1cHBseWAgb2YgdGhlIHRva2VuDQogICAgQ2hlY2twb2ludFtdIHRvdGFsU3VwcGx5SGlzdG9yeTsNCg0KICAgIC8vIEZsYWcgdGhhdCBkZXRlcm1pbmVzIGlmIHRoZSB0b2tlbiBpcyB0cmFuc2ZlcmFibGUgb3Igbm90Lg0KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQ7DQoNCiAgICAvLyBUaGUgZmFjdG9yeSB1c2VkIHRvIGNyZWF0ZSBuZXcgY2xvbmUgdG9rZW5zDQogICAgTWluaU1lVG9rZW5GYWN0b3J5IHB1YmxpYyB0b2tlbkZhY3Rvcnk7DQoNCi8vLy8vLy8vLy8vLy8vLy8NCi8vIENvbnN0cnVjdG9yDQovLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbg0KICAgIC8vLyBAcGFyYW0gX3Rva2VuRmFjdG9yeSBUaGUgYWRkcmVzcyBvZiB0aGUgTWluaU1lVG9rZW5GYWN0b3J5IGNvbnRyYWN0IHRoYXQNCiAgICAvLy8gIHdpbGwgY3JlYXRlIHRoZSBDbG9uZSB0b2tlbiBjb250cmFjdHMsIHRoZSB0b2tlbiBmYWN0b3J5IG5lZWRzIHRvIGJlDQogICAgLy8vICBkZXBsb3llZCBmaXJzdA0KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHBhcmVudCB0b2tlbiwgc2V0IHRvIDB4MCBpZiBpdCBpcyBhDQogICAgLy8vICBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRTbmFwU2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsDQogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbiwgc2V0IHRvIDAgaWYgaXQNCiAgICAvLy8gIGlzIGEgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZA0KICAgIGZ1bmN0aW9uIE1pbmlNZVRva2VuKA0KICAgICAgICBhZGRyZXNzIF90b2tlbkZhY3RvcnksDQogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLA0KICAgICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLA0KICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwNCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywNCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwNCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZA0KICAgICkgew0KICAgICAgICB0b2tlbkZhY3RvcnkgPSBNaW5pTWVUb2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7DQogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZQ0KICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGRlY2ltYWxzDQogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sDQogICAgICAgIHBhcmVudFRva2VuID0gTWluaU1lVG9rZW4oX3BhcmVudFRva2VuKTsNCiAgICAgICAgcGFyZW50U25hcFNob3RCbG9jayA9IF9wYXJlbnRTbmFwU2hvdEJsb2NrOw0KICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7DQogICAgICAgIGNyZWF0aW9uQmxvY2sgPSBibG9jay5udW1iZXI7DQogICAgfQ0KDQoNCi8vLy8vLy8vLy8vLy8vLy8vLy8NCi8vIEVSQzIwIE1ldGhvZHMNCi8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsNCiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQNCiAgICAvLy8gIGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWANCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50DQogICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCg0KICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwNCiAgICAgICAgLy8gIHRoaXMgaXMgaW1wb3J0YW50IHRvIHJlY29nbml6ZSEgQ29uZmlybSB0aGF0IHlvdSB0cnVzdCB0aGUNCiAgICAgICAgLy8gIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCwgd2hpY2ggaW4gbW9zdCBzaXR1YXRpb25zIHNob3VsZCBiZQ0KICAgICAgICAvLyAgYW5vdGhlciBvcGVuIHNvdXJjZSBzbWFydCBjb250cmFjdCBvciAweDANCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgew0KICAgICAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsNCg0KICAgICAgICAgICAgLy8gVGhlIHN0YW5kYXJkIEVSQyAyMCB0cmFuc2ZlckZyb20gZnVuY3Rpb25hbGl0eQ0KICAgICAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX2Ftb3VudCkgdGhyb3c7DQogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfYW1vdW50Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbg0KICAgIC8vLyAgb25seSBiZSBjYWxsZWQgYnkgb3RoZXIgZnVuY3Rpb25zIGluIHRoaXMgY29udHJhY3QuDQogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwNCiAgICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQNCiAgICApIGludGVybmFsIHJldHVybnMoYm9vbCkgew0KDQogICAgICAgICAgIGlmIChfYW1vdW50ID09IDApIHsNCiAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICB9DQoNCiAgICAgICAgICAgLy8gRG8gbm90IGFsbG93IHRyYW5zZmVyIHRvIDB4MCBvciB0aGUgdG9rZW4gY29udHJhY3QgaXRzZWxmDQogICAgICAgICAgIGlmICgoX3RvID09IDApIHx8IChfdG8gPT0gYWRkcmVzcyh0aGlzKSkpIHRocm93Ow0KDQogICAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgYmVpbmcgdHJhbnNmZXJlZCBpcyBtb3JlIHRoYW4gdGhlIGJhbGFuY2Ugb2YgdGhlDQogICAgICAgICAgIC8vICBhY2NvdW50IHRoZSB0cmFuc2ZlciByZXR1cm5zIGZhbHNlDQogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mQXQoX2Zyb20sIGJsb2NrLm51bWJlcik7DQogICAgICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VGcm9tIDwgX2Ftb3VudCkgew0KICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgIH0NCg0KICAgICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIHRyYW5zZmVyDQogICAgICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7DQogICAgICAgICAgICAgICBpZiAoIUNvbnRyb2xsZXIoY29udHJvbGxlcikub25UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KSkgdGhyb3c7DQogICAgICAgICAgIH0NCg0KICAgICAgICAgICAvLyBGaXJzdCB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcw0KICAgICAgICAgICAvLyAgc2VuZGluZyB0aGUgdG9rZW5zDQogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2Zyb21dLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7DQoNCiAgICAgICAgICAgLy8gVGhlbiB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcw0KICAgICAgICAgICAvLyAgcmVjZWl2aW5nIHRoZSB0b2tlbnMNCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mQXQoX3RvLCBibG9jay5udW1iZXIpOw0KICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50IDwgcHJldmlvdXNCYWxhbmNlVG8pIHRocm93OyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cNCiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfdG9dLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOw0KDQogICAgICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbg0KICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsNCg0KICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQNCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCB0aGUgY3VycmVudCBibG9jaw0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7DQogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdChfb3duZXIsIGJsb2NrLm51bWJlcik7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbg0KICAgIC8vLyAgaXRzIGJlaGFsZi4gVGhpcyBpcyBhIG1vZGlmaWVkIHZlcnNpb24gb2YgdGhlIEVSQzIwIGFwcHJvdmUgZnVuY3Rpb24NCiAgICAvLy8gIHRvIGJlIGEgbGl0dGxlIGJpdCBzYWZlcg0KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2Zlcg0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsDQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoIXRyYW5zZmVyc0VuYWJsZWQpIHRocm93Ow0KDQogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXMmIzE4MDsNCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdA0KICAgICAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToNCiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5DQogICAgICAgIGlmICgoX2Ftb3VudCE9MCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9MCkpIHRocm93Ow0KDQogICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgYXBwcm92ZSBmdW5jdGlvbiBjYWxsDQogICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7DQogICAgICAgICAgICBpZiAoIUNvbnRyb2xsZXIoY29udHJvbGxlcikub25BcHByb3ZlKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KSkNCiAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KDQogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsNCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gcmVhZCB0aGUgYGFsbG93ZWRbXWAgbWFwDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zDQogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgb2YgX293bmVyIHRoYXQgX3NwZW5kZXIgaXMgYWxsb3dlZA0KICAgIC8vLyAgdG8gc3BlbmQNCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXINCiAgICApIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7DQogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNlbmQgYF9hbW91bnRgIHRva2VucyBvbg0KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMNCiAgICAvLy8gIGJlaW5nIGFwcHJvdmVkLCBgX3NwZW5kZXJgLiBUaGlzIGFsbG93cyB1c2VycyB0byB1c2UgdGhlaXIgdG9rZW5zIHRvDQogICAgLy8vICBpbnRlcmFjdCB3aXRoIGNvbnRyYWN0cyBpbiBvbmUgZnVuY3Rpb24gY2FsbCBpbnN0ZWFkIG9mIHR3bw0KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXINCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBmdW5jdGlvbiBjYWxsIHdhcyBzdWNjZXNzZnVsDQogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50LCBieXRlcyBfZXh0cmFEYXRhDQogICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgYXBwcm92ZShfc3BlbmRlciwgX2Ftb3VudCk7DQoNCiAgICAgICAgLy8gVGhpcyBwb3J0aW9uIGlzIGNvcGllZCBmcm9tIENvbnNlblN5cydzIFN0YW5kYXJkIFRva2VuIENvbnRyYWN0LiBJdA0KICAgICAgICAvLyAgY2FsbHMgdGhlIHJlY2VpdmVBcHByb3ZhbCBmdW5jdGlvbiB0aGF0IGlzIHBhcnQgb2YgdGhlIGNvbnRyYWN0IHRoYXQNCiAgICAgICAgLy8gIGlzIGJlaW5nIGFwcHJvdmVkIChgX3NwZW5kZXJgKS4gVGhlIGZ1bmN0aW9uIHNob3VsZCBsb29rIGxpa2U6DQogICAgICAgIC8vICBgcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCwgYWRkcmVzcw0KICAgICAgICAvLyAgX3Rva2VuQ29udHJhY3QsIGJ5dGVzIF9leHRyYURhdGEpYCBJdCBpcyBhc3N1bWVkIHRoYXQgdGhlIGNhbGwNCiAgICAgICAgLy8gICpzaG91bGQqIHN1Y2NlZWQsIG90aGVyd2lzZSB0aGUgcGxhaW4gdmFuaWxsYSBhcHByb3ZlIHdvdWxkIGJlIHVzZWQNCiAgICAgICAgQXBwcm92ZUFuZENhbGxSZWNlaXZlcihfc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKA0KICAgICAgICAgICBtc2cuc2VuZGVyLA0KICAgICAgICAgICBfYW1vdW50LA0KICAgICAgICAgICB0aGlzLA0KICAgICAgICAgICBfZXh0cmFEYXRhDQogICAgICAgICk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byBnZXQgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMNCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2Vucw0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOw0KICAgIH0NCg0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBRdWVyeSBiYWxhbmNlIGFuZCB0b3RhbFN1cHBseSBpbiBIaXN0b3J5DQovLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQGRldiBRdWVyaWVzIHRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmANCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkDQogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSBiYWxhbmNlIGlzIHF1ZXJpZWQNCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBhdCBgX2Jsb2NrTnVtYmVyYA0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAodWludCkgew0KDQogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIGJhbGFuY2Ugb2YgdGhlIHRva2VuIGlzDQogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQNCiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdGAgYmUgcXVlcmllZCBhdCB0aGUNCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoYXQgdG9rZW4gYXMgdGhpcyBjb250YWlucyBpbml0aWFsIGJhbGFuY2Ugb2YNCiAgICAgICAgLy8gIHRoaXMgdG9rZW4NCiAgICAgICAgaWYgKChiYWxhbmNlc1tfb3duZXJdLmxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgfHwgKGJhbGFuY2VzW19vd25lcl1bMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgew0KICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4uYmFsYW5jZU9mQXQoX293bmVyLCBtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIEhhcyBubyBwYXJlbnQNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCBiYWxhbmNlIGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQoYmFsYW5jZXNbX293bmVyXSwgX2Jsb2NrTnVtYmVyKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYC4NCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIHRvdGFsU3VwcGx5IGlzIHF1ZXJpZWQNCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgX2Jsb2NrTnVtYmVyYA0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5QXQodWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50IHJldHVybnModWludCkgew0KDQogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIHRvdGFsU3VwcGx5IG9mIHRoZSB0b2tlbiBpcw0KICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0DQogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdGAgYmUgcXVlcmllZCBhdCB0aGUNCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoaXMgdG9rZW4gYXMgdGhhdCBjb250YWlucyB0b3RhbFN1cHBseSBvZiB0aGlzDQogICAgICAgIC8vICB0b2tlbiBhdCB0aGlzIGJsb2NrIG51bWJlci4NCiAgICAgICAgaWYgKCh0b3RhbFN1cHBseUhpc3RvcnkubGVuZ3RoID09IDApDQogICAgICAgICAgICB8fCAodG90YWxTdXBwbHlIaXN0b3J5WzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsNCiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXQobWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCB0b3RhbFN1cHBseSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgX2Jsb2NrTnVtYmVyKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogICAgfQ0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBDbG9uZSBUb2tlbiBNZXRob2QNCi8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgYSBuZXcgY2xvbmUgdG9rZW4gd2l0aCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gYmVpbmcNCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYA0KICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5OYW1lIE5hbWUgb2YgdGhlIGNsb25lIHRva2VuDQogICAgLy8vIEBwYXJhbSBfY2xvbmVEZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0DQogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuDQogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayB3aGVuIHRoZSBkaXN0cmlidXRpb24gb2YgdGhlIHBhcmVudCB0b2tlbiBpcw0KICAgIC8vLyAgY29waWVkIHRvIHNldCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIG5ldyBjbG9uZSB0b2tlbjsNCiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyBoaWdoZXIgdGhhbiB0aGUgYWN0dWFsIGJsb2NrLCB0aGUgY3VycmVudCBibG9jayBpcyB1c2VkDQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUNCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IE1pbmlNZVRva2VuIENvbnRyYWN0DQogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigNCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuTmFtZSwNCiAgICAgICAgdWludDggX2Nsb25lRGVjaW1hbFVuaXRzLA0KICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsDQogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssDQogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQNCiAgICAgICAgKSByZXR1cm5zKGFkZHJlc3MpIHsNCiAgICAgICAgaWYgKF9zbmFwc2hvdEJsb2NrID4gYmxvY2subnVtYmVyKSBfc25hcHNob3RCbG9jayA9IGJsb2NrLm51bWJlcjsNCiAgICAgICAgTWluaU1lVG9rZW4gY2xvbmVUb2tlbiA9IHRva2VuRmFjdG9yeS5jcmVhdGVDbG9uZVRva2VuKA0KICAgICAgICAgICAgdGhpcywNCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLA0KICAgICAgICAgICAgX2Nsb25lVG9rZW5OYW1lLA0KICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLA0KICAgICAgICAgICAgX2Nsb25lVG9rZW5TeW1ib2wsDQogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZA0KICAgICAgICAgICAgKTsNCg0KICAgICAgICBjbG9uZVRva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7DQoNCiAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdG9rZW4gZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluDQogICAgICAgIE5ld0Nsb25lVG9rZW4oYWRkcmVzcyhjbG9uZVRva2VuKSwgX3NuYXBzaG90QmxvY2spOw0KICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsNCiAgICB9DQoNCi8vLy8vLy8vLy8vLy8vLy8NCi8vIEdlbmVyYXRlIGFuZCBkZXN0cm95IHRva2Vucw0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgR2VuZXJhdGVzIGBfYW1vdW50YCB0b2tlbnMgdGhhdCBhcmUgYXNzaWduZWQgdG8gYF9vd25lcmANCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgYXNzaWduZWQgdGhlIG5ldyB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQNCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGdlbmVyYXRlZCBjb3JyZWN0bHkNCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50DQogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7DQogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgYmxvY2subnVtYmVyKTsNCiAgICAgICAgaWYgKGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCA8IGN1clRvdGFsU3VwcGx5KSB0aHJvdzsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93DQogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIF9hbW91bnQpOw0KICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2YoX293bmVyKTsNCiAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA8IHByZXZpb3VzQmFsYW5jZVRvKSB0aHJvdzsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93DQogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsNCiAgICAgICAgVHJhbnNmZXIoMCwgX293bmVyLCBfYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQoNCiAgICAvLy8gQG5vdGljZSBCdXJucyBgX2Ftb3VudGAgdG9rZW5zIGZyb20gYF9vd25lcmANCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbG9zZSB0aGUgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gYnVybg0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgYnVybmVkIGNvcnJlY3RseQ0KICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudA0KICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGJsb2NrLm51bWJlcik7DQogICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSA8IF9hbW91bnQpIHRocm93Ow0KICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgLSBfYW1vdW50KTsNCiAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsNCiAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB0aHJvdzsNCiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7DQogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMNCi8vLy8vLy8vLy8vLy8vLy8NCg0KDQogICAgLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQ0KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lDQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIG9ubHlDb250cm9sbGVyIHsNCiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOw0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gSW50ZXJuYWwgaGVscGVyIGZ1bmN0aW9ucyB0byBxdWVyeSBhbmQgc2V0IGEgdmFsdWUgaW4gYSBzbmFwc2hvdCBhcnJheQ0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBkZXYgYGdldFZhbHVlQXRgIHJldHJpZXZlcyB0aGUgbnVtYmVyIG9mIHRva2VucyBhdCBhIGdpdmVuIGJsb2NrIG51bWJlcg0KICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQNCiAgICAvLy8gQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgbnVtYmVyIHRvIHJldHJpZXZlIHRoZSB2YWx1ZSBhdA0KICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdG9rZW5zIGJlaW5nIHF1ZXJpZWQNCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jaw0KICAgICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICBpZiAoY2hlY2twb2ludHMubGVuZ3RoID09IDApIHJldHVybiAwOw0KDQogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlDQogICAgICAgIGlmIChfYmxvY2sgPj0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLmZyb21CbG9jaykNCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7DQogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOw0KDQogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQ0KICAgICAgICB1aW50IG1pbiA9IDA7DQogICAgICAgIHVpbnQgbWF4ID0gY2hlY2twb2ludHMubGVuZ3RoLTE7DQogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsNCiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOw0KICAgICAgICAgICAgaWYgKGNoZWNrcG9pbnRzW21pZF0uZnJvbUJsb2NrPD1fYmxvY2spIHsNCiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG1heCA9IG1pZC0xOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjaGVja3BvaW50c1ttaW5dLnZhbHVlOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IGB1cGRhdGVWYWx1ZUF0Tm93YCB1c2VkIHRvIHVwZGF0ZSB0aGUgYGJhbGFuY2VzYCBtYXAgYW5kIHRoZQ0KICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWANCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIGRhdGEgYmVpbmcgdXBkYXRlZA0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBuZXcgbnVtYmVyIG9mIHRva2Vucw0KICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlDQogICAgKSBpbnRlcm5hbCAgew0KICAgICAgICBpZiAoKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKQ0KICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7DQogICAgICAgICAgICAgICBDaGVja3BvaW50IG5ld0NoZWNrUG9pbnQgPSBjaGVja3BvaW50c1sgY2hlY2twb2ludHMubGVuZ3RoKysgXTsNCiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsNCiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7DQogICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICBDaGVja3BvaW50IG9sZENoZWNrUG9pbnQgPSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV07DQogICAgICAgICAgICAgICBvbGRDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOw0KICAgICAgICAgICB9DQogICAgfQ0KDQogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZA0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsNCiAgICAgICAgdWludCBzaXplOw0KICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzaXplPjA7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uOiBJZiB0aGUgY29udHJhY3QncyBjb250cm9sbGVyIGhhcyBub3QgYmVlbg0KICAgIC8vLyAgc2V0IHRvIDAsIHRoZW4gdGhlIGBwcm94eVBheW1lbnRgIG1ldGhvZCBpcyBjYWxsZWQgd2hpY2ggcmVsYXlzIHRoZQ0KICAgIC8vLyAgZXRoZXIgYW5kIGNyZWF0ZXMgdG9rZW5zIGFzIGRlc2NyaWJlZCBpbiB0aGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdA0KICAgIGZ1bmN0aW9uICgpICBwYXlhYmxlIHsNCiAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsNCiAgICAgICAgICAgIGlmICghIENvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpDQogICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgIH0NCg0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBFdmVudHMNCi8vLy8vLy8vLy8vLy8vLy8NCiAgICBldmVudCBOZXdDbG9uZVRva2VuKGFkZHJlc3MgaW5kZXhlZCBfY2xvbmVUb2tlbiwgdWludCBfc25hcHNob3RCbG9jayk7DQp9DQoNCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gTWluaU1lVG9rZW5GYWN0b3J5DQovLy8vLy8vLy8vLy8vLy8vDQoNCi8vLyBAZGV2IFRoaXMgY29udHJhY3QgaXMgdXNlZCB0byBnZW5lcmF0ZSBjbG9uZSBjb250cmFjdHMgZnJvbSBhIGNvbnRyYWN0Lg0KLy8vICBJbiBzb2xpZGl0eSB0aGlzIGlzIHRoZSB3YXkgdG8gY3JlYXRlIGEgY29udHJhY3QgZnJvbSBhIGNvbnRyYWN0IG9mIHRoZQ0KLy8vICBzYW1lIGNsYXNzDQpjb250cmFjdCBNaW5pTWVUb2tlbkZhY3Rvcnkgew0KDQogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcw0KICAgIC8vLyAgdGhlIG1zZy5zZW5kZXIgYmVjb21lcyB0aGUgY29udHJvbGxlciBvZiB0aGlzIGNsb25lIHRva2VuDQogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgdG9rZW4gYmVpbmcgY2xvbmVkDQogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbA0KICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBJZiB0cnVlLCB0b2tlbnMgd2lsbCBiZSBhYmxlIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdA0KICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oDQogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLA0KICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLA0KICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwNCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywNCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwNCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZA0KICAgICkgcmV0dXJucyAoTWluaU1lVG9rZW4pIHsNCiAgICAgICAgTWluaU1lVG9rZW4gbmV3VG9rZW4gPSBuZXcgTWluaU1lVG9rZW4oDQogICAgICAgICAgICB0aGlzLA0KICAgICAgICAgICAgX3BhcmVudFRva2VuLA0KICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssDQogICAgICAgICAgICBfdG9rZW5OYW1lLA0KICAgICAgICAgICAgX2RlY2ltYWxVbml0cywNCiAgICAgICAgICAgIF90b2tlblN5bWJvbCwNCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkDQogICAgICAgICAgICApOw0KDQogICAgICAgIG5ld1Rva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7DQogICAgICAgIHJldHVybiBuZXdUb2tlbjsNCiAgICB9DQp9DQoNCg0KLyoNCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZ2UgSXpxdWllcmRvIChBcmFnb24gRm91bmRhdGlvbikNCg0KICAgIEJhc2VkIG9uIFZlc3RlZFRva2VuLnNvbCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkNCg0KICAgIFNhZmVNYXRoIOKAkyBDb3B5cmlnaHQgKGMpIDIwMTYgU21hcnQgQ29udHJhY3QgU29sdXRpb25zLCBJbmMuDQogICAgTWluaU1lVG9rZW4g4oCTIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hIChHaXZldGgpDQogKi8NCg0KLy8gQGRldiBNaW5pTWVJcnJldm9jYWJsZVZlc3RlZFRva2VuIGlzIGEgZGVyaXZlZCB2ZXJzaW9uIG9mIE1pbmlNZVRva2VuIGFkZGluZyB0aGUNCi8vIGFiaWxpdHkgdG8gY3JlYXRlVG9rZW5HcmFudHMgd2hpY2ggYXJlIGJhc2ljYWxseSBhIHRyYW5zZmVyIHRoYXQgbGltaXRzIHRoZQ0KLy8gcmVjZWl2ZXIgb2YgdGhlIHRva2VucyBob3cgY2FuIGhlIHNwZW5kIHRoZW0gb3ZlciB0aW1lLg0KDQovLyBGb3Igc2ltcGxpY2l0eSwgdG9rZW4gZ3JhbnRzIGFyZSBub3Qgc2F2ZWQgaW4gTWluaU1lIHR5cGUgY2hlY2twb2ludHMuDQovLyBWYW5pbGxhIGNsb25pbmcgQU5UIHdpbGwgY2xvbmUgaXQgaW50byBhIE1pbmlNZVRva2VuIHdpdGhvdXQgdmVzdGluZy4NCi8vIE1vcmUgY29tcGxleCBjbG9uaW5nIGNvdWxkIGFjY291bnQgZm9yIHBhc3QgdmVzdGluZyBjYWxlbmRhcnMuDQoNCmNvbnRyYWN0IE1pbmlNZUlycmV2b2NhYmxlVmVzdGVkVG9rZW4gaXMgTWluaU1lVG9rZW4sIFNhZmVNYXRoIHsNCiAgLy8gS2VlcCB0aGUgc3RydWN0IGF0IDIgc3N0b3JlcyAoMSBzbG90IGZvciB2YWx1ZSArIDY0ICogMyAoZGF0ZXMpICsgMjAgKGFkZHJlc3MpID0gMiBzbG90cyAoMm5kIHNsb3QgaXMgMjEyIGJ5dGVzLCBsb3dlciB0aGFuIDI1NikpDQogIHN0cnVjdCBUb2tlbkdyYW50IHsNCiAgICBhZGRyZXNzIGdyYW50ZXI7DQogICAgdWludDI1NiB2YWx1ZTsNCiAgICB1aW50NjQgY2xpZmY7DQogICAgdWludDY0IHZlc3Rpbmc7DQogICAgdWludDY0IHN0YXJ0Ow0KICB9DQoNCiAgZXZlbnQgTmV3VG9rZW5HcmFudChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlLCB1aW50NjQgc3RhcnQsIHVpbnQ2NCBjbGlmZiwgdWludDY0IHZlc3RpbmcpOw0KDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gVG9rZW5HcmFudFtdKSBwdWJsaWMgZ3JhbnRzOw0KDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgY2FuQ3JlYXRlR3JhbnRzOw0KICBhZGRyZXNzIHZlc3RpbmdXaGl0ZWxpc3RlcjsNCg0KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIsIHVpbnQgX3ZhbHVlKSB7DQogICAgaWYgKF92YWx1ZSA+IHNwZW5kYWJsZUJhbGFuY2VPZihfc2VuZGVyKSkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHlWZXN0aW5nV2hpdGVsaXN0ZXIgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IHZlc3RpbmdXaGl0ZWxpc3RlcikgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIGZ1bmN0aW9uIE1pbmlNZUlycmV2b2NhYmxlVmVzdGVkVG9rZW4gKA0KICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LA0KICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sDQogICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLA0KICAgICAgc3RyaW5nIF90b2tlbk5hbWUsDQogICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLA0KICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwNCiAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQNCiAgKSBNaW5pTWVUb2tlbihfdG9rZW5GYWN0b3J5LCBfcGFyZW50VG9rZW4sIF9wYXJlbnRTbmFwU2hvdEJsb2NrLCBfdG9rZW5OYW1lLCBfZGVjaW1hbFVuaXRzLCBfdG9rZW5TeW1ib2wsIF90cmFuc2ZlcnNFbmFibGVkKSB7DQogICAgdmVzdGluZ1doaXRlbGlzdGVyID0gbXNnLnNlbmRlcjsNCiAgICBkb1NldENhbkNyZWF0ZUdyYW50cyh2ZXN0aW5nV2hpdGVsaXN0ZXIsIHRydWUpOw0KICB9DQoNCiAgLy8gQGRldiBBZGQgY2FuVHJhbnNmZXIgbW9kaWZpZXIgYmVmb3JlIGFsbG93aW5nIHRyYW5zZmVyIGFuZCB0cmFuc2ZlckZyb20gdG8gZ28gdGhyb3VnaA0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpDQogICAgICAgICAgIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIsIF92YWx1ZSkNCiAgICAgICAgICAgcHVibGljDQogICAgICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQ0KICAgICAgICAgICBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKQ0KICAgICAgICAgICBwdWJsaWMNCiAgICAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3BlbmRhYmxlQmFsYW5jZU9mKGFkZHJlc3MgX2hvbGRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIHsNCiAgICByZXR1cm4gdHJhbnNmZXJhYmxlVG9rZW5zKF9ob2xkZXIsIHVpbnQ2NChub3cpKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdyYW50VmVzdGVkVG9rZW5zKA0KICAgIGFkZHJlc3MgX3RvLA0KICAgIHVpbnQyNTYgX3ZhbHVlLA0KICAgIHVpbnQ2NCBfc3RhcnQsDQogICAgdWludDY0IF9jbGlmZiwNCiAgICB1aW50NjQgX3Zlc3RpbmcpIHB1YmxpYyB7DQoNCiAgICAvLyBDaGVjayBzdGFydCwgY2xpZmYgYW5kIHZlc3RpbmcgYXJlIHByb3Blcmx5IG9yZGVyIHRvIGVuc3VyZSBjb3JyZWN0IGZ1bmN0aW9uYWxpdHkgb2YgdGhlIGZvcm11bGEuDQogICAgaWYgKF9jbGlmZiA8IF9zdGFydCkgdGhyb3c7DQogICAgaWYgKF92ZXN0aW5nIDwgX3N0YXJ0KSB0aHJvdzsNCiAgICBpZiAoX3Zlc3RpbmcgPCBfY2xpZmYpIHRocm93Ow0KDQogICAgaWYgKCFjYW5DcmVhdGVHcmFudHNbbXNnLnNlbmRlcl0pIHRocm93Ow0KICAgIGlmICh0b2tlbkdyYW50c0NvdW50KF90bykgPiAyMCkgdGhyb3c7ICAgLy8gVG8gcHJldmVudCBhIHVzZXIgYmVpbmcgc3BhbW1lZCBhbmQgaGF2ZSBoaXMgYmFsYW5jZSBsb2NrZWQgKG91dCBvZiBnYXMgYXR0YWNrIHdoZW4gY2FsY3VsYXRpbmcgdmVzdGluZykuDQoNCiAgICBUb2tlbkdyYW50IG1lbW9yeSBncmFudCA9IFRva2VuR3JhbnQobXNnLnNlbmRlciwgX3ZhbHVlLCBfY2xpZmYsIF92ZXN0aW5nLCBfc3RhcnQpOw0KICAgIGdyYW50c1tfdG9dLnB1c2goZ3JhbnQpOw0KDQogICAgaWYgKCF0cmFuc2ZlcihfdG8sIF92YWx1ZSkpIHRocm93Ow0KDQogICAgTmV3VG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgX2NsaWZmLCBfdmVzdGluZywgX3N0YXJ0KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNldENhbkNyZWF0ZUdyYW50cyhhZGRyZXNzIF9hZGRyLCBib29sIF9hbGxvd2VkKQ0KICAgICAgICAgICBvbmx5VmVzdGluZ1doaXRlbGlzdGVyIHB1YmxpYyB7DQogICAgZG9TZXRDYW5DcmVhdGVHcmFudHMoX2FkZHIsIF9hbGxvd2VkKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRvU2V0Q2FuQ3JlYXRlR3JhbnRzKGFkZHJlc3MgX2FkZHIsIGJvb2wgX2FsbG93ZWQpDQogICAgICAgICAgIGludGVybmFsIHsNCiAgICBjYW5DcmVhdGVHcmFudHNbX2FkZHJdID0gX2FsbG93ZWQ7DQogIH0NCg0KICBmdW5jdGlvbiBjaGFuZ2VWZXN0aW5nV2hpdGVsaXN0ZXIoYWRkcmVzcyBfbmV3V2hpdGVsaXN0ZXIpIG9ubHlWZXN0aW5nV2hpdGVsaXN0ZXIgcHVibGljIHsNCiAgICBkb1NldENhbkNyZWF0ZUdyYW50cyh2ZXN0aW5nV2hpdGVsaXN0ZXIsIGZhbHNlKTsNCiAgICB2ZXN0aW5nV2hpdGVsaXN0ZXIgPSBfbmV3V2hpdGVsaXN0ZXI7DQogICAgZG9TZXRDYW5DcmVhdGVHcmFudHModmVzdGluZ1doaXRlbGlzdGVyLCB0cnVlKTsNCiAgfQ0KDQogIC8vIEBkZXYgTm90IGFsbG93IHRva2VuIGdyYW50cw0KICBmdW5jdGlvbiByZXZva2VUb2tlbkdyYW50KGFkZHJlc3MgX2hvbGRlciwgdWludCBfZ3JhbnRJZCkgcHVibGljIHsNCiAgICB0aHJvdzsNCiAgfQ0KDQogIC8vDQogIGZ1bmN0aW9uIHRva2VuR3JhbnRzQ291bnQoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCBpbmRleCkgew0KICAgIHJldHVybiBncmFudHNbX2hvbGRlcl0ubGVuZ3RoOw0KICB9DQoNCiAgZnVuY3Rpb24gdG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzIGdyYW50ZXIsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdmVzdGVkLCB1aW50NjQgc3RhcnQsIHVpbnQ2NCBjbGlmZiwgdWludDY0IHZlc3RpbmcpIHsNCiAgICBUb2tlbkdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsNCg0KICAgIGdyYW50ZXIgPSBncmFudC5ncmFudGVyOw0KICAgIHZhbHVlID0gZ3JhbnQudmFsdWU7DQogICAgc3RhcnQgPSBncmFudC5zdGFydDsNCiAgICBjbGlmZiA9IGdyYW50LmNsaWZmOw0KICAgIHZlc3RpbmcgPSBncmFudC52ZXN0aW5nOw0KDQogICAgdmVzdGVkID0gdmVzdGVkVG9rZW5zKGdyYW50LCB1aW50NjQobm93KSk7DQogIH0NCg0KICBmdW5jdGlvbiB2ZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKA0KICAgICAgZ3JhbnQudmFsdWUsDQogICAgICB1aW50MjU2KHRpbWUpLA0KICAgICAgdWludDI1NihncmFudC5zdGFydCksDQogICAgICB1aW50MjU2KGdyYW50LmNsaWZmKSwNCiAgICAgIHVpbnQyNTYoZ3JhbnQudmVzdGluZykNCiAgICApOw0KICB9DQoNCiAgLy8gIHRyYW5zZmVyYWJsZVRva2Vucw0KICAvLyAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgXy8tLS0tLS0tLSAgIE5vblZlc3RlZFRva2Vucw0KICAvLyAgIHwgICAgICAgICAgICAgICAgICAgICAgIF8vDQogIC8vICAgfCAgICAgICAgICAgICAgICAgICAgIF8vDQogIC8vICAgfCAgICAgICAgICAgICAgICAgICBfLw0KICAvLyAgIHwgICAgICAgICAgICAgICAgIF8vDQogIC8vICAgfCAgICAgICAgICAgICAgICAvDQogIC8vICAgfCAgICAgICAgICAgICAgLnwNCiAgLy8gICB8ICAgICAgICAgICAgLiAgfA0KICAvLyAgIHwgICAgICAgICAgLiAgICB8DQogIC8vICAgfCAgICAgICAgLiAgICAgIHwNCiAgLy8gICB8ICAgICAgLiAgICAgICAgfA0KICAvLyAgIHwgICAgLiAgICAgICAgICB8DQogIC8vICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQ0KICAvLyAgICAgIFN0YXJ0ICAgICAgIENsaWZ0ICAgIFZlc3RpbmcNCg0KICBmdW5jdGlvbiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoDQogICAgdWludDI1NiB0b2tlbnMsDQogICAgdWludDI1NiB0aW1lLA0KICAgIHVpbnQyNTYgc3RhcnQsDQogICAgdWludDI1NiBjbGlmZiwNCiAgICB1aW50MjU2IHZlc3RpbmcpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICAgew0KDQogICAgLy8gU2hvcnRjdXRzIGZvciBiZWZvcmUgY2xpZmYgYW5kIGFmdGVyIHZlc3RpbmcgY2FzZXMuDQogICAgaWYgKHRpbWUgPCBjbGlmZikgcmV0dXJuIDA7DQogICAgaWYgKHRpbWUgPj0gdmVzdGluZykgcmV0dXJuIHRva2VuczsNCg0KICAgIC8vIEludGVycG9sYXRlIGFsbCB2ZXN0ZWQgdG9rZW5zLg0KICAgIC8vIEFzIGJlZm9yZSBjbGlmZiB0aGUgc2hvcnRjdXQgcmV0dXJucyAwLCB3ZSBjYW4gdXNlIGp1c3QgdGhpcyBmdW5jdGlvbiB0bw0KICAgIC8vIGNhbGN1bGF0ZSBpdC4NCg0KICAgIC8vIHZlc3RlZFRva2VucyA9IHRva2VucyAqICh0aW1lIC0gc3RhcnQpIC8gKHZlc3RpbmcgLSBzdGFydCkNCiAgICB1aW50MjU2IHZlc3RlZFRva2VucyA9IHNhZmVEaXYoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FmZU11bCgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhZmVTdWIodGltZSwgc3RhcnQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhZmVTdWIodmVzdGluZywgc3RhcnQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsNCg0KICAgIHJldHVybiB2ZXN0ZWRUb2tlbnM7DQogIH0NCg0KICBmdW5jdGlvbiBub25WZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAvLyBPZiBhbGwgdGhlIHRva2VucyBvZiB0aGUgZ3JhbnQsIGhvdyBtYW55IG9mIHRoZW0gYXJlIG5vdCB2ZXN0ZWQ/DQogICAgLy8gZ3JhbnRWYWx1ZSAtIHZlc3RlZFRva2Vucw0KICAgIHJldHVybiBzYWZlU3ViKGdyYW50LnZhbHVlLCB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHRpbWUpKTsNCiAgfQ0KDQogIC8vIEBkZXYgVGhlIGRhdGUgaW4gd2hpY2ggYWxsIHRva2VucyBhcmUgdHJhbnNmZXJhYmxlIGZvciB0aGUgaG9sZGVyDQogIC8vIFVzZWZ1bCBmb3IgZGlzcGxheWluZyBwdXJwb3NlcyAobm90IHVzZWQgaW4gYW55IGxvZ2ljIGNhbGN1bGF0aW9ucykNCiAgZnVuY3Rpb24gbGFzdFRva2VuSXNUcmFuc2ZlcmFibGVEYXRlKGFkZHJlc3MgaG9sZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDY0IGRhdGUpIHsNCiAgICBkYXRlID0gdWludDY0KG5vdyk7DQogICAgdWludDI1NiBncmFudEluZGV4ID0gdG9rZW5HcmFudHNDb3VudChob2xkZXIpOw0KICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgew0KICAgICAgZGF0ZSA9IG1heDY0KGdyYW50c1tob2xkZXJdW2ldLnZlc3RpbmcsIGRhdGUpOw0KICAgIH0NCiAgICByZXR1cm4gZGF0ZTsNCiAgfQ0KDQogIC8vIEBkZXYgSG93IG1hbnkgdG9rZW5zIGNhbiBhIGhvbGRlciB0cmFuc2ZlciBhdCBhIHBvaW50IGluIHRpbWUNCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICB1aW50MjU2IGdyYW50SW5kZXggPSB0b2tlbkdyYW50c0NvdW50KGhvbGRlcik7DQoNCiAgICBpZiAoZ3JhbnRJbmRleCA9PSAwKSByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7IC8vIHNob3J0Y3V0IGZvciBob2xkZXIgd2l0aG91dCBncmFudHMNCg0KICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBhbGwgdGhlIGdyYW50cyB0aGUgaG9sZGVyIGhhcywgYW5kIGFkZCBhbGwgbm9uLXZlc3RlZCB0b2tlbnMNCiAgICB1aW50MjU2IG5vblZlc3RlZCA9IDA7DQogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7DQogICAgICBub25WZXN0ZWQgPSBzYWZlQWRkKG5vblZlc3RlZCwgbm9uVmVzdGVkVG9rZW5zKGdyYW50c1tob2xkZXJdW2ldLCB0aW1lKSk7DQogICAgfQ0KDQogICAgLy8gQmFsYW5jZSAtIHRvdGFsTm9uVmVzdGVkIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGEgaG9sZGVyIGNhbiB0cmFuc2ZlciBhdCBhbnkgZ2l2ZW4gdGltZQ0KICAgIHJldHVybiBzYWZlU3ViKGJhbGFuY2VPZihob2xkZXIpLCBub25WZXN0ZWQpOw0KICB9DQp9DQoNCi8qDQogICAgQ29weXJpZ2h0IDIwMTcsIEpvcmdlIEl6cXVpZXJkbyAoQXJhZ29uIEZvdW5kYXRpb24pDQoqLw0KDQpjb250cmFjdCBBTlQgaXMgTWluaU1lSXJyZXZvY2FibGVWZXN0ZWRUb2tlbiB7DQogIC8vIEBkZXYgQU5UIGNvbnN0cnVjdG9yIGp1c3QgcGFyYW1ldHJpemVzIHRoZSBNaW5pTWVJcnJldm9jYWJsZVZlc3RlZFRva2VuIGNvbnN0cnVjdG9yDQogIGZ1bmN0aW9uIEFOVCgNCiAgICBhZGRyZXNzIF90b2tlbkZhY3RvcnkNCiAgKSBNaW5pTWVJcnJldm9jYWJsZVZlc3RlZFRva2VuKA0KICAgIF90b2tlbkZhY3RvcnksDQogICAgMHgwLCAgICAgICAgICAgICAgICAgICAgLy8gbm8gcGFyZW50IHRva2VuDQogICAgMCwgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gc25hcHNob3QgYmxvY2sgbnVtYmVyIGZyb20gcGFyZW50DQogICAgIkFyYWdvbiBOZXR3b3JrIFRva2VuIiwgLy8gVG9rZW4gbmFtZQ0KICAgIDE4LCAgICAgICAgICAgICAgICAgICAgIC8vIERlY2ltYWxzDQogICAgIkFOVCIsICAgICAgICAgICAgICAgICAgLy8gU3ltYm9sDQogICAgdHJ1ZSAgICAgICAgICAgICAgICAgICAgLy8gRW5hYmxlIHRyYW5zZmVycw0KICAgICkge30NCn0NCg0KDQoNCi8qDQogICAgQ29weXJpZ2h0IDIwMTcsIEpvcmdlIEl6cXVpZXJkbyAoQXJhZ29uIEZvdW5kYXRpb24pDQogICAgQ29weXJpZ2h0IDIwMTcsIEpvcmRpIEJheWxpbmEgKEdpdmV0aCkNCg0KICAgIEJhc2VkIG9uIFNhbXBsZUNhbXBhaWduLVRva2VuQ29udHJvbGxlci5zb2wgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vR2l2ZXRoL21pbmltZQ0KICovDQoNCmNvbnRyYWN0IEFyYWdvblRva2VuU2FsZSBpcyBDb250cm9sbGVyLCBTYWZlTWF0aCB7DQogICAgdWludCBwdWJsaWMgaW5pdGlhbEJsb2NrOyAgICAgICAgICAgICAvLyBCbG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIHNhbGUgc3RhcnRzLiBJbmNsdXNpdmUuIHNhbGUgd2lsbCBiZSBvcGVuZWQgYXQgaW5pdGlhbCBibG9jay4NCiAgICB1aW50IHB1YmxpYyBmaW5hbEJsb2NrOyAgICAgICAgICAgICAgIC8vIEJsb2NrIG51bWJlciBpbiB3aGljaCB0aGUgc2FsZSBlbmQuIEV4Y2x1c2l2ZSwgc2FsZSB3aWxsIGJlIGNsb3NlZCBhdCBlbmRzIGJsb2NrLg0KICAgIHVpbnQgcHVibGljIGluaXRpYWxQcmljZTsgICAgICAgICAgICAgLy8gTnVtYmVyIG9mIHdlaS1BTlQgdG9rZW5zIGZvciAxIHdlaSwgYXQgdGhlIHN0YXJ0IG9mIHRoZSBzYWxlICgxOCBkZWNpbWFscykNCiAgICB1aW50IHB1YmxpYyBmaW5hbFByaWNlOyAgICAgICAgICAgICAgIC8vIE51bWJlciBvZiB3ZWktQU5UIHRva2VucyBmb3IgMSB3ZWksIGF0IHRoZSBlbmQgb2YgdGhlIHNhbGUNCiAgICB1aW50OCBwdWJsaWMgcHJpY2VTdGFnZXM7ICAgICAgICAgICAgIC8vIE51bWJlciBvZiBkaWZmZXJlbnQgcHJpY2Ugc3RhZ2VzIGZvciBpbnRlcnBvbGF0aW5nIGJldHdlZW4gaW5pdGlhbFByaWNlIGFuZCBmaW5hbFByaWNlDQogICAgYWRkcmVzcyBwdWJsaWMgYXJhZ29uRGV2TXVsdGlzaWc7ICAgICAvLyBUaGUgYWRkcmVzcyB0byBob2xkIHRoZSBmdW5kcyBkb25hdGVkDQogICAgYWRkcmVzcyBwdWJsaWMgY29tbXVuaXR5TXVsdGlzaWc7ICAgICAvLyBDb21tdW5pdHkgdHJ1c3RlZCBtdWx0aXNpZyB0byBkZXBsb3kgbmV0d29yaw0KICAgIGJ5dGVzMzIgcHVibGljIGNhcENvbW1pdG1lbnQ7DQoNCiAgICB1aW50IHB1YmxpYyB0b3RhbENvbGxlY3RlZCA9IDA7ICAgICAgICAgICAgICAgLy8gSW4gd2VpDQogICAgYm9vbCBwdWJsaWMgc2FsZVN0b3BwZWQgPSBmYWxzZTsgICAgICAgICAgICAgIC8vIEhhcyBBcmFnb24gRGV2IHN0b3BwZWQgdGhlIHNhbGU/DQogICAgYm9vbCBwdWJsaWMgc2FsZUZpbmFsaXplZCA9IGZhbHNlOyAgICAgICAgICAgIC8vIEhhcyBBcmFnb24gRGV2IGZpbmFsaXplZCB0aGUgc2FsZT8NCg0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGFjdGl2YXRlZDsgICAvLyBBZGRyZXNzIGNvbmZpcm1hdGVzIHRoYXQgd2FudHMgdG8gYWN0aXZhdGUgdGhlIHNhbGUNCg0KICAgIEFOVCBwdWJsaWMgdG9rZW47ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgdG9rZW4NCiAgICBBTlBsYWNlaG9sZGVyIHB1YmxpYyBuZXR3b3JrUGxhY2Vob2xkZXI7ICAgICAgLy8gVGhlIG5ldHdvcmsgcGxhY2Vob2xkZXINCiAgICBTYWxlV2FsbGV0IHB1YmxpYyBzYWxlV2FsbGV0OyAgICAgICAgICAgICAgICAgICAgLy8gV2FsbGV0IHRoYXQgcmVjZWl2ZXMgYWxsIHNhbGUgZnVuZHMNCg0KICAgIHVpbnQgY29uc3RhbnQgcHVibGljIGR1c3QgPSAxIGZpbm5leTsgICAgICAgICAvLyBNaW5pbXVtIGludmVzdG1lbnQNCiAgICB1aW50IHB1YmxpYyBoYXJkQ2FwID0gMTAwMDAwMCBldGhlcjsgICAgICAgICAgLy8gSGFyZCBjYXAgdG8gcHJvdGVjdCB0aGUgRVRIIG5ldHdvcmsgZnJvbSBhIHJlYWxseSBoaWdoIHJhaXNlDQoNCiAgICBldmVudCBOZXdQcmVzYWxlQWxsb2NhdGlvbihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyLCB1aW50MjU2IGFudEFtb3VudCk7DQogICAgZXZlbnQgTmV3QnV5ZXIoYWRkcmVzcyBpbmRleGVkIGhvbGRlciwgdWludDI1NiBhbnRBbW91bnQsIHVpbnQyNTYgZXRoZXJBbW91bnQpOw0KICAgIGV2ZW50IENhcFJldmVhbGVkKHVpbnQgdmFsdWUsIHVpbnQgc2VjcmV0LCBhZGRyZXNzIHJldmVhbGVyKTsNCi8vLyBAZGV2IFRoZXJlIGFyZSBzZXZlcmFsIGNoZWNrcyB0byBtYWtlIHN1cmUgdGhlIHBhcmFtZXRlcnMgYXJlIGFjY2VwdGFibGUNCi8vLyBAcGFyYW0gX2luaXRpYWxCbG9jayBUaGUgQmxvY2sgbnVtYmVyIGluIHdoaWNoIHRoZSBzYWxlIHN0YXJ0cw0KLy8vIEBwYXJhbSBfZmluYWxCbG9jayBUaGUgQmxvY2sgbnVtYmVyIGluIHdoaWNoIHRoZSBzYWxlIGVuZHMNCi8vLyBAcGFyYW0gX2FyYWdvbkRldk11bHRpc2lnIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzdG9yZSB0aGUgZG9uYXRlZCBmdW5kcyBhbmQgbWFuYWdlcg0KLy8vIGZvciB0aGUgc2FsZQ0KLy8vIEBwYXJhbSBfaW5pdGlhbFByaWNlIFRoZSBwcmljZSBmb3IgdGhlIGZpcnN0IHN0YWdlIG9mIHRoZSBzYWxlLiBQcmljZSBpbiB3ZWktQU5UIHBlciB3ZWkuDQovLy8gQHBhcmFtIF9maW5hbFByaWNlIFRoZSBwcmljZSBmb3IgdGhlIGZpbmFsIHN0YWdlIG9mIHRoZSBzYWxlLiBQcmljZSBpbiB3ZWktQU5UIHBlciB3ZWkuDQovLy8gQHBhcmFtIF9wcmljZVN0YWdlcyBUaGUgbnVtYmVyIG9mIHByaWNlIHN0YWdlcy4gVGhlIHByaWNlIGZvciBldmVyeSBtaWRkbGUgc3RhZ2UNCi8vLyB3aWxsIGJlIGxpbmVhcmx5IGludGVycG9sYXRlZC4NCi8qDQogcHJpY2UNCiAgICAgICAgXg0KICAgICAgICB8DQpJbml0aWFsIHwgICAgICAgcyA9IDANCnByaWNlICAgfCAgICAgICstLS0tLS0rDQogICAgICAgIHwgICAgICB8ICAgICAgfCBzID0gMQ0KICAgICAgICB8ICAgICAgfCAgICAgICstLS0tLS0rDQogICAgICAgIHwgICAgICB8ICAgICAgICAgICAgIHwgcyA9IDINCiAgICAgICAgfCAgICAgIHwgICAgICAgICAgICAgKy0tLS0tLSsNCiAgICAgICAgfCAgICAgIHwgICAgICAgICAgICAgICAgICAgIHwgcyA9IDMNCkZpbmFsICAgfCAgICAgIHwgICAgICAgICAgICAgICAgICAgICstLS0tLS0rDQpwcmljZSAgIHwgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgfA0KICAgICAgICB8ICAgICAgfCAgICBmb3IgcHJpY2VTdGFnZXMgPSA0ICAgIHwNCiAgICAgICAgKy0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0+DQogICAgICAgICAgSW5pdGlhbCAgICAgICAgICAgICAgICAgICAgIEZpbmFsICAgICAgIHRpbWUNCiAgICAgICAgICBibG9jayAgICAgICAgICAgICAgICAgICAgICAgYmxvY2sNCg0KDQpFdmVyeSBzdGFnZSBpcyB0aGUgc2FtZSB0aW1lIGxlbmd0aC4NClByaWNlIGluY3JlYXNlcyBieSB0aGUgc2FtZSBkZWx0YSBpbiBldmVyeSBzdGFnZSBjaGFuZ2UNCg0KKi8NCg0KICBmdW5jdGlvbiBBcmFnb25Ub2tlblNhbGUgKA0KICAgICAgdWludCBfaW5pdGlhbEJsb2NrLA0KICAgICAgdWludCBfZmluYWxCbG9jaywNCiAgICAgIGFkZHJlc3MgX2FyYWdvbkRldk11bHRpc2lnLA0KICAgICAgYWRkcmVzcyBfY29tbXVuaXR5TXVsdGlzaWcsDQogICAgICB1aW50MjU2IF9pbml0aWFsUHJpY2UsDQogICAgICB1aW50MjU2IF9maW5hbFByaWNlLA0KICAgICAgdWludDggX3ByaWNlU3RhZ2VzLA0KICAgICAgYnl0ZXMzMiBfY2FwQ29tbWl0bWVudA0KICApDQogICAgICBub25femVyb19hZGRyZXNzKF9hcmFnb25EZXZNdWx0aXNpZykNCiAgICAgIG5vbl96ZXJvX2FkZHJlc3MoX2NvbW11bml0eU11bHRpc2lnKQ0KICB7DQogICAgICBpZiAoX2luaXRpYWxCbG9jayA8IGdldEJsb2NrTnVtYmVyKCkpIHRocm93Ow0KICAgICAgaWYgKF9pbml0aWFsQmxvY2sgPj0gX2ZpbmFsQmxvY2spIHRocm93Ow0KICAgICAgaWYgKF9pbml0aWFsUHJpY2UgPD0gX2ZpbmFsUHJpY2UpIHRocm93Ow0KICAgICAgaWYgKF9wcmljZVN0YWdlcyA8IDIpIHRocm93Ow0KICAgICAgaWYgKF9wcmljZVN0YWdlcyA+IF9pbml0aWFsUHJpY2UgLSBfZmluYWxQcmljZSkgdGhyb3c7DQogICAgICBpZiAodWludChfY2FwQ29tbWl0bWVudCkgPT0gMCkgdGhyb3c7DQoNCiAgICAgIC8vIFNhdmUgY29uc3RydWN0b3IgYXJndW1lbnRzIGFzIGdsb2JhbCB2YXJpYWJsZXMNCiAgICAgIGluaXRpYWxCbG9jayA9IF9pbml0aWFsQmxvY2s7DQogICAgICBmaW5hbEJsb2NrID0gX2ZpbmFsQmxvY2s7DQogICAgICBhcmFnb25EZXZNdWx0aXNpZyA9IF9hcmFnb25EZXZNdWx0aXNpZzsNCiAgICAgIGNvbW11bml0eU11bHRpc2lnID0gX2NvbW11bml0eU11bHRpc2lnOw0KICAgICAgaW5pdGlhbFByaWNlID0gX2luaXRpYWxQcmljZTsNCiAgICAgIGZpbmFsUHJpY2UgPSBfZmluYWxQcmljZTsNCiAgICAgIHByaWNlU3RhZ2VzID0gX3ByaWNlU3RhZ2VzOw0KICAgICAgY2FwQ29tbWl0bWVudCA9IF9jYXBDb21taXRtZW50Ow0KICB9DQoNCiAgLy8gQG5vdGljZSBEZXBsb3kgQU5UIGlzIGNhbGxlZCBvbmx5IG9uY2UgdG8gc2V0dXAgYWxsIHRoZSBuZWVkZWQgY29udHJhY3RzLg0KICAvLyBAcGFyYW0gX3Rva2VuOiBBZGRyZXNzIG9mIGFuIGluc3RhbmNlIG9mIHRoZSBBTlQgdG9rZW4NCiAgLy8gQHBhcmFtIF9uZXR3b3JrUGxhY2Vob2xkZXI6IEFkZHJlc3Mgb2YgYW4gaW5zdGFuY2Ugb2YgQU5QbGFjZWhvbGRlcg0KICAvLyBAcGFyYW0gX3NhbGVXYWxsZXQ6IEFkZHJlc3Mgb2YgdGhlIHdhbGxldCByZWNlaXZpbmcgdGhlIGZ1bmRzIG9mIHRoZSBzYWxlDQoNCiAgZnVuY3Rpb24gc2V0QU5UKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9uZXR3b3JrUGxhY2Vob2xkZXIsIGFkZHJlc3MgX3NhbGVXYWxsZXQpDQogICAgICAgICAgIG5vbl96ZXJvX2FkZHJlc3MoX3Rva2VuKQ0KICAgICAgICAgICBub25femVyb19hZGRyZXNzKF9uZXR3b3JrUGxhY2Vob2xkZXIpDQogICAgICAgICAgIG5vbl96ZXJvX2FkZHJlc3MoX3NhbGVXYWxsZXQpDQogICAgICAgICAgIG9ubHkoYXJhZ29uRGV2TXVsdGlzaWcpDQogICAgICAgICAgIHB1YmxpYyB7DQoNCiAgICAvLyBBc3NlcnQgdGhhdCB0aGUgZnVuY3Rpb24gaGFzbid0IGJlZW4gY2FsbGVkIGJlZm9yZSwgYXMgYWN0aXZhdGUgd2lsbCBoYXBwZW4gYXQgdGhlIGVuZA0KICAgIGlmIChhY3RpdmF0ZWRbdGhpc10pIHRocm93Ow0KDQogICAgdG9rZW4gPSBBTlQoX3Rva2VuKTsNCiAgICBuZXR3b3JrUGxhY2Vob2xkZXIgPSBBTlBsYWNlaG9sZGVyKF9uZXR3b3JrUGxhY2Vob2xkZXIpOw0KICAgIHNhbGVXYWxsZXQgPSBTYWxlV2FsbGV0KF9zYWxlV2FsbGV0KTsNCg0KICAgIGlmICh0b2tlbi5jb250cm9sbGVyKCkgIT0gYWRkcmVzcyh0aGlzKSkgdGhyb3c7IC8vIHNhbGUgaXMgY29udHJvbGxlcg0KICAgIGlmIChuZXR3b3JrUGxhY2Vob2xkZXIuc2FsZSgpICE9IGFkZHJlc3ModGhpcykpIHRocm93OyAvLyBwbGFjZWhvbGRlciBoYXMgcmVmZXJlbmNlIHRvIFNhbGUNCiAgICBpZiAobmV0d29ya1BsYWNlaG9sZGVyLnRva2VuKCkgIT0gYWRkcmVzcyh0b2tlbikpIHRocm93OyAvLyBwbGFjZWhvbGRlciBoYXMgcmVmZXJlbmNlIHRvIEFOVA0KICAgIGlmICh0b2tlbi50b3RhbFN1cHBseSgpID4gMCkgdGhyb3c7IC8vIHRva2VuIGlzIGVtcHR5DQogICAgaWYgKHNhbGVXYWxsZXQuZmluYWxCbG9jaygpICE9IGZpbmFsQmxvY2spIHRocm93OyAvLyBmaW5hbCBibG9ja3MgbXVzdCBtYXRjaA0KICAgIGlmIChzYWxlV2FsbGV0Lm11bHRpc2lnKCkgIT0gYXJhZ29uRGV2TXVsdGlzaWcpIHRocm93OyAvLyByZWNlaXZpbmcgd2FsbGV0IG11c3QgbWF0Y2gNCiAgICBpZiAoc2FsZVdhbGxldC50b2tlblNhbGUoKSAhPSBhZGRyZXNzKHRoaXMpKSB0aHJvdzsgLy8gd2F0Y2hlZCB0b2tlbiBzYWxlIG11c3QgYmUgc2VsZg0KDQogICAgLy8gQ29udHJhY3QgYWN0aXZhdGVzIHNhbGUgYXMgYWxsIHJlcXVpcmVtZW50cyBhcmUgcmVhZHkNCiAgICBkb0FjdGl2YXRlU2FsZSh0aGlzKTsNCiAgfQ0KDQogIC8vIEBub3RpY2UgQ2VydGFpbiBhZGRyZXNzZXMgbmVlZCB0byBjYWxsIHRoZSBhY3RpdmF0ZSBmdW5jdGlvbiBwcmlvciB0byB0aGUgc2FsZSBvcGVuaW5nIGJsb2NrLg0KICAvLyBUaGlzIHByb3ZlcyB0aGF0IHRoZXkgaGF2ZSBjaGVja2VkIHRoZSBzYWxlIGNvbnRyYWN0IGlzIGxlZ2l0LCBhcyB3ZWxsIGFzIHByb3ZpbmcNCiAgLy8gdGhlIGNhcGFiaWxpdHkgZm9yIHRob3NlIGFkZHJlc3NlcyB0byBpbnRlcmFjdCB3aXRoIHRoZSBjb250cmFjdC4NCiAgZnVuY3Rpb24gYWN0aXZhdGVTYWxlKCkNCiAgICAgICAgICAgcHVibGljIHsNCiAgICBkb0FjdGl2YXRlU2FsZShtc2cuc2VuZGVyKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRvQWN0aXZhdGVTYWxlKGFkZHJlc3MgX2VudGl0eSkNCiAgICBub25femVyb19hZGRyZXNzKHRva2VuKSAgICAgICAgICAgICAgIC8vIGNhbm5vdCBhY3RpdmF0ZSBiZWZvcmUgc2V0dGluZyB0b2tlbg0KICAgIG9ubHlfYmVmb3JlX3NhbGUNCiAgICBwcml2YXRlIHsNCiAgICBhY3RpdmF0ZWRbX2VudGl0eV0gPSB0cnVlOw0KICB9DQoNCiAgLy8gQG5vdGljZSBXaGV0aGVyIHRoZSBuZWVkZWQgYWNjb3VudHMgaGF2ZSBhY3RpdmF0ZWQgdGhlIHNhbGUuDQogIC8vIEByZXR1cm4gSXMgc2FsZSBhY3RpdmF0ZWQNCiAgZnVuY3Rpb24gaXNBY3RpdmF0ZWQoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiBhY3RpdmF0ZWRbdGhpc10gJiYgYWN0aXZhdGVkW2FyYWdvbkRldk11bHRpc2lnXSAmJiBhY3RpdmF0ZWRbY29tbXVuaXR5TXVsdGlzaWddOw0KICB9DQoNCiAgLy8gQG5vdGljZSBHZXQgdGhlIHByaWNlIGZvciBhIEFOVCB0b2tlbiBhdCBhbnkgZ2l2ZW4gYmxvY2sgbnVtYmVyDQogIC8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgdGhlIGJsb2NrIGZvciB3aGljaCB0aGUgcHJpY2UgaXMgcmVxdWVzdGVkDQogIC8vIEByZXR1cm4gTnVtYmVyIG9mIHdlaS1BTlQgZm9yIDEgd2VpDQogIC8vIElmIHNhbGUgaXNuJ3Qgb25nb2luZyBmb3IgdGhhdCBibG9jaywgcmV0dXJucyAwLg0KICBmdW5jdGlvbiBnZXRQcmljZSh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICBpZiAoX2Jsb2NrTnVtYmVyIDwgaW5pdGlhbEJsb2NrIHx8IF9ibG9ja051bWJlciA+PSBmaW5hbEJsb2NrKSByZXR1cm4gMDsNCg0KICAgIHJldHVybiBwcmljZUZvclN0YWdlKHN0YWdlRm9yQmxvY2soX2Jsb2NrTnVtYmVyKSk7DQogIH0NCg0KICAvLyBAbm90aWNlIEdldCB3aGF0IHRoZSBzdGFnZSBpcyBmb3IgYSBnaXZlbiBibG9ja051bWJlcg0KICAvLyBAcGFyYW0gX2Jsb2NrTnVtYmVyOiBCbG9jayBudW1iZXINCiAgLy8gQHJldHVybiBUaGUgc2FsZSBzdGFnZSBmb3IgdGhhdCBibG9jay4gU3RhZ2UgaXMgYmV0d2VlbiAwIGFuZCAocHJpY2VTdGFnZXMgLSAxKQ0KICBmdW5jdGlvbiBzdGFnZUZvckJsb2NrKHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50OCkgew0KICAgIHVpbnQgYmxvY2tOID0gc2FmZVN1YihfYmxvY2tOdW1iZXIsIGluaXRpYWxCbG9jayk7DQogICAgdWludCB0b3RhbEJsb2NrcyA9IHNhZmVTdWIoZmluYWxCbG9jaywgaW5pdGlhbEJsb2NrKTsNCg0KICAgIHJldHVybiB1aW50OChzYWZlRGl2KHNhZmVNdWwocHJpY2VTdGFnZXMsIGJsb2NrTiksIHRvdGFsQmxvY2tzKSk7DQogIH0NCg0KICAvLyBAbm90aWNlIEdldCB3aGF0IHRoZSBwcmljZSBpcyBmb3IgYSBnaXZlbiBzdGFnZQ0KICAvLyBAcGFyYW0gX3N0YWdlOiBTdGFnZSBudW1iZXINCiAgLy8gQHJldHVybiBQcmljZSBpbiB3ZWkgZm9yIHRoYXQgc3RhZ2UuDQogIC8vIElmIHNhbGUgc3RhZ2UgZG9lc24ndCBleGlzdCwgcmV0dXJucyAwLg0KICBmdW5jdGlvbiBwcmljZUZvclN0YWdlKHVpbnQ4IF9zdGFnZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1Nikgew0KICAgIGlmIChfc3RhZ2UgPj0gcHJpY2VTdGFnZXMpIHJldHVybiAwOw0KICAgIHVpbnQgcHJpY2VEaWZmZXJlbmNlID0gc2FmZVN1Yihpbml0aWFsUHJpY2UsIGZpbmFsUHJpY2UpOw0KICAgIHVpbnQgc3RhZ2VEZWx0YSA9IHNhZmVEaXYocHJpY2VEaWZmZXJlbmNlLCB1aW50KHByaWNlU3RhZ2VzIC0gMSkpOw0KICAgIHJldHVybiBzYWZlU3ViKGluaXRpYWxQcmljZSwgc2FmZU11bCh1aW50MjU2KF9zdGFnZSksIHN0YWdlRGVsdGEpKTsNCiAgfQ0KDQogIC8vIEBub3RpY2UgQXJhZ29uIERldiBuZWVkcyB0byBtYWtlIGluaXRpYWwgdG9rZW4gYWxsb2NhdGlvbnMgZm9yIHByZXNhbGUgcGFydG5lcnMNCiAgLy8gVGhpcyBhbGxvY2F0aW9uIGhhcyB0byBiZSBtYWRlIGJlZm9yZSB0aGUgc2FsZSBpcyBhY3RpdmF0ZWQuIEFjdGl2YXRpbmcgdGhlIHNhbGUgbWVhbnMgbm8gbW9yZQ0KICAvLyBhcmJpdHJhcnkgYWxsb2NhdGlvbnMgYXJlIHBvc3NpYmxlIGFuZCBleHByZXNzZXMgY29uZm9ybWl0eS4NCiAgLy8gQHBhcmFtIF9yZWNlaXZlcjogVGhlIHJlY2VpdmVyIG9mIHRoZSB0b2tlbnMNCiAgLy8gQHBhcmFtIF9hbW91bnQ6IEFtb3VudCBvZiB0b2tlbnMgYWxsb2NhdGVkIGZvciByZWNlaXZlci4NCiAgZnVuY3Rpb24gYWxsb2NhdGVQcmVzYWxlVG9rZW5zKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50IF9hbW91bnQsIHVpbnQ2NCBjbGlmZkRhdGUsIHVpbnQ2NCB2ZXN0aW5nRGF0ZSkNCiAgICAgICAgICAgb25seV9iZWZvcmVfc2FsZV9hY3RpdmF0aW9uDQogICAgICAgICAgIG9ubHlfYmVmb3JlX3NhbGUNCiAgICAgICAgICAgbm9uX3plcm9fYWRkcmVzcyhfcmVjZWl2ZXIpDQogICAgICAgICAgIG9ubHkoYXJhZ29uRGV2TXVsdGlzaWcpDQogICAgICAgICAgIHB1YmxpYyB7DQoNCiAgICBpZiAoX2Ftb3VudCA+IDEwICoqIDI0KSB0aHJvdzsgLy8gMSBtaWxsaW9uIEFOVC4gTm8gcHJlc2FsZSBwYXJ0bmVyIHdpbGwgaGF2ZSBtb3JlIHRoYW4gdGhpcyBhbGxvY2F0ZWQuIFByZXZlbnQgb3ZlcmZsb3dzLg0KDQogICAgaWYgKCF0b2tlbi5nZW5lcmF0ZVRva2VucyhhZGRyZXNzKHRoaXMpLCBfYW1vdW50KSkgdGhyb3c7DQogICAgdG9rZW4uZ3JhbnRWZXN0ZWRUb2tlbnMoX3JlY2VpdmVyLCBfYW1vdW50LCB1aW50NjQobm93KSwgY2xpZmZEYXRlLCB2ZXN0aW5nRGF0ZSk7DQoNCiAgICBOZXdQcmVzYWxlQWxsb2NhdGlvbihfcmVjZWl2ZXIsIF9hbW91bnQpOw0KICB9DQoNCi8vLyBAZGV2IFRoZSBmYWxsYmFjayBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiBldGhlciBpcyBzZW50IHRvIHRoZSBjb250cmFjdCwgaXQNCi8vLyBzaW1wbHkgY2FsbHMgYGRvUGF5bWVudCgpYCB3aXRoIHRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgYXMgdGhlDQovLy8gYF9vd25lcmAuIFBheWFibGUgaXMgYSByZXF1aXJlZCBzb2xpZGl0eSBtb2RpZmllciBmb3IgZnVuY3Rpb25zIHRvIHJlY2VpdmUNCi8vLyBldGhlciwgd2l0aG91dCB0aGlzIG1vZGlmaWVyIGZ1bmN0aW9ucyB3aWxsIHRocm93IGlmIGV0aGVyIGlzIHNlbnQgdG8gdGhlbQ0KDQogIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICByZXR1cm4gZG9QYXltZW50KG1zZy5zZW5kZXIpOw0KICB9DQoNCi8vLy8vLy8vLy8vLy8vLy8vDQovLyBDb250cm9sbGVyIGludGVyZmFjZQ0KLy8vLy8vLy8vLy8vLy8vLy8NCg0KLy8vIEBub3RpY2UgYHByb3h5UGF5bWVudCgpYCBhbGxvd3MgdGhlIGNhbGxlciB0byBzZW5kIGV0aGVyIHRvIHRoZSBUb2tlbiBkaXJlY3RseSBhbmQNCi8vLyBoYXZlIHRoZSB0b2tlbnMgY3JlYXRlZCBpbiBhbiBhZGRyZXNzIG9mIHRoZWlyIGNob29zaW5nDQovLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgbmV3bHkgY3JlYXRlZCB0b2tlbnMNCg0KICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcHVibGljIHJldHVybnMgKGJvb2wpIHsNCiAgICBkb1BheW1lbnQoX293bmVyKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQovLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRyYW5zZmVyLCBmb3IgdGhpcyBzYWxlIGFsbA0KLy8vICB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgYnkgZGVmYXVsdCBhbmQgbm8gZXh0cmEgbm90aWZpY2F0aW9ucyBhcmUgbmVlZGVkDQovLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyDQovLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyDQovLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXINCi8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXINCiAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgew0KICAgIC8vIFVudGlsIHRoZSBzYWxlIGlzIGZpbmFsaXplZCwgb25seSBhbGxvd3MgdHJhbnNmZXJzIG9yaWdpbmF0ZWQgYnkgdGhlIHNhbGUgY29udHJhY3QuDQogICAgLy8gV2hlbiBmaW5hbGl6ZVNhbGUgaXMgY2FsbGVkLCB0aGlzIGZ1bmN0aW9uIHdpbGwgc3RvcCBiZWluZyBjYWxsZWQgYW5kIHdpbGwgYWx3YXlzIGJlIHRydWUuDQogICAgcmV0dXJuIF9mcm9tID09IGFkZHJlc3ModGhpcyk7DQogIH0NCg0KLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwsIGZvciB0aGlzIHNhbGUgYWxsDQovLy8gIGFwcHJvdmFscyBhcmUgYWxsb3dlZCBieSBkZWZhdWx0IGFuZCBubyBleHRyYSBub3RpZmljYXRpb25zIGFyZSBuZWVkZWQNCi8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWANCi8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwNCi8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsDQovLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsDQogIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgew0KICAgIC8vIE5vIGFwcHJvdmUvdHJhbnNmZXJGcm9tIGR1cmluZyB0aGUgc2FsZQ0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KDQovLy8gQGRldiBgZG9QYXltZW50KClgIGlzIGFuIGludGVybmFsIGZ1bmN0aW9uIHRoYXQgc2VuZHMgdGhlIGV0aGVyIHRoYXQgdGhpcw0KLy8vICBjb250cmFjdCByZWNlaXZlcyB0byB0aGUgYXJhZ29uRGV2TXVsdGlzaWcgYW5kIGNyZWF0ZXMgdG9rZW5zIGluIHRoZSBhZGRyZXNzIG9mIHRoZQ0KLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIG5ld2x5IGNyZWF0ZWQgdG9rZW5zDQoNCiAgZnVuY3Rpb24gZG9QYXltZW50KGFkZHJlc3MgX293bmVyKQ0KICAgICAgICAgICBvbmx5X2R1cmluZ19zYWxlX3BlcmlvZA0KICAgICAgICAgICBvbmx5X3NhbGVfbm90X3N0b3BwZWQNCiAgICAgICAgICAgb25seV9zYWxlX2FjdGl2YXRlZA0KICAgICAgICAgICBub25femVyb19hZGRyZXNzKF9vd25lcikNCiAgICAgICAgICAgbWluaW11bV92YWx1ZShkdXN0KQ0KICAgICAgICAgICBpbnRlcm5hbCB7DQoNCiAgICBpZiAodG90YWxDb2xsZWN0ZWQgKyBtc2cudmFsdWUgPiBoYXJkQ2FwKSB0aHJvdzsgLy8gSWYgcGFzdCBoYXJkIGNhcCwgdGhyb3cNCg0KICAgIHVpbnQyNTYgYm91Z2h0VG9rZW5zID0gc2FmZU11bChtc2cudmFsdWUsIGdldFByaWNlKGdldEJsb2NrTnVtYmVyKCkpKTsgLy8gQ2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyBib3VnaHQNCg0KICAgIGlmICghc2FsZVdhbGxldC5zZW5kKG1zZy52YWx1ZSkpIHRocm93OyAvLyBTZW5kIGZ1bmRzIHRvIG11bHRpc2lnDQogICAgaWYgKCF0b2tlbi5nZW5lcmF0ZVRva2Vucyhfb3duZXIsIGJvdWdodFRva2VucykpIHRocm93OyAvLyBBbGxvY2F0ZSB0b2tlbnMuIFRoaXMgd2lsbCBmYWlsIGFmdGVyIHNhbGUgaXMgZmluYWxpemVkIGluIGNhc2UgaXQgaXMgaGlkZGVuIGNhcCBmaW5hbGl6ZWQuDQoNCiAgICB0b3RhbENvbGxlY3RlZCA9IHNhZmVBZGQodG90YWxDb2xsZWN0ZWQsIG1zZy52YWx1ZSk7IC8vIFNhdmUgdG90YWwgY29sbGVjdGVkIGFtb3VudA0KDQogICAgTmV3QnV5ZXIoX293bmVyLCBib3VnaHRUb2tlbnMsIG1zZy52YWx1ZSk7DQogIH0NCg0KICAvLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHN0b3Agc2FsZSBmb3IgYW4gZW1lcmdlbmN5Lg0KICAvLyBAZGV2IE9ubHkgQXJhZ29uIERldiBjYW4gZG8gaXQgYWZ0ZXIgaXQgaGFzIGJlZW4gYWN0aXZhdGVkLg0KICBmdW5jdGlvbiBlbWVyZ2VuY3lTdG9wU2FsZSgpDQogICAgICAgICAgIG9ubHlfc2FsZV9hY3RpdmF0ZWQNCiAgICAgICAgICAgb25seV9zYWxlX25vdF9zdG9wcGVkDQogICAgICAgICAgIG9ubHkoYXJhZ29uRGV2TXVsdGlzaWcpDQogICAgICAgICAgIHB1YmxpYyB7DQoNCiAgICBzYWxlU3RvcHBlZCA9IHRydWU7DQogIH0NCg0KICAvLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHJlc3RhcnQgc3RvcHBlZCBzYWxlLg0KICAvLyBAZGV2IE9ubHkgQXJhZ29uIERldiBjYW4gZG8gaXQgYWZ0ZXIgaXQgaGFzIGJlZW4gZGlzYWJsZWQgYW5kIHNhbGUgaXMgb25nb2luZy4NCiAgZnVuY3Rpb24gcmVzdGFydFNhbGUoKQ0KICAgICAgICAgICBvbmx5X2R1cmluZ19zYWxlX3BlcmlvZA0KICAgICAgICAgICBvbmx5X3NhbGVfc3RvcHBlZA0KICAgICAgICAgICBvbmx5KGFyYWdvbkRldk11bHRpc2lnKQ0KICAgICAgICAgICBwdWJsaWMgew0KDQogICAgc2FsZVN0b3BwZWQgPSBmYWxzZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJldmVhbENhcCh1aW50MjU2IF9jYXAsIHVpbnQyNTYgX2NhcF9zZWN1cmUpDQogICAgICAgICAgIG9ubHlfZHVyaW5nX3NhbGVfcGVyaW9kDQogICAgICAgICAgIG9ubHlfc2FsZV9hY3RpdmF0ZWQNCiAgICAgICAgICAgdmVyaWZ5X2NhcChfY2FwLCBfY2FwX3NlY3VyZSkNCiAgICAgICAgICAgcHVibGljIHsNCg0KICAgIGlmIChfY2FwID4gaGFyZENhcCkgdGhyb3c7DQoNCiAgICBoYXJkQ2FwID0gX2NhcDsNCiAgICBDYXBSZXZlYWxlZChfY2FwLCBfY2FwX3NlY3VyZSwgbXNnLnNlbmRlcik7DQoNCiAgICBpZiAodG90YWxDb2xsZWN0ZWQgKyBkdXN0ID49IGhhcmRDYXApIHsNCiAgICAgIGRvRmluYWxpemVTYWxlKF9jYXAsIF9jYXBfc2VjdXJlKTsNCiAgICB9DQogIH0NCg0KICAvLyBAbm90aWNlIEZpbmFsaXplcyBzYWxlIGdlbmVyYXRpbmcgdGhlIHRva2VucyBmb3IgQXJhZ29uIERldi4NCiAgLy8gQGRldiBUcmFuc2ZlcnMgdGhlIHRva2VuIGNvbnRyb2xsZXIgcG93ZXIgdG8gdGhlIEFOUGxhY2Vob2xkZXIuDQogIGZ1bmN0aW9uIGZpbmFsaXplU2FsZSh1aW50MjU2IF9jYXAsIHVpbnQyNTYgX2NhcF9zZWN1cmUpDQogICAgICAgICAgIG9ubHlfYWZ0ZXJfc2FsZQ0KICAgICAgICAgICBvbmx5KGFyYWdvbkRldk11bHRpc2lnKQ0KICAgICAgICAgICBwdWJsaWMgew0KDQogICAgZG9GaW5hbGl6ZVNhbGUoX2NhcCwgX2NhcF9zZWN1cmUpOw0KICB9DQoNCiAgZnVuY3Rpb24gZG9GaW5hbGl6ZVNhbGUodWludDI1NiBfY2FwLCB1aW50MjU2IF9jYXBfc2VjdXJlKQ0KICAgICAgICAgICB2ZXJpZnlfY2FwKF9jYXAsIF9jYXBfc2VjdXJlKQ0KICAgICAgICAgICBpbnRlcm5hbCB7DQogICAgLy8gRG9lc24ndCBjaGVjayBpZiBzYWxlU3RvcHBlZCBpcyBmYWxzZSwgYmVjYXVzZSBzYWxlIGNvdWxkIGVuZCBpbiBhIGVtZXJnZW5jeSBzdG9wLg0KICAgIC8vIFRoaXMgZnVuY3Rpb24gY2Fubm90IGJlIHN1Y2Nlc3NmdWxseSBjYWxsZWQgdHdpY2UsIGJlY2F1c2UgaXQgd2lsbCB0b3AgYmVpbmcgdGhlIGNvbnRyb2xsZXIsDQogICAgLy8gYW5kIHRoZSBnZW5lcmF0ZVRva2VucyBjYWxsIHdpbGwgZmFpbCBpZiBjYWxsZWQgYWdhaW4uDQoNCiAgICAvLyBBcmFnb24gRGV2IG93bnMgMzAlIG9mIHRoZSB0b3RhbCBudW1iZXIgb2YgZW1pdHRlZCB0b2tlbnMgYXQgdGhlIGVuZCBvZiB0aGUgc2FsZS4NCiAgICB1aW50MjU2IGFyYWdvblRva2VucyA9IHRva2VuLnRvdGFsU3VwcGx5KCkgKiAzIC8gNzsNCiAgICBpZiAoIXRva2VuLmdlbmVyYXRlVG9rZW5zKGFyYWdvbkRldk11bHRpc2lnLCBhcmFnb25Ub2tlbnMpKSB0aHJvdzsNCiAgICB0b2tlbi5jaGFuZ2VDb250cm9sbGVyKG5ldHdvcmtQbGFjZWhvbGRlcik7IC8vIFNhbGUgbG9zZXMgdG9rZW4gY29udHJvbGxlciBwb3dlciBpbiBmYXZvciBvZiBuZXR3b3JrIHBsYWNlaG9sZGVyDQoNCiAgICBzYWxlRmluYWxpemVkID0gdHJ1ZTsgIC8vIFNldCBzdG9wIGlzIHRydWUgd2hpY2ggd2lsbCBlbmFibGUgbmV0d29yayBkZXBsb3ltZW50DQogICAgc2FsZVN0b3BwZWQgPSB0cnVlOw0KICB9DQoNCiAgLy8gQG5vdGljZSBEZXBsb3kgQXJhZ29uIE5ldHdvcmsgY29udHJhY3QuDQogIC8vIEBwYXJhbSBuZXR3b3JrQWRkcmVzczogVGhlIGFkZHJlc3MgdGhlIG5ldHdvcmsgd2FzIGRlcGxveWVkIGF0Lg0KICBmdW5jdGlvbiBkZXBsb3lOZXR3b3JrKGFkZHJlc3MgbmV0d29ya0FkZHJlc3MpDQogICAgICAgICAgIG9ubHlfZmluYWxpemVkX3NhbGUNCiAgICAgICAgICAgbm9uX3plcm9fYWRkcmVzcyhuZXR3b3JrQWRkcmVzcykNCiAgICAgICAgICAgb25seShjb21tdW5pdHlNdWx0aXNpZykNCiAgICAgICAgICAgcHVibGljIHsNCg0KICAgIG5ldHdvcmtQbGFjZWhvbGRlci5jaGFuZ2VDb250cm9sbGVyKG5ldHdvcmtBZGRyZXNzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNldEFyYWdvbkRldk11bHRpc2lnKGFkZHJlc3MgX25ld011bHRpc2lnKQ0KICAgICAgICAgICBub25femVyb19hZGRyZXNzKF9uZXdNdWx0aXNpZykNCiAgICAgICAgICAgb25seShhcmFnb25EZXZNdWx0aXNpZykNCiAgICAgICAgICAgcHVibGljIHsNCg0KICAgIGFyYWdvbkRldk11bHRpc2lnID0gX25ld011bHRpc2lnOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0Q29tbXVuaXR5TXVsdGlzaWcoYWRkcmVzcyBfbmV3TXVsdGlzaWcpDQogICAgICAgICAgIG5vbl96ZXJvX2FkZHJlc3MoX25ld011bHRpc2lnKQ0KICAgICAgICAgICBvbmx5KGNvbW11bml0eU11bHRpc2lnKQ0KICAgICAgICAgICBwdWJsaWMgew0KDQogICAgY29tbXVuaXR5TXVsdGlzaWcgPSBfbmV3TXVsdGlzaWc7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRCbG9ja051bWJlcigpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICByZXR1cm4gYmxvY2subnVtYmVyOw0KICB9DQoNCiAgZnVuY3Rpb24gY29tcHV0ZUNhcCh1aW50MjU2IF9jYXAsIHVpbnQyNTYgX2NhcF9zZWN1cmUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChieXRlczMyKSB7DQogICAgcmV0dXJuIHNoYTMoX2NhcCwgX2NhcF9zZWN1cmUpOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNWYWxpZENhcCh1aW50MjU2IF9jYXAsIHVpbnQyNTYgX2NhcF9zZWN1cmUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgcmV0dXJuIGNvbXB1dGVDYXAoX2NhcCwgX2NhcF9zZWN1cmUpID09IGNhcENvbW1pdG1lbnQ7DQogIH0NCg0KICBtb2RpZmllciBvbmx5KGFkZHJlc3MgeCkgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IHgpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciB2ZXJpZnlfY2FwKHVpbnQyNTYgX2NhcCwgdWludDI1NiBfY2FwX3NlY3VyZSkgew0KICAgIGlmICghaXNWYWxpZENhcChfY2FwLCBfY2FwX3NlY3VyZSkpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5X2JlZm9yZV9zYWxlIHsNCiAgICBpZiAoZ2V0QmxvY2tOdW1iZXIoKSA+PSBpbml0aWFsQmxvY2spIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5X2R1cmluZ19zYWxlX3BlcmlvZCB7DQogICAgaWYgKGdldEJsb2NrTnVtYmVyKCkgPCBpbml0aWFsQmxvY2spIHRocm93Ow0KICAgIGlmIChnZXRCbG9ja051bWJlcigpID49IGZpbmFsQmxvY2spIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5X2FmdGVyX3NhbGUgew0KICAgIGlmIChnZXRCbG9ja051bWJlcigpIDwgZmluYWxCbG9jaykgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHlfc2FsZV9zdG9wcGVkIHsNCiAgICBpZiAoIXNhbGVTdG9wcGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seV9zYWxlX25vdF9zdG9wcGVkIHsNCiAgICBpZiAoc2FsZVN0b3BwZWQpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5X2JlZm9yZV9zYWxlX2FjdGl2YXRpb24gew0KICAgIGlmIChpc0FjdGl2YXRlZCgpKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seV9zYWxlX2FjdGl2YXRlZCB7DQogICAgaWYgKCFpc0FjdGl2YXRlZCgpKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seV9maW5hbGl6ZWRfc2FsZSB7DQogICAgaWYgKGdldEJsb2NrTnVtYmVyKCkgPCBmaW5hbEJsb2NrKSB0aHJvdzsNCiAgICBpZiAoIXNhbGVGaW5hbGl6ZWQpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBub25femVyb19hZGRyZXNzKGFkZHJlc3MgeCkgew0KICAgIGlmICh4ID09IDApIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBtaW5pbXVtX3ZhbHVlKHVpbnQyNTYgeCkgew0KICAgIGlmIChtc2cudmFsdWUgPCB4KSB0aHJvdzsNCiAgICBfOw0KICB9DQp9'