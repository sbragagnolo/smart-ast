base 64 content
base64artSale
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KDQovKioNCiAqIENvbnRyb2xsZXINCiAqLw0KY29udHJhY3QgQ29udHJvbGxlciB7DQoNCiAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIHRva2VuIGNvbnRyYWN0DQogIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgdG8gY3JlYXRlIHRva2Vucw0KICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzDQogIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcGF5YWJsZSByZXR1cm5zKGJvb2wpOw0KDQogIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdG9rZW4gdHJhbnNmZXIgYWxsb3dpbmcgdGhlDQogIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkDQogIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXINCiAgLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2Zlcg0KICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXINCiAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2Zlcg0KICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHJldHVybnMoYm9vbCk7DQoNCiAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlDQogIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkDQogIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWANCiAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsDQogIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOw0KfQ0KDQovKioNCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MNCiAqLw0KbGlicmFyeSBTYWZlTWF0aCB7DQoNCiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMA0KICAgIHVpbnQgYyA9IGEgLyBiOw0KICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkDQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICBhc3NlcnQoYiA8PSBhKTsNCiAgICByZXR1cm4gYSAtIGI7DQogIH0NCg0KICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYyA+PSBhKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7DQogICAgaWYgKCFhc3NlcnRpb24pIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KfQ0KDQovKioNCiAqIEB0aXRsZSBPd25hYmxlDQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sDQogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLg0KICovDQpjb250cmFjdCBPd25hYmxlIHsNCg0KICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCg0KICAvKioNCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyDQogICAqIGFjY291bnQuDQogICAqLw0KICBmdW5jdGlvbiBPd25hYmxlKCkgew0KICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuDQogICAqLw0KICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICBfOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuDQogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uDQogICAqLw0KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgew0KICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7DQogICAgICBvd25lciA9IG5ld093bmVyOw0KICAgIH0NCiAgfQ0KfQ0KDQovKioNCiAqIEB0aXRsZSBFUkMyMEJhc2ljDQogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UNCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMEJhc2ljIHsNCiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7DQogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOw0KICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsNCn0NCg0KLyoqDQogKiBAdGl0bGUgQ29udHJhY3RzIHRoYXQgc2hvdWxkIG5vdCBvd24gVG9rZW5zDQogKiBAZGV2IFRoaXMgYmxvY2tzIGluY29taW5nIEVSQzIzIHRva2VucyB0byBwcmV2ZW50IGFjY2lkZW50YWwgbG9zcyBvZiB0b2tlbnMuDQogKiBTaG91bGQgdG9rZW5zIChhbnkgRVJDMjBCYXNpYyBjb21wYXRpYmxlKSBlbmQgdXAgaW4gdGhlIGNvbnRyYWN0LCBpdCBhbGxvd3MgdGhlDQogKiBvd25lciB0byByZWNsYWltIHRoZSB0b2tlbnMuDQogKi8NCmNvbnRyYWN0IEhhc05vVG9rZW5zIGlzIE93bmFibGUgew0KDQogLyoqDQogICogQGRldiBSZWplY3QgYWxsIEVSQzIzIGNvbXBhdGlibGUgdG9rZW5zDQogICogQHBhcmFtIGZyb21fIGFkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCBpcyB0cmFuc2ZlcnJpbmcgdGhlIHRva2Vucw0KICAqIEBwYXJhbSB2YWx1ZV8gVWludCB0aGUgYW1vdW50IG9mIHRoZSBzcGVjaWZpZWQgdG9rZW4NCiAgKiBAcGFyYW0gZGF0YV8gQnl0ZXMgVGhlIGRhdGEgcGFzc2VkIGZyb20gdGhlIGNhbGxlci4NCiAgKi8NCiAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIGZyb21fLCB1aW50IHZhbHVlXywgYnl0ZXMgZGF0YV8pIGV4dGVybmFsIHsNCiAgICB0aHJvdzsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IFJlY2xhaW0gYWxsIEVSQzIwQmFzaWMgY29tcGF0aWJsZSB0b2tlbnMNCiAgICogQHBhcmFtIHRva2VuQWRkciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdA0KICAgKi8NCiAgZnVuY3Rpb24gcmVjbGFpbVRva2VuKGFkZHJlc3MgdG9rZW5BZGRyKSBleHRlcm5hbCBvbmx5T3duZXIgew0KICAgIEVSQzIwQmFzaWMgdG9rZW5JbnN0ID0gRVJDMjBCYXNpYyh0b2tlbkFkZHIpOw0KICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuSW5zdC5iYWxhbmNlT2YodGhpcyk7DQogICAgdG9rZW5JbnN0LnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsNCiAgfQ0KfQ0KDQovLyBAZGV2IENvbnRyYWN0IHRvIGhvbGQgRVRIIHJhaXNlZCBkdXJpbmcgYSB0b2tlbiBzYWxlLg0KLy8gUHJldmVudHMgYXR0YWNrIGluIHdoaWNoIHRoZSBNdWx0aXNpZyBzZW5kcyByYWlzZWQgZXRoZXIgdG8gdGhlDQovLyBzYWxlIGNvbnRyYWN0IHRvIG1pbnQgdG9rZW5zIHRvIGl0c2VsZiwgYW5kIGdldHRpbmcgdGhlDQovLyBmdW5kcyBiYWNrIGltbWVkaWF0ZWx5Lg0KY29udHJhY3QgQWJzdHJhY3RTYWxlIHsNCiAgZnVuY3Rpb24gc2FsZUZpbmFsaXplZCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOw0KfQ0KDQpjb250cmFjdCBFc2Nyb3cgaXMgSGFzTm9Ub2tlbnMgew0KDQogIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5Ow0KICB1aW50IHB1YmxpYyBmaW5hbEJsb2NrOw0KICBBYnN0cmFjdFNhbGUgcHVibGljIHRva2VuU2FsZTsNCg0KICAvLyBAZGV2IENvbnN0cnVjdG9yIGluaXRpYWxpemVzIHB1YmxpYyB2YXJpYWJsZXMNCiAgLy8gQHBhcmFtIF9iZW5lZmljaWFyeSBUaGUgYWRkcmVzcyBvZiB0aGUgbXVsdGlzaWcgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIGZ1bmRzDQogIC8vIEBwYXJhbSBfZmluYWxCbG9jayBCbG9jayBhZnRlciB3aGljaCB0aGUgYmVuZWZpY2lhcnkgY2FuIHJlcXVlc3QgdGhlIGZ1bmRzDQogIGZ1bmN0aW9uIEVzY3JvdyhhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfZmluYWxCbG9jaywgYWRkcmVzcyBfdG9rZW5TYWxlKSB7DQogICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7DQogICAgZmluYWxCbG9jayA9IF9maW5hbEJsb2NrOw0KICAgIHRva2VuU2FsZSA9IEFic3RyYWN0U2FsZShfdG9rZW5TYWxlKTsNCiAgfQ0KDQogIC8vIEBkZXYgUmVjZWl2ZSBhbGwgc2VudCBmdW5kcyB3aXRob3V0IGFueSBmdXJ0aGVyIGxvZ2ljDQogIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUge30NCg0KICAvLyBAZGV2IFdpdGhkcmF3IGZ1bmN0aW9uIHNlbmRzIGFsbCB0aGUgZnVuZHMgdG8gdGhlIHdhbGxldCBpZiBjb25kaXRpb25zIGFyZSBjb3JyZWN0DQogIGZ1bmN0aW9uIHdpdGhkcmF3KCkgcHVibGljIHsNCiAgICBpZiAobXNnLnNlbmRlciAhPSBiZW5lZmljaWFyeSkgdGhyb3c7DQogICAgaWYgKGJsb2NrLm51bWJlciA+IGZpbmFsQmxvY2spIHJldHVybiBkb1dpdGhkcmF3KCk7DQogICAgaWYgKHRva2VuU2FsZS5zYWxlRmluYWxpemVkKCkpIHJldHVybiBkb1dpdGhkcmF3KCk7DQogIH0NCg0KICBmdW5jdGlvbiBkb1dpdGhkcmF3KCkgaW50ZXJuYWwgew0KICAgIGlmICghYmVuZWZpY2lhcnkuc2VuZCh0aGlzLmJhbGFuY2UpKSB0aHJvdzsNCiAgfQ0KfQ0KDQovKioNCiAqIEB0aXRsZSBCYXNpYyB0b2tlbg0KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4NCiAqLw0KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsNCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7DQoNCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsNCg0KICAvKioNCiAgICogQGRldiBGaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjay4NCiAgICovDQogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsNCiAgICAgaWYobXNnLmRhdGEubGVuZ3RoIDwgc2l6ZSArIDQpIHsNCiAgICAgICB0aHJvdzsNCiAgICAgfQ0KICAgICBfOw0KICB9DQoNCiAgLyoqDQogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcw0KICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uDQogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLg0KICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHsNCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOw0KICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuDQogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuDQogICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4NCiAgKi8NCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsNCiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgfQ0KfQ0KDQovKioNCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UNCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQovKioNCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbg0KICoNCiAqIEBkZXYgSW1wbGVtYW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJ0IHRva2VuLg0KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wNCiAqLw0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBCYXNpY1Rva2VuLCBFUkMyMCB7DQoNCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOw0KDQogIC8qKg0KICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXINCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQ0KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8NCiAgICogQHBhcmFtIF92YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZA0KICAgKi8NCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgew0KICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07DQogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7DQogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOw0KICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsNCiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVhaGxmIG9mIG1zZy5zZW5kZXIuDQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4NCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4NCiAgICovDQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHsNCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYA0KICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90DQogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6DQogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5DQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsNCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYW4gYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuDQogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4NCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuDQogICAqIEByZXR1cm4gQSB1aW50IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpYmxlIGZvciB0aGUgc3BlbmRlci4NCiAgICovDQogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsNCiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgfQ0KfQ0KDQovKioNCiAqIENvbnRyb2xsZWQNCiAqLw0KY29udHJhY3QgQ29udHJvbGxlZCB7DQoNCiAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsNCg0KICBmdW5jdGlvbiBDb250cm9sbGVkKCkgew0KICAgIGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyOw0KICB9DQoNCiAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIF9jb250cm9sbGVyKSBvbmx5Q29udHJvbGxlciB7DQogICAgY29udHJvbGxlciA9IF9jb250cm9sbGVyOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHRocm93Ow0KICAgIF87DQogIH0NCn0NCg0KLyoqDQogKiBAdGl0bGUgTWludGFibGUgdG9rZW4NCiAqIEBkZXYgU2ltcGxlIEVSQzIwIFRva2VuIGV4YW1wbGUsIHdpdGggbWludGFibGUgdG9rZW4gY3JlYXRpb24NCiAqLw0KY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBDb250cm9sbGVkIHsNCg0KICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOw0KDQogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOw0KICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseSA9IDA7DQoNCiAgLyoqDQogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMNCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjaWV2ZSB0aGUgbWludGVkIHRva2Vucy4NCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4NCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4NCiAgICovDQogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgb25seUNvbnRyb2xsZXIgY2FuTWludCByZXR1cm5zIChib29sKSB7DQogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7DQogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOw0KICAgIE1pbnQoX3RvLCBfYW1vdW50KTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IEZ1bmN0aW9uIHRvIHN0b3AgbWludGluZyBuZXcgdG9rZW5zLg0KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4NCiAgICovDQogIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7DQogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsNCiAgICBNaW50RmluaXNoZWQoKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIG1vZGlmaWVyIGNhbk1pbnQoKSB7DQogICAgaWYgKG1pbnRpbmdGaW5pc2hlZCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KfQ0KDQovKioNCiAqIEB0aXRsZSBMaW1pdGVkVHJhbnNmZXJUb2tlbg0KICogQGRldiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBkZWZpbmVzIHRoZSBnZW5lcmljIGludGVyZmFjZSBhbmQgdGhlIGltcGxlbWVudGF0aW9uIHRvIGxpbWl0IHRva2VuDQogKiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGRpZmZlcmVudCBldmVudHMuIEl0IGlzIGludGVuZGVkIHRvIGJlIHVzZWQgYXMgYSBiYXNlIGNsYXNzIGZvciBvdGhlciB0b2tlbg0KICogY29udHJhY3RzLg0KICogTGltaXRlZFRyYW5zZmVyVG9rZW4gaGFzIGJlZW4gZGVzaWduZWQgdG8gYWxsb3cgZm9yIGRpZmZlcmVudCBsaW1pdGluZyBmYWN0b3JzLA0KICogdGhpcyBjYW4gYmUgYWNoaWV2ZWQgYnkgcmVjdXJzaXZlbHkgY2FsbGluZyBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoKSB1bnRpbCB0aGUgYmFzZSBjbGFzcyBpcw0KICogaGl0LiBGb3IgZXhhbXBsZToNCiAqICAgICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1Nikgew0KICogICAgICAgcmV0dXJuIG1pbjI1Nih1bmxvY2tlZFRva2Vucywgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOw0KICogICAgIH0NCiAqIEEgd29ya2luZyBleGFtcGxlIGlzIFZlc3RlZFRva2VuLnNvbDoNCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvYmxvYi9tYXN0ZXIvY29udHJhY3RzL3Rva2VuL1Zlc3RlZFRva2VuLnNvbA0KICovDQpjb250cmFjdCBMaW1pdGVkVHJhbnNmZXJUb2tlbiBpcyBFUkMyMCB7DQoNCiAgLyoqDQogICAqIEBkZXYgQ2hlY2tzIHdoZXRoZXIgaXQgY2FuIHRyYW5zZmVyIG9yIG90aGVyd2lzZSB0aHJvd3MuDQogICAqLw0KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIsIHVpbnQgX3ZhbHVlKSB7DQogICBpZiAoX3ZhbHVlID4gdHJhbnNmZXJhYmxlVG9rZW5zKF9zZW5kZXIsIHVpbnQ2NChub3cpKSkgdGhyb3c7DQogICBfOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLg0KICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSB0b2tlbnMuDQogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuDQogICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIsIF92YWx1ZSkgew0KICAgIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLg0KICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgc2VuZCB0aGUgdG9rZW5zLg0KICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIHRva2Vucy4NCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLg0KICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKSB7DQogICAgc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBEZWZhdWx0IHRyYW5zZmVyYWJsZSB0b2tlbnMgZnVuY3Rpb24gcmV0dXJucyBhbGwgdG9rZW5zIGZvciBhIGhvbGRlciAobm8gbGltaXQpLg0KICAgKiBAZGV2IE92ZXJ3cml0aW5nIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGlzIHRoZSB3YXkgdG8gcHJvdmlkZSB0aGUNCiAgICogc3BlY2lmaWMgbG9naWMgZm9yIGxpbWl0aW5nIHRva2VuIHRyYW5zZmVyYWJpbGl0eSBmb3IgYSBob2xkZXIgb3ZlciB0aW1lLg0KICAgKi8NCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7DQogIH0NCn0NCg0KLyoqDQogKiBAdGl0bGUgVmVzdGVkIHRva2VuDQogKiBAZGV2IFRva2VucyB0aGF0IGNhbiBiZSB2ZXN0ZWQgZm9yIGEgZ3JvdXAgb2YgYWRkcmVzc2VzLg0KICovDQpjb250cmFjdCBWZXN0ZWRUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBMaW1pdGVkVHJhbnNmZXJUb2tlbiB7DQoNCiAgdWludDI1NiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTID0gMjA7DQoNCiAgc3RydWN0IFRva2VuR3JhbnQgew0KICAgIGFkZHJlc3MgZ3JhbnRlcjsgICAgIC8vIDIwIGJ5dGVzDQogICAgdWludDI1NiB2YWx1ZTsgICAgICAgLy8gMzIgYnl0ZXMNCiAgICB1aW50NjQgY2xpZmY7DQogICAgdWludDY0IHZlc3Rpbmc7DQogICAgdWludDY0IHN0YXJ0OyAgICAgICAgLy8gMyAqIDggPSAyNCBieXRlcw0KICAgIGJvb2wgcmV2b2thYmxlOw0KICAgIGJvb2wgYnVybnNPblJldm9rZTsgIC8vIDIgKiAxID0gMiBiaXRzPyBvciAyIGJ5dGVzPw0KICB9IC8vIHRvdGFsIDc4IGJ5dGVzID0gMyBzc3RvcmUgcGVyIG9wZXJhdGlvbiAoMzIgcGVyIHNzdG9yZSkNCg0KICBtYXBwaW5nIChhZGRyZXNzID0+IFRva2VuR3JhbnRbXSkgcHVibGljIGdyYW50czsNCg0KICBldmVudCBOZXdUb2tlbkdyYW50KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgZ3JhbnRJZCk7DQoNCiAgLyoqDQogICAqIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MNCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHRoZSB0b2tlbnMgd2lsbCBiZSBncmFudGVkIHRvLg0KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4NCiAgICogQHBhcmFtIF9zdGFydCB1aW50NjQgVGltZSBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudC4NCiAgICogQHBhcmFtIF9jbGlmZiB1aW50NjQgVGltZSBvZiB0aGUgY2xpZmYgcGVyaW9kLg0KICAgKiBAcGFyYW0gX3Zlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4NCiAgICogQHBhcmFtIF9yZXZva2FibGUgYm9vbCBJZiB0aGUgZ3JhbnQgaXMgcmV2b2thYmxlLg0KICAgKiBAcGFyYW0gX2J1cm5zT25SZXZva2UgYm9vbCBXaGVuIHRydWUsIHRoZSB0b2tlbnMgYXJlIGJ1cm5lZCBpZiByZXZva2VkLg0KICAgKi8NCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWRUb2tlbnMoDQogICAgYWRkcmVzcyBfdG8sDQogICAgdWludDI1NiBfdmFsdWUsDQogICAgdWludDY0IF9zdGFydCwNCiAgICB1aW50NjQgX2NsaWZmLA0KICAgIHVpbnQ2NCBfdmVzdGluZywNCiAgICBib29sIF9yZXZva2FibGUsDQogICAgYm9vbCBfYnVybnNPblJldm9rZQ0KICApIHB1YmxpYyB7DQoNCiAgICAvLyBDaGVjayBmb3IgZGF0ZSBpbmNvbnNpc3RlbmNpZXMgdGhhdCBtYXkgY2F1c2UgdW5leHBlY3RlZCBiZWhhdmlvcg0KICAgIGlmIChfY2xpZmYgPCBfc3RhcnQgfHwgX3Zlc3RpbmcgPCBfY2xpZmYpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGlmICh0b2tlbkdyYW50c0NvdW50KF90bykgPiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTKSB0aHJvdzsgIC8vIFRvIHByZXZlbnQgYSB1c2VyIGJlaW5nIHNwYW1tZWQgYW5kIGhhdmUgaGlzIGJhbGFuY2UgbG9ja2VkIChvdXQgb2YgZ2FzIGF0dGFjayB3aGVuIGNhbGN1bGF0aW5nIHZlc3RpbmcpLg0KDQogICAgdWludCBjb3VudCA9IGdyYW50c1tfdG9dLnB1c2goDQogICAgICAgICAgICAgICAgVG9rZW5HcmFudCgNCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUgPyBtc2cuc2VuZGVyIDogMCwgIC8vIGF2b2lkIHN0b3JpbmcgYW4gZXh0cmEgMjAgYnl0ZXMgd2hlbiBpdCBpcyBub24tcmV2b2thYmxlDQogICAgICAgICAgICAgICAgICBfdmFsdWUsDQogICAgICAgICAgICAgICAgICBfY2xpZmYsDQogICAgICAgICAgICAgICAgICBfdmVzdGluZywNCiAgICAgICAgICAgICAgICAgIF9zdGFydCwNCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUsDQogICAgICAgICAgICAgICAgICBfYnVybnNPblJldm9rZQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgKTsNCiAgICB0cmFuc2ZlcihfdG8sIF92YWx1ZSk7DQogICAgTmV3VG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgY291bnQgLSAxKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IFJldm9rZSB0aGUgZ3JhbnQgb2YgdG9rZW5zIG9mIGEgc3BlY2lmZWQgYWRkcmVzcy4NCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4NCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuDQogICAqLw0KICBmdW5jdGlvbiByZXZva2VUb2tlbkdyYW50KGFkZHJlc3MgX2hvbGRlciwgdWludCBfZ3JhbnRJZCkgcHVibGljIHsNCiAgICBUb2tlbkdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsNCg0KICAgIGlmICghZ3JhbnQucmV2b2thYmxlKSB7IC8vIENoZWNrIGlmIGdyYW50IHdhcyByZXZva2FibGUNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGlmIChncmFudC5ncmFudGVyICE9IG1zZy5zZW5kZXIpIHsgLy8gT25seSBncmFudGVyIGNhbiByZXZva2UgaXQNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGFkZHJlc3MgcmVjZWl2ZXIgPSBncmFudC5idXJuc09uUmV2b2tlID8gMHhkZWFkIDogbXNnLnNlbmRlcjsNCiAgICB1aW50MjU2IG5vblZlc3RlZCA9IG5vblZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOw0KDQogICAgLy8gcmVtb3ZlIGdyYW50IGZyb20gYXJyYXkNCiAgICBkZWxldGUgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsNCiAgICBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdID0gZ3JhbnRzW19ob2xkZXJdW2dyYW50c1tfaG9sZGVyXS5sZW5ndGguc3ViKDEpXTsNCiAgICBncmFudHNbX2hvbGRlcl0ubGVuZ3RoIC09IDE7DQoNCiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKG5vblZlc3RlZCk7DQogICAgYmFsYW5jZXNbX2hvbGRlcl0gPSBiYWxhbmNlc1tfaG9sZGVyXS5zdWIobm9uVmVzdGVkKTsNCg0KICAgIFRyYW5zZmVyKF9ob2xkZXIsIHJlY2VpdmVyLCBub25WZXN0ZWQpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2VucyBvZiBhIGhvbGRlciBhdCBhIGdpdmVuIHRpbWUNCiAgICogQHBhcmFtIGhvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXINCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSBzcGVjaWZpYyB0aW1lLg0KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1Nikgew0KICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsNCiAgICBpZiAoZ3JhbnRJbmRleCA9PSAwKSByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7IC8vIHNob3J0Y3V0IGZvciBob2xkZXIgd2l0aG91dCBncmFudHMNCg0KICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBhbGwgdGhlIGdyYW50cyB0aGUgaG9sZGVyIGhhcywgYW5kIGFkZCBhbGwgbm9uLXZlc3RlZCB0b2tlbnMNCiAgICB1aW50MjU2IG5vblZlc3RlZCA9IDA7DQogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7DQogICAgICBub25WZXN0ZWQgPSBub25WZXN0ZWQuYWRkKG5vblZlc3RlZFRva2VucyhncmFudHNbaG9sZGVyXVtpXSwgdGltZSkpOw0KICAgIH0NCg0KICAgIC8vIEJhbGFuY2UgLSB0b3RhbE5vblZlc3RlZCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhIGhvbGRlciBjYW4gdHJhbnNmZXIgYXQgYW55IGdpdmVuIHRpbWUNCiAgICB1aW50MjU2IHZlc3RlZFRyYW5zZmVyYWJsZSA9IGJhbGFuY2VPZihob2xkZXIpLnN1Yihub25WZXN0ZWQpOw0KDQogICAgLy8gUmV0dXJuIHRoZSBtaW5pbXVtIG9mIGhvdyBtYW55IHZlc3RlZCBjYW4gdHJhbnNmZXIgYW5kIG90aGVyIHZhbHVlDQogICAgLy8gaW4gY2FzZSB0aGVyZSBhcmUgb3RoZXIgbGltaXRpbmcgdHJhbnNmZXJhYmlsaXR5IGZhY3RvcnMgKGRlZmF1bHQgaXMgYmFsYW5jZU9mKQ0KICAgIHJldHVybiBTYWZlTWF0aC5taW4yNTYodmVzdGVkVHJhbnNmZXJhYmxlLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDaGVjayB0aGUgYW1vdW50IG9mIGdyYW50cyB0aGF0IGFuIGFkZHJlc3MgaGFzLg0KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgaG9sZGVyIG9mIHRoZSBncmFudHMuDQogICAqIEByZXR1cm4gQSB1aW50IHJlcHJlc2VudGluZyB0aGUgdG90YWwgYW1vdW50IG9mIGdyYW50cy4NCiAgICovDQogIGZ1bmN0aW9uIHRva2VuR3JhbnRzQ291bnQoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGluZGV4KSB7DQogICAgcmV0dXJuIGdyYW50c1tfaG9sZGVyXS5sZW5ndGg7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDYWxjdWxhdGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZjIHRpbWUuDQogICAqIEBwYXJhbSB0b2tlbnMgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyBncmFudHRlZC4NCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQNCiAgICogQHBhcmFtIHN0YXJ0IHVpbnQ2NCBBIHRpbWUgcmVwcmVzZW50aW5nIHRoZSBiZWdpbmluZyBvZiB0aGUgZ3JhbnQNCiAgICogQHBhcmFtIGNsaWZmIHVpbnQ2NCBUaGUgY2xpZmYgcGVyaW9kLg0KICAgKiBAcGFyYW0gdmVzdGluZyB1aW50NjQgVGhlIHZlc3RpbmcgcGVyaW9kLg0KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2Vuc29mIGEgc3BlY2lmIGdyYW50Lg0KICAgKiAgdHJhbnNmZXJhYmxlVG9rZW5zDQogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgdmVzdGVkVG9rZW5zIHJlY3QNCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICBfLw0KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICBfLw0KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgXy8NCiAgICogICB8ICAgICAgICAgICAgICAgICBfLw0KICAgKiAgIHwgICAgICAgICAgICAgICAgLw0KICAgKiAgIHwgICAgICAgICAgICAgIC58DQogICAqICAgfCAgICAgICAgICAgIC4gIHwNCiAgICogICB8ICAgICAgICAgIC4gICAgfA0KICAgKiAgIHwgICAgICAgIC4gICAgICB8DQogICAqICAgfCAgICAgIC4gICAgICAgIHwoZ3JhbnRzW19ob2xkZXJdID09IGFkZHJlc3MoMCkpIHJldHVybiAwOw0KICAgKiAgIHwgICAgLiAgICAgICAgICB8DQogICAqICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQ0KICAgKiAgICAgIFN0YXJ0ICAgICAgIENsaWZ0ICAgIFZlc3RpbmcNCiAgICovDQogIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucygNCiAgICB1aW50MjU2IHRva2VucywNCiAgICB1aW50MjU2IHRpbWUsDQogICAgdWludDI1NiBzdGFydCwNCiAgICB1aW50MjU2IGNsaWZmLA0KICAgIHVpbnQyNTYgdmVzdGluZykgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikNCiAgICB7DQogICAgICAvLyBTaG9ydGN1dHMgZm9yIGJlZm9yZSBjbGlmZiBhbmQgYWZ0ZXIgdmVzdGluZyBjYXNlcy4NCiAgICAgIGlmICh0aW1lIDwgY2xpZmYpIHJldHVybiAwOw0KICAgICAgaWYgKHRpbWUgPj0gdmVzdGluZykgcmV0dXJuIHRva2VuczsNCg0KICAgICAgLy8gSW50ZXJwb2xhdGUgYWxsIHZlc3RlZCB0b2tlbnMuDQogICAgICAvLyBBcyBiZWZvcmUgY2xpZmYgdGhlIHNob3J0Y3V0IHJldHVybnMgMCwgd2UgY2FuIHVzZSBqdXN0IGNhbGN1bGF0ZSBhIHZhbHVlDQogICAgICAvLyBpbiB0aGUgdmVzdGluZyByZWN0IChhcyBzaG93biBpbiBhYm92ZSdzIGZpZ3VyZSkNCg0KICAgICAgLy8gdmVzdGVkVG9rZW5zID0gdG9rZW5zICogKHRpbWUgLSBzdGFydCkgLyAodmVzdGluZyAtIHN0YXJ0KQ0KICAgICAgdWludDI1NiB2ZXN0ZWRUb2tlbnMgPSB0b2tlbnMubXVsKHRpbWUuc3ViKHN0YXJ0KSkuZGl2KHZlc3Rpbmcuc3ViKHN0YXJ0KSk7DQogICAgICByZXR1cm4gdmVzdGVkVG9rZW5zOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgR2V0IGFsbCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmMgZ3JhbnQuDQogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuDQogICAqIEBwYXJhbSBfZ3JhbnRJZCBUaGUgaWQgb2YgdGhlIHRva2VuIGdyYW50Lg0KICAgKiBAcmV0dXJuIFJldHVybnMgYWxsIHRoZSB2YWx1ZXMgdGhhdCByZXByZXNlbnQgYSBUb2tlbkdyYW50KGFkZHJlc3MsIHZhbHVlLCBzdGFydCwgY2xpZmYsDQogICAqIHJldm9rYWJpbGl0eSwgYnVybnNPblJldm9rZSwgYW5kIHZlc3RpbmcpIHBsdXMgdGhlIHZlc3RlZCB2YWx1ZSBhdCB0aGUgY3VycmVudCB0aW1lLg0KICAgKi8NCiAgZnVuY3Rpb24gdG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgZ3JhbnRlciwgdWludDI1NiB2YWx1ZSwgdWludDI1NiB2ZXN0ZWQsIHVpbnQ2NCBzdGFydCwgdWludDY0IGNsaWZmLCB1aW50NjQgdmVzdGluZywgYm9vbCByZXZva2FibGUsIGJvb2wgYnVybnNPblJldm9rZSkgew0KICAgIFRva2VuR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOw0KDQogICAgZ3JhbnRlciA9IGdyYW50LmdyYW50ZXI7DQogICAgdmFsdWUgPSBncmFudC52YWx1ZTsNCiAgICBzdGFydCA9IGdyYW50LnN0YXJ0Ow0KICAgIGNsaWZmID0gZ3JhbnQuY2xpZmY7DQogICAgdmVzdGluZyA9IGdyYW50LnZlc3Rpbmc7DQogICAgcmV2b2thYmxlID0gZ3JhbnQucmV2b2thYmxlOw0KICAgIGJ1cm5zT25SZXZva2UgPSBncmFudC5idXJuc09uUmV2b2tlOw0KDQogICAgdmVzdGVkID0gdmVzdGVkVG9rZW5zKGdyYW50LCB1aW50NjQobm93KSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBHZXQgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4NCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuDQogICAqIEBwYXJhbSB0aW1lIFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQNCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZpYyBncmFudCBhdCBhIHNwZWNpZmljIHRpbWUuDQogICAqLw0KICBmdW5jdGlvbiB2ZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoDQogICAgICBncmFudC52YWx1ZSwNCiAgICAgIHVpbnQyNTYodGltZSksDQogICAgICB1aW50MjU2KGdyYW50LnN0YXJ0KSwNCiAgICAgIHVpbnQyNTYoZ3JhbnQuY2xpZmYpLA0KICAgICAgdWludDI1NihncmFudC52ZXN0aW5nKQ0KICAgICk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuDQogICAqIEBwYXJhbSBncmFudCBUb2tlbkdyYW50IFRoZSBncmFudCB0byBiZSBjaGVja2VkLg0KICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZA0KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZjIGdyYW50IG9uIHRoZQ0KICAgKiBwYXNzZWQgdGltZSBmcmFtZS4NCiAgICovDQogIGZ1bmN0aW9uIG5vblZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGdyYW50LnZhbHVlLnN1Yih2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHRpbWUpKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgZGF0ZSB3aGVuIHRoZSBob2xkZXIgY2FuIHRyYXNmZXIgYWxsIGl0cyB0b2tlbnMNCiAgICogQHBhcmFtIGhvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXINCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCB0cmFuc2ZlcmFibGUgdG9rZW5zLg0KICAgKi8NCiAgZnVuY3Rpb24gbGFzdFRva2VuSXNUcmFuc2ZlcmFibGVEYXRlKGFkZHJlc3MgaG9sZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDY0IGRhdGUpIHsNCiAgICBkYXRlID0gdWludDY0KG5vdyk7DQogICAgdWludDI1NiBncmFudEluZGV4ID0gZ3JhbnRzW2hvbGRlcl0ubGVuZ3RoOw0KICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgew0KICAgICAgZGF0ZSA9IFNhZmVNYXRoLm1heDY0KGdyYW50c1tob2xkZXJdW2ldLnZlc3RpbmcsIGRhdGUpOw0KICAgIH0NCiAgfQ0KfQ0KDQovLy8gQHRpdGxlIEFydGNvaW4gKEFSVCkgLSBkZW1vY3JhdGl6aW5nIGN1bHR1cmUuDQpjb250cmFjdCBBcnRjb2luIGlzIE1pbnRhYmxlVG9rZW4sIFZlc3RlZFRva2VuIHsNCg0KICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAnQXJ0Y29pbic7DQogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gJ0FSVCc7DQogIHVpbnQgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7DQoNCiAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsNCiAgICAgIGlmICghQ29udHJvbGxlcihjb250cm9sbGVyKS5wcm94eVBheW1lbnQudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKSkgdGhyb3c7DQogICAgfSBlbHNlIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7DQogICAgdWludCBzaXplOw0KICAgIGlmIChfYWRkciA9PSBhZGRyZXNzKDApKSByZXR1cm4gZmFsc2U7DQogICAgYXNzZW1ibHkgew0KICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikNCiAgICB9DQogICAgcmV0dXJuIHNpemUgPiAwOw0KICB9DQp9DQoNCi8vLyBAdGl0bGUgQXJ0Y29pbiBQbGFjZWhvbGRlciAtIGRlbW9jcmF0aXppbmcgY3VsdHVyZS4NCmNvbnRyYWN0IEFydGNvaW5QbGFjZWhvbGRlciBpcyBDb250cm9sbGVyIHsNCg0KICBBcnRjb2luIHB1YmxpYyB0b2tlbjsNCiAgYWRkcmVzcyBwdWJsaWMgdG9rZW5TYWxlOw0KDQogIGZ1bmN0aW9uIEFydGNvaW5QbGFjZWhvbGRlcihhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfdG9rZW5TYWxlKSB7DQogICAgdG9rZW4gPSBBcnRjb2luKF90b2tlbik7DQogICAgdG9rZW5TYWxlID0gX3Rva2VuU2FsZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBjb25zb3J0aXVtKSBwdWJsaWMgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IHRva2VuU2FsZSkgdGhyb3c7DQogICAgdG9rZW4uY2hhbmdlQ29udHJvbGxlcihjb25zb3J0aXVtKTsNCiAgICBzdWljaWRlKGNvbnNvcnRpdW0pOw0KICB9DQoNCiAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgdGhyb3c7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQoNCiAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCn0NCg0KLy8vIEB0aXRsZSBBUlQgU2FsZSAtIGRlbW9jcmF0aXppbmcgY3VsdHVyZS4NCmNvbnRyYWN0IEFydFNhbGUgaXMgQ29udHJvbGxlciB7DQogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50Ow0KDQogIGFkZHJlc3MgcHVibGljIG1hbmFnZXI7DQogIGFkZHJlc3MgcHVibGljIG9wZXJhdGlvbnM7DQogIEFydGNvaW5QbGFjZWhvbGRlciBwdWJsaWMgY29uc29ydGl1bVBsYWNlaG9sZGVyOw0KDQogIEFydGNvaW4gcHVibGljIHRva2VuOw0KICBFc2Nyb3cgcHVibGljIGVzY3JvdzsNCg0KICB1aW50IHB1YmxpYyBpbml0aWFsQmxvY2s7ICAvLyBibG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIHNhbGUgc3RhcnRzLCBpbmNsdXNpdmUuIHNhbGUgd2lsbCBiZSBvcGVuZWQgYXQgaW5pdGlhbCBibG9jay4NCiAgdWludCBwdWJsaWMgZmluYWxCbG9jazsgIC8vIGJsb2NrIG51bWJlciBpbiB3aGljaCB0aGUgc2FsZSBlbmRzLCBleGNsdXNpdmUsIHNhbGUgd2lsbCBiZSBjbG9zZWQgYXQgZW5kcyBibG9jay4NCiAgdWludCBwdWJsaWMgaW5pdGlhbFByaWNlOyAgLy8gbnVtYmVyIG9mIHdlaS1BcnRjb2luIHRva2VucyBmb3IgMSB3ZWksIGF0IHRoZSBzdGFydCBvZiB0aGUgc2FsZSAoMTggZGVjaW1hbHMpDQogIHVpbnQgcHVibGljIGZpbmFsUHJpY2U7ICAvLyBudW1iZXIgb2Ygd2VpLUFydGNvaW4gdG9rZW5zIGZvciAxIHdlaSwgYXQgdGhlIGVuZCBvZiB0aGUgc2FsZQ0KICB1aW50IHB1YmxpYyBwcmljZVN0YWdlczsgIC8vIG51bWJlciBvZiBkaWZmZXJlbnQgcHJpY2Ugc3RhZ2VzIGZvciBpbnRlcnBvbGF0aW5nIGJldHdlZW4gaW5pdGlhbFByaWNlIGFuZCBmaW5hbFByaWNlDQoNCiAgdWludCBwdWJsaWMgbWF4aW11bVN1YnNjcmlwdGlvbjsgIC8vIG1heGltdW0gc3Vic2NyaXB0aW9ucywgaW4gd2VpDQogIHVpbnQgcHVibGljIHRvdGFsU3Vic2NyaXB0aW9uID0gMDsgIC8vIHRvdGFsIHN1YnNjcmlwdGlvbnMsIGluIHdlaQ0KDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGFjdGl2YXRpb25zOyAgLy8gY29uZmlybWF0aW9ucyB0byBhY3RpdmF0ZSB0aGUgc2FsZQ0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBzdWJzY3JpcHRpb25zOyAgLy8gc3Vic2NyaXB0aW9ucw0KDQogIHVpbnQgY29uc3RhbnQgcHVibGljIGR1c3QgPSAxIGZpbm5leTsgIC8vIG1pbmltdW0gaW52ZXN0bWVudA0KDQogIGJvb2wgcHVibGljIHNhbGVTdG9wcGVkID0gZmFsc2U7DQogIGJvb2wgcHVibGljIHNhbGVGaW5hbGl6ZWQgPSBmYWxzZTsNCg0KICBldmVudCBOZXdQcmVzYWxlQWxsb2NhdGlvbihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyLCB1aW50IGFtb3VudCk7DQogIGV2ZW50IE5ld1N1YnNjcmlwdGlvbihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyLCB1aW50IGFtb3VudCwgdWludCBldGhlckFtb3VudCk7DQoNCiAgZnVuY3Rpb24gQXJ0U2FsZShhZGRyZXNzIF9tYW5hZ2VyLA0KICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX29wZXJhdGlvbnMsDQogICAgICAgICAgICAgICAgICAgdWludCBfaW5pdGlhbEJsb2NrLA0KICAgICAgICAgICAgICAgICAgIHVpbnQgX2ZpbmFsQmxvY2ssDQogICAgICAgICAgICAgICAgICAgdWludDI1NiBfaW5pdGlhbFByaWNlLA0KICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX2ZpbmFsUHJpY2UsDQogICAgICAgICAgICAgICAgICAgdWludDggX3ByaWNlU3RhZ2VzLA0KICAgICAgICAgICAgICAgICAgIHVpbnQgX21heGltdW1TdWJzY3JpcHRpb24pDQogICAgICAgICAgICAgICAgICAgbm9uWmVyb0FkZHJlc3MoX29wZXJhdGlvbnMpIHsNCiAgICBpZiAoX2luaXRpYWxCbG9jayA8IGdldEJsb2NrTnVtYmVyKCkpIHRocm93Ow0KICAgIGlmIChfaW5pdGlhbEJsb2NrID49IF9maW5hbEJsb2NrKSB0aHJvdzsNCiAgICBpZiAoX2luaXRpYWxQcmljZSA8PSBfZmluYWxQcmljZSkgdGhyb3c7DQogICAgaWYgKF9wcmljZVN0YWdlcyA8IDIpIHRocm93Ow0KICAgIGlmIChfcHJpY2VTdGFnZXMgPiBfaW5pdGlhbFByaWNlIC0gX2ZpbmFsUHJpY2UpIHRocm93Ow0KDQogICAgbWFuYWdlciA9IF9tYW5hZ2VyOw0KICAgIG9wZXJhdGlvbnMgPSBfb3BlcmF0aW9uczsNCiAgICBtYXhpbXVtU3Vic2NyaXB0aW9uID0gX21heGltdW1TdWJzY3JpcHRpb247DQogICAgaW5pdGlhbEJsb2NrID0gX2luaXRpYWxCbG9jazsNCiAgICBmaW5hbEJsb2NrID0gX2ZpbmFsQmxvY2s7DQogICAgaW5pdGlhbFByaWNlID0gX2luaXRpYWxQcmljZTsNCiAgICBmaW5hbFByaWNlID0gX2ZpbmFsUHJpY2U7DQogICAgcHJpY2VTdGFnZXMgPSBfcHJpY2VTdGFnZXM7DQogIH0NCg0KICAvLyBAbm90aWNlIFNldCBBcnRjb2luIHRva2VuIGFuZCBlc2Nyb3cgYWRkcmVzcy4NCiAgLy8gQHBhcmFtIF90b2tlbjogQWRkcmVzcyBvZiBhbiBpbnN0YW5jZSBvZiB0aGUgQXJ0Y29pbiB0b2tlbg0KICAvLyBAcGFyYW0gX2NvbnNvcnRpdW1QbGFjZWhvbGRlcjogQWRkcmVzcyBvZiB0aGUgY29uc29ydGl1bSBwbGFjZWhvbGRlcg0KICAvLyBAcGFyYW0gX2VzY3JvdzogQWRkcmVzcyBvZiB0aGUgd2FsbGV0IHJlY2VpdmluZyB0aGUgZnVuZHMgb2YgdGhlIHNhbGUNCiAgZnVuY3Rpb24gc2V0QXJ0Y29pbihhZGRyZXNzIF90b2tlbiwNCiAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9jb25zb3J0aXVtUGxhY2Vob2xkZXIsDQogICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfZXNjcm93KQ0KICAgICAgICAgICAgICAgICAgICAgIG5vblplcm9BZGRyZXNzKF90b2tlbikNCiAgICAgICAgICAgICAgICAgICAgICBub25aZXJvQWRkcmVzcyhfY29uc29ydGl1bVBsYWNlaG9sZGVyKQ0KICAgICAgICAgICAgICAgICAgICAgIG5vblplcm9BZGRyZXNzKF9lc2Nyb3cpDQogICAgICAgICAgICAgICAgICAgICAgcHVibGljIHsNCiAgICBpZiAoYWN0aXZhdGlvbnNbdGhpc10pIHRocm93Ow0KDQogICAgdG9rZW4gPSBBcnRjb2luKF90b2tlbik7DQogICAgY29uc29ydGl1bVBsYWNlaG9sZGVyID0gQXJ0Y29pblBsYWNlaG9sZGVyKF9jb25zb3J0aXVtUGxhY2Vob2xkZXIpOw0KICAgIGVzY3JvdyA9IEVzY3JvdyhfZXNjcm93KTsNCg0KICAgIGlmICh0b2tlbi5jb250cm9sbGVyKCkgIT0gYWRkcmVzcyh0aGlzKSkgdGhyb3c7ICAvLyBzYWxlIGlzIHRva2VuIGNvbnRyb2xsZXINCiAgICBpZiAodG9rZW4udG90YWxTdXBwbHkoKSA+IDApIHRocm93OyAgLy8gdG9rZW4gaXMgZW1wdHkNCiAgICBpZiAoY29uc29ydGl1bVBsYWNlaG9sZGVyLnRva2VuU2FsZSgpICE9IGFkZHJlc3ModGhpcykpIHRocm93OyAgLy8gcGxhY2Vob2xkZXIgaGFzIHJlZmVyZW5jZSB0byBzYWxlDQogICAgaWYgKGNvbnNvcnRpdW1QbGFjZWhvbGRlci50b2tlbigpICE9IGFkZHJlc3ModG9rZW4pKSB0aHJvdzsgLy8gcGxhY2Vob2xkZXIgaGFzIHJlZmVyZW5jZSB0byBBUlQNCiAgICBpZiAoZXNjcm93LmZpbmFsQmxvY2soKSAhPSBmaW5hbEJsb2NrKSB0aHJvdzsgIC8vIGZpbmFsIGJsb2NrcyBtdXN0IG1hdGNoDQogICAgaWYgKGVzY3Jvdy5iZW5lZmljaWFyeSgpICE9IG9wZXJhdGlvbnMpIHRocm93OyAgLy8gcmVjZWl2aW5nIHdhbGxldCBtdXN0IG1hdGNoDQogICAgaWYgKGVzY3Jvdy50b2tlblNhbGUoKSAhPSBhZGRyZXNzKHRoaXMpKSB0aHJvdzsgIC8vIHdhdGNoZWQgdG9rZW4gc2FsZSBtdXN0IGJlIHNlbGYNCg0KICAgIGRvQWN0aXZhdGVTYWxlKHRoaXMpOw0KICB9DQoNCiAgLy8gQG5vdGljZSBDZXJ0YWluIGFkZHJlc3NlcyBuZWVkIHRvIGNhbGwgdGhlIGFjdGl2YXRlIGZ1bmN0aW9uIHByaW9yIHRvIHRoZSBzYWxlIG9wZW5pbmcgYmxvY2suDQogIC8vIFRoaXMgcHJvdmVzIHRoYXQgdGhleSBoYXZlIGNoZWNrZWQgdGhlIHNhbGUgY29udHJhY3QgaXMgbGVnaXQsIGFzIHdlbGwgYXMgcHJvdmluZw0KICAvLyB0aGUgY2FwYWJpbGl0eSBmb3IgdGhvc2UgYWRkcmVzc2VzIHRvIGludGVyYWN0IHdpdGggdGhlIGNvbnRyYWN0Lg0KICBmdW5jdGlvbiBhY3RpdmF0ZVNhbGUoKSBwdWJsaWMgew0KICAgIGRvQWN0aXZhdGVTYWxlKG1zZy5zZW5kZXIpOw0KICB9DQoNCiAgZnVuY3Rpb24gZG9BY3RpdmF0ZVNhbGUoYWRkcmVzcyBfZW50aXR5KSBub25aZXJvQWRkcmVzcyh0b2tlbikgb25seUJlZm9yZVNhbGUgcHJpdmF0ZSB7DQogICAgYWN0aXZhdGlvbnNbX2VudGl0eV0gPSB0cnVlOw0KICB9DQoNCiAgLy8gQG5vdGljZSBXaGV0aGVyIHRoZSBuZWVkZWQgYWNjb3VudHMgaGF2ZSBhY3RpdmF0ZWQgdGhlIHNhbGUuDQogIC8vIEByZXR1cm4gSXMgc2FsZSBhY3RpdmF0ZWQNCiAgZnVuY3Rpb24gaXNBY3RpdmF0ZWQoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiBhY3RpdmF0aW9uc1t0aGlzXSAmJiBhY3RpdmF0aW9uc1tvcGVyYXRpb25zXTsNCiAgfQ0KDQogIC8vIEBub3RpY2UgR2V0IHRoZSBwcmljZSBmb3IgYSBBcnRjb2luIHRva2VuIGF0IGFueSBnaXZlbiBibG9jayBudW1iZXINCiAgLy8gQHBhcmFtIF9ibG9ja051bWJlciB0aGUgYmxvY2sgZm9yIHdoaWNoIHRoZSBwcmljZSBpcyByZXF1ZXN0ZWQNCiAgLy8gQHJldHVybiBOdW1iZXIgb2Ygd2VpLUFydGNvaW4gZm9yIDEgd2VpDQogIC8vIElmIHNhbGUgaXNuJ3Qgb25nb2luZyBmb3IgdGhhdCBibG9jaywgcmV0dXJucyAwLg0KICBmdW5jdGlvbiBnZXRQcmljZSh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIHsNCiAgICBpZiAoX2Jsb2NrTnVtYmVyIDwgaW5pdGlhbEJsb2NrIHx8IF9ibG9ja051bWJlciA+PSBmaW5hbEJsb2NrKSByZXR1cm4gMDsNCiAgICByZXR1cm4gcHJpY2VGb3JTdGFnZShzdGFnZUZvckJsb2NrKF9ibG9ja051bWJlcikpOw0KICB9DQoNCiAgLy8gQG5vdGljZSBHZXQgd2hhdCB0aGUgc3RhZ2UgaXMgZm9yIGEgZ2l2ZW4gYmxvY2tOdW1iZXINCiAgLy8gQHBhcmFtIF9ibG9ja051bWJlcjogQmxvY2sgbnVtYmVyDQogIC8vIEByZXR1cm4gVGhlIHNhbGUgc3RhZ2UgZm9yIHRoYXQgYmxvY2suIFN0YWdlIGlzIGJldHdlZW4gMCBhbmQgKHByaWNlU3RhZ2VzIC0gMSkNCiAgZnVuY3Rpb24gc3RhZ2VGb3JCbG9jayh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYmxvY2tOID0gX2Jsb2NrTnVtYmVyLnN1Yihpbml0aWFsQmxvY2spOw0KICAgIHVpbnQgdG90YWxCbG9ja3MgPSBmaW5hbEJsb2NrLnN1Yihpbml0aWFsQmxvY2spOw0KICAgIHJldHVybiBwcmljZVN0YWdlcy5tdWwoYmxvY2tOKS5kaXYodG90YWxCbG9ja3MpOw0KICB9DQoNCiAgLy8gQG5vdGljZSBHZXQgd2hhdCB0aGUgcHJpY2UgaXMgZm9yIGEgZ2l2ZW4gc3RhZ2UNCiAgLy8gQHBhcmFtIF9zdGFnZTogU3RhZ2UgbnVtYmVyDQogIC8vIEByZXR1cm4gUHJpY2UgaW4gd2VpIGZvciB0aGF0IHN0YWdlLg0KICAvLyBJZiBzYWxlIHN0YWdlIGRvZXNuJ3QgZXhpc3QsIHJldHVybnMgMC4NCiAgZnVuY3Rpb24gcHJpY2VGb3JTdGFnZSh1aW50IF9zdGFnZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIGlmIChfc3RhZ2UgPj0gcHJpY2VTdGFnZXMpIHJldHVybiAwOw0KICAgIHVpbnQgcHJpY2VEaWZmZXJlbmNlID0gaW5pdGlhbFByaWNlLnN1YihmaW5hbFByaWNlKTsNCiAgICB1aW50IHN0YWdlRGVsdGEgPSBwcmljZURpZmZlcmVuY2UuZGl2KHVpbnQocHJpY2VTdGFnZXMgLSAxKSk7DQogICAgcmV0dXJuIGluaXRpYWxQcmljZS5zdWIodWludChfc3RhZ2UpLm11bChzdGFnZURlbHRhKSk7DQogIH0NCg0KICAvLyBAbm90aWNlIEFydGNvaW4gbmVlZHMgdG8gbWFrZSBpbml0aWFsIHRva2VuIGFsbG9jYXRpb25zIGZvciBwcmVzYWxlIHBhcnRuZXJzDQogIC8vIFRoaXMgYWxsb2NhdGlvbiBoYXMgdG8gYmUgbWFkZSBiZWZvcmUgdGhlIHNhbGUgaXMgYWN0aXZhdGVkLiBBY3RpdmF0aW5nIHRoZQ0KICAvLyBzYWxlIG1lYW5zIG5vIG1vcmUgYXJiaXRyYXJ5IGFsbG9jYXRpb25zIGFyZSBwb3NzaWJsZSBhbmQgZXhwcmVzc2VzIGNvbmZvcm1pdHkuDQogIC8vIEBwYXJhbSBfcmVjaXBpZW50OiBUaGUgcmVjZWl2ZXIgb2YgdGhlIHRva2Vucw0KICAvLyBAcGFyYW0gX2Ftb3VudDogQW1vdW50IG9mIHRva2VucyBhbGxvY2F0ZWQgZm9yIHJlY2VpdmVyLg0KICBmdW5jdGlvbiBhbGxvY2F0ZVByZXNhbGVUb2tlbnMoYWRkcmVzcyBfcmVjaXBpZW50LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfYW1vdW50LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0IGNsaWZmRGF0ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NCB2ZXN0aW5nRGF0ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgcmV2b2thYmxlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBidXJuT25SZXZvY2F0aW9uKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUJlZm9yZVNhbGVBY3RpdmF0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5QmVmb3JlU2FsZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9uWmVyb0FkZHJlc3MoX3JlY2lwaWVudCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHkob3BlcmF0aW9ucykgcHVibGljIHsNCiAgICB0b2tlbi5ncmFudFZlc3RlZFRva2VucyhfcmVjaXBpZW50LCBfYW1vdW50LCB1aW50NjQobm93KSwgY2xpZmZEYXRlLCB2ZXN0aW5nRGF0ZSwgcmV2b2thYmxlLCBidXJuT25SZXZvY2F0aW9uKTsNCiAgICBOZXdQcmVzYWxlQWxsb2NhdGlvbihfcmVjaXBpZW50LCBfYW1vdW50KTsNCiAgfQ0KDQogIC8vLyBAZGV2IFRoZSBmYWxsYmFjayBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiBldGhlciBpcyBzZW50IHRvIHRoZSBjb250cmFjdCwgaXQNCiAgLy8vIHNpbXBseSBjYWxscyBgZG9QYXltZW50KClgIHdpdGggdGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciBhcyB0aGUNCiAgLy8vIGBfc3Vic2NyaWJlcmAuIFBheWFibGUgaXMgYSByZXF1aXJlZCBzb2xpZGl0eSBtb2RpZmllciBmb3IgZnVuY3Rpb25zIHRvIHJlY2VpdmUNCiAgLy8vIGV0aGVyLCB3aXRob3V0IHRoaXMgbW9kaWZpZXIgZnVuY3Rpb25zIHdpbGwgdGhyb3cgaWYgZXRoZXIgaXMgc2VudCB0byB0aGVtDQogIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgew0KICAgIHJldHVybiBkb1BheW1lbnQobXNnLnNlbmRlcik7DQogIH0NCg0KICAvLy8gQGRldiBgZG9QYXltZW50KClgIGlzIGFuIGludGVybmFsIGZ1bmN0aW9uIHRoYXQgc2VuZHMgdGhlIGV0aGVyIHRoYXQgdGhpcw0KICAvLy8gY29udHJhY3QgcmVjZWl2ZXMgdG8gZXNjcm93IGFuZCBjcmVhdGVzIHRva2VucyBpbiB0aGUgYWRkcmVzcyBvZiB0aGUNCiAgLy8vIEBwYXJhbSBfc3Vic2NyaWJlciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgbmV3bHkgY3JlYXRlZCB0b2tlbnMNCiAgZnVuY3Rpb24gZG9QYXltZW50KGFkZHJlc3MgX3N1YnNjcmliZXIpDQogICAgICAgICAgIG9ubHlEdXJpbmdTYWxlUGVyaW9kDQogICAgICAgICAgIG9ubHlTYWxlTm90U3RvcHBlZA0KICAgICAgICAgICBvbmx5U2FsZUFjdGl2YXRlZA0KICAgICAgICAgICBub25aZXJvQWRkcmVzcyhfc3Vic2NyaWJlcikNCiAgICAgICAgICAgbWluaW11bVZhbHVlKGR1c3QpIGludGVybmFsIHsNCiAgICBpZiAodG90YWxTdWJzY3JpcHRpb24gKyBtc2cudmFsdWUgPiBtYXhpbXVtU3Vic2NyaXB0aW9uKSB0aHJvdzsgIC8vIHRocm93IGlmIG1heGltdW0gc3Vic2NyaXB0aW9uIGV4Y2VlZGVkDQogICAgdWludCBwdXJjaGFzZWRUb2tlbnMgPSBtc2cudmFsdWUubXVsKGdldFByaWNlKGdldEJsb2NrTnVtYmVyKCkpKTsgIC8vIG51bWJlciBvZiBwdXJjaGFzZWQgdG9rZW5zDQoNCiAgICBpZiAoIWVzY3Jvdy5zZW5kKG1zZy52YWx1ZSkpIHRocm93OyAgLy8gZXNjcm93IGZ1bmRzDQogICAgaWYgKCF0b2tlbi5taW50KF9zdWJzY3JpYmVyLCBwdXJjaGFzZWRUb2tlbnMpKSB0aHJvdzsgIC8vIGRlbGl2ZXIgdG9rZW5zDQoNCiAgICBzdWJzY3JpcHRpb25zW19zdWJzY3JpYmVyXSA9IHN1YnNjcmlwdGlvbnNbX3N1YnNjcmliZXJdLmFkZChtc2cudmFsdWUpOw0KICAgIHRvdGFsU3Vic2NyaXB0aW9uID0gdG90YWxTdWJzY3JpcHRpb24uYWRkKG1zZy52YWx1ZSk7DQogICAgTmV3U3Vic2NyaXB0aW9uKF9zdWJzY3JpYmVyLCBwdXJjaGFzZWRUb2tlbnMsIG1zZy52YWx1ZSk7DQogIH0NCg0KICAvLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHN0b3Agc2FsZSBiZWZvcmUgdGhlIHNhbGUgcGVyaW9kIGVuZHMNCiAgLy8gQGRldiBPbmx5IG9wZXJhdGlvbnMgaXMgYXV0aG9yaXplZCB0byBjYWxsIHRoaXMgbWV0aG9kDQogIGZ1bmN0aW9uIHN0b3BTYWxlKCkgb25seVNhbGVBY3RpdmF0ZWQgb25seVNhbGVOb3RTdG9wcGVkIG9ubHkob3BlcmF0aW9ucykgcHVibGljIHsNCiAgICBzYWxlU3RvcHBlZCA9IHRydWU7DQogIH0NCg0KICAvLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHJlc3RhcnQgc3RvcHBlZCBzYWxlDQogIC8vIEBkZXYgT25seSBvcGVyYXRpb25zIGlzIGF1dGhvcml6ZWQgdG8gY2FsbCB0aGlzIG1ldGhvZA0KICBmdW5jdGlvbiByZXN0YXJ0U2FsZSgpIG9ubHlEdXJpbmdTYWxlUGVyaW9kIG9ubHlTYWxlU3RvcHBlZCBvbmx5KG9wZXJhdGlvbnMpIHB1YmxpYyB7DQogICAgc2FsZVN0b3BwZWQgPSBmYWxzZTsNCiAgfQ0KDQogIC8vIEBub3RpY2UgRmluYWxpemVzIHNhbGUgYW5kIGRpc3RyaWJ1dGVzIEFydGNvaW4gdG8gcHVyY2hhc2VycyBhbmQgcmVsZWFzZXMgcGF5bWVudHMNCiAgLy8gQGRldiBUcmFuc2ZlcnMgdGhlIHRva2VuIGNvbnRyb2xsZXIgcG93ZXIgdG8gdGhlIGNvbnNvcnRpdW0uDQogIGZ1bmN0aW9uIGZpbmFsaXplU2FsZSgpIG9ubHlBZnRlclNhbGUgb25seShvcGVyYXRpb25zKSBwdWJsaWMgew0KICAgIGRvRmluYWxpemVTYWxlKCk7DQogIH0NCg0KICBmdW5jdGlvbiBkb0ZpbmFsaXplU2FsZSgpIGludGVybmFsIHsNCiAgICB1aW50IHB1cmNoYXNlZFRva2VucyA9IHRva2VuLnRvdGFsU3VwcGx5KCk7DQoNCiAgICB1aW50IGFkdmlzb3JUb2tlbnMgPSBwdXJjaGFzZWRUb2tlbnMgKiA1IC8gMTAwOyAgLy8gbWludCA1JSBvZiBwdXJjaGFzZWQgZm9yIGFkdmlzb3JzDQogICAgaWYgKCF0b2tlbi5taW50KG9wZXJhdGlvbnMsIGFkdmlzb3JUb2tlbnMpKSB0aHJvdzsNCg0KICAgIHVpbnQgbWFuYWdlclRva2VucyA9IHB1cmNoYXNlZFRva2VucyAqIDI1IC8gMTAwOyAgLy8gbWludCAyNSUgb2YgcHVyY2hhc2VkIGZvciBtYW5hZ2VyDQogICAgaWYgKCF0b2tlbi5taW50KG1hbmFnZXIsIG1hbmFnZXJUb2tlbnMpKSB0aHJvdzsNCg0KICAgIHRva2VuLmNoYW5nZUNvbnRyb2xsZXIoY29uc29ydGl1bVBsYWNlaG9sZGVyKTsNCg0KICAgIHNhbGVGaW5hbGl6ZWQgPSB0cnVlOw0KICAgIHNhbGVTdG9wcGVkID0gdHJ1ZTsNCiAgfQ0KDQogIC8vIEBub3RpY2UgRGVwbG95IEFydGNvaW4gQ29uc29ydGl1bSBjb250cmFjdA0KICAvLyBAcGFyYW0gY29uc29ydGl1bTogVGhlIGFkZHJlc3MgdGhlIGNvbnNvcnRpdW0gd2FzIGRlcGxveWVkIGF0Lg0KICBmdW5jdGlvbiBkZXBsb3lDb25zb3J0aXVtKGFkZHJlc3MgY29uc29ydGl1bSkgb25seUZpbmFsaXplZFNhbGUgbm9uWmVyb0FkZHJlc3MoY29uc29ydGl1bSkgb25seShvcGVyYXRpb25zKSBwdWJsaWMgew0KICAgIGNvbnNvcnRpdW1QbGFjZWhvbGRlci5jaGFuZ2VDb250cm9sbGVyKGNvbnNvcnRpdW0pOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0T3BlcmF0aW9ucyhhZGRyZXNzIF9vcGVyYXRpb25zKSBub25aZXJvQWRkcmVzcyhfb3BlcmF0aW9ucykgb25seShvcGVyYXRpb25zKSBwdWJsaWMgew0KICAgIG9wZXJhdGlvbnMgPSBfb3BlcmF0aW9uczsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldEJsb2NrTnVtYmVyKCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHJldHVybiBibG9jay5udW1iZXI7DQogIH0NCg0KICBmdW5jdGlvbiBzYWxlRmluYWxpemVkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiBzYWxlRmluYWxpemVkOw0KICB9DQoNCiAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgZG9QYXltZW50KF9vd25lcik7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRyYW5zZmVyDQogIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXINCiAgLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2Zlcg0KICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXINCiAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2Zlcg0KICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgLy8gVW50aWwgdGhlIHNhbGUgaXMgZmluYWxpemVkLCBvbmx5IGFsbG93cyB0cmFuc2ZlcnMgb3JpZ2luYXRlZCBieSB0aGUgc2FsZSBjb250cmFjdC4NCiAgICAvLyBXaGVuIGZpbmFsaXplU2FsZSBpcyBjYWxsZWQsIHRoaXMgZnVuY3Rpb24gd2lsbCBzdG9wIGJlaW5nIGNhbGxlZCBhbmQgd2lsbCBhbHdheXMgYmUgdHJ1ZS4NCiAgICByZXR1cm4gX2Zyb20gPT0gYWRkcmVzcyh0aGlzKTsNCiAgfQ0KDQogIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsDQogIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWANCiAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsDQogIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHkoYWRkcmVzcyB4KSB7DQogICAgaWYgKG1zZy5zZW5kZXIgIT0geCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHlCZWZvcmVTYWxlIHsNCiAgICBpZiAoZ2V0QmxvY2tOdW1iZXIoKSA+PSBpbml0aWFsQmxvY2spIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5RHVyaW5nU2FsZVBlcmlvZCB7DQogICAgaWYgKGdldEJsb2NrTnVtYmVyKCkgPCBpbml0aWFsQmxvY2spIHRocm93Ow0KICAgIGlmIChnZXRCbG9ja051bWJlcigpID49IGZpbmFsQmxvY2spIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5QWZ0ZXJTYWxlIHsNCiAgICBpZiAoZ2V0QmxvY2tOdW1iZXIoKSA8IGZpbmFsQmxvY2spIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5U2FsZVN0b3BwZWQgew0KICAgIGlmICghc2FsZVN0b3BwZWQpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5U2FsZU5vdFN0b3BwZWQgew0KICAgIGlmIChzYWxlU3RvcHBlZCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHlCZWZvcmVTYWxlQWN0aXZhdGlvbiB7DQogICAgaWYgKGlzQWN0aXZhdGVkKCkpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5U2FsZUFjdGl2YXRlZCB7DQogICAgaWYgKCFpc0FjdGl2YXRlZCgpKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUZpbmFsaXplZFNhbGUgew0KICAgIGlmIChnZXRCbG9ja051bWJlcigpIDwgZmluYWxCbG9jaykgdGhyb3c7DQogICAgaWYgKCFzYWxlRmluYWxpemVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgbm9uWmVyb0FkZHJlc3MoYWRkcmVzcyB4KSB7DQogICAgaWYgKHggPT0gMCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIG1vZGlmaWVyIG1pbmltdW1WYWx1ZSh1aW50MjU2IHgpIHsNCiAgICBpZiAobXNnLnZhbHVlIDwgeCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KfQ=='