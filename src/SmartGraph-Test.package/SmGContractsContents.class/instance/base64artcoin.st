base 64 content
base64artcoin
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KY29udHJhY3QgQ29udHJvbGxlciB7DQoNCiAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdA0KICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMNCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZXRoZXIgaXMgYWNjZXB0ZWQsIGZhbHNlIGlmIGl0IHRocm93cw0KICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKSB7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQoNCiAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0b2tlbiB0cmFuc2ZlciBhbGxvd2luZyB0aGUNCiAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQNCiAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2Zlcg0KICAvLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyDQogIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2Zlcg0KICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyDQogIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcmV0dXJucyhib29sKSB7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQoNCiAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlDQogIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkDQogIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWANCiAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsDQogIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpIHsNCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCn0NCg0KLyoqDQogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzDQogKi8NCmxpYnJhcnkgU2FmZU1hdGggew0KDQogIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKiBiOw0KICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDANCiAgICB1aW50IGMgPSBhIC8gYjsNCiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZA0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSArIGI7DQogICAgYXNzZXJ0KGMgPj0gYSk7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgew0KICAgIGlmICghYXNzZXJ0aW9uKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogIH0NCn0NCg0KLyoqDQogKiBAdGl0bGUgRVJDMjBCYXNpYw0KICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlDQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqLw0KY29udHJhY3QgRVJDMjBCYXNpYyB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQp9DQoNCi8qKg0KICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQ0KICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKi8NCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgew0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7DQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7DQp9DQoNCi8qKg0KICogQHRpdGxlIEJhc2ljIHRva2VuDQogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLg0KICovDQpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgew0KICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsNCg0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOw0KDQogIC8qKg0KICAgKiBAZGV2IEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrLg0KICAgKi8NCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgew0KICAgICBpZihtc2cuZGF0YS5sZW5ndGggPCBzaXplICsgNCkgew0KICAgICAgIHRocm93Ow0KICAgICB9DQogICAgIF87DQogIH0NCg0KICAvKioNCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzDQogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4NCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuDQogICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgew0KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7DQogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7DQogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4NCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4NCiAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLg0KICAqLw0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgew0KICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOw0KICB9DQp9DQoNCg0KLyoqDQogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4NCiAqDQogKiBAZGV2IEltcGxlbWFudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFydCB0b2tlbi4NCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sDQogKi8NCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgQmFzaWNUb2tlbiwgRVJDMjAgew0KDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsNCg0KICAvKioNCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyDQogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20NCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvDQogICAqIEBwYXJhbSBfdmFsdWUgdWludCB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQNCiAgICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgzICogMzIpIHsNCiAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOw0KICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsNCiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7DQogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlYWhsZiBvZiBtc2cuc2VuZGVyLg0KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuDQogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuDQogICAqLw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB7DQogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2ANCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdA0KICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOg0KICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQ0KICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgdGhyb3c7DQogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLg0KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuDQogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLg0KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuDQogICAqLw0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7DQogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogIH0NCn0NCg0KY29udHJhY3QgQ29udHJvbGxlZCB7DQoNCiAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsNCg0KICBmdW5jdGlvbiBDb250cm9sbGVkKCkgew0KICAgIGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyOw0KICB9DQoNCiAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIF9jb250cm9sbGVyKSBvbmx5Q29udHJvbGxlciB7DQogICAgY29udHJvbGxlciA9IF9jb250cm9sbGVyOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHRocm93Ow0KICAgIF87DQogIH0NCn0NCg0KDQovKioNCiAqIEB0aXRsZSBNaW50YWJsZSB0b2tlbg0KICogQGRldiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBtaW50YWJsZSB0b2tlbiBjcmVhdGlvbg0KICovDQpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIENvbnRyb2xsZWQgew0KDQogIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgTWludEZpbmlzaGVkKCk7DQoNCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5ID0gMDsNCg0KICAvKioNCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2Vucw0KICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSBtaW50ZWQgdG9rZW5zLg0KICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50Lg0KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLg0KICAgKi8NCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBvbmx5Q29udHJvbGxlciBjYW5NaW50IHJldHVybnMgKGJvb2wpIHsNCiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsNCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7DQogICAgTWludChfdG8sIF9hbW91bnQpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuDQogICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLg0KICAgKi8NCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsNCiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOw0KICAgIE1pbnRGaW5pc2hlZCgpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgbW9kaWZpZXIgY2FuTWludCgpIHsNCiAgICBpZiAobWludGluZ0ZpbmlzaGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQp9DQoNCi8qKg0KICogQHRpdGxlIExpbWl0ZWRUcmFuc2ZlclRva2VuDQogKiBAZGV2IExpbWl0ZWRUcmFuc2ZlclRva2VuIGRlZmluZXMgdGhlIGdlbmVyaWMgaW50ZXJmYWNlIGFuZCB0aGUgaW1wbGVtZW50YXRpb24gdG8gbGltaXQgdG9rZW4NCiAqIHRyYW5zZmVyYWJpbGl0eSBmb3IgZGlmZmVyZW50IGV2ZW50cy4gSXQgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBhcyBhIGJhc2UgY2xhc3MgZm9yIG90aGVyIHRva2VuDQogKiBjb250cmFjdHMuDQogKiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBoYXMgYmVlbiBkZXNpZ25lZCB0byBhbGxvdyBmb3IgZGlmZmVyZW50IGxpbWl0aW5nIGZhY3RvcnMsDQogKiB0aGlzIGNhbiBiZSBhY2hpZXZlZCBieSByZWN1cnNpdmVseSBjYWxsaW5nIHN1cGVyLnRyYW5zZmVyYWJsZVRva2VucygpIHVudGlsIHRoZSBiYXNlIGNsYXNzIGlzDQogKiBoaXQuIEZvciBleGFtcGxlOg0KICogICAgIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7DQogKiAgICAgICByZXR1cm4gbWluMjU2KHVubG9ja2VkVG9rZW5zLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7DQogKiAgICAgfQ0KICogQSB3b3JraW5nIGV4YW1wbGUgaXMgVmVzdGVkVG9rZW4uc29sOg0KICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9ibG9iL21hc3Rlci9jb250cmFjdHMvdG9rZW4vVmVzdGVkVG9rZW4uc29sDQogKi8NCmNvbnRyYWN0IExpbWl0ZWRUcmFuc2ZlclRva2VuIGlzIEVSQzIwIHsNCg0KICAvKioNCiAgICogQGRldiBDaGVja3Mgd2hldGhlciBpdCBjYW4gdHJhbnNmZXIgb3Igb3RoZXJ3aXNlIHRocm93cy4NCiAgICovDQogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludCBfdmFsdWUpIHsNCiAgIGlmIChfdmFsdWUgPiB0cmFuc2ZlcmFibGVUb2tlbnMoX3NlbmRlciwgdWludDY0KG5vdykpKSB0aHJvdzsNCiAgIF87DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuDQogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIHRva2Vucy4NCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4NCiAgICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSB7DQogICAgc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICogQGRldiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuDQogICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzZW5kIHRoZSB0b2tlbnMuDQogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjaWV2ZSB0aGUgdG9rZW5zLg0KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuDQogICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKF9mcm9tLCBfdmFsdWUpIHsNCiAgICBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IERlZmF1bHQgdHJhbnNmZXJhYmxlIHRva2VucyBmdW5jdGlvbiByZXR1cm5zIGFsbCB0b2tlbnMgZm9yIGEgaG9sZGVyIChubyBsaW1pdCkuDQogICAqIEBkZXYgT3ZlcndyaXRpbmcgdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgaXMgdGhlIHdheSB0byBwcm92aWRlIHRoZQ0KICAgKiBzcGVjaWZpYyBsb2dpYyBmb3IgbGltaXRpbmcgdG9rZW4gdHJhbnNmZXJhYmlsaXR5IGZvciBhIGhvbGRlciBvdmVyIHRpbWUuDQogICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBiYWxhbmNlT2YoaG9sZGVyKTsNCiAgfQ0KfQ0KDQoNCi8qKg0KICogQHRpdGxlIFZlc3RlZCB0b2tlbg0KICogQGRldiBUb2tlbnMgdGhhdCBjYW4gYmUgdmVzdGVkIGZvciBhIGdyb3VwIG9mIGFkZHJlc3Nlcy4NCiAqLw0KY29udHJhY3QgVmVzdGVkVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgTGltaXRlZFRyYW5zZmVyVG9rZW4gew0KDQogIHVpbnQyNTYgTUFYX0dSQU5UU19QRVJfQUREUkVTUyA9IDIwOw0KDQogIHN0cnVjdCBUb2tlbkdyYW50IHsNCiAgICBhZGRyZXNzIGdyYW50ZXI7ICAgICAvLyAyMCBieXRlcw0KICAgIHVpbnQyNTYgdmFsdWU7ICAgICAgIC8vIDMyIGJ5dGVzDQogICAgdWludDY0IGNsaWZmOw0KICAgIHVpbnQ2NCB2ZXN0aW5nOw0KICAgIHVpbnQ2NCBzdGFydDsgICAgICAgIC8vIDMgKiA4ID0gMjQgYnl0ZXMNCiAgICBib29sIHJldm9rYWJsZTsNCiAgICBib29sIGJ1cm5zT25SZXZva2U7ICAvLyAyICogMSA9IDIgYml0cz8gb3IgMiBieXRlcz8NCiAgfSAvLyB0b3RhbCA3OCBieXRlcyA9IDMgc3N0b3JlIHBlciBvcGVyYXRpb24gKDMyIHBlciBzc3RvcmUpDQoNCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBUb2tlbkdyYW50W10pIHB1YmxpYyBncmFudHM7DQoNCiAgZXZlbnQgTmV3VG9rZW5HcmFudChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGdyYW50SWQpOw0KDQogIC8qKg0KICAgKiBAZGV2IEdyYW50IHRva2VucyB0byBhIHNwZWNpZmllZCBhZGRyZXNzDQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB0aGUgdG9rZW5zIHdpbGwgYmUgZ3JhbnRlZCB0by4NCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuDQogICAqIEBwYXJhbSBfc3RhcnQgdWludDY0IFRpbWUgb2YgdGhlIGJlZ2lubmluZyBvZiB0aGUgZ3JhbnQuDQogICAqIEBwYXJhbSBfY2xpZmYgdWludDY0IFRpbWUgb2YgdGhlIGNsaWZmIHBlcmlvZC4NCiAgICogQHBhcmFtIF92ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QuDQogICAqIEBwYXJhbSBfcmV2b2thYmxlIGJvb2wgSWYgdGhlIGdyYW50IGlzIHJldm9rYWJsZS4NCiAgICogQHBhcmFtIF9idXJuc09uUmV2b2tlIGJvb2wgV2hlbiB0cnVlLCB0aGUgdG9rZW5zIGFyZSBidXJuZWQgaWYgcmV2b2tlZC4NCiAgICovDQogIGZ1bmN0aW9uIGdyYW50VmVzdGVkVG9rZW5zKA0KICAgIGFkZHJlc3MgX3RvLA0KICAgIHVpbnQyNTYgX3ZhbHVlLA0KICAgIHVpbnQ2NCBfc3RhcnQsDQogICAgdWludDY0IF9jbGlmZiwNCiAgICB1aW50NjQgX3Zlc3RpbmcsDQogICAgYm9vbCBfcmV2b2thYmxlLA0KICAgIGJvb2wgX2J1cm5zT25SZXZva2UNCiAgKSBwdWJsaWMgew0KDQogICAgLy8gQ2hlY2sgZm9yIGRhdGUgaW5jb25zaXN0ZW5jaWVzIHRoYXQgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgYmVoYXZpb3INCiAgICBpZiAoX2NsaWZmIDwgX3N0YXJ0IHx8IF92ZXN0aW5nIDwgX2NsaWZmKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZiAodG9rZW5HcmFudHNDb3VudChfdG8pID4gTUFYX0dSQU5UU19QRVJfQUREUkVTUykgdGhyb3c7ICAvLyBUbyBwcmV2ZW50IGEgdXNlciBiZWluZyBzcGFtbWVkIGFuZCBoYXZlIGhpcyBiYWxhbmNlIGxvY2tlZCAob3V0IG9mIGdhcyBhdHRhY2sgd2hlbiBjYWxjdWxhdGluZyB2ZXN0aW5nKS4NCg0KICAgIHVpbnQgY291bnQgPSBncmFudHNbX3RvXS5wdXNoKA0KICAgICAgICAgICAgICAgIFRva2VuR3JhbnQoDQogICAgICAgICAgICAgICAgICBfcmV2b2thYmxlID8gbXNnLnNlbmRlciA6IDAsICAvLyBhdm9pZCBzdG9yaW5nIGFuIGV4dHJhIDIwIGJ5dGVzIHdoZW4gaXQgaXMgbm9uLXJldm9rYWJsZQ0KICAgICAgICAgICAgICAgICAgX3ZhbHVlLA0KICAgICAgICAgICAgICAgICAgX2NsaWZmLA0KICAgICAgICAgICAgICAgICAgX3Zlc3RpbmcsDQogICAgICAgICAgICAgICAgICBfc3RhcnQsDQogICAgICAgICAgICAgICAgICBfcmV2b2thYmxlLA0KICAgICAgICAgICAgICAgICAgX2J1cm5zT25SZXZva2UNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICk7DQogICAgdHJhbnNmZXIoX3RvLCBfdmFsdWUpOw0KICAgIE5ld1Rva2VuR3JhbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIGNvdW50IC0gMSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBSZXZva2UgdGhlIGdyYW50IG9mIHRva2VucyBvZiBhIHNwZWNpZmVkIGFkZHJlc3MuDQogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuDQogICAqIEBwYXJhbSBfZ3JhbnRJZCBUaGUgaWQgb2YgdGhlIHRva2VuIGdyYW50Lg0KICAgKi8NCiAgZnVuY3Rpb24gcmV2b2tlVG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIHB1YmxpYyB7DQogICAgVG9rZW5HcmFudCBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07DQoNCiAgICBpZiAoIWdyYW50LnJldm9rYWJsZSkgeyAvLyBDaGVjayBpZiBncmFudCB3YXMgcmV2b2thYmxlDQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZiAoZ3JhbnQuZ3JhbnRlciAhPSBtc2cuc2VuZGVyKSB7IC8vIE9ubHkgZ3JhbnRlciBjYW4gcmV2b2tlIGl0DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBhZGRyZXNzIHJlY2VpdmVyID0gZ3JhbnQuYnVybnNPblJldm9rZSA/IDB4ZGVhZCA6IG1zZy5zZW5kZXI7DQogICAgdWludDI1NiBub25WZXN0ZWQgPSBub25WZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsNCg0KICAgIC8vIHJlbW92ZSBncmFudCBmcm9tIGFycmF5DQogICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07DQogICAgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXSA9IGdyYW50c1tfaG9sZGVyXVtncmFudHNbX2hvbGRlcl0ubGVuZ3RoLnN1YigxKV07DQogICAgZ3JhbnRzW19ob2xkZXJdLmxlbmd0aCAtPSAxOw0KDQogICAgYmFsYW5jZXNbcmVjZWl2ZXJdID0gYmFsYW5jZXNbcmVjZWl2ZXJdLmFkZChub25WZXN0ZWQpOw0KICAgIGJhbGFuY2VzW19ob2xkZXJdID0gYmFsYW5jZXNbX2hvbGRlcl0uc3ViKG5vblZlc3RlZCk7DQoNCiAgICBUcmFuc2ZlcihfaG9sZGVyLCByZWNlaXZlciwgbm9uVmVzdGVkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMgb2YgYSBob2xkZXIgYXQgYSBnaXZlbiB0aW1lDQogICAqIEBwYXJhbSBob2xkZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyDQogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgc3BlY2lmaWMgdGltZS4NCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyBhIGhvbGRlcidzIHRvdGFsIGFtb3VudCBvZiB0cmFuc2ZlcmFibGUgdG9rZW5zLg0KICAgKi8NCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICB1aW50MjU2IGdyYW50SW5kZXggPSB0b2tlbkdyYW50c0NvdW50KGhvbGRlcik7DQogICAgaWYgKGdyYW50SW5kZXggPT0gMCkgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOyAvLyBzaG9ydGN1dCBmb3IgaG9sZGVyIHdpdGhvdXQgZ3JhbnRzDQoNCiAgICAvLyBJdGVyYXRlIHRocm91Z2ggYWxsIHRoZSBncmFudHMgdGhlIGhvbGRlciBoYXMsIGFuZCBhZGQgYWxsIG5vbi12ZXN0ZWQgdG9rZW5zDQogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOw0KICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgew0KICAgICAgbm9uVmVzdGVkID0gbm9uVmVzdGVkLmFkZChub25WZXN0ZWRUb2tlbnMoZ3JhbnRzW2hvbGRlcl1baV0sIHRpbWUpKTsNCiAgICB9DQoNCiAgICAvLyBCYWxhbmNlIC0gdG90YWxOb25WZXN0ZWQgaXMgdGhlIGFtb3VudCBvZiB0b2tlbnMgYSBob2xkZXIgY2FuIHRyYW5zZmVyIGF0IGFueSBnaXZlbiB0aW1lDQogICAgdWludDI1NiB2ZXN0ZWRUcmFuc2ZlcmFibGUgPSBiYWxhbmNlT2YoaG9sZGVyKS5zdWIobm9uVmVzdGVkKTsNCg0KICAgIC8vIFJldHVybiB0aGUgbWluaW11bSBvZiBob3cgbWFueSB2ZXN0ZWQgY2FuIHRyYW5zZmVyIGFuZCBvdGhlciB2YWx1ZQ0KICAgIC8vIGluIGNhc2UgdGhlcmUgYXJlIG90aGVyIGxpbWl0aW5nIHRyYW5zZmVyYWJpbGl0eSBmYWN0b3JzIChkZWZhdWx0IGlzIGJhbGFuY2VPZikNCiAgICByZXR1cm4gU2FmZU1hdGgubWluMjU2KHZlc3RlZFRyYW5zZmVyYWJsZSwgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQ2hlY2sgdGhlIGFtb3VudCBvZiBncmFudHMgdGhhdCBhbiBhZGRyZXNzIGhhcy4NCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGhvbGRlciBvZiB0aGUgZ3JhbnRzLg0KICAgKiBAcmV0dXJuIEEgdWludCByZXByZXNlbnRpbmcgdGhlIHRvdGFsIGFtb3VudCBvZiBncmFudHMuDQogICAqLw0KICBmdW5jdGlvbiB0b2tlbkdyYW50c0NvdW50KGFkZHJlc3MgX2hvbGRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCBpbmRleCkgew0KICAgIHJldHVybiBncmFudHNbX2hvbGRlcl0ubGVuZ3RoOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmYyB0aW1lLg0KICAgKiBAcGFyYW0gdG9rZW5zIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgZ3JhbnR0ZWQuDQogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkDQogICAqIEBwYXJhbSBzdGFydCB1aW50NjQgQSB0aW1lIHJlcHJlc2VudGluZyB0aGUgYmVnaW5pbmcgb2YgdGhlIGdyYW50DQogICAqIEBwYXJhbSBjbGlmZiB1aW50NjQgVGhlIGNsaWZmIHBlcmlvZC4NCiAgICogQHBhcmFtIHZlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4NCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnNvZiBhIHNwZWNpZiBncmFudC4NCiAgICogIHRyYW5zZmVyYWJsZVRva2Vucw0KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgXy8tLS0tLS0tLSAgIHZlc3RlZFRva2VucyByZWN0DQogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8NCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgXy8NCiAgICogICB8ICAgICAgICAgICAgICAgICAgIF8vDQogICAqICAgfCAgICAgICAgICAgICAgICAgXy8NCiAgICogICB8ICAgICAgICAgICAgICAgIC8NCiAgICogICB8ICAgICAgICAgICAgICAufA0KICAgKiAgIHwgICAgICAgICAgICAuICB8DQogICAqICAgfCAgICAgICAgICAuICAgIHwNCiAgICogICB8ICAgICAgICAuICAgICAgfA0KICAgKiAgIHwgICAgICAuICAgICAgICB8KGdyYW50c1tfaG9sZGVyXSA9PSBhZGRyZXNzKDApKSByZXR1cm4gMDsNCiAgICogICB8ICAgIC4gICAgICAgICAgfA0KICAgKiAgICs9PT0rPT09PT09PT09PT0rLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUNCiAgICogICAgICBTdGFydCAgICAgICBDbGlmdCAgICBWZXN0aW5nDQogICAqLw0KICBmdW5jdGlvbiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoDQogICAgdWludDI1NiB0b2tlbnMsDQogICAgdWludDI1NiB0aW1lLA0KICAgIHVpbnQyNTYgc3RhcnQsDQogICAgdWludDI1NiBjbGlmZiwNCiAgICB1aW50MjU2IHZlc3RpbmcpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICAgew0KICAgICAgLy8gU2hvcnRjdXRzIGZvciBiZWZvcmUgY2xpZmYgYW5kIGFmdGVyIHZlc3RpbmcgY2FzZXMuDQogICAgICBpZiAodGltZSA8IGNsaWZmKSByZXR1cm4gMDsNCiAgICAgIGlmICh0aW1lID49IHZlc3RpbmcpIHJldHVybiB0b2tlbnM7DQoNCiAgICAgIC8vIEludGVycG9sYXRlIGFsbCB2ZXN0ZWQgdG9rZW5zLg0KICAgICAgLy8gQXMgYmVmb3JlIGNsaWZmIHRoZSBzaG9ydGN1dCByZXR1cm5zIDAsIHdlIGNhbiB1c2UganVzdCBjYWxjdWxhdGUgYSB2YWx1ZQ0KICAgICAgLy8gaW4gdGhlIHZlc3RpbmcgcmVjdCAoYXMgc2hvd24gaW4gYWJvdmUncyBmaWd1cmUpDQoNCiAgICAgIC8vIHZlc3RlZFRva2VucyA9IHRva2VucyAqICh0aW1lIC0gc3RhcnQpIC8gKHZlc3RpbmcgLSBzdGFydCkNCiAgICAgIHVpbnQyNTYgdmVzdGVkVG9rZW5zID0gdG9rZW5zLm11bCh0aW1lLnN1YihzdGFydCkpLmRpdih2ZXN0aW5nLnN1YihzdGFydCkpOw0KICAgICAgcmV0dXJuIHZlc3RlZFRva2VuczsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IEdldCBhbGwgaW5mb3JtYXRpb24gYWJvdXQgYSBzcGVjaWZjIGdyYW50Lg0KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIGhhdmUgaXRzIHRva2VucyByZXZva2VkLg0KICAgKiBAcGFyYW0gX2dyYW50SWQgVGhlIGlkIG9mIHRoZSB0b2tlbiBncmFudC4NCiAgICogQHJldHVybiBSZXR1cm5zIGFsbCB0aGUgdmFsdWVzIHRoYXQgcmVwcmVzZW50IGEgVG9rZW5HcmFudChhZGRyZXNzLCB2YWx1ZSwgc3RhcnQsIGNsaWZmLA0KICAgKiByZXZva2FiaWxpdHksIGJ1cm5zT25SZXZva2UsIGFuZCB2ZXN0aW5nKSBwbHVzIHRoZSB2ZXN0ZWQgdmFsdWUgYXQgdGhlIGN1cnJlbnQgdGltZS4NCiAgICovDQogIGZ1bmN0aW9uIHRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50IF9ncmFudElkKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIGdyYW50ZXIsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdmVzdGVkLCB1aW50NjQgc3RhcnQsIHVpbnQ2NCBjbGlmZiwgdWludDY0IHZlc3RpbmcsIGJvb2wgcmV2b2thYmxlLCBib29sIGJ1cm5zT25SZXZva2UpIHsNCiAgICBUb2tlbkdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsNCg0KICAgIGdyYW50ZXIgPSBncmFudC5ncmFudGVyOw0KICAgIHZhbHVlID0gZ3JhbnQudmFsdWU7DQogICAgc3RhcnQgPSBncmFudC5zdGFydDsNCiAgICBjbGlmZiA9IGdyYW50LmNsaWZmOw0KICAgIHZlc3RpbmcgPSBncmFudC52ZXN0aW5nOw0KICAgIHJldm9rYWJsZSA9IGdyYW50LnJldm9rYWJsZTsNCiAgICBidXJuc09uUmV2b2tlID0gZ3JhbnQuYnVybnNPblJldm9rZTsNCg0KICAgIHZlc3RlZCA9IHZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgR2V0IHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuDQogICAqIEBwYXJhbSBncmFudCBUb2tlbkdyYW50IFRoZSBncmFudCB0byBiZSBjaGVja2VkLg0KICAgKiBAcGFyYW0gdGltZSBUaGUgdGltZSB0byBiZSBjaGVja2VkDQogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQgYXQgYSBzcGVjaWZpYyB0aW1lLg0KICAgKi8NCiAgZnVuY3Rpb24gdmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKA0KICAgICAgZ3JhbnQudmFsdWUsDQogICAgICB1aW50MjU2KHRpbWUpLA0KICAgICAgdWludDI1NihncmFudC5zdGFydCksDQogICAgICB1aW50MjU2KGdyYW50LmNsaWZmKSwNCiAgICAgIHVpbnQyNTYoZ3JhbnQudmVzdGluZykNCiAgICApOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZpYyB0aW1lLg0KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4NCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQNCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmYyBncmFudCBvbiB0aGUNCiAgICogcGFzc2VkIHRpbWUgZnJhbWUuDQogICAqLw0KICBmdW5jdGlvbiBub25WZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBncmFudC52YWx1ZS5zdWIodmVzdGVkVG9rZW5zKGdyYW50LCB0aW1lKSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGRhdGUgd2hlbiB0aGUgaG9sZGVyIGNhbiB0cmFzZmVyIGFsbCBpdHMgdG9rZW5zDQogICAqIEBwYXJhbSBob2xkZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyDQogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGRhdGUgb2YgdGhlIGxhc3QgdHJhbnNmZXJhYmxlIHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIGxhc3RUb2tlbklzVHJhbnNmZXJhYmxlRGF0ZShhZGRyZXNzIGhvbGRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ2NCBkYXRlKSB7DQogICAgZGF0ZSA9IHVpbnQ2NChub3cpOw0KICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IGdyYW50c1tob2xkZXJdLmxlbmd0aDsNCiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBncmFudEluZGV4OyBpKyspIHsNCiAgICAgIGRhdGUgPSBTYWZlTWF0aC5tYXg2NChncmFudHNbaG9sZGVyXVtpXS52ZXN0aW5nLCBkYXRlKTsNCiAgICB9DQogIH0NCn0NCg0KDQovLy8gQHRpdGxlIEFydGNvaW4gKEFSVCkgLSBkZW1vY3JhdGl6aW5nIGN1bHR1cmUuDQpjb250cmFjdCBBcnRjb2luIGlzIE1pbnRhYmxlVG9rZW4sIFZlc3RlZFRva2VuIHsNCg0KICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAnQXJ0Y29pbic7DQogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gJ0FSVCc7DQogIHVpbnQgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7DQoNCiAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsNCiAgICAgIGlmICghQ29udHJvbGxlcihjb250cm9sbGVyKS5wcm94eVBheW1lbnQudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKSkgdGhyb3c7DQogICAgfSBlbHNlIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7DQogICAgdWludCBzaXplOw0KICAgIGlmIChfYWRkciA9PSBhZGRyZXNzKDApKSByZXR1cm4gZmFsc2U7DQogICAgYXNzZW1ibHkgew0KICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikNCiAgICB9DQogICAgcmV0dXJuIHNpemUgPiAwOw0KICB9DQp9'