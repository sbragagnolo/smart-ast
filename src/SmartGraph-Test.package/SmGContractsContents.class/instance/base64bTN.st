base 64 content
base64bTN
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLyoqDQogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzDQogKi8NCmxpYnJhcnkgU2FmZU1hdGggew0KICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICogYjsNCiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gZGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwDQogICAgdWludCBjID0gYSAvIGI7DQogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiIDw9IGEpOw0KICAgIHJldHVybiBhIC0gYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjID49IGEpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsNCiAgICBpZiAoIWFzc2VydGlvbikgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQp9DQoNCg0KLyoqDQogKiBAdGl0bGUgRVJDMjBCYXNpYw0KICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlDQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqLw0KY29udHJhY3QgRVJDMjBCYXNpYyB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQp9DQoNCg0KDQoNCi8qKg0KICogQHRpdGxlIEJhc2ljIHRva2VuDQogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLiANCiAqLw0KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsNCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7DQoNCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOw0KDQogIC8qKg0KICAgKiBAZGV2IEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrLg0KICAgKi8NCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgew0KICAgICBpZihtc2cuZGF0YS5sZW5ndGggPCBzaXplICsgNCkgew0KICAgICAgIHRocm93Ow0KICAgICB9DQogICAgIF87DQogIH0NCg0KICAvKioNCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzDQogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4NCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuDQogICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgew0KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7DQogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7DQogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4NCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4gDQogICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4NCiAgKi8NCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsNCiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgfQ0KDQp9DQoNCg0KDQoNCi8qKg0KICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQ0KICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKi8NCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgew0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7DQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7DQp9DQoNCg0KDQoNCi8qKg0KICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuDQogKg0KICogQGRldiBJbXBsZW1hbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcnQgdG9rZW4uDQogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbA0KICovDQpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEJhc2ljVG9rZW4sIEVSQzIwIHsNCg0KICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7DQoNCg0KICAvKioNCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyDQogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20NCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvDQogICAqIEBwYXJhbSBfdmFsdWUgdWludCB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQNCiAgICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgzICogMzIpIHsNCiAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOw0KDQogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0DQogICAgLy8gaWYgKF92YWx1ZSA+IF9hbGxvd2FuY2UpIHRocm93Ow0KDQogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7DQogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOw0KICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsNCiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVhaGxmIG9mIG1zZy5zZW5kZXIuDQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4NCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4NCiAgICovDQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHsNCg0KICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgDQogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QNCiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToNCiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkNCiAgICBpZiAoKF92YWx1ZSAhPSAwKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0gMCkpIHRocm93Ow0KDQogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLg0KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuDQogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLg0KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuDQogICAqLw0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7DQogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogIH0NCg0KfQ0KDQoNCi8qKg0KICogQHRpdGxlIExpbWl0ZWRUcmFuc2ZlclRva2VuDQogKiBAZGV2IExpbWl0ZWRUcmFuc2ZlclRva2VuIGRlZmluZXMgdGhlIGdlbmVyaWMgaW50ZXJmYWNlIGFuZCB0aGUgaW1wbGVtZW50YXRpb24gdG8gbGltaXQgdG9rZW4gDQogKiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGRpZmZlcmVudCBldmVudHMuIEl0IGlzIGludGVuZGVkIHRvIGJlIHVzZWQgYXMgYSBiYXNlIGNsYXNzIGZvciBvdGhlciB0b2tlbiANCiAqIGNvbnRyYWN0cy4gDQogKiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBoYXMgYmVlbiBkZXNpZ25lZCB0byBhbGxvdyBmb3IgZGlmZmVyZW50IGxpbWl0aW5nIGZhY3RvcnMsDQogKiB0aGlzIGNhbiBiZSBhY2hpZXZlZCBieSByZWN1cnNpdmVseSBjYWxsaW5nIHN1cGVyLnRyYW5zZmVyYWJsZVRva2VucygpIHVudGlsIHRoZSBiYXNlIGNsYXNzIGlzIA0KICogaGl0LiBGb3IgZXhhbXBsZToNCiAqICAgICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1Nikgew0KICogICAgICAgcmV0dXJuIG1pbjI1Nih1bmxvY2tlZFRva2Vucywgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOw0KICogICAgIH0NCiAqIEEgd29ya2luZyBleGFtcGxlIGlzIFZlc3RlZFRva2VuLnNvbDoNCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvYmxvYi9tYXN0ZXIvY29udHJhY3RzL3Rva2VuL1Zlc3RlZFRva2VuLnNvbA0KICovDQoNCmNvbnRyYWN0IExpbWl0ZWRUcmFuc2ZlclRva2VuIGlzIEVSQzIwIHsNCg0KICAvKioNCiAgICogQGRldiBDaGVja3Mgd2hldGhlciBpdCBjYW4gdHJhbnNmZXIgb3Igb3RoZXJ3aXNlIHRocm93cy4NCiAgICovDQogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludCBfdmFsdWUpIHsNCiAgIGlmIChfdmFsdWUgPiB0cmFuc2ZlcmFibGVUb2tlbnMoX3NlbmRlciwgdWludDY0KG5vdykpKSB0aHJvdzsNCiAgIF87DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuDQogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIHRva2Vucy4NCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4NCiAgICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSB7DQogICAgc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICogQGRldiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuDQogICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzZW5kIHRoZSB0b2tlbnMuDQogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjaWV2ZSB0aGUgdG9rZW5zLg0KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuDQogICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKF9mcm9tLCBfdmFsdWUpIHsNCiAgICBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IERlZmF1bHQgdHJhbnNmZXJhYmxlIHRva2VucyBmdW5jdGlvbiByZXR1cm5zIGFsbCB0b2tlbnMgZm9yIGEgaG9sZGVyIChubyBsaW1pdCkuDQogICAqIEBkZXYgT3ZlcndyaXRpbmcgdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgaXMgdGhlIHdheSB0byBwcm92aWRlIHRoZSANCiAgICogc3BlY2lmaWMgbG9naWMgZm9yIGxpbWl0aW5nIHRva2VuIHRyYW5zZmVyYWJpbGl0eSBmb3IgYSBob2xkZXIgb3ZlciB0aW1lLg0KICAgKi8NCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7DQogIH0NCn0NCg0KDQovKioNCiAqIEB0aXRsZSBWZXN0ZWQgdG9rZW4NCiAqIEBkZXYgVG9rZW5zIHRoYXQgY2FuIGJlIHZlc3RlZCBmb3IgYSBncm91cCBvZiBhZGRyZXNzZXMuDQogKi8NCmNvbnRyYWN0IFZlc3RlZFRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIExpbWl0ZWRUcmFuc2ZlclRva2VuIHsNCg0KICB1aW50MjU2IE1BWF9HUkFOVFNfUEVSX0FERFJFU1MgPSAyMDsNCg0KICBzdHJ1Y3QgVG9rZW5HcmFudCB7DQogICAgYWRkcmVzcyBncmFudGVyOyAgICAgLy8gMjAgYnl0ZXMNCiAgICB1aW50MjU2IHZhbHVlOyAgICAgICAvLyAzMiBieXRlcw0KICAgIHVpbnQ2NCBjbGlmZjsNCiAgICB1aW50NjQgdmVzdGluZzsNCiAgICB1aW50NjQgc3RhcnQ7ICAgICAgICAvLyAzICogOCA9IDI0IGJ5dGVzDQogICAgYm9vbCByZXZva2FibGU7DQogICAgYm9vbCBidXJuc09uUmV2b2tlOyAgLy8gMiAqIDEgPSAyIGJpdHM/IG9yIDIgYnl0ZXM/DQogIH0gLy8gdG90YWwgNzggYnl0ZXMgPSAzIHNzdG9yZSBwZXIgb3BlcmF0aW9uICgzMiBwZXIgc3N0b3JlKQ0KDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gVG9rZW5HcmFudFtdKSBwdWJsaWMgZ3JhbnRzOw0KDQogIGV2ZW50IE5ld1Rva2VuR3JhbnQoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSwgdWludDI1NiBncmFudElkKTsNCg0KICAvKioNCiAgICogQGRldiBHcmFudCB0b2tlbnMgdG8gYSBzcGVjaWZpZWQgYWRkcmVzcw0KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggdGhlIHRva2VucyB3aWxsIGJlIGdyYW50ZWQgdG8uDQogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBncmFudGVkLg0KICAgKiBAcGFyYW0gX3N0YXJ0IHVpbnQ2NCBUaW1lIG9mIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGdyYW50Lg0KICAgKiBAcGFyYW0gX2NsaWZmIHVpbnQ2NCBUaW1lIG9mIHRoZSBjbGlmZiBwZXJpb2QuDQogICAqIEBwYXJhbSBfdmVzdGluZyB1aW50NjQgVGhlIHZlc3RpbmcgcGVyaW9kLg0KICAgKi8NCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWRUb2tlbnMoDQogICAgYWRkcmVzcyBfdG8sDQogICAgdWludDI1NiBfdmFsdWUsDQogICAgdWludDY0IF9zdGFydCwNCiAgICB1aW50NjQgX2NsaWZmLA0KICAgIHVpbnQ2NCBfdmVzdGluZywNCiAgICBib29sIF9yZXZva2FibGUsDQogICAgYm9vbCBfYnVybnNPblJldm9rZQ0KICApIHB1YmxpYyB7DQoNCiAgICAvLyBDaGVjayBmb3IgZGF0ZSBpbmNvbnNpc3RlbmNpZXMgdGhhdCBtYXkgY2F1c2UgdW5leHBlY3RlZCBiZWhhdmlvcg0KICAgIGlmIChfY2xpZmYgPCBfc3RhcnQgfHwgX3Zlc3RpbmcgPCBfY2xpZmYpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGlmICh0b2tlbkdyYW50c0NvdW50KF90bykgPiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTKSB0aHJvdzsgICAvLyBUbyBwcmV2ZW50IGEgdXNlciBiZWluZyBzcGFtbWVkIGFuZCBoYXZlIGhpcyBiYWxhbmNlIGxvY2tlZCAob3V0IG9mIGdhcyBhdHRhY2sgd2hlbiBjYWxjdWxhdGluZyB2ZXN0aW5nKS4NCg0KICAgIHVpbnQgY291bnQgPSBncmFudHNbX3RvXS5wdXNoKA0KICAgICAgICAgICAgICAgIFRva2VuR3JhbnQoDQogICAgICAgICAgICAgICAgICBfcmV2b2thYmxlID8gbXNnLnNlbmRlciA6IDAsIC8vIGF2b2lkIHN0b3JpbmcgYW4gZXh0cmEgMjAgYnl0ZXMgd2hlbiBpdCBpcyBub24tcmV2b2thYmxlDQogICAgICAgICAgICAgICAgICBfdmFsdWUsDQogICAgICAgICAgICAgICAgICBfY2xpZmYsDQogICAgICAgICAgICAgICAgICBfdmVzdGluZywNCiAgICAgICAgICAgICAgICAgIF9zdGFydCwNCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUsDQogICAgICAgICAgICAgICAgICBfYnVybnNPblJldm9rZQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgKTsNCg0KICAgIHRyYW5zZmVyKF90bywgX3ZhbHVlKTsNCg0KICAgIE5ld1Rva2VuR3JhbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIGNvdW50IC0gMSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBSZXZva2UgdGhlIGdyYW50IG9mIHRva2VucyBvZiBhIHNwZWNpZmVkIGFkZHJlc3MuDQogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuDQogICAqIEBwYXJhbSBfZ3JhbnRJZCBUaGUgaWQgb2YgdGhlIHRva2VuIGdyYW50Lg0KICAgKi8NCiAgZnVuY3Rpb24gcmV2b2tlVG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIHB1YmxpYyB7DQogICAgVG9rZW5HcmFudCBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07DQoNCiAgICBpZiAoIWdyYW50LnJldm9rYWJsZSkgeyAvLyBDaGVjayBpZiBncmFudCB3YXMgcmV2b2thYmxlDQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZiAoZ3JhbnQuZ3JhbnRlciAhPSBtc2cuc2VuZGVyKSB7IC8vIE9ubHkgZ3JhbnRlciBjYW4gcmV2b2tlIGl0DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBhZGRyZXNzIHJlY2VpdmVyID0gZ3JhbnQuYnVybnNPblJldm9rZSA/IDB4ZGVhZCA6IG1zZy5zZW5kZXI7DQoNCiAgICB1aW50MjU2IG5vblZlc3RlZCA9IG5vblZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOw0KDQogICAgLy8gcmVtb3ZlIGdyYW50IGZyb20gYXJyYXkNCiAgICBkZWxldGUgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsNCiAgICBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdID0gZ3JhbnRzW19ob2xkZXJdW2dyYW50c1tfaG9sZGVyXS5sZW5ndGguc3ViKDEpXTsNCiAgICBncmFudHNbX2hvbGRlcl0ubGVuZ3RoIC09IDE7DQoNCiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKG5vblZlc3RlZCk7DQogICAgYmFsYW5jZXNbX2hvbGRlcl0gPSBiYWxhbmNlc1tfaG9sZGVyXS5zdWIobm9uVmVzdGVkKTsNCg0KICAgIFRyYW5zZmVyKF9ob2xkZXIsIHJlY2VpdmVyLCBub25WZXN0ZWQpOw0KICB9DQoNCg0KICAvKioNCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiB0cmFuc2ZlcmFibGUgdG9rZW5zIG9mIGEgaG9sZGVyIGF0IGEgZ2l2ZW4gdGltZQ0KICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcg0KICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHNwZWNpZmljIHRpbWUuDQogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgYSBob2xkZXIncyB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7DQogICAgdWludDI1NiBncmFudEluZGV4ID0gdG9rZW5HcmFudHNDb3VudChob2xkZXIpOw0KDQogICAgaWYgKGdyYW50SW5kZXggPT0gMCkgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOyAvLyBzaG9ydGN1dCBmb3IgaG9sZGVyIHdpdGhvdXQgZ3JhbnRzDQoNCiAgICAvLyBJdGVyYXRlIHRocm91Z2ggYWxsIHRoZSBncmFudHMgdGhlIGhvbGRlciBoYXMsIGFuZCBhZGQgYWxsIG5vbi12ZXN0ZWQgdG9rZW5zDQogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOw0KICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgew0KICAgICAgbm9uVmVzdGVkID0gU2FmZU1hdGguYWRkKG5vblZlc3RlZCwgbm9uVmVzdGVkVG9rZW5zKGdyYW50c1tob2xkZXJdW2ldLCB0aW1lKSk7DQogICAgfQ0KDQogICAgLy8gQmFsYW5jZSAtIHRvdGFsTm9uVmVzdGVkIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGEgaG9sZGVyIGNhbiB0cmFuc2ZlciBhdCBhbnkgZ2l2ZW4gdGltZQ0KICAgIHVpbnQyNTYgdmVzdGVkVHJhbnNmZXJhYmxlID0gU2FmZU1hdGguc3ViKGJhbGFuY2VPZihob2xkZXIpLCBub25WZXN0ZWQpOw0KDQogICAgLy8gUmV0dXJuIHRoZSBtaW5pbXVtIG9mIGhvdyBtYW55IHZlc3RlZCBjYW4gdHJhbnNmZXIgYW5kIG90aGVyIHZhbHVlDQogICAgLy8gaW4gY2FzZSB0aGVyZSBhcmUgb3RoZXIgbGltaXRpbmcgdHJhbnNmZXJhYmlsaXR5IGZhY3RvcnMgKGRlZmF1bHQgaXMgYmFsYW5jZU9mKQ0KICAgIHJldHVybiBTYWZlTWF0aC5taW4yNTYodmVzdGVkVHJhbnNmZXJhYmxlLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDaGVjayB0aGUgYW1vdW50IG9mIGdyYW50cyB0aGF0IGFuIGFkZHJlc3MgaGFzLg0KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgaG9sZGVyIG9mIHRoZSBncmFudHMuDQogICAqIEByZXR1cm4gQSB1aW50IHJlcHJlc2VudGluZyB0aGUgdG90YWwgYW1vdW50IG9mIGdyYW50cy4NCiAgICovDQogIGZ1bmN0aW9uIHRva2VuR3JhbnRzQ291bnQoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGluZGV4KSB7DQogICAgcmV0dXJuIGdyYW50c1tfaG9sZGVyXS5sZW5ndGg7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDYWxjdWxhdGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZjIHRpbWUuDQogICAqIEBwYXJhbSB0b2tlbnMgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyBncmFudHRlZC4NCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQNCiAgICogQHBhcmFtIHN0YXJ0IHVpbnQ2NCBBIHRpbWUgcmVwcmVzZW50aW5nIHRoZSBiZWdpbmluZyBvZiB0aGUgZ3JhbnQNCiAgICogQHBhcmFtIGNsaWZmIHVpbnQ2NCBUaGUgY2xpZmYgcGVyaW9kLg0KICAgKiBAcGFyYW0gdmVzdGluZyB1aW50NjQgVGhlIHZlc3RpbmcgcGVyaW9kLg0KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2Vuc29mIGEgc3BlY2lmIGdyYW50Lg0KICAgKiAgdHJhbnNmZXJhYmxlVG9rZW5zDQogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgdmVzdGVkVG9rZW5zIHJlY3QNCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICBfLw0KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICBfLw0KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgXy8NCiAgICogICB8ICAgICAgICAgICAgICAgICBfLw0KICAgKiAgIHwgICAgICAgICAgICAgICAgLw0KICAgKiAgIHwgICAgICAgICAgICAgIC58DQogICAqICAgfCAgICAgICAgICAgIC4gIHwNCiAgICogICB8ICAgICAgICAgIC4gICAgfA0KICAgKiAgIHwgICAgICAgIC4gICAgICB8DQogICAqICAgfCAgICAgIC4gICAgICAgIHwNCiAgICogICB8ICAgIC4gICAgICAgICAgfA0KICAgKiAgICs9PT0rPT09PT09PT09PT0rLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUNCiAgICogICAgICBTdGFydCAgICAgICBDbGlmdCAgICBWZXN0aW5nDQogICAqLw0KICBmdW5jdGlvbiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoDQogICAgdWludDI1NiB0b2tlbnMsDQogICAgdWludDI1NiB0aW1lLA0KICAgIHVpbnQyNTYgc3RhcnQsDQogICAgdWludDI1NiBjbGlmZiwNCiAgICB1aW50MjU2IHZlc3RpbmcpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICAgew0KICAgICAgLy8gU2hvcnRjdXRzIGZvciBiZWZvcmUgY2xpZmYgYW5kIGFmdGVyIHZlc3RpbmcgY2FzZXMuDQogICAgICBpZiAodGltZSA8IGNsaWZmKSByZXR1cm4gMDsNCiAgICAgIGlmICh0aW1lID49IHZlc3RpbmcpIHJldHVybiB0b2tlbnM7DQoNCiAgICAgIC8vIEludGVycG9sYXRlIGFsbCB2ZXN0ZWQgdG9rZW5zLg0KICAgICAgLy8gQXMgYmVmb3JlIGNsaWZmIHRoZSBzaG9ydGN1dCByZXR1cm5zIDAsIHdlIGNhbiB1c2UganVzdCBjYWxjdWxhdGUgYSB2YWx1ZQ0KICAgICAgLy8gaW4gdGhlIHZlc3RpbmcgcmVjdCAoYXMgc2hvd24gaW4gYWJvdmUncyBmaWd1cmUpDQoNCiAgICAgIC8vIHZlc3RlZFRva2VucyA9IHRva2VucyAqICh0aW1lIC0gc3RhcnQpIC8gKHZlc3RpbmcgLSBzdGFydCkNCiAgICAgIHVpbnQyNTYgdmVzdGVkVG9rZW5zID0gU2FmZU1hdGguZGl2KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZU1hdGgubXVsKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNhZmVNYXRoLnN1Yih0aW1lLCBzdGFydCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNhZmVNYXRoLnN1Yih2ZXN0aW5nLCBzdGFydCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7DQoNCiAgICAgIHJldHVybiB2ZXN0ZWRUb2tlbnM7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBHZXQgYWxsIGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmYyBncmFudC4NCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4NCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuDQogICAqIEByZXR1cm4gUmV0dXJucyBhbGwgdGhlIHZhbHVlcyB0aGF0IHJlcHJlc2VudCBhIFRva2VuR3JhbnQoYWRkcmVzcywgdmFsdWUsIHN0YXJ0LCBjbGlmZiwNCiAgICogcmV2b2thYmlsaXR5LCBidXJuc09uUmV2b2tlLCBhbmQgdmVzdGluZykgcGx1cyB0aGUgdmVzdGVkIHZhbHVlIGF0IHRoZSBjdXJyZW50IHRpbWUuDQogICAqLw0KICBmdW5jdGlvbiB0b2tlbkdyYW50KGFkZHJlc3MgX2hvbGRlciwgdWludCBfZ3JhbnRJZCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBncmFudGVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHZlc3RlZCwgdWludDY0IHN0YXJ0LCB1aW50NjQgY2xpZmYsIHVpbnQ2NCB2ZXN0aW5nLCBib29sIHJldm9rYWJsZSwgYm9vbCBidXJuc09uUmV2b2tlKSB7DQogICAgVG9rZW5HcmFudCBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07DQoNCiAgICBncmFudGVyID0gZ3JhbnQuZ3JhbnRlcjsNCiAgICB2YWx1ZSA9IGdyYW50LnZhbHVlOw0KICAgIHN0YXJ0ID0gZ3JhbnQuc3RhcnQ7DQogICAgY2xpZmYgPSBncmFudC5jbGlmZjsNCiAgICB2ZXN0aW5nID0gZ3JhbnQudmVzdGluZzsNCiAgICByZXZva2FibGUgPSBncmFudC5yZXZva2FibGU7DQogICAgYnVybnNPblJldm9rZSA9IGdyYW50LmJ1cm5zT25SZXZva2U7DQoNCiAgICB2ZXN0ZWQgPSB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IEdldCB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZpYyB0aW1lLg0KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4NCiAgICogQHBhcmFtIHRpbWUgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZA0KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50IGF0IGEgc3BlY2lmaWMgdGltZS4NCiAgICovDQogIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGNhbGN1bGF0ZVZlc3RlZFRva2VucygNCiAgICAgIGdyYW50LnZhbHVlLA0KICAgICAgdWludDI1Nih0aW1lKSwNCiAgICAgIHVpbnQyNTYoZ3JhbnQuc3RhcnQpLA0KICAgICAgdWludDI1NihncmFudC5jbGlmZiksDQogICAgICB1aW50MjU2KGdyYW50LnZlc3RpbmcpDQogICAgKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4NCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuDQogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkDQogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmMgZ3JhbnQgb24gdGhlIA0KICAgKiBwYXNzZWQgdGltZSBmcmFtZS4NCiAgICovDQogIGZ1bmN0aW9uIG5vblZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGdyYW50LnZhbHVlLnN1Yih2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHRpbWUpKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgZGF0ZSB3aGVuIHRoZSBob2xkZXIgY2FuIHRyYXNmZXIgYWxsIGl0cyB0b2tlbnMNCiAgICogQHBhcmFtIGhvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXINCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCB0cmFuc2ZlcmFibGUgdG9rZW5zLg0KICAgKi8NCiAgZnVuY3Rpb24gbGFzdFRva2VuSXNUcmFuc2ZlcmFibGVEYXRlKGFkZHJlc3MgaG9sZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDY0IGRhdGUpIHsNCiAgICBkYXRlID0gdWludDY0KG5vdyk7DQogICAgdWludDI1NiBncmFudEluZGV4ID0gZ3JhbnRzW2hvbGRlcl0ubGVuZ3RoOw0KICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgew0KICAgICAgZGF0ZSA9IFNhZmVNYXRoLm1heDY0KGdyYW50c1tob2xkZXJdW2ldLnZlc3RpbmcsIGRhdGUpOw0KICAgIH0NCiAgfQ0KfQ0KDQovLyAtIENvbnNpZGVyaW5nIHdlIGluaGVyaXQgZnJvbSBWZXN0ZWRUb2tlbiwgaG93IG11Y2ggZG9lcyB0aGF0IGhpdCBhdCBvdXIgZ2FzIHByaWNlPw0KLy8gLSBFbnN1cmUgbWF4IHN1cHBseSBpcyAxNTAsMDAwLDAwMA0KLy8gLSBFbnN1cmUgdGhhdCBldmVuIGlmIG5vdCB0b3RhbFN1cHBseSBpcyBzb2xkLCB0b2tlbnMgd291bGQgc3RpbGwgYmUgdHJhbnNmZXJyYWJsZSBhZnRlci4NCg0KLy8gdmVzdGluZzogMzY1IGRheXMsIDM2NSBkYXlzIC8gNCB2ZXN0aW5nDQoNCg0KY29udHJhY3QgQlROIGlzIFZlc3RlZFRva2VuIHsNCiAgLy9GSUVMRFMNCiAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIkJFVE5ldHdvcmsiOw0KICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJCVE4iOw0KICB1aW50IHB1YmxpYyBkZWNpbWFscyA9IDQ7DQoNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgU1RBR0VfUFJFU0FMRV9FVEhSYWlzZWQgPSAzNTAwKjEgZXRoZXI7IC8vIFN0YWdlIDEgRXRoZXIgMTAwMDANCiAgdWludCBwdWJsaWMgY29uc3RhbnQgU1RBR0VfVFdPX0VUSFJhaXNlZCA9IDg1MDAqMSBldGhlcjsgLy8gIFN0YWdlIDIgRXRoZXIgMTAwMDANCiAgdWludCBwdWJsaWMgY29uc3RhbnQgU1RBR0VfVEhSRUVfRVRIUmFpc2VkID0gMTQwMDAqMSBldGhlcjsNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgU1RBR0VfRk9VUl9FVEhSYWlzZWQgPSAyMDAwMCoxIGV0aGVyOw0KICANCiAgLy8gTXVsdGlwbGllciBmb3IgdGhlIGRlY2ltYWxzDQogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBERUNJTUFMUyA9IDEwMDAwOw0KDQogIC8vUHJpY2VzIG9mIEJUTg0KICB1aW50IHB1YmxpYyBjb25zdGFudCBQUklDRV9TVEFOREFSRCAgICA9IDMxMjgqREVDSU1BTFM7IC8vIEJUTiByZWNlaXZlZCBwZXIgb25lIEVUSDsgTUFYX1NVUFBMWSAvICh2YWx1YXRpb24gLyBldGhQcmljZSkNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfU1RBR0VfUFJFU0FMRSAgID0gUFJJQ0VfU1RBTkRBUkQgKiAxNDAvMTAwOyAvLyAxRVRIID0gNDAlIG1vcmUgQlRODQogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSSUNFX1NUQUdFX1RXTyAgID0gUFJJQ0VfU1RBTkRBUkQgKiAxMjUvMTAwOyAvLyAxRVRIID0gMjUlIG1vcmUgQlRODQogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSSUNFX1NUQUdFX1RIUkVFID0gUFJJQ0VfU1RBTkRBUkQgKiAxMTUvMTAwOyAvLyAxRVRIID0gMTUlIG1vcmUgQlRODQogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSSUNFX1NUQUdFX0ZPVVIgPSBQUklDRV9TVEFOREFSRCAqIDEwNS8xMDA7IC8vIDFFVEggPSA1JSBtb3JlIEJUTg0KICANCiAgLy9CVE4gVG9rZW4gTGltaXRzDQogIHVpbnQgcHVibGljIGNvbnN0YW50IEFMTE9DX1RFQU0gPSAgICAgICAgIDIyNTAwMDAwKkRFQ0lNQUxTOyAvLyB0ZWFtDQogIHVpbnQgcHVibGljIGNvbnN0YW50IEFMTE9DX1JFUyA9ICAgICAgICAgMjI1MDAwMDAqREVDSU1BTFM7IC8vIFJlc2VydmUNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgQUxMT0NfQ1JPV0RTQUxFID0gICAgMTA1MDAwMDAwKkRFQ0lNQUxTOw0KICANCiAgLy9BU1NJR05FRCBJTiBJTklUSUFMSVpBVElPTg0KICAvL1N0YXJ0IGFuZCBlbmQgdGltZXMNCiAgdWludCBwdWJsaWMgcHVibGljU3RhcnRUaW1lOyAvLyBUaW1lIGluIHNlY29uZHMgcHVibGljIGNyb3dkIHNhbGUgc3RhcnRzLg0KICB1aW50IHB1YmxpYyBwdWJsaWNFbmRUaW1lOyAvLyBUaW1lIGluIHNlY29uZHMgQlROIGNyb3dkc2FsZSBlbmRzDQogIHVpbnQgcHVibGljIGhhcmRjYXBJbkV0aD0zMDAwMCogMSBldGhlcjsNCg0KICAvL1NwZWNpYWwgQWRkcmVzc2VzDQogIGFkZHJlc3MgcHVibGljIG11bHRpc2lnQWRkcmVzcz0weDJERDAxNjY2OEJENDA5QjdFMTk4OGRGZGRDMDgzODhlNDQ4ZjFFOTA7IC8vIEFkZHJlc3MgdG8gd2hpY2ggYWxsIGV0aGVyIGZ1bmQgZmxvd3MuDQogIGFkZHJlc3MgcHVibGljIEJFVE5ldHdvcmtUZWFtQWRkcmVzcz0weGRDRTU5OTk5ODhhNDBBRjBmOUU2YjczRUFGOUQ1YTFEQzAxYTI0RTk7IC8vIEFkZHJlc3MgdG8gd2hpY2ggdGVhbXMgZnVuZHMgdHJhbnNmZXJyZWQuDQogIGFkZHJlc3MgcHVibGljIG93bmVyQWRkcmVzczsgLy8gQWRkcmVzcyBvZiB0aGUgY29udHJhY3Qgb3duZXIuIENhbiBoYWx0IHRoZSBjcm93ZHNhbGUuDQoNCg0KICAvL1J1bm5pbmcgdG90YWxzDQogIHVpbnQgcHVibGljIGV0aGVyUmFpc2VkOyAvLyBUb3RhbCBFdGhlciByYWlzZWQuDQogIHVpbnQgcHVibGljIEJUTlNvbGQ7IC8vIFRvdGFsIEJUTiBjcmVhdGVkDQogIA0KICAvL2Jvb2xlYW5zDQogIGJvb2wgcHVibGljIGhhbHRlZDsgLy8gaGFsdHMgdGhlIGNyb3dkIHNhbGUgaWYgdHJ1ZS4NCg0KICAvLyBNT0RJRklFUlMNCiAgLy9JcyBjdXJyZW50bHkgaW4gdGhlIHBlcmlvZCBhZnRlciB0aGUgcHJpdmF0ZSBzdGFydCB0aW1lIGFuZCBiZWZvcmUgdGhlIHB1YmxpYyBzdGFydCB0aW1lLg0KICBtb2RpZmllciBpc19wcmVfY3Jvd2RmdW5kX3BlcmlvZCgpIHsNCiAgICBpZiAobm93ID49IHB1YmxpY1N0YXJ0VGltZSApIHRocm93Ow0KICAgIF87DQogIH0NCg0KICAvL0lzIGN1cnJlbnRseSB0aGUgY3Jvd2RmdW5kIHBlcmlvZA0KICBtb2RpZmllciBpc19jcm93ZGZ1bmRfcGVyaW9kKCkgew0KICAgIGlmIChub3cgPCBwdWJsaWNTdGFydFRpbWUpIHRocm93Ow0KICAgIGlmIChpc0Nyb3dkZnVuZENvbXBsZXRlZCgpKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgLy8gSXMgY29tcGxldGVkDQogIG1vZGlmaWVyIGlzX2Nyb3dkZnVuZF9jb21wbGV0ZWQoKSB7DQogICAgaWYgKCFpc0Nyb3dkZnVuZENvbXBsZXRlZCgpKSB0aHJvdzsNCiAgICBfOw0KICB9DQogIGZ1bmN0aW9uIGlzQ3Jvd2RmdW5kQ29tcGxldGVkKCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgIGlmIChub3cgPiBwdWJsaWNFbmRUaW1lIHx8IEJUTlNvbGQgPj0gQUxMT0NfQ1JPV0RTQUxFIHx8IGV0aGVyUmFpc2VkID49IGhhcmRjYXBJbkV0aCkgcmV0dXJuIHRydWU7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQoNCiAgLy9NYXkgb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIGFkZHJlc3MNCiAgbW9kaWZpZXIgb25seV9vd25lcigpIHsNCiAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lckFkZHJlc3MpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICAvL01heSBvbmx5IGJlIGNhbGxlZCBpZiB0aGUgY3Jvd2RmdW5kIGhhcyBub3QgYmVlbiBoYWx0ZWQNCiAgbW9kaWZpZXIgaXNfbm90X2hhbHRlZCgpIHsNCiAgICBpZiAoaGFsdGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgLy8gRVZFTlRTDQogIGV2ZW50IEJ1eShhZGRyZXNzIGluZGV4ZWQgX3JlY2lwaWVudCwgdWludCBfYW1vdW50KTsNCg0KICAvLyBJbml0aWFsaXphdGlvbiBjb250cmFjdCBhc3NpZ25zIGFkZHJlc3Mgb2YgY3Jvd2RmdW5kIGNvbnRyYWN0IGFuZCBlbmQgdGltZS4NCiAgZnVuY3Rpb24gQlROKCkgew0KICAgIG93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7DQogICAgcHVibGljU3RhcnRUaW1lID0gbm93Ow0KICAgIHB1YmxpY0VuZFRpbWUgPSBub3cgKyA2IHdlZWtzOw0KICAgIGJhbGFuY2VzW0JFVE5ldHdvcmtUZWFtQWRkcmVzc10gKz0gQUxMT0NfVEVBTTsNCiAgICBiYWxhbmNlc1tvd25lckFkZHJlc3NdICs9IEFMTE9DX1JFUzsNCiAgICBiYWxhbmNlc1tvd25lckFkZHJlc3NdICs9IEFMTE9DX0NST1dEU0FMRTsNCiAgfQ0KDQogIC8vIFRyYW5zZmVyIGFtb3VudCBvZiB0b2tlbnMgZnJvbSBzZW5kZXIgYWNjb3VudCB0byByZWNpcGllbnQuDQogIC8vIE9ubHkgY2FsbGFibGUgYWZ0ZXIgdGhlIGNyb3dkIGZ1bmQgaXMgY29tcGxldGVkDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkNCiAgew0KICAgIGlmIChfdG8gPT0gbXNnLnNlbmRlcikgcmV0dXJuOyAvLyBuby1vcCwgYWxsb3cgZXZlbiBkdXJpbmcgY3Jvd2RzYWxlLCBpbiBvcmRlciB0byB3b3JrIGFyb3VuZCB1c2luZyBncmFudFZlc3RlZFRva2VucygpIHdoaWxlIGluIGNyb3dkc2FsZQ0KICAgIGlmICghaXNDcm93ZGZ1bmRDb21wbGV0ZWQoKSkgdGhyb3c7DQogICAgc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgLy8gVHJhbnNmZXIgYW1vdW50IG9mIHRva2VucyBmcm9tIGEgc3BlY2lmaWVkIGFkZHJlc3MgdG8gYSByZWNpcGllbnQuDQogIC8vIFRyYW5zZmVyIGFtb3VudCBvZiB0b2tlbnMgZnJvbSBzZW5kZXIgYWNjb3VudCB0byByZWNpcGllbnQuDQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpDQogICAgaXNfY3Jvd2RmdW5kX2NvbXBsZXRlZA0KICB7DQogICAgc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogIH0NCg0KICAvL2NvbnN0YW50IGZ1bmN0aW9uIHJldHVybnMgdGhlIGN1cnJlbnQgQlROIHByaWNlLg0KICBmdW5jdGlvbiBnZXRQcmljZVJhdGUoKQ0KICAgICAgY29uc3RhbnQNCiAgICAgIHJldHVybnMgKHVpbnQgb19yYXRlKQ0KICB7DQogICAgICB1aW50IGRlbHRhID0gZXRoZXJSYWlzZWQ7DQogICAgICBpZiAoZGVsdGEgPCBTVEFHRV9QUkVTQUxFX0VUSFJhaXNlZCkgcmV0dXJuIFBSSUNFX1NUQUdFX1BSRVNBTEU7DQogICAgICBpZiAoZGVsdGEgPCBTVEFHRV9UV09fRVRIUmFpc2VkKSByZXR1cm4gUFJJQ0VfU1RBR0VfVFdPOw0KICAgICAgaWYgKGRlbHRhIDwgU1RBR0VfVEhSRUVfRVRIUmFpc2VkKSByZXR1cm4gUFJJQ0VfU1RBR0VfVEhSRUU7DQogICAgICAgaWYgKGRlbHRhIDwgU1RBR0VfRk9VUl9FVEhSYWlzZWQpIHJldHVybiBQUklDRV9TVEFHRV9GT1VSOw0KICAgICAgcmV0dXJuIChQUklDRV9TVEFOREFSRCk7DQogIH0NCg0KICAvLyBjYWxjdWxhdGVzIHdtb3VudCBvZiBCVE4gd2UgZ2V0LCBnaXZlbiB0aGUgd2VpIGFuZCB0aGUgcmF0ZXMgd2UndmUgZGVmaW5lZCBwZXIgMSBldGgNCiAgZnVuY3Rpb24gY2FsY0Ftb3VudCh1aW50IF93ZWksIHVpbnQgX3JhdGUpIA0KICAgIGNvbnN0YW50DQogICAgcmV0dXJucyAodWludCkgDQogIHsNCiAgICByZXR1cm4gU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChfd2VpLCBfcmF0ZSksIDEgZXRoZXIpOw0KICB9IA0KICANCiAgLy8gR2l2ZW4gdGhlIHJhdGUgb2YgYSBwdXJjaGFzZSBhbmQgdGhlIHJlbWFpbmluZyB0b2tlbnMgaW4gdGhpcyB0cmFuY2hlLCBpdA0KICAvLyB3aWxsIHRocm93IGlmIHRoZSBzYWxlIHdvdWxkIHRha2UgaXQgcGFzdCB0aGUgbGltaXQgb2YgdGhlIHRyYW5jaGUuDQogIC8vIFJldHVybnMgYGFtb3VudGAgaW4gc2NvcGUgYXMgdGhlIG51bWJlciBvZiBCVE4gdG9rZW5zIHRoYXQgaXQgd2lsbCBwdXJjaGFzZS4NCiAgZnVuY3Rpb24gcHJvY2Vzc1B1cmNoYXNlKHVpbnQgX3JhdGUsIHVpbnQgX3JlbWFpbmluZykNCiAgICBpbnRlcm5hbA0KICAgIHJldHVybnMgKHVpbnQgb19hbW91bnQpDQogIHsNCiAgICBvX2Ftb3VudCA9IGNhbGNBbW91bnQobXNnLnZhbHVlLCBfcmF0ZSk7DQoNCiAgICBpZiAob19hbW91bnQgPiBfcmVtYWluaW5nKSB0aHJvdzsNCiAgICBpZiAoIW11bHRpc2lnQWRkcmVzcy5zZW5kKG1zZy52YWx1ZSkpIHRocm93Ow0KDQogICAgYmFsYW5jZXNbb3duZXJBZGRyZXNzXSA9IGJhbGFuY2VzW293bmVyQWRkcmVzc10uc3ViKG9fYW1vdW50KTsNCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChvX2Ftb3VudCk7DQoNCiAgICBCVE5Tb2xkICs9IG9fYW1vdW50Ow0KICAgIGV0aGVyUmFpc2VkICs9IG1zZy52YWx1ZTsNCiAgfQ0KDQogIC8vRGVmYXVsdCBmdW5jdGlvbiBjYWxsZWQgYnkgc2VuZGluZyBFdGhlciB0byB0aGlzIGFkZHJlc3Mgd2l0aCBubyBhcmd1bWVudHMuDQogIC8vUmVzdWx0cyBpbiBjcmVhdGlvbiBvZiBuZXcgQlROIFRva2VucyBpZiB0cmFuc2FjdGlvbiB3b3VsZCBub3QgZXhjZWVkIGhhcmQgbGltaXQgb2YgQURYIFRva2VuLg0KICBmdW5jdGlvbigpDQogICAgcGF5YWJsZQ0KICAgIGlzX2Nyb3dkZnVuZF9wZXJpb2QNCiAgICBpc19ub3RfaGFsdGVkDQogIHsNCiAgICB1aW50IGFtb3VudCA9IHByb2Nlc3NQdXJjaGFzZShnZXRQcmljZVJhdGUoKSwgU2FmZU1hdGguc3ViKEFMTE9DX0NST1dEU0FMRSwgQlROU29sZCkpOw0KICAgIEJ1eShtc2cuc2VuZGVyLCBhbW91bnQpOw0KICB9DQoNCiAgLy8gVG8gYmUgY2FsbGVkIGF0IHRoZSBlbmQgb2YgY3Jvd2RmdW5kIHBlcmlvZA0KICAvLyBXQVJOSU5HOiB0cmFuc2ZlcigpLCB3aGljaCBpcyBjYWxsZWQgYnkgZ3JhbnRWZXN0ZWRUb2tlbnMoKSwgd2FudHMgYSBtaW5pbXVtIG1lc3NhZ2UgbGVuZ3RoDQogIGZ1bmN0aW9uIGdyYW50VmVzdGVkKGFkZHJlc3MgX0JFVE5ldHdvcmtUZWFtQWRkcmVzcywgYWRkcmVzcyBfQkVUTmV0d29ya0Z1bmRBZGRyZXNzKQ0KICAgIGlzX2Nyb3dkZnVuZF9jb21wbGV0ZWQNCiAgICBvbmx5X293bmVyDQogICAgaXNfbm90X2hhbHRlZA0KICB7DQogICAgLy8gR3JhbnQgdG9rZW5zIHByZS1hbGxvY2F0ZWQgZm9yIHRoZSB0ZWFtDQogICAgZ3JhbnRWZXN0ZWRUb2tlbnMoDQogICAgICBfQkVUTmV0d29ya1RlYW1BZGRyZXNzLCBBTExPQ19URUFNLA0KICAgICAgdWludDY0KG5vdyksIHVpbnQ2NChub3cpICsgOTEgZGF5cyAsIHVpbnQ2NChub3cpICsgMzY1IGRheXMsIA0KICAgICAgZmFsc2UsIGZhbHNlDQogICAgKTsNCg0KICAgIC8vIEdyYW50IHRva2VucyB0aGF0IHJlbWFpbiBhZnRlciBjcm93ZHNhbGUgdG8gdGhlIEJFVE5ldHdvcmsgZnVuZCwgdmVzdGVkIGZvciAyIHllYXJzDQogICAgZ3JhbnRWZXN0ZWRUb2tlbnMoDQogICAgICBfQkVUTmV0d29ya0Z1bmRBZGRyZXNzLCBiYWxhbmNlc1tvd25lckFkZHJlc3NdLA0KICAgICAgdWludDY0KG5vdyksIHVpbnQ2NChub3cpICsgMTgyIGRheXMgLCB1aW50NjQobm93KSArIDczMCBkYXlzLCANCiAgICAgIGZhbHNlLCBmYWxzZQ0KICAgICk7DQogIH0NCg0KICAvL01heSBiZSB1c2VkIGJ5IG93bmVyIG9mIGNvbnRyYWN0IHRvIGhhbHQgY3Jvd2RzYWxlIGFuZCBubyBsb25nZXIgZXhjZXB0IGV0aGVyLg0KICBmdW5jdGlvbiB0b2dnbGVIYWx0KGJvb2wgX2hhbHRlZCkNCiAgICBvbmx5X293bmVyDQogIHsNCiAgICBoYWx0ZWQgPSBfaGFsdGVkOw0KICB9DQoNCiAgLy9mYWlsc2FmZSBkcmFpbg0KICBmdW5jdGlvbiBkcmFpbigpDQogICAgb25seV9vd25lcg0KICB7DQogICAgaWYgKCFvd25lckFkZHJlc3Muc2VuZCh0aGlzLmJhbGFuY2UpKSB0aHJvdzsNCiAgfQ0KfQ=='