base 64 content
base64baktFactory
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMDsNCg0KY29udHJhY3QgUmVnQmFzZQ0Kew0KLy8NCi8vIENvbnN0YW50cw0KLy8NCg0KICAgIGJ5dGVzMzIgY29uc3RhbnQgcHVibGljIFZFUlNJT04gPSAiUmVnQmFzZSB2MC4yLjEiOw0KDQovLw0KLy8gU3RhdGUgVmFyaWFibGVzDQovLw0KICAgIA0KICAgIC8vLyBAZGV2IEEgc3RhdGljIGlkZW50aWZpZXIsIHNldCBpbiB0aGUgY29uc3RydWN0b3IgYW5kIHVzZWQgZm9yIHJlZ2lzdHJhcg0KICAgIC8vLyBsb29rdXANCiAgICAvLy8gQHJldHVybiBSZWdpc3RyYXIgbmFtZSBTYW5kYWxTdHJhcHMgcmVnaXN0cmFycw0KICAgIGJ5dGVzMzIgcHVibGljIHJlZ05hbWU7DQoNCiAgICAvLy8gQGRldiBBbiBnZW5lcmFsIHB1cnBvc2UgcmVzb3VyY2Ugc3VjaCBhcyBzaG9ydCB0ZXh0IG9yIGEga2V5IHRvIGENCiAgICAvLy8gc3RyaW5nIGluIGEgU3RyaW5nc01hcA0KICAgIC8vLyBAcmV0dXJuIHJlc291cmNlDQogICAgYnl0ZXMzMiBwdWJsaWMgcmVzb3VyY2U7DQogICAgDQogICAgLy8vIEBkZXYgQW4gYWRkcmVzcyBwZXJtaXNzaW9uZWQgdG8gZW5hY3Qgb3duZXIgcmVzdHJpY3RlZCBmdW5jdGlvbnMNCiAgICAvLy8gQHJldHVybiBvd25lcg0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KDQovLw0KLy8gRXZlbnRzDQovLw0KDQogICAgLy8gVHJpZ2dlcmVkIG9uIGNoYW5nZSBvZiBvd25lciBhZGRyZXNzDQogICAgZXZlbnQgQ2hhbmdlZE93bmVyKGFkZHJlc3MgaW5kZXhlZCBvbGRPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsNCg0KICAgIC8vIFRyaWdnZXJlZCBvbiBjaGFuZ2Ugb2YgcmVzb3VyY2UNCiAgICBldmVudCBDaGFuZ2VkUmVzb3VyY2UoYnl0ZXMzMiBpbmRleGVkIHJlc291cmNlKTsNCg0KLy8NCi8vIE1vZGlmaWVycw0KLy8NCg0KICAgIC8vIFBlcm1pdHMgb25seSB0aGUgb3duZXINCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7DQogICAgICAgIF87DQogICAgfQ0KDQovLw0KLy8gRnVuY3Rpb25zDQovLw0KDQogICAgLy8vIEBwYXJhbSBfY3JlYXRvciBUaGUgY2FsbGluZyBhZGRyZXNzIHBhc3NlZCB0aHJvdWdoIGJ5IGEgZmFjdG9yeSwNCiAgICAvLy8gdHlwaWNhbGx5IG1zZy5zZW5kZXINCiAgICAvLy8gQHBhcmFtIF9yZWdOYW1lIEEgc3RhdGljIG5hbWUgcmVmZXJlbmNlZCBieSBhIFJlZ2lzdHJhcg0KICAgIC8vLyBAcGFyYW0gX293bmVyIG9wdGlvbmFsIG93bmVyIGFkZHJlc3MgaWYgY3JlYXRvciBpcyBub3QgdGhlIGludGVuZGVkDQogICAgLy8vIG93bmVyDQogICAgLy8vIEBkZXYgT24gMHgwIHZhbHVlIGZvciBvd25lciwgb3duZXJzaGlwIHByZWNlZGVuY2UgaXM6DQogICAgLy8vIGBfb3duZXJgIGVsc2UgYF9jcmVhdG9yYCBlbHNlIG1zZy5zZW5kZXINCiAgICBmdW5jdGlvbiBSZWdCYXNlKGFkZHJlc3MgX2NyZWF0b3IsIGJ5dGVzMzIgX3JlZ05hbWUsIGFkZHJlc3MgX293bmVyKQ0KICAgIHsNCiAgICAgICAgcmVnTmFtZSA9IF9yZWdOYW1lOw0KICAgICAgICBvd25lciA9IF9vd25lciAhPSAweDAgPyBfb3duZXIgOiANCiAgICAgICAgICAgICAgICBfY3JlYXRvciAhPSAweDAgPyBfY3JlYXRvciA6IG1zZy5zZW5kZXI7DQogICAgfQ0KICAgIA0KICAgIC8vLyBAbm90aWNlIFdpbGwgc2VsZmRlc3RydWN0IHRoZSBjb250cmFjdA0KICAgIGZ1bmN0aW9uIGRlc3Ryb3koKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgb25seU93bmVyDQogICAgew0KICAgICAgICBzZWxmZGVzdHJ1Y3QobXNnLnNlbmRlcik7DQogICAgfQ0KICAgIA0KICAgIC8vLyBAbm90aWNlIENoYW5nZSB0aGUgb3duZXIgdG8gYF9vd25lcmANCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byB3aGljaCBvd25lcnNoaXAgaXMgdHJhbnNmZXJlZA0KICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX293bmVyKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgb25seU93bmVyDQogICAgICAgIHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgICBDaGFuZ2VkT3duZXIob3duZXIsIF9vd25lcik7DQogICAgICAgIG93bmVyID0gX293bmVyOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBDaGFuZ2UgdGhlIHJlc291cmNlIHRvIGBfcmVzb3VyY2VgDQogICAgLy8vIEBwYXJhbSBfcmVzb3VyY2UgQSBrZXkgb3Igc2hvcnQgdGV4dCB0byBiZSBzdG9yZWQgYXMgdGhlIHJlc291cmNlLg0KICAgIGZ1bmN0aW9uIGNoYW5nZVJlc291cmNlKGJ5dGVzMzIgX3Jlc291cmNlKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgb25seU93bmVyDQogICAgICAgIHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgICByZXNvdXJjZSA9IF9yZXNvdXJjZTsNCiAgICAgICAgQ2hhbmdlZFJlc291cmNlKF9yZXNvdXJjZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCn0NCg0KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlwNCg0KZmlsZTogICBGYWN0b3J5LnNvbA0KdmVyOiAgICAwLjIuMQ0KdXBkYXRlZDo5LU1heS0yMDE3DQphdXRob3I6IERhcnJ5bCBNb3JyaXMgKG8wcmFnbWFuMG8pDQplbWFpbDogIG8wcmFnbWFuMG8gQVQgZ21haWwuY29tDQoNClRoaXMgZmlsZSBpcyBwYXJ0IG9mIHRoZSBTYW5kYWxTdHJhcHMgZnJhbWV3b3JrDQoNCkZhY3RvcmllcyBhcmUgYSBjb3JlIGJ1dCBpbmRlcGVuZGFudCBjb25jZXB0IG9mIHRoZSBTYW5kYWxTdHJhcHMgZnJhbWV3b3JrIGFuZCANCmNhbiBiZSB1c2VkIHRvIGNyZWF0ZSBTYW5kYWxTdHJhcHMgY29tcGxpYW50ICdwcm9kdWN0JyBjb250cmFjdHMgZnJvbSBlbWJlZA0KYnl0ZWNvZGUuDQoNClRoZSBhYnN0cmFjdCBGYWN0b3J5IGNvbnRyYWN0IGlzIHRvIGJlIHVzZWQgYXMgYSBTYW5kYWxTdHJhcHMgY29tcGxpYW50IGJhc2UgZm9yDQpwcm9kdWN0IHNwZWNpZmljIGZhY3RvcmllcyB3aGljaCBtdXN0IGltcGxpbWVudCB0aGUgY3JlYXRlTmV3KCkgZnVuY3Rpb24uDQoNCmlzIGl0c2VsZiBjb21wbGlhbnQgd2l0aCBgUmVnaXN0cmFyYCBieSBpbmhlcmV0aW5nIGBSZWdCYXNlYCBhbmQNCmNvbXBpYW50IHdpdGggYEZhY3RvcnlgIHRocm91Z2ggdGhlIGBjcmVhdGVOZXcoYnl0ZXMzMiBfbmFtZSwgYWRkcmVzcyBfb3duZXIpYA0KQVBJLg0KDQpBbiBvcHRpb25hbCBjcmVhdGlvbiBmZWUgY2FuIGJlIHNldCBhbmQgbWFudWFsbHkgY29sbGVjdGVkIGJ5IHRoZSBvd25lci4NCg0KVGhpcyBzb2Z0d2FyZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIA0KU2VlIE1JVCBMaWNlbmNlIGZvciBmdXJ0aGVyIGRldGFpbHMuDQo8aHR0cHM6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVQ+Lg0KDQpcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQpwcmFnbWEgc29saWRpdHkgXjAuNC4xMDsNCg0KLy8gaW1wb3J0ICJodHRwczovL2dpdGh1Yi5jb20vbzByYWdtYW4wby9TYW5kYWxTdHJhcHMvY29udHJhY3RzL1JlZ0Jhc2Uuc29sIjsNCg0KY29udHJhY3QgRmFjdG9yeSBpcyBSZWdCYXNlDQp7DQovLw0KLy8gQ29uc3RhbnRzDQovLw0KDQogICAgLy8gRGVyaXZpbmcgZmFjdG9yaWVzIHNob3VsZCBoYXZlIGBieXRlczMyIGNvbnN0YW50IHB1YmxpYyByZWdOYW1lYCBiZWluZw0KICAgIC8vIHRoZSBwcm9kdWN0J3MgY29udHJhY3QgbmFtZSwgZS5nIGZvciBwcm9kdWN0cyAiRm9vIjoNCiAgICAvLyBieXRlczMyIGNvbnN0YW50IHB1YmxpYyByZWdOYW1lID0gIkZvbyI7DQoNCiAgICAvLyBEZXJpdmluZyBmYWN0b3JpZXMgc2hvdWxkIGhhdmUgYGJ5dGVzMzIgY29uc3RhbnQgcHVibGljIFZFUlNJT05gIGJlaW5nDQogICAgLy8gdGhlIHByb2R1Y3QncyBjb250cmFjdCBuYW1lIGFwcGVuZGVkIHdpdGggJ0ZhY3RvcnlgIGFuZCB0aGUgdmVyc2lvbg0KICAgIC8vIG9mIHRoZSBwcm9kdWN0LCBlLmcgZm9yIHByb2R1Y3RzICJGb28iOg0KICAgIC8vIGJ5dGVzMzIgY29uc3RhbnQgcHVibGljIFZFUlNJT04gIkZvb0ZhY3RvcnkgMC4wLjEiOw0KDQovLw0KLy8gU3RhdGUgVmFyaWFibGVzDQovLw0KDQogICAgLy8vIEByZXR1cm4gVGhlIHBheW1lbnQgaW4gd2VpIHJlcXVpcmVkIHRvIGNyZWF0ZSB0aGUgcHJvZHVjdCBjb250cmFjdC4NCiAgICB1aW50IHB1YmxpYyB2YWx1ZTsNCg0KLy8NCi8vIEV2ZW50cw0KLy8NCg0KICAgIC8vIElzIHRyaWdnZXJlZCB3aGVuIGEgcHJvZHVjdCBpcyBjcmVhdGVkDQogICAgZXZlbnQgQ3JlYXRlZChhZGRyZXNzIF9jcmVhdG9yLCBieXRlczMyIF9yZWdOYW1lLCBhZGRyZXNzIF9hZGRyZXNzKTsNCg0KLy8NCi8vIE1vZGlmaWVycw0KLy8NCg0KICAgIC8vIFRvIGNoZWNrIHRoYXQgdGhlIGNvcnJlY3QgZmVlIGhhcyBiZW5lIHBhaWQNCiAgICBtb2RpZmllciBmZWVQYWlkKCkgew0KICAgIAlyZXF1aXJlKG1zZy52YWx1ZSA9PSB2YWx1ZSB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsNCiAgICAJXzsNCiAgICB9DQoNCi8vDQovLyBGdW5jdGlvbnMNCi8vDQoNCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yIFRoZSBjYWxsaW5nIGFkZHJlc3MgcGFzc2VkIHRocm91Z2ggYnkgYSBmYWN0b3J5LA0KICAgIC8vLyB0eXBpY2FsbHkgbXNnLnNlbmRlcg0KICAgIC8vLyBAcGFyYW0gX3JlZ05hbWUgQSBzdGF0aWMgbmFtZSByZWZlcmVuY2VkIGJ5IGEgUmVnaXN0cmFyDQogICAgLy8vIEBwYXJhbSBfb3duZXIgb3B0aW9uYWwgb3duZXIgYWRkcmVzcyBpZiBjcmVhdG9yIGlzIG5vdCB0aGUgaW50ZW5kZWQNCiAgICAvLy8gb3duZXINCiAgICAvLy8gQGRldiBPbiAweDAgdmFsdWUgZm9yIF9vd25lciBvciBfY3JlYXRvciwgb3duZXJzaGlwIHByZWNlZGVuY2UgaXM6DQogICAgLy8vIGBfb3duZXJgIGVsc2UgYF9jcmVhdG9yYCBlbHNlIG1zZy5zZW5kZXINCiAgICBmdW5jdGlvbiBGYWN0b3J5KGFkZHJlc3MgX2NyZWF0b3IsIGJ5dGVzMzIgX3JlZ05hbWUsIGFkZHJlc3MgX293bmVyKQ0KICAgICAgICBSZWdCYXNlKF9jcmVhdG9yLCBfcmVnTmFtZSwgX293bmVyKQ0KICAgIHsNCiAgICAgICAgLy8gbm90aGluZyBsZWZ0IHRvIGNvbnN0cnVjdA0KICAgIH0NCiAgICANCiAgICAvLy8gQG5vdGljZSBTZXQgdGhlIHByb2R1Y3QgY3JlYXRpb24gZmVlDQogICAgLy8vIEBwYXJhbSBfZmVlIFRoZSBkZXNpcmVkIGZlZSBpbiB3ZWkNCiAgICBmdW5jdGlvbiBzZXQodWludCBfZmVlKSANCiAgICAgICAgb25seU93bmVyDQogICAgICAgIHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgICB2YWx1ZSA9IF9mZWU7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFNlbmQgY29udHJhY3QgYmFsYW5jZSB0byBgb3duZXJgDQogICAgZnVuY3Rpb24gd2l0aGRyYXcoKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICANCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgYSBuZXcgcHJvZHVjdCBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX3JlZ05hbWUgQSB1bmlxdWUgbmFtZSBpZiB0aGUgdGhlIHByb2R1Y3QgaXMgdG8gYmUgcmVnaXN0ZXJlZCBpbg0KICAgIC8vLyBhIFNhbmRhbFN0cmFwcyByZWdpc3RyYXINCiAgICAvLy8gQHBhcmFtIF9vd25lciBBbiBhZGRyZXNzIG9mIGEgdGhpcmQgcGFydHkgb3duZXIuICBXaWxsIGRlZmF1bHQgdG8NCiAgICAvLy8gbXNnLnNlbmRlciBpZiAweDANCiAgICAvLy8gQHJldHVybiBrQWRkcl8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBwcm9kdWN0IGNvbnRyYWN0DQogICAgZnVuY3Rpb24gY3JlYXRlTmV3KGJ5dGVzMzIgX3JlZ05hbWUsIGFkZHJlc3MgX293bmVyKSANCiAgICAgICAgcGF5YWJsZSByZXR1cm5zKGFkZHJlc3Mga0FkZHJfKTsNCn0NCg0KLyogRXhhbXBsZSBpbXBsaW1lbnRhdGlvbiBvZiBgY3JlYXRlTmV3KClgIGZvciBhIGRlcml2aW5nIGZhY3RvcnkNCg0KICAgIGZ1bmN0aW9uIGNyZWF0ZU5ldyhieXRlczMyIF9yZWdOYW1lLCBhZGRyZXNzIF9vd25lcikNCiAgICAgICAgcGF5YWJsZQ0KICAgICAgICBmZWVQYWlkDQogICAgICAgIHJldHVybnMgKGFkZHJlc3Mga0FkZHJfKQ0KICAgIHsNCiAgICAgICAgcmVxdWlyZShfcmVnTmFtZSAhPSAweDApOw0KICAgICAgICBhZGRyZXNzIGtBZGRyXyA9IGFkZHJlc3MobmV3IEZvbyhtc2cuc2VuZGVyLCBfcmVnTmFtZSwgX293bmVyKSk7DQogICAgICAgIENyZWF0ZWQobXNnLnNlbmRlciwgX3JlZ05hbWUsIGtBZGRyKTsNCiAgICB9DQoNCkV4YW1wbGUgcHJvZHVjdCBjb250cmFjdCB3aXRoIGBGYWN0b3J5YCBjb21waWFudCBjb25zdHJ1Y3RvciBhbmQgYFJlZ2lzdHJhcmANCmNvbXBsaWFudCBgcmVnTmFtZWAuDQoNClRoZSBvd25lciB3aWxsIGJlIHRoZSBjYWxsZXIgYnkgZGVmYXVsdCBpZiB0aGUgYF9vd25lcmAgdmFsdWUgaXMgYDB4MGAuDQoNCklmIHRoZSBjb250cmFjdCByZXF1aXJlcyBpbml0aWFsaXphdGlvbiB0aGF0IHdvdWxkIG5vcm1hbGx5IGJlIGRvbmUgaW4gYQ0KY29uc3RydWN0b3IsIHRoZW4gYSBgaW5pdCgpYCBmdW5jdGlvbiBjYW4gYmUgdXNlZCBpbnN0ZWFkIHBvc3QgZGVwbG95bWVudC4NCg0KICAgIGNvbnRyYWN0IEZvbyBpcyBSZWdCYXNlDQogICAgew0KICAgICAgICBieXRlczMyIGNvbnN0YW50IHB1YmxpYyBWRVJTSU9OID0gIkZvbyB2MC4wLjEiOw0KICAgICAgICB1aW50IHZhbDsNCiAgICAgICAgdWludDggcHVibGljIF9faW5pdEZ1c2UgPSAxOw0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gRm9vKGFkZHJlc3MgX2NyZWF0b3IsIGJ5dGVzMzIgX3JlZ05hbWUsIGFkZHJlc3MgX293bmVyKQ0KICAgICAgICAgICAgUmVnQmFzZShfY3JlYXRvciwgX3JlZ05hbWUsIF9vd25lcikNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gcHV0IG5vbi1wYXJhbWV0cmljIGNvbnN0cnVjdG9yIGNvZGUgaGVyZS4NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZnVuY3Rpb24gX2luaXQodWludCBfdmFsKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXF1aXJlKF9faW5pdEZ1c2UgPT0gMSk7DQoNCiAgICAgICAgICAgIC8vIHB1dCBwYXJhbWV0cmljIGNvbnN0cnVjdG9yIGNvZGUgaGVyZSBhbmQgY2FsbCBfaW5pdCgpIHBvc3QgDQogICAgICAgICAgICAvLyBkZXBsb3ltZW50DQogICAgICAgICAgICB2YWwgPSBfdmFsOw0KICAgICAgICAgICAgZGVsZXRlIF9faW5pdEZ1c2U7DQogICAgICAgIH0NCiAgICB9DQoNCiovDQoNCi8qDQpmaWxlOiAgIEJha3Quc29sDQp2ZXI6ICAgIDAuMy40LWJldGENCnVwZGF0ZWQ6MTYtTWF5LTIwMTcNCmF1dGhvcjogRGFycnlsIE1vcnJpcw0KZW1haWw6ICBvMHJhZ21hbjBvIEFUIGdtYWlsLmNvbQ0KDQpDb3B5cmlnaHQgaXMgcmV0YWluZWQgYnkgdGhlIGF1dGhvci4gIENvcHlpbmcgb3IgcnVubmluZyB0aGlzIHNvZnR3YXJlIGlzIG9ubHkNCmJ5IGV4cHJlc3MgcGVybWlzc2lvbi4NCg0KVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkDQp3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFRoZSBhdXRob3INCmNhbm5vdCBiZSBoZWxkIGxpYWJsZSBmb3IgZGFtYWdlIG9yIGxvc3MuDQoNCkRlc2lnbiBOb3RlczoNCg0KVGhpcyBjb250cmFjdCBET0VTIE5PVCBvZmZlciB0cnVzdCB0byBpdHMgaG9sZGVycy4gSG9sZGVycyBpbnN0ZWFkIGVsZWN0IGENClRydXN0ZWUgZnJvbSBhbW9uZyB0aGUgaG9sZGVycyBhbmQgdGhlIFRydXN0ZWUgaXMgcmVzcG9uc2libGUgZm9yIGZ1bmRzLg0KDQpUaGUgVHJ1c3RlZSBoYXMgdW5pbGF0ZXJhbCBwb3dlcnMgdG86DQogICAgLSByZW1vdmUgZnVuZHMNCiAgICAtIHVzZSB0aGUgY29udHJhY3QgdG8gZXhlY3V0ZSBjb2RlIG9uIGFub3RoZXIgY29udHJhY3QNCiAgICAtIHBheSBkaXZpZGVuZHMNCiAgICAtIGFkZCBob2xkZXJzDQogICAgLSBpc3N1ZSBhIHRva2VuIG9mZmVyIHRvIGEgaG9sZGVyDQogICAgLSBzZWxmZGVzdHJ1Y3QgdGhlIGNvbnRyYWN0LCBvbiBjb25kaXRpb24gb2YgMCBzdXBwbHkgYW5kIDAgZXRoZXIgYmFsYW5jZQ0KICAgIC0gdmV0byBhIHRyYW5zYWN0aW9uDQoNCkhvbGRlcnMgaGF2ZSB0aGUgcG93ZXIgdG86DQogICAgLSB2b3RlIGZvciBhIHByZWZlcnJlZCBUcnVzdGVlDQogICAgLSB2ZXRvIGEgdHJhbnNhY3Rpb24gaWYgb3duZWQgb3Igb3ducyA+IDEwJSBvZiB0b2tlbnMNCiAgICAtIHB1cmNoYXNlIHRva2VucyBvZmZlciB3aXRoIGV0aGVyLg0KICAgIC0gcmVkZWVtIHRva2VucyBmb3IgZXRoZXIgYXQgdGhlIHRva2VuIHByaWNlIG9yIGEgcHJpY2UgcHJvcG9ydGlvbmFsIHRvDQogICAgICB0aGUgZnVuZC4NCiAgICAtIHdpdGhkcmF3IHRoZWlyIGJhbGFuY2Ugb2YgZXRoZXIuDQogICAgLSBDYXVzZSBhIHBhbmljIHN0YXRlIGluIHRoZSBjb250cmFjdCBpZiBob2xkcyA+IDEwJSBvZiB0b2tlbnMNCg0KVGhpcyBjb250cmFjdCB1c2VzIGludGVnZXIgdG9rZW5zIHNvIEVSQzIwIGBkZWNpbWFsUGxhY2VzYCBpcyAwLg0KDQpNYXhpbXVtIG51bWJlciBvZiBob2xkZXJzIGlzIGxpbWl0ZWQgdG8gMjU0IHRvIHByZXZlbnQgcG90ZW50aWFsIE9PRyBsb29wcw0KZHVyaW5nIGVsZWN0aW9ucy4NClBlcnBldHVhbCBlbGVjdGlvbiBvZiB0aGUgYFRydXN0ZWVgIHJ1bnMgaW4gTygyNTQpIHRpbWUgdG8gZGlzY292ZXIgYSB3aW5uZXIuDQoNClJlbGVhc2UgTm90ZXMgdjAuMy40LWJldGE6DQotZml4ZWQgbWFnbml0dWRlIGJ1ZyBpbnRyb2R1Y2VkIHdoZW4gdXNpbmcgc2NpZW50aWZpYyBub3RhdGlvbiAoMTAqKjE4ICE9IDEwZTE4KQ0KLXVzaW5nIDEwKioxOCBub3RhdGlvbiByYXRoZXIgdGhhbiAxZTE4IGFzIGFscmVhZHkgdXNpbmcgMioqMjU2IG5vdGF0aW9uDQotSW50ZW5kIHRvIGRlcGxveSBmYWN0b3J5IHRvIFJvcHN0ZW4sIFJpbmtlYnkgYW5kIExpdmUgDQoNClJvcHN0ZW46IDAuMy40LWJldGEtdGVzdDEgQCAweGM0NDY1NzVmN2VkMTNmN2I0Yjg0OWY3MGZmYTlmMjA5YTY0ZGI3NDINCg0KKi8NCg0KLy8gaW1wb3J0ICJodHRwczovL2dpdGh1Yi5jb20vbzByYWdtYW4wby9TYW5kYWxTdHJhcHMvY29udHJhY3RzL0ZhY3Rvcnkuc29sIjsNCg0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTA7DQoNCg0KY29udHJhY3QgQmFrdEludGVyZmFjZQ0Kew0KDQovKiBTdHJ1Y3RzICovDQoNCiAgICBzdHJ1Y3QgSG9sZGVyIHsNCiAgICAgICAgdWludDggaWQ7DQogICAgICAgIGFkZHJlc3Mgdm90aW5nRm9yOw0KICAgICAgICB1aW50NDAgb2ZmZXJFeHBpcnk7DQogICAgICAgIHVpbnQgbGFzdENsYWltZWQ7DQogICAgICAgIHVpbnQgdG9rZW5CYWxhbmNlOw0KICAgICAgICB1aW50IGV0aGVyQmFsYW5jZTsNCiAgICAgICAgdWludCB2b3RlczsNCiAgICAgICAgdWludCBvZmZlckFtb3VudDsNCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBhbGxvd2FuY2VzOw0KICAgIH0NCg0KICAgIHN0cnVjdCBUWCB7DQogICAgICAgIGJvb2wgYmxvY2tlZDsNCiAgICAgICAgdWludDQwIHRpbWVMb2NrOw0KICAgICAgICBhZGRyZXNzIGZyb207DQogICAgICAgIGFkZHJlc3MgdG87DQogICAgICAgIHVpbnQgdmFsdWU7DQogICAgICAgIGJ5dGVzIGRhdGE7DQogICAgfQ0KDQoNCi8qIENvbnN0YW50cyAqLw0KDQogICAgLy8gQ29uc3RhbnQgbWF4IHRva2VucyBhbmQgbWF4IGV0aGVyIHRvIHByZXZlbnQgcG90ZW50aWFsIG11bHRpcGxpY2F0aW9uDQogICAgLy8gb3ZlcmZsb3dzIGluIDEwZTE3IGZpeGVkIHBvaW50ICAgICANCiAgICB1aW50IGNvbnN0YW50IE1BWFRPS0VOUyA9IDIqKjEyOCAtIDEwKioxODsNCiAgICB1aW50IGNvbnN0YW50IE1BWEVUSEVSID0gMioqMTI4Ow0KICAgIHVpbnQgY29uc3RhbnQgQkxPQ0tQQ05UID0gMTA7IC8vIDEwJSBob2xkaW5nIHJlcXVpcmVkIHRvIGJsb2NrIFRYJ3MNCiAgICB1aW50IGNvbnN0YW50IFRPS0VOUFJJQ0UgPSAxMDAwMDAwMDAwMDAwMDAwOw0KICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFsUGxhY2VzID0gMTU7DQoNCi8qIFN0YXRlIFZhbGlhYmxlcyAqLw0KDQogICAgLy8gQSBtdXRleCB1c2VkIGZvciByZWVudHJ5IHByb3RlY3Rpb24NCiAgICBib29sIF9fcmVNdXRleDsNCg0KICAgIC8vIEluaXRpYWxpc2F0aW9uIGZ1c2UuIEJsb3dzIG9uIGluaXRpYWxpc2F0aW9uIGFuZCB1c2VkIGZvciBlbnRyeSBjaGVjazsNCiAgICBib29sIF9faW5pdEZ1c2UgPSB0cnVlOw0KDQogICAgLy8gQWxsb3dzIHRoZSBjb250cmFjdCB0byBhY2NlcHQgb3IgZGVueSBwYXltZW50cw0KICAgIGJvb2wgcHVibGljIGFjY2VwdGluZ1BheW1lbnRzOw0KDQogICAgLy8gVGhlIHBlcmlvZCBmb3Igd2hpY2ggYSBwYW5pYyB3aWxsIHByZXZlbnQgZnVuY3Rpb25hbGl0eSB0byB0aGUgY29udHJhY3QNCiAgICB1aW50NDAgcHVibGljIFBBTklDUEVSSU9EOw0KDQogICAgLy8gVGhlIHBlcmlvZCBmb3Igd2hpY2ggYSBwZW5kaW5nIHRyYW5zYWN0aW9uIG11c3Qgd2FpdCBiZWZvcmUgYmVpbmcgc2VudCANCiAgICB1aW50NDAgcHVibGljIFRYREVMQVk7DQoNCiAgICAvLy8gQHJldHVybiBUaGUgUGFuaWMgZmxhZyBzdGF0ZS4gZmFsc2UgPT0gY2FsbSwgdHJ1ZSA9PSBwYW5pY2tlZA0KICAgIGJvb2wgcHVibGljIHBhbmlja2VkOw0KDQogICAgLy8vIEByZXR1cm4gVGhlIHBlbmRpbmcgdHJhbnNhY3Rpb24gcXVldWUgaGVhZCBwb2ludGVyDQogICAgdWludDggcHVibGljIHB0eEhlYWQ7DQoNCiAgICAvLy8gQHJldHVybiBUaGUgcGVuZGluZyB0cmFuc2FjdGlvbiBxdWV1ZSB0YWlsIHBvaW50ZXINCiAgICB1aW50OCBwdWJsaWMgcHR4VGFpbDsNCg0KICAgIC8vLyBAcmV0dXJuIFRoZSBgUEFOSUNgIHRpbWVsb2NrIGV4cGlyeSBkYXRlL3RpbWUNCiAgICB1aW50NDAgcHVibGljIHRpbWVUb0NhbG07DQoNCiAgICAvLy8gQHJldHVybiBUaGUgQWRkcmVzcyBvZiB0aGUgY3VycmVudCBlbGVjdGVkIHRydXN0ZWUNCiAgICBhZGRyZXNzIHB1YmxpYyB0cnVzdGVlOw0KDQogICAgLy8vIEByZXR1cm4gVG90YWwgY291bnQgb2YgdG9rZW5zDQogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7DQoNCiAgICAvLy8gQHJldHVybiBUaGUgY29tYmluZWQgYmFsYW5jZSBvZiBldGhlciBjb21taXR0ZWQgdG8gaG9sZGVyIGFjY291bnRzLCANCiAgICAvLy8gdW5jbGFpbWVkIGRpdmlkZW5kcyBhbmQgdmFsdWVzIGluIHBlbmRpbmcgdHJhbnNhY3Rpb25zLg0KICAgIHVpbnQgcHVibGljIGNvbW1pdHRlZEV0aGVyOw0KDQogICAgLy8vIEBkZXYgVGhlIHJ1bm5pbmcgdGFsbHkgb2YgZGl2aWRlbmRzIHBvaW50cyBhY2N1cmVkIGJ5IA0KICAgIC8vLyBkaXZpZGVuZC90b3RhbFN1cHBseSBhdCBlYWNoIGRpdmlkZW5kIHBheW1lbnQNCiAgICB1aW50IGRpdmlkZW5kUG9pbnRzOw0KDQogICAgLy8vIEByZXR1cm4gVGhlIGhpc3RvcmljIHRhbGx5IG9mIHBhaWQgZGl2aWRlbmRzDQogICAgdWludCBwdWJsaWMgdG90YWxEaXZpZGVuZHM7DQoNCiAgICAvLy8gQHJldHVybiBBIHN0YXRpYyBpZGVudGlmaWVyLCBzZXQgaW4gdGhlIGNvbnN0cnVjdG9yIGFuZCB1c2VkIGJ5DQogICAgLy8vIHJlZ2lzdHJhcnMNCiAgICBieXRlczMyIHB1YmxpYyByZWdOYW1lOw0KDQogICAgLy8vIEByZXR1cm4gQW4gaW5mb3JtYXRpb25hbCByZXNvdXJjZS4gQ2FuIGJlIGEgc2hhMyBvZiBhIHN0cmluZyB0byBsb29rdXANCiAgICAvLy8gaW4gYSBTdHJpbmdzTWFwDQogICAgYnl0ZXMzMiBwdWJsaWMgcmVzb3VyY2U7DQoNCiAgICAvLy8gQHBhcmFtIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgYSBob2xkZXIuDQogICAgLy8vIEByZXR1cm4gSG9sZGVyIGRhdGEgY2FzdCBmcm9tIHN0cnVjdCBIb2xkZXIgdG8gYW4gYXJyYXkNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IEhvbGRlcikgcHVibGljIGhvbGRlcnM7DQoNCiAgICAvLy8gQHBhcmFtIHVpbnQ4IFRoZSBpbmRleCBvZiBhIGhvbGRlcg0KICAgIC8vLyBAcmV0dXJuIEFuIGFkZHJlc3Mgb2YgYSBob2xkZXINCiAgICBhZGRyZXNzWzI1Nl0gcHVibGljIGhvbGRlckluZGV4Ow0KDQogICAgLy8vIEBwYXJhbSB1aW50OCBUaGUgaW5kZXggb2YgYSBwZW5kaW5nIHRyYW5zYWN0aW9uDQogICAgLy8vIEByZXR1cm4gVHJhbnNhY3Rpb24gZGV0YWlscyBjYXN0IGZyb20gc3RydWN0IFRYIHRvIGFycmF5DQogICAgVFhbMjU2XSBwdWJsaWMgcGVuZGluZ1R4czsNCg0KLyogRXZlbnRzICovDQoNCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiB0aGUgY29udHJhY3QgcmVjaWV2ZXMgYSBwYXltZW50DQogICAgZXZlbnQgRGVwb3NpdCh1aW50IHZhbHVlKTsNCg0KICAgIC8vIFRyaWdnZXJlZCB3aGVuIGV0aGVyIGlzIHNlbnQgZnJvbSB0aGUgY29udHJhY3QNCiAgICBldmVudCBXaXRoZHJhd2FsKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIGFkZHJlc3MgaW5kZXhlZCByZWNpcGllbnQsDQogICAgICAgIHVpbnQgdmFsdWUpOw0KDQogICAgLy8gVHJpZ2dlcmVkIHdoZW4gYSB0cmFuc2FjdGlvbiBpcyBvcmRlcmVkDQogICAgZXZlbnQgVHJhbnNhY3Rpb25QZW5kaW5nKHVpbnQgaW5kZXhlZCBwVFgsIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIA0KICAgICAgICBhZGRyZXNzIGluZGV4ZWQgcmVjaXBpZW50LCB1aW50IHZhbHVlLCB1aW50IHRpbWVMb2NrKTsNCg0KICAgIC8vIFRyaWdnZXJlZCB3aGVuIGEgcGVuZGluZyB0cmFuc2FjdGlvbiBpcyBibG9ja2VkDQogICAgZXZlbnQgVHJhbnNhY3Rpb25CbG9ja2VkKGFkZHJlc3MgaW5kZXhlZCBieSwgdWludCBpbmRleGVkIHBUWCk7DQoNCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiBhIHRyYW5zYWN0aW9uIGZhaWxzIGVpdGhlciBieSBiZWluZyBibG9ja2VkIG9yIGZhaWx1cmUgb2YgDQogICAgLy8gcmVjaWVwdA0KICAgIGV2ZW50IFRyYW5zYWN0aW9uRmFpbGVkKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIGFkZHJlc3MgaW5kZXhlZCByZWNpcGllbnQsDQogICAgICAgIHVpbnQgdmFsdWUpOw0KDQogICAgLy8gVHJpZ2dlcmVkIHdoZW4gdGhlIHRydXN0ZWUgcGF5cyBkaXZpZGVuZHMNCiAgICBldmVudCBEaXZpZGVuZFBhaWQodWludCB2YWx1ZSk7DQoNCiAgICAvLyBFUkMyMCB0cmFuc2ZlciBub3RpZmljYXRpb24NCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsNCg0KICAgIC8vIEVSQzIwIGFwcHJvdmFsIG5vdGlmaWNhdGlvbg0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KDQogICAgLy8gVHJpZ2dlcmVkIG9uIGNoYW5nZSBvZiB0cnVzdGVlDQogICAgZXZlbnQgVHJ1c3RlZShhZGRyZXNzIGluZGV4ZWQgdHJ1c3RlZSk7DQoNCiAgICAvLyBUcmlnZ2VyIHdoZW4gYSBuZXcgaG9sZGVyIGlzIGFkZGVkDQogICAgZXZlbnQgTmV3SG9sZGVyKGFkZHJlc3MgaW5kZXhlZCBob2xkZXIpOw0KDQogICAgLy8gVHJpZ2dlcmVkIHdoZW4gYSBob2xkZXIgdmFjYXRlcw0KICAgIGV2ZW50IEhvbGRlclZhY2F0ZWQoYWRkcmVzcyBpbmRleGVkIGhvbGRlcik7DQoNCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiBhIG9mZmVyIG9mIHRva2VucyBpcyBjcmVhdGVkDQogICAgZXZlbnQgSXNzdWVPZmZlcihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyKTsNCg0KICAgIC8vIFRyaWdnZXJlZCBvbiB0b2tlbiBjcmVhdGlvbiB3aGVuIGFuIG9mZmVyIGlzIGFjY2VwdGVkDQogICAgZXZlbnQgVG9rZW5zQ3JlYXRlZChhZGRyZXNzIGluZGV4ZWQgaG9sZGVyLCB1aW50IGFtb3VudCk7DQoNCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiB0b2tlbnMgYXJlIGRlc3Ryb3llZCBkdXJpbmcgYSByZWRlZW1pbmcgcm91bmQNCiAgICBldmVudCBUb2tlbnNEZXN0cm95ZWQoYWRkcmVzcyBpbmRleGVkIGhvbGRlciwgdWludCBhbW91bnQpOw0KDQogICAgLy8gVHJpZ2dlcmVkIHdoZW4gYSBob2xkIGNhdXNlcyBhIHBhbmljDQogICAgZXZlbnQgUGFuaWNrZWQoYWRkcmVzcyBpbmRleGVkIGJ5KTsNCg0KICAgIC8vIFRyaWdnZXJlZCB3aGVuIGEgaG9sZGVyIGNhbG1zIGEgcGFuaWMNCiAgICBldmVudCBDYWxtKCk7DQoNCi8vDQovLyBCYWt0IEZ1bmN0aW9ucw0KLy8NCg0KICAgIC8vLyBAZGV2IEFjY2VwdCBwYXltZW50IHRvIHRoZSBkZWZhdWx0IGZ1bmN0aW9uDQogICAgZnVuY3Rpb24oKSBwYXlhYmxlOw0KDQogICAgLy8vIEBub3RpY2UgVGhpcyB3aWxsIHNldCB0aGUgcGFuaWMgYW5kIHBlbmRpbmcgcGVyaW9kcy4NCiAgICAvLy8gVGhpcyBhY3Rpb24gaXMgYSBvbmUgb2ZmIGFuZCBpcyBpcnJldm9jYWJsZSEgDQogICAgLy8vIEBwYXJhbSBfcGFuaWNEZWxheUluU2Vjb25kcyBUaGUgcGFuaWMgZGVsYXkgcGVyaW9kIGluIHNlY29uZHMNCiAgICAvLy8gQHBhcmFtIF9wZW5kaW5nRGVsYXlJblNlY29uZHMgVGhlIHBlbmRpbmcgcGVyaW9kIGluIHNlY29uZHMNCiAgICBmdW5jdGlvbiBfaW5pdCh1aW50NDAgX3BhbmljRGVsYXlJblNlY29uZHMsIHVpbnQ0MCBfcGVuZGluZ0RlbGF5SW5TZWNvbmRzKQ0KICAgICAgICByZXR1cm5zIChib29sKTsNCg0KICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIHVuY29tbWl0dGVkIGV0aGVyIGZ1bmRzLg0KICAgIGZ1bmN0aW9uIGZ1bmRCYWxhbmNlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogICAgDQogICAgLy8vIEByZXR1cm4gVGhlIGNvbnN0YW50IFRPS0VOUFJJQ0UuDQogICAgZnVuY3Rpb24gdG9rZW5QcmljZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KDQovLw0KLy8gRVJDMjAgQVBJIGZ1bmN0aW9ucw0KLy8NCg0KICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3Mgb2YgYSBob2xkZXINCiAgICAvLy8gQHJldHVybiBUaGUgRVJDMjAgdG9rZW4gYmFsYW5jZSBvZiB0aGUgaG9sZGVyDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KDQogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYF9hbW91bnRgIG9mIHRva2VucyB0byBgX3RvYA0KICAgIC8vLyBAcGFyYW0gX3RvIHRoZSByZWNpcGllbnQgaG9sZGVyJ3MgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCB0aGUgbnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlcg0KICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3Mgc3RhdGUNCiAgICAvLy8gQGRldiBgX3RvYCBtdXN0IGJlIGFuIGV4aXN0aW5nIGhvbGRlcg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHJldHVybnMgKGJvb2wpOw0KDQogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYF9hbW91bnRgIG9mIHRva2VucyBmcm9tIGBfZnJvbWAgdG8gYF90b2ANCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBob2xkZXIgYWRkcmVzcyBmcm9tIHdoaWNoIHRvIHRha2UgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfdG8gdGhlIHJlY2lwaWVudCBob2xkZXIncyBhZGRyZXNzDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IHRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyDQogICAgLy8vIEByZXR1cm4gc3VjY2VzcyBzdGF0ZQ0KICAgIC8vLyBAZGV2IGBfZnJvbWAgYW5kIGBfdG9gIG11c3QgYmUgZXhpc3RpbmcgaG9sZGVycw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KQ0KICAgICAgICByZXR1cm5zIChib29sKTsNCg0KICAgIC8vLyBAbm90aWNlIEFwcHJvdmUgYF9zcGVuZGVyYCB0byB0cmFuc2ZlciBgX2Ftb3VudGAgb2YgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciB0aGUgYXBwcm92ZWQgc3BlbmRlciBhZGRyZXNzLiBEb2VzIG5vdCBoYXZlIHRvIGJlIGFuDQogICAgLy8vIGV4aXN0aW5nIGhvbGRlci4NCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgdGhlIG51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXINCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkZHJlc3Mgb2YgdGhlIGhvbGRlciBvd25pbmcgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhbGxvd2VkIHRvIHRyYW5zZmVyIHRva2Vucw0KICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW4gdGhhdCB0aGUgX3NwZW5kZXIgY2FuIHRyYW5zZmVyDQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQ0KICAgICAgICBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsNCg0KLy8NCi8vIFNlY3VyaXR5IEZ1bmN0aW9ucw0KLy8NCg0KICAgIC8vLyBAbm90aWNlIENhdXNlIHRoZSBjb250cmFjdCB0byBQYW5pYy4gVGhpcyB3aWxsIGJsb2NrIG1vc3Qgc3RhdGUgY2hhbmdpbmcNCiAgICAvLy8gZnVuY3Rpb25zIGZvciBhIHNldCBkZWxheS4NCiAgICAvLy8gRXhjZXB0aW9ucyBhcmUgYHZvdGUoKWAsIGBibG9ja1BlbmRpbmdUeCh1aW50IF90eElkeClgIGFuZCBgUEFOSUMoKWAuDQogICAgZnVuY3Rpb24gUEFOSUMoKSByZXR1cm5zIChib29sKTsNCg0KICAgIC8vLyBAbm90aWNlIFJlbGVhc2UgdGhlIGNvbnRyYWN0IGZyb20gYSBQYW5pYyBhZnRlciB0aGUgcGFuaWMgcGVyaW9kIGhhcw0KICAgIC8vLyBleHBpcmVkLg0KICAgIGZ1bmN0aW9uIGNhbG0oKSByZXR1cm5zIChib29sKTsNCg0KICAgIC8vLyBAbm90aWNlIEV4ZWN1dGUgdGhlIGZpcnN0IFRYIGluIHRoZSBwZW5kaW5nVHhzIHF1ZXVlLiBWYWx1ZXMgd2lsbA0KICAgIC8vLyByZXZlcnQgaWYgdGhlIHRyYW5zYWN0aW9uIGlzIGJsb2NrZWQgb3IgZmFpbHMuDQogICAgZnVuY3Rpb24gc2VuZFBlbmRpbmcoKSByZXR1cm5zIChib29sKTsNCg0KICAgIC8vLyBAbm90aWNlIEJsb2NrIGEgcGVuZGluZyB0cmFuc2FjdGlvbiB3aXRoIGlkIGBfdHhJZHhgLiBQZW5kaW5nDQogICAgLy8vIHRyYW5zYWN0aW9ucyBjYW4gYmUgYmxvY2tlZCBieSBhbnkgaG9sZGVyIGF0IGFueSB0aW1lIGJ1dCBtdXN0DQogICAgLy8vIHN0aWxsIGJlIGNsZWFyZWQgZnJvbSB0aGUgcGVuZGluZyB0cmFuc2FjdGlvbnMgcXVldWUgb25jZSB0aGUgdGltZWxvY2sNCiAgICAvLy8gaXMgY2xlYXJlZC4NCiAgICAvLy8gQHBhcmFtIF90eElkeCBJbmRleCBvZiB0aGUgdHJhbnNhY3Rpb24gaW4gdGhlIHBlbmRpbmcgdHJhbnNhY3Rpb25zDQogICAgLy8vIHRhYmxlDQogICAgZnVuY3Rpb24gYmxvY2tQZW5kaW5nVHgodWludCBfdHhJZHgpIHJldHVybnMgKGJvb2wpOw0KDQovLw0KLy8gVHJ1c3RlZSBmdW5jdGlvbnMNCi8vDQoNCiAgICAvLy8gQG5vdGljZSBTZW5kIGEgdHJhbnNhY3Rpb24gdG8gYF90b2AgY29udGFpbmluZyBgX3ZhbHVlYCB3aXRoIFJMUCBlbmNvZGVkDQogICAgLy8vICAgICBhcmd1bWVudHMgb2YgYF9kYXRhYA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSByZWNpcGllbnQgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHZhbHVlIG9mIGV0aGVyIHRvIHNlbmQNCiAgICAvLy8gQHBhcmFtIF9kYXRhIFJMUCBlbmNvZGVkIGRhdGEgdG8gc2VuZCB3aXRoIHRoZSB0cmFuc2FjdGlvbg0KICAgIC8vLyBAZGV2IEFsbG93cyB0aGUgdHJ1c3RlZSB0byBpbml0aWF0ZSBhIHRyYW5zYWN0aW9uIGFzIHRoZSBCYWt0LiBJdCBtdXN0DQogICAgLy8vIGJlIGZvbGxvd2VkIGJ5IHNlbmRQZW5kaW5nKCkgYWZ0ZXIgdGhlIHRpbWVMb2NrIGV4cGlyZXMuDQogICAgZnVuY3Rpb24gZXhlY3V0ZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSByZXR1cm5zICh1aW50OCk7DQoNCiAgICAvLy8gQG5vdGljZSBQYXkgZGl2aWRlbmRzIG9mIGBfdmFsdWVgDQogICAgLy8vIEBwYXJhbSBfdmFsdWUgYSB2YWx1ZSBvZiBldGhlciB1cHRvIHRoZSBmdW5kIGJhbGFuY2UNCiAgICAvLy8gQGRldiBBbGxvd3MgdGhlIHRydXN0ZWUgdG8gY29tbWl0IGEgcG9ydGlvbiBvZiBgZnVuZEJhbGFuY2VgIHRvIGRpdmlkZW5kcy4NCiAgICBmdW5jdGlvbiBwYXlEaXZpZGVuZHModWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wpOw0KDQovLw0KLy8gSG9sZGVyIEZ1bmN0aW9ucw0KLy8NCg0KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgdGhlIGFycmF5IG9mIGhvbGRlciBhZGRyZXNzZXMuDQogICAgZnVuY3Rpb24gZ2V0SG9sZGVycygpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzc1syNTZdKTsNCg0KICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3Mgb2YgYSBob2xkZXINCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRoZSBob2xkZXIncyB3aXRoZHJhd2FibGUgYmFsYW5jZSBvZiBldGhlcg0KICAgIGZ1bmN0aW9uIGV0aGVyQmFsYW5jZU9mKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KDQogICAgLy8vIEBub3RpY2UgSW5pdGlhdGUgYSB3aXRoZHJhd2FsIG9mIHRoZSBob2xkZXIncyBgZXRoZXJCYWxhbmNlYA0KICAgIC8vLyBGb2xsb3cgdXAgd2l0aCBzZW5kUGVuZGluZygpIG9uY2UgdGhlIHRpbWVsb2NrIGhhcyBleHBpcmVkDQogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSByZXR1cm5zKHVpbnQ4KTsNCg0KICAgIC8vLyBAbm90aWNlIFZhY2F0ZSBob2xkZXIgYF9hZGRyYA0KICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3Mgb2YgYSBob2xkZXIgd2l0aCBlbXB0eSBiYWxhbmNlcy4NCiAgICBmdW5jdGlvbiB2YWNhdGUoYWRkcmVzcyBfYWRkcikgcmV0dXJucyAoYm9vbCk7DQoNCi8vDQovLyBUb2tlbiBDcmVhdGlvbi9EZXN0cnVjdGlvbiBGdW5jdGlvbnMNCi8vDQoNCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgdG9rZW5zIHRvIHRoZSB2YWx1ZSBvZiBgbXNnLnZhbHVlYCArDQogICAgLy8vIGBob2xkZXIuZXRoZXJCYWxhbmNlYA0KICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3Mgc3RhdGUNCiAgICAvLy8gQGRldiBUaGUgYW1vdW50IG9mIHRva2VucyBjcmVhdGVkIGlzOg0KICAgIC8vLyAgICAgdG9rZW5zID0gZmxvb3IoKGBldGhlckJhbGFuY2VgICsgYG1zZy52YWx1ZWApL2B0b2tlblByaWNlYCkNCiAgICAvLy8gICAgIEFueSByZW1haW5kZXIgb2YgZXRoZXIgaXMgY3JlZGl0ZWQgdG8gdGhlIGhvbGRlcidzIGBldGhlckJhbGFuY2VgDQogICAgZnVuY3Rpb24gcHVyY2hhc2UoKSBwYXlhYmxlIHJldHVybnMgKGJvb2wpOw0KDQogICAgLy8vIEBub3RpY2UgUmVkZWVtIGBfYW1vdW50YCB0b2tlbnMgYmFjayB0byB0aGUgY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVkZWVtDQogICAgLy8vIEBkZXYgZXRoZXIgPSBgX2Ftb3VudGAgKiBgZnVuZEJhbGFuY2UoKWAgLyBgdG90YWxTdXBwbHlgDQogICAgLy8vIEByZXR1cm4gc3VjY2VzcyBzdGF0ZQ0KICAgIGZ1bmN0aW9uIHJlZGVlbSh1aW50IF9hbW91bnQpIHJldHVybnMgKGJvb2wpOw0KDQovLw0KLy8gQmFsbG90IGZ1bmN0aW9ucw0KLy8NCg0KICAgIC8vLyBAbm90aWNlIFZvdGUgZm9yIGBfY2FuZGlkYXRlYCBhcyBwcmVmZXJyZWQgVHJ1c3RlZS4NCiAgICAvLy8gQHBhcmFtIF9jYW5kaWRhdGUgVGhlIGFkZHJlc3Mgb2YgdGhlIHByZWZlcnJlZCBob2xkZXINCiAgICAvLy8gQHJldHVybiBzdWNjZXNzIHN0YXRlDQogICAgZnVuY3Rpb24gdm90ZShhZGRyZXNzIF9jYW5kaWRhdGUpIHJldHVybnMgKGJvb2wpOw0KfQ0KDQpjb250cmFjdCBCYWt0IGlzIEJha3RJbnRlcmZhY2UNCnsNCiAgICBieXRlczMyIGNvbnN0YW50IHB1YmxpYyBWRVJTSU9OID0gIkJha3QgMC4zLjQtYmV0YSI7DQoNCi8vDQovLyBCYWt0IEZ1bmN0aW9ucw0KLy8NCg0KICAgIC8vIFNhbmRhbFN0cmFwcyBjb21wbGlhbnQgY29uc3RydWN0b3INCiAgICBmdW5jdGlvbiBCYWt0KGFkZHJlc3MgX2NyZWF0b3IsIGJ5dGVzMzIgX3JlZ05hbWUsIGFkZHJlc3MgX3RydXN0ZWUpDQogICAgew0KICAgICAgICByZWdOYW1lID0gX3JlZ05hbWU7DQogICAgICAgIHRydXN0ZWUgPSBfdHJ1c3RlZSAhPSAweDAgPyBfdHJ1c3RlZSA6IA0KICAgICAgICAgICAgICAgIF9jcmVhdG9yICE9IDB4MCA/IF9jcmVhdG9yIDogbXNnLnNlbmRlcjsNCiAgICAgICAgam9pbih0cnVzdGVlKTsNCiAgICB9DQoNCiAgICAvLyBBY2NlcHQgcGF5bWVudCB0byB0aGUgZGVmYXVsdCBmdW5jdGlvbiBvbiB0aGUgY29uZGl0aW9uIHRoYXQNCiAgICAvLyBgYWNjZXB0aW5nUGF5bWVudHNgIGlzIHRydWUNCiAgICBmdW5jdGlvbigpDQogICAgICAgIHBheWFibGUNCiAgICB7DQogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCAmJg0KICAgICAgICAgICAgbXNnLnZhbHVlICsgdGhpcy5iYWxhbmNlIDwgTUFYRVRIRVIgJiYNCiAgICAgICAgICAgIGFjY2VwdGluZ1BheW1lbnRzKTsNCiAgICAgICAgRGVwb3NpdChtc2cudmFsdWUpOw0KICAgIH0NCg0KICAgIC8vIERlc3RydWN0b3INCiAgICAvLyBTZWxmZGVzdHJ1Y3RzIG9uIHRoZSBjb25kaXRpb24gdGhhdCBgdG90YWxTdXBwbHlgIGFuZCBgY29tbWl0dGVkRXRoZXJgDQogICAgLy8gYXJlIDANCiAgICBmdW5jdGlvbiBkZXN0cm95KCkNCiAgICAgICAgcHVibGljDQogICAgICAgIGNhbkVudGVyDQogICAgICAgIG9ubHlUcnVzdGVlDQogICAgew0KICAgICAgICByZXF1aXJlKHRvdGFsU3VwcGx5ID09IDAgJiYgY29tbWl0dGVkRXRoZXIgPT0gMCk7DQogICAgICAgIA0KICAgICAgICBkZWxldGUgaG9sZGVyc1t0cnVzdGVlXTsNCiAgICAgICAgc2VsZmRlc3RydWN0KG1zZy5zZW5kZXIpOw0KICAgIH0NCg0KICAgIC8vIE9uZSBUaW1lIFByb2dyYW1hYmxlIHNob3QgdG8gc2V0IHRoZSBwYW5pYyBhbmQgcGVuZGluZyBwZXJpb2RzLg0KICAgIC8vIDg2NDAwID09IDEgZGF5DQogICAgZnVuY3Rpb24gX2luaXQodWludDQwIF9wYW5pY1BlcmlvZEluU2Vjb25kcywgdWludDQwIF9wZW5kaW5nUGVyaW9kSW5TZWNvbmRzKQ0KICAgICAgICBvbmx5VHJ1c3RlZQ0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgcmVxdWlyZShfX2luaXRGdXNlKTsNCiAgICAgICAgUEFOSUNQRVJJT0QgPSBfcGFuaWNQZXJpb2RJblNlY29uZHM7DQogICAgICAgIFRYREVMQVkgPSBfcGVuZGluZ1BlcmlvZEluU2Vjb25kczsNCiAgICAgICAgYWNjZXB0aW5nUGF5bWVudHMgPSB0cnVlOw0KICAgICAgICBkZWxldGUgX19pbml0RnVzZTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8gUmV0dXJucyBjYWxjdWxhdGVkIGZ1bmQgYmFsYW5jZQ0KICAgIGZ1bmN0aW9uIGZ1bmRCYWxhbmNlKCkNCiAgICAgICAgcHVibGljDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIHJldHVybnMgKHVpbnQpDQogICAgew0KICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlIC0gY29tbWl0dGVkRXRoZXI7DQogICAgfQ0KDQogICAgLy8gUmV0dXJucyB0b2tlbiBwcmljZSBjb25zdGFudA0KICAgIGZ1bmN0aW9uIHRva2VuUHJpY2UoKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAodWludCkNCiAgICB7DQogICAgICAgIHJldHVybiBUT0tFTlBSSUNFOw0KICAgIH0NCg0KICAgIC8vIGBSZWdCYXNlYCBjb21wbGlhbnQgYGNoYW5nZVJlc291cmNlKClgIHRvIHJlc3RyaWN0IGNhbGxlciB0bw0KICAgIC8vIGB0cnVzdGVlYCByYXRoZXIgdGhhbiBgb3duZXJgDQogICAgZnVuY3Rpb24gY2hhbmdlUmVzb3VyY2UoYnl0ZXMzMiBfcmVzb3VyY2UpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBjYW5FbnRlcg0KICAgICAgICBvbmx5VHJ1c3RlZQ0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgcmVzb3VyY2UgPSBfcmVzb3VyY2U7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KLy8NCi8vIEVSQzIwIEFQSSBmdW5jdGlvbnMNCi8vDQoNCiAgICAvLyBSZXR1cm5zIGhvbGRlciB0b2tlbiBiYWxhbmNlDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX2FkZHIpIA0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAodWludCkNCiAgICB7DQogICAgICAgIHJldHVybiBob2xkZXJzW19hZGRyXS50b2tlbkJhbGFuY2U7DQogICAgfQ0KDQogICAgLy8gVG8gdHJhbnNmZXIgdG9rZW5zDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkNCiAgICAgICAgcHVibGljDQogICAgICAgIGNhbkVudGVyDQogICAgICAgIGlzSG9sZGVyKF90bykNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIEhvbGRlciBmcm9tID0gaG9sZGVyc1ttc2cuc2VuZGVyXTsNCiAgICAgICAgSG9sZGVyIHRvID0gaG9sZGVyc1tfdG9dOw0KDQogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB4ZmVyKGZyb20sIHRvLCBfYW1vdW50KTsNCiAgICB9DQoNCiAgICAvLyBUbyB0cmFuc2ZlciB0b2tlbnMgYnkgcHJveHkNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkNCiAgICAgICAgcHVibGljDQogICAgICAgIGNhbkVudGVyDQogICAgICAgIGlzSG9sZGVyKF90bykNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIHJlcXVpcmUoX2Ftb3VudCA8PSBob2xkZXJzW19mcm9tXS5hbGxvd2FuY2VzW21zZy5zZW5kZXJdKTsNCiAgICAgICAgDQogICAgICAgIEhvbGRlciBmcm9tID0gaG9sZGVyc1tfZnJvbV07DQogICAgICAgIEhvbGRlciB0byA9IGhvbGRlcnNbX3RvXTsNCg0KICAgICAgICBmcm9tLmFsbG93YW5jZXNbbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsNCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB4ZmVyKGZyb20sIHRvLCBfYW1vdW50KTsNCiAgICB9DQoNCiAgICAvLyBUbyBhcHByb3ZlIGEgcHJveHkgZm9yIHRva2VuIHRyYW5zZmVycw0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY2FuRW50ZXINCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIGhvbGRlcnNbbXNnLnNlbmRlcl0uYWxsb3dhbmNlc1tfc3BlbmRlcl0gPSBfYW1vdW50Ow0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vIFJldHVybiB0aGUgYWxsb2FuY2Ugb2YgYSBwcm94eQ0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAodWludDI1NikNCiAgICB7DQogICAgICAgIHJldHVybiBob2xkZXJzW19vd25lcl0uYWxsb3dhbmNlc1tfc3BlbmRlcl07DQogICAgfQ0KDQogICAgLy8gUHJvY2Vzc2VzIHRva2VuIHRyYW5zZmVycyBhbmQgc3Vic2VxdWVudCBjaGFuZ2UgaW4gdm90aW5nIHBvd2VyDQogICAgZnVuY3Rpb24geGZlcihIb2xkZXIgc3RvcmFnZSBfZnJvbSwgSG9sZGVyIHN0b3JhZ2UgX3RvLCB1aW50IF9hbW91bnQpDQogICAgICAgIGludGVybmFsDQogICAgICAgIHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgICAvLyBFbnN1cmUgZGl2aWRlbmRzIGFyZSB1cCB0byBkYXRlIGF0IGN1cnJlbnQgYmFsYW5jZXMNCiAgICAgICAgdXBkYXRlRGl2aWRlbmRzRm9yKF9mcm9tKTsNCiAgICAgICAgdXBkYXRlRGl2aWRlbmRzRm9yKF90byk7DQoNCiAgICAgICAgLy8gUmVtb3ZlIGV4aXN0aW5nIHZvdGVzDQogICAgICAgIHJldm9rZShfZnJvbSk7DQogICAgICAgIHJldm9rZShfdG8pOw0KDQogICAgICAgIC8vIFRyYW5zZmVyIHRva2Vucw0KICAgICAgICBfZnJvbS50b2tlbkJhbGFuY2UgLT0gX2Ftb3VudDsNCiAgICAgICAgX3RvLnRva2VuQmFsYW5jZSArPSBfYW1vdW50Ow0KDQogICAgICAgIC8vIFJldm90ZSBhY2NvcmluZyB0byBjaGFuZ2VkIHRva2VuIGJhbGFuY2VzDQogICAgICAgIHJldm90ZShfZnJvbSk7DQogICAgICAgIHJldm90ZShfdG8pOw0KDQogICAgICAgIC8vIEZvcmNlIGVsZWN0aW9uDQogICAgICAgIGVsZWN0aW9uKCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KLy8NCi8vIFNlY3VyaXR5IEZ1bmN0aW9ucw0KLy8NCg0KICAgIC8vIENhdXNlIHRoZSBjb250cmFjdCB0byBQYW5pYy4gVGhpcyB3aWxsIGJsb2NrIG1vc3Qgc3RhdGUgY2hhbmdpbmcNCiAgICAvLyBmdW5jdGlvbnMgZm9yIGEgc2V0IGRlbGF5Lg0KICAgIGZ1bmN0aW9uIFBBTklDKCkNCiAgICAgICAgcHVibGljDQogICAgICAgIGlzSG9sZGVyKG1zZy5zZW5kZXIpDQogICAgICAgIHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgICAvLyBBIGJsb2NraW5nIGhvbGRlciByZXF1aXJlcyBhdCBsZWFzdCAxMCUgb2YgdG9rZW5zDQogICAgICAgIHJlcXVpcmUoaG9sZGVyc1ttc2cuc2VuZGVyXS50b2tlbkJhbGFuY2UgPj0gdG90YWxTdXBwbHkgLyAxMCk7DQogICAgICAgIA0KICAgICAgICBwYW5pY2tlZCA9IHRydWU7DQogICAgICAgIHRpbWVUb0NhbG0gPSB1aW50NDAobm93ICsgUEFOSUNQRVJJT0QpOw0KICAgICAgICBQYW5pY2tlZChtc2cuc2VuZGVyKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8gUmVsZWFzZSB0aGUgY29udHJhY3QgZnJvbSBhIFBhbmljIGFmdGVyIHRoZSBwYW5pYyBwZXJpb2QgaGFzIGV4cGlyZWQuDQogICAgZnVuY3Rpb24gY2FsbSgpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBpc0hvbGRlcihtc2cuc2VuZGVyKQ0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgcmVxdWlyZSh1aW50NDAobm93KSA+IHRpbWVUb0NhbG0gJiYgcGFuaWNrZWQpOw0KICAgICAgICANCiAgICAgICAgcGFuaWNrZWQgPSBmYWxzZTsNCiAgICAgICAgQ2FsbSgpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLyBRdWV1ZXMgYSBwZW5kaW5nIHRyYW5zYWN0aW9uIA0KICAgIGZ1bmN0aW9uIHRpbWVMb2NrU2VuZChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKQ0KICAgICAgICBpbnRlcm5hbA0KICAgICAgICByZXR1cm5zICh1aW50OCkNCiAgICB7DQogICAgICAgIC8vIENoZWNrIHRoYXQgcXVldWUgaXMgbm90IGZ1bGwNCiAgICAgICAgcmVxdWlyZShwdHhIZWFkICsgMSAhPSBwdHhUYWlsKTsNCg0KICAgICAgICBUWCBtZW1vcnkgdHggPSBUWCh7DQogICAgICAgICAgICBmcm9tOiBfZnJvbSwNCiAgICAgICAgICAgIHRvOiBfdG8sDQogICAgICAgICAgICB2YWx1ZTogX3ZhbHVlLA0KICAgICAgICAgICAgZGF0YTogX2RhdGEsDQogICAgICAgICAgICBibG9ja2VkOiBmYWxzZSwNCiAgICAgICAgICAgIHRpbWVMb2NrOiB1aW50NDAobm93ICsgVFhERUxBWSkNCiAgICAgICAgfSk7DQogICAgICAgIFRyYW5zYWN0aW9uUGVuZGluZyhwdHhIZWFkLCBfZnJvbSwgX3RvLCBfdmFsdWUsIG5vdyArIFRYREVMQVkpOw0KICAgICAgICBwZW5kaW5nVHhzW3B0eEhlYWQrK10gPSB0eDsNCiAgICAgICAgcmV0dXJuICBwdHhIZWFkIC0gMTsNCiAgICB9DQoNCiAgICAvLyBFeGVjdXRlIHRoZSBmaXJzdCBUWCBpbiB0aGUgcGVuZGluZ1R4cyBxdWV1ZS4gVmFsdWVzIHdpbGwNCiAgICAvLyByZXZlcnQgaWYgdGhlIHRyYW5zYWN0aW9uIGlzIGJsb2NrZWQgb3IgZmFpbHMuDQogICAgZnVuY3Rpb24gc2VuZFBlbmRpbmcoKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgcHJldmVudFJlZW50cnkNCiAgICAgICAgaXNIb2xkZXIobXNnLnNlbmRlcikNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIGlmIChwdHhUYWlsID09IHB0eEhlYWQpIHJldHVybiBmYWxzZTsgLy8gVFggcXVldWUgaXMgZW1wdHkNCiAgICAgICAgDQogICAgICAgIFRYIG1lbW9yeSB0eCA9IHBlbmRpbmdUeHNbcHR4VGFpbF07DQogICAgICAgIGlmKG5vdyA8IHR4LnRpbWVMb2NrKSByZXR1cm4gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAvLyBIYXZlIG1lbW9yeSBjYWNoZWQgdGhlIFRYIHNvIGRlbGV0aW5nIHN0b3JlIG5vdyB0byBwcmV2ZW50IGFueSBjaGFuY2UNCiAgICAgICAgLy8gb2YgZG91YmxlIHNwZW5kcy4NCiAgICAgICAgZGVsZXRlIHBlbmRpbmdUeHNbcHR4VGFpbCsrXTsNCiAgICAgICAgDQogICAgICAgIGlmKCF0eC5ibG9ja2VkKSB7DQogICAgICAgICAgICBpZih0eC50by5jYWxsLnZhbHVlKHR4LnZhbHVlKSh0eC5kYXRhKSkgew0KICAgICAgICAgICAgICAgIC8vIFRYIHNlbnQgc3VjY2Vzc2Z1bGx5DQogICAgICAgICAgICAgICAgY29tbWl0dGVkRXRoZXIgLT0gdHgudmFsdWU7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgV2l0aGRyYXdhbCh0eC5mcm9tLCB0eC50bywgdHgudmFsdWUpOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBUWCBpcyBibG9ja2VkIG9yIGZhaWxlZCBzbyBtYW51YWxseSByZXZlcnQgYmFsYW5jZXMgdG8gcHJlLXBlbmRpbmcNCiAgICAgICAgLy8gc3RhdGUNCiAgICAgICAgaWYgKHR4LmZyb20gPT0gYWRkcmVzcyh0aGlzKSkgew0KICAgICAgICAgICAgLy8gV2FzIHNlbnQgZnJvbSBmdW5kIGJhbGFuY2UNCiAgICAgICAgICAgIGNvbW1pdHRlZEV0aGVyIC09IHR4LnZhbHVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gV2FzIHNlbnQgZnJvbSBob2xkZXIgZXRoZXIgYmFsYW5jZQ0KICAgICAgICAgICAgaG9sZGVyc1t0eC5mcm9tXS5ldGhlckJhbGFuY2UgKz0gdHgudmFsdWU7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIFRyYW5zYWN0aW9uRmFpbGVkKHR4LmZyb20sIHR4LnRvLCB0eC52YWx1ZSk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICAvLyBUbyBibG9jayBhIHBlbmRpbmcgdHJhbnNhY3Rpb24NCiAgICBmdW5jdGlvbiBibG9ja1BlbmRpbmdUeCh1aW50IF90eElkeCkNCiAgICAgICAgcHVibGljDQogICAgICAgIHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgICAvLyBPbmx5IHByZXZlbnQgcmVlbnRyeSBub3QgZW50cnkgZHVyaW5nIHBhbmljDQogICAgICAgIHJlcXVpcmUoIV9fcmVNdXRleCk7DQogICAgICAgIA0KICAgICAgICAvLyBBIGJsb2NraW5nIGhvbGRlciByZXF1aXJlcyBhdCBsZWFzdCAxMCUgb2YgdG9rZW5zIG9yIGlzIHRydXN0ZWUgb3INCiAgICAgICAgLy8gaXMgZnJvbSBvd24gYWNjb3VudA0KICAgICAgICByZXF1aXJlKGhvbGRlcnNbbXNnLnNlbmRlcl0udG9rZW5CYWxhbmNlID49IHRvdGFsU3VwcGx5IC8gQkxPQ0tQQ05UIHx8DQogICAgICAgICAgICBtc2cuc2VuZGVyID09IHBlbmRpbmdUeHNbcHR4VGFpbF0uZnJvbSB8fA0KICAgICAgICAgICAgbXNnLnNlbmRlciA9PSB0cnVzdGVlKTsNCiAgICAgICAgDQogICAgICAgIHBlbmRpbmdUeHNbX3R4SWR4XS5ibG9ja2VkID0gdHJ1ZTsNCiAgICAgICAgVHJhbnNhY3Rpb25CbG9ja2VkKG1zZy5zZW5kZXIsIF90eElkeCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KLy8NCi8vIFRydXN0ZWUgZnVuY3Rpb25zDQovLw0KDQogICAgLy8gRm9yIHRoZSB0cnVzdGVlIHRvIHNlbmQgYSB0cmFuc2FjdGlvbiBhcyB0aGUgY29udHJhY3QuIFJldHVybnMgcGVuZGluZw0KICAgIC8vIFRYIHF1ZXVlIGluZGV4DQogICAgZnVuY3Rpb24gZXhlY3V0ZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY2FuRW50ZXINCiAgICAgICAgb25seVRydXN0ZWUNCiAgICAgICAgcmV0dXJucyAodWludDgpDQogICAgew0KICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBmdW5kQmFsYW5jZSgpKTsNCg0KICAgICAgICBjb21taXR0ZWRFdGhlciArPSBfdmFsdWU7DQogICAgICAgIHJldHVybiB0aW1lTG9ja1NlbmQoYWRkcmVzcyh0aGlzKSwgX3RvLCBfdmFsdWUsIF9kYXRhKTsNCiAgICB9DQoNCiAgICAvLyBGb3IgdGhlIHRydXN0ZWUgdG8gY29tbWl0IGFuIGFtb3VudCBmcm9tIHRoZSBmdW5kIGJhbGFuY2UgYXMgYSBkaXZpZGVuZA0KICAgIGZ1bmN0aW9uIHBheURpdmlkZW5kcyh1aW50IF92YWx1ZSkNCiAgICAgICAgcHVibGljDQogICAgICAgIGNhbkVudGVyDQogICAgICAgIG9ubHlUcnVzdGVlDQogICAgICAgIHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBmdW5kQmFsYW5jZSgpKTsNCiAgICAgICAgLy8gQ2FsY3VsYXRlcyBkaXZpZGVuZCBhcyBwZXJjZW50IG9mIGN1cnJlbnQgYHRvdGFsU3VwcGx5YCBpbiAxMGUxNw0KICAgICAgICAvLyBmaXhlZCBwb2ludCBtYXRoDQogICAgICAgIGRpdmlkZW5kUG9pbnRzICs9IDEwKioxOCAqIF92YWx1ZSAvIHRvdGFsU3VwcGx5Ow0KICAgICAgICB0b3RhbERpdmlkZW5kcyArPSBfdmFsdWU7DQogICAgICAgIGNvbW1pdHRlZEV0aGVyICs9IF92YWx1ZTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KICAgIC8vIEZvciB0aGUgdHJ1c3RlZSB0byBhZGQgYW4gYWRkcmVzcyBhcyBhIGhvbGRlcg0KICAgIGZ1bmN0aW9uIGFkZEhvbGRlcihhZGRyZXNzIF9hZGRyKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY2FuRW50ZXINCiAgICAgICAgb25seVRydXN0ZWUNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIHJldHVybiBqb2luKF9hZGRyKTsNCiAgICB9DQoNCiAgICAvLyBDcmVhdGVzIGhvbGRlciBhY2NvdW50cy4gIENhbGxlZCBieSBhZGRIb2xkZXIoKSBhbmQgaXNzdWUoKQ0KICAgIGZ1bmN0aW9uIGpvaW4oYWRkcmVzcyBfYWRkcikNCiAgICAgICAgaW50ZXJuYWwNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIGlmKDAgIT0gaG9sZGVyc1tfYWRkcl0uaWQpIHJldHVybiB0cnVlOw0KICAgICAgICANCiAgICAgICAgcmVxdWlyZShfYWRkciAhPSBhZGRyZXNzKHRoaXMpKTsNCiAgICAgICAgDQogICAgICAgIHVpbnQ4IGlkOw0KICAgICAgICAvLyBTZWFyY2ggZm9yIHRoZSBmaXJzdCBhdmFpbGFibGUgc2xvdC4NCiAgICAgICAgd2hpbGUgKGhvbGRlckluZGV4WysraWRdICE9IDApIHt9DQogICAgICAgIA0KICAgICAgICAvLyBpZiBgaWRgIGlzIDAgdGhlbiB0aGVyZSBoYXMgYmVlbiBhIGFycmF5IGZ1bGwgb3ZlcmZsb3cuDQogICAgICAgIGlmKGlkID09IDApIHJldmVydCgpOw0KICAgICAgICANCiAgICAgICAgSG9sZGVyIGhvbGRlciA9IGhvbGRlcnNbX2FkZHJdOw0KICAgICAgICBob2xkZXIuaWQgPSBpZDsNCiAgICAgICAgaG9sZGVyLmxhc3RDbGFpbWVkID0gZGl2aWRlbmRQb2ludHM7DQogICAgICAgIGhvbGRlci52b3RpbmdGb3IgPSB0cnVzdGVlOw0KICAgICAgICBob2xkZXJJbmRleFtpZF0gPSBfYWRkcjsNCiAgICAgICAgTmV3SG9sZGVyKF9hZGRyKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8gRm9yIHRoZSB0cnVzdGVlIHRvIGFsbG93IG9yIGRpc2FsbG93IHBheW1lbnRzIG1hZGUgdG8gdGhlIEJha3QNCiAgICBmdW5jdGlvbiBhY2NlcHRQYXltZW50cyhib29sIF9hY2NlcHRpbmcpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBjYW5FbnRlcg0KICAgICAgICBvbmx5VHJ1c3RlZQ0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgYWNjZXB0aW5nUGF5bWVudHMgPSBfYWNjZXB0aW5nOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLyBGb3IgdGhlIHRydXN0ZWUgdG8gaXNzdWUgYW4gb2ZmZXIgb2YgbmV3IHRva2VucyB0byBhIGhvbGRlcg0KICAgIGZ1bmN0aW9uIGlzc3VlKGFkZHJlc3MgX2FkZHIsIHVpbnQgX2Ftb3VudCkNCiAgICAgICAgcHVibGljDQogICAgICAgIGNhbkVudGVyDQogICAgICAgIG9ubHlUcnVzdGVlDQogICAgICAgIHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgICAvLyBwcmV2ZW50IG92ZXJmbG93cyBpbiB0b3RhbCBzdXBwbHkNCiAgICAgICAgYXNzZXJ0KHRvdGFsU3VwcGx5ICsgX2Ftb3VudCA8IE1BWFRPS0VOUyk7DQogICAgICAgIA0KICAgICAgICBqb2luKF9hZGRyKTsNCiAgICAgICAgSG9sZGVyIGhvbGRlciA9IGhvbGRlcnNbX2FkZHJdOw0KICAgICAgICBob2xkZXIub2ZmZXJBbW91bnQgPSBfYW1vdW50Ow0KICAgICAgICBob2xkZXIub2ZmZXJFeHBpcnkgPSB1aW50NDAobm93ICsgNyBkYXlzKTsNCiAgICAgICAgSXNzdWVPZmZlcihfYWRkcik7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vIEZvciB0aGUgdHJ1c3RlZSB0byByZXZva2UgYW4gZWFybGllciBJc3N1ZSBPZmZlcg0KICAgIGZ1bmN0aW9uIHJldm9rZU9mZmVyKGFkZHJlc3MgX2FkZHIpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBjYW5FbnRlcg0KICAgICAgICBvbmx5VHJ1c3RlZQ0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgSG9sZGVyIGhvbGRlciA9IGhvbGRlcnNbX2FkZHJdOw0KICAgICAgICBkZWxldGUgaG9sZGVyLm9mZmVyQW1vdW50Ow0KICAgICAgICBkZWxldGUgaG9sZGVyLm9mZmVyRXhwaXJ5Ow0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCi8vDQovLyBIb2xkZXIgRnVuY3Rpb25zDQovLw0KDQogICAgLy8gUmV0dXJucyB0aGUgYXJyYXkgb2YgaG9sZGVyIGFkZHJlc3Nlcy4NCiAgICBmdW5jdGlvbiBnZXRIb2xkZXJzKCkNCiAgICAgICAgcHVibGljDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIHJldHVybnMoYWRkcmVzc1syNTZdKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuIGhvbGRlckluZGV4Ow0KICAgIH0NCg0KICAgIC8vIFJldHVybnMgdGhlIGhvbGRlcidzIHdpdGhkcmF3YWJsZSBiYWxhbmNlIG9mIGV0aGVyDQogICAgZnVuY3Rpb24gZXRoZXJCYWxhbmNlT2YoYWRkcmVzcyBfYWRkcikNCiAgICAgICAgcHVibGljDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIHJldHVybnMgKHVpbnQpDQogICAgew0KICAgICAgICBIb2xkZXIgaG9sZGVyID0gaG9sZGVyc1tfYWRkcl07DQogICAgICAgIHJldHVybiBob2xkZXIuZXRoZXJCYWxhbmNlICsgZGl2aWRlbmRzT3dpbmcoaG9sZGVyKTsNCiAgICB9DQoNCiAgICAvLyBGb3IgYSBob2xkZXIgdG8gaW5pdGlhdGUgYSB3aXRoZHJhd2FsIG9mIHRoZWlyIGV0aGVyIGJhbGFuY2UNCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBjYW5FbnRlcg0KICAgICAgICByZXR1cm5zKHVpbnQ4IHBUeElkXykNCiAgICB7DQogICAgICAgIEhvbGRlciBob2xkZXIgPSBob2xkZXJzW21zZy5zZW5kZXJdOw0KICAgICAgICB1cGRhdGVEaXZpZGVuZHNGb3IoaG9sZGVyKTsNCiAgICAgICAgDQogICAgICAgIHBUeElkXyA9IHRpbWVMb2NrU2VuZChtc2cuc2VuZGVyLCBtc2cuc2VuZGVyLCBob2xkZXIuZXRoZXJCYWxhbmNlLCAiIik7DQogICAgICAgIGhvbGRlci5ldGhlckJhbGFuY2UgPSAwOw0KICAgIH0NCg0KICAgIC8vIFRvIGNsb3NlIGEgaG9sZGVyIGFjY291bnQNCiAgICBmdW5jdGlvbiB2YWNhdGUoYWRkcmVzcyBfYWRkcikNCiAgICAgICAgcHVibGljDQogICAgICAgIGNhbkVudGVyDQogICAgICAgIGlzSG9sZGVyKG1zZy5zZW5kZXIpDQogICAgICAgIGlzSG9sZGVyKF9hZGRyKQ0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgSG9sZGVyIGhvbGRlciA9IGhvbGRlcnNbX2FkZHJdOw0KICAgICAgICAvLyBFbnN1cmUgaG9sZGVyIGFjY291bnQgaXMgZW1wdHksIGlzIG5vdCB0aGUgdHJ1c3RlZSBhbmQgdGhlcmUgYXJlIG5vDQogICAgICAgIC8vIHBlbmRpbmcgdHJhbnNhY3Rpb25zIG9yIGRpdmlkZW5kcw0KICAgICAgICByZXF1aXJlKF9hZGRyICE9IHRydXN0ZWUpOw0KICAgICAgICByZXF1aXJlKGhvbGRlci50b2tlbkJhbGFuY2UgPT0gMCk7DQogICAgICAgIHJlcXVpcmUoaG9sZGVyLmV0aGVyQmFsYW5jZSA9PSAwKTsNCiAgICAgICAgcmVxdWlyZShob2xkZXIubGFzdENsYWltZWQgPT0gZGl2aWRlbmRQb2ludHMpOw0KICAgICAgICByZXF1aXJlKHB0eEhlYWQgPT0gcHR4VGFpbCk7DQogICAgICAgIA0KICAgICAgICBkZWxldGUgaG9sZGVySW5kZXhbaG9sZGVyLmlkXTsNCiAgICAgICAgZGVsZXRlIGhvbGRlcnNbX2FkZHJdOw0KICAgICAgICAvLyBOQiBjYW4ndCBnYXJiYWdlIGNvbGxlY3QgaG9sZGVyLmFsbG93YW5jZXMgbWFwcGluZw0KICAgICAgICByZXR1cm4gKHRydWUpOw0KICAgIH0NCg0KLy8NCi8vIFRva2VuIENyZWF0aW9uL0Rlc3RydWN0aW9uIEZ1bmN0aW9ucw0KLy8NCg0KICAgIC8vIEZvciBhIGhvbGRlciB0byBidXkgYW4gb2ZmZXIgb2YgdG9rZW5zDQogICAgZnVuY3Rpb24gcHVyY2hhc2UoKQ0KICAgICAgICBwYXlhYmxlDQogICAgICAgIGNhbkVudGVyDQogICAgICAgIHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgICBIb2xkZXIgaG9sZGVyID0gaG9sZGVyc1ttc2cuc2VuZGVyXTsNCiAgICAgICAgLy8gb2ZmZXIgbXVzdCBleGlzdA0KICAgICAgICByZXF1aXJlKGhvbGRlci5vZmZlckFtb3VudCA+IDApOw0KICAgICAgICAvLyBvZmZlciBub3QgZXhwaXJlZA0KICAgICAgICByZXF1aXJlKGhvbGRlci5vZmZlckV4cGlyeSA+IG5vdyk7DQogICAgICAgIC8vIGNvcnJlY3QgcGF5bWVudCBoYXMgYmVlbiBzZW50DQogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IGhvbGRlci5vZmZlckFtb3VudCAqIFRPS0VOUFJJQ0UpOw0KICAgICAgICANCiAgICAgICAgdXBkYXRlRGl2aWRlbmRzRm9yKGhvbGRlcik7DQogICAgICAgICAgICAgICAgDQogICAgICAgIHJldm9rZShob2xkZXIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICB0b3RhbFN1cHBseSArPSBob2xkZXIub2ZmZXJBbW91bnQ7DQogICAgICAgIGhvbGRlci50b2tlbkJhbGFuY2UgKz0gaG9sZGVyLm9mZmVyQW1vdW50Ow0KICAgICAgICBUb2tlbnNDcmVhdGVkKG1zZy5zZW5kZXIsIGhvbGRlci5vZmZlckFtb3VudCk7DQogICAgICAgIA0KICAgICAgICBkZWxldGUgaG9sZGVyLm9mZmVyQW1vdW50Ow0KICAgICAgICBkZWxldGUgaG9sZGVyLm9mZmVyRXhwaXJ5Ow0KICAgICAgICANCiAgICAgICAgcmV2b3RlKGhvbGRlcik7DQogICAgICAgIGVsZWN0aW9uKCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vIEZvciBob2xkZXJzIHRvIGRlc3Ryb3kgdG9rZW5zIGluIHJldHVybiBmb3IgZXRoZXIgZHVyaW5nIGEgcmVkZWVtaW5nDQogICAgLy8gcm91bmQNCiAgICBmdW5jdGlvbiByZWRlZW0odWludCBfYW1vdW50KQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY2FuRW50ZXINCiAgICAgICAgaXNIb2xkZXIobXNnLnNlbmRlcikNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIHVpbnQgcmVkZWVtUHJpY2U7DQogICAgICAgIHVpbnQgZXRoOw0KICAgICAgICANCiAgICAgICAgSG9sZGVyIGhvbGRlciA9IGhvbGRlcnNbbXNnLnNlbmRlcl07DQogICAgICAgIHJlcXVpcmUoX2Ftb3VudCA8PSBob2xkZXIudG9rZW5CYWxhbmNlKTsNCiAgICAgICAgDQogICAgICAgIHVwZGF0ZURpdmlkZW5kc0Zvcihob2xkZXIpOw0KICAgICAgICANCiAgICAgICAgcmV2b2tlKGhvbGRlcik7DQogICAgICAgIA0KICAgICAgICByZWRlZW1QcmljZSA9IGZ1bmRCYWxhbmNlKCkgLyB0b3RhbFN1cHBseTsNCiAgICAgICAgLy8gcHJldmVudCByZWRlZW1pbmcgYWJvdmUgdG9rZW4gcHJpY2Ugd2hpY2ggd291bGQgYWxsb3cgYW4gYXJiaXRyYWdlDQogICAgICAgIC8vIGF0dGFjayBvbiB0aGUgZnVuZCBiYWxhbmNlDQogICAgICAgIHJlZGVlbVByaWNlID0gcmVkZWVtUHJpY2UgPCBUT0tFTlBSSUNFID8gcmVkZWVtUHJpY2UgOiBUT0tFTlBSSUNFOw0KICAgICAgICANCiAgICAgICAgZXRoID0gX2Ftb3VudCAqIHJlZGVlbVByaWNlOw0KICAgICAgICANCiAgICAgICAgLy8gd2lsbCB0aHJvdyBpZiBlaXRoZXIgYGFtb3VudGAgb3IgYHJlZGVlbVBSaWNlYCBhcmUgMA0KICAgICAgICByZXF1aXJlKGV0aCA+IDApOw0KICAgICAgICANCiAgICAgICAgdG90YWxTdXBwbHkgLT0gX2Ftb3VudDsNCiAgICAgICAgaG9sZGVyLnRva2VuQmFsYW5jZSAtPSBfYW1vdW50Ow0KICAgICAgICBob2xkZXIuZXRoZXJCYWxhbmNlICs9IGV0aDsNCiAgICAgICAgY29tbWl0dGVkRXRoZXIgKz0gZXRoOw0KICAgICAgICANCiAgICAgICAgVG9rZW5zRGVzdHJveWVkKG1zZy5zZW5kZXIsIF9hbW91bnQpOw0KICAgICAgICByZXZvdGUoaG9sZGVyKTsNCiAgICAgICAgZWxlY3Rpb24oKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQovLw0KLy8gRGl2aWRlbmQgRnVuY3Rpb25zDQovLw0KDQogICAgZnVuY3Rpb24gZGl2aWRlbmRzT3dpbmcoSG9sZGVyIHN0b3JhZ2UgX2hvbGRlcikNCiAgICAgICAgaW50ZXJuYWwNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAodWludCBfdmFsdWUpDQogICAgew0KICAgICAgICAvLyBDYWxjdWxhdGVzIG93ZWQgZGl2aWRlbmRzIGluIDEwZTE3IGZpeGVkIHBvaW50IG1hdGgNCiAgICAgICAgcmV0dXJuIChkaXZpZGVuZFBvaW50cyAtIF9ob2xkZXIubGFzdENsYWltZWQpICogX2hvbGRlci50b2tlbkJhbGFuY2UvDQogICAgICAgICAgICAxMCoqMTg7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHVwZGF0ZURpdmlkZW5kc0ZvcihIb2xkZXIgc3RvcmFnZSBfaG9sZGVyKQ0KICAgICAgICBpbnRlcm5hbA0KICAgIHsNCiAgICAgICAgX2hvbGRlci5ldGhlckJhbGFuY2UgKz0gZGl2aWRlbmRzT3dpbmcoX2hvbGRlcik7DQogICAgICAgIF9ob2xkZXIubGFzdENsYWltZWQgPSBkaXZpZGVuZFBvaW50czsNCiAgICB9DQoNCi8vDQovLyBCYWxsb3QgZnVuY3Rpb25zDQovLw0KDQogICAgLy8gVG8gdm90ZSBmb3IgYSBwcmVmZXJyZWQgVHJ1c3RlZS4NCiAgICBmdW5jdGlvbiB2b3RlKGFkZHJlc3MgX2NhbmRpZGF0ZSkNCiAgICAgICAgcHVibGljDQogICAgICAgIGlzSG9sZGVyKG1zZy5zZW5kZXIpDQogICAgICAgIGlzSG9sZGVyKF9jYW5kaWRhdGUpDQogICAgICAgIHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgICAvLyBPbmx5IHByZXZlbnQgcmVlbnRyeSBub3QgZW50cnkgZHVyaW5nIHBhbmljDQogICAgICAgIHJlcXVpcmUoIV9fcmVNdXRleCk7DQogICAgICAgIA0KICAgICAgICBIb2xkZXIgaG9sZGVyID0gaG9sZGVyc1ttc2cuc2VuZGVyXTsNCiAgICAgICAgcmV2b2tlKGhvbGRlcik7DQogICAgICAgIGhvbGRlci52b3RpbmdGb3IgPSBfY2FuZGlkYXRlOw0KICAgICAgICByZXZvdGUoaG9sZGVyKTsNCiAgICAgICAgZWxlY3Rpb24oKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8gTG9vcHMgdGhyb3VnaCBob2xkZXJzIHRvIGZpbmQgdGhlIGhvbGRlciB3aXRoIG1vc3Qgdm90ZXMgYW5kIGRlY2xhcmVzDQogICAgLy8gdGhlbSB0byBiZSB0aGUgRXhlY3V0aXZlOw0KICAgIGZ1bmN0aW9uIGVsZWN0aW9uKCkNCiAgICAgICAgaW50ZXJuYWwNCiAgICB7DQogICAgICAgIHVpbnQgbWF4Ow0KICAgICAgICB1aW50IHdpbm5lcjsNCiAgICAgICAgdWludCB2b3RlczsNCiAgICAgICAgdWludDggaTsNCiAgICAgICAgYWRkcmVzcyBhZGRyOw0KICAgICAgICANCiAgICAgICAgaWYgKDAgPT0gdG90YWxTdXBwbHkpIHJldHVybjsNCiAgICAgICAgDQogICAgICAgIHdoaWxlKCsraSAhPSAwKQ0KICAgICAgICB7DQogICAgICAgICAgICBhZGRyID0gaG9sZGVySW5kZXhbaV07DQogICAgICAgICAgICBpZiAoYWRkciAhPSAweDApIHsNCiAgICAgICAgICAgICAgICB2b3RlcyA9IGhvbGRlcnNbYWRkcl0udm90ZXM7DQogICAgICAgICAgICAgICAgaWYgKHZvdGVzID4gbWF4KSB7DQogICAgICAgICAgICAgICAgICAgIG1heCA9IHZvdGVzOw0KICAgICAgICAgICAgICAgICAgICB3aW5uZXIgPSBpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICB0cnVzdGVlID0gaG9sZGVySW5kZXhbd2lubmVyXTsNCiAgICAgICAgVHJ1c3RlZSh0cnVzdGVlKTsNCiAgICB9DQoNCiAgICAvLyBQdWxscyB2b3RlcyBmcm9tIHRoZSBwcmVmZXJyZWQgY2FuZGlkYXRlDQogICAgLy8gcmVxdWlyZWQgYmVmb3JlIGFueSBhZGp1c3RtZW50cyB0byBgdG9rZW5CYWxhbmNlYCBvciB2b3RlIHByZWZlcmVuY2UuDQogICAgZnVuY3Rpb24gcmV2b2tlKEhvbGRlciBfaG9sZGVyKQ0KICAgICAgICBpbnRlcm5hbA0KICAgIHsNCiAgICAgICAgaG9sZGVyc1tfaG9sZGVyLnZvdGluZ0Zvcl0udm90ZXMgLT0gX2hvbGRlci50b2tlbkJhbGFuY2U7DQogICAgfQ0KDQogICAgLy8gUGxhY2VzIHZvdGVzIHdpdGggcHJlZmVycmVkIGNhbmRpZGF0ZQ0KICAgIC8vIHJlcXVpcmVkIGFmdGVyIGFueSBhZGp1c3RtZW50cyB0byBgdG9rZW5CYWxhbmNlYCBvciB2b3RlIHByZWZlcmVuY2UuDQogICAgZnVuY3Rpb24gcmV2b3RlKEhvbGRlciBfaG9sZGVyKQ0KICAgICAgICBpbnRlcm5hbA0KICAgIHsNCiAgICAgICAgaG9sZGVyc1tfaG9sZGVyLnZvdGluZ0Zvcl0udm90ZXMgKz0gX2hvbGRlci50b2tlbkJhbGFuY2U7DQogICAgfQ0KDQovLw0KLy8gTW9kaWZpZXJzDQovLw0KDQogICAgLy8gQmxvY2tzIGlmIHJlZW50cnkgbXV0ZXggb3IgcGFuaWNrZWQgaXMgdHJ1ZSBvciBzZXRzIHJlbnRyeSBtdXRleCB0byB0cnVlDQogICAgbW9kaWZpZXIgcHJldmVudFJlZW50cnkoKSB7DQogICAgICAgIHJlcXVpcmUoIShfX3JlTXV0ZXggfHwgcGFuaWNrZWQgfHwgX19pbml0RnVzZSkpOw0KICAgICAgICBfX3JlTXV0ZXggPSB0cnVlOw0KICAgICAgICBfOw0KICAgICAgICBfX3JlTXV0ZXggPSBmYWxzZTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIEJsb2NrcyBpZiByZWVudHJ5IG11dGV4IG9yIHBhbmlja2VkIGlzIHRydWUNCiAgICBtb2RpZmllciBjYW5FbnRlcigpIHsNCiAgICAgICAgcmVxdWlyZSghKF9fcmVNdXRleCB8fCBwYW5pY2tlZCB8fCBfX2luaXRGdXNlKSk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLy8gQmxvY2tzIGlmICdfYWRkcicgaXMgbm90IGEgaG9sZGVyDQogICAgbW9kaWZpZXIgaXNIb2xkZXIoYWRkcmVzcyBfYWRkcikgew0KICAgICAgICByZXF1aXJlKDAgIT0gaG9sZGVyc1tfYWRkcl0uaWQpOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8vIEJsb2NrIG5vbi10cnVzdGVlIGhvbGRlcnMNCiAgICBtb2RpZmllciBvbmx5VHJ1c3RlZSgpIHsNCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHRydXN0ZWUpOw0KICAgICAgICBfOw0KICAgIH0NCn0NCg0KDQovLyBTYW5kYWxTdHJhcHMgY29tcGxpYW50IGZhY3RvcnkgZm9yIEJha3QNCmNvbnRyYWN0IEJha3RGYWN0b3J5IGlzIEZhY3RvcnkNCnsNCiAgICAvLyBMaXZlOiAweGM3YzExZWI2OTgzNzg3ZjdhYTBjMjBhYmVlYWM4MTAxY2Y2MjFlNDcNCiAgICAvLyBodHRwczovL2V0aGVyc2Nhbi5pby9hZGRyZXNzLzB4YzdjMTFlYjY5ODM3ODdmN2FhMGMyMGFiZWVhYzgxMDFjZjYyMWU0Nw0KICAgIC8vIFJvcHN0ZW46IDB4ZGEzMzEyOTQ2NDY4OGI3YmQ3NTJjZTY0ZTllZDZiY2E2NWY0NDkwMiAoY291bGQgbm90IHZlcmlmeSksDQogICAgLy8gICAgICAgICAgMHgxOTEyNGRiYWIzZmNiYTc4YjhkMjQwZWQyZjJlYjg3NjU0ZTI1MmQ0DQogICAgLy8gUmlua2VieTogDQoNCi8qIENvbnN0YW50cyAqLw0KDQogICAgYnl0ZXMzMiBjb25zdGFudCBwdWJsaWMgcmVnTmFtZSA9ICJCYWt0IjsNCiAgICBieXRlczMyIGNvbnN0YW50IHB1YmxpYyBWRVJTSU9OID0gIkJha3QgRmFjdG9yeSB2MC4zLjQtYmV0YSI7DQoNCi8qIENvbnN0cnVjdG9yIERlc3RydWN0b3IqLw0KDQogICAgZnVuY3Rpb24gQmFrdEZhY3RvcnkoYWRkcmVzcyBfY3JlYXRvciwgYnl0ZXMzMiBfcmVnTmFtZSwgYWRkcmVzcyBfb3duZXIpDQogICAgICAgIEZhY3RvcnkoX2NyZWF0b3IsIF9yZWdOYW1lLCBfb3duZXIpDQogICAgew0KICAgICAgICAvLyBub3RoaW5nIHRvIGNvbnN0cnVjdA0KICAgIH0NCg0KLyogUHVibGljIEZ1bmN0aW9ucyAqLw0KDQogICAgZnVuY3Rpb24gY3JlYXRlTmV3KGJ5dGVzMzIgX3JlZ05hbWUsIGFkZHJlc3MgX293bmVyKQ0KICAgICAgICBwYXlhYmxlDQogICAgICAgIGZlZVBhaWQNCiAgICAgICAgcmV0dXJucyAoYWRkcmVzcyBrQWRkcl8pDQogICAgew0KICAgICAgICByZXF1aXJlKF9yZWdOYW1lICE9IDB4MCk7DQogICAgICAgIGtBZGRyXyA9IG5ldyBCYWt0KG93bmVyLCBfcmVnTmFtZSwgbXNnLnNlbmRlcik7DQogICAgICAgIENyZWF0ZWQobXNnLnNlbmRlciwgX3JlZ05hbWUsIGtBZGRyXyk7DQogICAgfQ0KfQ=='