base 64 content
base64bancorChanger
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLyoNCiAgICBPdmVyZmxvdyBwcm90ZWN0ZWQgbWF0aCBmdW5jdGlvbnMNCiovDQpjb250cmFjdCBTYWZlTWF0aCB7DQogICAgLyoqDQogICAgICAgIGNvbnN0cnVjdG9yDQogICAgKi8NCiAgICBmdW5jdGlvbiBTYWZlTWF0aCgpIHsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBzdW0gb2YgX3ggYW5kIF95LCBhc3NlcnRzIGlmIHRoZSBjYWxjdWxhdGlvbiBvdmVyZmxvd3MNCg0KICAgICAgICBAcGFyYW0gX3ggICB2YWx1ZSAxDQogICAgICAgIEBwYXJhbSBfeSAgIHZhbHVlIDINCg0KICAgICAgICBAcmV0dXJuIHN1bQ0KICAgICovDQogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIHVpbnQyNTYgeiA9IF94ICsgX3k7DQogICAgICAgIGFzc2VydCh6ID49IF94KTsNCiAgICAgICAgcmV0dXJuIHo7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZGlmZmVyZW5jZSBvZiBfeCBtaW51cyBfeSwgYXNzZXJ0cyBpZiB0aGUgc3VidHJhY3Rpb24gcmVzdWx0cyBpbiBhIG5lZ2F0aXZlIG51bWJlcg0KDQogICAgICAgIEBwYXJhbSBfeCAgIG1pbnVlbmQNCiAgICAgICAgQHBhcmFtIF95ICAgc3VidHJhaGVuZA0KDQogICAgICAgIEByZXR1cm4gZGlmZmVyZW5jZQ0KICAgICovDQogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIGFzc2VydChfeCA+PSBfeSk7DQogICAgICAgIHJldHVybiBfeCAtIF95Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IHJldHVybnMgdGhlIHByb2R1Y3Qgb2YgbXVsdGlwbHlpbmcgX3ggYnkgX3ksIGFzc2VydHMgaWYgdGhlIGNhbGN1bGF0aW9uIG92ZXJmbG93cw0KDQogICAgICAgIEBwYXJhbSBfeCAgIGZhY3RvciAxDQogICAgICAgIEBwYXJhbSBfeSAgIGZhY3RvciAyDQoNCiAgICAgICAgQHJldHVybiBwcm9kdWN0DQogICAgKi8NCiAgICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgdWludDI1NiB6ID0gX3ggKiBfeTsNCiAgICAgICAgYXNzZXJ0KF94ID09IDAgfHwgeiAvIF94ID09IF95KTsNCiAgICAgICAgcmV0dXJuIHo7DQogICAgfQ0KfQ0KDQovKg0KICAgIE93bmVkIGNvbnRyYWN0IGludGVyZmFjZQ0KKi8NCmNvbnRyYWN0IElPd25lZCB7DQogICAgLy8gdGhpcyBmdW5jdGlvbiBpc24ndCBhYnN0cmFjdCBzaW5jZSB0aGUgY29tcGlsZXIgZW1pdHMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgZ2V0dGVyIGZ1bmN0aW9ucyBhcyBleHRlcm5hbA0KICAgIGZ1bmN0aW9uIG93bmVyKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpIHsgb3duZXI7IH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWM7DQogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgcHVibGljOw0KfQ0KDQovKg0KICAgIFByb3ZpZGVzIHN1cHBvcnQgYW5kIHV0aWxpdGllcyBmb3IgY29udHJhY3Qgb3duZXJzaGlwDQoqLw0KY29udHJhY3QgT3duZWQgaXMgSU93bmVkIHsNCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsNCg0KICAgIGV2ZW50IE93bmVyVXBkYXRlKGFkZHJlc3MgX3ByZXZPd25lciwgYWRkcmVzcyBfbmV3T3duZXIpOw0KDQogICAgLyoqDQogICAgICAgIEBkZXYgY29uc3RydWN0b3INCiAgICAqLw0KICAgIGZ1bmN0aW9uIE93bmVkKCkgew0KICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogICAgfQ0KDQogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBieSB0aGUgb3duZXIgb25seQ0KICAgIG1vZGlmaWVyIG93bmVyT25seSB7DQogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IG93bmVyKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBhbGxvd3MgdHJhbnNmZXJyaW5nIHRoZSBjb250cmFjdCBvd25lcnNoaXANCiAgICAgICAgdGhlIG5ldyBvd25lciBzdGlsbCBuZWVkIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXINCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcg0KDQogICAgICAgIEBwYXJhbSBfbmV3T3duZXIgICAgbmV3IGNvbnRyYWN0IG93bmVyDQogICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG93bmVyT25seSB7DQogICAgICAgIHJlcXVpcmUoX25ld093bmVyICE9IG93bmVyKTsNCiAgICAgICAgbmV3T3duZXIgPSBfbmV3T3duZXI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgdXNlZCBieSBhIG5ldyBvd25lciB0byBhY2NlcHQgYW4gb3duZXJzaGlwIHRyYW5zZmVyDQogICAgKi8NCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBwdWJsaWMgew0KICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbmV3T3duZXIpOw0KICAgICAgICBPd25lclVwZGF0ZShvd25lciwgbmV3T3duZXIpOw0KICAgICAgICBvd25lciA9IG5ld093bmVyOw0KICAgICAgICBuZXdPd25lciA9IDB4MDsNCiAgICB9DQp9DQoNCi8qDQogICAgRVJDMjAgU3RhbmRhcmQgVG9rZW4gaW50ZXJmYWNlDQoqLw0KY29udHJhY3QgSUVSQzIwVG9rZW4gew0KICAgIC8vIHRoZXNlIGZ1bmN0aW9ucyBhcmVuJ3QgYWJzdHJhY3Qgc2luY2UgdGhlIGNvbXBpbGVyIGVtaXRzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGdldHRlciBmdW5jdGlvbnMgYXMgZXh0ZXJuYWwNCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBuYW1lKSB7IG5hbWU7IH0NCiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCkgeyBzeW1ib2w7IH0NCiAgICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCBkZWNpbWFscykgeyBkZWNpbWFsczsgfQ0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWxTdXBwbHkpIHsgdG90YWxTdXBwbHk7IH0NCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsgX293bmVyOyBiYWxhbmNlOyB9DQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsgX293bmVyOyBfc3BlbmRlcjsgcmVtYWluaW5nOyB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KfQ0KDQovKg0KICAgIFRva2VuIEhvbGRlciBpbnRlcmZhY2UNCiovDQpjb250cmFjdCBJVG9rZW5Ib2xkZXIgaXMgSU93bmVkIHsNCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucyhJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsNCn0NCg0KLyoNCiAgICBXZSBjb25zaWRlciBldmVyeSBjb250cmFjdCB0byBiZSBhICd0b2tlbiBob2xkZXInIHNpbmNlIGl0J3MgY3VycmVudGx5IG5vdCBwb3NzaWJsZQ0KICAgIGZvciBhIGNvbnRyYWN0IHRvIGRlbnkgcmVjZWl2aW5nIHRva2Vucy4NCg0KICAgIFRoZSBUb2tlbkhvbGRlcidzIGNvbnRyYWN0IHNvbGUgcHVycG9zZSBpcyB0byBwcm92aWRlIGEgc2FmZXR5IG1lY2hhbmlzbSB0aGF0IGFsbG93cw0KICAgIHRoZSBvd25lciB0byBzZW5kIHRva2VucyB0aGF0IHdlcmUgc2VudCB0byB0aGUgY29udHJhY3QgYnkgbWlzdGFrZSBiYWNrIHRvIHRoZWlyIHNlbmRlci4NCiovDQpjb250cmFjdCBUb2tlbkhvbGRlciBpcyBJVG9rZW5Ib2xkZXIsIE93bmVkIHsNCiAgICAvKioNCiAgICAgICAgQGRldiBjb25zdHJ1Y3Rvcg0KICAgICovDQogICAgZnVuY3Rpb24gVG9rZW5Ib2xkZXIoKSB7DQogICAgfQ0KDQogICAgLy8gdmFsaWRhdGVzIGFuIGFkZHJlc3MgLSBjdXJyZW50bHkgb25seSBjaGVja3MgdGhhdCBpdCBpc24ndCBudWxsDQogICAgbW9kaWZpZXIgdmFsaWRBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHsNCiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAweDApOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8vIHZlcmlmaWVzIHRoYXQgdGhlIGFkZHJlc3MgaXMgZGlmZmVyZW50IHRoYW4gdGhpcyBjb250cmFjdCBhZGRyZXNzDQogICAgbW9kaWZpZXIgbm90VGhpcyhhZGRyZXNzIF9hZGRyZXNzKSB7DQogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gYWRkcmVzcyh0aGlzKSk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgd2l0aGRyYXdzIHRva2VucyBoZWxkIGJ5IHRoZSBjb250cmFjdCBhbmQgc2VuZHMgdGhlbSB0byBhbiBhY2NvdW50DQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXINCg0KICAgICAgICBAcGFyYW0gX3Rva2VuICAgRVJDMjAgdG9rZW4gY29udHJhY3QgYWRkcmVzcw0KICAgICAgICBAcGFyYW0gX3RvICAgICAgYWNjb3VudCB0byByZWNlaXZlIHRoZSBuZXcgYW1vdW50DQogICAgICAgIEBwYXJhbSBfYW1vdW50ICBhbW91bnQgdG8gd2l0aGRyYXcNCiAgICAqLw0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKElFUkMyMFRva2VuIF90b2tlbiwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkNCiAgICAgICAgcHVibGljDQogICAgICAgIG93bmVyT25seQ0KICAgICAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQ0KICAgICAgICB2YWxpZEFkZHJlc3MoX3RvKQ0KICAgICAgICBub3RUaGlzKF90bykNCiAgICB7DQogICAgICAgIGFzc2VydChfdG9rZW4udHJhbnNmZXIoX3RvLCBfYW1vdW50KSk7DQogICAgfQ0KfQ0KDQovKg0KICAgIFNtYXJ0IFRva2VuIGludGVyZmFjZQ0KKi8NCmNvbnRyYWN0IElTbWFydFRva2VuIGlzIElUb2tlbkhvbGRlciwgSUVSQzIwVG9rZW4gew0KICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcnMoYm9vbCBfZGlzYWJsZSkgcHVibGljOw0KICAgIGZ1bmN0aW9uIGlzc3VlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsNCiAgICBmdW5jdGlvbiBkZXN0cm95KGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOw0KfQ0KDQovKg0KICAgIFRoZSBzbWFydCB0b2tlbiBjb250cm9sbGVyIGlzIGFuIHVwZ3JhZGFibGUgcGFydCBvZiB0aGUgc21hcnQgdG9rZW4gdGhhdCBhbGxvd3MNCiAgICBtb3JlIGZ1bmN0aW9uYWxpdHkgYXMgd2VsbCBhcyBmaXhlcyBmb3IgYnVncy9leHBsb2l0cy4NCiAgICBPbmNlIGl0IGFjY2VwdHMgb3duZXJzaGlwIG9mIHRoZSB0b2tlbiwgaXQgYmVjb21lcyB0aGUgdG9rZW4ncyBzb2xlIGNvbnRyb2xsZXINCiAgICB0aGF0IGNhbiBleGVjdXRlIGFueSBvZiBpdHMgZnVuY3Rpb25zLg0KDQogICAgVG8gdXBncmFkZSB0aGUgY29udHJvbGxlciwgb3duZXJzaGlwIG11c3QgYmUgdHJhbnNmZXJyZWQgdG8gYSBuZXcgY29udHJvbGxlciwgYWxvbmcgd2l0aA0KICAgIGFueSByZWxldmFudCBkYXRhLg0KDQogICAgVGhlIHNtYXJ0IHRva2VuIG11c3QgYmUgc2V0IG9uIGNvbnN0cnVjdGlvbiBhbmQgY2Fubm90IGJlIGNoYW5nZWQgYWZ0ZXJ3YXJkcy4NCiAgICBXcmFwcGVycyBhcmUgcHJvdmlkZWQgKGFzIG9wcG9zZWQgdG8gYSBzaW5nbGUgJ2V4ZWN1dGUnIGZ1bmN0aW9uKSBmb3IgZWFjaCBvZiB0aGUgdG9rZW4ncyBmdW5jdGlvbnMsIGZvciBlYXNpZXIgYWNjZXNzLg0KDQogICAgTm90ZSB0aGF0IHRoZSBjb250cm9sbGVyIGNhbiB0cmFuc2ZlciB0b2tlbiBvd25lcnNoaXAgdG8gYSBuZXcgY29udHJvbGxlciB0aGF0DQogICAgZG9lc24ndCBhbGxvdyBleGVjdXRpbmcgYW55IGZ1bmN0aW9uIG9uIHRoZSB0b2tlbiwgZm9yIGEgdHJ1c3RsZXNzIHNvbHV0aW9uLg0KICAgIERvaW5nIHRoYXQgd2lsbCBhbHNvIHJlbW92ZSB0aGUgb3duZXIncyBhYmlsaXR5IHRvIHVwZ3JhZGUgdGhlIGNvbnRyb2xsZXIuDQoqLw0KY29udHJhY3QgU21hcnRUb2tlbkNvbnRyb2xsZXIgaXMgVG9rZW5Ib2xkZXIgew0KICAgIElTbWFydFRva2VuIHB1YmxpYyB0b2tlbjsgICAvLyBzbWFydCB0b2tlbg0KDQogICAgLyoqDQogICAgICAgIEBkZXYgY29uc3RydWN0b3INCiAgICAqLw0KICAgIGZ1bmN0aW9uIFNtYXJ0VG9rZW5Db250cm9sbGVyKElTbWFydFRva2VuIF90b2tlbikNCiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikNCiAgICB7DQogICAgICAgIHRva2VuID0gX3Rva2VuOw0KICAgIH0NCg0KICAgIC8vIGVuc3VyZXMgdGhhdCB0aGUgY29udHJvbGxlciBpcyB0aGUgdG9rZW4ncyBvd25lcg0KICAgIG1vZGlmaWVyIGFjdGl2ZSgpIHsNCiAgICAgICAgYXNzZXJ0KHRva2VuLm93bmVyKCkgPT0gYWRkcmVzcyh0aGlzKSk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLy8gZW5zdXJlcyB0aGF0IHRoZSBjb250cm9sbGVyIGlzIG5vdCB0aGUgdG9rZW4ncyBvd25lcg0KICAgIG1vZGlmaWVyIGluYWN0aXZlKCkgew0KICAgICAgICBhc3NlcnQodG9rZW4ub3duZXIoKSAhPSBhZGRyZXNzKHRoaXMpKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBhbGxvd3MgdHJhbnNmZXJyaW5nIHRoZSB0b2tlbiBvd25lcnNoaXANCiAgICAgICAgdGhlIG5ldyBvd25lciBzdGlsbCBuZWVkIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXINCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcg0KDQogICAgICAgIEBwYXJhbSBfbmV3T3duZXIgICAgbmV3IHRva2VuIG93bmVyDQogICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRva2VuT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb3duZXJPbmx5IHsNCiAgICAgICAgdG9rZW4udHJhbnNmZXJPd25lcnNoaXAoX25ld093bmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiB1c2VkIGJ5IGEgbmV3IG93bmVyIHRvIGFjY2VwdCBhIHRva2VuIG93bmVyc2hpcCB0cmFuc2Zlcg0KICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyDQogICAgKi8NCiAgICBmdW5jdGlvbiBhY2NlcHRUb2tlbk93bmVyc2hpcCgpIHB1YmxpYyBvd25lck9ubHkgew0KICAgICAgICB0b2tlbi5hY2NlcHRPd25lcnNoaXAoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBkaXNhYmxlcy9lbmFibGVzIHRva2VuIHRyYW5zZmVycw0KICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyDQoNCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlICAgIHRydWUgdG8gZGlzYWJsZSB0cmFuc2ZlcnMsIGZhbHNlIHRvIGVuYWJsZSB0aGVtDQogICAgKi8NCiAgICBmdW5jdGlvbiBkaXNhYmxlVG9rZW5UcmFuc2ZlcnMoYm9vbCBfZGlzYWJsZSkgcHVibGljIG93bmVyT25seSB7DQogICAgICAgIHRva2VuLmRpc2FibGVUcmFuc2ZlcnMoX2Rpc2FibGUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGFsbG93cyB0aGUgb3duZXIgdG8gZXhlY3V0ZSB0aGUgdG9rZW4ncyBpc3N1ZSBmdW5jdGlvbg0KDQogICAgICAgIEBwYXJhbSBfdG8gICAgICAgICBhY2NvdW50IHRvIHJlY2VpdmUgdGhlIG5ldyBhbW91bnQNCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgIGFtb3VudCB0byBpbmNyZWFzZSB0aGUgc3VwcGx5IGJ5DQogICAgKi8NCiAgICBmdW5jdGlvbiBpc3N1ZVRva2VucyhhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgb3duZXJPbmx5IHsNCiAgICAgICAgdG9rZW4uaXNzdWUoX3RvLCBfYW1vdW50KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG93bmVyIHRvIGV4ZWN1dGUgdGhlIHRva2VuJ3MgZGVzdHJveSBmdW5jdGlvbg0KDQogICAgICAgIEBwYXJhbSBfZnJvbSAgICAgICBhY2NvdW50IHRvIHJlbW92ZSB0aGUgYW1vdW50IGZyb20NCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgIGFtb3VudCB0byBkZWNyZWFzZSB0aGUgc3VwcGx5IGJ5DQogICAgKi8NCiAgICBmdW5jdGlvbiBkZXN0cm95VG9rZW5zKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIG93bmVyT25seSB7DQogICAgICAgIHRva2VuLmRlc3Ryb3koX2Zyb20sIF9hbW91bnQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IHdpdGhkcmF3cyB0b2tlbnMgaGVsZCBieSB0aGUgdG9rZW4gYW5kIHNlbmRzIHRoZW0gdG8gYW4gYWNjb3VudA0KICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyDQoNCiAgICAgICAgQHBhcmFtIF90b2tlbiAgIEVSQzIwIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MNCiAgICAgICAgQHBhcmFtIF90byAgICAgIGFjY291bnQgdG8gcmVjZWl2ZSB0aGUgbmV3IGFtb3VudA0KICAgICAgICBAcGFyYW0gX2Ftb3VudCAgYW1vdW50IHRvIHdpdGhkcmF3DQogICAgKi8NCiAgICBmdW5jdGlvbiB3aXRoZHJhd0Zyb21Ub2tlbihJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvd25lck9ubHkgew0KICAgICAgICB0b2tlbi53aXRoZHJhd1Rva2VucyhfdG9rZW4sIF90bywgX2Ftb3VudCk7DQogICAgfQ0KfQ0KDQovKg0KICAgIEJhbmNvciBGb3JtdWxhIGludGVyZmFjZQ0KKi8NCmNvbnRyYWN0IElCYW5jb3JGb3JtdWxhIHsNCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVQdXJjaGFzZVJldHVybih1aW50MjU2IF9zdXBwbHksIHVpbnQyNTYgX3Jlc2VydmVCYWxhbmNlLCB1aW50MTYgX3Jlc2VydmVSYXRpbywgdWludDI1NiBfZGVwb3NpdEFtb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOw0KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVNhbGVSZXR1cm4odWludDI1NiBfc3VwcGx5LCB1aW50MjU2IF9yZXNlcnZlQmFsYW5jZSwgdWludDE2IF9yZXNlcnZlUmF0aW8sIHVpbnQyNTYgX3NlbGxBbW91bnQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsNCn0NCg0KLyoNCiAgICBFSVAyMjggVG9rZW4gQ2hhbmdlciBpbnRlcmZhY2UNCiovDQpjb250cmFjdCBJVG9rZW5DaGFuZ2VyIHsNCiAgICBmdW5jdGlvbiBjaGFuZ2VhYmxlVG9rZW5Db3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MTYgY291bnQpOw0KICAgIGZ1bmN0aW9uIGNoYW5nZWFibGVUb2tlbih1aW50MTYgX3Rva2VuSW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIHRva2VuQWRkcmVzcyk7DQogICAgZnVuY3Rpb24gZ2V0UmV0dXJuKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGFtb3VudCk7DQogICAgZnVuY3Rpb24gY2hhbmdlKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KTsNCn0NCg0KLyoNCiAgICBPcGVuIGlzc3VlczoNCiAgICAtIEFkZCBtaW5lciBmcm9udC1ydW5uaW5nIGF0dGFjayBwcm90ZWN0aW9uLiBUaGUgaXNzdWUgaXMgc29tZXdoYXQgbWl0aWdhdGVkIGJ5IHRoZSB1c2Ugb2YgX21pblJldHVybiB3aGVuIGNoYW5naW5nDQogICAgLSBQb3NzaWJseSBhZGQgZ2V0dGVycyBmb3IgcmVzZXJ2ZSBmaWVsZHMgc28gdGhhdCB0aGUgY2xpZW50IHdvbid0IG5lZWQgdG8gcmVseSBvbiB0aGUgb3JkZXIgaW4gdGhlIHN0cnVjdA0KKi8NCg0KLyoNCiAgICBCYW5jb3IgQ2hhbmdlciB2MC4xDQoNCiAgICBUaGUgQmFuY29yIHZlcnNpb24gb2YgdGhlIHRva2VuIGNoYW5nZXIsIGFsbG93cyBjaGFuZ2luZyBiZXR3ZWVuIGEgc21hcnQgdG9rZW4gYW5kIG90aGVyIEVSQzIwIHRva2VucyBhbmQgYmV0d2VlbiBkaWZmZXJlbnQgRVJDMjAgdG9rZW5zIGFuZCB0aGVtc2VsdmVzLg0KDQogICAgRVJDMjAgcmVzZXJ2ZSB0b2tlbiBiYWxhbmNlIGNhbiBiZSB2aXJ0dWFsLCBtZWFuaW5nIHRoYXQgdGhlIGNhbGN1bGF0aW9ucyBhcmUgYmFzZWQgb24gdGhlIHZpcnR1YWwgYmFsYW5jZSBpbnN0ZWFkIG9mIHJlbHlpbmcgb24NCiAgICB0aGUgYWN0dWFsIHJlc2VydmUgYmFsYW5jZS4gVGhpcyBpcyBhIHNlY3VyaXR5IG1lY2hhbmlzbSB0aGF0IHByZXZlbnRzIHRoZSBuZWVkIHRvIGtlZXAgYSB2ZXJ5IGxhcmdlIChhbmQgdmFsdWFibGUpIGJhbGFuY2UgaW4gYSBzaW5nbGUgY29udHJhY3QuDQoNCiAgICBUaGUgY2hhbmdlciBpcyB1cGdyYWRhYmxlIChqdXN0IGxpa2UgYW55IFNtYXJ0VG9rZW5Db250cm9sbGVyKS4NCg0KICAgIFdBUk5JTkc6IEl0IGlzIE5PVCBSRUNPTU1FTkRFRCB0byB1c2UgdGhlIGNoYW5nZXIgd2l0aCBTbWFydCBUb2tlbnMgdGhhdCBoYXZlIGxlc3MgdGhhbiA4IGRlY2ltYWwgZGlnaXRzDQogICAgICAgICAgICAgb3Igd2l0aCB2ZXJ5IHNtYWxsIG51bWJlcnMgYmVjYXVzZSBvZiBwcmVjaXNpb24gbG9zcw0KKi8NCmNvbnRyYWN0IEJhbmNvckNoYW5nZXIgaXMgSVRva2VuQ2hhbmdlciwgU21hcnRUb2tlbkNvbnRyb2xsZXIsIFNhZmVNYXRoIHsNCiAgICBzdHJ1Y3QgUmVzZXJ2ZSB7DQogICAgICAgIHVpbnQyNTYgdmlydHVhbEJhbGFuY2U7ICAgICAgICAgLy8gdmlydHVhbCBiYWxhbmNlDQogICAgICAgIHVpbnQ4IHJhdGlvOyAgICAgICAgICAgICAgICAgICAgLy8gY29uc3RhbnQgcmVzZXJ2ZSByYXRpbyAoQ1JSKSwgMS0xMDANCiAgICAgICAgYm9vbCBpc1ZpcnR1YWxCYWxhbmNlRW5hYmxlZDsgICAvLyB0cnVlIGlmIHZpcnR1YWwgYmFsYW5jZSBpcyBlbmFibGVkLCBmYWxzZSBpZiBub3QNCiAgICAgICAgYm9vbCBpc1B1cmNoYXNlRW5hYmxlZDsgICAgICAgICAvLyBpcyBwdXJjaGFzZSBvZiB0aGUgc21hcnQgdG9rZW4gZW5hYmxlZCB3aXRoIHRoZSByZXNlcnZlLCBjYW4gYmUgc2V0IGJ5IHRoZSB0b2tlbiBvd25lcg0KICAgICAgICBib29sIGlzU2V0OyAgICAgICAgICAgICAgICAgICAgIC8vIHVzZWQgdG8gdGVsbCBpZiB0aGUgbWFwcGluZyBlbGVtZW50IGlzIGRlZmluZWQNCiAgICB9DQoNCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnMC4xJzsNCiAgICBzdHJpbmcgcHVibGljIGNoYW5nZXJUeXBlID0gJ2JhbmNvcic7DQoNCiAgICBJQmFuY29yRm9ybXVsYSBwdWJsaWMgZm9ybXVsYTsgICAgICAgICAgICAgICAgICAvLyBiYW5jb3IgY2FsY3VsYXRpb24gZm9ybXVsYSBjb250cmFjdA0KICAgIGFkZHJlc3NbXSBwdWJsaWMgcmVzZXJ2ZVRva2VuczsgICAgICAgICAgICAgICAgIC8vIEVSQzIwIHN0YW5kYXJkIHRva2VuIGFkZHJlc3Nlcw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gUmVzZXJ2ZSkgcHVibGljIHJlc2VydmVzOyAgIC8vIHJlc2VydmUgdG9rZW4gYWRkcmVzc2VzIC0+IHJlc2VydmUgZGF0YQ0KICAgIHVpbnQ4IHByaXZhdGUgdG90YWxSZXNlcnZlUmF0aW8gPSAwOyAgICAgICAgICAgIC8vIHVzZWQgdG8gcHJldmVudCBpbmNyZWFzaW5nIHRoZSB0b3RhbCByZXNlcnZlIHJhdGlvIGFib3ZlIDEwMCUgZWZmaWNpZW50bHkNCg0KICAgIC8vIHRyaWdnZXJlZCB3aGVuIGEgY2hhbmdlIGJldHdlZW4gdHdvIHRva2VucyBvY2N1cnMNCiAgICBldmVudCBDaGFuZ2UoYWRkcmVzcyBpbmRleGVkIF9mcm9tVG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfdG9Ub2tlbiwgYWRkcmVzcyBpbmRleGVkIF90cmFkZXIsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfcmV0dXJuKTsNCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGNvbnN0cnVjdG9yDQoNCiAgICAgICAgQHBhcmFtIF90b2tlbiAgICAgIHNtYXJ0IHRva2VuIGdvdmVybmVkIGJ5IHRoZSBjaGFuZ2VyDQogICAgICAgIEBwYXJhbSBfZm9ybXVsYSAgICBhZGRyZXNzIG9mIGEgYmFuY29yIGZvcm11bGEgY29udHJhY3QNCiAgICAqLw0KICAgIGZ1bmN0aW9uIEJhbmNvckNoYW5nZXIoSVNtYXJ0VG9rZW4gX3Rva2VuLCBJQmFuY29yRm9ybXVsYSBfZm9ybXVsYSwgSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDggX3Jlc2VydmVSYXRpbykNCiAgICAgICAgU21hcnRUb2tlbkNvbnRyb2xsZXIoX3Rva2VuKQ0KICAgICAgICB2YWxpZEFkZHJlc3MoX2Zvcm11bGEpDQogICAgew0KICAgICAgICBmb3JtdWxhID0gX2Zvcm11bGE7DQoNCiAgICAgICAgaWYgKGFkZHJlc3MoX3Jlc2VydmVUb2tlbikgIT0gMHgwKQ0KICAgICAgICAgICAgYWRkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuLCBfcmVzZXJ2ZVJhdGlvLCBmYWxzZSk7DQogICAgfQ0KDQogICAgLy8gdmVyaWZpZXMgdGhhdCBhbiBhbW91bnQgaXMgZ3JlYXRlciB0aGFuIHplcm8NCiAgICBtb2RpZmllciB2YWxpZEFtb3VudCh1aW50MjU2IF9hbW91bnQpIHsNCiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLy8gdmFsaWRhdGVzIGEgcmVzZXJ2ZSB0b2tlbiBhZGRyZXNzIC0gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBiZWxvbmdzIHRvIG9uZSBvZiB0aGUgcmVzZXJ2ZSB0b2tlbnMNCiAgICBtb2RpZmllciB2YWxpZFJlc2VydmUoYWRkcmVzcyBfYWRkcmVzcykgew0KICAgICAgICByZXF1aXJlKHJlc2VydmVzW19hZGRyZXNzXS5pc1NldCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLy8gdmFsaWRhdGVzIGEgdG9rZW4gYWRkcmVzcyAtIHZlcmlmaWVzIHRoYXQgdGhlIGFkZHJlc3MgYmVsb25ncyB0byBvbmUgb2YgdGhlIGNoYW5nZWFibGUgdG9rZW5zDQogICAgbW9kaWZpZXIgdmFsaWRUb2tlbihhZGRyZXNzIF9hZGRyZXNzKSB7DQogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgPT0gYWRkcmVzcyh0b2tlbikgfHwgcmVzZXJ2ZXNbX2FkZHJlc3NdLmlzU2V0KTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvLyB2YWxpZGF0ZXMgcmVzZXJ2ZSByYXRpbyByYW5nZQ0KICAgIG1vZGlmaWVyIHZhbGlkUmVzZXJ2ZVJhdGlvKHVpbnQ4IF9yYXRpbykgew0KICAgICAgICByZXF1aXJlKF9yYXRpbyA+IDAgJiYgX3JhdGlvIDw9IDEwMCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgbnVtYmVyIG9mIHJlc2VydmUgdG9rZW5zIGRlZmluZWQNCg0KICAgICAgICBAcmV0dXJuIG51bWJlciBvZiByZXNlcnZlIHRva2Vucw0KICAgICovDQogICAgZnVuY3Rpb24gcmVzZXJ2ZVRva2VuQ291bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDE2IGNvdW50KSB7DQogICAgICAgIHJldHVybiB1aW50MTYocmVzZXJ2ZVRva2Vucy5sZW5ndGgpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IHJldHVybnMgdGhlIG51bWJlciBvZiBjaGFuZ2VhYmxlIHRva2VucyBzdXBwb3J0ZWQgYnkgdGhlIGNvbnRyYWN0DQogICAgICAgIG5vdGUgdGhhdCB0aGUgbnVtYmVyIG9mIGNoYW5nZWFibGUgdG9rZW5zIGlzIHRoZSBudW1iZXIgb2YgcmVzZXJ2ZSB0b2tlbiwgcGx1cyAxICh0aGF0IHJlcHJlc2VudHMgdGhlIHNtYXJ0IHRva2VuKQ0KDQogICAgICAgIEByZXR1cm4gbnVtYmVyIG9mIGNoYW5nZWFibGUgdG9rZW5zDQogICAgKi8NCiAgICBmdW5jdGlvbiBjaGFuZ2VhYmxlVG9rZW5Db3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MTYgY291bnQpIHsNCiAgICAgICAgcmV0dXJuIHJlc2VydmVUb2tlbkNvdW50KCkgKyAxOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGdpdmVuIGEgY2hhbmdlYWJsZSB0b2tlbiBpbmRleCwgcmV0dXJucyB0aGUgY2hhbmdlYWJsZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzDQoNCiAgICAgICAgQHBhcmFtIF90b2tlbkluZGV4ICBjaGFuZ2VhYmxlIHRva2VuIGluZGV4DQoNCiAgICAgICAgQHJldHVybiBudW1iZXIgb2YgY2hhbmdlYWJsZSB0b2tlbnMNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGNoYW5nZWFibGVUb2tlbih1aW50MTYgX3Rva2VuSW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIHRva2VuQWRkcmVzcykgew0KICAgICAgICBpZiAoX3Rva2VuSW5kZXggPT0gMCkNCiAgICAgICAgICAgIHJldHVybiB0b2tlbjsNCiAgICAgICAgcmV0dXJuIHJlc2VydmVUb2tlbnNbX3Rva2VuSW5kZXggLSAxXTsNCiAgICB9DQoNCiAgICAvKg0KICAgICAgICBAZGV2IGFsbG93cyB0aGUgb3duZXIgdG8gdXBkYXRlIHRoZSBmb3JtdWxhIGNvbnRyYWN0IGFkZHJlc3MNCg0KICAgICAgICBAcGFyYW0gX2Zvcm11bGEgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBmb3JtdWxhIGNvbnRyYWN0DQogICAgKi8NCiAgICBmdW5jdGlvbiBzZXRGb3JtdWxhKElCYW5jb3JGb3JtdWxhIF9mb3JtdWxhKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgb3duZXJPbmx5DQogICAgICAgIHZhbGlkQWRkcmVzcyhfZm9ybXVsYSkNCiAgICAgICAgbm90VGhpcyhfZm9ybXVsYSkNCiAgICB7DQogICAgICAgIHJlcXVpcmUoX2Zvcm11bGEgIT0gZm9ybXVsYSk7IC8vIHZhbGlkYXRlIGlucHV0DQogICAgICAgIGZvcm11bGEgPSBfZm9ybXVsYTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBkZWZpbmVzIGEgbmV3IHJlc2VydmUgZm9yIHRoZSB0b2tlbg0KICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIHRva2VuIG93bmVyIHdoaWxlIHRoZSBjaGFuZ2VyIGlzIGluYWN0aXZlDQoNCiAgICAgICAgQHBhcmFtIF90b2tlbiAgICAgICAgICAgICAgICAgIGFkZHJlc3Mgb2YgdGhlIHJlc2VydmUgdG9rZW4NCiAgICAgICAgQHBhcmFtIF9yYXRpbyAgICAgICAgICAgICAgICAgIGNvbnN0YW50IHJlc2VydmUgcmF0aW8sIDEtMTAwDQogICAgICAgIEBwYXJhbSBfZW5hYmxlVmlydHVhbEJhbGFuY2UgICB0cnVlIHRvIGVuYWJsZSB2aXJ0dWFsIGJhbGFuY2UgZm9yIHRoZSByZXNlcnZlLCBmYWxzZSB0byBkaXNhYmxlIGl0DQogICAgKi8NCiAgICBmdW5jdGlvbiBhZGRSZXNlcnZlKElFUkMyMFRva2VuIF90b2tlbiwgdWludDggX3JhdGlvLCBib29sIF9lbmFibGVWaXJ0dWFsQmFsYW5jZSkNCiAgICAgICAgcHVibGljDQogICAgICAgIG93bmVyT25seQ0KICAgICAgICBpbmFjdGl2ZQ0KICAgICAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQ0KICAgICAgICBub3RUaGlzKF90b2tlbikNCiAgICAgICAgdmFsaWRSZXNlcnZlUmF0aW8oX3JhdGlvKQ0KICAgIHsNCiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcyh0b2tlbikgJiYgIXJlc2VydmVzW190b2tlbl0uaXNTZXQgJiYgdG90YWxSZXNlcnZlUmF0aW8gKyBfcmF0aW8gPD0gMTAwKTsgLy8gdmFsaWRhdGUgaW5wdXQNCg0KICAgICAgICByZXNlcnZlc1tfdG9rZW5dLnZpcnR1YWxCYWxhbmNlID0gMDsNCiAgICAgICAgcmVzZXJ2ZXNbX3Rva2VuXS5yYXRpbyA9IF9yYXRpbzsNCiAgICAgICAgcmVzZXJ2ZXNbX3Rva2VuXS5pc1ZpcnR1YWxCYWxhbmNlRW5hYmxlZCA9IF9lbmFibGVWaXJ0dWFsQmFsYW5jZTsNCiAgICAgICAgcmVzZXJ2ZXNbX3Rva2VuXS5pc1B1cmNoYXNlRW5hYmxlZCA9IHRydWU7DQogICAgICAgIHJlc2VydmVzW190b2tlbl0uaXNTZXQgPSB0cnVlOw0KICAgICAgICByZXNlcnZlVG9rZW5zLnB1c2goX3Rva2VuKTsNCiAgICAgICAgdG90YWxSZXNlcnZlUmF0aW8gKz0gX3JhdGlvOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IHVwZGF0ZXMgb25lIG9mIHRoZSB0b2tlbiByZXNlcnZlcw0KICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIHRva2VuIG93bmVyDQoNCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICAgICAgICAgIGFkZHJlc3Mgb2YgdGhlIHJlc2VydmUgdG9rZW4NCiAgICAgICAgQHBhcmFtIF9yYXRpbyAgICAgICAgICAgICAgICAgIGNvbnN0YW50IHJlc2VydmUgcmF0aW8sIDEtMTAwDQogICAgICAgIEBwYXJhbSBfZW5hYmxlVmlydHVhbEJhbGFuY2UgICB0cnVlIHRvIGVuYWJsZSB2aXJ0dWFsIGJhbGFuY2UgZm9yIHRoZSByZXNlcnZlLCBmYWxzZSB0byBkaXNhYmxlIGl0DQogICAgICAgIEBwYXJhbSBfdmlydHVhbEJhbGFuY2UgICAgICAgICBuZXcgcmVzZXJ2ZSdzIHZpcnR1YWwgYmFsYW5jZQ0KICAgICovDQogICAgZnVuY3Rpb24gdXBkYXRlUmVzZXJ2ZShJRVJDMjBUb2tlbiBfcmVzZXJ2ZVRva2VuLCB1aW50OCBfcmF0aW8sIGJvb2wgX2VuYWJsZVZpcnR1YWxCYWxhbmNlLCB1aW50MjU2IF92aXJ0dWFsQmFsYW5jZSkNCiAgICAgICAgcHVibGljDQogICAgICAgIG93bmVyT25seQ0KICAgICAgICB2YWxpZFJlc2VydmUoX3Jlc2VydmVUb2tlbikNCiAgICAgICAgdmFsaWRSZXNlcnZlUmF0aW8oX3JhdGlvKQ0KICAgIHsNCiAgICAgICAgUmVzZXJ2ZSByZXNlcnZlID0gcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl07DQogICAgICAgIHJlcXVpcmUodG90YWxSZXNlcnZlUmF0aW8gLSByZXNlcnZlLnJhdGlvICsgX3JhdGlvIDw9IDEwMCk7IC8vIHZhbGlkYXRlIGlucHV0DQoNCiAgICAgICAgdG90YWxSZXNlcnZlUmF0aW8gPSB0b3RhbFJlc2VydmVSYXRpbyAtIHJlc2VydmUucmF0aW8gKyBfcmF0aW87DQogICAgICAgIHJlc2VydmUucmF0aW8gPSBfcmF0aW87DQogICAgICAgIHJlc2VydmUuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQgPSBfZW5hYmxlVmlydHVhbEJhbGFuY2U7DQogICAgICAgIHJlc2VydmUudmlydHVhbEJhbGFuY2UgPSBfdmlydHVhbEJhbGFuY2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgZGlzYWJsZXMgcHVyY2hhc2luZyB3aXRoIHRoZSBnaXZlbiByZXNlcnZlIHRva2VuIGluIGNhc2UgdGhlIHJlc2VydmUgdG9rZW4gZ290IGNvbXByb21pc2VkDQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgdG9rZW4gb3duZXINCiAgICAgICAgbm90ZSB0aGF0IHNlbGxpbmcgaXMgc3RpbGwgZW5hYmxlZCByZWdhcmRsZXNzIG9mIHRoaXMgZmxhZyBhbmQgaXQgY2Fubm90IGJlIGRpc2FibGVkIGJ5IHRoZSB0b2tlbiBvd25lcg0KDQogICAgICAgIEBwYXJhbSBfcmVzZXJ2ZVRva2VuICAgIHJlc2VydmUgdG9rZW4gY29udHJhY3QgYWRkcmVzcw0KICAgICAgICBAcGFyYW0gX2Rpc2FibGUgICAgICAgICB0cnVlIHRvIGRpc2FibGUgdGhlIHRva2VuLCBmYWxzZSB0byByZS1lbmFibGUgaXQNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGRpc2FibGVSZXNlcnZlUHVyY2hhc2VzKElFUkMyMFRva2VuIF9yZXNlcnZlVG9rZW4sIGJvb2wgX2Rpc2FibGUpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBvd25lck9ubHkNCiAgICAgICAgdmFsaWRSZXNlcnZlKF9yZXNlcnZlVG9rZW4pDQogICAgew0KICAgICAgICByZXNlcnZlc1tfcmVzZXJ2ZVRva2VuXS5pc1B1cmNoYXNlRW5hYmxlZCA9ICFfZGlzYWJsZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSByZXNlcnZlJ3MgdmlydHVhbCBiYWxhbmNlIGlmIG9uZSBpcyBkZWZpbmVkLCBvdGhlcndpc2UgcmV0dXJucyB0aGUgYWN0dWFsIGJhbGFuY2UNCg0KICAgICAgICBAcGFyYW0gX3Jlc2VydmVUb2tlbiAgICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MNCg0KICAgICAgICBAcmV0dXJuIHJlc2VydmUgYmFsYW5jZQ0KICAgICovDQogICAgZnVuY3Rpb24gZ2V0UmVzZXJ2ZUJhbGFuY2UoSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbikNCiAgICAgICAgcHVibGljDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQ0KICAgICAgICByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpDQogICAgew0KICAgICAgICBSZXNlcnZlIHJlc2VydmUgPSByZXNlcnZlc1tfcmVzZXJ2ZVRva2VuXTsNCiAgICAgICAgcmV0dXJuIHJlc2VydmUuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQgPyByZXNlcnZlLnZpcnR1YWxCYWxhbmNlIDogX3Jlc2VydmVUb2tlbi5iYWxhbmNlT2YodGhpcyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBjaGFuZ2luZyBhIHNwZWNpZmljIGFtb3VudCBvZiBfZnJvbVRva2VuIHRvIF90b1Rva2VuDQoNCiAgICAgICAgQHBhcmFtIF9mcm9tVG9rZW4gIEVSQzIwIHRva2VuIHRvIGNoYW5nZSBmcm9tDQogICAgICAgIEBwYXJhbSBfdG9Ub2tlbiAgICBFUkMyMCB0b2tlbiB0byBjaGFuZ2UgdG8NCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgIGFtb3VudCB0byBjaGFuZ2UsIGluIGZyb21Ub2tlbg0KDQogICAgICAgIEByZXR1cm4gZXhwZWN0ZWQgY2hhbmdlIHJldHVybiBhbW91bnQNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGdldFJldHVybihJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50KQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgdmFsaWRUb2tlbihfZnJvbVRva2VuKQ0KICAgICAgICB2YWxpZFRva2VuKF90b1Rva2VuKQ0KICAgICAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkNCiAgICB7DQogICAgICAgIHJlcXVpcmUoX2Zyb21Ub2tlbiAhPSBfdG9Ub2tlbik7IC8vIHZhbGlkYXRlIGlucHV0DQoNCiAgICAgICAgLy8gY2hhbmdlIGJldHdlZW4gdGhlIHRva2VuIGFuZCBvbmUgb2YgaXRzIHJlc2VydmVzDQogICAgICAgIGlmIChfdG9Ub2tlbiA9PSB0b2tlbikNCiAgICAgICAgICAgIHJldHVybiBnZXRQdXJjaGFzZVJldHVybihfZnJvbVRva2VuLCBfYW1vdW50KTsNCiAgICAgICAgZWxzZSBpZiAoX2Zyb21Ub2tlbiA9PSB0b2tlbikNCiAgICAgICAgICAgIHJldHVybiBnZXRTYWxlUmV0dXJuKF90b1Rva2VuLCBfYW1vdW50KTsNCg0KICAgICAgICAvLyBjaGFuZ2UgYmV0d2VlbiAyIHJlc2VydmVzDQogICAgICAgIHVpbnQyNTYgcHVyY2hhc2VSZXR1cm5BbW91bnQgPSBnZXRQdXJjaGFzZVJldHVybihfZnJvbVRva2VuLCBfYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIGdldFNhbGVSZXR1cm4oX3RvVG9rZW4sIHB1cmNoYXNlUmV0dXJuQW1vdW50LCBzYWZlQWRkKHRva2VuLnRvdGFsU3VwcGx5KCksIHB1cmNoYXNlUmV0dXJuQW1vdW50KSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBidXlpbmcgdGhlIHRva2VuIGZvciBhIHJlc2VydmUgdG9rZW4NCg0KICAgICAgICBAcGFyYW0gX3Jlc2VydmVUb2tlbiAgIHJlc2VydmUgdG9rZW4gY29udHJhY3QgYWRkcmVzcw0KICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgIGFtb3VudCB0byBkZXBvc2l0IChpbiB0aGUgcmVzZXJ2ZSB0b2tlbikNCg0KICAgICAgICBAcmV0dXJuIGV4cGVjdGVkIHB1cmNoYXNlIHJldHVybiBhbW91bnQNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGdldFB1cmNoYXNlUmV0dXJuKElFUkMyMFRva2VuIF9yZXNlcnZlVG9rZW4sIHVpbnQyNTYgX2RlcG9zaXRBbW91bnQpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBjb25zdGFudA0KICAgICAgICBhY3RpdmUNCiAgICAgICAgdmFsaWRSZXNlcnZlKF9yZXNlcnZlVG9rZW4pDQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KQ0KICAgIHsNCiAgICAgICAgUmVzZXJ2ZSByZXNlcnZlID0gcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl07DQogICAgICAgIHJlcXVpcmUocmVzZXJ2ZS5pc1B1cmNoYXNlRW5hYmxlZCk7IC8vIHZhbGlkYXRlIGlucHV0DQoNCiAgICAgICAgdWludDI1NiB0b2tlblN1cHBseSA9IHRva2VuLnRvdGFsU3VwcGx5KCk7DQogICAgICAgIHVpbnQyNTYgcmVzZXJ2ZUJhbGFuY2UgPSBnZXRSZXNlcnZlQmFsYW5jZShfcmVzZXJ2ZVRva2VuKTsNCiAgICAgICAgcmV0dXJuIGZvcm11bGEuY2FsY3VsYXRlUHVyY2hhc2VSZXR1cm4odG9rZW5TdXBwbHksIHJlc2VydmVCYWxhbmNlLCByZXNlcnZlLnJhdGlvLCBfZGVwb3NpdEFtb3VudCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBzZWxsaW5nIHRoZSB0b2tlbiBmb3Igb25lIG9mIGl0cyByZXNlcnZlIHRva2Vucw0KDQogICAgICAgIEBwYXJhbSBfcmVzZXJ2ZVRva2VuICAgcmVzZXJ2ZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzDQogICAgICAgIEBwYXJhbSBfc2VsbEFtb3VudCAgICAgYW1vdW50IHRvIHNlbGwgKGluIHRoZSBzbWFydCB0b2tlbikNCg0KICAgICAgICBAcmV0dXJuIGV4cGVjdGVkIHNhbGUgcmV0dXJuIGFtb3VudA0KICAgICovDQogICAgZnVuY3Rpb24gZ2V0U2FsZVJldHVybihJRVJDMjBUb2tlbiBfcmVzZXJ2ZVRva2VuLCB1aW50MjU2IF9zZWxsQW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBhbW91bnQpIHsNCiAgICAgICAgcmV0dXJuIGdldFNhbGVSZXR1cm4oX3Jlc2VydmVUb2tlbiwgX3NlbGxBbW91bnQsIHRva2VuLnRvdGFsU3VwcGx5KCkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGNoYW5nZXMgYSBzcGVjaWZpYyBhbW91bnQgb2YgX2Zyb21Ub2tlbiB0byBfdG9Ub2tlbg0KDQogICAgICAgIEBwYXJhbSBfZnJvbVRva2VuICBFUkMyMCB0b2tlbiB0byBjaGFuZ2UgZnJvbQ0KICAgICAgICBAcGFyYW0gX3RvVG9rZW4gICAgRVJDMjAgdG9rZW4gdG8gY2hhbmdlIHRvDQogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICBhbW91bnQgdG8gY2hhbmdlLCBpbiBmcm9tVG9rZW4NCiAgICAgICAgQHBhcmFtIF9taW5SZXR1cm4gIGlmIHRoZSBjaGFuZ2UgcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGFuIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvDQoNCiAgICAgICAgQHJldHVybiBjaGFuZ2UgcmV0dXJuIGFtb3VudA0KICAgICovDQogICAgZnVuY3Rpb24gY2hhbmdlKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikNCiAgICAgICAgcHVibGljDQogICAgICAgIHZhbGlkVG9rZW4oX2Zyb21Ub2tlbikNCiAgICAgICAgdmFsaWRUb2tlbihfdG9Ub2tlbikNCiAgICAgICAgcmV0dXJucyAodWludDI1NiBhbW91bnQpDQogICAgew0KICAgICAgICByZXF1aXJlKF9mcm9tVG9rZW4gIT0gX3RvVG9rZW4pOyAvLyB2YWxpZGF0ZSBpbnB1dA0KDQogICAgICAgIC8vIGNoYW5nZSBiZXR3ZWVuIHRoZSB0b2tlbiBhbmQgb25lIG9mIGl0cyByZXNlcnZlcw0KICAgICAgICBpZiAoX3RvVG9rZW4gPT0gdG9rZW4pDQogICAgICAgICAgICByZXR1cm4gYnV5KF9mcm9tVG9rZW4sIF9hbW91bnQsIF9taW5SZXR1cm4pOw0KICAgICAgICBlbHNlIGlmIChfZnJvbVRva2VuID09IHRva2VuKQ0KICAgICAgICAgICAgcmV0dXJuIHNlbGwoX3RvVG9rZW4sIF9hbW91bnQsIF9taW5SZXR1cm4pOw0KDQogICAgICAgIC8vIGNoYW5nZSBiZXR3ZWVuIDIgcmVzZXJ2ZXMNCiAgICAgICAgdWludDI1NiBwdXJjaGFzZUFtb3VudCA9IGJ1eShfZnJvbVRva2VuLCBfYW1vdW50LCAxKTsNCiAgICAgICAgcmV0dXJuIHNlbGwoX3RvVG9rZW4sIHB1cmNoYXNlQW1vdW50LCBfbWluUmV0dXJuKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBidXlzIHRoZSB0b2tlbiBieSBkZXBvc2l0aW5nIG9uZSBvZiBpdHMgcmVzZXJ2ZSB0b2tlbnMNCg0KICAgICAgICBAcGFyYW0gX3Jlc2VydmVUb2tlbiAgIHJlc2VydmUgdG9rZW4gY29udHJhY3QgYWRkcmVzcw0KICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgIGFtb3VudCB0byBkZXBvc2l0IChpbiB0aGUgcmVzZXJ2ZSB0b2tlbikNCiAgICAgICAgQHBhcmFtIF9taW5SZXR1cm4gICAgICBpZiB0aGUgY2hhbmdlIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhhbiB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybw0KDQogICAgICAgIEByZXR1cm4gYnV5IHJldHVybiBhbW91bnQNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGJ1eShJRVJDMjBUb2tlbiBfcmVzZXJ2ZVRva2VuLCB1aW50MjU2IF9kZXBvc2l0QW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pDQogICAgICAgIHB1YmxpYw0KICAgICAgICB2YWxpZEFtb3VudChfbWluUmV0dXJuKQ0KICAgICAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkgew0KICAgICAgICBhbW91bnQgPSBnZXRQdXJjaGFzZVJldHVybihfcmVzZXJ2ZVRva2VuLCBfZGVwb3NpdEFtb3VudCk7DQogICAgICAgIGFzc2VydChhbW91bnQgIT0gMCAmJiBhbW91bnQgPj0gX21pblJldHVybik7IC8vIGVuc3VyZSB0aGUgdHJhZGUgZ2l2ZXMgc29tZXRoaW5nIGluIHJldHVybiBhbmQgbWVldHMgdGhlIG1pbmltdW0gcmVxdWVzdGVkIGFtb3VudA0KDQogICAgICAgIC8vIHVwZGF0ZSB2aXJ0dWFsIGJhbGFuY2UgaWYgcmVsZXZhbnQNCiAgICAgICAgUmVzZXJ2ZSByZXNlcnZlID0gcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl07DQogICAgICAgIGlmIChyZXNlcnZlLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkKQ0KICAgICAgICAgICAgcmVzZXJ2ZS52aXJ0dWFsQmFsYW5jZSA9IHNhZmVBZGQocmVzZXJ2ZS52aXJ0dWFsQmFsYW5jZSwgX2RlcG9zaXRBbW91bnQpOw0KDQogICAgICAgIGFzc2VydChfcmVzZXJ2ZVRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBfZGVwb3NpdEFtb3VudCkpOyAvLyB0cmFuc2ZlciBfZGVwb3NpdEFtb3VudCBmdW5kcyBmcm9tIHRoZSBjYWxsZXIgaW4gdGhlIHJlc2VydmUgdG9rZW4NCiAgICAgICAgdG9rZW4uaXNzdWUobXNnLnNlbmRlciwgYW1vdW50KTsgLy8gaXNzdWUgbmV3IGZ1bmRzIHRvIHRoZSBjYWxsZXIgaW4gdGhlIHNtYXJ0IHRva2VuDQoNCiAgICAgICAgQ2hhbmdlKF9yZXNlcnZlVG9rZW4sIHRva2VuLCBtc2cuc2VuZGVyLCBfZGVwb3NpdEFtb3VudCwgYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIGFtb3VudDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBzZWxscyB0aGUgdG9rZW4gYnkgd2l0aGRyYXdpbmcgZnJvbSBvbmUgb2YgaXRzIHJlc2VydmUgdG9rZW5zDQoNCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MNCiAgICAgICAgQHBhcmFtIF9zZWxsQW1vdW50ICAgICBhbW91bnQgdG8gc2VsbCAoaW4gdGhlIHNtYXJ0IHRva2VuKQ0KICAgICAgICBAcGFyYW0gX21pblJldHVybiAgICAgIGlmIHRoZSBjaGFuZ2UgcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybw0KDQogICAgICAgIEByZXR1cm4gc2VsbCByZXR1cm4gYW1vdW50DQogICAgKi8NCiAgICBmdW5jdGlvbiBzZWxsKElFUkMyMFRva2VuIF9yZXNlcnZlVG9rZW4sIHVpbnQyNTYgX3NlbGxBbW91bnQsIHVpbnQyNTYgX21pblJldHVybikNCiAgICAgICAgcHVibGljDQogICAgICAgIHZhbGlkQW1vdW50KF9taW5SZXR1cm4pDQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KSB7DQogICAgICAgIHJlcXVpcmUoX3NlbGxBbW91bnQgPD0gdG9rZW4uYmFsYW5jZU9mKG1zZy5zZW5kZXIpKTsgLy8gdmFsaWRhdGUgaW5wdXQNCg0KICAgICAgICBhbW91bnQgPSBnZXRTYWxlUmV0dXJuKF9yZXNlcnZlVG9rZW4sIF9zZWxsQW1vdW50KTsNCiAgICAgICAgYXNzZXJ0KGFtb3VudCAhPSAwICYmIGFtb3VudCA+PSBfbWluUmV0dXJuKTsgLy8gZW5zdXJlIHRoZSB0cmFkZSBnaXZlcyBzb21ldGhpbmcgaW4gcmV0dXJuIGFuZCBtZWV0cyB0aGUgbWluaW11bSByZXF1ZXN0ZWQgYW1vdW50DQoNCiAgICAgICAgdWludDI1NiByZXNlcnZlQmFsYW5jZSA9IGdldFJlc2VydmVCYWxhbmNlKF9yZXNlcnZlVG9rZW4pOw0KICAgICAgICBhc3NlcnQoYW1vdW50IDw9IHJlc2VydmVCYWxhbmNlKTsgLy8gZW5zdXJlIHRoYXQgdGhlIHRyYWRlIHdvbid0IHJlc3VsdCBpbiBuZWdhdGl2ZSByZXNlcnZlDQoNCiAgICAgICAgdWludDI1NiB0b2tlblN1cHBseSA9IHRva2VuLnRvdGFsU3VwcGx5KCk7DQogICAgICAgIGFzc2VydChhbW91bnQgPCByZXNlcnZlQmFsYW5jZSB8fCBfc2VsbEFtb3VudCA9PSB0b2tlblN1cHBseSk7IC8vIGVuc3VyZSB0aGF0IHRoZSB0cmFkZSB3aWxsIG9ubHkgZGVwbGV0ZSB0aGUgcmVzZXJ2ZSBpZiB0aGUgdG90YWwgc3VwcGx5IGlzIGRlcGxldGVkIGFzIHdlbGwNCg0KICAgICAgICAvLyB1cGRhdGUgdmlydHVhbCBiYWxhbmNlIGlmIHJlbGV2YW50DQogICAgICAgIFJlc2VydmUgcmVzZXJ2ZSA9IHJlc2VydmVzW19yZXNlcnZlVG9rZW5dOw0KICAgICAgICBpZiAocmVzZXJ2ZS5pc1ZpcnR1YWxCYWxhbmNlRW5hYmxlZCkNCiAgICAgICAgICAgIHJlc2VydmUudmlydHVhbEJhbGFuY2UgPSBzYWZlU3ViKHJlc2VydmUudmlydHVhbEJhbGFuY2UsIGFtb3VudCk7DQoNCiAgICAgICAgdG9rZW4uZGVzdHJveShtc2cuc2VuZGVyLCBfc2VsbEFtb3VudCk7IC8vIGRlc3Ryb3kgX3NlbGxBbW91bnQgZnJvbSB0aGUgY2FsbGVyJ3MgYmFsYW5jZSBpbiB0aGUgc21hcnQgdG9rZW4NCiAgICAgICAgYXNzZXJ0KF9yZXNlcnZlVG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgYW1vdW50KSk7IC8vIHRyYW5zZmVyIGZ1bmRzIHRvIHRoZSBjYWxsZXIgaW4gdGhlIHJlc2VydmUgdG9rZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vdGUgdGhhdCBpdCBtaWdodCBmYWlsIGlmIHRoZSBhY3R1YWwgcmVzZXJ2ZSBiYWxhbmNlIGlzIHNtYWxsZXIgdGhhbiB0aGUgdmlydHVhbCBiYWxhbmNlDQogICAgICAgIENoYW5nZSh0b2tlbiwgX3Jlc2VydmVUb2tlbiwgbXNnLnNlbmRlciwgX3NlbGxBbW91bnQsIGFtb3VudCk7DQogICAgICAgIHJldHVybiBhbW91bnQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgdXRpbGl0eSwgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBzZWxsaW5nIHRoZSB0b2tlbiBmb3Igb25lIG9mIGl0cyByZXNlcnZlIHRva2VucywgZ2l2ZW4gYSB0b3RhbCBzdXBwbHkgb3ZlcnJpZGUNCg0KICAgICAgICBAcGFyYW0gX3Jlc2VydmVUb2tlbiAgIHJlc2VydmUgdG9rZW4gY29udHJhY3QgYWRkcmVzcw0KICAgICAgICBAcGFyYW0gX3NlbGxBbW91bnQgICAgIGFtb3VudCB0byBzZWxsIChpbiB0aGUgc21hcnQgdG9rZW4pDQogICAgICAgIEBwYXJhbSBfdG90YWxTdXBwbHkgICAgdG90YWwgdG9rZW4gc3VwcGx5LCBvdmVycmlkZXMgdGhlIGFjdHVhbCB0b2tlbiB0b3RhbCBzdXBwbHkgd2hlbiBjYWxjdWxhdGluZyB0aGUgcmV0dXJuDQoNCiAgICAgICAgQHJldHVybiBzYWxlIHJldHVybiBhbW91bnQNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGdldFNhbGVSZXR1cm4oSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDI1NiBfc2VsbEFtb3VudCwgdWludDI1NiBfdG90YWxTdXBwbHkpDQogICAgICAgIHByaXZhdGUNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgYWN0aXZlDQogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQ0KICAgICAgICB2YWxpZEFtb3VudChfdG90YWxTdXBwbHkpDQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KQ0KICAgIHsNCiAgICAgICAgUmVzZXJ2ZSByZXNlcnZlID0gcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl07DQogICAgICAgIHVpbnQyNTYgcmVzZXJ2ZUJhbGFuY2UgPSBnZXRSZXNlcnZlQmFsYW5jZShfcmVzZXJ2ZVRva2VuKTsNCiAgICAgICAgcmV0dXJuIGZvcm11bGEuY2FsY3VsYXRlU2FsZVJldHVybihfdG90YWxTdXBwbHksIHJlc2VydmVCYWxhbmNlLCByZXNlcnZlLnJhdGlvLCBfc2VsbEFtb3VudCk7DQogICAgfQ0KfQ=='