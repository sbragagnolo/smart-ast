base 64 content
base64blockjack1
	^'bGlicmFyeSBBcnJheUxpYiB7DQogIC8vIEluc2VydHMgdG8ga2VlcCBhcnJheSBzb3J0ZWQgKGFzc3VtZXMgaW5wdXQgYXJyYXkgaXMgc29ydGVkKQ0KCWZ1bmN0aW9uIGluc2VydEluUGxhY2UodWludDhbXSBzdG9yYWdlIHNlbGYsIHVpbnQ4IG4pIHsNCgkJdWludDggaW5zZXJ0aW5nSW5kZXggPSAwOw0KDQoJCXdoaWxlIChzZWxmLmxlbmd0aCA+IDAgJiYgaW5zZXJ0aW5nSW5kZXggPCBzZWxmLmxlbmd0aCAmJiBzZWxmW2luc2VydGluZ0luZGV4XSA8IG4pIHsNCgkJCWluc2VydGluZ0luZGV4ICs9IDE7DQoJCX0NCg0KCQlzZWxmLmxlbmd0aCArPSAxOw0KCQlmb3IgKHVpbnQ4IGkgPSB1aW50OChzZWxmLmxlbmd0aCkgLSAxOyBpID4gaW5zZXJ0aW5nSW5kZXg7IGktLSkgew0KCQkJc2VsZltpXSA9IHNlbGZbaSAtIDFdOw0KCQl9DQoNCgkJc2VsZltpbnNlcnRpbmdJbmRleF0gPSBuOw0KCX0NCn0NCg0KbGlicmFyeSBEZWNrTGliIHsNCgl1c2luZyBBcnJheUxpYiBmb3IgdWludDhbXTsNCg0KCWVudW0gU3VpdCB7IFNwYWRlcywgSGVhcnRzLCBDbHVicywgRGlhbW9uZHMgfQ0KCXVpbnQ4IGNvbnN0YW50IGNhcmRzUGVyU3VpdCA9IDEzOw0KCXVpbnQ4IGNvbnN0YW50IHN1aXRzID0gNDsNCgl1aW50OCBjb25zdGFudCB0b3RhbENhcmRzID0gY2FyZHNQZXJTdWl0ICogc3VpdHM7DQoNCglzdHJ1Y3QgRGVjayB7DQoJCXVpbnQ4W10gdXNlZENhcmRzOyAvLyBhbHdheXMgaGFzIHRvIGJlIHNvcnRlZA0KCQlhZGRyZXNzIHBsYXllcjsNCgkJdWludDI1NiBnYW1lSUQ7DQoJfQ0KDQoJZnVuY3Rpb24gaW5pdChEZWNrIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBnYW1lSUQpICB7DQoJCXNlbGYudXNlZENhcmRzID0gbmV3IHVpbnQ4W10oMCk7DQoJCXNlbGYucGxheWVyID0gbXNnLnNlbmRlcjsNCgkJc2VsZi5nYW1lSUQgPSBnYW1lSUQ7DQoJfQ0KDQoJZnVuY3Rpb24gZ2V0Q2FyZChEZWNrIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBibG9ja051bWJlcikgIHJldHVybnMgKHVpbnQ4KSAgew0KCQl1aW50IGNhcmRJbmRleCA9IHNlbGYudXNlZENhcmRzLmxlbmd0aDsNCgkJaWYgKGNhcmRJbmRleCA+PSB0b3RhbENhcmRzKSB0aHJvdzsNCgkJdWludDggciA9IHVpbnQ4KGdldFJhbmRvbU51bWJlcihibG9ja051bWJlciwgc2VsZi5wbGF5ZXIsIHNlbGYuZ2FtZUlELCBjYXJkSW5kZXgsIHRvdGFsQ2FyZHMgLSBjYXJkSW5kZXgpKTsNCg0KCQlmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgY2FyZEluZGV4OyBpKyspIHsNCgkJCWlmIChzZWxmLnVzZWRDYXJkc1tpXSA8PSByKSByICs9IDE7DQoJCX0NCg0KCQlzZWxmLnVzZWRDYXJkcy5pbnNlcnRJblBsYWNlKHIpOw0KDQoJCXJldHVybiByOw0KCX0NCg0KCWZ1bmN0aW9uIGNhcmREZXNjcmlwdGlvbih1aW50OCBzZWxmKSBjb25zdGFudCByZXR1cm5zIChTdWl0LCB1aW50OCkgew0KCQlyZXR1cm4gKFN1aXQoc2VsZiAvIGNhcmRzUGVyU3VpdCksIGNhcmRGYWNldmFsdWUoc2VsZikpOw0KCX0NCg0KCWZ1bmN0aW9uIGNhcmRFbW9qaWZpZWQodWludDggc2VsZikgY29uc3RhbnQgcmV0dXJucyAodWludDgsIHN0cmluZykgew0KCQlzdHJpbmcgbWVtb3J5IGVtb2ppU3VpdDsNCg0KCQl2YXIgKHN1aXQsIG51bWJlcikgPSBjYXJkRGVzY3JpcHRpb24oc2VsZik7DQoJCWlmIChzdWl0ID09IFN1aXQuQ2x1YnMpIGVtb2ppU3VpdCA9ICLimaPvuI8iOw0KCQllbHNlIGlmIChzdWl0ID09IFN1aXQuRGlhbW9uZHMpIGVtb2ppU3VpdCA9ICLimabvuI8iOw0KCQllbHNlIGlmIChzdWl0ID09IFN1aXQuSGVhcnRzKSBlbW9qaVN1aXQgPSAi4pml77iPIjsNCgkJZWxzZSBpZiAoc3VpdCA9PSBTdWl0LlNwYWRlcykgZW1vamlTdWl0ID0gIuKZoO+4jyI7DQoNCgkJcmV0dXJuIChudW1iZXIsIGVtb2ppU3VpdCk7DQoJfQ0KDQoJZnVuY3Rpb24gY2FyZEZhY2V2YWx1ZSh1aW50OCBzZWxmKSBjb25zdGFudCByZXR1cm5zICh1aW50OCkgew0KCQlyZXR1cm4gMSArIHNlbGYgJSBjYXJkc1BlclN1aXQ7DQoJfQ0KDQoJZnVuY3Rpb24gYmxhY2tqYWNrVmFsdWUodWludDggc2VsZikgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsNCgkJdWludDggY2FyZFZhbHVlID0gY2FyZEZhY2V2YWx1ZShzZWxmKTsNCgkJcmV0dXJuIGNhcmRWYWx1ZSA8IDEwID8gY2FyZFZhbHVlIDogMTA7DQoJfQ0KDQoJZnVuY3Rpb24gZ2V0UmFuZG9tTnVtYmVyKHVpbnQgYiwgYWRkcmVzcyBwbGF5ZXIsIHVpbnQyNTYgZ2FtZUlELCB1aW50IG4sIHVpbnQgbSkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KCQkvLyBVc2VzIGJsb2NraGFzaCBhcyByYW5kb21uZXNzIHNvdXJjZS4NCgkJLy8gQ3JlZGl0czogaHR0cHM6Ly9naXRodWIuY29tL0J1bmppbi9Sb3VsZXRoL2Jsb2IvbWFzdGVyL1Byb3ZhYmx5X0ZhaXJfTm9fQ2hlYXRpbmcubWQNCgkJYnl0ZXMzMiBibG9ja0hhc2ggPSBibG9jay5ibG9ja2hhc2goYik7DQoJCWlmIChibG9ja0hhc2ggPT0gMHgwKSB0aHJvdzsNCgkJcmV0dXJuIHVpbnQodWludDI1NihrZWNjYWsyNTYoYmxvY2tIYXNoLCBwbGF5ZXIsIGdhbWVJRCwgbikpICUgbSk7DQoNCgl9DQp9DQoNCmNvbnRyYWN0IEFic3RyYWN0QmxvY2tqYWNrTG9ncyB7DQogIGV2ZW50IEdhbWVFbmRlZCh1aW50MjU2IGdhbWVJRCwgYWRkcmVzcyBwbGF5ZXIsIHVpbnQgZ2FtZVJlc3VsdCwgdWludDI1NiBwYXlvdXQsIHVpbnQ4IHBsYXllckhhbmQsIHVpbnQ4IGhvdXNlSGFuZCk7DQogIGV2ZW50IEdhbWVOZWVkc1RpY2sodWludDI1NiBnYW1lSUQsIGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IGFjdGlvbkJsb2NrKTsNCg0KICBmdW5jdGlvbiByZWNvcmRMb2codWludDI1NiBnYW1lSUQsIGFkZHJlc3MgcGxheWVyLCB1aW50IGdhbWVSZXN1bHQsIHVpbnQyNTYgcGF5b3V0LCB1aW50OCBwbGF5ZXJIYW5kLCB1aW50OCBob3VzZUhhbmQpOw0KICBmdW5jdGlvbiB0aWNrUmVxdWlyZWRMb2codWludDI1NiBnYW1lSUQsIGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IGFjdGlvbkJsb2NrKTsNCn0NCg0KbGlicmFyeSBHYW1lTGliIHsNCiAgdXNpbmcgRGVja0xpYiBmb3IgKjsNCg0KICB1aW50OCBjb25zdGFudCBob3VzZUxpbWl0ID0gMTc7DQogIHVpbnQ4IGNvbnN0YW50IHRhcmdldCA9IDIxOw0KDQogIGVudW0gQ29tcGFyYWlzb25SZXN1bHQgeyBGaXJzdCwgU2Vjb25kLCBUaWUgfQ0KICBlbnVtIEdhbWVTdGF0ZSB7IEluaXRpYWxDYXJkcywgV2FpdGluZywgSGl0LCBTdGFuZCwgRG91YmxlRG93biwgRmluaXNoZWQgfQ0KICBlbnVtIEdhbWVSZXN1bHQgeyBPbmdvaW5nLCBIb3VzZSwgVGllLCBQbGF5ZXIsIFBsYXllck5hdHVyYWwgfQ0KDQogIHN0cnVjdCBHYW1lIHsNCiAgICBhZGRyZXNzIHBsYXllcjsNCiAgICB1aW50MjU2IGJldDsNCiAgICB1aW50MjU2IHBheW91dDsNCiAgICB1aW50MjU2IGdhbWVJRDsNCg0KICAgIERlY2tMaWIuRGVjayBkZWNrOw0KICAgIHVpbnQ4W10gaG91c2VDYXJkczsNCiAgICB1aW50OFtdIHBsYXllckNhcmRzOw0KDQogICAgdWludDI1NiBhY3Rpb25CbG9jazsgLy8gQmxvY2sgb24gd2hpY2ggY29tbWl0bWVudCB0byBwZXJmb3JtIGFuIGFjdGlvbiBoYXBwZW5zLg0KDQogICAgR2FtZVN0YXRlIHN0YXRlOw0KICAgIEdhbWVSZXN1bHQgcmVzdWx0Ow0KDQogICAgYm9vbCBjbG9zZWQ7DQogIH0NCg0KICBmdW5jdGlvbiBpbml0KEdhbWUgc3RvcmFnZSBzZWxmLCB1aW50MjU2IGdhbWVJRCkgew0KICAgIHNlbGYucGxheWVyID0gbXNnLnNlbmRlcjsNCiAgICBzZWxmLmJldCA9IG1zZy52YWx1ZTsNCiAgICBzZWxmLnBheW91dCA9IDA7DQogICAgc2VsZi5ob3VzZUNhcmRzID0gbmV3IHVpbnQ4W10oMCk7DQogICAgc2VsZi5wbGF5ZXJDYXJkcyA9IG5ldyB1aW50OFtdKDApOw0KICAgIHNlbGYuYWN0aW9uQmxvY2sgPSBibG9jay5udW1iZXI7DQogICAgc2VsZi5zdGF0ZSA9IEdhbWVTdGF0ZS5Jbml0aWFsQ2FyZHM7DQogICAgc2VsZi5yZXN1bHQgPSBHYW1lUmVzdWx0Lk9uZ29pbmc7DQogICAgc2VsZi5jbG9zZWQgPSBmYWxzZTsNCiAgICBzZWxmLmdhbWVJRCA9IGdhbWVJRDsNCg0KICAgIHNlbGYuZGVjay5pbml0KGdhbWVJRCk7DQogIH0NCg0KICBmdW5jdGlvbiB0aWNrKEdhbWUgc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7DQogICAgaWYgKGJsb2NrLm51bWJlciA8PSBzZWxmLmFjdGlvbkJsb2NrKSByZXR1cm4gZmFsc2U7IC8vIENhbid0IHRpY2sgeWV0DQogICAgaWYgKHNlbGYuYWN0aW9uQmxvY2sgKyAyNTUgPCBibG9jay5udW1iZXIpIHsNCiAgICAgIGVuZEdhbWUoc2VsZiwgR2FtZVJlc3VsdC5Ib3VzZSk7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgaWYgKCFuZWVkc1RpY2soc2VsZikpIHJldHVybiB0cnVlOyAvLyBub3QgbmVlZGVkLCBldmVyeXRoaW5nIGlzIGZpbmUNCg0KICAgIGlmIChzZWxmLnN0YXRlID09IEdhbWVTdGF0ZS5Jbml0aWFsQ2FyZHMpIGRlYWxJbml0aWFsQ2FyZHMoc2VsZik7DQogICAgaWYgKHNlbGYuc3RhdGUgPT0gR2FtZVN0YXRlLkhpdCkgZGVhbEhpdENhcmQoc2VsZik7DQogICAgaWYgKHNlbGYuc3RhdGUgPT0gR2FtZVN0YXRlLkRvdWJsZURvd24pIHsNCiAgICAgIGlmICghY2FuRG91YmxlRG93bihzZWxmKSkgdGhyb3c7DQogICAgICBzZWxmLmJldCArPSBtc2cudmFsdWU7DQogICAgICBkZWFsSGl0Q2FyZChzZWxmKTsNCiAgICAgIGZvcmNlU3RhbmQoc2VsZik7DQogICAgfQ0KDQogICAgaWYgKHNlbGYuc3RhdGUgPT0gR2FtZVN0YXRlLlN0YW5kKSB7DQogICAgICBkZWFsSG91c2VDYXJkcyhzZWxmKTsNCiAgICAgIGNoZWNrR2FtZVJlc3VsdChzZWxmKTsNCiAgICB9IGVsc2Ugew0KICAgICAgY2hlY2tHYW1lQ29udGludWVzKHNlbGYpOw0KICAgIH0NCg0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gbmVlZHNUaWNrKEdhbWUgc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgaWYgKHNlbGYuc3RhdGUgPT0gR2FtZVN0YXRlLldhaXRpbmcpIHJldHVybiBmYWxzZTsNCiAgICBpZiAoc2VsZi5zdGF0ZSA9PSBHYW1lU3RhdGUuRmluaXNoZWQpIHJldHVybiBmYWxzZTsNCg0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gY2hlY2tHYW1lUmVzdWx0KEdhbWUgc3RvcmFnZSBzZWxmKSAgew0KICAgIHVpbnQ4IGhvdXNlSGFuZCA9IGNvdW50SGFuZChzZWxmLmhvdXNlQ2FyZHMpOw0KDQogICAgaWYgKGhvdXNlSGFuZCA9PSB0YXJnZXQgJiYgc2VsZi5ob3VzZUNhcmRzLmxlbmd0aCA9PSAyKSByZXR1cm4gZW5kR2FtZShzZWxmLCBHYW1lUmVzdWx0LkhvdXNlKTsgLy8gSG91c2UgbmF0dXJhbA0KDQogICAgQ29tcGFyYWlzb25SZXN1bHQgcmVzdWx0ID0gY29tcGFyZUhhbmRzKGhvdXNlSGFuZCwgY291bnRIYW5kKHNlbGYucGxheWVyQ2FyZHMpKTsNCiAgICBpZiAocmVzdWx0ID09IENvbXBhcmFpc29uUmVzdWx0LkZpcnN0KSByZXR1cm4gZW5kR2FtZShzZWxmLCBHYW1lUmVzdWx0LkhvdXNlKTsNCiAgICBpZiAocmVzdWx0ID09IENvbXBhcmFpc29uUmVzdWx0LlNlY29uZCkgcmV0dXJuIGVuZEdhbWUoc2VsZiwgR2FtZVJlc3VsdC5QbGF5ZXIpOw0KDQogICAgZW5kR2FtZShzZWxmLCBHYW1lUmVzdWx0LlRpZSk7DQogIH0NCg0KICBmdW5jdGlvbiBjaGVja0dhbWVDb250aW51ZXMoR2FtZSBzdG9yYWdlIHNlbGYpICB7DQogICAgdWludDggcGxheWVySGFuZCA9IGNvdW50SGFuZChzZWxmLnBsYXllckNhcmRzKTsNCiAgICBpZiAocGxheWVySGFuZCA9PSB0YXJnZXQgJiYgc2VsZi5wbGF5ZXJDYXJkcy5sZW5ndGggPT0gMikgcmV0dXJuIGVuZEdhbWUoc2VsZiwgR2FtZVJlc3VsdC5QbGF5ZXJOYXR1cmFsKTsgLy8gcGxheWVyIG5hdHVyYWwNCiAgICBpZiAocGxheWVySGFuZCA+IHRhcmdldCkgcmV0dXJuIGVuZEdhbWUoc2VsZiwgR2FtZVJlc3VsdC5Ib3VzZSk7IC8vIFBsYXllciBidXN0ZWQNCiAgICBpZiAocGxheWVySGFuZCA9PSB0YXJnZXQpIHsNCiAgICAgIC8vIFBsYXllciBpcyBmb3JjZWQgdG8gc3RhbmQgd2l0aCAyMQ0KICAgICAgZm9yY2VTdGFuZChzZWxmKTsNCiAgICAgIGlmICghdGljayhzZWxmKSkgdGhyb3c7IC8vIEZvcmNlcyB0aWNrLCBjb21taXRtZW50IHRvIHBsYXkgYWN0dWFsbHkgaGFwcGVuZWQgcGFzdCBibG9jaw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGZvcmNlU3RhbmQoR2FtZSBzdG9yYWdlIHNlbGYpIHsNCiAgICB1aW50MjU2IGN1cnJlbnRBY3Rpb25CbG9jayA9IHNlbGYuYWN0aW9uQmxvY2s7DQogICAgcGxheWVyRGVjaXNpb24oc2VsZiwgR2FtZVN0YXRlLlN0YW5kKTsNCiAgICBzZWxmLmFjdGlvbkJsb2NrID0gY3VycmVudEFjdGlvbkJsb2NrOw0KICB9DQoNCiAgZnVuY3Rpb24gY2FuRG91YmxlRG93bihHYW1lIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgew0KICAgIGlmIChzZWxmLnBsYXllckNhcmRzLmxlbmd0aCA+IDIpIHJldHVybiBmYWxzZTsNCiAgICB1aW50OCB0b3RhbFBsYXllciA9IGNvdW50SGFuZChzZWxmLnBsYXllckNhcmRzKTsNCiAgICBpZiAodG90YWxQbGF5ZXIgPCA5IHx8IHRvdGFsUGxheWVyID4gMTEpIHJldHVybiBmYWxzZTsNCiAgICBpZiAobXNnLnZhbHVlICE9IHNlbGYuYmV0KSByZXR1cm4gZmFsc2U7DQogIH0NCg0KICBmdW5jdGlvbiBwbGF5ZXJEZWNpc2lvbihHYW1lIHN0b3JhZ2Ugc2VsZiwgR2FtZVN0YXRlIGRlY2lzaW9uKSAgew0KICAgIGlmIChzZWxmLnN0YXRlICE9IEdhbWVTdGF0ZS5XYWl0aW5nKSB0aHJvdzsNCiAgICBpZiAoZGVjaXNpb24gIT0gR2FtZVN0YXRlLkhpdCAmJiBkZWNpc2lvbiAhPSBHYW1lU3RhdGUuU3RhbmQpIHRocm93Ow0KDQogICAgc2VsZi5zdGF0ZSA9IGRlY2lzaW9uOw0KICAgIHNlbGYuYWN0aW9uQmxvY2sgPSBibG9jay5udW1iZXI7DQogIH0NCg0KICBmdW5jdGlvbiBkZWFsSW5pdGlhbENhcmRzKEdhbWUgc3RvcmFnZSBzZWxmKSBwcml2YXRlIHsNCiAgICBzZWxmLnBsYXllckNhcmRzLnB1c2goc2VsZi5kZWNrLmdldENhcmQoc2VsZi5hY3Rpb25CbG9jaykpOw0KICAgIHNlbGYuaG91c2VDYXJkcy5wdXNoKHNlbGYuZGVjay5nZXRDYXJkKHNlbGYuYWN0aW9uQmxvY2spKTsNCiAgICBzZWxmLnBsYXllckNhcmRzLnB1c2goc2VsZi5kZWNrLmdldENhcmQoc2VsZi5hY3Rpb25CbG9jaykpOw0KDQogICAgc2VsZi5zdGF0ZSA9IEdhbWVTdGF0ZS5XYWl0aW5nOw0KICB9DQoNCiAgZnVuY3Rpb24gZGVhbEhpdENhcmQoR2FtZSBzdG9yYWdlIHNlbGYpIHByaXZhdGUgew0KICAgIHNlbGYucGxheWVyQ2FyZHMucHVzaChzZWxmLmRlY2suZ2V0Q2FyZChzZWxmLmFjdGlvbkJsb2NrKSk7DQoNCiAgICBzZWxmLnN0YXRlID0gR2FtZVN0YXRlLldhaXRpbmc7DQogIH0NCg0KICBmdW5jdGlvbiBkZWFsSG91c2VDYXJkcyhHYW1lIHN0b3JhZ2Ugc2VsZikgcHJpdmF0ZSB7DQogICAgc2VsZi5ob3VzZUNhcmRzLnB1c2goc2VsZi5kZWNrLmdldENhcmQoc2VsZi5hY3Rpb25CbG9jaykpOw0KDQogICAgaWYgKGNvdW50SGFuZChzZWxmLmhvdXNlQ2FyZHMpIDwgaG91c2VMaW1pdCkgZGVhbEhvdXNlQ2FyZHMoc2VsZik7DQogIH0NCg0KICBmdW5jdGlvbiBlbmRHYW1lKEdhbWUgc3RvcmFnZSBzZWxmLCBHYW1lUmVzdWx0IHJlc3VsdCkgew0KICAgIHNlbGYucmVzdWx0ID0gcmVzdWx0Ow0KICAgIHNlbGYuc3RhdGUgPSBHYW1lU3RhdGUuRmluaXNoZWQ7DQogICAgc2VsZi5wYXlvdXQgPSBwYXlvdXRGb3JSZXN1bHQoc2VsZi5yZXN1bHQsIHNlbGYuYmV0KTsNCg0KICAgIGNsb3NlR2FtZShzZWxmKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNsb3NlR2FtZShHYW1lIHN0b3JhZ2Ugc2VsZikgcHJpdmF0ZSB7DQogICAgaWYgKHNlbGYuY2xvc2VkKSB0aHJvdzsgLy8gY2Fubm90IHJlLWNsb3NlDQogICAgaWYgKHNlbGYuc3RhdGUgIT0gR2FtZVN0YXRlLkZpbmlzaGVkKSB0aHJvdzsgLy8gbm90IGNsb3NhYmxlDQoNCiAgICBzZWxmLmNsb3NlZCA9IHRydWU7DQoNCiAgICBpZiAoc2VsZi5wYXlvdXQgPiAwKSB7DQogICAgICBpZiAoIXNlbGYucGxheWVyLnNlbmQoc2VsZi5wYXlvdXQpKSB0aHJvdzsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBwYXlvdXRGb3JSZXN1bHQoR2FtZVJlc3VsdCByZXN1bHQsIHVpbnQyNTYgYmV0KSBwcml2YXRlIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICBpZiAocmVzdWx0ID09IEdhbWVSZXN1bHQuUGxheWVyTmF0dXJhbCkgcmV0dXJuIGJldCAqIDUgLyAyOyAvLyBiZXQgKyAxLjV4IGJldA0KICAgIGlmIChyZXN1bHQgPT0gR2FtZVJlc3VsdC5QbGF5ZXIpIHJldHVybiBiZXQgKiAyOyAvLyBkb3VibGVzIGJldA0KICAgIGlmIChyZXN1bHQgPT0gR2FtZVJlc3VsdC5UaWUpIHJldHVybiBiZXQ7IC8vIHJldHVybnMgYmV0DQoNCiAgICByZXR1cm4gMDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvdW50SGFuZCh1aW50OFtdIG1lbW9yeSBoYW5kKSAgcmV0dXJucyAodWludDgpIHsNCiAgICB1aW50OFtdIG1lbW9yeSBwb3NzaWJsZVN1bXMgPSBuZXcgdWludDhbXSgxKTsNCg0KICAgIGZvciAodWludCBpID0gMDsgaSA8IGhhbmQubGVuZ3RoOyBpKyspIHsNCiAgICAgIHVpbnQ4IHZhbHVlID0gaGFuZFtpXS5ibGFja2phY2tWYWx1ZSgpOw0KICAgICAgdWludCBsID0gcG9zc2libGVTdW1zLmxlbmd0aDsNCiAgICAgIGZvciAodWludCBqID0gMDsgaiA8IGw7IGorKykgew0KICAgICAgICBwb3NzaWJsZVN1bXNbal0gKz0gdmFsdWU7DQogICAgICAgIGlmICh2YWx1ZSA9PSAxKSB7IC8vIGlzIEFjZQ0KICAgICAgICAgIHBvc3NpYmxlU3VtcyA9IGFwcGVuZEFycmF5KHBvc3NpYmxlU3VtcywgcG9zc2libGVTdW1zW2pdICsgMTApOyAvLyBGb3JrIHBvc3NpYmxlIHN1bSB3aXRoIDExIGFzIGFjZSB2YWx1ZS4NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybiBiZXN0U3VtKHBvc3NpYmxlU3Vtcyk7DQogIH0NCg0KICBmdW5jdGlvbiBiZXN0U3VtKHVpbnQ4W10gcG9zc2libGVTdW1zKSAgcmV0dXJucyAodWludDggYmVzdFN1bSkgew0KICAgIGJlc3RTdW0gPSA1MDsgLy8gdmVyeSBiYWQgaGFuZA0KICAgIGZvciAodWludCBpID0gMDsgaSA8IHBvc3NpYmxlU3Vtcy5sZW5ndGg7IGkrKykgew0KICAgICAgaWYgKGNvbXBhcmVIYW5kcyhiZXN0U3VtLCBwb3NzaWJsZVN1bXNbaV0pID09IENvbXBhcmFpc29uUmVzdWx0LlNlY29uZCkgew0KICAgICAgICBiZXN0U3VtID0gcG9zc2libGVTdW1zW2ldOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm47DQogIH0NCg0KICBmdW5jdGlvbiBhcHBlbmRBcnJheSh1aW50OFtdIG1lbW9yeSBhcnJheSwgdWludDggbikgIHJldHVybnMgKHVpbnQ4W10gbWVtb3J5KSB7DQogICAgdWludDhbXSBtZW1vcnkgbmV3QXJyYXkgPSBuZXcgdWludDhbXShhcnJheS5sZW5ndGggKyAxKTsNCiAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHsNCiAgICAgIG5ld0FycmF5W2ldID0gYXJyYXlbaV07DQogICAgfQ0KICAgIG5ld0FycmF5W2FycmF5Lmxlbmd0aF0gPSBuOw0KICAgIHJldHVybiBuZXdBcnJheTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvbXBhcmVIYW5kcyh1aW50OCBhLCB1aW50OCBiKSAgcmV0dXJucyAoQ29tcGFyYWlzb25SZXN1bHQpIHsNCiAgICBpZiAoYSA8PSB0YXJnZXQgJiYgYiA8PSB0YXJnZXQpIHsNCiAgICAgIGlmIChhID4gYikgcmV0dXJuIENvbXBhcmFpc29uUmVzdWx0LkZpcnN0Ow0KICAgICAgaWYgKGEgPCBiKSByZXR1cm4gQ29tcGFyYWlzb25SZXN1bHQuU2Vjb25kOw0KICAgIH0NCg0KICAgIGlmIChhID4gdGFyZ2V0ICYmIGIgPiB0YXJnZXQpIHsNCiAgICAgIGlmIChhIDwgYikgcmV0dXJuIENvbXBhcmFpc29uUmVzdWx0LkZpcnN0Ow0KICAgICAgaWYgKGEgPiBiKSByZXR1cm4gQ29tcGFyYWlzb25SZXN1bHQuU2Vjb25kOw0KICAgIH0NCg0KICAgIGlmIChhID4gdGFyZ2V0KSByZXR1cm4gQ29tcGFyYWlzb25SZXN1bHQuU2Vjb25kOw0KICAgIGlmIChiID4gdGFyZ2V0KSByZXR1cm4gQ29tcGFyYWlzb25SZXN1bHQuRmlyc3Q7DQoNCiAgICByZXR1cm4gQ29tcGFyYWlzb25SZXN1bHQuVGllOw0KICB9DQp9DQoNCmNvbnRyYWN0IEJsb2NramFjayB7DQogIEFic3RyYWN0QmxvY2tqYWNrTG9ncyBibG9ja2phY2tsb2dzOw0KDQogIHVzaW5nIEdhbWVMaWIgZm9yIEdhbWVMaWIuR2FtZTsNCg0KICBHYW1lTGliLkdhbWVbXSBnYW1lczsNCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgY3VycmVudEdhbWU7DQoNCiAgYm9vbCBjb250cmFjdENsZWFyZWQ7DQogIC8vIEluaXRpYWwgc2V0dGluZ3MNCiAgdWludDI1NiBwdWJsaWMgbWluQmV0ID0gNTAgZmlubmV5Ow0KICB1aW50MjU2IHB1YmxpYyBtYXhCZXQgPSA1MDAgZmlubmV5Ow0KICBib29sIHB1YmxpYyBhbGxvd3NOZXdHYW1lcyA9IGZhbHNlOw0KICB1aW50MjU2IHB1YmxpYyBtYXhCbG9ja0FjdGlvbnMgPSAxMDsNCg0KICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIGJsb2NrQWN0aW9uczsNCg0KICAvLyBBZG1pbg0KDQogIC8va292YW4NCiAgLy8gIGFkZHJlc3MgcHVibGljIERYID0gICAgICAgMHgwMDA2NDI2YTEwNTdjYmM2MDc2MjgwMkZGYjVGQmRjNTVEMDA4ZkFmOw0KICAvLyAgYWRkcmVzcyBwdWJsaWMgREVWID0gICAgICAweDAwMzFFRGI0ODQ2QkFiMkVERWRkN2Y3MjRFNThDNTA3NjJhNDVDYjI7DQoNCiAgLy9tYWluDQogIGFkZHJlc3MgcHVibGljIERYID0gMHgyOTZBZTFkMkQ5QTg3MDFlMTEzRWNkRjZjRTk4NmE0YTdEMEE2ZEM1Ow0KICBhZGRyZXNzIHB1YmxpYyBERVYgPSAweEJDNDM0M0IxMUI3Y2ZkZDZkRDYzNWY2MTAzOWI4YTY2YUY2RTczQmI7DQoNCg0KDQogIGFkZHJlc3MgcHVibGljIEFETUlOX0NPTlRSQUNUOw0KDQogIHVpbnQyNTYgcHVibGljIEJBTktST0xMX0xPQ0tfUEVSSU9EID0gMzAgZGF5czsNCg0KICB1aW50MjU2IHB1YmxpYyBiYW5rcm9sbExvY2tlZFVudGlsOw0KICB1aW50MjU2IHB1YmxpYyBwcm9maXRzTG9ja2VkVW50aWw7DQogIHVpbnQyNTYgcHVibGljIGluaXRpYWxCYW5rcm9sbDsNCiAgdWludDI1NiBwdWJsaWMgY3VycmVudEJhbmtyb2xsOw0KDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzT3duZXI7DQoNCiAgbW9kaWZpZXIgb25seU93bmVyIHsNCiAgICBpZiAoIWlzT3duZXJbbXNnLnNlbmRlcl0pIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5KGFkZHJlc3MgeCkgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IHgpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5UGxheWVyKHVpbnQyNTYgZ2FtZUlEKSB7DQogICAgaWYgKG1zZy5zZW5kZXIgIT0gZ2FtZXNbZ2FtZUlEXS5wbGF5ZXIpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBibG9ja0FjdGlvblByb3RlY3RlZCB7DQogICAgYmxvY2tBY3Rpb25zW2Jsb2NrLm51bWJlcl0gKz0gMTsNCiAgICBpZiAoYmxvY2tBY3Rpb25zW2Jsb2NrLm51bWJlcl0gPiBtYXhCbG9ja0FjdGlvbnMpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBmdW5jdGlvbiBCbG9ja2phY2soYWRkcmVzcyBfYWRtaW5fY29udHJhY3QsIGFkZHJlc3MgX2xvZ3NfY29udHJhY3QpIHsgLy8gb25seShERVYpIHsNCiAgICBBRE1JTl9DT05UUkFDVCA9IF9hZG1pbl9jb250cmFjdDsNCiAgICBibG9ja2phY2tsb2dzID0gQWJzdHJhY3RCbG9ja2phY2tMb2dzKF9sb2dzX2NvbnRyYWN0KTsNCiAgICBnYW1lcy5sZW5ndGggKz0gMTsNCiAgICBnYW1lc1swXS5pbml0KDApOyAvLyBJbml0IGdhbWUgMCBzbyBpbmRpY2VzIHN0YXJ0IG9uIDENCiAgICBnYW1lc1swXS5wbGF5ZXIgPSB0aGlzOw0KICAgIHNldHVwVHJ1c3RlZEFjY291bnRzKCk7DQogIH0NCg0KICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsNCiAgICBzdGFydEdhbWUoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN0YXJ0R2FtZSgpIGJsb2NrQWN0aW9uUHJvdGVjdGVkIHBheWFibGUgew0KICAgIGlmICghYWxsb3dzTmV3R2FtZXMpIHRocm93Ow0KICAgIGlmIChtc2cudmFsdWUgPCBtaW5CZXQpIHRocm93Ow0KICAgIGlmIChtc2cudmFsdWUgPiBtYXhCZXQpIHRocm93Ow0KDQogICAgLy8gY2hlY2sgaWYgcGxheWVyIGhhcyBnYW1lIG9wZW5lZA0KICAgIHVpbnQyNTYgY3VycmVudEdhbWVJZCA9IGN1cnJlbnRHYW1lW21zZy5zZW5kZXJdOw0KICAgIGlmIChnYW1lcy5sZW5ndGggPiBjdXJyZW50R2FtZUlkKSB7DQogICAgICBHYW1lTGliLkdhbWUgb3BlbmVkR2FtZSA9IGdhbWVzW2N1cnJlbnRHYW1lSWRdOw0KICAgICAgaWYgKG9wZW5lZEdhbWUucGxheWVyID09IG1zZy5zZW5kZXIgJiYgIW9wZW5lZEdhbWUuY2xvc2VkKSB7IC8vIENoZWNrIGZvciBpbmRleCAwIG1hcHBpbmcgcHJvYmxlbXMNCglpZiAoIW9wZW5lZEdhbWUudGljaygpKSB0aHJvdzsNCglpZiAoIW9wZW5lZEdhbWUuY2xvc2VkKSB0aHJvdzsgLy8gY2Fubm90IHN0YXJ0IGdhbWUgd2l0aCBvbi1nb2luZyBnYW1lDQoJcmVjb3JkRW5kZWRHYW1lKGN1cnJlbnRHYW1lSWQpOw0KICAgICAgfQ0KICAgIH0NCiAgICB1aW50MjU2IG5ld0dhbWVJRCA9IGdhbWVzLmxlbmd0aDsNCg0KICAgIGdhbWVzLmxlbmd0aCArPSAxOw0KICAgIGdhbWVzW25ld0dhbWVJRF0uaW5pdChuZXdHYW1lSUQpOw0KICAgIGN1cnJlbnRHYW1lW21zZy5zZW5kZXJdID0gbmV3R2FtZUlEOw0KICAgIHRpY2tSZXF1aXJlZExvZyhnYW1lc1tuZXdHYW1lSURdKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGhpdCh1aW50MjU2IGdhbWVJRCkgb25seVBsYXllcihnYW1lSUQpIGJsb2NrQWN0aW9uUHJvdGVjdGVkIHsNCiAgICBHYW1lTGliLkdhbWUgZ2FtZSA9IGdhbWVzW2dhbWVJRF07DQoNCiAgICBpZiAoIWdhbWUudGljaygpKSB0aHJvdzsNCiAgICBnYW1lLnBsYXllckRlY2lzaW9uKEdhbWVMaWIuR2FtZVN0YXRlLkhpdCk7DQogICAgdGlja1JlcXVpcmVkTG9nKGdhbWUpOw0KICB9DQoNCiAgZnVuY3Rpb24gZG91YmxlRG93bih1aW50MjU2IGdhbWVJRCkgb25seVBsYXllcihnYW1lSUQpIGJsb2NrQWN0aW9uUHJvdGVjdGVkIHBheWFibGUgew0KICAgIEdhbWVMaWIuR2FtZSBnYW1lID0gZ2FtZXNbZ2FtZUlEXTsNCg0KICAgIGlmICghZ2FtZS50aWNrKCkpIHRocm93Ow0KICAgIGdhbWUucGxheWVyRGVjaXNpb24oR2FtZUxpYi5HYW1lU3RhdGUuRG91YmxlRG93bik7DQogICAgdGlja1JlcXVpcmVkTG9nKGdhbWUpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3RhbmQodWludDI1NiBnYW1lSUQpIG9ubHlQbGF5ZXIoZ2FtZUlEKSBibG9ja0FjdGlvblByb3RlY3RlZCB7DQogICAgR2FtZUxpYi5HYW1lIGdhbWUgPSBnYW1lc1tnYW1lSURdOw0KDQogICAgaWYgKCFnYW1lLnRpY2soKSkgdGhyb3c7DQogICAgZ2FtZS5wbGF5ZXJEZWNpc2lvbihHYW1lTGliLkdhbWVTdGF0ZS5TdGFuZCk7DQogICAgdGlja1JlcXVpcmVkTG9nKGdhbWUpOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2FtZVRpY2sodWludDI1NiBnYW1lSUQpIGJsb2NrQWN0aW9uUHJvdGVjdGVkIHsNCiAgICBHYW1lTGliLkdhbWUgb3BlbmVkR2FtZSA9IGdhbWVzW2dhbWVJRF07DQogICAgaWYgKG9wZW5lZEdhbWUuY2xvc2VkKSB0aHJvdzsNCiAgICBpZiAoIW9wZW5lZEdhbWUudGljaygpKSB0aHJvdzsNCiAgICBpZiAob3BlbmVkR2FtZS5jbG9zZWQpIHJlY29yZEVuZGVkR2FtZShnYW1lSUQpOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVjb3JkRW5kZWRHYW1lKHVpbnQgZ2FtZUlEKSBwcml2YXRlIHsNCiAgICBHYW1lTGliLkdhbWUgb3BlbmVkR2FtZSA9IGdhbWVzW2dhbWVJRF07DQoNCiAgICAvL3ZzIHBvdGVudGlhbCBvdmVyZmxvdyB3aGVuIGNyb3VwaWVyIGlzIG5vdCB0aWNraW5nIGZyZXF1ZW50bHkgZW5vdWdoDQogICAgaWYoY3VycmVudEJhbmtyb2xsICsgb3BlbmVkR2FtZS5iZXQgPiBvcGVuZWRHYW1lLnBheW91dCl7DQogICAgICBjdXJyZW50QmFua3JvbGwgPSBjdXJyZW50QmFua3JvbGwgKyBvcGVuZWRHYW1lLmJldCAtIG9wZW5lZEdhbWUucGF5b3V0Ow0KICAgIH0NCg0KICAgIGJsb2NramFja2xvZ3MucmVjb3JkTG9nKA0KCQkJICAgIG9wZW5lZEdhbWUuZ2FtZUlELA0KCQkJICAgIG9wZW5lZEdhbWUucGxheWVyLA0KCQkJICAgIHVpbnQob3BlbmVkR2FtZS5yZXN1bHQpLA0KCQkJICAgIG9wZW5lZEdhbWUucGF5b3V0LA0KCQkJICAgIEdhbWVMaWIuY291bnRIYW5kKG9wZW5lZEdhbWUucGxheWVyQ2FyZHMpLA0KCQkJICAgIEdhbWVMaWIuY291bnRIYW5kKG9wZW5lZEdhbWUuaG91c2VDYXJkcykNCgkJCSAgICApOw0KICB9DQoNCiAgZnVuY3Rpb24gdGlja1JlcXVpcmVkTG9nKEdhbWVMaWIuR2FtZSBzdG9yYWdlIGdhbWUpIHByaXZhdGUgew0KICAgIGJsb2NramFja2xvZ3MudGlja1JlcXVpcmVkTG9nKGdhbWUuZ2FtZUlELCBnYW1lLnBsYXllciwgZ2FtZS5hY3Rpb25CbG9jayk7DQogIH0NCg0KICAvLyBDb25zdGFudHMNCg0KICBmdW5jdGlvbiBnYW1lU3RhdGUodWludCBpKSBjb25zdGFudCByZXR1cm5zICh1aW50OFtdLCB1aW50OFtdLCB1aW50OCwgdWludDgsIHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQ4LCB1aW50OCwgYm9vbCwgdWludDI1Nikgew0KICAgIEdhbWVMaWIuR2FtZSBnYW1lID0gZ2FtZXNbaV07DQoNCiAgICByZXR1cm4gKA0KCSAgICBnYW1lLmhvdXNlQ2FyZHMsDQoJICAgIGdhbWUucGxheWVyQ2FyZHMsDQoJICAgIEdhbWVMaWIuY291bnRIYW5kKGdhbWUuaG91c2VDYXJkcyksDQoJICAgIEdhbWVMaWIuY291bnRIYW5kKGdhbWUucGxheWVyQ2FyZHMpLA0KCSAgICBnYW1lLmJldCwNCgkgICAgZ2FtZS5wYXlvdXQsDQoJICAgIHVpbnQ4KGdhbWUuc3RhdGUpLA0KCSAgICB1aW50OChnYW1lLnJlc3VsdCksDQoJICAgIGdhbWUuY2xvc2VkLA0KCSAgICBnYW1lLmFjdGlvbkJsb2NrDQoJICAgICk7DQogIH0NCg0KICAvLyBBZG1pbg0KICBmdW5jdGlvbiBzZXR1cFRydXN0ZWRBY2NvdW50cygpDQogICAgaW50ZXJuYWwNCiAgew0KICAgIGlzT3duZXJbRFhdID0gdHJ1ZTsNCiAgICBpc093bmVyW0RFVl0gPSB0cnVlOw0KICAgIGlzT3duZXJbQURNSU5fQ09OVFJBQ1RdID0gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNoYW5nZURldihhZGRyZXNzIG5ld0Rldikgb25seShERVYpIHsNCiAgICBpc093bmVyW0RFVl0gPSBmYWxzZTsNCiAgICBERVYgPSBuZXdEZXY7DQogICAgaXNPd25lcltERVZdID0gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNoYW5nZURYKGFkZHJlc3MgbmV3RFgpIG9ubHkoRFgpIHsNCiAgICBpc093bmVyW0RYXSA9IGZhbHNlOw0KICAgIERYID0gbmV3RFg7DQogICAgaXNPd25lcltEWF0gPSB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gY2hhbmdlQWRtaW5Db250cmFjdChhZGRyZXNzIF9uZXdfYWRtaW5fY29udHJhY3QpIG9ubHkoQURNSU5fQ09OVFJBQ1QpIHsNCiAgICBpc093bmVyW0FETUlOX0NPTlRSQUNUXSA9IGZhbHNlOw0KICAgIEFETUlOX0NPTlRSQUNUID0gX25ld19hZG1pbl9jb250cmFjdDsNCiAgICBpc093bmVyW0FETUlOX0NPTlRSQUNUXSA9IHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBzZXRTZXR0aW5ncyh1aW50MjU2IF9taW4sIHVpbnQyNTYgX21heCwgdWludDI1NiBfbWF4QmxvY2tBY3Rpb25zKSBvbmx5KEFETUlOX0NPTlRSQUNUKSB7DQogICAgbWluQmV0ID0gX21pbjsNCiAgICBtYXhCZXQgPSBfbWF4Ow0KICAgIG1heEJsb2NrQWN0aW9ucyA9IF9tYXhCbG9ja0FjdGlvbnM7DQogIH0NCg0KICBmdW5jdGlvbiByZWdpc3Rlck93bmVyKGFkZHJlc3MgX25ld193YXRjaGVyKSBvbmx5KEFETUlOX0NPTlRSQUNUKSB7DQogICAgaXNPd25lcltfbmV3X3dhdGNoZXJdID0gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlbW92ZU93bmVyKGFkZHJlc3MgX29sZF93YXRjaGVyKSBvbmx5KEFETUlOX0NPTlRSQUNUKSB7DQogICAgaXNPd25lcltfb2xkX3dhdGNoZXJdID0gZmFsc2U7DQogIH0NCg0KICBmdW5jdGlvbiBzdG9wQmxvY2tqYWNrKCkgb25seU93bmVyIHsNCiAgICBhbGxvd3NOZXdHYW1lcyA9IGZhbHNlOw0KICB9DQoNCiAgZnVuY3Rpb24gc3RhcnRCbG9ja2phY2soKSBvbmx5KEFETUlOX0NPTlRSQUNUKSB7DQogICAgYWxsb3dzTmV3R2FtZXMgPSB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gYWRkQmFua3JvbGwoKSBvbmx5KERYKSBwYXlhYmxlIHsNCiAgICBpbml0aWFsQmFua3JvbGwgKz0gbXNnLnZhbHVlOw0KICAgIGN1cnJlbnRCYW5rcm9sbCArPSBtc2cudmFsdWU7DQogIH0NCg0KICBmdW5jdGlvbiByZW1haW5pbmdCYW5rcm9sbCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gY3VycmVudEJhbmtyb2xsID4gaW5pdGlhbEJhbmtyb2xsID8gaW5pdGlhbEJhbmtyb2xsIDogY3VycmVudEJhbmtyb2xsOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVtb3ZlQmFua3JvbGwoKSBvbmx5KERYKSB7DQogICAgaWYgKGluaXRpYWxCYW5rcm9sbCA+IGN1cnJlbnRCYW5rcm9sbCAtIDUgZXRoZXIgJiYgYmFua3JvbGxMb2NrZWRVbnRpbCA+IG5vdykgdGhyb3c7DQoNCiAgICBzdG9wQmxvY2tqYWNrKCk7DQoNCiAgICBpZiAoY3VycmVudEJhbmtyb2xsID4gaW5pdGlhbEJhbmtyb2xsKSB7IC8vIHRoZXJlIGFyZSBwcm9maXRzDQogICAgICBpZiAoIURFVi5zZW5kKGN1cnJlbnRCYW5rcm9sbCAtIGluaXRpYWxCYW5rcm9sbCkpIHRocm93Ow0KICAgIH0NCg0KICAgIHN1aWNpZGUoRFgpOyAvLyBzZW5kIHJlc3QgdG8gZHgNCiAgICBjb250cmFjdENsZWFyZWQgPSB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gbWlncmF0ZUJsb2NramFjaygpIG9ubHkoQURNSU5fQ09OVFJBQ1QpIHsNCiAgICBzdG9wQmxvY2tqYWNrKCk7DQoNCiAgICBpZiAoY3VycmVudEJhbmtyb2xsID4gaW5pdGlhbEJhbmtyb2xsKSB7IC8vIHRoZXJlIGFyZSBwcm9maXRzLCBzaGFyZSB0aGVtDQogICAgICBpZiAoIUFETUlOX0NPTlRSQUNULmNhbGwudmFsdWUoY3VycmVudEJhbmtyb2xsIC0gaW5pdGlhbEJhbmtyb2xsKSgpKSB0aHJvdzsNCiAgICB9DQogICAgc3VpY2lkZShEWCk7IC8vIHNlbmQgcmVzdCB0byBkeA0KICAgIC8vRFggd2lsbCBoYXZlIHRvIHJlZnVuZCB0aGUgbm9uIGZpbmFsaXplZCBiZXRzIHRoYXQgbWF5IGhhdmUgYmVlbiBzdG9wcGVkDQogIH0NCg0KICBmdW5jdGlvbiBzaGFyZVByb2ZpdHMoKSBvbmx5T3duZXIgew0KICAgIGlmIChwcm9maXRzTG9ja2VkVW50aWwgPiBub3cpIHRocm93Ow0KICAgIGlmIChjdXJyZW50QmFua3JvbGwgPD0gaW5pdGlhbEJhbmtyb2xsKSB0aHJvdzsgLy8gdGhlcmUgYXJlIG5vIHByb2ZpdHMNCg0KICAgIHVpbnQyNTYgcHJvZml0ID0gY3VycmVudEJhbmtyb2xsIC0gaW5pdGlhbEJhbmtyb2xsOw0KICAgIGlmICghQURNSU5fQ09OVFJBQ1QuY2FsbC52YWx1ZShwcm9maXQpKCkpIHRocm93Ow0KICAgIGN1cnJlbnRCYW5rcm9sbCAtPSBwcm9maXQ7DQoNCiAgICBiYW5rcm9sbExvY2tlZFVudGlsID0gbm93ICsgQkFOS1JPTExfTE9DS19QRVJJT0Q7DQogICAgcHJvZml0c0xvY2tlZFVudGlsID0gYmFua3JvbGxMb2NrZWRVbnRpbCArIEJBTktST0xMX0xPQ0tfUEVSSU9EOw0KICB9DQp9'