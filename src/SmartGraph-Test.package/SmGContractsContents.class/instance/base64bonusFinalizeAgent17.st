base 64 content
base64bonusFinalizeAgent17
	^'LyoqDQogKiBTYWZlIHVuc2lnbmVkIHNhZmUgbWF0aC4NCiAqDQogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQ0KICoNCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQXJhZ29uT25lL3plcHBlbGluLXNvbGlkaXR5L21hc3Rlci9jb250cmFjdHMvU2FmZU1hdGhMaWIuc29sDQogKg0KICogTWFpbnRhaW5lZCBoZXJlIHVudGlsIG1lcmdlZCB0byBtYWlubGluZSB6ZXBwZWxpbi1zb2xpZGl0eS4NCiAqDQogKi8NCmxpYnJhcnkgU2FmZU1hdGhMaWIgew0KDQogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gcGx1cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjPj1hICYmIGM+PWIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBwcml2YXRlIHsNCiAgICBpZiAoIWFzc2VydGlvbikgdGhyb3c7DQogIH0NCn0NCg0KDQoNCg0KLyoNCiAqIE93bmFibGUNCiAqDQogKiBCYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIuDQogKiBQcm92aWRlcyBvbmx5T3duZXIgbW9kaWZpZXIsIHdoaWNoIHByZXZlbnRzIGZ1bmN0aW9uIGZyb20gcnVubmluZyBpZiBpdCBpcyBjYWxsZWQgYnkgYW55b25lIG90aGVyIHRoYW4gdGhlIG93bmVyLg0KICovDQpjb250cmFjdCBPd25hYmxlIHsNCiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsNCiAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogIH0NCg0KICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICBfOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsNCiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgew0KICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICB9DQogIH0NCg0KfQ0KDQoNCi8qDQogKiBIYWx0YWJsZQ0KICoNCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbg0KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLg0KICoNCiAqDQogKiBPcmlnaW5hbGx5IGVudmlzaW9uZWQgaW4gRmlyc3RCbG9vZCBJQ08gY29udHJhY3QuDQogKi8NCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgew0KICBib29sIHB1YmxpYyBoYWx0ZWQ7DQoNCiAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsNCiAgICBpZiAoaGFsdGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsNCiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlDQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgew0KICAgIGhhbHRlZCA9IHRydWU7DQogIH0NCg0KICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlDQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgew0KICAgIGhhbHRlZCA9IGZhbHNlOw0KICB9DQoNCn0NCg0KDQovKioNCiAqIEludGVyZmFjZSBmb3IgZGVmaW5pbmcgY3Jvd2RzYWxlIHByaWNpbmcuDQogKi8NCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7DQoNCiAgLyoqIEludGVyZmFjZSBkZWNsYXJhdGlvbi4gKi8NCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFNlbGYgY2hlY2sgaWYgYWxsIHJlZmVyZW5jZXMgYXJlIGNvcnJlY3RseSBzZXQuDQogICAqDQogICAqIENoZWNrcyB0aGF0IHByaWNpbmcgc3RyYXRlZ3kgbWF0Y2hlcyBjcm93ZHNhbGUgcGFyYW1ldGVycy4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIGNyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0Lg0KICAgKg0KICAgKg0KICAgKiBAcGFyYW0gdmFsdWUgLSBXaGF0IGlzIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VuZCBpbiBhcyB3ZWkNCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXINCiAgICogQHBhcmFtIHdlaVJhaXNlZCAtIGhvdyBtdWNoIG1vbmV5IGhhcyBiZWVuIHJhaXNlZCB0aGlzIGZhcg0KICAgKiBAcGFyYW0gbXNnU2VuZGVyIC0gd2hvIGlzIHRoZSBpbnZlc3RvciBvZiB0aGlzIHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcw0KICAgKiBAcmV0dXJuIEFtb3VudCBvZiB0b2tlbnMgdGhlIGludmVzdG9yIHJlY2VpdmVzDQogICAqLw0KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHRva2Vuc1NvbGQsIHVpbnQgd2VpUmFpc2VkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOw0KfQ0KDQoNCi8qKg0KICogRmluYWxpemUgYWdlbnQgZGVmaW5lcyB3aGF0IGhhcHBlbnMgYXQgdGhlIGVuZCBvZiBzdWNjZXNlZnVsIGNyb3dkc2FsZS4NCiAqDQogKiAtIEFsbG9jYXRlIHRva2VucyBmb3IgZm91bmRlcnMsIGJvdW50aWVzIGFuZCBjb21tdW5pdHkNCiAqIC0gTWFrZSB0b2tlbnMgdHJhbnNmZXJhYmxlDQogKiAtIGV0Yy4NCiAqLw0KY29udHJhY3QgRmluYWxpemVBZ2VudCB7DQoNCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFJldHVybiB0cnVlIGlmIHdlIGNhbiBydW4gZmluYWxpemVDcm93ZHNhbGUoKSBwcm9wZXJseS4NCiAgICoNCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luDQogICAqIHVubGVzcyB0aGUgZmluYWxpemVyIGhhcyBiZWVuIHNldCB1cCBwcm9wZXJseS4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsNCg0KICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovDQogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7DQoNCn0NCg0KDQoNCg0KLyoNCiAqIEVSQzIwIGludGVyZmFjZQ0KICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMCB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCg0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQoNCi8qKg0KICogQSB0b2tlbiB0aGF0IGRlZmluZXMgZnJhY3Rpb25hbCB1bml0cyBhcyBkZWNpbWFscy4NCiAqLw0KY29udHJhY3QgRnJhY3Rpb25hbEVSQzIwIGlzIEVSQzIwIHsNCg0KICB1aW50IHB1YmxpYyBkZWNpbWFsczsNCg0KfQ0KDQoNCg0KLyoqDQogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcy4NCiAqDQogKiBIYW5kbGUNCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcw0KICogLSBhY2NlcHRpbmcgaW52ZXN0bWVudHMNCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZA0KICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQNCiAqIC0gZGlmZmVyZW50IHByaWNpbmcgc3RyYXRlZ2llcw0KICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpDQogKg0KICovDQpjb250cmFjdCBDcm93ZHNhbGUgaXMgSGFsdGFibGUgew0KDQogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50Ow0KDQogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLw0KICBGcmFjdGlvbmFsRVJDMjAgcHVibGljIHRva2VuOw0KDQogIC8qIEhvdyB3ZSBhcmUgZ29pbmcgdG8gcHJpY2Ugb3VyIG9mZmVyaW5nICovDQogIFByaWNpbmdTdHJhdGVneSBwdWJsaWMgcHJpY2luZ1N0cmF0ZWd5Ow0KDQogIC8qIFBvc3Qtc3VjY2VzcyBjYWxsYmFjayAqLw0KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50Ow0KDQogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8NCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7DQoNCiAgLyogaWYgdGhlIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZCwgaW52ZXN0b3JzIG1heSB3aXRoZHJhdyB0aGVpciBmdW5kcyAqLw0KICB1aW50IHB1YmxpYyBtaW5pbXVtRnVuZGluZ0dvYWw7DQoNCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLw0KICB1aW50IHB1YmxpYyBzdGFydHNBdDsNCg0KICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLw0KICB1aW50IHB1YmxpYyBlbmRzQXQ7DQoNCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovDQogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOw0KDQogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovDQogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7DQoNCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8NCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7DQoNCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLw0KICB1aW50IHB1YmxpYyBsb2FkZWRSZWZ1bmQgPSAwOw0KDQogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIGdpdmVuIGJhY2sgdG8gaW52ZXN0b3JzLiovDQogIHVpbnQgcHVibGljIHdlaVJlZnVuZGVkID0gMDsNCg0KICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8NCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOw0KDQogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8NCiAgYm9vbCBwdWJsaWMgcmVxdWlyZUN1c3RvbWVySWQ7DQoNCiAgLyoqDQogICAgKiBEbyB3ZSB2ZXJpZnkgdGhhdCBjb250cmlidXRvciBoYXMgYmVlbiBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSAoYWNjcmVkaXRlZCBpbnZlc3RvcnMgb25seSkuDQogICAgKiBUaGlzIG1ldGhvZCB3YXMgZmlyc3QgdXNlZCBpbiBGaXJzdEJsb29kIGNyb3dkc2FsZSB0byBlbnN1cmUgYWxsIGNvbnRyaWJ1dG9ycyBoYXZlIGFjY2VwdGVkIHRlcm1zIG9uIHNhbGUgKG9uIHRoZSB3ZWIpLg0KICAgICovDQogIGJvb2wgcHVibGljIHJlcXVpcmVkU2lnbmVkQWRkcmVzczsNCg0KICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8NCiAgYWRkcmVzcyBwdWJsaWMgc2lnbmVyQWRkcmVzczsNCg0KICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaW52ZXN0ZWRBbW91bnRPZjsNCg0KICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2VuQW1vdW50T2Y7DQoNCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNhbCBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdDsNCg0KICAvKiogVGhpcyBpcyBmb3IgbWFudWwgdGVzdGluZyBmb3IgdGhlIGludGVyYWN0aW9uIGZyb20gb3duZXIgd2FsbGV0LiBZb3UgY2FuIHNldCBpdCB0byBhbnkgdmFsdWUgYW5kIGluc3BlY3QgdGhpcyBpbiBibG9ja2NoYWluIGV4cGxvcmVyIHRvIHNlZSB0aGF0IGNyb3dkc2FsZSBpbnRlcmFjdGlvbiB3b3Jrcy4gKi8NCiAgdWludCBwdWJsaWMgb3duZXJUZXN0VmFsdWU7DQoNCiAgLyoqIFN0YXRlIG1hY2hpbmUNCiAgICoNCiAgICogLSBQcmVwYXJpbmc6IEFsbCBjb250cmFjdCBpbml0aWFsaXphdGlvbiBjYWxscyBhbmQgdmFyaWFibGVzIGhhdmUgbm90IGJlZW4gc2V0IHlldA0KICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHBhc3NlZCBzdGFydCB0aW1lIHlldA0KICAgKiAtIEZ1bmRpbmc6IEFjdGl2ZSBjcm93ZHNhbGUNCiAgICogLSBTdWNjZXNzOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCByZWFjaGVkDQogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lDQogICAqIC0gRmluYWxpemVkOiBUaGUgZmluYWxpemVkIGhhcyBiZWVuIGNhbGxlZCBhbmQgc3VjY2VzZnVsbHkgZXhlY3V0ZWQNCiAgICogLSBSZWZ1bmRpbmc6IFJlZnVuZHMgYXJlIGxvYWRlZCBvbiB0aGUgY29udHJhY3QgZm9yIHJlY2xhaW0uDQogICAqLw0KICBlbnVtIFN0YXRle1Vua25vd24sIFByZXBhcmluZywgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmFpbHVyZSwgRmluYWxpemVkLCBSZWZ1bmRpbmd9DQoNCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQ0KICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludDEyOCBjdXN0b21lcklkKTsNCg0KICAvLyBSZWZ1bmQgd2FzIHByb2Nlc3NlZCBmb3IgYSBjb250cmlidXRvcg0KICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOw0KDQogIC8vIFRoZSBydWxlcyB3ZXJlIGNoYW5nZWQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdA0KICBldmVudCBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChib29sIHJlcXVpcmVDdXN0b21lcklkLCBib29sIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgYWRkcmVzcyBzaWduZXJBZGRyZXNzKTsNCg0KICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkDQogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpOw0KDQogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkDQogIGV2ZW50IEVuZHNBdENoYW5nZWQodWludCBlbmRzQXQpOw0KDQogIGZ1bmN0aW9uIENyb3dkc2FsZShhZGRyZXNzIF90b2tlbiwgUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3ksIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCB1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF9taW5pbXVtRnVuZGluZ0dvYWwpIHsNCg0KICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCg0KICAgIHRva2VuID0gRnJhY3Rpb25hbEVSQzIwKF90b2tlbik7DQoNCiAgICBzZXRQcmljaW5nU3RyYXRlZ3koX3ByaWNpbmdTdHJhdGVneSk7DQoNCiAgICBtdWx0aXNpZ1dhbGxldCA9IF9tdWx0aXNpZ1dhbGxldDsNCiAgICBpZihtdWx0aXNpZ1dhbGxldCA9PSAwKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGlmKF9zdGFydCA9PSAwKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIHN0YXJ0c0F0ID0gX3N0YXJ0Ow0KDQogICAgaWYoX2VuZCA9PSAwKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGVuZHNBdCA9IF9lbmQ7DQoNCiAgICAvLyBEb24ndCBtZXNzIHRoZSBkYXRlcw0KICAgIGlmKHN0YXJ0c0F0ID49IGVuZHNBdCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBjYW4gYmUgemVybw0KICAgIG1pbmltdW1GdW5kaW5nR29hbCA9IF9taW5pbXVtRnVuZGluZ0dvYWw7DQogIH0NCg0KICAvKioNCiAgICogRG9uJ3QgZXhwZWN0IHRvIGp1c3Qgc2VuZCBpbiBtb25leSBhbmQgZ2V0IHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uKCkgcGF5YWJsZSB7DQogICAgdGhyb3c7DQogIH0NCg0KICAvKioNCiAgICogTWFrZSBhbiBpbnZlc3RtZW50Lg0KICAgKg0KICAgKiBDcm93ZHNhbGUgbXVzdCBiZSBydW5uaW5nIGZvciBvbmUgdG8gaW52ZXN0Lg0KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4NCiAgICoNCiAgICogQHBhcmFtIHJlY2VpdmVyIFRoZSBFdGhlcmV1bSBhZGRyZXNzIHdobyByZWNlaXZlcyB0aGUgdG9rZW5zDQogICAqIEBwYXJhbSBjdXN0b21lcklkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUNCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgc3RvcEluRW1lcmdlbmN5IHByaXZhdGUgew0KDQogICAgLy8gRGV0ZXJtaW5lIGlmIGl0J3MgYSBnb29kIHRpbWUgdG8gYWNjZXB0IGludmVzdG1lbnQgZnJvbSB0aGlzIHBhcnRpY2lwYW50DQogICAgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5QcmVGdW5kaW5nKSB7DQogICAgICAvLyBBcmUgd2Ugd2hpdGVsaXN0ZWQgZm9yIGVhcmx5IGRlcG9zaXQNCiAgICAgIGlmKCFlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W3JlY2VpdmVyXSkgew0KICAgICAgICB0aHJvdzsNCiAgICAgIH0NCiAgICB9IGVsc2UgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5GdW5kaW5nKSB7DQogICAgICAvLyBSZXRhaWwgcGFydGljaXBhbnRzIGNhbiBvbmx5IGNvbWUgaW4gd2hlbiB0aGUgY3Jvd2RzYWxlIGlzIHJ1bm5pbmcNCiAgICAgIC8vIHBhc3MNCiAgICB9IGVsc2Ugew0KICAgICAgLy8gVW53YW50ZWQgc3RhdGUNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIHVpbnQgd2VpQW1vdW50ID0gbXNnLnZhbHVlOw0KICAgIHVpbnQgdG9rZW5BbW91bnQgPSBwcmljaW5nU3RyYXRlZ3kuY2FsY3VsYXRlUHJpY2Uod2VpQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQsIG1zZy5zZW5kZXIsIHRva2VuLmRlY2ltYWxzKCkpOw0KDQogICAgaWYodG9rZW5BbW91bnQgPT0gMCkgew0KICAgICAgLy8gRHVzdCB0cmFuc2FjdGlvbg0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgew0KICAgICAgIC8vIEEgbmV3IGludmVzdG9yDQogICAgICAgaW52ZXN0b3JDb3VudCsrOw0KICAgIH0NCg0KICAgIC8vIFVwZGF0ZSBpbnZlc3Rvcg0KICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOw0KICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0ucGx1cyh0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBVcGRhdGUgdG90YWxzDQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsNCiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5wbHVzKHRva2VuQW1vdW50KTsNCg0KICAgIC8vIENoZWNrIHRoYXQgd2UgZGlkIG5vdCBidXN0IHRoZSBjYXANCiAgICBpZihpc0JyZWFraW5nQ2FwKHRva2VuQW1vdW50LCB3ZWlBbW91bnQsIHdlaVJhaXNlZCwgdG9rZW5zU29sZCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOw0KDQogICAgLy8gUG9ja2V0IHRoZSBtb25leQ0KICAgIGlmKCFtdWx0aXNpZ1dhbGxldC5zZW5kKHdlaUFtb3VudCkpIHRocm93Ow0KDQogICAgLy8gVGVsbCB1cyBpbnZlc3Qgd2FzIHN1Y2Nlc3MNCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgYW5vbnltb3VzIGNvbnRyaWJ1dGlvbnMgdG8gdGhpcyBjcm93ZHNhbGUuDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3RXaXRoU2lnbmVkQWRkcmVzcyhhZGRyZXNzIGFkZHIsIHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICAgYnl0ZXMzMiBoYXNoID0gc2hhMjU2KGFkZHIpOw0KICAgICBpZiAoZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpICE9IHNpZ25lckFkZHJlc3MpIHRocm93Ow0KICAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjaw0KICAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCBjdXN0b21lcklkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBUcmFjayB3aG8gaXMgdGhlIGN1c3RvbWVyIG1ha2luZyB0aGUgcGF5bWVudCBzbyB3ZSBjYW4gc2VuZCB0aGFuayB5b3UgZW1haWwuDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3RXaXRoQ3VzdG9tZXJJZChhZGRyZXNzIGFkZHIsIHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgew0KICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzDQogICAgaWYoY3VzdG9tZXJJZCA9PSAwKSB0aHJvdzsgIC8vIFVVSUR2NCBzYW5pdHkgY2hlY2sNCiAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCBjdXN0b21lcklkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4NCiAgICovDQogIGZ1bmN0aW9uIGludmVzdChhZGRyZXNzIGFkZHIpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpZihyZXF1aXJlQ3VzdG9tZXJJZCkgdGhyb3c7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aXBhbnRzIGZvciB0aGFuayB5b3UgZW1haWwNCiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cw0KICAgIGludmVzdEludGVybmFsKGFkZHIsIDApOw0KICB9DQoNCiAgLyoqDQogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIgYW5kIGNsZWFyIGhpcyBhZGRyZXNzLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gYnV5V2l0aFNpZ25lZEFkZHJlc3ModWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgew0KICAgIGludmVzdFdpdGhTaWduZWRBZGRyZXNzKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQsIHYsIHIsIHMpOw0KICB9DQoNCiAgLyoqDQogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIuDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpbnZlc3RXaXRoQ3VzdG9tZXJJZChtc2cuc2VuZGVyLCBjdXN0b21lcklkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLg0KICAgKg0KICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuDQogICAqLw0KICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaW52ZXN0KG1zZy5zZW5kZXIpOw0KICB9DQoNCiAgLyoqDQogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuDQogICAqDQogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7DQoNCiAgICAvLyBBbHJlYWR5IGZpbmFsaXplZA0KICAgIGlmKGZpbmFsaXplZCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gRmluYWxpemluZyBpcyBvcHRpb25hbC4gV2Ugb25seSBjYWxsIGl0IGlmIHdlIGFyZSBnaXZlbiBhIGZpbmFsaXppbmcgYWdlbnQuDQogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSAwKSB7DQogICAgICBmaW5hbGl6ZUFnZW50LmZpbmFsaXplQ3Jvd2RzYWxlKCk7DQogICAgfQ0KDQogICAgZmluYWxpemVkID0gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byAocmUpc2V0IGZpbmFsaXplIGFnZW50Lg0KICAgKg0KICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gc2V0dGluZyB0aGlzLCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4NCiAgICovDQogIGZ1bmN0aW9uIHNldEZpbmFsaXplQWdlbnQoRmluYWxpemVBZ2VudCBhZGRyKSBvbmx5T3duZXIgew0KICAgIGZpbmFsaXplQWdlbnQgPSBhZGRyOw0KDQogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQNCiAgICBpZighZmluYWxpemVBZ2VudC5pc0ZpbmFsaXplQWdlbnQoKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIFNldCBwb2xpY3kgZG8gd2UgbmVlZCB0byBoYXZlIHNlcnZlci1zaWRlIGN1c3RvbWVyIGlkcyBmb3IgdGhlIGludmVzdG1lbnRzLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0UmVxdWlyZUN1c3RvbWVySWQoYm9vbCB2YWx1ZSkgb25seU93bmVyIHsNCiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOw0KICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOw0KICB9DQoNCiAgLyoqDQogICAqIFNldCBwb2xpY3kgaWYgYWxsIGludmVzdG9ycyBtdXN0IGJlIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIGZpcnN0Lg0KICAgKg0KICAgKiBUaGlzIGlzIGUuZy4gZm9yIHRoZSBhY2NyZWRpdGVkIGludmVzdG9yIGNsZWFyaW5nLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0UmVxdWlyZVNpZ25lZEFkZHJlc3MoYm9vbCB2YWx1ZSwgYWRkcmVzcyBfc2lnbmVyQWRkcmVzcykgb25seU93bmVyIHsNCiAgICByZXF1aXJlZFNpZ25lZEFkZHJlc3MgPSB2YWx1ZTsNCiAgICBzaWduZXJBZGRyZXNzID0gX3NpZ25lckFkZHJlc3M7DQogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgYWRkcmVzc2VzIHRvIGRvIGVhcmx5IHBhcnRpY2lwYXRpb24uDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBzZXRFYXJseVBhcmljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cykgb25seU93bmVyIHsNCiAgICBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdID0gc3RhdHVzOw0KICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgY3Jvd2RzYWxlIG93bmVyIHRvIGNsb3NlIGVhcmx5IG9yIGV4dGVuZCB0aGUgY3Jvd2RzYWxlLg0KICAgKg0KICAgKiBUaGlzIGlzIHVzZWZ1bCBlLmcuIGZvciBhIG1hbnVhbCBzb2Z0IGNhcCBpbXBsZW1lbnRhdGlvbjoNCiAgICogLSBhZnRlciBYIGFtb3VudCBpcyByZWFjaGVkIGRldGVybWluZSBtYW51YWwgY2xvc2luZw0KICAgKg0KICAgKiBUaGlzIG1heSBwdXQgdGhlIGNyb3dkc2FsZSB0byBhbiBpbnZhbGlkIHN0YXRlLA0KICAgKiBidXQgd2UgdHJ1c3Qgb3duZXJzIGtub3cgd2hhdCB0aGV5IGFyZSBkb2luZy4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIHNldEVuZHNBdCh1aW50IHRpbWUpIG9ubHlPd25lciB7DQoNCiAgICBpZihub3cgPiB0aW1lKSB7DQogICAgICB0aHJvdzsgLy8gRG9uJ3QgY2hhbmdlIHBhc3QNCiAgICB9DQoNCiAgICBlbmRzQXQgPSB0aW1lOw0KICAgIEVuZHNBdENoYW5nZWQoZW5kc0F0KTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuDQogICAqDQogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiB0aGUgc2V0LCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4NCiAgICovDQogIGZ1bmN0aW9uIHNldFByaWNpbmdTdHJhdGVneShQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSkgb25seU93bmVyIHsNCiAgICBwcmljaW5nU3RyYXRlZ3kgPSBfcHJpY2luZ1N0cmF0ZWd5Ow0KDQogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQNCiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyBsb2FkIHJlZnVuZHMgYmFjayBvbiB0aGUgY29udHJhY3QgZm9yIHRoZSByZWZ1bmRpbmcuDQogICAqDQogICAqIFRoZSB0ZWFtIGNhbiB0cmFuc2ZlciB0aGUgZnVuZHMgYmFjayBvbiB0aGUgc21hcnQgY29udHJhY3QgaW4gdGhlIGNhc2UgdGhlIG1pbmltdW0gZ29hbCB3YXMgbm90IHJlYWNoZWQuLg0KICAgKi8NCiAgZnVuY3Rpb24gbG9hZFJlZnVuZCgpIHB1YmxpYyBwYXlhYmxlIGluU3RhdGUoU3RhdGUuRmFpbHVyZSkgew0KICAgIGlmKG1zZy52YWx1ZSA9PSAwKSB0aHJvdzsNCiAgICBsb2FkZWRSZWZ1bmQgPSBsb2FkZWRSZWZ1bmQucGx1cyhtc2cudmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIEludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kLg0KICAgKi8NCiAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIGluU3RhdGUoU3RhdGUuUmVmdW5kaW5nKSB7DQogICAgdWludDI1NiB3ZWlWYWx1ZSA9IGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl07DQogICAgaWYgKHdlaVZhbHVlID09IDApIHRocm93Ow0KICAgIGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl0gPSAwOw0KICAgIHdlaVJlZnVuZGVkID0gd2VpUmVmdW5kZWQucGx1cyh3ZWlWYWx1ZSk7DQogICAgUmVmdW5kKG1zZy5zZW5kZXIsIHdlaVZhbHVlKTsNCiAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh3ZWlWYWx1ZSkpIHRocm93Ow0KICB9DQoNCiAgLyoqDQogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY3Jvd2RzYWxlIGhhcyByYWlzZWQgZW5vdWdoIG1vbmV5IHRvIGJlIGEgc3VjY2VzDQogICAqLw0KICBmdW5jdGlvbiBpc01pbmltdW1Hb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHJlYWNoZWQpIHsNCiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbmltdW1GdW5kaW5nR29hbDsNCiAgfQ0KDQogIC8qKg0KICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50Lg0KICAgKg0KICAgKiBXZSBtYWtlIGl0IGEgZnVuY3Rpb24gYW5kIGRvIG5vdCBhc3NpZ24gdGhlIHJlc3VsdCB0byBhIHZhcmlhYmxlLCBzbyB0aGVyZSBpcyBubyBjaGFuY2Ugb2YgdGhlIHZhcmlhYmxlIGJlaW5nIHN0YWxlLg0KICAgKi8NCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoU3RhdGUpIHsNCiAgICBpZihmaW5hbGl6ZWQpIHJldHVybiBTdGF0ZS5GaW5hbGl6ZWQ7DQogICAgZWxzZSBpZiAoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSA9PSAwKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOw0KICAgIGVsc2UgaWYgKCFmaW5hbGl6ZUFnZW50LmlzU2FuZSgpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOw0KICAgIGVsc2UgaWYgKCFwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOw0KICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsNCiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPD0gZW5kc0F0ICYmICFpc0Nyb3dkc2FsZUZ1bGwoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7DQogICAgZWxzZSBpZiAoaXNNaW5pbXVtR29hbFJlYWNoZWQoKSkgcmV0dXJuIFN0YXRlLlN1Y2Nlc3M7DQogICAgZWxzZSBpZiAoIWlzTWluaW11bUdvYWxSZWFjaGVkKCkgJiYgd2VpUmFpc2VkID4gMCAmJiBsb2FkZWRSZWZ1bmQgPj0gd2VpUmFpc2VkKSByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOw0KICAgIGVsc2UgcmV0dXJuIFN0YXRlLkZhaWx1cmU7DQogIH0NCg0KICAvKiogVGhpcyBpcyBmb3IgbWFudWFsIHRlc3Rpbmcgb2YgbXVsdGlzaWcgd2FsbGV0IGludGVyYWN0aW9uICovDQogIGZ1bmN0aW9uIHNldE93bmVyVGVzdFZhbHVlKHVpbnQgdmFsKSBvbmx5T3duZXIgew0KICAgIG93bmVyVGVzdFZhbHVlID0gdmFsOw0KICB9DQoNCiAgLy8NCiAgLy8gTW9kaWZpZXJzDQogIC8vDQoNCiAgLyoqIE1vZGlmaWVkIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcuICAqLw0KICBtb2RpZmllciBpblN0YXRlKFN0YXRlIHN0YXRlKSB7DQogICAgaWYoZ2V0U3RhdGUoKSAhPSBzdGF0ZSkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQoNCiAgLy8NCiAgLy8gQWJzdHJhY3QgZnVuY3Rpb25zDQogIC8vDQoNCiAgLyoqDQogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGludmVzdGVkIGJyZWFrcyBvdXIgY2FwIHJ1bGVzLg0KICAgKg0KICAgKg0KICAgKiBUaGUgY2hpbGQgY29udHJhY3QgbXVzdCBkZWZpbmUgdGhlaXIgb3duIGNhcCBzZXR0aW5nIHJ1bGVzLg0KICAgKiBXZSBhbGxvdyBhIGxvdCBvZiBmbGV4aWJpbGl0eSB0aHJvdWdoIGRpZmZlcmVudCBjYXBwaW5nIHN0cmF0ZWdpZXMgKEVUSCwgdG9rZW4gY291bnQpDQogICAqIENhbGxlZCBmcm9tIGludmVzdCgpLg0KICAgKg0KICAgKiBAcGFyYW0gd2VpQW1vdW50IFRoZSBhbW91bnQgb2Ygd2VpIHRoZSBpbnZlc3RvciB0cmllcyB0byBpbnZlc3QgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHRva2VuQW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHdlIHRyeSB0byBnaXZlIHRvIHRoZSBpbnZlc3RvciBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gd2VpUmFpc2VkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgcmFpc2VkIGJhbGFuY2UgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gdG9rZW5zU29sZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHNvbGQgdG9rZW5zIGNvdW50IGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24NCiAgICoNCiAgICogQHJldHVybiB0cnVlIGlmIHRha2luZyB0aGlzIGludmVzdG1lbnQgd291bGQgYnJlYWsgb3VyIGNhcCBydWxlcw0KICAgKi8NCiAgZnVuY3Rpb24gaXNCcmVha2luZ0NhcCh1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludCB3ZWlSYWlzZWRUb3RhbCwgdWludCB0b2tlbnNTb2xkVG90YWwpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgbGltaXRCcm9rZW4pOw0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBjcm93ZHNhbGUgaXMgZnVsbCBhbmQgd2UgY2FuIG5vIGxvbmdlciBzZWxsIGFueSB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7DQoNCiAgLyoqDQogICAqIENyZWF0ZSBuZXcgdG9rZW5zIG9yIHRyYW5zZmVyIGlzc3VlZCB0b2tlbnMgdG8gdGhlIGludmVzdG9yIGRlcGVuZGluZyBvbiB0aGUgY2FwIG1vZGVsLg0KICAgKi8NCiAgZnVuY3Rpb24gYXNzaWduVG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIHByaXZhdGU7DQp9DQoNCg0KDQoNCg0KDQoNCi8qKg0KICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcw0KICovDQpjb250cmFjdCBTYWZlTWF0aCB7DQogIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICogYjsNCiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gc2FmZURpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiID4gMCk7DQogICAgdWludCBjID0gYSAvIGI7DQogICAgYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjPj1hICYmIGM+PWIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsNCiAgICBpZiAoIWFzc2VydGlvbikgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQp9DQoNCg0KDQovKioNCiAqIFN0YW5kYXJkIEVSQzIwIHRva2VuDQogKg0KICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6DQogKiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wNCiAqLw0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgU2FmZU1hdGggew0KDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsNCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOw0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOw0KICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7DQogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsNCg0KICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzYWZlU3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQNCiAgICAvLyBpZiAoX3ZhbHVlID4gX2FsbG93YW5jZSkgdGhyb3c7DQoNCiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOw0KICAgIGJhbGFuY2VzW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZXNbX2Zyb21dLCBfdmFsdWUpOw0KICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihfYWxsb3dhbmNlLCBfdmFsdWUpOw0KICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgew0KICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOw0KICB9DQoNCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7DQogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogIH0NCg0KfQ0KDQoNCg0KDQoNCi8qKg0KICogVXBncmFkZSBhZ2VudCBpbnRlcmZhY2UgaW5zcGlyZWQgYnkgTHVueXIuDQogKg0KICogVXBncmFkZSBhZ2VudCB0cmFuc2ZlcnMgdG9rZW5zIHRvIGEgbmV3IGNvbnRyYWN0Lg0KICogVXBncmFkZSBhZ2VudCBpdHNlbGYgY2FuIGJlIHRoZSB0b2tlbiBjb250cmFjdCwgb3IganVzdCBhIG1pZGRsZSBtYW4gY29udHJhY3QgZG9pbmcgdGhlIGhlYXZ5IGxpZnRpbmcuDQogKi8NCmNvbnRyYWN0IFVwZ3JhZGVBZ2VudCB7DQoNCiAgdWludCBwdWJsaWMgb3JpZ2luYWxTdXBwbHk7DQoNCiAgLyoqIEludGVyZmFjZSBtYXJrZXIgKi8NCiAgZnVuY3Rpb24gaXNVcGdyYWRlQWdlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gdXBncmFkZUZyb20oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUpIHB1YmxpYzsNCg0KfQ0KDQoNCi8qKg0KICogQSB0b2tlbiB1cGdyYWRlIG1lY2hhbmlzbSB3aGVyZSB1c2VycyBjYW4gb3B0LWluIGFtb3VudCBvZiB0b2tlbnMgdG8gdGhlIG5leHQgc21hcnQgY29udHJhY3QgcmV2aXNpb24uDQogKg0KICogRmlyc3QgZW52aXNpb25lZCBieSBHb2xlbSBhbmQgTHVueXIgcHJvamVjdHMuDQogKi8NCmNvbnRyYWN0IFVwZ3JhZGVhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7DQoNCiAgLyoqIENvbnRyYWN0IC8gcGVyc29uIHdobyBjYW4gc2V0IHRoZSB1cGdyYWRlIHBhdGguIFRoaXMgY2FuIGJlIHRoZSBzYW1lIGFzIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBhcyB3aGF0IGl0IGlzIHdpdGggaXRzIGRlZmF1bHQgdmFsdWUuICovDQogIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVNYXN0ZXI7DQoNCiAgLyoqIFRoZSBuZXh0IGNvbnRyYWN0IHdoZXJlIHRoZSB0b2tlbnMgd2lsbCBiZSBtaWdyYXRlZC4gKi8NCiAgVXBncmFkZUFnZW50IHB1YmxpYyB1cGdyYWRlQWdlbnQ7DQoNCiAgLyoqIEhvdyBtYW55IHRva2VucyB3ZSBoYXZlIHVwZ3JhZGVkIGJ5IG5vdy4gKi8NCiAgdWludDI1NiBwdWJsaWMgdG90YWxVcGdyYWRlZDsNCg0KICAvKioNCiAgICogVXBncmFkZSBzdGF0ZXMuDQogICAqDQogICAqIC0gTm90QWxsb3dlZDogVGhlIGNoaWxkIGNvbnRyYWN0IGhhcyBub3QgcmVhY2hlZCBhIGNvbmRpdGlvbiB3aGVyZSB0aGUgdXBncmFkZSBjYW4gYmd1bg0KICAgKiAtIFdhaXRpbmdGb3JBZ2VudDogVG9rZW4gYWxsb3dzIHVwZ3JhZGUsIGJ1dCB3ZSBkb24ndCBoYXZlIGEgbmV3IGFnZW50IHlldA0KICAgKiAtIFJlYWR5VG9VcGdyYWRlOiBUaGUgYWdlbnQgaXMgc2V0LCBidXQgbm90IGEgc2luZ2xlIHRva2VuIGhhcyBiZWVuIHVwZ3JhZGVkIHlldA0KICAgKiAtIFVwZ3JhZGluZzogVXBncmFkZSBhZ2VudCBpcyBzZXQgYW5kIHRoZSBiYWxhbmNlIGhvbGRlcnMgY2FuIHVwZ3JhZGUgdGhlaXIgdG9rZW5zDQogICAqDQogICAqLw0KICBlbnVtIFVwZ3JhZGVTdGF0ZSB7VW5rbm93biwgTm90QWxsb3dlZCwgV2FpdGluZ0ZvckFnZW50LCBSZWFkeVRvVXBncmFkZSwgVXBncmFkaW5nfQ0KDQogIC8qKg0KICAgKiBTb21lYm9keSBoYXMgdXBncmFkZWQgc29tZSBvZiBoaXMgdG9rZW5zLg0KICAgKi8NCiAgZXZlbnQgVXBncmFkZShhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsNCg0KICAvKioNCiAgICogTmV3IHVwZ3JhZGUgYWdlbnQgYXZhaWxhYmxlLg0KICAgKi8NCiAgZXZlbnQgVXBncmFkZUFnZW50U2V0KGFkZHJlc3MgYWdlbnQpOw0KDQogIC8qKg0KICAgKiBEbyBub3QgYWxsb3cgY29uc3RydWN0aW9uIHdpdGhvdXQgdXBncmFkZSBtYXN0ZXIgc2V0Lg0KICAgKi8NCiAgZnVuY3Rpb24gVXBncmFkZWFibGVUb2tlbihhZGRyZXNzIF91cGdyYWRlTWFzdGVyKSB7DQogICAgdXBncmFkZU1hc3RlciA9IF91cGdyYWRlTWFzdGVyOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4NCiAgICovDQogIGZ1bmN0aW9uIHVwZ3JhZGUodWludDI1NiB2YWx1ZSkgcHVibGljIHsNCg0KICAgICAgVXBncmFkZVN0YXRlIHN0YXRlID0gZ2V0VXBncmFkZVN0YXRlKCk7DQogICAgICBpZighKHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5SZWFkeVRvVXBncmFkZSB8fCBzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuVXBncmFkaW5nKSkgew0KICAgICAgICAvLyBDYWxsZWQgaW4gYSBiYWQgc3RhdGUNCiAgICAgICAgdGhyb3c7DQogICAgICB9DQoNCiAgICAgIC8vIFZhbGlkYXRlIGlucHV0IHZhbHVlLg0KICAgICAgaWYgKHZhbHVlID09IDApIHRocm93Ow0KDQogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIHZhbHVlKTsNCg0KICAgICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24NCiAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSwgdmFsdWUpOw0KICAgICAgdG90YWxVcGdyYWRlZCA9IHNhZmVBZGQodG90YWxVcGdyYWRlZCwgdmFsdWUpOw0KDQogICAgICAvLyBVcGdyYWRlIGFnZW50IHJlaXNzdWVzIHRoZSB0b2tlbnMNCiAgICAgIHVwZ3JhZGVBZ2VudC51cGdyYWRlRnJvbShtc2cuc2VuZGVyLCB2YWx1ZSk7DQogICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIFNldCBhbiB1cGdyYWRlIGFnZW50IHRoYXQgaGFuZGxlcw0KICAgKi8NCiAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgYWdlbnQpIGV4dGVybmFsIHsNCg0KICAgICAgaWYoIWNhblVwZ3JhZGUoKSkgew0KICAgICAgICAvLyBUaGUgdG9rZW4gaXMgbm90IHlldCBpbiBhIHN0YXRlIHRoYXQgd2UgY291bGQgdGhpbmsgdXBncmFkaW5nDQogICAgICAgIHRocm93Ow0KICAgICAgfQ0KDQogICAgICBpZiAoYWdlbnQgPT0gMHgwKSB0aHJvdzsNCiAgICAgIC8vIE9ubHkgYSBtYXN0ZXIgY2FuIGRlc2lnbmF0ZSB0aGUgbmV4dCBhZ2VudA0KICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdXBncmFkZU1hc3RlcikgdGhyb3c7DQogICAgICAvLyBVcGdyYWRlIGhhcyBhbHJlYWR5IGJlZ3VuIGZvciBhbiBhZ2VudA0KICAgICAgaWYgKGdldFVwZ3JhZGVTdGF0ZSgpID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpIHRocm93Ow0KDQogICAgICB1cGdyYWRlQWdlbnQgPSBVcGdyYWRlQWdlbnQoYWdlbnQpOw0KDQogICAgICAvLyBCYWQgaW50ZXJmYWNlDQogICAgICBpZighdXBncmFkZUFnZW50LmlzVXBncmFkZUFnZW50KCkpIHRocm93Ow0KICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdG9rZW4gc3VwcGxpZXMgbWF0Y2ggaW4gc291cmNlIGFuZCB0YXJnZXQNCiAgICAgIGlmICh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSAhPSB0b3RhbFN1cHBseSkgdGhyb3c7DQoNCiAgICAgIFVwZ3JhZGVBZ2VudFNldCh1cGdyYWRlQWdlbnQpOw0KICB9DQoNCiAgLyoqDQogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuDQogICAqLw0KICBmdW5jdGlvbiBnZXRVcGdyYWRlU3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhVcGdyYWRlU3RhdGUpIHsNCiAgICBpZighY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7DQogICAgZWxzZSBpZihhZGRyZXNzKHVwZ3JhZGVBZ2VudCkgPT0gMHgwMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5XYWl0aW5nRm9yQWdlbnQ7DQogICAgZWxzZSBpZih0b3RhbFVwZ3JhZGVkID09IDApIHJldHVybiBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGU7DQogICAgZWxzZSByZXR1cm4gVXBncmFkZVN0YXRlLlVwZ3JhZGluZzsNCiAgfQ0KDQogIC8qKg0KICAgKiBDaGFuZ2UgdGhlIHVwZ3JhZGUgbWFzdGVyLg0KICAgKg0KICAgKiBUaGlzIGFsbG93cyB1cyB0byBzZXQgYSBuZXcgb3duZXIgZm9yIHRoZSB1cGdyYWRlIG1lY2hhbmlzbS4NCiAgICovDQogIGZ1bmN0aW9uIHNldFVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBtYXN0ZXIpIHB1YmxpYyB7DQogICAgICBpZiAobWFzdGVyID09IDB4MCkgdGhyb3c7DQogICAgICBpZiAobXNnLnNlbmRlciAhPSB1cGdyYWRlTWFzdGVyKSB0aHJvdzsNCiAgICAgIHVwZ3JhZGVNYXN0ZXIgPSBtYXN0ZXI7DQogIH0NCg0KICAvKioNCiAgICogQ2hpbGQgY29udHJhY3QgY2FuIGVuYWJsZSB0byBwcm92aWRlIHRoZSBjb25kaXRpb24gd2hlbiB0aGUgdXBncmFkZSBjYW4gYmVndW4uDQogICAqLw0KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQp9DQoNCg0KDQoNCg0KDQovKioNCiAqIERlZmluZSBpbnRlcmZhY2UgZm9yIHJlbGVhc2luZyB0aGUgdG9rZW4gdHJhbnNmZXIgYWZ0ZXIgYSBzdWNjZXNzZnVsIGNyb3dkc2FsZS4NCiAqLw0KY29udHJhY3QgUmVsZWFzYWJsZVRva2VuIGlzIEVSQzIwLCBPd25hYmxlIHsNCg0KICAvKiBUaGUgZmluYWxpemVyIGNvbnRyYWN0IHRoYXQgYWxsb3dzIHVubGlmdCB0aGUgdHJhbnNmZXIgbGltaXRzIG9uIHRoaXMgdG9rZW4gKi8NCiAgYWRkcmVzcyBwdWJsaWMgcmVsZWFzZUFnZW50Ow0KDQogIC8qKiBBIGNyb3dkc2FsZSBjb250cmFjdCBjYW4gcmVsZWFzZSB1cyB0byB0aGUgd2lsZCBpZiBJQ08gc3VjY2Vzcy4gSWYgZmFsc2Ugd2UgYXJlIGFyZSBpbiB0cmFuc2ZlciBsb2NrIHVwIHBlcmlvZC4qLw0KICBib29sIHB1YmxpYyByZWxlYXNlZCA9IGZhbHNlOw0KDQogIC8qKiBNYXAgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gdHJhbnNmZXIgdG9rZW5zIHJlZ2FyZGxlc3Mgb2YgdGhlIGxvY2sgZG93biBwZXJpb2QuIFRoZXNlIGFyZSBjcm93ZHNhbGUgY29udHJhY3RzIGFuZCBwb3NzaWJsZSB0aGUgdGVhbSBtdWx0aXNpZyBpdHNlbGYuICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRyYW5zZmVyQWdlbnRzOw0KDQogIC8qKg0KICAgKiBMaW1pdCB0b2tlbiB0cmFuc2ZlciB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXIuDQogICAqDQogICAqLw0KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIpIHsNCg0KICAgIGlmKCFyZWxlYXNlZCkgew0KICAgICAgICBpZighdHJhbnNmZXJBZ2VudHNbX3NlbmRlcl0pIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgfQ0KDQogICAgXzsNCiAgfQ0KDQogIC8qKg0KICAgKiBTZXQgdGhlIGNvbnRyYWN0IHRoYXQgY2FuIGNhbGwgcmVsZWFzZSBhbmQgbWFrZSB0aGUgdG9rZW4gdHJhbnNmZXJhYmxlLg0KICAgKg0KICAgKiBEZXNpZ24gY2hvaWNlLiBBbGxvdyByZXNldCB0aGUgcmVsZWFzZSBhZ2VudCB0byBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4NCiAgICovDQogIGZ1bmN0aW9uIHNldFJlbGVhc2VBZ2VudChhZGRyZXNzIGFkZHIpIG9ubHlPd25lciBpblJlbGVhc2VTdGF0ZShmYWxzZSkgcHVibGljIHsNCg0KICAgIC8vIFdlIGRvbid0IGRvIGludGVyZmFjZSBjaGVjayBoZXJlIGFzIHdlIG1pZ2h0IHdhbnQgdG8gYSBub3JtYWwgd2FsbGV0IGFkZHJlc3MgdG8gYWN0IGFzIGEgcmVsZWFzZSBhZ2VudA0KICAgIHJlbGVhc2VBZ2VudCA9IGFkZHI7DQogIH0NCg0KICAvKioNCiAgICogT3duZXIgY2FuIGFsbG93IGEgcGFydGljdWxhciBhZGRyZXNzIChhIGNyb3dkc2FsZSBjb250cmFjdCkgdG8gdHJhbnNmZXIgdG9rZW5zIGRlc3BpdGUgdGhlIGxvY2sgdXAgcGVyaW9kLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0VHJhbnNmZXJBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBpblJlbGVhc2VTdGF0ZShmYWxzZSkgcHVibGljIHsNCiAgICB0cmFuc2ZlckFnZW50c1thZGRyXSA9IHN0YXRlOw0KICB9DQoNCiAgLyoqDQogICAqIE9uZSB3YXkgZnVuY3Rpb24gdG8gcmVsZWFzZSB0aGUgdG9rZW5zIHRvIHRoZSB3aWxkLg0KICAgKg0KICAgKiBDYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgcmVsZWFzZSBhZ2VudCB0aGF0IGlzIHRoZSBmaW5hbCBJQ08gY29udHJhY3QuIEl0IGlzIG9ubHkgY2FsbGVkIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGJlZW4gc3VjY2VzcyAoZmlyc3QgbWlsZXN0b25lIHJlYWNoZWQpLg0KICAgKi8NCiAgZnVuY3Rpb24gcmVsZWFzZVRva2VuVHJhbnNmZXIoKSBwdWJsaWMgb25seVJlbGVhc2VBZ2VudCB7DQogICAgcmVsZWFzZWQgPSB0cnVlOw0KICB9DQoNCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYmVmb3JlIG9yIGFmdGVyIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIHJlbGVhc2VzZCAqLw0KICBtb2RpZmllciBpblJlbGVhc2VTdGF0ZShib29sIHJlbGVhc2VTdGF0ZSkgew0KICAgIGlmKHJlbGVhc2VTdGF0ZSAhPSByZWxlYXNlZCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQogICAgXzsNCiAgfQ0KDQogIC8qKiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IGEgd2hpdGVsaXN0ZWQgcmVsZWFzZSBhZ2VudC4gKi8NCiAgbW9kaWZpZXIgb25seVJlbGVhc2VBZ2VudCgpIHsNCiAgICBpZihtc2cuc2VuZGVyICE9IHJlbGVhc2VBZ2VudCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQogICAgXzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyKCkNCiAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyRm9ybSgpDQogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICB9DQoNCn0NCg0KDQoNCg0KDQoNCg0KLyoqDQogKiBBIHRva2VuIHRoYXQgY2FuIGluY3JlYXNlIGl0cyBzdXBwbHkgYnkgYW5vdGhlciBjb250cmFjdC4NCiAqDQogKiBUaGlzIGFsbG93cyB1bmNhcHBlZCBjcm93ZHNhbGUgYnkgZHluYW1pY2FsbHkgaW5jcmVhc2luZyB0aGUgc3VwcGx5IHdoZW4gbW9uZXkgcG91cnMgaW4uDQogKiBPbmx5IG1pbnQgYWdlbnRzLCBjb250cmFjdHMgd2hpdGVsaXN0ZWQgYnkgb3duZXIsIGNhbiBtaW50IG5ldyB0b2tlbnMuDQogKg0KICovDQpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgew0KDQogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50Ow0KDQogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOw0KDQogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIG1pbnRBZ2VudHM7DQoNCiAgLyoqDQogICAqIENyZWF0ZSBuZXcgdG9rZW5zIGFuZCBhbGxvY2F0ZSB0aGVtIHRvIGFuIGFkZHJlc3MuLg0KICAgKg0KICAgKiBPbmx5IGNhbGxhYmx5IGJ5IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IChtaW50IGFnZW50KS4NCiAgICovDQogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpIG9ubHlNaW50QWdlbnQgY2FuTWludCBwdWJsaWMgew0KICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkucGx1cyhhbW91bnQpOw0KICAgIGJhbGFuY2VzW3JlY2VpdmVyXSA9IGJhbGFuY2VzW3JlY2VpdmVyXS5wbHVzKGFtb3VudCk7DQogICAgVHJhbnNmZXIoMCwgcmVjZWl2ZXIsIGFtb3VudCk7DQogIH0NCg0KICAvKioNCiAgICogT3duZXIgY2FuIGFsbG93IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHRvIG1pbnQgbmV3IHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7DQogICAgbWludEFnZW50c1thZGRyXSA9IHN0YXRlOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seU1pbnRBZ2VudCgpIHsNCiAgICAvLyBPbmx5IGNyb3dkc2FsZSBjb250cmFjdHMgYXJlIGFsbG93ZWQgdG8gbWludCBuZXcgdG9rZW5zDQogICAgaWYoIW1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KICAgIF87DQogIH0NCg0KICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovDQogIG1vZGlmaWVyIGNhbk1pbnQoKSB7DQogICAgaWYobWludGluZ0ZpbmlzaGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQp9DQoNCg0KDQoNCi8qKg0KICogQSBjcm93ZHNhbGVkIHRva2VuLg0KICoNCiAqIEFuIEVSQy0yMCB0b2tlbiBkZXNpZ25lZCBzcGVjaWZpY2FsbHkgZm9yIGNyb3dkc2FsZXMgd2l0aCBpbnZlc3RvciBwcm90ZWN0aW9uIGFuZCBmdXJ0aGVyIGRldmVsb3BtZW50IHBhdGguDQogKg0KICogLSBUaGUgdG9rZW4gdHJhbnNmZXIoKSBpcyBkaXNhYmxlZCB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXINCiAqIC0gVGhlIHRva2VuIGNvbnRyYWN0IGdpdmVzIGFuIG9wdC1pbiB1cGdyYWRlIHBhdGggdG8gYSBuZXcgY29udHJhY3QNCiAqIC0gVGhlIHNhbWUgdG9rZW4gY2FuIGJlIHBhcnQgb2Ygc2V2ZXJhbCBjcm93ZHNhbGVzIHRocm91Z2ggYXBwcm92ZSgpIG1lY2hhbmlzbQ0KICogLSBUaGUgdG9rZW4gY2FuIGJlIGNhcHBlZCAoc3VwcGx5IHNldCBpbiB0aGUgY29uc3RydWN0b3IpIG9yIHVuY2FwcGVkIChjcm93ZHNhbGUgY29udHJhY3QgY2FuIG1pbnQgbmV3IHRva2VucykNCiAqDQogKi8NCmNvbnRyYWN0IENyb3dkc2FsZVRva2VuIGlzIFJlbGVhc2FibGVUb2tlbiwgTWludGFibGVUb2tlbiwgVXBncmFkZWFibGVUb2tlbiB7DQoNCiAgc3RyaW5nIHB1YmxpYyBuYW1lOw0KDQogIHN0cmluZyBwdWJsaWMgc3ltYm9sOw0KDQogIHVpbnQgcHVibGljIGRlY2ltYWxzOw0KDQogIC8qKg0KICAgKiBDb25zdHJ1Y3QgdGhlIHRva2VuLg0KICAgKg0KICAgKiBUaGlzIHRva2VuIG11c3QgYmUgY3JlYXRlZCB0aHJvdWdoIGEgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIHNvIHRoYXQgaXQgaXMgb3duZWQgYnkgdGhhdCB3YWxsZXQuDQogICAqLw0KICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50IF9pbml0aWFsU3VwcGx5LCB1aW50IF9kZWNpbWFscykNCiAgICBVcGdyYWRlYWJsZVRva2VuKG1zZy5zZW5kZXIpIHsNCg0KICAgIC8vIENyZWF0ZSBhbnkgYWRkcmVzcywgY2FuIGJlIHRyYW5zZmVycmVkDQogICAgLy8gdG8gdGVhbSBtdWx0aXNpZyB2aWEgY2hhbmdlT3duZXIoKSwNCiAgICAvLyBhbHNvIHJlbWVtYmVyIHRvIGNhbGwgc2V0VXBncmFkZU1hc3RlcigpDQogICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KDQogICAgbmFtZSA9IF9uYW1lOw0KICAgIHN5bWJvbCA9IF9zeW1ib2w7DQoNCiAgICB0b3RhbFN1cHBseSA9IF9pbml0aWFsU3VwcGx5Ow0KDQogICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7DQoNCiAgICAvLyBDcmVhdGUgaW5pdGlhbGx5IGFsbCBiYWxhbmNlIG9uIHRoZSB0ZWFtIG11bHRpc2lnDQogICAgYmFsYW5jZXNbb3duZXJdID0gdG90YWxTdXBwbHk7DQogIH0NCg0KICAvKioNCiAgICogV2hlbiB0b2tlbiBpcyByZWxlYXNlZCB0byBiZSB0cmFuc2ZlcmFibGUsIGVuZm9yY2Ugbm8gbmV3IHRva2VucyBjYW4gYmUgY3JlYXRlZC4NCiAgICovDQogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgew0KICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7DQogICAgc3VwZXIucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB1cGdyYWRlIGFnZW50IGZ1bmN0aW9uYWxpdHkga2ljayBpbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgd2FzIHN1Y2Nlc3MuDQogICAqLw0KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgIHJldHVybiByZWxlYXNlZDsNCiAgfQ0KDQp9DQoNCg0KDQovKioNCiAqIEF0IHRoZSBlbmQgb2YgdGhlIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlIGFsbG9jYXRlICUgYm9udXMgb2YgdG9rZW5zIHRvIHRoZSB0ZWFtLg0KICoNCiAqIFVubG9jayB0b2tlbnMuDQogKg0KICogQm9udXNBbGxvY2F0aW9uRmluYWwgbXVzdCBiZSBzZXQgYXMgdGhlIG1pbnRpbmcgYWdlbnQgZm9yIHRoZSBNaW50YWJsZVRva2VuLg0KICoNCiAqLw0KY29udHJhY3QgQm9udXNGaW5hbGl6ZUFnZW50IGlzIEZpbmFsaXplQWdlbnQgew0KDQogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50Ow0KDQogIENyb3dkc2FsZVRva2VuIHB1YmxpYyB0b2tlbjsNCiAgQ3Jvd2RzYWxlIHB1YmxpYyBjcm93ZHNhbGU7DQoNCiAgLyoqIFRvdGFsIHBlcmNlbnQgb2YgdG9rZW5zIG1pbnRlZCB0byB0aGUgdGVhbSBhdCB0aGUgZW5kIG9mIHRoZSBzYWxlIGFzIGJhc2UgcG9pbnRzICgwLjAwMDEpICovDQogIHVpbnQgcHVibGljIGJvbnVzQmFzZVBvaW50czsNCg0KICAvKiogV2hlcmUgd2UgbW92ZSB0aGUgdG9rZW5zIGF0IHRoZSBlbmQgb2YgdGhlIHNhbGUuICovDQogIGFkZHJlc3MgcHVibGljIHRlYW1NdWx0aXNpZzsNCg0KICAvKiBIb3cgbXVjaCBib251cyB0b2tlbnMgd2UgYWxsb2NhdGVkICovDQogIHVpbnQgcHVibGljIGFsbG9jYXRlZEJvbnVzOw0KDQogIGZ1bmN0aW9uIEJvbnVzRmluYWxpemVBZ2VudChDcm93ZHNhbGVUb2tlbiBfdG9rZW4sIENyb3dkc2FsZSBfY3Jvd2RzYWxlLCB1aW50IF9ib251c0Jhc2VQb2ludHMsIGFkZHJlc3MgX3RlYW1NdWx0aXNpZykgew0KICAgIHRva2VuID0gX3Rva2VuOw0KICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7DQogICAgaWYoYWRkcmVzcyhjcm93ZHNhbGUpID09IDApIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIHRlYW1NdWx0aXNpZyA9IF90ZWFtTXVsdGlzaWc7DQogICAgaWYoYWRkcmVzcyh0ZWFtTXVsdGlzaWcpID09IDApIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGJvbnVzQmFzZVBvaW50cyA9IF9ib251c0Jhc2VQb2ludHM7DQogIH0NCg0KICAvKiBDYW4gd2UgcnVuIGZpbmFsaXplIHByb3Blcmx5ICovDQogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgcmV0dXJuICh0b2tlbi5taW50QWdlbnRzKGFkZHJlc3ModGhpcykpID09IHRydWUpICYmICh0b2tlbi5yZWxlYXNlQWdlbnQoKSA9PSBhZGRyZXNzKHRoaXMpKTsNCiAgfQ0KDQogIC8qKiBDYWxsZWQgb25jZSBieSBjcm93ZHNhbGUgZmluYWxpemUoKSBpZiB0aGUgc2FsZSB3YXMgc3VjY2Vzcy4gKi8NCiAgZnVuY3Rpb24gZmluYWxpemVDcm93ZHNhbGUoKSB7DQogICAgaWYobXNnLnNlbmRlciAhPSBhZGRyZXNzKGNyb3dkc2FsZSkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8vIEhvdyBtYW55ICUgb2YgdG9rZW5zIHRoZSBmb3VuZGVycyBhbmQgb3RoZXJzIGdldA0KICAgIHVpbnQgdG9rZW5zU29sZCA9IGNyb3dkc2FsZS50b2tlbnNTb2xkKCk7DQogICAgYWxsb2NhdGVkQm9udXMgPSB0b2tlbnNTb2xkLnRpbWVzKGJvbnVzQmFzZVBvaW50cykgLyAxMDAwMDsNCg0KICAgIC8vIG1vdmUgdG9rZW5zIHRvIHRoZSB0ZWFtIG11bHRpc2lnIHdhbGxldA0KICAgIHRva2VuLm1pbnQodGVhbU11bHRpc2lnLCBhbGxvY2F0ZWRCb251cyk7DQoNCiAgICAvLyBNYWtlIHRva2VuIHRyYW5zZmVyYWJsZQ0KICAgIHRva2VuLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7DQogIH0NCg0KfQ=='