base 64 content
base64bonusFinalizeAgent6
	^'LyoqDQogKiBTYWZlIHVuc2lnbmVkIHNhZmUgbWF0aC4NCiAqDQogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQ0KICoNCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQXJhZ29uT25lL3plcHBlbGluLXNvbGlkaXR5L21hc3Rlci9jb250cmFjdHMvU2FmZU1hdGhMaWIuc29sDQogKg0KICogTWFpbnRhaW5lZCBoZXJlIHVudGlsIG1lcmdlZCB0byBtYWlubGluZSB6ZXBwZWxpbi1zb2xpZGl0eS4NCiAqDQogKi8NCmxpYnJhcnkgU2FmZU1hdGhMaWIgew0KDQogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gcGx1cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjPj1hKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgcHJpdmF0ZSB7DQogICAgaWYgKCFhc3NlcnRpb24pIHRocm93Ow0KICB9DQp9DQoNCg0KDQoNCi8qDQogKiBPd25hYmxlDQogKg0KICogQmFzZSBjb250cmFjdCB3aXRoIGFuIG93bmVyLg0KICogUHJvdmlkZXMgb25seU93bmVyIG1vZGlmaWVyLCB3aGljaCBwcmV2ZW50cyBmdW5jdGlvbiBmcm9tIHJ1bm5pbmcgaWYgaXQgaXMgY2FsbGVkIGJ5IGFueW9uZSBvdGhlciB0aGFuIHRoZSBvd25lci4NCiAqLw0KY29udHJhY3QgT3duYWJsZSB7DQogIGFkZHJlc3MgcHVibGljIG93bmVyOw0KDQogIGZ1bmN0aW9uIE93bmFibGUoKSB7DQogICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seU93bmVyKCkgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogICAgXzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7DQogICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsNCiAgICAgIG93bmVyID0gbmV3T3duZXI7DQogICAgfQ0KICB9DQoNCn0NCg0KDQovKg0KICogSGFsdGFibGUNCiAqDQogKiBBYnN0cmFjdCBjb250cmFjdCB0aGF0IGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4NCiAqIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4gRGlmZmVycyBmcm9tIFBhdXNhYmxlIGJ5IGNhdXNpbmcgYSB0aHJvdyB3aGVuIGluIGhhbHQgbW9kZS4NCiAqDQogKg0KICogT3JpZ2luYWxseSBlbnZpc2lvbmVkIGluIEZpcnN0Qmxvb2QgSUNPIGNvbnRyYWN0Lg0KICovDQpjb250cmFjdCBIYWx0YWJsZSBpcyBPd25hYmxlIHsNCiAgYm9vbCBwdWJsaWMgaGFsdGVkOw0KDQogIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7DQogICAgaWYgKGhhbHRlZCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7DQogICAgaWYgKCFoYWx0ZWQpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQ0KICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsNCiAgICBoYWx0ZWQgPSB0cnVlOw0KICB9DQoNCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQ0KICBmdW5jdGlvbiB1bmhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsNCiAgICBoYWx0ZWQgPSBmYWxzZTsNCiAgfQ0KDQp9DQoNCg0KLyoqDQogKiBJbnRlcmZhY2UgZm9yIGRlZmluaW5nIGNyb3dkc2FsZSBwcmljaW5nLg0KICovDQpjb250cmFjdCBQcmljaW5nU3RyYXRlZ3kgew0KDQogIC8qKiBJbnRlcmZhY2UgZGVjbGFyYXRpb24uICovDQogIGZ1bmN0aW9uIGlzUHJpY2luZ1N0cmF0ZWd5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKiBTZWxmIGNoZWNrIGlmIGFsbCByZWZlcmVuY2VzIGFyZSBjb3JyZWN0bHkgc2V0Lg0KICAgKg0KICAgKiBDaGVja3MgdGhhdCBwcmljaW5nIHN0cmF0ZWd5IG1hdGNoZXMgY3Jvd2RzYWxlIHBhcmFtZXRlcnMuDQogICAqLw0KICBmdW5jdGlvbiBpc1NhbmUoYWRkcmVzcyBjcm93ZHNhbGUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICAvKioNCiAgICogV2hlbiBzb21lYm9keSB0cmllcyB0byBidXkgdG9rZW5zIGZvciBYIGV0aCwgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGV5IGdldC4NCiAgICoNCiAgICoNCiAgICogQHBhcmFtIHZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbmQgaW4gYXMgd2VpDQogICAqIEBwYXJhbSB0b2tlbnNTb2xkIC0gaG93IG11Y2ggdG9rZW5zIGhhdmUgYmVlbiBzb2xkIHRoaXMgZmFyDQogICAqIEBwYXJhbSB3ZWlSYWlzZWQgLSBob3cgbXVjaCBtb25leSBoYXMgYmVlbiByYWlzZWQgdGhpcyBmYXINCiAgICogQHBhcmFtIG1zZ1NlbmRlciAtIHdobyBpcyB0aGUgaW52ZXN0b3Igb2YgdGhpcyB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gZGVjaW1hbHMgLSBob3cgbWFueSBkZWNpbWFsIHVuaXRzIHRoZSB0b2tlbiBoYXMNCiAgICogQHJldHVybiBBbW91bnQgb2YgdG9rZW5zIHRoZSBpbnZlc3RvciByZWNlaXZlcw0KICAgKi8NCiAgZnVuY3Rpb24gY2FsY3VsYXRlUHJpY2UodWludCB2YWx1ZSwgdWludCB3ZWlSYWlzZWQsIHVpbnQgdG9rZW5zU29sZCwgYWRkcmVzcyBtc2dTZW5kZXIsIHVpbnQgZGVjaW1hbHMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IHRva2VuQW1vdW50KTsNCn0NCg0KDQovKioNCiAqIEZpbmFsaXplIGFnZW50IGRlZmluZXMgd2hhdCBoYXBwZW5zIGF0IHRoZSBlbmQgb2Ygc3VjY2VzZWZ1bCBjcm93ZHNhbGUuDQogKg0KICogLSBBbGxvY2F0ZSB0b2tlbnMgZm9yIGZvdW5kZXJzLCBib3VudGllcyBhbmQgY29tbXVuaXR5DQogKiAtIE1ha2UgdG9rZW5zIHRyYW5zZmVyYWJsZQ0KICogLSBldGMuDQogKi8NCmNvbnRyYWN0IEZpbmFsaXplQWdlbnQgew0KDQogIGZ1bmN0aW9uIGlzRmluYWxpemVBZ2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBjYW4gcnVuIGZpbmFsaXplQ3Jvd2RzYWxlKCkgcHJvcGVybHkuDQogICAqDQogICAqIFRoaXMgaXMgYSBzYWZldHkgY2hlY2sgZnVuY3Rpb24gdGhhdCBkb2Vzbid0IGFsbG93IGNyb3dkc2FsZSB0byBiZWdpbg0KICAgKiB1bmxlc3MgdGhlIGZpbmFsaXplciBoYXMgYmVlbiBzZXQgdXAgcHJvcGVybHkuDQogICAqLw0KICBmdW5jdGlvbiBpc1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7DQoNCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLiAqLw0KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpOw0KDQp9DQoNCg0KDQoNCi8qDQogKiBFUkMyMCBpbnRlcmZhY2UNCiAqIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqLw0KY29udHJhY3QgRVJDMjAgew0KICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsNCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOw0KICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsNCn0NCg0KDQovKioNCiAqIEEgdG9rZW4gdGhhdCBkZWZpbmVzIGZyYWN0aW9uYWwgdW5pdHMgYXMgZGVjaW1hbHMuDQogKi8NCmNvbnRyYWN0IEZyYWN0aW9uYWxFUkMyMCBpcyBFUkMyMCB7DQoNCiAgdWludCBwdWJsaWMgZGVjaW1hbHM7DQoNCn0NCg0KDQoNCi8qKg0KICogQWJzdHJhY3QgYmFzZSBjb250cmFjdCBmb3IgdG9rZW4gc2FsZXMuDQogKg0KICogSGFuZGxlDQogKiAtIHN0YXJ0IGFuZCBlbmQgZGF0ZXMNCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzDQogKiAtIG1pbmltdW0gZnVuZGluZyBnb2FsIGFuZCByZWZ1bmQNCiAqIC0gdmFyaW91cyBzdGF0aXN0aWNzIGR1cmluZyB0aGUgY3Jvd2RmdW5kDQogKiAtIGRpZmZlcmVudCBwcmljaW5nIHN0cmF0ZWdpZXMNCiAqIC0gZGlmZmVyZW50IGludmVzdG1lbnQgcG9saWNpZXMgKHJlcXVpcmUgc2VydmVyIHNpZGUgY3VzdG9tZXIgaWQsIGFsbG93IG9ubHkgd2hpdGVsaXN0ZWQgYWRkcmVzc2VzKQ0KICoNCiAqLw0KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIEhhbHRhYmxlIHsNCg0KICAvKiBNYXggaW52ZXN0bWVudCBjb3VudCB3aGVuIHdlIGFyZSBzdGlsbCBhbGxvd2VkIHRvIGNoYW5nZSB0aGUgbXVsdGlzaWcgYWRkcmVzcyAqLw0KICB1aW50IHB1YmxpYyBNQVhfSU5WRVNUTUVOVFNfQkVGT1JFX01VTFRJU0lHX0NIQU5HRSA9IDU7DQoNCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7DQoNCiAgLyogVGhlIHRva2VuIHdlIGFyZSBzZWxsaW5nICovDQogIEZyYWN0aW9uYWxFUkMyMCBwdWJsaWMgdG9rZW47DQoNCiAgLyogSG93IHdlIGFyZSBnb2luZyB0byBwcmljZSBvdXIgb2ZmZXJpbmcgKi8NCiAgUHJpY2luZ1N0cmF0ZWd5IHB1YmxpYyBwcmljaW5nU3RyYXRlZ3k7DQoNCiAgLyogUG9zdC1zdWNjZXNzIGNhbGxiYWNrICovDQogIEZpbmFsaXplQWdlbnQgcHVibGljIGZpbmFsaXplQWdlbnQ7DQoNCiAgLyogdG9rZW5zIHdpbGwgYmUgdHJhbnNmZXJlZCBmcm9tIHRoaXMgYWRkcmVzcyAqLw0KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsNCg0KICAvKiBpZiB0aGUgZnVuZGluZyBnb2FsIGlzIG5vdCByZWFjaGVkLCBpbnZlc3RvcnMgbWF5IHdpdGhkcmF3IHRoZWlyIGZ1bmRzICovDQogIHVpbnQgcHVibGljIG1pbmltdW1GdW5kaW5nR29hbDsNCg0KICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgc3RhcnQgZGF0ZSBvZiB0aGUgY3Jvd2RzYWxlICovDQogIHVpbnQgcHVibGljIHN0YXJ0c0F0Ow0KDQogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBlbmQgZGF0ZSBvZiB0aGUgY3Jvd2RzYWxlICovDQogIHVpbnQgcHVibGljIGVuZHNBdDsNCg0KICAvKiB0aGUgbnVtYmVyIG9mIHRva2VucyBhbHJlYWR5IHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0Ki8NCiAgdWludCBwdWJsaWMgdG9rZW5zU29sZCA9IDA7DQoNCiAgLyogSG93IG1hbnkgd2VpIG9mIGZ1bmRpbmcgd2UgaGF2ZSByYWlzZWQgKi8NCiAgdWludCBwdWJsaWMgd2VpUmFpc2VkID0gMDsNCg0KICAvKiBIb3cgbWFueSBkaXN0aW5jdCBhZGRyZXNzZXMgaGF2ZSBpbnZlc3RlZCAqLw0KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50ID0gMDsNCg0KICAvKiBIb3cgbXVjaCB3ZWkgd2UgaGF2ZSByZXR1cm5lZCBiYWNrIHRvIHRoZSBjb250cmFjdCBhZnRlciBhIGZhaWxlZCBjcm93ZGZ1bmQuICovDQogIHVpbnQgcHVibGljIGxvYWRlZFJlZnVuZCA9IDA7DQoNCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgZ2l2ZW4gYmFjayB0byBpbnZlc3RvcnMuKi8NCiAgdWludCBwdWJsaWMgd2VpUmVmdW5kZWQgPSAwOw0KDQogIC8qIEhhcyB0aGlzIGNyb3dkc2FsZSBiZWVuIGZpbmFsaXplZCAqLw0KICBib29sIHB1YmxpYyBmaW5hbGl6ZWQ7DQoNCiAgLyogRG8gd2UgbmVlZCB0byBoYXZlIHVuaXF1ZSBjb250cmlidXRvciBpZCBmb3IgZWFjaCBjdXN0b21lciAqLw0KICBib29sIHB1YmxpYyByZXF1aXJlQ3VzdG9tZXJJZDsNCg0KICAvKioNCiAgICAqIERvIHdlIHZlcmlmeSB0aGF0IGNvbnRyaWJ1dG9yIGhhcyBiZWVuIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIChhY2NyZWRpdGVkIGludmVzdG9ycyBvbmx5KS4NCiAgICAqIFRoaXMgbWV0aG9kIHdhcyBmaXJzdCB1c2VkIGluIEZpcnN0Qmxvb2QgY3Jvd2RzYWxlIHRvIGVuc3VyZSBhbGwgY29udHJpYnV0b3JzIGhhdmUgYWNjZXB0ZWQgdGVybXMgb24gc2FsZSAob24gdGhlIHdlYikuDQogICAgKi8NCiAgYm9vbCBwdWJsaWMgcmVxdWlyZWRTaWduZWRBZGRyZXNzOw0KDQogIC8qIFNlcnZlciBzaWRlIGFkZHJlc3MgdGhhdCBzaWduZWQgYWxsb3dlZCBjb250cmlidXRvcnMgKEV0aGVyZXVtIGFkZHJlc3NlcykgdGhhdCBjYW4gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSAqLw0KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOw0KDQogIC8qKiBIb3cgbXVjaCBFVEggZWFjaCBhZGRyZXNzIGhhcyBpbnZlc3RlZCB0byB0aGlzIGNyb3dkc2FsZSAqLw0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOw0KDQogIC8qKiBIb3cgbXVjaCB0b2tlbnMgdGhpcyBjcm93ZHNhbGUgaGFzIGNyZWRpdGVkIGZvciBlYWNoIGludmVzdG9yIGFkZHJlc3MgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsNCg0KICAvKiogQWRkcmVzc2VzIHRoYXQgYXJlIGFsbG93ZWQgdG8gaW52ZXN0IGV2ZW4gYmVmb3JlIElDTyBvZmZpY2FsIG9wZW5zLiBGb3IgdGVzdGluZywgZm9yIElDTyBwYXJ0bmVycywgZXRjLiAqLw0KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0Ow0KDQogIC8qKiBUaGlzIGlzIGZvciBtYW51bCB0ZXN0aW5nIGZvciB0aGUgaW50ZXJhY3Rpb24gZnJvbSBvd25lciB3YWxsZXQuIFlvdSBjYW4gc2V0IGl0IHRvIGFueSB2YWx1ZSBhbmQgaW5zcGVjdCB0aGlzIGluIGJsb2NrY2hhaW4gZXhwbG9yZXIgdG8gc2VlIHRoYXQgY3Jvd2RzYWxlIGludGVyYWN0aW9uIHdvcmtzLiAqLw0KICB1aW50IHB1YmxpYyBvd25lclRlc3RWYWx1ZTsNCg0KICAvKiogU3RhdGUgbWFjaGluZQ0KICAgKg0KICAgKiAtIFByZXBhcmluZzogQWxsIGNvbnRyYWN0IGluaXRpYWxpemF0aW9uIGNhbGxzIGFuZCB2YXJpYWJsZXMgaGF2ZSBub3QgYmVlbiBzZXQgeWV0DQogICAqIC0gUHJlZnVuZGluZzogV2UgaGF2ZSBub3QgcGFzc2VkIHN0YXJ0IHRpbWUgeWV0DQogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQ0KICAgKiAtIFN1Y2Nlc3M6IE1pbmltdW0gZnVuZGluZyBnb2FsIHJlYWNoZWQNCiAgICogLSBGYWlsdXJlOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBub3QgcmVhY2hlZCBiZWZvcmUgZW5kaW5nIHRpbWUNCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZWQgaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZA0KICAgKiAtIFJlZnVuZGluZzogUmVmdW5kcyBhcmUgbG9hZGVkIG9uIHRoZSBjb250cmFjdCBmb3IgcmVjbGFpbS4NCiAgICovDQogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlcGFyaW5nLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGYWlsdXJlLCBGaW5hbGl6ZWQsIFJlZnVuZGluZ30NCg0KICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlDQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50MTI4IGN1c3RvbWVySWQpOw0KDQogIC8vIFJlZnVuZCB3YXMgcHJvY2Vzc2VkIGZvciBhIGNvbnRyaWJ1dG9yDQogIGV2ZW50IFJlZnVuZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCk7DQoNCiAgLy8gVGhlIHJ1bGVzIHdlcmUgY2hhbmdlZCB3aGF0IGtpbmQgb2YgaW52ZXN0bWVudHMgd2UgYWNjZXB0DQogIGV2ZW50IEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKGJvb2wgcmVxdWlyZUN1c3RvbWVySWQsIGJvb2wgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBhZGRyZXNzIHNpZ25lckFkZHJlc3MpOw0KDQogIC8vIEFkZHJlc3MgZWFybHkgcGFydGljaXBhdGlvbiB3aGl0ZWxpc3Qgc3RhdHVzIGNoYW5nZWQNCiAgZXZlbnQgV2hpdGVsaXN0ZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cyk7DQoNCiAgLy8gQ3Jvd2RzYWxlIGVuZCB0aW1lIGhhcyBiZWVuIGNoYW5nZWQNCiAgZXZlbnQgRW5kc0F0Q2hhbmdlZCh1aW50IGVuZHNBdCk7DQoNCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKGFkZHJlc3MgX3Rva2VuLCBQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSwgYWRkcmVzcyBfbXVsdGlzaWdXYWxsZXQsIHVpbnQgX3N0YXJ0LCB1aW50IF9lbmQsIHVpbnQgX21pbmltdW1GdW5kaW5nR29hbCkgew0KDQogICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KDQogICAgdG9rZW4gPSBGcmFjdGlvbmFsRVJDMjAoX3Rva2VuKTsNCg0KICAgIHNldFByaWNpbmdTdHJhdGVneShfcHJpY2luZ1N0cmF0ZWd5KTsNCg0KICAgIG11bHRpc2lnV2FsbGV0ID0gX211bHRpc2lnV2FsbGV0Ow0KICAgIGlmKG11bHRpc2lnV2FsbGV0ID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYoX3N0YXJ0ID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgc3RhcnRzQXQgPSBfc3RhcnQ7DQoNCiAgICBpZihfZW5kID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgZW5kc0F0ID0gX2VuZDsNCg0KICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzDQogICAgaWYoc3RhcnRzQXQgPj0gZW5kc0F0KSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8vIE1pbmltdW0gZnVuZGluZyBnb2FsIGNhbiBiZSB6ZXJvDQogICAgbWluaW11bUZ1bmRpbmdHb2FsID0gX21pbmltdW1GdW5kaW5nR29hbDsNCiAgfQ0KDQogIC8qKg0KICAgKiBEb24ndCBleHBlY3QgdG8ganVzdCBzZW5kIGluIG1vbmV5IGFuZCBnZXQgdG9rZW5zLg0KICAgKi8NCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsNCiAgICB0aHJvdzsNCiAgfQ0KDQogIC8qKg0KICAgKiBNYWtlIGFuIGludmVzdG1lbnQuDQogICAqDQogICAqIENyb3dkc2FsZSBtdXN0IGJlIHJ1bm5pbmcgZm9yIG9uZSB0byBpbnZlc3QuDQogICAqIFdlIG11c3QgaGF2ZSBub3QgcHJlc3NlZCB0aGUgZW1lcmdlbmN5IGJyYWtlLg0KICAgKg0KICAgKiBAcGFyYW0gcmVjZWl2ZXIgVGhlIEV0aGVyZXVtIGFkZHJlc3Mgd2hvIHJlY2VpdmVzIHRoZSB0b2tlbnMNCiAgICogQHBhcmFtIGN1c3RvbWVySWQgKG9wdGlvbmFsKSBVVUlEIHY0IHRvIHRyYWNrIHRoZSBzdWNjZXNzZnVsIHBheW1lbnRzIG9uIHRoZSBzZXJ2ZXIgc2lkZQ0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gaW52ZXN0SW50ZXJuYWwoYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBzdG9wSW5FbWVyZ2VuY3kgcHJpdmF0ZSB7DQoNCiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQNCiAgICBpZihnZXRTdGF0ZSgpID09IFN0YXRlLlByZUZ1bmRpbmcpIHsNCiAgICAgIC8vIEFyZSB3ZSB3aGl0ZWxpc3RlZCBmb3IgZWFybHkgZGVwb3NpdA0KICAgICAgaWYoIWVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbcmVjZWl2ZXJdKSB7DQogICAgICAgIHRocm93Ow0KICAgICAgfQ0KICAgIH0gZWxzZSBpZihnZXRTdGF0ZSgpID09IFN0YXRlLkZ1bmRpbmcpIHsNCiAgICAgIC8vIFJldGFpbCBwYXJ0aWNpcGFudHMgY2FuIG9ubHkgY29tZSBpbiB3aGVuIHRoZSBjcm93ZHNhbGUgaXMgcnVubmluZw0KICAgICAgLy8gcGFzcw0KICAgIH0gZWxzZSB7DQogICAgICAvLyBVbndhbnRlZCBzdGF0ZQ0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7DQogICAgdWludCB0b2tlbkFtb3VudCA9IHByaWNpbmdTdHJhdGVneS5jYWxjdWxhdGVQcmljZSh3ZWlBbW91bnQsIHdlaVJhaXNlZCwgdG9rZW5zU29sZCwgbXNnLnNlbmRlciwgdG9rZW4uZGVjaW1hbHMoKSk7DQoNCiAgICBpZih0b2tlbkFtb3VudCA9PSAwKSB7DQogICAgICAvLyBEdXN0IHRyYW5zYWN0aW9uDQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZihpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9PSAwKSB7DQogICAgICAgLy8gQSBuZXcgaW52ZXN0b3INCiAgICAgICBpbnZlc3RvckNvdW50Kys7DQogICAgfQ0KDQogICAgLy8gVXBkYXRlIGludmVzdG9yDQogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHdlaUFtb3VudCk7DQogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsNCg0KICAgIC8vIFVwZGF0ZSB0b3RhbHMNCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOw0KICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLnBsdXModG9rZW5BbW91bnQpOw0KDQogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcA0KICAgIGlmKGlzQnJlYWtpbmdDYXAod2VpQW1vdW50LCB0b2tlbkFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5DQogICAgaWYoIW11bHRpc2lnV2FsbGV0LnNlbmQod2VpQW1vdW50KSkgdGhyb3c7DQoNCiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2Vzcw0KICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50LCBjdXN0b21lcklkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBQcmVhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBlYXJseSBpbnZlc3RvcnMuDQogICAqDQogICAqIFByZWFsbG9jYXRlZCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgYmVmb3JlIHRoZSBhY3R1YWwgY3Jvd2RzYWxlIG9wZW5zLg0KICAgKiBUaGlzIGZ1bmN0aW9uIG1pbnRzIHRoZSB0b2tlbnMgYW5kIG1vdmVzIHRoZSBjcm93ZHNhbGUgbmVlZGxlLg0KICAgKg0KICAgKiBJbnZlc3RvciBjb3VudCBpcyBub3QgaGFuZGxlZDsgaXQgaXMgYXNzdW1lZCB0aGlzIGdvZXMgZm9yIG11bHRpcGxlIGludmVzdG9ycw0KICAgKiBhbmQgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBoYXBwZW5zIG91dHNpZGUgdGhlIHNtYXJ0IGNvbnRyYWN0IGZsb3cuDQogICAqDQogICAqIE5vIG1vbmV5IGlzIGV4Y2hhbmdlZCwgYXMgdGhlIGNyb3dkc2FsZSB0ZWFtIGFscmVhZHkgaGF2ZSByZWNlaXZlZCB0aGUgcGF5bWVudC4NCiAgICoNCiAgICogQHBhcmFtIGZ1bGxUb2tlbnMgdG9rZW5zIGFzIGZ1bGwgdG9rZW5zIC0gZGVjaW1hbCBwbGFjZXMgYWRkZWQgaW50ZXJuYWxseQ0KICAgKiBAcGFyYW0gd2VpUHJpY2UgUHJpY2Ugb2YgYSBzaW5nbGUgZnVsbCB0b2tlbiBpbiB3ZWkNCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIHByZWFsbG9jYXRlKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgZnVsbFRva2VucywgdWludCB3ZWlQcmljZSkgcHVibGljIG9ubHlPd25lciB7DQoNCiAgICB1aW50IHRva2VuQW1vdW50ID0gZnVsbFRva2VucyAqIDEwKip0b2tlbi5kZWNpbWFscygpOw0KICAgIHVpbnQgd2VpQW1vdW50ID0gd2VpUHJpY2UgKiBmdWxsVG9rZW5zOyAvLyBUaGlzIGNhbiBiZSBhbHNvIDAsIHdlIGdpdmUgb3V0IHRva2VucyBmb3IgZnJlZQ0KDQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsNCiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5wbHVzKHRva2VuQW1vdW50KTsNCg0KICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOw0KICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0ucGx1cyh0b2tlbkFtb3VudCk7DQoNCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsNCg0KICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzDQogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIDApOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGFub255bW91cyBjb250cmlidXRpb25zIHRvIHRoaXMgY3Jvd2RzYWxlLg0KICAgKi8NCiAgZnVuY3Rpb24gaW52ZXN0V2l0aFNpZ25lZEFkZHJlc3MoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTI1NihhZGRyKTsNCiAgICAgaWYgKGVjcmVjb3ZlcihoYXNoLCB2LCByLCBzKSAhPSBzaWduZXJBZGRyZXNzKSB0aHJvdzsNCiAgICAgaWYoY3VzdG9tZXJJZCA9PSAwKSB0aHJvdzsgIC8vIFVVSUR2NCBzYW5pdHkgY2hlY2sNCiAgICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7DQogIH0NCg0KICAvKioNCiAgICogVHJhY2sgd2hvIGlzIHRoZSBjdXN0b21lciBtYWtpbmcgdGhlIHBheW1lbnQgc28gd2UgY2FuIHNlbmQgdGhhbmsgeW91IGVtYWlsLg0KICAgKi8NCiAgZnVuY3Rpb24gaW52ZXN0V2l0aEN1c3RvbWVySWQoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cw0KICAgIGlmKGN1c3RvbWVySWQgPT0gMCkgdGhyb3c7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrDQogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgYW5vbnltb3VzIGNvbnRyaWJ1dGlvbnMgdG8gdGhpcyBjcm93ZHNhbGUuDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyBhZGRyKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaWYocmVxdWlyZUN1c3RvbWVySWQpIHRocm93OyAvLyBDcm93ZHNhbGUgbmVlZHMgdG8gdHJhY2sgcGFydGlwYW50cyBmb3IgdGhhbmsgeW91IGVtYWlsDQogICAgaWYocmVxdWlyZWRTaWduZWRBZGRyZXNzKSB0aHJvdzsgLy8gQ3Jvd2RzYWxlIGFsbG93cyBvbmx5IHNlcnZlci1zaWRlIHNpZ25lZCBwYXJ0aWNpcGFudHMNCiAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCAwKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyIGFuZCBjbGVhciBoaXMgYWRkcmVzcy4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIGJ1eVdpdGhTaWduZWRBZGRyZXNzKHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpbnZlc3RXaXRoU2lnbmVkQWRkcmVzcyhtc2cuc2VuZGVyLCBjdXN0b21lcklkLCB2LCByLCBzKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gYnV5V2l0aEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaW52ZXN0V2l0aEN1c3RvbWVySWQobXNnLnNlbmRlciwgY3VzdG9tZXJJZCk7DQogIH0NCg0KICAvKioNCiAgICogVGhlIGJhc2ljIGVudHJ5IHBvaW50IHRvIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgcHJvY2Vzcy4NCiAgICoNCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLg0KICAgKi8NCiAgZnVuY3Rpb24gYnV5KCkgcHVibGljIHBheWFibGUgew0KICAgIGludmVzdChtc2cuc2VuZGVyKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBGaW5hbGl6ZSBhIHN1Y2NjZXNmdWwgY3Jvd2RzYWxlLg0KICAgKg0KICAgKiBUaGUgb3duZXIgY2FuIHRyaWdncmUgYSBjYWxsIHRoZSBjb250cmFjdCB0aGF0IHByb3ZpZGVzIHBvc3QtY3Jvd2RzYWxlIGFjdGlvbnMsIGxpa2UgcmVsZWFzaW5nIHRoZSB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgew0KDQogICAgLy8gQWxyZWFkeSBmaW5hbGl6ZWQNCiAgICBpZihmaW5hbGl6ZWQpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8vIEZpbmFsaXppbmcgaXMgb3B0aW9uYWwuIFdlIG9ubHkgY2FsbCBpdCBpZiB3ZSBhcmUgZ2l2ZW4gYSBmaW5hbGl6aW5nIGFnZW50Lg0KICAgIGlmKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgIT0gMCkgew0KICAgICAgZmluYWxpemVBZ2VudC5maW5hbGl6ZUNyb3dkc2FsZSgpOw0KICAgIH0NCg0KICAgIGZpbmFsaXplZCA9IHRydWU7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgdG8gKHJlKXNldCBmaW5hbGl6ZSBhZ2VudC4NCiAgICoNCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHNldHRpbmcgdGhpcywgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuDQogICAqLw0KICBmdW5jdGlvbiBzZXRGaW5hbGl6ZUFnZW50KEZpbmFsaXplQWdlbnQgYWRkcikgb25seU93bmVyIHsNCiAgICBmaW5hbGl6ZUFnZW50ID0gYWRkcjsNCg0KICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50DQogICAgaWYoIWZpbmFsaXplQWdlbnQuaXNGaW5hbGl6ZUFnZW50KCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBTZXQgcG9saWN5IGRvIHdlIG5lZWQgdG8gaGF2ZSBzZXJ2ZXItc2lkZSBjdXN0b21lciBpZHMgZm9yIHRoZSBpbnZlc3RtZW50cy4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIHNldFJlcXVpcmVDdXN0b21lcklkKGJvb2wgdmFsdWUpIG9ubHlPd25lciB7DQogICAgcmVxdWlyZUN1c3RvbWVySWQgPSB2YWx1ZTsNCiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBTZXQgcG9saWN5IGlmIGFsbCBpbnZlc3RvcnMgbXVzdCBiZSBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSBmaXJzdC4NCiAgICoNCiAgICogVGhpcyBpcyBlLmcuIGZvciB0aGUgYWNjcmVkaXRlZCBpbnZlc3RvciBjbGVhcmluZy4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIHNldFJlcXVpcmVTaWduZWRBZGRyZXNzKGJvb2wgdmFsdWUsIGFkZHJlc3MgX3NpZ25lckFkZHJlc3MpIG9ubHlPd25lciB7DQogICAgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gdmFsdWU7DQogICAgc2lnbmVyQWRkcmVzcyA9IF9zaWduZXJBZGRyZXNzOw0KICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLg0KICAgKg0KICAgKiBUT0RPOiBGaXggc3BlbGxpbmcgZXJyb3IgaW4gdGhlIG5hbWUNCiAgICovDQogIGZ1bmN0aW9uIHNldEVhcmx5UGFyaWNpcGFudFdoaXRlbGlzdChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKSBvbmx5T3duZXIgew0KICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBzdGF0dXM7DQogICAgV2hpdGVsaXN0ZWQoYWRkciwgc3RhdHVzKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyBjcm93ZHNhbGUgb3duZXIgdG8gY2xvc2UgZWFybHkgb3IgZXh0ZW5kIHRoZSBjcm93ZHNhbGUuDQogICAqDQogICAqIFRoaXMgaXMgdXNlZnVsIGUuZy4gZm9yIGEgbWFudWFsIHNvZnQgY2FwIGltcGxlbWVudGF0aW9uOg0KICAgKiAtIGFmdGVyIFggYW1vdW50IGlzIHJlYWNoZWQgZGV0ZXJtaW5lIG1hbnVhbCBjbG9zaW5nDQogICAqDQogICAqIFRoaXMgbWF5IHB1dCB0aGUgY3Jvd2RzYWxlIHRvIGFuIGludmFsaWQgc3RhdGUsDQogICAqIGJ1dCB3ZSB0cnVzdCBvd25lcnMga25vdyB3aGF0IHRoZXkgYXJlIGRvaW5nLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0RW5kc0F0KHVpbnQgdGltZSkgb25seU93bmVyIHsNCg0KICAgIGlmKG5vdyA+IHRpbWUpIHsNCiAgICAgIHRocm93OyAvLyBEb24ndCBjaGFuZ2UgcGFzdA0KICAgIH0NCg0KICAgIGVuZHNBdCA9IHRpbWU7DQogICAgRW5kc0F0Q2hhbmdlZChlbmRzQXQpOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IHRvIChyZSlzZXQgcHJpY2luZyBzdHJhdGVneS4NCiAgICoNCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHRoZSBzZXQsIHNvIHRoYXQgd2UgY2FuIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0UHJpY2luZ1N0cmF0ZWd5KFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5KSBvbmx5T3duZXIgew0KICAgIHByaWNpbmdTdHJhdGVneSA9IF9wcmljaW5nU3RyYXRlZ3k7DQoNCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudA0KICAgIGlmKCFwcmljaW5nU3RyYXRlZ3kuaXNQcmljaW5nU3RyYXRlZ3koKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IHRvIGNoYW5nZSB0aGUgdGVhbSBtdWx0aXNpZyBhZGRyZXNzIGluIHRoZSBjYXNlIG9mIGVtZXJnZW5jeS4NCiAgICoNCiAgICogVGhpcyBhbGxvd3MgdG8gc2F2ZSBhIGRlcGxveWVkIGNyb3dkc2FsZSB3YWxsZXQgaW4gdGhlIGNhc2UgdGhlIGNyb3dkc2FsZSBoYXMgbm90IHlldCBiZWd1bg0KICAgKiAod2UgaGF2ZSBkb25lIG9ubHkgZmV3IHRlc3QgdHJhbnNhY3Rpb25zKS4gQWZ0ZXIgdGhlIGNyb3dkc2FsZSBpcyBnb2luZw0KICAgKiB0aGVuIG11bHRpc2lnIGFkZHJlc3Mgc3RheXMgbG9ja2VkIGZvciB0aGUgc2FmZXR5IHJlYXNvbnMuDQogICAqLw0KICBmdW5jdGlvbiBzZXRNdWx0aXNpZyhhZGRyZXNzIGFkZHIpIHB1YmxpYyBvbmx5T3duZXIgew0KDQogICAgLy8gQ2hhbmdlDQogICAgaWYoaW52ZXN0b3JDb3VudCA+IE1BWF9JTlZFU1RNRU5UU19CRUZPUkVfTVVMVElTSUdfQ0hBTkdFKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBtdWx0aXNpZ1dhbGxldCA9IGFkZHI7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgbG9hZCByZWZ1bmRzIGJhY2sgb24gdGhlIGNvbnRyYWN0IGZvciB0aGUgcmVmdW5kaW5nLg0KICAgKg0KICAgKiBUaGUgdGVhbSBjYW4gdHJhbnNmZXIgdGhlIGZ1bmRzIGJhY2sgb24gdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBjYXNlIHRoZSBtaW5pbXVtIGdvYWwgd2FzIG5vdCByZWFjaGVkLi4NCiAgICovDQogIGZ1bmN0aW9uIGxvYWRSZWZ1bmQoKSBwdWJsaWMgcGF5YWJsZSBpblN0YXRlKFN0YXRlLkZhaWx1cmUpIHsNCiAgICBpZihtc2cudmFsdWUgPT0gMCkgdGhyb3c7DQogICAgbG9hZGVkUmVmdW5kID0gbG9hZGVkUmVmdW5kLnBsdXMobXNnLnZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBJbnZlc3RvcnMgY2FuIGNsYWltIHJlZnVuZC4NCiAgICovDQogIGZ1bmN0aW9uIHJlZnVuZCgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlJlZnVuZGluZykgew0KICAgIHVpbnQyNTYgd2VpVmFsdWUgPSBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdOw0KICAgIGlmICh3ZWlWYWx1ZSA9PSAwKSB0aHJvdzsNCiAgICBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdID0gMDsNCiAgICB3ZWlSZWZ1bmRlZCA9IHdlaVJlZnVuZGVkLnBsdXMod2VpVmFsdWUpOw0KICAgIFJlZnVuZChtc2cuc2VuZGVyLCB3ZWlWYWx1ZSk7DQogICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQod2VpVmFsdWUpKSB0aHJvdzsNCiAgfQ0KDQogIC8qKg0KICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNyb3dkc2FsZSBoYXMgcmFpc2VkIGVub3VnaCBtb25leSB0byBiZSBhIHN1Y2Nlcw0KICAgKi8NCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZWFjaGVkKSB7DQogICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBtaW5pbXVtRnVuZGluZ0dvYWw7DQogIH0NCg0KICAvKioNCiAgICogQ2hlY2sgaWYgdGhlIGNvbnRyYWN0IHJlbGF0aW9uc2hpcCBsb29rcyBnb29kLg0KICAgKi8NCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZXJTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgc2FuZSkgew0KICAgIHJldHVybiBmaW5hbGl6ZUFnZW50LmlzU2FuZSgpOw0KICB9DQoNCiAgLyoqDQogICAqIENoZWNrIGlmIHRoZSBjb250cmFjdCByZWxhdGlvbnNoaXAgbG9va3MgZ29vZC4NCiAgICovDQogIGZ1bmN0aW9uIGlzUHJpY2luZ1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzYW5lKSB7DQogICAgcmV0dXJuIHByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSk7DQogIH0NCg0KICAvKioNCiAgICogQ3Jvd2RmdW5kIHN0YXRlIG1hY2hpbmUgbWFuYWdlbWVudC4NCiAgICoNCiAgICogV2UgbWFrZSBpdCBhIGZ1bmN0aW9uIGFuZCBkbyBub3QgYXNzaWduIHRoZSByZXN1bHQgdG8gYSB2YXJpYWJsZSwgc28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZS4NCiAgICovDQogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFN0YXRlKSB7DQogICAgaWYoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOw0KICAgIGVsc2UgaWYgKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgPT0gMCkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsNCiAgICBlbHNlIGlmICghZmluYWxpemVBZ2VudC5pc1NhbmUoKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsNCiAgICBlbHNlIGlmICghcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsNCiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPCBzdGFydHNBdCkgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7DQogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDw9IGVuZHNBdCAmJiAhaXNDcm93ZHNhbGVGdWxsKCkpIHJldHVybiBTdGF0ZS5GdW5kaW5nOw0KICAgIGVsc2UgaWYgKGlzTWluaW11bUdvYWxSZWFjaGVkKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOw0KICAgIGVsc2UgaWYgKCFpc01pbmltdW1Hb2FsUmVhY2hlZCgpICYmIHdlaVJhaXNlZCA+IDAgJiYgbG9hZGVkUmVmdW5kID49IHdlaVJhaXNlZCkgcmV0dXJuIFN0YXRlLlJlZnVuZGluZzsNCiAgICBlbHNlIHJldHVybiBTdGF0ZS5GYWlsdXJlOw0KICB9DQoNCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVhbCB0ZXN0aW5nIG9mIG11bHRpc2lnIHdhbGxldCBpbnRlcmFjdGlvbiAqLw0KICBmdW5jdGlvbiBzZXRPd25lclRlc3RWYWx1ZSh1aW50IHZhbCkgb25seU93bmVyIHsNCiAgICBvd25lclRlc3RWYWx1ZSA9IHZhbDsNCiAgfQ0KDQogIC8qKiBJbnRlcmZhY2UgbWFya2VyLiAqLw0KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICAvLw0KICAvLyBNb2RpZmllcnMNCiAgLy8NCg0KICAvKiogTW9kaWZpZWQgYWxsb3dpbmcgZXhlY3V0aW9uIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgcnVubmluZy4gICovDQogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsNCiAgICBpZihnZXRTdGF0ZSgpICE9IHN0YXRlKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCg0KICAvLw0KICAvLyBBYnN0cmFjdCBmdW5jdGlvbnMNCiAgLy8NCg0KICAvKioNCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgaW52ZXN0ZWQgYnJlYWtzIG91ciBjYXAgcnVsZXMuDQogICAqDQogICAqDQogICAqIFRoZSBjaGlsZCBjb250cmFjdCBtdXN0IGRlZmluZSB0aGVpciBvd24gY2FwIHNldHRpbmcgcnVsZXMuDQogICAqIFdlIGFsbG93IGEgbG90IG9mIGZsZXhpYmlsaXR5IHRocm91Z2ggZGlmZmVyZW50IGNhcHBpbmcgc3RyYXRlZ2llcyAoRVRILCB0b2tlbiBjb3VudCkNCiAgICogQ2FsbGVkIGZyb20gaW52ZXN0KCkuDQogICAqDQogICAqIEBwYXJhbSB3ZWlBbW91bnQgVGhlIGFtb3VudCBvZiB3ZWkgdGhlIGludmVzdG9yIHRyaWVzIHRvIGludmVzdCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gdG9rZW5BbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgd2UgdHJ5IHRvIGdpdmUgdG8gdGhlIGludmVzdG9yIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSB3ZWlSYWlzZWRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCByYWlzZWQgYmFsYW5jZSBhZnRlciB0aGlzIHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSB0b2tlbnNTb2xkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgc29sZCB0b2tlbnMgY291bnQgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbg0KICAgKg0KICAgKiBAcmV0dXJuIHRydWUgaWYgdGFraW5nIHRoaXMgaW52ZXN0bWVudCB3b3VsZCBicmVhayBvdXIgY2FwIHJ1bGVzDQogICAqLw0KICBmdW5jdGlvbiBpc0JyZWFraW5nQ2FwKHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50IHdlaVJhaXNlZFRvdGFsLCB1aW50IHRva2Vuc1NvbGRUb3RhbCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBsaW1pdEJyb2tlbik7DQoNCiAgLyoqDQogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGNyb3dkc2FsZSBpcyBmdWxsIGFuZCB3ZSBjYW4gbm8gbG9uZ2VyIHNlbGwgYW55IHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsNCg0KICAvKioNCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgb3IgdHJhbnNmZXIgaXNzdWVkIHRva2VucyB0byB0aGUgaW52ZXN0b3IgZGVwZW5kaW5nIG9uIHRoZSBjYXAgbW9kZWwuDQogICAqLw0KICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgcHJpdmF0ZTsNCn0NCg0KDQoNCg0KDQoNCg0KLyoqDQogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzDQogKi8NCmNvbnRyYWN0IFNhZmVNYXRoIHsNCiAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKiBiOw0KICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBzYWZlRGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPiAwKTsNCiAgICB1aW50IGMgPSBhIC8gYjsNCiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICBhc3NlcnQoYiA8PSBhKTsNCiAgICByZXR1cm4gYSAtIGI7DQogIH0NCg0KICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSArIGI7DQogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgew0KICAgIGlmICghYXNzZXJ0aW9uKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogIH0NCn0NCg0KDQoNCi8qKg0KICogU3RhbmRhcmQgRVJDMjAgdG9rZW4gd2l0aCBTaG9ydCBIYW5kIEF0dGFjayBhbmQgYXBwcm92ZSgpIHJhY2UgY29uZGl0aW9uIG1pdGlnYXRpb24uDQogKg0KICogQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOg0KICogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sDQogKi8NCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIFNhZmVNYXRoIHsNCg0KICAvKiBUb2tlbiBzdXBwbHkgZ290IGluY3JlYXNlZCBhbmQgYSBuZXcgb3duZXIgcmVjZWl2ZWQgdGhlc2UgdG9rZW5zICovDQogIGV2ZW50IE1pbnRlZChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCk7DQoNCiAgLyogQWN0dWFsIGJhbGFuY2VzIG9mIHRva2VuIGhvbGRlcnMgKi8NCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOw0KDQogIC8qIGFwcHJvdmUoKSBhbGxvd2FuY2VzICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsNCg0KICAvKiBJbnRlcmZhY2UgZGVjbGFyYXRpb24gKi8NCiAgZnVuY3Rpb24gaXNUb2tlbigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHdlQXJlKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICAvKioNCiAgICoNCiAgICogRml4IGZvciB0aGUgRVJDMjAgc2hvcnQgYWRkcmVzcyBhdHRhY2sNCiAgICoNCiAgICogaHR0cDovL3Zlc3NlbmVzLmNvbS90aGUtZXJjMjAtc2hvcnQtYWRkcmVzcy1hdHRhY2stZXhwbGFpbmVkLw0KICAgKi8NCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgew0KICAgICBpZihtc2cuZGF0YS5sZW5ndGggPCBzaXplICsgNCkgew0KICAgICAgIHRocm93Ow0KICAgICB9DQogICAgIF87DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsNCiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOw0KICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgIHVpbnQgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOw0KDQogICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsNCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsNCiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKTsNCiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsNCiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KDQogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2ANCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdA0KICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOg0KICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQ0KICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgdGhyb3c7DQoNCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsNCiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgfQ0KDQp9DQoNCg0KDQoNCg0KLyoqDQogKiBVcGdyYWRlIGFnZW50IGludGVyZmFjZSBpbnNwaXJlZCBieSBMdW55ci4NCiAqDQogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuDQogKiBVcGdyYWRlIGFnZW50IGl0c2VsZiBjYW4gYmUgdGhlIHRva2VuIGNvbnRyYWN0LCBvciBqdXN0IGEgbWlkZGxlIG1hbiBjb250cmFjdCBkb2luZyB0aGUgaGVhdnkgbGlmdGluZy4NCiAqLw0KY29udHJhY3QgVXBncmFkZUFnZW50IHsNCg0KICB1aW50IHB1YmxpYyBvcmlnaW5hbFN1cHBseTsNCg0KICAvKiogSW50ZXJmYWNlIG1hcmtlciAqLw0KICBmdW5jdGlvbiBpc1VwZ3JhZGVBZ2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOw0KDQp9DQoNCg0KLyoqDQogKiBBIHRva2VuIHVwZ3JhZGUgbWVjaGFuaXNtIHdoZXJlIHVzZXJzIGNhbiBvcHQtaW4gYW1vdW50IG9mIHRva2VucyB0byB0aGUgbmV4dCBzbWFydCBjb250cmFjdCByZXZpc2lvbi4NCiAqDQogKiBGaXJzdCBlbnZpc2lvbmVkIGJ5IEdvbGVtIGFuZCBMdW55ciBwcm9qZWN0cy4NCiAqLw0KY29udHJhY3QgVXBncmFkZWFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsNCg0KICAvKiogQ29udHJhY3QgLyBwZXJzb24gd2hvIGNhbiBzZXQgdGhlIHVwZ3JhZGUgcGF0aC4gVGhpcyBjYW4gYmUgdGhlIHNhbWUgYXMgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIGFzIHdoYXQgaXQgaXMgd2l0aCBpdHMgZGVmYXVsdCB2YWx1ZS4gKi8NCiAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZU1hc3RlcjsNCg0KICAvKiogVGhlIG5leHQgY29udHJhY3Qgd2hlcmUgdGhlIHRva2VucyB3aWxsIGJlIG1pZ3JhdGVkLiAqLw0KICBVcGdyYWRlQWdlbnQgcHVibGljIHVwZ3JhZGVBZ2VudDsNCg0KICAvKiogSG93IG1hbnkgdG9rZW5zIHdlIGhhdmUgdXBncmFkZWQgYnkgbm93LiAqLw0KICB1aW50MjU2IHB1YmxpYyB0b3RhbFVwZ3JhZGVkOw0KDQogIC8qKg0KICAgKiBVcGdyYWRlIHN0YXRlcy4NCiAgICoNCiAgICogLSBOb3RBbGxvd2VkOiBUaGUgY2hpbGQgY29udHJhY3QgaGFzIG5vdCByZWFjaGVkIGEgY29uZGl0aW9uIHdoZXJlIHRoZSB1cGdyYWRlIGNhbiBiZ3VuDQogICAqIC0gV2FpdGluZ0ZvckFnZW50OiBUb2tlbiBhbGxvd3MgdXBncmFkZSwgYnV0IHdlIGRvbid0IGhhdmUgYSBuZXcgYWdlbnQgeWV0DQogICAqIC0gUmVhZHlUb1VwZ3JhZGU6IFRoZSBhZ2VudCBpcyBzZXQsIGJ1dCBub3QgYSBzaW5nbGUgdG9rZW4gaGFzIGJlZW4gdXBncmFkZWQgeWV0DQogICAqIC0gVXBncmFkaW5nOiBVcGdyYWRlIGFnZW50IGlzIHNldCBhbmQgdGhlIGJhbGFuY2UgaG9sZGVycyBjYW4gdXBncmFkZSB0aGVpciB0b2tlbnMNCiAgICoNCiAgICovDQogIGVudW0gVXBncmFkZVN0YXRlIHtVbmtub3duLCBOb3RBbGxvd2VkLCBXYWl0aW5nRm9yQWdlbnQsIFJlYWR5VG9VcGdyYWRlLCBVcGdyYWRpbmd9DQoNCiAgLyoqDQogICAqIFNvbWVib2R5IGhhcyB1cGdyYWRlZCBzb21lIG9mIGhpcyB0b2tlbnMuDQogICAqLw0KICBldmVudCBVcGdyYWRlKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KDQogIC8qKg0KICAgKiBOZXcgdXBncmFkZSBhZ2VudCBhdmFpbGFibGUuDQogICAqLw0KICBldmVudCBVcGdyYWRlQWdlbnRTZXQoYWRkcmVzcyBhZ2VudCk7DQoNCiAgLyoqDQogICAqIERvIG5vdCBhbGxvdyBjb25zdHJ1Y3Rpb24gd2l0aG91dCB1cGdyYWRlIG1hc3RlciBzZXQuDQogICAqLw0KICBmdW5jdGlvbiBVcGdyYWRlYWJsZVRva2VuKGFkZHJlc3MgX3VwZ3JhZGVNYXN0ZXIpIHsNCiAgICB1cGdyYWRlTWFzdGVyID0gX3VwZ3JhZGVNYXN0ZXI7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgdGhlIHRva2VuIGhvbGRlciB0byB1cGdyYWRlIHNvbWUgb2YgdGhlaXIgdG9rZW5zIHRvIGEgbmV3IGNvbnRyYWN0Lg0KICAgKi8NCiAgZnVuY3Rpb24gdXBncmFkZSh1aW50MjU2IHZhbHVlKSBwdWJsaWMgew0KDQogICAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsNCiAgICAgIGlmKCEoc3RhdGUgPT0gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlIHx8IHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpKSB7DQogICAgICAgIC8vIENhbGxlZCBpbiBhIGJhZCBzdGF0ZQ0KICAgICAgICB0aHJvdzsNCiAgICAgIH0NCg0KICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuDQogICAgICBpZiAodmFsdWUgPT0gMCkgdGhyb3c7DQoNCiAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgdmFsdWUpOw0KDQogICAgICAvLyBUYWtlIHRva2VucyBvdXQgZnJvbSBjaXJjdWxhdGlvbg0KICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCB2YWx1ZSk7DQogICAgICB0b3RhbFVwZ3JhZGVkID0gc2FmZUFkZCh0b3RhbFVwZ3JhZGVkLCB2YWx1ZSk7DQoNCiAgICAgIC8vIFVwZ3JhZGUgYWdlbnQgcmVpc3N1ZXMgdGhlIHRva2Vucw0KICAgICAgdXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsNCiAgICAgIFVwZ3JhZGUobXNnLnNlbmRlciwgdXBncmFkZUFnZW50LCB2YWx1ZSk7DQogIH0NCg0KICAvKioNCiAgICogU2V0IGFuIHVwZ3JhZGUgYWdlbnQgdGhhdCBoYW5kbGVzDQogICAqLw0KICBmdW5jdGlvbiBzZXRVcGdyYWRlQWdlbnQoYWRkcmVzcyBhZ2VudCkgZXh0ZXJuYWwgew0KDQogICAgICBpZighY2FuVXBncmFkZSgpKSB7DQogICAgICAgIC8vIFRoZSB0b2tlbiBpcyBub3QgeWV0IGluIGEgc3RhdGUgdGhhdCB3ZSBjb3VsZCB0aGluayB1cGdyYWRpbmcNCiAgICAgICAgdGhyb3c7DQogICAgICB9DQoNCiAgICAgIGlmIChhZ2VudCA9PSAweDApIHRocm93Ow0KICAgICAgLy8gT25seSBhIG1hc3RlciBjYW4gZGVzaWduYXRlIHRoZSBuZXh0IGFnZW50DQogICAgICBpZiAobXNnLnNlbmRlciAhPSB1cGdyYWRlTWFzdGVyKSB0aHJvdzsNCiAgICAgIC8vIFVwZ3JhZGUgaGFzIGFscmVhZHkgYmVndW4gZm9yIGFuIGFnZW50DQogICAgICBpZiAoZ2V0VXBncmFkZVN0YXRlKCkgPT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZykgdGhyb3c7DQoNCiAgICAgIHVwZ3JhZGVBZ2VudCA9IFVwZ3JhZGVBZ2VudChhZ2VudCk7DQoNCiAgICAgIC8vIEJhZCBpbnRlcmZhY2UNCiAgICAgIGlmKCF1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSkgdGhyb3c7DQogICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0b2tlbiBzdXBwbGllcyBtYXRjaCBpbiBzb3VyY2UgYW5kIHRhcmdldA0KICAgICAgaWYgKHVwZ3JhZGVBZ2VudC5vcmlnaW5hbFN1cHBseSgpICE9IHRvdGFsU3VwcGx5KSB0aHJvdzsNCg0KICAgICAgVXBncmFkZUFnZW50U2V0KHVwZ3JhZGVBZ2VudCk7DQogIH0NCg0KICAvKioNCiAgICogR2V0IHRoZSBzdGF0ZSBvZiB0aGUgdG9rZW4gdXBncmFkZS4NCiAgICovDQogIGZ1bmN0aW9uIGdldFVwZ3JhZGVTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKFVwZ3JhZGVTdGF0ZSkgew0KICAgIGlmKCFjYW5VcGdyYWRlKCkpIHJldHVybiBVcGdyYWRlU3RhdGUuTm90QWxsb3dlZDsNCiAgICBlbHNlIGlmKGFkZHJlc3ModXBncmFkZUFnZW50KSA9PSAweDAwKSByZXR1cm4gVXBncmFkZVN0YXRlLldhaXRpbmdGb3JBZ2VudDsNCiAgICBlbHNlIGlmKHRvdGFsVXBncmFkZWQgPT0gMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5SZWFkeVRvVXBncmFkZTsNCiAgICBlbHNlIHJldHVybiBVcGdyYWRlU3RhdGUuVXBncmFkaW5nOw0KICB9DQoNCiAgLyoqDQogICAqIENoYW5nZSB0aGUgdXBncmFkZSBtYXN0ZXIuDQogICAqDQogICAqIFRoaXMgYWxsb3dzIHVzIHRvIHNldCBhIG5ldyBvd25lciBmb3IgdGhlIHVwZ3JhZGUgbWVjaGFuaXNtLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0VXBncmFkZU1hc3RlcihhZGRyZXNzIG1hc3RlcikgcHVibGljIHsNCiAgICAgIGlmIChtYXN0ZXIgPT0gMHgwKSB0aHJvdzsNCiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHVwZ3JhZGVNYXN0ZXIpIHRocm93Ow0KICAgICAgdXBncmFkZU1hc3RlciA9IG1hc3RlcjsNCiAgfQ0KDQogIC8qKg0KICAgKiBDaGlsZCBjb250cmFjdCBjYW4gZW5hYmxlIHRvIHByb3ZpZGUgdGhlIGNvbmRpdGlvbiB3aGVuIHRoZSB1cGdyYWRlIGNhbiBiZWd1bi4NCiAgICovDQogIGZ1bmN0aW9uIGNhblVwZ3JhZGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7DQogICAgIHJldHVybiB0cnVlOw0KICB9DQoNCn0NCg0KDQoNCg0KDQoNCi8qKg0KICogRGVmaW5lIGludGVyZmFjZSBmb3IgcmVsZWFzaW5nIHRoZSB0b2tlbiB0cmFuc2ZlciBhZnRlciBhIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlLg0KICovDQpjb250cmFjdCBSZWxlYXNhYmxlVG9rZW4gaXMgRVJDMjAsIE93bmFibGUgew0KDQogIC8qIFRoZSBmaW5hbGl6ZXIgY29udHJhY3QgdGhhdCBhbGxvd3MgdW5saWZ0IHRoZSB0cmFuc2ZlciBsaW1pdHMgb24gdGhpcyB0b2tlbiAqLw0KICBhZGRyZXNzIHB1YmxpYyByZWxlYXNlQWdlbnQ7DQoNCiAgLyoqIEEgY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiByZWxlYXNlIHVzIHRvIHRoZSB3aWxkIGlmIElDTyBzdWNjZXNzLiBJZiBmYWxzZSB3ZSBhcmUgYXJlIGluIHRyYW5zZmVyIGxvY2sgdXAgcGVyaW9kLiovDQogIGJvb2wgcHVibGljIHJlbGVhc2VkID0gZmFsc2U7DQoNCiAgLyoqIE1hcCBvZiBhZ2VudHMgdGhhdCBhcmUgYWxsb3dlZCB0byB0cmFuc2ZlciB0b2tlbnMgcmVnYXJkbGVzcyBvZiB0aGUgbG9jayBkb3duIHBlcmlvZC4gVGhlc2UgYXJlIGNyb3dkc2FsZSBjb250cmFjdHMgYW5kIHBvc3NpYmxlIHRoZSB0ZWFtIG11bHRpc2lnIGl0c2VsZi4gKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgdHJhbnNmZXJBZ2VudHM7DQoNCiAgLyoqDQogICAqIExpbWl0IHRva2VuIHRyYW5zZmVyIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3Zlci4NCiAgICoNCiAgICovDQogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlcikgew0KDQogICAgaWYoIXJlbGVhc2VkKSB7DQogICAgICAgIGlmKCF0cmFuc2ZlckFnZW50c1tfc2VuZGVyXSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBfOw0KICB9DQoNCiAgLyoqDQogICAqIFNldCB0aGUgY29udHJhY3QgdGhhdCBjYW4gY2FsbCByZWxlYXNlIGFuZCBtYWtlIHRoZSB0b2tlbiB0cmFuc2ZlcmFibGUuDQogICAqDQogICAqIERlc2lnbiBjaG9pY2UuIEFsbG93IHJlc2V0IHRoZSByZWxlYXNlIGFnZW50IHRvIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0UmVsZWFzZUFnZW50KGFkZHJlc3MgYWRkcikgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgew0KDQogICAgLy8gV2UgZG9uJ3QgZG8gaW50ZXJmYWNlIGNoZWNrIGhlcmUgYXMgd2UgbWlnaHQgd2FudCB0byBhIG5vcm1hbCB3YWxsZXQgYWRkcmVzcyB0byBhY3QgYXMgYSByZWxlYXNlIGFnZW50DQogICAgcmVsZWFzZUFnZW50ID0gYWRkcjsNCiAgfQ0KDQogIC8qKg0KICAgKiBPd25lciBjYW4gYWxsb3cgYSBwYXJ0aWN1bGFyIGFkZHJlc3MgKGEgY3Jvd2RzYWxlIGNvbnRyYWN0KSB0byB0cmFuc2ZlciB0b2tlbnMgZGVzcGl0ZSB0aGUgbG9jayB1cCBwZXJpb2QuDQogICAqLw0KICBmdW5jdGlvbiBzZXRUcmFuc2ZlckFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgew0KICAgIHRyYW5zZmVyQWdlbnRzW2FkZHJdID0gc3RhdGU7DQogIH0NCg0KICAvKioNCiAgICogT25lIHdheSBmdW5jdGlvbiB0byByZWxlYXNlIHRoZSB0b2tlbnMgdG8gdGhlIHdpbGQuDQogICAqDQogICAqIENhbiBiZSBjYWxsZWQgb25seSBmcm9tIHRoZSByZWxlYXNlIGFnZW50IHRoYXQgaXMgdGhlIGZpbmFsIElDTyBjb250cmFjdC4gSXQgaXMgb25seSBjYWxsZWQgaWYgdGhlIGNyb3dkc2FsZSBoYXMgYmVlbiBzdWNjZXNzIChmaXJzdCBtaWxlc3RvbmUgcmVhY2hlZCkuDQogICAqLw0KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsNCiAgICByZWxlYXNlZCA9IHRydWU7DQogIH0NCg0KICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBiZWZvcmUgb3IgYWZ0ZXIgdGhlIHRva2VucyBoYXZlIGJlZW4gcmVsZWFzZXNkICovDQogIG1vZGlmaWVyIGluUmVsZWFzZVN0YXRlKGJvb2wgcmVsZWFzZVN0YXRlKSB7DQogICAgaWYocmVsZWFzZVN0YXRlICE9IHJlbGVhc2VkKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCiAgICBfOw0KICB9DQoNCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYnkgYSB3aGl0ZWxpc3RlZCByZWxlYXNlIGFnZW50LiAqLw0KICBtb2RpZmllciBvbmx5UmVsZWFzZUFnZW50KCkgew0KICAgIGlmKG1zZy5zZW5kZXIgIT0gcmVsZWFzZUFnZW50KSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCiAgICBfOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXIoKQ0KICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKF9mcm9tKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXJGb3JtKCkNCiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogIH0NCg0KfQ0KDQoNCg0KDQoNCg0KDQovKioNCiAqIEEgdG9rZW4gdGhhdCBjYW4gaW5jcmVhc2UgaXRzIHN1cHBseSBieSBhbm90aGVyIGNvbnRyYWN0Lg0KICoNCiAqIFRoaXMgYWxsb3dzIHVuY2FwcGVkIGNyb3dkc2FsZSBieSBkeW5hbWljYWxseSBpbmNyZWFzaW5nIHRoZSBzdXBwbHkgd2hlbiBtb25leSBwb3VycyBpbi4NCiAqIE9ubHkgbWludCBhZ2VudHMsIGNvbnRyYWN0cyB3aGl0ZWxpc3RlZCBieSBvd25lciwgY2FuIG1pbnQgbmV3IHRva2Vucy4NCiAqDQogKi8NCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7DQoNCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7DQoNCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7DQoNCiAgLyoqIExpc3Qgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gY3JlYXRlIG5ldyB0b2tlbnMgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsNCg0KICBldmVudCBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSAgKTsNCg0KICAvKioNCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgYW5kIGFsbG9jYXRlIHRoZW0gdG8gYW4gYWRkcmVzcy4uDQogICAqDQogICAqIE9ubHkgY2FsbGFibHkgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgKG1pbnQgYWdlbnQpLg0KICAgKi8NCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgb25seU1pbnRBZ2VudCBjYW5NaW50IHB1YmxpYyB7DQogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5wbHVzKGFtb3VudCk7DQogICAgYmFsYW5jZXNbcmVjZWl2ZXJdID0gYmFsYW5jZXNbcmVjZWl2ZXJdLnBsdXMoYW1vdW50KTsNCg0KICAgIC8vIFRoaXMgd2lsbCBtYWtlIHRoZSBtaW50IHRyYW5zYWN0aW9uIGFwcGVyIGluIEV0aGVyU2Nhbi5pbw0KICAgIC8vIFdlIGNhbiByZW1vdmUgdGhpcyBhZnRlciB0aGVyZSBpcyBhIHN0YW5kYXJkaXplZCBtaW50aW5nIGV2ZW50DQogICAgVHJhbnNmZXIoMCwgcmVjZWl2ZXIsIGFtb3VudCk7DQogIH0NCg0KICAvKioNCiAgICogT3duZXIgY2FuIGFsbG93IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHRvIG1pbnQgbmV3IHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7DQogICAgbWludEFnZW50c1thZGRyXSA9IHN0YXRlOw0KICAgIE1pbnRpbmdBZ2VudENoYW5nZWQoYWRkciwgc3RhdGUpOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seU1pbnRBZ2VudCgpIHsNCiAgICAvLyBPbmx5IGNyb3dkc2FsZSBjb250cmFjdHMgYXJlIGFsbG93ZWQgdG8gbWludCBuZXcgdG9rZW5zDQogICAgaWYoIW1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KICAgIF87DQogIH0NCg0KICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovDQogIG1vZGlmaWVyIGNhbk1pbnQoKSB7DQogICAgaWYobWludGluZ0ZpbmlzaGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQp9DQoNCg0KDQovKioNCiAqIEEgY3Jvd2RzYWxlZCB0b2tlbi4NCiAqDQogKiBBbiBFUkMtMjAgdG9rZW4gZGVzaWduZWQgc3BlY2lmaWNhbGx5IGZvciBjcm93ZHNhbGVzIHdpdGggaW52ZXN0b3IgcHJvdGVjdGlvbiBhbmQgZnVydGhlciBkZXZlbG9wbWVudCBwYXRoLg0KICoNCiAqIC0gVGhlIHRva2VuIHRyYW5zZmVyKCkgaXMgZGlzYWJsZWQgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyDQogKiAtIFRoZSB0b2tlbiBjb250cmFjdCBnaXZlcyBhbiBvcHQtaW4gdXBncmFkZSBwYXRoIHRvIGEgbmV3IGNvbnRyYWN0DQogKiAtIFRoZSBzYW1lIHRva2VuIGNhbiBiZSBwYXJ0IG9mIHNldmVyYWwgY3Jvd2RzYWxlcyB0aHJvdWdoIGFwcHJvdmUoKSBtZWNoYW5pc20NCiAqIC0gVGhlIHRva2VuIGNhbiBiZSBjYXBwZWQgKHN1cHBseSBzZXQgaW4gdGhlIGNvbnN0cnVjdG9yKSBvciB1bmNhcHBlZCAoY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiBtaW50IG5ldyB0b2tlbnMpDQogKg0KICovDQpjb250cmFjdCBDcm93ZHNhbGVUb2tlbiBpcyBSZWxlYXNhYmxlVG9rZW4sIE1pbnRhYmxlVG9rZW4sIFVwZ3JhZGVhYmxlVG9rZW4gew0KDQogIGV2ZW50IFVwZGF0ZWRUb2tlbkluZm9ybWF0aW9uKHN0cmluZyBuZXdOYW1lLCBzdHJpbmcgbmV3U3ltYm9sKTsNCg0KICBzdHJpbmcgcHVibGljIG5hbWU7DQoNCiAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7DQoNCiAgdWludCBwdWJsaWMgZGVjaW1hbHM7DQoNCiAgLyoqDQogICAqIENvbnN0cnVjdCB0aGUgdG9rZW4uDQogICAqDQogICAqIFRoaXMgdG9rZW4gbXVzdCBiZSBjcmVhdGVkIHRocm91Z2ggYSB0ZWFtIG11bHRpc2lnIHdhbGxldCwgc28gdGhhdCBpdCBpcyBvd25lZCBieSB0aGF0IHdhbGxldC4NCiAgICoNCiAgICogQHBhcmFtIF9uYW1lIFRva2VuIG5hbWUNCiAgICogQHBhcmFtIF9zeW1ib2wgVG9rZW4gc3ltYm9sIC0gc2hvdWxkIGJlIGFsbCBjYXBzDQogICAqIEBwYXJhbSBfaW5pdGlhbFN1cHBseSBIb3cgbWFueSB0b2tlbnMgd2Ugc3RhcnQgd2l0aA0KICAgKiBAcGFyYW0gX2RlY2ltYWxzIE51bWJlciBvZiBkZWNpbWFsIHBsYWNlcw0KICAgKiBAcGFyYW0gX21pbnRhYmxlIEFyZSBuZXcgdG9rZW5zIGNyZWF0ZWQgb3ZlciB0aGUgY3Jvd2RzYWxlIG9yIGRvIHdlIGRpc3RyaWJ1dGUgb25seSB0aGUgaW5pdGlhbCBzdXBwbHk/IE5vdGUgdGhhdCB3aGVuIHRoZSB0b2tlbiBiZWNvbWVzIHRyYW5zZmVyYWJsZSB0aGUgbWludGluZyBhbHdheXMgZW5kcy4NCiAgICovDQogIGZ1bmN0aW9uIENyb3dkc2FsZVRva2VuKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQgX2luaXRpYWxTdXBwbHksIHVpbnQgX2RlY2ltYWxzLCBib29sIF9taW50YWJsZSkNCiAgICBVcGdyYWRlYWJsZVRva2VuKG1zZy5zZW5kZXIpIHsNCg0KICAgIC8vIENyZWF0ZSBhbnkgYWRkcmVzcywgY2FuIGJlIHRyYW5zZmVycmVkDQogICAgLy8gdG8gdGVhbSBtdWx0aXNpZyB2aWEgY2hhbmdlT3duZXIoKSwNCiAgICAvLyBhbHNvIHJlbWVtYmVyIHRvIGNhbGwgc2V0VXBncmFkZU1hc3RlcigpDQogICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KDQogICAgbmFtZSA9IF9uYW1lOw0KICAgIHN5bWJvbCA9IF9zeW1ib2w7DQoNCiAgICB0b3RhbFN1cHBseSA9IF9pbml0aWFsU3VwcGx5Ow0KDQogICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7DQoNCiAgICAvLyBDcmVhdGUgaW5pdGlhbGx5IGFsbCBiYWxhbmNlIG9uIHRoZSB0ZWFtIG11bHRpc2lnDQogICAgYmFsYW5jZXNbb3duZXJdID0gdG90YWxTdXBwbHk7DQoNCiAgICBpZih0b3RhbFN1cHBseSA+IDApIHsNCiAgICAgIE1pbnRlZChvd25lciwgdG90YWxTdXBwbHkpOw0KICAgIH0NCg0KICAgIC8vIE5vIG1vcmUgbmV3IHN1cHBseSBhbGxvd2VkIGFmdGVyIHRoZSB0b2tlbiBjcmVhdGlvbg0KICAgIGlmKCFfbWludGFibGUpIHsNCiAgICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7DQogICAgICBpZih0b3RhbFN1cHBseSA9PSAwKSB7DQogICAgICAgIHRocm93OyAvLyBDYW5ub3QgY3JlYXRlIGEgdG9rZW4gd2l0aG91dCBzdXBwbHkgYW5kIG5vIG1pbnRpbmcNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICAvKioNCiAgICogV2hlbiB0b2tlbiBpcyByZWxlYXNlZCB0byBiZSB0cmFuc2ZlcmFibGUsIGVuZm9yY2Ugbm8gbmV3IHRva2VucyBjYW4gYmUgY3JlYXRlZC4NCiAgICovDQogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgew0KICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7DQogICAgc3VwZXIucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB1cGdyYWRlIGFnZW50IGZ1bmN0aW9uYWxpdHkga2ljayBpbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgd2FzIHN1Y2Nlc3MuDQogICAqLw0KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgIHJldHVybiByZWxlYXNlZCAmJiBzdXBlci5jYW5VcGdyYWRlKCk7DQogIH0NCg0KICAvKioNCiAgICogT3duZXIgY2FuIHVwZGF0ZSB0b2tlbiBpbmZvcm1hdGlvbiBoZXJlDQogICAqLw0KICBmdW5jdGlvbiBzZXRUb2tlbkluZm9ybWF0aW9uKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wpIG9ubHlPd25lciB7DQogICAgbmFtZSA9IF9uYW1lOw0KICAgIHN5bWJvbCA9IF9zeW1ib2w7DQoNCiAgICBVcGRhdGVkVG9rZW5JbmZvcm1hdGlvbihuYW1lLCBzeW1ib2wpOw0KICB9DQoNCn0NCg0KDQoNCi8qKg0KICogQXQgdGhlIGVuZCBvZiB0aGUgc3VjY2Vzc2Z1bCBjcm93ZHNhbGUgYWxsb2NhdGUgJSBib251cyBvZiB0b2tlbnMgdG8gdGhlIHRlYW0uDQogKg0KICogVW5sb2NrIHRva2Vucy4NCiAqDQogKiBCb251c0FsbG9jYXRpb25GaW5hbCBtdXN0IGJlIHNldCBhcyB0aGUgbWludGluZyBhZ2VudCBmb3IgdGhlIE1pbnRhYmxlVG9rZW4uDQogKg0KICovDQpjb250cmFjdCBCb251c0ZpbmFsaXplQWdlbnQgaXMgRmluYWxpemVBZ2VudCB7DQoNCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7DQoNCiAgQ3Jvd2RzYWxlVG9rZW4gcHVibGljIHRva2VuOw0KICBDcm93ZHNhbGUgcHVibGljIGNyb3dkc2FsZTsNCg0KICAvKiogVG90YWwgcGVyY2VudCBvZiB0b2tlbnMgbWludGVkIHRvIHRoZSB0ZWFtIGF0IHRoZSBlbmQgb2YgdGhlIHNhbGUgYXMgYmFzZSBwb2ludHMgKDAuMDAwMSkgKi8NCiAgdWludCBwdWJsaWMgYm9udXNCYXNlUG9pbnRzOw0KDQogIC8qKiBXaGVyZSB3ZSBtb3ZlIHRoZSB0b2tlbnMgYXQgdGhlIGVuZCBvZiB0aGUgc2FsZS4gKi8NCiAgYWRkcmVzcyBwdWJsaWMgdGVhbU11bHRpc2lnOw0KDQogIC8qIEhvdyBtdWNoIGJvbnVzIHRva2VucyB3ZSBhbGxvY2F0ZWQgKi8NCiAgdWludCBwdWJsaWMgYWxsb2NhdGVkQm9udXM7DQoNCiAgZnVuY3Rpb24gQm9udXNGaW5hbGl6ZUFnZW50KENyb3dkc2FsZVRva2VuIF90b2tlbiwgQ3Jvd2RzYWxlIF9jcm93ZHNhbGUsIHVpbnQgX2JvbnVzQmFzZVBvaW50cywgYWRkcmVzcyBfdGVhbU11bHRpc2lnKSB7DQogICAgdG9rZW4gPSBfdG9rZW47DQogICAgY3Jvd2RzYWxlID0gX2Nyb3dkc2FsZTsNCiAgICBpZihhZGRyZXNzKGNyb3dkc2FsZSkgPT0gMCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgdGVhbU11bHRpc2lnID0gX3RlYW1NdWx0aXNpZzsNCiAgICBpZihhZGRyZXNzKHRlYW1NdWx0aXNpZykgPT0gMCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgYm9udXNCYXNlUG9pbnRzID0gX2JvbnVzQmFzZVBvaW50czsNCiAgfQ0KDQogIC8qIENhbiB3ZSBydW4gZmluYWxpemUgcHJvcGVybHkgKi8NCiAgZnVuY3Rpb24gaXNTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gKHRva2VuLm1pbnRBZ2VudHMoYWRkcmVzcyh0aGlzKSkgPT0gdHJ1ZSkgJiYgKHRva2VuLnJlbGVhc2VBZ2VudCgpID09IGFkZHJlc3ModGhpcykpOw0KICB9DQoNCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLiAqLw0KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpIHsNCiAgICBpZihtc2cuc2VuZGVyICE9IGFkZHJlc3MoY3Jvd2RzYWxlKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gSG93IG1hbnkgJSBvZiB0b2tlbnMgdGhlIGZvdW5kZXJzIGFuZCBvdGhlcnMgZ2V0DQogICAgdWludCB0b2tlbnNTb2xkID0gY3Jvd2RzYWxlLnRva2Vuc1NvbGQoKTsNCiAgICBhbGxvY2F0ZWRCb251cyA9IHRva2Vuc1NvbGQudGltZXMoYm9udXNCYXNlUG9pbnRzKSAvIDEwMDAwOw0KDQogICAgLy8gbW92ZSB0b2tlbnMgdG8gdGhlIHRlYW0gbXVsdGlzaWcgd2FsbGV0DQogICAgdG9rZW4ubWludCh0ZWFtTXVsdGlzaWcsIGFsbG9jYXRlZEJvbnVzKTsNCg0KICAgIC8vIE1ha2UgdG9rZW4gdHJhbnNmZXJhYmxlDQogICAgdG9rZW4ucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsNCiAgfQ0KDQp9'