base 64 content
base64cHEXToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMjsNCi8qKg0KICogT3ZlcmZsb3cgYXdhcmUgdWludCBtYXRoIGZ1bmN0aW9ucy4NCiAqLw0KY29udHJhY3QgU2FmZU1hdGggew0KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICB1aW50MjU2IGMgPSBhICogYjsNCiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgdWludDI1NiBjID0gYSAvIGI7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBwY3QodWludCBudW1lcmF0b3IsIHVpbnQgZGVub21pbmF0b3IsIHVpbnQgcHJlY2lzaW9uKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQgcXVvdGllbnQpIHsNCiAgICB1aW50IF9udW1lcmF0b3IgPSBudW1lcmF0b3IgKiAxMCAqKiAocHJlY2lzaW9uKzEpOw0KICAgIHVpbnQgX3F1b3RpZW50ID0gKChfbnVtZXJhdG9yIC8gZGVub21pbmF0b3IpICsgNSkgLyAxMDsNCiAgICByZXR1cm4gKF9xdW90aWVudCk7DQogIH0NCg0KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICBhc3NlcnQoYiA8PSBhKTsNCiAgICByZXR1cm4gYSAtIGI7DQogIH0NCg0KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICB1aW50MjU2IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYyA+PSBhKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCn0NCg0KLyoqDQogKiBFUkMgMjAgdG9rZW4NCiAqLw0KY29udHJhY3QgVG9rZW4gaXMgU2FmZU1hdGggew0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgew0KICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7DQogICAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gYWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7DQogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7DQogICAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gYWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7DQogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBzdWIoYmFsYW5jZXNbX2Zyb21dLCBfdmFsdWUpOw0KICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBzdWIoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sIF92YWx1ZSk7DQogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSB7IHJldHVybiBmYWxzZTsgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7DQogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsNCiAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICAgIH0NCg0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOw0KDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsNCg0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsNCg0KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5Ow0KDQogICAgLy8gQSB2dWxlcm5hYmlsaXR5IG9mIHRoZSBhcHByb3ZlIG1ldGhvZCBpbiB0aGUgRVJDMjAgc3RhbmRhcmQgd2FzIGlkZW50aWZpZWQgYnkNCiAgICAvLyBNaWtoYWlsIFZsYWRpbWlyb3YgYW5kIERtaXRyeSBLaG92cmF0b3ZpY2ggaGVyZToNCiAgICAvLyBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFZTFB0UXhadTFVQXZPOWNaMU8yUlBYQmJUMG1vb2g0RFlLakFfanAtUkxNDQogICAgLy8gSXQncyBiZXR0ZXIgdG8gdXNlIHRoaXMgbWV0aG9kIHdoaWNoIGlzIG5vdCBzdXNjZXB0aWJsZSB0byBvdmVyLXdpdGhkcmF3aW5nIGJ5IHRoZSBhcHByb3ZlZS4NCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHRvIGFwcHJvdmUNCiAgICAvLy8gQHBhcmFtIF9jdXJyZW50VmFsdWUgVGhlIHByZXZpb3VzIHZhbHVlIGFwcHJvdmVkLCB3aGljaCBjYW4gYmUgcmV0cmlldmVkIHdpdGggYWxsb3dhbmNlKG1zZy5zZW5kZXIsIF9zcGVuZGVyKQ0KICAgIC8vLyBAcGFyYW0gX25ld1ZhbHVlIFRoZSBuZXcgdmFsdWUgdG8gYXBwcm92ZSwgdGhpcyB3aWxsIHJlcGxhY2UgdGhlIF9jdXJyZW50VmFsdWUNCiAgICAvLy8gQHJldHVybiBib29sIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBhIHN1Y2Nlc3MgKHNlZSBFUkMyMCdzIGBhcHByb3ZlYCkNCiAgICBmdW5jdGlvbiBjb21wYXJlQW5kQXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9jdXJyZW50VmFsdWUsIHVpbnQyNTYgX25ld1ZhbHVlKSBwdWJsaWMgcmV0dXJucyhib29sKSB7DQogICAgICAgIGlmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSBfY3VycmVudFZhbHVlKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBhcHByb3ZlKF9zcGVuZGVyLCBfbmV3VmFsdWUpOw0KICAgIH0NCn0NCg0KY29udHJhY3QgQ0hFWFRva2VuIGlzIFRva2VuIHsNCg0KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJDSEVYIFRva2VuIjsNCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJDSFgiOw0KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7DQogICAgdWludCBwdWJsaWMgc3RhcnRCbG9jazsgLy9jcm93ZHNhbGUgc3RhcnQgYmxvY2sNCiAgICB1aW50IHB1YmxpYyBlbmRCbG9jazsgLy9jcm93ZHNhbGUgZW5kIGJsb2NrDQoNCiAgICBhZGRyZXNzIHB1YmxpYyBmb3VuZGVyOw0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KICAgIA0KICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5ID0gMjAwMDAwMDAwMCAqIDEwKipkZWNpbWFsczsgLy8gMmIgdG9rZW5zLCBlYWNoIGRpdmlkZWQgdG8gdXAgdG8gMTBeZGVjaW1hbHMgdW5pdHMuDQogICAgDQogICAgdWludCBwdWJsaWMgdG90YWxUb2tlbnMgPSAwOw0KICAgIHVpbnQgcHVibGljIHByZXNhbGVTdXBwbHkgPSAwOw0KICAgIHVpbnQgcHVibGljIHByZXNhbGVFdGhlclJhaXNlZCA9IDA7DQoNCiAgICBldmVudCBCdXkoYWRkcmVzcyBpbmRleGVkIHJlY2lwaWVudCwgdWludCBldGgsIHVpbnQgY2h4KTsNCg0KICAgIHVpbnQgcHVibGljIHByZXNhbGVBbGxvY2F0aW9uID0gdG90YWxTdXBwbHkgLyAyOyAvLzUwJSBvZiB0b2tlbiBzdXBwbHkgYWxsb2NhdGVkIGZvciBjcm93ZHNhbGUNCiAgICB1aW50IHB1YmxpYyBzdHJhdGVnaWNBbGxvY2F0aW9uID0gdG90YWxTdXBwbHkgLyA0OyAvLzI1JSBvZiB0b2tlbiBzdXBwbHkgYWxsb2NhdGVkIHBvc3QtY3Jvd2RzYWxlIGZvciBzdHJhdGVnaWMgc3VwcGx5DQogICAgdWludCBwdWJsaWMgcmVzZXJ2ZUFsbG9jYXRpb24gPSB0b3RhbFN1cHBseSAvIDQ7IC8vMjUlIG9mIHRva2VuIHN1cHBseSBhbGxvY2F0ZWQgcG9zdC1jcm93ZHNhbGUgZm9yIGludGVybmFsDQogICAgYm9vbCBwdWJsaWMgc3RyYXRlZ2ljQWxsb2NhdGVkID0gZmFsc2U7DQogICAgYm9vbCBwdWJsaWMgcmVzZXJ2ZUFsbG9jYXRlZCA9IGZhbHNlOw0KDQogICAgdWludCBwdWJsaWMgdHJhbnNmZXJMb2NrdXAgPSAxNzI4MDA7IC8vbm8gdHJhbnNmZXJzIHVudGlsIDMwIGRheXMgYWZ0ZXIgY3Jvd2RzYWxlIGJlZ2lucyAoYXNzdW1lcyAxMDAgZGF5IGNyb3dkc2FsZSkNCiAgICB1aW50IHB1YmxpYyByZXNlcnZlTG9ja3VwID0gMjQxOTIwOyAvL2ZpcnN0IHdhdmUgb2YgcmVzZXJ2ZSBsb2NrZWQgdW50aWwgNDIgZGF5cyBhZnRlciBzYWxlIGlzIG92ZXINCg0KICAgIHVpbnQgcHVibGljIHJlc2VydmVXYXZlID0gMDsgLy9pbmNyZW1lbnRzIGVhY2ggdGltZSAxMCUgb2YgcmVzZXJ2ZSBpcyBhbGxvY2F0ZWQsIHRvIGEgbWF4IG9mIDEwDQogICAgdWludCBwdWJsaWMgcmVzZXJ2ZVdhdmVUb2tlbnMgPSByZXNlcnZlQWxsb2NhdGlvbiAvIDEwOyAvLzEwJSBvZiByZXNlcnZlIHdpbGwgYmUgcmVsZWFzZWQgb24gZWFjaCB3YXZlDQogICAgdWludCBwdWJsaWMgcmVzZXJ2ZVdhdmVMb2NrdXAgPSAxNzI4MDA7IC8vMzAgZGF5IGludGVydmFscyBiZWZvcmUgc3Vic2VxdWVudCB3YXZlIG9mIHJlc2VydmUgdG9rZW5zIGNhbiBiZSByZWxlYXNlZA0KDQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUlOX0VUSEVSID0gMSBmaW5uZXk7DQoNCiAgICBlbnVtIFRva2VuU2FsZVN0YXRlIHsNCiAgICAgICAgSW5pdGlhbCwgICAgLy9jb250cmFjdCBpbml0aWFsaXplZCwgYm9udXMgdG9rZW4NCiAgICAgICAgUHJlc2FsZSwgICAgLy9saW1pdGVkIHRpbWUgY3Jvd2RzYWxlDQogICAgICAgIExpdmUsICAgICAgIC8vZGVmYXVsdCBwcmljZQ0KICAgICAgICBGcm96ZW4gICAgICAvL3ByZXZlbnQgc2FsZSBvZiB0b2tlbnMNCiAgICB9DQoNCiAgICBUb2tlblNhbGVTdGF0ZSBwdWJsaWMgX3NhbGVTdGF0ZSA9IFRva2VuU2FsZVN0YXRlLkluaXRpYWw7DQoNCiAgICBmdW5jdGlvbiBDSEVYVG9rZW4oYWRkcmVzcyBmb3VuZGVySW5wdXQsIGFkZHJlc3Mgb3duZXJJbnB1dCwgdWludCBzdGFydEJsb2NrSW5wdXQsIHVpbnQgZW5kQmxvY2tJbnB1dCkgew0KICAgICAgICBmb3VuZGVyID0gZm91bmRlcklucHV0Ow0KICAgICAgICBvd25lciA9IG93bmVySW5wdXQ7DQogICAgICAgIHN0YXJ0QmxvY2sgPSBzdGFydEJsb2NrSW5wdXQ7DQogICAgICAgIGVuZEJsb2NrID0gZW5kQmxvY2tJbnB1dDsNCiAgICAgICAgDQogICAgICAgIHVwZGF0ZVRva2VuU2FsZVN0YXRlKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHJpY2UoKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsNCiAgICAgICAgaWYgKF9zYWxlU3RhdGUgPT0gVG9rZW5TYWxlU3RhdGUuSW5pdGlhbCkgcmV0dXJuIDEyMDAyOw0KICAgICAgICBpZiAoX3NhbGVTdGF0ZSA9PSBUb2tlblNhbGVTdGF0ZS5QcmVzYWxlKSB7DQogICAgICAgICAgICB1aW50IHBlcmNlbnRSZW1haW5pbmcgPSBwY3QoKGVuZEJsb2NrIC0gYmxvY2subnVtYmVyKSwgKGVuZEJsb2NrIC0gc3RhcnRCbG9jayksIDMpOw0KICAgICAgICAgICAgcmV0dXJuIDYwMDAgKyA2ICogcGVyY2VudFJlbWFpbmluZzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gNjAwMDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbigpIHBheWFibGUgew0KICAgICAgICBidXkobXNnLnNlbmRlcik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYnV5KGFkZHJlc3MgcmVjaXBpZW50KSBwYXlhYmxlIHsNCiAgICAgICAgaWYgKHJlY2lwaWVudCA9PSAweDApIHRocm93Ow0KICAgICAgICBpZiAobXNnLnZhbHVlIDwgTUlOX0VUSEVSKSB0aHJvdzsNCiAgICAgICAgaWYgKF9zYWxlU3RhdGUgPT0gVG9rZW5TYWxlU3RhdGUuRnJvemVuKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIHVwZGF0ZVRva2VuU2FsZVN0YXRlKCk7DQoNCiAgICAgICAgdWludCB0b2tlbnMgPSBtdWwobXNnLnZhbHVlLCBwcmljZSgpKTsNCiAgICAgICAgdWludCBuZXh0VG90YWwgPSBhZGQodG90YWxUb2tlbnMsIHRva2Vucyk7DQogICAgICAgIHVpbnQgbmV4dFByZXNhbGVUb3RhbCA9IGFkZChwcmVzYWxlU3VwcGx5LCB0b2tlbnMpOw0KDQogICAgICAgIGlmIChuZXh0VG90YWwgPj0gdG90YWxTdXBwbHkpIHRocm93Ow0KICAgICAgICBpZiAobmV4dFByZXNhbGVUb3RhbCA+PSBwcmVzYWxlQWxsb2NhdGlvbikgdGhyb3c7DQogICAgICAgIA0KICAgICAgICBiYWxhbmNlc1tyZWNpcGllbnRdID0gYWRkKGJhbGFuY2VzW3JlY2lwaWVudF0sIHRva2Vucyk7DQogICAgICAgIHByZXNhbGVTdXBwbHkgPSBuZXh0UHJlc2FsZVRvdGFsOw0KICAgICAgICB0b3RhbFRva2VucyA9IG5leHRUb3RhbDsNCg0KICAgICAgICBpZiAoX3NhbGVTdGF0ZSA9PSBUb2tlblNhbGVTdGF0ZS5Jbml0aWFsIHx8IF9zYWxlU3RhdGUgPT0gVG9rZW5TYWxlU3RhdGUuUHJlc2FsZSkgew0KICAgICAgICAgICAgcHJlc2FsZUV0aGVyUmFpc2VkID0gYWRkKHByZXNhbGVFdGhlclJhaXNlZCwgbXNnLnZhbHVlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvdW5kZXIudHJhbnNmZXIobXNnLnZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIFRyYW5zZmVyKDAsIHJlY2lwaWVudCwgdG9rZW5zKTsNCiAgICAgICAgQnV5KHJlY2lwaWVudCwgbXNnLnZhbHVlLCB0b2tlbnMpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHVwZGF0ZVRva2VuU2FsZVN0YXRlICgpIHsNCiAgICAgICAgaWYgKF9zYWxlU3RhdGUgPT0gVG9rZW5TYWxlU3RhdGUuRnJvemVuKSByZXR1cm47DQoNCiAgICAgICAgaWYgKF9zYWxlU3RhdGUgPT0gVG9rZW5TYWxlU3RhdGUuTGl2ZSAmJiBibG9jay5udW1iZXIgPiBlbmRCbG9jaykgcmV0dXJuOw0KICAgICAgICANCiAgICAgICAgaWYgKF9zYWxlU3RhdGUgPT0gVG9rZW5TYWxlU3RhdGUuSW5pdGlhbCAmJiBibG9jay5udW1iZXIgPj0gc3RhcnRCbG9jaykgew0KICAgICAgICAgICAgX3NhbGVTdGF0ZSA9IFRva2VuU2FsZVN0YXRlLlByZXNhbGU7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmIChfc2FsZVN0YXRlID09IFRva2VuU2FsZVN0YXRlLlByZXNhbGUgJiYgYmxvY2subnVtYmVyID4gZW5kQmxvY2spIHsNCiAgICAgICAgICAgIF9zYWxlU3RhdGUgPSBUb2tlblNhbGVTdGF0ZS5MaXZlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8PSBzdGFydEJsb2NrICsgdHJhbnNmZXJMb2NrdXAgJiYgbXNnLnNlbmRlciAhPSBmb3VuZGVyICYmIG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93Ow0KICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoYmxvY2subnVtYmVyIDw9IHN0YXJ0QmxvY2sgKyB0cmFuc2ZlckxvY2t1cCAmJiBtc2cuc2VuZGVyICE9IGZvdW5kZXIgJiYgbXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7DQogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5SW50ZXJuYWwgew0KICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgbXNnLnNlbmRlciA9PSBmb3VuZGVyKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhbGxvY2F0ZVN0cmF0ZWdpY1Rva2VucygpIG9ubHlJbnRlcm5hbCB7DQogICAgICAgIGlmIChzdHJhdGVnaWNBbGxvY2F0ZWQpIHRocm93Ow0KDQogICAgICAgIGJhbGFuY2VzW293bmVyXSA9IGFkZChiYWxhbmNlc1tvd25lcl0sIHN0cmF0ZWdpY0FsbG9jYXRpb24pOw0KICAgICAgICB0b3RhbFRva2VucyA9IGFkZCh0b3RhbFRva2Vucywgc3RyYXRlZ2ljQWxsb2NhdGlvbik7DQoNCiAgICAgICAgc3RyYXRlZ2ljQWxsb2NhdGVkID0gdHJ1ZTsNCg0KICAgICAgICBUcmFuc2ZlcigwLCBvd25lciwgc3RyYXRlZ2ljQWxsb2NhdGlvbik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWxsb2NhdGVSZXNlcnZlVG9rZW5zKCkgb25seUludGVybmFsIHsNCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8PSBlbmRCbG9jayArIHJlc2VydmVMb2NrdXAgKyAocmVzZXJ2ZVdhdmVMb2NrdXAgKiByZXNlcnZlV2F2ZSkpIHRocm93Ow0KICAgICAgICBpZiAocmVzZXJ2ZUFsbG9jYXRlZCkgdGhyb3c7DQoNCiAgICAgICAgYmFsYW5jZXNbZm91bmRlcl0gPSBhZGQoYmFsYW5jZXNbZm91bmRlcl0sIHJlc2VydmVXYXZlVG9rZW5zKTsNCiAgICAgICAgdG90YWxUb2tlbnMgPSBhZGQodG90YWxUb2tlbnMsIHJlc2VydmVXYXZlVG9rZW5zKTsNCg0KICAgICAgICByZXNlcnZlV2F2ZSsrOw0KICAgICAgICBpZiAocmVzZXJ2ZVdhdmUgPj0gMTApIHsNCiAgICAgICAgICAgIHJlc2VydmVBbGxvY2F0ZWQgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgVHJhbnNmZXIoMCwgZm91bmRlciwgcmVzZXJ2ZVdhdmVUb2tlbnMpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGZyZWV6ZSgpIG9ubHlJbnRlcm5hbCB7DQogICAgICAgIF9zYWxlU3RhdGUgPSBUb2tlblNhbGVTdGF0ZS5Gcm96ZW47DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdW5mcmVlemUoKSBvbmx5SW50ZXJuYWwgew0KICAgICAgICBfc2FsZVN0YXRlID0gVG9rZW5TYWxlU3RhdGUuUHJlc2FsZTsNCiAgICAgICAgdXBkYXRlVG9rZW5TYWxlU3RhdGUoKTsNCiAgICB9DQoNCn0='