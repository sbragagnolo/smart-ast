base 64 content
base64campaign1
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC42Ow0KDQovKg0KICAgIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQ0KICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5DQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCg0KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQogKi8NCg0KLy8vIEB0aXRsZSBNaWxlc3RvbmVUcmFja2VyIENvbnRyYWN0DQovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hDQovLy8gQGRldiBUaGlzIGNvbnRyYWN0IGNvbnRyb2xzIHRoZSBpc3N1YW5jZSBvZiB0b2tlbnMgZm9yIHRoZSBNaW5pTWUgVG9rZW4NCi8vLyAgQ29udHJhY3QuIFRoaXMgdmVyc2lvbiBzcGVjaWZpY2FsbHkgYWN0cyBhcyBhIENhbXBhaWduIG1hbmFnZXIgZm9yIHJhaXNpbmcNCi8vLyAgZnVuZHMgZm9yIG5vbi1wcm9maXQgY2F1c2VzLCBidXQgaXQgY2FuIGJlIGN1c3RvbWl6ZWQgZm9yIGFueSB2YXJpZXR5IG9mDQovLy8gIHB1cnBvc2VzLg0KDQpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgew0KICAgIC8vLyBAbm90aWNlIENhbGxlZCB3aGVuIGBfb3duZXJgIHNlbmRzIGV0aGVyIHRvIHRoZSBNaW5pTWUgVG9rZW4gY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMNCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzDQogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHJldHVybnMoYm9vbCk7DQoNCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQ0KICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkDQogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2Zlcg0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXINCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXINCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyDQogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOw0KDQogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlDQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsDQogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbA0KICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KQ0KICAgICAgICByZXR1cm5zKGJvb2wpOw0KfQ0KDQpjb250cmFjdCBDb250cm9sbGVkIHsNCiAgICAvLy8gQG5vdGljZSBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJvbGxlciBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwNCiAgICAvLy8gIGEgZnVuY3Rpb24gd2l0aCB0aGlzIG1vZGlmaWVyDQogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB0aHJvdzsgXzsgfQ0KDQogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsNCg0KICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30NCg0KICAgIC8vLyBAbm90aWNlIENoYW5nZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0DQogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIF9uZXdDb250cm9sbGVyKSBvbmx5Q29udHJvbGxlciB7DQogICAgICAgIGNvbnRyb2xsZXIgPSBfbmV3Q29udHJvbGxlcjsNCiAgICB9DQp9DQoNCi8vLyBAZGV2IFRoZSBhY3R1YWwgdG9rZW4gY29udHJhY3QsIHRoZSBkZWZhdWx0IGNvbnRyb2xsZXIgaXMgdGhlIG1zZy5zZW5kZXINCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQ0KLy8vICB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0LCB3aGljaCBHaXZldGggd2lsbCBjYWxsIGEgIkNhbXBhaWduIg0KY29udHJhY3QgTWluaU1lVG9rZW4gaXMgQ29udHJvbGxlZCB7DQoNCiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgIC8vVGhlIFRva2VuJ3MgbmFtZTogZS5nLiBEaWdpeERBTyBUb2tlbnMNCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgIC8vTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0DQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGUuZy4gUkVQDQogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJ01NVF8wLjEnOyAvL0FuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZQ0KDQoNCiAgICAvLy8gQGRldiBgQ2hlY2twb2ludGAgaXMgdGhlIHN0cnVjdHVyZSB0aGF0IGF0dGFjaGVzIGEgYmxvY2sgbnVtYmVyIHRvIGENCiAgICAvLy8gIGdpdmVuIHZhbHVlLCB0aGUgYmxvY2sgbnVtYmVyIGF0dGFjaGVkIGlzIHRoZSBvbmUgdGhhdCBsYXN0IGNoYW5nZWQgdGhlDQogICAgLy8vICB2YWx1ZQ0KICAgIHN0cnVjdCAgQ2hlY2twb2ludCB7DQoNCiAgICAgICAgLy8gYGZyb21CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSB2YWx1ZSB3YXMgZ2VuZXJhdGVkIGZyb20NCiAgICAgICAgdWludDEyOCBmcm9tQmxvY2s7DQoNCiAgICAgICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcg0KICAgICAgICB1aW50MTI4IHZhbHVlOw0KICAgIH0NCg0KICAgIC8vIGBwYXJlbnRUb2tlbmAgaXMgdGhlIFRva2VuIGFkZHJlc3MgdGhhdCB3YXMgY2xvbmVkIHRvIHByb2R1Y2UgdGhpcyB0b2tlbjsNCiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZA0KICAgIE1pbmlNZVRva2VuIHB1YmxpYyBwYXJlbnRUb2tlbjsNCg0KICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcw0KICAgIC8vICB1c2VkIHRvIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIENsb25lIFRva2VuDQogICAgdWludCBwdWJsaWMgcGFyZW50U25hcFNob3RCbG9jazsNCg0KICAgIC8vIGBjcmVhdGlvbkJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIENsb25lIFRva2VuIHdhcyBjcmVhdGVkDQogICAgdWludCBwdWJsaWMgY3JlYXRpb25CbG9jazsNCg0KICAgIC8vIGBiYWxhbmNlc2AgaXMgdGhlIG1hcCB0aGF0IHRyYWNrcyB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGluIHRoaXMNCiAgICAvLyAgY29udHJhY3Qgd2hlbiB0aGUgYmFsYW5jZSBjaGFuZ2VzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgY2hhbmdlDQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcA0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsNCg0KICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOw0KDQogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbg0KICAgIENoZWNrcG9pbnRbXSB0b3RhbFN1cHBseUhpc3Rvcnk7DQoNCiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4NCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOw0KDQogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2Vucw0KICAgIE1pbmlNZVRva2VuRmFjdG9yeSBwdWJsaWMgdG9rZW5GYWN0b3J5Ow0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBDb25zdHJ1Y3Rvcg0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgTWluaU1lVG9rZW4NCiAgICAvLy8gQHBhcmFtIF90b2tlbkZhY3RvcnkgVGhlIGFkZHJlc3Mgb2YgdGhlIE1pbmlNZVRva2VuRmFjdG9yeSBjb250cmFjdCB0aGF0DQogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQ0KICAgIC8vLyAgZGVwbG95ZWQgZmlyc3QNCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSBwYXJlbnQgdG9rZW4sIHNldCB0byAweDAgaWYgaXQgaXMgYQ0KICAgIC8vLyAgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfcGFyZW50U25hcFNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbA0KICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4sIHNldCB0byAwIGlmIGl0DQogICAgLy8vICBpcyBhIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICBmdW5jdGlvbiBNaW5pTWVUb2tlbigNCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LA0KICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwNCiAgICAgICAgdWludCBfcGFyZW50U25hcFNob3RCbG9jaywNCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsDQogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsDQogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsDQogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQNCiAgICApIHsNCiAgICAgICAgdG9rZW5GYWN0b3J5ID0gTWluaU1lVG9rZW5GYWN0b3J5KF90b2tlbkZhY3RvcnkpOw0KICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUNCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscw0KICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbA0KICAgICAgICBwYXJlbnRUb2tlbiA9IE1pbmlNZVRva2VuKF9wYXJlbnRUb2tlbik7DQogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsNCiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOw0KICAgICAgICBjcmVhdGlvbkJsb2NrID0gYmxvY2subnVtYmVyOw0KICAgIH0NCg0KDQovLy8vLy8vLy8vLy8vLy8vLy8vDQovLyBFUkMyMCBNZXRob2RzDQovLy8vLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmANCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7DQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0DQogICAgLy8vICBpcyBhcHByb3ZlZCBieSBgX2Zyb21gDQogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudA0KICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQoNCiAgICAgICAgLy8gVGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCBjYW4gbW92ZSB0b2tlbnMgYXJvdW5kIGF0IHdpbGwsDQogICAgICAgIC8vICB0aGlzIGlzIGltcG9ydGFudCB0byByZWNvZ25pemUhIENvbmZpcm0gdGhhdCB5b3UgdHJ1c3QgdGhlDQogICAgICAgIC8vICBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QsIHdoaWNoIGluIG1vc3Qgc2l0dWF0aW9ucyBzaG91bGQgYmUNCiAgICAgICAgLy8gIGFub3RoZXIgb3BlbiBzb3VyY2Ugc21hcnQgY29udHJhY3Qgb3IgMHgwDQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHsNCiAgICAgICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7DQoNCiAgICAgICAgICAgIC8vIFRoZSBzdGFuZGFyZCBFUkMgMjAgdHJhbnNmZXJGcm9tIGZ1bmN0aW9uYWxpdHkNCiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgVGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGluIHRoZSB0b2tlbiBjb250cmFjdCwgaXQgY2FuDQogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4NCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudA0KICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7DQoNCiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgew0KICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgIH0NCg0KICAgICAgICAgICAvLyBEbyBub3QgYWxsb3cgdHJhbnNmZXIgdG8gMHgwIG9yIHRoZSB0b2tlbiBjb250cmFjdCBpdHNlbGYNCiAgICAgICAgICAgaWYgKChfdG8gPT0gMCkgfHwgKF90byA9PSBhZGRyZXNzKHRoaXMpKSkgdGhyb3c7DQoNCiAgICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBiZWluZyB0cmFuc2ZlcmVkIGlzIG1vcmUgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUNCiAgICAgICAgICAgLy8gIGFjY291bnQgdGhlIHRyYW5zZmVyIHJldHVybnMgZmFsc2UNCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2ZBdChfZnJvbSwgYmxvY2subnVtYmVyKTsNCiAgICAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB7DQogICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgIH0NCg0KICAgICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIHRyYW5zZmVyDQogICAgICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7DQogICAgICAgICAgICAgICBpZiAoIVRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vblRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpKQ0KICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgIH0NCg0KICAgICAgICAgICAvLyBGaXJzdCB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcw0KICAgICAgICAgICAvLyAgc2VuZGluZyB0aGUgdG9rZW5zDQogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2Zyb21dLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7DQoNCiAgICAgICAgICAgLy8gVGhlbiB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcw0KICAgICAgICAgICAvLyAgcmVjZWl2aW5nIHRoZSB0b2tlbnMNCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mQXQoX3RvLCBibG9jay5udW1iZXIpOw0KICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7DQoNCiAgICAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdHJhbnNmZXIgZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluDQogICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOw0KDQogICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQncyBiYWxhbmNlIGlzIGJlaW5nIHJlcXVlc3RlZA0KICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IHRoZSBjdXJyZW50IGJsb2NrDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0KF9vd25lciwgYmxvY2subnVtYmVyKTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX2Ftb3VudGAgdG9rZW5zIG9uDQogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbg0KICAgIC8vLyAgdG8gYmUgYSBsaXR0bGUgYml0IHNhZmVyDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7DQoNCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3NlcyYjMTgwOw0KICAgICAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwwKWAgaWYgaXQgaXMgbm90DQogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOg0KICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkNCiAgICAgICAgaWYgKChfYW1vdW50IT0wKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0wKSkgdGhyb3c7DQoNCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwNCiAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsNCiAgICAgICAgICAgIGlmICghVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uQXBwcm92ZShtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCkpDQogICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7DQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcA0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2Vucw0KICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQNCiAgICAvLy8gIHRvIHNwZW5kDQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyDQogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgew0KICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24NCiAgICAvLy8gIGl0cyBiZWhhbGYsIGFuZCB0aGVuIGEgZnVuY3Rpb24gaXMgdHJpZ2dlcmVkIGluIHRoZSBjb250cmFjdCB0aGF0IGlzDQogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bw0KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28NCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMgX2V4dHJhRGF0YQ0KICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsNCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOw0KDQogICAgICAgIC8vIFRoaXMgcG9ydGlvbiBpcyBjb3BpZWQgZnJvbSBDb25zZW5TeXMncyBTdGFuZGFyZCBUb2tlbiBDb250cmFjdC4gSXQNCiAgICAgICAgLy8gIGNhbGxzIHRoZSByZWNlaXZlQXBwcm92YWwgZnVuY3Rpb24gdGhhdCBpcyBwYXJ0IG9mIHRoZSBjb250cmFjdCB0aGF0DQogICAgICAgIC8vICBpcyBiZWluZyBhcHByb3ZlZCAoYF9zcGVuZGVyYCkuIFRoZSBmdW5jdGlvbiBzaG91bGQgbG9vayBsaWtlOg0KICAgICAgICAvLyAgYHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnQsIGFkZHJlc3MNCiAgICAgICAgLy8gIF90b2tlbkNvbnRyYWN0LCBieXRlcyBfZXh0cmFEYXRhKWAgSXQgaXMgYXNzdW1lZCB0aGF0IHRoZSBjYWxsDQogICAgICAgIC8vICAqc2hvdWxkKiBzdWNjZWVkLCBvdGhlcndpc2UgdGhlIHBsYWluIHZhbmlsbGEgYXBwcm92ZSB3b3VsZCBiZSB1c2VkDQogICAgICAgIGlmKCFfc3BlbmRlci5jYWxsKA0KICAgICAgICAgICAgYnl0ZXM0KGJ5dGVzMzIoc2hhMygicmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MsdWludDI1NixhZGRyZXNzLGJ5dGVzKSIpKSksDQogICAgICAgICAgICBtc2cuc2VuZGVyLA0KICAgICAgICAgICAgX2Ftb3VudCwNCiAgICAgICAgICAgIHRoaXMsDQogICAgICAgICAgICBfZXh0cmFEYXRhDQogICAgICAgICAgICApKSB7IHRocm93Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byBnZXQgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMNCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2Vucw0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOw0KICAgIH0NCg0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBRdWVyeSBiYWxhbmNlIGFuZCB0b3RhbFN1cHBseSBpbiBIaXN0b3J5DQovLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQGRldiBRdWVyaWVzIHRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmANCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkDQogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSBiYWxhbmNlIGlzIHF1ZXJpZWQNCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBhdCBgX2Jsb2NrTnVtYmVyYA0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAodWludCkgew0KDQogICAgICAgIC8vIElmIHRoZSBgX2Jsb2NrTnVtYmVyYCByZXF1ZXN0ZWQgaXMgYmVmb3JlIHRoZSBnZW5lc2lzIGJsb2NrIGZvciB0aGUNCiAgICAgICAgLy8gIHRoZSB0b2tlbiBiZWluZyBxdWVyaWVkLCB0aGUgdmFsdWUgcmV0dXJuZWQgaXMgMA0KICAgICAgICBpZiAoX2Jsb2NrTnVtYmVyIDwgY3JlYXRpb25CbG9jaykgew0KICAgICAgICAgICAgcmV0dXJuIDA7DQoNCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgYmFsYW5jZSBvZiB0aGUgdG9rZW4gaXMNCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdA0KICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQ0KICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhhdCB0b2tlbiBhcyB0aGlzIGNvbnRhaW5zIGluaXRpYWwgYmFsYW5jZSBvZg0KICAgICAgICAvLyAgdGhpcyB0b2tlbg0KICAgICAgICB9IGVsc2UgaWYgKChiYWxhbmNlc1tfb3duZXJdLmxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgfHwgKGJhbGFuY2VzW19vd25lcl1bMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgew0KICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4uYmFsYW5jZU9mQXQoX293bmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gSGFzIG5vIHBhcmVudA0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdChiYWxhbmNlc1tfb3duZXJdLCBfYmxvY2tOdW1iZXIpOw0KICAgICAgICB9DQoNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAuDQogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkDQogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYF9ibG9ja051bWJlcmANCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseUF0KHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsNCg0KICAgICAgICAvLyBJZiB0aGUgYF9ibG9ja051bWJlcmAgcmVxdWVzdGVkIGlzIGJlZm9yZSB0aGUgZ2VuZXNpcyBibG9jayBmb3IgdGhlDQogICAgICAgIC8vICB0aGUgdG9rZW4gYmVpbmcgcXVlcmllZCwgdGhlIHZhbHVlIHJldHVybmVkIGlzIDANCiAgICAgICAgaWYgKF9ibG9ja051bWJlciA8IGNyZWF0aW9uQmxvY2spIHsNCiAgICAgICAgICAgIHJldHVybiAwOw0KDQogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIHRvdGFsU3VwcGx5IG9mIHRoZSB0b2tlbiBpcw0KICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0DQogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdGAgYmUgcXVlcmllZCBhdCB0aGUNCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoaXMgdG9rZW4gYXMgdGhhdCBjb250YWlucyB0b3RhbFN1cHBseSBvZiB0aGlzDQogICAgICAgIC8vICB0b2tlbiBhdCB0aGlzIGJsb2NrIG51bWJlci4NCiAgICAgICAgfSBlbHNlIGlmICgodG90YWxTdXBwbHlIaXN0b3J5Lmxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgfHwgKHRvdGFsU3VwcGx5SGlzdG9yeVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7DQogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0KHBhcmVudFNuYXBTaG90QmxvY2spOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCB0b3RhbFN1cHBseSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgX2Jsb2NrTnVtYmVyKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gQ2xvbmUgVG9rZW4gTWV0aG9kDQovLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgbmV3IGNsb25lIHRva2VuIHdpdGggdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIGJlaW5nDQogICAgLy8vICB0aGlzIHRva2VuIGF0IGBfc25hcHNob3RCbG9ja2ANCiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuTmFtZSBOYW1lIG9mIHRoZSBjbG9uZSB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX2Nsb25lRGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdA0KICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5TeW1ib2wgU3ltYm9sIG9mIHRoZSBjbG9uZSB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgd2hlbiB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBwYXJlbnQgdG9rZW4gaXMNCiAgICAvLy8gIGNvcGllZCB0byBzZXQgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBuZXcgY2xvbmUgdG9rZW47DQogICAgLy8vICBpZiB0aGUgYmxvY2sgaXMgaGlnaGVyIHRoYW4gdGhlIGFjdHVhbCBibG9jaywgdGhlIGN1cnJlbnQgYmxvY2sgaXMgdXNlZA0KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lDQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBNaW5pTWVUb2tlbiBDb250cmFjdA0KICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oDQogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlbk5hbWUsDQogICAgICAgIHVpbnQ4IF9jbG9uZURlY2ltYWxVbml0cywNCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuU3ltYm9sLA0KICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLA0KICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkDQogICAgICAgICkgcmV0dXJucyhhZGRyZXNzKSB7DQogICAgICAgIGlmIChfc25hcHNob3RCbG9jayA+IGJsb2NrLm51bWJlcikgX3NuYXBzaG90QmxvY2sgPSBibG9jay5udW1iZXI7DQogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigNCiAgICAgICAgICAgIHRoaXMsDQogICAgICAgICAgICBfc25hcHNob3RCbG9jaywNCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwNCiAgICAgICAgICAgIF9jbG9uZURlY2ltYWxVbml0cywNCiAgICAgICAgICAgIF9jbG9uZVRva2VuU3ltYm9sLA0KICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQNCiAgICAgICAgICAgICk7DQoNCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOw0KDQogICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRva2VuIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbg0KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsNCiAgICAgICAgcmV0dXJuIGFkZHJlc3MoY2xvbmVUb2tlbik7DQogICAgfQ0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBHZW5lcmF0ZSBhbmQgZGVzdHJveSB0b2tlbnMNCi8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIEdlbmVyYXRlcyBgX2Ftb3VudGAgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIGBfb3duZXJgDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgZ2VuZXJhdGVkDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBnZW5lcmF0ZWQgY29ycmVjdGx5DQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudA0KICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGJsb2NrLm51bWJlcik7DQogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIF9hbW91bnQpOw0KICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2YoX293bmVyKTsNCiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOw0KICAgICAgICBUcmFuc2ZlcigwLCBfb3duZXIsIF9hbW91bnQpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCg0KICAgIC8vLyBAbm90aWNlIEJ1cm5zIGBfYW1vdW50YCB0b2tlbnMgZnJvbSBgX293bmVyYA0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBsb3NlIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXJuDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBidXJuZWQgY29ycmVjdGx5DQogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50DQogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7DQogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgYmxvY2subnVtYmVyKTsNCiAgICAgICAgaWYgKGN1clRvdGFsU3VwcGx5IDwgX2Ftb3VudCkgdGhyb3c7DQogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSAtIF9hbW91bnQpOw0KICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZihfb3duZXIpOw0KICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHRocm93Ow0KICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsNCiAgICAgICAgVHJhbnNmZXIoX293bmVyLCAwLCBfYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBFbmFibGUgdG9rZW5zIHRyYW5zZmVycw0KLy8vLy8vLy8vLy8vLy8vLw0KDQoNCiAgICAvLy8gQG5vdGljZSBFbmFibGVzIHRva2VuIGhvbGRlcnMgdG8gdHJhbnNmZXIgdGhlaXIgdG9rZW5zIGZyZWVseSBpZiB0cnVlDQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUNCiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgb25seUNvbnRyb2xsZXIgew0KICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7DQogICAgfQ0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBJbnRlcm5hbCBoZWxwZXIgZnVuY3Rpb25zIHRvIHF1ZXJ5IGFuZCBzZXQgYSB2YWx1ZSBpbiBhIHNuYXBzaG90IGFycmF5DQovLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQGRldiBgZ2V0VmFsdWVBdGAgcmV0cmlldmVzIHRoZSBudW1iZXIgb2YgdG9rZW5zIGF0IGEgZ2l2ZW4gYmxvY2sgbnVtYmVyDQogICAgLy8vIEBwYXJhbSBjaGVja3BvaW50cyBUaGUgaGlzdG9yeSBvZiB2YWx1ZXMgYmVpbmcgcXVlcmllZA0KICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0DQogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiB0b2tlbnMgYmVpbmcgcXVlcmllZA0KICAgIGZ1bmN0aW9uIGdldFZhbHVlQXQoQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX2Jsb2NrDQogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIGlmIChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkgcmV0dXJuIDA7DQoNCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBhY3R1YWwgdmFsdWUNCiAgICAgICAgaWYgKF9ibG9jayA+PSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0uZnJvbUJsb2NrKQ0KICAgICAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS52YWx1ZTsNCiAgICAgICAgaWYgKF9ibG9jayA8IGNoZWNrcG9pbnRzWzBdLmZyb21CbG9jaykgcmV0dXJuIDA7DQoNCiAgICAgICAgLy8gQmluYXJ5IHNlYXJjaCBvZiB0aGUgdmFsdWUgaW4gdGhlIGFycmF5DQogICAgICAgIHVpbnQgbWluID0gMDsNCiAgICAgICAgdWludCBtYXggPSBjaGVja3BvaW50cy5sZW5ndGgtMTsNCiAgICAgICAgd2hpbGUgKG1heCA+IG1pbikgew0KICAgICAgICAgICAgdWludCBtaWQgPSAobWF4ICsgbWluICsgMSkvIDI7DQogICAgICAgICAgICBpZiAoY2hlY2twb2ludHNbbWlkXS5mcm9tQmxvY2s8PV9ibG9jaykgew0KICAgICAgICAgICAgICAgIG1pbiA9IG1pZDsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbWF4ID0gbWlkLTE7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW21pbl0udmFsdWU7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgYHVwZGF0ZVZhbHVlQXROb3dgIHVzZWQgdG8gdXBkYXRlIHRoZSBgYmFsYW5jZXNgIG1hcCBhbmQgdGhlDQogICAgLy8vICBgdG90YWxTdXBwbHlIaXN0b3J5YA0KICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgZGF0YSBiZWluZyB1cGRhdGVkDQogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIG5ldyBudW1iZXIgb2YgdG9rZW5zDQogICAgZnVuY3Rpb24gdXBkYXRlVmFsdWVBdE5vdyhDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfdmFsdWUNCiAgICApIGludGVybmFsICB7DQogICAgICAgIGlmICgoY2hlY2twb2ludHMubGVuZ3RoID09IDApDQogICAgICAgIHx8IChjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGggLTFdLmZyb21CbG9jayA8IGJsb2NrLm51bWJlcikpIHsNCiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgbmV3Q2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzWyBjaGVja3BvaW50cy5sZW5ndGgrKyBdOw0KICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC5mcm9tQmxvY2sgPSAgdWludDEyOChibG9jay5udW1iZXIpOw0KICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsNCiAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsNCiAgICAgICAgICAgICAgIG9sZENoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7DQogICAgICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBkZXRlcm1pbmUgaWYgYW4gYWRkcmVzcyBpcyBhIGNvbnRyYWN0DQogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QNCiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMoYm9vbCkgew0KICAgICAgICB1aW50IHNpemU7DQogICAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHNpemU+MDsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuDQogICAgLy8vICBzZXQgdG8gMCwgdGhlbiB0aGUgYHByb3h5UGF5bWVudGAgbWV0aG9kIGlzIGNhbGxlZCB3aGljaCByZWxheXMgdGhlDQogICAgLy8vICBldGhlciBhbmQgY3JlYXRlcyB0b2tlbnMgYXMgZGVzY3JpYmVkIGluIHRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gKCkgIHBheWFibGUgew0KICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgew0KICAgICAgICAgICAgaWYgKCEgVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKQ0KICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICB9DQoNCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gRXZlbnRzDQovLy8vLy8vLy8vLy8vLy8vDQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF9hbW91bnQpOw0KICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsNCiAgICBldmVudCBBcHByb3ZhbCgNCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9vd25lciwNCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLA0KICAgICAgICB1aW50MjU2IF9hbW91bnQNCiAgICAgICAgKTsNCg0KfQ0KDQoNCi8vLy8vLy8vLy8vLy8vLy8NCi8vIE1pbmlNZVRva2VuRmFjdG9yeQ0KLy8vLy8vLy8vLy8vLy8vLw0KDQovLy8gQGRldiBUaGlzIGNvbnRyYWN0IGlzIHVzZWQgdG8gZ2VuZXJhdGUgY2xvbmUgY29udHJhY3RzIGZyb20gYSBjb250cmFjdC4NCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUNCi8vLyAgc2FtZSBjbGFzcw0KY29udHJhY3QgTWluaU1lVG9rZW5GYWN0b3J5IHsNCg0KICAgIC8vLyBAbm90aWNlIFVwZGF0ZSB0aGUgREFwcCBieSBjcmVhdGluZyBhIG5ldyB0b2tlbiB3aXRoIG5ldyBmdW5jdGlvbmFsaXRpZXMNCiAgICAvLy8gIHRoZSBtc2cuc2VuZGVyIGJlY29tZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjbG9uZSB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZA0KICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgb2YgdGhlIHBhcmVudCB0b2tlbiB0aGF0IHdpbGwNCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuDQogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgdG9rZW4gY29udHJhY3QNCiAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKA0KICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwNCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywNCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsDQogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsDQogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsDQogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQNCiAgICApIHJldHVybnMgKE1pbmlNZVRva2VuKSB7DQogICAgICAgIE1pbmlNZVRva2VuIG5ld1Rva2VuID0gbmV3IE1pbmlNZVRva2VuKA0KICAgICAgICAgICAgdGhpcywNCiAgICAgICAgICAgIF9wYXJlbnRUb2tlbiwNCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLA0KICAgICAgICAgICAgX3Rva2VuTmFtZSwNCiAgICAgICAgICAgIF9kZWNpbWFsVW5pdHMsDQogICAgICAgICAgICBfdG9rZW5TeW1ib2wsDQogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZA0KICAgICAgICAgICAgKTsNCg0KICAgICAgICBuZXdUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOw0KICAgICAgICByZXR1cm4gbmV3VG9rZW47DQogICAgfQ0KfQ0KDQoNCi8vLyBAZGV2IGBPd25lZGAgaXMgYSBiYXNlIGxldmVsIGNvbnRyYWN0IHRoYXQgYXNzaWducyBhbiBgb3duZXJgIHRoYXQgY2FuIGJlDQovLy8gIGxhdGVyIGNoYW5nZWQNCmNvbnRyYWN0IE93bmVkIHsNCiAgICAvLy8gQGRldiBgb3duZXJgIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbCBhIGZ1bmN0aW9uIHdpdGggdGhpcw0KICAgIC8vLyBtb2RpZmllcg0KICAgIG1vZGlmaWVyIG9ubHlPd25lciB7IGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsgXzsgfQ0KDQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCiAgICAvLy8gQG5vdGljZSBUaGUgQ29uc3RydWN0b3IgYXNzaWducyB0aGUgbWVzc2FnZSBzZW5kZXIgdG8gYmUgYG93bmVyYA0KICAgIGZ1bmN0aW9uIE93bmVkKCkgeyBvd25lciA9IG1zZy5zZW5kZXI7fQ0KDQogICAgLy8vIEBub3RpY2UgYG93bmVyYCBjYW4gc3RlcCBkb3duIGFuZCBhc3NpZ24gc29tZSBvdGhlciBhZGRyZXNzIHRvIHRoaXMgcm9sZQ0KICAgIC8vLyBAcGFyYW0gX25ld093bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgb3duZXIuIDB4MCBjYW4gYmUgdXNlZCB0byBjcmVhdGUNCiAgICAvLy8gIGFuIHVub3duZWQgbmV1dHJhbCB2YXVsdCwgaG93ZXZlciB0aGF0IGNhbm5vdCBiZSB1bmRvbmUNCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsNCiAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7DQogICAgfQ0KfQ0KDQoNCi8vLyBAZGV2IFRoaXMgaXMgZGVzaWduZWQgdG8gY29udHJvbCB0aGUgaXNzdWFuY2Ugb2YgYSBNaW5pTWUgVG9rZW4gZm9yIGENCi8vLyAgbm9uLXByb2ZpdCBDYW1wYWlnbi4gVGhpcyBjb250cmFjdCBlZmZlY3RpdmVseSBkaWN0YXRlcyB0aGUgdGVybXMgb2YgdGhlDQovLy8gIGZ1bmRpbmcgcm91bmQuDQoNCmNvbnRyYWN0IENhbXBhaWduIGlzIFRva2VuQ29udHJvbGxlciwgT3duZWQgew0KDQogICAgdWludCBwdWJsaWMgc3RhcnRGdW5kaW5nVGltZTsgICAgICAgLy8gSW4gVU5JWCBUaW1lIEZvcm1hdA0KICAgIHVpbnQgcHVibGljIGVuZEZ1bmRpbmdUaW1lOyAgICAgICAgIC8vIEluIFVOSVggVGltZSBGb3JtYXQNCiAgICB1aW50IHB1YmxpYyBtYXhpbXVtRnVuZGluZzsgICAgICAgICAvLyBJbiB3ZWkNCiAgICB1aW50IHB1YmxpYyB0b3RhbENvbGxlY3RlZDsgICAgICAgICAvLyBJbiB3ZWkNCiAgICBNaW5pTWVUb2tlbiBwdWJsaWMgdG9rZW5Db250cmFjdDsgICAvLyBUaGUgbmV3IHRva2VuIGZvciB0aGlzIENhbXBhaWduDQogICAgYWRkcmVzcyBwdWJsaWMgdmF1bHRBZGRyZXNzOyAgICAgICAgLy8gVGhlIGFkZHJlc3MgdG8gaG9sZCB0aGUgZnVuZHMgZG9uYXRlZA0KDQovLy8gQG5vdGljZSAnQ2FtcGFpZ24oKScgaW5pdGlhdGVzIHRoZSBDYW1wYWlnbiBieSBzZXR0aW5nIGl0cyBmdW5kaW5nDQovLy8gcGFyYW1ldGVycw0KLy8vIEBkZXYgVGhlcmUgYXJlIHNldmVyYWwgY2hlY2tzIHRvIG1ha2Ugc3VyZSB0aGUgcGFyYW1ldGVycyBhcmUgYWNjZXB0YWJsZQ0KLy8vIEBwYXJhbSBfc3RhcnRGdW5kaW5nVGltZSBUaGUgVU5JWCB0aW1lIHRoYXQgdGhlIENhbXBhaWduIHdpbGwgYmUgYWJsZSB0bw0KLy8vIHN0YXJ0IHJlY2VpdmluZyBmdW5kcw0KLy8vIEBwYXJhbSBfZW5kRnVuZGluZ1RpbWUgVGhlIFVOSVggdGltZSB0aGF0IHRoZSBDYW1wYWlnbiB3aWxsIHN0b3AgYmVpbmcgYWJsZQ0KLy8vIHRvIHJlY2VpdmUgZnVuZHMNCi8vLyBAcGFyYW0gX21heGltdW1GdW5kaW5nIEluIHdlaSwgdGhlIE1heGltdW0gYW1vdW50IHRoYXQgdGhlIENhbXBhaWduIGNhbg0KLy8vIHJlY2VpdmUgKGN1cnJlbnRseSB0aGUgbWF4IGlzIHNldCBhdCAxMCwwMDAgRVRIIGZvciB0aGUgYmV0YSkNCi8vLyBAcGFyYW0gX3ZhdWx0QWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgc3RvcmUgdGhlIGRvbmF0ZWQgZnVuZHMNCi8vLyBAcGFyYW0gX3Rva2VuQWRkcmVzcyBBZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGlzIGNvbnRyYWN0IGNvbnRyb2xzDQoNCiAgICBmdW5jdGlvbiBDYW1wYWlnbigNCiAgICAgICAgdWludCBfc3RhcnRGdW5kaW5nVGltZSwNCiAgICAgICAgdWludCBfZW5kRnVuZGluZ1RpbWUsDQogICAgICAgIHVpbnQgX21heGltdW1GdW5kaW5nLA0KICAgICAgICBhZGRyZXNzIF92YXVsdEFkZHJlc3MsDQogICAgICAgIGFkZHJlc3MgX3Rva2VuQWRkcmVzcw0KDQogICAgKSB7DQogICAgICAgIGlmICgoX2VuZEZ1bmRpbmdUaW1lIDwgbm93KSB8fCAgICAgICAgICAgICAgICAvLyBDYW5ub3QgZW5kIGluIHRoZSBwYXN0DQogICAgICAgICAgICAoX2VuZEZ1bmRpbmdUaW1lIDw9IF9zdGFydEZ1bmRpbmdUaW1lKSB8fA0KICAgICAgICAgICAgKF9tYXhpbXVtRnVuZGluZyA+IDEwMDAwIGV0aGVyKSB8fCAgICAgICAgLy8gVGhlIEJldGEgaXMgbGltaXRlZA0KICAgICAgICAgICAgKF92YXVsdEFkZHJlc3MgPT0gMCkpICAgICAgICAgICAgICAgICAgICAgLy8gVG8gcHJldmVudCBidXJuaW5nIEVUSA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICB9DQogICAgICAgIHN0YXJ0RnVuZGluZ1RpbWUgPSBfc3RhcnRGdW5kaW5nVGltZTsNCiAgICAgICAgZW5kRnVuZGluZ1RpbWUgPSBfZW5kRnVuZGluZ1RpbWU7DQogICAgICAgIG1heGltdW1GdW5kaW5nID0gX21heGltdW1GdW5kaW5nOw0KICAgICAgICB0b2tlbkNvbnRyYWN0ID0gTWluaU1lVG9rZW4oX3Rva2VuQWRkcmVzcyk7Ly8gVGhlIERlcGxveWVkIFRva2VuIENvbnRyYWN0DQogICAgICAgIHZhdWx0QWRkcmVzcyA9IF92YXVsdEFkZHJlc3M7DQogICAgfQ0KDQovLy8gQGRldiBUaGUgZmFsbGJhY2sgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gZXRoZXIgaXMgc2VudCB0byB0aGUgY29udHJhY3QsIGl0DQovLy8gc2ltcGx5IGNhbGxzIGBkb1BheW1lbnQoKWAgd2l0aCB0aGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIGFzIHRoZQ0KLy8vIGBfb3duZXJgLiBQYXlhYmxlIGlzIGEgcmVxdWlyZWQgc29saWRpdHkgbW9kaWZpZXIgZm9yIGZ1bmN0aW9ucyB0byByZWNlaXZlDQovLy8gZXRoZXIsIHdpdGhvdXQgdGhpcyBtb2RpZmllciBmdW5jdGlvbnMgd2lsbCB0aHJvdyBpZiBldGhlciBpcyBzZW50IHRvIHRoZW0NCg0KICAgIGZ1bmN0aW9uICgpICBwYXlhYmxlIHsNCiAgICAgICAgZG9QYXltZW50KG1zZy5zZW5kZXIpOw0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLy8NCi8vIFRva2VuQ29udHJvbGxlciBpbnRlcmZhY2UNCi8vLy8vLy8vLy8vLy8vLy8vDQoNCi8vLyBAbm90aWNlIGBwcm94eVBheW1lbnQoKWAgYWxsb3dzIHRoZSBjYWxsZXIgdG8gc2VuZCBldGhlciB0byB0aGUgQ2FtcGFpZ24gYW5kDQovLy8gaGF2ZSB0aGUgdG9rZW5zIGNyZWF0ZWQgaW4gYW4gYWRkcmVzcyBvZiB0aGVpciBjaG9vc2luZw0KLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIG5ld2x5IGNyZWF0ZWQgdG9rZW5zDQoNCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKSB7DQogICAgICAgIGRvUGF5bWVudChfb3duZXIpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCi8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdHJhbnNmZXIsIGZvciB0aGlzIENhbXBhaWduIGFsbA0KLy8vICB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgYnkgZGVmYXVsdCBhbmQgbm8gZXh0cmEgbm90aWZpY2F0aW9ucyBhcmUgbmVlZGVkDQovLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyDQovLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyDQovLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXINCi8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXINCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHJldHVybnMoYm9vbCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCi8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsLCBmb3IgdGhpcyBDYW1wYWlnbiBhbGwNCi8vLyAgYXBwcm92YWxzIGFyZSBhbGxvd2VkIGJ5IGRlZmF1bHQgYW5kIG5vIGV4dHJhIG5vdGlmaWNhdGlvbnMgYXJlIG5lZWRlZA0KLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYA0KLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwNCi8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwNCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkNCiAgICAgICAgcmV0dXJucyhib29sKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQoNCi8vLyBAZGV2IGBkb1BheW1lbnQoKWAgaXMgYW4gaW50ZXJuYWwgZnVuY3Rpb24gdGhhdCBzZW5kcyB0aGUgZXRoZXIgdGhhdCB0aGlzDQovLy8gIGNvbnRyYWN0IHJlY2VpdmVzIHRvIHRoZSBgdmF1bHRgIGFuZCBjcmVhdGVzIHRva2VucyBpbiB0aGUgYWRkcmVzcyBvZiB0aGUNCi8vLyAgYF9vd25lcmAgYXNzdW1pbmcgdGhlIENhbXBhaWduIGlzIHN0aWxsIGFjY2VwdGluZyBmdW5kcw0KLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIG5ld2x5IGNyZWF0ZWQgdG9rZW5zDQoNCiAgICBmdW5jdGlvbiBkb1BheW1lbnQoYWRkcmVzcyBfb3duZXIpIGludGVybmFsIHsNCg0KLy8gRmlyc3QgY2hlY2sgdGhhdCB0aGUgQ2FtcGFpZ24gaXMgYWxsb3dlZCB0byByZWNlaXZlIHRoaXMgZG9uYXRpb24NCiAgICAgICAgaWYgKChub3c8c3RhcnRGdW5kaW5nVGltZSkgfHwNCiAgICAgICAgICAgIChub3c+ZW5kRnVuZGluZ1RpbWUpIHx8DQogICAgICAgICAgICAodG9rZW5Db250cmFjdC5jb250cm9sbGVyKCkgPT0gMCkgfHwgICAgICAgICAgIC8vIEV4dHJhIGNoZWNrDQogICAgICAgICAgICAobXNnLnZhbHVlID09IDApIHx8DQogICAgICAgICAgICAodG90YWxDb2xsZWN0ZWQgKyBtc2cudmFsdWUgPiBtYXhpbXVtRnVuZGluZykpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQoNCi8vVHJhY2sgaG93IG11Y2ggdGhlIENhbXBhaWduIGhhcyBjb2xsZWN0ZWQNCiAgICAgICAgdG90YWxDb2xsZWN0ZWQgKz0gbXNnLnZhbHVlOw0KDQovL1NlbmQgdGhlIGV0aGVyIHRvIHRoZSB2YXVsdA0KICAgICAgICBpZiAoIXZhdWx0QWRkcmVzcy5zZW5kKG1zZy52YWx1ZSkpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQoNCi8vIENyZWF0ZXMgYW4gZXF1YWwgYW1vdW50IG9mIHRva2VucyBhcyBldGhlciBzZW50LiBUaGUgbmV3IHRva2VucyBhcmUgY3JlYXRlZA0KLy8gIGluIHRoZSBgX293bmVyYCBhZGRyZXNzDQogICAgICAgIGlmICghdG9rZW5Db250cmFjdC5nZW5lcmF0ZVRva2Vucyhfb3duZXIsIG1zZy52YWx1ZSkpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KLy8vIEBub3RpY2UgYGZpbmFsaXplRnVuZGluZygpYCBlbmRzIHRoZSBDYW1wYWlnbiBieSBjYWxsaW5nIHNldHRpbmcgdGhlDQovLy8gIGNvbnRyb2xsZXIgdG8gMCwgdGhlcmVieSBlbmRpbmcgdGhlIGlzc3VhbmNlIG9mIG5ldyB0b2tlbnMgYW5kIHN0b3BwaW5nIHRoZQ0KLy8vICBDYW1wYWlnbiBmcm9tIHJlY2VpdmluZyBtb3JlIGV0aGVyDQovLy8gQGRldiBgZmluYWxpemVGdW5kaW5nKClgIGNhbiBvbmx5IGJlIGNhbGxlZCBhZnRlciB0aGUgZW5kIG9mIHRoZSBmdW5kaW5nIHBlcmlvZC4NCg0KICAgIGZ1bmN0aW9uIGZpbmFsaXplRnVuZGluZygpIHsNCiAgICAgICAgaWYgKG5vdyA8IGVuZEZ1bmRpbmdUaW1lKSB0aHJvdzsNCiAgICAgICAgdG9rZW5Db250cmFjdC5jaGFuZ2VDb250cm9sbGVyKDApOw0KICAgIH0NCg0KDQovLy8gQG5vdGljZSBgb25seU93bmVyYCBjaGFuZ2VzIHRoZSBsb2NhdGlvbiB0aGF0IGV0aGVyIGlzIHNlbnQNCi8vLyBAcGFyYW0gX25ld1ZhdWx0QWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgZXRoZXIgc2VudCB0byB0aGlzDQovLy8gIENhbXBhaWduDQogICAgZnVuY3Rpb24gc2V0VmF1bHQoYWRkcmVzcyBfbmV3VmF1bHRBZGRyZXNzKSBvbmx5T3duZXIgew0KICAgICAgICB2YXVsdEFkZHJlc3MgPSBfbmV3VmF1bHRBZGRyZXNzOw0KICAgIH0NCg0KfQ=='