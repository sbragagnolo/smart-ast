base 64 content
base64centrallyIssuedToken
	^'LyoNCiAqIEVSQzIwIGludGVyZmFjZQ0KICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMCB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCg0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQoNCg0KDQoNCg0KLyoqDQogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzDQogKi8NCmNvbnRyYWN0IFNhZmVNYXRoIHsNCiAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKiBiOw0KICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBzYWZlRGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPiAwKTsNCiAgICB1aW50IGMgPSBhIC8gYjsNCiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICBhc3NlcnQoYiA8PSBhKTsNCiAgICByZXR1cm4gYSAtIGI7DQogIH0NCg0KICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSArIGI7DQogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgew0KICAgIGlmICghYXNzZXJ0aW9uKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogIH0NCn0NCg0KDQoNCi8qKg0KICogU3RhbmRhcmQgRVJDMjAgdG9rZW4gd2l0aCBTaG9ydCBIYW5kIEF0dGFjayBhbmQgYXBwcm92ZSgpIHJhY2UgY29uZGl0aW9uIG1pdGlnYXRpb24uDQogKg0KICogQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOg0KICogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sDQogKi8NCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIFNhZmVNYXRoIHsNCg0KICAvKiBBY3R1YWwgYmFsYW5jZXMgb2YgdG9rZW4gaG9sZGVycyAqLw0KICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7DQoNCiAgLyogYXBwcm92ZSgpIGFsbG93YW5jZXMgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOw0KDQogIC8qIEludGVyZmFjZSBkZWNsYXJhdGlvbiAqLw0KICBmdW5jdGlvbiBpc1Rva2VuKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgd2VBcmUpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOw0KICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7DQogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgdWludCBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07DQoNCiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOw0KICAgIGJhbGFuY2VzW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZXNbX2Zyb21dLCBfdmFsdWUpOw0KICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihfYWxsb3dhbmNlLCBfdmFsdWUpOw0KICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgew0KICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOw0KICB9DQoNCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQoNCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYA0KICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90DQogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6DQogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5DQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsNCg0KICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgew0KICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICB9DQoNCn0NCg0KDQovKioNCiAqIFVwZ3JhZGUgYWdlbnQgaW50ZXJmYWNlIGluc3BpcmVkIGJ5IEx1bnlyLg0KICoNCiAqIFVwZ3JhZGUgYWdlbnQgdHJhbnNmZXJzIHRva2VucyB0byBhIG5ldyB2ZXJzaW9uIG9mIGEgdG9rZW4gY29udHJhY3QuDQogKiBVcGdyYWRlIGFnZW50IGNhbiBiZSBzZXQgb24gYSB0b2tlbiBieSB0aGUgdXBncmFkZSBtYXN0ZXIuDQogKg0KICogU3RlcHMgYXJlDQogKiAtIFVwZ3JhZGVhYmxldG9rZW4udXBncmFkZU1hc3RlciBjYWxscyBVcGdyYWRlYWJsZVRva2VuLnNldFVwZ3JhZGVBZ2VudCgpDQogKiAtIEluZGl2aWR1YWwgdG9rZW4gaG9sZGVycyBjYW4gbm93IGNhbGwgVXBncmFkZWFibGVUb2tlbi51cGdyYWRlKCkNCiAqICAgLT4gVGhpcyByZXN1bHRzIHRvIGNhbGwgVXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKCkgdGhhdCBpc3N1ZXMgbmV3IHRva2Vucw0KICogICAtPiBVcGdyYWRlYWJsZVRva2VuLnVwZ3JhZGUoKSByZWR1Y2VzIHRoZSBvcmlnaW5hbCB0b3RhbCBzdXBwbHkgYmFzZWQgb24gYW1vdW50IG9mIHVwZ3JhZGVkIHRva2Vucw0KICoNCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLg0KICovDQpjb250cmFjdCBVcGdyYWRlQWdlbnQgew0KDQogIHVpbnQgcHVibGljIG9yaWdpbmFsU3VwcGx5Ow0KDQogIC8qKiBJbnRlcmZhY2UgbWFya2VyICovDQogIGZ1bmN0aW9uIGlzVXBncmFkZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBVcGdyYWRlIGFtb3VudCBvZiB0b2tlbnMgdG8gYSBuZXcgdmVyc2lvbi4NCiAgICoNCiAgICogT25seSBjYWxsYWJsZSBieSBVcGdyYWRlYWJsZVRva2VuLg0KICAgKg0KICAgKiBAcGFyYW0gX3Rva2VuSG9sZGVyIEFkZHJlc3MgdGhhdCB3YW50cyB0byB1cGdyYWRlIGl0cyB0b2tlbnMNCiAgICogQHBhcmFtIF9hbW91bnQgTnVtYmVyIG9mIHRva2VucyB0byB1cGdyYWRlLiBUaGUgYWRkcmVzcyBtYXkgY29uc2lkZXIgdG8gaG9sZCBiYWNrIHNvbWUgYW1vdW50IG9mIHRva2VucyBpbiB0aGUgb2xkIHZlcnNpb24uDQogICAqLw0KICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF90b2tlbkhvbGRlciwgdWludDI1NiBfYW1vdW50KSBleHRlcm5hbDsNCn0NCg0KDQovKioNCiAqIEEgdG9rZW4gdXBncmFkZSBtZWNoYW5pc20gd2hlcmUgdXNlcnMgY2FuIG9wdC1pbiBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBuZXh0IHNtYXJ0IGNvbnRyYWN0IHJldmlzaW9uLg0KICoNCiAqIEZpcnN0IGVudmlzaW9uZWQgYnkgR29sZW0gYW5kIEx1bnlyIHByb2plY3RzLg0KICovDQpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gew0KDQogIC8qKiBDb250cmFjdCAvIHBlcnNvbiB3aG8gY2FuIHNldCB0aGUgdXBncmFkZSBwYXRoLiBUaGlzIGNhbiBiZSB0aGUgc2FtZSBhcyB0ZWFtIG11bHRpc2lnIHdhbGxldCwgYXMgd2hhdCBpdCBpcyB3aXRoIGl0cyBkZWZhdWx0IHZhbHVlLiAqLw0KICBhZGRyZXNzIHB1YmxpYyB1cGdyYWRlTWFzdGVyOw0KDQogIC8qKiBUaGUgbmV4dCBjb250cmFjdCB3aGVyZSB0aGUgdG9rZW5zIHdpbGwgYmUgbWlncmF0ZWQuICovDQogIFVwZ3JhZGVBZ2VudCBwdWJsaWMgdXBncmFkZUFnZW50Ow0KDQogIC8qKiBIb3cgbWFueSB0b2tlbnMgd2UgaGF2ZSB1cGdyYWRlZCBieSBub3cuICovDQogIHVpbnQyNTYgcHVibGljIHRvdGFsVXBncmFkZWQ7DQoNCiAgLyoqDQogICAqIFVwZ3JhZGUgc3RhdGVzLg0KICAgKg0KICAgKiAtIE5vdEFsbG93ZWQ6IFRoZSBjaGlsZCBjb250cmFjdCBoYXMgbm90IHJlYWNoZWQgYSBjb25kaXRpb24gd2hlcmUgdGhlIHVwZ3JhZGUgY2FuIGJndW4NCiAgICogLSBXYWl0aW5nRm9yQWdlbnQ6IFRva2VuIGFsbG93cyB1cGdyYWRlLCBidXQgd2UgZG9uJ3QgaGF2ZSBhIG5ldyBhZ2VudCB5ZXQNCiAgICogLSBSZWFkeVRvVXBncmFkZTogVGhlIGFnZW50IGlzIHNldCwgYnV0IG5vdCBhIHNpbmdsZSB0b2tlbiBoYXMgYmVlbiB1cGdyYWRlZCB5ZXQNCiAgICogLSBVcGdyYWRpbmc6IFVwZ3JhZGUgYWdlbnQgaXMgc2V0IGFuZCB0aGUgYmFsYW5jZSBob2xkZXJzIGNhbiB1cGdyYWRlIHRoZWlyIHRva2Vucw0KICAgKg0KICAgKi8NCiAgZW51bSBVcGdyYWRlU3RhdGUge1Vua25vd24sIE5vdEFsbG93ZWQsIFdhaXRpbmdGb3JBZ2VudCwgUmVhZHlUb1VwZ3JhZGUsIFVwZ3JhZGluZ30NCg0KICAvKioNCiAgICogU29tZWJvZHkgaGFzIHVwZ3JhZGVkIHNvbWUgb2YgaGlzIHRva2Vucy4NCiAgICovDQogIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7DQoNCiAgLyoqDQogICAqIE5ldyB1cGdyYWRlIGFnZW50IGF2YWlsYWJsZS4NCiAgICovDQogIGV2ZW50IFVwZ3JhZGVBZ2VudFNldChhZGRyZXNzIGFnZW50KTsNCg0KICAvKioNCiAgICogVXBncmFkZSBtYXN0ZXIgdXBkYXRlZC4NCiAgICovDQogIGV2ZW50IE5ld1VwZ3JhZGVNYXN0ZXIoYWRkcmVzcyB1cGdyYWRlTWFzdGVyKTsNCg0KICAvKioNCiAgICogRG8gbm90IGFsbG93IGNvbnN0cnVjdGlvbiB3aXRob3V0IHVwZ3JhZGUgbWFzdGVyIHNldC4NCiAgICovDQogIGZ1bmN0aW9uIFVwZ3JhZGVhYmxlVG9rZW4oYWRkcmVzcyBfdXBncmFkZU1hc3Rlcikgew0KICAgIHVwZ3JhZGVNYXN0ZXIgPSBfdXBncmFkZU1hc3RlcjsNCiAgICBOZXdVcGdyYWRlTWFzdGVyKHVwZ3JhZGVNYXN0ZXIpOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4NCiAgICovDQogIGZ1bmN0aW9uIHVwZ3JhZGUodWludDI1NiB2YWx1ZSkgcHVibGljIHsNCg0KICAgICAgVXBncmFkZVN0YXRlIHN0YXRlID0gZ2V0VXBncmFkZVN0YXRlKCk7DQogICAgICBpZighKHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5SZWFkeVRvVXBncmFkZSB8fCBzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuVXBncmFkaW5nKSkgew0KICAgICAgICAvLyBDYWxsZWQgaW4gYSBiYWQgc3RhdGUNCiAgICAgICAgdGhyb3c7DQogICAgICB9DQoNCiAgICAgIC8vIFZhbGlkYXRlIGlucHV0IHZhbHVlLg0KICAgICAgaWYgKHZhbHVlID09IDApIHRocm93Ow0KDQogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIHZhbHVlKTsNCg0KICAgICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24NCiAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSwgdmFsdWUpOw0KICAgICAgdG90YWxVcGdyYWRlZCA9IHNhZmVBZGQodG90YWxVcGdyYWRlZCwgdmFsdWUpOw0KDQogICAgICAvLyBVcGdyYWRlIGFnZW50IHJlaXNzdWVzIHRoZSB0b2tlbnMNCiAgICAgIHVwZ3JhZGVBZ2VudC51cGdyYWRlRnJvbShtc2cuc2VuZGVyLCB2YWx1ZSk7DQogICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIFNldCBhbiB1cGdyYWRlIGFnZW50IHRoYXQgaGFuZGxlcw0KICAgKi8NCiAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgYWdlbnQpIGV4dGVybmFsIHsNCg0KICAgICAgaWYoIWNhblVwZ3JhZGUoKSkgew0KICAgICAgICAvLyBUaGUgdG9rZW4gaXMgbm90IHlldCBpbiBhIHN0YXRlIHRoYXQgd2UgY291bGQgdGhpbmsgdXBncmFkaW5nDQogICAgICAgIHRocm93Ow0KICAgICAgfQ0KDQogICAgICBpZiAoYWdlbnQgPT0gMHgwKSB0aHJvdzsNCiAgICAgIC8vIE9ubHkgYSBtYXN0ZXIgY2FuIGRlc2lnbmF0ZSB0aGUgbmV4dCBhZ2VudA0KICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdXBncmFkZU1hc3RlcikgdGhyb3c7DQogICAgICAvLyBVcGdyYWRlIGhhcyBhbHJlYWR5IGJlZ3VuIGZvciBhbiBhZ2VudA0KICAgICAgaWYgKGdldFVwZ3JhZGVTdGF0ZSgpID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpIHRocm93Ow0KDQogICAgICB1cGdyYWRlQWdlbnQgPSBVcGdyYWRlQWdlbnQoYWdlbnQpOw0KDQogICAgICAvLyBCYWQgaW50ZXJmYWNlDQogICAgICBpZighdXBncmFkZUFnZW50LmlzVXBncmFkZUFnZW50KCkpIHRocm93Ow0KICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdG9rZW4gc3VwcGxpZXMgbWF0Y2ggaW4gc291cmNlIGFuZCB0YXJnZXQNCiAgICAgIGlmICh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSAhPSB0b3RhbFN1cHBseSkgdGhyb3c7DQoNCiAgICAgIFVwZ3JhZGVBZ2VudFNldCh1cGdyYWRlQWdlbnQpOw0KICB9DQoNCiAgLyoqDQogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuDQogICAqLw0KICBmdW5jdGlvbiBnZXRVcGdyYWRlU3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhVcGdyYWRlU3RhdGUpIHsNCiAgICBpZighY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7DQogICAgZWxzZSBpZihhZGRyZXNzKHVwZ3JhZGVBZ2VudCkgPT0gMHgwMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5XYWl0aW5nRm9yQWdlbnQ7DQogICAgZWxzZSBpZih0b3RhbFVwZ3JhZGVkID09IDApIHJldHVybiBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGU7DQogICAgZWxzZSByZXR1cm4gVXBncmFkZVN0YXRlLlVwZ3JhZGluZzsNCiAgfQ0KDQogIC8qKg0KICAgKiBDaGFuZ2UgdGhlIHVwZ3JhZGUgbWFzdGVyLg0KICAgKg0KICAgKiBUaGlzIGFsbG93cyB1cyB0byBzZXQgYSBuZXcgb3duZXIgZm9yIHRoZSB1cGdyYWRlIG1lY2hhbmlzbS4NCiAgICovDQogIGZ1bmN0aW9uIHNldFVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBtYXN0ZXIpIHB1YmxpYyB7DQogICAgICBpZiAobWFzdGVyID09IDB4MCkgdGhyb3c7DQogICAgICBpZiAobXNnLnNlbmRlciAhPSB1cGdyYWRlTWFzdGVyKSB0aHJvdzsNCiAgICAgIHVwZ3JhZGVNYXN0ZXIgPSBtYXN0ZXI7DQogICAgICBOZXdVcGdyYWRlTWFzdGVyKHVwZ3JhZGVNYXN0ZXIpOw0KICB9DQoNCiAgLyoqDQogICAqIENoaWxkIGNvbnRyYWN0IGNhbiBlbmFibGUgdG8gcHJvdmlkZSB0aGUgY29uZGl0aW9uIHdoZW4gdGhlIHVwZ3JhZGUgY2FuIGJlZ3VuLg0KICAgKi8NCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsNCiAgICAgcmV0dXJuIHRydWU7DQogIH0NCg0KfQ0KDQoNCg0KLyoqDQogKiBDZW50cmFsbHkgaXNzdWVkIEV0aGVyZXVtIHRva2VuLg0KICoNCiAqIFdlIG1peCBpbiBidXJuYWJsZSBhbmQgdXBncmFkZWFibGUgdHJhaXRzLg0KICoNCiAqIFRva2VuIHN1cHBseSBpcyBjcmVhdGVkIGluIHRoZSB0b2tlbiBjb250cmFjdCBjcmVhdGlvbiBhbmQgYWxsb2NhdGVkIHRvIG93bmVyLg0KICogVGhlIG93bmVyIGNhbiB0aGVuIHRyYW5zZmVyIGZyb20gaXRzIHN1cHBseSB0byBjcm93ZHNhbGUgcGFydGljaXBhbnRzLg0KICogVGhlIG93bmVyLCBvciBhbnlib2R5LCBjYW4gYnVybiBhbnkgZXhjZXNzaXZlIHRva2VucyB0aGV5IGFyZSBob2xkaW5nLg0KICoNCiAqLw0KY29udHJhY3QgQ2VudHJhbGx5SXNzdWVkVG9rZW4gaXMgVXBncmFkZWFibGVUb2tlbiB7DQoNCiAgc3RyaW5nIHB1YmxpYyBuYW1lOw0KICBzdHJpbmcgcHVibGljIHN5bWJvbDsNCiAgdWludCBwdWJsaWMgZGVjaW1hbHM7DQoNCiAgLyoqIE5hbWUgYW5kIHN5bWJvbCB3ZXJlIHVwZGF0ZWQuICovDQogIGV2ZW50IFVwZGF0ZWRUb2tlbkluZm9ybWF0aW9uKHN0cmluZyBuZXdOYW1lLCBzdHJpbmcgbmV3U3ltYm9sKTsNCg0KICBmdW5jdGlvbiBDZW50cmFsbHlJc3N1ZWRUb2tlbihhZGRyZXNzIF9vd25lciwgc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludCBfdG90YWxTdXBwbHksIHVpbnQgX2RlY2ltYWxzKSAgVXBncmFkZWFibGVUb2tlbihfb3duZXIpIHsNCiAgICBuYW1lID0gX25hbWU7DQogICAgc3ltYm9sID0gX3N5bWJvbDsNCiAgICB0b3RhbFN1cHBseSA9IF90b3RhbFN1cHBseTsNCiAgICBkZWNpbWFscyA9IF9kZWNpbWFsczsNCg0KICAgIC8vIEFsbG9jYXRlIGluaXRpYWwgYmFsYW5jZSB0byB0aGUgb3duZXINCiAgICBiYWxhbmNlc1tfb3duZXJdID0gX3RvdGFsU3VwcGx5Ow0KICB9DQoNCiAgLyoqDQogICAqIE93bmVyIGNhbiB1cGRhdGUgdG9rZW4gaW5mb3JtYXRpb24gaGVyZS4NCiAgICoNCiAgICogSXQgaXMgb2Z0ZW4gdXNlZnVsIHRvIGNvbmNlYWwgdGhlIGFjdHVhbCB0b2tlbiBhc3NvY2lhdGlvbiwgdW50aWwNCiAgICogdGhlIHRva2VuIG9wZXJhdGlvbnMsIGxpa2UgY2VudHJhbCBpc3N1YW5jZSBvciByZWlzc3VhbmNlIGhhdmUgYmVlbiBjb21wbGV0ZWQuDQogICAqIEluIHRoaXMgY2FzZSB0aGUgaW5pdGlhbCB0b2tlbiBjYW4gYmUgc3VwcGxpZWQgd2l0aCBlbXB0eSBuYW1lIGFuZCBzeW1ib2wgaW5mb3JtYXRpb24uDQogICAqDQogICAqIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHRoZSB0b2tlbiBvd25lciB0byByZW5hbWUgdGhlIHRva2VuIGFmdGVyIHRoZSBvcGVyYXRpb25zDQogICAqIGhhdmUgYmVlbiBjb21wbGV0ZWQgYW5kIHRoZW4gcG9pbnQgdGhlIGF1ZGllbmNlIHRvIHVzZSB0aGUgdG9rZW4gY29udHJhY3QuDQogICAqLw0KICBmdW5jdGlvbiBzZXRUb2tlbkluZm9ybWF0aW9uKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wpIHsNCg0KICAgIGlmKG1zZy5zZW5kZXIgIT0gdXBncmFkZU1hc3Rlcikgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYoYnl0ZXMobmFtZSkubGVuZ3RoID4gMCB8fCBieXRlcyhzeW1ib2wpLmxlbmd0aCA+IDApIHsNCiAgICAgIC8vIEluZm9ybWF0aW9uIGFscmVhZHkgc2V0DQogICAgICAvLyBBbGxvdyBvd25lciB0byBzZXQgdGhpcyBpbmZvcm1hdGlvbiBvbmx5IG9uY2UNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIG5hbWUgPSBfbmFtZTsNCiAgICBzeW1ib2wgPSBfc3ltYm9sOw0KICAgIFVwZGF0ZWRUb2tlbkluZm9ybWF0aW9uKG5hbWUsIHN5bWJvbCk7DQogIH0NCg0KfQ=='