base 64 content
base64clusterToken1
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KDQovKioNCiAqIEB0aXRsZSBTYWZlTWF0aA0KICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3INCiAqLw0KbGlicmFyeSBTYWZlTWF0aCB7DQoJZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQoJCXVpbnQgYyA9IGEgKiBiOw0KCQlhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KCQlyZXR1cm4gYzsNCgl9DQoJZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KCQlhc3NlcnQoYiA8PSBhKTsNCgkJcmV0dXJuIGEgLSBiOw0KCX0NCglmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCgkJYXNzZXJ0KGIgPiAwKTsNCgkJdWludCBjID0gYSAvIGI7DQoJCWFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOw0KCQlyZXR1cm4gYzsNCgl9DQoJZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQoJCWFzc2VydChiIDw9IGEpOw0KCQlyZXR1cm4gYSAtIGI7DQoJfQ0KCWZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KCQl1aW50IGMgPSBhICsgYjsNCgkJYXNzZXJ0KGMgPj0gYSk7DQoJCXJldHVybiBjOw0KCX0NCglmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgew0KCQlyZXR1cm4gYSA+PSBiID8gYSA6IGI7DQoJfQ0KCWZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQoJCXJldHVybiBhIDwgYiA/IGEgOiBiOw0KCX0NCglmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCgkJcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KCX0NCglmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCgkJcmV0dXJuIGEgPCBiID8gYSA6IGI7DQoJfQ0KCWZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgew0KCQlpZiAoIWFzc2VydGlvbikgew0KCQkJdGhyb3c7DQoJCX0NCgl9DQp9DQoNCg0KLyoqDQogKiBAdGl0bGUgT3duYWJsZQ0KICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbA0KICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4NCiAqLw0KY29udHJhY3QgT3duYWJsZSB7DQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQogICAgZnVuY3Rpb24gT3duYWJsZSgpIHsNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgIH0NCiAgICBtb2RpZmllciBvbmx5T3duZXIgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7DQogICAgICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7DQogICAgICAgICAgICBvd25lciA9IG5ld093bmVyOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQoNCi8qKg0KICogQHRpdGxlIFBhdXNhYmxlDQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uDQogKi8NCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgew0KCWJvb2wgcHVibGljIHN0b3BwZWQ7DQoJbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsNCgkJaWYgKHN0b3BwZWQpIHsNCgkJCXRocm93Ow0KCQl9DQoJCV87DQoJfQ0KDQoJbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsNCgkJaWYgKCFzdG9wcGVkKSB7DQoJCSAgdGhyb3c7DQoJCX0NCglfOw0KCX0NCgkvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQ0KCWZ1bmN0aW9uIGVtZXJnZW5jeVN0b3AoKSBleHRlcm5hbCBvbmx5T3duZXIgew0KCQlzdG9wcGVkID0gdHJ1ZTsNCgl9DQoJLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQ0KCWZ1bmN0aW9uIHJlbGVhc2UoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsNCgkJc3RvcHBlZCA9IGZhbHNlOw0KCX0NCn0NCg0KDQoNCi8qKg0KICogQHRpdGxlIFB1bGxQYXltZW50DQogKiBAZGV2IEJhc2UgY29udHJhY3Qgc3VwcG9ydGluZyBhc3luYyBzZW5kIGZvciBwdWxsIHBheW1lbnRzLiBJbmhlcml0IGZyb20gdGhpcw0KICogY29udHJhY3QgYW5kIHVzZSBhc3luY1NlbmQgaW5zdGVhZCBvZiBzZW5kLg0KICovDQpjb250cmFjdCBQdWxsUGF5bWVudCB7DQoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7DQoNCgltYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIHBheW1lbnRzOw0KCWV2ZW50IExvZ1JlZnVuZEVUSChhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsNCgkvKioNCgkqICBTdG9yZSBzZW50IGFtb3VudCBhcyBjcmVkaXQgdG8gYmUgcHVsbGVkLCBjYWxsZWQgYnkgcGF5ZXIgDQoJKiovDQoJZnVuY3Rpb24gYXN5bmNTZW5kKGFkZHJlc3MgZGVzdCwgdWludCBhbW91bnQpIGludGVybmFsIHsNCgkJcGF5bWVudHNbZGVzdF0gPSBwYXltZW50c1tkZXN0XS5hZGQoYW1vdW50KTsNCgl9DQoJLy8gd2l0aGRyYXcgYWNjdW11bGF0ZWQgYmFsYW5jZSwgY2FsbGVkIGJ5IHBheWVlDQoJZnVuY3Rpb24gd2l0aGRyYXdQYXltZW50cygpIHsNCgkJYWRkcmVzcyBwYXllZSA9IG1zZy5zZW5kZXI7DQoJCXVpbnQgcGF5bWVudCA9IHBheW1lbnRzW3BheWVlXTsNCg0KCQlpZiAocGF5bWVudCA9PSAwKSB7DQoJCQl0aHJvdzsNCgkJfQ0KCQlpZiAodGhpcy5iYWxhbmNlIDwgcGF5bWVudCkgew0KCQkgICAgdGhyb3c7DQoJCX0NCgkJcGF5bWVudHNbcGF5ZWVdID0gMDsNCgkJaWYgKCFwYXllZS5zZW5kKHBheW1lbnQpKSB7DQoJCSAgICB0aHJvdzsNCgkJfQ0KCQlMb2dSZWZ1bmRFVEgocGF5ZWUscGF5bWVudCk7DQoJfQ0KfQ0KDQoNCg0KLyoqDQogKiBAdGl0bGUgRVJDMjBCYXNpYw0KICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlDQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5DQogKi8NCmNvbnRyYWN0IEVSQzIwQmFzaWMgew0KCXVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7DQoJZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQp9DQoNCg0KLyoqDQogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlDQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqLw0KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7DQoJZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7DQoJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KCWV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQoNCi8qKg0KICogQHRpdGxlIEJhc2ljIHRva2VuDQogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLiANCiAqLw0KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsNCiAgDQoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7DQoNCgltYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7DQoNCgkvKg0KCSogRml4IGZvciB0aGUgRVJDMjAgc2hvcnQgYWRkcmVzcyBhdHRhY2sgIA0KCSovDQoJbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgew0KCSAgIGlmKG1zZy5kYXRhLmxlbmd0aCA8IHNpemUgKyA0KSB7DQoJICAgICB0aHJvdzsNCgkgICB9DQoJIF87DQoJfQ0KCWZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgew0KCQliYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOw0KCQliYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsNCgkJVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KCX0NCglmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgew0KCQlyZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCgl9DQp9DQoNCg0KLyoqDQogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4NCiAqDQogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4NCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sDQogKi8NCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgQmFzaWNUb2tlbiwgRVJDMjAgew0KCW1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsNCglmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMyAqIDMyKSB7DQoJCXZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07DQoJCWJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KCQliYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7DQoJCWFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsNCgkJVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICB9DQoJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgew0KCQlpZiAoKF92YWx1ZSAhPSAwKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0gMCkpIHRocm93Ow0KCQlhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCgkJQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQoJfQ0KCWZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsNCgkJcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQoJfQ0KfQ0KDQoNCi8qKg0KICogIENsdXN0ZXJUb2tlbiBwcmVzYWxlIGNvbnRyYWN0Lg0KICovDQpjb250cmFjdCBDbHVzdGVyVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgUHVsbFBheW1lbnQsIE93bmFibGUsIFBhdXNhYmxlIHsNCgkNCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7DQogIA0KICBzdHJ1Y3QgQmFja2VyIHsNCiAgICAgICAgYWRkcmVzcyBidXllcjsNCiAgICAgICAgdWludCBjb250cmlidXRpb247DQogICAgICAgIHVpbnQgd2l0aGRyYXduQXRTZWdtZW50Ow0KICAgICAgICB1aW50IHdpdGhkcmF3bkF0Q2x1c3RlcjsNCiAgICAgICAgYm9vbCBzdGF0ZTsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogVmFyaWFibGVzDQogICAgKi8NCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiQ2x1c3RlclRva2VuIjsNCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJDTFJUIjsNCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4Ow0KICAgIHVpbnQyNTYgcHJpdmF0ZSBidXlQcmljZUV0aCA9IDEwMDAwMDAwMDAwMDAwMDAwOw0KICAgIA0KICAgIHVpbnQyNTYgcHVibGljIGluaXRpYWxCbG9ja0NvdW50Ow0KICAgIHVpbnQyNTYgcHJpdmF0ZSB0ZXN0QmxvY2tFbmQ7DQogICAgdWludDI1NiBwdWJsaWMgY29udHJpYnV0b3JzOw0KICAgIA0KICAgIHVpbnQyNTYgcHJpdmF0ZSBtaW5lZEJsb2NrczsNCiAgICB1aW50MjU2IHByaXZhdGUgQ2x1c3RlckN1cnJlbnQ7DQogICAgdWludDI1NiBwcml2YXRlIFNlZ21lbnRDdXJyZW50Ow0KICAgIHVpbnQyNTYgcHJpdmF0ZSBVbml0Q3VycmVudDsNCiAgDQogIA0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBCYWNrZXIpIHB1YmxpYyBiYWNrZXJzOw0KICAgIA0KICAgDQogICAgLyoqDQogICAgICogQGRldiBDb250cmFjdCBjb25zdHJ1Y3Rvcg0KICAgICAqLyANCiAgICBmdW5jdGlvbiBDbHVzdGVyVG9rZW4oKSB7DQogICAgdG90YWxTdXBwbHkgPSA3NTAwMDAwMDAwMDAwMDAwMDAwMDA7DQogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSB0b3RhbFN1cHBseTsNCg0KICAgIGNvbnRyaWJ1dG9ycyA9IDA7DQogICAgfQ0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgY3VycmVudCBhbW91bnQgb2YgQ0xVU1RFUlMNCiAgICAgKi8gDQogICAgZnVuY3Rpb24gY3VycmVudENsdXN0ZXIoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGN1cnJlbnRDbHVzdGVyKQ0KICAgIHsNCiAgICAJdWludCBibG9ja0NvdW50ID0gYmxvY2subnVtYmVyIC0gaW5pdGlhbEJsb2NrQ291bnQ7DQogICAgCXVpbnQgcmVzdWx0ID0gYmxvY2tDb3VudC5kaXYoMTAwMDAwMCk7DQogICAgCXJldHVybiByZXN1bHQ7DQogICAgfQ0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgY3VycmVudCBhbW91bnQgb2YgU0VHTUVOVFMNCiAgICAgKi8gDQogICAgZnVuY3Rpb24gY3VycmVudFNlZ21lbnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGN1cnJlbnRTZWdtZW50KQ0KICAgIHsNCiAgICAJdWludCBibG9ja0NvdW50ID0gYmxvY2subnVtYmVyIC0gaW5pdGlhbEJsb2NrQ291bnQ7DQogICAgCXVpbnQgbmV3U2VnbWVudCA9IGN1cnJlbnRDbHVzdGVyKCkubXVsKDEwMDApOw0KICAgIAl1aW50IHJlc3VsdCA9IGJsb2NrQ291bnQuZGl2KDEwMDApLnN1YihuZXdTZWdtZW50KTsNCg0KICAgIAlyZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICANCiAgICANCiAgICAvKioNCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIGN1cnJlbnQgYW1vdW50IG9mIFVOSVRTDQogICAgICovIA0KICAgIGZ1bmN0aW9uIGN1cnJlbnRVbml0KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBjdXJyZW50VW5pdCkNCiAgICB7DQogICAgCXVpbnQgYmxvY2tDb3VudCA9IGJsb2NrLm51bWJlciAtIGluaXRpYWxCbG9ja0NvdW50Ow0KICAgIAl1aW50IGdldENsdXN0ZXJzID0gY3VycmVudENsdXN0ZXIoKS5tdWwoMTAwMDAwMCk7DQogICAgICAgIHVpbnQgbmV3VW5pdCA9IGN1cnJlbnRTZWdtZW50KCkubXVsKDEwMDApOw0KICAgIAlyZXR1cm4gYmxvY2tDb3VudC5zdWIoZ2V0Q2x1c3RlcnMpLnN1YihuZXdVbml0KTsgICAgICANCiAgICAJDQogICAgfQ0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgY3VycmVudCBuZXR3b3JrIGJsb2NrDQogICAgICovIA0KICAgIGZ1bmN0aW9uIGN1cnJlbnRCbG9jaygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmxvY2tOdW1iZXIpDQogICAgew0KICAgIAlyZXR1cm4gYmxvY2subnVtYmVyIC0gaW5pdGlhbEJsb2NrQ291bnQ7DQogICAgfQ0KDQoNCg0KICAgIC8qKg0KICAgICAqIEBkZXYgQWxsb3dzIHVzZXJzIHRvIGJ1eSBDTFVTVEVSIGFuZCByZWNlaXZlIHRoZWlyIHRva2VucyBhdCBvbmNlLg0KICAgICAqIEByZXR1cm4gVGhlIGFtb3VudCBvZiBDTFVTVEVSIGJvdWdodCBieSBzZW5kZXIuDQogICAgICovIA0KICAgIGZ1bmN0aW9uIGJ1eUNsdXN0ZXJUb2tlbigpIHBheWFibGUgcmV0dXJucyAodWludCBhbW91bnQpIHsNCiAgICAgICAgDQogICAgICAgIGlmIChiYWxhbmNlc1t0aGlzXSA8IGFtb3VudCkgdGhyb3c7ICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgYW1vdW50ID0gbXNnLnZhbHVlLm11bChidXlQcmljZUV0aCkuZGl2KDEgZXRoZXIpOw0KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSArPSBhbW91bnQ7DQogICAgICAgIGJhbGFuY2VzW3RoaXNdIC09IGFtb3VudDsNCiAgICAgICAgVHJhbnNmZXIodGhpcywgbXNnLnNlbmRlciwgYW1vdW50KTsNCiAgICAgICAgDQogICAgICAgIEJhY2tlciBiYWNrZXIgPSBiYWNrZXJzW21zZy5zZW5kZXJdOw0KICAgICAgICBiYWNrZXIuY29udHJpYnV0aW9uID0gYmFja2VyLmNvbnRyaWJ1dGlvbi5hZGQoYW1vdW50KTsNCiAgICAgICAgYmFja2VyLndpdGhkcmF3bkF0U2VnbWVudCA9IGJhY2tlci53aXRoZHJhd25BdFNlZ21lbnQuYWRkKDApOw0KICAgICAgICBiYWNrZXIud2l0aGRyYXduQXRDbHVzdGVyID0gYmFja2VyLndpdGhkcmF3bkF0Q2x1c3Rlci5hZGQoMCk7DQogICAgICAgIGJhY2tlci5zdGF0ZSA9IGJhY2tlci5zdGF0ZSA9IHRydWU7DQogICAgICAgIA0KICAgICAgICBjb250cmlidXRvcnMrKzsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBhbW91bnQ7DQogICAgfQ0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIEBkZXYgQWxsb3dzIHVzZXJzIHRvIGNsYWltIENMVVNURVIgZXZlcnkgMTAwMCBTRUdNRU5UUyAoMS4wMDAuMDAwIGJsb2NrcykuDQogICAgICogQHJldHVybiBUaGUgYW1vdW50IG9mIENMVVNURVIgY2xhaW1lZCBieSBzZW5kZXIuDQogICAgICovDQogICAgZnVuY3Rpb24gY2xhaW1DbHVzdGVycygpIHB1YmxpYyByZXR1cm5zICh1aW50IGFtb3VudCkgew0KICAgICAgICANCiAgICAgICAgaWYgKGN1cnJlbnRTZWdtZW50KCkgPT0gMCkgdGhyb3c7DQogICAgICAgIGlmICghYmFja2Vyc1ttc2cuc2VuZGVyXS5zdGF0ZSkgdGhyb3c7IA0KICAgICAgICANCiAgICAgICAgdWludCBwcmV2aW91c1dpdGhkcmF3cyA9IGJhY2tlcnNbbXNnLnNlbmRlcl0ud2l0aGRyYXduQXRDbHVzdGVyOw0KICAgICAgICB1aW50IGVudGl0bGVkVG9DbHVzdGVycyA9IGN1cnJlbnRDbHVzdGVyKCkuc3ViKHByZXZpb3VzV2l0aGRyYXdzKTsNCiAgICAgICAgDQogICAgICAgIGlmIChlbnRpdGxlZFRvQ2x1c3RlcnMgPT0gMCkgdGhyb3c7DQogICAgICAgIGlmICghaXNFbnRpdGxlZEZvckNsdXN0ZXIobXNnLnNlbmRlcikpIHRocm93Ow0KICAgICAgICANCiAgICAgICAgdWludCB1c2VyU2hhcmVzID0gYmFja2Vyc1ttc2cuc2VuZGVyXS5jb250cmlidXRpb24uZGl2KDEgZmlubmV5KTsNCiAgICAgICAgdWludCBhbW91bnRGb3JQYXlvdXQgPSBidXlQcmljZUV0aC5kaXYoY29udHJpYnV0b3JzKTsNCiAgICAgICAgDQogICAgICAgIGFtb3VudCA9ICBhbW91bnRGb3JQYXlvdXQubXVsKHVzZXJTaGFyZXMpLm11bCgxMDAwKTsgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgDQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IGFtb3VudDsNCiAgICAgICAgYmFsYW5jZXNbdGhpc10gLT0gYW1vdW50Ow0KICAgICAgICBUcmFuc2Zlcih0aGlzLCBtc2cuc2VuZGVyLCBhbW91bnQpOw0KICAgICAgICANCiAgICAgICAgYmFja2Vyc1ttc2cuc2VuZGVyXS53aXRoZHJhd25BdENsdXN0ZXIgPSBjdXJyZW50Q2x1c3RlcigpOyANCiAgICAgICAgDQogICAgICAgIHJldHVybiBhbW91bnQ7DQogICAgfQ0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIEBkZXYgQWxsb3dzIHVzZXJzIHRvIGNsYWltIHNlZ21lbnRzIGV2ZXJ5IDEwMDAgVU5JVFMgKGJsb2NrcykuDQogICAgICogQGRldiBOT1RFOiBVc2VycyBjbGFpbWluZyBTRUdNRU5UUyBpbnN0ZWFkIG9mIENMVVNURVJTIGdldCBvbmx5IGhhbGYgb2YgdGhlIHJld2FyZC4NCiAgICAgKiBAcmV0dXJuIFRoZSBhbW91bnQgb2YgU0VHTUVOVFMgY2xhaW1lZCBieSBzZW5kZXIuDQogICAgICovDQogICAgZnVuY3Rpb24gY2xhaW1TZWdtZW50cygpIHB1YmxpYyByZXR1cm5zICh1aW50IGFtb3VudCkgew0KICAgICAgICANCiAgICAgICAgaWYgKGN1cnJlbnRTZWdtZW50KCkgPT0gMCkgdGhyb3c7DQogICAgICAgIGlmICghYmFja2Vyc1ttc2cuc2VuZGVyXS5zdGF0ZSkgdGhyb3c7ICANCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICB1aW50IHByZXZpb3VzV2l0aGRyYXdzID0gY3VycmVudENsdXN0ZXIoKS5hZGQoYmFja2Vyc1ttc2cuc2VuZGVyXS53aXRoZHJhd25BdFNlZ21lbnQpOw0KICAgICAgICB1aW50IGVudGl0bGVkVG9TZWdtZW50cyA9IGN1cnJlbnRDbHVzdGVyKCkuYWRkKGN1cnJlbnRTZWdtZW50KCkuc3ViKHByZXZpb3VzV2l0aGRyYXdzKSk7DQogICAgICAgIA0KICAgICAgICBpZiAoZW50aXRsZWRUb1NlZ21lbnRzID09IDAgKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIHVpbnQgdXNlclNoYXJlcyA9IGJhY2tlcnNbbXNnLnNlbmRlcl0uY29udHJpYnV0aW9uLmRpdigxIGZpbm5leSk7DQogICAgICAgIHVpbnQgYW1vdW50Rm9yUGF5b3V0ID0gYnV5UHJpY2VFdGguZGl2KGNvbnRyaWJ1dG9ycyk7DQogICAgICAgIA0KICAgICAgICBhbW91bnQgPSAgYW1vdW50Rm9yUGF5b3V0Lm11bCh1c2VyU2hhcmVzKS5kaXYoMTApLmRpdigyKTsgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgDQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IGFtb3VudDsNCiAgICAgICAgYmFsYW5jZXNbdGhpc10gLT0gYW1vdW50Ow0KICAgICAgICBUcmFuc2Zlcih0aGlzLCBtc2cuc2VuZGVyLCBhbW91bnQpOw0KICAgICAgICANCiAgICAgICAgYmFja2Vyc1ttc2cuc2VuZGVyXS53aXRoZHJhd25BdFNlZ21lbnQgPSBjdXJyZW50U2VnbWVudCgpOyANCiAgICAgICAgDQogICAgICAgIHJldHVybiBhbW91bnQ7DQogICAgfQ0KDQogICAgDQogICAgLyoqDQogICAgICogQGRldiBGdW5jdGlvbiBpZiB1c2VycyBzZW5kIGZ1bmRzIHRvIHRoaXMgY29udHJhY3QsIGNhbGwgdGhlIGJ1eSBmdW5jdGlvbi4NCiAgICAgKi8gDQogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgICAgICAgIGJ1eUNsdXN0ZXJUb2tlbigpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIEBkZXYgQWxsb3dzIG93bmVyIHRvIHdpdGhkcmF3IGZ1bmRzIGZyb20gdGhlIGFjY291bnQuDQogICAgICovIA0KICAgIGZ1bmN0aW9uIERyYWluKCkgb25seU93bmVyIHB1YmxpYyB7DQogICAgICAgIGlmKHRoaXMuYmFsYW5jZSA+IDApIHsNCiAgICAgICAgICAgIGlmICghb3duZXIuc2VuZCh0aGlzLmJhbGFuY2UpKSB0aHJvdzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICAvKioNCiAgICAqICBCdXJuIGF3YXkgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgQ2x1c3RlclRva2VuIHRva2Vucy4NCiAgICAqIEByZXR1cm4gUmV0dXJucyBzdWNjZXNzIGJvb2xlYW4uDQogICAgKi8NCiAgICBmdW5jdGlvbiBidXJuKHVpbnQgX3ZhbHVlKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOw0KICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOw0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCAweDAsIF92YWx1ZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICANCiAgICANCiAgICAvKioNCiAgICAgKiBAZGV2IEludGVybmFsIGNoZWNrIHRvIHNlZSBpZiBhdCBsZWFzdCAxMDAwIHNlZ21lbnRzIHBhc3NlZCB3aXRob3V0IHdpdGhkcmF3YWwgcHJpb3IgdG8gcmV3YXJkaW5nIGEgY2x1c3Rlcg0KICAgICAqLyANCiAgICBmdW5jdGlvbiBpc0VudGl0bGVkRm9yQ2x1c3RlcihhZGRyZXNzIF9zZW5kZXIpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICANCiAgICAgICAgdWludCB0MSA9IGN1cnJlbnRDbHVzdGVyKCkubXVsKDEwMDApLmFkZChjdXJyZW50U2VnbWVudCgpKTsgDQogICAgICAgIHVpbnQgdDIgPSBiYWNrZXJzW19zZW5kZXJdLndpdGhkcmF3bkF0U2VnbWVudDsgICAgICANCg0KICAgICAgICBpZiAodDEuc3ViKHQyKSA+PSAxMDAwKSB7IHJldHVybiB0cnVlOyB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgDQogICAgfQ0KICAgIA0KfQ=='