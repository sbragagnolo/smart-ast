base 64 content
base64contingencyToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KY29udHJhY3QgU2FmZU1hdGggew0KICAvL2ludGVybmFscw0KDQogIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICogYjsNCiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiIDw9IGEpOw0KICAgIHJldHVybiBhIC0gYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgew0KICAgIGlmICghYXNzZXJ0aW9uKSB0aHJvdzsNCiAgfQ0KfQ0KDQovKioNCiAqIEVSQyAyMCB0b2tlbg0KICoNCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBUb2tlbiB7DQoNCiAgICAvLy8gQHJldHVybiB0b3RhbCBhbW91bnQgb2YgdG9rZW5zDQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSkge30NCg0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQNCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZQ0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7fQ0KDQogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHt9DQoNCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWANCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXINCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykge30NCg0KICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX2FkZHJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB3ZWkgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7fQ0KDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zDQogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudA0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHt9DQoNCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsNCg0KfQ0KDQovKioNCiAqIEVSQyAyMCB0b2tlbg0KICoNCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIFRva2VuIHsNCg0KICAgIC8qKg0KICAgICAqIFJldmlld2VkOg0KICAgICAqIC0gSW50ZXJnZXIgb3ZlcmZsb3cgPSBPSywgY2hlY2tlZA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIC8vRGVmYXVsdCBhc3N1bWVzIHRvdGFsU3VwcGx5IGNhbid0IGJlIG92ZXIgbWF4ICgyXjI1NiAtIDEpLg0KICAgICAgICAvL0lmIHlvdXIgdG9rZW4gbGVhdmVzIG91dCB0b3RhbFN1cHBseSBhbmQgY2FuIGlzc3VlIG1vcmUgdG9rZW5zIGFzIHRpbWUgZ29lcyBvbiwgeW91IG5lZWQgdG8gY2hlY2sgaWYgaXQgZG9lc24ndCB3cmFwLg0KICAgICAgICAvL1JlcGxhY2UgdGhlIGlmIHdpdGggdGhpcyBvbmUgaW5zdGVhZC4NCiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgew0KICAgICAgICAvL2lmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgew0KICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7DQogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIC8vc2FtZSBhcyBhYm92ZS4gUmVwbGFjZSB0aGlzIGxpbmUgd2l0aCB0aGUgZm9sbG93aW5nIGlmIHlvdSB3YW50IHRvIHByb3RlY3QgYWdhaW5zdCB3cmFwcGluZyB1aW50cy4NCiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7DQogICAgICAgIC8vaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDApIHsNCiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOw0KICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsNCiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsNCiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgew0KICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogICAgfQ0KDQogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOw0KDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOw0KDQogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7DQoNCn0NCg0KDQovKioNCiAqIENvbnRpbmdlbmN5IGNyb3dkc2FsZSBjcm93ZHNhbGUgY29udHJhY3QuIE1vZGlmaWVkIGZyb20gRmlyc3RCbG9vZCBjcm93ZHNhbGUgY29udHJhY3QuDQogKg0KICogU2VjdXJpdHkgY3JpdGVyaWEgZXZhbHVhdGVkIGFnYWluc3QgaHR0cDovL2V0aGVyZXVtLnN0YWNrZXhjaGFuZ2UuY29tL3F1ZXN0aW9ucy84NTUxL21ldGhvZG9sb2dpY2FsLXNlY3VyaXR5LXJldmlldy1vZi1hLXNtYXJ0LWNvbnRyYWN0DQogKg0KICoNCiAqLw0KY29udHJhY3QgQ29udGluZ2VuY3lUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBTYWZlTWF0aCB7DQogICAgLyoNCiAgICAgICAgTW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRmlyc3RCbG9vZC5pbyB0b2tlbiBhbmQgdG9rZW4gc2FsZQ0KICAgICovDQogICAgDQogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIkNvbnRpbmdlbmN5IFRva2VuIjsNCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJDVFkiOw0KICAgIHVpbnQgcHVibGljIGRlY2ltYWxzID0gMTg7DQogICAgdWludCBwdWJsaWMgc3RhcnRCbG9jayA9IDMxMDAwMDA7IC8vY3Jvd2RzYWxlIHN0YXJ0IGJsb2NrDQogICAgdWludCBwdWJsaWMgZW5kQmxvY2sgPSAzMjcyODAwOyAvL2Nyb3dkc2FsZSBlbmQgYmxvY2sNCg0KICAgIC8vIEluaXRpYWwgZm91bmRlciBhZGRyZXNzDQogICAgLy8gQWxsIGRlcG9zaXRlZCBFVEggd2lsbCBiZSBmb3J3YXJkZWQgdG8gdGhpcyBhZGRyZXNzLg0KICAgIGFkZHJlc3MgcHVibGljIGZvdW5kZXIgPSAweDQ0ODVmNDRhYTFmOTliNDNCRDY0MDA1ODZDMUIyQTAyZWMyNjNFYzA7DQoNCiAgICB1aW50IHB1YmxpYyBldGhlckNhcCA9IDg1MDAwMCAqIDEwKioxODsgLy9tYXggYW1vdW50IHJhaXNlZCBkdXJpbmcgY3Jvd2RzYWxlICg4LjVNIFVTRCB3b3J0aCBvZiBldGhlciB3aWxsIGJlIG1lYXN1cmVkIHdpdGggYSBtb3ZpbmcgYXZlcmFnZSBtYXJrZXQgcHJpY2UgYXQgYmVnaW5uaW5nIG9mIHRoZSBjcm93ZHNhbGUpDQogICAgdWludCBwdWJsaWMgdHJhbnNmZXJMb2NrdXAgPSAzNzAyODQ7IC8vdHJhbnNmZXJzIGFyZSBsb2NrZWQgZm9yIHRoaXMgbWFueSBibG9ja3MgYWZ0ZXIgZW5kQmxvY2sgKGFzc3VtaW5nIDE0IHNlY29uZCBibG9ja3MsIHRoaXMgaXMgMiBtb250aHMpDQogICAgdWludCBwdWJsaWMgZm91bmRlckxvY2t1cCA9IDExMjYyODU7IC8vZm91bmRlciBhbGxvY2F0aW9uIGNhbm5vdCBiZSBjcmVhdGVkIHVudGlsIHRoaXMgbWFueSBibG9ja3MgYWZ0ZXIgZW5kQmxvY2sgKGFzc3VtaW5nIDE0IHNlY29uZCBibG9ja3MsIHRoaXMgaXMgNiBtb250aHMpDQoNCiAgICB1aW50IHB1YmxpYyBmb3VuZGVyQWxsb2NhdGlvbiA9IDEwICogMTAqKjE2OyAvLzEwJSBvZiB0b2tlbiBzdXBwbHkgYWxsb2NhdGVkIHBvc3QtY3Jvd2RzYWxlIGZvciB0aGUgZm91bmRlciBhbGxvY2F0aW9uDQogICAgYm9vbCBwdWJsaWMgZm91bmRlckFsbG9jYXRlZCA9IGZhbHNlOyAvL3RoaXMgd2lsbCBjaGFuZ2UgdG8gdHJ1ZSB3aGVuIHRoZSBmb3VuZGVyIGZ1bmQgaXMgYWxsb2NhdGVkDQogICAgdWludCBwdWJsaWMgcHJlc2FsZVRva2VuU3VwcGx5ID0gMDsgLy90aGlzIHdpbGwga2VlcCB0cmFjayBvZiB0aGUgdG9rZW4gc3VwcGx5IGNyZWF0ZWQgZHVyaW5nIHRoZSBjcm93ZHNhbGUNCiAgICB1aW50IHB1YmxpYyBwcmVzYWxlRXRoZXJSYWlzZWQgPSAwOyAvL3RoaXMgd2lsbCBrZWVwIHRyYWNrIG9mIHRoZSBFdGhlciByYWlzZWQgZHVyaW5nIHRoZSBjcm93ZHNhbGUNCiAgICBib29sIHB1YmxpYyBoYWx0ZWQgPSBmYWxzZTsgLy90aGUgZm91bmRlciBhZGRyZXNzIGNhbiBzZXQgdGhpcyB0byB0cnVlIHRvIGhhbHQgdGhlIGNyb3dkc2FsZSBkdWUgdG8gZW1lcmdlbmN5DQogICAgZXZlbnQgQnV5KGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXRoLCB1aW50IGZidCk7DQogICAgZXZlbnQgV2l0aGRyYXcoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgYWRkcmVzcyB0bywgdWludCBldGgpOw0KICAgIGV2ZW50IEFsbG9jYXRlRm91bmRlclRva2VucyhhZGRyZXNzIGluZGV4ZWQgc2VuZGVyKTsNCg0KICAgIC8qKg0KICAgICAqIFNlY3VyaXR5IHJldmlldw0KICAgICAqDQogICAgICogLSBJbnRlZ2VyIG92ZXJmbG93OiBkb2VzIG5vdCBhcHBseSwgYmxvY2tudW1iZXIgY2FuJ3QgZ3JvdyB0aGF0IGhpZ2gNCiAgICAgKiAtIERpdmlzaW9uIGlzIHRoZSBsYXN0IG9wZXJhdGlvbiBhbmQgY29uc3RhbnQsIHNob3VsZCBub3QgY2F1c2UgaXNzdWVzDQogICAgICogLSBQcmljZSBmdW5jdGlvbiBwbG90dGVkIGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vaXNzdWVzLzINCiAgICAgKi8NCiAgICBmdW5jdGlvbiBwcmljZSgpIGNvbnN0YW50IHJldHVybnModWludCkgew0KICAgICAgICBpZiAoYmxvY2subnVtYmVyPj1zdGFydEJsb2NrICYmIGJsb2NrLm51bWJlcjxzdGFydEJsb2NrKzI1MCkgcmV0dXJuIDE3MDsgLy9mdW5jdGlvbigpIHsNCiAgICAgICAgaWYgKGJsb2NrLm51bWJlcjxzdGFydEJsb2NrIHx8IGJsb2NrLm51bWJlcj5lbmRCbG9jaykgcmV0dXJuIDEwMDsgLy9kZWZhdWx0IHByaWNlDQogICAgICAgIHJldHVybiAxMDAgKyA0KihlbmRCbG9jayAtIGJsb2NrLm51bWJlcikvKGVuZEJsb2NrIC0gc3RhcnRCbG9jayArIDEpKjY3LzQ7IC8vY3Jvd2RzYWxlIHByaWNlDQogICAgfQ0KDQogICAgLy8gcHJpY2UoKSBleHBvc2VkIGZvciB1bml0IHRlc3RzDQogICAgZnVuY3Rpb24gdGVzdFByaWNlKHVpbnQgYmxvY2tOdW1iZXIpIGNvbnN0YW50IHJldHVybnModWludCkgew0KICAgICAgICBpZiAoYmxvY2tOdW1iZXI+PXN0YXJ0QmxvY2sgJiYgYmxvY2tOdW1iZXI8c3RhcnRCbG9jaysyNTApIHJldHVybiAxNzA7IC8vaG91ciBvbmUNCiAgICAgICAgaWYgKGJsb2NrTnVtYmVyPHN0YXJ0QmxvY2sgfHwgYmxvY2tOdW1iZXI+ZW5kQmxvY2spIHJldHVybiAxMDA7IC8vZGVmYXVsdCBwcmljZQ0KICAgICAgICByZXR1cm4gMTAwICsgNCooZW5kQmxvY2sgLSBibG9ja051bWJlcikvKGVuZEJsb2NrIC0gc3RhcnRCbG9jayArIDEpKjY3LzQ7IC8vY3Jvd2RzYWxlIHByaWNlDQogICAgfQ0KDQogICAgLy8gQnV5IGVudHJ5IHBvaW50DQogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsNCiAgICAgICAgYnV5UmVjaXBpZW50KG1zZy5zZW5kZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIE1haW4gdG9rZW4gYnV5IGZ1bmN0aW9uLg0KICAgICAqDQogICAgICogU2VjdXJpdHkgcmV2aWV3DQogICAgICoNCiAgICAgKiAtIEludGVnZXIgbWF0aDogb2sgLSB1c2luZyBTYWZlTWF0aA0KICAgICAqDQogICAgICogLSBoYWx0IGZsYWcgYWRkZWQgLSBvaw0KICAgICAqDQogICAgICogQXBwbGljYWJsZSB0ZXN0czoNCiAgICAgKg0KICAgICAqIC0gVGVzdCBoYWx0aW5nLCBidXlpbmcsIGFuZCBmYWlsaW5nDQogICAgICogLSBUZXN0IGJ1eWluZyBvbiBiZWhhbGYgb2YgYSByZWNpcGllbnQNCiAgICAgKiAtIFRlc3QgYnV5DQogICAgICogLSBUZXN0IHVuaGFsdGluZywgYnV5aW5nLCBhbmQgc3VjY2VlZGluZw0KICAgICAqIC0gVGVzdCBidXlpbmcgYWZ0ZXIgdGhlIHNhbGUgZW5kcw0KICAgICAqDQogICAgICovDQogICAgZnVuY3Rpb24gYnV5UmVjaXBpZW50KGFkZHJlc3MgcmVjaXBpZW50KSBwYXlhYmxlIHsNCiAgICAgICAgaWYgKGJsb2NrLm51bWJlcjxzdGFydEJsb2NrIHx8IGJsb2NrLm51bWJlcj5lbmRCbG9jayB8fCBzYWZlQWRkKHByZXNhbGVFdGhlclJhaXNlZCxtc2cudmFsdWUpPmV0aGVyQ2FwIHx8IGhhbHRlZCkgdGhyb3c7DQogICAgICAgIHVpbnQgdG9rZW5zID0gc2FmZU11bChtc2cudmFsdWUsIHByaWNlKCkpOw0KICAgICAgICBiYWxhbmNlc1tyZWNpcGllbnRdID0gc2FmZUFkZChiYWxhbmNlc1tyZWNpcGllbnRdLCB0b2tlbnMpOw0KICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVBZGQodG90YWxTdXBwbHksIHRva2Vucyk7DQogICAgICAgIHByZXNhbGVFdGhlclJhaXNlZCA9IHNhZmVBZGQocHJlc2FsZUV0aGVyUmFpc2VkLCBtc2cudmFsdWUpOw0KDQogICAgICAgIC8vaWYgKCFmb3VuZGVyLnNlbmQobXNnLnZhbHVlKSkgdGhyb3c7IC8vaW1tZWRpYXRlbHkgc2VuZCBFdGhlciB0byBmb3VuZGVyIGFkZHJlc3MNCiAgICAgICAgLy9EdWUgdG8gTWV0YW1hc2sgbm90IHNlbmRpbmcgZW5vdWdoIGdhcyB3aXRoIHRoaXMgbWV0aG9kLCB3ZSBzZW5kIGV0aGVyIGxhdGVyIHdpdGggdGhlIGZ1bmN0aW9uICJmb3VuZGVyV2l0aGRyYXciIGJlbG93DQoNCiAgICAgICAgQnV5KHJlY2lwaWVudCwgbXNnLnZhbHVlLCB0b2tlbnMpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBmb3VuZGVyV2l0aGRyYXcodWludCBhbW91bnQpIHsNCiAgICAgICAgLy8gRm91bmRlciB0byByZWNlaXZlIHByZXNhbGUgZXRoZXINCiAgICAgICAgaWYgKG1zZy5zZW5kZXIhPWZvdW5kZXIpIHRocm93Ow0KICAgICAgICBpZiAoIWZvdW5kZXIuc2VuZChhbW91bnQpKSB0aHJvdzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXQgdXAgZm91bmRlciBhZGRyZXNzIHRva2VuIGJhbGFuY2UuDQogICAgICoNCiAgICAgKiBTZWN1cml0eSByZXZpZXcNCiAgICAgKg0KICAgICAqIC0gSW50ZWdlciBtYXRoOiBvayAtIG9ubHkgY2FsbGVkIG9uY2Ugd2l0aCBmaXhlZCBwYXJhbWV0ZXJzDQogICAgICoNCiAgICAgKiBBcHBsaWNhYmxlIHRlc3RzOg0KICAgICAqDQogICAgICogLSBUZXN0IGJvdW50eSBhbmQgZWNvc3lzdGVtIGFsbG9jYXRpb24NCiAgICAgKiAtIFRlc3QgYm91bnR5IGFuZCBlY29zeXN0ZW0gYWxsb2NhdGlvbiB0d2ljZQ0KICAgICAqDQogICAgICovDQogICAgZnVuY3Rpb24gYWxsb2NhdGVGb3VuZGVyVG9rZW5zKCkgew0KICAgICAgICBpZiAobXNnLnNlbmRlciE9Zm91bmRlcikgdGhyb3c7DQogICAgICAgIGlmIChibG9jay5udW1iZXIgPD0gZW5kQmxvY2sgKyBmb3VuZGVyTG9ja3VwKSB0aHJvdzsNCiAgICAgICAgaWYgKGZvdW5kZXJBbGxvY2F0ZWQpIHRocm93Ow0KICAgICAgICAvL2lmICghYm91bnR5QWxsb2NhdGVkIHx8ICFlY29zeXN0ZW1BbGxvY2F0ZWQpIHRocm93OyAvLyBFeHRyYSBib3VudHkgb3IgZWNvc3lzdGVtIGFsbG9jYXRpb24gZm9yIGZvdW5kZXJzIGRpc2FibGVkIGZvciBjb250aW5nZW5jeQ0KICAgICAgICBiYWxhbmNlc1tmb3VuZGVyXSA9IHNhZmVBZGQoYmFsYW5jZXNbZm91bmRlcl0sIHByZXNhbGVUb2tlblN1cHBseSAqIGZvdW5kZXJBbGxvY2F0aW9uIC8gKDEgZXRoZXIpKTsNCiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBwcmVzYWxlVG9rZW5TdXBwbHkgKiBmb3VuZGVyQWxsb2NhdGlvbiAvICgxIGV0aGVyKSk7DQogICAgICAgIGZvdW5kZXJBbGxvY2F0ZWQgPSB0cnVlOw0KICAgICAgICBBbGxvY2F0ZUZvdW5kZXJUb2tlbnMobXNnLnNlbmRlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRW1lcmdlbmN5IFN0b3AgY3Jvd2RzYWxlLg0KICAgICAqDQogICAgICogIEFwcGxpY2FibGUgdGVzdHM6DQogICAgICoNCiAgICAgKiAtIFRlc3QgdW5oYWx0aW5nLCBidXlpbmcsIGFuZCBzdWNjZWVkaW5nDQogICAgICovDQogICAgZnVuY3Rpb24gaGFsdCgpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIhPWZvdW5kZXIpIHRocm93Ow0KICAgICAgICBoYWx0ZWQgPSB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHVuaGFsdCgpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIhPWZvdW5kZXIpIHRocm93Ow0KICAgICAgICBoYWx0ZWQgPSBmYWxzZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGFuZ2UgZm91bmRlciBhZGRyZXNzICh3aGVyZSBjcm93ZHNhbGUgRVRIIGlzIGJlaW5nIGZvcndhcmRlZCkuDQogICAgICoNCiAgICAgKiBBcHBsaWNhYmxlIHRlc3RzOg0KICAgICAqDQogICAgICogLSBUZXN0IGZvdW5kZXIgY2hhbmdlIGJ5IGhhY2tlcg0KICAgICAqIC0gVGVzdCBmb3VuZGVyIGNoYW5nZQ0KICAgICAqIC0gVGVzdCBmb3VuZGVyIHRva2VuIGFsbG9jYXRpb24gdHdpY2UNCiAgICAgKg0KICAgICAqLw0KDQogICAgZnVuY3Rpb24gY2hhbmdlRm91bmRlcihhZGRyZXNzIG5ld0ZvdW5kZXIpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIhPWZvdW5kZXIpIHRocm93Ow0KICAgICAgICBmb3VuZGVyID0gbmV3Rm91bmRlcjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBFUkMgMjAgU3RhbmRhcmQgVG9rZW4gaW50ZXJmYWNlIHRyYW5zZmVyIGZ1bmN0aW9uDQogICAgICoNCiAgICAgKiBQcmV2ZW50IHRyYW5zZmVycyB1bnRpbCBmcmVlemUgcGVyaW9kIGlzIG92ZXIuDQogICAgICoNCiAgICAgKiBBcHBsaWNhYmxlIHRlc3RzOg0KICAgICAqDQogICAgICogLSBUZXN0IHJlc3RyaWN0ZWQgZWFybHkgdHJhbnNmZXINCiAgICAgKiAtIFRlc3QgdHJhbnNmZXIgYWZ0ZXIgcmVzdHJpY3RlZCBwZXJpb2QNCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoYmxvY2subnVtYmVyIDw9IGVuZEJsb2NrICsgdHJhbnNmZXJMb2NrdXAgJiYgbXNnLnNlbmRlciE9Zm91bmRlcikgdGhyb3c7DQogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEVSQyAyMCBTdGFuZGFyZCBUb2tlbiBpbnRlcmZhY2UgdHJhbnNmZXIgZnVuY3Rpb24NCiAgICAgKg0KICAgICAqIFByZXZlbnQgdHJhbnNmZXJzIHVudGlsIGZyZWV6ZSBwZXJpb2QgaXMgb3Zlci4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8PSBlbmRCbG9jayArIHRyYW5zZmVyTG9ja3VwICYmIG1zZy5zZW5kZXIhPWZvdW5kZXIpIHRocm93Ow0KICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogICAgfQ0KDQp9'