base 64 content
base64crowdsale6
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCmxpYnJhcnkgU2FmZU1hdGggew0KICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICogYjsNCiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KICAgIHJldHVybiBjOw0KICB9DQogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiID4gMCk7DQogICAgdWludCBjID0gYSAvIGI7DQogICAgYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7DQogICAgcmV0dXJuIGM7DQogIH0NCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjID49IGEpOw0KICAgIHJldHVybiBjOw0KICB9DQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogIH0NCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgew0KICAgIGlmICghYXNzZXJ0aW9uKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogIH0NCn0NCmNvbnRyYWN0IE93bmFibGUgew0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KICAgIGZ1bmN0aW9uIE93bmFibGUoKSB7DQogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgICB9DQogICAgbW9kaWZpZXIgb25seU93bmVyIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgew0KICAgICAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgew0KICAgICAgICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICAgICAgfQ0KICAgIH0NCn0NCi8qDQogKiBQYXVzYWJsZQ0KICogQWJzdHJhY3QgY29udHJhY3QgdGhhdCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuDQogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uDQogKi8NCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgew0KICBib29sIHB1YmxpYyBzdG9wcGVkOw0KICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgew0KICAgIGlmIChzdG9wcGVkKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogICAgXzsNCiAgfQ0KICANCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsNCiAgICBpZiAoIXN0b3BwZWQpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICBfOw0KICB9DQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlDQogIGZ1bmN0aW9uIGVtZXJnZW5jeVN0b3AoKSBleHRlcm5hbCBvbmx5T3duZXIgew0KICAgIHN0b3BwZWQgPSB0cnVlOw0KICB9DQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUNCiAgZnVuY3Rpb24gcmVsZWFzZSgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgew0KICAgIHN0b3BwZWQgPSBmYWxzZTsNCiAgfQ0KfQ0KY29udHJhY3QgRVJDMjBCYXNpYyB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQp9DQpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KLyoNCiAqIFB1bGxQYXltZW50DQogKiBCYXNlIGNvbnRyYWN0IHN1cHBvcnRpbmcgYXN5bmMgc2VuZCBmb3IgcHVsbCBwYXltZW50cy4NCiAqIEluaGVyaXQgZnJvbSB0aGlzIGNvbnRyYWN0IGFuZCB1c2UgYXN5bmNTZW5kIGluc3RlYWQgb2Ygc2VuZC4NCiAqLw0KY29udHJhY3QgUHVsbFBheW1lbnQgew0KICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsNCiAgDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgcGF5bWVudHM7DQogIGV2ZW50IExvZ1JlZnVuZEVUSChhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsNCiAgLyoqDQogICogIFN0b3JlIHNlbnQgYW1vdW50IGFzIGNyZWRpdCB0byBiZSBwdWxsZWQsIGNhbGxlZCBieSBwYXllciANCiAgKiovDQogIGZ1bmN0aW9uIGFzeW5jU2VuZChhZGRyZXNzIGRlc3QsIHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7DQogICAgcGF5bWVudHNbZGVzdF0gPSBwYXltZW50c1tkZXN0XS5hZGQoYW1vdW50KTsNCiAgfQ0KICAvLyB3aXRoZHJhdyBhY2N1bXVsYXRlZCBiYWxhbmNlLCBjYWxsZWQgYnkgcGF5ZWUNCiAgZnVuY3Rpb24gd2l0aGRyYXdQYXltZW50cygpIHsNCiAgICBhZGRyZXNzIHBheWVlID0gbXNnLnNlbmRlcjsNCiAgICB1aW50IHBheW1lbnQgPSBwYXltZW50c1twYXllZV07DQogICAgDQogICAgaWYgKHBheW1lbnQgPT0gMCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICAgIGlmICh0aGlzLmJhbGFuY2UgPCBwYXltZW50KSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogICAgcGF5bWVudHNbcGF5ZWVdID0gMDsNCiAgICBpZiAoIXBheWVlLnNlbmQocGF5bWVudCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICBMb2dSZWZ1bmRFVEgocGF5ZWUscGF5bWVudCk7DQogIH0NCn0NCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7DQogIA0KICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsNCiAgDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsNCiAgDQogIC8qDQogICAqIEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrICANCiAgKi8NCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgew0KICAgICBpZihtc2cuZGF0YS5sZW5ndGggPCBzaXplICsgNCkgew0KICAgICAgIHRocm93Ow0KICAgICB9DQogICAgIF87DQogIH0NCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKSB7DQogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsNCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsNCiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7DQogIH0NCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsNCiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgfQ0KfQ0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBCYXNpY1Rva2VuLCBFUkMyMCB7DQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgew0KICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07DQogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0DQogICAgLy8gaWYgKF92YWx1ZSA+IF9hbGxvd2FuY2UpIHRocm93Ow0KICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsNCiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7DQogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgfQ0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB7DQogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2ANCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdA0KICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOg0KICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQ0KICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgdGhyb3c7DQogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogIH0NCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgew0KICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICB9DQp9DQovKioNCiAqICBTa2luQ29pbiB0b2tlbiBjb250cmFjdC4gSW1wbGVtZW50cw0KICovDQpjb250cmFjdCBTa2luQ29pbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsNCiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlNraW5Db2luIjsNCiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiU0tJTiI7DQogIHVpbnQgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gNjsNCiAgLy8gQ29uc3RydWN0b3INCiAgZnVuY3Rpb24gU2tpbkNvaW4oKSB7DQogICAgICB0b3RhbFN1cHBseSA9IDEwMDAwMDAwMDAwMDAwMDA7DQogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHRvdGFsU3VwcGx5OyAvLyBTZW5kIGFsbCB0b2tlbnMgdG8gb3duZXINCiAgfQ0KICAvKioNCiAgICogIEJ1cm4gYXdheSB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiBTa2luQ29pbiB0b2tlbnMNCiAgICovDQogIGZ1bmN0aW9uIGJ1cm4odWludCBfdmFsdWUpIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7DQogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsNCiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOw0KICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIDB4MCwgX3ZhbHVlKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KfQ0KLyoNCiAgQ3Jvd2RzYWxlIFNtYXJ0IENvbnRyYWN0IGZvciB0aGUgc2tpbmNvaW4ub3JnIHByb2plY3QNCiAgVGhpcyBzbWFydCBjb250cmFjdCBjb2xsZWN0cyBFVEgsIGFuZCBpbiByZXR1cm4gZW1pdHMgU2tpbkNvaW4gdG9rZW5zIHRvIHRoZSBiYWNrZXJzDQoqLw0KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIFBhdXNhYmxlLCBQdWxsUGF5bWVudCB7DQogICAgDQogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7DQogICAgc3RydWN0IEJhY2tlciB7DQogICAgICAgIHVpbnQgd2VpUmVjZWl2ZWQ7IC8vIEFtb3VudCBvZiBFdGhlciBnaXZlbg0KICAgICAgICB1aW50IGNvaW5TZW50Ow0KICAgIH0NCiAgICAvKg0KICAgICogQ29uc3RhbnRzDQogICAgKi8NCiAgICAvKiBNaW5pbXVtIG51bWJlciBvZiBTa2luQ29pbiB0byBzZWxsICovDQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUlOX0NBUCA9IDMwMDAwMDAwMDAwMDAwOyAvLyAzMCwwMDAsMDAwIFNraW5Db2lucw0KICAgIC8qIE1heGltdW0gbnVtYmVyIG9mIFNraW5Db2luIHRvIHNlbGwgKi8NCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNQVhfQ0FQID0gNjAwMDAwMDAwMDAwMDAwOyAvLyA2MDAsMDAwLDAwMCBTa2luQ29pbnMNCiAgICAvKiBNaW5pbXVtIGFtb3VudCB0byBpbnZlc3QgKi8NCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNSU5fSU5WRVNUX0VUSEVSID0gMTAwIGZpbm5leTsNCiAgICAvKiBDcm93ZHNhbGUgcGVyaW9kICovDQogICAgdWludCBwcml2YXRlIGNvbnN0YW50IENST1dEU0FMRV9QRVJJT0QgPSAzMCBkYXlzOw0KICAgIC8qIE51bWJlciBvZiBTa2luQ29pbnMgcGVyIEV0aGVyICovDQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgQ09JTl9QRVJfRVRIRVIgPSA2MDAwMDAwMDAwOyAvLyA2LDAwMCBTa2luQ29pbnMNCiAgICAvKg0KICAgICogVmFyaWFibGVzDQogICAgKi8NCiAgICAvKiBTa2luQ29pbiBjb250cmFjdCByZWZlcmVuY2UgKi8NCiAgICBTa2luQ29pbiBwdWJsaWMgY29pbjsNCiAgICAvKiBNdWx0aXNpZyBjb250cmFjdCB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgRXRoZXIgKi8NCiAgICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ0V0aGVyOw0KICAgIC8qIE51bWJlciBvZiBFdGhlciByZWNlaXZlZCAqLw0KICAgIHVpbnQgcHVibGljIGV0aGVyUmVjZWl2ZWQ7DQogICAgLyogTnVtYmVyIG9mIFNraW5Db2lucyBzZW50IHRvIEV0aGVyIGNvbnRyaWJ1dG9ycyAqLw0KICAgIHVpbnQgcHVibGljIGNvaW5TZW50VG9FdGhlcjsNCiAgICAvKiBDcm93ZHNhbGUgc3RhcnQgdGltZSAqLw0KICAgIHVpbnQgcHVibGljIHN0YXJ0VGltZTsNCiAgICAvKiBDcm93ZHNhbGUgZW5kIHRpbWUgKi8NCiAgICB1aW50IHB1YmxpYyBlbmRUaW1lOw0KICAgIC8qIElzIGNyb3dkc2FsZSBzdGlsbCBvbiBnb2luZyAqLw0KICAgIGJvb2wgcHVibGljIGNyb3dkc2FsZUNsb3NlZDsNCiAgICAvKiBCYWNrZXJzIEV0aGVyIGluZGV4ZWQgYnkgdGhlaXIgRXRoZXJldW0gYWRkcmVzcyAqLw0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBCYWNrZXIpIHB1YmxpYyBiYWNrZXJzOw0KICAgIC8qDQogICAgKiBNb2RpZmllcnMNCiAgICAqLw0KICAgIG1vZGlmaWVyIG1pbkNhcE5vdFJlYWNoZWQoKSB7DQogICAgICAgIGlmICgobm93IDwgZW5kVGltZSkgfHwgY29pblNlbnRUb0V0aGVyID49IE1JTl9DQVAgKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQogICAgbW9kaWZpZXIgcmVzcGVjdFRpbWVGcmFtZSgpIHsNCiAgICAgICAgaWYgKChub3cgPCBzdGFydFRpbWUpIHx8IChub3cgPiBlbmRUaW1lICkpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCiAgICAvKg0KICAgICAqIEV2ZW50DQogICAgKi8NCiAgICBldmVudCBMb2dSZWNlaXZlZEVUSChhZGRyZXNzIGFkZHIsIHVpbnQgdmFsdWUpOw0KICAgIGV2ZW50IExvZ0NvaW5zRW1pdGVkKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50IGFtb3VudCk7DQogICAgLyoNCiAgICAgKiBDb25zdHJ1Y3Rvcg0KICAgICovDQogICAgZnVuY3Rpb24gQ3Jvd2RzYWxlKGFkZHJlc3MgX3NraW5Db2luQWRkcmVzcywgYWRkcmVzcyBfdG8pIHsNCiAgICAgICAgY29pbiA9IFNraW5Db2luKF9za2luQ29pbkFkZHJlc3MpOw0KICAgICAgICBtdWx0aXNpZ0V0aGVyID0gX3RvOw0KICAgIH0NCiAgICAvKiANCiAgICAgKiBUaGUgZmFsbGJhY2sgZnVuY3Rpb24gY29ycmVzcG9uZHMgdG8gYSBkb25hdGlvbiBpbiBFVEgNCiAgICAgKi8NCiAgICBmdW5jdGlvbigpIHN0b3BJbkVtZXJnZW5jeSByZXNwZWN0VGltZUZyYW1lIHBheWFibGUgew0KICAgICAgICByZWNlaXZlRVRIKG1zZy5zZW5kZXIpOw0KICAgIH0NCiAgICAvKiANCiAgICAgKiBUbyBjYWxsIHRvIHN0YXJ0IHRoZSBjcm93ZHNhbGUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdGFydCgpIG9ubHlPd25lciB7DQogICAgICAgIGlmIChzdGFydFRpbWUgIT0gMCkgdGhyb3c7IC8vIENyb3dkc2FsZSB3YXMgYWxyZWFkeSBzdGFydGVkDQogICAgICAgIHN0YXJ0VGltZSA9IG5vdyA7ICAgICAgICAgICAgDQogICAgICAgIGVuZFRpbWUgPSAgbm93ICsgQ1JPV0RTQUxFX1BFUklPRDsgICAgDQogICAgfQ0KICAgIC8qDQogICAgICogIFJlY2VpdmVzIGEgZG9uYXRpb24gaW4gRXRoZXINCiAgICAqLw0KICAgIGZ1bmN0aW9uIHJlY2VpdmVFVEgoYWRkcmVzcyBiZW5lZmljaWFyeSkgaW50ZXJuYWwgew0KICAgICAgICBpZiAobXNnLnZhbHVlIDwgTUlOX0lOVkVTVF9FVEhFUikgdGhyb3c7IC8vIERvbid0IGFjY2VwdCBmdW5kaW5nIHVuZGVyIGEgcHJlZGVmaW5lZCB0aHJlc2hvbGQNCiAgICAgICAgDQogICAgICAgIHVpbnQgY29pblRvU2VuZCA9IGJvbnVzKG1zZy52YWx1ZS5tdWwoQ09JTl9QRVJfRVRIRVIpLmRpdigxIGV0aGVyKSk7IC8vIENvbXB1dGUgdGhlIG51bWJlciBvZiBTa2luQ29pbiB0byBzZW5kDQogICAgICAgIGlmIChjb2luVG9TZW5kLmFkZChjb2luU2VudFRvRXRoZXIpID4gTUFYX0NBUCkgdGhyb3c7ICAgIA0KICAgICAgICBCYWNrZXIgYmFja2VyID0gYmFja2Vyc1tiZW5lZmljaWFyeV07DQogICAgICAgIGNvaW4udHJhbnNmZXIoYmVuZWZpY2lhcnksIGNvaW5Ub1NlbmQpOyAvLyBUcmFuc2ZlciBTa2luQ29pbnMgcmlnaHQgbm93IA0KICAgICAgICBiYWNrZXIuY29pblNlbnQgPSBiYWNrZXIuY29pblNlbnQuYWRkKGNvaW5Ub1NlbmQpOw0KICAgICAgICBiYWNrZXIud2VpUmVjZWl2ZWQgPSBiYWNrZXIud2VpUmVjZWl2ZWQuYWRkKG1zZy52YWx1ZSk7IC8vIFVwZGF0ZSB0aGUgdG90YWwgd2VpIGNvbGxlY3RlZCBkdXJpbmcgdGhlIGNyb3dkZnVuZGluZyBmb3IgdGhpcyBiYWNrZXIgICAgDQogICAgICAgIGV0aGVyUmVjZWl2ZWQgPSBldGhlclJlY2VpdmVkLmFkZChtc2cudmFsdWUpOyAvLyBVcGRhdGUgdGhlIHRvdGFsIHdlaSBjb2xsZWN0ZWQgZHVyaW5nIHRoZSBjcm93ZGZ1bmRpbmcNCiAgICAgICAgY29pblNlbnRUb0V0aGVyID0gY29pblNlbnRUb0V0aGVyLmFkZChjb2luVG9TZW5kKTsNCiAgICAgICAgLy8gU2VuZCBldmVudHMNCiAgICAgICAgTG9nQ29pbnNFbWl0ZWQobXNnLnNlbmRlciAsY29pblRvU2VuZCk7DQogICAgICAgIExvZ1JlY2VpdmVkRVRIKGJlbmVmaWNpYXJ5LCBldGhlclJlY2VpdmVkKTsgDQogICAgfQ0KICAgIA0KICAgIC8qDQogICAgICpDb21wdXRlIHRoZSBTa2luQ29pbiBib251cyBhY2NvcmRpbmcgdG8gdGhlIGludmVzdG1lbnQgcGVyaW9kDQogICAgICovDQogICAgZnVuY3Rpb24gYm9udXModWludCBhbW91bnQpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgaWYgKG5vdyA8IHN0YXJ0VGltZS5hZGQoMiBkYXlzKSkgcmV0dXJuIGFtb3VudC5hZGQoYW1vdW50LmRpdig1KSk7ICAgLy8gYm9udXMgMjAlDQogICAgICAgIHJldHVybiBhbW91bnQ7DQogICAgfQ0KICAgIC8qICANCiAgICAgKiBGaW5hbGl6ZSB0aGUgY3Jvd2RzYWxlLCBzaG91bGQgYmUgY2FsbGVkIGFmdGVyIHRoZSByZWZ1bmQgcGVyaW9kDQogICAgKi8NCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciBwdWJsaWMgew0KICAgICAgICBpZiAobm93IDwgZW5kVGltZSkgeyAvLyBDYW5ub3QgZmluYWxpc2UgYmVmb3JlIENST1dEU0FMRV9QRVJJT0Qgb3IgYmVmb3JlIHNlbGxpbmcgYWxsIGNvaW5zDQogICAgICAgICAgICBpZiAoY29pblNlbnRUb0V0aGVyID09IE1BWF9DQVApIHsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvaW5TZW50VG9FdGhlciA8IE1JTl9DQVAgJiYgbm93IDwgZW5kVGltZSArIDE1IGRheXMpIHRocm93OyAvLyBJZiBNSU5fQ0FQIGlzIG5vdCByZWFjaGVkIGRvbm9ycyBoYXZlIDE1ZGF5cyB0byBnZXQgcmVmdW5kIGJlZm9yZSB3ZSBjYW4gZmluYWxpc2UNCiAgICAgICAgaWYgKCFtdWx0aXNpZ0V0aGVyLnNlbmQodGhpcy5iYWxhbmNlKSkgdGhyb3c7IC8vIE1vdmUgdGhlIHJlbWFpbmluZyBFdGhlciB0byB0aGUgbXVsdGlzaWcgYWRkcmVzcw0KICAgICAgICANCiAgICAgICAgdWludCByZW1haW5zID0gY29pbi5iYWxhbmNlT2YodGhpcyk7DQogICAgICAgIGlmIChyZW1haW5zID4gMCkgeyAvLyBCdXJuIHRoZSByZXN0IG9mIFNraW5Db2lucw0KICAgICAgICAgICAgaWYgKCFjb2luLmJ1cm4ocmVtYWlucykpIHRocm93IDsNCiAgICAgICAgfQ0KICAgICAgICBjcm93ZHNhbGVDbG9zZWQgPSB0cnVlOw0KICAgIH0NCiAgICAvKiAgDQogICAgKiBGYWlsc2FmZSBkcmFpbg0KICAgICovDQogICAgZnVuY3Rpb24gZHJhaW4oKSBvbmx5T3duZXIgew0KICAgICAgICBpZiAoIW93bmVyLnNlbmQodGhpcy5iYWxhbmNlKSkgdGhyb3c7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEFsbG93IHRvIGNoYW5nZSB0aGUgdGVhbSBtdWx0aXNpZyBhZGRyZXNzIGluIHRoZSBjYXNlIG9mIGVtZXJnZW5jeS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzZXRNdWx0aXNpZyhhZGRyZXNzIGFkZHIpIG9ubHlPd25lciBwdWJsaWMgew0KICAgICAgICBpZiAoYWRkciA9PSBhZGRyZXNzKDApKSB0aHJvdzsNCiAgICAgICAgbXVsdGlzaWdFdGhlciA9IGFkZHI7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIE1hbnVhbGx5IGJhY2sgU2tpbkNvaW4gb3duZXIgYWRkcmVzcy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYWNrU2tpbkNvaW5Pd25lcigpIG9ubHlPd25lciBwdWJsaWMgew0KICAgICAgICBjb2luLnRyYW5zZmVyT3duZXJzaGlwKG93bmVyKTsNCiAgICB9DQogICAgLyoqDQogICAgICogVHJhbnNmZXIgcmVtYWlucyB0byBvd25lciBpbiBjYXNlIGlmIGltcG9zc2libGUgdG8gZG8gbWluIGludmVzdA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGdldFJlbWFpbkNvaW5zKCkgb25seU93bmVyIHB1YmxpYyB7DQogICAgICAgIHZhciByZW1haW5zID0gTUFYX0NBUCAtIGNvaW5TZW50VG9FdGhlcjsNCiAgICAgICAgdWludCBtaW5Db2luc1RvU2VsbCA9IGJvbnVzKE1JTl9JTlZFU1RfRVRIRVIubXVsKENPSU5fUEVSX0VUSEVSKSAvICgxIGV0aGVyKSk7DQogICAgICAgIGlmKHJlbWFpbnMgPiBtaW5Db2luc1RvU2VsbCkgdGhyb3c7DQogICAgICAgIEJhY2tlciBiYWNrZXIgPSBiYWNrZXJzW293bmVyXTsNCiAgICAgICAgY29pbi50cmFuc2Zlcihvd25lciwgcmVtYWlucyk7IC8vIFRyYW5zZmVyIFNraW5Db2lucyByaWdodCBub3cgDQogICAgICAgIGJhY2tlci5jb2luU2VudCA9IGJhY2tlci5jb2luU2VudC5hZGQocmVtYWlucyk7DQogICAgICAgIGNvaW5TZW50VG9FdGhlciA9IGNvaW5TZW50VG9FdGhlci5hZGQocmVtYWlucyk7DQogICAgICAgIC8vIFNlbmQgZXZlbnRzDQogICAgICAgIExvZ0NvaW5zRW1pdGVkKHRoaXMgLHJlbWFpbnMpOw0KICAgICAgICBMb2dSZWNlaXZlZEVUSChvd25lciwgZXRoZXJSZWNlaXZlZCk7IA0KICAgIH0NCiAgICAvKiANCiAgICAgKiBXaGVuIE1JTl9DQVAgaXMgbm90IHJlYWNoOg0KICAgICAqIDEpIGJhY2tlciBjYWxsIHRoZSAiYXBwcm92ZSIgZnVuY3Rpb24gb2YgdGhlIFNraW5Db2luIHRva2VuIGNvbnRyYWN0IHdpdGggdGhlIGFtb3VudCBvZiBhbGwgU2tpbkNvaW5zIHRoZXkgZ290IGluIG9yZGVyIHRvIGJlIHJlZnVuZA0KICAgICAqIDIpIGJhY2tlciBjYWxsIHRoZSAicmVmdW5kIiBmdW5jdGlvbiBvZiB0aGUgQ3Jvd2RzYWxlIGNvbnRyYWN0IHdpdGggdGhlIHNhbWUgYW1vdW50IG9mIFNraW5Db2lucw0KICAgICAqIDMpIGJhY2tlciBjYWxsIHRoZSAid2l0aGRyYXdQYXltZW50cyIgZnVuY3Rpb24gb2YgdGhlIENyb3dkc2FsZSBjb250cmFjdCB0byBnZXQgYSByZWZ1bmQgaW4gRVRIDQogICAgICovDQogICAgZnVuY3Rpb24gcmVmdW5kKHVpbnQgX3ZhbHVlKSBtaW5DYXBOb3RSZWFjaGVkIHB1YmxpYyB7DQogICAgICAgIA0KICAgICAgICBpZiAoX3ZhbHVlICE9IGJhY2tlcnNbbXNnLnNlbmRlcl0uY29pblNlbnQpIHRocm93OyAvLyBjb21wYXJlIHZhbHVlIGZyb20gYmFja2VyIGJhbGFuY2UNCiAgICAgICAgY29pbi50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgYWRkcmVzcyh0aGlzKSwgX3ZhbHVlKTsgLy8gZ2V0IHRoZSB0b2tlbiBiYWNrIHRvIHRoZSBjcm93ZHNhbGUgY29udHJhY3QNCiAgICAgICAgaWYgKCFjb2luLmJ1cm4oX3ZhbHVlKSkgdGhyb3cgOyAvLyB0b2tlbiBzZW50IGZvciByZWZ1bmQgYXJlIGJ1cm50DQogICAgICAgIHVpbnQgRVRIVG9TZW5kID0gYmFja2Vyc1ttc2cuc2VuZGVyXS53ZWlSZWNlaXZlZDsNCiAgICAgICAgYmFja2Vyc1ttc2cuc2VuZGVyXS53ZWlSZWNlaXZlZD0wOw0KICAgICAgICBpZiAoRVRIVG9TZW5kID4gMCkgew0KICAgICAgICAgICAgYXN5bmNTZW5kKG1zZy5zZW5kZXIsIEVUSFRvU2VuZCk7IC8vIHB1bGwgcGF5bWVudCB0byBnZXQgcmVmdW5kIGluIEVUSA0KICAgICAgICB9DQogICAgfQ0KfQ=='