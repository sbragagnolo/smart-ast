base 64 content
base64cryptoPunksMarket
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KY29udHJhY3QgQ3J5cHRvUHVua3NNYXJrZXQgew0KDQogICAgLy8gWW91IGNhbiB1c2UgdGhpcyBoYXNoIHRvIHZlcmlmeSB0aGUgaW1hZ2UgZmlsZSBjb250YWluaW5nIGFsbCB0aGUgcHVua3MNCiAgICBzdHJpbmcgcHVibGljIGltYWdlSGFzaCA9ICJhYzM5YWY0NzkzMTE5ZWU0NmJiZmYzNTFkOGNiNmI1ZjIzZGE2MDIyMjEyNmFkZDQyNjhlMjYxMTk5YTI5MjFiIjsNCg0KICAgIGFkZHJlc3Mgb3duZXI7DQoNCiAgICBzdHJpbmcgcHVibGljIHN0YW5kYXJkID0gJ0NyeXB0b1B1bmtzJzsNCiAgICBzdHJpbmcgcHVibGljIG5hbWU7DQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7DQogICAgdWludDggcHVibGljIGRlY2ltYWxzOw0KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5Ow0KDQogICAgdWludCBwdWJsaWMgbmV4dFB1bmtJbmRleFRvQXNzaWduID0gMDsNCg0KICAgIGJvb2wgcHVibGljIGFsbFB1bmtzQXNzaWduZWQgPSBmYWxzZTsNCiAgICB1aW50IHB1YmxpYyBwdW5rc1JlbWFpbmluZ1RvQXNzaWduID0gMDsNCg0KICAgIC8vbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgYWRkcmVzc1RvUHVua0luZGV4Ow0KICAgIG1hcHBpbmcgKHVpbnQgPT4gYWRkcmVzcykgcHVibGljIHB1bmtJbmRleFRvQWRkcmVzczsNCg0KICAgIC8qIFRoaXMgY3JlYXRlcyBhbiBhcnJheSB3aXRoIGFsbCBiYWxhbmNlcyAqLw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VPZjsNCg0KICAgIHN0cnVjdCBPZmZlciB7DQogICAgICAgIGJvb2wgaXNGb3JTYWxlOw0KICAgICAgICB1aW50IHB1bmtJbmRleDsNCiAgICAgICAgYWRkcmVzcyBzZWxsZXI7DQogICAgICAgIHVpbnQgbWluVmFsdWU7ICAgICAgICAgIC8vIGluIGV0aGVyDQogICAgICAgIGFkZHJlc3Mgb25seVNlbGxUbzsgICAgIC8vIHNwZWNpZnkgdG8gc2VsbCBvbmx5IHRvIGEgc3BlY2lmaWMgcGVyc29uDQogICAgfQ0KDQogICAgc3RydWN0IEJpZCB7DQogICAgICAgIGJvb2wgaGFzQmlkOw0KICAgICAgICB1aW50IHB1bmtJbmRleDsNCiAgICAgICAgYWRkcmVzcyBiaWRkZXI7DQogICAgICAgIHVpbnQgdmFsdWU7DQogICAgfQ0KDQogICAgLy8gQSByZWNvcmQgb2YgcHVua3MgdGhhdCBhcmUgb2ZmZXJlZCBmb3Igc2FsZSBhdCBhIHNwZWNpZmljIG1pbmltdW0gdmFsdWUsIGFuZCBwZXJoYXBzIHRvIGEgc3BlY2lmaWMgcGVyc29uDQogICAgbWFwcGluZyAodWludCA9PiBPZmZlcikgcHVibGljIHB1bmtzT2ZmZXJlZEZvclNhbGU7DQoNCiAgICAvLyBBIHJlY29yZCBvZiB0aGUgaGlnaGVzdCBwdW5rIGJpZA0KICAgIG1hcHBpbmcgKHVpbnQgPT4gQmlkKSBwdWJsaWMgcHVua0JpZHM7DQoNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBwZW5kaW5nV2l0aGRyYXdhbHM7DQoNCiAgICBldmVudCBBc3NpZ24oYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHB1bmtJbmRleCk7DQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7DQogICAgZXZlbnQgUHVua1RyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgcHVua0luZGV4KTsNCiAgICBldmVudCBQdW5rT2ZmZXJlZCh1aW50IGluZGV4ZWQgcHVua0luZGV4LCB1aW50IG1pblZhbHVlLCBhZGRyZXNzIGluZGV4ZWQgdG9BZGRyZXNzKTsNCiAgICBldmVudCBQdW5rQmlkRW50ZXJlZCh1aW50IGluZGV4ZWQgcHVua0luZGV4LCB1aW50IHZhbHVlLCBhZGRyZXNzIGluZGV4ZWQgZnJvbUFkZHJlc3MpOw0KICAgIGV2ZW50IFB1bmtCaWRXaXRoZHJhd24odWludCBpbmRleGVkIHB1bmtJbmRleCwgdWludCB2YWx1ZSwgYWRkcmVzcyBpbmRleGVkIGZyb21BZGRyZXNzKTsNCiAgICBldmVudCBQdW5rQm91Z2h0KHVpbnQgaW5kZXhlZCBwdW5rSW5kZXgsIHVpbnQgdmFsdWUsIGFkZHJlc3MgaW5kZXhlZCBmcm9tQWRkcmVzcywgYWRkcmVzcyBpbmRleGVkIHRvQWRkcmVzcyk7DQogICAgZXZlbnQgUHVua05vTG9uZ2VyRm9yU2FsZSh1aW50IGluZGV4ZWQgcHVua0luZGV4KTsNCg0KICAgIC8qIEluaXRpYWxpemVzIGNvbnRyYWN0IHdpdGggaW5pdGlhbCBzdXBwbHkgdG9rZW5zIHRvIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCAqLw0KICAgIGZ1bmN0aW9uIENyeXB0b1B1bmtzTWFya2V0KCkgcGF5YWJsZSB7DQogICAgICAgIC8vICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPSBpbml0aWFsU3VwcGx5OyAgICAgICAgICAgICAgLy8gR2l2ZSB0aGUgY3JlYXRvciBhbGwgaW5pdGlhbCB0b2tlbnMNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgICAgICB0b3RhbFN1cHBseSA9IDEwMDAwOyAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0b3RhbCBzdXBwbHkNCiAgICAgICAgcHVua3NSZW1haW5pbmdUb0Fzc2lnbiA9IHRvdGFsU3VwcGx5Ow0KICAgICAgICBuYW1lID0gIkNSWVBUT1BVTktTIjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZSBmb3IgZGlzcGxheSBwdXJwb3Nlcw0KICAgICAgICBzeW1ib2wgPSAiz74iOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbCBmb3IgZGlzcGxheSBwdXJwb3Nlcw0KICAgICAgICBkZWNpbWFscyA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW1vdW50IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2VzDQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0SW5pdGlhbE93bmVyKGFkZHJlc3MgdG8sIHVpbnQgcHVua0luZGV4KSB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsNCiAgICAgICAgaWYgKGFsbFB1bmtzQXNzaWduZWQpIHRocm93Ow0KICAgICAgICBpZiAocHVua0luZGV4ID49IDEwMDAwKSB0aHJvdzsNCiAgICAgICAgaWYgKHB1bmtJbmRleFRvQWRkcmVzc1twdW5rSW5kZXhdICE9IHRvKSB7DQogICAgICAgICAgICBpZiAocHVua0luZGV4VG9BZGRyZXNzW3B1bmtJbmRleF0gIT0gMHgwKSB7DQogICAgICAgICAgICAgICAgYmFsYW5jZU9mW3B1bmtJbmRleFRvQWRkcmVzc1twdW5rSW5kZXhdXS0tOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBwdW5rc1JlbWFpbmluZ1RvQXNzaWduLS07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwdW5rSW5kZXhUb0FkZHJlc3NbcHVua0luZGV4XSA9IHRvOw0KICAgICAgICAgICAgYmFsYW5jZU9mW3RvXSsrOw0KICAgICAgICAgICAgQXNzaWduKHRvLCBwdW5rSW5kZXgpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0SW5pdGlhbE93bmVycyhhZGRyZXNzW10gYWRkcmVzc2VzLCB1aW50W10gaW5kaWNlcykgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7DQogICAgICAgIHVpbnQgbiA9IGFkZHJlc3Nlcy5sZW5ndGg7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG47IGkrKykgew0KICAgICAgICAgICAgc2V0SW5pdGlhbE93bmVyKGFkZHJlc3Nlc1tpXSwgaW5kaWNlc1tpXSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhbGxJbml0aWFsT3duZXJzQXNzaWduZWQoKSB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsNCiAgICAgICAgYWxsUHVua3NBc3NpZ25lZCA9IHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0UHVuayh1aW50IHB1bmtJbmRleCkgew0KICAgICAgICBpZiAoIWFsbFB1bmtzQXNzaWduZWQpIHRocm93Ow0KICAgICAgICBpZiAocHVua3NSZW1haW5pbmdUb0Fzc2lnbiA9PSAwKSB0aHJvdzsNCiAgICAgICAgaWYgKHB1bmtJbmRleFRvQWRkcmVzc1twdW5rSW5kZXhdICE9IDB4MCkgdGhyb3c7DQogICAgICAgIGlmIChwdW5rSW5kZXggPj0gMTAwMDApIHRocm93Ow0KICAgICAgICBwdW5rSW5kZXhUb0FkZHJlc3NbcHVua0luZGV4XSA9IG1zZy5zZW5kZXI7DQogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSsrOw0KICAgICAgICBwdW5rc1JlbWFpbmluZ1RvQXNzaWduLS07DQogICAgICAgIEFzc2lnbihtc2cuc2VuZGVyLCBwdW5rSW5kZXgpOw0KICAgIH0NCg0KICAgIC8vIFRyYW5zZmVyIG93bmVyc2hpcCBvZiBhIHB1bmsgdG8gYW5vdGhlciB1c2VyIHdpdGhvdXQgcmVxdWlyaW5nIHBheW1lbnQNCiAgICBmdW5jdGlvbiB0cmFuc2ZlclB1bmsoYWRkcmVzcyB0bywgdWludCBwdW5rSW5kZXgpIHsNCiAgICAgICAgaWYgKCFhbGxQdW5rc0Fzc2lnbmVkKSB0aHJvdzsNCiAgICAgICAgaWYgKHB1bmtJbmRleFRvQWRkcmVzc1twdW5rSW5kZXhdICE9IG1zZy5zZW5kZXIpIHRocm93Ow0KICAgICAgICBpZiAocHVua0luZGV4ID49IDEwMDAwKSB0aHJvdzsNCiAgICAgICAgaWYgKHB1bmtzT2ZmZXJlZEZvclNhbGVbcHVua0luZGV4XS5pc0ZvclNhbGUpIHsNCiAgICAgICAgICAgIHB1bmtOb0xvbmdlckZvclNhbGUocHVua0luZGV4KTsNCiAgICAgICAgfQ0KICAgICAgICBwdW5rSW5kZXhUb0FkZHJlc3NbcHVua0luZGV4XSA9IHRvOw0KICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0tLTsNCiAgICAgICAgYmFsYW5jZU9mW3RvXSsrOw0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgMSk7DQogICAgICAgIFB1bmtUcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgcHVua0luZGV4KTsNCiAgICAgICAgLy8gQ2hlY2sgZm9yIHRoZSBjYXNlIHdoZXJlIHRoZXJlIGlzIGEgYmlkIGZyb20gdGhlIG5ldyBvd25lciBhbmQgcmVmdW5kIGl0Lg0KICAgICAgICAvLyBBbnkgb3RoZXIgYmlkIGNhbiBzdGF5IGluIHBsYWNlLg0KICAgICAgICBCaWQgYmlkID0gcHVua0JpZHNbcHVua0luZGV4XTsNCiAgICAgICAgaWYgKGJpZC5iaWRkZXIgPT0gdG8pIHsNCiAgICAgICAgICAgIC8vIEtpbGwgYmlkIGFuZCByZWZ1bmQgdmFsdWUNCiAgICAgICAgICAgIHBlbmRpbmdXaXRoZHJhd2Fsc1t0b10gKz0gYmlkLnZhbHVlOw0KICAgICAgICAgICAgcHVua0JpZHNbcHVua0luZGV4XSA9IEJpZChmYWxzZSwgcHVua0luZGV4LCAweDAsIDApOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHVua05vTG9uZ2VyRm9yU2FsZSh1aW50IHB1bmtJbmRleCkgew0KICAgICAgICBpZiAoIWFsbFB1bmtzQXNzaWduZWQpIHRocm93Ow0KICAgICAgICBpZiAocHVua0luZGV4VG9BZGRyZXNzW3B1bmtJbmRleF0gIT0gbXNnLnNlbmRlcikgdGhyb3c7DQogICAgICAgIGlmIChwdW5rSW5kZXggPj0gMTAwMDApIHRocm93Ow0KICAgICAgICBwdW5rc09mZmVyZWRGb3JTYWxlW3B1bmtJbmRleF0gPSBPZmZlcihmYWxzZSwgcHVua0luZGV4LCBtc2cuc2VuZGVyLCAwLCAweDApOw0KICAgICAgICBQdW5rTm9Mb25nZXJGb3JTYWxlKHB1bmtJbmRleCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb2ZmZXJQdW5rRm9yU2FsZSh1aW50IHB1bmtJbmRleCwgdWludCBtaW5TYWxlUHJpY2VJbldlaSkgew0KICAgICAgICBpZiAoIWFsbFB1bmtzQXNzaWduZWQpIHRocm93Ow0KICAgICAgICBpZiAocHVua0luZGV4VG9BZGRyZXNzW3B1bmtJbmRleF0gIT0gbXNnLnNlbmRlcikgdGhyb3c7DQogICAgICAgIGlmIChwdW5rSW5kZXggPj0gMTAwMDApIHRocm93Ow0KICAgICAgICBwdW5rc09mZmVyZWRGb3JTYWxlW3B1bmtJbmRleF0gPSBPZmZlcih0cnVlLCBwdW5rSW5kZXgsIG1zZy5zZW5kZXIsIG1pblNhbGVQcmljZUluV2VpLCAweDApOw0KICAgICAgICBQdW5rT2ZmZXJlZChwdW5rSW5kZXgsIG1pblNhbGVQcmljZUluV2VpLCAweDApOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9mZmVyUHVua0ZvclNhbGVUb0FkZHJlc3ModWludCBwdW5rSW5kZXgsIHVpbnQgbWluU2FsZVByaWNlSW5XZWksIGFkZHJlc3MgdG9BZGRyZXNzKSB7DQogICAgICAgIGlmICghYWxsUHVua3NBc3NpZ25lZCkgdGhyb3c7DQogICAgICAgIGlmIChwdW5rSW5kZXhUb0FkZHJlc3NbcHVua0luZGV4XSAhPSBtc2cuc2VuZGVyKSB0aHJvdzsNCiAgICAgICAgaWYgKHB1bmtJbmRleCA+PSAxMDAwMCkgdGhyb3c7DQogICAgICAgIHB1bmtzT2ZmZXJlZEZvclNhbGVbcHVua0luZGV4XSA9IE9mZmVyKHRydWUsIHB1bmtJbmRleCwgbXNnLnNlbmRlciwgbWluU2FsZVByaWNlSW5XZWksIHRvQWRkcmVzcyk7DQogICAgICAgIFB1bmtPZmZlcmVkKHB1bmtJbmRleCwgbWluU2FsZVByaWNlSW5XZWksIHRvQWRkcmVzcyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYnV5UHVuayh1aW50IHB1bmtJbmRleCkgcGF5YWJsZSB7DQogICAgICAgIGlmICghYWxsUHVua3NBc3NpZ25lZCkgdGhyb3c7DQogICAgICAgIE9mZmVyIG9mZmVyID0gcHVua3NPZmZlcmVkRm9yU2FsZVtwdW5rSW5kZXhdOw0KICAgICAgICBpZiAocHVua0luZGV4ID49IDEwMDAwKSB0aHJvdzsNCiAgICAgICAgaWYgKCFvZmZlci5pc0ZvclNhbGUpIHRocm93OyAgICAgICAgICAgICAgICAvLyBwdW5rIG5vdCBhY3R1YWxseSBmb3Igc2FsZQ0KICAgICAgICBpZiAob2ZmZXIub25seVNlbGxUbyAhPSAweDAgJiYgb2ZmZXIub25seVNlbGxUbyAhPSBtc2cuc2VuZGVyKSB0aHJvdzsgIC8vIHB1bmsgbm90IHN1cHBvc2VkIHRvIGJlIHNvbGQgdG8gdGhpcyB1c2VyDQogICAgICAgIGlmIChtc2cudmFsdWUgPCBvZmZlci5taW5WYWx1ZSkgdGhyb3c7ICAgICAgLy8gRGlkbid0IHNlbmQgZW5vdWdoIEVUSA0KICAgICAgICBpZiAob2ZmZXIuc2VsbGVyICE9IHB1bmtJbmRleFRvQWRkcmVzc1twdW5rSW5kZXhdKSB0aHJvdzsgLy8gU2VsbGVyIG5vIGxvbmdlciBvd25lciBvZiBwdW5rDQoNCiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBvZmZlci5zZWxsZXI7DQoNCiAgICAgICAgcHVua0luZGV4VG9BZGRyZXNzW3B1bmtJbmRleF0gPSBtc2cuc2VuZGVyOw0KICAgICAgICBiYWxhbmNlT2Zbc2VsbGVyXS0tOw0KICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0rKzsNCiAgICAgICAgVHJhbnNmZXIoc2VsbGVyLCBtc2cuc2VuZGVyLCAxKTsNCg0KICAgICAgICBwdW5rTm9Mb25nZXJGb3JTYWxlKHB1bmtJbmRleCk7DQogICAgICAgIHBlbmRpbmdXaXRoZHJhd2Fsc1tzZWxsZXJdICs9IG1zZy52YWx1ZTsNCiAgICAgICAgUHVua0JvdWdodChwdW5rSW5kZXgsIG1zZy52YWx1ZSwgc2VsbGVyLCBtc2cuc2VuZGVyKTsNCg0KICAgICAgICAvLyBDaGVjayBmb3IgdGhlIGNhc2Ugd2hlcmUgdGhlcmUgaXMgYSBiaWQgZnJvbSB0aGUgbmV3IG93bmVyIGFuZCByZWZ1bmQgaXQuDQogICAgICAgIC8vIEFueSBvdGhlciBiaWQgY2FuIHN0YXkgaW4gcGxhY2UuDQogICAgICAgIEJpZCBiaWQgPSBwdW5rQmlkc1twdW5rSW5kZXhdOw0KICAgICAgICBpZiAoYmlkLmJpZGRlciA9PSBtc2cuc2VuZGVyKSB7DQogICAgICAgICAgICAvLyBLaWxsIGJpZCBhbmQgcmVmdW5kIHZhbHVlDQogICAgICAgICAgICBwZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gKz0gYmlkLnZhbHVlOw0KICAgICAgICAgICAgcHVua0JpZHNbcHVua0luZGV4XSA9IEJpZChmYWxzZSwgcHVua0luZGV4LCAweDAsIDApOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSB7DQogICAgICAgIGlmICghYWxsUHVua3NBc3NpZ25lZCkgdGhyb3c7DQogICAgICAgIHVpbnQgYW1vdW50ID0gcGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdOw0KICAgICAgICAvLyBSZW1lbWJlciB0byB6ZXJvIHRoZSBwZW5kaW5nIHJlZnVuZCBiZWZvcmUNCiAgICAgICAgLy8gc2VuZGluZyB0byBwcmV2ZW50IHJlLWVudHJhbmN5IGF0dGFja3MNCiAgICAgICAgcGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdID0gMDsNCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihhbW91bnQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGVudGVyQmlkRm9yUHVuayh1aW50IHB1bmtJbmRleCkgcGF5YWJsZSB7DQogICAgICAgIGlmIChwdW5rSW5kZXggPj0gMTAwMDApIHRocm93Ow0KICAgICAgICBpZiAoIWFsbFB1bmtzQXNzaWduZWQpIHRocm93OyAgICAgICAgICAgICAgICANCiAgICAgICAgaWYgKHB1bmtJbmRleFRvQWRkcmVzc1twdW5rSW5kZXhdID09IDB4MCkgdGhyb3c7DQogICAgICAgIGlmIChwdW5rSW5kZXhUb0FkZHJlc3NbcHVua0luZGV4XSA9PSBtc2cuc2VuZGVyKSB0aHJvdzsNCiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSAwKSB0aHJvdzsNCiAgICAgICAgQmlkIGV4aXN0aW5nID0gcHVua0JpZHNbcHVua0luZGV4XTsNCiAgICAgICAgaWYgKG1zZy52YWx1ZSA8PSBleGlzdGluZy52YWx1ZSkgdGhyb3c7DQogICAgICAgIGlmIChleGlzdGluZy52YWx1ZSA+IDApIHsNCiAgICAgICAgICAgIC8vIFJlZnVuZCB0aGUgZmFpbGluZyBiaWQNCiAgICAgICAgICAgIHBlbmRpbmdXaXRoZHJhd2Fsc1tleGlzdGluZy5iaWRkZXJdICs9IGV4aXN0aW5nLnZhbHVlOw0KICAgICAgICB9DQogICAgICAgIHB1bmtCaWRzW3B1bmtJbmRleF0gPSBCaWQodHJ1ZSwgcHVua0luZGV4LCBtc2cuc2VuZGVyLCBtc2cudmFsdWUpOw0KICAgICAgICBQdW5rQmlkRW50ZXJlZChwdW5rSW5kZXgsIG1zZy52YWx1ZSwgbXNnLnNlbmRlcik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWNjZXB0QmlkRm9yUHVuayh1aW50IHB1bmtJbmRleCwgdWludCBtaW5QcmljZSkgew0KICAgICAgICBpZiAocHVua0luZGV4ID49IDEwMDAwKSB0aHJvdzsNCiAgICAgICAgaWYgKCFhbGxQdW5rc0Fzc2lnbmVkKSB0aHJvdzsgICAgICAgICAgICAgICAgDQogICAgICAgIGlmIChwdW5rSW5kZXhUb0FkZHJlc3NbcHVua0luZGV4XSAhPSBtc2cuc2VuZGVyKSB0aHJvdzsNCiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBtc2cuc2VuZGVyOw0KICAgICAgICBCaWQgYmlkID0gcHVua0JpZHNbcHVua0luZGV4XTsNCiAgICAgICAgaWYgKGJpZC52YWx1ZSA9PSAwKSB0aHJvdzsNCiAgICAgICAgaWYgKGJpZC52YWx1ZSA8IG1pblByaWNlKSB0aHJvdzsNCg0KICAgICAgICBwdW5rSW5kZXhUb0FkZHJlc3NbcHVua0luZGV4XSA9IGJpZC5iaWRkZXI7DQogICAgICAgIGJhbGFuY2VPZltzZWxsZXJdLS07DQogICAgICAgIGJhbGFuY2VPZltiaWQuYmlkZGVyXSsrOw0KICAgICAgICBUcmFuc2ZlcihzZWxsZXIsIGJpZC5iaWRkZXIsIDEpOw0KDQogICAgICAgIHB1bmtzT2ZmZXJlZEZvclNhbGVbcHVua0luZGV4XSA9IE9mZmVyKGZhbHNlLCBwdW5rSW5kZXgsIGJpZC5iaWRkZXIsIDAsIDB4MCk7DQogICAgICAgIHVpbnQgYW1vdW50ID0gYmlkLnZhbHVlOw0KICAgICAgICBwdW5rQmlkc1twdW5rSW5kZXhdID0gQmlkKGZhbHNlLCBwdW5rSW5kZXgsIDB4MCwgMCk7DQogICAgICAgIHBlbmRpbmdXaXRoZHJhd2Fsc1tzZWxsZXJdICs9IGFtb3VudDsNCiAgICAgICAgUHVua0JvdWdodChwdW5rSW5kZXgsIGJpZC52YWx1ZSwgc2VsbGVyLCBiaWQuYmlkZGVyKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JpZEZvclB1bmsodWludCBwdW5rSW5kZXgpIHsNCiAgICAgICAgaWYgKHB1bmtJbmRleCA+PSAxMDAwMCkgdGhyb3c7DQogICAgICAgIGlmICghYWxsUHVua3NBc3NpZ25lZCkgdGhyb3c7ICAgICAgICAgICAgICAgIA0KICAgICAgICBpZiAocHVua0luZGV4VG9BZGRyZXNzW3B1bmtJbmRleF0gPT0gMHgwKSB0aHJvdzsNCiAgICAgICAgaWYgKHB1bmtJbmRleFRvQWRkcmVzc1twdW5rSW5kZXhdID09IG1zZy5zZW5kZXIpIHRocm93Ow0KICAgICAgICBCaWQgYmlkID0gcHVua0JpZHNbcHVua0luZGV4XTsNCiAgICAgICAgaWYgKGJpZC5iaWRkZXIgIT0gbXNnLnNlbmRlcikgdGhyb3c7DQogICAgICAgIFB1bmtCaWRXaXRoZHJhd24ocHVua0luZGV4LCBiaWQudmFsdWUsIG1zZy5zZW5kZXIpOw0KICAgICAgICB1aW50IGFtb3VudCA9IGJpZC52YWx1ZTsNCiAgICAgICAgcHVua0JpZHNbcHVua0luZGV4XSA9IEJpZChmYWxzZSwgcHVua0luZGV4LCAweDAsIDApOw0KICAgICAgICAvLyBSZWZ1bmQgdGhlIGJpZCBtb25leQ0KICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudCk7DQogICAgfQ0KDQp9'