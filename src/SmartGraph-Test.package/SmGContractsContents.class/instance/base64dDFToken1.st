base 64 content
base64dDFToken1
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KDQovKg0KICogT3duYWJsZQ0KICoNCiAqIEJhc2UgY29udHJhY3Qgd2l0aCBhbiBvd25lci4NCiAqIFByb3ZpZGVzIG9ubHlPd25lciBtb2RpZmllciwgd2hpY2ggcHJldmVudHMgZnVuY3Rpb24gZnJvbSBydW5uaW5nIGlmIGl0IGlzIGNhbGxlZCBieSBhbnlvbmUgb3RoZXIgdGhhbiB0aGUgb3duZXIuDQogKi8NCmNvbnRyYWN0IE93bmFibGUgew0KICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCg0KICBmdW5jdGlvbiBPd25hYmxlKCkgew0KICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsNCiAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICAgIF87DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgew0KICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7DQogICAgICBvd25lciA9IG5ld093bmVyOw0KICAgIH0NCiAgfQ0KDQp9DQoNCi8qIHRha2luZyBpZGVhcyBmcm9tIEZpcnN0Qmxvb2QgdG9rZW4gKi8NCmNvbnRyYWN0IFNhZmVNYXRoIHsNCg0KICAgIC8qIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgeyAqLw0KICAgIC8qICAgaWYgKCFhc3NlcnRpb24pIHsgKi8NCiAgICAvKiAgICAgdGhyb3c7ICovDQogICAgLyogICB9ICovDQogICAgLyogfSAgICAgIC8vIGFzc2VydCBubyBsb25nZXIgbmVlZGVkIG9uY2Ugc29saWRpdHkgaXMgb24gMC40LjEwICovDQoNCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQyNTYgeCwgdWludDI1NiB5KSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsNCiAgICAgIHVpbnQyNTYgeiA9IHggKyB5Ow0KICAgICAgYXNzZXJ0KCh6ID49IHgpICYmICh6ID49IHkpKTsNCiAgICAgIHJldHVybiB6Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNhZmVTdWJ0cmFjdCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgaW50ZXJuYWwgcmV0dXJucyh1aW50MjU2KSB7DQogICAgICBhc3NlcnQoeCA+PSB5KTsNCiAgICAgIHVpbnQyNTYgeiA9IHggLSB5Ow0KICAgICAgcmV0dXJuIHo7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2FmZU11bHQodWludDI1NiB4LCB1aW50MjU2IHkpIGludGVybmFsIHJldHVybnModWludDI1Nikgew0KICAgICAgdWludDI1NiB6ID0geCAqIHk7DQogICAgICBhc3NlcnQoKHggPT0gMCl8fCh6L3ggPT0geSkpOw0KICAgICAgcmV0dXJuIHo7DQogICAgfQ0KDQp9DQoNCmNvbnRyYWN0IFRva2VuIHsNCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsNCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7DQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsNCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsNCn0NCg0KDQovKiAgRVJDIDIwIHRva2VuICovDQpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIFRva2VuIHsNCg0KICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBzaXplKSB7DQogICAgIGlmKG1zZy5kYXRhLmxlbmd0aCA8IHNpemUgKyA0KSB7DQogICAgICAgdGhyb3c7DQogICAgIH0NCiAgICAgXzsNCiAgfQ0KDQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7DQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IF92YWx1ZTsNCiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7DQogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgew0KICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsNCiAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsNCiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOw0KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgew0KICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7DQogICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgICB9DQoNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsNCn0NCg0KY29udHJhY3Qgc3BsaXR0ZXJDb250cmFjdCBpcyBPd25hYmxlew0KDQogICAgZXZlbnQgZXYoc3RyaW5nIG1zZywgYWRkcmVzcyB3aG9tLCB1aW50MjU2IHZhbCk7DQoNCiAgICBzdHJ1Y3QgeFJlYyB7DQogICAgICAgIGJvb2wgaW5MaXN0Ow0KICAgICAgICBhZGRyZXNzIG5leHQ7DQogICAgICAgIGFkZHJlc3MgcHJldjsNCiAgICAgICAgdWludDI1NiB2YWw7DQogICAgfQ0KDQogICAgc3RydWN0IGw4ciB7DQogICAgICAgIGFkZHJlc3Mgd2hvbTsNCiAgICAgICAgdWludDI1NiB2YWw7DQogICAgfQ0KICAgIGFkZHJlc3MgcHVibGljIG15QWRkcmVzcyA9IHRoaXM7DQogICAgYWRkcmVzcyBwdWJsaWMgZmlyc3Q7DQogICAgYWRkcmVzcyBwdWJsaWMgbGFzdDsNCiAgICBhZGRyZXNzIHB1YmxpYyBkZGY7DQogICAgYm9vbCAgICBwdWJsaWMgdGhpbmtNb2RlOw0KICAgIHVpbnQyNTYgcHVibGljIHBvczsNCg0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4geFJlYykgcHVibGljIHRoZUxpc3Q7DQoNCiAgICBsOHJbXSAgYWZ0ZXJQYXJ0eTsNCg0KICAgIG1vZGlmaWVyIG9ubHlNZU9yRERGKCkgew0KICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBkZGYgfHwgbXNnLnNlbmRlciA9PSBteUFkZHJlc3MgfHwgbXNnLnNlbmRlciA9PSBvd25lcikgew0KICAgICAgICAgICAgXzsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldERERihhZGRyZXNzIGRkZl8pIG9ubHlPd25lciB7DQogICAgICAgIGRkZiA9IGRkZl87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3BsaXR0ZXJDb250cmFjdChhZGRyZXNzIHNlZWQsIHVpbnQyNTYgc2VlZFZhbCkgew0KICAgICAgICBmaXJzdCA9IHNlZWQ7DQogICAgICAgIGxhc3QgPSBzZWVkOw0KICAgICAgICB0aGVMaXN0W3NlZWRdID0geFJlYyh0cnVlLDB4MCwweDAsc2VlZFZhbCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3RhcnRUaGlua2luZygpIG9ubHlPd25lciB7DQogICAgICAgIHRoaW5rTW9kZSA9IHRydWU7DQogICAgICAgIHBvcyA9IDA7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3RvcFRoaW5raW5nKHVpbnQyNTYgbnVtKSBvbmx5T3duZXIgew0KICAgICAgICB0aGlua01vZGUgPSBmYWxzZTsNCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgbnVtOyBpKyspIHsNCiAgICAgICAgICAgIGlmIChwb3MgPj0gYWZ0ZXJQYXJ0eS5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBkZWxldGUgYWZ0ZXJQYXJ0eTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICB1cGRhdGUoYWZ0ZXJQYXJ0eVtwb3NdLndob20sYWZ0ZXJQYXJ0eVtwb3NdLnZhbCk7DQogICAgICAgICAgICBwb3MrKzsNCiAgICAgICAgfQ0KICAgICAgICB0aGlua01vZGUgPSB0cnVlOw0KICAgIH0gDQoNCiAgICBmdW5jdGlvbiB0aGlua0xlbmd0aCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgcmV0dXJuIGFmdGVyUGFydHkubGVuZ3RoOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFkZFJlYzRMOFIoYWRkcmVzcyB3aG9tLCB1aW50MjU2IHZhbCkgaW50ZXJuYWwgew0KICAgICAgICBhZnRlclBhcnR5LnB1c2gobDhyKHdob20sdmFsKSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWRkKGFkZHJlc3Mgd2hvbSwgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgew0KICAgICAgICB0aGVMaXN0W3dob21dID0geFJlYyh0cnVlLDB4MCxsYXN0LHZhbHVlKTsNCiAgICAgICAgdGhlTGlzdFtsYXN0XS5uZXh0ID0gd2hvbTsNCiAgICAgICAgbGFzdCA9IHdob207DQogICAgICAgIGV2KCJhZGQiLHdob20sdmFsdWUpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlbW92ZShhZGRyZXNzIHdob20pIGludGVybmFsIHsNCiAgICAgICAgaWYgKGZpcnN0ID09IHdob20pIHsNCiAgICAgICAgICAgIGZpcnN0ID0gdGhlTGlzdFt3aG9tXS5uZXh0Ow0KICAgICAgICAgICAgdGhlTGlzdFt3aG9tXSA9IHhSZWMoZmFsc2UsMHgwLDB4MCwwKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBhZGRyZXNzIG5leHQgPSB0aGVMaXN0W3dob21dLm5leHQ7DQogICAgICAgIGFkZHJlc3MgcHJldiA9IHRoZUxpc3Rbd2hvbV0ucHJldjsNCiAgICAgICAgaWYgKHByZXYgIT0gMHgwKSB7DQogICAgICAgICAgICB0aGVMaXN0W3ByZXZdLm5leHQgPSBuZXh0Ow0KICAgICAgICB9DQogICAgICAgIGlmIChuZXh0ICE9IDB4MCkgew0KICAgICAgICAgICAgdGhlTGlzdFtuZXh0XS5wcmV2ID0gcHJldjsNCiAgICAgICAgfQ0KICAgICAgICB0aGVMaXN0W3dob21dID0geFJlYyhmYWxzZSwweDAsMHgwLDApOw0KICAgICAgICBldigicmVtb3ZlIix3aG9tLDApOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHVwZGF0ZShhZGRyZXNzIHdob20sIHVpbnQyNTYgdmFsdWUpIG9ubHlNZU9yRERGIHsNCiAgICAgICAgaWYgKHRoaW5rTW9kZSkgew0KICAgICAgICAgICAgYWRkUmVjNEw4Uih3aG9tLHZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodmFsdWUgIT0gMCkgew0KICAgICAgICAgICAgaWYgKCF0aGVMaXN0W3dob21dLmluTGlzdCkgew0KICAgICAgICAgICAgICAgIGFkZCh3aG9tLHZhbHVlKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhlTGlzdFt3aG9tXS52YWwgPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICBldigidXBkYXRlIix3aG9tLHZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhlTGlzdFt3aG9tXS5pbkxpc3QpIHsNCiAgICAgICAgICAgICAgICByZW1vdmUod2hvbSk7DQogICAgICAgIH0NCiAgICB9DQoNCn0NCg0KDQoNCmNvbnRyYWN0IERERlRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFNhZmVNYXRoIHsNCg0KICAgIC8vIG1ldGFkYXRhDQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkRpZ2l0YWwgRGV2ZWxvcGVycyBGdW5kIFRva2VuIjsNCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJEREYiOw0KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7DQogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gIjEuMCI7DQoNCiAgICAvLyBjb250cmFjdHMNCiAgICBhZGRyZXNzIHB1YmxpYyBldGhGdW5kRGVwb3NpdDsgICAgICAvLyBkZXBvc2l0IGFkZHJlc3MgZm9yIEVUSCBmb3IgRG9tYWluIERldmVsb3BtZW50IEZ1bmQNCiAgICBhZGRyZXNzIHB1YmxpYyBkZGZ0RnVuZERlcG9zaXQ7ICAgICAvLyBkZXBvc2l0IGFkZHJlc3MgZm9yIERvbWFpbiBEZXZlbG9wbWVudCBGdW5kIHJlc2VydmUNCiAgICBhZGRyZXNzIHB1YmxpYyBzcGxpdHRlcjsgICAgICAgICAgLy8gREEgOC82LzIwMTcgLSBzcGxpdHRlciBjb250cmFjdA0KDQogICAgLy8gY3Jvd2RzYWxlIHBhcmFtZXRlcnMNCiAgICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZDsgICAgICAgICAgICAgIC8vIHN3aXRjaGVkIHRvIHRydWUgaW4gb3BlcmF0aW9uYWwgc3RhdGUNCiAgICB1aW50MjU2IHB1YmxpYyBmdW5kaW5nU3RhcnRUaW1lOw0KICAgIHVpbnQyNTYgcHVibGljIGZ1bmRpbmdFbmRUaW1lOw0KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRkZnRGdW5kID0gMSAqICgxMCoqNikgKiAxMCoqZGVjaW1hbHM7ICAgLy8gMW0gRERGVCByZXNlcnZlZCBmb3IgRERGIHVzZQ0KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHRva2VuRXhjaGFuZ2VSYXRlID0gMTAwMDsgICAgICAgICAgICAgICAvLyAxMDAwIERERlQgdG9rZW5zIHBlciAxIEVUSA0KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHRva2VuQ3JlYXRpb25DYXAgPSAgMjUwICogKDEwKio2KSAqIDEwKipkZWNpbWFsczsNCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCB0b2tlbkNyZWF0aW9uTWluID0gIDEgKiAoMTAqKjYpICogMTAqKmRlY2ltYWxzOw0KDQoNCiAgICAvLyBldmVudHMNCiAgICBldmVudCBMb2dSZWZ1bmQoYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KICAgIGV2ZW50IENyZWF0ZURERlQoYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KDQogICAgLy8gY29uc3RydWN0b3INCiAgICBmdW5jdGlvbiBEREZUb2tlbigNCiAgICAgICAgYWRkcmVzcyBfZXRoRnVuZERlcG9zaXQsDQogICAgICAgIGFkZHJlc3MgX2RkZnRGdW5kRGVwb3NpdCwNCiAgICAgICAgYWRkcmVzcyBfc3BsaXR0ZXIsIC8vIERBIDgvNi8yMDE3DQogICAgICAgIHVpbnQyNTYgX2Z1bmRpbmdTdGFydFRpbWUsDQogICAgICAgIHVpbnQyNTYgZHVyYXRpb24pDQogICAgew0KICAgICAgaXNGaW5hbGl6ZWQgPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgLy9jb250cm9scyBwcmUgdGhyb3VnaCBjcm93ZHNhbGUgc3RhdGUNCiAgICAgIGV0aEZ1bmREZXBvc2l0ID0gX2V0aEZ1bmREZXBvc2l0Ow0KICAgICAgZGRmdEZ1bmREZXBvc2l0ID0gX2RkZnRGdW5kRGVwb3NpdDsNCiAgICAgIHNwbGl0dGVyID0gIF9zcGxpdHRlciA7ICAgICAgICAgICAgICAgICAgLy8gREEgOC82LzIwMTcNCiAgICAgIGZ1bmRpbmdTdGFydFRpbWUgPSBfZnVuZGluZ1N0YXJ0VGltZTsNCiAgICAgIGZ1bmRpbmdFbmRUaW1lID0gZnVuZGluZ1N0YXJ0VGltZSArIGR1cmF0aW9uICogMSBkYXlzOw0KICAgICAgdG90YWxTdXBwbHkgPSBkZGZ0RnVuZDsNCiAgICAgIGJhbGFuY2VzW2RkZnRGdW5kRGVwb3NpdF0gPSBkZGZ0RnVuZDsgICAgLy8gRGVwb3NpdCBEREYgc2hhcmUNCiAgICAgIENyZWF0ZURERlQoZGRmdEZ1bmREZXBvc2l0LCBkZGZ0RnVuZCk7ICAvLyBsb2dzIERERiBmdW5kDQogICAgfQ0KDQogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7ICAgICAgICAgICAvLyBEQSA4LzYvMjAxNyBwcmVmZXIgdG8gdXNlIGZhbGxiYWNrIGZ1bmN0aW9uDQogICAgICBjcmVhdGVUb2tlbnMobXNnLnZhbHVlKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBBY2NlcHRzIGV0aGVyIGFuZCBjcmVhdGVzIG5ldyBEREZUIHRva2Vucy4NCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbnModWludDI1NiBfdmFsdWUpICBpbnRlcm5hbCB7DQogICAgICBpZiAoaXNGaW5hbGl6ZWQpIHRocm93Ow0KICAgICAgaWYgKG5vdyA8IGZ1bmRpbmdTdGFydFRpbWUpIHRocm93Ow0KICAgICAgaWYgKG5vdyA+IGZ1bmRpbmdFbmRUaW1lKSB0aHJvdzsNCiAgICAgIGlmIChtc2cudmFsdWUgPT0gMCkgdGhyb3c7DQoNCiAgICAgIHVpbnQyNTYgdG9rZW5zID0gc2FmZU11bHQoX3ZhbHVlLCB0b2tlbkV4Y2hhbmdlUmF0ZSk7IC8vIGNoZWNrIHRoYXQgd2UncmUgbm90IG92ZXIgdG90YWxzDQogICAgICB1aW50MjU2IGNoZWNrZWRTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCB0b2tlbnMpOw0KDQogICAgICAvLyBEQSA4LzYvMjAxNyB0byBmYWlybHkgYWxsb2NhdGUgdGhlIGxhc3QgZmV3IHRva2Vucw0KICAgICAgaWYgKHRva2VuQ3JlYXRpb25DYXAgPCBjaGVja2VkU3VwcGx5KSB7DQogICAgICAgIGlmICh0b2tlbkNyZWF0aW9uQ2FwIDw9IHRvdGFsU3VwcGx5KSB0aHJvdzsgIC8vIENBUCByZWFjaGVkIG5vIG1vcmUgcGxlYXNlDQogICAgICAgIHVpbnQyNTYgdG9rZW5zVG9BbGxvY2F0ZSA9IHNhZmVTdWJ0cmFjdCh0b2tlbkNyZWF0aW9uQ2FwLHRvdGFsU3VwcGx5KTsNCiAgICAgICAgdWludDI1NiB0b2tlbnNUb1JlZnVuZCAgID0gc2FmZVN1YnRyYWN0KHRva2Vucyx0b2tlbnNUb0FsbG9jYXRlKTsNCiAgICAgICAgdG90YWxTdXBwbHkgPSB0b2tlbkNyZWF0aW9uQ2FwOw0KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSArPSB0b2tlbnNUb0FsbG9jYXRlOyAgLy8gc2FmZUFkZCBub3QgbmVlZGVkOyBiYWQgc2VtYW50aWNzIHRvIHVzZSBoZXJlDQogICAgICAgIHVpbnQyNTYgZXRoZXJUb1JlZnVuZCA9IHRva2Vuc1RvUmVmdW5kIC8gdG9rZW5FeGNoYW5nZVJhdGU7DQogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXRoZXJUb1JlZnVuZCk7DQogICAgICAgIENyZWF0ZURERlQobXNnLnNlbmRlciwgdG9rZW5zVG9BbGxvY2F0ZSk7ICAvLyBsb2dzIHRva2VuIGNyZWF0aW9uDQogICAgICAgIExvZ1JlZnVuZChtc2cuc2VuZGVyLGV0aGVyVG9SZWZ1bmQpOw0KICAgICAgICBzcGxpdHRlckNvbnRyYWN0KHNwbGl0dGVyKS51cGRhdGUobXNnLnNlbmRlcixiYWxhbmNlc1ttc2cuc2VuZGVyXSk7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIC8vIERBIDgvNi8yMDE3IGVuZCBvZiBmYWlyIGFsbG9jYXRpb24gY29kZQ0KICAgICAgdG90YWxTdXBwbHkgPSBjaGVja2VkU3VwcGx5Ow0KICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gKz0gdG9rZW5zOyAgLy8gc2FmZUFkZCBub3QgbmVlZGVkOyBiYWQgc2VtYW50aWNzIHRvIHVzZSBoZXJlDQogICAgICBDcmVhdGVEREZUKG1zZy5zZW5kZXIsIHRva2Vucyk7ICAvLyBsb2dzIHRva2VuIGNyZWF0aW9uDQogICAgICBzcGxpdHRlckNvbnRyYWN0KHNwbGl0dGVyKS51cGRhdGUobXNnLnNlbmRlcixiYWxhbmNlc1ttc2cuc2VuZGVyXSk7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgRW5kcyB0aGUgZnVuZGluZyBwZXJpb2QgYW5kIHNlbmRzIHRoZSBFVEggaG9tZQ0KICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkgZXh0ZXJuYWwgew0KICAgICAgaWYgKGlzRmluYWxpemVkKSB0aHJvdzsNCiAgICAgIGlmIChtc2cuc2VuZGVyICE9IGV0aEZ1bmREZXBvc2l0KSB0aHJvdzsgLy8gbG9ja3MgZmluYWxpemUgdG8gdGhlIHVsdGltYXRlIEVUSCBvd25lcg0KICAgICAgaWYodG90YWxTdXBwbHkgPCB0b2tlbkNyZWF0aW9uTWluICsgZGRmdEZ1bmQpIHRocm93OyAgICAgIC8vIGhhdmUgdG8gc2VsbCBtaW5pbXVtIHRvIG1vdmUgdG8gb3BlcmF0aW9uYWwNCiAgICAgIGlmKG5vdyA8PSBmdW5kaW5nRW5kVGltZSAmJiB0b3RhbFN1cHBseSAhPSB0b2tlbkNyZWF0aW9uQ2FwKSB0aHJvdzsNCiAgICAgIC8vIG1vdmUgdG8gb3BlcmF0aW9uYWwNCiAgICAgIGlzRmluYWxpemVkID0gdHJ1ZTsNCiAgICAgIC8vIERBIDgvNi8yMDE3IGNoYW5nZSBzZW5kL3Rocm93IHRvIHRyYW5zZmVyDQogICAgICBldGhGdW5kRGVwb3NpdC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOyAgLy8gc2VuZCB0aGUgZXRoIHRvIERERg0KICAgIH0NCg0KICAgIC8vLyBAZGV2IEFsbG93cyBjb250cmlidXRvcnMgdG8gcmVjb3ZlciB0aGVpciBldGhlciBpbiB0aGUgY2FzZSBvZiBhIGZhaWxlZCBmdW5kaW5nIGNhbXBhaWduLg0KICAgIGZ1bmN0aW9uIHJlZnVuZCgpIGV4dGVybmFsIHsNCiAgICAgIGlmKGlzRmluYWxpemVkKSB0aHJvdzsgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXZlbnRzIHJlZnVuZCBpZiBvcGVyYXRpb25hbA0KICAgICAgaWYgKG5vdyA8PSBmdW5kaW5nRW5kVGltZSkgdGhyb3c7IC8vIHByZXZlbnRzIHJlZnVuZCB1bnRpbCBzYWxlIHBlcmlvZCBpcyBvdmVyDQogICAgICBpZih0b3RhbFN1cHBseSA+PSB0b2tlbkNyZWF0aW9uTWluICsgZGRmdEZ1bmQpIHRocm93OyAgLy8gbm8gcmVmdW5kcyBpZiB3ZSBzb2xkIGVub3VnaA0KICAgICAgaWYobXNnLnNlbmRlciA9PSBkZGZ0RnVuZERlcG9zaXQpIHRocm93OyAgICAvLyBEREYgbm90IGVudGl0bGVkIHRvIGEgcmVmdW5kDQogICAgICB1aW50MjU2IGRkZnRWYWwgPSBiYWxhbmNlc1ttc2cuc2VuZGVyXTsNCiAgICAgIGlmIChkZGZ0VmFsID09IDApIHRocm93Ow0KICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSAwOw0KICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3VidHJhY3QodG90YWxTdXBwbHksIGRkZnRWYWwpOyAvLyBleHRyYSBzYWZlDQogICAgICB1aW50MjU2IGV0aFZhbCA9IGRkZnRWYWwgLyB0b2tlbkV4Y2hhbmdlUmF0ZTsgICAgIC8vIHNob3VsZCBiZSBzYWZlOyBwcmV2aW91cyB0aHJvd3MgY292ZXJzIGVkZ2VzDQogICAgICBMb2dSZWZ1bmQobXNnLnNlbmRlciwgZXRoVmFsKTsgICAgICAgICAgICAgICAvLyBsb2cgaXQgDQogICAgICAvLyBEQSA4LzYvMjAxNyBjaGFuZ2Ugc2VuZC90aHJvdyB0byB0cmFuc2Zlcg0KICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihldGhWYWwpOyAgICAgICAgICAgICAgICAgLy8gaWYgeW91J3JlIHVzaW5nIGEgY29udHJhY3Q7IG1ha2Ugc3VyZSBpdCB3b3JrcyB3aXRoIC5zZW5kIGdhcyBsaW1pdHMNCiAgICB9DQoNCiAgICAvLyBEQSA4LzYvMjAxNw0KICAgIC8vLyBAZGV2IFVwZGF0ZXMgc3BsaXR0ZXIgY29udHJhY3Qgd2l0aCBvd25lcnNoaXAgY2hhbmdlcw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSAgew0KICAgICAgc3VjY2VzcyA9IHN1cGVyLnRyYW5zZmVyKF90byxfdmFsdWUpOw0KICAgICAgc3BsaXR0ZXJDb250cmFjdCBzYyA9IHNwbGl0dGVyQ29udHJhY3Qoc3BsaXR0ZXIpOw0KICAgICAgc2MudXBkYXRlKG1zZy5zZW5kZXIsYmFsYW5jZXNbbXNnLnNlbmRlcl0pOw0KICAgICAgc2MudXBkYXRlKF90byxiYWxhbmNlc1tfdG9dKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCn0='