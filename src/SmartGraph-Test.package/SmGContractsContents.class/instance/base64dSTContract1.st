base 64 content
base64dSTContract1
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4wOw0KDQovKg0KICogVG9rZW4gLSBpcyBhIHNtYXJ0IGNvbnRyYWN0IGludGVyZmFjZSANCiAqIGZvciBtYW5hZ2luZyBjb21tb24gZnVuY3Rpb25hbGl0eSBvZiANCiAqIGEgdG9rZW4uDQogKg0KICogRVJDLjIwIFRva2VuIHN0YW5kYXJkOiBodHRwczovL2dpdGh1Yi5jb20vZXRoIGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKi8NCmNvbnRyYWN0IFRva2VuSW50ZXJmYWNlIHsNCg0KICAgICAgICANCiAgICAvLyB0b3RhbCBhbW91bnQgb2YgdG9rZW5zDQogICAgdWludCB0b3RhbFN1cHBseVZhcjsNCg0KICAgIA0KICAgIC8qKg0KICAgICAqDQogICAgICogYmFsYW5jZU9mKCkgLSBjb25zdGFudCBmdW5jdGlvbiBjaGVjayBjb25jcmV0ZSB0b2tlbnMgYmFsYW5jZSAgDQogICAgICoNCiAgICAgKiAgQHBhcmFtIG93bmVyIC0gYWNjb3VudCBvd25lcg0KICAgICAqICANCiAgICAgKiAgQHJldHVybiB0aGUgdmFsdWUgb2YgYmFsYW5jZSANCiAgICAgKi8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7DQogICAgDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQoNCiAgICAvKioNCiAgICAgKg0KICAgICAqIGFwcHJvdmUoKSAtIGZ1bmN0aW9uIGFwcHJvdmVzIHRvIGEgcGVyc29uIHRvIHNwZW5kIHNvbWUgdG9rZW5zIGZyb20gDQogICAgICogICAgICAgICAgIG93bmVyIGJhbGFuY2UuIA0KICAgICAqDQogICAgICogIEBwYXJhbSBzcGVuZGVyIC0gcGVyc29uIHdob20gdGhpcyByaWdodCBiZWVuIGdyYW50ZWQuDQogICAgICogIEBwYXJhbSB2YWx1ZSAgIC0gdmFsdWUgdG8gc3BlbmQuDQogICAgICogDQogICAgICogIEByZXR1cm4gdHJ1ZSBpbiBjYXNlIG9mIHN1Y2Nlcywgb3RoZXJ3aXNlIGZhaWx1cmUNCiAgICAgKiANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIC8qKg0KICAgICAqDQogICAgICogYWxsb3dhbmNlKCkgLSBjb25zdGFudCBmdW5jdGlvbiB0byBjaGVjayBob3cgbXVjaCBpcyANCiAgICAgKiAgICAgICAgICAgICAgIHBlcm1pdHRlZCB0byBzcGVuZCB0byAzcmQgcGVyc29uIGZyb20gb3duZXIgYmFsYW5jZQ0KICAgICAqDQogICAgICogIEBwYXJhbSBvd25lciAgIC0gb3duZXIgb2YgdGhlIGJhbGFuY2UNCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJtaXR0ZWQgdG8gc3BlbmQgZnJvbSB0aGlzIGJhbGFuY2UgcGVyc29uIA0KICAgICAqICANCiAgICAgKiAgQHJldHVybiAtIHJlbWFpbmluZyByaWdodCB0byBzcGVuZCANCiAgICAgKiANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7DQogICAgDQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHRvdGFsU3VwcGx5KXsNCiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5VmFyOyAgICANCiAgICB9DQoNCiAgICAvLyBldmVudHMgbm90aWZpY2F0aW9ucw0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOw0KfQ0KDQoNCi8qDQogKiBTdGFuZGFyZFRva2VuIC0gaXMgYSBzbWFydCBjb250cmFjdCAgDQogKiBmb3IgbWFuYWdpbmcgY29tbW9uIGZ1bmN0aW9uYWxpdHkgb2YgDQogKiBhIHRva2VuLg0KICoNCiAqIEVSQy4yMCBUb2tlbiBzdGFuZGFyZDogDQogKiAgICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGggZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqLw0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBUb2tlbkludGVyZmFjZSB7DQoNCg0KICAgIC8vIHRva2VuIG93bmVyc2hpcA0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7DQoNCiAgICAvLyBzcGVuZGluZyBwZXJtaXNpb24gbWFuYWdlbWVudA0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsNCiAgICANCiAgICANCiAgICANCiAgICBmdW5jdGlvbiBTdGFuZGFyZFRva2VuKCl7DQogICAgfQ0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIHRyYW5zZmVyKCkgLSB0cmFuc2ZlciB0b2tlbnMgZnJvbSBtc2cuc2VuZGVyIGJhbGFuY2UgDQogICAgICogICAgICAgICAgICAgIHRvIHJlcXVlc3RlZCBhY2NvdW50DQogICAgICoNCiAgICAgKiAgQHBhcmFtIHRvICAgIC0gdGFyZ2V0IGFkZHJlc3MgdG8gdHJhbnNmZXIgdG9rZW5zDQogICAgICogIEBwYXJhbSB2YWx1ZSAtIGFtbW91bnQgb2YgdG9rZW5zIHRvIHRyYW5zZmVyDQogICAgICoNCiAgICAgKiAgQHJldHVybiAtIHN1Y2Nlc3MgLyBmYWlsdXJlIG9mIHRoZSB0cmFuc2FjdGlvbg0KICAgICAqLyAgICANCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gdmFsdWUgJiYgdmFsdWUgPiAwKSB7DQoNCiAgICAgICAgICAgIC8vIGRvIGFjdHVhbCB0b2tlbnMgdHJhbnNmZXIgICAgICAgDQogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSB2YWx1ZTsNCiAgICAgICAgICAgIGJhbGFuY2VzW3RvXSAgICAgICAgICs9IHZhbHVlOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyByaXNlIHRoZSBUcmFuc2ZlciBldmVudA0KICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgdG8sIHZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7IA0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIA0KDQogICAgDQogICAgLyoqDQogICAgICogdHJhbnNmZXJGcm9tKCkgLSB1c2VkIHRvIG1vdmUgYWxsb3dlZCBmdW5kcyBmcm9tIG90aGVyIG93bmVyDQogICAgICogICAgICAgICAgICAgICAgICBhY2NvdW50IA0KICAgICAqDQogICAgICogIEBwYXJhbSBmcm9tICAtIG1vdmUgZnVuZHMgZnJvbSBhY2NvdW50DQogICAgICogIEBwYXJhbSB0byAgICAtIG1vdmUgZnVuZHMgdG8gYWNjb3VudA0KICAgICAqICBAcGFyYW0gdmFsdWUgLSBtb3ZlIHRoZSB2YWx1ZSANCiAgICAgKg0KICAgICAqICBAcmV0dXJuIC0gcmV0dXJuIHRydWUgb24gc3VjY2VzcyBmYWxzZSBvdGhlcndpc2UgDQogICAgICovDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgDQogICAgICAgIGlmICggYmFsYW5jZXNbZnJvbV0gPj0gdmFsdWUgJiYgDQogICAgICAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSA+PSB2YWx1ZSAmJiANCiAgICAgICAgICAgICB2YWx1ZSA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgIA0KICAgICAgICAgICAgLy8gZG8gdGhlIGFjdHVhbCB0cmFuc2Zlcg0KICAgICAgICAgICAgYmFsYW5jZXNbZnJvbV0gLT0gdmFsdWU7ICAgIA0KICAgICAgICAgICAgYmFsYW5jZXNbdG9dICAgKz0gdmFsdWU7ICAgICAgICAgICAgDQogICAgICAgICAgICANCg0KICAgICAgICAgICAgLy8gYWRkanVzdCB0aGUgcGVybWlzaW9uLCBhZnRlciBwYXJ0IG9mIA0KICAgICAgICAgICAgLy8gcGVybWl0ZWQgdG8gc3BlbmQgdmFsdWUgd2FzIHVzZWQNCiAgICAgICAgICAgIGFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl0gLT0gdmFsdWU7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIHJpc2UgdGhlIFRyYW5zZmVyIGV2ZW50DQogICAgICAgICAgICBUcmFuc2Zlcihmcm9tLCB0bywgdmFsdWUpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSB7IA0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7IA0KICAgICAgICB9DQogICAgfQ0KDQogICAgDQoNCiAgICANCiAgICAvKioNCiAgICAgKg0KICAgICAqIGJhbGFuY2VPZigpIC0gY29uc3RhbnQgZnVuY3Rpb24gY2hlY2sgY29uY3JldGUgdG9rZW5zIGJhbGFuY2UgIA0KICAgICAqDQogICAgICogIEBwYXJhbSBvd25lciAtIGFjY291bnQgb3duZXINCiAgICAgKiAgDQogICAgICogIEByZXR1cm4gdGhlIHZhbHVlIG9mIGJhbGFuY2UgDQogICAgICovICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW293bmVyXTsNCiAgICB9DQoNCiAgICANCiAgICANCiAgICAvKioNCiAgICAgKg0KICAgICAqIGFwcHJvdmUoKSAtIGZ1bmN0aW9uIGFwcHJvdmVzIHRvIGEgcGVyc29uIHRvIHNwZW5kIHNvbWUgdG9rZW5zIGZyb20gDQogICAgICogICAgICAgICAgIG93bmVyIGJhbGFuY2UuIA0KICAgICAqDQogICAgICogIEBwYXJhbSBzcGVuZGVyIC0gcGVyc29uIHdob20gdGhpcyByaWdodCBiZWVuIGdyYW50ZWQuDQogICAgICogIEBwYXJhbSB2YWx1ZSAgIC0gdmFsdWUgdG8gc3BlbmQuDQogICAgICogDQogICAgICogIEByZXR1cm4gdHJ1ZSBpbiBjYXNlIG9mIHN1Y2Nlcywgb3RoZXJ3aXNlIGZhaWx1cmUNCiAgICAgKiANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIC8vIG5vdyBzcGVuZGVyIGNhbiB1c2UgYmFsYW5jZSBpbiANCiAgICAgICAgLy8gYW1tb3VudCBvZiB2YWx1ZSBmcm9tIG93bmVyIGJhbGFuY2UNCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IHZhbHVlOw0KICAgICAgICANCiAgICAgICAgLy8gcmlzZSBldmVudCBhYm91dCB0aGUgdHJhbnNhY3Rpb24NCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgc3BlbmRlciwgdmFsdWUpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KDQogICAgLyoqDQogICAgICoNCiAgICAgKiBhbGxvd2FuY2UoKSAtIGNvbnN0YW50IGZ1bmN0aW9uIHRvIGNoZWNrIGhvdyBtb3VjaCBpcyANCiAgICAgKiAgICAgICAgICAgICAgIHBlcm1pdGVkIHRvIHNwZW5kIHRvIDNyZCBwZXJzb24gZnJvbSBvd25lciBiYWxhbmNlDQogICAgICoNCiAgICAgKiAgQHBhcmFtIG93bmVyICAgLSBvd25lciBvZiB0aGUgYmFsYW5jZQ0KICAgICAqICBAcGFyYW0gc3BlbmRlciAtIHBlcm1pdGVkIHRvIHNwZW5kIGZyb20gdGhpcyBiYWxhbmNlIHBlcnNvbiANCiAgICAgKiAgDQogICAgICogIEByZXR1cm4gLSByZW1haW5pbmcgcmlnaHQgdG8gc3BlbmQgDQogICAgICogDQogICAgICovDQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsNCiAgICAgIHJldHVybiBhbGxvd2VkW293bmVyXVtzcGVuZGVyXTsNCiAgICB9DQoNCn0NCg0KDQovKioNCiAqDQogKiBAdGl0bGUgSGFja2VyIEdvbGQNCiAqIA0KICogVGhlIG9mZmljaWFsIHRva2VuIHBvd2VyaW5nIHRoZSBoYWNrLmV0aGVyLmNhbXAgdmlydHVhbCBhY2NlbGVyYXRvci4NCiAqIFRoaXMgaXMgdGhlIG9ubHkgd2F5IHRvIGFjcXVpcmUgdG9rZW5zIGZyb20gc3RhcnR1cHMgZHVyaW5nIHRoZSBldmVudC4NCiAqDQogKiBXaGl0ZXBhcGVyIGh0dHBzOi8vaGFjay5ldGhlci5jYW1wL3doaXRlcGFwZXINCiAqDQogKi8NCmNvbnRyYWN0IEhhY2tlckdvbGQgaXMgU3RhbmRhcmRUb2tlbiB7DQoNCiAgICAvLyBOYW1lIG9mIHRoZSB0b2tlbiAgICANCiAgICBzdHJpbmcgcHVibGljIG5hbWUgPSAiSGFja2VyR29sZCI7DQoNCiAgICAvLyBEZWNpbWFsIHBsYWNlcw0KICAgIHVpbnQ4ICBwdWJsaWMgZGVjaW1hbHMgPSAzOw0KICAgIC8vIFRva2VuIGFiYnJldmlhdGlvbiAgICAgICAgDQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiSEtHIjsNCiAgICANCiAgICAvLyAxIGV0aGVyID0gMjAwIGhrZw0KICAgIHVpbnQgQkFTRV9QUklDRSA9IDIwMDsNCiAgICAvLyAxIGV0aGVyID0gMTUwIGhrZw0KICAgIHVpbnQgTUlEX1BSSUNFID0gMTUwOw0KICAgIC8vIDEgZXRoZXIgPSAxMDAgaGtnDQogICAgdWludCBGSU5fUFJJQ0UgPSAxMDA7DQogICAgLy8gU2FmZXR5IGNhcA0KICAgIHVpbnQgU0FGRVRZX0xJTUlUID0gNDAwMDAwMCBldGhlcjsNCiAgICAvLyBaZXJvcyBhZnRlciB0aGUgcG9pbnQNCiAgICB1aW50IERFQ0lNQUxfWkVST1MgPSAxMDAwOw0KICAgIA0KICAgIC8vIFRvdGFsIHZhbHVlIGluIHdlaQ0KICAgIHVpbnQgdG90YWxWYWx1ZTsNCiAgICANCiAgICAvLyBBZGRyZXNzIG9mIG11bHRpc2lnIHdhbGxldCBob2xkaW5nIGV0aGVyIGZyb20gc2FsZQ0KICAgIGFkZHJlc3Mgd2FsbGV0Ow0KDQogICAgLy8gU3RydWN0dXJlIG9mIHNhbGUgaW5jcmVhc2UgbWlsZXN0b25lcw0KICAgIHN0cnVjdCBtaWxlc3RvbmVzX3N0cnVjdCB7DQogICAgICB1aW50IHAxOw0KICAgICAgdWludCBwMjsgDQogICAgICB1aW50IHAzOw0KICAgICAgdWludCBwNDsNCiAgICAgIHVpbnQgcDU7DQogICAgICB1aW50IHA2Ow0KICAgIH0NCiAgICAvLyBNaWxlc3RvbmVzIGluc3RhbmNlDQogICAgbWlsZXN0b25lc19zdHJ1Y3QgbWlsZXN0b25lczsNCiAgICANCiAgICAvKioNCiAgICAgKiBDb25zdHJ1Y3RvciBvZiB0aGUgY29udHJhY3QuDQogICAgICogDQogICAgICogUGFzc2VzIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgaG9sZGluZyB0aGUgdmFsdWUuDQogICAgICogSGFja2VyR29sZCBjb250cmFjdCBpdHNlbGYgZG9lcyBub3QgaG9sZCBhbnkgdmFsdWUNCiAgICAgKiANCiAgICAgKiBAcGFyYW0gbXVsdGlzaWcgYWRkcmVzcyBvZiBNdWx0aVNpZyB3YWxsZXQgd2hpY2ggd2lsbCBob2xkIHRoZSB2YWx1ZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIEhhY2tlckdvbGQoYWRkcmVzcyBtdWx0aXNpZykgew0KICAgICAgICANCiAgICAgICAgd2FsbGV0ID0gbXVsdGlzaWc7DQoNCiAgICAgICAgLy8gc2V0IHRpbWUgcGVyaW9kcyBmb3Igc2FsZQ0KICAgICAgICBtaWxlc3RvbmVzID0gbWlsZXN0b25lc19zdHJ1Y3QoDQogICAgICAgIA0KICAgICAgICAgIDE0NzY5NzIwMDAsICAvLyBQMTogR01UOiAyMC1PY3QtMjAxNiAxNDowMCAgPT4gVGhlIFNhbGUgU3RhcnRzDQogICAgICAgICAgMTQ3ODE4MTYwMCwgIC8vIFAyOiBHTVQ6IDAzLU5vdi0yMDE2IDE0OjAwICA9PiAxc3QgUHJpY2UgTGFkZGVyIA0KICAgICAgICAgIDE0NzkzOTEyMDAsICAvLyBQMzogR01UOiAxNy1Ob3YtMjAxNiAxNDowMCAgPT4gUHJpY2UgU3RhYmxlLCANCiAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhY2thdGhvbiBTdGFydHMNCiAgICAgICAgICAxNDgwNjAwODAwLCAgLy8gUDQ6IEdNVDogMDEtRGVjLTIwMTYgMTQ6MDAgID0+IDJuZCBQcmljZSBMYWRkZXINCiAgICAgICAgICAxNDgxODEwNDAwLCAgLy8gUDU6IEdNVDogMTUtRGVjLTIwMTYgMTQ6MDAgID0+IFByaWNlIFN0YWJsZQ0KICAgICAgICAgIDE0ODI0MTUyMDAgICAvLyBQNjogR01UOiAyMi1EZWMtMjAxNiAxNDowMCAgPT4gU2FsZSBFbmRzLCBIYWNrYXRob24gRW5kcw0KICAgICAgICApOw0KICAgICAgICANCiAgICAgICAgLy8gYXNzaWduIHJlY292ZXJ5IGJhbGFuY2UNCiAgICAgICAgdG90YWxTdXBwbHlWYXIgICA9IDE2MTEwODkzMDAwOw0KICAgICAgICBiYWxhbmNlc1sweDM0MmU2MjczMmI3Njg3NWRhOTMwNTA4M2VhOGFlNjMxMjVhNGU2NjddID0gMTYxMTA4OTMwMDA7DQogICAgICAgIHRvdGFsVmFsdWUgICAgPSA4NTM2MiBldGhlcjsgICAgICAgIA0KICAgIH0NCiAgICANCiAgICANCiAgICAvKioNCiAgICAgKiBGYWxsYmFjayBmdW5jdGlvbjogY2FsbGVkIG9uIGV0aGVyIHNlbnQuDQogICAgICogDQogICAgICogSXQgY2FsbHMgdG8gY3JlYXRlSEtHIGZ1bmN0aW9uIHdpdGggbXNnLnNlbmRlciANCiAgICAgKiBhcyBhIHZhbHVlIGZvciBob2xkZXIgYXJndW1lbnQNCiAgICAgKi8NCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsNCiAgICAgICAgY3JlYXRlSEtHKG1zZy5zZW5kZXIpOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIEhLRyB0b2tlbnMuDQogICAgICogDQogICAgICogUnVucyBzYW5pdHkgY2hlY2tzIGluY2x1ZGluZyBzYWZldHkgY2FwDQogICAgICogVGhlbiBjYWxjdWxhdGVzIGN1cnJlbnQgcHJpY2UgYnkgZ2V0UHJpY2UoKSBmdW5jdGlvbiwgY3JlYXRlcyBIS0cgdG9rZW5zDQogICAgICogRmluYWxseSBzZW5kcyBhIHZhbHVlIG9mIHRyYW5zYWN0aW9uIHRvIHRoZSB3YWxsZXQNCiAgICAgKiANCiAgICAgKiBOb3RlOiBkdWUgdG8gbGFjayBvZiBmbG9hdGluZyBwb2ludCB0eXBlcyBpbiBTb2xpZGl0eSwNCiAgICAgKiBjb250cmFjdCBhc3N1bWVzIHRoYXQgbGFzdCAzIGRpZ2l0cyBpbiB0b2tlbnMgYW1vdW50IGFyZSBzdG9vZCBhZnRlciB0aGUgcG9pbnQuDQogICAgICogSXQgbWVhbnMgdGhhdCBpZiBzdG9yZWQgSEtHIGJhbGFuY2UgaXMgMTAwMDAwLCB0aGVuIGl0cyByZWFsIHZhbHVlIGlzIDEwMCBIS0cNCiAgICAgKiANCiAgICAgKiBAcGFyYW0gaG9sZGVyIHRva2VuIGhvbGRlcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZUhLRyhhZGRyZXNzIGhvbGRlcikgcGF5YWJsZSB7DQogICAgICAgIA0KICAgICAgICBpZiAobm93IDwgbWlsZXN0b25lcy5wMSkgdGhyb3c7DQogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wNikgdGhyb3c7DQogICAgICAgIGlmIChtc2cudmFsdWUgPT0gMCkgdGhyb3c7DQogICAgDQogICAgICAgIC8vIHNhZmV0eSBjYXANCiAgICAgICAgaWYgKGdldFRvdGFsVmFsdWUoKSArIG1zZy52YWx1ZSA+IFNBRkVUWV9MSU1JVCkgdGhyb3c7IA0KICAgIA0KICAgICAgICB1aW50IHRva2VucyA9IG1zZy52YWx1ZSAqIGdldFByaWNlKCkgKiBERUNJTUFMX1pFUk9TIC8gMSBldGhlcjsNCg0KICAgICAgICB0b3RhbFN1cHBseVZhciArPSB0b2tlbnM7DQogICAgICAgIGJhbGFuY2VzW2hvbGRlcl0gKz0gdG9rZW5zOw0KICAgICAgICB0b3RhbFZhbHVlICs9IG1zZy52YWx1ZTsNCiAgICAgICAgDQogICAgICAgIGlmICghd2FsbGV0LnNlbmQobXNnLnZhbHVlKSkgdGhyb3c7DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIERlbm90ZXMgY29tcGxldGUgcHJpY2Ugc3RydWN0dXJlIGR1cmluZyB0aGUgc2FsZS4NCiAgICAgKg0KICAgICAqIEByZXR1cm4gSEtHIGFtb3VudCBwZXIgMSBFVEggZm9yIHRoZSBjdXJyZW50IG1vbWVudCBpbiB0aW1lDQogICAgICovDQogICAgZnVuY3Rpb24gZ2V0UHJpY2UoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgew0KICAgICAgICANCiAgICAgICAgaWYgKG5vdyA8IG1pbGVzdG9uZXMucDEpIHJldHVybiAwOw0KICAgICAgICANCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnAxICYmIG5vdyA8IG1pbGVzdG9uZXMucDIpIHsNCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gQkFTRV9QUklDRTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnAyICYmIG5vdyA8IG1pbGVzdG9uZXMucDMpIHsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdWludCBkYXlzX2luID0gMSArIChub3cgLSBtaWxlc3RvbmVzLnAyKSAvIDEgZGF5czsgDQogICAgICAgICAgICByZXR1cm4gQkFTRV9QUklDRSAtIGRheXNfaW4gKiAyNSAvIDc7ICAvLyBkYWlseSBkZWNyZWFzZSAzLjUNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wMyAmJiBub3cgPCBtaWxlc3RvbmVzLnA0KSB7DQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIE1JRF9QUklDRTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnA0ICYmIG5vdyA8IG1pbGVzdG9uZXMucDUpIHsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZGF5c19pbiA9IDEgKyAobm93IC0gbWlsZXN0b25lcy5wNCkgLyAxIGRheXM7IA0KICAgICAgICAgICAgcmV0dXJuIE1JRF9QUklDRSAtIGRheXNfaW4gKiAyNSAvIDc7ICAvLyBkYWlseSBkZWNyZWFzZSAzLjUNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wNSAmJiBub3cgPCBtaWxlc3RvbmVzLnA2KSB7DQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIEZJTl9QUklDRTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnA2KXsNCg0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCg0KICAgICB9DQogICAgDQogICAgLyoqDQogICAgICogUmV0dXJucyB0b3RhbCBzdG9yZWQgSEtHIGFtb3VudC4NCiAgICAgKiANCiAgICAgKiBDb250cmFjdCBhc3N1bWVzIHRoYXQgbGFzdCAzIGRpZ2l0cyBvZiB0aGlzIHZhbHVlIGFyZSBiZWhpbmQgdGhlIGRlY2ltYWwgcGxhY2UuIGkuZS4gMTAwMDEgaXMgMTAuMDAxDQogICAgICogVGh1cywgcmVzdWx0IG9mIHRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGRpdmlkZWQgYnkgMTAwMCB0byBnZXQgSEtHIHZhbHVlDQogICAgICogDQogICAgICogQHJldHVybiByZXN1bHQgc3RvcmVkIEhLRyBhbW91bnQNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXRUb3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KSB7DQogICAgICAgIHJldHVybiB0b3RhbFN1cHBseVZhcjsNCiAgICB9IA0KDQogICAgLyoqDQogICAgICogSXQgaXMgdXNlZCBmb3IgdGVzdCBwdXJwb3Nlcy4NCiAgICAgKiANCiAgICAgKiBSZXR1cm5zIHRoZSByZXN1bHQgb2YgJ25vdycgc3RhdGVtZW50IG9mIFNvbGlkaXR5IGxhbmd1YWdlDQogICAgICogDQogICAgICogQHJldHVybiB1bml4IHRpbWVzdGFtcCBmb3IgY3VycmVudCBtb21lbnQgaW4gdGltZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGdldE5vdygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KSB7DQogICAgICAgIHJldHVybiBub3c7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJucyB0b3RhbCB2YWx1ZSBwYXNzZWQgdGhyb3VnaCB0aGUgY29udHJhY3QNCiAgICAgKiANCiAgICAgKiBAcmV0dXJuIHJlc3VsdCB0b3RhbCB2YWx1ZSBpbiB3ZWkNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXRUb3RhbFZhbHVlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpIHsNCiAgICAgICAgcmV0dXJuIHRvdGFsVmFsdWU7ICANCiAgICB9DQp9DQoNCg0KLyoqDQogKiANCiAqIEV2ZW50SW5mbyAtIGltdXRhYmxlIGNsYXNzIHRoYXQgZGVub3Rlcw0KICogdGhlIHRpbWUgb2YgdGhlIHZpcnR1YWwgYWNjZWxlcmF0b3IgaGFjaw0KICogZXZlbnQNCiAqIA0KICovDQpjb250cmFjdCBFdmVudEluZm97DQogICAgDQogICAgDQogICAgdWludCBjb25zdGFudCBIQUNLQVRIT05fNV9XRUVLUyA9IDYwICogNjAgKiAyNCAqIDcgKiA1Ow0KICAgIHVpbnQgY29uc3RhbnQgVF8xX1dFRUsgPSA2MCAqIDYwICogMjQgKiA3Ow0KDQogICAgdWludCBldmVudFN0YXJ0ID0gMTQ3OTM5MTIwMDsgLy8gVGh1LCAxNyBOb3YgMjAxNiAxNDowMDowMCBHTVQNCiAgICB1aW50IGV2ZW50RW5kID0gZXZlbnRTdGFydCArIEhBQ0tBVEhPTl81X1dFRUtTOw0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIGdldEV2ZW50U3RhcnQgLSByZXR1cm4gdGhlIHN0YXJ0IG9mIHRoZSBldmVudCB0aW1lDQogICAgICovIA0KICAgIGZ1bmN0aW9uIGdldEV2ZW50U3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7ICAgICAgICANCiAgICAgICByZXR1cm4gZXZlbnRTdGFydDsNCiAgICB9IA0KICAgIA0KICAgIC8qKg0KICAgICAqIGdldEV2ZW50RW5kIC0gcmV0dXJuIHRoZSBlbmQgb2YgdGhlIGV2ZW50IHRpbWUNCiAgICAgKi8gDQogICAgZnVuY3Rpb24gZ2V0RXZlbnRFbmQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7ICAgICAgICANCiAgICAgICByZXR1cm4gZXZlbnRFbmQ7DQogICAgfSANCiAgICANCiAgICANCiAgICAvKioNCiAgICAgKiBnZXRWb3RpbmdTdGFydCAtIHRoZSB2b3Rpbmcgc3RhcnRzIDEgd2VlayBhZnRlciB0aGUgDQogICAgICogICAgICAgICAgICAgICAgICBldmVudCBzdGFydHMNCiAgICAgKi8gDQogICAgZnVuY3Rpb24gZ2V0Vm90aW5nU3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiBldmVudFN0YXJ0KyBUXzFfV0VFSzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBnZXRUcmFkaW5nU3RhcnQgLSB0aGUgRFNUIHRva2VucyB0cmFkaW5nIHN0YXJ0cyAxIHdlZWsgDQogICAgICogICAgICAgICAgICAgICAgICAgYWZ0ZXIgdGhlIGV2ZW50IHN0YXJ0cw0KICAgICAqLyANCiAgICBmdW5jdGlvbiBnZXRUcmFkaW5nU3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiBldmVudFN0YXJ0KyBUXzFfV0VFSzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBnZXROb3cgLSBoZWxwZXIgY2xhc3MgdG8gY2hlY2sgd2hhdCB0aW1lIHRoZSBjb250cmFjdCBzZWUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXROb3coKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7ICAgICAgICANCiAgICAgICByZXR1cm4gbm93Ow0KICAgIH0gDQogICAgDQp9DQoNCg0KLyoNCiAqIERTVENvbnRyYWN0IC0gRFNUIHN0YW5kcyBmb3IgZGVjZW50cmFsaXplZCBzdGFydHVwIHRlYW0uDQogKiAgICAgICAgICAgICAgIHRoZSBjb250cmFjdCBlbnN1cmVzIGZ1bmRpbmcgZm9yIGEgZGVjZW50cmFsaXplZA0KICogICAgICAgICAgICAgICB0ZWFtIGluIDIgcGhhc2VzOiANCiAqDQogKiAgICAgICAgICAgICAgICArLiBGdW5kaW5nIGJ5IEhLRyBkdXJpbmcgdGhlIGhhY2thdGhvbiBldmVudC4gDQogKiAgICAgICAgICAgICAgICArLiBGdW5kaW5nIGJ5IEV0aGVyIGFmdGVyIHRoZSBldmVudCBpcyBvdmVyLiANCiAqDQogKiAgICAgICAgICAgICAgIEFmdGVyIHRoZSBmdW5kcyBiZWVuIGNvbGxlY3RlZCB0aGVyZSBpcyBhIGdvdmVybmVuY2UNCiAqICAgICAgICAgICAgICAgbWVjaGFuaXNtIG1hbmFnZWQgYnkgcHJvcG9zaXRpb24gdG8gd2l0aGRyYXcgZnVuZHMNCiAqICAgICAgICAgICAgICAgZm9yIGRldmVsb3BtZW50IHVzYWdlLiANCiAqDQogKiAgICAgICAgICAgICAgIFRoZSBEU1QgZW5zdXJlcyB0aGF0IGJhY2tlcnMgb2YgdGhlIHByb2plY3RzIGtlZXBzDQogKiAgICAgICAgICAgICAgIHNvbWUgaW5mbHVlbmNlIG9uIHRoZSBwcm9qZWN0IGJ5IGFiaWxpdHkgdG8gcmVqZWN0DQogKiAgICAgICAgICAgICAgIHByb3Bvc2l0aW9ucyB0aGV5IGZpbmQgYXMgbm9uIGVmZmVjdGl2ZS4gDQogKg0KICogICAgICAgICAgICAgICBJbiB2ZXJ5IHJhZGljYWwgb2NjYXNpb25zIHRoZSBiYWNrZXJzIG1heSBsb29zZSANCiAqICAgICAgICAgICAgICAgdGhlIHRydXN0IGluIHRoZSB0ZWFtIGNvbXBsZXRlbGx5LCBpbiB0aGF0IGNhc2UgDQogKiAgICAgICAgICAgICAgIHRoZXJlIGlzIGFuIG9wdGlvbiB0byBwcm9wb3NlIGltcGVhY2htZW50IHByb2Nlc3MNCiAqICAgICAgICAgICAgICAgY29tcGxldGVsbHkgcmVtb3ZpbmcgdGhlIGV4ZWN1dGUgYW5kIGFzc2lnbmluZyBuZXcNCiAqICAgICAgICAgICAgICAgcGVyc29uIHRvIG1hbmFnZSB0aGUgZnVuZHMuIA0KICoNCiAqLw0KY29udHJhY3QgRFNUQ29udHJhY3QgaXMgU3RhbmRhcmRUb2tlbnsNCg0KICAgIC8vIFplcm9zIGFmdGVyIHRoZSBwb2ludA0KICAgIHVpbnQgREVDSU1BTF9aRVJPUyA9IDEwMDA7DQogICAgLy8gUHJvcG9zYWwgbGlmZXRpbWUNCiAgICB1aW50IFBST1BPU0FMX0xJRkVUSU1FID0gMTAgZGF5czsNCiAgICAvLyBQcm9wb3NhbCBmdW5kcyB0aHJlc2hvbGQsIGluIHBlcmNlbnRzDQogICAgdWludCBQUk9QT1NBTF9GVU5EU19USCA9IDIwOw0KDQogICAgYWRkcmVzcyAgIGV4ZWN1dGl2ZTsgDQogICAgICAgIA0KICAgIEV2ZW50SW5mbyBldmVudEluZm87DQogICAgDQogICAgLy8gSW5kaWNhdGVkIHdoZXJlIHRoZSBEU1QgaXMgdHJhZGVkDQogICAgYWRkcmVzcyB2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzOw0KICAgIA0KICAgIEhhY2tlckdvbGQgaGFja2VyR29sZDsNCiAgICAgICAgDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSB2b3RpbmdSaWdodHM7DQoNCg0KICAgIC8vIDEgLSBIS0cgPT4gRFNUIHF0eTsgdG9rZW5zIGZvciAxIEhLRw0KICAgIHVpbnQgaGtnUHJpY2U7DQogICAgDQogICAgLy8gMSAtIEV0aGVyID0+IERTVCBxdHk7IHRva2VucyBmb3IgMSBFdGhlcg0KICAgIHVpbnQgZXRoZXJQcmljZTsNCiAgICANCiAgICBzdHJpbmcgcHVibGljIG5hbWUgPSAiLi4uIjsgICAgICAgICAgICAgICAgICAgDQogICAgdWludDggIHB1YmxpYyBkZWNpbWFscyA9IDM7ICAgICAgICAgICAgICAgICANCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICIuLi4iOw0KICAgIA0KICAgIGJvb2wgYWJsZVRvSXNzdWVUb2tlbnMgPSB0cnVlOyANCiAgICANCiAgICB1aW50IHByZWZlcmVkUXR5U29sZDsNCg0KICAgIHVpbnQgY29sbGVjdGVkSEtHOyANCiAgICB1aW50IGNvbGxlY3RlZEV0aGVyOyAgICANCiAgICANCiAgICAvLyBQcm9wb3NhbCBvZiB0aGUgZnVuZHMgc3BlbmRpbmcNCiAgICBtYXBwaW5nIChieXRlczMyID0+IFByb3Bvc2FsKSBwcm9wb3NhbHM7DQoNCiAgICBlbnVtIFByb3Bvc2FsQ3VycmVuY3kgeyBIS0csIEVUSEVSIH0NCiAgICBQcm9wb3NhbEN1cnJlbmN5IGVudW1EZWNsYXJhdGlvbjsNCiAgICAgICAgICAgICAgICAgIA0KICAgICAgIA0KICAgIHN0cnVjdCBQcm9wb3NhbHsNCiAgICAgICAgDQogICAgICAgIGJ5dGVzMzIgaWQ7DQogICAgICAgIHVpbnQgdmFsdWU7DQoNCiAgICAgICAgc3RyaW5nIHVybERldGFpbHM7DQoNCiAgICAgICAgdWludCB2b3RpbmRFbmRUUzsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgdWludCB2b3Rlc09iamVjdGluZzsNCiAgICAgICAgDQogICAgICAgIGFkZHJlc3Mgc3VibWl0dGVyOw0KICAgICAgICBib29sIHJlZGVlbWVkOw0KDQogICAgICAgIFByb3Bvc2FsQ3VycmVuY3kgcHJvcG9zYWxDdXJyZW5jeTsNCiAgICAgICAgDQogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgdm90ZWQ7DQogICAgfQ0KICAgIHVpbnQgY291bnRlclByb3Bvc2FsczsNCiAgICB1aW50IHRpbWVPZkxhc3RQcm9wb3NhbDsNCiAgICANCiAgICBQcm9wb3NhbFtdIGxpc3RQcm9wb3NhbHM7DQogICAgDQoNCiAgICAvKioNCiAgICAgKiBJbXBlYWNobWVudCBwcm9jZXNzIHByb3Bvc2Fscw0KICAgICAqLyAgICANCiAgICBzdHJ1Y3QgSW1wZWFjaG1lbnRQcm9wb3NhbHsNCiAgICAgICAgDQogICAgICAgIHN0cmluZyB1cmxEZXRhaWxzOw0KICAgICAgICANCiAgICAgICAgYWRkcmVzcyBuZXdFeGVjdXRpdmU7DQoNCiAgICAgICAgdWludCB2b3RpbmRFbmRUUzsgICAgICAgIA0KICAgICAgICB1aW50IHZvdGVzU3VwcG9ydGluZzsNCiAgICAgICAgDQogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgdm90ZWQ7ICAgICAgICANCiAgICB9DQogICAgSW1wZWFjaG1lbnRQcm9wb3NhbCBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbDsNCg0KICAgICAgICANCiAgICAvKioNCiAgICAgKiANCiAgICAgKiAgRFNUQ29udHJhY3Q6IGN0b3IgZm9yIERTVCB0b2tlbiBhbmQgZ292ZXJuZW5jZSBjb250cmFjdA0KICAgICAqDQogICAgICogIEBwYXJhbSBldmVudEluZm9BZGRyIEV2ZW50SW5mbzogYWRkcmVzcyBvZiBvYmplY3QgZGVub3RlcyBldmVudHMgDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWlsZXN0b25lcyAgICAgIA0KICAgICAqICBAcGFyYW0gaGFja2VyR29sZEFkZHIgSGFja2VyR29sZDogYWRkcmVzcyBvZiBIYWNrZXJHb2xkIHRva2VuDQogICAgICoNCiAgICAgKiAgQHBhcmFtIGRzdE5hbWUgc3RyaW5nOiBkc3ROYW1lOiByZWFsIG5hbWUgb2YgdGhlIHRlYW0NCiAgICAgKg0KICAgICAqICBAcGFyYW0gZHN0U3ltYm9sIHN0cmluZzogMyBsZXR0ZXIgc3ltYm9sZCBvZiB0aGUgdGVhbQ0KICAgICAqDQogICAgICovIA0KICAgIGZ1bmN0aW9uIERTVENvbnRyYWN0KEV2ZW50SW5mbyBldmVudEluZm9BZGRyLCBIYWNrZXJHb2xkIGhhY2tlckdvbGRBZGRyLCBzdHJpbmcgZHN0TmFtZSwgc3RyaW5nIGRzdFN5bWJvbCl7DQogICAgDQogICAgICBleGVjdXRpdmUgICA9IG1zZy5zZW5kZXI7ICANCiAgICAgIG5hbWUgICAgICAgID0gZHN0TmFtZTsNCiAgICAgIHN5bWJvbCAgICAgID0gZHN0U3ltYm9sOw0KDQogICAgICBoYWNrZXJHb2xkID0gSGFja2VyR29sZChoYWNrZXJHb2xkQWRkcik7DQogICAgICBldmVudEluZm8gID0gRXZlbnRJbmZvKGV2ZW50SW5mb0FkZHIpOw0KICAgIH0NCiAgICANCg0KICAgIGZ1bmN0aW9uKCkgcGF5YWJsZQ0KICAgICAgICAgICAgICAgb25seUFmdGVyRW5kIHsNCiAgICAgICAgDQogICAgICAgIC8vIHRoZXJlIGlzIHRva2VucyBsZWZ0IGZyb20gaGFja2F0aG9uIA0KICAgICAgICBpZiAoZXRoZXJQcmljZSA9PSAwKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIHVpbnQgdG9rZW5zID0gbXNnLnZhbHVlICogZXRoZXJQcmljZSAqIERFQ0lNQUxfWkVST1MgLyAoMSBldGhlcik7DQogICAgICAgIA0KICAgICAgICAvLyBjaGVjayBpZiBkZW1hbmQgb2YgdG9rZW5zIGlzIA0KICAgICAgICAvLyBvdmVyZmxvdyB0aGUgc3VwcGx5IA0KICAgICAgICB1aW50IHJldEV0aGVyID0gMDsNCiAgICAgICAgaWYgKGJhbGFuY2VzW3RoaXNdIDwgdG9rZW5zKSB7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHRva2VucyA9IGJhbGFuY2VzW3RoaXNdOw0KICAgICAgICAgICAgcmV0RXRoZXIgPSBtc2cudmFsdWUgLSB0b2tlbnMgLyBldGhlclByaWNlICogKDEgZmlubmV5KTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyByZXR1cm4gbGVmdCBldGhlciANCiAgICAgICAgICAgIGlmICghbXNnLnNlbmRlci5zZW5kKHJldEV0aGVyKSkgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICAvLyBkbyB0cmFuc2Zlcg0KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSArPSB0b2tlbnM7DQogICAgICAgIGJhbGFuY2VzW3RoaXNdIC09IHRva2VuczsNCiAgICAgICAgDQogICAgICAgIC8vIGNvdW50IGNvbGxlY3RlZCBldGhlciANCiAgICAgICAgY29sbGVjdGVkRXRoZXIgKz0gbXNnLnZhbHVlIC0gcmV0RXRoZXI7IA0KICAgICAgICANCiAgICAgICAgLy8gcmlzZSBldmVudA0KICAgICAgICBCdXlGb3JFdGhlclRyYW5zYWN0aW9uKG1zZy5zZW5kZXIsIGNvbGxlY3RlZEV0aGVyLCB0b3RhbFN1cHBseVZhciwgZXRoZXJQcmljZSwgdG9rZW5zKTsNCiAgICAgICAgDQogICAgfQ0KDQogICAgDQogICAgDQogICAgLyoqDQogICAgICogc2V0SEtHUHJpY2UgLSBzZXQgcHJpY2U6IDFIS0cgPT4gRFNUIHRva2VucyBxdHkNCiAgICAgKg0KICAgICAqICBAcGFyYW0gcXR5Rm9yT25lSEtHIHVpbnQ6IERTVCB0b2tlbnMgZm9yIDEgSEtHDQogICAgICogDQogICAgICovICAgIA0KICAgICBmdW5jdGlvbiBzZXRIS0dQcmljZSh1aW50IHF0eUZvck9uZUhLRykgb25seUV4ZWN1dGl2ZSAgew0KICAgICAgICAgDQogICAgICAgICBoa2dQcmljZSA9IHF0eUZvck9uZUhLRzsNCiAgICAgICAgIFByaWNlSEtHQ2hhbmdlKHF0eUZvck9uZUhLRywgcHJlZmVyZWRRdHlTb2xkLCB0b3RhbFN1cHBseVZhcik7DQogICAgIH0NCiAgICAgDQogICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIA0KICAgICAqIGlzc3VlUHJlZmVyZWRUb2tlbnMgLSBwcmVmZXJlZCB0b2tlbnMgaXNzdWVkIG9uIHRoZSBoYWNrYXRob24gZXZlbnQNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgZ3JhbnQgc3BlY2lhbCByaWdodHMNCiAgICAgKg0KICAgICAqICBAcGFyYW0gcXR5Rm9yT25lSEtHIHVpbnQ6IHByaWNlIERTVCB0b2tlbnMgZm9yIG9uZSAxIEhLRw0KICAgICAqICBAcGFyYW0gcXR5VG9FbWl0IHVpbnQ6IG5ldyBzdXBwbHkgb2YgdG9rZW5zIA0KICAgICAqIA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzc3VlUHJlZmVyZWRUb2tlbnModWludCBxdHlGb3JPbmVIS0csIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBxdHlUb0VtaXQpIG9ubHlFeGVjdXRpdmUgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUlmQWJsZVRvSXNzdWVUb2tlbnMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5QmVmb3JlRW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUFmdGVyVHJhZGluZ1N0YXJ0IHsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgLy8gbm8gaXNzdWVuY2UgaXMgYWxsb3dlZCBiZWZvcmUgZW5saXN0ZWQgb24gdGhlDQogICAgICAgIC8vIGV4Y2hhbmdlIA0KICAgICAgICBpZiAodmlydHVhbEV4Y2hhbmdlQWRkcmVzcyA9PSAweDApIHRocm93Ow0KICAgICAgICAgICAgDQogICAgICAgIHRvdGFsU3VwcGx5VmFyICs9IHF0eVRvRW1pdDsNCiAgICAgICAgYmFsYW5jZXNbdGhpc10gKz0gcXR5VG9FbWl0Ow0KICAgICAgICBoa2dQcmljZSA9IHF0eUZvck9uZUhLRzsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICAvLyBub3cgc3BlbmRlciBjYW4gdXNlIGJhbGFuY2UgaW4gDQogICAgICAgIC8vIGFtb3VudCBvZiB2YWx1ZSBmcm9tIG93bmVyIGJhbGFuY2UNCiAgICAgICAgYWxsb3dlZFt0aGlzXVt2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzXSArPSBxdHlUb0VtaXQ7DQogICAgICAgIA0KICAgICAgICAvLyByaXNlIGV2ZW50IGFib3V0IHRoZSB0cmFuc2FjdGlvbg0KICAgICAgICBBcHByb3ZhbCh0aGlzLCB2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzLCBxdHlUb0VtaXQpOw0KICAgICAgICANCiAgICAgICAgLy8gcmlzZSBldmVudCANCiAgICAgICAgRHN0VG9rZW5zSXNzdWVkKGhrZ1ByaWNlLCBwcmVmZXJlZFF0eVNvbGQsIHRvdGFsU3VwcGx5VmFyLCBxdHlUb0VtaXQpOw0KICAgIH0NCg0KICAgIA0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIA0KICAgICAqIGJ1eUZvckhhY2tlckdvbGQgLSBvbiB0aGUgaGFjayBldmVudCB0aGlzIGZ1bmN0aW9uIGlzIGF2YWlsYWJsZSANCiAgICAgKiAgICAgICAgICAgICAgICAgICAgdGhlIGJ1eWVyIGZvciBoYWNrZXIgZ29sZCB3aWxsIGdhaW4gdm90ZXMgdG8gDQogICAgICogICAgICAgICAgICAgICAgICAgIGluZmx1ZW5jZSBmdXR1cmUgcHJvcG9zYWxzIG9uIHRoZSBEU1QNCiAgICAgKiAgICANCiAgICAgKiAgQHBhcmFtIGhrZ1ZhbHVlIC0gcXR5IG9mIHRoaXMgRFNUIHRva2VucyBmb3IgMSBIS0cgICAgIA0KICAgICAqIA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJ1eUZvckhhY2tlckdvbGQodWludCBoa2dWYWx1ZSkgb25seUJlZm9yZUVuZCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgIA0KICAgICAgLy8gdmFsaWRhdGUgdGhhdCB0aGUgY2FsbGVyIGlzIG9mZmljaWFsIGFjY2VsZXJhdG9yIEhLRyBFeGNoYW5nZQ0KICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdmlydHVhbEV4Y2hhbmdlQWRkcmVzcykgdGhyb3c7DQogICAgICANCiAgICAgIA0KICAgICAgLy8gdHJhbnNmZXIgdG9rZW4gDQogICAgICBhZGRyZXNzIHNlbmRlciA9IHR4Lm9yaWdpbjsNCiAgICAgIHVpbnQgdG9rZW5zUXR5ID0gaGtnVmFsdWUgKiBoa2dQcmljZTsNCg0KICAgICAgLy8gZ2FpbiB2b3RpbmcgcmlnaHRzDQogICAgICB2b3RpbmdSaWdodHNbc2VuZGVyXSArPXRva2Vuc1F0eTsNCiAgICAgIHByZWZlcmVkUXR5U29sZCArPSB0b2tlbnNRdHk7DQogICAgICBjb2xsZWN0ZWRIS0cgKz0gaGtnVmFsdWU7DQoNCiAgICAgIC8vIGRvIGFjdHVhbCB0cmFuc2Zlcg0KICAgICAgdHJhbnNmZXJGcm9tKHRoaXMsIA0KICAgICAgICAgICAgICAgICAgIHZpcnR1YWxFeGNoYW5nZUFkZHJlc3MsIHRva2Vuc1F0eSk7DQogICAgICB0cmFuc2ZlcihzZW5kZXIsIHRva2Vuc1F0eSk7ICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgLy8gcmlzZSBldmVudCAgICAgICANCiAgICAgIEJ1eUZvckhLR1RyYW5zYWN0aW9uKHNlbmRlciwgcHJlZmVyZWRRdHlTb2xkLCB0b3RhbFN1cHBseVZhciwgaGtnUHJpY2UsIHRva2Vuc1F0eSk7DQogICAgICAgIA0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgICAgICANCiAgICANCiAgICAvKioNCiAgICAgKiANCiAgICAgKiBpc3N1ZVRva2VucyAtIGZ1bmN0aW9uIHdpbGwgaXNzdWUgdG9rZW5zIGFmdGVyIHRoZSANCiAgICAgKiAgICAgICAgICAgICAgIGV2ZW50LCBhYmxlIHRvIHNlbGwgZm9yIDEgZXRoZXIgDQogICAgICogDQogICAgICogIEBwYXJhbSBxdHlGb3JPbmVFdGhlciB1aW50OiBEU1QgdG9rZW5zIGZvciAxIEVUSA0KICAgICAqICBAcGFyYW0gcXR5VG9FbWl0IHVpbnQ6IG5ldyB0b2tlbnMgc3VwcGx5DQogICAgICoNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc3N1ZVRva2Vucyh1aW50IHF0eUZvck9uZUV0aGVyLCANCiAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IHF0eVRvRW1pdCkgb25seUFmdGVyRW5kIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5RXhlY3V0aXZlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlJZkFibGVUb0lzc3VlVG9rZW5zIHsNCiAgICAgICAgIA0KICAgICAgICAgYmFsYW5jZXNbdGhpc10gKz0gcXR5VG9FbWl0Ow0KICAgICAgICAgZXRoZXJQcmljZSA9IHF0eUZvck9uZUV0aGVyOw0KICAgICAgICAgdG90YWxTdXBwbHlWYXIgICAgKz0gcXR5VG9FbWl0Ow0KICAgICAgICAgDQogICAgICAgICAvLyByaXNlIGV2ZW50ICANCiAgICAgICAgIERzdFRva2Vuc0lzc3VlZChxdHlGb3JPbmVFdGhlciwgdG90YWxTdXBwbHlWYXIsIHRvdGFsU3VwcGx5VmFyLCBxdHlUb0VtaXQpOw0KICAgIH0NCiAgICAgDQogICAgDQogICAgLyoqDQogICAgICogc2V0RXRoZXJQcmljZSAtIGNoYW5nZSB0aGUgdG9rZW4gcHJpY2UNCiAgICAgKg0KICAgICAqICBAcGFyYW0gcXR5Rm9yT25lRXRoZXIgdWludDogbmV3IHByaWNlIC0gRFNUIHRva2VucyBmb3IgMSBFVEgNCiAgICAgKi8gICAgIA0KICAgIGZ1bmN0aW9uIHNldEV0aGVyUHJpY2UodWludCBxdHlGb3JPbmVFdGhlcikgb25seUFmdGVyRW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5RXhlY3V0aXZlIHsNCiAgICAgICAgIGV0aGVyUHJpY2UgPSBxdHlGb3JPbmVFdGhlcjsgDQoNCiAgICAgICAgIC8vIHJpc2UgZXZlbnQgZm9yIHRoaXMNCiAgICAgICAgIE5ld0V0aGVyUHJpY2UocXR5Rm9yT25lRXRoZXIpOw0KICAgIH0gICAgDQogICAgDQoNCiAgICAvKioNCiAgICAgKiAgZGlzYWJsZVRva2VuSXNzdWFuY2UgLSBmdW5jdGlvbiB3aWxsIGRpc2FibGUgYW55IA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbiBmb3IgZnV0dXJlIHRva2VuIA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgIGlzc3VlbmNlDQogICAgICovDQogICAgZnVuY3Rpb24gZGlzYWJsZVRva2VuSXNzdWFuY2UoKSBvbmx5RXhlY3V0aXZlIHsNCiAgICAgICAgYWJsZVRvSXNzdWVUb2tlbnMgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgIERpc2FibGVUb2tlbklzc3VhbmNlKCk7DQogICAgfQ0KDQogICAgDQogICAgLyoqDQogICAgICogIGJ1cm5SZW1haW5Ub2tlbiAtICBlbGltaW5hdGVkIGFsbCBhdmFpbGFibGUgZm9yIHNhbGUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIHRva2Vucy4gDQogICAgICovDQogICAgZnVuY3Rpb24gYnVyblJlbWFpblRva2VuKCkgb25seUV4ZWN1dGl2ZSB7DQogICAgDQogICAgICAgIHRvdGFsU3VwcGx5VmFyIC09IGJhbGFuY2VzW3RoaXNdOw0KICAgICAgICBiYWxhbmNlc1t0aGlzXSA9IDA7DQogICAgICAgIA0KICAgICAgICAvLyByaXNlIGV2ZW50IGZvciB0aGlzDQogICAgICAgIEJ1cm5lZEFsbFJlbWFpbmVkVG9rZW5zKCk7DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqICBzdWJtaXRFdGhlclByb3Bvc2FsOiBzdWJtaXQgcHJvcG9zYWwgdG8gdXNlIHBhcnQgb2YgdGhlIA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICBjb2xsZWN0ZWQgZXRoZXIgZnVuZHMNCiAgICAgKg0KICAgICAqICAgQHBhcmFtIHJlcXVlc3RWYWx1ZSB1aW50OiB2YWx1ZSBpbiB3ZWkgDQogICAgICogICBAcGFyYW0gdXJsIHN0cmluZzogZGV0YWlscyBvZiB0aGUgcHJvcG9zYWwgDQogICAgICovIA0KICAgIGZ1bmN0aW9uIHN1Ym1pdEV0aGVyUHJvcG9zYWwodWludCByZXF1ZXN0VmFsdWUsIHN0cmluZyB1cmwpIG9ubHlBZnRlckVuZCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5RXhlY3V0aXZlIHJldHVybnMgKGJ5dGVzMzIgcmVzdWx0SWQsIGJvb2wgcmVzdWx0U3VjY2VzKSB7ICAgICAgIA0KICAgIA0KICAgICAgICAvLyBlbnN1cmUgdGhlcmUgaXMgbm8gbW9yZSBpc3N1ZW5jZSBhdmFpbGFibGUgDQogICAgICAgIGlmIChhYmxlVG9Jc3N1ZVRva2VucykgdGhyb3c7DQogICAgICAgICAgICANCiAgICAgICAgLy8gZW5zdXJlIHRoZXJlIGlzIG5vIG1vcmUgdG9rZW5zIGF2YWlsYWJsZSANCiAgICAgICAgaWYgKGJhbGFuY2VPZih0aGlzKSA+IDApIHRocm93Ow0KDQogICAgICAgIC8vIFBvc3NpYmxlIHRvIHN1Ym1pdCBhIHByb3Bvc2FsIG9uY2UgMiB3ZWVrcyANCiAgICAgICAgaWYgKG5vdyA8ICh0aW1lT2ZMYXN0UHJvcG9zYWwgKyAyIHdlZWtzKSkgdGhyb3c7DQogICAgICAgICAgICANCiAgICAgICAgdWludCBwZXJjZW50ID0gY29sbGVjdGVkRXRoZXIgLyAxMDA7DQogICAgICAgICAgICANCiAgICAgICAgaWYgKHJlcXVlc3RWYWx1ZSA+IFBST1BPU0FMX0ZVTkRTX1RIICogcGVyY2VudCkgdGhyb3c7DQoNCiAgICAgICAgLy8gaWYgcmVtYWluZWQgdmFsdWUgaXMgbGVzcyB0aGFuIHJlcXVlc3RlZCBnYWluIGFsbC4NCiAgICAgICAgaWYgKHJlcXVlc3RWYWx1ZSA+IHRoaXMuYmFsYW5jZSkgDQogICAgICAgICAgICByZXF1ZXN0VmFsdWUgPSB0aGlzLmJhbGFuY2U7ICAgIA0KICAgICAgICAgICAgDQogICAgICAgIC8vIHNldCBpZCBvZiB0aGUgcHJvcG9zYWwNCiAgICAgICAgLy8gc3VibWl0IHByb3Bvc2FsIHRvIHRoZSBtYXANCiAgICAgICAgYnl0ZXMzMiBpZCA9IHNoYTMobXNnLmRhdGEsIG5vdyk7DQogICAgICAgIHVpbnQgdGltZUVuZHMgPSBub3cgKyBQUk9QT1NBTF9MSUZFVElNRTsgDQogICAgICAgICAgICANCiAgICAgICAgUHJvcG9zYWwgbWVtb3J5IG5ld1Byb3Bvc2FsID0gUHJvcG9zYWwoaWQsIHJlcXVlc3RWYWx1ZSwgdXJsLCB0aW1lRW5kcywgMCwgbXNnLnNlbmRlciwgZmFsc2UsIFByb3Bvc2FsQ3VycmVuY3kuRVRIRVIpOw0KICAgICAgICBwcm9wb3NhbHNbaWRdID0gbmV3UHJvcG9zYWw7DQogICAgICAgIGxpc3RQcm9wb3NhbHMucHVzaChuZXdQcm9wb3NhbCk7DQogICAgICAgICAgICANCiAgICAgICAgdGltZU9mTGFzdFByb3Bvc2FsID0gbm93OyAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICBQcm9wb3NhbFJlcXVlc3RTdWJtaXR0ZWQoaWQsIHJlcXVlc3RWYWx1ZSwgdGltZUVuZHMsIHVybCwgbXNnLnNlbmRlcik7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gKGlkLCB0cnVlKTsNCiAgICB9DQogICAgDQogICAgDQogICAgIA0KICAgIC8qKg0KICAgICAqIA0KICAgICAqIHN1Ym1pdEhLR1Byb3Bvc2FsIC0gc3VibWl0IHByb3Bvc2FsIHRvIHJlcXVlc3QgZm9yIA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgcGFydGlhbCBIS0cgZnVuZHMgY29sbGVjdGVkIA0KICAgICAqIA0KICAgICAqICBAcGFyYW0gcmVxdWVzdFZhbHVlIHVpbnQ6IHZhbHVlIGluIEhLRyB0byByZXF1ZXN0LiANCiAgICAgKiAgQHBhcmFtIHVybCBzdHJpbmc6IHVybCB3aXRoIGRldGFpbHMgb24gdGhlIHByb3Bvc2l0aW9uIA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHN1Ym1pdEhLR1Byb3Bvc2FsKHVpbnQgcmVxdWVzdFZhbHVlLCBzdHJpbmcgdXJsKSBvbmx5QWZ0ZXJFbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUV4ZWN1dGl2ZSByZXR1cm5zIChieXRlczMyIHJlc3VsdElkLCBib29sIHJlc3VsdFN1Y2Nlcyl7DQogICAgICAgIA0KDQogICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIDIgbW9udGhzIG92ZXIgc2luY2UgdGhlIGxhc3QgZXZlbnQuDQogICAgICAgIC8vIFRoZXJlIGlzIG5vIHBvc2libGUgdG8gZ2V0IGFueSBIS0cuIEFmdGVyIDIgbW9udGhzDQogICAgICAgIC8vIGFsbCB0aGUgSEtHIGlzIGF2YWlsYWJsZS4gDQogICAgICAgIGlmIChub3cgPCAoZXZlbnRJbmZvLmdldEV2ZW50RW5kKCkgKyA4IHdlZWtzKSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBQb3NzaWJsZSB0byBzdWJtaXQgYSBwcm9wb3NhbCBvbmNlIDIgd2Vla3MgDQogICAgICAgIGlmIChub3cgPCAodGltZU9mTGFzdFByb3Bvc2FsICsgMiB3ZWVrcykpIHRocm93Ow0KDQogICAgICAgIHVpbnQgcGVyY2VudCA9IHByZWZlcmVkUXR5U29sZCAvIDEwMDsNCiAgICAgICAgDQogICAgICAgIC8vIHZhbGlkYXRlIHRoZSBhbW91bnQgaXMgbGVnaXQNCiAgICAgICAgLy8gZmlyc3QgNSBwcm9wb3NhbHMgc2hvdWxkIGJlIGxlc3MgdGhhbiAyMCUgDQogICAgICAgIGlmIChjb3VudGVyUHJvcG9zYWxzIDw9IDUgJiYgDQogICAgICAgICAgICByZXF1ZXN0VmFsdWUgICAgID4gIFBST1BPU0FMX0ZVTkRTX1RIICogcGVyY2VudCkgdGhyb3c7DQogICAgICAgICAgICAgICAgDQogICAgICAgIC8vIGlmIHJlbWFpbmVkIHZhbHVlIGlzIGxlc3MgdGhhbiByZXF1ZXN0ZWQgDQogICAgICAgIC8vIGdhaW4gYWxsLg0KICAgICAgICBpZiAocmVxdWVzdFZhbHVlID4gZ2V0SEtHT3duZWQoKSkgDQogICAgICAgICAgICByZXF1ZXN0VmFsdWUgPSBnZXRIS0dPd25lZCgpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIC8vIHNldCBpZCBvZiB0aGUgcHJvcG9zYWwNCiAgICAgICAgLy8gc3VibWl0IHByb3Bvc2FsIHRvIHRoZSBtYXANCiAgICAgICAgYnl0ZXMzMiBpZCA9IHNoYTMobXNnLmRhdGEsIG5vdyk7DQogICAgICAgIHVpbnQgdGltZUVuZHMgPSBub3cgKyBQUk9QT1NBTF9MSUZFVElNRTsgDQogICAgICAgIA0KICAgICAgICBQcm9wb3NhbCBtZW1vcnkgbmV3UHJvcG9zYWwgPSBQcm9wb3NhbChpZCwgcmVxdWVzdFZhbHVlLCB1cmwsIHRpbWVFbmRzLCAwLCBtc2cuc2VuZGVyLCBmYWxzZSwgUHJvcG9zYWxDdXJyZW5jeS5IS0cpOw0KICAgICAgICBwcm9wb3NhbHNbaWRdID0gbmV3UHJvcG9zYWw7DQogICAgICAgIGxpc3RQcm9wb3NhbHMucHVzaChuZXdQcm9wb3NhbCk7DQogICAgICAgIA0KICAgICAgICArK2NvdW50ZXJQcm9wb3NhbHM7DQogICAgICAgIHRpbWVPZkxhc3RQcm9wb3NhbCA9IG5vdzsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgIFByb3Bvc2FsUmVxdWVzdFN1Ym1pdHRlZChpZCwgcmVxdWVzdFZhbHVlLCB0aW1lRW5kcywgdXJsLCBtc2cuc2VuZGVyKTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiAoaWQsIHRydWUpOyAgICAgICAgDQogICAgfSAgDQogICAgDQogICAgDQogICAgDQogICAgLyoqDQogICAgICogb2JqZWN0UHJvcG9zYWwgLSBvYmplY3QgcHJldmlvdXNseSBzdWJtaXR0ZWQgcHJvcG9zYWwsIA0KICAgICAqICAgICAgICAgICAgICAgICAgdGhlIG9iamVjdGlvbiByaWdodCBpcyBvYnRhaW5lZCBieSANCiAgICAgKiAgICAgICAgICAgICAgICAgIHB1cmNoYXNpbmcgcHJlZmVyZWQgdG9rZW5zIG9uIHRpbWUgb2YgDQogICAgICogICAgICAgICAgICAgICAgICB0aGUgaGFja2F0aG9uLg0KICAgICAqIA0KICAgICAqICBAcGFyYW0gaWQgYnl0ZXMzMiA6IHRoZSBpZCBvZiB0aGUgcHJvcG9zbGEgdG8gcmVkZWVtDQogICAgICovDQogICAgIGZ1bmN0aW9uIG9iamVjdFByb3Bvc2FsKGJ5dGVzMzIgaWQpew0KICAgICAgICAgDQogICAgICAgIFByb3Bvc2FsIG1lbW9yeSBwcm9wb3NhbCA9IHByb3Bvc2Fsc1tpZF07DQogICAgICAgICANCiAgICAgICAgLy8gY2hlY2sgcHJvcG9zYWwgZXhpc3QgDQogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLmlkID09IDApIHRocm93Ow0KDQogICAgICAgIC8vIGNoZWNrIGFscmVhZHkgcmVkZWVtZWQNCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0ucmVkZWVtZWQpIHRocm93Ow0KICAgICAgICAgDQogICAgICAgIC8vIGVuc3VyZSBvYmplY3Rpb24gdGltZQ0KICAgICAgICBpZiAobm93ID49IHByb3Bvc2Fsc1tpZF0udm90aW5kRW5kVFMpIHRocm93Ow0KICAgICAgICAgDQogICAgICAgIC8vIGVuc3VyZSBub3Qgdm90ZWQgIA0KICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS52b3RlZFttc2cuc2VuZGVyXSkgdGhyb3c7DQogICAgICAgICANCiAgICAgICAgIC8vIHN1Ym1pdCB2b3Rlcw0KICAgICAgICAgdWludCB2b3RlcyA9IHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXTsNCiAgICAgICAgIHByb3Bvc2Fsc1tpZF0udm90ZXNPYmplY3RpbmcgKz0gdm90ZXM7DQogICAgICAgICANCiAgICAgICAgIC8vIG1hcmsgdm90ZWQgDQogICAgICAgICBwcm9wb3NhbHNbaWRdLnZvdGVkW21zZy5zZW5kZXJdID0gdHJ1ZTsgDQogICAgICAgICANCiAgICAgICAgIHVpbnQgaWR4ID0gZ2V0SW5kZXhCeVByb3Bvc2FsSWQoaWQpOw0KICAgICAgICAgbGlzdFByb3Bvc2Fsc1tpZHhdID0gcHJvcG9zYWxzW2lkXTsgICANCg0KICAgICAgICAgT2JqZWN0ZWRWb3RlKGlkLCBtc2cuc2VuZGVyLCB2b3Rlcyk7ICAgICAgICAgDQogICAgIH0NCiAgICAgDQogICAgIA0KICAgICBmdW5jdGlvbiBnZXRJbmRleEJ5UHJvcG9zYWxJZChieXRlczMyIGlkKSByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgICANCiAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxpc3RQcm9wb3NhbHMubGVuZ3RoOyArK2kpew0KICAgICAgICAgICAgIGlmIChpZCA9PSBsaXN0UHJvcG9zYWxzW2ldLmlkKSByZXR1cm4gaTsNCiAgICAgICAgIH0NCiAgICAgfQ0KICAgIA0KICAgIA0KICAgDQogICAgLyoqDQogICAgICogcmVkZWVtUHJvcG9zYWxGdW5kcyAtIHJlZGVlbSBmdW5kcyByZXF1ZXN0ZWQgYnkgcHJpb3IgDQogICAgICogICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdHRlZCBwcm9wb3NhbCAgICAgDQogICAgICogDQogICAgICogQHBhcmFtIGlkIGJ5dGVzMzI6IHRoZSBpZCBvZiB0aGUgcHJvcG9zYWwgdG8gcmVkZWVtDQogICAgICovDQogICAgZnVuY3Rpb24gcmVkZWVtUHJvcG9zYWxGdW5kcyhieXRlczMyIGlkKSBvbmx5RXhlY3V0aXZlIHsNCg0KICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS5pZCA9PSAwKSB0aHJvdzsNCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0uc3VibWl0dGVyICE9IG1zZy5zZW5kZXIpIHRocm93Ow0KDQogICAgICAgIC8vIGVuc3VyZSBvYmplY3Rpb24gdGltZQ0KICAgICAgICBpZiAobm93IDwgcHJvcG9zYWxzW2lkXS52b3RpbmRFbmRUUykgdGhyb3c7DQogICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICANCiAgICAgICAgICAgIC8vIGNoZWNrIGFscmVhZHkgcmVkZWVtZWQNCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0ucmVkZWVtZWQpIHRocm93Ow0KDQogICAgICAgIC8vIGNoZWNrIHZvdGVzIG9iamVjdGlvbiA9PiA1NSUgb2YgdG90YWwgdm90ZXMNCiAgICAgICAgdWludCBvYmplY3Rpb25UaHJlc2hvbGQgPSBwcmVmZXJlZFF0eVNvbGQgLyAxMDAgKiA1NTsNCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0udm90ZXNPYmplY3RpbmcgID4gb2JqZWN0aW9uVGhyZXNob2xkKSB0aHJvdzsNCiAgICANCiAgICANCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0ucHJvcG9zYWxDdXJyZW5jeSA9PSBQcm9wb3NhbEN1cnJlbmN5LkhLRyl7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIHNlbmQgaGFja2VyIGdvbGQgDQogICAgICAgICAgICBoYWNrZXJHb2xkLnRyYW5zZmVyKHByb3Bvc2Fsc1tpZF0uc3VibWl0dGVyLCBwcm9wb3NhbHNbaWRdLnZhbHVlKTsgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgIC8vIHNlbmQgZXRoZXIgICAgICAgICAgICAgIA0KICAgICAgICAgICBib29sIHN1Y2Nlc3MgPSBwcm9wb3NhbHNbaWRdLnN1Ym1pdHRlci5zZW5kKHByb3Bvc2Fsc1tpZF0udmFsdWUpOyANCg0KICAgICAgICAgICAvLyByaXNlIGV2ZW50DQogICAgICAgICAgIEV0aGVyUmVkZWVtQWNjZXB0ZWQocHJvcG9zYWxzW2lkXS5zdWJtaXR0ZXIsIHByb3Bvc2Fsc1tpZF0udmFsdWUpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBleGVjdXRlIHRoZSBwcm9wb3NhbCANCiAgICAgICAgcHJvcG9zYWxzW2lkXS5yZWRlZW1lZCA9IHRydWU7IA0KICAgIH0NCiAgICANCiAgICANCiAgICAvKioNCiAgICAgKiAgZ2V0QWxsVGhlRnVuZHMgLSB0byBlbnN1cmUgdGhlcmUgaXMgbm8gZGVhZGxvY2sgY2FuIA0KICAgICAqICAgICAgICAgICAgICAgICAgIGNhbiBoYXBwZW4sIGFuZCBubyBjYXNlIHRoYXQgdm90aW5nIA0KICAgICAqICAgICAgICAgICAgICAgICAgIHN0cnVjdHVyZSB3aWxsIGZyZWV6ZSB0aGUgZnVuZHMgZm9yZXZlcg0KICAgICAqICAgICAgICAgICAgICAgICAgIHRoZSBzdGFydHVwIHdpbGwgYmUgYWJsZSB0byBnZXQgYWxsIHRoZQ0KICAgICAqICAgICAgICAgICAgICAgICAgIGZ1bmRzIHdpdGhvdXQgYSBwcm9wb3NhbCByZXF1aXJlZCBhZnRlcg0KICAgICAqICAgICAgICAgICAgICAgICAgIDYgbW9udGhzLg0KICAgICAqIA0KICAgICAqIA0KICAgICAqLyAgICAgICAgICAgICANCiAgICBmdW5jdGlvbiBnZXRBbGxUaGVGdW5kcygpIG9ubHlFeGVjdXRpdmUgew0KICAgICAgICANCiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBkZWFkbG9jayBpbiB2b3RpbmcgcGFydGljaXBhdGVzDQogICAgICAgIC8vIHRoZSBmdW5kcyBjYW4gYmUgcmVkZWVtZWQgY29tcGxldGVsbHkgaW4gNiBtb250aHMNCiAgICAgICAgaWYgKG5vdyA8IChldmVudEluZm8uZ2V0RXZlbnRFbmQoKSArIDI0IHdlZWtzKSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0gIA0KICAgICAgICANCiAgICAgICAgLy8gYWxsIHRoZSBFdGhlcg0KICAgICAgICBib29sIHN1Y2Nlc3MgPSBtc2cuc2VuZGVyLnNlbmQodGhpcy5iYWxhbmNlKTsgICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gYWxsIHRoZSBIS0cNCiAgICAgICAgaGFja2VyR29sZC50cmFuc2Zlcihtc2cuc2VuZGVyLCBnZXRIS0dPd25lZCgpKTsgICAgICAgICAgICAgIA0KICAgIH0NCiAgICANCiAgICANCiAgICAvKioNCiAgICAgKiBzdWJtaXRJbXBlYWNobWVudFByb3Bvc2FsIC0gc3VibWl0IHJlcXVlc3QgdG8gc3dpdGNoIA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGVjdXRpdmUuDQogICAgICogDQogICAgICogIEBwYXJhbSB1cmxEZXRhaWxzICAtIGRldGFpbHMgb2YgdGhlIGltcGVhY2htZW50IHByb3Bvc2FsIA0KICAgICAqICBAcGFyYW0gbmV3RXhlY3V0aXZlIC0gYWRkcmVzcyBvZiB0aGUgbmV3IGV4ZWN1dGl2ZSANCiAgICAgKiANCiAgICAgKi8gICAgICAgICAgICAgDQogICAgIGZ1bmN0aW9uIHN1Ym1pdEltcGVhY2htZW50UHJvcG9zYWwoc3RyaW5nIHVybERldGFpbHMsIGFkZHJlc3MgbmV3RXhlY3V0aXZlKXsNCiAgICAgICAgIA0KICAgICAgICAvLyB0byBvZmZlciBpbXBlYWNobWVudCB5b3Ugc2hvdWxkIGhhdmUgDQogICAgICAgIC8vIHZvdGluZyByaWdodHMNCiAgICAgICAgaWYgKHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXSA9PSAwKSB0aHJvdzsNCiAgICAgICAgIA0KICAgICAgICAvLyB0aGUgc3VibWlzc2lvbiBvZiB0aGUgZmlyc3QgaW1wZWFjaG1lbnQgDQogICAgICAgIC8vIHByb3Bvc2FsIGlzIHBvc3NpYmxlIG9ubHkgYWZ0ZXIgMyBtb250aHMNCiAgICAgICAgLy8gc2luY2UgdGhlIGhhY2thdGhvbiBpcyBvdmVyDQogICAgICAgIGlmIChub3cgPCAoZXZlbnRJbmZvLmdldEV2ZW50RW5kKCkgKyAxMiB3ZWVrcykpIHRocm93Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgLy8gY2hlY2sgdGhlcmUgaXMgMSBtb250aHMgb3ZlciBzaW5jZSBsYXN0IG9uZQ0KICAgICAgICBpZiAobGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90aW5kRW5kVFMgIT0gMCAmJiANCiAgICAgICAgICAgIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGluZEVuZFRTICsgIDIgd2Vla3MgPiBub3cpIHRocm93Ow0KDQoNCiAgICAgICAgLy8gc3VibWl0IGltcGVhY2htZW50IHByb3Bvc2FsDQogICAgICAgIC8vIGFkZCB0aGUgdm90ZXMgb2YgdGhlIHN1Ym1pdHRlciANCiAgICAgICAgLy8gdG8gdGhlIHByb3Bvc2FsIHJpZ2h0IGF3YXkNCiAgICAgICAgbGFzdEltcGVhY2htZW50UHJvcG9zYWwgPSBJbXBlYWNobWVudFByb3Bvc2FsKHVybERldGFpbHMsIG5ld0V4ZWN1dGl2ZSwgbm93ICsgMiB3ZWVrcywgdm90aW5nUmlnaHRzW21zZy5zZW5kZXJdKTsNCiAgICAgICAgbGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZWRbbXNnLnNlbmRlcl0gPSB0cnVlOw0KICAgICAgICAgDQogICAgICAgIC8vIHJpc2UgZXZlbnQNCiAgICAgICAgSW1wZWFjaG1lbnRQcm9wb3NlZChtc2cuc2VuZGVyLCB1cmxEZXRhaWxzLCBub3cgKyAyIHdlZWtzLCBuZXdFeGVjdXRpdmUpOw0KICAgICB9DQogICAgDQogICAgDQogICAgLyoqDQogICAgICogc3VwcG9ydEltcGVhY2htZW50IC0gdm90ZSBmb3IgaW1wZWFjaG1lbnQgcHJvcG9zYWwgDQogICAgICogICAgICAgICAgICAgICAgICAgICAgdGhhdCBpcyBjdXJyZW50bHkgaW4gcHJvZ3Jlc3MNCiAgICAgKg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHN1cHBvcnRJbXBlYWNobWVudCgpew0KDQogICAgICAgIC8vIGVuc3VyZSB0aGF0IHN1cHBvcnQgaXMgZm9yIGV4aXN0IHByb3Bvc2FsIA0KICAgICAgICBpZiAobGFzdEltcGVhY2htZW50UHJvcG9zYWwubmV3RXhlY3V0aXZlID09IDB4MCkgdGhyb3c7DQogICAgDQogICAgICAgIC8vIHRvIG9mZmVyIGltcGVhY2htZW50IHlvdSBzaG91bGQgaGF2ZSANCiAgICAgICAgLy8gdm90aW5nIHJpZ2h0cw0KICAgICAgICBpZiAodm90aW5nUmlnaHRzW21zZy5zZW5kZXJdID09IDApIHRocm93Ow0KICAgICAgICANCiAgICAgICAgLy8gY2hlY2sgaWYgbm90IHZvdGVkIGFscmVhZHkgDQogICAgICAgIGlmIChsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3RlZFttc2cuc2VuZGVyXSkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICAvLyBjaGVjayBpZiBub3QgZmluaXNoZWQgdGhlIDIgd2Vla3Mgb2Ygdm90aW5nIA0KICAgICAgICBpZiAobGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90aW5kRW5kVFMgKyAyIHdlZWtzIDw9IG5vdykgdGhyb3c7DQogICAgICAgICAgICAgICAgDQogICAgICAgIC8vIHN1cHBvcnQgdGhlIGltcGVhY2htZW50DQogICAgICAgIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGVkW21zZy5zZW5kZXJdID0gdHJ1ZTsNCiAgICAgICAgbGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZXNTdXBwb3J0aW5nICs9IHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXTsNCg0KICAgICAgICAvLyByaXNlIGltcGVhY2htZW50IHN1cHBwb3J0aW5nIGV2ZW50DQogICAgICAgIEltcGVhY2htZW50U3VwcG9ydChtc2cuc2VuZGVyLCB2b3RpbmdSaWdodHNbbXNnLnNlbmRlcl0pOw0KICAgICAgICANCiAgICAgICAgLy8gaWYgdGhlIHZvdGUgaXMgb3ZlciA3MCUgZXhlY3V0ZSB0aGUgc3dpdGNoIA0KICAgICAgICB1aW50IHBlcmNlbnQgPSBwcmVmZXJlZFF0eVNvbGQgLyAxMDA7IA0KICAgICAgICANCiAgICAgICAgaWYgKGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGVzU3VwcG9ydGluZyA+PSA3MCAqIHBlcmNlbnQpew0KICAgICAgICAgICAgZXhlY3V0aXZlID0gbGFzdEltcGVhY2htZW50UHJvcG9zYWwubmV3RXhlY3V0aXZlOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBpbXBlYWNobWVudCBldmVudA0KICAgICAgICAgICAgSW1wZWFjaG1lbnRBY2NlcHRlZChleGVjdXRpdmUpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgIH0gDQogICAgDQogICAgICANCiAgICANCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqIC8vDQogICAgLy8gKiAgICAgQ29uc3RhbnQgR2V0dGVycyAgICAgKiAvLw0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKiogLy8NCiAgICANCiAgICBmdW5jdGlvbiB2b3RpbmdSaWdodHNPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZXN1bHQpIHsNCiAgICAgICAgcmVzdWx0ID0gdm90aW5nUmlnaHRzW19vd25lcl07DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGdldFByZWZlcmVkUXR5U29sZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsNCiAgICAgICAgcmV0dXJuIHByZWZlcmVkUXR5U29sZDsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gc2V0VmlydHVhbEV4Y2hhbmdlKGFkZHJlc3MgdmlydHVhbEV4Y2hhbmdlQWRkcil7DQogICAgICAgIGlmICh2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzICE9IDB4MCkgdGhyb3c7DQogICAgICAgIHZpcnR1YWxFeGNoYW5nZUFkZHJlc3MgPSB2aXJ0dWFsRXhjaGFuZ2VBZGRyOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldEhLR093bmVkKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpew0KICAgICAgICByZXR1cm4gaGFja2VyR29sZC5iYWxhbmNlT2YodGhpcyk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGdldEV0aGVyVmFsdWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiB0aGlzLmJhbGFuY2U7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGdldEV4ZWN1dGl2ZSgpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgcmVzdWx0KXsNCiAgICAgICAgcmV0dXJuIGV4ZWN1dGl2ZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gZ2V0SEtHUHJpY2UoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiBoa2dQcmljZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRFdGhlclByaWNlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpew0KICAgICAgICByZXR1cm4gZXRoZXJQcmljZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gZ2V0RFNUTmFtZSgpIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHJlc3VsdCl7DQogICAgICAgIHJldHVybiBuYW1lOw0KICAgIH0gICAgDQogICAgDQogICAgZnVuY3Rpb24gZ2V0RFNUTmFtZUJ5dGVzKCkgY29uc3RhbnQgcmV0dXJucyhieXRlczMyIHJlc3VsdCl7DQogICAgICAgIHJldHVybiBjb252ZXJ0KG5hbWUpOw0KICAgIH0gICAgDQoNCiAgICBmdW5jdGlvbiBnZXREU1RTeW1ib2woKSBjb25zdGFudCByZXR1cm5zKHN0cmluZyByZXN1bHQpew0KICAgICAgICByZXR1cm4gc3ltYm9sOw0KICAgIH0gICAgDQogICAgDQogICAgZnVuY3Rpb24gZ2V0RFNUU3ltYm9sQnl0ZXMoKSBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIgcmVzdWx0KXsNCiAgICAgICAgcmV0dXJuIGNvbnZlcnQoc3ltYm9sKTsNCiAgICB9ICAgIA0KDQogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgcmVzdWx0KSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBnZXRUb3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KSB7DQogICAgICAgIHJldHVybiB0b3RhbFN1cHBseVZhcjsNCiAgICB9IA0KICAgICAgICANCiAgICBmdW5jdGlvbiBnZXRDb2xsZWN0ZWRFdGhlcigpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0cykgeyAgICAgICAgDQogICAgICAgIHJldHVybiBjb2xsZWN0ZWRFdGhlcjsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gZ2V0Q291bnRlclByb3Bvc2FscygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsNCiAgICAgICAgcmV0dXJuIGNvdW50ZXJQcm9wb3NhbHM7DQogICAgfQ0KICAgICAgICANCiAgICBmdW5jdGlvbiBnZXRQcm9wb3NhbElkQnlJbmRleCh1aW50IGkpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIgcmVzdWx0KXsNCiAgICAgICAgcmV0dXJuIGxpc3RQcm9wb3NhbHNbaV0uaWQ7DQogICAgfSAgICANCg0KICAgIGZ1bmN0aW9uIGdldFByb3Bvc2FsT2JqZWN0aW9uQnlJbmRleCh1aW50IGkpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsNCiAgICAgICAgcmV0dXJuIGxpc3RQcm9wb3NhbHNbaV0udm90ZXNPYmplY3Rpbmc7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0UHJvcG9zYWxWYWx1ZUJ5SW5kZXgodWludCBpKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiBsaXN0UHJvcG9zYWxzW2ldLnZhbHVlOw0KICAgIH0gICAgICAgICAgICAgICAgICANCiAgICANCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50SW1wZWFjaG1lbnRVcmxEZXRhaWxzKCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIHJlc3VsdCl7DQogICAgICAgIHJldHVybiBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC51cmxEZXRhaWxzOw0KICAgIH0NCiAgICANCiAgICANCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50SW1wZWFjaG1lbnRWb3Rlc1N1cHBvcnRpbmcoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3Rlc1N1cHBvcnRpbmc7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGNvbnZlcnQoc3RyaW5nIGtleSkgcmV0dXJucyAoYnl0ZXMzMiByZXQpIHsNCiAgICAgICAgICAgIGlmIChieXRlcyhrZXkpLmxlbmd0aCA+IDMyKSB7DQogICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICB9ICAgICAgDQoNCiAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICByZXQgOj0gbWxvYWQoYWRkKGtleSwgMzIpKQ0KICAgICAgICAgICAgfQ0KICAgIH0gICAgDQogICAgDQogICAgLy8gRW1lcmdlbmN5IEZpeCBsaW1pdGVkIGJ5IHRpbWUgZnVuY3Rpb25zDQogICAgZnVuY3Rpb24gc2V0Vm90ZVJpZ2h0KGFkZHJlc3Mgdm90ZXIsIHVpbnQgYW1tb3VudCl7DQogICAgICAgIA0KICAgICAgICAvLyBsaW1pdGVkIGJ5IFsxMiBKYW4gMjAxNyAwMDowMDowMCBHTVRdDQogICAgICAgIGlmIChub3cgPiAxNDg0MTc5MjAwKSB0aHJvdzsNCg0KICAgICAgICAvLyBsaW1pdGVkIGJ5IG9uZSBhY2NvdW50IHRvIGZpeCANCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gMHgzNDJlNjI3MzJiNzY4NzVkYTkzMDUwODNlYThhZTYzMTI1YTRlNjY3KSB0aHJvdzsNCg0KICAgICAgICB2b3RpbmdSaWdodHNbdm90ZXJdID0gYW1tb3VudDsNCiAgICB9DQogICAgDQogICAgLy8gRW1lcmdlbmN5IEZpeCBsaW1pdGVkIGJ5IHRpbWUgZnVuY3Rpb25zDQogICAgZnVuY3Rpb24gc2V0QmFsYW5jZShhZGRyZXNzIG93bmVyLCB1aW50IGFtbW91bnQpew0KDQogICAgICAgIC8vIGxpbWl0ZWQgYnkgWzEyIEphbiAyMDE3IDAwOjAwOjAwIEdNVF0NCiAgICAgICAgaWYgKG5vdyA+IDE0ODQxNzkyMDApIHRocm93Ow0KICAgICAgICANCiAgICAgICAgLy8gbGltaXRlZCBieSBvbmUgYWNjb3VudCB0byBmaXggDQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IDB4MzQyZTYyNzMyYjc2ODc1ZGE5MzA1MDgzZWE4YWU2MzEyNWE0ZTY2NykgdGhyb3c7DQogICAgICAgIA0KICAgICAgICBiYWxhbmNlc1tvd25lcl0gPSBhbW1vdW50Ow0KICAgIH0NCiAgICANCiAgICAvLyBFbWVyZ2VuY3kgRml4IGxpbWl0ZWQgYnkgdGltZSBmdW5jdGlvbnMNCiAgICBmdW5jdGlvbiBzZXRJbnRlcm5hbEluZm8oYWRkcmVzcyBmaXhFeGVjdXRpdmUsIHVpbnQgZml4VG90YWxTdXBwbHksIHVpbnQyNTYgZml4UHJlZmVyZWRRdHlTb2xkLCANCiAgICAgICAgICAgIHVpbnQyNTYgZml4Q29sbGVjdGVkSEtHLCB1aW50IGZpeENvbGxlY3RlZEV0aGVyKXsNCg0KICAgICAgICAvLyBsaW1pdGVkIGJ5IFsxMiBKYW4gMjAxNyAwMDowMDowMCBHTVRdDQogICAgICAgIGlmIChub3cgPiAxNDg0MTc5MjAwKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIC8vIGxpbWl0ZWQgYnkgb25lIGFjY291bnQgdG8gZml4IA0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSAweDM0MmU2MjczMmI3Njg3NWRhOTMwNTA4M2VhOGFlNjMxMjVhNGU2NjcpIHRocm93Ow0KICAgICAgICANCiAgICAgICAgZXhlY3V0aXZlID0gZml4RXhlY3V0aXZlOw0KICAgICAgICB0b3RhbFN1cHBseVZhciA9IGZpeFRvdGFsU3VwcGx5Ow0KICAgICAgICBwcmVmZXJlZFF0eVNvbGQgPSBmaXhQcmVmZXJlZFF0eVNvbGQ7DQogICAgICAgIGNvbGxlY3RlZEhLRyA9IGZpeENvbGxlY3RlZEhLRzsNCiAgICAgICAgY29sbGVjdGVkRXRoZXIgPSBmaXhDb2xsZWN0ZWRFdGhlcjsNCiAgICB9DQogICAgDQogICAgDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqIC8vDQogICAgLy8gKiAgICAgTW9kaWZpZXJzICAgICAqIC8vDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqIC8vICAgIA0KIA0KICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVFbmQoKSB7IGlmIChub3cgID49ICBldmVudEluZm8uZ2V0RXZlbnRFbmQoKSkgdGhyb3c7IF87IH0NCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJFbmQoKSAgeyBpZiAobm93ICA8ICAgZXZlbnRJbmZvLmdldEV2ZW50RW5kKCkpIHRocm93OyBfOyB9DQogICAgDQogICAgbW9kaWZpZXIgb25seUFmdGVyVHJhZGluZ1N0YXJ0KCkgIHsgaWYgKG5vdyAgPCBldmVudEluZm8uZ2V0VHJhZGluZ1N0YXJ0KCkpIHRocm93OyBfOyB9DQogICAgDQogICAgbW9kaWZpZXIgb25seUV4ZWN1dGl2ZSgpICAgICB7IGlmIChtc2cuc2VuZGVyICE9IGV4ZWN1dGl2ZSkgdGhyb3c7IF87IH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgIG1vZGlmaWVyIG9ubHlJZkFibGVUb0lzc3VlVG9rZW5zKCkgIHsgaWYgKCFhYmxlVG9Jc3N1ZVRva2VucykgdGhyb3c7IF87IH0gDQogICAgDQoNCiAgICAvLyAqKioqKioqKioqKioqKioqKiogLy8NCiAgICAvLyAqICAgICBFdmVudHMgICAgICogLy8NCiAgICAvLyAqKioqKioqKioqKioqKioqKiogLy8gICAgICAgIA0KDQogICAgDQogICAgZXZlbnQgUHJpY2VIS0dDaGFuZ2UodWludCBpbmRleGVkIHF0eUZvck9uZUhLRywgdWludCBpbmRleGVkIHRva2Vuc1NvbGQsIHVpbnQgaW5kZXhlZCB0b3RhbFN1cHBseSk7DQogICAgZXZlbnQgQnV5Rm9ySEtHVHJhbnNhY3Rpb24oYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50IGluZGV4ZWQgdG9rZW5zU29sZCwgdWludCBpbmRleGVkIHRvdGFsU3VwcGx5LCB1aW50IHF0eUZvck9uZUhLRywgdWludCB0b2tlbnNBbW91bnQpOw0KICAgIGV2ZW50IEJ1eUZvckV0aGVyVHJhbnNhY3Rpb24oYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50IGluZGV4ZWQgdG9rZW5zU29sZCwgdWludCBpbmRleGVkIHRvdGFsU3VwcGx5LCB1aW50IHF0eUZvck9uZUV0aGVyLCB1aW50IHRva2Vuc0Ftb3VudCk7DQoNCiAgICBldmVudCBEc3RUb2tlbnNJc3N1ZWQodWludCBpbmRleGVkIHF0eUZvck9uZUhLRywgdWludCBpbmRleGVkIHRva2Vuc1NvbGQsIHVpbnQgaW5kZXhlZCB0b3RhbFN1cHBseSwgdWludCBxdHlUb0VtaXQpOw0KICAgIA0KICAgIGV2ZW50IFByb3Bvc2FsUmVxdWVzdFN1Ym1pdHRlZChieXRlczMyIGlkLCB1aW50IHZhbHVlLCB1aW50IHRpbWVFbmRzLCBzdHJpbmcgdXJsLCBhZGRyZXNzIHNlbmRlcik7DQogICAgDQogICAgZXZlbnQgRXRoZXJSZWRlZW1BY2NlcHRlZChhZGRyZXNzIHNlbmRlciwgdWludCB2YWx1ZSk7DQogICAgDQogICAgZXZlbnQgT2JqZWN0ZWRWb3RlKGJ5dGVzMzIgaWQsIGFkZHJlc3Mgdm90ZXIsIHVpbnQgdm90ZXMpOw0KICAgIA0KICAgIGV2ZW50IEltcGVhY2htZW50UHJvcG9zZWQoYWRkcmVzcyBzdWJtaXR0ZXIsIHN0cmluZyB1cmxEZXRhaWxzLCB1aW50IHZvdGluZEVuZFRTLCBhZGRyZXNzIG5ld0V4ZWN1dGl2ZSk7DQogICAgZXZlbnQgSW1wZWFjaG1lbnRTdXBwb3J0KGFkZHJlc3Mgc3VwcG9ydHRlciwgdWludCB2b3Rlcyk7DQogICAgDQogICAgZXZlbnQgSW1wZWFjaG1lbnRBY2NlcHRlZChhZGRyZXNzIG5ld0V4ZWN1dGl2ZSk7DQoNCiAgICBldmVudCBOZXdFdGhlclByaWNlKHVpbnQgbmV3UXR5Rm9yT25lRXRoZXIpOw0KICAgIGV2ZW50IERpc2FibGVUb2tlbklzc3VhbmNlKCk7DQogICAgDQogICAgZXZlbnQgQnVybmVkQWxsUmVtYWluZWRUb2tlbnMoKTsNCiAgICANCn0='