base 64 content
base64dSTContract2
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4wOw0KDQovKg0KICogVG9rZW4gLSBpcyBhIHNtYXJ0IGNvbnRyYWN0IGludGVyZmFjZSANCiAqIGZvciBtYW5hZ2luZyBjb21tb24gZnVuY3Rpb25hbGl0eSBvZiANCiAqIGEgdG9rZW4uDQogKg0KICogRVJDLjIwIFRva2VuIHN0YW5kYXJkOiBodHRwczovL2dpdGh1Yi5jb20vZXRoIGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKi8NCmNvbnRyYWN0IFRva2VuSW50ZXJmYWNlIHsNCg0KICAgICAgICANCiAgICAvLyB0b3RhbCBhbW91bnQgb2YgdG9rZW5zDQogICAgdWludCB0b3RhbFN1cHBseVZhcjsNCg0KICAgIA0KICAgIC8qKg0KICAgICAqDQogICAgICogYmFsYW5jZU9mKCkgLSBjb25zdGFudCBmdW5jdGlvbiBjaGVjayBjb25jcmV0ZSB0b2tlbnMgYmFsYW5jZSAgDQogICAgICoNCiAgICAgKiAgQHBhcmFtIG93bmVyIC0gYWNjb3VudCBvd25lcg0KICAgICAqICANCiAgICAgKiAgQHJldHVybiB0aGUgdmFsdWUgb2YgYmFsYW5jZSANCiAgICAgKi8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7DQogICAgDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQoNCiAgICAvKioNCiAgICAgKg0KICAgICAqIGFwcHJvdmUoKSAtIGZ1bmN0aW9uIGFwcHJvdmVzIHRvIGEgcGVyc29uIHRvIHNwZW5kIHNvbWUgdG9rZW5zIGZyb20gDQogICAgICogICAgICAgICAgIG93bmVyIGJhbGFuY2UuIA0KICAgICAqDQogICAgICogIEBwYXJhbSBzcGVuZGVyIC0gcGVyc29uIHdob20gdGhpcyByaWdodCBiZWVuIGdyYW50ZWQuDQogICAgICogIEBwYXJhbSB2YWx1ZSAgIC0gdmFsdWUgdG8gc3BlbmQuDQogICAgICogDQogICAgICogIEByZXR1cm4gdHJ1ZSBpbiBjYXNlIG9mIHN1Y2Nlcywgb3RoZXJ3aXNlIGZhaWx1cmUNCiAgICAgKiANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIC8qKg0KICAgICAqDQogICAgICogYWxsb3dhbmNlKCkgLSBjb25zdGFudCBmdW5jdGlvbiB0byBjaGVjayBob3cgbXVjaCBpcyANCiAgICAgKiAgICAgICAgICAgICAgIHBlcm1pdHRlZCB0byBzcGVuZCB0byAzcmQgcGVyc29uIGZyb20gb3duZXIgYmFsYW5jZQ0KICAgICAqDQogICAgICogIEBwYXJhbSBvd25lciAgIC0gb3duZXIgb2YgdGhlIGJhbGFuY2UNCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJtaXR0ZWQgdG8gc3BlbmQgZnJvbSB0aGlzIGJhbGFuY2UgcGVyc29uIA0KICAgICAqICANCiAgICAgKiAgQHJldHVybiAtIHJlbWFpbmluZyByaWdodCB0byBzcGVuZCANCiAgICAgKiANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7DQogICAgDQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHRvdGFsU3VwcGx5KXsNCiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5VmFyOyAgICANCiAgICB9DQoNCiAgICAvLyBldmVudHMgbm90aWZpY2F0aW9ucw0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOw0KfQ0KDQpwcmFnbWEgc29saWRpdHkgXjAuNC4yOw0KDQovKg0KICogU3RhbmRhcmRUb2tlbiAtIGlzIGEgc21hcnQgY29udHJhY3QgIA0KICogZm9yIG1hbmFnaW5nIGNvbW1vbiBmdW5jdGlvbmFsaXR5IG9mIA0KICogYSB0b2tlbi4NCiAqDQogKiBFUkMuMjAgVG9rZW4gc3RhbmRhcmQ6IA0KICogICAgICAgICBodHRwczovL2dpdGh1Yi5jb20vZXRoIGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKi8NCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW5JbnRlcmZhY2Ugew0KDQoNCiAgICAvLyB0b2tlbiBvd25lcnNoaXANCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOw0KDQogICAgLy8gc3BlbmRpbmcgcGVybWlzaW9uIG1hbmFnZW1lbnQNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7DQogICAgDQogICAgDQogICAgDQogICAgZnVuY3Rpb24gU3RhbmRhcmRUb2tlbigpew0KICAgIH0NCiAgICANCiAgICANCiAgICAvKioNCiAgICAgKiB0cmFuc2ZlcigpIC0gdHJhbnNmZXIgdG9rZW5zIGZyb20gbXNnLnNlbmRlciBiYWxhbmNlIA0KICAgICAqICAgICAgICAgICAgICB0byByZXF1ZXN0ZWQgYWNjb3VudA0KICAgICAqDQogICAgICogIEBwYXJhbSB0byAgICAtIHRhcmdldCBhZGRyZXNzIHRvIHRyYW5zZmVyIHRva2Vucw0KICAgICAqICBAcGFyYW0gdmFsdWUgLSBhbW1vdW50IG9mIHRva2VucyB0byB0cmFuc2Zlcg0KICAgICAqDQogICAgICogIEByZXR1cm4gLSBzdWNjZXNzIC8gZmFpbHVyZSBvZiB0aGUgdHJhbnNhY3Rpb24NCiAgICAgKi8gICAgDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IHZhbHVlICYmIHZhbHVlID4gMCkgew0KDQogICAgICAgICAgICAvLyBkbyBhY3R1YWwgdG9rZW5zIHRyYW5zZmVyICAgICAgIA0KICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gdmFsdWU7DQogICAgICAgICAgICBiYWxhbmNlc1t0b10gICAgICAgICArPSB2YWx1ZTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gcmlzZSB0aGUgVHJhbnNmZXIgZXZlbnQNCiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyANCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICANCg0KICAgIA0KICAgIC8qKg0KICAgICAqIHRyYW5zZmVyRnJvbSgpIC0gdXNlZCB0byBtb3ZlIGFsbG93ZWQgZnVuZHMgZnJvbSBvdGhlciBvd25lcg0KICAgICAqICAgICAgICAgICAgICAgICAgYWNjb3VudCANCiAgICAgKg0KICAgICAqICBAcGFyYW0gZnJvbSAgLSBtb3ZlIGZ1bmRzIGZyb20gYWNjb3VudA0KICAgICAqICBAcGFyYW0gdG8gICAgLSBtb3ZlIGZ1bmRzIHRvIGFjY291bnQNCiAgICAgKiAgQHBhcmFtIHZhbHVlIC0gbW92ZSB0aGUgdmFsdWUgDQogICAgICoNCiAgICAgKiAgQHJldHVybiAtIHJldHVybiB0cnVlIG9uIHN1Y2Nlc3MgZmFsc2Ugb3RoZXJ3aXNlIA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgIA0KICAgICAgICBpZiAoIGJhbGFuY2VzW2Zyb21dID49IHZhbHVlICYmIA0KICAgICAgICAgICAgIGFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl0gPj0gdmFsdWUgJiYgDQogICAgICAgICAgICAgdmFsdWUgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICANCiAgICAgICAgICAgIC8vIGRvIHRoZSBhY3R1YWwgdHJhbnNmZXINCiAgICAgICAgICAgIGJhbGFuY2VzW2Zyb21dIC09IHZhbHVlOyAgICANCiAgICAgICAgICAgIGJhbGFuY2VzW3RvXSAgICs9IHZhbHVlOyAgICAgICAgICAgIA0KICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIC8vIGFkZGp1c3QgdGhlIHBlcm1pc2lvbiwgYWZ0ZXIgcGFydCBvZiANCiAgICAgICAgICAgIC8vIHBlcm1pdGVkIHRvIHNwZW5kIHZhbHVlIHdhcyB1c2VkDQogICAgICAgICAgICBhbGxvd2VkW2Zyb21dW21zZy5zZW5kZXJdIC09IHZhbHVlOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyByaXNlIHRoZSBUcmFuc2ZlciBldmVudA0KICAgICAgICAgICAgVHJhbnNmZXIoZnJvbSwgdG8sIHZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgeyANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyANCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIA0KDQogICAgDQogICAgLyoqDQogICAgICoNCiAgICAgKiBiYWxhbmNlT2YoKSAtIGNvbnN0YW50IGZ1bmN0aW9uIGNoZWNrIGNvbmNyZXRlIHRva2VucyBiYWxhbmNlICANCiAgICAgKg0KICAgICAqICBAcGFyYW0gb3duZXIgLSBhY2NvdW50IG93bmVyDQogICAgICogIA0KICAgICAqICBAcmV0dXJuIHRoZSB2YWx1ZSBvZiBiYWxhbmNlIA0KICAgICAqLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBvd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7DQogICAgICAgIHJldHVybiBiYWxhbmNlc1tvd25lcl07DQogICAgfQ0KDQogICAgDQogICAgDQogICAgLyoqDQogICAgICoNCiAgICAgKiBhcHByb3ZlKCkgLSBmdW5jdGlvbiBhcHByb3ZlcyB0byBhIHBlcnNvbiB0byBzcGVuZCBzb21lIHRva2VucyBmcm9tIA0KICAgICAqICAgICAgICAgICBvd25lciBiYWxhbmNlLiANCiAgICAgKg0KICAgICAqICBAcGFyYW0gc3BlbmRlciAtIHBlcnNvbiB3aG9tIHRoaXMgcmlnaHQgYmVlbiBncmFudGVkLg0KICAgICAqICBAcGFyYW0gdmFsdWUgICAtIHZhbHVlIHRvIHNwZW5kLg0KICAgICAqIA0KICAgICAqICBAcmV0dXJuIHRydWUgaW4gY2FzZSBvZiBzdWNjZXMsIG90aGVyd2lzZSBmYWlsdXJlDQogICAgICogDQogICAgICovDQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICAvLyBub3cgc3BlbmRlciBjYW4gdXNlIGJhbGFuY2UgaW4gDQogICAgICAgIC8vIGFtbW91bnQgb2YgdmFsdWUgZnJvbSBvd25lciBiYWxhbmNlDQogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsNCiAgICAgICAgDQogICAgICAgIC8vIHJpc2UgZXZlbnQgYWJvdXQgdGhlIHRyYW5zYWN0aW9uDQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICANCg0KICAgIC8qKg0KICAgICAqDQogICAgICogYWxsb3dhbmNlKCkgLSBjb25zdGFudCBmdW5jdGlvbiB0byBjaGVjayBob3cgbW91Y2ggaXMgDQogICAgICogICAgICAgICAgICAgICBwZXJtaXRlZCB0byBzcGVuZCB0byAzcmQgcGVyc29uIGZyb20gb3duZXIgYmFsYW5jZQ0KICAgICAqDQogICAgICogIEBwYXJhbSBvd25lciAgIC0gb3duZXIgb2YgdGhlIGJhbGFuY2UNCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJtaXRlZCB0byBzcGVuZCBmcm9tIHRoaXMgYmFsYW5jZSBwZXJzb24gDQogICAgICogIA0KICAgICAqICBAcmV0dXJuIC0gcmVtYWluaW5nIHJpZ2h0IHRvIHNwZW5kIA0KICAgICAqIA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7DQogICAgICByZXR1cm4gYWxsb3dlZFtvd25lcl1bc3BlbmRlcl07DQogICAgfQ0KDQp9DQoNCg0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuNjsNCg0KLyoqDQogKiANCiAqIEV2ZW50SW5mbyAtIGltdXRhYmxlIGNsYXNzIHRoYXQgZGVub3Rlcw0KICogdGhlIHRpbWUgb2YgdGhlIHZpcnR1YWwgYWNjZWxlcmF0b3IgaGFjaw0KICogZXZlbnQNCiAqIA0KICovDQpjb250cmFjdCBFdmVudEluZm97DQogICAgDQogICAgDQogICAgdWludCBjb25zdGFudCBIQUNLQVRIT05fNV9XRUVLUyA9IDYwICogNjAgKiAyNCAqIDcgKiA1Ow0KICAgIHVpbnQgY29uc3RhbnQgVF8xX1dFRUsgPSA2MCAqIDYwICogMjQgKiA3Ow0KDQogICAgdWludCBldmVudFN0YXJ0ID0gMTQ3OTM5MTIwMDsgLy8gVGh1LCAxNyBOb3YgMjAxNiAxNDowMDowMCBHTVQNCiAgICB1aW50IGV2ZW50RW5kID0gZXZlbnRTdGFydCArIEhBQ0tBVEhPTl81X1dFRUtTOw0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIGdldEV2ZW50U3RhcnQgLSByZXR1cm4gdGhlIHN0YXJ0IG9mIHRoZSBldmVudCB0aW1lDQogICAgICovIA0KICAgIGZ1bmN0aW9uIGdldEV2ZW50U3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7ICAgICAgICANCiAgICAgICByZXR1cm4gZXZlbnRTdGFydDsNCiAgICB9IA0KICAgIA0KICAgIC8qKg0KICAgICAqIGdldEV2ZW50RW5kIC0gcmV0dXJuIHRoZSBlbmQgb2YgdGhlIGV2ZW50IHRpbWUNCiAgICAgKi8gDQogICAgZnVuY3Rpb24gZ2V0RXZlbnRFbmQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7ICAgICAgICANCiAgICAgICByZXR1cm4gZXZlbnRFbmQ7DQogICAgfSANCiAgICANCiAgICANCiAgICAvKioNCiAgICAgKiBnZXRWb3RpbmdTdGFydCAtIHRoZSB2b3Rpbmcgc3RhcnRzIDEgd2VlayBhZnRlciB0aGUgDQogICAgICogICAgICAgICAgICAgICAgICBldmVudCBzdGFydHMNCiAgICAgKi8gDQogICAgZnVuY3Rpb24gZ2V0Vm90aW5nU3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiBldmVudFN0YXJ0KyBUXzFfV0VFSzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBnZXRUcmFkaW5nU3RhcnQgLSB0aGUgRFNUIHRva2VucyB0cmFkaW5nIHN0YXJ0cyAxIHdlZWsgDQogICAgICogICAgICAgICAgICAgICAgICAgYWZ0ZXIgdGhlIGV2ZW50IHN0YXJ0cw0KICAgICAqLyANCiAgICBmdW5jdGlvbiBnZXRUcmFkaW5nU3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiBldmVudFN0YXJ0KyBUXzFfV0VFSzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBnZXROb3cgLSBoZWxwZXIgY2xhc3MgdG8gY2hlY2sgd2hhdCB0aW1lIHRoZSBjb250cmFjdCBzZWUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXROb3coKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7ICAgICAgICANCiAgICAgICByZXR1cm4gbm93Ow0KICAgIH0gDQogICAgDQp9DQoNCnByYWdtYSBzb2xpZGl0eSBeMC40LjA7DQoNCi8qKg0KICoNCiAqIEB0aXRsZSBIYWNrZXIgR29sZA0KICogDQogKiBUaGUgb2ZmaWNpYWwgdG9rZW4gcG93ZXJpbmcgdGhlIGhhY2suZXRoZXIuY2FtcCB2aXJ0dWFsIGFjY2VsZXJhdG9yLg0KICogVGhpcyBpcyB0aGUgb25seSB3YXkgdG8gYWNxdWlyZSB0b2tlbnMgZnJvbSBzdGFydHVwcyBkdXJpbmcgdGhlIGV2ZW50Lg0KICoNCiAqIFdoaXRlcGFwZXIgaHR0cHM6Ly9oYWNrLmV0aGVyLmNhbXAvd2hpdGVwYXBlcg0KICoNCiAqLw0KY29udHJhY3QgSGFja2VyR29sZCBpcyBTdGFuZGFyZFRva2VuIHsNCg0KICAgIC8vIE5hbWUgb2YgdGhlIHRva2VuICAgIA0KICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJIYWNrZXJHb2xkIjsNCg0KICAgIC8vIERlY2ltYWwgcGxhY2VzDQogICAgdWludDggIHB1YmxpYyBkZWNpbWFscyA9IDM7DQogICAgLy8gVG9rZW4gYWJicmV2aWF0aW9uICAgICAgICANCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJIS0ciOw0KICAgIA0KICAgIC8vIDEgZXRoZXIgPSAyMDAgaGtnDQogICAgdWludCBCQVNFX1BSSUNFID0gMjAwOw0KICAgIC8vIDEgZXRoZXIgPSAxNTAgaGtnDQogICAgdWludCBNSURfUFJJQ0UgPSAxNTA7DQogICAgLy8gMSBldGhlciA9IDEwMCBoa2cNCiAgICB1aW50IEZJTl9QUklDRSA9IDEwMDsNCiAgICAvLyBTYWZldHkgY2FwDQogICAgdWludCBTQUZFVFlfTElNSVQgPSA0MDAwMDAwIGV0aGVyOw0KICAgIC8vIFplcm9zIGFmdGVyIHRoZSBwb2ludA0KICAgIHVpbnQgREVDSU1BTF9aRVJPUyA9IDEwMDA7DQogICAgDQogICAgLy8gVG90YWwgdmFsdWUgaW4gd2VpDQogICAgdWludCB0b3RhbFZhbHVlOw0KICAgIA0KICAgIC8vIEFkZHJlc3Mgb2YgbXVsdGlzaWcgd2FsbGV0IGhvbGRpbmcgZXRoZXIgZnJvbSBzYWxlDQogICAgYWRkcmVzcyB3YWxsZXQ7DQoNCiAgICAvLyBTdHJ1Y3R1cmUgb2Ygc2FsZSBpbmNyZWFzZSBtaWxlc3RvbmVzDQogICAgc3RydWN0IG1pbGVzdG9uZXNfc3RydWN0IHsNCiAgICAgIHVpbnQgcDE7DQogICAgICB1aW50IHAyOyANCiAgICAgIHVpbnQgcDM7DQogICAgICB1aW50IHA0Ow0KICAgICAgdWludCBwNTsNCiAgICAgIHVpbnQgcDY7DQogICAgfQ0KICAgIC8vIE1pbGVzdG9uZXMgaW5zdGFuY2UNCiAgICBtaWxlc3RvbmVzX3N0cnVjdCBtaWxlc3RvbmVzOw0KICAgIA0KICAgIC8qKg0KICAgICAqIENvbnN0cnVjdG9yIG9mIHRoZSBjb250cmFjdC4NCiAgICAgKiANCiAgICAgKiBQYXNzZXMgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBob2xkaW5nIHRoZSB2YWx1ZS4NCiAgICAgKiBIYWNrZXJHb2xkIGNvbnRyYWN0IGl0c2VsZiBkb2VzIG5vdCBob2xkIGFueSB2YWx1ZQ0KICAgICAqIA0KICAgICAqIEBwYXJhbSBtdWx0aXNpZyBhZGRyZXNzIG9mIE11bHRpU2lnIHdhbGxldCB3aGljaCB3aWxsIGhvbGQgdGhlIHZhbHVlDQogICAgICovDQogICAgZnVuY3Rpb24gSGFja2VyR29sZChhZGRyZXNzIG11bHRpc2lnKSB7DQogICAgICAgIA0KICAgICAgICB3YWxsZXQgPSBtdWx0aXNpZzsNCg0KICAgICAgICAvLyBzZXQgdGltZSBwZXJpb2RzIGZvciBzYWxlDQogICAgICAgIG1pbGVzdG9uZXMgPSBtaWxlc3RvbmVzX3N0cnVjdCgNCiAgICAgICAgDQogICAgICAgICAgMTQ3Njk3MjAwMCwgIC8vIFAxOiBHTVQ6IDIwLU9jdC0yMDE2IDE0OjAwICA9PiBUaGUgU2FsZSBTdGFydHMNCiAgICAgICAgICAxNDc4MTgxNjAwLCAgLy8gUDI6IEdNVDogMDMtTm92LTIwMTYgMTQ6MDAgID0+IDFzdCBQcmljZSBMYWRkZXIgDQogICAgICAgICAgMTQ3OTM5MTIwMCwgIC8vIFAzOiBHTVQ6IDE3LU5vdi0yMDE2IDE0OjAwICA9PiBQcmljZSBTdGFibGUsIA0KICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGFja2F0aG9uIFN0YXJ0cw0KICAgICAgICAgIDE0ODA2MDA4MDAsICAvLyBQNDogR01UOiAwMS1EZWMtMjAxNiAxNDowMCAgPT4gMm5kIFByaWNlIExhZGRlcg0KICAgICAgICAgIDE0ODE4MTA0MDAsICAvLyBQNTogR01UOiAxNS1EZWMtMjAxNiAxNDowMCAgPT4gUHJpY2UgU3RhYmxlDQogICAgICAgICAgMTQ4MjQxNTIwMCAgIC8vIFA2OiBHTVQ6IDIyLURlYy0yMDE2IDE0OjAwICA9PiBTYWxlIEVuZHMsIEhhY2thdGhvbiBFbmRzDQogICAgICAgICk7DQogICAgICAgIA0KICAgICAgICAvLyBhc3NpZ24gcmVjb3ZlcnkgYmFsYW5jZQ0KICAgICAgICB0b3RhbFN1cHBseVZhciAgID0gMTYxMTA4OTMwMDA7DQogICAgICAgIGJhbGFuY2VzWzB4MzQyZTYyNzMyYjc2ODc1ZGE5MzA1MDgzZWE4YWU2MzEyNWE0ZTY2N10gPSAxNjExMDg5MzAwMDsNCiAgICAgICAgdG90YWxWYWx1ZSAgICA9IDg1MzYyIGV0aGVyOyAgICAgICAgDQogICAgfQ0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIEZhbGxiYWNrIGZ1bmN0aW9uOiBjYWxsZWQgb24gZXRoZXIgc2VudC4NCiAgICAgKiANCiAgICAgKiBJdCBjYWxscyB0byBjcmVhdGVIS0cgZnVuY3Rpb24gd2l0aCBtc2cuc2VuZGVyIA0KICAgICAqIGFzIGEgdmFsdWUgZm9yIGhvbGRlciBhcmd1bWVudA0KICAgICAqLw0KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgew0KICAgICAgICBjcmVhdGVIS0cobXNnLnNlbmRlcik7DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgSEtHIHRva2Vucy4NCiAgICAgKiANCiAgICAgKiBSdW5zIHNhbml0eSBjaGVja3MgaW5jbHVkaW5nIHNhZmV0eSBjYXANCiAgICAgKiBUaGVuIGNhbGN1bGF0ZXMgY3VycmVudCBwcmljZSBieSBnZXRQcmljZSgpIGZ1bmN0aW9uLCBjcmVhdGVzIEhLRyB0b2tlbnMNCiAgICAgKiBGaW5hbGx5IHNlbmRzIGEgdmFsdWUgb2YgdHJhbnNhY3Rpb24gdG8gdGhlIHdhbGxldA0KICAgICAqIA0KICAgICAqIE5vdGU6IGR1ZSB0byBsYWNrIG9mIGZsb2F0aW5nIHBvaW50IHR5cGVzIGluIFNvbGlkaXR5LA0KICAgICAqIGNvbnRyYWN0IGFzc3VtZXMgdGhhdCBsYXN0IDMgZGlnaXRzIGluIHRva2VucyBhbW91bnQgYXJlIHN0b29kIGFmdGVyIHRoZSBwb2ludC4NCiAgICAgKiBJdCBtZWFucyB0aGF0IGlmIHN0b3JlZCBIS0cgYmFsYW5jZSBpcyAxMDAwMDAsIHRoZW4gaXRzIHJlYWwgdmFsdWUgaXMgMTAwIEhLRw0KICAgICAqIA0KICAgICAqIEBwYXJhbSBob2xkZXIgdG9rZW4gaG9sZGVyDQogICAgICovDQogICAgZnVuY3Rpb24gY3JlYXRlSEtHKGFkZHJlc3MgaG9sZGVyKSBwYXlhYmxlIHsNCiAgICAgICAgDQogICAgICAgIGlmIChub3cgPCBtaWxlc3RvbmVzLnAxKSB0aHJvdzsNCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnA2KSB0aHJvdzsNCiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSAwKSB0aHJvdzsNCiAgICANCiAgICAgICAgLy8gc2FmZXR5IGNhcA0KICAgICAgICBpZiAoZ2V0VG90YWxWYWx1ZSgpICsgbXNnLnZhbHVlID4gU0FGRVRZX0xJTUlUKSB0aHJvdzsgDQogICAgDQogICAgICAgIHVpbnQgdG9rZW5zID0gbXNnLnZhbHVlICogZ2V0UHJpY2UoKSAqIERFQ0lNQUxfWkVST1MgLyAxIGV0aGVyOw0KDQogICAgICAgIHRvdGFsU3VwcGx5VmFyICs9IHRva2VuczsNCiAgICAgICAgYmFsYW5jZXNbaG9sZGVyXSArPSB0b2tlbnM7DQogICAgICAgIHRvdGFsVmFsdWUgKz0gbXNnLnZhbHVlOw0KICAgICAgICANCiAgICAgICAgaWYgKCF3YWxsZXQuc2VuZChtc2cudmFsdWUpKSB0aHJvdzsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogRGVub3RlcyBjb21wbGV0ZSBwcmljZSBzdHJ1Y3R1cmUgZHVyaW5nIHRoZSBzYWxlLg0KICAgICAqDQogICAgICogQHJldHVybiBIS0cgYW1vdW50IHBlciAxIEVUSCBmb3IgdGhlIGN1cnJlbnQgbW9tZW50IGluIHRpbWUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXRQcmljZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KSB7DQogICAgICAgIA0KICAgICAgICBpZiAobm93IDwgbWlsZXN0b25lcy5wMSkgcmV0dXJuIDA7DQogICAgICAgIA0KICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDEgJiYgbm93IDwgbWlsZXN0b25lcy5wMikgew0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBCQVNFX1BSSUNFOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDIgJiYgbm93IDwgbWlsZXN0b25lcy5wMykgew0KICAgICAgICAgICAgDQogICAgICAgICAgICB1aW50IGRheXNfaW4gPSAxICsgKG5vdyAtIG1pbGVzdG9uZXMucDIpIC8gMSBkYXlzOyANCiAgICAgICAgICAgIHJldHVybiBCQVNFX1BSSUNFIC0gZGF5c19pbiAqIDI1IC8gNzsgIC8vIGRhaWx5IGRlY3JlYXNlIDMuNQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnAzICYmIG5vdyA8IG1pbGVzdG9uZXMucDQpIHsNCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gTUlEX1BSSUNFOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDQgJiYgbm93IDwgbWlsZXN0b25lcy5wNSkgew0KICAgICAgICAgICAgDQogICAgICAgICAgICBkYXlzX2luID0gMSArIChub3cgLSBtaWxlc3RvbmVzLnA0KSAvIDEgZGF5czsgDQogICAgICAgICAgICByZXR1cm4gTUlEX1BSSUNFIC0gZGF5c19pbiAqIDI1IC8gNzsgIC8vIGRhaWx5IGRlY3JlYXNlIDMuNQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnA1ICYmIG5vdyA8IG1pbGVzdG9uZXMucDYpIHsNCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gRklOX1BSSUNFOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDYpew0KDQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KDQogICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRvdGFsIHN0b3JlZCBIS0cgYW1vdW50Lg0KICAgICAqIA0KICAgICAqIENvbnRyYWN0IGFzc3VtZXMgdGhhdCBsYXN0IDMgZGlnaXRzIG9mIHRoaXMgdmFsdWUgYXJlIGJlaGluZCB0aGUgZGVjaW1hbCBwbGFjZS4gaS5lLiAxMDAwMSBpcyAxMC4wMDENCiAgICAgKiBUaHVzLCByZXN1bHQgb2YgdGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgZGl2aWRlZCBieSAxMDAwIHRvIGdldCBIS0cgdmFsdWUNCiAgICAgKiANCiAgICAgKiBAcmV0dXJuIHJlc3VsdCBzdG9yZWQgSEtHIGFtb3VudA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGdldFRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpIHsNCiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5VmFyOw0KICAgIH0gDQoNCiAgICAvKioNCiAgICAgKiBJdCBpcyB1c2VkIGZvciB0ZXN0IHB1cnBvc2VzLg0KICAgICAqIA0KICAgICAqIFJldHVybnMgdGhlIHJlc3VsdCBvZiAnbm93JyBzdGF0ZW1lbnQgb2YgU29saWRpdHkgbGFuZ3VhZ2UNCiAgICAgKiANCiAgICAgKiBAcmV0dXJuIHVuaXggdGltZXN0YW1wIGZvciBjdXJyZW50IG1vbWVudCBpbiB0aW1lDQogICAgICovDQogICAgZnVuY3Rpb24gZ2V0Tm93KCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpIHsNCiAgICAgICAgcmV0dXJuIG5vdzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRvdGFsIHZhbHVlIHBhc3NlZCB0aHJvdWdoIHRoZSBjb250cmFjdA0KICAgICAqIA0KICAgICAqIEByZXR1cm4gcmVzdWx0IHRvdGFsIHZhbHVlIGluIHdlaQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGdldFRvdGFsVmFsdWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgew0KICAgICAgICByZXR1cm4gdG90YWxWYWx1ZTsgIA0KICAgIH0NCn0NCnByYWdtYSBzb2xpZGl0eSBeMC40LjY7DQoNCi8qDQogKiBEU1RDb250cmFjdCAtIERTVCBzdGFuZHMgZm9yIGRlY2VudHJhbGl6ZWQgc3RhcnR1cCB0ZWFtLg0KICogICAgICAgICAgICAgICB0aGUgY29udHJhY3QgZW5zdXJlcyBmdW5kaW5nIGZvciBhIGRlY2VudHJhbGl6ZWQNCiAqICAgICAgICAgICAgICAgdGVhbSBpbiAyIHBoYXNlczogDQogKg0KICogICAgICAgICAgICAgICAgKy4gRnVuZGluZyBieSBIS0cgZHVyaW5nIHRoZSBoYWNrYXRob24gZXZlbnQuIA0KICogICAgICAgICAgICAgICAgKy4gRnVuZGluZyBieSBFdGhlciBhZnRlciB0aGUgZXZlbnQgaXMgb3Zlci4gDQogKg0KICogICAgICAgICAgICAgICBBZnRlciB0aGUgZnVuZHMgYmVlbiBjb2xsZWN0ZWQgdGhlcmUgaXMgYSBnb3Zlcm5lbmNlDQogKiAgICAgICAgICAgICAgIG1lY2hhbmlzbSBtYW5hZ2VkIGJ5IHByb3Bvc2l0aW9uIHRvIHdpdGhkcmF3IGZ1bmRzDQogKiAgICAgICAgICAgICAgIGZvciBkZXZlbG9wbWVudCB1c2FnZS4gDQogKg0KICogICAgICAgICAgICAgICBUaGUgRFNUIGVuc3VyZXMgdGhhdCBiYWNrZXJzIG9mIHRoZSBwcm9qZWN0cyBrZWVwcw0KICogICAgICAgICAgICAgICBzb21lIGluZmx1ZW5jZSBvbiB0aGUgcHJvamVjdCBieSBhYmlsaXR5IHRvIHJlamVjdA0KICogICAgICAgICAgICAgICBwcm9wb3NpdGlvbnMgdGhleSBmaW5kIGFzIG5vbiBlZmZlY3RpdmUuIA0KICoNCiAqICAgICAgICAgICAgICAgSW4gdmVyeSByYWRpY2FsIG9jY2FzaW9ucyB0aGUgYmFja2VycyBtYXkgbG9vc2UgDQogKiAgICAgICAgICAgICAgIHRoZSB0cnVzdCBpbiB0aGUgdGVhbSBjb21wbGV0ZWxseSwgaW4gdGhhdCBjYXNlIA0KICogICAgICAgICAgICAgICB0aGVyZSBpcyBhbiBvcHRpb24gdG8gcHJvcG9zZSBpbXBlYWNobWVudCBwcm9jZXNzDQogKiAgICAgICAgICAgICAgIGNvbXBsZXRlbGx5IHJlbW92aW5nIHRoZSBleGVjdXRlIGFuZCBhc3NpZ25pbmcgbmV3DQogKiAgICAgICAgICAgICAgIHBlcnNvbiB0byBtYW5hZ2UgdGhlIGZ1bmRzLiANCiAqDQogKi8NCmNvbnRyYWN0IERTVENvbnRyYWN0IGlzIFN0YW5kYXJkVG9rZW57DQoNCiAgICAvLyBaZXJvcyBhZnRlciB0aGUgcG9pbnQNCiAgICB1aW50IERFQ0lNQUxfWkVST1MgPSAxMDAwOw0KICAgIC8vIFByb3Bvc2FsIGxpZmV0aW1lDQogICAgdWludCBQUk9QT1NBTF9MSUZFVElNRSA9IDEwIGRheXM7DQogICAgLy8gUHJvcG9zYWwgZnVuZHMgdGhyZXNob2xkLCBpbiBwZXJjZW50cw0KICAgIHVpbnQgUFJPUE9TQUxfRlVORFNfVEggPSAyMDsNCg0KICAgIGFkZHJlc3MgICBleGVjdXRpdmU7IA0KICAgICAgICANCiAgICBFdmVudEluZm8gZXZlbnRJbmZvOw0KICAgIA0KICAgIC8vIEluZGljYXRlZCB3aGVyZSB0aGUgRFNUIGlzIHRyYWRlZA0KICAgIGFkZHJlc3MgdmlydHVhbEV4Y2hhbmdlQWRkcmVzczsNCiAgICANCiAgICBIYWNrZXJHb2xkIGhhY2tlckdvbGQ7DQogICAgICAgIA0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgdm90aW5nUmlnaHRzOw0KDQoNCiAgICAvLyAxIC0gSEtHID0+IERTVCBxdHk7IHRva2VucyBmb3IgMSBIS0cNCiAgICB1aW50IGhrZ1ByaWNlOw0KICAgIA0KICAgIC8vIDEgLSBFdGhlciA9PiBEU1QgcXR5OyB0b2tlbnMgZm9yIDEgRXRoZXINCiAgICB1aW50IGV0aGVyUHJpY2U7DQogICAgDQogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIi4uLiI7ICAgICAgICAgICAgICAgICAgIA0KICAgIHVpbnQ4ICBwdWJsaWMgZGVjaW1hbHMgPSAzOyAgICAgICAgICAgICAgICAgDQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiLi4uIjsNCiAgICANCiAgICBib29sIGFibGVUb0lzc3VlVG9rZW5zID0gdHJ1ZTsgDQogICAgDQogICAgdWludCBwcmVmZXJlZFF0eVNvbGQ7DQoNCiAgICB1aW50IGNvbGxlY3RlZEhLRzsgDQogICAgdWludCBjb2xsZWN0ZWRFdGhlcjsgICAgDQogICAgDQogICAgLy8gUHJvcG9zYWwgb2YgdGhlIGZ1bmRzIHNwZW5kaW5nDQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBQcm9wb3NhbCkgcHJvcG9zYWxzOw0KDQogICAgZW51bSBQcm9wb3NhbEN1cnJlbmN5IHsgSEtHLCBFVEhFUiB9DQogICAgUHJvcG9zYWxDdXJyZW5jeSBlbnVtRGVjbGFyYXRpb247DQogICAgICAgICAgICAgICAgICANCiAgICAgICANCiAgICBzdHJ1Y3QgUHJvcG9zYWx7DQogICAgICAgIA0KICAgICAgICBieXRlczMyIGlkOw0KICAgICAgICB1aW50IHZhbHVlOw0KDQogICAgICAgIHN0cmluZyB1cmxEZXRhaWxzOw0KDQogICAgICAgIHVpbnQgdm90aW5kRW5kVFM7DQogICAgICAgICAgICAgICAgDQogICAgICAgIHVpbnQgdm90ZXNPYmplY3Rpbmc7DQogICAgICAgIA0KICAgICAgICBhZGRyZXNzIHN1Ym1pdHRlcjsNCiAgICAgICAgYm9vbCByZWRlZW1lZDsNCg0KICAgICAgICBQcm9wb3NhbEN1cnJlbmN5IHByb3Bvc2FsQ3VycmVuY3k7DQogICAgICAgIA0KICAgICAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHZvdGVkOw0KICAgIH0NCiAgICB1aW50IGNvdW50ZXJQcm9wb3NhbHM7DQogICAgdWludCB0aW1lT2ZMYXN0UHJvcG9zYWw7DQogICAgDQogICAgUHJvcG9zYWxbXSBsaXN0UHJvcG9zYWxzOw0KICAgIA0KDQogICAgLyoqDQogICAgICogSW1wZWFjaG1lbnQgcHJvY2VzcyBwcm9wb3NhbHMNCiAgICAgKi8gICAgDQogICAgc3RydWN0IEltcGVhY2htZW50UHJvcG9zYWx7DQogICAgICAgIA0KICAgICAgICBzdHJpbmcgdXJsRGV0YWlsczsNCiAgICAgICAgDQogICAgICAgIGFkZHJlc3MgbmV3RXhlY3V0aXZlOw0KDQogICAgICAgIHVpbnQgdm90aW5kRW5kVFM7ICAgICAgICANCiAgICAgICAgdWludCB2b3Rlc1N1cHBvcnRpbmc7DQogICAgICAgIA0KICAgICAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHZvdGVkOyAgICAgICAgDQogICAgfQ0KICAgIEltcGVhY2htZW50UHJvcG9zYWwgbGFzdEltcGVhY2htZW50UHJvcG9zYWw7DQoNCiAgICAgICAgDQogICAgLyoqDQogICAgICogDQogICAgICogIERTVENvbnRyYWN0OiBjdG9yIGZvciBEU1QgdG9rZW4gYW5kIGdvdmVybmVuY2UgY29udHJhY3QNCiAgICAgKg0KICAgICAqICBAcGFyYW0gZXZlbnRJbmZvQWRkciBFdmVudEluZm86IGFkZHJlc3Mgb2Ygb2JqZWN0IGRlbm90ZXMgZXZlbnRzIA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbGVzdG9uZXMgICAgICANCiAgICAgKiAgQHBhcmFtIGhhY2tlckdvbGRBZGRyIEhhY2tlckdvbGQ6IGFkZHJlc3Mgb2YgSGFja2VyR29sZCB0b2tlbg0KICAgICAqDQogICAgICogIEBwYXJhbSBkc3ROYW1lIHN0cmluZzogZHN0TmFtZTogcmVhbCBuYW1lIG9mIHRoZSB0ZWFtDQogICAgICoNCiAgICAgKiAgQHBhcmFtIGRzdFN5bWJvbCBzdHJpbmc6IDMgbGV0dGVyIHN5bWJvbGQgb2YgdGhlIHRlYW0NCiAgICAgKg0KICAgICAqLyANCiAgICBmdW5jdGlvbiBEU1RDb250cmFjdChFdmVudEluZm8gZXZlbnRJbmZvQWRkciwgSGFja2VyR29sZCBoYWNrZXJHb2xkQWRkciwgc3RyaW5nIGRzdE5hbWUsIHN0cmluZyBkc3RTeW1ib2wpew0KICAgIA0KICAgICAgZXhlY3V0aXZlICAgPSBtc2cuc2VuZGVyOyAgDQogICAgICBuYW1lICAgICAgICA9IGRzdE5hbWU7DQogICAgICBzeW1ib2wgICAgICA9IGRzdFN5bWJvbDsNCg0KICAgICAgaGFja2VyR29sZCA9IEhhY2tlckdvbGQoaGFja2VyR29sZEFkZHIpOw0KICAgICAgZXZlbnRJbmZvICA9IEV2ZW50SW5mbyhldmVudEluZm9BZGRyKTsNCiAgICB9DQogICAgDQoNCiAgICBmdW5jdGlvbigpIHBheWFibGUNCiAgICAgICAgICAgICAgIG9ubHlBZnRlckVuZCB7DQogICAgICAgIA0KICAgICAgICAvLyB0aGVyZSBpcyB0b2tlbnMgbGVmdCBmcm9tIGhhY2thdGhvbiANCiAgICAgICAgaWYgKGV0aGVyUHJpY2UgPT0gMCkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICB1aW50IHRva2VucyA9IG1zZy52YWx1ZSAqIGV0aGVyUHJpY2UgKiBERUNJTUFMX1pFUk9TIC8gKDEgZXRoZXIpOw0KICAgICAgICANCiAgICAgICAgLy8gY2hlY2sgaWYgZGVtYW5kIG9mIHRva2VucyBpcyANCiAgICAgICAgLy8gb3ZlcmZsb3cgdGhlIHN1cHBseSANCiAgICAgICAgdWludCByZXRFdGhlciA9IDA7DQogICAgICAgIGlmIChiYWxhbmNlc1t0aGlzXSA8IHRva2Vucykgew0KICAgICAgICAgICAgDQogICAgICAgICAgICB0b2tlbnMgPSBiYWxhbmNlc1t0aGlzXTsNCiAgICAgICAgICAgIHJldEV0aGVyID0gbXNnLnZhbHVlIC0gdG9rZW5zIC8gZXRoZXJQcmljZSAqICgxIGZpbm5leSk7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gcmV0dXJuIGxlZnQgZXRoZXIgDQogICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChyZXRFdGhlcikpIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gZG8gdHJhbnNmZXINCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gKz0gdG9rZW5zOw0KICAgICAgICBiYWxhbmNlc1t0aGlzXSAtPSB0b2tlbnM7DQogICAgICAgIA0KICAgICAgICAvLyBjb3VudCBjb2xsZWN0ZWQgZXRoZXIgDQogICAgICAgIGNvbGxlY3RlZEV0aGVyICs9IG1zZy52YWx1ZSAtIHJldEV0aGVyOyANCiAgICAgICAgDQogICAgICAgIC8vIHJpc2UgZXZlbnQNCiAgICAgICAgQnV5Rm9yRXRoZXJUcmFuc2FjdGlvbihtc2cuc2VuZGVyLCBjb2xsZWN0ZWRFdGhlciwgdG90YWxTdXBwbHlWYXIsIGV0aGVyUHJpY2UsIHRva2Vucyk7DQogICAgICAgIA0KICAgIH0NCg0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIHNldEhLR1ByaWNlIC0gc2V0IHByaWNlOiAxSEtHID0+IERTVCB0b2tlbnMgcXR5DQogICAgICoNCiAgICAgKiAgQHBhcmFtIHF0eUZvck9uZUhLRyB1aW50OiBEU1QgdG9rZW5zIGZvciAxIEhLRw0KICAgICAqIA0KICAgICAqLyAgICANCiAgICAgZnVuY3Rpb24gc2V0SEtHUHJpY2UodWludCBxdHlGb3JPbmVIS0cpIG9ubHlFeGVjdXRpdmUgIHsNCiAgICAgICAgIA0KICAgICAgICAgaGtnUHJpY2UgPSBxdHlGb3JPbmVIS0c7DQogICAgICAgICBQcmljZUhLR0NoYW5nZShxdHlGb3JPbmVIS0csIHByZWZlcmVkUXR5U29sZCwgdG90YWxTdXBwbHlWYXIpOw0KICAgICB9DQogICAgIA0KICAgICANCiAgICANCiAgICAvKioNCiAgICAgKiANCiAgICAgKiBpc3N1ZVByZWZlcmVkVG9rZW5zIC0gcHJlZmVyZWQgdG9rZW5zIGlzc3VlZCBvbiB0aGUgaGFja2F0aG9uIGV2ZW50DQogICAgICogICAgICAgICAgICAgICAgICAgICAgIGdyYW50IHNwZWNpYWwgcmlnaHRzDQogICAgICoNCiAgICAgKiAgQHBhcmFtIHF0eUZvck9uZUhLRyB1aW50OiBwcmljZSBEU1QgdG9rZW5zIGZvciBvbmUgMSBIS0cNCiAgICAgKiAgQHBhcmFtIHF0eVRvRW1pdCB1aW50OiBuZXcgc3VwcGx5IG9mIHRva2VucyANCiAgICAgKiANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc3N1ZVByZWZlcmVkVG9rZW5zKHVpbnQgcXR5Rm9yT25lSEtHLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgcXR5VG9FbWl0KSBvbmx5RXhlY3V0aXZlIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlJZkFibGVUb0lzc3VlVG9rZW5zDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUJlZm9yZUVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlBZnRlclRyYWRpbmdTdGFydCB7DQogICAgICAgICAgICAgICAgDQogICAgICAgIC8vIG5vIGlzc3VlbmNlIGlzIGFsbG93ZWQgYmVmb3JlIGVubGlzdGVkIG9uIHRoZQ0KICAgICAgICAvLyBleGNoYW5nZSANCiAgICAgICAgaWYgKHZpcnR1YWxFeGNoYW5nZUFkZHJlc3MgPT0gMHgwKSB0aHJvdzsNCiAgICAgICAgICAgIA0KICAgICAgICB0b3RhbFN1cHBseVZhciArPSBxdHlUb0VtaXQ7DQogICAgICAgIGJhbGFuY2VzW3RoaXNdICs9IHF0eVRvRW1pdDsNCiAgICAgICAgaGtnUHJpY2UgPSBxdHlGb3JPbmVIS0c7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gbm93IHNwZW5kZXIgY2FuIHVzZSBiYWxhbmNlIGluIA0KICAgICAgICAvLyBhbW91bnQgb2YgdmFsdWUgZnJvbSBvd25lciBiYWxhbmNlDQogICAgICAgIGFsbG93ZWRbdGhpc11bdmlydHVhbEV4Y2hhbmdlQWRkcmVzc10gKz0gcXR5VG9FbWl0Ow0KICAgICAgICANCiAgICAgICAgLy8gcmlzZSBldmVudCBhYm91dCB0aGUgdHJhbnNhY3Rpb24NCiAgICAgICAgQXBwcm92YWwodGhpcywgdmlydHVhbEV4Y2hhbmdlQWRkcmVzcywgcXR5VG9FbWl0KTsNCiAgICAgICAgDQogICAgICAgIC8vIHJpc2UgZXZlbnQgDQogICAgICAgIERzdFRva2Vuc0lzc3VlZChoa2dQcmljZSwgcHJlZmVyZWRRdHlTb2xkLCB0b3RhbFN1cHBseVZhciwgcXR5VG9FbWl0KTsNCiAgICB9DQoNCiAgICANCiAgICANCiAgICANCiAgICAvKioNCiAgICAgKiANCiAgICAgKiBidXlGb3JIYWNrZXJHb2xkIC0gb24gdGhlIGhhY2sgZXZlbnQgdGhpcyBmdW5jdGlvbiBpcyBhdmFpbGFibGUgDQogICAgICogICAgICAgICAgICAgICAgICAgIHRoZSBidXllciBmb3IgaGFja2VyIGdvbGQgd2lsbCBnYWluIHZvdGVzIHRvIA0KICAgICAqICAgICAgICAgICAgICAgICAgICBpbmZsdWVuY2UgZnV0dXJlIHByb3Bvc2FscyBvbiB0aGUgRFNUDQogICAgICogICAgDQogICAgICogIEBwYXJhbSBoa2dWYWx1ZSAtIHF0eSBvZiB0aGlzIERTVCB0b2tlbnMgZm9yIDEgSEtHICAgICANCiAgICAgKiANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBidXlGb3JIYWNrZXJHb2xkKHVpbnQgaGtnVmFsdWUpIG9ubHlCZWZvcmVFbmQgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICANCiAgICAgIC8vIHZhbGlkYXRlIHRoYXQgdGhlIGNhbGxlciBpcyBvZmZpY2lhbCBhY2NlbGVyYXRvciBIS0cgRXhjaGFuZ2UNCiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHZpcnR1YWxFeGNoYW5nZUFkZHJlc3MpIHRocm93Ow0KICAgICAgDQogICAgICANCiAgICAgIC8vIHRyYW5zZmVyIHRva2VuIA0KICAgICAgYWRkcmVzcyBzZW5kZXIgPSB0eC5vcmlnaW47DQogICAgICB1aW50IHRva2Vuc1F0eSA9IGhrZ1ZhbHVlICogaGtnUHJpY2U7DQoNCiAgICAgIC8vIGdhaW4gdm90aW5nIHJpZ2h0cw0KICAgICAgdm90aW5nUmlnaHRzW3NlbmRlcl0gKz10b2tlbnNRdHk7DQogICAgICBwcmVmZXJlZFF0eVNvbGQgKz0gdG9rZW5zUXR5Ow0KICAgICAgY29sbGVjdGVkSEtHICs9IGhrZ1ZhbHVlOw0KDQogICAgICAvLyBkbyBhY3R1YWwgdHJhbnNmZXINCiAgICAgIHRyYW5zZmVyRnJvbSh0aGlzLCANCiAgICAgICAgICAgICAgICAgICB2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzLCB0b2tlbnNRdHkpOw0KICAgICAgdHJhbnNmZXIoc2VuZGVyLCB0b2tlbnNRdHkpOyAgICAgICAgDQogICAgICAgICAgICANCiAgICAgIC8vIHJpc2UgZXZlbnQgICAgICAgDQogICAgICBCdXlGb3JIS0dUcmFuc2FjdGlvbihzZW5kZXIsIHByZWZlcmVkUXR5U29sZCwgdG90YWxTdXBwbHlWYXIsIGhrZ1ByaWNlLCB0b2tlbnNRdHkpOw0KICAgICAgICANCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICAgICAgDQogICAgDQogICAgLyoqDQogICAgICogDQogICAgICogaXNzdWVUb2tlbnMgLSBmdW5jdGlvbiB3aWxsIGlzc3VlIHRva2VucyBhZnRlciB0aGUgDQogICAgICogICAgICAgICAgICAgICBldmVudCwgYWJsZSB0byBzZWxsIGZvciAxIGV0aGVyIA0KICAgICAqIA0KICAgICAqICBAcGFyYW0gcXR5Rm9yT25lRXRoZXIgdWludDogRFNUIHRva2VucyBmb3IgMSBFVEgNCiAgICAgKiAgQHBhcmFtIHF0eVRvRW1pdCB1aW50OiBuZXcgdG9rZW5zIHN1cHBseQ0KICAgICAqDQogICAgICovDQogICAgZnVuY3Rpb24gaXNzdWVUb2tlbnModWludCBxdHlGb3JPbmVFdGhlciwgDQogICAgICAgICAgICAgICAgICAgICAgICAgdWludCBxdHlUb0VtaXQpIG9ubHlBZnRlckVuZCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUV4ZWN1dGl2ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5SWZBYmxlVG9Jc3N1ZVRva2VucyB7DQogICAgICAgICANCiAgICAgICAgIGJhbGFuY2VzW3RoaXNdICs9IHF0eVRvRW1pdDsNCiAgICAgICAgIGV0aGVyUHJpY2UgPSBxdHlGb3JPbmVFdGhlcjsNCiAgICAgICAgIHRvdGFsU3VwcGx5VmFyICAgICs9IHF0eVRvRW1pdDsNCiAgICAgICAgIA0KICAgICAgICAgLy8gcmlzZSBldmVudCAgDQogICAgICAgICBEc3RUb2tlbnNJc3N1ZWQocXR5Rm9yT25lRXRoZXIsIHRvdGFsU3VwcGx5VmFyLCB0b3RhbFN1cHBseVZhciwgcXR5VG9FbWl0KTsNCiAgICB9DQogICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIHNldEV0aGVyUHJpY2UgLSBjaGFuZ2UgdGhlIHRva2VuIHByaWNlDQogICAgICoNCiAgICAgKiAgQHBhcmFtIHF0eUZvck9uZUV0aGVyIHVpbnQ6IG5ldyBwcmljZSAtIERTVCB0b2tlbnMgZm9yIDEgRVRIDQogICAgICovICAgICANCiAgICBmdW5jdGlvbiBzZXRFdGhlclByaWNlKHVpbnQgcXR5Rm9yT25lRXRoZXIpIG9ubHlBZnRlckVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUV4ZWN1dGl2ZSB7DQogICAgICAgICBldGhlclByaWNlID0gcXR5Rm9yT25lRXRoZXI7IA0KDQogICAgICAgICAvLyByaXNlIGV2ZW50IGZvciB0aGlzDQogICAgICAgICBOZXdFdGhlclByaWNlKHF0eUZvck9uZUV0aGVyKTsNCiAgICB9ICAgIA0KICAgIA0KDQogICAgLyoqDQogICAgICogIGRpc2FibGVUb2tlbklzc3VhbmNlIC0gZnVuY3Rpb24gd2lsbCBkaXNhYmxlIGFueSANCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24gZm9yIGZ1dHVyZSB0b2tlbiANCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICBpc3N1ZW5jZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGRpc2FibGVUb2tlbklzc3VhbmNlKCkgb25seUV4ZWN1dGl2ZSB7DQogICAgICAgIGFibGVUb0lzc3VlVG9rZW5zID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICBEaXNhYmxlVG9rZW5Jc3N1YW5jZSgpOw0KICAgIH0NCg0KICAgIA0KICAgIC8qKg0KICAgICAqICBidXJuUmVtYWluVG9rZW4gLSAgZWxpbWluYXRlZCBhbGwgYXZhaWxhYmxlIGZvciBzYWxlDQogICAgICogICAgICAgICAgICAgICAgICAgICB0b2tlbnMuIA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJ1cm5SZW1haW5Ub2tlbigpIG9ubHlFeGVjdXRpdmUgew0KICAgIA0KICAgICAgICB0b3RhbFN1cHBseVZhciAtPSBiYWxhbmNlc1t0aGlzXTsNCiAgICAgICAgYmFsYW5jZXNbdGhpc10gPSAwOw0KICAgICAgICANCiAgICAgICAgLy8gcmlzZSBldmVudCBmb3IgdGhpcw0KICAgICAgICBCdXJuZWRBbGxSZW1haW5lZFRva2VucygpOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiAgc3VibWl0RXRoZXJQcm9wb3NhbDogc3VibWl0IHByb3Bvc2FsIHRvIHVzZSBwYXJ0IG9mIHRoZSANCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdGVkIGV0aGVyIGZ1bmRzDQogICAgICoNCiAgICAgKiAgIEBwYXJhbSByZXF1ZXN0VmFsdWUgdWludDogdmFsdWUgaW4gd2VpIA0KICAgICAqICAgQHBhcmFtIHVybCBzdHJpbmc6IGRldGFpbHMgb2YgdGhlIHByb3Bvc2FsIA0KICAgICAqLyANCiAgICBmdW5jdGlvbiBzdWJtaXRFdGhlclByb3Bvc2FsKHVpbnQgcmVxdWVzdFZhbHVlLCBzdHJpbmcgdXJsKSBvbmx5QWZ0ZXJFbmQgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUV4ZWN1dGl2ZSByZXR1cm5zIChieXRlczMyIHJlc3VsdElkLCBib29sIHJlc3VsdFN1Y2NlcykgeyAgICAgICANCiAgICANCiAgICAgICAgLy8gZW5zdXJlIHRoZXJlIGlzIG5vIG1vcmUgaXNzdWVuY2UgYXZhaWxhYmxlIA0KICAgICAgICBpZiAoYWJsZVRvSXNzdWVUb2tlbnMpIHRocm93Ow0KICAgICAgICAgICAgDQogICAgICAgIC8vIGVuc3VyZSB0aGVyZSBpcyBubyBtb3JlIHRva2VucyBhdmFpbGFibGUgDQogICAgICAgIGlmIChiYWxhbmNlT2YodGhpcykgPiAwKSB0aHJvdzsNCg0KICAgICAgICAvLyBQb3NzaWJsZSB0byBzdWJtaXQgYSBwcm9wb3NhbCBvbmNlIDIgd2Vla3MgDQogICAgICAgIGlmIChub3cgPCAodGltZU9mTGFzdFByb3Bvc2FsICsgMiB3ZWVrcykpIHRocm93Ow0KICAgICAgICAgICAgDQogICAgICAgIHVpbnQgcGVyY2VudCA9IGNvbGxlY3RlZEV0aGVyIC8gMTAwOw0KICAgICAgICAgICAgDQogICAgICAgIGlmIChyZXF1ZXN0VmFsdWUgPiBQUk9QT1NBTF9GVU5EU19USCAqIHBlcmNlbnQpIHRocm93Ow0KDQogICAgICAgIC8vIGlmIHJlbWFpbmVkIHZhbHVlIGlzIGxlc3MgdGhhbiByZXF1ZXN0ZWQgZ2FpbiBhbGwuDQogICAgICAgIGlmIChyZXF1ZXN0VmFsdWUgPiB0aGlzLmJhbGFuY2UpIA0KICAgICAgICAgICAgcmVxdWVzdFZhbHVlID0gdGhpcy5iYWxhbmNlOyAgICANCiAgICAgICAgICAgIA0KICAgICAgICAvLyBzZXQgaWQgb2YgdGhlIHByb3Bvc2FsDQogICAgICAgIC8vIHN1Ym1pdCBwcm9wb3NhbCB0byB0aGUgbWFwDQogICAgICAgIGJ5dGVzMzIgaWQgPSBzaGEzKG1zZy5kYXRhLCBub3cpOw0KICAgICAgICB1aW50IHRpbWVFbmRzID0gbm93ICsgUFJPUE9TQUxfTElGRVRJTUU7IA0KICAgICAgICAgICAgDQogICAgICAgIFByb3Bvc2FsIG1lbW9yeSBuZXdQcm9wb3NhbCA9IFByb3Bvc2FsKGlkLCByZXF1ZXN0VmFsdWUsIHVybCwgdGltZUVuZHMsIDAsIG1zZy5zZW5kZXIsIGZhbHNlLCBQcm9wb3NhbEN1cnJlbmN5LkVUSEVSKTsNCiAgICAgICAgcHJvcG9zYWxzW2lkXSA9IG5ld1Byb3Bvc2FsOw0KICAgICAgICBsaXN0UHJvcG9zYWxzLnB1c2gobmV3UHJvcG9zYWwpOw0KICAgICAgICAgICAgDQogICAgICAgIHRpbWVPZkxhc3RQcm9wb3NhbCA9IG5vdzsgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgUHJvcG9zYWxSZXF1ZXN0U3VibWl0dGVkKGlkLCByZXF1ZXN0VmFsdWUsIHRpbWVFbmRzLCB1cmwsIG1zZy5zZW5kZXIpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIChpZCwgdHJ1ZSk7DQogICAgfQ0KICAgIA0KICAgIA0KICAgICANCiAgICAvKioNCiAgICAgKiANCiAgICAgKiBzdWJtaXRIS0dQcm9wb3NhbCAtIHN1Ym1pdCBwcm9wb3NhbCB0byByZXF1ZXN0IGZvciANCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIHBhcnRpYWwgSEtHIGZ1bmRzIGNvbGxlY3RlZCANCiAgICAgKiANCiAgICAgKiAgQHBhcmFtIHJlcXVlc3RWYWx1ZSB1aW50OiB2YWx1ZSBpbiBIS0cgdG8gcmVxdWVzdC4gDQogICAgICogIEBwYXJhbSB1cmwgc3RyaW5nOiB1cmwgd2l0aCBkZXRhaWxzIG9uIHRoZSBwcm9wb3NpdGlvbiANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdWJtaXRIS0dQcm9wb3NhbCh1aW50IHJlcXVlc3RWYWx1ZSwgc3RyaW5nIHVybCkgb25seUFmdGVyRW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlFeGVjdXRpdmUgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHRJZCwgYm9vbCByZXN1bHRTdWNjZXMpew0KICAgICAgICANCg0KICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyAyIG1vbnRocyBvdmVyIHNpbmNlIHRoZSBsYXN0IGV2ZW50Lg0KICAgICAgICAvLyBUaGVyZSBpcyBubyBwb3NpYmxlIHRvIGdldCBhbnkgSEtHLiBBZnRlciAyIG1vbnRocw0KICAgICAgICAvLyBhbGwgdGhlIEhLRyBpcyBhdmFpbGFibGUuIA0KICAgICAgICBpZiAobm93IDwgKGV2ZW50SW5mby5nZXRFdmVudEVuZCgpICsgOCB3ZWVrcykpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUG9zc2libGUgdG8gc3VibWl0IGEgcHJvcG9zYWwgb25jZSAyIHdlZWtzIA0KICAgICAgICBpZiAobm93IDwgKHRpbWVPZkxhc3RQcm9wb3NhbCArIDIgd2Vla3MpKSB0aHJvdzsNCg0KICAgICAgICB1aW50IHBlcmNlbnQgPSBwcmVmZXJlZFF0eVNvbGQgLyAxMDA7DQogICAgICAgIA0KICAgICAgICAvLyB2YWxpZGF0ZSB0aGUgYW1vdW50IGlzIGxlZ2l0DQogICAgICAgIC8vIGZpcnN0IDUgcHJvcG9zYWxzIHNob3VsZCBiZSBsZXNzIHRoYW4gMjAlIA0KICAgICAgICBpZiAoY291bnRlclByb3Bvc2FscyA8PSA1ICYmIA0KICAgICAgICAgICAgcmVxdWVzdFZhbHVlICAgICA+ICBQUk9QT1NBTF9GVU5EU19USCAqIHBlcmNlbnQpIHRocm93Ow0KICAgICAgICAgICAgICAgIA0KICAgICAgICAvLyBpZiByZW1haW5lZCB2YWx1ZSBpcyBsZXNzIHRoYW4gcmVxdWVzdGVkIA0KICAgICAgICAvLyBnYWluIGFsbC4NCiAgICAgICAgaWYgKHJlcXVlc3RWYWx1ZSA+IGdldEhLR093bmVkKCkpIA0KICAgICAgICAgICAgcmVxdWVzdFZhbHVlID0gZ2V0SEtHT3duZWQoKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICAvLyBzZXQgaWQgb2YgdGhlIHByb3Bvc2FsDQogICAgICAgIC8vIHN1Ym1pdCBwcm9wb3NhbCB0byB0aGUgbWFwDQogICAgICAgIGJ5dGVzMzIgaWQgPSBzaGEzKG1zZy5kYXRhLCBub3cpOw0KICAgICAgICB1aW50IHRpbWVFbmRzID0gbm93ICsgUFJPUE9TQUxfTElGRVRJTUU7IA0KICAgICAgICANCiAgICAgICAgUHJvcG9zYWwgbWVtb3J5IG5ld1Byb3Bvc2FsID0gUHJvcG9zYWwoaWQsIHJlcXVlc3RWYWx1ZSwgdXJsLCB0aW1lRW5kcywgMCwgbXNnLnNlbmRlciwgZmFsc2UsIFByb3Bvc2FsQ3VycmVuY3kuSEtHKTsNCiAgICAgICAgcHJvcG9zYWxzW2lkXSA9IG5ld1Byb3Bvc2FsOw0KICAgICAgICBsaXN0UHJvcG9zYWxzLnB1c2gobmV3UHJvcG9zYWwpOw0KICAgICAgICANCiAgICAgICAgKytjb3VudGVyUHJvcG9zYWxzOw0KICAgICAgICB0aW1lT2ZMYXN0UHJvcG9zYWwgPSBub3c7ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICBQcm9wb3NhbFJlcXVlc3RTdWJtaXR0ZWQoaWQsIHJlcXVlc3RWYWx1ZSwgdGltZUVuZHMsIHVybCwgbXNnLnNlbmRlcik7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gKGlkLCB0cnVlKTsgICAgICAgIA0KICAgIH0gIA0KICAgIA0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIG9iamVjdFByb3Bvc2FsIC0gb2JqZWN0IHByZXZpb3VzbHkgc3VibWl0dGVkIHByb3Bvc2FsLCANCiAgICAgKiAgICAgICAgICAgICAgICAgIHRoZSBvYmplY3Rpb24gcmlnaHQgaXMgb2J0YWluZWQgYnkgDQogICAgICogICAgICAgICAgICAgICAgICBwdXJjaGFzaW5nIHByZWZlcmVkIHRva2VucyBvbiB0aW1lIG9mIA0KICAgICAqICAgICAgICAgICAgICAgICAgdGhlIGhhY2thdGhvbi4NCiAgICAgKiANCiAgICAgKiAgQHBhcmFtIGlkIGJ5dGVzMzIgOiB0aGUgaWQgb2YgdGhlIHByb3Bvc2xhIHRvIHJlZGVlbQ0KICAgICAqLw0KICAgICBmdW5jdGlvbiBvYmplY3RQcm9wb3NhbChieXRlczMyIGlkKXsNCiAgICAgICAgIA0KICAgICAgICBQcm9wb3NhbCBtZW1vcnkgcHJvcG9zYWwgPSBwcm9wb3NhbHNbaWRdOw0KICAgICAgICAgDQogICAgICAgIC8vIGNoZWNrIHByb3Bvc2FsIGV4aXN0IA0KICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS5pZCA9PSAwKSB0aHJvdzsNCg0KICAgICAgICAvLyBjaGVjayBhbHJlYWR5IHJlZGVlbWVkDQogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnJlZGVlbWVkKSB0aHJvdzsNCiAgICAgICAgIA0KICAgICAgICAvLyBlbnN1cmUgb2JqZWN0aW9uIHRpbWUNCiAgICAgICAgaWYgKG5vdyA+PSBwcm9wb3NhbHNbaWRdLnZvdGluZEVuZFRTKSB0aHJvdzsNCiAgICAgICAgIA0KICAgICAgICAvLyBlbnN1cmUgbm90IHZvdGVkICANCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0udm90ZWRbbXNnLnNlbmRlcl0pIHRocm93Ow0KICAgICAgICAgDQogICAgICAgICAvLyBzdWJtaXQgdm90ZXMNCiAgICAgICAgIHVpbnQgdm90ZXMgPSB2b3RpbmdSaWdodHNbbXNnLnNlbmRlcl07DQogICAgICAgICBwcm9wb3NhbHNbaWRdLnZvdGVzT2JqZWN0aW5nICs9IHZvdGVzOw0KICAgICAgICAgDQogICAgICAgICAvLyBtYXJrIHZvdGVkIA0KICAgICAgICAgcHJvcG9zYWxzW2lkXS52b3RlZFttc2cuc2VuZGVyXSA9IHRydWU7IA0KICAgICAgICAgDQogICAgICAgICB1aW50IGlkeCA9IGdldEluZGV4QnlQcm9wb3NhbElkKGlkKTsNCiAgICAgICAgIGxpc3RQcm9wb3NhbHNbaWR4XSA9IHByb3Bvc2Fsc1tpZF07ICAgDQoNCiAgICAgICAgIE9iamVjdGVkVm90ZShpZCwgbXNnLnNlbmRlciwgdm90ZXMpOyAgICAgICAgIA0KICAgICB9DQogICAgIA0KICAgICANCiAgICAgZnVuY3Rpb24gZ2V0SW5kZXhCeVByb3Bvc2FsSWQoYnl0ZXMzMiBpZCkgcmV0dXJucyAodWludCByZXN1bHQpew0KICAgICAgICAgDQogICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsaXN0UHJvcG9zYWxzLmxlbmd0aDsgKytpKXsNCiAgICAgICAgICAgICBpZiAoaWQgPT0gbGlzdFByb3Bvc2Fsc1tpXS5pZCkgcmV0dXJuIGk7DQogICAgICAgICB9DQogICAgIH0NCiAgICANCiAgICANCiAgIA0KICAgIC8qKg0KICAgICAqIHJlZGVlbVByb3Bvc2FsRnVuZHMgLSByZWRlZW0gZnVuZHMgcmVxdWVzdGVkIGJ5IHByaW9yIA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXR0ZWQgcHJvcG9zYWwgICAgIA0KICAgICAqIA0KICAgICAqIEBwYXJhbSBpZCBieXRlczMyOiB0aGUgaWQgb2YgdGhlIHByb3Bvc2FsIHRvIHJlZGVlbQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlZGVlbVByb3Bvc2FsRnVuZHMoYnl0ZXMzMiBpZCkgb25seUV4ZWN1dGl2ZSB7DQoNCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0uaWQgPT0gMCkgdGhyb3c7DQogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnN1Ym1pdHRlciAhPSBtc2cuc2VuZGVyKSB0aHJvdzsNCg0KICAgICAgICAvLyBlbnN1cmUgb2JqZWN0aW9uIHRpbWUNCiAgICAgICAgaWYgKG5vdyA8IHByb3Bvc2Fsc1tpZF0udm90aW5kRW5kVFMpIHRocm93Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgDQogICAgICAgICAgICAvLyBjaGVjayBhbHJlYWR5IHJlZGVlbWVkDQogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnJlZGVlbWVkKSB0aHJvdzsNCg0KICAgICAgICAvLyBjaGVjayB2b3RlcyBvYmplY3Rpb24gPT4gNTUlIG9mIHRvdGFsIHZvdGVzDQogICAgICAgIHVpbnQgb2JqZWN0aW9uVGhyZXNob2xkID0gcHJlZmVyZWRRdHlTb2xkIC8gMTAwICogNTU7DQogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnZvdGVzT2JqZWN0aW5nICA+IG9iamVjdGlvblRocmVzaG9sZCkgdGhyb3c7DQogICAgDQogICAgDQogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnByb3Bvc2FsQ3VycmVuY3kgPT0gUHJvcG9zYWxDdXJyZW5jeS5IS0cpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBzZW5kIGhhY2tlciBnb2xkIA0KICAgICAgICAgICAgaGFja2VyR29sZC50cmFuc2Zlcihwcm9wb3NhbHNbaWRdLnN1Ym1pdHRlciwgcHJvcG9zYWxzW2lkXS52YWx1ZSk7ICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAvLyBzZW5kIGV0aGVyICAgICAgICAgICAgICANCiAgICAgICAgICAgYm9vbCBzdWNjZXNzID0gcHJvcG9zYWxzW2lkXS5zdWJtaXR0ZXIuc2VuZChwcm9wb3NhbHNbaWRdLnZhbHVlKTsgDQoNCiAgICAgICAgICAgLy8gcmlzZSBldmVudA0KICAgICAgICAgICBFdGhlclJlZGVlbUFjY2VwdGVkKHByb3Bvc2Fsc1tpZF0uc3VibWl0dGVyLCBwcm9wb3NhbHNbaWRdLnZhbHVlKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gZXhlY3V0ZSB0aGUgcHJvcG9zYWwgDQogICAgICAgIHByb3Bvc2Fsc1tpZF0ucmVkZWVtZWQgPSB0cnVlOyANCiAgICB9DQogICAgDQogICAgDQogICAgLyoqDQogICAgICogIGdldEFsbFRoZUZ1bmRzIC0gdG8gZW5zdXJlIHRoZXJlIGlzIG5vIGRlYWRsb2NrIGNhbiANCiAgICAgKiAgICAgICAgICAgICAgICAgICBjYW4gaGFwcGVuLCBhbmQgbm8gY2FzZSB0aGF0IHZvdGluZyANCiAgICAgKiAgICAgICAgICAgICAgICAgICBzdHJ1Y3R1cmUgd2lsbCBmcmVlemUgdGhlIGZ1bmRzIGZvcmV2ZXINCiAgICAgKiAgICAgICAgICAgICAgICAgICB0aGUgc3RhcnR1cCB3aWxsIGJlIGFibGUgdG8gZ2V0IGFsbCB0aGUNCiAgICAgKiAgICAgICAgICAgICAgICAgICBmdW5kcyB3aXRob3V0IGEgcHJvcG9zYWwgcmVxdWlyZWQgYWZ0ZXINCiAgICAgKiAgICAgICAgICAgICAgICAgICA2IG1vbnRocy4NCiAgICAgKiANCiAgICAgKiANCiAgICAgKi8gICAgICAgICAgICAgDQogICAgZnVuY3Rpb24gZ2V0QWxsVGhlRnVuZHMoKSBvbmx5RXhlY3V0aXZlIHsNCiAgICAgICAgDQogICAgICAgIC8vIElmIHRoZXJlIGlzIGEgZGVhZGxvY2sgaW4gdm90aW5nIHBhcnRpY2lwYXRlcw0KICAgICAgICAvLyB0aGUgZnVuZHMgY2FuIGJlIHJlZGVlbWVkIGNvbXBsZXRlbGx5IGluIDYgbW9udGhzDQogICAgICAgIGlmIChub3cgPCAoZXZlbnRJbmZvLmdldEV2ZW50RW5kKCkgKyAyNCB3ZWVrcykpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9ICANCiAgICAgICAgDQogICAgICAgIC8vIGFsbCB0aGUgRXRoZXINCiAgICAgICAgYm9vbCBzdWNjZXNzID0gbXNnLnNlbmRlci5zZW5kKHRoaXMuYmFsYW5jZSk7ICAgICAgICANCiAgICAgICAgDQogICAgICAgIC8vIGFsbCB0aGUgSEtHDQogICAgICAgIGhhY2tlckdvbGQudHJhbnNmZXIobXNnLnNlbmRlciwgZ2V0SEtHT3duZWQoKSk7ICAgICAgICAgICAgICANCiAgICB9DQogICAgDQogICAgDQogICAgLyoqDQogICAgICogc3VibWl0SW1wZWFjaG1lbnRQcm9wb3NhbCAtIHN1Ym1pdCByZXF1ZXN0IHRvIHN3aXRjaCANCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0aXZlLg0KICAgICAqIA0KICAgICAqICBAcGFyYW0gdXJsRGV0YWlscyAgLSBkZXRhaWxzIG9mIHRoZSBpbXBlYWNobWVudCBwcm9wb3NhbCANCiAgICAgKiAgQHBhcmFtIG5ld0V4ZWN1dGl2ZSAtIGFkZHJlc3Mgb2YgdGhlIG5ldyBleGVjdXRpdmUgDQogICAgICogDQogICAgICovICAgICAgICAgICAgIA0KICAgICBmdW5jdGlvbiBzdWJtaXRJbXBlYWNobWVudFByb3Bvc2FsKHN0cmluZyB1cmxEZXRhaWxzLCBhZGRyZXNzIG5ld0V4ZWN1dGl2ZSl7DQogICAgICAgICANCiAgICAgICAgLy8gdG8gb2ZmZXIgaW1wZWFjaG1lbnQgeW91IHNob3VsZCBoYXZlIA0KICAgICAgICAvLyB2b3RpbmcgcmlnaHRzDQogICAgICAgIGlmICh2b3RpbmdSaWdodHNbbXNnLnNlbmRlcl0gPT0gMCkgdGhyb3c7DQogICAgICAgICANCiAgICAgICAgLy8gdGhlIHN1Ym1pc3Npb24gb2YgdGhlIGZpcnN0IGltcGVhY2htZW50IA0KICAgICAgICAvLyBwcm9wb3NhbCBpcyBwb3NzaWJsZSBvbmx5IGFmdGVyIDMgbW9udGhzDQogICAgICAgIC8vIHNpbmNlIHRoZSBoYWNrYXRob24gaXMgb3Zlcg0KICAgICAgICBpZiAobm93IDwgKGV2ZW50SW5mby5nZXRFdmVudEVuZCgpICsgMTIgd2Vla3MpKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgIC8vIGNoZWNrIHRoZXJlIGlzIDEgbW9udGhzIG92ZXIgc2luY2UgbGFzdCBvbmUNCiAgICAgICAgaWYgKGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGluZEVuZFRTICE9IDAgJiYgDQogICAgICAgICAgICBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3RpbmRFbmRUUyArICAyIHdlZWtzID4gbm93KSB0aHJvdzsNCg0KDQogICAgICAgIC8vIHN1Ym1pdCBpbXBlYWNobWVudCBwcm9wb3NhbA0KICAgICAgICAvLyBhZGQgdGhlIHZvdGVzIG9mIHRoZSBzdWJtaXR0ZXIgDQogICAgICAgIC8vIHRvIHRoZSBwcm9wb3NhbCByaWdodCBhd2F5DQogICAgICAgIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsID0gSW1wZWFjaG1lbnRQcm9wb3NhbCh1cmxEZXRhaWxzLCBuZXdFeGVjdXRpdmUsIG5vdyArIDIgd2Vla3MsIHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXSk7DQogICAgICAgIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGVkW21zZy5zZW5kZXJdID0gdHJ1ZTsNCiAgICAgICAgIA0KICAgICAgICAvLyByaXNlIGV2ZW50DQogICAgICAgIEltcGVhY2htZW50UHJvcG9zZWQobXNnLnNlbmRlciwgdXJsRGV0YWlscywgbm93ICsgMiB3ZWVrcywgbmV3RXhlY3V0aXZlKTsNCiAgICAgfQ0KICAgIA0KICAgIA0KICAgIC8qKg0KICAgICAqIHN1cHBvcnRJbXBlYWNobWVudCAtIHZvdGUgZm9yIGltcGVhY2htZW50IHByb3Bvc2FsIA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgIHRoYXQgaXMgY3VycmVudGx5IGluIHByb2dyZXNzDQogICAgICoNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdXBwb3J0SW1wZWFjaG1lbnQoKXsNCg0KICAgICAgICAvLyBlbnN1cmUgdGhhdCBzdXBwb3J0IGlzIGZvciBleGlzdCBwcm9wb3NhbCANCiAgICAgICAgaWYgKGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLm5ld0V4ZWN1dGl2ZSA9PSAweDApIHRocm93Ow0KICAgIA0KICAgICAgICAvLyB0byBvZmZlciBpbXBlYWNobWVudCB5b3Ugc2hvdWxkIGhhdmUgDQogICAgICAgIC8vIHZvdGluZyByaWdodHMNCiAgICAgICAgaWYgKHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXSA9PSAwKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIC8vIGNoZWNrIGlmIG5vdCB2b3RlZCBhbHJlYWR5IA0KICAgICAgICBpZiAobGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZWRbbXNnLnNlbmRlcl0pIHRocm93Ow0KICAgICAgICANCiAgICAgICAgLy8gY2hlY2sgaWYgbm90IGZpbmlzaGVkIHRoZSAyIHdlZWtzIG9mIHZvdGluZyANCiAgICAgICAgaWYgKGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGluZEVuZFRTICsgMiB3ZWVrcyA8PSBub3cpIHRocm93Ow0KICAgICAgICAgICAgICAgIA0KICAgICAgICAvLyBzdXBwb3J0IHRoZSBpbXBlYWNobWVudA0KICAgICAgICBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3RlZFttc2cuc2VuZGVyXSA9IHRydWU7DQogICAgICAgIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGVzU3VwcG9ydGluZyArPSB2b3RpbmdSaWdodHNbbXNnLnNlbmRlcl07DQoNCiAgICAgICAgLy8gcmlzZSBpbXBlYWNobWVudCBzdXBwcG9ydGluZyBldmVudA0KICAgICAgICBJbXBlYWNobWVudFN1cHBvcnQobXNnLnNlbmRlciwgdm90aW5nUmlnaHRzW21zZy5zZW5kZXJdKTsNCiAgICAgICAgDQogICAgICAgIC8vIGlmIHRoZSB2b3RlIGlzIG92ZXIgNzAlIGV4ZWN1dGUgdGhlIHN3aXRjaCANCiAgICAgICAgdWludCBwZXJjZW50ID0gcHJlZmVyZWRRdHlTb2xkIC8gMTAwOyANCiAgICAgICAgDQogICAgICAgIGlmIChsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3Rlc1N1cHBvcnRpbmcgPj0gNzAgKiBwZXJjZW50KXsNCiAgICAgICAgICAgIGV4ZWN1dGl2ZSA9IGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLm5ld0V4ZWN1dGl2ZTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gaW1wZWFjaG1lbnQgZXZlbnQNCiAgICAgICAgICAgIEltcGVhY2htZW50QWNjZXB0ZWQoZXhlY3V0aXZlKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICB9IA0KICAgIA0KICAgICAgDQogICAgDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAvLw0KICAgIC8vICogICAgIENvbnN0YW50IEdldHRlcnMgICAgICogLy8NCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqIC8vDQogICAgDQogICAgZnVuY3Rpb24gdm90aW5nUmlnaHRzT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVzdWx0KSB7DQogICAgICAgIHJlc3VsdCA9IHZvdGluZ1JpZ2h0c1tfb3duZXJdOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBnZXRQcmVmZXJlZFF0eVNvbGQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiBwcmVmZXJlZFF0eVNvbGQ7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHNldFZpcnR1YWxFeGNoYW5nZShhZGRyZXNzIHZpcnR1YWxFeGNoYW5nZUFkZHIpew0KICAgICAgICBpZiAodmlydHVhbEV4Y2hhbmdlQWRkcmVzcyAhPSAweDApIHRocm93Ow0KICAgICAgICB2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzID0gdmlydHVhbEV4Y2hhbmdlQWRkcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRIS0dPd25lZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsNCiAgICAgICAgcmV0dXJuIGhhY2tlckdvbGQuYmFsYW5jZU9mKHRoaXMpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBnZXRFdGhlclZhbHVlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpew0KICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBnZXRFeGVjdXRpdmUoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIHJlc3VsdCl7DQogICAgICAgIHJldHVybiBleGVjdXRpdmU7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGdldEhLR1ByaWNlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpew0KICAgICAgICByZXR1cm4gaGtnUHJpY2U7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0RXRoZXJQcmljZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsNCiAgICAgICAgcmV0dXJuIGV0aGVyUHJpY2U7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGdldERTVE5hbWUoKSBjb25zdGFudCByZXR1cm5zKHN0cmluZyByZXN1bHQpew0KICAgICAgICByZXR1cm4gbmFtZTsNCiAgICB9ICAgIA0KICAgIA0KICAgIGZ1bmN0aW9uIGdldERTVE5hbWVCeXRlcygpIGNvbnN0YW50IHJldHVybnMoYnl0ZXMzMiByZXN1bHQpew0KICAgICAgICByZXR1cm4gY29udmVydChuYW1lKTsNCiAgICB9ICAgIA0KDQogICAgZnVuY3Rpb24gZ2V0RFNUU3ltYm9sKCkgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcgcmVzdWx0KXsNCiAgICAgICAgcmV0dXJuIHN5bWJvbDsNCiAgICB9ICAgIA0KICAgIA0KICAgIGZ1bmN0aW9uIGdldERTVFN5bWJvbEJ5dGVzKCkgY29uc3RhbnQgcmV0dXJucyhieXRlczMyIHJlc3VsdCl7DQogICAgICAgIHJldHVybiBjb252ZXJ0KHN5bWJvbCk7DQogICAgfSAgICANCg0KICAgIGZ1bmN0aW9uIGdldEFkZHJlc3MoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIHJlc3VsdCkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gZ2V0VG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgew0KICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlWYXI7DQogICAgfSANCiAgICAgICAgDQogICAgZnVuY3Rpb24gZ2V0Q29sbGVjdGVkRXRoZXIoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdHMpIHsgICAgICAgIA0KICAgICAgICByZXR1cm4gY29sbGVjdGVkRXRoZXI7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGdldENvdW50ZXJQcm9wb3NhbHMoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiBjb3VudGVyUHJvcG9zYWxzOw0KICAgIH0NCiAgICAgICAgDQogICAgZnVuY3Rpb24gZ2V0UHJvcG9zYWxJZEJ5SW5kZXgodWludCBpKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyIHJlc3VsdCl7DQogICAgICAgIHJldHVybiBsaXN0UHJvcG9zYWxzW2ldLmlkOw0KICAgIH0gICAgDQoNCiAgICBmdW5jdGlvbiBnZXRQcm9wb3NhbE9iamVjdGlvbkJ5SW5kZXgodWludCBpKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7DQogICAgICAgIHJldHVybiBsaXN0UHJvcG9zYWxzW2ldLnZvdGVzT2JqZWN0aW5nOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldFByb3Bvc2FsVmFsdWVCeUluZGV4KHVpbnQgaSkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpew0KICAgICAgICByZXR1cm4gbGlzdFByb3Bvc2Fsc1tpXS52YWx1ZTsNCiAgICB9ICAgICAgICAgICAgICAgICAgDQogICAgDQogICAgZnVuY3Rpb24gZ2V0Q3VycmVudEltcGVhY2htZW50VXJsRGV0YWlscygpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyByZXN1bHQpew0KICAgICAgICByZXR1cm4gbGFzdEltcGVhY2htZW50UHJvcG9zYWwudXJsRGV0YWlsczsNCiAgICB9DQogICAgDQogICAgDQogICAgZnVuY3Rpb24gZ2V0Q3VycmVudEltcGVhY2htZW50Vm90ZXNTdXBwb3J0aW5nKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpew0KICAgICAgICByZXR1cm4gbGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZXNTdXBwb3J0aW5nOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBjb252ZXJ0KHN0cmluZyBrZXkpIHJldHVybnMgKGJ5dGVzMzIgcmV0KSB7DQogICAgICAgICAgICBpZiAoYnl0ZXMoa2V5KS5sZW5ndGggPiAzMikgew0KICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgfSAgICAgIA0KDQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgcmV0IDo9IG1sb2FkKGFkZChrZXksIDMyKSkNCiAgICAgICAgICAgIH0NCiAgICB9ICAgIA0KICAgIA0KICAgIC8vIEVtZXJnZW5jeSBGaXggbGltaXRlZCBieSB0aW1lIGZ1bmN0aW9ucw0KICAgIGZ1bmN0aW9uIHNldFZvdGVSaWdodChhZGRyZXNzIHZvdGVyLCB1aW50IGFtbW91bnQpew0KICAgICAgICANCiAgICAgICAgLy8gbGltaXRlZCBieSBbMTcgSmFuIDIwMTcgMDA6MDA6MDAgR01UXQ0KICAgICAgICBpZiAobm93ID4gMTQ4NDYxMTIwMCkgdGhyb3c7DQoNCiAgICAgICAgLy8gbGltaXRlZCBieSBvbmUgYWNjb3VudCB0byBmaXggDQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IDB4MzQyZTYyNzMyYjc2ODc1ZGE5MzA1MDgzZWE4YWU2MzEyNWE0ZTY2NykgdGhyb3c7DQoNCiAgICAgICAgdm90aW5nUmlnaHRzW3ZvdGVyXSA9IGFtbW91bnQ7DQogICAgfQ0KICAgIA0KICAgIC8vIEVtZXJnZW5jeSBGaXggbGltaXRlZCBieSB0aW1lIGZ1bmN0aW9ucw0KICAgIGZ1bmN0aW9uIHNldEJhbGFuY2UoYWRkcmVzcyBvd25lciwgdWludCBhbW1vdW50KXsNCg0KICAgICAgICAvLyBsaW1pdGVkIGJ5IFsxNyBKYW4gMjAxNyAwMDowMDowMCBHTVRdDQogICAgICAgIGlmIChub3cgPiAxNDg0NjExMjAwKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIC8vIGxpbWl0ZWQgYnkgb25lIGFjY291bnQgdG8gZml4IA0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSAweDM0MmU2MjczMmI3Njg3NWRhOTMwNTA4M2VhOGFlNjMxMjVhNGU2NjcpIHRocm93Ow0KICAgICAgICANCiAgICAgICAgYmFsYW5jZXNbb3duZXJdID0gYW1tb3VudDsNCiAgICB9DQogICAgDQogICAgLy8gRW1lcmdlbmN5IEZpeCBsaW1pdGVkIGJ5IHRpbWUgZnVuY3Rpb25zDQogICAgZnVuY3Rpb24gc2V0SW50ZXJuYWxJbmZvKGFkZHJlc3MgZml4RXhlY3V0aXZlLCB1aW50IGZpeFRvdGFsU3VwcGx5LCB1aW50MjU2IGZpeFByZWZlcmVkUXR5U29sZCwgDQogICAgICAgICAgICB1aW50MjU2IGZpeENvbGxlY3RlZEhLRywgdWludCBmaXhDb2xsZWN0ZWRFdGhlcil7DQoNCiAgICAgICAgLy8gbGltaXRlZCBieSBbMTcgSmFuIDIwMTcgMDA6MDA6MDAgR01UXQ0KICAgICAgICBpZiAobm93ID4gMTQ4NDYxMTIwMCkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICAvLyBsaW1pdGVkIGJ5IG9uZSBhY2NvdW50IHRvIGZpeCANCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gMHgzNDJlNjI3MzJiNzY4NzVkYTkzMDUwODNlYThhZTYzMTI1YTRlNjY3KSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIGV4ZWN1dGl2ZSA9IGZpeEV4ZWN1dGl2ZTsNCiAgICAgICAgdG90YWxTdXBwbHlWYXIgPSBmaXhUb3RhbFN1cHBseTsNCiAgICAgICAgcHJlZmVyZWRRdHlTb2xkID0gZml4UHJlZmVyZWRRdHlTb2xkOw0KICAgICAgICBjb2xsZWN0ZWRIS0cgPSBmaXhDb2xsZWN0ZWRIS0c7DQogICAgICAgIGNvbGxlY3RlZEV0aGVyID0gZml4Q29sbGVjdGVkRXRoZXI7DQogICAgfQ0KICAgIA0KICAgIA0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKiAvLw0KICAgIC8vICogICAgIE1vZGlmaWVycyAgICAgKiAvLw0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKiAvLyAgICANCiANCiAgICBtb2RpZmllciBvbmx5QmVmb3JlRW5kKCkgeyBpZiAobm93ICA+PSAgZXZlbnRJbmZvLmdldEV2ZW50RW5kKCkpIHRocm93OyBfOyB9DQogICAgbW9kaWZpZXIgb25seUFmdGVyRW5kKCkgIHsgaWYgKG5vdyAgPCAgIGV2ZW50SW5mby5nZXRFdmVudEVuZCgpKSB0aHJvdzsgXzsgfQ0KICAgIA0KICAgIG1vZGlmaWVyIG9ubHlBZnRlclRyYWRpbmdTdGFydCgpICB7IGlmIChub3cgIDwgZXZlbnRJbmZvLmdldFRyYWRpbmdTdGFydCgpKSB0aHJvdzsgXzsgfQ0KICAgIA0KICAgIG1vZGlmaWVyIG9ubHlFeGVjdXRpdmUoKSAgICAgeyBpZiAobXNnLnNlbmRlciAhPSBleGVjdXRpdmUpIHRocm93OyBfOyB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICBtb2RpZmllciBvbmx5SWZBYmxlVG9Jc3N1ZVRva2VucygpICB7IGlmICghYWJsZVRvSXNzdWVUb2tlbnMpIHRocm93OyBfOyB9IA0KICAgIA0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqIC8vDQogICAgLy8gKiAgICAgRXZlbnRzICAgICAqIC8vDQogICAgLy8gKioqKioqKioqKioqKioqKioqIC8vICAgICAgICANCg0KICAgIA0KICAgIGV2ZW50IFByaWNlSEtHQ2hhbmdlKHVpbnQgaW5kZXhlZCBxdHlGb3JPbmVIS0csIHVpbnQgaW5kZXhlZCB0b2tlbnNTb2xkLCB1aW50IGluZGV4ZWQgdG90YWxTdXBwbHkpOw0KICAgIGV2ZW50IEJ1eUZvckhLR1RyYW5zYWN0aW9uKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludCBpbmRleGVkIHRva2Vuc1NvbGQsIHVpbnQgaW5kZXhlZCB0b3RhbFN1cHBseSwgdWludCBxdHlGb3JPbmVIS0csIHVpbnQgdG9rZW5zQW1vdW50KTsNCiAgICBldmVudCBCdXlGb3JFdGhlclRyYW5zYWN0aW9uKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludCBpbmRleGVkIHRva2Vuc1NvbGQsIHVpbnQgaW5kZXhlZCB0b3RhbFN1cHBseSwgdWludCBxdHlGb3JPbmVFdGhlciwgdWludCB0b2tlbnNBbW91bnQpOw0KDQogICAgZXZlbnQgRHN0VG9rZW5zSXNzdWVkKHVpbnQgaW5kZXhlZCBxdHlGb3JPbmVIS0csIHVpbnQgaW5kZXhlZCB0b2tlbnNTb2xkLCB1aW50IGluZGV4ZWQgdG90YWxTdXBwbHksIHVpbnQgcXR5VG9FbWl0KTsNCiAgICANCiAgICBldmVudCBQcm9wb3NhbFJlcXVlc3RTdWJtaXR0ZWQoYnl0ZXMzMiBpZCwgdWludCB2YWx1ZSwgdWludCB0aW1lRW5kcywgc3RyaW5nIHVybCwgYWRkcmVzcyBzZW5kZXIpOw0KICAgIA0KICAgIGV2ZW50IEV0aGVyUmVkZWVtQWNjZXB0ZWQoYWRkcmVzcyBzZW5kZXIsIHVpbnQgdmFsdWUpOw0KICAgIA0KICAgIGV2ZW50IE9iamVjdGVkVm90ZShieXRlczMyIGlkLCBhZGRyZXNzIHZvdGVyLCB1aW50IHZvdGVzKTsNCiAgICANCiAgICBldmVudCBJbXBlYWNobWVudFByb3Bvc2VkKGFkZHJlc3Mgc3VibWl0dGVyLCBzdHJpbmcgdXJsRGV0YWlscywgdWludCB2b3RpbmRFbmRUUywgYWRkcmVzcyBuZXdFeGVjdXRpdmUpOw0KICAgIGV2ZW50IEltcGVhY2htZW50U3VwcG9ydChhZGRyZXNzIHN1cHBvcnR0ZXIsIHVpbnQgdm90ZXMpOw0KICAgIA0KICAgIGV2ZW50IEltcGVhY2htZW50QWNjZXB0ZWQoYWRkcmVzcyBuZXdFeGVjdXRpdmUpOw0KDQogICAgZXZlbnQgTmV3RXRoZXJQcmljZSh1aW50IG5ld1F0eUZvck9uZUV0aGVyKTsNCiAgICBldmVudCBEaXNhYmxlVG9rZW5Jc3N1YW5jZSgpOw0KICAgIA0KICAgIGV2ZW50IEJ1cm5lZEFsbFJlbWFpbmVkVG9rZW5zKCk7DQogICAgDQp9'