base 64 content
base64deCenterToken1
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KY29udHJhY3Qgb3duZWQgew0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KDQogICAgZnVuY3Rpb24gb3duZWQoKSB7DQogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5T3duZXIgew0KICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7DQogICAgICAgIG93bmVyID0gbmV3T3duZXI7DQogICAgfQ0KfQ0KDQpjb250cmFjdCBEU01hdGggew0KDQogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgeCwgdWludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2IHopIHsNCiAgICAgICAgYXNzZXJ0KCh6ID0geCArIHkpID49IHgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IHgsIHVpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiB6KSB7DQogICAgICAgIGFzc2VydCgoeiA9IHggLSB5KSA8PSB4KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgew0KICAgICAgICBhc3NlcnQoKHogPSB4ICogeSkgPj0geCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgeCwgdWludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2IHopIHsNCiAgICAgICAgeiA9IHggLyB5Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1pbih1aW50MjU2IHgsIHVpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiB6KSB7DQogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBtYXgodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgew0KICAgICAgICByZXR1cm4geCA+PSB5ID8geCA6IHk7DQogICAgfQ0KfQ0KDQoNCmNvbnRyYWN0IHF1ZXVlIHsNCiAgICBRdWV1ZSBwdWJsaWMgcTsNCg0KICAgIHN0cnVjdCBCdXlUaWNrZXQgew0KICAgICAgICBhZGRyZXNzIGFjY291bnQ7DQogICAgICAgIHVpbnQgYW1vdW50Ow0KICAgICAgICB1aW50IHRpbWU7DQogICAgfQ0KDQogICAgc3RydWN0IFF1ZXVlIHsNCiAgICAgICAgQnV5VGlja2V0W10gZGF0YTsNCiAgICAgICAgdWludCBmcm9udDsNCiAgICAgICAgdWludCBiYWNrOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHF1ZXVlU2l6ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcikgew0KICAgICAgICByID0gcS5iYWNrIC0gcS5mcm9udDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBxdWV1ZSgpIHsNCiAgICAgICAgcS5kYXRhLmxlbmd0aCA9IDYwMDAwMDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwdXNoUXVldWUoQnV5VGlja2V0IHRpY2tldCkgaW50ZXJuYWwgew0KICAgICAgICByZXF1aXJlKChxLmJhY2sgKyAxKSAlIHEuZGF0YS5sZW5ndGggIT0gcS5mcm9udCk7DQoNCiAgICAgICAgcS5kYXRhW3EuYmFja10gPSB0aWNrZXQ7DQogICAgICAgIHEuYmFjayA9IChxLmJhY2sgKyAxKSAlIHEuZGF0YS5sZW5ndGg7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcGVla1F1ZXVlKCkgaW50ZXJuYWwgcmV0dXJucyAoQnV5VGlja2V0IHIpIHsNCiAgICAgICAgcmVxdWlyZShxLmJhY2sgIT0gcS5mcm9udCk7DQoNCiAgICAgICAgciA9IHEuZGF0YVtxLmZyb250XTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwb3BRdWV1ZSgpIGludGVybmFsIHsNCiAgICAgICAgcmVxdWlyZShxLmJhY2sgIT0gcS5mcm9udCk7DQoNCiAgICAgICAgZGVsZXRlIHEuZGF0YVtxLmZyb250XTsNCiAgICAgICAgcS5mcm9udCA9IChxLmZyb250ICsgMSkgJSBxLmRhdGEubGVuZ3RoOw0KICAgIH0NCn0NCg0KY29udHJhY3QgRGVDZW50ZXJUb2tlbiBpcyBvd25lZCwgcXVldWUsIERTTWF0aCB7DQogICAgc3RyaW5nIHB1YmxpYyBzdGFuZGFyZCA9ICdUb2tlbiAwLjEnOw0KICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICdEZUNlbnRlcic7DQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAnREMnOw0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFscyA9IDg7DQoNCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseSA9IDEwMDAwMDAwMDAwMDAwMDAwOyAvLyAxMDAgbWlsbGlvbg0KICAgIHVpbnQyNTYgcHVibGljIGF2YWlsYWJsZVRva2VucyA9IDYwMDAwMDAwMDAwMDAwMDA7IC8vIDYwIG1pbGxpb24NCiAgICB1aW50MjU2IHB1YmxpYyB0ZWFtQW5kRXhwZXJ0c1Rva2VucyA9IDQwMDAwMDAwMDAwMDAwMDA7IC8vIDQwIG1pbGxpb24NCiAgICB1aW50MjU2IHB1YmxpYyBwcmljZSA9IDAuMDAwMDAwMDAwMSBldGhlcjsgLy8gMC4wMSBldGhlciBwZXIgdG9rZW4NCg0KICAgIHVpbnQgcHVibGljIHN0YXJ0VGltZTsNCiAgICB1aW50IHB1YmxpYyByZWZ1bmRTdGFydFRpbWU7DQogICAgdWludCBwdWJsaWMgcmVmdW5kRHVyYXRpb24gPSAzIGRheXM7IC8vIDMgeWVhcnMNCiAgICB1aW50IHB1YmxpYyBmaXJzdFN0YWdlRHVyYXRpb24gPSAzIGRheXM7IC8vIDMxIGRheXMNCg0KICAgIHVpbnQgcHVibGljIG1heERhaWx5Q2FwID0gMzMzMzMwMDAwMDAwMDsgLy8gMzMgMzMzIERDDQogICAgbWFwcGluZyAodWludCA9PiB1aW50KSBwdWJsaWMgZGFpbHlUb3RhbHM7DQoNCiAgICB1aW50IHB1YmxpYyBxdWV1ZWRBbW91bnQ7DQoNCiAgICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTsNCiAgICBhZGRyZXNzIHB1YmxpYyBleHBlcnRzQWNjb3VudDsNCiAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtQWNjb3VudDsNCg0KICAgIHVpbnQgcHVibGljIGxhc3RTY2hlZHVsZWRUb3BVcDsNCiAgICB1aW50IHB1YmxpYyBsYXN0UHJvY2Vzc2VkRGF5Ow0KDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZU9mOw0KDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBwdWJsaWMgYWxsb3dhbmNlOw0KDQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7DQoNCiAgICAvLyBmb3IgdGVzdGluZw0KICAgIHVpbnQgcHVibGljIGNUaW1lID0gMDsNCiAgICBmdW5jdGlvbiBzZXRDVGltZSh1aW50IF9jVGltZSkgb25seU93bmVyIHsNCiAgICAgICAgY1RpbWUgPSBfY1RpbWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gRGVDZW50ZXJUb2tlbigNCiAgICBhZGRyZXNzIF9iZW5lZmljaWFyeSwNCiAgICBhZGRyZXNzIF9leHBlcnRzQWNjb3VudCwNCiAgICBhZGRyZXNzIF90ZWFtQWNjb3VudCwNCiAgICB1aW50IF9zdGFydFRpbWUsDQogICAgdWludCBfcmVmdW5kU3RhcnRUaW1lDQogICAgKSB7DQogICAgICAgIGJlbmVmaWNpYXJ5ID0gX2JlbmVmaWNpYXJ5Ow0KICAgICAgICBleHBlcnRzQWNjb3VudCA9IF9leHBlcnRzQWNjb3VudDsNCiAgICAgICAgdGVhbUFjY291bnQgPSBfdGVhbUFjY291bnQ7DQoNCiAgICAgICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsNCiAgICAgICAgcmVmdW5kU3RhcnRUaW1lID0gX3JlZnVuZFN0YXJ0VGltZTsNCg0KICAgICAgICBiYWxhbmNlT2ZbdGhpc10gPSB0b3RhbFN1cHBseTsNCg0KICAgICAgICBsYXN0UHJvY2Vzc2VkRGF5ID0gZmlyc3RTdGFnZUR1cmF0aW9uIC0gMTsNCg0KICAgICAgICBzY2hlZHVsZWRUb3BVcCgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRpbWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIC8vIGZvciB0ZXN0aW5nDQogICAgICAgIGlmKGNUaW1lID4gMCkgew0KICAgICAgICAgICAgcmV0dXJuIGNUaW1lOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGJsb2NrLnRpbWVzdGFtcDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0b2RheSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIGRheUZvcih0aW1lKCkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGRheUZvcih1aW50IHRpbWVzdGFtcCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gc3ViKHRpbWVzdGFtcCwgc3RhcnRUaW1lKSAvIDI0IGhvdXJzOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGxvd2VyTGltaXRGb3JUb2RheSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHRvZGF5KCkgKiAxIGV0aGVyOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNjaGVkdWxlZFRvcFVwKCkgb25seU93bmVyIHsNCiAgICAgICAgdWludCBwYXltZW50ID0gNDAwMDAwMDAwMDAwMDAwOyAvLyA0IG1pbGxpb24gdG9rZW5zDQoNCiAgICAgICAgcmVxdWlyZShzdWIodGltZSgpLCBsYXN0U2NoZWR1bGVkVG9wVXApID49IDEgeWVhcnMpOw0KICAgICAgICByZXF1aXJlKHRlYW1BbmRFeHBlcnRzVG9rZW5zID49IHBheW1lbnQgKiAyKTsNCg0KICAgICAgICBsYXN0U2NoZWR1bGVkVG9wVXAgPSB0aW1lKCk7DQoNCiAgICAgICAgdGVhbUFuZEV4cGVydHNUb2tlbnMgLT0gcGF5bWVudDsNCiAgICAgICAgYmFsYW5jZU9mW3RoaXNdID0gc3ViKGJhbGFuY2VPZlt0aGlzXSwgcGF5bWVudCk7DQogICAgICAgIGJhbGFuY2VPZltleHBlcnRzQWNjb3VudF0gPSBhZGQoYmFsYW5jZU9mW2V4cGVydHNBY2NvdW50XSwgcGF5bWVudCk7DQoNCiAgICAgICAgdGVhbUFuZEV4cGVydHNUb2tlbnMgLT0gcGF5bWVudDsNCiAgICAgICAgYmFsYW5jZU9mW3RoaXNdID0gc3ViKGJhbGFuY2VPZlt0aGlzXSwgcGF5bWVudCk7DQogICAgICAgIGJhbGFuY2VPZlt0ZWFtQWNjb3VudF0gPSBhZGQoYmFsYW5jZU9mW3RlYW1BY2NvdW50XSwgcGF5bWVudCk7DQoNCiAgICAgICAgVHJhbnNmZXIodGhpcywgZXhwZXJ0c0FjY291bnQsIHBheW1lbnQpOyAvLyBleGVjdXRlIGFuIGV2ZW50IHJlZmxlY3RpbmcgdGhlIGNoYW5nZQ0KICAgICAgICBUcmFuc2Zlcih0aGlzLCB0ZWFtQWNjb3VudCwgcGF5bWVudCk7IC8vIGV4ZWN1dGUgYW4gZXZlbnQgcmVmbGVjdGluZyB0aGUgY2hhbmdlDQogICAgfQ0KDQogICAgLyogQWxsb3cgYW5vdGhlciBjb250cmFjdCB0byBzcGVuZCBzb21lIHRva2VucyBpbiB5b3VyIGJlaGFsZiAqLw0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBhbGxvd2FuY2VbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlZnVuZCh1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgew0KICAgICAgICByZXF1aXJlKHRpbWUoKSA+IHJlZnVuZFN0YXJ0VGltZSk7DQogICAgICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IF92YWx1ZSAqIHByaWNlKTsNCg0KICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPSBzdWIoYmFsYW5jZU9mW21zZy5zZW5kZXJdLCBfdmFsdWUpOw0KICAgICAgICBiYWxhbmNlT2ZbdGhpc10gPSBhZGQoYmFsYW5jZU9mW3RoaXNdLCBfdmFsdWUpOw0KICAgICAgICBhdmFpbGFibGVUb2tlbnMgPSBhZGQoYXZhaWxhYmxlVG9rZW5zLCBfdmFsdWUpOw0KDQogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoX3ZhbHVlICogcHJpY2UpOw0KDQogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRoaXMsIF92YWx1ZSk7IC8vIE5vdGlmeSBhbnlvbmUgbGlzdGVuaW5nIHRoYXQgdGhpcyB0cmFuc2ZlciB0b29rIHBsYWNlDQogICAgfQ0KDQogICAgLyogU2VuZCB0b2tlbnMgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHsNCiAgICAgICAgcmVxdWlyZShiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsgLy8gQ2hlY2sgaWYgdGhlIHNlbmRlciBoYXMgZW5vdWdoDQoNCiAgICAgICAgaWYgKF90byA9PSBhZGRyZXNzKHRoaXMpKSB7DQogICAgICAgICAgICByZWZ1bmQoX3ZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSA9IHN1YihiYWxhbmNlT2ZbbXNnLnNlbmRlcl0sIF92YWx1ZSk7DQogICAgICAgIGJhbGFuY2VPZltfdG9dID0gYWRkKGJhbGFuY2VPZltfdG9dLCBfdmFsdWUpOw0KDQogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsgLy8gTm90aWZ5IGFueW9uZSBsaXN0ZW5pbmcgdGhhdCB0aGlzIHRyYW5zZmVyIHRvb2sgcGxhY2UNCiAgICB9DQoNCiAgICAvKiBBIGNvbnRyYWN0IGF0dGVtcHRzIHRvIGdldCB0aGUgdG9rZW5zICovDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIHJlcXVpcmUoYmFsYW5jZU9mW19mcm9tXSA+PSBfdmFsdWUpOyAvLyBDaGVjayBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2gNCiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSk7IC8vIENoZWNrIGFsbG93YW5jZQ0KDQogICAgICAgIGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0gPSBzdWIoYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSwgX3ZhbHVlKTsgLy8gIFN1YnRyYWN0IGZyb20gdGhlIGFsbG93YW5jZQ0KICAgICAgICBiYWxhbmNlT2ZbX2Zyb21dID0gc3ViKGJhbGFuY2VPZltfZnJvbV0sIF92YWx1ZSk7IC8vIFN1YnRyYWN0IGZyb20gdGhlIHNlbmRlcg0KICAgICAgICBiYWxhbmNlT2ZbX3RvXSA9IGFkZChiYWxhbmNlT2ZbX3RvXSwgX3ZhbHVlKTsgLy8gQWRkIHRoZSBzYW1lIHRvIHRoZSByZWNpcGllbnQNCg0KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNsb3NlUmVmdW5kKCkgb25seU93bmVyIHsNCiAgICAgICAgcmVxdWlyZSh0aW1lKCkgLSByZWZ1bmRTdGFydFRpbWUgPiByZWZ1bmREdXJhdGlvbik7DQoNCiAgICAgICAgYmVuZWZpY2lhcnkudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqICAgIFRva2VuIHB1cmNoYXNpbmcgaGFzIDIgc3RhZ2VzOg0KICAgICAqICAgICAgIC0gRmlyc3Qgc3RhZ2UgaG9sZHMgMzEgZGF5cy4gVGhlcmUgaXMgbm8gbGltaXQgb2YgYnV5aW5nLg0KICAgICAqICAgICAgIC0gU2Vjb25kIHN0YWdlIGhvbGRzIH41IHllYXJzIGFmdGVyLiBUaGVyZSB3aWxsIGJlIGxpbWl0IG9mIDMzMy4zMyBldGhlciBwZXIgZGF5Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJ1eSgpIHBheWFibGUgew0KICAgICAgICByZXF1aXJlKHN0YXJ0VGltZSA8PSB0aW1lKCkpOyAvLyBjaGVjayBpZiBJQ08gaXMgZ29pbmcNCg0KICAgICAgICB1aW50IGFtb3VudCA9IGRpdihtc2cudmFsdWUsIHByaWNlKTsNCg0KICAgICAgICBpZiAodGltZSgpIC0gc3RhcnRUaW1lID4gZmlyc3RTdGFnZUR1cmF0aW9uKSB7IC8vIHNlY29uZCBzdGFnZQ0KICAgICAgICAgICAgcmVxdWlyZSgxIGV0aGVyIDw9IG1zZy52YWx1ZSk7IC8vIGNoZWNrIG1pbi4gbGltaXQNCiAgICAgICAgICAgIHJlcXVpcmUobXNnLnZhbHVlIDw9IDMwMCBldGhlcik7IC8vIGNoZWNrIG1heC4gbGltaXQNCg0KICAgICAgICAgICAgLy8gc2VuZCA4MCUgdG8gYmVuZWZpY2lhcnkgYWNjb3VudCwgYW5vdGhlciAyMCUgc3RheXMgZm9yIHJlZnVuZGluZw0KICAgICAgICAgICAgYmVuZWZpY2lhcnkudHJhbnNmZXIobXVsKGRpdihtc2cudmFsdWUsIDUpLCA0KSk7DQoNCiAgICAgICAgICAgIHVpbnQgY3VycmVudERheSA9IGxhc3RQcm9jZXNzZWREYXkgKyAxOw0KICAgICAgICAgICAgdWludCBsaW1pdCA9IG1heERhaWx5Q2FwIC0gZGFpbHlUb3RhbHNbY3VycmVudERheV07DQoNCiAgICAgICAgICAgIGlmIChsaW1pdCA+PSBhbW91bnQpIHsNCiAgICAgICAgICAgICAgICBhdmFpbGFibGVUb2tlbnMgPSBzdWIoYXZhaWxhYmxlVG9rZW5zLCBhbW91bnQpOw0KICAgICAgICAgICAgICAgIGJhbGFuY2VPZlt0aGlzXSA9IHN1YihiYWxhbmNlT2ZbdGhpc10sIGFtb3VudCk7IC8vIHN1YnRyYWN0cyBhbW91bnQgZnJvbSBzZWxsZXIncyBiYWxhbmNlDQogICAgICAgICAgICAgICAgZGFpbHlUb3RhbHNbY3VycmVudERheV0gPSBhZGQoZGFpbHlUb3RhbHNbY3VycmVudERheV0sIGFtb3VudCk7DQogICAgICAgICAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdID0gYWRkKGJhbGFuY2VPZlttc2cuc2VuZGVyXSwgYW1vdW50KTsgLy8gYWRkcyB0aGUgYW1vdW50IHRvIGJ1eWVyJ3MgYmFsYW5jZQ0KDQogICAgICAgICAgICAgICAgVHJhbnNmZXIodGhpcywgbXNnLnNlbmRlciwgYW1vdW50KTsgLy8gZXhlY3V0ZSBhbiBldmVudCByZWZsZWN0aW5nIHRoZSBjaGFuZ2UNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcXVldWVkQW1vdW50ID0gYWRkKHF1ZXVlZEFtb3VudCwgYW1vdW50KTsNCiAgICAgICAgICAgICAgICByZXF1aXJlKHF1ZXVlZEFtb3VudCA8PSBhdmFpbGFibGVUb2tlbnMpOw0KICAgICAgICAgICAgICAgIEJ1eVRpY2tldCBtZW1vcnkgdGlja2V0ID0gQnV5VGlja2V0KHthY2NvdW50OiBtc2cuc2VuZGVyLCBhbW91bnQ6IGFtb3VudCwgdGltZTogdGltZSgpfSk7DQogICAgICAgICAgICAgICAgcHVzaFF1ZXVlKHRpY2tldCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgfSBlbHNlIHsgLy8gZmlyc3Qgc3RhZ2UNCiAgICAgICAgICAgIHJlcXVpcmUobG93ZXJMaW1pdEZvclRvZGF5KCkgPD0gbXNnLnZhbHVlKTsgLy8gY2hlY2sgbWluLiBsaW1pdA0KICAgICAgICAgICAgcmVxdWlyZShhbW91bnQgPD0gYXZhaWxhYmxlVG9rZW5zKTsNCg0KICAgICAgICAgICAgLy8gc2VuZCA4MCUgdG8gYmVuZWZpY2lhcnkgYWNjb3VudCwgYW5vdGhlciAyMCUgc3RheXMgZm9yIHJlZnVuZGluZw0KICAgICAgICAgICAgYmVuZWZpY2lhcnkudHJhbnNmZXIobXVsKGRpdihtc2cudmFsdWUsIDUpLCA0KSk7DQoNCiAgICAgICAgICAgIGF2YWlsYWJsZVRva2VucyA9IHN1YihhdmFpbGFibGVUb2tlbnMsIGFtb3VudCk7DQogICAgICAgICAgICBiYWxhbmNlT2ZbdGhpc10gPSBzdWIoYmFsYW5jZU9mW3RoaXNdLCBhbW91bnQpOyAvLyBzdWJ0cmFjdHMgYW1vdW50IGZyb20gc2VsbGVyJ3MgYmFsYW5jZQ0KICAgICAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdID0gYWRkKGJhbGFuY2VPZlttc2cuc2VuZGVyXSwgYW1vdW50KTsgLy8gYWRkcyB0aGUgYW1vdW50IHRvIGJ1eWVyJ3MgYmFsYW5jZQ0KDQogICAgICAgICAgICBUcmFuc2Zlcih0aGlzLCBtc2cuc2VuZGVyLCBhbW91bnQpOyAvLyBleGVjdXRlIGFuIGV2ZW50IHJlZmxlY3RpbmcgdGhlIGNoYW5nZQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHJvY2Vzc1BlbmRpbmdUaWNrZXRzKCkgb25seU93bmVyIHsNCg0KICAgICAgICB1aW50IHNpemUgPSBxdWV1ZVNpemUoKTsNCiAgICAgICAgdWludCBwdHIgPSAwOw0KICAgICAgICB1aW50IGN1cnJlbnREYXk7DQogICAgICAgIHVpbnQgbGltaXQ7DQogICAgICAgIEJ1eVRpY2tldCBtZW1vcnkgdGlja2V0Ow0KDQogICAgICAgIHdoaWxlIChwdHIgPCBzaXplKSB7DQogICAgICAgICAgICBjdXJyZW50RGF5ID0gbGFzdFByb2Nlc3NlZERheSArIDE7DQogICAgICAgICAgICBsaW1pdCA9IG1heERhaWx5Q2FwIC0gZGFpbHlUb3RhbHNbY3VycmVudERheV07DQoNCiAgICAgICAgICAgIC8vIHN0b3AgdGhlbiB0cnlpbmcgdG8gcHJvY2VzcyBmdXR1cmUNCiAgICAgICAgICAgIGlmIChzdGFydFRpbWUgKyAoY3VycmVudERheSAtIDEpICogMSBkYXlzID4gdGltZSgpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBsaW1pdCB0byBwcmV2ZW50IG91dCBvZiBnYXMgZXJyb3INCiAgICAgICAgICAgIGlmIChwdHIgPiA1MCkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdGlja2V0ID0gcGVla1F1ZXVlKCk7DQoNCiAgICAgICAgICAgIGlmIChsaW1pdCA8IHRpY2tldC5hbW91bnQgfHwgdGlja2V0LnRpbWUgLSAxMDAwIHNlY29uZHMgPiBzdGFydFRpbWUgKyAoY3VycmVudERheSAtIDEpICogMSBkYXlzKSB7DQogICAgICAgICAgICAgICAgbGFzdFByb2Nlc3NlZERheSArPSAxOw0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwb3BRdWV1ZSgpOw0KICAgICAgICAgICAgcHRyICs9IDE7DQoNCiAgICAgICAgICAgIGF2YWlsYWJsZVRva2VucyA9IHN1YihhdmFpbGFibGVUb2tlbnMsIHRpY2tldC5hbW91bnQpOw0KICAgICAgICAgICAgcXVldWVkQW1vdW50ID0gc3ViKHF1ZXVlZEFtb3VudCwgdGlja2V0LmFtb3VudCk7DQogICAgICAgICAgICBkYWlseVRvdGFsc1tjdXJyZW50RGF5XSA9IGFkZChkYWlseVRvdGFsc1tjdXJyZW50RGF5XSwgdGlja2V0LmFtb3VudCk7DQogICAgICAgICAgICBiYWxhbmNlT2ZbdGhpc10gPSBzdWIoYmFsYW5jZU9mW3RoaXNdLCB0aWNrZXQuYW1vdW50KTsNCiAgICAgICAgICAgIGJhbGFuY2VPZlt0aWNrZXQuYWNjb3VudF0gPSBhZGQoYmFsYW5jZU9mW3RpY2tldC5hY2NvdW50XSwgdGlja2V0LmFtb3VudCk7IC8vIGFkZHMgdGhlIGFtb3VudCB0byBidXllcidzIGJhbGFuY2UNCg0KICAgICAgICAgICAgVHJhbnNmZXIodGhpcywgdGlja2V0LmFjY291bnQsIHRpY2tldC5hbW91bnQpOyAvLyBleGVjdXRlIGFuIGV2ZW50IHJlZmxlY3RpbmcgdGhlIGNoYW5nZQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsNCiAgICAgICAgYnV5KCk7DQogICAgfQ0KfQ=='