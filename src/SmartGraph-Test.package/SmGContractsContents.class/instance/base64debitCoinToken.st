base 64 content
base64debitCoinToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMzsNCg0KLyoNCiAgICBPdmVyZmxvdyBwcm90ZWN0ZWQgbWF0aCBmdW5jdGlvbnMNCiovDQpjb250cmFjdCBTYWZlTWF0aCB7DQogICAgLyoqDQogICAgICAgIGNvbnN0cnVjdG9yDQogICAgKi8NCiAgICBmdW5jdGlvbiBTYWZlTWF0aCgpIHsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBzdW0gb2YgX3ggYW5kIF95LCBhc3NlcnRzIGlmIHRoZSBjYWxjdWxhdGlvbiBvdmVyZmxvd3MNCg0KICAgICAgICBAcGFyYW0gX3ggICB2YWx1ZSAxDQogICAgICAgIEBwYXJhbSBfeSAgIHZhbHVlIDINCg0KICAgICAgICBAcmV0dXJuIHN1bQ0KICAgICovDQogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIHVpbnQyNTYgeiA9IF94ICsgX3k7DQogICAgICAgIGFzc2VydCh6ID49IF94KTsNCiAgICAgICAgcmV0dXJuIHo7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZGlmZmVyZW5jZSBvZiBfeCBtaW51cyBfeSwgYXNzZXJ0cyBpZiB0aGUgc3VidHJhY3Rpb24gcmVzdWx0cyBpbiBhIG5lZ2F0aXZlIG51bWJlcg0KDQogICAgICAgIEBwYXJhbSBfeCAgIG1pbnVlbmQNCiAgICAgICAgQHBhcmFtIF95ICAgc3VidHJhaGVuZA0KDQogICAgICAgIEByZXR1cm4gZGlmZmVyZW5jZQ0KICAgICovDQogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIGFzc2VydChfeCA+PSBfeSk7DQogICAgICAgIHJldHVybiBfeCAtIF95Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IHJldHVybnMgdGhlIHByb2R1Y3Qgb2YgbXVsdGlwbHlpbmcgX3ggYnkgX3ksIGFzc2VydHMgaWYgdGhlIGNhbGN1bGF0aW9uIG92ZXJmbG93cw0KDQogICAgICAgIEBwYXJhbSBfeCAgIGZhY3RvciAxDQogICAgICAgIEBwYXJhbSBfeSAgIGZhY3RvciAyDQoNCiAgICAgICAgQHJldHVybiBwcm9kdWN0DQogICAgKi8NCiAgICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgdWludDI1NiB6ID0gX3ggKiBfeTsNCiAgICAgICAgYXNzZXJ0KF94ID09IDAgfHwgeiAvIF94ID09IF95KTsNCiAgICAgICAgcmV0dXJuIHo7DQogICAgfQ0KfSANCg0KLyoNCiAgICBPd25lZCBjb250cmFjdCBpbnRlcmZhY2UNCiovDQpjb250cmFjdCBJT3duZWQgew0KICAgIC8vIHRoaXMgZnVuY3Rpb24gaXNuJ3QgYWJzdHJhY3Qgc2luY2UgdGhlIGNvbXBpbGVyIGVtaXRzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGdldHRlciBmdW5jdGlvbnMgYXMgZXh0ZXJuYWwNCiAgICBmdW5jdGlvbiBvd25lcigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIG93bmVyKSB7IG93bmVyOyB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljOw0KICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYzsNCn0NCg0KLyoNCiAgICBQcm92aWRlcyBzdXBwb3J0IGFuZCB1dGlsaXRpZXMgZm9yIGNvbnRyYWN0IG93bmVyc2hpcA0KKi8NCmNvbnRyYWN0IE93bmVkIGlzIElPd25lZCB7DQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXI7DQoNCiAgICBldmVudCBPd25lclVwZGF0ZShhZGRyZXNzIF9wcmV2T3duZXIsIGFkZHJlc3MgX25ld093bmVyKTsNCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGNvbnN0cnVjdG9yDQogICAgKi8NCiAgICBmdW5jdGlvbiBPd25lZCgpIHsNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgIH0NCg0KICAgIC8vIGFsbG93cyBleGVjdXRpb24gYnkgdGhlIG93bmVyIG9ubHkNCiAgICBtb2RpZmllciBvd25lck9ubHkgew0KICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBvd25lcik7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgYWxsb3dzIHRyYW5zZmVycmluZyB0aGUgY29udHJhY3Qgb3duZXJzaGlwDQogICAgICAgIHRoZSBuZXcgb3duZXIgc3RpbGwgbmVlZCB0byBhY2NlcHQgdGhlIHRyYW5zZmVyDQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXINCg0KICAgICAgICBAcGFyYW0gX25ld093bmVyICAgIG5ldyBjb250cmFjdCBvd25lcg0KICAgICovDQogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyBvd25lck9ubHkgew0KICAgICAgICByZXF1aXJlKF9uZXdPd25lciAhPSBvd25lcik7DQogICAgICAgIG5ld093bmVyID0gX25ld093bmVyOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IHVzZWQgYnkgYSBuZXcgb3duZXIgdG8gYWNjZXB0IGFuIG93bmVyc2hpcCB0cmFuc2Zlcg0KICAgICovDQogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgcHVibGljIHsNCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG5ld093bmVyKTsNCiAgICAgICAgT3duZXJVcGRhdGUob3duZXIsIG5ld093bmVyKTsNCiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICAgICAgbmV3T3duZXIgPSAweDA7DQogICAgfQ0KfQ0KDQovKg0KICAgIFRva2VuIEhvbGRlciBpbnRlcmZhY2UNCiovDQpjb250cmFjdCBJVG9rZW5Ib2xkZXIgaXMgSU93bmVkIHsNCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucyhJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsNCn0NCg0KLyoNCiAgICBXZSBjb25zaWRlciBldmVyeSBjb250cmFjdCB0byBiZSBhICd0b2tlbiBob2xkZXInIHNpbmNlIGl0J3MgY3VycmVudGx5IG5vdCBwb3NzaWJsZQ0KICAgIGZvciBhIGNvbnRyYWN0IHRvIGRlbnkgcmVjZWl2aW5nIHRva2Vucy4NCg0KICAgIFRoZSBUb2tlbkhvbGRlcidzIGNvbnRyYWN0IHNvbGUgcHVycG9zZSBpcyB0byBwcm92aWRlIGEgc2FmZXR5IG1lY2hhbmlzbSB0aGF0IGFsbG93cw0KICAgIHRoZSBvd25lciB0byBzZW5kIHRva2VucyB0aGF0IHdlcmUgc2VudCB0byB0aGUgY29udHJhY3QgYnkgbWlzdGFrZSBiYWNrIHRvIHRoZWlyIHNlbmRlci4NCiovDQpjb250cmFjdCBUb2tlbkhvbGRlciBpcyBJVG9rZW5Ib2xkZXIsIE93bmVkIHsNCiAgICAvKioNCiAgICAgICAgQGRldiBjb25zdHJ1Y3Rvcg0KICAgICovDQogICAgZnVuY3Rpb24gVG9rZW5Ib2xkZXIoKSB7DQogICAgfQ0KDQogICAgLy8gdmFsaWRhdGVzIGFuIGFkZHJlc3MgLSBjdXJyZW50bHkgb25seSBjaGVja3MgdGhhdCBpdCBpc24ndCBudWxsDQogICAgbW9kaWZpZXIgdmFsaWRBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHsNCiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAweDApOw0KICAgICAgICBfOw0KICAgIH0NCiAgICAvLyBzaW5jZSB2MC40LjEyIG9mIGNvbXBpbGVyIHdlIG5lZWQgdGhpcyANCiAgICBtb2RpZmllciB2YWxpZEFkZHJlc3NGb3JTZWNvbmQoYWRkcmVzcyBfYWRkcmVzcykgew0KICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IDB4MCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLy8gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBpcyBkaWZmZXJlbnQgdGhhbiB0aGlzIGNvbnRyYWN0IGFkZHJlc3MNCiAgICBtb2RpZmllciBub3RUaGlzKGFkZHJlc3MgX2FkZHJlc3MpIHsNCiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSBhZGRyZXNzKHRoaXMpKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiB3aXRoZHJhd3MgdG9rZW5zIGhlbGQgYnkgdGhlIGNvbnRyYWN0IGFuZCBzZW5kcyB0aGVtIHRvIGFuIGFjY291bnQNCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lcg0KDQogICAgICAgIEBwYXJhbSBfdG9rZW4gICBFUkMyMCB0b2tlbiBjb250cmFjdCBhZGRyZXNzDQogICAgICAgIEBwYXJhbSBfdG8gICAgICBhY2NvdW50IHRvIHJlY2VpdmUgdGhlIG5ldyBhbW91bnQNCiAgICAgICAgQHBhcmFtIF9hbW91bnQgIGFtb3VudCB0byB3aXRoZHJhdw0KICAgICovDQogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoSUVSQzIwVG9rZW4gX3Rva2VuLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgb3duZXJPbmx5DQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG9rZW4pDQogICAgICAgIHZhbGlkQWRkcmVzc0ZvclNlY29uZChfdG8pDQogICAgICAgIG5vdFRoaXMoX3RvKQ0KICAgIHsNCiAgICAgICAgYXNzZXJ0KF90b2tlbi50cmFuc2ZlcihfdG8sIF9hbW91bnQpKTsNCiAgICB9DQp9DQoNCi8qDQogICAgRVJDMjAgU3RhbmRhcmQgVG9rZW4gaW50ZXJmYWNlDQoqLw0KY29udHJhY3QgSUVSQzIwVG9rZW4gew0KICAgIC8vIHRoZXNlIGZ1bmN0aW9ucyBhcmVuJ3QgYWJzdHJhY3Qgc2luY2UgdGhlIGNvbXBpbGVyIGVtaXRzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGdldHRlciBmdW5jdGlvbnMgYXMgZXh0ZXJuYWwNCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBuYW1lKSB7IG5hbWU7IH0NCiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCkgeyBzeW1ib2w7IH0NCiAgICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCBkZWNpbWFscykgeyBkZWNpbWFsczsgfQ0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWxTdXBwbHkpIHsgdG90YWxTdXBwbHk7IH0NCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsgX293bmVyOyBiYWxhbmNlOyB9DQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsgX293bmVyOyBfc3BlbmRlcjsgcmVtYWluaW5nOyB9DQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCn0NCg0KLyoqDQogICAgRVJDMjAgU3RhbmRhcmQgVG9rZW4gaW1wbGVtZW50YXRpb24NCiovDQpjb250cmFjdCBFUkMyMFRva2VuIGlzIElFUkMyMFRva2VuLCBTYWZlTWF0aCB7DQogICAgc3RyaW5nIHB1YmxpYyBzdGFuZGFyZCA9ICdUb2tlbiAwLjEnOw0KICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICdERUJJVCBDb2luIFRva2VuJzsNCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICdEQkMnOw0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFscyA9IDg7DQogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHkgPSAwOw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VPZjsNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyBhbGxvd2FuY2U7DQoNCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsNCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGNvbnN0cnVjdG9yDQoNCiAgICAgICAgQHBhcmFtIF9uYW1lICAgICAgICB0b2tlbiBuYW1lDQogICAgICAgIEBwYXJhbSBfc3ltYm9sICAgICAgdG9rZW4gc3ltYm9sDQogICAgICAgIEBwYXJhbSBfZGVjaW1hbHMgICAgZGVjaW1hbCBwb2ludHMsIGZvciBkaXNwbGF5IHB1cnBvc2VzDQogICAgKi8NCiAgICBmdW5jdGlvbiBFUkMyMFRva2VuKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQ4IF9kZWNpbWFscykgew0KICAgICAgICByZXF1aXJlKGJ5dGVzKF9uYW1lKS5sZW5ndGggPiAwICYmIGJ5dGVzKF9zeW1ib2wpLmxlbmd0aCA+IDApOyAvLyB2YWxpZGF0ZSBpbnB1dA0KDQogICAgICAgIG5hbWUgPSBfbmFtZTsNCiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsNCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7DQogICAgfQ0KDQogICAgLy8gdmFsaWRhdGVzIGFuIGFkZHJlc3MgLSBjdXJyZW50bHkgb25seSBjaGVja3MgdGhhdCBpdCBpc24ndCBudWxsDQogICAgbW9kaWZpZXIgdmFsaWRBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHsNCiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAweDApOw0KICAgICAgICBfOw0KICAgIH0NCiAgICANCiAgICAvLyBzaW5jZSB2MC40LjEyIGNvbXBpbGVyIHdlIG5lZWQgdGhpcyANCiAgICBtb2RpZmllciB2YWxpZEFkZHJlc3NGb3JTZWNvbmQoYWRkcmVzcyBfYWRkcmVzcykgew0KICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IDB4MCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgc2VuZCBjb2lucw0KICAgICAgICB0aHJvd3Mgb24gYW55IGVycm9yIHJhdGhlciB0aGVuIHJldHVybiBhIGZhbHNlIGZsYWcgdG8gbWluaW1pemUgdXNlciBlcnJvcnMNCg0KICAgICAgICBAcGFyYW0gX3RvICAgICAgdGFyZ2V0IGFkZHJlc3MNCiAgICAgICAgQHBhcmFtIF92YWx1ZSAgIHRyYW5zZmVyIGFtb3VudA0KDQogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIGlmIGl0IHdhc24ndA0KICAgICovDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgdmFsaWRBZGRyZXNzKF90bykNCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQ0KICAgIHsNCiAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlT2ZbbXNnLnNlbmRlcl0sIF92YWx1ZSk7DQogICAgICAgIGJhbGFuY2VPZltfdG9dID0gc2FmZUFkZChiYWxhbmNlT2ZbX3RvXSwgX3ZhbHVlKTsNCiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBhbiBhY2NvdW50L2NvbnRyYWN0IGF0dGVtcHRzIHRvIGdldCB0aGUgY29pbnMNCiAgICAgICAgdGhyb3dzIG9uIGFueSBlcnJvciByYXRoZXIgdGhlbiByZXR1cm4gYSBmYWxzZSBmbGFnIHRvIG1pbmltaXplIHVzZXIgZXJyb3JzDQoNCiAgICAgICAgQHBhcmFtIF9mcm9tICAgIHNvdXJjZSBhZGRyZXNzDQogICAgICAgIEBwYXJhbSBfdG8gICAgICB0YXJnZXQgYWRkcmVzcw0KICAgICAgICBAcGFyYW0gX3ZhbHVlICAgdHJhbnNmZXIgYW1vdW50DQoNCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2UgaWYgaXQgd2Fzbid0DQogICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgdmFsaWRBZGRyZXNzKF9mcm9tKQ0KICAgICAgICB2YWxpZEFkZHJlc3NGb3JTZWNvbmQoX3RvKQ0KICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpDQogICAgew0KICAgICAgICBhbGxvd2FuY2VbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihhbGxvd2FuY2VbX2Zyb21dW21zZy5zZW5kZXJdLCBfdmFsdWUpOw0KICAgICAgICBiYWxhbmNlT2ZbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlT2ZbX2Zyb21dLCBfdmFsdWUpOw0KICAgICAgICBiYWxhbmNlT2ZbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZU9mW190b10sIF92YWx1ZSk7DQogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGFsbG93IGFub3RoZXIgYWNjb3VudC9jb250cmFjdCB0byBzcGVuZCBzb21lIHRva2VucyBvbiB5b3VyIGJlaGFsZg0KICAgICAgICB0aHJvd3Mgb24gYW55IGVycm9yIHJhdGhlciB0aGVuIHJldHVybiBhIGZhbHNlIGZsYWcgdG8gbWluaW1pemUgdXNlciBlcnJvcnMNCg0KICAgICAgICBhbHNvLCB0byBtaW5pbWl6ZSB0aGUgcmlzayBvZiB0aGUgYXBwcm92ZS90cmFuc2ZlckZyb20gYXR0YWNrIHZlY3Rvcg0KICAgICAgICAoc2VlIGh0dHBzOi8vZG9jcy5nb29nbGUuY29tL2RvY3VtZW50L2QvMVlMUHRReFp1MVVBdk85Y1oxTzJSUFhCYlQwbW9vaDREWUtqQV9qcC1STE0vKSwgYXBwcm92ZSBoYXMgdG8gYmUgY2FsbGVkIHR3aWNlDQogICAgICAgIGluIDIgc2VwYXJhdGUgdHJhbnNhY3Rpb25zIC0gb25jZSB0byBjaGFuZ2UgdGhlIGFsbG93YW5jZSB0byAwIGFuZCBzZWNvbmRseSB0byBjaGFuZ2UgaXQgdG8gdGhlIG5ldyBhbGxvd2FuY2UgdmFsdWUNCg0KICAgICAgICBAcGFyYW0gX3NwZW5kZXIgYXBwcm92ZWQgYWRkcmVzcw0KICAgICAgICBAcGFyYW0gX3ZhbHVlICAgYWxsb3dhbmNlIGFtb3VudA0KDQogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIGlmIGl0IHdhc24ndA0KICAgICovDQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkNCiAgICAgICAgcHVibGljDQogICAgICAgIHZhbGlkQWRkcmVzcyhfc3BlbmRlcikNCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQ0KICAgIHsNCiAgICAgICAgLy8gaWYgdGhlIGFsbG93YW5jZSBpc24ndCAwLCBpdCBjYW4gb25seSBiZSB1cGRhdGVkIHRvIDAgdG8gcHJldmVudCBhbiBhbGxvd2FuY2UgY2hhbmdlIGltbWVkaWF0ZWx5IGFmdGVyIHdpdGhkcmF3YWwNCiAgICAgICAgcmVxdWlyZShfdmFsdWUgPT0gMCB8fCBhbGxvd2FuY2VbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApOw0KDQogICAgICAgIGFsbG93YW5jZVttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQp9DQoNCi8qDQogICAgREVCSVRDb2luIFRva2VuIGludGVyZmFjZQ0KKi8NCmNvbnRyYWN0IElEZWJpdENvaW5Ub2tlbiBpcyBJVG9rZW5Ib2xkZXIsIElFUkMyMFRva2VuIHsNCiAgICBmdW5jdGlvbiBkaXNhYmxlVHJhbnNmZXJzKGJvb2wgX2Rpc2FibGUpIHB1YmxpYzsNCiAgICBmdW5jdGlvbiBpc3N1ZShhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7DQogICAgZnVuY3Rpb24gZGVzdHJveShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsNCn0NCg0KLyoNCiAgICBERUJJVENvaW4gVG9rZW4gdjAuMg0KDQogICAgJ093bmVkJyBpcyBzcGVjaWZpZWQgaGVyZSBmb3IgcmVhZGFiaWxpdHkgcmVhc29ucw0KKi8NCmNvbnRyYWN0IERlYml0Q29pblRva2VuIGlzIElEZWJpdENvaW5Ub2tlbiwgRVJDMjBUb2tlbiwgT3duZWQsIFRva2VuSG9sZGVyIHsNCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnMC4yJzsNCg0KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQgPSB0cnVlOyAgICAvLyB0cnVlIGlmIHRyYW5zZmVyL3RyYW5zZmVyRnJvbSBhcmUgZW5hYmxlZCwgZmFsc2UgaWYgbm90DQogICAgdWludCBwdWJsaWMgTWluaW5nUmV3YXJkUGVyRVRIQmxvY2sgPSA1OyAgLy8gZGVmaW5lIGFtb3VudCBvZiByZWF3YXJkIGluIERFQklUQ29pbiwgZm9yIG1pbmVyIHRoYXQgZm91bmQgbGFzdCBibG9jayBpbiBFdGhlcmV1bSBCbG9ja0NoYWluDQogICAgdWludCBwdWJsaWMgbGFzdEJsb2NrUmV3YXJkZWQ7DQogICAgDQogICAgLy8gdHJpZ2dlcmVkIHdoZW4gYSBERUJJVENvaW4gdG9rZW4gaXMgZGVwbG95ZWQgLSB0aGUgX3Rva2VuIGFkZHJlc3MgaXMgZGVmaW5lZCBmb3IgZm9yd2FyZCBjb21wYXRpYmlsaXR5LCBpbiBjYXNlIHdlIHdhbnQgdG8gdHJpZ2dlciB0aGUgZXZlbnQgZnJvbSBhIGZhY3RvcnkNCiAgICBldmVudCBEZWJpdENvaW5Ub2tlbkdlbmVzaXMoYWRkcmVzcyBfdG9rZW4pOw0KICAgIC8vIHRyaWdnZXJlZCB3aGVuIHRoZSB0b3RhbCBzdXBwbHkgaXMgaW5jcmVhc2VkDQogICAgZXZlbnQgSXNzdWFuY2UodWludDI1NiBfYW1vdW50KTsNCiAgICAvLyB0cmlnZ2VyZWQgd2hlbiB0aGUgdG90YWwgc3VwcGx5IGlzIGRlY3JlYXNlZA0KICAgIGV2ZW50IERlc3RydWN0aW9uKHVpbnQyNTYgX2Ftb3VudCk7DQogICAgLy8gdHJpZ2dlcmVkIHdoZW4gdGhlIGFtb3VudCBvZiByZWF3YXJkIGZvciBtaW5pbmcgYXJlIGNoYW5nZXNkDQogICAgZXZlbnQgTWluaW5nUmV3YXJkQ2hhbmdlZCh1aW50MjU2IF9hbW91bnQpOw0KICAgIC8vIHRyaWdnZXJlZCB3aGVuIG1pbmVyIGdldCBhIHJld2FyZA0KICAgIGV2ZW50IE1pbmluZ1Jld2FyZFNlbnQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBjb25zdHJ1Y3Rvcg0KDQogICAgICAgIEBwYXJhbSBfbmFtZSAgICAgICB0b2tlbiBuYW1lDQogICAgICAgIEBwYXJhbSBfc3ltYm9sICAgICB0b2tlbiBzaG9ydCBzeW1ib2wsIDEtNiBjaGFyYWN0ZXJzDQogICAgICAgIEBwYXJhbSBfZGVjaW1hbHMgICBmb3IgZGlzcGxheSBwdXJwb3NlcyBvbmx5DQogICAgKi8NCiAgICBmdW5jdGlvbiBEZWJpdENvaW5Ub2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50OCBfZGVjaW1hbHMpDQogICAgICAgIEVSQzIwVG9rZW4oX25hbWUsIF9zeW1ib2wsIF9kZWNpbWFscykNCiAgICB7DQogICAgICAgIHJlcXVpcmUoYnl0ZXMoX3N5bWJvbCkubGVuZ3RoIDw9IDYpOyAvLyB2YWxpZGF0ZSBpbnB1dA0KICAgICAgICBEZWJpdENvaW5Ub2tlbkdlbmVzaXMoYWRkcmVzcyh0aGlzKSk7DQogICAgfQ0KDQogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBvbmx5IHdoZW4gdHJhbnNmZXJzIGFyZW4ndCBkaXNhYmxlZA0KICAgIG1vZGlmaWVyIHRyYW5zZmVyc0FsbG93ZWQgew0KICAgICAgICBhc3NlcnQodHJhbnNmZXJzRW5hYmxlZCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgZGlzYWJsZXMvZW5hYmxlcyB0cmFuc2ZlcnMNCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcg0KDQogICAgICAgIEBwYXJhbSBfZGlzYWJsZSAgICB0cnVlIHRvIGRpc2FibGUgdHJhbnNmZXJzLCBmYWxzZSB0byBlbmFibGUgdGhlbQ0KICAgICovDQogICAgZnVuY3Rpb24gZGlzYWJsZVRyYW5zZmVycyhib29sIF9kaXNhYmxlKSBwdWJsaWMgb3duZXJPbmx5IHsNCiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9ICFfZGlzYWJsZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBhbnlvbmUgd2hvIGZpbmRzIGEgYmxvY2sgb24gZXRoZXJldW0gd291bGQgYWxzbyBnZXQgYSByZXdhcmQgaW4gDQogICAgICAgIERFQklUQ29pbiwgZ2l2ZW4gdGhhdCBhbnlvbmUgY2FsbHMgdGhlIHJld2FyZCBmdW5jdGlvbiBvbiB0aGF0IGJsb2NrDQogICAgKi8NCiAgICBmdW5jdGlvbiBUcmFuc2Zlck1pbmVyc1Jld2FyZCgpIHsNCiAgICAgICAgcmVxdWlyZShsYXN0QmxvY2tSZXdhcmRlZCA8IGJsb2NrLm51bWJlcik7DQogICAgICAgIGxhc3RCbG9ja1Jld2FyZGVkID0gYmxvY2subnVtYmVyOw0KICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVBZGQodG90YWxTdXBwbHksIE1pbmluZ1Jld2FyZFBlckVUSEJsb2NrKTsNCiAgICAgICAgYmFsYW5jZU9mW2Jsb2NrLmNvaW5iYXNlXSA9IHNhZmVBZGQoYmFsYW5jZU9mW2Jsb2NrLmNvaW5iYXNlXSwgTWluaW5nUmV3YXJkUGVyRVRIQmxvY2spOw0KICAgICAgICBNaW5pbmdSZXdhcmRTZW50KHRoaXMsIGJsb2NrLmNvaW5iYXNlLCBNaW5pbmdSZXdhcmRQZXJFVEhCbG9jayk7DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAgICBAZGV2IGNoYW5nZSBtaW5lcnMgcmV3YXJkDQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXINCg0KICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICBhbW91bnQgdG8gaW5jcmVhc2UgdGhlIHN1cHBseSBieQ0KICAgICovDQogICAgZnVuY3Rpb24gQ2hhbmdlTWluaW5nUmV3YXJkKHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIG93bmVyT25seSB7DQogICAgICAgIE1pbmluZ1Jld2FyZFBlckVUSEJsb2NrID0gX2Ftb3VudDsNCiAgICAgICAgTWluaW5nUmV3YXJkQ2hhbmdlZChfYW1vdW50KTsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICAgIEBkZXYgaW5jcmVhc2VzIHRoZSB0b2tlbiBzdXBwbHkgYW5kIHNlbmRzIHRoZSBuZXcgdG9rZW5zIHRvIGFuIGFjY291bnQNCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcg0KDQogICAgICAgIEBwYXJhbSBfdG8gICAgICAgICBhY2NvdW50IHRvIHJlY2VpdmUgdGhlIG5ldyBhbW91bnQNCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgIGFtb3VudCB0byBpbmNyZWFzZSB0aGUgc3VwcGx5IGJ5DQogICAgKi8NCiAgICBmdW5jdGlvbiBpc3N1ZShhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgb3duZXJPbmx5DQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG8pDQogICAgICAgIG5vdFRoaXMoX3RvKQ0KICAgIHsNCiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBfYW1vdW50KTsNCiAgICAgICAgYmFsYW5jZU9mW190b10gPSBzYWZlQWRkKGJhbGFuY2VPZltfdG9dLCBfYW1vdW50KTsNCg0KICAgICAgICBJc3N1YW5jZShfYW1vdW50KTsNCiAgICAgICAgVHJhbnNmZXIodGhpcywgX3RvLCBfYW1vdW50KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiByZW1vdmVzIHRva2VucyBmcm9tIGFuIGFjY291bnQgYW5kIGRlY3JlYXNlcyB0aGUgdG9rZW4gc3VwcGx5DQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXINCg0KICAgICAgICBAcGFyYW0gX2Zyb20gICAgICAgYWNjb3VudCB0byByZW1vdmUgdGhlIGFtb3VudCBmcm9tDQogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICBhbW91bnQgdG8gZGVjcmVhc2UgdGhlIHN1cHBseSBieQ0KICAgICovDQogICAgZnVuY3Rpb24gZGVzdHJveShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnQpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBvd25lck9ubHkNCiAgICB7DQogICAgICAgIGJhbGFuY2VPZltfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VPZltfZnJvbV0sIF9hbW91bnQpOw0KICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVTdWIodG90YWxTdXBwbHksIF9hbW91bnQpOw0KDQogICAgICAgIFRyYW5zZmVyKF9mcm9tLCB0aGlzLCBfYW1vdW50KTsNCiAgICAgICAgRGVzdHJ1Y3Rpb24oX2Ftb3VudCk7DQogICAgfQ0KDQogICAgLy8gRVJDMjAgc3RhbmRhcmQgbWV0aG9kIG92ZXJyaWRlcyB3aXRoIHNvbWUgZXh0cmEgZnVuY3Rpb25hbGl0eQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgc2VuZCBjb2lucw0KICAgICAgICB0aHJvd3Mgb24gYW55IGVycm9yIHJhdGhlciB0aGVuIHJldHVybiBhIGZhbHNlIGZsYWcgdG8gbWluaW1pemUgdXNlciBlcnJvcnMNCiAgICAgICAgbm90ZSB0aGF0IHdoZW4gdHJhbnNmZXJyaW5nIHRvIHRoZSBzbWFydCB0b2tlbidzIGFkZHJlc3MsIHRoZSBjb2lucyBhcmUgYWN0dWFsbHkgZGVzdHJveWVkDQoNCiAgICAgICAgQHBhcmFtIF90byAgICAgIHRhcmdldCBhZGRyZXNzDQogICAgICAgIEBwYXJhbSBfdmFsdWUgICB0cmFuc2ZlciBhbW91bnQNCg0KICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBpZiBpdCB3YXNuJ3QNCiAgICAqLw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHRyYW5zZmVyc0FsbG93ZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGFzc2VydChzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSkpOw0KDQogICAgICAgIC8vIHRyYW5zZmVycmluZyB0byB0aGUgY29udHJhY3QgYWRkcmVzcyBkZXN0cm95cyB0b2tlbnMNCiAgICAgICAgaWYgKF90byA9PSBhZGRyZXNzKHRoaXMpKSB7DQogICAgICAgICAgICBiYWxhbmNlT2ZbX3RvXSAtPSBfdmFsdWU7DQogICAgICAgICAgICB0b3RhbFN1cHBseSAtPSBfdmFsdWU7DQogICAgICAgICAgICBEZXN0cnVjdGlvbihfdmFsdWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgYW4gYWNjb3VudC9jb250cmFjdCBhdHRlbXB0cyB0byBnZXQgdGhlIGNvaW5zDQogICAgICAgIHRocm93cyBvbiBhbnkgZXJyb3IgcmF0aGVyIHRoZW4gcmV0dXJuIGEgZmFsc2UgZmxhZyB0byBtaW5pbWl6ZSB1c2VyIGVycm9ycw0KICAgICAgICBub3RlIHRoYXQgd2hlbiB0cmFuc2ZlcnJpbmcgdG8gdGhlIHNtYXJ0IHRva2VuJ3MgYWRkcmVzcywgdGhlIGNvaW5zIGFyZSBhY3R1YWxseSBkZXN0cm95ZWQNCg0KICAgICAgICBAcGFyYW0gX2Zyb20gICAgc291cmNlIGFkZHJlc3MNCiAgICAgICAgQHBhcmFtIF90byAgICAgIHRhcmdldCBhZGRyZXNzDQogICAgICAgIEBwYXJhbSBfdmFsdWUgICB0cmFuc2ZlciBhbW91bnQNCg0KICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBpZiBpdCB3YXNuJ3QNCiAgICAqLw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB0cmFuc2ZlcnNBbGxvd2VkIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBhc3NlcnQoc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSkpOw0KDQogICAgICAgIC8vIHRyYW5zZmVycmluZyB0byB0aGUgY29udHJhY3QgYWRkcmVzcyBkZXN0cm95cyB0b2tlbnMNCiAgICAgICAgaWYgKF90byA9PSBhZGRyZXNzKHRoaXMpKSB7DQogICAgICAgICAgICBiYWxhbmNlT2ZbX3RvXSAtPSBfdmFsdWU7DQogICAgICAgICAgICB0b3RhbFN1cHBseSAtPSBfdmFsdWU7DQogICAgICAgICAgICBEZXN0cnVjdGlvbihfdmFsdWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KfQ0KDQovKioNCiAqIFVwZ3JhZGUgYWdlbnQgaW50ZXJmYWNlIGluc3BpcmVkIGJ5IEx1bnlyLg0KICoNCiAqIFVwZ3JhZGUgYWdlbnQgdHJhbnNmZXJzIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4NCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLg0KICovDQpjb250cmFjdCBVcGdyYWRlQWdlbnQgew0KDQogIHVpbnQgcHVibGljIG9yaWdpbmFsU3VwcGx5Ow0KDQogIC8qKiBJbnRlcmZhY2UgbWFya2VyICovDQogIGZ1bmN0aW9uIGlzVXBncmFkZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVwZ3JhZGVGcm9tKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWM7DQoNCn0NCg0KDQovKioNCiAqIEEgdG9rZW4gdXBncmFkZSBtZWNoYW5pc20gd2hlcmUgdXNlcnMgY2FuIG9wdC1pbiBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBuZXh0IHNtYXJ0IGNvbnRyYWN0IHJldmlzaW9uLg0KICoNCiAqIEZpcnN0IGVudmlzaW9uZWQgYnkgR29sZW0gYW5kIEx1bnlyIHByb2plY3RzLg0KICovDQpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIERlYml0Q29pblRva2VuIHsNCg0KICAvKiogQ29udHJhY3QgLyBwZXJzb24gd2hvIGNhbiBzZXQgdGhlIHVwZ3JhZGUgcGF0aC4gVGhpcyBjYW4gYmUgdGhlIHNhbWUgYXMgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIGFzIHdoYXQgaXQgaXMgd2l0aCBpdHMgZGVmYXVsdCB2YWx1ZS4gKi8NCiAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZU1hc3RlcjsNCg0KICAvKiogVGhlIG5leHQgY29udHJhY3Qgd2hlcmUgdGhlIHRva2VucyB3aWxsIGJlIG1pZ3JhdGVkLiAqLw0KICBVcGdyYWRlQWdlbnQgcHVibGljIHVwZ3JhZGVBZ2VudDsNCg0KICAvKiogSG93IG1hbnkgdG9rZW5zIHdlIGhhdmUgdXBncmFkZWQgYnkgbm93LiAqLw0KICB1aW50MjU2IHB1YmxpYyB0b3RhbFVwZ3JhZGVkOw0KDQogIC8qKg0KICAgKiBVcGdyYWRlIHN0YXRlcy4NCiAgICoNCiAgICogLSBOb3RBbGxvd2VkOiBUaGUgY2hpbGQgY29udHJhY3QgaGFzIG5vdCByZWFjaGVkIGEgY29uZGl0aW9uIHdoZXJlIHRoZSB1cGdyYWRlIGNhbiBiZ3VuDQogICAqIC0gV2FpdGluZ0ZvckFnZW50OiBUb2tlbiBhbGxvd3MgdXBncmFkZSwgYnV0IHdlIGRvbid0IGhhdmUgYSBuZXcgYWdlbnQgeWV0DQogICAqIC0gUmVhZHlUb1VwZ3JhZGU6IFRoZSBhZ2VudCBpcyBzZXQsIGJ1dCBub3QgYSBzaW5nbGUgdG9rZW4gaGFzIGJlZW4gdXBncmFkZWQgeWV0DQogICAqIC0gVXBncmFkaW5nOiBVcGdyYWRlIGFnZW50IGlzIHNldCBhbmQgdGhlIGJhbGFuY2UgaG9sZGVycyBjYW4gdXBncmFkZSB0aGVpciB0b2tlbnMNCiAgICoNCiAgICovDQogIGVudW0gVXBncmFkZVN0YXRlIHtVbmtub3duLCBOb3RBbGxvd2VkLCBXYWl0aW5nRm9yQWdlbnQsIFJlYWR5VG9VcGdyYWRlLCBVcGdyYWRpbmd9DQoNCiAgLyoqDQogICAqIFNvbWVib2R5IGhhcyB1cGdyYWRlZCBzb21lIG9mIGhpcyB0b2tlbnMuDQogICAqLw0KICBldmVudCBVcGdyYWRlKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KDQogIC8qKg0KICAgKiBOZXcgdXBncmFkZSBhZ2VudCBhdmFpbGFibGUuDQogICAqLw0KICBldmVudCBVcGdyYWRlQWdlbnRTZXQoYWRkcmVzcyBhZ2VudCk7DQoNCiAgLyoqDQogICAqIERvIG5vdCBhbGxvdyBjb25zdHJ1Y3Rpb24gd2l0aG91dCB1cGdyYWRlIG1hc3RlciBzZXQuDQogICAqLw0KICBmdW5jdGlvbiBVcGdyYWRlYWJsZVRva2VuKGFkZHJlc3MgX3VwZ3JhZGVNYXN0ZXIpIHsNCiAgICB1cGdyYWRlTWFzdGVyID0gX3VwZ3JhZGVNYXN0ZXI7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgdGhlIHRva2VuIGhvbGRlciB0byB1cGdyYWRlIHNvbWUgb2YgdGhlaXIgdG9rZW5zIHRvIGEgbmV3IGNvbnRyYWN0Lg0KICAgKi8NCiAgZnVuY3Rpb24gdXBncmFkZSh1aW50MjU2IHZhbHVlKSBwdWJsaWMgew0KDQogICAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsNCiAgICAgIHJlcXVpcmUoc3RhdGUgPT0gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlIHx8IHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOw0KICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuDQogICAgICByZXF1aXJlKHZhbHVlICE9IDApOw0KDQogICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VPZlttc2cuc2VuZGVyXSwgdmFsdWUpOw0KDQogICAgICAvLyBUYWtlIHRva2VucyBvdXQgZnJvbSBjaXJjdWxhdGlvbg0KICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCB2YWx1ZSk7DQogICAgICB0b3RhbFVwZ3JhZGVkID0gc2FmZUFkZCh0b3RhbFVwZ3JhZGVkLCB2YWx1ZSk7DQoNCiAgICAgIC8vIFVwZ3JhZGUgYWdlbnQgcmVpc3N1ZXMgdGhlIHRva2Vucw0KICAgICAgdXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsNCiAgICAgIFVwZ3JhZGUobXNnLnNlbmRlciwgdXBncmFkZUFnZW50LCB2YWx1ZSk7DQogIH0NCg0KICAvKioNCiAgICogU2V0IGFuIHVwZ3JhZGUgYWdlbnQgdGhhdCBoYW5kbGVzDQogICAqLw0KICBmdW5jdGlvbiBzZXRVcGdyYWRlQWdlbnQoYWRkcmVzcyBhZ2VudCkgZXh0ZXJuYWwgew0KDQogICAgICByZXF1aXJlKGNhblVwZ3JhZGUoKSk7DQoNCiAgICAgIHJlcXVpcmUoYWdlbnQgIT0gMHgwKTsNCiAgICAgIC8vIE9ubHkgYSBtYXN0ZXIgY2FuIGRlc2lnbmF0ZSB0aGUgbmV4dCBhZ2VudA0KICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHVwZ3JhZGVNYXN0ZXIpOw0KICAgICAgLy8gVXBncmFkZSBoYXMgYWxyZWFkeSBiZWd1biBmb3IgYW4gYWdlbnQNCiAgICAgIHJlcXVpcmUoZ2V0VXBncmFkZVN0YXRlKCkgIT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZyk7DQoNCiAgICAgIHVwZ3JhZGVBZ2VudCA9IFVwZ3JhZGVBZ2VudChhZ2VudCk7DQoNCiAgICAgIC8vIEJhZCBpbnRlcmZhY2UNCiAgICAgIHJlcXVpcmUodXBncmFkZUFnZW50LmlzVXBncmFkZUFnZW50KCkpOw0KICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdG9rZW4gc3VwcGxpZXMgbWF0Y2ggaW4gc291cmNlIGFuZCB0YXJnZXQNCiAgICAgIHJlcXVpcmUodXBncmFkZUFnZW50Lm9yaWdpbmFsU3VwcGx5KCkgPT0gdG90YWxTdXBwbHkpOw0KDQogICAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsNCiAgfQ0KDQogIC8qKg0KICAgKiBHZXQgdGhlIHN0YXRlIG9mIHRoZSB0b2tlbiB1cGdyYWRlLg0KICAgKi8NCiAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoVXBncmFkZVN0YXRlKSB7DQogICAgaWYoIWNhblVwZ3JhZGUoKSkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5Ob3RBbGxvd2VkOw0KICAgIGVsc2UgaWYoYWRkcmVzcyh1cGdyYWRlQWdlbnQpID09IDB4MDApIHJldHVybiBVcGdyYWRlU3RhdGUuV2FpdGluZ0ZvckFnZW50Ow0KICAgIGVsc2UgaWYodG90YWxVcGdyYWRlZCA9PSAwKSByZXR1cm4gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlOw0KICAgIGVsc2UgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmc7DQogIH0NCg0KICAvKioNCiAgICogQ2hhbmdlIHRoZSB1cGdyYWRlIG1hc3Rlci4NCiAgICoNCiAgICogVGhpcyBhbGxvd3MgdXMgdG8gc2V0IGEgbmV3IG93bmVyIGZvciB0aGUgdXBncmFkZSBtZWNoYW5pc20uDQogICAqLw0KICBmdW5jdGlvbiBzZXRVcGdyYWRlTWFzdGVyKGFkZHJlc3MgbWFzdGVyKSBwdWJsaWMgew0KICAgICAgcmVxdWlyZShtYXN0ZXIgIT0gMHgwKTsNCiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB1cGdyYWRlTWFzdGVyKTsNCiAgICAgIHVwZ3JhZGVNYXN0ZXIgPSBtYXN0ZXI7DQogIH0NCg0KICAvKioNCiAgICogQ2hpbGQgY29udHJhY3QgY2FuIGVuYWJsZSB0byBwcm92aWRlIHRoZSBjb25kaXRpb24gd2hlbiB0aGUgdXBncmFkZSBjYW4gYmVndW4uDQogICAqLw0KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQp9'