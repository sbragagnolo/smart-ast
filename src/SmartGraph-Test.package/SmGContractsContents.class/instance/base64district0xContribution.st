base 64 content
base64district0xContribution
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KDQpsaWJyYXJ5IFNhZmVNYXRoIHsNCiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMA0KICAgIHVpbnQgYyA9IGEgLyBiOw0KICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkDQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICBhc3NlcnQoYiA8PSBhKTsNCiAgICByZXR1cm4gYSAtIGI7DQogIH0NCg0KICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYyA+PSBhKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7DQogICAgaWYgKCFhc3NlcnRpb24pIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KfQ0KDQpjb250cmFjdCBPd25hYmxlIHsNCg0KICAgIC8vLyBAZGV2IGBvd25lcmAgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzDQogICAgLy8vIG1vZGlmaWVyDQogICAgbW9kaWZpZXIgb25seU93bmVyKCkgew0KICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KDQogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGFzc2lnbnMgdGhlIG1lc3NhZ2Ugc2VuZGVyIHRvIGJlIGBvd25lcmANCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgew0KICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogICAgfQ0KDQogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXI7DQoNCiAgICAvLy8gQG5vdGljZSBgb3duZXJgIGNhbiBzdGVwIGRvd24gYW5kIGFzc2lnbiBzb21lIG90aGVyIGFkZHJlc3MgdG8gdGhpcyByb2xlDQogICAgLy8vIEBwYXJhbSBfbmV3T3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBvd25lci4NCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsNCiAgICAgICAgbmV3T3duZXIgPSBfbmV3T3duZXI7DQogICAgfQ0KDQoNCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyID09IG5ld093bmVyKSB7DQogICAgICAgICAgICBvd25lciA9IG5ld093bmVyOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsNCiAgYm9vbCBwdWJsaWMgc3RvcHBlZDsNCiAgZXZlbnQgb25FbWVyZ2VuY3lDaGFuZ2VkKGJvb2wgaXNTdG9wcGVkKTsNCg0KICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgew0KICAgIGlmIChzdG9wcGVkKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogICAgXzsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7DQogICAgaWYgKCFzdG9wcGVkKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogICAgXzsNCiAgfQ0KDQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlDQogIGZ1bmN0aW9uIGVtZXJnZW5jeVN0b3AoKSBleHRlcm5hbCBvbmx5T3duZXIgew0KICAgIHN0b3BwZWQgPSB0cnVlOw0KICAgIG9uRW1lcmdlbmN5Q2hhbmdlZChzdG9wcGVkKTsNCiAgfQ0KDQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUNCiAgZnVuY3Rpb24gcmVsZWFzZSgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgew0KICAgIHN0b3BwZWQgPSBmYWxzZTsNCiAgICBvbkVtZXJnZW5jeUNoYW5nZWQoc3RvcHBlZCk7DQogIH0NCg0KfQ0KDQpjb250cmFjdCBFUkMyMEJhc2ljIHsNCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7DQogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOw0KfQ0KDQpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsNCg0KICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7DQoNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wpOw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7DQogIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSwgYnl0ZXMgZXh0cmFEYXRhKSByZXR1cm5zIChib29sKTsNCiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7DQoNCiAgZnVuY3Rpb24gZG9UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpOw0KfQ0KDQpjb250cmFjdCBHcmFudHNDb250cm9sbGVkIHsNCiAgICBtb2RpZmllciBvbmx5R3JhbnRzQ29udHJvbGxlciB7IGlmIChtc2cuc2VuZGVyICE9IGdyYW50c0NvbnRyb2xsZXIpIHRocm93OyBfOyB9DQoNCiAgICBhZGRyZXNzIHB1YmxpYyBncmFudHNDb250cm9sbGVyOw0KDQogICAgZnVuY3Rpb24gR3JhbnRzQ29udHJvbGxlZCgpIHsgZ3JhbnRzQ29udHJvbGxlciA9IG1zZy5zZW5kZXI7fQ0KDQogICAgZnVuY3Rpb24gY2hhbmdlR3JhbnRzQ29udHJvbGxlcihhZGRyZXNzIF9uZXdDb250cm9sbGVyKSBvbmx5R3JhbnRzQ29udHJvbGxlciB7DQogICAgICAgIGdyYW50c0NvbnRyb2xsZXIgPSBfbmV3Q29udHJvbGxlcjsNCiAgICB9DQp9DQoNCmNvbnRyYWN0IExpbWl0ZWRUcmFuc2ZlclRva2VuIGlzIEVSQzIwIHsNCiAgLy8gQ2hlY2tzIHdoZXRoZXIgaXQgY2FuIHRyYW5zZmVyIG9yIG90aGVyd2lzZSB0aHJvd3MuDQogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludCBfdmFsdWUpIHsNCiAgIGlmIChfdmFsdWUgPiB0cmFuc2ZlcmFibGVUb2tlbnMoX3NlbmRlciwgdWludDY0KG5vdykpKSB0aHJvdzsNCiAgIF87DQogIH0NCg0KICAvLyBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7DQogICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgLy8gQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLg0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7DQogICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogIH0NCg0KICAvLyBEZWZhdWx0IHRyYW5zZmVyYWJsZSB0b2tlbnMgZnVuY3Rpb24gcmV0dXJucyBhbGwgdG9rZW5zIGZvciBhIGhvbGRlciAobm8gbGltaXQpLg0KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBiYWxhbmNlT2YoaG9sZGVyKTsNCiAgfQ0KfQ0KDQpjb250cmFjdCBDb250cm9sbGVkIHsNCiAgICAvLy8gQG5vdGljZSBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJvbGxlciBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwNCiAgICAvLy8gIGEgZnVuY3Rpb24gd2l0aCB0aGlzIG1vZGlmaWVyDQogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB0aHJvdzsgXzsgfQ0KDQogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsNCg0KICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30NCg0KICAgIC8vLyBAbm90aWNlIENoYW5nZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0DQogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIF9uZXdDb250cm9sbGVyKSBvbmx5Q29udHJvbGxlciB7DQogICAgICAgIGNvbnRyb2xsZXIgPSBfbmV3Q29udHJvbGxlcjsNCiAgICB9DQp9DQoNCmNvbnRyYWN0IE1pbmlNZVRva2VuIGlzIEVSQzIwLCBDb250cm9sbGVkIHsNCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsNCg0KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgLy9UaGUgVG9rZW4ncyBuYW1lOiBlLmcuIERpZ2l4REFPIFRva2Vucw0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgICAgICAgICAgICAgLy9OdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQNCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZS5nLiBSRVANCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnTU1UXzAuMSc7IC8vQW4gYXJiaXRyYXJ5IHZlcnNpb25pbmcgc2NoZW1lDQoNCg0KICAgIC8vLyBAZGV2IGBDaGVja3BvaW50YCBpcyB0aGUgc3RydWN0dXJlIHRoYXQgYXR0YWNoZXMgYSBibG9jayBudW1iZXIgdG8gYQ0KICAgIC8vLyAgZ2l2ZW4gdmFsdWUsIHRoZSBibG9jayBudW1iZXIgYXR0YWNoZWQgaXMgdGhlIG9uZSB0aGF0IGxhc3QgY2hhbmdlZCB0aGUNCiAgICAvLy8gIHZhbHVlDQogICAgc3RydWN0ICBDaGVja3BvaW50IHsNCg0KICAgICAgICAvLyBgZnJvbUJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIHZhbHVlIHdhcyBnZW5lcmF0ZWQgZnJvbQ0KICAgICAgICB1aW50MTI4IGZyb21CbG9jazsNCg0KICAgICAgICAvLyBgdmFsdWVgIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYmxvY2sgbnVtYmVyDQogICAgICAgIHVpbnQxMjggdmFsdWU7DQogICAgfQ0KDQogICAgLy8gYHBhcmVudFRva2VuYCBpcyB0aGUgVG9rZW4gYWRkcmVzcyB0aGF0IHdhcyBjbG9uZWQgdG8gcHJvZHVjZSB0aGlzIHRva2VuOw0KICAgIC8vICBpdCB3aWxsIGJlIDB4MCBmb3IgYSB0b2tlbiB0aGF0IHdhcyBub3QgY2xvbmVkDQogICAgTWluaU1lVG9rZW4gcHVibGljIHBhcmVudFRva2VuOw0KDQogICAgLy8gYHBhcmVudFNuYXBTaG90QmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgZnJvbSB0aGUgUGFyZW50IFRva2VuIHRoYXQgd2FzDQogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgQ2xvbmUgVG9rZW4NCiAgICB1aW50IHB1YmxpYyBwYXJlbnRTbmFwU2hvdEJsb2NrOw0KDQogICAgLy8gYGNyZWF0aW9uQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgQ2xvbmUgVG9rZW4gd2FzIGNyZWF0ZWQNCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkJsb2NrOw0KDQogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcw0KICAgIC8vICBjb250cmFjdCB3aGVuIHRoZSBiYWxhbmNlIGNoYW5nZXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBjaGFuZ2UNCiAgICAvLyAgb2NjdXJyZWQgaXMgYWxzbyBpbmNsdWRlZCBpbiB0aGUgbWFwDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDaGVja3BvaW50W10pIGJhbGFuY2VzOw0KDQogICAgLy8gYGFsbG93ZWRgIHRyYWNrcyBhbnkgZXh0cmEgdHJhbnNmZXIgcmlnaHRzIGFzIGluIGFsbCBFUkMyMCB0b2tlbnMNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7DQoNCiAgICAvLyBUcmFja3MgdGhlIGhpc3Rvcnkgb2YgdGhlIGB0b3RhbFN1cHBseWAgb2YgdGhlIHRva2VuDQogICAgQ2hlY2twb2ludFtdIHRvdGFsU3VwcGx5SGlzdG9yeTsNCg0KICAgIC8vIEZsYWcgdGhhdCBkZXRlcm1pbmVzIGlmIHRoZSB0b2tlbiBpcyB0cmFuc2ZlcmFibGUgb3Igbm90Lg0KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQ7DQoNCiAgICAvLyBUaGUgZmFjdG9yeSB1c2VkIHRvIGNyZWF0ZSBuZXcgY2xvbmUgdG9rZW5zDQogICAgTWluaU1lVG9rZW5GYWN0b3J5IHB1YmxpYyB0b2tlbkZhY3Rvcnk7DQoNCi8vLy8vLy8vLy8vLy8vLy8NCi8vIENvbnN0cnVjdG9yDQovLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbg0KICAgIC8vLyBAcGFyYW0gX3Rva2VuRmFjdG9yeSBUaGUgYWRkcmVzcyBvZiB0aGUgTWluaU1lVG9rZW5GYWN0b3J5IGNvbnRyYWN0IHRoYXQNCiAgICAvLy8gIHdpbGwgY3JlYXRlIHRoZSBDbG9uZSB0b2tlbiBjb250cmFjdHMsIHRoZSB0b2tlbiBmYWN0b3J5IG5lZWRzIHRvIGJlDQogICAgLy8vICBkZXBsb3llZCBmaXJzdA0KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHBhcmVudCB0b2tlbiwgc2V0IHRvIDB4MCBpZiBpdCBpcyBhDQogICAgLy8vICBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRTbmFwU2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsDQogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbiwgc2V0IHRvIDAgaWYgaXQNCiAgICAvLy8gIGlzIGEgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZA0KICAgIGZ1bmN0aW9uIE1pbmlNZVRva2VuKA0KICAgICAgICBhZGRyZXNzIF90b2tlbkZhY3RvcnksDQogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLA0KICAgICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLA0KICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwNCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywNCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwNCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZA0KICAgICkgew0KICAgICAgICB0b2tlbkZhY3RvcnkgPSBNaW5pTWVUb2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7DQogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZQ0KICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGRlY2ltYWxzDQogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sDQogICAgICAgIHBhcmVudFRva2VuID0gTWluaU1lVG9rZW4oX3BhcmVudFRva2VuKTsNCiAgICAgICAgcGFyZW50U25hcFNob3RCbG9jayA9IF9wYXJlbnRTbmFwU2hvdEJsb2NrOw0KICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7DQogICAgICAgIGNyZWF0aW9uQmxvY2sgPSBibG9jay5udW1iZXI7DQogICAgfQ0KDQoNCi8vLy8vLy8vLy8vLy8vLy8vLy8NCi8vIEVSQzIwIE1ldGhvZHMNCi8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsNCiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQNCiAgICAvLy8gIGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWANCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50DQogICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCg0KICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwNCiAgICAgICAgLy8gIHRoaXMgaXMgaW1wb3J0YW50IHRvIHJlY29nbml6ZSEgQ29uZmlybSB0aGF0IHlvdSB0cnVzdCB0aGUNCiAgICAgICAgLy8gIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCwgd2hpY2ggaW4gbW9zdCBzaXR1YXRpb25zIHNob3VsZCBiZQ0KICAgICAgICAvLyAgYW5vdGhlciBvcGVuIHNvdXJjZSBzbWFydCBjb250cmFjdCBvciAweDANCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgew0KICAgICAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsNCg0KICAgICAgICAgICAgLy8gVGhlIHN0YW5kYXJkIEVSQyAyMCB0cmFuc2ZlckZyb20gZnVuY3Rpb25hbGl0eQ0KICAgICAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX2Ftb3VudCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX2Ftb3VudCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgVGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGluIHRoZSB0b2tlbiBjb250cmFjdCwgaXQgY2FuDQogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4NCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudA0KICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7DQoNCiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgew0KICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgIH0NCg0KICAgICAgICAgICBpZiAocGFyZW50U25hcFNob3RCbG9jayA+PSBibG9jay5udW1iZXIpIHRocm93Ow0KDQogICAgICAgICAgIC8vIERvIG5vdCBhbGxvdyB0cmFuc2ZlciB0byAweDAgb3IgdGhlIHRva2VuIGNvbnRyYWN0IGl0c2VsZg0KICAgICAgICAgICBpZiAoKF90byA9PSAwKSB8fCAoX3RvID09IGFkZHJlc3ModGhpcykpKSB0aHJvdzsNCg0KICAgICAgICAgICAvLyBJZiB0aGUgYW1vdW50IGJlaW5nIHRyYW5zZmVyZWQgaXMgbW9yZSB0aGFuIHRoZSBiYWxhbmNlIG9mIHRoZQ0KICAgICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV0dXJucyBmYWxzZQ0KICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZkF0KF9mcm9tLCBibG9jay5udW1iZXIpOw0KICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHsNCiAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgfQ0KDQogICAgICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgdHJhbnNmZXINCiAgICAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsNCiAgICAgICAgICAgICAgIGlmICghVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCkpDQogICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgfQ0KDQogICAgICAgICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzDQogICAgICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMNCiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfZnJvbV0sIHByZXZpb3VzQmFsYW5jZUZyb20uc3ViKF9hbW91bnQpKTsNCg0KICAgICAgICAgICAvLyBUaGVuIHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzDQogICAgICAgICAgIC8vICByZWNlaXZpbmcgdGhlIHRva2Vucw0KICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGJsb2NrLm51bWJlcik7DQogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX3RvXSwgcHJldmlvdXNCYWxhbmNlVG8uYWRkKF9hbW91bnQpKTsNCg0KICAgICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0cmFuc2ZlciBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4NCiAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7DQoNCiAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCdzIGJhbGFuY2UgaXMgYmVpbmcgcmVxdWVzdGVkDQogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgdGhlIGN1cnJlbnQgYmxvY2sNCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgew0KICAgICAgICByZXR1cm4gYmFsYW5jZU9mQXQoX293bmVyLCBibG9jay5udW1iZXIpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24NCiAgICAvLy8gIGl0cyBiZWhhbGYuIFRoaXMgaXMgYSBtb2RpZmllZCB2ZXJzaW9uIG9mIHRoZSBFUkMyMCBhcHByb3ZlIGZ1bmN0aW9uDQogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXINCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXINCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsNCg0KICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYA0KICAgICAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwwKWAgaWYgaXQgaXMgbm90DQogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOg0KICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkNCiAgICAgICAgaWYgKChfYW1vdW50IT0wKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0wKSkgdGhyb3c7DQoNCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwNCiAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsNCiAgICAgICAgICAgIGlmICghVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uQXBwcm92ZShtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCkpDQogICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7DQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcA0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2Vucw0KICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQNCiAgICAvLy8gIHRvIHNwZW5kDQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyDQogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgew0KICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24NCiAgICAvLy8gIGl0cyBiZWhhbGYsIGFuZCB0aGVuIGEgZnVuY3Rpb24gaXMgdHJpZ2dlcmVkIGluIHRoZSBjb250cmFjdCB0aGF0IGlzDQogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bw0KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28NCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMgX2V4dHJhRGF0YQ0KICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmICghYXBwcm92ZShfc3BlbmRlciwgX2Ftb3VudCkpIHRocm93Ow0KDQogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgNCiAgICAgICAgICAgIG1zZy5zZW5kZXIsDQogICAgICAgICAgICBfYW1vdW50LA0KICAgICAgICAgICAgdGhpcywNCiAgICAgICAgICAgIF9leHRyYURhdGENCiAgICAgICAgKTsNCg0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zDQogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMNCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QXQoYmxvY2subnVtYmVyKTsNCiAgICB9DQoNCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gUXVlcnkgYmFsYW5jZSBhbmQgdG90YWxTdXBwbHkgaW4gSGlzdG9yeQ0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZA0KICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgYmFsYW5jZSBpcyBxdWVyaWVkDQogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmANCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdChhZGRyZXNzIF9vd25lciwgdWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50DQogICAgICAgIHJldHVybnMgKHVpbnQpIHsNCg0KICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSBiYWxhbmNlIG9mIHRoZSB0b2tlbiBpcw0KICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0DQogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4uYmFsYW5jZU9mQXRgIGJlIHF1ZXJpZWQgYXQgdGhlDQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGF0IHRva2VuIGFzIHRoaXMgY29udGFpbnMgaW5pdGlhbCBiYWxhbmNlIG9mDQogICAgICAgIC8vICB0aGlzIHRva2VuDQogICAgICAgIGlmICgoYmFsYW5jZXNbX293bmVyXS5sZW5ndGggPT0gMCkNCiAgICAgICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsNCiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLmJhbGFuY2VPZkF0KF9vd25lciwgbWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBIYXMgbm8gcGFyZW50DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgYmFsYW5jZSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KGJhbGFuY2VzW19vd25lcl0sIF9ibG9ja051bWJlcik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAuDQogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkDQogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYF9ibG9ja051bWJlcmANCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseUF0KHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsNCg0KICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSB0b3RhbFN1cHBseSBvZiB0aGUgdG9rZW4gaXMNCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdA0KICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXRgIGJlIHF1ZXJpZWQgYXQgdGhlDQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGlzIHRva2VuIGFzIHRoYXQgY29udGFpbnMgdG90YWxTdXBwbHkgb2YgdGhpcw0KICAgICAgICAvLyAgdG9rZW4gYXQgdGhpcyBibG9jayBudW1iZXIuDQogICAgICAgIGlmICgodG90YWxTdXBwbHlIaXN0b3J5Lmxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgfHwgKHRvdGFsU3VwcGx5SGlzdG9yeVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7DQogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0KG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgdG90YWxTdXBwbHkgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIF9ibG9ja051bWJlcik7DQogICAgICAgIH0NCiAgICB9DQoNCi8vLy8vLy8vLy8vLy8vLy8NCi8vIENsb25lIFRva2VuIE1ldGhvZA0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIG5ldyBjbG9uZSB0b2tlbiB3aXRoIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBiZWluZw0KICAgIC8vLyAgdGhpcyB0b2tlbiBhdCBgX3NuYXBzaG90QmxvY2tgDQogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlbk5hbWUgTmFtZSBvZiB0aGUgY2xvbmUgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9jbG9uZURlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQNCiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuU3ltYm9sIFN5bWJvbCBvZiB0aGUgY2xvbmUgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIHdoZW4gdGhlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgcGFyZW50IHRva2VuIGlzDQogICAgLy8vICBjb3BpZWQgdG8gc2V0IHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgbmV3IGNsb25lIHRva2VuOw0KICAgIC8vLyAgaWYgdGhlIGJsb2NrIGlzIHplcm8gdGhhbiB0aGUgYWN0dWFsIGJsb2NrLCB0aGUgY3VycmVudCBibG9jayBpcyB1c2VkDQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUNCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IE1pbmlNZVRva2VuIENvbnRyYWN0DQogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigNCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuTmFtZSwNCiAgICAgICAgdWludDggX2Nsb25lRGVjaW1hbFVuaXRzLA0KICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsDQogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssDQogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQNCiAgICAgICAgKSByZXR1cm5zKGFkZHJlc3MpIHsNCiAgICAgICAgaWYgKF9zbmFwc2hvdEJsb2NrID09IDApIF9zbmFwc2hvdEJsb2NrID0gYmxvY2subnVtYmVyOw0KICAgICAgICBNaW5pTWVUb2tlbiBjbG9uZVRva2VuID0gdG9rZW5GYWN0b3J5LmNyZWF0ZUNsb25lVG9rZW4oDQogICAgICAgICAgICB0aGlzLA0KICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssDQogICAgICAgICAgICBfY2xvbmVUb2tlbk5hbWUsDQogICAgICAgICAgICBfY2xvbmVEZWNpbWFsVW5pdHMsDQogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwNCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkDQogICAgICAgICAgICApOw0KDQogICAgICAgIGNsb25lVG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsNCg0KICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4NCiAgICAgICAgTmV3Q2xvbmVUb2tlbihhZGRyZXNzKGNsb25lVG9rZW4pLCBfc25hcHNob3RCbG9jayk7DQogICAgICAgIHJldHVybiBhZGRyZXNzKGNsb25lVG9rZW4pOw0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zDQovLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYA0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBiZSBhc3NpZ25lZCB0aGUgbmV3IHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIGdlbmVyYXRlZA0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQ0KICAgIGZ1bmN0aW9uIGdlbmVyYXRlVG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQNCiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBibG9jay5udW1iZXIpOw0KICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkuYWRkKF9hbW91bnQpKTsNCiAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mKF9vd25lcik7DQogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8uYWRkKF9hbW91bnQpKTsNCiAgICAgICAgVHJhbnNmZXIoMCwgX293bmVyLCBfYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQoNCiAgICAvLy8gQG5vdGljZSBCdXJucyBgX2Ftb3VudGAgdG9rZW5zIGZyb20gYF9vd25lcmANCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbG9zZSB0aGUgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gYnVybg0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgYnVybmVkIGNvcnJlY3RseQ0KICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudA0KICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGJsb2NrLm51bWJlcik7DQogICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSA8IF9hbW91bnQpIHRocm93Ow0KICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkuc3ViKF9hbW91bnQpKTsNCiAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsNCiAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB0aHJvdzsNCiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VGcm9tLnN1YihfYW1vdW50KSk7DQogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMNCi8vLy8vLy8vLy8vLy8vLy8NCg0KDQogICAgLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQ0KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lDQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIG9ubHlDb250cm9sbGVyIHsNCiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOw0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gSW50ZXJuYWwgaGVscGVyIGZ1bmN0aW9ucyB0byBxdWVyeSBhbmQgc2V0IGEgdmFsdWUgaW4gYSBzbmFwc2hvdCBhcnJheQ0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBkZXYgYGdldFZhbHVlQXRgIHJldHJpZXZlcyB0aGUgbnVtYmVyIG9mIHRva2VucyBhdCBhIGdpdmVuIGJsb2NrIG51bWJlcg0KICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQNCiAgICAvLy8gQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgbnVtYmVyIHRvIHJldHJpZXZlIHRoZSB2YWx1ZSBhdA0KICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdG9rZW5zIGJlaW5nIHF1ZXJpZWQNCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jaw0KICAgICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICBpZiAoY2hlY2twb2ludHMubGVuZ3RoID09IDApIHJldHVybiAwOw0KDQogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlDQogICAgICAgIGlmIChfYmxvY2sgPj0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLmZyb21CbG9jaykNCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7DQogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOw0KDQogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQ0KICAgICAgICB1aW50IG1pbiA9IDA7DQogICAgICAgIHVpbnQgbWF4ID0gY2hlY2twb2ludHMubGVuZ3RoLTE7DQogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsNCiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOw0KICAgICAgICAgICAgaWYgKGNoZWNrcG9pbnRzW21pZF0uZnJvbUJsb2NrPD1fYmxvY2spIHsNCiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG1heCA9IG1pZC0xOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjaGVja3BvaW50c1ttaW5dLnZhbHVlOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IGB1cGRhdGVWYWx1ZUF0Tm93YCB1c2VkIHRvIHVwZGF0ZSB0aGUgYGJhbGFuY2VzYCBtYXAgYW5kIHRoZQ0KICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWANCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIGRhdGEgYmVpbmcgdXBkYXRlZA0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBuZXcgbnVtYmVyIG9mIHRva2Vucw0KICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlDQogICAgKSBpbnRlcm5hbCAgew0KICAgICAgICBpZiAoKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKQ0KICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7DQogICAgICAgICAgICAgICBDaGVja3BvaW50IG5ld0NoZWNrUG9pbnQgPSBjaGVja3BvaW50c1sgY2hlY2twb2ludHMubGVuZ3RoKysgXTsNCiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsNCiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7DQogICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICBDaGVja3BvaW50IG9sZENoZWNrUG9pbnQgPSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV07DQogICAgICAgICAgICAgICBvbGRDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOw0KICAgICAgICAgICB9DQogICAgfQ0KDQogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZA0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsNCiAgICAgICAgdWludCBzaXplOw0KICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzaXplPjA7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cw0KICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuDQogICAgLy8vICBzZXQgdG8gMCwgdGhlbiB0aGUgYHByb3h5UGF5bWVudGAgbWV0aG9kIGlzIGNhbGxlZCB3aGljaCByZWxheXMgdGhlDQogICAgLy8vICBldGhlciBhbmQgY3JlYXRlcyB0b2tlbnMgYXMgZGVzY3JpYmVkIGluIHRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gKCkgIHBheWFibGUgew0KICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgew0KICAgICAgICAgICAgaWYgKCEgVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKQ0KICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vDQogICAgLy8gU2FmZXR5IE1ldGhvZHMNCiAgICAvLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkNCiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuDQogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3Zlcg0KICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLg0KICAgIC8vLyBAcGFyYW0gX2NsYWltZXIgQWRkcmVzcyB0aGF0IHRva2VucyB3aWxsIGJlIHNlbmQgdG8NCiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfY2xhaW1lcikgb25seUNvbnRyb2xsZXIgew0KICAgICAgICBpZiAoX3Rva2VuID09IDB4MCkgew0KICAgICAgICAgICAgX2NsYWltZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIEVSQzIwQmFzaWMgdG9rZW4gPSBFUkMyMEJhc2ljKF90b2tlbik7DQogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsNCiAgICAgICAgdG9rZW4udHJhbnNmZXIoX2NsYWltZXIsIGJhbGFuY2UpOw0KICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgX2NsYWltZXIsIGJhbGFuY2UpOw0KICAgIH0NCg0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBFdmVudHMNCi8vLy8vLy8vLy8vLy8vLy8NCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY2xhaW1lciwgdWludCBfYW1vdW50KTsNCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX2Ftb3VudCk7DQogICAgZXZlbnQgTmV3Q2xvbmVUb2tlbihhZGRyZXNzIGluZGV4ZWQgX2Nsb25lVG9rZW4sIHVpbnQgX3NuYXBzaG90QmxvY2spOw0KICAgIGV2ZW50IEFwcHJvdmFsKA0KICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX293bmVyLA0KICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsDQogICAgICAgIHVpbnQyNTYgX2Ftb3VudA0KICAgICAgICApOw0KDQp9DQoNCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gTWluaU1lVG9rZW5GYWN0b3J5DQovLy8vLy8vLy8vLy8vLy8vDQoNCi8vLyBAZGV2IFRoaXMgY29udHJhY3QgaXMgdXNlZCB0byBnZW5lcmF0ZSBjbG9uZSBjb250cmFjdHMgZnJvbSBhIGNvbnRyYWN0Lg0KLy8vICBJbiBzb2xpZGl0eSB0aGlzIGlzIHRoZSB3YXkgdG8gY3JlYXRlIGEgY29udHJhY3QgZnJvbSBhIGNvbnRyYWN0IG9mIHRoZQ0KLy8vICBzYW1lIGNsYXNzDQpjb250cmFjdCBNaW5pTWVUb2tlbkZhY3Rvcnkgew0KDQogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcw0KICAgIC8vLyAgdGhlIG1zZy5zZW5kZXIgYmVjb21lcyB0aGUgY29udHJvbGxlciBvZiB0aGlzIGNsb25lIHRva2VuDQogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgdG9rZW4gYmVpbmcgY2xvbmVkDQogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbA0KICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBJZiB0cnVlLCB0b2tlbnMgd2lsbCBiZSBhYmxlIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdA0KICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oDQogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLA0KICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLA0KICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwNCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywNCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwNCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZA0KICAgICkgcmV0dXJucyAoTWluaU1lVG9rZW4pIHsNCiAgICAgICAgTWluaU1lVG9rZW4gbmV3VG9rZW4gPSBuZXcgTWluaU1lVG9rZW4oDQogICAgICAgICAgICB0aGlzLA0KICAgICAgICAgICAgX3BhcmVudFRva2VuLA0KICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssDQogICAgICAgICAgICBfdG9rZW5OYW1lLA0KICAgICAgICAgICAgX2RlY2ltYWxVbml0cywNCiAgICAgICAgICAgIF90b2tlblN5bWJvbCwNCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkDQogICAgICAgICAgICApOw0KDQogICAgICAgIG5ld1Rva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7DQogICAgICAgIHJldHVybiBuZXdUb2tlbjsNCiAgICB9DQp9DQoNCmNvbnRyYWN0IFZlc3RlZFRva2VuIGlzIExpbWl0ZWRUcmFuc2ZlclRva2VuLCBHcmFudHNDb250cm9sbGVkIHsNCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7DQoNCiAgdWludDI1NiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTID0gMjA7DQoNCiAgc3RydWN0IFRva2VuR3JhbnQgew0KICAgIGFkZHJlc3MgZ3JhbnRlcjsgICAgIC8vIDIwIGJ5dGVzDQogICAgdWludDI1NiB2YWx1ZTsgICAgICAgLy8gMzIgYnl0ZXMNCiAgICB1aW50NjQgY2xpZmY7DQogICAgdWludDY0IHZlc3Rpbmc7DQogICAgdWludDY0IHN0YXJ0OyAgICAgICAgLy8gMyAqIDggPSAyNCBieXRlcw0KICAgIGJvb2wgcmV2b2thYmxlOw0KICAgIGJvb2wgYnVybnNPblJldm9rZTsgIC8vIDIgKiAxID0gMiBiaXRzPyBvciAyIGJ5dGVzPw0KICB9IC8vIHRvdGFsIDc4IGJ5dGVzID0gMyBzc3RvcmUgcGVyIG9wZXJhdGlvbiAoMzIgcGVyIHNzdG9yZSkNCg0KICBtYXBwaW5nIChhZGRyZXNzID0+IFRva2VuR3JhbnRbXSkgcHVibGljIGdyYW50czsNCg0KICBldmVudCBOZXdUb2tlbkdyYW50KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgZ3JhbnRJZCk7DQoNCiAgLyoqDQogICAqIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MNCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHRoZSB0b2tlbnMgd2lsbCBiZSBncmFudGVkIHRvLg0KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4NCiAgICogQHBhcmFtIF9zdGFydCB1aW50NjQgVGltZSBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudC4NCiAgICogQHBhcmFtIF9jbGlmZiB1aW50NjQgVGltZSBvZiB0aGUgY2xpZmYgcGVyaW9kLg0KICAgKiBAcGFyYW0gX3Zlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4NCiAgICovDQogIGZ1bmN0aW9uIGdyYW50VmVzdGVkVG9rZW5zKA0KICAgIGFkZHJlc3MgX3RvLA0KICAgIHVpbnQyNTYgX3ZhbHVlLA0KICAgIHVpbnQ2NCBfc3RhcnQsDQogICAgdWludDY0IF9jbGlmZiwNCiAgICB1aW50NjQgX3Zlc3RpbmcsDQogICAgYm9vbCBfcmV2b2thYmxlLA0KICAgIGJvb2wgX2J1cm5zT25SZXZva2UNCiAgKSBvbmx5R3JhbnRzQ29udHJvbGxlciBwdWJsaWMgew0KDQogICAgLy8gQ2hlY2sgZm9yIGRhdGUgaW5jb25zaXN0ZW5jaWVzIHRoYXQgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgYmVoYXZpb3INCiAgICBpZiAoX2NsaWZmIDwgX3N0YXJ0IHx8IF92ZXN0aW5nIDwgX2NsaWZmKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZiAodG9rZW5HcmFudHNDb3VudChfdG8pID4gTUFYX0dSQU5UU19QRVJfQUREUkVTUykgdGhyb3c7ICAgLy8gVG8gcHJldmVudCBhIHVzZXIgYmVpbmcgc3BhbW1lZCBhbmQgaGF2ZSBoaXMgYmFsYW5jZSBsb2NrZWQgKG91dCBvZiBnYXMgYXR0YWNrIHdoZW4gY2FsY3VsYXRpbmcgdmVzdGluZykuDQoNCiAgICB1aW50IGNvdW50ID0gZ3JhbnRzW190b10ucHVzaCgNCiAgICAgICAgICAgICAgICBUb2tlbkdyYW50KA0KICAgICAgICAgICAgICAgICAgX3Jldm9rYWJsZSA/IG1zZy5zZW5kZXIgOiAwLCAvLyBhdm9pZCBzdG9yaW5nIGFuIGV4dHJhIDIwIGJ5dGVzIHdoZW4gaXQgaXMgbm9uLXJldm9rYWJsZQ0KICAgICAgICAgICAgICAgICAgX3ZhbHVlLA0KICAgICAgICAgICAgICAgICAgX2NsaWZmLA0KICAgICAgICAgICAgICAgICAgX3Zlc3RpbmcsDQogICAgICAgICAgICAgICAgICBfc3RhcnQsDQogICAgICAgICAgICAgICAgICBfcmV2b2thYmxlLA0KICAgICAgICAgICAgICAgICAgX2J1cm5zT25SZXZva2UNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICk7DQoNCiAgICB0cmFuc2ZlcihfdG8sIF92YWx1ZSk7DQoNCiAgICBOZXdUb2tlbkdyYW50KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBjb3VudCAtIDEpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZlZCBhZGRyZXNzLg0KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIGhhdmUgaXRzIHRva2VucyByZXZva2VkLg0KICAgKiBAcGFyYW0gX2dyYW50SWQgVGhlIGlkIG9mIHRoZSB0b2tlbiBncmFudC4NCiAgICovDQogIGZ1bmN0aW9uIHJldm9rZVRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50IF9ncmFudElkKSBwdWJsaWMgew0KICAgIFRva2VuR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOw0KDQogICAgaWYgKCFncmFudC5yZXZva2FibGUpIHsgLy8gQ2hlY2sgaWYgZ3JhbnQgd2FzIHJldm9rYWJsZQ0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYgKGdyYW50LmdyYW50ZXIgIT0gbXNnLnNlbmRlcikgeyAvLyBPbmx5IGdyYW50ZXIgY2FuIHJldm9rZSBpdA0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgYWRkcmVzcyByZWNlaXZlciA9IGdyYW50LmJ1cm5zT25SZXZva2UgPyAweGRlYWQgOiBtc2cuc2VuZGVyOw0KDQogICAgdWludDI1NiBub25WZXN0ZWQgPSBub25WZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsNCg0KICAgIC8vIHJlbW92ZSBncmFudCBmcm9tIGFycmF5DQogICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07DQogICAgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXSA9IGdyYW50c1tfaG9sZGVyXVtncmFudHNbX2hvbGRlcl0ubGVuZ3RoLnN1YigxKV07DQogICAgZ3JhbnRzW19ob2xkZXJdLmxlbmd0aCAtPSAxOw0KDQogICAgLy8gVGhpcyB3aWxsIGNhbGwgTWluaU1lJ3MgZG9UcmFuc2ZlciBtZXRob2QsIHNvIHRva2VuIGlzIHRyYW5zZmVycmVkIGFjY29yZGluZyB0bw0KICAgIC8vIE1pbmlNZSBUb2tlbiBsb2dpYw0KICAgIGRvVHJhbnNmZXIoX2hvbGRlciwgcmVjZWl2ZXIsIG5vblZlc3RlZCk7DQoNCiAgICBUcmFuc2ZlcihfaG9sZGVyLCByZWNlaXZlciwgbm9uVmVzdGVkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IFJldm9rZSBhbGwgZ3JhbnRzIG9mIHRva2VucyBvZiBhIHNwZWNpZmVkIGFkZHJlc3MuDQogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuDQogICAqLw0KICAgIGZ1bmN0aW9uIHJldm9rZUFsbFRva2VuR3JhbnRzKGFkZHJlc3MgX2hvbGRlcikgew0KICAgICAgICB2YXIgZ3JhbmRzQ291bnQgPSB0b2tlbkdyYW50c0NvdW50KF9ob2xkZXIpOw0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBncmFuZHNDb3VudDsgaSsrKSB7DQogICAgICAgICAgcmV2b2tlVG9rZW5HcmFudChfaG9sZGVyLCAwKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAvKioNCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiB0cmFuc2ZlcmFibGUgdG9rZW5zIG9mIGEgaG9sZGVyIGF0IGEgZ2l2ZW4gdGltZQ0KICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcg0KICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHNwZWNpZmljIHRpbWUuDQogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgYSBob2xkZXIncyB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7DQogICAgdWludDI1NiBncmFudEluZGV4ID0gdG9rZW5HcmFudHNDb3VudChob2xkZXIpOw0KDQogICAgaWYgKGdyYW50SW5kZXggPT0gMCkgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOyAvLyBzaG9ydGN1dCBmb3IgaG9sZGVyIHdpdGhvdXQgZ3JhbnRzDQoNCiAgICAvLyBJdGVyYXRlIHRocm91Z2ggYWxsIHRoZSBncmFudHMgdGhlIGhvbGRlciBoYXMsIGFuZCBhZGQgYWxsIG5vbi12ZXN0ZWQgdG9rZW5zDQogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOw0KICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgew0KICAgICAgbm9uVmVzdGVkID0gU2FmZU1hdGguYWRkKG5vblZlc3RlZCwgbm9uVmVzdGVkVG9rZW5zKGdyYW50c1tob2xkZXJdW2ldLCB0aW1lKSk7DQogICAgfQ0KDQogICAgLy8gQmFsYW5jZSAtIHRvdGFsTm9uVmVzdGVkIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGEgaG9sZGVyIGNhbiB0cmFuc2ZlciBhdCBhbnkgZ2l2ZW4gdGltZQ0KICAgIHVpbnQyNTYgdmVzdGVkVHJhbnNmZXJhYmxlID0gU2FmZU1hdGguc3ViKGJhbGFuY2VPZihob2xkZXIpLCBub25WZXN0ZWQpOw0KDQogICAgLy8gUmV0dXJuIHRoZSBtaW5pbXVtIG9mIGhvdyBtYW55IHZlc3RlZCBjYW4gdHJhbnNmZXIgYW5kIG90aGVyIHZhbHVlDQogICAgLy8gaW4gY2FzZSB0aGVyZSBhcmUgb3RoZXIgbGltaXRpbmcgdHJhbnNmZXJhYmlsaXR5IGZhY3RvcnMgKGRlZmF1bHQgaXMgYmFsYW5jZU9mKQ0KICAgIHJldHVybiBTYWZlTWF0aC5taW4yNTYodmVzdGVkVHJhbnNmZXJhYmxlLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDaGVjayB0aGUgYW1vdW50IG9mIGdyYW50cyB0aGF0IGFuIGFkZHJlc3MgaGFzLg0KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgaG9sZGVyIG9mIHRoZSBncmFudHMuDQogICAqIEByZXR1cm4gQSB1aW50IHJlcHJlc2VudGluZyB0aGUgdG90YWwgYW1vdW50IG9mIGdyYW50cy4NCiAgICovDQogIGZ1bmN0aW9uIHRva2VuR3JhbnRzQ291bnQoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGluZGV4KSB7DQogICAgcmV0dXJuIGdyYW50c1tfaG9sZGVyXS5sZW5ndGg7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBDYWxjdWxhdGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZjIHRpbWUuDQogICAqIEBwYXJhbSB0b2tlbnMgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyBncmFudHRlZC4NCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQNCiAgICogQHBhcmFtIHN0YXJ0IHVpbnQ2NCBBIHRpbWUgcmVwcmVzZW50aW5nIHRoZSBiZWdpbmluZyBvZiB0aGUgZ3JhbnQNCiAgICogQHBhcmFtIGNsaWZmIHVpbnQ2NCBUaGUgY2xpZmYgcGVyaW9kLg0KICAgKiBAcGFyYW0gdmVzdGluZyB1aW50NjQgVGhlIHZlc3RpbmcgcGVyaW9kLg0KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2Vuc29mIGEgc3BlY2lmIGdyYW50Lg0KICAgKiAgdHJhbnNmZXJhYmxlVG9rZW5zDQogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgdmVzdGVkVG9rZW5zIHJlY3QNCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICBfLw0KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICBfLw0KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgXy8NCiAgICogICB8ICAgICAgICAgICAgICAgICBfLw0KICAgKiAgIHwgICAgICAgICAgICAgICAgLw0KICAgKiAgIHwgICAgICAgICAgICAgIC58DQogICAqICAgfCAgICAgICAgICAgIC4gIHwNCiAgICogICB8ICAgICAgICAgIC4gICAgfA0KICAgKiAgIHwgICAgICAgIC4gICAgICB8DQogICAqICAgfCAgICAgIC4gICAgICAgIHwNCiAgICogICB8ICAgIC4gICAgICAgICAgfA0KICAgKiAgICs9PT0rPT09PT09PT09PT0rLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUNCiAgICogICAgICBTdGFydCAgICAgICBDbGlmdCAgICBWZXN0aW5nDQogICAqLw0KICBmdW5jdGlvbiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoDQogICAgdWludDI1NiB0b2tlbnMsDQogICAgdWludDI1NiB0aW1lLA0KICAgIHVpbnQyNTYgc3RhcnQsDQogICAgdWludDI1NiBjbGlmZiwNCiAgICB1aW50MjU2IHZlc3RpbmcpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICAgew0KICAgICAgLy8gU2hvcnRjdXRzIGZvciBiZWZvcmUgY2xpZmYgYW5kIGFmdGVyIHZlc3RpbmcgY2FzZXMuDQogICAgICBpZiAodGltZSA8IGNsaWZmKSByZXR1cm4gMDsNCiAgICAgIGlmICh0aW1lID49IHZlc3RpbmcpIHJldHVybiB0b2tlbnM7DQoNCiAgICAgIC8vIEludGVycG9sYXRlIGFsbCB2ZXN0ZWQgdG9rZW5zLg0KICAgICAgLy8gQXMgYmVmb3JlIGNsaWZmIHRoZSBzaG9ydGN1dCByZXR1cm5zIDAsIHdlIGNhbiB1c2UganVzdCBjYWxjdWxhdGUgYSB2YWx1ZQ0KICAgICAgLy8gaW4gdGhlIHZlc3RpbmcgcmVjdCAoYXMgc2hvd24gaW4gYWJvdmUncyBmaWd1cmUpDQoNCiAgICAgIC8vIHZlc3RlZFRva2VucyA9IHRva2VucyAqICh0aW1lIC0gc3RhcnQpIC8gKHZlc3RpbmcgLSBzdGFydCkNCiAgICAgIHVpbnQyNTYgdmVzdGVkVG9rZW5zID0gU2FmZU1hdGguZGl2KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZU1hdGgubXVsKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNhZmVNYXRoLnN1Yih0aW1lLCBzdGFydCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNhZmVNYXRoLnN1Yih2ZXN0aW5nLCBzdGFydCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7DQoNCiAgICAgIHJldHVybiB2ZXN0ZWRUb2tlbnM7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBHZXQgYWxsIGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmYyBncmFudC4NCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4NCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuDQogICAqIEByZXR1cm4gUmV0dXJucyBhbGwgdGhlIHZhbHVlcyB0aGF0IHJlcHJlc2VudCBhIFRva2VuR3JhbnQoYWRkcmVzcywgdmFsdWUsIHN0YXJ0LCBjbGlmZiwNCiAgICogcmV2b2thYmlsaXR5LCBidXJuc09uUmV2b2tlLCBhbmQgdmVzdGluZykgcGx1cyB0aGUgdmVzdGVkIHZhbHVlIGF0IHRoZSBjdXJyZW50IHRpbWUuDQogICAqLw0KICBmdW5jdGlvbiB0b2tlbkdyYW50KGFkZHJlc3MgX2hvbGRlciwgdWludCBfZ3JhbnRJZCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBncmFudGVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHZlc3RlZCwgdWludDY0IHN0YXJ0LCB1aW50NjQgY2xpZmYsIHVpbnQ2NCB2ZXN0aW5nLCBib29sIHJldm9rYWJsZSwgYm9vbCBidXJuc09uUmV2b2tlKSB7DQogICAgVG9rZW5HcmFudCBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07DQoNCiAgICBncmFudGVyID0gZ3JhbnQuZ3JhbnRlcjsNCiAgICB2YWx1ZSA9IGdyYW50LnZhbHVlOw0KICAgIHN0YXJ0ID0gZ3JhbnQuc3RhcnQ7DQogICAgY2xpZmYgPSBncmFudC5jbGlmZjsNCiAgICB2ZXN0aW5nID0gZ3JhbnQudmVzdGluZzsNCiAgICByZXZva2FibGUgPSBncmFudC5yZXZva2FibGU7DQogICAgYnVybnNPblJldm9rZSA9IGdyYW50LmJ1cm5zT25SZXZva2U7DQoNCiAgICB2ZXN0ZWQgPSB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IEdldCB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZpYyB0aW1lLg0KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4NCiAgICogQHBhcmFtIHRpbWUgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZA0KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50IGF0IGEgc3BlY2lmaWMgdGltZS4NCiAgICovDQogIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGNhbGN1bGF0ZVZlc3RlZFRva2VucygNCiAgICAgIGdyYW50LnZhbHVlLA0KICAgICAgdWludDI1Nih0aW1lKSwNCiAgICAgIHVpbnQyNTYoZ3JhbnQuc3RhcnQpLA0KICAgICAgdWludDI1NihncmFudC5jbGlmZiksDQogICAgICB1aW50MjU2KGdyYW50LnZlc3RpbmcpDQogICAgKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4NCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuDQogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkDQogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmMgZ3JhbnQgb24gdGhlDQogICAqIHBhc3NlZCB0aW1lIGZyYW1lLg0KICAgKi8NCiAgZnVuY3Rpb24gbm9uVmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gZ3JhbnQudmFsdWUuc3ViKHZlc3RlZFRva2VucyhncmFudCwgdGltZSkpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSBkYXRlIHdoZW4gdGhlIGhvbGRlciBjYW4gdHJhc2ZlciBhbGwgaXRzIHRva2Vucw0KICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcg0KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBkYXRlIG9mIHRoZSBsYXN0IHRyYW5zZmVyYWJsZSB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbiBsYXN0VG9rZW5Jc1RyYW5zZmVyYWJsZURhdGUoYWRkcmVzcyBob2xkZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50NjQgZGF0ZSkgew0KICAgIGRhdGUgPSB1aW50NjQobm93KTsNCiAgICB1aW50MjU2IGdyYW50SW5kZXggPSBncmFudHNbaG9sZGVyXS5sZW5ndGg7DQogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7DQogICAgICBkYXRlID0gU2FmZU1hdGgubWF4NjQoZ3JhbnRzW2hvbGRlcl1baV0udmVzdGluZywgZGF0ZSk7DQogICAgfQ0KICB9DQp9DQoNCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgew0KICAgIGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIGZyb20sIHVpbnQyNTYgX2Ftb3VudCwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9kYXRhKTsNCn0NCg0KDQpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgew0KICAgIC8vLyBAbm90aWNlIENhbGxlZCB3aGVuIGBfb3duZXJgIHNlbmRzIGV0aGVyIHRvIHRoZSBNaW5pTWUgVG9rZW4gY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMNCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzDQogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHJldHVybnMoYm9vbCk7DQoNCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQ0KICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkDQogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2Zlcg0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXINCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXINCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyDQogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOw0KDQogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlDQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsDQogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbA0KICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KQ0KICAgICAgICByZXR1cm5zKGJvb2wpOw0KfQ0KDQpjb250cmFjdCBEaXN0cmljdDB4TmV0d29ya1Rva2VuIGlzIE1pbmlNZVRva2VuLCBWZXN0ZWRUb2tlbiB7DQogICAgZnVuY3Rpb24gRGlzdHJpY3QweE5ldHdvcmtUb2tlbihhZGRyZXNzIF9jb250cm9sbGVyLCBhZGRyZXNzIF90b2tlbkZhY3RvcnkpDQogICAgICAgIE1pbmlNZVRva2VuKA0KICAgICAgICAgICAgX3Rva2VuRmFjdG9yeSwNCiAgICAgICAgICAgIDB4MCwgICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBwYXJlbnQgdG9rZW4NCiAgICAgICAgICAgIDAsICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBzbmFwc2hvdCBibG9jayBudW1iZXIgZnJvbSBwYXJlbnQNCiAgICAgICAgICAgICJkaXN0cmljdDB4IE5ldHdvcmsgVG9rZW4iLCAvLyBUb2tlbiBuYW1lDQogICAgICAgICAgICAxOCwgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVjaW1hbHMNCiAgICAgICAgICAgICJETlQiLCAgICAgICAgICAgICAgICAgICAgICAvLyBTeW1ib2wNCiAgICAgICAgICAgIHRydWUgICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmFibGUgdHJhbnNmZXJzDQogICAgICAgICAgICApDQogICAgew0KICAgICAgICBjaGFuZ2VDb250cm9sbGVyKF9jb250cm9sbGVyKTsNCiAgICAgICAgY2hhbmdlR3JhbnRzQ29udHJvbGxlcihfY29udHJvbGxlcik7DQogICAgfQ0KfQ0KDQpjb250cmFjdCBIYXNOb1Rva2VucyBpcyBPd25hYmxlIHsNCg0KICBEaXN0cmljdDB4TmV0d29ya1Rva2VuIHB1YmxpYyBkaXN0cmljdDB4TmV0d29ya1Rva2VuOw0KDQogLyoqDQogICogQGRldiBSZWplY3QgYWxsIEVSQzIzIGNvbXBhdGlibGUgdG9rZW5zDQogICogQHBhcmFtIGZyb21fIGFkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCBpcyB0cmFuc2ZlcnJpbmcgdGhlIHRva2Vucw0KICAqIEBwYXJhbSB2YWx1ZV8gdWludDI1NiB0aGUgYW1vdW50IG9mIHRoZSBzcGVjaWZpZWQgdG9rZW4NCiAgKiBAcGFyYW0gZGF0YV8gQnl0ZXMgVGhlIGRhdGEgcGFzc2VkIGZyb20gdGhlIGNhbGxlci4NCiAgKi8NCiAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIGZyb21fLCB1aW50MjU2IHZhbHVlXywgYnl0ZXMgZGF0YV8pIGV4dGVybmFsIHsNCiAgICB0aHJvdzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzVG9rZW5TYWxlVG9rZW4oYWRkcmVzcyB0b2tlbkFkZHIpIHJldHVybnMoYm9vbCk7DQoNCiAgLyoqDQogICAqIEBkZXYgUmVjbGFpbSBhbGwgRVJDMjBCYXNpYyBjb21wYXRpYmxlIHRva2Vucw0KICAgKiBAcGFyYW0gdG9rZW5BZGRyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0DQogICAqLw0KICBmdW5jdGlvbiByZWNsYWltVG9rZW4oYWRkcmVzcyB0b2tlbkFkZHIpIGV4dGVybmFsIG9ubHlPd25lciB7DQogICAgcmVxdWlyZSghaXNUb2tlblNhbGVUb2tlbih0b2tlbkFkZHIpKTsNCiAgICBFUkMyMEJhc2ljIHRva2VuSW5zdCA9IEVSQzIwQmFzaWModG9rZW5BZGRyKTsNCiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbkluc3QuYmFsYW5jZU9mKHRoaXMpOw0KICAgIHRva2VuSW5zdC50cmFuc2Zlcihtc2cuc2VuZGVyLCBiYWxhbmNlKTsNCiAgfQ0KfQ0KDQoNCmNvbnRyYWN0IERpc3RyaWN0MHhDb250cmlidXRpb24gaXMgUGF1c2FibGUsIEhhc05vVG9rZW5zLCBUb2tlbkNvbnRyb2xsZXIgew0KICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50Ow0KDQogICAgRGlzdHJpY3QweE5ldHdvcmtUb2tlbiBwdWJsaWMgZGlzdHJpY3QweE5ldHdvcmtUb2tlbjsNCiAgICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdhbGxldCB0aGF0IHJlY2VpdmVzIGFsbCBzYWxlIGZ1bmRzDQogICAgYWRkcmVzcyBwdWJsaWMgZm91bmRlcjE7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXYWxsZXQgb2YgZm91bmRlciAxDQogICAgYWRkcmVzcyBwdWJsaWMgZm91bmRlcjI7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXYWxsZXQgb2YgZm91bmRlciAyDQogICAgYWRkcmVzcyBwdWJsaWMgZWFybHlTcG9uc29yOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXYWxsZXQgb2YgZWFybHkgc3BvbnNvcg0KICAgIGFkZHJlc3NbXSBwdWJsaWMgYWR2aXNlcnM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gNCBXYWxsZXRzIG9mIGFkdmlzb3JzDQoNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBGT1VOREVSMV9TVEFLRSA9IDExOTAwMDAwMCBldGhlcjsgICAgICAgICAgICAgIC8vIDExOU0gRE5UDQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgRk9VTkRFUjJfU1RBS0UgPSA3OTAwMDAwMCBldGhlcjsgICAgICAgICAgICAgICAvLyA3OU0gIEROVA0KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IEVBUkxZX0NPTlRSSUJVVE9SX1NUQUtFID0gNTAwMDAwMCBldGhlcjsgICAgICAgLy8gNU0gICBETlQNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBBRFZJU0VSX1NUQUtFID0gNTAwMDAwMCBldGhlcjsgICAgICAgICAgICAgICAgIC8vIDVNICAgRE5UDQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgQURWSVNFUl9TVEFLRTIgPSAxMDAwMDAwIGV0aGVyOyAgICAgICAgICAgICAgICAvLyAxTSAgIEROVA0KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IENPTU1VTklUWV9BRFZJU0VSU19TVEFLRSA9IDUwMDAwMDAgZXRoZXI7ICAgICAgLy8gNU0gICBETlQNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBDT05UUklCX1BFUklPRDFfU1RBS0UgPSA2MDAwMDAwMDAgZXRoZXI7ICAgICAgIC8vIDYwME0gRE5UDQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgQ09OVFJJQl9QRVJJT0QyX1NUQUtFID0gMTQwMDAwMDAwIGV0aGVyOyAgICAgICAvLyAxNDBNIEROVA0KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IENPTlRSSUJfUEVSSU9EM19TVEFLRSA9IDQwMDAwMDAwIGV0aGVyOyAgICAgICAgLy8gNDBNICBETlQNCg0KICAgIHVpbnQgcHVibGljIG1pbkNvbnRyaWJBbW91bnQgPSAwLjAxIGV0aGVyOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMC4wMSBldGhlcg0KICAgIHVpbnQgcHVibGljIG1heEdhc1ByaWNlID0gNTAwMDAwMDAwMDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gNTAgR1dlaQ0KDQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgVEVBTV9WRVNUSU5HX0NMSUZGID0gMjQgd2Vla3M7ICAgICAgICAgICAgICAgICAvLyA2IG1vbnRocyB2ZXN0aW5nIGNsaWZmIGZvciBmb3VuZGVycyBhbmQgYWR2aXNvcnMsIGV4Y2VwdCBjb21tdW5pdHkgYWR2aXNvcnMNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBURUFNX1ZFU1RJTkdfUEVSSU9EID0gOTYgd2Vla3M7ICAgICAgICAgICAgICAgIC8vIDIgeWVhcnMgdmVzdGluZyBwZXJpb2QgZm9yIGZvdW5kZXJzIGFuZCBhZHZpc29ycywgZXhjZXB0IGNvbW11bml0eSBhZHZpc29ycw0KDQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgRUFSTFlfQ09OVFJJQlVUT1JfVkVTVElOR19DTElGRiA9IDEyIHdlZWtzOyAgICAvLyAzIG1vbnRocyB2ZXN0aW5nIGNsaWZmIGZvciBlYXJseSBzcG9uc29yDQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgRUFSTFlfQ09OVFJJQlVUT1JfVkVTVElOR19QRVJJT0QgPSAyNCB3ZWVrczsgICAvLyA2IG1vbnRocyB2ZXN0aW5nIGNsaWZmIGZvciBlYXJseSBzcG9uc29yDQoNCiAgICBib29sIHB1YmxpYyB0b2tlblRyYW5zZmVyc0VuYWJsZWQgPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEROVCB0b2tlbiB0cmFuc2ZlcnMgd2lsbCBiZSBlbmFibGVkIG1hbnVhbGx5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZnRlciBmaXJzdCBjb250cmlidXRpb24gcGVyaW9kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDYW4ndCBiZSBkaXNhYmxlZCBiYWNrDQogICAgc3RydWN0IENvbnRyaWJ1dG9yIHsNCiAgICAgICAgdWludCBhbW91bnQ7ICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW1vdW50IG9mIEVUSCBjb250cmlidXRlZCBieSBhbiBhZGRyZXNzIGluIGdpdmVuIGNvbnRyaWJ1dGlvbiBwZXJpb2QNCiAgICAgICAgYm9vbCBpc0NvbXBlbnNhdGVkOyAgICAgICAgICAgICAgICAgLy8gV2hldGhlciB0aGlzIGNvbnRyaWJ1dG9yIHJlY2VpdmVkIEROVCB0b2tlbiBmb3IgRVRIIGNvbnRyaWJ1dGlvbg0KICAgICAgICB1aW50IGFtb3VudENvbXBlbnNhdGVkOyAgICAgICAgICAgICAvLyBBbW91bnQgb2YgRE5UIHJlY2VpdmVkLiBOb3QgcmVhbGx5IG5lZWRlZCB0byBzdG9yZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnV0IHN0b3JlZCBmb3IgYWNjb3VudGluZyBhbmQgc2VjdXJpdHkgcHVycG9zZXMNCiAgICB9DQoNCiAgICB1aW50IHB1YmxpYyBzb2Z0Q2FwQW1vdW50OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNvZnQgY2FwIG9mIGNvbnRyaWJ1dGlvbiBwZXJpb2QgaW4gd2VpDQogICAgdWludCBwdWJsaWMgYWZ0ZXJTb2Z0Q2FwRHVyYXRpb247ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOdW1iZXIgb2Ygc2Vjb25kcyB0byB0aGUgZW5kIG9mIHNhbGUgZnJvbSB0aGUgbW9tZW50IG9mIHJlYWNoaW5nIHNvZnQgY2FwICh1bmxlc3MgcmVhY2hpbmcgaGFyZGNhcCkNCiAgICB1aW50IHB1YmxpYyBoYXJkQ2FwQW1vdW50OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdoZW4gcmVhY2hlZCB0aGlzIGFtb3VudCBvZiB3ZWksIHRoZSBjb250cmlidXRpb24gd2lsbCBlbmQgaW5zdGFudGx5DQogICAgdWludCBwdWJsaWMgc3RhcnRUaW1lOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGFydCB0aW1lIG9mIGNvbnRyaWJ1dGlvbiBwZXJpb2QgaW4gVU5JWCB0aW1lDQogICAgdWludCBwdWJsaWMgZW5kVGltZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmQgdGltZSBvZiBjb250cmlidXRpb24gcGVyaW9kIGluIFVOSVggdGltZQ0KICAgIGJvb2wgcHVibGljIGlzRW5hYmxlZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgY29udHJpYnV0aW9uIHBlcmlvZCB3YXMgZW5hYmxlZCBieSBtdWx0aXNpZ25hdHVyZQ0KICAgIGJvb2wgcHVibGljIHNvZnRDYXBSZWFjaGVkOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgc29mdCBjYXAgd2FzIHJlYWNoZWQNCiAgICBib29sIHB1YmxpYyBoYXJkQ2FwUmVhY2hlZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGhhcmQgY2FwIHdhcyByZWFjaGVkDQogICAgdWludCBwdWJsaWMgdG90YWxDb250cmlidXRlZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUb3RhbCBhbW91bnQgb2YgRVRIIGNvbnRyaWJ1dGVkIGluIGdpdmVuIHBlcmlvZA0KICAgIGFkZHJlc3NbXSBwdWJsaWMgY29udHJpYnV0b3JzS2V5czsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkcmVzc2VzIG9mIGFsbCBjb250cmlidXRvcnMgaW4gZ2l2ZW4gY29udHJpYnV0aW9uIHBlcmlvZA0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ29udHJpYnV0b3IpIHB1YmxpYyBjb250cmlidXRvcnM7DQoNCiAgICBldmVudCBvbkNvbnRyaWJ1dGlvbih1aW50IHRvdGFsQ29udHJpYnV0ZWQsIGFkZHJlc3MgaW5kZXhlZCBjb250cmlidXRvciwgdWludCBhbW91bnQsDQogICAgICAgIHVpbnQgY29udHJpYnV0b3JzQ291bnQpOw0KICAgIGV2ZW50IG9uU29mdENhcFJlYWNoZWQodWludCBlbmRUaW1lKTsNCiAgICBldmVudCBvbkhhcmRDYXBSZWFjaGVkKHVpbnQgZW5kVGltZSk7DQogICAgZXZlbnQgb25Db21wZW5zYXRlZChhZGRyZXNzIGluZGV4ZWQgY29udHJpYnV0b3IsIHVpbnQgYW1vdW50KTsNCg0KICAgIG1vZGlmaWVyIG9ubHlNdWx0aXNpZygpIHsNCiAgICAgICAgcmVxdWlyZShtdWx0aXNpZ1dhbGxldCA9PSBtc2cuc2VuZGVyKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBEaXN0cmljdDB4Q29udHJpYnV0aW9uKA0KICAgICAgICBhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwNCiAgICAgICAgYWRkcmVzcyBfZm91bmRlcjEsDQogICAgICAgIGFkZHJlc3MgX2ZvdW5kZXIyLA0KICAgICAgICBhZGRyZXNzIF9lYXJseVNwb25zb3IsDQogICAgICAgIGFkZHJlc3NbXSBfYWR2aXNlcnMNCiAgICApIHsNCiAgICAgICAgcmVxdWlyZShfYWR2aXNlcnMubGVuZ3RoID09IDUpOw0KICAgICAgICBtdWx0aXNpZ1dhbGxldCA9IF9tdWx0aXNpZ1dhbGxldDsNCiAgICAgICAgZm91bmRlcjEgPSBfZm91bmRlcjE7DQogICAgICAgIGZvdW5kZXIyID0gX2ZvdW5kZXIyOw0KICAgICAgICBlYXJseVNwb25zb3IgPSBfZWFybHlTcG9uc29yOw0KICAgICAgICBhZHZpc2VycyA9IF9hZHZpc2VyczsNCiAgICB9DQoNCiAgICAvLyBAbm90aWNlIFJldHVybnMgdHJ1ZSBpZiBjb250cmlidXRpb24gcGVyaW9kIGlzIGN1cnJlbnRseSBydW5uaW5nDQogICAgZnVuY3Rpb24gaXNDb250cmliUGVyaW9kUnVubmluZygpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuICFoYXJkQ2FwUmVhY2hlZCAmJg0KICAgICAgICAgICAgICAgaXNFbmFibGVkICYmDQogICAgICAgICAgICAgICBzdGFydFRpbWUgPD0gbm93ICYmDQogICAgICAgICAgICAgICBlbmRUaW1lID4gbm93Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGUoKQ0KICAgICAgICBwYXlhYmxlDQogICAgICAgIHN0b3BJbkVtZXJnZW5jeQ0KICAgIHsNCiAgICAgICAgY29udHJpYnV0ZVdpdGhBZGRyZXNzKG1zZy5zZW5kZXIpOw0KICAgIH0NCg0KICAgIC8vIEBub3RpY2UgRnVuY3Rpb24gdG8gcGFydGljaXBhdGUgaW4gY29udHJpYnV0aW9uIHBlcmlvZA0KICAgIC8vICBBbW91bnRzIGZyb20gdGhlIHNhbWUgYWRkcmVzcyBzaG91bGQgYmUgYWRkZWQgdXANCiAgICAvLyAgSWYgc29mdCBvciBoYXJkIGNhcCBpcyByZWFjaGVkLCBlbmQgdGltZSBzaG91bGQgYmUgbW9kaWZpZWQNCiAgICAvLyAgRnVuZHMgc2hvdWxkIGJlIHRyYW5zZmVycmVkIGludG8gbXVsdGlzaWcgd2FsbGV0DQogICAgLy8gQHBhcmFtIGNvbnRyaWJ1dG9yIEFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgRE5UIHRva2VuDQogICAgZnVuY3Rpb24gY29udHJpYnV0ZVdpdGhBZGRyZXNzKGFkZHJlc3MgY29udHJpYnV0b3IpDQogICAgICAgIHBheWFibGUNCiAgICAgICAgc3RvcEluRW1lcmdlbmN5DQogICAgew0KICAgICAgICByZXF1aXJlKHR4Lmdhc3ByaWNlIDw9IG1heEdhc1ByaWNlKTsNCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gbWluQ29udHJpYkFtb3VudCk7DQogICAgICAgIHJlcXVpcmUoaXNDb250cmliUGVyaW9kUnVubmluZygpKTsNCg0KICAgICAgICB1aW50IGNvbnRyaWJWYWx1ZSA9IG1zZy52YWx1ZTsNCiAgICAgICAgdWludCBleGNlc3NDb250cmliVmFsdWUgPSAwOw0KDQogICAgICAgIHVpbnQgb2xkVG90YWxDb250cmlidXRlZCA9IHRvdGFsQ29udHJpYnV0ZWQ7DQoNCiAgICAgICAgdG90YWxDb250cmlidXRlZCA9IG9sZFRvdGFsQ29udHJpYnV0ZWQuYWRkKGNvbnRyaWJWYWx1ZSk7DQoNCiAgICAgICAgdWludCBuZXdUb3RhbENvbnRyaWJ1dGVkID0gdG90YWxDb250cmlidXRlZDsNCg0KICAgICAgICAvLyBTb2Z0IGNhcCB3YXMgcmVhY2hlZA0KICAgICAgICBpZiAobmV3VG90YWxDb250cmlidXRlZCA+PSBzb2Z0Q2FwQW1vdW50ICYmDQogICAgICAgICAgICBvbGRUb3RhbENvbnRyaWJ1dGVkIDwgc29mdENhcEFtb3VudCkNCiAgICAgICAgew0KICAgICAgICAgICAgc29mdENhcFJlYWNoZWQgPSB0cnVlOw0KICAgICAgICAgICAgZW5kVGltZSA9IGFmdGVyU29mdENhcER1cmF0aW9uLmFkZChub3cpOw0KICAgICAgICAgICAgb25Tb2Z0Q2FwUmVhY2hlZChlbmRUaW1lKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBIYXJkIGNhcCB3YXMgcmVhY2hlZA0KICAgICAgICBpZiAobmV3VG90YWxDb250cmlidXRlZCA+PSBoYXJkQ2FwQW1vdW50ICYmDQogICAgICAgICAgICBvbGRUb3RhbENvbnRyaWJ1dGVkIDwgaGFyZENhcEFtb3VudCkNCiAgICAgICAgew0KICAgICAgICAgICAgaGFyZENhcFJlYWNoZWQgPSB0cnVlOw0KICAgICAgICAgICAgZW5kVGltZSA9IG5vdzsNCiAgICAgICAgICAgIG9uSGFyZENhcFJlYWNoZWQoZW5kVGltZSk7DQoNCiAgICAgICAgICAgIC8vIEV2ZXJ5dGhpbmcgYWJvdmUgaGFyZCBjYXAgd2lsbCBiZSBzZW50IGJhY2sgdG8gY29udHJpYnV0b3INCiAgICAgICAgICAgIGV4Y2Vzc0NvbnRyaWJWYWx1ZSA9IG5ld1RvdGFsQ29udHJpYnV0ZWQuc3ViKGhhcmRDYXBBbW91bnQpOw0KICAgICAgICAgICAgY29udHJpYlZhbHVlID0gY29udHJpYlZhbHVlLnN1YihleGNlc3NDb250cmliVmFsdWUpOw0KDQogICAgICAgICAgICB0b3RhbENvbnRyaWJ1dGVkID0gaGFyZENhcEFtb3VudDsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb250cmlidXRvcnNbY29udHJpYnV0b3JdLmFtb3VudCA9PSAwKSB7DQogICAgICAgICAgICBjb250cmlidXRvcnNLZXlzLnB1c2goY29udHJpYnV0b3IpOw0KICAgICAgICB9DQoNCiAgICAgICAgY29udHJpYnV0b3JzW2NvbnRyaWJ1dG9yXS5hbW91bnQgPSBjb250cmlidXRvcnNbY29udHJpYnV0b3JdLmFtb3VudC5hZGQoY29udHJpYlZhbHVlKTsNCg0KICAgICAgICBtdWx0aXNpZ1dhbGxldC50cmFuc2Zlcihjb250cmliVmFsdWUpOw0KICAgICAgICBpZiAoZXhjZXNzQ29udHJpYlZhbHVlID4gMCkgew0KICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlc3NDb250cmliVmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIG9uQ29udHJpYnV0aW9uKG5ld1RvdGFsQ29udHJpYnV0ZWQsIGNvbnRyaWJ1dG9yLCBjb250cmliVmFsdWUsIGNvbnRyaWJ1dG9yc0tleXMubGVuZ3RoKTsNCiAgICB9DQoNCiAgICAvLyBAbm90aWNlIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBieSBvd25lciBhZnRlciBjb250cmlidXRpb24gcGVyaW9kIGVuZHMsIHRvIGRpc3RyaWJ1dGUgRE5UIGluIHByb3BvcnRpb25hbCBtYW5uZXINCiAgICAvLyAgRWFjaCBjb250cmlidXRvciBzaG91bGQgcmVjZWl2ZSBETlQganVzdCBvbmNlIGV2ZW4gaWYgdGhpcyBtZXRob2QgaXMgY2FsbGVkIG11bHRpcGxlIHRpbWVzDQogICAgLy8gIEluIGNhc2Ugb2YgbWFueSBjb250cmlidXRvcnMgbXVzdCBiZSBhYmxlIHRvIGNvbXBlbnNhdGUgY29udHJpYnV0b3JzIGluIHBhZ2luYXRpb25hbCB3YXksIG90aGVyd2lzZSBtaWdodA0KICAgIC8vICBydW4gb3V0IG9mIGdhcyBpZiB3YW50ZWQgdG8gY29tcGVuc2F0ZSBhbGwgb24gb25lIG1ldGhvZCBjYWxsLiBUaGVyZWZvcmUgcGFyYW1ldGVycyBvZmZzZXQgYW5kIGxpbWl0DQogICAgLy8gQHBhcmFtIHBlcmlvZEluZGV4IEluZGV4IG9mIGNvbnRyaWJ1dGlvbiBwZXJpb2QgKDAtMikNCiAgICAvLyBAcGFyYW0gb2Zmc2V0IE51bWJlciBvZiBmaXJzdCBjb250cmlidXRvcnMgdG8gc2tpcC4NCiAgICAvLyBAcGFyYW0gbGltaXQgTWF4IG51bWJlciBvZiBjb250cmlidXRvcnMgY29tcGVuc2F0ZWQgb24gdGhpcyBjYWxsDQogICAgZnVuY3Rpb24gY29tcGVuc2F0ZUNvbnRyaWJ1dG9ycyh1aW50IG9mZnNldCwgdWludCBsaW1pdCkNCiAgICAgICAgb25seU93bmVyDQogICAgew0KICAgICAgICByZXF1aXJlKGlzRW5hYmxlZCk7DQogICAgICAgIHJlcXVpcmUoZW5kVGltZSA8IG5vdyk7DQoNCiAgICAgICAgdWludCBpID0gb2Zmc2V0Ow0KICAgICAgICB1aW50IGNvbXBlbnNhdGVkQ291bnQgPSAwOw0KICAgICAgICB1aW50IGNvbnRyaWJ1dG9yc0NvdW50ID0gY29udHJpYnV0b3JzS2V5cy5sZW5ndGg7DQoNCiAgICAgICAgdWludCByYXRpbyA9IENPTlRSSUJfUEVSSU9EMV9TVEFLRQ0KICAgICAgICAgICAgLm11bCgxMDAwMDAwMDAwMDAwMDAwMDAwKQ0KICAgICAgICAgICAgLmRpdih0b3RhbENvbnRyaWJ1dGVkKTsNCg0KICAgICAgICB3aGlsZSAoaSA8IGNvbnRyaWJ1dG9yc0NvdW50ICYmIGNvbXBlbnNhdGVkQ291bnQgPCBsaW1pdCkgew0KICAgICAgICAgICAgYWRkcmVzcyBjb250cmlidXRvckFkZHJlc3MgPSBjb250cmlidXRvcnNLZXlzW2ldOw0KICAgICAgICAgICAgaWYgKCFjb250cmlidXRvcnNbY29udHJpYnV0b3JBZGRyZXNzXS5pc0NvbXBlbnNhdGVkKSB7DQogICAgICAgICAgICAgICAgdWludCBhbW91bnRDb250cmlidXRlZCA9IGNvbnRyaWJ1dG9yc1tjb250cmlidXRvckFkZHJlc3NdLmFtb3VudDsNCiAgICAgICAgICAgICAgICBjb250cmlidXRvcnNbY29udHJpYnV0b3JBZGRyZXNzXS5pc0NvbXBlbnNhdGVkID0gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIGNvbnRyaWJ1dG9yc1tjb250cmlidXRvckFkZHJlc3NdLmFtb3VudENvbXBlbnNhdGVkID0NCiAgICAgICAgICAgICAgICAgICAgYW1vdW50Q29udHJpYnV0ZWQubXVsKHJhdGlvKS5kaXYoMTAwMDAwMDAwMDAwMDAwMDAwMCk7DQoNCiAgICAgICAgICAgICAgICBkaXN0cmljdDB4TmV0d29ya1Rva2VuLnRyYW5zZmVyKGNvbnRyaWJ1dG9yQWRkcmVzcywgY29udHJpYnV0b3JzW2NvbnRyaWJ1dG9yQWRkcmVzc10uYW1vdW50Q29tcGVuc2F0ZWQpOw0KICAgICAgICAgICAgICAgIG9uQ29tcGVuc2F0ZWQoY29udHJpYnV0b3JBZGRyZXNzLCBjb250cmlidXRvcnNbY29udHJpYnV0b3JBZGRyZXNzXS5hbW91bnRDb21wZW5zYXRlZCk7DQoNCiAgICAgICAgICAgICAgICBjb21wZW5zYXRlZENvdW50Kys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpKys7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBAbm90aWNlIE1ldGhvZCBmb3Igc2V0dGluZyB1cCBjb250cmlidXRpb24gcGVyaW9kDQogICAgLy8gIE9ubHkgb3duZXIgc2hvdWxkIGJlIGFibGUgdG8gZXhlY3V0ZQ0KICAgIC8vICBTZXR0aW5nIGZpcnN0IGNvbnRyaWJ1dGlvbiBwZXJpb2Qgc2V0cyB1cCB2ZXN0aW5nIGZvciBmb3VuZGVycyAmIGFkdmlzb3JzDQogICAgLy8gIENvbnRyaWJ1dGlvbiBwZXJpb2Qgc2hvdWxkIHN0aWxsIG5vdCBiZSBlbmFibGVkIGFmdGVyIGNhbGxpbmcgdGhpcyBtZXRob2QNCiAgICAvLyBAcGFyYW0gc29mdENhcEFtb3VudCBTb2Z0IENhcCBpbiB3ZWkNCiAgICAvLyBAcGFyYW0gYWZ0ZXJTb2Z0Q2FwRHVyYXRpb24gTnVtYmVyIG9mIHNlY29uZHMgdGlsbCB0aGUgZW5kIG9mIHNhbGUgaW4gdGhlIG1vbWVudCBvZiByZWFjaGluZyBzb2Z0IGNhcCAodW5sZXNzIHJlYWNoaW5nIGhhcmQgY2FwKQ0KICAgIC8vIEBwYXJhbSBoYXJkQ2FwQW1vdW50IEhhcmQgQ2FwIGluIHdlaQ0KICAgIC8vIEBwYXJhbSBzdGFydFRpbWUgQ29udHJpYnV0aW9uIHN0YXJ0IHRpbWUgaW4gVU5JWCB0aW1lDQogICAgLy8gQHBhcmFtIGVuZFRpbWUgQ29udHJpYnV0aW9uIGVuZCB0aW1lIGluIFVOSVggdGltZQ0KICAgIGZ1bmN0aW9uIHNldENvbnRyaWJQZXJpb2QoDQogICAgICAgIHVpbnQgX3NvZnRDYXBBbW91bnQsDQogICAgICAgIHVpbnQgX2FmdGVyU29mdENhcER1cmF0aW9uLA0KICAgICAgICB1aW50IF9oYXJkQ2FwQW1vdW50LA0KICAgICAgICB1aW50IF9zdGFydFRpbWUsDQogICAgICAgIHVpbnQgX2VuZFRpbWUNCiAgICApDQogICAgICAgIG9ubHlPd25lcg0KICAgIHsNCiAgICAgICAgcmVxdWlyZShfc29mdENhcEFtb3VudCA+IDApOw0KICAgICAgICByZXF1aXJlKF9oYXJkQ2FwQW1vdW50ID4gX3NvZnRDYXBBbW91bnQpOw0KICAgICAgICByZXF1aXJlKF9hZnRlclNvZnRDYXBEdXJhdGlvbiA+IDApOw0KICAgICAgICByZXF1aXJlKF9zdGFydFRpbWUgPiBub3cpOw0KICAgICAgICByZXF1aXJlKF9lbmRUaW1lID4gX3N0YXJ0VGltZSk7DQogICAgICAgIHJlcXVpcmUoIWlzRW5hYmxlZCk7DQoNCiAgICAgICAgc29mdENhcEFtb3VudCA9IF9zb2Z0Q2FwQW1vdW50Ow0KICAgICAgICBhZnRlclNvZnRDYXBEdXJhdGlvbiA9IF9hZnRlclNvZnRDYXBEdXJhdGlvbjsNCiAgICAgICAgaGFyZENhcEFtb3VudCA9IF9oYXJkQ2FwQW1vdW50Ow0KICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOw0KICAgICAgICBlbmRUaW1lID0gX2VuZFRpbWU7DQoNCiAgICAgICAgZGlzdHJpY3QweE5ldHdvcmtUb2tlbi5yZXZva2VBbGxUb2tlbkdyYW50cyhmb3VuZGVyMSk7DQogICAgICAgIGRpc3RyaWN0MHhOZXR3b3JrVG9rZW4ucmV2b2tlQWxsVG9rZW5HcmFudHMoZm91bmRlcjIpOw0KICAgICAgICBkaXN0cmljdDB4TmV0d29ya1Rva2VuLnJldm9rZUFsbFRva2VuR3JhbnRzKGVhcmx5U3BvbnNvcik7DQoNCiAgICAgICAgZm9yICh1aW50IGogPSAwOyBqIDwgYWR2aXNlcnMubGVuZ3RoOyBqKyspIHsNCiAgICAgICAgICAgIGRpc3RyaWN0MHhOZXR3b3JrVG9rZW4ucmV2b2tlQWxsVG9rZW5HcmFudHMoYWR2aXNlcnNbal0pOw0KICAgICAgICB9DQoNCiAgICAgICAgdWludDY0IHZlc3RpbmdEYXRlID0gdWludDY0KHN0YXJ0VGltZS5hZGQoVEVBTV9WRVNUSU5HX1BFUklPRCkpOw0KICAgICAgICB1aW50NjQgY2xpZmZEYXRlID0gdWludDY0KHN0YXJ0VGltZS5hZGQoVEVBTV9WRVNUSU5HX0NMSUZGKSk7DQogICAgICAgIHVpbnQ2NCBlYXJseUNvbnRyaWJWZXN0aW5nRGF0ZSA9IHVpbnQ2NChzdGFydFRpbWUuYWRkKEVBUkxZX0NPTlRSSUJVVE9SX1ZFU1RJTkdfUEVSSU9EKSk7DQogICAgICAgIHVpbnQ2NCBlYXJseUNvbnRyaWJDbGlmZkRhdGUgPSB1aW50NjQoc3RhcnRUaW1lLmFkZChFQVJMWV9DT05UUklCVVRPUl9WRVNUSU5HX0NMSUZGKSk7DQogICAgICAgIHVpbnQ2NCBzdGFydERhdGUgPSB1aW50NjQoc3RhcnRUaW1lKTsNCg0KICAgICAgICBkaXN0cmljdDB4TmV0d29ya1Rva2VuLmdyYW50VmVzdGVkVG9rZW5zKGZvdW5kZXIxLCBGT1VOREVSMV9TVEFLRSwgc3RhcnREYXRlLCBjbGlmZkRhdGUsIHZlc3RpbmdEYXRlLCB0cnVlLCBmYWxzZSk7DQogICAgICAgIGRpc3RyaWN0MHhOZXR3b3JrVG9rZW4uZ3JhbnRWZXN0ZWRUb2tlbnMoZm91bmRlcjIsIEZPVU5ERVIyX1NUQUtFLCBzdGFydERhdGUsIGNsaWZmRGF0ZSwgdmVzdGluZ0RhdGUsIHRydWUsIGZhbHNlKTsNCiAgICAgICAgZGlzdHJpY3QweE5ldHdvcmtUb2tlbi5ncmFudFZlc3RlZFRva2VucyhlYXJseVNwb25zb3IsIEVBUkxZX0NPTlRSSUJVVE9SX1NUQUtFLCBzdGFydERhdGUsIGVhcmx5Q29udHJpYkNsaWZmRGF0ZSwgZWFybHlDb250cmliVmVzdGluZ0RhdGUsIHRydWUsIGZhbHNlKTsNCiAgICAgICAgZGlzdHJpY3QweE5ldHdvcmtUb2tlbi5ncmFudFZlc3RlZFRva2VucyhhZHZpc2Vyc1swXSwgQURWSVNFUl9TVEFLRSwgc3RhcnREYXRlLCBjbGlmZkRhdGUsIHZlc3RpbmdEYXRlLCB0cnVlLCBmYWxzZSk7DQogICAgICAgIGRpc3RyaWN0MHhOZXR3b3JrVG9rZW4uZ3JhbnRWZXN0ZWRUb2tlbnMoYWR2aXNlcnNbMV0sIEFEVklTRVJfU1RBS0UsIHN0YXJ0RGF0ZSwgY2xpZmZEYXRlLCB2ZXN0aW5nRGF0ZSwgdHJ1ZSwgZmFsc2UpOw0KICAgICAgICBkaXN0cmljdDB4TmV0d29ya1Rva2VuLmdyYW50VmVzdGVkVG9rZW5zKGFkdmlzZXJzWzJdLCBBRFZJU0VSX1NUQUtFMiwgc3RhcnREYXRlLCBjbGlmZkRhdGUsIHZlc3RpbmdEYXRlLCB0cnVlLCBmYWxzZSk7DQogICAgICAgIGRpc3RyaWN0MHhOZXR3b3JrVG9rZW4uZ3JhbnRWZXN0ZWRUb2tlbnMoYWR2aXNlcnNbM10sIEFEVklTRVJfU1RBS0UyLCBzdGFydERhdGUsIGNsaWZmRGF0ZSwgdmVzdGluZ0RhdGUsIHRydWUsIGZhbHNlKTsNCg0KICAgICAgICAvLyBDb21tdW5pdHkgYWR2aXNvcnMgc3Rha2UgaGFzIG5vIHZlc3RpbmcsIGJ1dCB3ZSBzZXQgaXQgdXAgdGhpcyB3YXksIHNvIHdlIGNhbiByZXZva2UgaXQgaW4gY2FzZSBvZg0KICAgICAgICAvLyByZS1zZXR0aW5nIHVwIGNvbnRyaWJ1dGlvbiBwZXJpb2QNCiAgICAgICAgZGlzdHJpY3QweE5ldHdvcmtUb2tlbi5ncmFudFZlc3RlZFRva2VucyhhZHZpc2Vyc1s0XSwgQ09NTVVOSVRZX0FEVklTRVJTX1NUQUtFLCBzdGFydERhdGUsIHN0YXJ0RGF0ZSwgc3RhcnREYXRlLCB0cnVlLCBmYWxzZSk7DQogICAgfQ0KDQogICAgLy8gQG5vdGljZSBFbmFibGVzIGNvbnRyaWJ1dGlvbiBwZXJpb2QNCiAgICAvLyAgTXVzdCBiZSBleGVjdXRlZCBieSBtdWx0aXNpZ25hdHVyZQ0KICAgIGZ1bmN0aW9uIGVuYWJsZUNvbnRyaWJQZXJpb2QoKQ0KICAgICAgICBvbmx5TXVsdGlzaWcNCiAgICB7DQogICAgICAgIHJlcXVpcmUoc3RhcnRUaW1lID4gbm93KTsNCiAgICAgICAgaXNFbmFibGVkID0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLyBAbm90aWNlIFNldHMgbmV3IG1pbi4gY29udHJpYnV0aW9uIGFtb3VudA0KICAgIC8vICBPbmx5IG93bmVyIGNhbiBleGVjdXRlDQogICAgLy8gIENhbm5vdCBiZSBleGVjdXRlZCB3aGlsZSBjb250cmlidXRpb24gcGVyaW9kIGlzIHJ1bm5pbmcNCiAgICAvLyBAcGFyYW0gX21pbkNvbnRyaWJBbW91bnQgbmV3IG1pbi4gYW1vdW50DQogICAgZnVuY3Rpb24gc2V0TWluQ29udHJpYkFtb3VudCh1aW50IF9taW5Db250cmliQW1vdW50KQ0KICAgICAgICBvbmx5T3duZXINCiAgICB7DQogICAgICAgIHJlcXVpcmUoX21pbkNvbnRyaWJBbW91bnQgPiAwKTsNCiAgICAgICAgcmVxdWlyZShzdGFydFRpbWUgPiBub3cpOw0KICAgICAgICBtaW5Db250cmliQW1vdW50ID0gX21pbkNvbnRyaWJBbW91bnQ7DQogICAgfQ0KDQogICAgLy8gQG5vdGljZSBTZXRzIG5ldyBtYXggZ2FzIHByaWNlIGZvciBjb250cmlidXRpb24NCiAgICAvLyAgT25seSBvd25lciBjYW4gZXhlY3V0ZQ0KICAgIC8vICBDYW5ub3QgYmUgZXhlY3V0ZWQgd2hpbGUgY29udHJpYnV0aW9uIHBlcmlvZCBpcyBydW5uaW5nDQogICAgLy8gQHBhcmFtIF9taW5Db250cmliQW1vdW50IG5ldyBtaW4uIGFtb3VudA0KICAgIGZ1bmN0aW9uIHNldE1heEdhc1ByaWNlKHVpbnQgX21heEdhc1ByaWNlKQ0KICAgICAgICBvbmx5T3duZXINCiAgICB7DQogICAgICAgIHJlcXVpcmUoX21heEdhc1ByaWNlID4gMCk7DQogICAgICAgIHJlcXVpcmUoc3RhcnRUaW1lID4gbm93KTsNCiAgICAgICAgbWF4R2FzUHJpY2UgPSBfbWF4R2FzUHJpY2U7DQogICAgfQ0KDQogICAgLy8gQG5vdGljZSBTZXRzIERpc3RyaWN0MHhOZXR3b3JrVG9rZW4gY29udHJhY3QNCiAgICAvLyAgR2VuZXJhdGVzIGFsbCBETlQgdG9rZW5zIGFuZCBhc3NpZ25zIHRoZW0gdG8gdGhpcyBjb250cmFjdA0KICAgIC8vICBJZiB0b2tlbiBjb250cmFjdCBoYXMgYWxyZWFkeSBnZW5lcmF0ZWQgdG9rZW5zLCBkbyBub3QgZ2VuZXJhdGUgYWdhaW4NCiAgICAvLyBAcGFyYW0gX2Rpc3RyaWN0MHhOZXR3b3JrVG9rZW4gRGlzdHJpY3QweE5ldHdvcmtUb2tlbiBhZGRyZXNzDQogICAgZnVuY3Rpb24gc2V0RGlzdHJpY3QweE5ldHdvcmtUb2tlbihhZGRyZXNzIF9kaXN0cmljdDB4TmV0d29ya1Rva2VuKQ0KICAgICAgICBvbmx5T3duZXINCiAgICB7DQogICAgICAgIHJlcXVpcmUoX2Rpc3RyaWN0MHhOZXR3b3JrVG9rZW4gIT0gMHgwKTsNCiAgICAgICAgcmVxdWlyZSghaXNFbmFibGVkKTsNCiAgICAgICAgZGlzdHJpY3QweE5ldHdvcmtUb2tlbiA9IERpc3RyaWN0MHhOZXR3b3JrVG9rZW4oX2Rpc3RyaWN0MHhOZXR3b3JrVG9rZW4pOw0KICAgICAgICBpZiAoZGlzdHJpY3QweE5ldHdvcmtUb2tlbi50b3RhbFN1cHBseSgpID09IDApIHsNCiAgICAgICAgICAgIGRpc3RyaWN0MHhOZXR3b3JrVG9rZW4uZ2VuZXJhdGVUb2tlbnModGhpcywgRk9VTkRFUjFfU1RBS0UNCiAgICAgICAgICAgICAgICAuYWRkKEZPVU5ERVIyX1NUQUtFKQ0KICAgICAgICAgICAgICAgIC5hZGQoRUFSTFlfQ09OVFJJQlVUT1JfU1RBS0UpDQogICAgICAgICAgICAgICAgLmFkZChBRFZJU0VSX1NUQUtFLm11bCgyKSkNCiAgICAgICAgICAgICAgICAuYWRkKEFEVklTRVJfU1RBS0UyLm11bCgyKSkNCiAgICAgICAgICAgICAgICAuYWRkKENPTU1VTklUWV9BRFZJU0VSU19TVEFLRSkNCiAgICAgICAgICAgICAgICAuYWRkKENPTlRSSUJfUEVSSU9EMV9TVEFLRSkpOw0KDQogICAgICAgICAgICBkaXN0cmljdDB4TmV0d29ya1Rva2VuLmdlbmVyYXRlVG9rZW5zKG11bHRpc2lnV2FsbGV0LCBDT05UUklCX1BFUklPRDJfU1RBS0UNCiAgICAgICAgICAgICAgICAuYWRkKENPTlRSSUJfUEVSSU9EM19TVEFLRSkpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gQG5vdGljZSBFbmFibGVzIHRyYW5zZmVycyBvZiBETlQNCiAgICAvLyAgV2lsbCBiZSBleGVjdXRlZCBhZnRlciBmaXJzdCBjb250cmlidXRpb24gcGVyaW9kIGJ5IG93bmVyDQogICAgZnVuY3Rpb24gZW5hYmxlRGlzdHJpY3QweE5ldHdvcmtUb2tlblRyYW5zZmVycygpDQogICAgICAgIG9ubHlPd25lcg0KICAgIHsNCiAgICAgICAgcmVxdWlyZShlbmRUaW1lIDwgbm93KTsNCiAgICAgICAgdG9rZW5UcmFuc2ZlcnNFbmFibGVkID0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLyBAbm90aWNlIE1ldGhvZCB0byBjbGFpbSB0b2tlbnMgYWNjaWRlbnRhbGx5IHNlbnQgdG8gYSBETlQgY29udHJhY3QNCiAgICAvLyAgT25seSBtdWx0aXNpZyB3YWxsZXQgY2FuIGV4ZWN1dGUNCiAgICAvLyBAcGFyYW0gX3Rva2VuIEFkZHJlc3Mgb2YgY2xhaW1lZCBFUkMyMCBUb2tlbg0KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zRnJvbVRva2VuRGlzdHJpY3QweE5ldHdvcmtUb2tlbihhZGRyZXNzIF90b2tlbikNCiAgICAgICAgb25seU11bHRpc2lnDQogICAgew0KICAgICAgICBkaXN0cmljdDB4TmV0d29ya1Rva2VuLmNsYWltVG9rZW5zKF90b2tlbiwgbXVsdGlzaWdXYWxsZXQpOw0KICAgIH0NCg0KICAgIC8vIEBub3RpY2UgS2lsbCBtZXRob2Qgc2hvdWxkIG5vdCByZWFsbHkgYmUgbmVlZGVkLCBidXQganVzdCBpbiBjYXNlDQogICAgZnVuY3Rpb24ga2lsbChhZGRyZXNzIF90bykgb25seU11bHRpc2lnIGV4dGVybmFsIHsNCiAgICAgICAgc3VpY2lkZShfdG8pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uKCkNCiAgICAgICAgcGF5YWJsZQ0KICAgICAgICBzdG9wSW5FbWVyZ2VuY3kNCiAgICB7DQogICAgICAgIGNvbnRyaWJ1dGVXaXRoQWRkcmVzcyhtc2cuc2VuZGVyKTsNCiAgICB9DQoNCiAgICAvLyBNaW5pTWUgQ29udHJvbGxlciBkZWZhdWx0IHNldHRpbmdzIGZvciBhbGxvd2luZyB0b2tlbiB0cmFuc2ZlcnMuDQogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8vIEJlZm9yZSB0cmFuc2ZlcnMgYXJlIGVuYWJsZWQgZm9yIGV2ZXJ5b25lLCBvbmx5IHRoaXMgY29udHJhY3QgaXMgYWxsb3dlZCB0byBkaXN0cmlidXRlIEROVA0KICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIHRva2VuVHJhbnNmZXJzRW5hYmxlZCB8fCBfZnJvbSA9PSBhZGRyZXNzKHRoaXMpIHx8IF90byA9PSBhZGRyZXNzKHRoaXMpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gdG9rZW5UcmFuc2ZlcnNFbmFibGVkOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGlzVG9rZW5TYWxlVG9rZW4oYWRkcmVzcyB0b2tlbkFkZHIpIHJldHVybnMoYm9vbCkgew0KICAgICAgICByZXR1cm4gZGlzdHJpY3QweE5ldHdvcmtUb2tlbiA9PSB0b2tlbkFkZHI7DQogICAgfQ0KDQogICAgLyoNCiAgICAgRm9sbG93aW5nIGNvbnN0YW50IG1ldGhvZHMgYXJlIHVzZWQgZm9yIHRlc3RzIGFuZCBjb250cmlidXRpb24gd2ViIGFwcA0KICAgICBUaGV5IGRvbid0IGltcGFjdCBsb2dpYyBvZiBjb250cmlidXRpb24gY29udHJhY3QsIHRoZXJlZm9yIERPRVMgTk9UIE5FRUQgVE8gQkUgQVVESVRFRA0KICAgICAqLw0KDQogICAgLy8gVXNlZCBieSBjb250cmlidXRpb24gZnJvbnQtZW5kIHRvIG9idGFpbiBjb250cmlidXRpb24gcGVyaW9kIHByb3BlcnRpZXMNCiAgICBmdW5jdGlvbiBnZXRDb250cmliUGVyaW9kKCkNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAoYm9vbFszXSBib29sVmFsdWVzLCB1aW50WzhdIHVpbnRWYWx1ZXMpDQogICAgew0KICAgICAgICBib29sVmFsdWVzWzBdID0gaXNFbmFibGVkOw0KICAgICAgICBib29sVmFsdWVzWzFdID0gc29mdENhcFJlYWNoZWQ7DQogICAgICAgIGJvb2xWYWx1ZXNbMl0gPSBoYXJkQ2FwUmVhY2hlZDsNCg0KICAgICAgICB1aW50VmFsdWVzWzBdID0gc29mdENhcEFtb3VudDsNCiAgICAgICAgdWludFZhbHVlc1sxXSA9IGFmdGVyU29mdENhcER1cmF0aW9uOw0KICAgICAgICB1aW50VmFsdWVzWzJdID0gaGFyZENhcEFtb3VudDsNCiAgICAgICAgdWludFZhbHVlc1szXSA9IHN0YXJ0VGltZTsNCiAgICAgICAgdWludFZhbHVlc1s0XSA9IGVuZFRpbWU7DQogICAgICAgIHVpbnRWYWx1ZXNbNV0gPSB0b3RhbENvbnRyaWJ1dGVkOw0KICAgICAgICB1aW50VmFsdWVzWzZdID0gY29udHJpYnV0b3JzS2V5cy5sZW5ndGg7DQogICAgICAgIHVpbnRWYWx1ZXNbN10gPSBDT05UUklCX1BFUklPRDFfU1RBS0U7DQoNCiAgICAgICAgcmV0dXJuIChib29sVmFsdWVzLCB1aW50VmFsdWVzKTsNCiAgICB9DQoNCiAgICAvLyBVc2VkIGJ5IGNvbnRyaWJ1dGlvbiBmcm9udC1lbmQgdG8gb2J0YWluIGNvbnRyaWJ1dGlvbiBjb250cmFjdCBwcm9wZXJ0aWVzDQogICAgZnVuY3Rpb24gZ2V0Q29uZmlndXJhdGlvbigpDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIHJldHVybnMgKGJvb2wsIGFkZHJlc3MsIGFkZHJlc3MsIGFkZHJlc3MsIGFkZHJlc3MsIGFkZHJlc3NbXSBfYWR2aXNlcnMsIGJvb2wsIHVpbnQpDQogICAgew0KICAgICAgICBfYWR2aXNlcnMgPSBuZXcgYWRkcmVzc1tdKGFkdmlzZXJzLmxlbmd0aCk7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFkdmlzZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBfYWR2aXNlcnNbaV0gPSBhZHZpc2Vyc1tpXTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKHN0b3BwZWQsIG11bHRpc2lnV2FsbGV0LCBmb3VuZGVyMSwgZm91bmRlcjIsIGVhcmx5U3BvbnNvciwgX2FkdmlzZXJzLCB0b2tlblRyYW5zZmVyc0VuYWJsZWQsDQogICAgICAgICAgICBtYXhHYXNQcmljZSk7DQogICAgfQ0KDQogICAgLy8gVXNlZCBieSBjb250cmlidXRpb24gZnJvbnQtZW5kIHRvIG9idGFpbiBjb250cmlidXRvcidzIHByb3BlcnRpZXMNCiAgICBmdW5jdGlvbiBnZXRDb250cmlidXRvcihhZGRyZXNzIGNvbnRyaWJ1dG9yQWRkcmVzcykNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyh1aW50LCBib29sLCB1aW50KQ0KICAgIHsNCiAgICAgICAgQ29udHJpYnV0b3IgY29udHJpYnV0b3IgPSBjb250cmlidXRvcnNbY29udHJpYnV0b3JBZGRyZXNzXTsNCiAgICAgICAgcmV0dXJuIChjb250cmlidXRvci5hbW91bnQsIGNvbnRyaWJ1dG9yLmlzQ29tcGVuc2F0ZWQsIGNvbnRyaWJ1dG9yLmFtb3VudENvbXBlbnNhdGVkKTsNCiAgICB9DQoNCiAgICAvLyBGdW5jdGlvbiB0byB2ZXJpZnkgaWYgYWxsIGNvbnRyaWJ1dG9ycyB3ZXJlIGNvbXBlbnNhdGVkDQogICAgZnVuY3Rpb24gZ2V0VW5jb21wZW5zYXRlZENvbnRyaWJ1dG9ycyh1aW50IG9mZnNldCwgdWludCBsaW1pdCkNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAodWludFtdIGNvbnRyaWJ1dG9ySW5kZXhlcykNCiAgICB7DQogICAgICAgIHVpbnQgY29udHJpYnV0b3JzQ291bnQgPSBjb250cmlidXRvcnNLZXlzLmxlbmd0aDsNCg0KICAgICAgICBpZiAobGltaXQgPT0gMCkgew0KICAgICAgICAgICAgbGltaXQgPSBjb250cmlidXRvcnNDb3VudDsNCiAgICAgICAgfQ0KDQogICAgICAgIHVpbnQgaSA9IG9mZnNldDsNCiAgICAgICAgdWludCByZXN1bHRzQ291bnQgPSAwOw0KICAgICAgICB1aW50W10gbWVtb3J5IF9jb250cmlidXRvckluZGV4ZXMgPSBuZXcgdWludFtdKGxpbWl0KTsNCg0KICAgICAgICB3aGlsZSAoaSA8IGNvbnRyaWJ1dG9yc0NvdW50ICYmIHJlc3VsdHNDb3VudCA8IGxpbWl0KSB7DQogICAgICAgICAgICBpZiAoIWNvbnRyaWJ1dG9yc1tjb250cmlidXRvcnNLZXlzW2ldXS5pc0NvbXBlbnNhdGVkKSB7DQogICAgICAgICAgICAgICAgX2NvbnRyaWJ1dG9ySW5kZXhlc1tyZXN1bHRzQ291bnRdID0gaTsNCiAgICAgICAgICAgICAgICByZXN1bHRzQ291bnQrKzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGkrKzsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnRyaWJ1dG9ySW5kZXhlcyA9IG5ldyB1aW50W10ocmVzdWx0c0NvdW50KTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJlc3VsdHNDb3VudDsgaSsrKSB7DQogICAgICAgICAgICBjb250cmlidXRvckluZGV4ZXNbaV0gPSBfY29udHJpYnV0b3JJbmRleGVzW2ldOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjb250cmlidXRvckluZGV4ZXM7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0Tm93KCkNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyh1aW50KQ0KICAgIHsNCiAgICAgICAgcmV0dXJuIG5vdzsNCiAgICB9DQp9'