base 64 content
base64e4RowEscrow
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLy8gdmVyc2lvbiAoTEFWQS1RKQ0KY29udHJhY3QgRTRSb3dFc2Nyb3cgew0KDQpldmVudCBTdGF0RXZlbnQoc3RyaW5nIG1zZyk7DQpldmVudCBTdGF0RXZlbnRJKHN0cmluZyBtc2csIHVpbnQgdmFsKTsNCmV2ZW50IFN0YXRFdmVudEEoc3RyaW5nIG1zZywgYWRkcmVzcyBhZGRyKTsNCg0KICAgICAgICB1aW50IGNvbnN0YW50IE1BWF9QTEFZRVJTID0gNTsNCg0KICAgICAgICBlbnVtIEVuZFJlYXNvbiAge2VyV2lubmVyLCBlclRpbWVPdXQsIGVyQ2FuY2VsfQ0KICAgICAgICBlbnVtIFNldHRpbmdTdGF0ZVZhbHVlICB7ZGVidWcsIHJlbGVhc2UsIGxvY2tlZFJlbGVhc2V9DQoNCiAgICAgICAgc3RydWN0IGdhbWVJbnN0YW5jZSB7DQogICAgICAgICAgICAgICAgYm9vbCBhY3RpdmU7ICAgICAgICAgICAvLyBhY3RpdmUNCiAgICAgICAgICAgICAgICBib29sIGFsbG9jZDsgICAgICAgICAgIC8vIGFsbG9jYXRlZCBhbHJlYWR5LiANCiAgICAgICAgICAgICAgICBFbmRSZWFzb24gcmVhc29uRW5kZWQ7IC8vIGVudW0gcmVhc29uIG9mIGVuZGVkDQogICAgICAgICAgICAgICAgdWludDggbnVtUGxheWVyczsNCiAgICAgICAgICAgICAgICB1aW50MTI4IHRvdGFsUG90OyAgICAgIC8vIHRvdGFsIG9mIGFsbCBiZXRzDQogICAgICAgICAgICAgICAgdWludDEyOFs1XSBwbGF5ZXJQb3RzOyAvLyBpbmRpdmlkdWFsIGRlcG9zaXRzDQogICAgICAgICAgICAgICAgYWRkcmVzc1s1XSBwbGF5ZXJzOyAgICAvLyBwbGF5ZXIgYWRkcnMNCiAgICAgICAgICAgICAgICB1aW50IGxhc3RNb3ZlZDsgICAgICAgIC8vIHRpbWUgZ2FtZSBsYXN0IG1vdmVkDQogICAgICAgIH0NCg0KICAgICAgICBzdHJ1Y3QgYXJiaXRlciB7DQogICAgICAgICAgICAgICAgbWFwcGluZyAodWludCA9PiB1aW50KSAgZ2FtZUluZGV4ZXM7IC8vIGdhbWUgaGFuZGxlcw0KICAgICAgICAgICAgICAgIGJvb2wgcmVnaXN0ZXJlZDsgDQogICAgICAgICAgICAgICAgYm9vbCBsb2NrZWQ7DQogICAgICAgICAgICAgICAgdWludDggbnVtUGxheWVyczsNCiAgICAgICAgICAgICAgICB1aW50MTYgYXJiVG9rZW47ICAgICAgICAgLy8gMiBieXRlcw0KICAgICAgICAgICAgICAgIHVpbnQxNiBlc2NGZWVQY3RYMTA7ICAgICAvLyBlc2Nyb3cgZmVlIC0tIGZyYWMgb2YgMTAwMA0KICAgICAgICAgICAgICAgIHVpbnQxNiBhcmJGZWVQY3RYMTA7ICAgICAvLyBhcmJpdGVyIGZlZSAtLSBmcmFjIG9mIDEwMDANCiAgICAgICAgICAgICAgICB1aW50MzIgZ2FtZVNsb3RzOyAgICAgICAgLy8gYSBjb3VudGVyIG9mIGFsbG9jJ2QgZ2FtZSBzdHJ1Y3RzICh0aGV5IGNhbiBiZSByZXVzZWQpDQogICAgICAgICAgICAgICAgdWludDEyOCBmZWVDYXA7ICAgICAgICAgIC8vIG1heCBmZWUgKGVzY3JvdyArIGFyYikgaW4gd2VpDQogICAgICAgICAgICAgICAgdWludDEyOCBhcmJIb2xkb3ZlcjsgICAgIC8vIGhvbGQgYWNjdW11bGF0ZWQgZ2FzIGNyZWRpdHMgYW5kIGFyYml0ZXIgZmVlcw0KICAgICAgICB9DQoNCg0KICAgICAgICBhZGRyZXNzIHB1YmxpYyAgb3duZXI7ICAvLyBvd25lciBpcyBhZGRyZXNzIHRoYXQgZGVwbG95ZWQgY29udHJhY3QNCiAgICAgICAgYWRkcmVzcyBwdWJsaWMgIHRva2VuUGFydG5lcjsgICAvLyB0aGUgYWRkcmVzcyBvZiBwYXJ0bmVyIHRoYXQgcmVjZWl2ZXMgcmFrZSBmZWVzDQogICAgICAgIHVpbnQgcHVibGljIG51bUFyYml0ZXJzOyAgICAgICAgLy8gbnVtYmVyIG9mIGFyYml0ZXJzDQoNCiAgICAgICAgaW50IG51bUdhbWVzU3RhcnRlZDsgICAgLy8gdG90YWwgc3RhdHMgZnJvbSBhbGwgYXJiaXRlcnMNCg0KICAgICAgICB1aW50IHB1YmxpYyBudW1HYW1lc0NvbXBsZXRlZDsgLy8gLi4uDQogICAgICAgIHVpbnQgcHVibGljIG51bUdhbWVzQ2FuY2VsZWQ7ICAgLy8gdGllZCBhbmQgY2FuY2VsZWQNCiAgICAgICAgdWludCBwdWJsaWMgbnVtR2FtZXNUaW1lZE91dDsgICAvLyAuLi4NCiAgICAgICAgdWludCBwdWJsaWMgaG91c2VGZWVIb2xkb3ZlcjsgICAvLyBob2xkIGZlZSB0aWxsIHRocmVzaG9sZA0KICAgICAgICB1aW50IHB1YmxpYyBsYXN0UGF5b3V0VGltZTsgICAgIC8vIHRpbWVzdGFtcCBvZiBsYXN0IHBheW91dCB0aW1lDQoNCiAgICAgICAgLy8gY29uZmlndXJhYmxlcw0KICAgICAgICB1aW50IHB1YmxpYyBnYW1lVGltZU91dDsNCiAgICAgICAgdWludCBwdWJsaWMgcmVnaXN0cmF0aW9uRmVlOw0KICAgICAgICB1aW50IHB1YmxpYyBob3VzZUZlZVRocmVzaG9sZDsNCiAgICAgICAgdWludCBwdWJsaWMgcGF5b3V0SW50ZXJ2YWw7DQoNCiAgICAgICAgdWludCBhY2N0Q2FsbEdhczsgIC8vIGZvciBwYXltZW50cyB0byBzaW1wbGUgYWNjdHMNCiAgICAgICAgdWludCB0b2tDYWxsR2FzOyAgIC8vIGZvciBjYWxsaW5nIHRva2VuIGNvbnRyYWN0LiBlZyBmZWUgcGF5b3V0DQogICAgICAgIHVpbnQgcHVibGljIHN0YXJ0R2FtZUdhczsgLy8gZ2FzIGNvbnN1bWVkIGJ5IHN0YXJ0R2FtZQ0KICAgICAgICB1aW50IHB1YmxpYyB3aW5uZXJEZWNpZGVkR2FzOyAvLyBnYXMgY29uc3VtZWQgYnkgd2lubmVyRGVjaWRlZA0KDQogICAgICAgIFNldHRpbmdTdGF0ZVZhbHVlIHB1YmxpYyBzZXR0aW5nc1N0YXRlID0gU2V0dGluZ1N0YXRlVmFsdWUuZGVidWc7IA0KDQoNCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiBhcmJpdGVyKSAgYXJiaXRlcnM7DQogICAgICAgIG1hcHBpbmcgKHVpbnQgPT4gYWRkcmVzcykgIGFyYml0ZXJUb2tlbnM7DQogICAgICAgIG1hcHBpbmcgKHVpbnQgPT4gYWRkcmVzcykgIGFyYml0ZXJJbmRleGVzOw0KICAgICAgICBtYXBwaW5nICh1aW50ID0+IGdhbWVJbnN0YW5jZSkgIGdhbWVzOw0KDQoNCiAgICAgICAgZnVuY3Rpb24gRTRSb3dFc2Nyb3coKSBwdWJsaWMNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgZnVuY3Rpb24gYXBwbHlTZXR0aW5ncyhTZXR0aW5nU3RhdGVWYWx1ZSBfc3RhdGUsIHVpbnQgX2ZlZSwgdWludCBfdGhyZXNob2xkLCB1aW50IF90aW1lb3V0LCB1aW50IF9pbnRlcnZhbCwgdWludCBfc3RhcnRHYW1lR2FzLCB1aW50IF93aW5uZXJEZWNpZGVkR2FzKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIA0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgLy8gdGhlc2UgaXRlbXMgYXJlIHR3ZWFrYWJsZSBmb3IgZ2FtZSBvcHRpbWl6YXRpb24NCiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgaG91c2VGZWVUaHJlc2hvbGQgPSBfdGhyZXNob2xkOw0KICAgICAgICAgICAgICAgIGdhbWVUaW1lT3V0ID0gX3RpbWVvdXQ7DQogICAgICAgICAgICAgICAgcGF5b3V0SW50ZXJ2YWwgPSBfaW50ZXJ2YWw7DQoNCiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5sb2NrZWRSZWxlYXNlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIlNldHRpbmdzIFR3ZWFrZWQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBzZXR0aW5nc1N0YXRlID0gX3N0YXRlOw0KICAgICAgICAgICAgICAgIHJlZ2lzdHJhdGlvbkZlZSA9IF9mZWU7DQoNCiAgICAgICAgICAgICAgICAvLyBzZXQgZGVmYXVsdCBvcCBnYXMgLSAgYW55IGZ1dGhlciBzZXR0aW5ncyBkb25lIGluIHNldCB1cCBnYXMNCiAgICAgICAgICAgICAgICBhY2N0Q2FsbEdhcyA9IDIxMDAwOyANCiAgICAgICAgICAgICAgICB0b2tDYWxsR2FzID0gMzYwMDAwOw0KDQogICAgICAgICAgICAgICAgLy8gc2V0IGdhcyBjb25zdW1wdGlvbiAtIHRoZXNlIHNob3VsZCBuZXZlciBjaGFuZ2UgKGV4Y2VwdCBnYXMgcHJpY2UpDQogICAgICAgICAgICAgICAgc3RhcnRHYW1lR2FzID0gX3N0YXJ0R2FtZUdhczsNCiAgICAgICAgICAgICAgICB3aW5uZXJEZWNpZGVkR2FzID0gX3dpbm5lckRlY2lkZWRHYXM7DQogICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJTZXR0aW5ncyBDaGFuZ2VkIik7DQoNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyByZXR1cm4gYW4gYXJiaXRlciB0b2tlbiBmcm9tIGFuIGhHYW1lDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gQXJiVG9rRnJvbUhHYW1lKHVpbnQgX2hHYW1lKSByZXR1cm5zICh1aW50IF90b2spDQogICAgICAgIHsgDQogICAgICAgICAgICAgICAgX3RvayA9ICAoX2hHYW1lIC8gKDIgKiogNDgpKSAmIDB4ZmZmZjsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBzdWljaWRlIHRoZSBjb250cmFjdCwgbm90IGNhbGxlZCBmb3IgcmVsZWFzZQ0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIEhhcmFLaXJpKCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICgobXNnLnNlbmRlciA9PSBvd25lcikgJiYgKHNldHRpbmdzU3RhdGUgIT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgIHN1aWNpZGUodG9rZW5QYXJ0bmVyKTsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIktpbGwgYXR0ZW1wdCBmYWlsZWQiKTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBkZWZhdWx0IGZ1bmN0aW9uDQogICAgICAgIC8vIHdobyBhcmUgd2UgdG8gbG9vayBhIGdpZnQtaG9yc2UgaW4gdGhlIG1vdXRoPw0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSAgew0KICAgICAgICAgICAgICAgIFN0YXRFdmVudCgidGhhbmtzISIpOw0KICAgICAgICAgICAgICAgIGhvdXNlRmVlSG9sZG92ZXIgKz0gbXNnLnZhbHVlOw0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIGJsYWNrSG9sZSgpIHBheWFibGUgIHsNCiAgICAgICAgICAgICAgICBTdGF0RXZlbnQoInRoYW5rcyEjMiIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gY2hlY2sgYWN0aXZlIGdhbWUgYW5kIHZhbGlkIHBsYXllciwgcmV0dXJuIHBsYXllciBpbmRleA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gdmFsaWRQbGF5ZXIodWludCBfaEdhbWUsIGFkZHJlc3MgX2FkZHIpICBpbnRlcm5hbCByZXR1cm5zKCBib29sIF92YWxpZCwgdWludCBfcGlkeCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIF92YWxpZCA9IGZhbHNlOw0KDQogICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUdhbWUoX2hHYW1lKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgZ2FtZXNbX2hHYW1lXS5udW1QbGF5ZXJzOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWVzW19oR2FtZV0ucGxheWVyc1tpXSA9PSBfYWRkcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF92YWxpZD10cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9waWR4ID0gaTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gY2hlY2sgdGhlIGFyYml0ZXIgaXMgdmFsaWQgYnkgY29tcGFyaW5nIHRva2VuDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIHZhbGlkQXJiKGFkZHJlc3MgX2FkZHIsIHVpbnQgX3RvaykgaW50ZXJuYWwgIHJldHVybnMoIGJvb2wgX3ZhbGlkKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgX3ZhbGlkID0gZmFsc2U7DQoNCiAgICAgICAgICAgICAgICBpZiAoKGFyYml0ZXJzW19hZGRyXS5yZWdpc3RlcmVkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgKGFyYml0ZXJzW19hZGRyXS5hcmJUb2tlbiA9PSBfdG9rKSkgDQogICAgICAgICAgICAgICAgICAgICAgICBfdmFsaWQgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gY2hlY2sgdGhlIGFyYml0ZXIgaXMgdmFsaWQgd2l0aG91dCBjb21wYXJpbmcgdG9rZW4NCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gdmFsaWRBcmIyKGFkZHJlc3MgX2FkZHIpIGludGVybmFsICByZXR1cm5zKCBib29sIF92YWxpZCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIF92YWxpZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGlmIChhcmJpdGVyc1tfYWRkcl0ucmVnaXN0ZXJlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIF92YWxpZCA9IHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBjaGVjayBpZiBhcmJpdGVyIGlzIGxvY2tlZCBvdXQNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gYXJiTG9ja2VkKGFkZHJlc3MgX2FkZHIpIGludGVybmFsICByZXR1cm5zKCBib29sIF9sb2NrZWQpDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBfbG9ja2VkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgaWYgKHZhbGlkQXJiMihfYWRkcikpIA0KICAgICAgICAgICAgICAgICAgICAgICAgX2xvY2tlZCA9IGFyYml0ZXJzW19hZGRyXS5sb2NrZWQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyByZXR1cm4gaWYgZ2FtZSBpcyBhY3RpdmUNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gYWN0aXZlR2FtZSh1aW50IF9oR2FtZSkgaW50ZXJuYWwgIHJldHVybnMoIGJvb2wgX3ZhbGlkKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgX3ZhbGlkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgaWYgKChfaEdhbWUgPiAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgKGdhbWVzW19oR2FtZV0uYWN0aXZlKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIF92YWxpZCA9IHRydWU7DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHJlZ2lzdGVyIGdhbWUgYXJiaXRlciwgbWF4IHBsYXllcnMgb2YgNSwgcGFzcyBpbiBleGFjdCByZWdpc3RyYXRpb24gZmVlDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyQXJiaXRlcih1aW50IF9udW1QbGF5ZXJzLCB1aW50IF9hcmJUb2tlbiwgdWludCBfZXNjRmVlUGN0WDEwLCB1aW50IF9hcmJGZWVQY3RYMTAsIHVpbnQgX2ZlZUNhcCkgcHVibGljIHBheWFibGUgDQogICAgICAgIHsNCg0KICAgICAgICAgICAgICAgIGlmIChtc2cudmFsdWUgIT0gcmVnaXN0cmF0aW9uRmVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsgIC8vSW5zdWZmaWNpZW50IEZlZQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChfYXJiVG9rZW4gPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IC8vIGludmFsaWQgdG9rZW4NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoYXJiVG9rZW5FeGlzdHMoX2FyYlRva2VuICYgMHhmZmZmKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IC8vIFRva2VuIEFscmVhZHkgRXhpc3RzDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGFyYml0ZXJzW21zZy5zZW5kZXJdLnJlZ2lzdGVyZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyAvLyBBcmIgQWxyZWFkeSBSZWdpc3RlcmVkDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKF9udW1QbGF5ZXJzID4gTUFYX1BMQVlFUlMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyAvLyBFeGNlZWRzIE1heCBQbGF5ZXJzDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKF9lc2NGZWVQY3RYMTAgPCAyMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IC8vIGxlc3MgdGhhbiAyJSBtaW4gZXNjcm93IGZlZQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChfYXJiRmVlUGN0WDEwID4gMTApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyAvLyBtb3JlIHRoYW4gdGhhbiAxJSBtYXggYXJiaXRlciBmZWUNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBhcmJpdGVyc1ttc2cuc2VuZGVyXS5sb2NrZWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBhcmJpdGVyc1ttc2cuc2VuZGVyXS5udW1QbGF5ZXJzID0gdWludDgoX251bVBsYXllcnMpOw0KICAgICAgICAgICAgICAgIGFyYml0ZXJzW21zZy5zZW5kZXJdLmVzY0ZlZVBjdFgxMCA9IHVpbnQ4KF9lc2NGZWVQY3RYMTApOw0KICAgICAgICAgICAgICAgIGFyYml0ZXJzW21zZy5zZW5kZXJdLmFyYkZlZVBjdFgxMCA9IHVpbnQ4KF9hcmJGZWVQY3RYMTApOw0KICAgICAgICAgICAgICAgIGFyYml0ZXJzW21zZy5zZW5kZXJdLmFyYlRva2VuID0gdWludDE2KF9hcmJUb2tlbiAmIDB4ZmZmZik7DQogICAgICAgICAgICAgICAgYXJiaXRlcnNbbXNnLnNlbmRlcl0uZmVlQ2FwID0gdWludDEyOChfZmVlQ2FwKTsNCiAgICAgICAgICAgICAgICBhcmJpdGVyc1ttc2cuc2VuZGVyXS5yZWdpc3RlcmVkID0gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIGFyYml0ZXJUb2tlbnNbKF9hcmJUb2tlbiAmIDB4ZmZmZildID0gbXNnLnNlbmRlcjsNCiAgICAgICAgICAgICAgICBhcmJpdGVySW5kZXhlc1tudW1BcmJpdGVycysrXSA9IG1zZy5zZW5kZXI7DQoNCiAgICAgICAgICAgICAgICBpZiAodG9rZW5QYXJ0bmVyICE9IGFkZHJlc3MoMCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdG9rZW5QYXJ0bmVyLmNhbGwuZ2FzKHRva0NhbGxHYXMpLnZhbHVlKG1zZy52YWx1ZSkoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1N0YXR2ZW50KCJTZW5kIEVycm9yIik7IC8vIGV2ZW50IG5ldmVyIHJlZ2lzdGVycw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciArPSBtc2cudmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFN0YXRFdmVudEkoIkFyYiBBZGRlZCIsIF9hcmJUb2tlbik7DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHN0YXJ0IGdhbWUuICBwYXNzIGluIHZhbGlkIGhHYW1lIGNvbnRhaW5pbmcgdG9rZW4gaW4gdG9wIHR3byBieXRlcw0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBzdGFydEdhbWUodWludCBfaEdhbWUsIGludCBfaGtNYXgsIGFkZHJlc3NbXSBfcGxheWVycykgcHVibGljIA0KDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICB1aW50IG50b2sgPSBBcmJUb2tGcm9tSEdhbWUoX2hHYW1lKTsNCiAgICAgICAgICAgICAgICBpZiAoIXZhbGlkQXJiKG1zZy5zZW5kZXIsIG50b2sgKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJJbnZhbGlkIEFyYiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAgICAgaWYgKGFyYkxvY2tlZChtc2cuc2VuZGVyKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJBcmIgTG9ja2VkIik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IA0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGFyYml0ZXIgeGFyYiA9IGFyYml0ZXJzW21zZy5zZW5kZXJdOw0KICAgICAgICAgICAgICAgIGlmIChfcGxheWVycy5sZW5ndGggIT0geGFyYi5udW1QbGF5ZXJzKSB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJJbmNvcnJlY3QgbnVtIHBsYXllcnMiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgZ2FtZUluc3RhbmNlIHhnYW1lID0gZ2FtZXNbX2hHYW1lXTsNCiAgICAgICAgICAgICAgICBpZiAoeGdhbWUuYWN0aXZlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBndWFyZC1yYWlsLiBqdXN0IGluIGNhc2UgdG8gcmV0dXJuIGZ1bmRzDQogICAgICAgICAgICAgICAgICAgICAgICBhYm9ydEdhbWUoX2hHYW1lLCBFbmRSZWFzb24uZXJDYW5jZWwpOw0KDQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfaGtNYXggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBob3VzZUtlZXAoX2hrTWF4LCBudG9rKTsgDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKCF4Z2FtZS5hbGxvY2QpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHhnYW1lLmFsbG9jZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB4YXJiLmdhbWVJbmRleGVzW3hhcmIuZ2FtZVNsb3RzKytdID0gX2hHYW1lOw0KICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgbnVtR2FtZXNTdGFydGVkKys7IC8vIGFsd2F5cyBpbmMgdGhpcyBvbmUNCg0KICAgICAgICAgICAgICAgIHhnYW1lLmFjdGl2ZSA9IHRydWU7DQogICAgICAgICAgICAgICAgeGdhbWUubGFzdE1vdmVkID0gbm93Ow0KICAgICAgICAgICAgICAgIHhnYW1lLnRvdGFsUG90ID0gMDsNCiAgICAgICAgICAgICAgICB4Z2FtZS5udW1QbGF5ZXJzID0geGFyYi5udW1QbGF5ZXJzOw0KICAgICAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9wbGF5ZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB4Z2FtZS5wbGF5ZXJzW2ldID0gX3BsYXllcnNbaV07DQogICAgICAgICAgICAgICAgICAgICAgICB4Z2FtZS5wbGF5ZXJQb3RzW2ldID0gMDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy9TdGF0RXZlbnRJKCJHYW1lIEFkZGVkIiwgX2hHYW1lKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGNsZWFuIHVwIGdhbWUsIHNldCB0byBpbmFjdGl2ZSwgcmVmdW5kIGFueSBiYWxhbmNlcw0KICAgICAgICAvLyBjYWxsZWQgYnkgaG91c2VrZWVwIE9OTFkNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gYWJvcnRHYW1lKHVpbnQgIF9oR2FtZSwgRW5kUmVhc29uIF9yZWFzb24pIHByaXZhdGUgcmV0dXJucyhib29sIF9zdWNjZXNzKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgZ2FtZUluc3RhbmNlIHhnYW1lID0gZ2FtZXNbX2hHYW1lXTsNCiAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBmaW5kIGdhbWUgaW4gZ2FtZSBpZCwgDQogICAgICAgICAgICAgICAgaWYgKHhnYW1lLmFjdGl2ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgX3N1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgeGdhbWUubnVtUGxheWVyczsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4Z2FtZS5wbGF5ZXJQb3RzW2ldID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgYSA9IHhnYW1lLnBsYXllcnNbaV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBuc2VuZCA9IHhnYW1lLnBsYXllclBvdHNbaV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGdhbWUucGxheWVyUG90c1tpXSA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhLmNhbGwuZ2FzKGFjY3RDYWxsR2FzKS52YWx1ZShuc2VuZCkoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciArPSBuc2VuZDsgLy8gY2Fubm90IHJlZnVuZCBkdWUgdG8gZXJyb3IsIGdpdmUgdG8gdGhlIGhvdXNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnRBKCJDYW5ub3QgUmVmdW5kIEFkZHJlc3MiLCBhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHhnYW1lLmFjdGl2ZSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgeGdhbWUucmVhc29uRW5kZWQgPSBfcmVhc29uOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9yZWFzb24gPT0gRW5kUmVhc29uLmVyQ2FuY2VsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bUdhbWVzQ2FuY2VsZWQrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJHYW1lIGNhbmNlbGVkIik7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9yZWFzb24gPT0gRW5kUmVhc29uLmVyVGltZU91dCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1HYW1lc1RpbWVkT3V0Kys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiR2FtZSB0aW1lZCBvdXQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJHYW1lIGFib3J0ZWQiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGNhbGxlZCBieSBhcmJpdGVyIHdoZW4gd2lubmVyIGlzIGRlY2lkZWQNCiAgICAgICAgLy8gKnBhc3MgaW4gaGlnaCBudW0gZm9yIHdpbm5lcmJhbCBmb3IgdGllIGdhbWVzDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIHdpbm5lckRlY2lkZWQodWludCBfaEdhbWUsIGFkZHJlc3MgX3dpbm5lciwgdWludCBfd2lubmVyQmFsKSBwdWJsaWMNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICghdmFsaWRBcmIobXNnLnNlbmRlciwgQXJiVG9rRnJvbUhHYW1lKF9oR2FtZSkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkludmFsaWQgQXJiIik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIG5vIHRocm93IG5vIGNoYW5nZSBtYWRlDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdmFyICh2YWxpZCwgcGlkeCkgPSB2YWxpZFBsYXllcihfaEdhbWUsIF93aW5uZXIpOw0KICAgICAgICAgICAgICAgIGlmICghdmFsaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiSW52YWxpZCBQbGF5ZXIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBhcmJpdGVyIHhhcmIgPSBhcmJpdGVyc1ttc2cuc2VuZGVyXTsNCiAgICAgICAgICAgICAgICBnYW1lSW5zdGFuY2UgeGdhbWUgPSBnYW1lc1tfaEdhbWVdOw0KDQogICAgICAgICAgICAgICAgaWYgKHhnYW1lLnBsYXllclBvdHNbcGlkeF0gPCBfd2lubmVyQmFsKSB7DQogICAgICAgICAgICAgICAgICAgIGFib3J0R2FtZShfaEdhbWUsIEVuZFJlYXNvbi5lckNhbmNlbCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB4Z2FtZS5hY3RpdmUgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB4Z2FtZS5yZWFzb25FbmRlZCA9IEVuZFJlYXNvbi5lcldpbm5lcjsNCiAgICAgICAgICAgICAgICBudW1HYW1lc0NvbXBsZXRlZCsrOw0KDQogICAgICAgICAgICAgICAgaWYgKHhnYW1lLnRvdGFsUG90ID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FsYyBwYXlvdXRzOiBlc2Nyb3dGZWUsIGFyYml0ZXJGZWUsIGdhc0Nvc3QsIHdpbm5lciBwYXlvdXQNCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX2VzY3Jvd0ZlZSA9ICh4Z2FtZS50b3RhbFBvdCAqIHhhcmIuZXNjRmVlUGN0WDEwKSAvIDEwMDA7DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IF9hcmJpdGVyRmVlID0gKHhnYW1lLnRvdGFsUG90ICogeGFyYi5hcmJGZWVQY3RYMTApIC8gMTAwMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoX2VzY3Jvd0ZlZSArIF9hcmJpdGVyRmVlKSA+IHhhcmIuZmVlQ2FwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9lc2Nyb3dGZWUgPSB4YXJiLmZlZUNhcCAqIHhhcmIuZXNjRmVlUGN0WDEwIC8gKHhhcmIuZXNjRmVlUGN0WDEwICsgeGFyYi5hcmJGZWVQY3RYMTApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYXJiaXRlckZlZSA9IHhhcmIuZmVlQ2FwICogeGFyYi5hcmJGZWVQY3RYMTAgLyAoeGFyYi5lc2NGZWVQY3RYMTAgKyB4YXJiLmFyYkZlZVBjdFgxMCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IF9wYXlvdXQgPSB4Z2FtZS50b3RhbFBvdCAtIChfZXNjcm93RmVlICsgX2FyYml0ZXJGZWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfZ2FzQ29zdCA9IHR4Lmdhc3ByaWNlICogKHN0YXJ0R2FtZUdhcyArIHdpbm5lckRlY2lkZWRHYXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9nYXNDb3N0ID4gX3BheW91dCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2dhc0Nvc3QgPSBfcGF5b3V0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgX3BheW91dCAtPSBfZ2FzQ29zdDsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG8gcGF5b3V0cw0KICAgICAgICAgICAgICAgICAgICAgICAgeGFyYi5hcmJIb2xkb3ZlciArPSB1aW50MTI4KF9hcmJpdGVyRmVlICsgX2dhc0Nvc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciArPSBfZXNjcm93RmVlOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGhvdXNlRmVlSG9sZG92ZXIgPiBob3VzZUZlZVRocmVzaG9sZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAobm93ID4gKGxhc3RQYXlvdXRUaW1lICsgcGF5b3V0SW50ZXJ2YWwpKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IG50bXBobyA9IGhvdXNlRmVlSG9sZG92ZXI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXNlRmVlSG9sZG92ZXIgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0UGF5b3V0VGltZSA9IG5vdzsgLy8gcmVzZXQgcmVnYXJkbGVzcyBvZiBzdWNjZWVkL2ZhaWwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0b2tlblBhcnRuZXIuY2FsbC5nYXModG9rQ2FsbEdhcykudmFsdWUobnRtcGhvKSgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciA9IG50bXBobzsgLy8gcHV0IGl0IGJhY2sNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkhvdXNlLUZlZSBFcnJvcjEiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9wYXlvdXQgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX3dpbm5lci5jYWxsLmdhcyhhY2N0Q2FsbEdhcykudmFsdWUodWludChfcGF5b3V0KSkoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHlvdSBjYW50IHBheSB0aGUgd2lubmVyIC0gdmVyeSBiYWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGF0RXZlbnQoIlNlbmQgRXJyb3IiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgZnVuZHMgdG8gaG91c2VGZWVIb2xkb3ZlciB0byBhdm9pZCBhY291bnRpbmcgZXJycw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhyb3c7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciArPSBfcGF5b3V0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudEkoIlBheW91dCBFcnJvciEiLCBfaEdhbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vU3RhdEV2ZW50SSgiV2lubmVyIFBhaWQiLCBfaEdhbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBoYW5kbGUgYSBiZXQgbWFkZSBieSBhIHBsYXllciwgdmFsaWRhdGUgdGhlIHBsYXllciBhbmQgZ2FtZQ0KICAgICAgICAvLyBhZGQgdG8gcGxheWVycyBiYWxhbmNlDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUJldCh1aW50IF9oR2FtZSkgcHVibGljIHBheWFibGUgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9hcmJBZGRyID0gYXJiaXRlclRva2Vuc1tBcmJUb2tGcm9tSEdhbWUoX2hHYW1lKV07DQogICAgICAgICAgICAgICAgaWYgKF9hcmJBZGRyID09IGFkZHJlc3MoMCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyAvLyAiSW52YWxpZCBoR2FtZSINCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB2YXIgKHZhbGlkLCBwaWR4KSA9IHZhbGlkUGxheWVyKF9oR2FtZSwgbXNnLnNlbmRlcik7DQogICAgICAgICAgICAgICAgaWYgKCF2YWxpZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IC8vICJJbnZhbGlkIFBsYXllciINCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBnYW1lSW5zdGFuY2UgeGdhbWUgPSBnYW1lc1tfaEdhbWVdOw0KICAgICAgICAgICAgICAgIHhnYW1lLnBsYXllclBvdHNbcGlkeF0gKz0gdWludDEyOChtc2cudmFsdWUpOw0KICAgICAgICAgICAgICAgIHhnYW1lLnRvdGFsUG90ICs9IHVpbnQxMjgobXNnLnZhbHVlKTsNCiAgICAgICAgICAgICAgICAvL1N0YXRFdmVudEkoIkJldCBBZGRlZCIsIF9oR2FtZSk7DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHJldHVybiBpZiBhcmIgdG9rZW4gZXhpc3RzDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGFyYlRva2VuRXhpc3RzKHVpbnQgX3RvaykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBfZXhpc3RzKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgX2V4aXN0cyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGlmICgoX3RvayA+IDApDQogICAgICAgICAgICAgICAgICAgICAgICAmJiAoYXJiaXRlclRva2Vuc1tfdG9rXSAhPSBhZGRyZXNzKDApKQ0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgYXJiaXRlcnNbYXJiaXRlclRva2Vuc1tfdG9rXV0ucmVnaXN0ZXJlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIF9leGlzdHMgPSB0cnVlOw0KDQogICAgICAgIH0NCg0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHJldHVybiBhcmJpdGVyIGdhbWUgc3RhdHMNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gZ2V0QXJiSW5mbyh1aW50IF90b2spIGNvbnN0YW50ICByZXR1cm5zIChhZGRyZXNzIF9hZGRyLCB1aW50IF9lc2NGZWVQY3RYMTAsIHVpbnQgX2FyYkZlZVBjdFgxMCwgdWludCBfZmVlQ2FwLCB1aW50IF9ob2xkT3ZlcikgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBpZiAoYXJiaXRlclRva2Vuc1tfdG9rXSAhPSBhZGRyZXNzKDApKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBfYWRkciA9IGFyYml0ZXJUb2tlbnNbX3Rva107IA0KICAgICAgICAgICAgICAgICAgICAgICAgIGFyYml0ZXIgeGFyYiA9IGFyYml0ZXJzW2FyYml0ZXJUb2tlbnNbX3Rva11dOw0KICAgICAgICAgICAgICAgICAgICAgICAgX2VzY0ZlZVBjdFgxMCA9IHhhcmIuZXNjRmVlUGN0WDEwOw0KICAgICAgICAgICAgICAgICAgICAgICAgX2FyYkZlZVBjdFgxMCA9IHhhcmIuYXJiRmVlUGN0WDEwOw0KICAgICAgICAgICAgICAgICAgICAgICAgX2ZlZUNhcCA9IHhhcmIuZmVlQ2FwOw0KICAgICAgICAgICAgICAgICAgICAgICAgX2hvbGRPdmVyID0geGFyYi5hcmJIb2xkb3ZlcjsgDQogICAgICAgICAgICAgICAgLy8gfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gc2NhbiBmb3IgYSBnYW1lIDEwIG1pbnV0ZXMgb2xkDQogICAgICAgIC8vIGlmIGZvdW5kIGFib3J0IHRoZSBnYW1lLCBjYXVzaW5nIGZ1bmRzIHRvIGJlIHJldHVybmVkDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGhvdXNlS2VlcChpbnQgX21heCwgdWludCBfYXJiVG9rZW4pIHB1YmxpYw0KICAgICAgICB7DQogICAgICAgICAgICAgICAgdWludCBnaTsNCiAgICAgICAgICAgICAgICBhZGRyZXNzIGE7DQogICAgICAgICAgICAgICAgaW50IGFib3J0ZWQgPSAwOw0KDQogICAgICAgICAgICAgICAgYXJiaXRlciB4YXJiID0gYXJiaXRlcnNbbXNnLnNlbmRlcl07Ly8gaGF2ZSB0byBzZXQgaXQgdG8gc29tZXRoaW5nDQogICAgICAgICAgICAgICAgDQogICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBvd25lcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh1aW50IGFyID0gMDsgKGFyIDwgbnVtQXJiaXRlcnMpICYmIChhYm9ydGVkIDwgX21heCkgOyBhcisrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGFyYml0ZXJJbmRleGVzW2FyXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4YXJiID0gYXJiaXRlcnNbYV07ICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggZ2kgPSAwOyAoZ2kgPCB4YXJiLmdhbWVTbG90cykgJiYgKGFib3J0ZWQgPCBfbWF4KTsgZ2krKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lSW5zdGFuY2UgbmdhbWUwID0gZ2FtZXNbeGFyYi5nYW1lSW5kZXhlc1tnaV1dOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG5nYW1lMC5hY3RpdmUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAoKG5vdyAtIG5nYW1lMC5sYXN0TW92ZWQpID4gZ2FtZVRpbWVPdXQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRHYW1lKHhhcmIuZ2FtZUluZGV4ZXNbZ2ldLCBFbmRSZWFzb24uZXJUaW1lT3V0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArK2Fib3J0ZWQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWxpZEFyYihtc2cuc2VuZGVyLCBfYXJiVG9rZW4pKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkhvdXNla2VlcCBpbnZhbGlkIGFyYml0ZXIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBtc2cuc2VuZGVyOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhhcmIgPSBhcmJpdGVyc1thXTsgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnaSA9IDA7IChnaSA8IHhhcmIuZ2FtZVNsb3RzKSAmJiAoYWJvcnRlZCA8IF9tYXgpOyBnaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWVJbnN0YW5jZSBuZ2FtZTEgPSBnYW1lc1t4YXJiLmdhbWVJbmRleGVzW2dpXV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobmdhbWUxLmFjdGl2ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICgobm93IC0gbmdhbWUxLmxhc3RNb3ZlZCkgPiBnYW1lVGltZU91dCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydEdhbWUoeGFyYi5nYW1lSW5kZXhlc1tnaV0sIEVuZFJlYXNvbi5lclRpbWVPdXQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsrYWJvcnRlZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gcmV0dXJuIGdhbWUgaW5mbw0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBnZXRHYW1lSW5mbyh1aW50IF9oR2FtZSkgIGNvbnN0YW50ICByZXR1cm5zIChFbmRSZWFzb24gX3JlYXNvbiwgdWludCBfcGxheWVycywgdWludCBfdG90YWxQb3QsIGJvb2wgX2FjdGl2ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGdhbWVJbnN0YW5jZSB4Z2FtZSA9IGdhbWVzW19oR2FtZV07DQogICAgICAgICAgICAgICAgX2FjdGl2ZSA9IHhnYW1lLmFjdGl2ZTsNCiAgICAgICAgICAgICAgICBfcGxheWVycyA9IHhnYW1lLm51bVBsYXllcnM7DQogICAgICAgICAgICAgICAgX3RvdGFsUG90ID0geGdhbWUudG90YWxQb3Q7DQogICAgICAgICAgICAgICAgX3JlYXNvbiA9IHhnYW1lLnJlYXNvbkVuZGVkOw0KDQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyByZXR1cm4gYXJiVG9rZW4gYW5kIGxvdyBieXRlcyBmcm9tIGFuIEhHYW1lDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGNoZWNrSEdhbWUodWludCBfaEdhbWUpIGNvbnN0YW50IHJldHVybnModWludCBfYXJiVG9rLCB1aW50IF9sb3dXb3JkcykNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIF9hcmJUb2sgPSBBcmJUb2tGcm9tSEdhbWUoX2hHYW1lKTsNCiAgICAgICAgICAgICAgICBfbG93V29yZHMgPSBfaEdhbWUgJiAweGZmZmZmZmZmZmZmZjsNCg0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gZ2V0IG9wZXJhdGlvbiBnYXMgYW1vdW50cw0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBnZXRPcEdhcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgX2FnLCB1aW50IF90ZykgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBfYWcgPSBhY2N0Q2FsbEdhczsgLy8gd2lubmVyIHBhaWQNCiAgICAgICAgICAgICAgICBfdGcgPSB0b2tDYWxsR2FzOyAgICAgLy8gdG9rZW4gY29udHJhY3QgY2FsbCBnYXMNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gc2V0IG9wZXJhdGlvbiBnYXMgYW1vdW50cyBmb3IgZm9yd2FkaW5nIG9wZXJhdGlvbnMNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gc2V0T3BHYXModWludCBfYWcsIHVpbnQgX3RnKSANCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgICAgICAgICBhY2N0Q2FsbEdhcyA9IF9hZzsNCiAgICAgICAgICAgICAgICB0b2tDYWxsR2FzID0gX3RnOw0KICAgICAgICB9DQoNCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBzZXQgYSBtaWNoZWl2b3VzIGFyYml0ZXIgdG8gbG9ja2VkDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIHNldEFyYml0ZXJMb2NrZWQoYWRkcmVzcyBfYWRkciwgYm9vbCBfbG9jaykgIHB1YmxpYyANCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChvd25lciAhPSBtc2cuc2VuZGVyKSAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IA0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXZhbGlkQXJiMihfYWRkcikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiaW52YWxpZCBhcmIiKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgYXJiaXRlcnNbX2FkZHJdLmxvY2tlZCA9IF9sb2NrOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gZmx1c2ggdGhlIGhvdXNlIGZlZXMgd2hlbmV2ZXIgY29tbWFuZGVkIHRvLg0KICAgICAgICAvLyBpZ25vcmUgdGhlIHRocmVzaG9sZCBhbmQgdGhlIGxhc3QgcGF5b3V0IHRpbWUNCiAgICAgICAgLy8gYnV0IHRoaXMgdGltZSBvbmx5IHJlc2V0IGxhc3RwYXlvdXR0aW1lIHVwb24gc3VjY2Vzcw0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBmbHVzaEhvdXNlRmVlcygpDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJvbmx5IG93bmVyIGNhbGxzIHRoaXMgZnVuY3Rpb24iKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhvdXNlRmVlSG9sZG92ZXIgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IG50bXBobyA9IGhvdXNlRmVlSG9sZG92ZXI7DQogICAgICAgICAgICAgICAgICAgICAgICBob3VzZUZlZUhvbGRvdmVyID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdG9rZW5QYXJ0bmVyLmNhbGwuZ2FzKHRva0NhbGxHYXMpLnZhbHVlKG50bXBobykoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VzZUZlZUhvbGRvdmVyID0gbnRtcGhvOyAvLyBwdXQgaXQgYmFjaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkhvdXNlLUZlZSBFcnJvcjIiKTsgDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0UGF5b3V0VGltZSA9IG5vdzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJIb3VzZS1GZWUgUGFpZCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyB3aXRoZHJhdyBleHBlbnNlIGZ1bmRzIHRvIGFyYml0ZXINCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiB3aXRoZHJhd0FyYkZ1bmRzKCkgcHVibGljDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoIXZhbGlkQXJiMihtc2cuc2VuZGVyKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJpbnZhbGlkIGFyYml0ZXIiKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgYXJiaXRlciB4YXJiID0gYXJiaXRlcnNbbXNnLnNlbmRlcl07DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGFyYi5hcmJIb2xkb3ZlciA9PSAwKSB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIjAgQmFsYW5jZSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IF9hbW91bnQgPSB4YXJiLmFyYkhvbGRvdmVyOyANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGFyYi5hcmJIb2xkb3ZlciA9IDA7IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuY2FsbC5nYXMoYWNjdENhbGxHYXMpLnZhbHVlKF9hbW91bnQpKCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBzZXQgdGhlIHRva2VuIHBhcnRuZXINCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gc2V0VG9rZW5QYXJ0bmVyKGFkZHJlc3MgX2FkZHIpIHB1YmxpYw0KICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgICAgIH0gDQoNCiAgICAgICAgICAgICAgICBpZiAoKHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkgDQogICAgICAgICAgICAgICAgICAgICAgICAmJiAodG9rZW5QYXJ0bmVyID09IGFkZHJlc3MoMCkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblBhcnRuZXIgPSBfYWRkcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiVG9rZW4gUGFydG5lciBGaW5hbCEiKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNldHRpbmdzU3RhdGUgIT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5QYXJ0bmVyID0gX2FkZHI7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIlRva2VuIFBhcnRuZXIgQXNzaWduZWQhIik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHN3YXAgZXhlY3V0b3INCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9hZGRyKSANCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyDQogICAgICAgICAgICAgICAgICAgICAgICB8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpDQogICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgICAgICAgICBvd25lciA9IF9hZGRyOw0KICAgICAgICB9DQoNCn0='