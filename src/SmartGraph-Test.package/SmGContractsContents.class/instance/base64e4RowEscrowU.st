base 64 content
base64e4RowEscrowU
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC42Ow0KDQoNCmNvbnRyYWN0IGlFNFJvd0VzY3JvdyB7DQogICAgICAgIGZ1bmN0aW9uIGdldE51bUdhbWVzU3RhcnRlZCgpIGNvbnN0YW50IHJldHVybnMgKGludCBuZ2FtZXMpOw0KfQ0KDQoNCmNvbnRyYWN0IEU0Um93RXNjcm93VSBpcyBpRTRSb3dFc2Nyb3cgew0KDQpldmVudCBTdGF0RXZlbnQoc3RyaW5nIG1zZyk7DQpldmVudCBTdGF0RXZlbnRJKHN0cmluZyBtc2csIHVpbnQgdmFsKTsNCmV2ZW50IFN0YXRFdmVudEEoc3RyaW5nIG1zZywgYWRkcmVzcyBhZGRyKTsNCg0KICAgICAgICB1aW50IGNvbnN0YW50IE1BWF9QTEFZRVJTID0gNTsNCg0KICAgICAgICBlbnVtIEVuZFJlYXNvbiAge2VyV2lubmVyLCBlclRpbWVPdXQsIGVyQ2hlYXR9DQogICAgICAgIGVudW0gU2V0dGluZ1N0YXRlVmFsdWUgIHtkZWJ1ZywgcmVsZWFzZSwgbG9ja2VkUmVsZWFzZX0NCg0KICAgICAgICBzdHJ1Y3QgZ2FtZUluc3RhbmNlIHsNCiAgICAgICAgICAgICAgICBhZGRyZXNzWzVdIHBsYXllcnM7DQogICAgICAgICAgICAgICAgdWludFs1XSBwbGF5ZXJQb3RzOw0KICAgICAgICAgICAgICAgIHVpbnQgbnVtUGxheWVyczsNCg0KICAgICAgICAgICAgICAgIGJvb2wgYWN0aXZlOyAvLyBhY3RpdmUNCiAgICAgICAgICAgICAgICBib29sIGFsbG9jZDsgLy8gIGFsbG9jYXRlZCBhbHJlYWR5LiANCiAgICAgICAgICAgICAgICB1aW50IHN0YXJ0ZWQ7IC8vIHRpbWUgZ2FtZSBzdGFydGVkDQogICAgICAgICAgICAgICAgdWludCBsYXN0TW92ZWQ7IC8vIHRpbWUgZ2FtZSBsYXN0IG1vdmVkDQogICAgICAgICAgICAgICAgdWludCBwYXlvdXQ7IC8vIHBheW91dCBhbW9udA0KICAgICAgICAgICAgICAgIGFkZHJlc3Mgd2lubmVyOyAvLyBhZGRyZXNzIG9mIHdpbm5lcg0KDQoNCiAgICAgICAgICAgICAgICBFbmRSZWFzb24gcmVhc29uRW5kZWQ7IC8vIGVudW0gcmVhc29uIG9mIGVuZGVkDQoNCiAgICAgICAgfQ0KDQogICAgICAgIHN0cnVjdCBhcmJpdGVyIHsNCiAgICAgICAgICAgICAgICBtYXBwaW5nICh1aW50ID0+IHVpbnQpICBnYW1lSW5kZXhlczsgLy8gZ2FtZSBoYW5kbGVzDQoNCiAgICAgICAgICAgICAgICB1aW50IGFyYlRva2VuOyAvLyAyIGJ5dGVzDQogICAgICAgICAgICAgICAgdWludCBnYW1lU2xvdHM7IC8vIGEgY291bnRlciBvZiBhbGxvYydkIGdhbWUgc3RydWN0cyAodGhleSBjYW4gYmUgcmV1c2VkKQ0KICAgICAgICAgICAgICAgIHVpbnQgZ2FtZXNTdGFydGVkOyAvLyB0b3RhbCBnYW1lcyBzdGFydGVkDQogICAgICAgICAgICAgICAgdWludCBnYW1lc0NvbXBsZXRlZDsNCiAgICAgICAgICAgICAgICB1aW50IGdhbWVzQ2hlYXRlZDsNCiAgICAgICAgICAgICAgICB1aW50IGdhbWVzVGltZWRvdXQ7DQogICAgICAgICAgICAgICAgdWludCBudW1QbGF5ZXJzOw0KICAgICAgICAgICAgICAgIGJvb2wgcmVnaXN0ZXJlZDsgDQogICAgICAgICAgICAgICAgYm9vbCBsb2NrZWQ7DQogICAgICAgIH0NCg0KDQogICAgICAgIGFkZHJlc3MgcHVibGljICBvd25lcjsgIC8vIG93bmVyIGlzIGFkZHJlc3MgdGhhdCBkZXBsb3llZCBjb250cmFjdA0KICAgICAgICBhZGRyZXNzIHB1YmxpYyAgdG9rZW5QYXJ0bmVyOyAgIC8vIHRoZSBhZGRyZXNzIG9mIHBhcnRuZXIgdGhhdCByZWNlaXZlcyByYWtlIGZlZXMNCiAgICAgICAgdWludCBwdWJsaWMgbnVtQXJiaXRlcnM7ICAgICAgICAvLyBudW1iZXIgb2YgYXJiaXRlcnMNCg0KICAgICAgICBpbnQgbnVtR2FtZXNTdGFydGVkOyAgICAvLyB0b3RhbCBzdGF0cyBmcm9tIGFsbCBhcmJpdGVycw0KDQogICAgICAgIHVpbnQgcHVibGljIG51bUdhbWVzQ29tcGxldGVkOyAvLyAuLi4NCiAgICAgICAgdWludCBwdWJsaWMgbnVtR2FtZXNDaGVhdGVkOyAgICAvLyAuLi4NCiAgICAgICAgdWludCBwdWJsaWMgbnVtR2FtZXNUaW1lZE91dDsgICAvLyAuLi4NCg0KICAgICAgICB1aW50IHB1YmxpYyBob3VzZUZlZUhvbGRvdmVyOyAvLyBob2xkIGZlZSB0aWxsIHRocmVzaG9sZA0KICAgICAgICB1aW50IHB1YmxpYyBsYXN0UGF5b3V0VGltZTsgICAgIC8vIHRpbWVzdGFtcCBvZiBsYXN0IHBheW91dCB0aW1lDQoNCg0KICAgICAgICAvLyBjb25maWd1cmFibGVzDQogICAgICAgIHVpbnQgcHVibGljIGdhbWVUaW1lT3V0Ow0KICAgICAgICB1aW50IHB1YmxpYyByZWdpc3RyYXRpb25GZWU7DQogICAgICAgIHVpbnQgcHVibGljIGhvdXNlRmVlVGhyZXNob2xkOw0KICAgICAgICB1aW50IHB1YmxpYyBwYXlvdXRJbnRlcnZhbDsNCg0KICAgICAgICB1aW50IHJhR2FzOyAvLyBmb3IgcmVnaXN0ZXIgYXJiDQogICAgICAgIHVpbnQgc2dHYXM7Ly8gZm9yIHN0YXJ0IGdhbWUNCiAgICAgICAgdWludCB3cEdhczsgLy8gZm9yIHdpbm5lciBwYWlkDQogICAgICAgIHVpbnQgcmZHYXM7IC8vIGZvciByZWZ1bmQNCiAgICAgICAgdWludCBmZWVHYXM7IC8vIGZvciByYWtlIGZlZSBwYXlvdXQNCg0KICAgICAgICBTZXR0aW5nU3RhdGVWYWx1ZSBwdWJsaWMgc2V0dGluZ3NTdGF0ZSA9IFNldHRpbmdTdGF0ZVZhbHVlLmRlYnVnOyANCg0KDQogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYXJiaXRlcikgIGFyYml0ZXJzOw0KICAgICAgICBtYXBwaW5nICh1aW50ID0+IGFkZHJlc3MpICBhcmJpdGVyVG9rZW5zOw0KICAgICAgICBtYXBwaW5nICh1aW50ID0+IGFkZHJlc3MpICBhcmJpdGVySW5kZXhlczsNCiAgICAgICAgbWFwcGluZyAodWludCA9PiBnYW1lSW5zdGFuY2UpICBnYW1lczsNCg0KDQogICAgICAgIGZ1bmN0aW9uIEU0Um93RXNjcm93VSgpIHB1YmxpYw0KICAgICAgICB7DQogICAgICAgICAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgICAgICB9DQoNCg0KICAgICAgICBmdW5jdGlvbiBhcHBseVNldHRpbmdzKFNldHRpbmdTdGF0ZVZhbHVlIF9zdGF0ZSwgdWludCBfZmVlLCB1aW50IF90aHJlc2hvbGQsIHVpbnQgX3RpbWVvdXQsIHVpbnQgX2ludGVydmFsKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIA0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgLy8gdGhlc2UgaXRlbXMgYXJlIHR3ZWFrYWJsZSBmb3IgZ2FtZSBvcHRpbWl6YXRpb24NCiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgaG91c2VGZWVUaHJlc2hvbGQgPSBfdGhyZXNob2xkOw0KICAgICAgICAgICAgICAgIGdhbWVUaW1lT3V0ID0gX3RpbWVvdXQ7DQogICAgICAgICAgICAgICAgcGF5b3V0SW50ZXJ2YWwgPSBfaW50ZXJ2YWw7DQoNCiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5sb2NrZWRSZWxlYXNlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIlNldHRpbmdzIFR3ZWFrZWQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBzZXR0aW5nc1N0YXRlID0gX3N0YXRlOw0KICAgICAgICAgICAgICAgIHJlZ2lzdHJhdGlvbkZlZSA9IF9mZWU7DQoNCiAgICAgICAgICAgICAgICAvLyBzZXQgZGVmYXVsdCBvcCBnYXMgLSAgYW55IGZ1dGhlciBzZXR0aW5ncyBkb25lIGluIHNldCB1cCBnYXMNCiAgICAgICAgICAgICAgICByYUdhcyA9IDE1MDAwMDsgDQogICAgICAgICAgICAgICAgc2dHYXMgPSAxMTAwMDA7DQogICAgICAgICAgICAgICAgd3BHYXMgPSAyMDAwMDsgDQogICAgICAgICAgICAgICAgcmZHYXMgPSAyMDAwMDsgDQogICAgICAgICAgICAgICAgZmVlR2FzID0gMzYwMDAwOyANCg0KICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiU2V0dGluZ3MgQ2hhbmdlZCIpOw0KDQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gcmV0dXJuIGFuIGFyYml0ZXIgdG9rZW4gZnJvbSBhbiBoR2FtZQ0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIEFyYlRva0Zyb21IR2FtZSh1aW50IF9oR2FtZSkgcmV0dXJucyAodWludCBfdG9rKQ0KICAgICAgICB7IA0KICAgICAgICAgICAgICAgIF90b2sgPSAgKF9oR2FtZSAvICgyICoqIDQ4KSkgJiAweGZmZmY7DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gc3VpY2lkZSB0aGUgY29udHJhY3QsIG5vdCBjYWxsZWQgZm9yIHJlbGVhc2UNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBIYXJhS2lyaSgpDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoKG1zZy5zZW5kZXIgPT0gb3duZXIpICYmIChzZXR0aW5nc1N0YXRlICE9IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICBzdWljaWRlKHRva2VuUGFydG5lcik7DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJLaWxsIGF0dGVtcHQgZmFpbGVkIik7DQogICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGRlZmF1bHQgZnVuY3Rpb24NCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbigpIHBheWFibGUgIHsNCiAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGNoZWNrIGFjdGl2ZSBnYW1lIGFuZCB2YWxpZCBwbGF5ZXIsIHJldHVybiBwbGF5ZXIgaW5kZXgNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIHZhbGlkUGxheWVyKHVpbnQgX2hHYW1lLCBhZGRyZXNzIF9hZGRyKSAgaW50ZXJuYWwgcmV0dXJucyggYm9vbCBfdmFsaWQsIHVpbnQgX3BpZHgpDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBfdmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlR2FtZShfaEdhbWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBnYW1lc1tfaEdhbWVdLm51bVBsYXllcnM7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZXNbX2hHYW1lXS5wbGF5ZXJzW2ldID09IF9hZGRyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3ZhbGlkPXRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3BpZHggPSBpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gY2hlY2sgdmFsaWQgcGxheWVyLCByZXR1cm4gcGxheWVyIGluZGV4DQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiB2YWxpZFBsYXllcjIodWludCBfaEdhbWUsIGFkZHJlc3MgX2FkZHIpIGludGVybmFsICByZXR1cm5zKCBib29sIF92YWxpZCwgdWludCBfcGlkeCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIF92YWxpZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGdhbWVzW19oR2FtZV0ubnVtUGxheWVyczsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZXNbX2hHYW1lXS5wbGF5ZXJzW2ldID09IF9hZGRyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF92YWxpZD10cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGlkeCA9IGk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGNoZWNrIHRoZSBhcmJpdGVyIGlzIHZhbGlkIGJ5IGNvbXBhcmluZyB0b2tlbg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiB2YWxpZEFyYihhZGRyZXNzIF9hZGRyLCB1aW50IF90b2spIGludGVybmFsICByZXR1cm5zKCBib29sIF92YWxpZCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIF92YWxpZCA9IGZhbHNlOw0KDQogICAgICAgICAgICAgICAgaWYgKChhcmJpdGVyc1tfYWRkcl0ucmVnaXN0ZXJlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICYmIChhcmJpdGVyc1tfYWRkcl0uYXJiVG9rZW4gPT0gX3RvaykpIA0KICAgICAgICAgICAgICAgICAgICAgICAgX3ZhbGlkID0gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGNoZWNrIHRoZSBhcmJpdGVyIGlzIHZhbGlkIHdpdGhvdXQgY29tcGFyaW5nIHRva2VuDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIHZhbGlkQXJiMihhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCAgcmV0dXJucyggYm9vbCBfdmFsaWQpDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBfdmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBpZiAoYXJiaXRlcnNbX2FkZHJdLnJlZ2lzdGVyZWQpDQogICAgICAgICAgICAgICAgICAgICAgICBfdmFsaWQgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gY2hlY2sgaWYgYXJiaXRlciBpcyBsb2NrZWQgb3V0DQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGFyYkxvY2tlZChhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCAgcmV0dXJucyggYm9vbCBfbG9ja2VkKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgX2xvY2tlZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGlmICh2YWxpZEFyYjIoX2FkZHIpKSANCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2NrZWQgPSBhcmJpdGVyc1tfYWRkcl0ubG9ja2VkOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gcmV0dXJuIGlmIGdhbWUgaXMgYWN0aXZlDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGFjdGl2ZUdhbWUodWludCBfaEdhbWUpIGludGVybmFsICByZXR1cm5zKCBib29sIF92YWxpZCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIF92YWxpZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGlmICgoX2hHYW1lID4gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgICYmIChnYW1lc1tfaEdhbWVdLmFjdGl2ZSkpDQogICAgICAgICAgICAgICAgICAgICAgICBfdmFsaWQgPSB0cnVlOw0KICAgICAgICB9DQoNCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyByZWdpc3RlciBnYW1lIGFyYml0ZXIsIG1heCBwbGF5ZXJzIG9mIDUsIHBhc3MgaW4gZXhhY3QgcmVnaXN0cmF0aW9uIGZlZQ0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiByZWdpc3RlckFyYml0ZXIodWludCBfbnVtUGxheWVycywgdWludCBfYXJiVG9rZW4pIHB1YmxpYyBwYXlhYmxlIA0KICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICBpZiAobXNnLnZhbHVlICE9IHJlZ2lzdHJhdGlvbkZlZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7ICAvL0luc3VmZmljaWVudCBGZWUNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoX2FyYlRva2VuID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyAvLyBpbnZhbGlkIHRva2VuDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGFyYlRva2VuRXhpc3RzKF9hcmJUb2tlbiAmIDB4ZmZmZikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyAvLyBUb2tlbiBBbHJlYWR5IEV4aXN0cw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChhcmJpdGVyc1ttc2cuc2VuZGVyXS5yZWdpc3RlcmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsgLy8gQXJiIEFscmVhZHkgUmVnaXN0ZXJlZA0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChfbnVtUGxheWVycyA+IE1BWF9QTEFZRVJTKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsgLy8gRXhjZWVkcyBNYXggUGxheWVycw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGFyYml0ZXJzW21zZy5zZW5kZXJdLmdhbWVzU3RhcnRlZCA9IDA7DQogICAgICAgICAgICAgICAgYXJiaXRlcnNbbXNnLnNlbmRlcl0uZ2FtZXNDb21wbGV0ZWQgPSAwOw0KICAgICAgICAgICAgICAgIGFyYml0ZXJzW21zZy5zZW5kZXJdLmdhbWVzQ2hlYXRlZCA9IDA7DQogICAgICAgICAgICAgICAgYXJiaXRlcnNbbXNnLnNlbmRlcl0uZ2FtZXNUaW1lZG91dCA9IDA7DQogICAgICAgICAgICAgICAgYXJiaXRlcnNbbXNnLnNlbmRlcl0ubG9ja2VkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgYXJiaXRlcnNbbXNnLnNlbmRlcl0uYXJiVG9rZW4gPSBfYXJiVG9rZW4gJiAweGZmZmY7DQogICAgICAgICAgICAgICAgYXJiaXRlcnNbbXNnLnNlbmRlcl0ubnVtUGxheWVycyA9IF9udW1QbGF5ZXJzOw0KICAgICAgICAgICAgICAgIGFyYml0ZXJzW21zZy5zZW5kZXJdLnJlZ2lzdGVyZWQgPSB0cnVlOw0KDQogICAgICAgICAgICAgICAgYXJiaXRlclRva2Vuc1soX2FyYlRva2VuICYgMHhmZmZmKV0gPSBtc2cuc2VuZGVyOw0KICAgICAgICAgICAgICAgIGFyYml0ZXJJbmRleGVzW251bUFyYml0ZXJzKytdID0gbXNnLnNlbmRlcjsNCg0KDQogICAgICAgICAgICAgICAgaWYgKCF0b2tlblBhcnRuZXIuY2FsbC5nYXMocmFHYXMpLnZhbHVlKG1zZy52YWx1ZSkoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9TdGF0dmVudCgiU2VuZCBFcnJvciIpOyAvLyBldmVudCBuZXZlciByZWdpc3RlcnMNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBTdGF0RXZlbnRJKCJBcmIgQWRkZWQiLCBfYXJiVG9rZW4pOw0KICAgICAgICB9DQoNCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBzdGFydCBnYW1lLiAgcGFzcyBpbiB2YWxpZCBoR2FtZSBjb250YWluaW5nIHRva2VuIGluIHRvcCB0d28gYnl0ZXMNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gc3RhcnRHYW1lKHVpbnQgX2hHYW1lLCBpbnQgX2hrTWF4LCBhZGRyZXNzW10gX3BsYXllcnMpIHB1YmxpYyANCiAgICAgICAgew0KICAgICAgICAgICAgICAgIHVpbnQgbnRvayA9IEFyYlRva0Zyb21IR2FtZShfaEdhbWUpOw0KICAgICAgICAgICAgICAgIGlmICghdmFsaWRBcmIobXNnLnNlbmRlciwgbnRvayApKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkludmFsaWQgQXJiIik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IA0KICAgICAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAgICAgaWYgKGFyYkxvY2tlZChtc2cuc2VuZGVyKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJBcmIgTG9ja2VkIik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IA0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGFyYml0ZXIgeGFyYiA9IGFyYml0ZXJzW21zZy5zZW5kZXJdOw0KICAgICAgICAgICAgICAgIGlmIChfcGxheWVycy5sZW5ndGggIT0geGFyYi5udW1QbGF5ZXJzKSB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJJbmNvcnJlY3QgbnVtIHBsYXllcnMiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKF9oa01heCA+IDApDQogICAgICAgICAgICAgICAgICAgICAgICBob3VzZUtlZXAoX2hrTWF4LCBudG9rKTsgDQoNCiAgICAgICAgICAgICAgICBpZiAoIWdhbWVzW19oR2FtZV0uYWxsb2NkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lc1tfaEdhbWVdLmFsbG9jZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB4YXJiLmdhbWVJbmRleGVzW3hhcmIuZ2FtZVNsb3RzKytdID0gX2hHYW1lOw0KICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgbnVtR2FtZXNTdGFydGVkKys7IC8vIGFsd2F5cyBpbmMgdGhpcyBvbmUNCiAgICAgICAgICAgICAgICB4YXJiLmdhbWVzU3RhcnRlZCsrOw0KDQogICAgICAgICAgICAgICAgZ2FtZXNbX2hHYW1lXS5hY3RpdmUgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGdhbWVzW19oR2FtZV0uc3RhcnRlZCA9IG5vdzsgDQogICAgICAgICAgICAgICAgZ2FtZXNbX2hHYW1lXS5sYXN0TW92ZWQgPSBub3c7IA0KICAgICAgICAgICAgICAgIGdhbWVzW19oR2FtZV0ucGF5b3V0ID0gMDsgDQogICAgICAgICAgICAgICAgZ2FtZXNbX2hHYW1lXS53aW5uZXIgPSBhZGRyZXNzKDApOw0KDQogICAgICAgICAgICAgICAgZ2FtZXNbX2hHYW1lXS5udW1QbGF5ZXJzID0gX3BsYXllcnMubGVuZ3RoOyAvLyB3ZSdsbCBiZSB0aGUganVkZ2Ugb2YgaG93IG1hbnkgdW5pcXVlIHBsYXllcnMNCiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGk8IF9wbGF5ZXJzLmxlbmd0aCAmJiBpIDwgTUFYX1BMQVlFUlM7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBnYW1lc1tfaEdhbWVdLnBsYXllcnNbaV0gPSBfcGxheWVyc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgZ2FtZXNbX2hHYW1lXS5wbGF5ZXJQb3RzW2ldID0gMDsNCiAgICAgICAgICAgICAgICB9DQoNCg0KICAgICAgICAgICAgICAgIFN0YXRFdmVudEkoIkdhbWUgQWRkZWQiLCBfaEdhbWUpOw0KDQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGNsZWFuIHVwIGdhbWUsIHNldCB0byBpbmFjdGl2ZSwgcmVmdW5kIGFueSBiYWxhbmNlcw0KICAgICAgICAvLyBjYWxsZWQgYnkgaG91c2VrZWVwIE9OTFkNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gYWJvcnRHYW1lKGFkZHJlc3MgX2FyYiwgdWludCAgX2hHYW1lLCBFbmRSZWFzb24gX3JlYXNvbikgcHJpdmF0ZSByZXR1cm5zKGJvb2wgX3N1Y2Nlc3MpDQogICAgICAgIHsNCiAgICAgICAgICAgICBnYW1lSW5zdGFuY2UgbkdhbWUgPSBnYW1lc1tfaEdhbWVdOw0KICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIGZpbmQgZ2FtZSBpbiBnYW1lIGlkLCANCiAgICAgICAgICAgICAgICBpZiAobkdhbWUuYWN0aXZlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBfc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBuR2FtZS5udW1QbGF5ZXJzOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5HYW1lLnBsYXllclBvdHNbaV0gPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBhID0gbkdhbWUucGxheWVyc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IG5zZW5kID0gbkdhbWUucGxheWVyUG90c1tpXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuR2FtZS5wbGF5ZXJQb3RzW2ldID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWEuY2FsbC5nYXMocmZHYXMpLnZhbHVlKG5zZW5kKSgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VzZUZlZUhvbGRvdmVyICs9IG5zZW5kOyAvLyBjYW5ub3QgcmVmdW5kIGR1ZSB0byBlcnJvciwgZ2l2ZSB0byB0aGUgaG91c2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudEEoIkNhbm5vdCBSZWZ1bmQgQWRkcmVzcyIsIGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgbkdhbWUuYWN0aXZlID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICBuR2FtZS5yZWFzb25FbmRlZCA9IF9yZWFzb247DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3JlYXNvbiA9PSBFbmRSZWFzb24uZXJDaGVhdCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1HYW1lc0NoZWF0ZWQrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJiaXRlcnNbX2FyYl0uZ2FtZXNDaGVhdGVkKys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiR2FtZSBBYm9ydGVkLUNoZWF0Iik7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9yZWFzb24gPT0gRW5kUmVhc29uLmVyVGltZU91dCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1HYW1lc1RpbWVkT3V0Kys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyYml0ZXJzW19hcmJdLmdhbWVzVGltZWRvdXQrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJHYW1lIEFib3J0ZWQtVGltZU91dCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkdhbWUgQWJvcnRlZCEiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGNhbGxlZCBieSBhcmJpdGVyIHdoZW4gd2lubmVyIGlzIGRlY2lkZWQNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gd2lubmVyRGVjaWRlZCh1aW50IF9oR2FtZSwgYWRkcmVzcyBfd2lubmVyLCB1aW50IF93aW5uZXJCYWwpIHB1YmxpYw0KICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICBpZiAoIXZhbGlkQXJiKG1zZy5zZW5kZXIsIEFyYlRva0Zyb21IR2FtZShfaEdhbWUpKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJJbnZhbGlkIEFyYiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBubyB0aHJvdyBubyBjaGFuZ2UgbWFkZQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHZhciAodmFsaWQsIHBpZHgpID0gdmFsaWRQbGF5ZXIoX2hHYW1lLCBfd2lubmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIXZhbGlkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkludmFsaWQgUGxheWVyIik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYXJiaXRlciB4YXJiID0gYXJiaXRlcnNbbXNnLnNlbmRlcl07DQogICAgICAgICAgICAgICAgZ2FtZUluc3RhbmNlIHhnYW1lID0gZ2FtZXNbX2hHYW1lXTsNCg0KICAgICAgICAgICAgICAgIHVpbnQgdG90YWxQb3QgPSAwOw0KDQogICAgICAgICAgICAgICAgaWYgKHhnYW1lLnBsYXllclBvdHNbcGlkeF0gIT0gX3dpbm5lckJhbCkgew0KICAgICAgICAgICAgICAgICAgICBhYm9ydEdhbWUobXNnLnNlbmRlciwgX2hHYW1lLCBFbmRSZWFzb24uZXJDaGVhdCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB4Z2FtZS5udW1QbGF5ZXJzOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsUG90ICs9IHhnYW1lLnBsYXllclBvdHNbaV07DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdWludCBucG9ydGlvbjsNCiAgICAgICAgICAgICAgICB1aW50IG5yZW1uYW50Ow0KICAgICAgICAgICAgICAgIGlmICh0b3RhbFBvdCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5wb3J0aW9uID0gdG90YWxQb3QvNTA7IC8vIDIgcGVyY2VudCBmaXhlZA0KICAgICAgICAgICAgICAgICAgICAgICAgbnJlbW5hbnQgPSB0b3RhbFBvdC1ucG9ydGlvbjsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgbnBvcnRpb24gPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgbnJlbW5hbnQgPSAwOw0KICAgICAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAgICAgeGdhbWUubGFzdE1vdmVkID0gbm93Ow0KICAgICAgICAgICAgICAgIHhnYW1lLmFjdGl2ZSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHhnYW1lLnJlYXNvbkVuZGVkID0gRW5kUmVhc29uLmVyV2lubmVyOw0KICAgICAgICAgICAgICAgIHhnYW1lLndpbm5lciA9IF93aW5uZXI7DQogICAgICAgICAgICAgICAgeGdhbWUucGF5b3V0ID0gbnJlbW5hbnQ7DQoNCiAgICAgICAgICAgICAgICBpZiAobnBvcnRpb24gPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBob3VzZUZlZUhvbGRvdmVyICs9IG5wb3J0aW9uOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChob3VzZUZlZUhvbGRvdmVyID4gaG91c2VGZWVUaHJlc2hvbGQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIChub3cgPiAobGFzdFBheW91dFRpbWUgKyBwYXlvdXRJbnRlcnZhbCkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbnRtcGhvID0gaG91c2VGZWVIb2xkb3ZlcjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RQYXlvdXRUaW1lID0gbm93OyAvLyByZXNldCByZWdhcmRsZXNzIG9mIHN1Y2NlZWQvZmFpbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRva2VuUGFydG5lci5jYWxsLmdhcyhmZWVHYXMpLnZhbHVlKG50bXBobykoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXNlRmVlSG9sZG92ZXIgPSBudG1waG87IC8vIHB1dCBpdCBiYWNrDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJIb3VzZS1GZWUgRXJyb3IxIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHhnYW1lLm51bVBsYXllcnM7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgeGdhbWUucGxheWVyUG90c1tpXSA9IDA7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgeGFyYi5nYW1lc0NvbXBsZXRlZCsrOw0KICAgICAgICAgICAgICAgIG51bUdhbWVzQ29tcGxldGVkKys7DQogICAgICAgICAgICAgICAgaWYgKG5yZW1uYW50ID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfd2lubmVyLmNhbGwuZ2FzKHdwR2FzKS52YWx1ZSh1aW50KG5yZW1uYW50KSkoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGF0RXZlbnQoIlNlbmQgRXJyb3IiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IC8vIGlmIHlvdSBjYW50IHBheSB0aGUgd2lubmVyIC0gdmVyeSBiYWQNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudEkoIldpbm5lciBQYWlkIiwgX2hHYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBoYW5kbGUgYSBiZXQgbWFkZSBieSBhIHBsYXllciwgdmFsaWRhdGUgdGhlIHBsYXllciBhbmQgZ2FtZQ0KICAgICAgICAvLyBhZGQgdG8gcGxheWVycyBiYWxhbmNlDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUJldCh1aW50IF9oR2FtZSkgcHVibGljIHBheWFibGUgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBhZGRyZXNzIG5hcmIgPSBhcmJpdGVyVG9rZW5zW0FyYlRva0Zyb21IR2FtZShfaEdhbWUpXTsNCiAgICAgICAgICAgICAgICBpZiAobmFyYiA9PSBhZGRyZXNzKDApKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkludmFsaWQgaEdhbWUiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5nc1N0YXRlICE9IFNldHRpbmdTdGF0ZVZhbHVlLmRlYnVnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHZhciAodmFsaWQsIHBpZHgpID0gdmFsaWRQbGF5ZXIoX2hHYW1lLCBtc2cuc2VuZGVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIXZhbGlkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkludmFsaWQgUGxheWVyIik7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3NTdGF0ZSAhPSBTZXR0aW5nU3RhdGVWYWx1ZS5kZWJ1ZykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBnYW1lc1tfaEdhbWVdLnBsYXllclBvdHNbcGlkeF0gKz0gbXNnLnZhbHVlOw0KICAgICAgICAgICAgICAgIGdhbWVzW19oR2FtZV0ubGFzdE1vdmVkID0gbm93Ow0KDQogICAgICAgICAgICAgICAgU3RhdEV2ZW50SSgiQmV0IEFkZGVkIiwgX2hHYW1lKTsNCg0KICAgICAgICB9DQoNCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyByZXR1cm4gaWYgYXJiIHRva2VuIGV4aXN0cw0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBhcmJUb2tlbkV4aXN0cyh1aW50IF90b2spIGNvbnN0YW50IHJldHVybnMgKGJvb2wgX2V4aXN0cykNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIF9leGlzdHMgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBpZiAoKF90b2sgPiAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgKGFyYml0ZXJUb2tlbnNbX3Rva10gIT0gYWRkcmVzcygwKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICYmIGFyYml0ZXJzW2FyYml0ZXJUb2tlbnNbX3Rva11dLnJlZ2lzdGVyZWQpDQogICAgICAgICAgICAgICAgICAgICAgICBfZXhpc3RzID0gdHJ1ZTsNCg0KICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gY2FsbGVkIGJ5IGljbyB0b2tlbiBjb250cmFjdCANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gZ2V0TnVtR2FtZXNTdGFydGVkKCkgY29uc3RhbnQgcmV0dXJucyAoaW50IF9nYW1lcykgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBfZ2FtZXMgPSBudW1HYW1lc1N0YXJ0ZWQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyByZXR1cm4gYXJiaXRlciBnYW1lIHN0YXRzDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGdldEFyYkluZm8odWludCBfaWR4KSBjb25zdGFudCAgcmV0dXJucyAoYWRkcmVzcyBfYWRkciwgdWludCBfc3RhcnRlZCwgdWludCBfY29tcGxldGVkLCB1aW50IF9jaGVhdGVkLCB1aW50IF90aW1lZE91dCkgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoX2lkeCA+PSBudW1BcmJpdGVycykgew0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJJbnZhbGlkIEFyYiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBfYWRkciA9IGFyYml0ZXJJbmRleGVzW19pZHhdOw0KICAgICAgICAgICAgICAgIGlmICgoX2FkZHIgPT0gYWRkcmVzcygwKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICghYXJiaXRlcnNbX2FkZHJdLnJlZ2lzdGVyZWQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkludmFsaWQgQXJiIik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGFyYml0ZXIgeGFyYiA9IGFyYml0ZXJzW19hZGRyXTsNCiAgICAgICAgICAgICAgICBfc3RhcnRlZCA9IHhhcmIuZ2FtZXNTdGFydGVkOw0KICAgICAgICAgICAgICAgIF9jb21wbGV0ZWQgPSB4YXJiLmdhbWVzQ29tcGxldGVkOw0KICAgICAgICAgICAgICAgIF90aW1lZE91dCA9IHhhcmIuZ2FtZXNUaW1lZG91dDsNCiAgICAgICAgICAgICAgICBfY2hlYXRlZCA9IHhhcmIuZ2FtZXNDaGVhdGVkOw0KICAgICAgICB9DQoNCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBzY2FuIGZvciBhIGdhbWUgMTAgbWludXRlcyBvbGQNCiAgICAgICAgLy8gaWYgZm91bmQgYWJvcnQgdGhlIGdhbWUsIGNhdXNpbmcgZnVuZHMgdG8gYmUgcmV0dXJuZWQNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gaG91c2VLZWVwKGludCBfbWF4LCB1aW50IF9hcmJUb2tlbikgcHVibGljDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICB1aW50IGdpOw0KICAgICAgICAgICAgICAgIGFkZHJlc3MgYTsNCiAgICAgICAgICAgICAgICBpbnQgYWJvcnRlZCA9IDA7DQoNCiAgICAgICAgICAgICAgICBhcmJpdGVyIHhhcmIgPSBhcmJpdGVyc1ttc2cuc2VuZGVyXTsvLyBoYXZlIHRvIHNldCBpdCB0byBzb21ldGhpbmcNCiAgICAgICAgICAgICAgICANCiAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyID09IG93bmVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHVpbnQgYXIgPSAwOyAoYXIgPCBudW1BcmJpdGVycykgJiYgKGFib3J0ZWQgPCBfbWF4KSA7IGFyKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gYXJiaXRlckluZGV4ZXNbYXJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhhcmIgPSBhcmJpdGVyc1thXTsgICAgDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCBnaSA9IDA7IChnaSA8IHhhcmIuZ2FtZVNsb3RzKSAmJiAoYWJvcnRlZCA8IF9tYXgpOyBnaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWVJbnN0YW5jZSBuZ2FtZTAgPSBnYW1lc1t4YXJiLmdhbWVJbmRleGVzW2dpXV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobmdhbWUwLmFjdGl2ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICgobm93IC0gbmdhbWUwLmxhc3RNb3ZlZCkgPiBnYW1lVGltZU91dCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydEdhbWUoYSwgeGFyYi5nYW1lSW5kZXhlc1tnaV0sIEVuZFJlYXNvbi5lclRpbWVPdXQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsrYWJvcnRlZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbGlkQXJiKG1zZy5zZW5kZXIsIF9hcmJUb2tlbikpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiSG91c2VrZWVwIGludmFsaWQgYXJiaXRlciIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IG1zZy5zZW5kZXI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeGFyYiA9IGFyYml0ZXJzW2FdOyAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGdpID0gMDsgKGdpIDwgeGFyYi5nYW1lU2xvdHMpICYmIChhYm9ydGVkIDwgX21heCk7IGdpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZUluc3RhbmNlIG5nYW1lMSA9IGdhbWVzW3hhcmIuZ2FtZUluZGV4ZXNbZ2ldXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChuZ2FtZTEuYWN0aXZlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgKChub3cgLSBuZ2FtZTEubGFzdE1vdmVkKSA+IGdhbWVUaW1lT3V0KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0R2FtZShhLCB4YXJiLmdhbWVJbmRleGVzW2dpXSwgRW5kUmVhc29uLmVyVGltZU91dCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKythYm9ydGVkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyByZXR1cm4gZ2FtZSBpbmZvDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGdldEdhbWVJbmZvKHVpbnQgX2hHYW1lKSAgY29uc3RhbnQgIHJldHVybnMgKEVuZFJlYXNvbiBfcmVhc29uLCB1aW50IF9wbGF5ZXJzLCB1aW50IF9wYXlvdXQsIGJvb2wgX2FjdGl2ZSwgYWRkcmVzcyBfd2lubmVyICkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGdhbWVJbnN0YW5jZSBuZ2FtZSA9IGdhbWVzW19oR2FtZV07DQogICAgICAgICAgICAgICAgX2FjdGl2ZSA9IG5nYW1lLmFjdGl2ZTsNCiAgICAgICAgICAgICAgICBfcGxheWVycyA9IG5nYW1lLm51bVBsYXllcnM7DQogICAgICAgICAgICAgICAgX3dpbm5lciA9IG5nYW1lLndpbm5lcjsNCiAgICAgICAgICAgICAgICBfcGF5b3V0ID0gbmdhbWUucGF5b3V0Ow0KICAgICAgICAgICAgICAgIF9yZWFzb24gPSBuZ2FtZS5yZWFzb25FbmRlZDsNCg0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gcmV0dXJuIGFyYlRva2VuIGFuZCBsb3cgYnl0ZXMgZnJvbSBhbiBIR2FtZQ0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBjaGVja0hHYW1lKHVpbnQgX2hHYW1lKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX2FyYlRvaywgdWludCBfbG93V29yZHMpDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBfYXJiVG9rID0gQXJiVG9rRnJvbUhHYW1lKF9oR2FtZSk7DQogICAgICAgICAgICAgICAgX2xvd1dvcmRzID0gX2hHYW1lICYgMHhmZmZmZmZmZmZmZmY7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGdldCBvcGVyYXRpb24gZ2FzIGFtb3VudHMNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gZ2V0T3BHYXMoKSBjb25zdGFudCByZXR1cm5zICh1aW50IF9yYSwgdWludCBfc2csIHVpbnQgX3dwLCB1aW50IF9yZiwgdWludCBfZmcpIA0KICAgICAgICB7DQogICAgICAgICAgICAgICAgX3JhID0gcmFHYXM7IC8vIHJlZ2lzdGVyIGFyYg0KICAgICAgICAgICAgICAgIF9zZyA9IHNnR2FzOyAvLyBzdGFydCBnYW1lDQogICAgICAgICAgICAgICAgX3dwID0gd3BHYXM7IC8vIHdpbm5lciBwYWlkDQogICAgICAgICAgICAgICAgX3JmID0gcmZHYXM7IC8vIHJlZnVuZA0KICAgICAgICAgICAgICAgIF9mZyA9IGZlZUdhczsgLy8gcmFrZSBmZWUgZ2FzDQogICAgICAgIH0NCg0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHNldCBvcGVyYXRpb24gZ2FzIGFtb3VudHMgZm9yIGZvcndhZGluZyBvcGVyYXRpb25zDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIHNldE9wR2FzKHVpbnQgX3JhLCB1aW50IF9zZywgdWludCBfd3AsIHVpbnQgX3JmLCB1aW50IF9mZykgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgICAgICAgICAgcmFHYXMgPSBfcmE7DQogICAgICAgICAgICAgICAgc2dHYXMgPSBfc2c7DQogICAgICAgICAgICAgICAgd3BHYXMgPSBfd3A7DQogICAgICAgICAgICAgICAgcmZHYXMgPSBfcmY7DQogICAgICAgICAgICAgICAgZmVlR2FzID0gX2ZnOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gc2V0IGEgbWljaGVpdm91cyBhcmJpdGVyIHRvIGxvY2tlZA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBzZXRBcmJpdGVyTG9ja2VkKGFkZHJlc3MgX2FkZHIsIGJvb2wgX2xvY2spICBwdWJsaWMgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAob3duZXIgIT0gbXNnLnNlbmRlcikgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyANCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF2YWxpZEFyYjIoX2FkZHIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoImludmFsaWQgYXJiIik7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFyYml0ZXJzW19hZGRyXS5sb2NrZWQgPSBfbG9jazsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGZsdXNoIHRoZSBob3VzZSBmZWVzIHdoZW5ldmVyIGNvbW1hbmRlZCB0by4NCiAgICAgICAgLy8gaWdub3JlIHRoZSB0aHJlc2hvbGQgYW5kIHRoZSBsYXN0IHBheW91dCB0aW1lDQogICAgICAgIC8vIGJ1dCB0aGlzIHRpbWUgb25seSByZXNldCBsYXN0cGF5b3V0dGltZSB1cG9uIHN1Y2Nlc3MNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gZmx1c2hIb3VzZUZlZXMoKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgib25seSBvd25lciBjYWxscyB0aGlzIGZ1bmN0aW9uIik7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChob3VzZUZlZUhvbGRvdmVyID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdWludCBudG1waG8gPSBob3VzZUZlZUhvbGRvdmVyOw0KICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRva2VuUGFydG5lci5jYWxsLmdhcyhmZWVHYXMpLnZhbHVlKG50bXBobykoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VzZUZlZUhvbGRvdmVyID0gbnRtcGhvOyAvLyBwdXQgaXQgYmFjaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkhvdXNlLUZlZSBFcnJvcjIiKTsgDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0UGF5b3V0VGltZSA9IG5vdzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJIb3VzZS1GZWUgUGFpZCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICB9DQoNCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBzZXQgdGhlIHRva2VuIHBhcnRuZXINCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gc2V0VG9rZW5QYXJ0bmVyKGFkZHJlc3MgX2FkZHIpIHB1YmxpYw0KICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgICAgIH0gDQoNCiAgICAgICAgICAgICAgICBpZiAoKHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkgDQogICAgICAgICAgICAgICAgICAgICAgICAmJiAodG9rZW5QYXJ0bmVyID09IGFkZHJlc3MoMCkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblBhcnRuZXIgPSBfYWRkcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiVG9rZW4gUGFydG5lciBGaW5hbCEiKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNldHRpbmdzU3RhdGUgIT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5QYXJ0bmVyID0gX2FkZHI7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIlRva2VuIFBhcnRuZXIgQXNzaWduZWQhIik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHN3YXAgZXhlY3V0b3INCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9hZGRyKSANCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyDQogICAgICAgICAgICAgICAgICAgICAgICB8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpDQogICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgICAgICAgICBvd25lciA9IF9hZGRyOw0KICAgICAgICB9DQoNCg0KDQp9'