base 64 content
base64e4Token7
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQoNCi8vDQovLyBGT1IgUkVGRVJFTkNFIC0gSU5DTFVERSAgaUU0Um93RXNjcm93ICAoaW50ZXJmYWNlKSBDT05UUkFDVCBhdCB0aGUgdG9wIC4uLi4uDQovLw0KDQpjb250cmFjdCBpRTRSb3dFc2Nyb3cgew0KICAgICAgICBmdW5jdGlvbiBnZXROdW1HYW1lc1N0YXJ0ZWQoKSBjb25zdGFudCByZXR1cm5zIChpbnQgbmdhbWVzKTsNCn0NCg0KLy8gQWJzdHJhY3QgY29udHJhY3QgZm9yIHRoZSBmdWxsIEVSQyAyMCBUb2tlbiBzdGFuZGFyZA0KLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQoNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLy8gQUJTVFJBQ1Qgc3RhbmRhcmQgdG9rZW4gY2xhc3MNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KY29udHJhY3QgVG9rZW4geyANCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KTsNCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7DQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsNCg0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOw0KfQ0KDQoNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQovLyAgRTRSb3dSZXdhcmRzIC0gYWJzdHJhY3QgZTQgZGl2aWRlbmQgY29udHJhY3QNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpjb250cmFjdCBFNFJvd1Jld2FyZHMNCnsNCiAgICAgICAgZnVuY3Rpb24gY2hlY2tEaXZpZGVuZHMoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgcmV0dXJucyh1aW50IF9hbW91bnQpOw0KICAgICAgICBmdW5jdGlvbiB3aXRoZHJhd0RpdmlkZW5kcygpIHB1YmxpYyByZXR1cm5zICh1aW50IG5hbW91bnQpOw0KfQ0KDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLy8gIEZpbm5leSBDaGlwIC0gdG9rZW4gY29udHJhY3QNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpjb250cmFjdCBFNFRva2VuIGlzIFRva2VuLCBFNFJvd1Jld2FyZHMgew0KICAgICAgICBldmVudCBTdGF0RXZlbnQoc3RyaW5nIG1zZyk7DQogICAgICAgIGV2ZW50IFN0YXRFdmVudEkoc3RyaW5nIG1zZywgdWludCB2YWwpOw0KDQogICAgICAgIGVudW0gU2V0dGluZ1N0YXRlVmFsdWUgIHtkZWJ1ZywgcmVsZWFzZSwgbG9ja2VkUmVsZWFzZX0NCiAgICAgICAgZW51bSBJY29TdGF0dXNWYWx1ZSB7YW5vdW5jZW1lbnQsIHNhbGVPcGVuLCBzYWxlQ2xvc2VkLCBmYWlsZWQsIHN1Y2NlZWRlZH0NCg0KDQoNCg0KICAgICAgICBzdHJ1Y3QgdG9rZW5BY2NvdW50IHsNCiAgICAgICAgICAgICAgICBib29sIGFsbG9jZWQ7IC8vIGZsYWcgdG8gYXNjZXJ0IHByaW9yIGFsbG9jYXRpb24NCiAgICAgICAgICAgICAgICB1aW50IHRva2VuczsgLy8gbnVtIHRva2Vucw0KICAgICAgICAgICAgICAgIHVpbnQgYmFsYW5jZTsgLy8gcmV3YXJkcyBiYWxhbmNlDQogICAgICAgIH0NCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQovLyAgZGF0YSBzdG9yYWdlDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGFkZHJlc3MgZGV2ZWxvcGVyczsgLy8gZGV2ZWxvcGVycyB0b2tlbiBob2xkaW5nIGFkZHJlc3MNCiAgICAgICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7IC8vIGRlcGxveWVyIGV4ZWN1dG9yDQogICAgICAgIGFkZHJlc3MgZm91bmRlck9yZzsgLy8gZm91bmRlciBvcmdpbmFpemF0aW9uIGNvbnRyYWN0DQogICAgICAgIGFkZHJlc3MgYXV4UGFydG5lcjsgLy8gYXV4IHBhcnRuZXIgKHByL2F1ZGl0aW5nKSAtIDEgcGVyY2VudCB1cG9uIGNsb3NlDQogICAgICAgIGFkZHJlc3MgZTRfcGFydG5lcjsgLy8gZTRyb3cgIGNvbnRyYWN0IGFkZHJlc3Nlcw0KDQoNCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiB0b2tlbkFjY291bnQpIGhvbGRlckFjY291bnRzIDsgLy8gd2hvIGhvbGRzIGhvdyBtYW55IHRva2VucyAoaGlnaCB0d28gYnl0ZXMgY29udGFpbiBjdXJQYXlJZCkNCiAgICAgICAgbWFwcGluZyAodWludCA9PiBhZGRyZXNzKSBob2xkZXJJbmRleGVzIDsgLy8gZm9yIGl0ZXJhdGlvbiB0aHJ1IGhvbGRlcg0KICAgICAgICB1aW50IG51bUFjY291bnRzOw0KDQogICAgICAgIHVpbnQgcGFydG5lckNyZWRpdHM7IC8vIGFtb3VudCBwYXJ0bmVyIChlNHJvdykgIGhhcyBwYWlkDQogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsgLy8gYXBwcm92YWxzDQoNCg0KICAgICAgICB1aW50IG1heE1pbnRhYmxlVG9rZW5zOyAvLyAuLi4NCiAgICAgICAgdWludCBtaW5JY29Ub2tlbkdvYWw7Ly8gdG9rZW4gZ29hbCBieSBzYWxlIGVuZA0KICAgICAgICB1aW50IG1pblVzYWdlR29hbDsgLy8gIG51bSBnYW1lcyBnb2FsIGJ5IHVzYWdlIGRlYWRsaW5lDQogICAgICAgIHVpbnQgcHVibGljICB0b2tlblByaWNlOyAvLyBwcmljZSBwZXIgdG9rZW4NCiAgICAgICAgdWludCBwdWJsaWMgcGF5b3V0VGhyZXNob2xkOyAvLyB0aHJlc2hvbGQgdGlsbCBwYXlvdXQNCg0KICAgICAgICB1aW50IHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkOyAgIC8vIHJ1bm5pbmcgdG90YWwgb2YgdG9rZW4gZnVuZHMgcmVjZWl2ZWQNCiAgICAgICAgdWludCBwdWJsaWMgdG90YWxUb2tlbnNNaW50ZWQ7ICAvLyB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIG1pbnRlZA0KICAgICAgICB1aW50IHB1YmxpYyBob2xkb3ZlckJhbGFuY2U7ICAgICAgICAgICAgLy8gaG9sZCB0aGlzIGFtb3VudCB1bnRpbCB0aHJlc2hob2xkIGJlZm9yZSByZXdhcmQgcGF5b3V0DQogICAgICAgIGludCBwdWJsaWMgcGF5b3V0QmFsYW5jZTsgICAgICAgICAgICAgICAvLyBob2xkIHRoaXMgYW1vdW50IHVudGlsIHRocmVzaGhvbGQgYmVmb3JlIHJld2FyZCBwYXlvdXQNCiAgICAgICAgaW50IHByT3JpZ1BheW91dEJhbDsgICAgICAgICAgICAgICAgICAgIC8vIG9yaWdpbmFsIHBheW91dCBiYWxhbmNlIGJlZm9yZSBydW4NCiAgICAgICAgdWludCBwck9yaWdUb2tlbnNNaW50OyAgICAgICAgICAgICAgICAgIC8vIHRva2VucyBtaW50ZWQgYXQgc3RhcnQgb2YgcGF5IHJ1bg0KICAgICAgICB1aW50IHB1YmxpYyBjdXJQYXlvdXRJZDsgICAgICAgICAgICAgICAgLy8gY3VycmVudCBwYXlvdXQgaWQNCiAgICAgICAgdWludCBwdWJsaWMgbGFzdFBheW91dEluZGV4OyAgICAgICAgICAgIC8vIHBheW91dCBpZHggYmV0d2VlbiBydW4gc2VnbWVudHMNCiAgICAgICAgdWludCBwdWJsaWMgbWF4UGF5c1BlcjsgICAgICAgICAgICAgICAgIC8vIG51bSBwYXlzIHBlciBzZWdtZW50DQogICAgICAgIHVpbnQgcHVibGljIG1pblBheUludGVydmFsOyAgICAgICAgICAgICAvLyBtaW4gaW50ZXJ2YWwgYmV0d2VlbiBzdGFydCBwYXkgcnVuDQoNCg0KICAgICAgICB1aW50IGZ1bmRpbmdTdGFydDsgICAgICAgICAgICAgIC8vIGZ1bmRpbmcgc3RhcnQgdGltZSBpbW1lZGlhdGVseSBhZnRlciBhbm91bmNlbWVudA0KICAgICAgICB1aW50IGZ1bmRpbmdEZWFkbGluZTsgICAgICAgICAgIC8vIGZ1bmRpbmcgZW5kIHRpbWUNCiAgICAgICAgdWludCB1c2FnZURlYWRsaW5lOyAgICAgICAgICAgICAvLyBkZWFkbGluZSB3aGVyZSBtaW5pbXVtIHVzYWdlIG5lZWRzIHRvIGJlIG1ldCBiZWZvcmUgY29uc2lkZXJlZCBzdWNjZXNzDQogICAgICAgIHVpbnQgcHVibGljIGxhc3RQYXlvdXRUaW1lOyAgICAgLy8gdGltZXN0YW1wIG9mIGxhc3QgcGF5b3V0IHRpbWUNCiAgICAgICAgdWludCB2ZXN0VGltZTsgICAgICAgICAgLy8gMSB5ZWFyIHBhc3Qgc2FsZSB2ZXN0IGRldmVsb3BlciB0b2tlbnMNCiAgICAgICAgdWludCBudW1EZXZUb2tlbnM7ICAgICAgLy8gMTAgcGVyIGNlbnQgb2YgdG9rZW5zIGFmdGVyIGNsb3NlIHRvIGRldmVsb3BlcnMNCiAgICAgICAgYm9vbCBkZXZlbG9wZXJzR3JhbnRlZDsgICAgICAgICAgICAgICAgIC8vIGZsYWcNCiAgICAgICAgdWludCByZW11bmVyYXRpb25TdGFnZTsgICAgICAgICAvLyAwIGZvciBub3QgeWV0LCAxIGZvciAxMCBwZXJjZW50LCAyIGZvciByZW1haW5pbmcgIHVwb24gc3VjY2VlZGVkLg0KICAgICAgICB1aW50IHB1YmxpYyByZW11bmVyYXRpb25CYWxhbmNlOyAgICAgICAgLy8gcmVtdW5lcmF0aW9uIGJhbGFuY2UgdG8gcmVsZWFzZSB0b2tlbiBmdW5kcw0KICAgICAgICB1aW50IGF1eFBhcnRuZXJCYWxhbmNlOyAgICAgICAgIC8vIGF1eCBwYXJ0bmVyIGJhbGFuY2UgLSAxIHBlcmNlbnQNCiAgICAgICAgdWludCBybUdhczsgLy8gcmVtdW5lcmF0aW9uIGdhcw0KICAgICAgICB1aW50IHJ3R2FzOyAvLyByZXdhcmQgZ2FzDQogICAgICAgIHVpbnQgcmZHYXM7IC8vIHJlZnVuZCBnYXMNCg0KICAgICAgICBJY29TdGF0dXNWYWx1ZSBpY29TdGF0dXM7ICAvLyBjdXJyZW50IHN0YXR1cyBvZiBpY28NCiAgICAgICAgU2V0dGluZ1N0YXRlVmFsdWUgcHVibGljIHNldHRpbmdzU3RhdGU7DQoNCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBjb250cmFjdCBjb25zdHJ1Y3Rvcg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBFNFRva2VuKCkgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogICAgICAgICAgICAgICAgZGV2ZWxvcGVycyA9IG1zZy5zZW5kZXI7DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyB1c2UgdGhpcyB0byByZXNldCBldmVyeXRoaW5nLCB3aWxsIG5ldmVyIGJlIGNhbGxlZCBhZnRlciBsb2NrUmVsZWFzZQ0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBhcHBseVNldHRpbmdzKFNldHRpbmdTdGF0ZVZhbHVlIHFTdGF0ZSwgdWludCBfc2FsZVN0YXJ0LCB1aW50IF9zYWxlRW5kLCB1aW50IF91c2FnZUVuZCwgdWludCBfbWluVXNhZ2UsIHVpbnQgX3Rva0dvYWwsIHVpbnQgIF9tYXhNaW50YWJsZSwgdWludCBfdGhyZXNob2xkLCB1aW50IF9wcmljZSwgdWludCBfbXBwLCB1aW50IF9tcGkgKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgLy8gdGhlc2Ugc2V0dGluZ3MgYXJlIHBlcm1hbmVudGx5IHR3ZWFrYWJsZSBmb3IgcGVyZm9ybWFuY2UgYWRqdXN0bWVudHMNCiAgICAgICAgICAgICAgICBwYXlvdXRUaHJlc2hvbGQgPSBfdGhyZXNob2xkOw0KICAgICAgICAgICAgICAgIG1heFBheXNQZXIgPSBfbXBwOw0KICAgICAgICAgICAgICAgIG1pblBheUludGVydmFsID0gX21waTsNCg0KICAgICAgICAgICAgICAgIGlmIChzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgICAgICAgICBzZXR0aW5nc1N0YXRlID0gcVN0YXRlOw0KICAgICAgICAgICAgICAgIGljb1N0YXR1cyA9IEljb1N0YXR1c1ZhbHVlLmFub3VuY2VtZW50Ow0KDQogICAgICAgICAgICAgICAgcm1HYXMgPSAxMDAwMDA7IC8vIHJlbXVuZXJhdGlvbiBnYXMNCiAgICAgICAgICAgICAgICByd0dhcyA9IDEwMDAwOyAvLyByZXdhcmQgZ2FzDQogICAgICAgICAgICAgICAgcmZHYXMgPSAxMDAwMDsgLy8gcmVmdW5kIGdhcw0KDQoNCiAgICAgICAgICAgICAgICAvLyB6ZXJvIG91dCBhbGwgdG9rZW4gaG9sZGVycy4gIA0KICAgICAgICAgICAgICAgIC8vIGxlYXZlIGFsbG9jZWQgb24sIGxlYXZlIG51bSBhY2NvdW50cw0KICAgICAgICAgICAgICAgIC8vIGNhbnQgZGVsZXRlIHRoZW0gYW55d2F5cw0KDQogICAgICAgICAgICAgICAgaWYgKHRvdGFsVG9rZW5zTWludGVkID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbnVtQWNjb3VudHM7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBhID0gaG9sZGVySW5kZXhlc1tpXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEgIT0gYWRkcmVzcygwKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvbGRlckFjY291bnRzW2FdLnRva2VucyA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbYV0uYmFsYW5jZSA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gZG8gbm90IHJlc2V0IG51bUFjY291bnRzIQ0KDQogICAgICAgICAgICAgICAgdG90YWxUb2tlbnNNaW50ZWQgPSAwOyAvLyB0aGlzIHdpbGwgZXJhc2UNCiAgICAgICAgICAgICAgICB0b3RhbFRva2VuRnVuZHNSZWNlaXZlZCA9IDA7IC8vIHRoaXMgd2lsbCBlcmFzZS4NCiAgICAgICAgICAgICAgICBlNF9wYXJ0bmVyID0gYWRkcmVzcygwKTsgLy8gbXVzdCBiZSByZXNldCBhZ2Fpbg0KDQogICAgICAgICAgICAgICAgZnVuZGluZ1N0YXJ0ID0gIF9zYWxlU3RhcnQ7DQogICAgICAgICAgICAgICAgZnVuZGluZ0RlYWRsaW5lID0gX3NhbGVFbmQ7DQogICAgICAgICAgICAgICAgdXNhZ2VEZWFkbGluZSA9IF91c2FnZUVuZDsNCiAgICAgICAgICAgICAgICBtaW5Vc2FnZUdvYWwgPSBfbWluVXNhZ2U7DQogICAgICAgICAgICAgICAgbWluSWNvVG9rZW5Hb2FsID0gX3Rva0dvYWw7DQogICAgICAgICAgICAgICAgbWF4TWludGFibGVUb2tlbnMgPSBfbWF4TWludGFibGU7DQogICAgICAgICAgICAgICAgdG9rZW5QcmljZSA9IF9wcmljZTsNCg0KICAgICAgICAgICAgICAgIHZlc3RUaW1lID0gZnVuZGluZ1N0YXJ0ICsgKDM2NSBkYXlzKTsNCiAgICAgICAgICAgICAgICBudW1EZXZUb2tlbnMgPSAwOw0KDQogICAgICAgICAgICAgICAgaG9sZG92ZXJCYWxhbmNlID0gMDsNCiAgICAgICAgICAgICAgICBwYXlvdXRCYWxhbmNlID0gMDsNCiAgICAgICAgICAgICAgICBjdXJQYXlvdXRJZCA9IDE7DQogICAgICAgICAgICAgICAgbGFzdFBheW91dEluZGV4ID0gMDsNCiAgICAgICAgICAgICAgICByZW11bmVyYXRpb25TdGFnZSA9IDA7DQogICAgICAgICAgICAgICAgcmVtdW5lcmF0aW9uQmFsYW5jZSA9IDA7DQoNCiAgICAgICAgICAgICAgICBhdXhQYXJ0bmVyQmFsYW5jZSA9IDA7DQoNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5iYWxhbmNlID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvd25lci5jYWxsLmdhcyhyZkdhcykudmFsdWUodGhpcy5iYWxhbmNlKSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkVSUk9SISIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIm9rIik7DQoNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHRva2VucyBoZWxkIHJlc2VydmUgdGhlIHRvcCB0d28gYnl0ZXMgZm9yIHRoZSBwYXlpZCBsYXN0IHBhaWQuDQogICAgICAgIC8vIHRoaXMgaXMgc28gaG9sZGVycyBhdCB0aGUgdG9wIG9mIHRoZSBsaXN0IGRvbnQgdHJhbnNmZXIgdG9rZW5zIA0KICAgICAgICAvLyB0byB0aGVtc2VsdmVzIG9uIHRoZSBib3R0b20gb2YgdGhlIGxpc3QgdGh1cyBzY2FtbWluZyB0aGUgDQogICAgICAgIC8vIHN5c3RlbS4gdGhpcyBmdW5jdGlvbiBkZWNvbnN0cnVjdHMgdGhlIHRva2VuaGVsZCB2YWx1ZS4NCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGdldFBheUlkQW5kSGVsZCh1aW50IF90b2tIZWxkKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IF9wYXlJZCwgdWludCBfaGVsZCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIF9wYXlJZCA9IChfdG9rSGVsZCAvICgyICoqIDQ4KSkgJiAweGZmZmY7DQogICAgICAgICAgICAgICAgX2hlbGQgPSBfdG9rSGVsZCAmIDB4ZmZmZmZmZmZmZmZmOw0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIGdldEhlbGQodWludCBfdG9rSGVsZCkgaW50ZXJuYWwgIHJldHVybnMgKHVpbnQgX2hlbGQpDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBfaGVsZCA9IF90b2tIZWxkICYgMHhmZmZmZmZmZmZmZmY7DQogICAgICAgIH0NCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGFsbG9jYXRlIGEgbmV3IGFjY291bnQgYnkgc2V0dGluZyBhbGxvYyB0byB0cnVlDQogICAgICAgIC8vIHNldCB0aGUgdG9wIHRvIGJ5dGVzIG9mIHRva2VucyB0byBjdXIgcGF5IGlkIHRvIGxlYXZlIG91dCBvZiBjdXJyZW50IHJvdW5kDQogICAgICAgIC8vIGFkZCBob2xkZXIgaW5kZXgsIGJ1bXAgdGhlIG51bSBhY2NvdW50cw0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gYWRkQWNjb3VudChhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCAgew0KICAgICAgICAgICAgICAgIGhvbGRlckFjY291bnRzW19hZGRyXS5hbGxvY2VkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBob2xkZXJBY2NvdW50c1tfYWRkcl0udG9rZW5zID0gKGN1clBheW91dElkICogKDIgKiogNDgpKTsNCiAgICAgICAgICAgICAgICBob2xkZXJJbmRleGVzW251bUFjY291bnRzKytdID0gX2FkZHI7DQogICAgICAgIH0NCg0KDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLy8gQkVHSU4gRVJDLTIwIGZyb20gU3RhbmRhcmRUb2tlbg0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc2FsZU9wZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1cHBseSA9IG1heE1pbnRhYmxlVG9rZW5zOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1cHBseSA9IHRvdGFsVG9rZW5zTWludGVkOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCg0KICAgICAgICAgICAgICAgIGlmICgobXNnLnNlbmRlciA9PSBkZXZlbG9wZXJzKSANCiAgICAgICAgICAgICAgICAgICAgICAgICYmICAobm93IDwgdmVzdFRpbWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvL3N0YXRFdmVudCgiVG9rZW5zIG5vdCB5ZXQgdmVzdGVkLiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAgICAgLy9EZWZhdWx0IGFzc3VtZXMgdG90YWxTdXBwbHkgY2FuJ3QgYmUgb3ZlciBtYXggKDJeMjU2IC0gMSkuDQogICAgICAgICAgICAgICAgLy9JZiB5b3VyIHRva2VuIGxlYXZlcyBvdXQgdG90YWxTdXBwbHkgYW5kIGNhbiBpc3N1ZSBtb3JlIHRva2VucyBhcyB0aW1lIGdvZXMgb24sIHlvdSBuZWVkIHRvIGNoZWNrIGlmIGl0IGRvZXNuJ3Qgd3JhcC4NCiAgICAgICAgICAgICAgICAvL1JlcGxhY2UgdGhlIGlmIHdpdGggdGhpcyBvbmUgaW5zdGVhZC4NCiAgICAgICAgICAgICAgICAvL2lmIChob2xkZXJBY2NvdW50c1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGhvbGRlckFjY291bnRzW190b10pIHsNCg0KICAgICAgICAgICAgICAgIHZhciAocGlkRnJvbSwgaGVsZEZyb20pID0gZ2V0UGF5SWRBbmRIZWxkKGhvbGRlckFjY291bnRzW21zZy5zZW5kZXJdLnRva2Vucyk7DQogICAgICAgICAgICAgICAgaWYgKGhlbGRGcm9tID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0udG9rZW5zIC09IF92YWx1ZTsNCg0KICAgICAgICAgICAgICAgICAgICBpZiAoIWhvbGRlckFjY291bnRzW190b10uYWxsb2NlZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkQWNjb3VudChfdG8pOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgdWludCBuZXdIZWxkID0gX3ZhbHVlICsgZ2V0SGVsZChob2xkZXJBY2NvdW50c1tfdG9dLnRva2Vucyk7DQogICAgICAgICAgICAgICAgICAgIGhvbGRlckFjY291bnRzW190b10udG9rZW5zID0gbmV3SGVsZCB8IChwaWRGcm9tICogKDIgKiogNDgpKTsNCiAgICAgICAgICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgeyANCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQoNCiAgICAgICAgICAgICAgICBpZiAoKF9mcm9tID09IGRldmVsb3BlcnMpIA0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgIChub3cgPCB2ZXN0VGltZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vc3RhdEV2ZW50KCJUb2tlbnMgbm90IHlldCB2ZXN0ZWQuIik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgLy9zYW1lIGFzIGFib3ZlLiBSZXBsYWNlIHRoaXMgbGluZSB3aXRoIHRoZSBmb2xsb3dpbmcgaWYgeW91IHdhbnQgdG8gcHJvdGVjdCBhZ2FpbnN0IHdyYXBwaW5nIHVpbnRzLg0KICAgICAgICAvL2lmIChiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgew0KDQogICAgICAgICAgICAgICAgdmFyIChwaWRGcm9tLCBoZWxkRnJvbSkgPSBnZXRQYXlJZEFuZEhlbGQoaG9sZGVyQWNjb3VudHNbX2Zyb21dLnRva2Vucyk7DQogICAgICAgICAgICAgICAgaWYgKGhlbGRGcm9tID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBob2xkZXJBY2NvdW50c1tfZnJvbV0udG9rZW5zIC09IF92YWx1ZTsNCg0KICAgICAgICAgICAgICAgICAgICBpZiAoIWhvbGRlckFjY291bnRzW190b10uYWxsb2NlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEFjY291bnQoX3RvKTsNCg0KICAgICAgICAgICAgICAgICAgICB1aW50IG5ld0hlbGQgPSBfdmFsdWUgKyBnZXRIZWxkKGhvbGRlckFjY291bnRzW190b10udG9rZW5zKTsNCg0KICAgICAgICAgICAgICAgICAgICBob2xkZXJBY2NvdW50c1tfdG9dLnRva2VucyA9IG5ld0hlbGQgfCAocGlkRnJvbSAqICgyICoqIDQ4KSk7DQogICAgICAgICAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgew0KICAgICAgICAgICAgICAgIC8vIHZhcnMgZGVmYXVsdCB0byAwDQogICAgICAgICAgICAgICAgaWYgKGhvbGRlckFjY291bnRzW19vd25lcl0uYWxsb2NlZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYmFsYW5jZSA9IGdldEhlbGQoaG9sZGVyQWNjb3VudHNbX293bmVyXS50b2tlbnMpOw0KICAgICAgICAgICAgICAgIH0gDQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCiAgICAgICAgICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgICAgICAgfQ0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLy8gRU5EIEVSQzIwDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCiAgDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gY2hlY2sgdGhlIGFsbG9jZWQNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBob2xkZXJFeGlzdHMoYWRkcmVzcyBfYWRkcikgcmV0dXJucyhib29sIF9leGlzdCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIF9leGlzdCA9IGhvbGRlckFjY291bnRzW19hZGRyXS5hbGxvY2VkOw0KICAgICAgICB9DQoNCg0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gZGVmYXVsdCBwYXlhYmxlIGZ1bmN0aW9uLg0KICAgICAgICAvLyBpZiBzZW5kZXIgaXMgZTRyb3cgIHBhcnRuZXIsIHRoaXMgaXMgYSByYWtlIGZlZSBwYXltZW50DQogICAgICAgIC8vIG90aGVyd2lzZSB0aGlzIGlzIGEgdG9rZW4gcHVyY2hhc2UuDQogICAgICAgIC8vIHRva2VucyBvbmx5IHB1cmNoYXNlYWJsZSBiZXR3ZWVuIHRva2VuZnVuZGluZ3N0YXJ0IGFuZCBlbmQNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsNCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBlNF9wYXJ0bmVyKSB7DQogICAgICAgICAgICAgICAgICAgICBmZWVQYXltZW50KCk7IC8vIGZyb20gZTRyb3cgZ2FtZSBlc2Nyb3cgY29udHJhY3QNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VUb2tlbigpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHB1cmNoYXNlIHRva2VuIGZ1bmN0aW9uIC0gdG9rZW5zIG9ubHkgc29sZCBkdXJpbmcgc2FsZSBwZXJpb2QgdXAgdW50aWwgdGhlIG1heCB0b2tlbnMNCiAgICAgICAgLy8gcHVyY2hhc2UgcHJpY2UgaXMgdG9rZW5QcmljZS4gIGFsbCB1bml0cyBpbiB3ZWkuDQogICAgICAgIC8vIHB1cmNoYXNlciB3aWxsIG5vdCBiZSBpbmNsdWRlZCBpbiBjdXJyZW50IHBheSBydW4NCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gcHVyY2hhc2VUb2tlbigpIHBheWFibGUgew0KDQogICAgICAgICAgICAgICAgdWludCBudmFsdWUgPSBtc2cudmFsdWU7IC8vIGJlaW5nIGNhcmVmdWwgdG8gcHJlc2VydmUgbXNnLnZhbHVlDQogICAgICAgICAgICAgICAgYWRkcmVzcyBucHVyY2hhc2VyID0gbXNnLnNlbmRlcjsNCiAgICAgICAgICAgICAgICBpZiAobnZhbHVlIDwgdG9rZW5QcmljZSkgDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAgICAgICAgIHVpbnQgcXR5ID0gbnZhbHVlL3Rva2VuUHJpY2U7DQogICAgICAgICAgICAgICAgdXBkYXRlSWNvU3RhdHVzKCk7DQogICAgICAgICAgICAgICAgaWYgKGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5zYWxlT3BlbikgLy8gcHVyY2hhc2UgaXMgY2xvc2VkDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgICAgICBpZiAodG90YWxUb2tlbnNNaW50ZWQgKyBxdHkgPiBtYXhNaW50YWJsZVRva2VucykNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgICAgIGlmICghaG9sZGVyQWNjb3VudHNbbnB1cmNoYXNlcl0uYWxsb2NlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEFjY291bnQobnB1cmNoYXNlcik7DQoNCiAgICAgICAgICAgICAgICAvLyBwdXJjaGFzZXIgd2FpdHMgZm9yIG5leHQgcGF5cnVuLiBvdGhlcndpc2UgY2FuIGRpc3J1cHQgY3VyIHBheSBydW4NCiAgICAgICAgICAgICAgICB1aW50IG5ld0hlbGQgPSBxdHkgKyBnZXRIZWxkKGhvbGRlckFjY291bnRzW25wdXJjaGFzZXJdLnRva2Vucyk7DQogICAgICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbbnB1cmNoYXNlcl0udG9rZW5zID0gbmV3SGVsZCB8IChjdXJQYXlvdXRJZCAqICgyICoqIDQ4KSk7DQoNCiAgICAgICAgICAgICAgICB0b3RhbFRva2Vuc01pbnRlZCArPSBxdHk7DQogICAgICAgICAgICAgICAgdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQgKz0gbnZhbHVlOw0KDQogICAgICAgICAgICAgICAgaWYgKHRvdGFsVG9rZW5zTWludGVkID09IG1heE1pbnRhYmxlVG9rZW5zKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5zYWxlQ2xvc2VkOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy90ZXN0IHVubmVjZXNzYXJ5IC0gIGlmIChnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSA+PSBtaW5JY29Ub2tlbkdvYWwpDQogICAgICAgICAgICAgICAgICAgICAgICBkb0RldmVsb3BlckdyYW50KCk7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnRJKCJQdXJjaGFzZWQsR3JhbnRlZCIsIHF0eSk7DQogICAgICAgICAgICAgICAgfSBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnRJKCJQdXJjaGFzZWQiLCBxdHkpOw0KDQogICAgICAgIH0NCg0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBhY2NlcHQgcGF5bWVudCBmcm9tIGU0cm93IGNvbnRyYWN0DQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBmZWVQYXltZW50KCkgcGF5YWJsZSAgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBlNF9wYXJ0bmVyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoImZvcmJpZGRlbiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyB0aGFuayB5b3UNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdWludCBuZnZhbHVlID0gbXNnLnZhbHVlOyAvLyBwcmVzZXJ2ZSB2YWx1ZSBpbiBjYXNlIGNoYW5nZWQgaW4gZGV2IGdyYW50DQoNCiAgICAgICAgICAgICAgICB1cGRhdGVJY29TdGF0dXMoKTsNCg0KICAgICAgICAgICAgICAgIGhvbGRvdmVyQmFsYW5jZSArPSBuZnZhbHVlOw0KICAgICAgICAgICAgICAgIHBhcnRuZXJDcmVkaXRzICs9IG5mdmFsdWU7DQogICAgICAgICAgICAgICAgU3RhdEV2ZW50SSgiUGF5bWVudCIsIG5mdmFsdWUpOw0KDQogICAgICAgICAgICAgICAgaWYgKGhvbGRvdmVyQmFsYW5jZSA+IHBheW91dFRocmVzaG9sZA0KICAgICAgICAgICAgICAgICAgICAgICAgfHwgcGF5b3V0QmFsYW5jZSA+IDApDQogICAgICAgICAgICAgICAgICAgICAgICBkb1BheW91dCgpOw0KDQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBzZXQgdGhlIGU0cm93IHBhcnRuZXIsIHRoaXMgaXMgb25seSBkb25lIG9uY2UNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIHNldEU0Um93UGFydG5lcihhZGRyZXNzIF9hZGRyKSBwdWJsaWMNCiAgICAgICAgew0KICAgICAgICAvLyBPTkxZIG93bmVyIGNhbiBzZXQgYW5kIE9OTFkgT05DRSEgKHVubGVzcyAidW5sb2NrZWQiIGRlYnVnKQ0KICAgICAgICAvLyBvbmNlIGl0cyBsb2NrZWQuIE9OTFkgT05DRSENCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBvd25lcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChlNF9wYXJ0bmVyID09IGFkZHJlc3MoMCkpIHx8IChzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmRlYnVnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlNF9wYXJ0bmVyID0gX2FkZHI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRuZXJDcmVkaXRzID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TdGF0RXZlbnRJKCJFNC1TZXQiLCAwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiQWxyZWFkeSBTZXQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHJldHVybiB0aGUgdG90YWwgdG9rZW5zIHB1cmNoYXNlZA0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGdldE51bVRva2Vuc1B1cmNoYXNlZCgpIGNvbnN0YW50IHJldHVybnModWludCBfcHVyY2hhc2VkKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgX3B1cmNoYXNlZCA9IHRvdGFsVG9rZW5zTWludGVkLW51bURldlRva2VuczsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gcmV0dXJuIHRoZSBudW0gZ2FtZXMgYXMgcmVwb3J0ZWQgZnJvbSB0aGUgZTRyb3cgIGNvbnRyYWN0DQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gZ2V0TnVtR2FtZXMoKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX2dhbWVzKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgLy9fZ2FtZXMgPSAwOw0KICAgICAgICAgICAgICAgIGlmIChlNF9wYXJ0bmVyICE9IGFkZHJlc3MoMCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlFNFJvd0VzY3JvdyBwZTQgPSBpRTRSb3dFc2Nyb3coZTRfcGFydG5lcik7DQogICAgICAgICAgICAgICAgICAgICAgICBfZ2FtZXMgPSB1aW50KHBlNC5nZXROdW1HYW1lc1N0YXJ0ZWQoKSk7DQogICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICAvL2Vsc2UNCiAgICAgICAgICAgICAgICAvL1N0YXRFdmVudCgiRW1wdHkgRTQiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBnZXQgdGhlIGZvdW5kZXJzLCBhdXhQYXJ0bmVyLCBkZXZlbG9wZXINCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gZ2V0U3BlY2lhbEFkZHJlc3NlcygpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgX2ZuZHIsIGFkZHJlc3MgX2F1eCwgYWRkcmVzcyBfZGV2LCBhZGRyZXNzIF9lNCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vaWYgKF9zZW5kZXIgPT0gb3duZXIpIHsgLy8gbm8gbXNnLnNlbmRlciBvbiBjb25zdGFudCBmdW5jdGlvbnMgYXQgbGVhc3QgaW4gbWV3DQogICAgICAgICAgICAgICAgICAgICAgICBfZm5kciA9IGZvdW5kZXJPcmc7DQogICAgICAgICAgICAgICAgICAgICAgICBfYXV4ID0gYXV4UGFydG5lcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9kZXYgPSBkZXZlbG9wZXJzOw0KICAgICAgICAgICAgICAgICAgICAgICAgX2U0ICA9IGU0X3BhcnRuZXI7DQogICAgICAgICAgICAgICAgLy99DQogICAgICAgIH0NCg0KDQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyB1cGRhdGUgdGhlIGljbyBzdGF0dXMNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVJY29TdGF0dXMoKSBwdWJsaWMNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc3VjY2VlZGVkIA0KICAgICAgICAgICAgICAgICAgICAgICAgfHwgaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLmZhaWxlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICBlbHNlIGlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuYW5vdW5jZW1lbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub3cgPiBmdW5kaW5nU3RhcnQgJiYgbm93IDw9IGZ1bmRpbmdEZWFkbGluZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5zYWxlT3BlbjsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChub3cgPiBmdW5kaW5nRGVhZGxpbmUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2hvdWxkIG5vdCBiZSBoZXJlIC0gdGhpcyB3aWxsIGV2ZW50dWFsbHkgZmFpbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5zYWxlQ2xvc2VkOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IG51bVAgPSBnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbnVtRyA9IGdldE51bUdhbWVzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG5vdyA+IGZ1bmRpbmdEZWFkbGluZSAmJiBudW1QIDwgbWluSWNvVG9rZW5Hb2FsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCAobm93ID4gdXNhZ2VEZWFkbGluZSAmJiBudW1HIDwgbWluVXNhZ2VHb2FsKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5mYWlsZWQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChub3cgPiBmdW5kaW5nRGVhZGxpbmUpIC8vIGRvbnQgd2FudCB0byBwcmV2ZW50IG1vcmUgdG9rZW4gc2FsZXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgKG51bVAgPj0gbWluSWNvVG9rZW5Hb2FsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAobnVtRyA+PSBtaW5Vc2FnZUdvYWwpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb1N0YXR1cyA9IEljb1N0YXR1c1ZhbHVlLnN1Y2NlZWRlZDsgLy8gaG9vcmF5DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLnNhbGVPcGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICgobnVtUCA+PSBtYXhNaW50YWJsZVRva2VucykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgKG5vdyA+IGZ1bmRpbmdEZWFkbGluZSkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvU3RhdHVzID0gSWNvU3RhdHVzVmFsdWUuc2FsZUNsb3NlZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICghZGV2ZWxvcGVyc0dyYW50ZWQNCiAgICAgICAgICAgICAgICAgICAgICAgICYmIGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5zYWxlT3BlbiANCiAgICAgICAgICAgICAgICAgICAgICAgICYmIGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudA0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgZ2V0TnVtVG9rZW5zUHVyY2hhc2VkKCkgPj0gbWluSWNvVG9rZW5Hb2FsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvRGV2ZWxvcGVyR3JhbnQoKTsgLy8gZ3JhbnQgd2hlbmV2ZXIgc3RhdHVzIGdvZXMgZnJvbSBvcGVuIHRvIGFueXRoaW5nLi4uDQogICAgICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyByZXF1ZXN0IHJlZnVuZC4gQ2FsbGVyIG11c3QgY2FsbCB0byByZXF1ZXN0IGFuZCByZWNlaXZlIHJlZnVuZCANCiAgICAgICAgLy8gV0FSTklORyAtIHdpdGhkcmF3IHJld2FyZHMvZGl2aWRlbmRzIGJlZm9yZSBjYWxsaW5nLg0KICAgICAgICAvLyBZT1UgSEFWRSBCRUVOIFdBUk5FRA0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIHJlcXVlc3RSZWZ1bmQoKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgYWRkcmVzcyBucmVxdWVzdGVyID0gbXNnLnNlbmRlcjsNCiAgICAgICAgICAgICAgICB1cGRhdGVJY29TdGF0dXMoKTsNCg0KICAgICAgICAgICAgICAgIHVpbnQgbnRva2VucyA9IGdldEhlbGQoaG9sZGVyQWNjb3VudHNbbnJlcXVlc3Rlcl0udG9rZW5zKTsNCiAgICAgICAgICAgICAgICBpZiAoaWNvU3RhdHVzICE9IEljb1N0YXR1c1ZhbHVlLmZhaWxlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiTm8gUmVmdW5kIik7DQogICAgICAgICAgICAgICAgZWxzZSBpZiAobnRva2VucyA9PSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJObyBUb2tlbnMiKTsNCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbnJlZnVuZCA9IG50b2tlbnMgKiB0b2tlblByaWNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdldE51bVRva2Vuc1B1cmNoYXNlZCgpID49IG1pbkljb1Rva2VuR29hbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnJlZnVuZCAtPSAobnJlZnVuZCAvMTApOyAvLyBvbmx5IDkwIHBlcmNlbnQgYi9jIDEwIHBlcmNlbnQgcGF5b3V0DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLnRva2VucyArPSBudG9rZW5zOw0KICAgICAgICAgICAgICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbbnJlcXVlc3Rlcl0udG9rZW5zID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChob2xkZXJBY2NvdW50c1tucmVxdWVzdGVyXS5iYWxhbmNlID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZWUgYWJvdmUgd2FybmluZyEhDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10uYWxsb2NlZCkgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQWNjb3VudChkZXZlbG9wZXJzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10uYmFsYW5jZSArPSBob2xkZXJBY2NvdW50c1tucmVxdWVzdGVyXS5iYWxhbmNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob2xkZXJBY2NvdW50c1tucmVxdWVzdGVyXS5iYWxhbmNlID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFucmVxdWVzdGVyLmNhbGwuZ2FzKHJmR2FzKS52YWx1ZShucmVmdW5kKSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vU3RhdEV2ZW50SSgiUmVmdW5kZWQiLCBucmVmdW5kKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHBheW91dCByZXdhcmRzIHRvIGFsbCB0b2tlbiBob2xkZXJzDQogICAgICAgIC8vIHVzZSBhIHNlY29uZCBob2xkaW5nIHZhcmlhYmxlIGNhbGxlZCBQYXlvdXRCYWxhbmNlIHRvIGRvIA0KICAgICAgICAvLyB0aGUgYWN0dWFsIHBheW91dCBmcm9tIGIvYyB0b28gbXVjaCBnYXMgdG8gaXRlcmF0ZSB0aHJ1IA0KICAgICAgICAvLyBlYWNoIHBheWVlLiBPbmx5IHN0YXJ0IGEgbmV3IHJ1biBhdCBtb3N0IG9uY2UgcGVyICJtaW5wYXlpbnRlcnZhbCIuDQogICAgICAgIC8vIEl0cyBkb25lIGluIHJ1bnMgb2YgIm1heFBheXNQZXIiDQogICAgICAgIC8vIHdlIHVzZSBzcGVjaWFsIGNvZGluZyBmb3IgdGhlIGhvbGRlckFjY291bnRzIHRvIGF2b2lkIGEgaGFjaw0KICAgICAgICAvLyBvZiBnZXR0aW5nIHBhaWQgYXQgdGhlIHRvcCBvZiB0aGUgbGlzdCB0aGVuIHRyYW5zZmVyaW5nIHRva2Vucw0KICAgICAgICAvLyB0byBhbm90aGVyIGFkZHJlc3MgYXQgdGhlIGJvdHRvbSBvZiB0aGUgbGlzdC4NCiAgICAgICAgLy8gYmVjYXVzZSBvZiB0aGF0IGVhY2ggaG9sZGVyQWNjb3VudHMgZW50cnkgZ2V0cyB0aGUgcGF5b3V0aWQgc3RhbXBlZCB1cG9uIGl0ICh0b3AgdHdvIGJ5dGVzKQ0KICAgICAgICAvLyBhbHNvIGEgdG9rZW4gdHJhbnNmZXIgd2lsbCB0cmFuc2ZlciB0aGUgcGF5b3V0IGlkLg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gZG9QYXlvdXQoKSAgaW50ZXJuYWwNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICh0b3RhbFRva2Vuc01pbnRlZCA9PSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgaWYgKChob2xkb3ZlckJhbGFuY2UgPiAwKSANCiAgICAgICAgICAgICAgICAgICAgICAgICYmIChwYXlvdXRCYWxhbmNlID09IDApDQogICAgICAgICAgICAgICAgICAgICAgICAmJiAobm93ID4gKGxhc3RQYXlvdXRUaW1lK21pblBheUludGVydmFsKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0IGEgbmV3IHJ1bg0KICAgICAgICAgICAgICAgICAgICAgICAgY3VyUGF5b3V0SWQrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJQYXlvdXRJZCA+PSAzMjc2OCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyUGF5b3V0SWQgPSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFBheW91dFRpbWUgPSBub3c7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXlvdXRCYWxhbmNlID0gaW50KGhvbGRvdmVyQmFsYW5jZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBwck9yaWdQYXlvdXRCYWwgPSBwYXlvdXRCYWxhbmNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgcHJPcmlnVG9rZW5zTWludCA9IHRvdGFsVG9rZW5zTWludGVkOw0KICAgICAgICAgICAgICAgICAgICAgICAgaG9sZG92ZXJCYWxhbmNlID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RQYXlvdXRJbmRleCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnRJKCJTdGFydFJ1biIsIHVpbnQoY3VyUGF5b3V0SWQpKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBheW91dEJhbGFuY2UgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyB3b3JrIGRvd24gdGhlIHAuby5iDQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IG5BbW91bnQ7DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IG5QZXJUb2tEaXN0cmliID0gdWludChwck9yaWdQYXlvdXRCYWwpL3ByT3JpZ1Rva2Vuc01pbnQ7DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IHBhaWRzID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgaTsgLy8gaW50ZW50aW9uYWwNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IGxhc3RQYXlvdXRJbmRleDsgKHBhaWRzIDwgbWF4UGF5c1BlcikgJiYgKGkgPCBudW1BY2NvdW50cykgJiYgKHBheW91dEJhbGFuY2UgPiAwKTsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIGEgPSBob2xkZXJJbmRleGVzW2ldOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSA9PSBhZGRyZXNzKDApKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIChwaWQsIGhlbGQpID0gZ2V0UGF5SWRBbmRIZWxkKGhvbGRlckFjY291bnRzW2FdLnRva2Vucyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaGVsZCA+IDApICYmIChwaWQgIT0gY3VyUGF5b3V0SWQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbkFtb3VudCA9IG5QZXJUb2tEaXN0cmliICogaGVsZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50KG5BbW91bnQpIDw9IHBheW91dEJhbGFuY2Upew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbYV0uYmFsYW5jZSArPSBuQW1vdW50OyANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvbGRlckFjY291bnRzW2FdLnRva2VucyA9IChjdXJQYXlvdXRJZCAqICgyICoqIDQ4KSkgfCBoZWxkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5b3V0QmFsYW5jZSAtPSBpbnQobkFtb3VudCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWlkcysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFBheW91dEluZGV4ID0gaTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0UGF5b3V0SW5kZXggPj0gbnVtQWNjb3VudHMgfHwgcGF5b3V0QmFsYW5jZSA8PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RQYXlvdXRJbmRleCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXlvdXRCYWxhbmNlID4gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob2xkb3ZlckJhbGFuY2UgKz0gdWludChwYXlvdXRCYWxhbmNlKTsvLyBwdXQgYmFjayBhbnkgbGVmdG92ZXJzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheW91dEJhbGFuY2UgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnRJKCJSdW5Db21wbGV0ZSIsIHVpbnQocHJPcmlnUGF5b3V0QmFsKSApOw0KDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnRJKCJQYXlSdW4iLCBuUGVyVG9rRGlzdHJpYiApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICB9DQoNCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHNlbmRlciB3aXRoZHJhdyBlbnRpcmUgcmV3YXJkcy9kaXZpZGVuZHMNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiB3aXRoZHJhd0RpdmlkZW5kcygpIHB1YmxpYyByZXR1cm5zICh1aW50IF9hbW91bnQpDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0uYmFsYW5jZSA9PSAwKSB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgLy9fYW1vdW50ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiMCBCYWxhbmNlIik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobXNnLnNlbmRlciA9PSBkZXZlbG9wZXJzKSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgIChub3cgPCB2ZXN0VGltZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9zdGF0RXZlbnQoIlRva2VucyBub3QgeWV0IHZlc3RlZC4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9fYW1vdW50ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBfYW1vdW50ID0gaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0uYmFsYW5jZTsgDQogICAgICAgICAgICAgICAgICAgICAgICBob2xkZXJBY2NvdW50c1ttc2cuc2VuZGVyXS5iYWxhbmNlID0gMDsgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuY2FsbC5nYXMocndHYXMpLnZhbHVlKF9hbW91bnQpKCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgICAgICAgICAgICAgLy9TdGF0RXZlbnRJKCJQYWlkIiwgX2Ftb3VudCk7DQoNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gc2V0IGdhcyBmb3Igb3BlcmF0aW9ucw0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIHNldE9wR2FzKHVpbnQgX3JtLCB1aW50IF9yZiwgdWludCBfcncpDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lciAmJiBtc2cuc2VuZGVyICE9IGRldmVsb3BlcnMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vU3RhdEV2ZW50KCJvbmx5IG93bmVyIGNhbGxzIik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJtR2FzID0gX3JtOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmZHYXMgPSBfcmY7DQogICAgICAgICAgICAgICAgICAgICAgICByd0dhcyA9IF9ydzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGdldCBnYXMgZm9yIG9wZXJhdGlvbnMNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBnZXRPcEdhcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgX3JtLCB1aW50IF9yZiwgdWludCBfcncpDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBfcm0gPSBybUdhczsNCiAgICAgICAgICAgICAgICBfcmYgPSByZkdhczsNCiAgICAgICAgICAgICAgICBfcncgPSByd0dhczsNCiAgICAgICAgfQ0KIA0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gY2hlY2sgcmV3YXJkcy4gIHBhc3MgaW4gYWRkcmVzcyBvZiB0b2tlbiBob2xkZXINCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBjaGVja0RpdmlkZW5kcyhhZGRyZXNzIF9hZGRyKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX2Ftb3VudCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChob2xkZXJBY2NvdW50c1tfYWRkcl0uYWxsb2NlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIF9hbW91bnQgPSBob2xkZXJBY2NvdW50c1tfYWRkcl0uYmFsYW5jZTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIGljb0NoZWNrdXAgLSBjaGVjayB1cCBjYWxsIGZvciBhZG1pbmlzdHJhdG9ycw0KICAgICAgICAvLyBhZnRlciBzYWxlIGlzIGNsb3NlZCBpZiBtaW4gaWNvIHRva2VucyBzb2xkLCAxMCBwZXJjZW50IHdpbGwgYmUgZGlzdHJpYnV0ZWQgdG8gDQogICAgICAgIC8vIGNvbXBhbnkgdG8gY292ZXIgdmFyaW91cyBvcGVyYXRpbmcgZXhwZW5zZXMNCiAgICAgICAgLy8gYWZ0ZXIgc2FsZSBhbmQgdXNhZ2UgZGVhbGluZXMgaGF2ZSBiZWVuIG1ldCwgcmVtYWluaW5nIDkwIHBlcmNlbnQgd2lsbCBiZSBkaXN0cmlidXRlZCB0bw0KICAgICAgICAvLyBjb21wYW55Lg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gaWNvQ2hlY2t1cCgpIHB1YmxpYw0KICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIgJiYgbXNnLnNlbmRlciAhPSBkZXZlbG9wZXJzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgICAgICAgICB1aW50IG5tc2dtYXNrOw0KICAgICAgICAgICAgICAgIC8vbm1zZ21hc2sgPSAwOw0KDQogICAgICAgICAgICAgICAgaWYgKGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5zYWxlQ2xvc2VkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGdldE51bVRva2Vuc1B1cmNoYXNlZCgpID49IG1pbkljb1Rva2VuR29hbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgKHJlbXVuZXJhdGlvblN0YWdlID09IDAgKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW11bmVyYXRpb25TdGFnZSA9IDE7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbXVuZXJhdGlvbkJhbGFuY2UgPSAodG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQvMTAwKSo5OyAvLyA5IHBlcmNlbnQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV4UGFydG5lckJhbGFuY2UgPSAgKHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkLzEwMCk7IC8vIDEgcGVyY2VudA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBubXNnbWFzayB8PSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5zdWNjZWVkZWQpIHsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlbXVuZXJhdGlvblN0YWdlID09IDAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbXVuZXJhdGlvblN0YWdlID0gMTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtdW5lcmF0aW9uQmFsYW5jZSA9ICh0b3RhbFRva2VuRnVuZHNSZWNlaXZlZC8xMDApKjk7IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXhQYXJ0bmVyQmFsYW5jZSA9ICAodG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQvMTAwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm1zZ21hc2sgfD0gNDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZW11bmVyYXRpb25TdGFnZSA9PSAxKSB7IC8vIHdlIGhhdmUgYWxyZWFkeSBzdWNlZWRlZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW11bmVyYXRpb25TdGFnZSA9IDI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbXVuZXJhdGlvbkJhbGFuY2UgKz0gdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQgLSAodG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQvMTApOyAvLyA5MCBwZXJjZW50DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5tc2dtYXNrIHw9IDg7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB1aW50IG50bXA7DQoNCiAgICAgICAgICAgICAgICBpZiAocmVtdW5lcmF0aW9uQmFsYW5jZSA+IDApIHsgDQogICAgICAgICAgICAgICAgLy8gb25seSBwYXkgb25lIGVudGl0eSBwZXIgY2FsbCwgZG9udCB3YW50IHRvIHJ1biBvdXQgb2YgZ2FzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG50bXAgPSByZW11bmVyYXRpb25CYWxhbmNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW11bmVyYXRpb25CYWxhbmNlID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZGVyT3JnLmNhbGwuZ2FzKHJtR2FzKS52YWx1ZShudG1wKSgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtdW5lcmF0aW9uQmFsYW5jZSA9IG50bXA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm1zZ21hc2sgfD0gMzI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm1zZ21hc2sgfD0gNjQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2UgIGlmIChhdXhQYXJ0bmVyQmFsYW5jZSA+IDApIHsNCiAgICAgICAgICAgICAgICAvLyBub3RlIHRoZSAiZWxzZSIgb25seSBwYXkgb25lIGVudGl0eSBwZXIgY2FsbCwgZG9udCB3YW50IHRvIHJ1biBvdXQgb2YgZ2FzDQogICAgICAgICAgICAgICAgICAgICAgICBudG1wID0gYXV4UGFydG5lckJhbGFuY2U7DQogICAgICAgICAgICAgICAgICAgICAgICBhdXhQYXJ0bmVyQmFsYW5jZSA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWF1eFBhcnRuZXIuY2FsbC5nYXMocm1HYXMpLnZhbHVlKG50bXApKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV4UGFydG5lckJhbGFuY2UgPSBudG1wOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBubXNnbWFzayB8PSAxMjg7DQogICAgICAgICAgICAgICAgICAgICAgICB9ICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm1zZ21hc2sgfD0gMjU2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgfSANCg0KICAgICAgICAgICAgICAgIFN0YXRFdmVudEkoImljby1jaGVja3VwIiwgbm1zZ21hc2spOw0KICAgICAgICB9DQoNCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIHN3YXAgZXhlY3V0b3INCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9hZGRyKSANCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyDQogICAgICAgICAgICAgICAgICAgICAgICB8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpDQogICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgICAgICAgICBvd25lciA9IF9hZGRyOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBzd2FwIGRldmVsb3BlcnMgYWNjb3VudA0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGNoYW5nZURldmV2b3BlckFjY29udChhZGRyZXNzIF9hZGRyKSANCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyDQogICAgICAgICAgICAgICAgICAgICAgICB8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpDQogICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICAgICAgZGV2ZWxvcGVycyA9IF9hZGRyOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBjaGFuZ2UgZm91bmRlcg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIGZ1bmN0aW9uIGNoYW5nZUZvdW5kZXIoYWRkcmVzcyBfYWRkcikgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcg0KICAgICAgICAgICAgICAgICAgICAgICAgfHwgc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5sb2NrZWRSZWxlYXNlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgICAgIGZvdW5kZXJPcmcgPSBfYWRkcjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gY2hhbmdlIGF1eFBhcnRuZXINCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBjaGFuZ2VBdXhQYXJ0bmVyKGFkZHJlc3MgX2F1eCkgDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcg0KICAgICAgICAgICAgICAgICAgICAgICAgfHwgc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5sb2NrZWRSZWxlYXNlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgICAgIGF1eFBhcnRuZXIgPSBfYXV4Ow0KICAgICAgICB9DQoNCg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIERFQlVHIE9OTFkgLSBlbmQgdGhpcyBjb250cmFjdCwgc3VpY2lkZSB0byBkZXZlbG9wZXJzDQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgZnVuY3Rpb24gaGFyYUtpcmkoKQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzU3RhdGUgIT0gU2V0dGluZ1N0YXRlVmFsdWUuZGVidWcpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikNCiAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgICAgICBzdWljaWRlKGRldmVsb3BlcnMpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyBnZXQgYWxsIGljbyBzdGF0dXMsIGZ1bmRpbmcgYW5kIHVzYWdlIGluZm8NCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBmdW5jdGlvbiBnZXRJY29JbmZvKCkgY29uc3RhbnQgcmV0dXJucyhJY29TdGF0dXNWYWx1ZSBfc3RhdHVzLCB1aW50IF9zYWxlU3RhcnQsIHVpbnQgX3NhbGVFbmQsIHVpbnQgX3VzYWdlRW5kLCB1aW50IF9zYWxlR29hbCwgdWludCBfdXNhZ2VHb2FsLCB1aW50IF9zb2xkLCB1aW50IF91c2VkLCB1aW50IF9mdW5kcywgdWludCBfY3JlZGl0cywgdWludCBfcmVtdVN0YWdlLCB1aW50IF92ZXN0KQ0KICAgICAgICB7DQogICAgICAgICAgICAgICAgX3N0YXR1cyA9IGljb1N0YXR1czsNCiAgICAgICAgICAgICAgICBfc2FsZVN0YXJ0ID0gZnVuZGluZ1N0YXJ0Ow0KICAgICAgICAgICAgICAgIF9zYWxlRW5kID0gZnVuZGluZ0RlYWRsaW5lOw0KICAgICAgICAgICAgICAgIF91c2FnZUVuZCA9IHVzYWdlRGVhZGxpbmU7DQogICAgICAgICAgICAgICAgX3Zlc3QgPSB2ZXN0VGltZTsNCiAgICAgICAgICAgICAgICBfc2FsZUdvYWwgPSBtaW5JY29Ub2tlbkdvYWw7DQogICAgICAgICAgICAgICAgX3VzYWdlR29hbCA9IG1pblVzYWdlR29hbDsNCiAgICAgICAgICAgICAgICBfc29sZCA9IGdldE51bVRva2Vuc1B1cmNoYXNlZCgpOw0KICAgICAgICAgICAgICAgIF91c2VkID0gZ2V0TnVtR2FtZXMoKTsNCiAgICAgICAgICAgICAgICBfZnVuZHMgPSB0b3RhbFRva2VuRnVuZHNSZWNlaXZlZDsNCiAgICAgICAgICAgICAgICBfY3JlZGl0cyA9IHBhcnRuZXJDcmVkaXRzOw0KICAgICAgICAgICAgICAgIF9yZW11U3RhZ2UgPSByZW11bmVyYXRpb25TdGFnZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGZsdXNoRGl2aWRlbmRzKCkNCiAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICgobXNnLnNlbmRlciAhPSBvd25lcikgJiYgKG1zZy5zZW5kZXIgIT0gZGV2ZWxvcGVycykpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgaWYgKGhvbGRvdmVyQmFsYW5jZSA+IDAgfHwgcGF5b3V0QmFsYW5jZSA+IDApDQogICAgICAgICAgICAgICAgICAgICAgICBkb1BheW91dCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gZG9EZXZlbG9wZXJHcmFudCgpIGludGVybmFsDQogICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoIWRldmVsb3BlcnNHcmFudGVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXZlbG9wZXJzR3JhbnRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBudW1EZXZUb2tlbnMgPSB0b3RhbFRva2Vuc01pbnRlZC8xMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsVG9rZW5zTWludGVkICs9IG51bURldlRva2VuczsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10uYWxsb2NlZCkgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZEFjY291bnQoZGV2ZWxvcGVycyk7DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IG5ld0hlbGQgPSBnZXRIZWxkKGhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLnRva2VucykgKyBudW1EZXZUb2tlbnM7DQogICAgICAgICAgICAgICAgICAgICAgICBob2xkZXJBY2NvdW50c1tkZXZlbG9wZXJzXS50b2tlbnMgPSBuZXdIZWxkIHwgIChjdXJQYXlvdXRJZCAqICgyICoqIDQ4KSk7DQoNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQp9'