base 64 content
base64employeesList
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KY29udHJhY3QgT3duYWJsZSB7DQogIC8vIHJlcGxhY2Ugd2l0aCBwcm9wZXIgemVwcGVsaW4gc21hcnQgY29udHJhY3QNCiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsNCiAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogIH0NCg0KICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpDQogICAgICB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsNCiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkNCiAgICAgIG93bmVyID0gbmV3T3duZXI7DQogIH0NCn0NCg0KDQpjb250cmFjdCBEZXN0cnVjdGFibGUgaXMgT3duYWJsZSB7DQogIGZ1bmN0aW9uIHNlbGZkZXN0cnVjdCgpIGV4dGVybmFsIG9ubHlPd25lciB7DQogICAgLy8gZnJlZSBldGhlcmV1bSBuZXR3b3JrIHN0YXRlIHdoZW4gZG9uZQ0KICAgIHNlbGZkZXN0cnVjdChvd25lcik7DQogIH0NCn0NCg0KDQpjb250cmFjdCBNYXRoIHsNCiAgLy8gc2NhbGUgb2YgdGhlIGVtdWxhdGVkIGZpeGVkIHBvaW50IG9wZXJhdGlvbnMNCiAgdWludCBjb25zdGFudCBwdWJsaWMgRlBfU0NBTEUgPSAxMDAwMDsNCg0KICAvLyB0b2RvOiBzaG91bGQgYmUgYSBsaWJyYXJ5DQogIGZ1bmN0aW9uIGRpdlJvdW5kKHVpbnQgdiwgdWludCBkKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsNCiAgICAvLyByb3VuZCB1cCBpZiAlIGlzIGhhbGYgb3IgbW9yZQ0KICAgIHJldHVybiAodiArIChkLzIpKSAvIGQ7DQogIH0NCg0KICBmdW5jdGlvbiBhYnNEaWZmKHVpbnQgdjEsIHVpbnQgdjIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsNCiAgICByZXR1cm4gdjEgPiB2MiA/IHYxIC0gdjIgOiB2MiAtIHYxOw0KICB9DQoNCiAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICogYjsNCiAgICBpZiAoYSA9PSAwIHx8IGMgLyBhID09IGIpDQogICAgICByZXR1cm4gYzsNCiAgICBlbHNlDQogICAgICB0aHJvdzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBpZiAoIShjPj1hICYmIGM+PWIpKQ0KICAgICAgdGhyb3c7DQogICAgcmV0dXJuIGM7DQogIH0NCn0NCg0KDQpjb250cmFjdCBUaW1lU291cmNlIHsNCiAgdWludDMyIHByaXZhdGUgbW9ja05vdzsNCg0KICBmdW5jdGlvbiBjdXJyZW50VGltZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MzIpIHsNCiAgICAvLyB3ZSBkbyBub3Qgc3VwcG9ydCBkYXRlcyBtdWNoIGludG8gZnV0dXJlIChTdW4sIDA3IEZlYiAyMTA2IDA2OjI4OjE1IEdNVCkNCiAgICBpZiAoYmxvY2sudGltZXN0YW1wID4gMHhGRkZGRkZGRikNCiAgICAgIHRocm93Ow0KICAgIHJldHVybiBtb2NrTm93ID4gMCA/IG1vY2tOb3cgOiB1aW50MzIoYmxvY2sudGltZXN0YW1wKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1vY2tUaW1lKHVpbnQzMiB0KSBwdWJsaWMgew0KICAgIC8vIG5vIG1vY2tpbmcgb24gbWFpbm5ldA0KICAgIGlmIChibG9jay5udW1iZXIgPiAzMzE2MDI5KQ0KICAgICAgdGhyb3c7DQogICAgbW9ja05vdyA9IHQ7DQogIH0NCn0NCg0KDQpjb250cmFjdCBCYXNlT3B0aW9uc0NvbnZlcnRlciB7DQoNCiAgLy8gbW9kaWZpZXJzIGFyZSBpbmhlcml0ZWQsIGNoZWNrIGBvd25lZGAgcGF0dGVybg0KICAvLyAgIGh0dHA6Ly9zb2xpZGl0eS5yZWFkdGhlZG9jcy5pby9lbi9kZXZlbG9wL2NvbnRyYWN0cy5odG1sI2Z1bmN0aW9uLW1vZGlmaWVycw0KICBtb2RpZmllciBvbmx5RVNPUCgpIHsNCiAgICBpZiAobXNnLnNlbmRlciAhPSBnZXRFU09QKCkpDQogICAgICB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgLy8gcmV0dXJucyBFU09QIGFkZHJlc3Mgd2hpY2ggaXMgYSBzb2xlIGV4ZWN1dG9yIG9mIGV4ZXJjaXNlT3B0aW9ucyBmdW5jdGlvbg0KICBmdW5jdGlvbiBnZXRFU09QKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpOw0KICAvLyBkZWFkbGluZSBmb3IgZW1wbG95ZWVzIHRvIGV4ZXJjaXNlIG9wdGlvbnMNCiAgZnVuY3Rpb24gZ2V0RXhlcmNpc2VQZXJpb2REZWFkbGluZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MzIpOw0KDQogIC8vIGV4ZXJjaXNlIG9mIG9wdGlvbnMgZm9yIGdpdmVuIGVtcGxveWVlIGFuZCBhbW91bnQsIHBsZWFzZSBub3RlIHRoYXQgZW1wbG95ZWUgYWRkcmVzcyBtYXkgYmUgMA0KICAvLyAuLiBpbiB3aGljaCBjYXNlIHRoZSBpbnRlbnRpb24gaXMgdG8gYnVybiBvcHRpb25zDQogIGZ1bmN0aW9uIGV4ZXJjaXNlT3B0aW9ucyhhZGRyZXNzIGVtcGxveWVlLCB1aW50IHBvb2xPcHRpb25zLCB1aW50IGV4dHJhT3B0aW9ucywgdWludCBib251c09wdGlvbnMsDQogICAgYm9vbCBhZ3JlZVRvQWNjZWxlcmF0ZWRWZXN0aW5nQm9udXNDb25kaXRpb25zKSBvbmx5RVNPUCBwdWJsaWM7DQp9DQoNCmNvbnRyYWN0IEVTT1BUeXBlcyB7DQogIC8vIGVudW1zIGFyZSBudW1iZXJlZCBzdGFydGluZyBmcm9tIDAuIE5vdFNldCBpcyB1c2VkIHRvIGNoZWNrIGZvciBub24gZXhpc3RpbmcgbWFwcGluZw0KICBlbnVtIEVtcGxveWVlU3RhdGUgeyBOb3RTZXQsIFdhaXRpbmdGb3JTaWduYXR1cmUsIEVtcGxveWVkLCBUZXJtaW5hdGVkLCBPcHRpb25zRXhlcmNpc2VkIH0NCiAgLy8gcGxlYXNlIG5vdGUgdGhhdCAzMiBiaXQgdW5zaWduZWQgaW50IGlzIHVzZWQgdG8gcmVwcmVzZW50IFVOSVggdGltZSB3aGljaCBpcyBlbm91Z2ggdG8gcmVwcmVzZW50IGRhdGVzIHVudGlsIFN1biwgMDcgRmViIDIxMDYgMDY6Mjg6MTUgR01UDQogIC8vIHN0b3JhZ2UgYWNjZXNzIGlzIG9wdGltaXplZCBzbyBzdHJ1Y3QgbGF5b3V0IGlzIGltcG9ydGFudA0KICBzdHJ1Y3QgRW1wbG95ZWUgew0KICAgICAgLy8gd2hlbiB2ZXN0aW5nIHN0YXJ0cw0KICAgICAgdWludDMyIGlzc3VlRGF0ZTsNCiAgICAgIC8vIHdhaXQgZm9yIGVtcGxveWVlIHNpZ25hdHVyZSB1bnRpbCB0aGF0IHRpbWUNCiAgICAgIHVpbnQzMiB0aW1lVG9TaWduOw0KICAgICAgLy8gZGF0ZSB3aGVuIGVtcGxveWVlIHdhcyB0ZXJtaW5hdGVkLCAwIGZvciBub3QgdGVybWluYXRlZA0KICAgICAgdWludDMyIHRlcm1pbmF0ZWRBdDsNCiAgICAgIC8vIHdoZW4gZmFkZSBvdXQgc3RhcnRzLCAwIGZvciBub3Qgc2V0LCBpbml0YWxseSA9PSB0ZXJtaW5hdGVkQXQNCiAgICAgIC8vIHVzZWQgb25seSB3aGVuIGNhbGN1bGF0aW5nIG9wdGlvbnMgcmV0dXJuZWQgdG8gcG9vbA0KICAgICAgdWludDMyIGZhZGVvdXRTdGFydHM7DQogICAgICAvLyBwb29sT3B0aW9ucyBlbXBsb3llZSBnZXRzIChleGl0IGJvbnVzIG5vdCBpbmNsdWRlZCkNCiAgICAgIHVpbnQzMiBwb29sT3B0aW9uczsNCiAgICAgIC8vIGV4dHJhIG9wdGlvbnMgZW1wbG95ZWUgZ2V0cyAobmV1ZnVuZCB3aWxsIG5vdCB0aGlzIG9wdGlvbikNCiAgICAgIHVpbnQzMiBleHRyYU9wdGlvbnM7DQogICAgICAvLyB0aW1lIGF0IHdoaWNoIGVtcGxveWVlIGdvdCBzdXNwZW5kZWQsIDAgLSBub3Qgc3VzcGVuZGVkDQogICAgICB1aW50MzIgc3VzcGVuZGVkQXQ7DQogICAgICAvLyB3aGF0IGlzIGVtcGxveWVlIGN1cnJlbnQgc3RhdHVzLCB0YWtlcyA4IGJpdCBpbiBzdG9yYWdlDQogICAgICBFbXBsb3llZVN0YXRlIHN0YXRlOw0KICAgICAgLy8gaW5kZXggaW4gaXRlcmFibGUgbWFwcGluZw0KICAgICAgdWludDE2IGlkeDsNCiAgICAgIC8vIHJlc2VydmUgdW50aWwgZnVsbCAyNTYgYml0IHdvcmQNCiAgICAgIC8vdWludDI0IHJlc2VydmVkOw0KICB9DQoNCiAgZnVuY3Rpb24gc2VyaWFsaXplRW1wbG95ZWUoRW1wbG95ZWUgbWVtb3J5IGVtcGxveWVlKQ0KICAgIGludGVybmFsDQogICAgY29uc3RhbnQNCiAgICByZXR1cm5zKHVpbnRbOV0gZW1wKQ0KICB7DQogICAgICAvLyBndWVzcyB3aGF0OiBzdHJ1Y3QgbGF5b3V0IGluIG1lbW9yeSBpcyBhbGlnbmVkIHRvIHdvcmQgKDI1NiBiaXRzKQ0KICAgICAgLy8gc3RydWN0IGluIHN0b3JhZ2UgaXMgYnl0ZSBhbGlnbmVkDQogICAgICBhc3NlbWJseSB7DQogICAgICAgIC8vIHJldHVybiBtZW1vcnkgYWxpZ25lZCBzdHJ1Y3QgYXMgYXJyYXkgb2Ygd29yZHMNCiAgICAgICAgLy8gSSBqdXN0IHdvbmRlciB3aGVuICdlbXBsb3llZScgbWVtb3J5IGlzIGRlYWxsb2NhdGVkDQogICAgICAgIC8vIGFuc3dlcjogbWVtb3J5IGlzIG5vdCBkZWFsbG9jYXRlZCB1bnRpbCB0cmFuc2FjdGlvbiBlbmRzDQogICAgICAgIGVtcCA6PSBlbXBsb3llZQ0KICAgICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZGVzZXJpYWxpemVFbXBsb3llZSh1aW50WzldIHNlcmlhbGl6ZWRFbXBsb3llZSkNCiAgICBpbnRlcm5hbA0KICAgIGNvbnN0YW50DQogICAgcmV0dXJucyAoRW1wbG95ZWUgbWVtb3J5IGVtcCkNCiAgew0KICAgICAgYXNzZW1ibHkgeyBlbXAgOj0gc2VyaWFsaXplZEVtcGxveWVlIH0NCiAgfQ0KfQ0KDQoNCmNvbnRyYWN0IENvZGVVcGRhdGVhYmxlIGlzIE93bmFibGUgew0KICAgIC8vIGFsbG93cyB0byBzdG9wIG9wZXJhdGlvbnMgYW5kIG1pZ3JhdGUgZGF0YSB0byBkaWZmZXJlbnQgY29udHJhY3QNCiAgICBlbnVtIENvZGVVcGRhdGVTdGF0ZSB7IEN1cnJlbnRDb2RlLCBPbmdvaW5nVXBkYXRlIC8qLCBDb2RlVXBkYXRlZCovfQ0KICAgIENvZGVVcGRhdGVTdGF0ZSBwdWJsaWMgY29kZVVwZGF0ZVN0YXRlOw0KDQogICAgbW9kaWZpZXIgaXNDdXJyZW50Q29kZSgpIHsNCiAgICAgIGlmIChjb2RlVXBkYXRlU3RhdGUgIT0gQ29kZVVwZGF0ZVN0YXRlLkN1cnJlbnRDb2RlKQ0KICAgICAgICB0aHJvdzsNCiAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgaW5Db2RlVXBkYXRlKCkgew0KICAgICAgaWYgKGNvZGVVcGRhdGVTdGF0ZSAhPSBDb2RlVXBkYXRlU3RhdGUuT25nb2luZ1VwZGF0ZSkNCiAgICAgICAgdGhyb3c7DQogICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGJlZ2luQ29kZVVwZGF0ZSgpIHB1YmxpYyBvbmx5T3duZXIgaXNDdXJyZW50Q29kZSB7DQogICAgICBjb2RlVXBkYXRlU3RhdGUgPSBDb2RlVXBkYXRlU3RhdGUuT25nb2luZ1VwZGF0ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjYW5jZWxDb2RlVXBkYXRlKCkgcHVibGljIG9ubHlPd25lciBpbkNvZGVVcGRhdGUgew0KICAgICAgY29kZVVwZGF0ZVN0YXRlID0gQ29kZVVwZGF0ZVN0YXRlLkN1cnJlbnRDb2RlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNvbXBsZXRlQ29kZVVwZGF0ZSgpIHB1YmxpYyBvbmx5T3duZXIgaW5Db2RlVXBkYXRlIHsNCiAgICAgIHNlbGZkZXN0cnVjdChvd25lcik7DQogICAgfQ0KfQ0KDQpjb250cmFjdCBFbXBsb3llZXNMaXN0IGlzIEVTT1BUeXBlcywgT3duYWJsZSwgRGVzdHJ1Y3RhYmxlIHsNCiAgZXZlbnQgQ3JlYXRlRW1wbG95ZWUoYWRkcmVzcyBpbmRleGVkIGUsIHVpbnQzMiBwb29sT3B0aW9ucywgdWludDMyIGV4dHJhT3B0aW9ucywgdWludDE2IGlkeCk7DQogIGV2ZW50IFVwZGF0ZUVtcGxveWVlKGFkZHJlc3MgaW5kZXhlZCBlLCB1aW50MzIgcG9vbE9wdGlvbnMsIHVpbnQzMiBleHRyYU9wdGlvbnMsIHVpbnQxNiBpZHgpOw0KICBldmVudCBDaGFuZ2VFbXBsb3llZVN0YXRlKGFkZHJlc3MgaW5kZXhlZCBlLCBFbXBsb3llZVN0YXRlIG9sZFN0YXRlLCBFbXBsb3llZVN0YXRlIG5ld1N0YXRlKTsNCiAgZXZlbnQgUmVtb3ZlRW1wbG95ZWUoYWRkcmVzcyBpbmRleGVkIGUpOw0KICBtYXBwaW5nIChhZGRyZXNzID0+IEVtcGxveWVlKSBlbXBsb3llZXM7DQogIC8vIGFkZHJlc3NlcyBpbiB0aGUgbWFwcGluZywgZXZlcg0KICBhZGRyZXNzW10gcHVibGljIGFkZHJlc3NlczsNCg0KICBmdW5jdGlvbiBzaXplKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDE2KSB7DQogICAgcmV0dXJuIHVpbnQxNihhZGRyZXNzZXMubGVuZ3RoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNldEVtcGxveWVlKGFkZHJlc3MgZSwgdWludDMyIGlzc3VlRGF0ZSwgdWludDMyIHRpbWVUb1NpZ24sIHVpbnQzMiB0ZXJtaW5hdGVkQXQsIHVpbnQzMiBmYWRlb3V0U3RhcnRzLA0KICAgIHVpbnQzMiBwb29sT3B0aW9ucywgdWludDMyIGV4dHJhT3B0aW9ucywgdWludDMyIHN1c3BlbmRlZEF0LCBFbXBsb3llZVN0YXRlIHN0YXRlKQ0KICAgIGV4dGVybmFsDQogICAgb25seU93bmVyDQogICAgcmV0dXJucyAoYm9vbCBpc05ldykNCiAgew0KICAgIHVpbnQxNiBlbXBJZHggPSBlbXBsb3llZXNbZV0uaWR4Ow0KICAgIGlmIChlbXBJZHggPT0gMCkgew0KICAgICAgLy8gbmV3IGVsZW1lbnQNCiAgICAgIHVpbnQgc2l6ZSA9IGFkZHJlc3Nlcy5sZW5ndGg7DQogICAgICBpZiAoc2l6ZSA9PSAweEZGRkYpDQogICAgICAgIHRocm93Ow0KICAgICAgaXNOZXcgPSB0cnVlOw0KICAgICAgZW1wSWR4ID0gdWludDE2KHNpemUgKyAxKTsNCiAgICAgIGFkZHJlc3Nlcy5wdXNoKGUpOw0KICAgICAgQ3JlYXRlRW1wbG95ZWUoZSwgcG9vbE9wdGlvbnMsIGV4dHJhT3B0aW9ucywgZW1wSWR4KTsNCiAgICB9IGVsc2Ugew0KICAgICAgaXNOZXcgPSBmYWxzZTsNCiAgICAgIFVwZGF0ZUVtcGxveWVlKGUsIHBvb2xPcHRpb25zLCBleHRyYU9wdGlvbnMsIGVtcElkeCk7DQogICAgfQ0KICAgIGVtcGxveWVlc1tlXSA9IEVtcGxveWVlKHsNCiAgICAgICAgaXNzdWVEYXRlOiBpc3N1ZURhdGUsDQogICAgICAgIHRpbWVUb1NpZ246IHRpbWVUb1NpZ24sDQogICAgICAgIHRlcm1pbmF0ZWRBdDogdGVybWluYXRlZEF0LA0KICAgICAgICBmYWRlb3V0U3RhcnRzOiBmYWRlb3V0U3RhcnRzLA0KICAgICAgICBwb29sT3B0aW9uczogcG9vbE9wdGlvbnMsDQogICAgICAgIGV4dHJhT3B0aW9uczogZXh0cmFPcHRpb25zLA0KICAgICAgICBzdXNwZW5kZWRBdDogc3VzcGVuZGVkQXQsDQogICAgICAgIHN0YXRlOiBzdGF0ZSwNCiAgICAgICAgaWR4OiBlbXBJZHgNCiAgICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gY2hhbmdlU3RhdGUoYWRkcmVzcyBlLCBFbXBsb3llZVN0YXRlIHN0YXRlKQ0KICAgIGV4dGVybmFsDQogICAgb25seU93bmVyDQogIHsNCiAgICBpZiAoZW1wbG95ZWVzW2VdLmlkeCA9PSAwKQ0KICAgICAgdGhyb3c7DQogICAgQ2hhbmdlRW1wbG95ZWVTdGF0ZShlLCBlbXBsb3llZXNbZV0uc3RhdGUsIHN0YXRlKTsNCiAgICBlbXBsb3llZXNbZV0uc3RhdGUgPSBzdGF0ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNldEZhZGVvdXRTdGFydHMoYWRkcmVzcyBlLCB1aW50MzIgZmFkZW91dFN0YXJ0cykNCiAgICBleHRlcm5hbA0KICAgIG9ubHlPd25lcg0KICB7DQogICAgaWYgKGVtcGxveWVlc1tlXS5pZHggPT0gMCkNCiAgICAgIHRocm93Ow0KICAgIFVwZGF0ZUVtcGxveWVlKGUsIGVtcGxveWVlc1tlXS5wb29sT3B0aW9ucywgZW1wbG95ZWVzW2VdLmV4dHJhT3B0aW9ucywgZW1wbG95ZWVzW2VdLmlkeCk7DQogICAgZW1wbG95ZWVzW2VdLmZhZGVvdXRTdGFydHMgPSBmYWRlb3V0U3RhcnRzOw0KICB9DQoNCiAgZnVuY3Rpb24gcmVtb3ZlRW1wbG95ZWUoYWRkcmVzcyBlKQ0KICAgIGV4dGVybmFsDQogICAgb25seU93bmVyDQogICAgcmV0dXJucyAoYm9vbCkNCiAgew0KICAgIHVpbnQxNiBlbXBJZHggPSBlbXBsb3llZXNbZV0uaWR4Ow0KICAgIGlmIChlbXBJZHggPiAwKSB7DQogICAgICAgIGRlbGV0ZSBlbXBsb3llZXNbZV07DQogICAgICAgIGRlbGV0ZSBhZGRyZXNzZXNbZW1wSWR4LTFdOw0KICAgICAgICBSZW1vdmVFbXBsb3llZShlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRlcm1pbmF0ZUVtcGxveWVlKGFkZHJlc3MgZSwgdWludDMyIGlzc3VlRGF0ZSwgdWludDMyIHRlcm1pbmF0ZWRBdCwgdWludDMyIGZhZGVvdXRTdGFydHMsIEVtcGxveWVlU3RhdGUgc3RhdGUpDQogICAgZXh0ZXJuYWwNCiAgICBvbmx5T3duZXINCiAgew0KICAgIGlmIChzdGF0ZSAhPSBFbXBsb3llZVN0YXRlLlRlcm1pbmF0ZWQpDQogICAgICAgIHRocm93Ow0KICAgIEVtcGxveWVlIGVtcGxveWVlID0gZW1wbG95ZWVzW2VdOyAvLyBnZXRzIHJlZmVyZW5jZSB0byBzdG9yYWdlIGFuZCBvcHRpbWl6ZXIgZG9lcyBpdCB3aXRoIG9uZSBTU1RPUkUNCiAgICBpZiAoZW1wbG95ZWUuaWR4ID09IDApDQogICAgICB0aHJvdzsNCiAgICBDaGFuZ2VFbXBsb3llZVN0YXRlKGUsIGVtcGxveWVlLnN0YXRlLCBzdGF0ZSk7DQogICAgZW1wbG95ZWUuc3RhdGUgPSBzdGF0ZTsNCiAgICBlbXBsb3llZS5pc3N1ZURhdGUgPSBpc3N1ZURhdGU7DQogICAgZW1wbG95ZWUudGVybWluYXRlZEF0ID0gdGVybWluYXRlZEF0Ow0KICAgIGVtcGxveWVlLmZhZGVvdXRTdGFydHMgPSBmYWRlb3V0U3RhcnRzOw0KICAgIGVtcGxveWVlLnN1c3BlbmRlZEF0ID0gMDsNCiAgICBVcGRhdGVFbXBsb3llZShlLCBlbXBsb3llZS5wb29sT3B0aW9ucywgZW1wbG95ZWUuZXh0cmFPcHRpb25zLCBlbXBsb3llZS5pZHgpOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0RW1wbG95ZWUoYWRkcmVzcyBlKQ0KICAgIGV4dGVybmFsDQogICAgY29uc3RhbnQNCiAgICByZXR1cm5zICh1aW50MzIsIHVpbnQzMiwgdWludDMyLCB1aW50MzIsIHVpbnQzMiwgdWludDMyLCB1aW50MzIsIEVtcGxveWVlU3RhdGUpDQogIHsNCiAgICAgIEVtcGxveWVlIGVtcGxveWVlID0gZW1wbG95ZWVzW2VdOw0KICAgICAgaWYgKGVtcGxveWVlLmlkeCA9PSAwKQ0KICAgICAgICB0aHJvdzsNCiAgICAgIC8vIHdoZXJlIGlzIHN0cnVjdCB6aXAvdW56aXAgOj4NCiAgICAgIHJldHVybiAoZW1wbG95ZWUuaXNzdWVEYXRlLCBlbXBsb3llZS50aW1lVG9TaWduLCBlbXBsb3llZS50ZXJtaW5hdGVkQXQsIGVtcGxveWVlLmZhZGVvdXRTdGFydHMsDQogICAgICAgIGVtcGxveWVlLnBvb2xPcHRpb25zLCBlbXBsb3llZS5leHRyYU9wdGlvbnMsIGVtcGxveWVlLnN1c3BlbmRlZEF0LCBlbXBsb3llZS5zdGF0ZSk7DQogIH0NCg0KICAgZnVuY3Rpb24gaGFzRW1wbG95ZWUoYWRkcmVzcyBlKQ0KICAgICBleHRlcm5hbA0KICAgICBjb25zdGFudA0KICAgICByZXR1cm5zIChib29sKQ0KICAgew0KICAgICAgLy8gdGhpcyBpcyB2ZXJ5IGluZWZmaWNpZW50IC0gd2hvbGUgd29yZCBpcyBsb2FkZWQganVzdCB0byBjaGVjayB0aGlzDQogICAgICByZXR1cm4gZW1wbG95ZWVzW2VdLmlkeCAhPSAwOw0KICAgIH0NCg0KICBmdW5jdGlvbiBnZXRTZXJpYWxpemVkRW1wbG95ZWUoYWRkcmVzcyBlKQ0KICAgIGV4dGVybmFsDQogICAgY29uc3RhbnQNCiAgICByZXR1cm5zICh1aW50WzldKQ0KICB7DQogICAgRW1wbG95ZWUgbWVtb3J5IGVtcGxveWVlID0gZW1wbG95ZWVzW2VdOw0KICAgIGlmIChlbXBsb3llZS5pZHggPT0gMCkNCiAgICAgIHRocm93Ow0KICAgIHJldHVybiBzZXJpYWxpemVFbXBsb3llZShlbXBsb3llZSk7DQogIH0NCn0NCg0KDQpjb250cmFjdCBFUkMyME9wdGlvbnNDb252ZXJ0ZXIgaXMgQmFzZU9wdGlvbnNDb252ZXJ0ZXIsIFRpbWVTb3VyY2UsIE1hdGggew0KICAvLyBzZWUgYmFzZSBjbGFzcyBmb3IgZXhwbGFuYXRpb25zDQogIGFkZHJlc3MgZXNvcEFkZHJlc3M7DQogIHVpbnQzMiBleGVyY2lzZVBlcmlvZERlYWRsaW5lOw0KICAvLyBiYWxhbmNlcyBmb3IgY29udmVydGVkIG9wdGlvbnMNCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGludGVybmFsIGJhbGFuY2VzOw0KICAvLyB0b3RhbCBzdXBwbHkNCiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7DQoNCiAgLy8gZGVhZGxpbmUgZm9yIGFsbCBvcHRpb25zIGNvbnZlcnNpb24gaW5jbHVkaW5nIGNvbXBhbnkncyBhY3Rpb25zDQogIHVpbnQzMiBwdWJsaWMgb3B0aW9uc0NvbnZlcnNpb25EZWFkbGluZTsNCg0KICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsNCg0KICBtb2RpZmllciBjb252ZXJ0aW5nKCkgew0KICAgIC8vIHRocm93IGFmdGVyIGRlYWRsaW5lDQogICAgaWYgKGN1cnJlbnRUaW1lKCkgPj0gZXhlcmNpc2VQZXJpb2REZWFkbGluZSkNCiAgICAgIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBjb252ZXJ0ZWQoKSB7DQogICAgLy8gdGhyb3cgYmVmb3JlIGRlYWRsaW5lDQogICAgaWYgKGN1cnJlbnRUaW1lKCkgPCBvcHRpb25zQ29udmVyc2lvbkRlYWRsaW5lKQ0KICAgICAgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQoNCiAgZnVuY3Rpb24gZ2V0RVNPUCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7DQogICAgcmV0dXJuIGVzb3BBZGRyZXNzOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0RXhlcmNpc2VQZXJpb2REZWFkbGluZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQzMikgew0KICAgIHJldHVybiBleGVyY2lzZVBlcmlvZERlYWRsaW5lOw0KICB9DQoNCiAgZnVuY3Rpb24gZXhlcmNpc2VPcHRpb25zKGFkZHJlc3MgZW1wbG95ZWUsIHVpbnQgcG9vbE9wdGlvbnMsIHVpbnQgZXh0cmFPcHRpb25zLCB1aW50IGJvbnVzT3B0aW9ucywNCiAgICBib29sIGFncmVlVG9BY2NlbGVyYXRlZFZlc3RpbmdCb251c0NvbmRpdGlvbnMpDQogICAgcHVibGljDQogICAgb25seUVTT1ANCiAgICBjb252ZXJ0aW5nDQogIHsNCiAgICAvLyBpZiBubyBvdmVyZmxvdyBvbiB0b3RhbFN1cHBseSwgbm8gb3ZlcmZsb3dzIGxhdGVyDQogICAgdWludCBvcHRpb25zID0gc2FmZUFkZChzYWZlQWRkKHBvb2xPcHRpb25zLCBleHRyYU9wdGlvbnMpLCBib251c09wdGlvbnMpOw0KICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgb3B0aW9ucyk7DQogICAgYmFsYW5jZXNbZW1wbG95ZWVdICs9IG9wdGlvbnM7DQogICAgVHJhbnNmZXIoMCwgZW1wbG95ZWUsIG9wdGlvbnMpOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjb252ZXJ0ZWQgcHVibGljIHsNCiAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCBfdmFsdWUpDQogICAgICB0aHJvdzsNCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7DQogICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7DQogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCBiYWxhbmNlKSB7DQogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogIH0NCg0KICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsNCiAgICB0aHJvdzsNCiAgfQ0KDQogIGZ1bmN0aW9uIEVSQzIwT3B0aW9uc0NvbnZlcnRlcihhZGRyZXNzIGVzb3AsIHVpbnQzMiBleGVyY2lzZURlYWRsaW5lLCB1aW50MzIgY29udmVyc2lvbkRlYWRsaW5lKSB7DQogICAgZXNvcEFkZHJlc3MgPSBlc29wOw0KICAgIGV4ZXJjaXNlUGVyaW9kRGVhZGxpbmUgPSBleGVyY2lzZURlYWRsaW5lOw0KICAgIG9wdGlvbnNDb252ZXJzaW9uRGVhZGxpbmUgPSBjb252ZXJzaW9uRGVhZGxpbmU7DQogIH0NCn0NCg0KY29udHJhY3QgRVNPUE1pZ3JhdGlvbiB7DQogIG1vZGlmaWVyIG9ubHlPbGRFU09QKCkgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IGdldE9sZEVTT1AoKSkNCiAgICAgIHRocm93Ow0KICAgIF87DQogIH0NCg0KICAvLyByZXR1cm5zIEVTT1AgYWRkcmVzcyB3aGljaCBpcyBhIHNvbGUgZXhlY3V0b3Igb2YgZXhlcmNpc2VPcHRpb25zIGZ1bmN0aW9uDQogIGZ1bmN0aW9uIGdldE9sZEVTT1AoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyk7DQoNCiAgLy8gbWlncmF0ZSBlbXBsb3llZSB0byBuZXcgRVNPUCBjb250cmFjdCwgdGhyb3dzIGlmIG5vdCBwb3NzaWJsZQ0KICAvLyBpbiBzaW1wbGVzdCBjYXNlIG5ldyBFU09QIGNvbnRyYWN0IHNob3VsZCBkZXJpdmUgZnJvbSB0aGlzIGNvbnRyYWN0IGFuZCBpbXBsZW1lbnQgYWJzdHJhY3QgbWV0aG9kcw0KICAvLyBlbXBsb3llZXMgbGlzdCBpcyBhdmFpbGFibGUgZm9yIGluc3BlY3Rpb24gYnkgZW1wbG95ZWUgYWRkcmVzcw0KICAvLyBwb29sT3B0aW9ucyBhbmQgZXh0cmFPcHRpb24gaXMgYW1vdW50IG9mIG9wdGlvbnMgdHJhbnNmZXJyZWQgb3V0IG9mIG9sZCBFU09QIGNvbnRyYWN0DQogIGZ1bmN0aW9uIG1pZ3JhdGUoYWRkcmVzcyBlbXBsb3llZSwgdWludCBwb29sT3B0aW9ucywgdWludCBleHRyYU9wdGlvbnMpIG9ubHlPbGRFU09QIHB1YmxpYzsNCn0NCg0KY29udHJhY3QgRVNPUCBpcyBFU09QVHlwZXMsIENvZGVVcGRhdGVhYmxlLCBUaW1lU291cmNlIHsNCiAgLy8gZW1wbG95ZWUgY2hhbmdlZCBldmVudHMNCiAgZXZlbnQgRVNPUE9mZmVyZWQoYWRkcmVzcyBpbmRleGVkIGVtcGxveWVlLCBhZGRyZXNzIGNvbXBhbnksIHVpbnQzMiBwb29sT3B0aW9ucywgdWludDMyIGV4dHJhT3B0aW9ucyk7DQogIGV2ZW50IEVtcGxveWVlU2lnbmVkVG9FU09QKGFkZHJlc3MgaW5kZXhlZCBlbXBsb3llZSk7DQogIGV2ZW50IFN1c3BlbmRFbXBsb3llZShhZGRyZXNzIGluZGV4ZWQgZW1wbG95ZWUsIHVpbnQzMiBzdXNwZW5kZWRBdCk7DQogIGV2ZW50IENvbnRpbnVlU3VzcGVuZGVkRW1wbG95ZWUoYWRkcmVzcyBpbmRleGVkIGVtcGxveWVlLCB1aW50MzIgY29udGludWVkQXQsIHVpbnQzMiBzdXNwZW5kZWRQZXJpb2QpOw0KICBldmVudCBUZXJtaW5hdGVFbXBsb3llZShhZGRyZXNzIGluZGV4ZWQgZW1wbG95ZWUsIGFkZHJlc3MgY29tcGFueSwgdWludDMyIHRlcm1pbmF0ZWRBdCwgVGVybWluYXRpb25UeXBlIHRlcm1UeXBlKTsNCiAgZXZlbnQgRW1wbG95ZWVPcHRpb25zRXhlcmNpc2VkKGFkZHJlc3MgaW5kZXhlZCBlbXBsb3llZSwgYWRkcmVzcyBleGVyY2lzZWRGb3IsIHVpbnQzMiBwb29sT3B0aW9ucywgYm9vbCBkaXNhYmxlQWNjZWxlcmF0ZWRWZXN0aW5nKTsNCiAgZXZlbnQgRW1wbG95ZWVNaWdyYXRlZChhZGRyZXNzIGluZGV4ZWQgZW1wbG95ZWUsIGFkZHJlc3MgbWlncmF0aW9uLCB1aW50IHBvb2wsIHVpbnQgZXh0cmEpOw0KICAvLyBlc29wIGNoYW5nZWQgZXZlbnRzDQogIGV2ZW50IEVTT1BPcGVuZWQoYWRkcmVzcyBjb21wYW55KTsNCiAgZXZlbnQgT3B0aW9uc0NvbnZlcnNpb25PZmZlcmVkKGFkZHJlc3MgY29tcGFueSwgYWRkcmVzcyBjb252ZXJ0ZXIsIHVpbnQzMiBjb252ZXJ0ZWRBdCwgdWludDMyIGV4ZXJjaXNlUGVyaW9kRGVhZGxpbmUpOw0KICBlbnVtIEVTT1BTdGF0ZSB7IE5ldywgT3BlbiwgQ29udmVyc2lvbiB9DQogIC8vIHVzZSByZXRydW4gY29kZXMgdW50aWwgcmV2ZXJ0IG9wY29kZSBpcyBpbXBsZW1lbnRlZA0KICBlbnVtIFJldHVybkNvZGVzIHsgT0ssIEludmFsaWRFbXBsb3llZVN0YXRlLCBUb29MYXRlLCBJbnZhbGlkUGFyYW1ldGVycywgVG9vRWFybHkgIH0NCiAgLy8gZXZlbnQgcmFpc2VkIHdoZW4gcmV0dXJuIGNvZGUgZnJvbSBhIGZ1bmN0aW9uIGlzIG5vdCBPSywgd2hlbiBPSyBpcyByZXR1cm5lZCBvbmUgb2YgZXZlbnRzIGFib3ZlIGlzIHJhaXNlZA0KICBldmVudCBSZXR1cm5Db2RlKFJldHVybkNvZGVzIHJjKTsNCiAgZW51bSBUZXJtaW5hdGlvblR5cGUgeyBSZWd1bGFyLCBCYWRMZWF2ZXIgfQ0KDQogIC8vQ09ORklHDQogIE9wdGlvbnNDYWxjdWxhdG9yIHB1YmxpYyBvcHRpb25zQ2FsY3VsYXRvcjsNCiAgLy8gdG90YWwgcG9vbE9wdGlvbnMgaW4gVGhlIFBvb2wNCiAgdWludCBwdWJsaWMgdG90YWxQb29sT3B0aW9uczsNCiAgLy8gaXBmcyBoYXNoIG9mIGRvY3VtZW50IGVzdGFibGlzaGluZyB0aGlzIEVTT1ANCiAgYnl0ZXMgcHVibGljIEVTT1BMZWdhbFdyYXBwZXJJUEZTSGFzaDsNCiAgLy8gY29tcGFueSBhZGRyZXNzDQogIGFkZHJlc3MgcHVibGljIGNvbXBhbnlBZGRyZXNzOw0KICAvLyByb290IG9mIGltbXV0YWJsZSByb290IG9mIHRydXN0IHBvaW50aW5nIHRvIGdpdmVuIEVTT1AgaW1wbGVtZW50YXRpb24NCiAgYWRkcmVzcyBwdWJsaWMgcm9vdE9mVHJ1c3Q7DQogIC8vIGRlZmF1bHQgcGVyaW9kIGZvciBlbXBsb3llZSBzaWduYXR1cmUNCiAgdWludDMyIGNvbnN0YW50IHB1YmxpYyBNSU5JTVVNX01BTlVBTF9TSUdOX1BFUklPRCA9IDIgd2Vla3M7DQoNCiAgLy8gU1RBVEUNCiAgLy8gcG9vbE9wdGlvbnMgdGhhdCByZW1haW4gdG8gYmUgYXNzaWduZWQNCiAgdWludCBwdWJsaWMgcmVtYWluaW5nUG9vbE9wdGlvbnM7DQogIC8vIHN0YXRlIG9mIEVTT1ANCiAgRVNPUFN0YXRlIHB1YmxpYyBlc29wU3RhdGU7IC8vIGF1dG9tYXRpY2FsbHkgc2V0cyB0byBPcGVuICgwKQ0KICAvLyBsaXN0IG9mIGVtcGxveWVlcw0KICBFbXBsb3llZXNMaXN0IHB1YmxpYyBlbXBsb3llZXM7DQogIC8vIGhvdyBtYW55IGV4dHJhIG9wdGlvbnMgaW5zZXJ0ZWQNCiAgdWludCBwdWJsaWMgdG90YWxFeHRyYU9wdGlvbnM7DQogIC8vIHdoZW4gY29udmVyc2lvbiBldmVudCBoYXBwZW5lZA0KICB1aW50MzIgcHVibGljIGNvbnZlcnNpb25PZmZlcmVkQXQ7DQogIC8vIGVtcGxveWVlIGNvbnZlcnNpb24gZGVhZGxpbmUNCiAgdWludDMyIHB1YmxpYyBleGVyY2lzZU9wdGlvbnNEZWFkbGluZTsNCiAgLy8gb3B0aW9uIGNvbnZlcnNpb24gcHJveHkNCiAgQmFzZU9wdGlvbnNDb252ZXJ0ZXIgcHVibGljIG9wdGlvbnNDb252ZXJ0ZXI7DQoNCiAgLy8gbWlncmF0aW9uIGRlc3RpbmF0aW9ucyBwZXIgZW1wbG95ZWUNCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBFU09QTWlncmF0aW9uKSBwcml2YXRlIG1pZ3JhdGlvbnM7DQoNCiAgbW9kaWZpZXIgaGFzRW1wbG95ZWUoYWRkcmVzcyBlKSB7DQogICAgLy8gd2lsbCB0aHJvdyBvbiB1bmtub3duIGFkZHJlc3MNCiAgICBpZiAoIWVtcGxveWVlcy5oYXNFbXBsb3llZShlKSkNCiAgICAgIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5RVNPUE5ldygpIHsNCiAgICBpZiAoZXNvcFN0YXRlICE9IEVTT1BTdGF0ZS5OZXcpDQogICAgICB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUVTT1BPcGVuKCkgew0KICAgIGlmIChlc29wU3RhdGUgIT0gRVNPUFN0YXRlLk9wZW4pDQogICAgICB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUVTT1BDb252ZXJzaW9uKCkgew0KICAgIGlmIChlc29wU3RhdGUgIT0gRVNPUFN0YXRlLkNvbnZlcnNpb24pDQogICAgICB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUNvbXBhbnkoKSB7DQogICAgaWYgKGNvbXBhbnlBZGRyZXNzICE9IG1zZy5zZW5kZXIpDQogICAgICB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgZnVuY3Rpb24gZGlzdHJpYnV0ZUFuZFJldHVyblRvUG9vbCh1aW50IGRpc3RyaWJ1dGVkT3B0aW9ucywgdWludCBpZHgpDQogICAgaW50ZXJuYWwNCiAgICByZXR1cm5zICh1aW50KQ0KICB7DQogICAgLy8gZW51bWVyYXRlIGFsbCBlbXBsb3llZXMgdGhhdCB3ZXJlIG9mZmVyZWQgcG9vbE9wdGlvbnMgYWZ0ZXIgdGhhbiBmcm9tSWR4IC0xIGVtcGxveWVlDQogICAgRW1wbG95ZWUgbWVtb3J5IGVtcDsNCiAgICBmb3IgKHVpbnQgaSA9IGlkeDsgaSA8IGVtcGxveWVlcy5zaXplKCk7IGkrKykgew0KICAgICAgYWRkcmVzcyBlYSA9IGVtcGxveWVlcy5hZGRyZXNzZXMoaSk7DQogICAgICBpZiAoZWEgIT0gMCkgeyAvLyBhZGRyZXNzKDApIGlzIGRlbGV0ZWQgZW1wbG95ZWUNCiAgICAgICAgZW1wID0gX2xvYWRlbXAoZWEpOw0KICAgICAgICAvLyBza2lwIGVtcGxveWVlcyB3aXRoIG5vIHBvb2xPcHRpb25zIGFuZCB0ZXJtaW5hdGVkIGVtcGxveWVlcw0KICAgICAgICBpZiAoZW1wLnBvb2xPcHRpb25zID4gMCAmJiAoIGVtcC5zdGF0ZSA9PSBFbXBsb3llZVN0YXRlLldhaXRpbmdGb3JTaWduYXR1cmUgfHwgZW1wLnN0YXRlID09IEVtcGxveWVlU3RhdGUuRW1wbG95ZWQpICkgew0KICAgICAgICAgIHVpbnQgbmV3b3B0aW9ucyA9IG9wdGlvbnNDYWxjdWxhdG9yLmNhbGNOZXdFbXBsb3llZVBvb2xPcHRpb25zKGRpc3RyaWJ1dGVkT3B0aW9ucyk7DQogICAgICAgICAgZW1wLnBvb2xPcHRpb25zICs9IHVpbnQzMihuZXdvcHRpb25zKTsNCiAgICAgICAgICBkaXN0cmlidXRlZE9wdGlvbnMgLT0gdWludDMyKG5ld29wdGlvbnMpOw0KICAgICAgICAgIF9zYXZlZW1wKGVhLCBlbXApOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBkaXN0cmlidXRlZE9wdGlvbnM7DQogIH0NCg0KICBmdW5jdGlvbiByZW1vdmVFbXBsb3llZXNXaXRoRXhwaXJlZFNpZ25hdHVyZXNBbmRSZXR1cm5GYWRlb3V0KCkNCiAgICBvbmx5RVNPUE9wZW4NCiAgICBpc0N1cnJlbnRDb2RlDQogICAgcHVibGljDQogIHsNCiAgICAvLyByZW1vdmVzIGVtcGxveWVlcyB0aGF0IGRpZG4ndCBzaWduIGFuZCBzZW5kcyB0aGVpciBwb29sT3B0aW9ucyBiYWNrIHRvIHRoZSBwb29sDQogICAgLy8gY29tcHV0ZXMgZmFkZW91dCBmb3IgdGVybWluYXRlZCBlbXBsb3llZXMgYW5kIHJldHVybnMgaXQgdG8gcG9vbA0KICAgIC8vIHdlIGxldCBhbnlvbmUgdG8gY2FsbCB0aGF0IG1ldGhvZCBhbmQgc3BlbmQgZ2FzIG9uIGl0DQogICAgRW1wbG95ZWUgbWVtb3J5IGVtcDsNCiAgICB1aW50MzIgY3QgPSBjdXJyZW50VGltZSgpOw0KICAgIGZvciAodWludCBpID0gMDsgaSA8IGVtcGxveWVlcy5zaXplKCk7IGkrKykgew0KICAgICAgYWRkcmVzcyBlYSA9IGVtcGxveWVlcy5hZGRyZXNzZXMoaSk7DQogICAgICBpZiAoZWEgIT0gMCkgeyAvLyBhZGRyZXNzKDApIGlzIGRlbGV0ZWQgZW1wbG95ZWUNCiAgICAgICAgdmFyIHNlciA9IGVtcGxveWVlcy5nZXRTZXJpYWxpemVkRW1wbG95ZWUoZWEpOw0KICAgICAgICBlbXAgPSBkZXNlcmlhbGl6ZUVtcGxveWVlKHNlcik7DQogICAgICAgIC8vIHJlbW92ZSBlbXBsb3llZXMgd2l0aCBleHBpcmVkIHNpZ25hdHVyZXMNCiAgICAgICAgaWYgKGVtcC5zdGF0ZSA9PSBFbXBsb3llZVN0YXRlLldhaXRpbmdGb3JTaWduYXR1cmUgJiYgY3QgPiBlbXAudGltZVRvU2lnbikgew0KICAgICAgICAgIHJlbWFpbmluZ1Bvb2xPcHRpb25zICs9IGRpc3RyaWJ1dGVBbmRSZXR1cm5Ub1Bvb2woZW1wLnBvb2xPcHRpb25zLCBpKzEpOw0KICAgICAgICAgIHRvdGFsRXh0cmFPcHRpb25zIC09IGVtcC5leHRyYU9wdGlvbnM7DQogICAgICAgICAgLy8gYWN0dWFsbHkgdGhpcyBqdXN0IHNldHMgYWRkcmVzcyB0byAwIHNvIGl0ZXJhdG9yIGNhbiBjb250aW51ZQ0KICAgICAgICAgIGVtcGxveWVlcy5yZW1vdmVFbXBsb3llZShlYSk7DQogICAgICAgIH0NCiAgICAgICAgLy8gcmV0dXJuIGZhZGVvdXQgdG8gcG9vbA0KICAgICAgICBpZiAoZW1wLnN0YXRlID09IEVtcGxveWVlU3RhdGUuVGVybWluYXRlZCAmJiBjdCA+IGVtcC5mYWRlb3V0U3RhcnRzKSB7DQogICAgICAgICAgdmFyIChyZXR1cm5lZFBvb2xPcHRpb25zLCByZXR1cm5lZEV4dHJhT3B0aW9ucykgPSBvcHRpb25zQ2FsY3VsYXRvci5jYWxjdWxhdGVGYWRlb3V0VG9Qb29sKGN0LCBzZXIpOw0KICAgICAgICAgIGlmIChyZXR1cm5lZFBvb2xPcHRpb25zID4gMCB8fCByZXR1cm5lZEV4dHJhT3B0aW9ucyA+IDApIHsNCiAgICAgICAgICAgIGVtcGxveWVlcy5zZXRGYWRlb3V0U3RhcnRzKGVhLCBjdCk7DQogICAgICAgICAgICAvLyBvcHRpb25zIGZyb20gZmFkZW91dCBhcmUgbm90IGRpc3RyaWJ1dGVkIHRvIG90aGVyIGVtcGxveWVlcyBidXQgcmV0dXJuZWQgdG8gcG9vbA0KICAgICAgICAgICAgcmVtYWluaW5nUG9vbE9wdGlvbnMgKz0gcmV0dXJuZWRQb29sT3B0aW9uczsNCiAgICAgICAgICAgIC8vIHdlIG1haW50YWluIGV4dHJhUG9vbCBmb3IgZWFzaWVyIHN0YXRpc3RpY3MNCiAgICAgICAgICAgIHRvdGFsRXh0cmFPcHRpb25zIC09IHJldHVybmVkRXh0cmFPcHRpb25zOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIG9wZW5FU09QKHVpbnQzMiBwVG90YWxQb29sT3B0aW9ucywgYnl0ZXMgcEVTT1BMZWdhbFdyYXBwZXJJUEZTSGFzaCkNCiAgICBleHRlcm5hbA0KICAgIG9ubHlDb21wYW55DQogICAgb25seUVTT1BOZXcNCiAgICBpc0N1cnJlbnRDb2RlDQogICAgcmV0dXJucyAoUmV0dXJuQ29kZXMpDQogIHsNCiAgICAvLyBvcHRpb25zIGFyZSBzdG9yZWQgaW4gdW5pdDMyDQogICAgaWYgKHBUb3RhbFBvb2xPcHRpb25zID4gMTEwMDAwMCB8fCBwVG90YWxQb29sT3B0aW9ucyA8IDEwMDAwKSB7DQogICAgICByZXR1cm4gX2xvZ2Vycm9yKFJldHVybkNvZGVzLkludmFsaWRQYXJhbWV0ZXJzKTsNCiAgICB9DQoNCiAgICB0b3RhbFBvb2xPcHRpb25zID0gcFRvdGFsUG9vbE9wdGlvbnM7DQogICAgcmVtYWluaW5nUG9vbE9wdGlvbnMgPSB0b3RhbFBvb2xPcHRpb25zOw0KICAgIEVTT1BMZWdhbFdyYXBwZXJJUEZTSGFzaCA9IHBFU09QTGVnYWxXcmFwcGVySVBGU0hhc2g7DQoNCiAgICBlc29wU3RhdGUgPSBFU09QU3RhdGUuT3BlbjsNCiAgICBFU09QT3BlbmVkKGNvbXBhbnlBZGRyZXNzKTsNCiAgICByZXR1cm4gUmV0dXJuQ29kZXMuT0s7DQogIH0NCg0KICBmdW5jdGlvbiBvZmZlck9wdGlvbnNUb0VtcGxveWVlKGFkZHJlc3MgZSwgdWludDMyIGlzc3VlRGF0ZSwgdWludDMyIHRpbWVUb1NpZ24sIHVpbnQzMiBleHRyYU9wdGlvbnMsIGJvb2wgcG9vbENsZWFudXApDQogICAgZXh0ZXJuYWwNCiAgICBvbmx5RVNPUE9wZW4NCiAgICBvbmx5Q29tcGFueQ0KICAgIGlzQ3VycmVudENvZGUNCiAgICByZXR1cm5zIChSZXR1cm5Db2RlcykNCiAgew0KICAgIC8vIGRvIG5vdCBhZGQgdHdpY2UNCiAgICBpZiAoZW1wbG95ZWVzLmhhc0VtcGxveWVlKGUpKSB7DQogICAgICByZXR1cm4gX2xvZ2Vycm9yKFJldHVybkNvZGVzLkludmFsaWRFbXBsb3llZVN0YXRlKTsNCiAgICB9DQogICAgaWYgKHRpbWVUb1NpZ24gPCBjdXJyZW50VGltZSgpICsgTUlOSU1VTV9NQU5VQUxfU0lHTl9QRVJJT0QpIHsNCiAgICAgIHJldHVybiBfbG9nZXJyb3IoUmV0dXJuQ29kZXMuVG9vTGF0ZSk7DQogICAgfQ0KICAgIGlmIChwb29sQ2xlYW51cCkgew0KICAgICAgLy8gcmVjb3ZlciBwb29sT3B0aW9ucyBmb3IgZW1wbG95ZWVzIHdpdGggZXhwaXJlZCBzaWduYXR1cmVzDQogICAgICAvLyByZXR1cm4gZmFkZSBvdXQgdG8gcG9vbA0KICAgICAgcmVtb3ZlRW1wbG95ZWVzV2l0aEV4cGlyZWRTaWduYXR1cmVzQW5kUmV0dXJuRmFkZW91dCgpOw0KICAgIH0NCiAgICB1aW50IHBvb2xPcHRpb25zID0gb3B0aW9uc0NhbGN1bGF0b3IuY2FsY05ld0VtcGxveWVlUG9vbE9wdGlvbnMocmVtYWluaW5nUG9vbE9wdGlvbnMpOw0KICAgIGlmIChwb29sT3B0aW9ucyA+IDB4RkZGRkZGRkYpDQogICAgICB0aHJvdzsNCiAgICBFbXBsb3llZSBtZW1vcnkgZW1wID0gRW1wbG95ZWUoew0KICAgICAgaXNzdWVEYXRlOiBpc3N1ZURhdGUsIHRpbWVUb1NpZ246IHRpbWVUb1NpZ24sIHRlcm1pbmF0ZWRBdDogMCwgZmFkZW91dFN0YXJ0czogMCwgcG9vbE9wdGlvbnM6IHVpbnQzMihwb29sT3B0aW9ucyksDQogICAgICBleHRyYU9wdGlvbnM6IGV4dHJhT3B0aW9ucywgc3VzcGVuZGVkQXQ6IDAsIHN0YXRlOiBFbXBsb3llZVN0YXRlLldhaXRpbmdGb3JTaWduYXR1cmUsIGlkeDogMA0KICAgIH0pOw0KICAgIF9zYXZlZW1wKGUsIGVtcCk7DQogICAgcmVtYWluaW5nUG9vbE9wdGlvbnMgLT0gcG9vbE9wdGlvbnM7DQogICAgdG90YWxFeHRyYU9wdGlvbnMgKz0gZXh0cmFPcHRpb25zOw0KICAgIEVTT1BPZmZlcmVkKGUsIGNvbXBhbnlBZGRyZXNzLCB1aW50MzIocG9vbE9wdGlvbnMpLCBleHRyYU9wdGlvbnMpOw0KICAgIHJldHVybiBSZXR1cm5Db2Rlcy5PSzsNCiAgfQ0KDQogIC8vIHRvZG86IGltcGxlbWVudCBncm91cCBhZGQgc29tZWRheSwgaG93ZXZlciBmdW5jIGRpc3RyaWJ1dGVBbmRSZXR1cm5Ub1Bvb2wgZ2V0cyB2ZXJ5IGNvbXBsaWNhdGVkDQogIC8vIHRvZG86IGZ1bmN0aW9uIGNhbGNOZXdFbXBsb3llZVBvb2xPcHRpb25zKHVpbnQgcmVtYWluaW5nLCB1aW50OCBncm91cFNpemUpDQogIC8vIHRvZG86IGZ1bmN0aW9uIGFkZE5ld0VtcGxveWVlc1RvRVNPUChhZGRyZXNzW10gZW1wcywgdWludDMyIGlzc3VlRGF0ZSwgdWludDMyIHRpbWVUb1NpZ24pDQoNCiAgZnVuY3Rpb24gb2ZmZXJPcHRpb25zVG9FbXBsb3llZU9ubHlFeHRyYShhZGRyZXNzIGUsIHVpbnQzMiBpc3N1ZURhdGUsIHVpbnQzMiB0aW1lVG9TaWduLCB1aW50MzIgZXh0cmFPcHRpb25zKQ0KICAgIGV4dGVybmFsDQogICAgb25seUVTT1BPcGVuDQogICAgb25seUNvbXBhbnkNCiAgICBpc0N1cnJlbnRDb2RlDQogICAgcmV0dXJucyAoUmV0dXJuQ29kZXMpDQogIHsNCiAgICAvLyBkbyBub3QgYWRkIHR3aWNlDQogICAgaWYgKGVtcGxveWVlcy5oYXNFbXBsb3llZShlKSkgew0KICAgICAgcmV0dXJuIF9sb2dlcnJvcihSZXR1cm5Db2Rlcy5JbnZhbGlkRW1wbG95ZWVTdGF0ZSk7DQogICAgfQ0KICAgIGlmICh0aW1lVG9TaWduIDwgY3VycmVudFRpbWUoKSArIE1JTklNVU1fTUFOVUFMX1NJR05fUEVSSU9EKSB7DQogICAgICByZXR1cm4gX2xvZ2Vycm9yKFJldHVybkNvZGVzLlRvb0xhdGUpOw0KICAgIH0NCiAgICBFbXBsb3llZSBtZW1vcnkgZW1wID0gRW1wbG95ZWUoew0KICAgICAgaXNzdWVEYXRlOiBpc3N1ZURhdGUsIHRpbWVUb1NpZ246IHRpbWVUb1NpZ24sIHRlcm1pbmF0ZWRBdDogMCwgZmFkZW91dFN0YXJ0czogMCwgcG9vbE9wdGlvbnM6IDAsDQogICAgICBleHRyYU9wdGlvbnM6IGV4dHJhT3B0aW9ucywgc3VzcGVuZGVkQXQ6IDAsIHN0YXRlOiBFbXBsb3llZVN0YXRlLldhaXRpbmdGb3JTaWduYXR1cmUsIGlkeDogMA0KICAgIH0pOw0KICAgIF9zYXZlZW1wKGUsIGVtcCk7DQogICAgdG90YWxFeHRyYU9wdGlvbnMgKz0gZXh0cmFPcHRpb25zOw0KICAgIEVTT1BPZmZlcmVkKGUsIGNvbXBhbnlBZGRyZXNzLCAwLCBleHRyYU9wdGlvbnMpOw0KICAgIHJldHVybiBSZXR1cm5Db2Rlcy5PSzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGluY3JlYXNlRW1wbG95ZWVFeHRyYU9wdGlvbnMoYWRkcmVzcyBlLCB1aW50MzIgZXh0cmFPcHRpb25zKQ0KICAgIGV4dGVybmFsDQogICAgb25seUVTT1BPcGVuDQogICAgb25seUNvbXBhbnkNCiAgICBpc0N1cnJlbnRDb2RlDQogICAgaGFzRW1wbG95ZWUoZSkNCiAgICByZXR1cm5zIChSZXR1cm5Db2RlcykNCiAgew0KICAgIEVtcGxveWVlIG1lbW9yeSBlbXAgPSBfbG9hZGVtcChlKTsNCiAgICBpZiAoZW1wLnN0YXRlICE9IEVtcGxveWVlU3RhdGUuRW1wbG95ZWQgJiYgZW1wLnN0YXRlICE9IEVtcGxveWVlU3RhdGUuV2FpdGluZ0ZvclNpZ25hdHVyZSkgew0KICAgICAgcmV0dXJuIF9sb2dlcnJvcihSZXR1cm5Db2Rlcy5JbnZhbGlkRW1wbG95ZWVTdGF0ZSk7DQogICAgfQ0KICAgIGVtcC5leHRyYU9wdGlvbnMgKz0gZXh0cmFPcHRpb25zOw0KICAgIF9zYXZlZW1wKGUsIGVtcCk7DQogICAgdG90YWxFeHRyYU9wdGlvbnMgKz0gZXh0cmFPcHRpb25zOw0KICAgIEVTT1BPZmZlcmVkKGUsIGNvbXBhbnlBZGRyZXNzLCAwLCBleHRyYU9wdGlvbnMpOw0KICAgIHJldHVybiBSZXR1cm5Db2Rlcy5PSzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVtcGxveWVlU2lnbnNUb0VTT1AoKQ0KICAgIGV4dGVybmFsDQogICAgaGFzRW1wbG95ZWUobXNnLnNlbmRlcikNCiAgICBvbmx5RVNPUE9wZW4NCiAgICBpc0N1cnJlbnRDb2RlDQogICAgcmV0dXJucyAoUmV0dXJuQ29kZXMpDQogIHsNCiAgICBFbXBsb3llZSBtZW1vcnkgZW1wID0gX2xvYWRlbXAobXNnLnNlbmRlcik7DQogICAgaWYgKGVtcC5zdGF0ZSAhPSBFbXBsb3llZVN0YXRlLldhaXRpbmdGb3JTaWduYXR1cmUpIHsNCiAgICAgIHJldHVybiBfbG9nZXJyb3IoUmV0dXJuQ29kZXMuSW52YWxpZEVtcGxveWVlU3RhdGUpOw0KICAgIH0NCiAgICB1aW50MzIgdCA9IGN1cnJlbnRUaW1lKCk7DQogICAgaWYgKHQgPiBlbXAudGltZVRvU2lnbikgew0KICAgICAgcmVtYWluaW5nUG9vbE9wdGlvbnMgKz0gZGlzdHJpYnV0ZUFuZFJldHVyblRvUG9vbChlbXAucG9vbE9wdGlvbnMsIGVtcC5pZHgpOw0KICAgICAgdG90YWxFeHRyYU9wdGlvbnMgLT0gZW1wLmV4dHJhT3B0aW9uczsNCiAgICAgIGVtcGxveWVlcy5yZW1vdmVFbXBsb3llZShtc2cuc2VuZGVyKTsNCiAgICAgIHJldHVybiBfbG9nZXJyb3IoUmV0dXJuQ29kZXMuVG9vTGF0ZSk7DQogICAgfQ0KICAgIGVtcGxveWVlcy5jaGFuZ2VTdGF0ZShtc2cuc2VuZGVyLCBFbXBsb3llZVN0YXRlLkVtcGxveWVkKTsNCiAgICBFbXBsb3llZVNpZ25lZFRvRVNPUChtc2cuc2VuZGVyKTsNCiAgICByZXR1cm4gUmV0dXJuQ29kZXMuT0s7DQogIH0NCg0KICBmdW5jdGlvbiB0b2dnbGVFbXBsb3llZVN1c3BlbnNpb24oYWRkcmVzcyBlLCB1aW50MzIgdG9nZ2xlZEF0KQ0KICAgIGV4dGVybmFsDQogICAgb25seUVTT1BPcGVuDQogICAgb25seUNvbXBhbnkNCiAgICBoYXNFbXBsb3llZShlKQ0KICAgIGlzQ3VycmVudENvZGUNCiAgICByZXR1cm5zIChSZXR1cm5Db2RlcykNCiAgew0KICAgIEVtcGxveWVlIG1lbW9yeSBlbXAgPSBfbG9hZGVtcChlKTsNCiAgICBpZiAoZW1wLnN0YXRlICE9IEVtcGxveWVlU3RhdGUuRW1wbG95ZWQpIHsNCiAgICAgIHJldHVybiBfbG9nZXJyb3IoUmV0dXJuQ29kZXMuSW52YWxpZEVtcGxveWVlU3RhdGUpOw0KICAgIH0NCiAgICBpZiAoZW1wLnN1c3BlbmRlZEF0ID09IDApIHsNCiAgICAgIC8vc3VzcGVuZCBhY3Rpb24NCiAgICAgIGVtcC5zdXNwZW5kZWRBdCA9IHRvZ2dsZWRBdDsNCiAgICAgIFN1c3BlbmRFbXBsb3llZShlLCB0b2dnbGVkQXQpOw0KICAgIH0gZWxzZSB7DQogICAgICBpZiAoZW1wLnN1c3BlbmRlZEF0ID4gdG9nZ2xlZEF0KSB7DQogICAgICAgIHJldHVybiBfbG9nZXJyb3IoUmV0dXJuQ29kZXMuVG9vTGF0ZSk7DQogICAgICB9DQogICAgICB1aW50MzIgc3VzcGVuZGVkUGVyaW9kID0gdG9nZ2xlZEF0IC0gZW1wLnN1c3BlbmRlZEF0Ow0KICAgICAgLy8gbW92ZSBldmVyeXRoaW5nIGJ5IHN1c3BlbnNpb24gcGVyaW9kIGJ5IGNoYW5naW5nIGlzc3VlRGF0ZQ0KICAgICAgZW1wLmlzc3VlRGF0ZSArPSBzdXNwZW5kZWRQZXJpb2Q7DQogICAgICBlbXAuc3VzcGVuZGVkQXQgPSAwOw0KICAgICAgQ29udGludWVTdXNwZW5kZWRFbXBsb3llZShlLCB0b2dnbGVkQXQsIHN1c3BlbmRlZFBlcmlvZCk7DQogICAgfQ0KICAgIF9zYXZlZW1wKGUsIGVtcCk7DQogICAgcmV0dXJuIFJldHVybkNvZGVzLk9LOw0KICB9DQoNCiAgZnVuY3Rpb24gdGVybWluYXRlRW1wbG95ZWUoYWRkcmVzcyBlLCB1aW50MzIgdGVybWluYXRlZEF0LCB1aW50OCB0ZXJtaW5hdGlvblR5cGUpDQogICAgZXh0ZXJuYWwNCiAgICBvbmx5RVNPUE9wZW4NCiAgICBvbmx5Q29tcGFueQ0KICAgIGhhc0VtcGxveWVlKGUpDQogICAgaXNDdXJyZW50Q29kZQ0KICAgIHJldHVybnMgKFJldHVybkNvZGVzKQ0KICB7DQogICAgLy8gdGVybWluYXRlcyBhbiBlbXBsb3llZQ0KICAgIFRlcm1pbmF0aW9uVHlwZSB0ZXJtVHlwZSA9IFRlcm1pbmF0aW9uVHlwZSh0ZXJtaW5hdGlvblR5cGUpOw0KICAgIEVtcGxveWVlIG1lbW9yeSBlbXAgPSBfbG9hZGVtcChlKTsNCiAgICAvLyB0b2RvOiBjaGVjayB0ZXJtaW5hdGlvbiB0aW1lIGFnYWluc3QgaXNzdWVEYXRlDQogICAgaWYgKHRlcm1pbmF0ZWRBdCA8IGVtcC5pc3N1ZURhdGUpIHsNCiAgICAgIHJldHVybiBfbG9nZXJyb3IoUmV0dXJuQ29kZXMuSW52YWxpZFBhcmFtZXRlcnMpOw0KICAgIH0NCiAgICBpZiAoZW1wLnN0YXRlID09IEVtcGxveWVlU3RhdGUuV2FpdGluZ0ZvclNpZ25hdHVyZSkNCiAgICAgIHRlcm1UeXBlID0gVGVybWluYXRpb25UeXBlLkJhZExlYXZlcjsNCiAgICBlbHNlIGlmIChlbXAuc3RhdGUgIT0gRW1wbG95ZWVTdGF0ZS5FbXBsb3llZCkgew0KICAgICAgcmV0dXJuIF9sb2dlcnJvcihSZXR1cm5Db2Rlcy5JbnZhbGlkRW1wbG95ZWVTdGF0ZSk7DQogICAgfQ0KICAgIC8vIGhvdyBtYW55IHBvb2xPcHRpb25zIHJldHVybmVkIHRvIHBvb2wNCiAgICB1aW50IHJldHVybmVkT3B0aW9uczsNCiAgICB1aW50IHJldHVybmVkRXh0cmFPcHRpb25zOw0KICAgIGlmICh0ZXJtVHlwZSA9PSBUZXJtaW5hdGlvblR5cGUuUmVndWxhcikgew0KICAgICAgLy8gcmVndWxhciB0ZXJtaW5hdGlvbiwgY29tcHV0ZSBzdXNwZW5zaW9uDQogICAgICBpZiAoZW1wLnN1c3BlbmRlZEF0ID4gMCAmJiBlbXAuc3VzcGVuZGVkQXQgPCB0ZXJtaW5hdGVkQXQpDQogICAgICAgIGVtcC5pc3N1ZURhdGUgKz0gdGVybWluYXRlZEF0IC0gZW1wLnN1c3BlbmRlZEF0Ow0KICAgICAgLy8gdmVzdGluZyBhcHBsaWVzDQogICAgICByZXR1cm5lZE9wdGlvbnMgPSBlbXAucG9vbE9wdGlvbnMgLSBvcHRpb25zQ2FsY3VsYXRvci5jYWxjdWxhdGVWZXN0ZWRPcHRpb25zKHRlcm1pbmF0ZWRBdCwgZW1wLmlzc3VlRGF0ZSwgZW1wLnBvb2xPcHRpb25zKTsNCiAgICAgIHJldHVybmVkRXh0cmFPcHRpb25zID0gZW1wLmV4dHJhT3B0aW9ucyAtIG9wdGlvbnNDYWxjdWxhdG9yLmNhbGN1bGF0ZVZlc3RlZE9wdGlvbnModGVybWluYXRlZEF0LCBlbXAuaXNzdWVEYXRlLCBlbXAuZXh0cmFPcHRpb25zKTsNCiAgICAgIGVtcGxveWVlcy50ZXJtaW5hdGVFbXBsb3llZShlLCBlbXAuaXNzdWVEYXRlLCB0ZXJtaW5hdGVkQXQsIHRlcm1pbmF0ZWRBdCwgRW1wbG95ZWVTdGF0ZS5UZXJtaW5hdGVkKTsNCiAgICB9IGVsc2UgaWYgKHRlcm1UeXBlID09IFRlcm1pbmF0aW9uVHlwZS5CYWRMZWF2ZXIpIHsNCiAgICAgIC8vIGJhZCBsZWF2ZXIgLSBlbXBsb3llZSBpcyBraWNrZWQgb3V0IGZyb20gRVNPUCwgcmV0dXJuIGFsbCBwb29sT3B0aW9ucw0KICAgICAgcmV0dXJuZWRPcHRpb25zID0gZW1wLnBvb2xPcHRpb25zOw0KICAgICAgcmV0dXJuZWRFeHRyYU9wdGlvbnMgPSBlbXAuZXh0cmFPcHRpb25zOw0KICAgICAgZW1wbG95ZWVzLnJlbW92ZUVtcGxveWVlKGUpOw0KICAgIH0NCiAgICByZW1haW5pbmdQb29sT3B0aW9ucyArPSBkaXN0cmlidXRlQW5kUmV0dXJuVG9Qb29sKHJldHVybmVkT3B0aW9ucywgZW1wLmlkeCk7DQogICAgdG90YWxFeHRyYU9wdGlvbnMgLT0gcmV0dXJuZWRFeHRyYU9wdGlvbnM7DQogICAgVGVybWluYXRlRW1wbG95ZWUoZSwgY29tcGFueUFkZHJlc3MsIHRlcm1pbmF0ZWRBdCwgdGVybVR5cGUpOw0KICAgIHJldHVybiBSZXR1cm5Db2Rlcy5PSzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG9mZmVyT3B0aW9uc0NvbnZlcnNpb24oQmFzZU9wdGlvbnNDb252ZXJ0ZXIgY29udmVydGVyKQ0KICAgIGV4dGVybmFsDQogICAgb25seUVTT1BPcGVuDQogICAgb25seUNvbXBhbnkNCiAgICBpc0N1cnJlbnRDb2RlDQogICAgcmV0dXJucyAoUmV0dXJuQ29kZXMpDQogIHsNCiAgICB1aW50MzIgb2ZmZXJNYWRlQXQgPSBjdXJyZW50VGltZSgpOw0KICAgIGlmIChjb252ZXJ0ZXIuZ2V0RXhlcmNpc2VQZXJpb2REZWFkbGluZSgpIC0gb2ZmZXJNYWRlQXQgPCBNSU5JTVVNX01BTlVBTF9TSUdOX1BFUklPRCkgew0KICAgICAgcmV0dXJuIF9sb2dlcnJvcihSZXR1cm5Db2Rlcy5Ub29MYXRlKTsNCiAgICB9DQogICAgLy8gZXhlcmNpc2VPcHRpb25zIG11c3QgYmUgY2FsbGFibGUgYnkgdXMNCiAgICBpZiAoY29udmVydGVyLmdldEVTT1AoKSAhPSBhZGRyZXNzKHRoaXMpKSB7DQogICAgICByZXR1cm4gX2xvZ2Vycm9yKFJldHVybkNvZGVzLkludmFsaWRQYXJhbWV0ZXJzKTsNCiAgICB9DQogICAgLy8gcmV0dXJuIHRvIHBvb2wgZXZlcnl0aGluZyB3ZSBjYW4NCiAgICByZW1vdmVFbXBsb3llZXNXaXRoRXhwaXJlZFNpZ25hdHVyZXNBbmRSZXR1cm5GYWRlb3V0KCk7DQogICAgLy8gZnJvbSBub3cgdmVzdGluZyBhbmQgZmFkZW91dCBzdG9wcywgbm8gbmV3IGVtcGxveWVlcyBtYXkgYmUgYWRkZWQNCiAgICBjb252ZXJzaW9uT2ZmZXJlZEF0ID0gb2ZmZXJNYWRlQXQ7DQogICAgZXhlcmNpc2VPcHRpb25zRGVhZGxpbmUgPSBjb252ZXJ0ZXIuZ2V0RXhlcmNpc2VQZXJpb2REZWFkbGluZSgpOw0KICAgIG9wdGlvbnNDb252ZXJ0ZXIgPSBjb252ZXJ0ZXI7DQogICAgLy8gdGhpcyBpcyB2ZXJ5IGlycmV2ZXJzaWJsZQ0KICAgIGVzb3BTdGF0ZSA9IEVTT1BTdGF0ZS5Db252ZXJzaW9uOw0KICAgIE9wdGlvbnNDb252ZXJzaW9uT2ZmZXJlZChjb21wYW55QWRkcmVzcywgYWRkcmVzcyhjb252ZXJ0ZXIpLCBvZmZlck1hZGVBdCwgZXhlcmNpc2VPcHRpb25zRGVhZGxpbmUpOw0KICAgIHJldHVybiBSZXR1cm5Db2Rlcy5PSzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGV4ZXJjaXNlT3B0aW9uc0ludGVybmFsKHVpbnQzMiBjYWxjQXRUaW1lLCBhZGRyZXNzIGVtcGxveWVlLCBhZGRyZXNzIGV4ZXJjaXNlRm9yLA0KICAgIGJvb2wgZGlzYWJsZUFjY2VsZXJhdGVkVmVzdGluZykNCiAgICBpbnRlcm5hbA0KICAgIHJldHVybnMgKFJldHVybkNvZGVzKQ0KICB7DQogICAgRW1wbG95ZWUgbWVtb3J5IGVtcCA9IF9sb2FkZW1wKGVtcGxveWVlKTsNCiAgICBpZiAoZW1wLnN0YXRlID09IEVtcGxveWVlU3RhdGUuT3B0aW9uc0V4ZXJjaXNlZCkgew0KICAgICAgcmV0dXJuIF9sb2dlcnJvcihSZXR1cm5Db2Rlcy5JbnZhbGlkRW1wbG95ZWVTdGF0ZSk7DQogICAgfQ0KICAgIC8vIGlmIHdlIGFyZSBidXJuaW5nIG9wdGlvbnMgdGhlbiBzZW5kIDANCiAgICBpZiAoZXhlcmNpc2VGb3IgIT0gYWRkcmVzcygwKSkgew0KICAgICAgdmFyIChwb29sLCBleHRyYSwgYm9udXMpID0gb3B0aW9uc0NhbGN1bGF0b3IuY2FsY3VsYXRlT3B0aW9uc0NvbXBvbmVudHMoc2VyaWFsaXplRW1wbG95ZWUoZW1wKSwNCiAgICAgICAgY2FsY0F0VGltZSwgY29udmVyc2lvbk9mZmVyZWRBdCwgZGlzYWJsZUFjY2VsZXJhdGVkVmVzdGluZyk7DQogICAgICB9DQogICAgLy8gY2FsbCBiZWZvcmUgb3B0aW9ucyBjb252ZXJzaW9uIGNvbnRyYWN0IHRvIHByZXZlbnQgcmUtZW50cnkNCiAgICBlbXBsb3llZXMuY2hhbmdlU3RhdGUoZW1wbG95ZWUsIEVtcGxveWVlU3RhdGUuT3B0aW9uc0V4ZXJjaXNlZCk7DQogICAgLy8gZXhlcmNpc2Ugb3B0aW9ucyBpbiB0aGUgbmFtZSBvZiBlbXBsb3llZSBhbmQgYXNzaWduIHRob3NlIHRvIGV4ZXJjaXNlRm9yDQogICAgb3B0aW9uc0NvbnZlcnRlci5leGVyY2lzZU9wdGlvbnMoZXhlcmNpc2VGb3IsIHBvb2wsIGV4dHJhLCBib251cywgIWRpc2FibGVBY2NlbGVyYXRlZFZlc3RpbmcpOw0KICAgIEVtcGxveWVlT3B0aW9uc0V4ZXJjaXNlZChlbXBsb3llZSwgZXhlcmNpc2VGb3IsIHVpbnQzMihwb29sICsgZXh0cmEgKyBib251cyksICFkaXNhYmxlQWNjZWxlcmF0ZWRWZXN0aW5nKTsNCiAgICByZXR1cm4gUmV0dXJuQ29kZXMuT0s7DQogIH0NCg0KICBmdW5jdGlvbiBlbXBsb3llZUV4ZXJjaXNlT3B0aW9ucyhib29sIGFncmVlVG9BY2NlbGVyYXRlZFZlc3RpbmdCb251c0NvbmRpdGlvbnMpDQogICAgZXh0ZXJuYWwNCiAgICBvbmx5RVNPUENvbnZlcnNpb24NCiAgICBoYXNFbXBsb3llZShtc2cuc2VuZGVyKQ0KICAgIGlzQ3VycmVudENvZGUNCiAgICByZXR1cm5zIChSZXR1cm5Db2RlcykNCiAgew0KICAgIHVpbnQzMiBjdCA9IGN1cnJlbnRUaW1lKCk7DQogICAgaWYgKGN0ID4gZXhlcmNpc2VPcHRpb25zRGVhZGxpbmUpIHsNCiAgICAgIHJldHVybiBfbG9nZXJyb3IoUmV0dXJuQ29kZXMuVG9vTGF0ZSk7DQogICAgfQ0KICAgIHJldHVybiBleGVyY2lzZU9wdGlvbnNJbnRlcm5hbChjdCwgbXNnLnNlbmRlciwgbXNnLnNlbmRlciwgIWFncmVlVG9BY2NlbGVyYXRlZFZlc3RpbmdCb251c0NvbmRpdGlvbnMpOw0KICB9DQoNCiAgZnVuY3Rpb24gZW1wbG95ZWVEZW55RXhlcmNpc2VPcHRpb25zKCkNCiAgICBleHRlcm5hbA0KICAgIG9ubHlFU09QQ29udmVyc2lvbg0KICAgIGhhc0VtcGxveWVlKG1zZy5zZW5kZXIpDQogICAgaXNDdXJyZW50Q29kZQ0KICAgIHJldHVybnMgKFJldHVybkNvZGVzKQ0KICB7DQogICAgdWludDMyIGN0ID0gY3VycmVudFRpbWUoKTsNCiAgICBpZiAoY3QgPiBleGVyY2lzZU9wdGlvbnNEZWFkbGluZSkgew0KICAgICAgcmV0dXJuIF9sb2dlcnJvcihSZXR1cm5Db2Rlcy5Ub29MYXRlKTsNCiAgICB9DQogICAgLy8gYnVybiB0aGUgb3B0aW9ucyBieSBzZW5kaW5nIHRvIDANCiAgICByZXR1cm4gZXhlcmNpc2VPcHRpb25zSW50ZXJuYWwoY3QsIG1zZy5zZW5kZXIsIGFkZHJlc3MoMCksIHRydWUpOw0KICB9DQoNCiAgZnVuY3Rpb24gZXhlcmNpc2VFeHBpcmVkRW1wbG95ZWVPcHRpb25zKGFkZHJlc3MgZSwgYm9vbCBkaXNhYmxlQWNjZWxlcmF0ZWRWZXN0aW5nKQ0KICAgIGV4dGVybmFsDQogICAgb25seUVTT1BDb252ZXJzaW9uDQogICAgb25seUNvbXBhbnkNCiAgICBoYXNFbXBsb3llZShlKQ0KICAgIGlzQ3VycmVudENvZGUNCiAgcmV0dXJucyAoUmV0dXJuQ29kZXMpDQogIHsNCiAgICAvLyBjb21wYW55IGNhbiBjb252ZXJ0IG9wdGlvbnMgZm9yIGFueSBlbXBsb3llZSB0aGF0IGRpZCBub3QgY29udmVydGVkIChhZnRlciBkZWFkbGluZSkNCiAgICB1aW50MzIgY3QgPSBjdXJyZW50VGltZSgpOw0KICAgIGlmIChjdCA8PSBleGVyY2lzZU9wdGlvbnNEZWFkbGluZSkgew0KICAgICAgcmV0dXJuIF9sb2dlcnJvcihSZXR1cm5Db2Rlcy5Ub29FYXJseSk7DQogICAgfQ0KICAgIHJldHVybiBleGVyY2lzZU9wdGlvbnNJbnRlcm5hbChjdCwgZSwgY29tcGFueUFkZHJlc3MsIGRpc2FibGVBY2NlbGVyYXRlZFZlc3RpbmcpOw0KICB9DQoNCiAgZnVuY3Rpb24gYWxsb3dFbXBsb3llZU1pZ3JhdGlvbihhZGRyZXNzIGVtcGxveWVlLCBFU09QTWlncmF0aW9uIG1pZ3JhdGlvbikNCiAgICBleHRlcm5hbA0KICAgIG9ubHlFU09QT3Blbg0KICAgIGhhc0VtcGxveWVlKGVtcGxveWVlKQ0KICAgIG9ubHlDb21wYW55DQogICAgaXNDdXJyZW50Q29kZQ0KICAgIHJldHVybnMgKFJldHVybkNvZGVzKQ0KICB7DQogICAgaWYgKGFkZHJlc3MobWlncmF0aW9uKSA9PSAwKQ0KICAgICAgdGhyb3c7DQogICAgLy8gb25seSBlbXBsb3llZCBhbmQgdGVybWluYXRlZCB1c2VycyBtYXkgbWlncmF0ZQ0KICAgIEVtcGxveWVlIG1lbW9yeSBlbXAgPSBfbG9hZGVtcChlbXBsb3llZSk7DQogICAgaWYgKGVtcC5zdGF0ZSAhPSBFbXBsb3llZVN0YXRlLkVtcGxveWVkICYmIGVtcC5zdGF0ZSAhPSBFbXBsb3llZVN0YXRlLlRlcm1pbmF0ZWQpIHsNCiAgICAgIHJldHVybiBfbG9nZXJyb3IoUmV0dXJuQ29kZXMuSW52YWxpZEVtcGxveWVlU3RhdGUpOw0KICAgIH0NCiAgICBtaWdyYXRpb25zW2VtcGxveWVlXSA9IG1pZ3JhdGlvbjsgLy8gY2FuIGJlIGNsZWFyZWQgd2l0aCAwIGFkZHJlc3MNCiAgICByZXR1cm4gUmV0dXJuQ29kZXMuT0s7DQogIH0NCg0KICBmdW5jdGlvbiBlbXBsb3llZU1pZ3JhdGVzVG9OZXdFU09QKEVTT1BNaWdyYXRpb24gbWlncmF0aW9uKQ0KICAgIGV4dGVybmFsDQogICAgb25seUVTT1BPcGVuDQogICAgaGFzRW1wbG95ZWUobXNnLnNlbmRlcikNCiAgICBpc0N1cnJlbnRDb2RlDQogICAgcmV0dXJucyAoUmV0dXJuQ29kZXMpDQogIHsNCiAgICAvLyBlbXBsb3llZSBtYXkgbWlncmF0ZSB0byBuZXcgRVNPUCBjb250cmFjdCB3aXRoIGRpZmZlcmVudCBydWxlcw0KICAgIC8vIGlmIG1pZ3JhdGlvbiBub3Qgc2V0IHVwIGJ5IGNvbXBhbnkgdGhlbiB0aHJvdw0KICAgIGlmIChhZGRyZXNzKG1pZ3JhdGlvbikgPT0gMCB8fCBtaWdyYXRpb25zW21zZy5zZW5kZXJdICE9IG1pZ3JhdGlvbikNCiAgICAgIHRocm93Ow0KICAgIC8vIGZpcnN0IGdpdmUgYmFjayB3aGF0IHlvdSBhbHJlYWR5IG93bg0KICAgIHJlbW92ZUVtcGxveWVlc1dpdGhFeHBpcmVkU2lnbmF0dXJlc0FuZFJldHVybkZhZGVvdXQoKTsNCiAgICAvLyBvbmx5IGVtcGxveWVkIGFuZCB0ZXJtaW5hdGVkIHVzZXJzIG1heSBtaWdyYXRlDQogICAgRW1wbG95ZWUgbWVtb3J5IGVtcCA9IF9sb2FkZW1wKG1zZy5zZW5kZXIpOw0KICAgIGlmIChlbXAuc3RhdGUgIT0gRW1wbG95ZWVTdGF0ZS5FbXBsb3llZCAmJiBlbXAuc3RhdGUgIT0gRW1wbG95ZWVTdGF0ZS5UZXJtaW5hdGVkKSB7DQogICAgICByZXR1cm4gX2xvZ2Vycm9yKFJldHVybkNvZGVzLkludmFsaWRFbXBsb3llZVN0YXRlKTsNCiAgICB9DQogICAgLy8gd2l0aCBhY2NlbGVyYXRlZCB2ZXN0aW5nIGlmIHBvc3NpYmxlIC0gdGFrZSBvdXQgYWxsIHBvc3NpYmxlIG9wdGlvbnMNCiAgICB2YXIgKHBvb2wsIGV4dHJhLCBfKSA9IG9wdGlvbnNDYWxjdWxhdG9yLmNhbGN1bGF0ZU9wdGlvbnNDb21wb25lbnRzKHNlcmlhbGl6ZUVtcGxveWVlKGVtcCksIGN1cnJlbnRUaW1lKCksIDAsIGZhbHNlKTsNCiAgICBkZWxldGUgbWlncmF0aW9uc1ttc2cuc2VuZGVyXTsNCiAgICAvLyBleGVjdXRlIG1pZ3JhdGlvbiBwcm9jZWR1cmUNCiAgICBtaWdyYXRpb24ubWlncmF0ZShtc2cuc2VuZGVyLCBwb29sLCBleHRyYSk7DQogICAgLy8gZXh0cmEgb3B0aW9ucyBhcmUgbW92ZWQgdG8gbmV3IGNvbnRyYWN0DQogICAgdG90YWxFeHRyYU9wdGlvbnMgLT0gZW1wLnN0YXRlID09IEVtcGxveWVlU3RhdGUuRW1wbG95ZWQgPyBlbXAuZXh0cmFPcHRpb25zIDogZXh0cmE7DQogICAgLy8gcG9vbCBvcHRpb25zIGFyZSBtb3ZlZCB0byBuZXcgY29udHJhY3QgYW5kIHJlbW92ZWQgZnJvbSBUaGUgUG9vbA0KICAgIC8vIHBsZWFzZSBub3RlIHRoYXQgc2VwYXJhdGUgUG9vbCB3aWxsIG1hbmFnZSBtaWdyYXRlZCBvcHRpb25zIGFuZA0KICAgIC8vIGFsZ29yaXRobSB0aGF0IHJldHVybnMgdG8gcG9vbCBhbmQgZGlzdHJpYnV0ZXMgd2lsbCBub3QgYmUgdXNlZA0KICAgIHRvdGFsUG9vbE9wdGlvbnMgLT0gZW1wLnN0YXRlID09IEVtcGxveWVlU3RhdGUuRW1wbG95ZWQgPyBlbXAucG9vbE9wdGlvbnMgOiBwb29sOw0KICAgIC8vIGdvbmUgZnJvbSBjdXJyZW50IGNvbnRyYWN0DQogICAgZW1wbG95ZWVzLnJlbW92ZUVtcGxveWVlKG1zZy5zZW5kZXIpOw0KICAgIEVtcGxveWVlTWlncmF0ZWQobXNnLnNlbmRlciwgbWlncmF0aW9uLCBwb29sLCBleHRyYSk7DQogICAgcmV0dXJuIFJldHVybkNvZGVzLk9LOw0KICB9DQoNCiAgZnVuY3Rpb24gY2FsY0VmZmVjdGl2ZU9wdGlvbnNGb3JFbXBsb3llZShhZGRyZXNzIGUsIHVpbnQzMiBjYWxjQXRUaW1lKQ0KICAgIHB1YmxpYw0KICAgIGNvbnN0YW50DQogICAgaGFzRW1wbG95ZWUoZSkNCiAgICBpc0N1cnJlbnRDb2RlDQogICAgcmV0dXJucyAodWludCkNCiAgew0KICAgIHJldHVybiBvcHRpb25zQ2FsY3VsYXRvci5jYWxjdWxhdGVPcHRpb25zKGVtcGxveWVlcy5nZXRTZXJpYWxpemVkRW1wbG95ZWUoZSksIGNhbGNBdFRpbWUsIGNvbnZlcnNpb25PZmZlcmVkQXQsIGZhbHNlKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIF9sb2dlcnJvcihSZXR1cm5Db2RlcyBjKSBwcml2YXRlIHJldHVybnMgKFJldHVybkNvZGVzKSB7DQogICAgUmV0dXJuQ29kZShjKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIF9sb2FkZW1wKGFkZHJlc3MgZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChFbXBsb3llZSBtZW1vcnkpIHsNCiAgICByZXR1cm4gZGVzZXJpYWxpemVFbXBsb3llZShlbXBsb3llZXMuZ2V0U2VyaWFsaXplZEVtcGxveWVlKGUpKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIF9zYXZlZW1wKGFkZHJlc3MgZSwgRW1wbG95ZWUgbWVtb3J5IGVtcCkgcHJpdmF0ZSB7DQogICAgZW1wbG95ZWVzLnNldEVtcGxveWVlKGUsIGVtcC5pc3N1ZURhdGUsIGVtcC50aW1lVG9TaWduLCBlbXAudGVybWluYXRlZEF0LCBlbXAuZmFkZW91dFN0YXJ0cywgZW1wLnBvb2xPcHRpb25zLA0KICAgICAgZW1wLmV4dHJhT3B0aW9ucywgZW1wLnN1c3BlbmRlZEF0LCBlbXAuc3RhdGUpOw0KICB9DQoNCiAgZnVuY3Rpb24gY29tcGxldGVDb2RlVXBkYXRlKCkgcHVibGljIG9ubHlPd25lciBpbkNvZGVVcGRhdGUgew0KICAgIGVtcGxveWVlcy50cmFuc2Zlck93bmVyc2hpcChtc2cuc2VuZGVyKTsNCiAgICBDb2RlVXBkYXRlYWJsZS5jb21wbGV0ZUNvZGVVcGRhdGUoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uKCkNCiAgICAgIHBheWFibGUNCiAgew0KICAgICAgdGhyb3c7DQogIH0NCg0KICBmdW5jdGlvbiBFU09QKGFkZHJlc3MgY29tcGFueSwgYWRkcmVzcyBwUm9vdE9mVHJ1c3QsIE9wdGlvbnNDYWxjdWxhdG9yIHBPcHRpb25zQ2FsY3VsYXRvciwgRW1wbG95ZWVzTGlzdCBwRW1wbG95ZWVzTGlzdCkgew0KICAgIC8vZXNvcFN0YXRlID0gRVNPUFN0YXRlLk5ldzsgLy8gdGhhdHMgaW5pdGlhbCB2YWx1ZQ0KICAgIGNvbXBhbnlBZGRyZXNzID0gY29tcGFueTsNCiAgICByb290T2ZUcnVzdCA9IHBSb290T2ZUcnVzdDsNCiAgICBlbXBsb3llZXMgPSBwRW1wbG95ZWVzTGlzdDsNCiAgICBvcHRpb25zQ2FsY3VsYXRvciA9IHBPcHRpb25zQ2FsY3VsYXRvcjsNCiAgfQ0KfQ0KDQoNCg0KDQpjb250cmFjdCBPcHRpb25zQ2FsY3VsYXRvciBpcyBPd25hYmxlLCBEZXN0cnVjdGFibGUsIE1hdGgsIEVTT1BUeXBlcyB7DQogIC8vIGNsaWZmIGR1cmF0aW9uIGluIHNlY29uZHMNCiAgdWludCBwdWJsaWMgY2xpZmZQZXJpb2Q7DQogIC8vIHZlc3RpbmcgZHVyYXRpb24gaW4gc2Vjb25kcw0KICB1aW50IHB1YmxpYyB2ZXN0aW5nUGVyaW9kOw0KICAvLyBtYXhpbXVtIHByb21pbGxlIHRoYXQgY2FuIGZhZGUgb3V0DQogIHVpbnQgcHVibGljIG1heEZhZGVvdXRQcm9taWxsZTsNCiAgLy8gbWluaW1hbCBvcHRpb25zIGFmdGVyIGZhZGVvdXQNCiAgZnVuY3Rpb24gcmVzaWR1YWxBbW91bnRQcm9taWxsZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsgcmV0dXJuIEZQX1NDQUxFIC0gbWF4RmFkZW91dFByb21pbGxlOyB9DQogIC8vIGV4aXQgYm9udXMgcHJvbWlsbGUNCiAgdWludCBwdWJsaWMgYm9udXNPcHRpb25zUHJvbWlsbGU7DQogIC8vIHBlciBtaWxsZSBvZiB1bmFzc2lnbmVkIHBvb2xPcHRpb25zIHRoYXQgbmV3IGVtcGxveWVlIGdldHMNCiAgdWludCBwdWJsaWMgbmV3RW1wbG95ZWVQb29sUHJvbWlsbGU7DQogIC8vIG9wdGlvbnMgcGVyIHNoYXJlDQogIHVpbnQgcHVibGljIG9wdGlvbnNQZXJTaGFyZTsNCiAgLy8gb3B0aW9ucyBzdHJpa2UgcHJpY2UNCiAgdWludCBjb25zdGFudCBwdWJsaWMgU1RSSUtFX1BSSUNFID0gMTsNCiAgLy8gY29tcGFueSBhZGRyZXNzDQogIGFkZHJlc3MgcHVibGljIGNvbXBhbnlBZGRyZXNzOw0KICAvLyBjaGVja3MgaWYgY2FsY3VsYXRvciBpIGluaXRpYWxpemVkDQogIGZ1bmN0aW9uIGhhc1BhcmFtZXRlcnMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7IHJldHVybiBvcHRpb25zUGVyU2hhcmUgPiAwOyB9DQoNCiAgbW9kaWZpZXIgb25seUNvbXBhbnkoKSB7DQogICAgaWYgKGNvbXBhbnlBZGRyZXNzICE9IG1zZy5zZW5kZXIpDQogICAgICB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgZnVuY3Rpb24gY2FsY05ld0VtcGxveWVlUG9vbE9wdGlvbnModWludCByZW1haW5pbmdQb29sT3B0aW9ucykNCiAgICBwdWJsaWMNCiAgICBjb25zdGFudA0KICAgIHJldHVybnMgKHVpbnQpDQogIHsNCiAgICByZXR1cm4gZGl2Um91bmQocmVtYWluaW5nUG9vbE9wdGlvbnMgKiBuZXdFbXBsb3llZVBvb2xQcm9taWxsZSwgRlBfU0NBTEUpOw0KICB9DQoNCiAgZnVuY3Rpb24gY2FsY3VsYXRlVmVzdGVkT3B0aW9ucyh1aW50IHQsIHVpbnQgdmVzdGluZ1N0YXJ0cywgdWludCBvcHRpb25zKQ0KICAgIHB1YmxpYw0KICAgIGNvbnN0YW50DQogICAgcmV0dXJucyAodWludCkNCiAgew0KICAgIGlmICh0IDw9IHZlc3RpbmdTdGFydHMpDQogICAgICByZXR1cm4gMDsNCiAgICAvLyBhcHBseSB2ZXN0aW5nDQogICAgdWludCBlZmZlY3RpdmVUaW1lID0gdCAtIHZlc3RpbmdTdGFydHM7DQogICAgLy8gaWYgd2l0aGluIGNsaWZmIG5vdGhpbmcgaXMgZHVlDQogICAgaWYgKGVmZmVjdGl2ZVRpbWUgPCBjbGlmZlBlcmlvZCkNCiAgICAgIHJldHVybiAwOw0KICAgIGVsc2UNCiAgICAgIHJldHVybiAgZWZmZWN0aXZlVGltZSA8IHZlc3RpbmdQZXJpb2QgPyBkaXZSb3VuZChvcHRpb25zICogZWZmZWN0aXZlVGltZSwgdmVzdGluZ1BlcmlvZCkgOiBvcHRpb25zOw0KICB9DQoNCiAgZnVuY3Rpb24gYXBwbHlGYWRlb3V0VG9PcHRpb25zKHVpbnQzMiB0LCB1aW50MzIgaXNzdWVEYXRlLCB1aW50MzIgdGVybWluYXRlZEF0LCB1aW50IG9wdGlvbnMsIHVpbnQgdmVzdGVkT3B0aW9ucykNCiAgICBwdWJsaWMNCiAgICBjb25zdGFudA0KICAgIHJldHVybnMgKHVpbnQpDQogIHsNCiAgICBpZiAodCA8IHRlcm1pbmF0ZWRBdCkNCiAgICAgIHJldHVybiB2ZXN0ZWRPcHRpb25zOw0KICAgIHVpbnQgdGltZWZyb21UZXJtaW5hdGlvbiA9IHQgLSB0ZXJtaW5hdGVkQXQ7DQogICAgLy8gZmFkZW91dCBkdXJhdGlvbiBlcXVhbHMgdG8gZW1wbG95bWVudCBkdXJhdGlvbg0KICAgIHVpbnQgZW1wbG95bWVudFBlcmlvZCA9IHRlcm1pbmF0ZWRBdCAtIGlzc3VlRGF0ZTsNCiAgICAvLyBtaW5pbXVtIHZhbHVlIG9mIG9wdGlvbnMgYXQgdGhlIGVuZCBvZiBmYWRlb3V0LCBpdCBpcyBhICUgb2YgYWxsIGVtcGxveWVlJ3Mgb3B0aW9ucw0KICAgIHVpbnQgbWluRmFkZVZhbHVlID0gZGl2Um91bmQob3B0aW9ucyAqIChGUF9TQ0FMRSAtIG1heEZhZGVvdXRQcm9taWxsZSksIEZQX1NDQUxFKTsNCiAgICAvLyBob3dldmVyIGVtcGxveWVlIGNhbm5vdCBoYXZlIG1vcmUgdGhhbiBvcHRpb25zIGFmdGVyIGZhZGVvdXQgdGhhbiBoZSB3YXMgdmVzdGVkIGF0IHRlcm1pbmF0aW9uDQogICAgaWYgKG1pbkZhZGVWYWx1ZSA+PSB2ZXN0ZWRPcHRpb25zKQ0KICAgICAgcmV0dXJuIHZlc3RlZE9wdGlvbnM7DQogICAgcmV0dXJuIHRpbWVmcm9tVGVybWluYXRpb24gPiBlbXBsb3ltZW50UGVyaW9kID8NCiAgICAgIG1pbkZhZGVWYWx1ZSAgOg0KICAgICAgKG1pbkZhZGVWYWx1ZSArIGRpdlJvdW5kKCh2ZXN0ZWRPcHRpb25zIC0gbWluRmFkZVZhbHVlKSAqIChlbXBsb3ltZW50UGVyaW9kIC0gdGltZWZyb21UZXJtaW5hdGlvbiksIGVtcGxveW1lbnRQZXJpb2QpKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNhbGN1bGF0ZU9wdGlvbnNDb21wb25lbnRzKHVpbnRbOV0gZW1wbG95ZWUsIHVpbnQzMiBjYWxjQXRUaW1lLCB1aW50MzIgY29udmVyc2lvbk9mZmVyZWRBdCwNCiAgICBib29sIGRpc2FibGVBY2NlbGVyYXRlZFZlc3RpbmcpDQogICAgcHVibGljDQogICAgY29uc3RhbnQNCiAgICByZXR1cm5zICh1aW50LCB1aW50LCB1aW50KQ0KICB7DQogICAgLy8gcmV0dXJucyB0dXBsZSBvZiAodmVzdGVkIHBvb2wgb3B0aW9ucywgdmVzdGVkIGV4dHJhIG9wdGlvbnMsIGJvbnVzKQ0KICAgIEVtcGxveWVlIG1lbW9yeSBlbXAgPSBkZXNlcmlhbGl6ZUVtcGxveWVlKGVtcGxveWVlKTsNCiAgICAvLyBubyBvcHRpb25zIGZvciBjb252ZXJ0ZWQgb3B0aW9ucyBvciB3aGVuIGVzb3AgaXMgbm90IHNpbmdlZA0KICAgIGlmIChlbXAuc3RhdGUgPT0gRW1wbG95ZWVTdGF0ZS5PcHRpb25zRXhlcmNpc2VkIHx8IGVtcC5zdGF0ZSA9PSBFbXBsb3llZVN0YXRlLldhaXRpbmdGb3JTaWduYXR1cmUpDQogICAgICByZXR1cm4gKDAsMCwwKTsNCiAgICAvLyBubyBvcHRpb25zIHdoZW4gZXNvcCBpcyBiZWluZyBjb252ZXJ0ZWQgYW5kIGNvbnZlcnNpb24gZGVhZGxpbmUgZXhwaXJlZA0KICAgIGJvb2wgaXNFU09QQ29udmVydGVkID0gY29udmVyc2lvbk9mZmVyZWRBdCA+IDAgJiYgY2FsY0F0VGltZSA+PSBjb252ZXJzaW9uT2ZmZXJlZEF0OyAvLyB0aGlzIGZ1bmN0aW9uIHRpbWUtdHJhdmVscw0KICAgIHVpbnQgaXNzdWVkT3B0aW9ucyA9IGVtcC5wb29sT3B0aW9ucyArIGVtcC5leHRyYU9wdGlvbnM7DQogICAgLy8gZW1wbG95ZWUgd2l0aCBubyBvcHRpb25zDQogICAgaWYgKGlzc3VlZE9wdGlvbnMgPT0gMCkNCiAgICAgIHJldHVybiAoMCwwLDApOw0KICAgIC8vIGlmIGVtcCBpcyB0ZXJtaW5hdGVkIGJ1dCB3ZSBjYWxjIG9wdGlvbnMgYmVmb3JlIHRlcm0sIHNpbXVsYXRlIGVtcGxveWVkIGFnYWluDQogICAgaWYgKGNhbGNBdFRpbWUgPCBlbXAudGVybWluYXRlZEF0ICYmIGVtcC50ZXJtaW5hdGVkQXQgPiAwKQ0KICAgICAgZW1wLnN0YXRlID0gRW1wbG95ZWVTdGF0ZS5FbXBsb3llZDsNCiAgICB1aW50IHZlc3RlZE9wdGlvbnMgPSBpc3N1ZWRPcHRpb25zOw0KICAgIGJvb2wgYWNjZWxlcmF0ZVZlc3RpbmcgPSBpc0VTT1BDb252ZXJ0ZWQgJiYgZW1wLnN0YXRlID09IEVtcGxveWVlU3RhdGUuRW1wbG95ZWQgJiYgIWRpc2FibGVBY2NlbGVyYXRlZFZlc3Rpbmc7DQogICAgaWYgKCFhY2NlbGVyYXRlVmVzdGluZykgew0KICAgICAgLy8gY2hvb3NlIHZlc3RpbmcgdGltZQ0KICAgICAgdWludDMyIGNhbGNWZXN0aW5nQXQgPSBlbXAuc3RhdGUgPT0NCiAgICAgICAgLy8gaWYgdGVybWluYXRlZCB0aGVuIHZlc3RpbmcgY2FsY3VsYXRlZCBhdCB0ZXJtaW5hdGlvbg0KICAgICAgICBFbXBsb3llZVN0YXRlLlRlcm1pbmF0ZWQgPyBlbXAudGVybWluYXRlZEF0IDoNCiAgICAgICAgLy8gaWYgZW1wbG95ZWUgaXMgc3VwZW5kZWQgdGhlbiBjb21wdXRlIHZlc3RpbmcgYXQgc3VzcGVuc2lvbiB0aW1lDQogICAgICAgIChlbXAuc3VzcGVuZGVkQXQgPiAwICYmIGVtcC5zdXNwZW5kZWRBdCA8IGNhbGNBdFRpbWUgPyBlbXAuc3VzcGVuZGVkQXQgOg0KICAgICAgICAvLyBpZiBjb252ZXJzaW9uIG9mZmVyIHRoZW4gdmVzdGluZyBjYWx1Y2F0ZWQgYXQgdGltZSB0aGUgb2ZmZXIgd2FzIG1hZGUNCiAgICAgICAgY29udmVyc2lvbk9mZmVyZWRBdCA+IDAgPyBjb252ZXJzaW9uT2ZmZXJlZEF0IDoNCiAgICAgICAgLy8gb3RoZXJ3aXNlIHVzZSBjdXJyZW50IHRpbWUNCiAgICAgICAgY2FsY0F0VGltZSk7DQogICAgICB2ZXN0ZWRPcHRpb25zID0gY2FsY3VsYXRlVmVzdGVkT3B0aW9ucyhjYWxjVmVzdGluZ0F0LCBlbXAuaXNzdWVEYXRlLCBpc3N1ZWRPcHRpb25zKTsNCiAgICB9DQogICAgLy8gY2FsYyBmYWRlb3V0IGZvciB0ZXJtaW5hdGVkIGVtcGxveWVlcw0KICAgIGlmIChlbXAuc3RhdGUgPT0gRW1wbG95ZWVTdGF0ZS5UZXJtaW5hdGVkKSB7DQogICAgICAvLyB1c2UgY29udmVyc2lvbiBldmVudCB0aW1lIHRvIGNvbXB1dGUgZmFkZW91dCB0byBzdG9wIGZhZGVvdXQgb24gY29udmVyc2lvbiBJRiBub3QgYWZ0ZXIgY29udmVyc2lvbiBkYXRlDQogICAgICB2ZXN0ZWRPcHRpb25zID0gYXBwbHlGYWRlb3V0VG9PcHRpb25zKGlzRVNPUENvbnZlcnRlZCA/IGNvbnZlcnNpb25PZmZlcmVkQXQgOiBjYWxjQXRUaW1lLA0KICAgICAgICBlbXAuaXNzdWVEYXRlLCBlbXAudGVybWluYXRlZEF0LCBpc3N1ZWRPcHRpb25zLCB2ZXN0ZWRPcHRpb25zKTsNCiAgICB9DQogICAgdmFyICh2ZXN0ZWRQb29sT3B0aW9ucywgdmVzdGVkRXh0cmFPcHRpb25zKSA9IGV4dHJhY3RWZXN0ZWRPcHRpb25zQ29tcG9uZW50cyhlbXAucG9vbE9wdGlvbnMsIGVtcC5leHRyYU9wdGlvbnMsIHZlc3RlZE9wdGlvbnMpOw0KICAgIC8vIGlmICh2ZXN0ZWRQb29sT3B0aW9ucyArIHZlc3RlZEV4dHJhT3B0aW9ucyAhPSB2ZXN0ZWRPcHRpb25zKSB0aHJvdzsNCiAgICByZXR1cm4gICh2ZXN0ZWRQb29sT3B0aW9ucywgdmVzdGVkRXh0cmFPcHRpb25zLA0KICAgICAgYWNjZWxlcmF0ZVZlc3RpbmcgPyBkaXZSb3VuZCh2ZXN0ZWRQb29sT3B0aW9ucypib251c09wdGlvbnNQcm9taWxsZSwgRlBfU0NBTEUpIDogMCApOw0KICB9DQoNCiAgZnVuY3Rpb24gY2FsY3VsYXRlT3B0aW9ucyh1aW50WzldIGVtcGxveWVlLCB1aW50MzIgY2FsY0F0VGltZSwgdWludDMyIGNvbnZlcnNpb25PZmZlcmVkQXQsIGJvb2wgZGlzYWJsZUFjY2VsZXJhdGVkVmVzdGluZykNCiAgICBwdWJsaWMNCiAgICBjb25zdGFudA0KICAgIHJldHVybnMgKHVpbnQpDQogIHsNCiAgICB2YXIgKHZlc3RlZFBvb2xPcHRpb25zLCB2ZXN0ZWRFeHRyYU9wdGlvbnMsIGJvbnVzKSA9IGNhbGN1bGF0ZU9wdGlvbnNDb21wb25lbnRzKGVtcGxveWVlLCBjYWxjQXRUaW1lLA0KICAgICAgY29udmVyc2lvbk9mZmVyZWRBdCwgZGlzYWJsZUFjY2VsZXJhdGVkVmVzdGluZyk7DQogICAgcmV0dXJuIHZlc3RlZFBvb2xPcHRpb25zICsgdmVzdGVkRXh0cmFPcHRpb25zICsgYm9udXM7DQogIH0NCg0KICBmdW5jdGlvbiBleHRyYWN0VmVzdGVkT3B0aW9uc0NvbXBvbmVudHModWludCBpc3N1ZWRQb29sT3B0aW9ucywgdWludCBpc3N1ZWRFeHRyYU9wdGlvbnMsIHVpbnQgdmVzdGVkT3B0aW9ucykNCiAgICBwdWJsaWMNCiAgICBjb25zdGFudA0KICAgIHJldHVybnMgKHVpbnQsIHVpbnQpDQogIHsNCiAgICAvLyBicmVha3MgZG93biB2ZXN0ZWQgb3B0aW9ucyBpbnRvIHBvb2wgb3B0aW9ucyBhbmQgZXh0cmEgb3B0aW9ucyBjb21wb25lbnRzDQogICAgaWYgKGlzc3VlZEV4dHJhT3B0aW9ucyA9PSAwKQ0KICAgICAgcmV0dXJuICh2ZXN0ZWRPcHRpb25zLCAwKTsNCiAgICB1aW50IHBvb2xPcHRpb25zID0gZGl2Um91bmQoaXNzdWVkUG9vbE9wdGlvbnMqdmVzdGVkT3B0aW9ucywgaXNzdWVkUG9vbE9wdGlvbnMgKyBpc3N1ZWRFeHRyYU9wdGlvbnMpOw0KICAgIHJldHVybiAocG9vbE9wdGlvbnMsIHZlc3RlZE9wdGlvbnMgLSBwb29sT3B0aW9ucyk7DQogIH0NCg0KICBmdW5jdGlvbiBjYWxjdWxhdGVGYWRlb3V0VG9Qb29sKHVpbnQzMiB0LCB1aW50WzldIGVtcGxveWVlKQ0KICAgIHB1YmxpYw0KICAgIGNvbnN0YW50DQogICAgcmV0dXJucyAodWludCwgdWludCkNCiAgew0KICAgIEVtcGxveWVlIG1lbW9yeSBlbXAgPSBkZXNlcmlhbGl6ZUVtcGxveWVlKGVtcGxveWVlKTsNCg0KICAgIHVpbnQgdmVzdGVkT3B0aW9ucyA9IGNhbGN1bGF0ZVZlc3RlZE9wdGlvbnMoZW1wLnRlcm1pbmF0ZWRBdCwgZW1wLmlzc3VlRGF0ZSwgZW1wLnBvb2xPcHRpb25zKTsNCiAgICB1aW50IHJldHVybmVkUG9vbE9wdGlvbnMgPSBhcHBseUZhZGVvdXRUb09wdGlvbnMoZW1wLmZhZGVvdXRTdGFydHMsIGVtcC5pc3N1ZURhdGUsIGVtcC50ZXJtaW5hdGVkQXQsIGVtcC5wb29sT3B0aW9ucywgdmVzdGVkT3B0aW9ucykgLQ0KICAgICAgYXBwbHlGYWRlb3V0VG9PcHRpb25zKHQsIGVtcC5pc3N1ZURhdGUsIGVtcC50ZXJtaW5hdGVkQXQsIGVtcC5wb29sT3B0aW9ucywgdmVzdGVkT3B0aW9ucyk7DQogICAgdWludCB2ZXN0ZWRFeHRyYU9wdGlvbnMgPSBjYWxjdWxhdGVWZXN0ZWRPcHRpb25zKGVtcC50ZXJtaW5hdGVkQXQsIGVtcC5pc3N1ZURhdGUsIGVtcC5leHRyYU9wdGlvbnMpOw0KICAgIHVpbnQgcmV0dXJuZWRFeHRyYU9wdGlvbnMgPSBhcHBseUZhZGVvdXRUb09wdGlvbnMoZW1wLmZhZGVvdXRTdGFydHMsIGVtcC5pc3N1ZURhdGUsIGVtcC50ZXJtaW5hdGVkQXQsIGVtcC5leHRyYU9wdGlvbnMsIHZlc3RlZEV4dHJhT3B0aW9ucykgLQ0KICAgICAgYXBwbHlGYWRlb3V0VG9PcHRpb25zKHQsIGVtcC5pc3N1ZURhdGUsIGVtcC50ZXJtaW5hdGVkQXQsIGVtcC5leHRyYU9wdGlvbnMsIHZlc3RlZEV4dHJhT3B0aW9ucyk7DQoNCiAgICByZXR1cm4gKHJldHVybmVkUG9vbE9wdGlvbnMsIHJldHVybmVkRXh0cmFPcHRpb25zKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNpbXVsYXRlT3B0aW9ucyh1aW50MzIgaXNzdWVEYXRlLCB1aW50MzIgdGVybWluYXRlZEF0LCB1aW50MzIgcG9vbE9wdGlvbnMsDQogICAgdWludDMyIGV4dHJhT3B0aW9ucywgdWludDMyIHN1c3BlbmRlZEF0LCB1aW50OCBlbXBsb3llZVN0YXRlLCB1aW50MzIgY2FsY0F0VGltZSkNCiAgICBwdWJsaWMNCiAgICBjb25zdGFudA0KICAgIHJldHVybnMgKHVpbnQpDQogIHsNCiAgICBFbXBsb3llZSBtZW1vcnkgZW1wID0gRW1wbG95ZWUoe2lzc3VlRGF0ZTogaXNzdWVEYXRlLCB0ZXJtaW5hdGVkQXQ6IHRlcm1pbmF0ZWRBdCwNCiAgICAgIHBvb2xPcHRpb25zOiBwb29sT3B0aW9ucywgZXh0cmFPcHRpb25zOiBleHRyYU9wdGlvbnMsIHN0YXRlOiBFbXBsb3llZVN0YXRlKGVtcGxveWVlU3RhdGUpLA0KICAgICAgdGltZVRvU2lnbjogaXNzdWVEYXRlKzIgd2Vla3MsIGZhZGVvdXRTdGFydHM6IHRlcm1pbmF0ZWRBdCwgc3VzcGVuZGVkQXQ6IHN1c3BlbmRlZEF0LA0KICAgICAgaWR4OjF9KTsNCiAgICByZXR1cm4gY2FsY3VsYXRlT3B0aW9ucyhzZXJpYWxpemVFbXBsb3llZShlbXApLCBjYWxjQXRUaW1lLCAwLCBmYWxzZSk7DQogIH0NCg0KICBmdW5jdGlvbiBzZXRQYXJhbWV0ZXJzKHVpbnQzMiBwQ2xpZmZQZXJpb2QsIHVpbnQzMiBwVmVzdGluZ1BlcmlvZCwgdWludDMyIHBSZXNpZHVhbEFtb3VudFByb21pbGxlLA0KICAgIHVpbnQzMiBwQm9udXNPcHRpb25zUHJvbWlsbGUsIHVpbnQzMiBwTmV3RW1wbG95ZWVQb29sUHJvbWlsbGUsIHVpbnQzMiBwT3B0aW9uc1BlclNoYXJlKQ0KICAgIGV4dGVybmFsDQogICAgb25seUNvbXBhbnkNCiAgew0KICAgIGlmIChwUmVzaWR1YWxBbW91bnRQcm9taWxsZSA+IEZQX1NDQUxFIHx8IHBCb251c09wdGlvbnNQcm9taWxsZSA+IEZQX1NDQUxFIHx8IHBOZXdFbXBsb3llZVBvb2xQcm9taWxsZSA+IEZQX1NDQUxFDQogICAgIHx8IHBPcHRpb25zUGVyU2hhcmUgPT0gMCkNCiAgICAgIHRocm93Ow0KICAgIGlmIChwQ2xpZmZQZXJpb2QgPiBwVmVzdGluZ1BlcmlvZCkNCiAgICAgIHRocm93Ow0KICAgIC8vIGluaXRpYWxpemF0aW9uIGNhbm5vdCBiZSBjYWxsZWQgZm9yIGEgc2Vjb25kIHRpbWUNCiAgICBpZiAoaGFzUGFyYW1ldGVycygpKQ0KICAgICAgdGhyb3c7DQogICAgY2xpZmZQZXJpb2QgPSBwQ2xpZmZQZXJpb2Q7DQogICAgdmVzdGluZ1BlcmlvZCA9IHBWZXN0aW5nUGVyaW9kOw0KICAgIG1heEZhZGVvdXRQcm9taWxsZSA9IEZQX1NDQUxFIC0gcFJlc2lkdWFsQW1vdW50UHJvbWlsbGU7DQogICAgYm9udXNPcHRpb25zUHJvbWlsbGUgPSBwQm9udXNPcHRpb25zUHJvbWlsbGU7DQogICAgbmV3RW1wbG95ZWVQb29sUHJvbWlsbGUgPSBwTmV3RW1wbG95ZWVQb29sUHJvbWlsbGU7DQogICAgb3B0aW9uc1BlclNoYXJlID0gcE9wdGlvbnNQZXJTaGFyZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIE9wdGlvbnNDYWxjdWxhdG9yKGFkZHJlc3MgcENvbXBhbnlBZGRyZXNzKSB7DQogICAgY29tcGFueUFkZHJlc3MgPSBwQ29tcGFueUFkZHJlc3M7DQogIH0NCn0NCg0KY29udHJhY3QgUHJvY2VlZHNPcHRpb25zQ29udmVydGVyIGlzIE93bmFibGUsIEVSQzIwT3B0aW9uc0NvbnZlcnRlciB7DQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgaW50ZXJuYWwgd2l0aGRyYXdhbHM7DQogIHVpbnRbXSBpbnRlcm5hbCBwYXlvdXRzOw0KDQogIGZ1bmN0aW9uIG1ha2VQYXlvdXQoKSBjb252ZXJ0ZWQgcGF5YWJsZSBvbmx5T3duZXIgcHVibGljIHsNCiAgICAvLyBpdCBkb2VzIG5vdCBtYWtlIHNlbnNlIHRvIGRpc3RyaWJ1dGUgbGVzcyB0aGFuIGV0aGVyDQogICAgaWYgKG1zZy52YWx1ZSA8IDEgZXRoZXIpDQogICAgICB0aHJvdzsNCiAgICBwYXlvdXRzLnB1c2gobXNnLnZhbHVlKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHdpdGhkcmF3KCkgY29udmVydGVkIHB1YmxpYyByZXR1cm5zICh1aW50KSB7DQogICAgLy8gd2l0aGRyYXcgZm9yIG1zZy5zZW5kZXINCiAgICB1aW50IGJhbGFuY2UgPSBiYWxhbmNlT2YobXNnLnNlbmRlcik7DQogICAgaWYgKGJhbGFuY2UgPT0gMCkNCiAgICAgIHJldHVybiAwOw0KICAgIHVpbnQgcGF5bWVudElkID0gd2l0aGRyYXdhbHNbbXNnLnNlbmRlcl07DQogICAgLy8gaWYgYWxsIHBheW91dHMgZm9yIGdpdmVuIHRva2VuIGhvbGRlciBleGVjdXRlZCB0aGVuIGV4aXQNCiAgICBpZiAocGF5bWVudElkID09IHBheW91dHMubGVuZ3RoKQ0KICAgICAgcmV0dXJuIDA7DQogICAgdWludCBwYXlvdXQgPSAwOw0KICAgIGZvciAodWludCBpID0gcGF5bWVudElkOyBpPHBheW91dHMubGVuZ3RoOyBpKyspIHsNCiAgICAgIC8vIGl0IGlzIHNhZmUgdG8gbWFrZSBwYXlvdXRzIHByby1yYXRhOiAoMSkgdG9rZW4gc3VwcGx5IHdpbGwgbm90IGNoYW5nZSAtIGNoZWNrIGNvbnZlcnRlZC9jb252ZXJzaW9uIG1vZGlmaWVycw0KICAgICAgLy8gLS0gKDIpIGJhbGFuY2VzIHdpbGwgbm90IGNoYW5nZTogY2hlY2sgdHJhbnNmZXIgb3ZlcnJpZGUgd2hpY2ggbGltaXRzIHRyYW5zZmVyIGJldHdlZW4gYWNjb3VudHMNCiAgICAgIC8vIE5PVEU6IHNhZmVNdWwgdGhyb3dzIG9uIG92ZXJmbG93LCBjYW4gbG9jayB1c2VycyBvdXQgb2YgdGhlaXIgd2l0aGRyYXdhbHMgaWYgYmFsYW5jZSBpcyB2ZXJ5IGhpZ2gNCiAgICAgIC8vIEByZW1jbyBJIGtub3cuIGFueSBzdWdnZXN0aW9ucz8gZXhwcmVzc2lvbiBiZWxvdyBnaXZlcyBtb3N0IHByZWNpc2lvbg0KICAgICAgdWludCB0aGlzUGF5b3V0ID0gZGl2Um91bmQoc2FmZU11bChwYXlvdXRzW2ldLCBiYWxhbmNlKSwgdG90YWxTdXBwbHkpOw0KICAgICAgcGF5b3V0ICs9IHRoaXNQYXlvdXQ7DQogICAgfQ0KICAgIC8vIGNoYW5nZSBub3cgdG8gcHJldmVudCByZS1lbnRyeSAobm90IG5lY2Vzc2FyeSBkdWUgdG8gbG93IHNlbmQoKSBnYXMgbGltaXQpDQogICAgd2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSBwYXlvdXRzLmxlbmd0aDsNCiAgICBpZiAocGF5b3V0ID4gMCkgew0KICAgICAgLy8gbm93IG1vZGlmeSBwYXlvdXQgd2l0aGluIDEwMDAgd2VpcyBhcyB3ZSBoYWQgcm91bmRpbmcgZXJyb3JzIGNvbWluZyBmcm9tIHByby1yYXRhIGFtb3VudHMNCiAgICAgIC8vIEByZW1jbyBtYXhpbXVtIHJvdW5kaW5nIGVycm9yIGlzIChudW1fZW1wbG95ZWVzICogbnVtX3BheW1lbnRzKSAvIDIgd2l0aCB0aGUgbWVhbiAwDQogICAgICAvLyAtLS0gMTAwMCB3ZWkgaXMgc3RpbGwgbm90aGluZywgcGxlYXNlIGV4cGxhaW4gbWUgd2hhdCBwcm9ibGVtIHlvdSBzZWUgaGVyZQ0KICAgICAgaWYgKCBhYnNEaWZmKHRoaXMuYmFsYW5jZSwgcGF5b3V0KSA8IDEwMDAgd2VpICkNCiAgICAgICAgcGF5b3V0ID0gdGhpcy5iYWxhbmNlOyAvLyBzZW5kIGFsbA0KICAgICAgLy9pZighbXNnLnNlbmRlci5jYWxsLnZhbHVlKHBheW91dCkoKSkgLy8gcmUgZW50cnkgdGVzdA0KICAgICAgLy8gIHRocm93Ow0KICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQocGF5b3V0KSkNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KICAgIHJldHVybiBwYXlvdXQ7DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyBjb252ZXJ0ZWQgew0KICAgIC8vIGlmIGFueXRoaW5nIHdhcyB3aXRoZHJhd24gdGhlbiBibG9jayB0cmFuc2ZlciB0byBwcmV2ZW50IG11bHRpcGxlIHdpdGhkcmF3YWxzDQogICAgLy8gdG9kbzogd2UgY291bGQgYWxsb3cgdHJhbnNmZXIgdG8gbmV3IGFjY291bnQgKG5vIHRva2VuIGJhbGFuY2UpDQogICAgLy8gdG9kbzogd2UgY291bGQgYWxsb3cgdHJhbnNmZXIgYmV0d2VlbiBhY2NvdW50IHRoYXQgZnVsbHkgd2l0aGRyYXduIChidXQgd2hhdCdzIHRoZSBwb2ludD8gLXRva2VuIGhhcyAwIHZhbHVlIHRoZW4pDQogICAgLy8gdG9kbzogdGhlcmUgYXJlIGEgZmV3IG90aGVyIGVkZ2UgY2FzZXMgd2hlcmUgdGhlcmUncyB0cmFuc2ZlciBhbmQgbm8gZG91YmxlIHNwZW5kaW5nDQogICAgaWYgKHdpdGhkcmF3YWxzW190b10gPiAwIHx8IHdpdGhkcmF3YWxzW21zZy5zZW5kZXJdID4gMCkNCiAgICAgIHRocm93Ow0KICAgIEVSQzIwT3B0aW9uc0NvbnZlcnRlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7DQogIH0NCg0KICBmdW5jdGlvbiBQcm9jZWVkc09wdGlvbnNDb252ZXJ0ZXIoYWRkcmVzcyBlc29wLCB1aW50MzIgZXhlcmNpc2VEZWFkbGluZSwgdWludDMyIGNvbnZlcnNpb25EZWFkbGluZSkNCiAgICBFUkMyME9wdGlvbnNDb252ZXJ0ZXIoZXNvcCwgZXhlcmNpc2VEZWFkbGluZSwgY29udmVyc2lvbkRlYWRsaW5lKQ0KICB7DQogIH0NCn0NCg0KY29udHJhY3QgUm9UIGlzIE93bmFibGUgew0KICAgIGFkZHJlc3MgcHVibGljIEVTT1BBZGRyZXNzOw0KICAgIGV2ZW50IEVTT1BBbmRDb21wYW55U2V0KGFkZHJlc3MgRVNPUEFkZHJlc3MsIGFkZHJlc3MgY29tcGFueUFkZHJlc3MpOw0KDQogICAgZnVuY3Rpb24gc2V0RVNPUChhZGRyZXNzIEVTT1AsIGFkZHJlc3MgY29tcGFueSkgcHVibGljIG9ubHlPd25lciB7DQogICAgICAvLyBvd25lciBzZXRzIEVTT1AgYW5kIGNvbXBhbnkgb25seSBvbmNlIHRoZW4gcGFzc2VzIG93bmVyc2hpcCB0byBjb21wYW55DQogICAgICAvLyBpbml0aWFsbHkgb3duZXIgaXMgYSBkZXZlbG9wZXIvYWRtaW4NCiAgICAgIEVTT1BBZGRyZXNzID0gRVNPUDsNCiAgICAgIHRyYW5zZmVyT3duZXJzaGlwKGNvbXBhbnkpOw0KICAgICAgRVNPUEFuZENvbXBhbnlTZXQoRVNPUCwgY29tcGFueSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24ga2lsbE9uVW5zdXBwb3J0ZWRGb3JrKCkgcHVibGljIG9ubHlPd25lciB7DQogICAgICAvLyB0aGlzIG1ldGhvZCBtYXkgb25seSBiZSBjYWxsZWQgYnkgY29tcGFueSBvbiB1bnN1cHBvcnRlZCBmb3Jrcw0KICAgICAgZGVsZXRlIEVTT1BBZGRyZXNzOw0KICAgICAgc2VsZmRlc3RydWN0KG93bmVyKTsNCiAgICB9DQp9'