base 64 content
base64ethTranchePricing30
	^'LyoqDQogKiBJbnRlcmZhY2UgZm9yIGRlZmluaW5nIGNyb3dkc2FsZSBwcmljaW5nLg0KICovDQpjb250cmFjdCBQcmljaW5nU3RyYXRlZ3kgew0KDQogIC8qKiBJbnRlcmZhY2UgZGVjbGFyYXRpb24uICovDQogIGZ1bmN0aW9uIGlzUHJpY2luZ1N0cmF0ZWd5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKiBTZWxmIGNoZWNrIGlmIGFsbCByZWZlcmVuY2VzIGFyZSBjb3JyZWN0bHkgc2V0Lg0KICAgKg0KICAgKiBDaGVja3MgdGhhdCBwcmljaW5nIHN0cmF0ZWd5IG1hdGNoZXMgY3Jvd2RzYWxlIHBhcmFtZXRlcnMuDQogICAqLw0KICBmdW5jdGlvbiBpc1NhbmUoYWRkcmVzcyBjcm93ZHNhbGUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICAvKioNCiAgICogV2hlbiBzb21lYm9keSB0cmllcyB0byBidXkgdG9rZW5zIGZvciBYIGV0aCwgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGV5IGdldC4NCiAgICoNCiAgICoNCiAgICogQHBhcmFtIHZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbmQgaW4gYXMgd2VpDQogICAqIEBwYXJhbSB0b2tlbnNTb2xkIC0gaG93IG11Y2ggdG9rZW5zIGhhdmUgYmVlbiBzb2xkIHRoaXMgZmFyDQogICAqIEBwYXJhbSB3ZWlSYWlzZWQgLSBob3cgbXVjaCBtb25leSBoYXMgYmVlbiByYWlzZWQgdGhpcyBmYXINCiAgICogQHBhcmFtIG1zZ1NlbmRlciAtIHdobyBpcyB0aGUgaW52ZXN0b3Igb2YgdGhpcyB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gZGVjaW1hbHMgLSBob3cgbWFueSBkZWNpbWFsIHVuaXRzIHRoZSB0b2tlbiBoYXMNCiAgICogQHJldHVybiBBbW91bnQgb2YgdG9rZW5zIHRoZSBpbnZlc3RvciByZWNlaXZlcw0KICAgKi8NCiAgZnVuY3Rpb24gY2FsY3VsYXRlUHJpY2UodWludCB2YWx1ZSwgdWludCB0b2tlbnNTb2xkLCB1aW50IHdlaVJhaXNlZCwgYWRkcmVzcyBtc2dTZW5kZXIsIHVpbnQgZGVjaW1hbHMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IHRva2VuQW1vdW50KTsNCn0NCg0KDQoNCi8qKg0KICogU2FmZSB1bnNpZ25lZCBzYWZlIG1hdGguDQogKg0KICogaHR0cHM6Ly9ibG9nLmFyYWdvbi5vbmUvbGlicmFyeS1kcml2ZW4tZGV2ZWxvcG1lbnQtaW4tc29saWRpdHktMmJlYmNhZjg4NzM2Iy43NTBnd3R3bGkNCiAqDQogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYWdvbk9uZS96ZXBwZWxpbi1zb2xpZGl0eS9tYXN0ZXIvY29udHJhY3RzL1NhZmVNYXRoTGliLnNvbA0KICoNCiAqIE1haW50YWluZWQgaGVyZSB1bnRpbCBtZXJnZWQgdG8gbWFpbmxpbmUgemVwcGVsaW4tc29saWRpdHkuDQogKg0KICovDQpsaWJyYXJ5IFNhZmVNYXRoTGliIHsNCg0KICBmdW5jdGlvbiB0aW1lcyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKiBiOw0KICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBtaW51cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiIDw9IGEpOw0KICAgIHJldHVybiBhIC0gYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBsdXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgcHJpdmF0ZSB7DQogICAgaWYgKCFhc3NlcnRpb24pIHRocm93Ow0KICB9DQp9DQoNCg0KDQoNCi8qDQogKiBPd25hYmxlDQogKg0KICogQmFzZSBjb250cmFjdCB3aXRoIGFuIG93bmVyLg0KICogUHJvdmlkZXMgb25seU93bmVyIG1vZGlmaWVyLCB3aGljaCBwcmV2ZW50cyBmdW5jdGlvbiBmcm9tIHJ1bm5pbmcgaWYgaXQgaXMgY2FsbGVkIGJ5IGFueW9uZSBvdGhlciB0aGFuIHRoZSBvd25lci4NCiAqLw0KY29udHJhY3QgT3duYWJsZSB7DQogIGFkZHJlc3MgcHVibGljIG93bmVyOw0KDQogIGZ1bmN0aW9uIE93bmFibGUoKSB7DQogICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seU93bmVyKCkgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogICAgXzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7DQogICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsNCiAgICAgIG93bmVyID0gbmV3T3duZXI7DQogICAgfQ0KICB9DQoNCn0NCg0KDQovKg0KICogSGFsdGFibGUNCiAqDQogKiBBYnN0cmFjdCBjb250cmFjdCB0aGF0IGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4NCiAqIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4gRGlmZmVycyBmcm9tIFBhdXNhYmxlIGJ5IGNhdXNpbmcgYSB0aHJvdyB3aGVuIGluIGhhbHQgbW9kZS4NCiAqDQogKg0KICogT3JpZ2luYWxseSBlbnZpc2lvbmVkIGluIEZpcnN0Qmxvb2QgSUNPIGNvbnRyYWN0Lg0KICovDQpjb250cmFjdCBIYWx0YWJsZSBpcyBPd25hYmxlIHsNCiAgYm9vbCBwdWJsaWMgaGFsdGVkOw0KDQogIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7DQogICAgaWYgKGhhbHRlZCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7DQogICAgaWYgKCFoYWx0ZWQpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQ0KICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsNCiAgICBoYWx0ZWQgPSB0cnVlOw0KICB9DQoNCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQ0KICBmdW5jdGlvbiB1bmhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsNCiAgICBoYWx0ZWQgPSBmYWxzZTsNCiAgfQ0KDQp9DQoNCg0KDQovKioNCiAqIEZpbmFsaXplIGFnZW50IGRlZmluZXMgd2hhdCBoYXBwZW5zIGF0IHRoZSBlbmQgb2Ygc3VjY2VzZWZ1bCBjcm93ZHNhbGUuDQogKg0KICogLSBBbGxvY2F0ZSB0b2tlbnMgZm9yIGZvdW5kZXJzLCBib3VudGllcyBhbmQgY29tbXVuaXR5DQogKiAtIE1ha2UgdG9rZW5zIHRyYW5zZmVyYWJsZQ0KICogLSBldGMuDQogKi8NCmNvbnRyYWN0IEZpbmFsaXplQWdlbnQgew0KDQogIGZ1bmN0aW9uIGlzRmluYWxpemVBZ2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBjYW4gcnVuIGZpbmFsaXplQ3Jvd2RzYWxlKCkgcHJvcGVybHkuDQogICAqDQogICAqIFRoaXMgaXMgYSBzYWZldHkgY2hlY2sgZnVuY3Rpb24gdGhhdCBkb2Vzbid0IGFsbG93IGNyb3dkc2FsZSB0byBiZWdpbg0KICAgKiB1bmxlc3MgdGhlIGZpbmFsaXplciBoYXMgYmVlbiBzZXQgdXAgcHJvcGVybHkuDQogICAqLw0KICBmdW5jdGlvbiBpc1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7DQoNCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLiAqLw0KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpOw0KDQp9DQoNCg0KDQoNCi8qDQogKiBFUkMyMCBpbnRlcmZhY2UNCiAqIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqLw0KY29udHJhY3QgRVJDMjAgew0KICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsNCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOw0KICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsNCn0NCg0KDQovKioNCiAqIEEgdG9rZW4gdGhhdCBkZWZpbmVzIGZyYWN0aW9uYWwgdW5pdHMgYXMgZGVjaW1hbHMuDQogKi8NCmNvbnRyYWN0IEZyYWN0aW9uYWxFUkMyMCBpcyBFUkMyMCB7DQoNCiAgdWludCBwdWJsaWMgZGVjaW1hbHM7DQoNCn0NCg0KDQoNCi8qKg0KICogQWJzdHJhY3QgYmFzZSBjb250cmFjdCBmb3IgdG9rZW4gc2FsZXMuDQogKg0KICogSGFuZGxlDQogKiAtIHN0YXJ0IGFuZCBlbmQgZGF0ZXMNCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzDQogKiAtIG1pbmltdW0gZnVuZGluZyBnb2FsIGFuZCByZWZ1bmQNCiAqIC0gdmFyaW91cyBzdGF0aXN0aWNzIGR1cmluZyB0aGUgY3Jvd2RmdW5kDQogKiAtIGRpZmZlcmVudCBwcmljaW5nIHN0cmF0ZWdpZXMNCiAqIC0gZGlmZmVyZW50IGludmVzdG1lbnQgcG9saWNpZXMgKHJlcXVpcmUgc2VydmVyIHNpZGUgY3VzdG9tZXIgaWQsIGFsbG93IG9ubHkgd2hpdGVsaXN0ZWQgYWRkcmVzc2VzKQ0KICoNCiAqLw0KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIEhhbHRhYmxlIHsNCg0KICB1c2luZyBTYWZlTWF0aExpYiBmb3IgdWludDsNCg0KICAvKiBUaGUgdG9rZW4gd2UgYXJlIHNlbGxpbmcgKi8NCiAgRnJhY3Rpb25hbEVSQzIwIHB1YmxpYyB0b2tlbjsNCg0KICAvKiBIb3cgd2UgYXJlIGdvaW5nIHRvIHByaWNlIG91ciBvZmZlcmluZyAqLw0KICBQcmljaW5nU3RyYXRlZ3kgcHVibGljIHByaWNpbmdTdHJhdGVneTsNCg0KICAvKiBQb3N0LXN1Y2Nlc3MgY2FsbGJhY2sgKi8NCiAgRmluYWxpemVBZ2VudCBwdWJsaWMgZmluYWxpemVBZ2VudDsNCg0KICAvKiB0b2tlbnMgd2lsbCBiZSB0cmFuc2ZlcmVkIGZyb20gdGhpcyBhZGRyZXNzICovDQogIGFkZHJlc3MgcHVibGljIG11bHRpc2lnV2FsbGV0Ow0KDQogIC8qIGlmIHRoZSBmdW5kaW5nIGdvYWwgaXMgbm90IHJlYWNoZWQsIGludmVzdG9ycyBtYXkgd2l0aGRyYXcgdGhlaXIgZnVuZHMgKi8NCiAgdWludCBwdWJsaWMgbWluaW11bUZ1bmRpbmdHb2FsOw0KDQogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBzdGFydCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8NCiAgdWludCBwdWJsaWMgc3RhcnRzQXQ7DQoNCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIGVuZCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8NCiAgdWludCBwdWJsaWMgZW5kc0F0Ow0KDQogIC8qIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFscmVhZHkgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QqLw0KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsNCg0KICAvKiBIb3cgbWFueSB3ZWkgb2YgZnVuZGluZyB3ZSBoYXZlIHJhaXNlZCAqLw0KICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQgPSAwOw0KDQogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovDQogIHVpbnQgcHVibGljIGludmVzdG9yQ291bnQgPSAwOw0KDQogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIHJldHVybmVkIGJhY2sgdG8gdGhlIGNvbnRyYWN0IGFmdGVyIGEgZmFpbGVkIGNyb3dkZnVuZC4gKi8NCiAgdWludCBwdWJsaWMgbG9hZGVkUmVmdW5kID0gMDsNCg0KICAvKiBIb3cgbXVjaCB3ZWkgd2UgaGF2ZSBnaXZlbiBiYWNrIHRvIGludmVzdG9ycy4qLw0KICB1aW50IHB1YmxpYyB3ZWlSZWZ1bmRlZCA9IDA7DQoNCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovDQogIGJvb2wgcHVibGljIGZpbmFsaXplZDsNCg0KICAvKiBEbyB3ZSBuZWVkIHRvIGhhdmUgdW5pcXVlIGNvbnRyaWJ1dG9yIGlkIGZvciBlYWNoIGN1c3RvbWVyICovDQogIGJvb2wgcHVibGljIHJlcXVpcmVDdXN0b21lcklkOw0KDQogIC8qKg0KICAgICogRG8gd2UgdmVyaWZ5IHRoYXQgY29udHJpYnV0b3IgaGFzIGJlZW4gY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgKGFjY3JlZGl0ZWQgaW52ZXN0b3JzIG9ubHkpLg0KICAgICogVGhpcyBtZXRob2Qgd2FzIGZpcnN0IHVzZWQgaW4gRmlyc3RCbG9vZCBjcm93ZHNhbGUgdG8gZW5zdXJlIGFsbCBjb250cmlidXRvcnMgaGF2ZSBhY2NlcHRlZCB0ZXJtcyBvbiBzYWxlIChvbiB0aGUgd2ViKS4NCiAgICAqLw0KICBib29sIHB1YmxpYyByZXF1aXJlZFNpZ25lZEFkZHJlc3M7DQoNCiAgLyogU2VydmVyIHNpZGUgYWRkcmVzcyB0aGF0IHNpZ25lZCBhbGxvd2VkIGNvbnRyaWJ1dG9ycyAoRXRoZXJldW0gYWRkcmVzc2VzKSB0aGF0IGNhbiBwYXJ0aWNpcGF0ZSB0aGUgY3Jvd2RzYWxlICovDQogIGFkZHJlc3MgcHVibGljIHNpZ25lckFkZHJlc3M7DQoNCiAgLyoqIEhvdyBtdWNoIEVUSCBlYWNoIGFkZHJlc3MgaGFzIGludmVzdGVkIHRvIHRoaXMgY3Jvd2RzYWxlICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGludmVzdGVkQW1vdW50T2Y7DQoNCiAgLyoqIEhvdyBtdWNoIHRva2VucyB0aGlzIGNyb3dkc2FsZSBoYXMgY3JlZGl0ZWQgZm9yIGVhY2ggaW52ZXN0b3IgYWRkcmVzcyAqLw0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlbkFtb3VudE9mOw0KDQogIC8qKiBBZGRyZXNzZXMgdGhhdCBhcmUgYWxsb3dlZCB0byBpbnZlc3QgZXZlbiBiZWZvcmUgSUNPIG9mZmljYWwgb3BlbnMuIEZvciB0ZXN0aW5nLCBmb3IgSUNPIHBhcnRuZXJzLCBldGMuICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3Q7DQoNCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVsIHRlc3RpbmcgZm9yIHRoZSBpbnRlcmFjdGlvbiBmcm9tIG93bmVyIHdhbGxldC4gWW91IGNhbiBzZXQgaXQgdG8gYW55IHZhbHVlIGFuZCBpbnNwZWN0IHRoaXMgaW4gYmxvY2tjaGFpbiBleHBsb3JlciB0byBzZWUgdGhhdCBjcm93ZHNhbGUgaW50ZXJhY3Rpb24gd29ya3MuICovDQogIHVpbnQgcHVibGljIG93bmVyVGVzdFZhbHVlOw0KDQogIC8qKiBTdGF0ZSBtYWNoaW5lDQogICAqDQogICAqIC0gUHJlcGFyaW5nOiBBbGwgY29udHJhY3QgaW5pdGlhbGl6YXRpb24gY2FsbHMgYW5kIHZhcmlhYmxlcyBoYXZlIG5vdCBiZWVuIHNldCB5ZXQNCiAgICogLSBQcmVmdW5kaW5nOiBXZSBoYXZlIG5vdCBwYXNzZWQgc3RhcnQgdGltZSB5ZXQNCiAgICogLSBGdW5kaW5nOiBBY3RpdmUgY3Jvd2RzYWxlDQogICAqIC0gU3VjY2VzczogTWluaW11bSBmdW5kaW5nIGdvYWwgcmVhY2hlZA0KICAgKiAtIEZhaWx1cmU6IE1pbmltdW0gZnVuZGluZyBnb2FsIG5vdCByZWFjaGVkIGJlZm9yZSBlbmRpbmcgdGltZQ0KICAgKiAtIEZpbmFsaXplZDogVGhlIGZpbmFsaXplZCBoYXMgYmVlbiBjYWxsZWQgYW5kIHN1Y2Nlc2Z1bGx5IGV4ZWN1dGVkDQogICAqIC0gUmVmdW5kaW5nOiBSZWZ1bmRzIGFyZSBsb2FkZWQgb24gdGhlIGNvbnRyYWN0IGZvciByZWNsYWltLg0KICAgKi8NCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQcmVwYXJpbmcsIFByZUZ1bmRpbmcsIEZ1bmRpbmcsIFN1Y2Nlc3MsIEZhaWx1cmUsIEZpbmFsaXplZCwgUmVmdW5kaW5nfQ0KDQogIC8vIEEgbmV3IGludmVzdG1lbnQgd2FzIG1hZGUNCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQxMjggY3VzdG9tZXJJZCk7DQoNCiAgLy8gUmVmdW5kIHdhcyBwcm9jZXNzZWQgZm9yIGEgY29udHJpYnV0b3INCiAgZXZlbnQgUmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50KTsNCg0KICAvLyBUaGUgcnVsZXMgd2VyZSBjaGFuZ2VkIHdoYXQga2luZCBvZiBpbnZlc3RtZW50cyB3ZSBhY2NlcHQNCiAgZXZlbnQgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQoYm9vbCByZXF1aXJlQ3VzdG9tZXJJZCwgYm9vbCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIGFkZHJlc3Mgc2lnbmVyQWRkcmVzcyk7DQoNCiAgLy8gQWRkcmVzcyBlYXJseSBwYXJ0aWNpcGF0aW9uIHdoaXRlbGlzdCBzdGF0dXMgY2hhbmdlZA0KICBldmVudCBXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKTsNCg0KICAvLyBDcm93ZHNhbGUgZW5kIHRpbWUgaGFzIGJlZW4gY2hhbmdlZA0KICBldmVudCBFbmRzQXRDaGFuZ2VkKHVpbnQgZW5kc0F0KTsNCg0KICBmdW5jdGlvbiBDcm93ZHNhbGUoYWRkcmVzcyBfdG9rZW4sIFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5LCBhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwgdWludCBfc3RhcnQsIHVpbnQgX2VuZCwgdWludCBfbWluaW11bUZ1bmRpbmdHb2FsKSB7DQoNCiAgICBvd25lciA9IG1zZy5zZW5kZXI7DQoNCiAgICB0b2tlbiA9IEZyYWN0aW9uYWxFUkMyMChfdG9rZW4pOw0KDQogICAgc2V0UHJpY2luZ1N0cmF0ZWd5KF9wcmljaW5nU3RyYXRlZ3kpOw0KDQogICAgbXVsdGlzaWdXYWxsZXQgPSBfbXVsdGlzaWdXYWxsZXQ7DQogICAgaWYobXVsdGlzaWdXYWxsZXQgPT0gMCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZihfc3RhcnQgPT0gMCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBzdGFydHNBdCA9IF9zdGFydDsNCg0KICAgIGlmKF9lbmQgPT0gMCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBlbmRzQXQgPSBfZW5kOw0KDQogICAgLy8gRG9uJ3QgbWVzcyB0aGUgZGF0ZXMNCiAgICBpZihzdGFydHNBdCA+PSBlbmRzQXQpIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gTWluaW11bSBmdW5kaW5nIGdvYWwgY2FuIGJlIHplcm8NCiAgICBtaW5pbXVtRnVuZGluZ0dvYWwgPSBfbWluaW11bUZ1bmRpbmdHb2FsOw0KICB9DQoNCiAgLyoqDQogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbigpIHBheWFibGUgew0KICAgIHRocm93Ow0KICB9DQoNCiAgLyoqDQogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4NCiAgICoNCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4NCiAgICogV2UgbXVzdCBoYXZlIG5vdCBwcmVzc2VkIHRoZSBlbWVyZ2VuY3kgYnJha2UuDQogICAqDQogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2Vucw0KICAgKiBAcGFyYW0gY3VzdG9tZXJJZCAob3B0aW9uYWwpIFVVSUQgdjQgdG8gdHJhY2sgdGhlIHN1Y2Nlc3NmdWwgcGF5bWVudHMgb24gdGhlIHNlcnZlciBzaWRlDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3RJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQpIHN0b3BJbkVtZXJnZW5jeSBwcml2YXRlIHsNCg0KICAgIC8vIERldGVybWluZSBpZiBpdCdzIGEgZ29vZCB0aW1lIHRvIGFjY2VwdCBpbnZlc3RtZW50IGZyb20gdGhpcyBwYXJ0aWNpcGFudA0KICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgew0KICAgICAgLy8gQXJlIHdlIHdoaXRlbGlzdGVkIGZvciBlYXJseSBkZXBvc2l0DQogICAgICBpZighZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0pIHsNCiAgICAgICAgdGhyb3c7DQogICAgICB9DQogICAgfSBlbHNlIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuRnVuZGluZykgew0KICAgICAgLy8gUmV0YWlsIHBhcnRpY2lwYW50cyBjYW4gb25seSBjb21lIGluIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyBydW5uaW5nDQogICAgICAvLyBwYXNzDQogICAgfSBlbHNlIHsNCiAgICAgIC8vIFVud2FudGVkIHN0YXRlDQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICB1aW50IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsNCiAgICB1aW50IHRva2VuQW1vdW50ID0gcHJpY2luZ1N0cmF0ZWd5LmNhbGN1bGF0ZVByaWNlKHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsNCg0KICAgIGlmKHRva2VuQW1vdW50ID09IDApIHsNCiAgICAgIC8vIER1c3QgdHJhbnNhY3Rpb24NCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGlmKGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID09IDApIHsNCiAgICAgICAvLyBBIG5ldyBpbnZlc3Rvcg0KICAgICAgIGludmVzdG9yQ291bnQrKzsNCiAgICB9DQoNCiAgICAvLyBVcGRhdGUgaW52ZXN0b3INCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXMod2VpQW1vdW50KTsNCiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOw0KDQogICAgLy8gVXBkYXRlIHRvdGFscw0KICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5wbHVzKHdlaUFtb3VudCk7DQogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBDaGVjayB0aGF0IHdlIGRpZCBub3QgYnVzdCB0aGUgY2FwDQogICAgaWYoaXNCcmVha2luZ0NhcCh0b2tlbkFtb3VudCwgd2VpQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQpKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsNCg0KICAgIC8vIFBvY2tldCB0aGUgbW9uZXkNCiAgICBpZighbXVsdGlzaWdXYWxsZXQuc2VuZCh3ZWlBbW91bnQpKSB0aHJvdzsNCg0KICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzDQogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGN1c3RvbWVySWQpOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGFub255bW91cyBjb250cmlidXRpb25zIHRvIHRoaXMgY3Jvd2RzYWxlLg0KICAgKi8NCiAgZnVuY3Rpb24gaW52ZXN0V2l0aFNpZ25lZEFkZHJlc3MoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTI1NihhZGRyKTsNCiAgICAgaWYgKGVjcmVjb3ZlcihoYXNoLCB2LCByLCBzKSAhPSBzaWduZXJBZGRyZXNzKSB0aHJvdzsNCiAgICAgaWYoY3VzdG9tZXJJZCA9PSAwKSB0aHJvdzsgIC8vIFVVSUR2NCBzYW5pdHkgY2hlY2sNCiAgICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7DQogIH0NCg0KICAvKioNCiAgICogVHJhY2sgd2hvIGlzIHRoZSBjdXN0b21lciBtYWtpbmcgdGhlIHBheW1lbnQgc28gd2UgY2FuIHNlbmQgdGhhbmsgeW91IGVtYWlsLg0KICAgKi8NCiAgZnVuY3Rpb24gaW52ZXN0V2l0aEN1c3RvbWVySWQoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cw0KICAgIGlmKGN1c3RvbWVySWQgPT0gMCkgdGhyb3c7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrDQogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgYW5vbnltb3VzIGNvbnRyaWJ1dGlvbnMgdG8gdGhpcyBjcm93ZHNhbGUuDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyBhZGRyKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaWYocmVxdWlyZUN1c3RvbWVySWQpIHRocm93OyAvLyBDcm93ZHNhbGUgbmVlZHMgdG8gdHJhY2sgcGFydGlwYW50cyBmb3IgdGhhbmsgeW91IGVtYWlsDQogICAgaWYocmVxdWlyZWRTaWduZWRBZGRyZXNzKSB0aHJvdzsgLy8gQ3Jvd2RzYWxlIGFsbG93cyBvbmx5IHNlcnZlci1zaWRlIHNpZ25lZCBwYXJ0aWNpcGFudHMNCiAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCAwKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyIGFuZCBjbGVhciBoaXMgYWRkcmVzcy4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIGJ1eVdpdGhTaWduZWRBZGRyZXNzKHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpbnZlc3RXaXRoU2lnbmVkQWRkcmVzcyhtc2cuc2VuZGVyLCBjdXN0b21lcklkLCB2LCByLCBzKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gYnV5V2l0aEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaW52ZXN0V2l0aEN1c3RvbWVySWQobXNnLnNlbmRlciwgY3VzdG9tZXJJZCk7DQogIH0NCg0KICAvKioNCiAgICogVGhlIGJhc2ljIGVudHJ5IHBvaW50IHRvIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgcHJvY2Vzcy4NCiAgICoNCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLg0KICAgKi8NCiAgZnVuY3Rpb24gYnV5KCkgcHVibGljIHBheWFibGUgew0KICAgIGludmVzdChtc2cuc2VuZGVyKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBGaW5hbGl6ZSBhIHN1Y2NjZXNmdWwgY3Jvd2RzYWxlLg0KICAgKg0KICAgKiBUaGUgb3duZXIgY2FuIHRyaWdncmUgYSBjYWxsIHRoZSBjb250cmFjdCB0aGF0IHByb3ZpZGVzIHBvc3QtY3Jvd2RzYWxlIGFjdGlvbnMsIGxpa2UgcmVsZWFzaW5nIHRoZSB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgew0KDQogICAgLy8gQWxyZWFkeSBmaW5hbGl6ZWQNCiAgICBpZihmaW5hbGl6ZWQpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8vIEZpbmFsaXppbmcgaXMgb3B0aW9uYWwuIFdlIG9ubHkgY2FsbCBpdCBpZiB3ZSBhcmUgZ2l2ZW4gYSBmaW5hbGl6aW5nIGFnZW50Lg0KICAgIGlmKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgIT0gMCkgew0KICAgICAgZmluYWxpemVBZ2VudC5maW5hbGl6ZUNyb3dkc2FsZSgpOw0KICAgIH0NCg0KICAgIGZpbmFsaXplZCA9IHRydWU7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgdG8gKHJlKXNldCBmaW5hbGl6ZSBhZ2VudC4NCiAgICoNCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHNldHRpbmcgdGhpcywgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuDQogICAqLw0KICBmdW5jdGlvbiBzZXRGaW5hbGl6ZUFnZW50KEZpbmFsaXplQWdlbnQgYWRkcikgb25seU93bmVyIHsNCiAgICBmaW5hbGl6ZUFnZW50ID0gYWRkcjsNCg0KICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50DQogICAgaWYoIWZpbmFsaXplQWdlbnQuaXNGaW5hbGl6ZUFnZW50KCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBTZXQgcG9saWN5IGRvIHdlIG5lZWQgdG8gaGF2ZSBzZXJ2ZXItc2lkZSBjdXN0b21lciBpZHMgZm9yIHRoZSBpbnZlc3RtZW50cy4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIHNldFJlcXVpcmVDdXN0b21lcklkKGJvb2wgdmFsdWUpIG9ubHlPd25lciB7DQogICAgcmVxdWlyZUN1c3RvbWVySWQgPSB2YWx1ZTsNCiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBTZXQgcG9saWN5IGlmIGFsbCBpbnZlc3RvcnMgbXVzdCBiZSBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSBmaXJzdC4NCiAgICoNCiAgICogVGhpcyBpcyBlLmcuIGZvciB0aGUgYWNjcmVkaXRlZCBpbnZlc3RvciBjbGVhcmluZy4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIHNldFJlcXVpcmVTaWduZWRBZGRyZXNzKGJvb2wgdmFsdWUsIGFkZHJlc3MgX3NpZ25lckFkZHJlc3MpIG9ubHlPd25lciB7DQogICAgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gdmFsdWU7DQogICAgc2lnbmVyQWRkcmVzcyA9IF9zaWduZXJBZGRyZXNzOw0KICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0RWFybHlQYXJpY2lwYW50V2hpdGVsaXN0KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpIG9ubHlPd25lciB7DQogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IHN0YXR1czsNCiAgICBXaGl0ZWxpc3RlZChhZGRyLCBzdGF0dXMpOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGNyb3dkc2FsZSBvd25lciB0byBjbG9zZSBlYXJseSBvciBleHRlbmQgdGhlIGNyb3dkc2FsZS4NCiAgICoNCiAgICogVGhpcyBpcyB1c2VmdWwgZS5nLiBmb3IgYSBtYW51YWwgc29mdCBjYXAgaW1wbGVtZW50YXRpb246DQogICAqIC0gYWZ0ZXIgWCBhbW91bnQgaXMgcmVhY2hlZCBkZXRlcm1pbmUgbWFudWFsIGNsb3NpbmcNCiAgICoNCiAgICogVGhpcyBtYXkgcHV0IHRoZSBjcm93ZHNhbGUgdG8gYW4gaW52YWxpZCBzdGF0ZSwNCiAgICogYnV0IHdlIHRydXN0IG93bmVycyBrbm93IHdoYXQgdGhleSBhcmUgZG9pbmcuDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBzZXRFbmRzQXQodWludCB0aW1lKSBvbmx5T3duZXIgew0KDQogICAgaWYobm93ID4gdGltZSkgew0KICAgICAgdGhyb3c7IC8vIERvbid0IGNoYW5nZSBwYXN0DQogICAgfQ0KDQogICAgZW5kc0F0ID0gdGltZTsNCiAgICBFbmRzQXRDaGFuZ2VkKGVuZHNBdCk7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgdG8gKHJlKXNldCBwcmljaW5nIHN0cmF0ZWd5Lg0KICAgKg0KICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gdGhlIHNldCwgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuDQogICAqLw0KICBmdW5jdGlvbiBzZXRQcmljaW5nU3RyYXRlZ3koUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3kpIG9ubHlPd25lciB7DQogICAgcHJpY2luZ1N0cmF0ZWd5ID0gX3ByaWNpbmdTdHJhdGVneTsNCg0KICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50DQogICAgaWYoIXByaWNpbmdTdHJhdGVneS5pc1ByaWNpbmdTdHJhdGVneSgpKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgbG9hZCByZWZ1bmRzIGJhY2sgb24gdGhlIGNvbnRyYWN0IGZvciB0aGUgcmVmdW5kaW5nLg0KICAgKg0KICAgKiBUaGUgdGVhbSBjYW4gdHJhbnNmZXIgdGhlIGZ1bmRzIGJhY2sgb24gdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBjYXNlIHRoZSBtaW5pbXVtIGdvYWwgd2FzIG5vdCByZWFjaGVkLi4NCiAgICovDQogIGZ1bmN0aW9uIGxvYWRSZWZ1bmQoKSBwdWJsaWMgcGF5YWJsZSBpblN0YXRlKFN0YXRlLkZhaWx1cmUpIHsNCiAgICBpZihtc2cudmFsdWUgPT0gMCkgdGhyb3c7DQogICAgbG9hZGVkUmVmdW5kID0gbG9hZGVkUmVmdW5kLnBsdXMobXNnLnZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBJbnZlc3RvcnMgY2FuIGNsYWltIHJlZnVuZC4NCiAgICovDQogIGZ1bmN0aW9uIHJlZnVuZCgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlJlZnVuZGluZykgew0KICAgIHVpbnQyNTYgd2VpVmFsdWUgPSBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdOw0KICAgIGlmICh3ZWlWYWx1ZSA9PSAwKSB0aHJvdzsNCiAgICBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdID0gMDsNCiAgICB3ZWlSZWZ1bmRlZCA9IHdlaVJlZnVuZGVkLnBsdXMod2VpVmFsdWUpOw0KICAgIFJlZnVuZChtc2cuc2VuZGVyLCB3ZWlWYWx1ZSk7DQogICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQod2VpVmFsdWUpKSB0aHJvdzsNCiAgfQ0KDQogIC8qKg0KICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNyb3dkc2FsZSBoYXMgcmFpc2VkIGVub3VnaCBtb25leSB0byBiZSBhIHN1Y2Nlcw0KICAgKi8NCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZWFjaGVkKSB7DQogICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBtaW5pbXVtRnVuZGluZ0dvYWw7DQogIH0NCg0KICAvKioNCiAgICogQ3Jvd2RmdW5kIHN0YXRlIG1hY2hpbmUgbWFuYWdlbWVudC4NCiAgICoNCiAgICogV2UgbWFrZSBpdCBhIGZ1bmN0aW9uIGFuZCBkbyBub3QgYXNzaWduIHRoZSByZXN1bHQgdG8gYSB2YXJpYWJsZSwgc28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZS4NCiAgICovDQogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFN0YXRlKSB7DQogICAgaWYoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOw0KICAgIGVsc2UgaWYgKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgPT0gMCkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsNCiAgICBlbHNlIGlmICghZmluYWxpemVBZ2VudC5pc1NhbmUoKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsNCiAgICBlbHNlIGlmICghcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsNCiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPCBzdGFydHNBdCkgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7DQogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDw9IGVuZHNBdCAmJiAhaXNDcm93ZHNhbGVGdWxsKCkpIHJldHVybiBTdGF0ZS5GdW5kaW5nOw0KICAgIGVsc2UgaWYgKGlzTWluaW11bUdvYWxSZWFjaGVkKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOw0KICAgIGVsc2UgaWYgKCFpc01pbmltdW1Hb2FsUmVhY2hlZCgpICYmIHdlaVJhaXNlZCA+IDAgJiYgbG9hZGVkUmVmdW5kID49IHdlaVJhaXNlZCkgcmV0dXJuIFN0YXRlLlJlZnVuZGluZzsNCiAgICBlbHNlIHJldHVybiBTdGF0ZS5GYWlsdXJlOw0KICB9DQoNCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVhbCB0ZXN0aW5nIG9mIG11bHRpc2lnIHdhbGxldCBpbnRlcmFjdGlvbiAqLw0KICBmdW5jdGlvbiBzZXRPd25lclRlc3RWYWx1ZSh1aW50IHZhbCkgb25seU93bmVyIHsNCiAgICBvd25lclRlc3RWYWx1ZSA9IHZhbDsNCiAgfQ0KDQogIC8vDQogIC8vIE1vZGlmaWVycw0KICAvLw0KDQogIC8qKiBNb2RpZmllZCBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8NCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgew0KICAgIGlmKGdldFN0YXRlKCkgIT0gc3RhdGUpIHRocm93Ow0KICAgIF87DQogIH0NCg0KDQogIC8vDQogIC8vIEFic3RyYWN0IGZ1bmN0aW9ucw0KICAvLw0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBpbnZlc3RlZCBicmVha3Mgb3VyIGNhcCBydWxlcy4NCiAgICoNCiAgICoNCiAgICogVGhlIGNoaWxkIGNvbnRyYWN0IG11c3QgZGVmaW5lIHRoZWlyIG93biBjYXAgc2V0dGluZyBydWxlcy4NCiAgICogV2UgYWxsb3cgYSBsb3Qgb2YgZmxleGliaWxpdHkgdGhyb3VnaCBkaWZmZXJlbnQgY2FwcGluZyBzdHJhdGVnaWVzIChFVEgsIHRva2VuIGNvdW50KQ0KICAgKiBDYWxsZWQgZnJvbSBpbnZlc3QoKS4NCiAgICoNCiAgICogQHBhcmFtIHdlaUFtb3VudCBUaGUgYW1vdW50IG9mIHdlaSB0aGUgaW52ZXN0b3IgdHJpZXMgdG8gaW52ZXN0IGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB3ZSB0cnkgdG8gZ2l2ZSB0byB0aGUgaW52ZXN0b3IgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHdlaVJhaXNlZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHJhaXNlZCBiYWxhbmNlIGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHRva2Vuc1NvbGRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCBzb2xkIHRva2VucyBjb3VudCBhZnRlciB0aGlzIHRyYW5zYWN0aW9uDQogICAqDQogICAqIEByZXR1cm4gdHJ1ZSBpZiB0YWtpbmcgdGhpcyBpbnZlc3RtZW50IHdvdWxkIGJyZWFrIG91ciBjYXAgcnVsZXMNCiAgICovDQogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpUmFpc2VkVG90YWwsIHVpbnQgdG9rZW5zU29sZFRvdGFsKSBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKTsNCg0KICAvKioNCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIGZ1bGwgYW5kIHdlIGNhbiBubyBsb25nZXIgc2VsbCBhbnkgdG9rZW5zLg0KICAgKi8NCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGVGdWxsKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOw0KDQogIC8qKg0KICAgKiBDcmVhdGUgbmV3IHRva2VucyBvciB0cmFuc2ZlciBpc3N1ZWQgdG9rZW5zIHRvIHRoZSBpbnZlc3RvciBkZXBlbmRpbmcgb24gdGhlIGNhcCBtb2RlbC4NCiAgICovDQogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBwcml2YXRlOw0KfQ0KDQoNCg0KDQovLy8gQGRldiBUcmFuY2hlIGJhc2VkIHByaWNpbmcgd2l0aCBzcGVjaWFsIHN1cHBvcnQgZm9yIHByZS1pY28gZGVhbHMuDQovLy8gICAgICBJbXBsZW1lbnRpbmcgImZpcnN0IHByaWNlIiB0cmFuY2hlcywgbWVhbmluZywgdGhhdCBpZiBieWVycyBvcmRlciBpcw0KLy8vICAgICAgY292ZXJpbmcgbW9yZSB0aGFuIG9uZSB0cmFuY2hlLCB0aGUgcHJpY2Ugb2YgdGhlIGxvd2VzdCB0cmFuY2hlIHdpbGwgYXBwbHkNCi8vLyAgICAgIHRvIHRoZSB3aG9sZSBvcmRlci4NCmNvbnRyYWN0IEV0aFRyYW5jaGVQcmljaW5nIGlzIFByaWNpbmdTdHJhdGVneSwgT3duYWJsZSB7DQoNCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7DQoNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgTUFYX1RSQU5DSEVTID0gMTA7DQoNCiAgLy8gVGhpcyBjb250YWlucyBhbGwgcHJlLUlDTyBhZGRyZXNzZXMsIGFuZCB0aGVpciBwcmljZXMgKHdlaXMgcGVyIHRva2VuKQ0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBwcmVpY29BZGRyZXNzZXM7DQoNCiAgLyoqDQogICogRGVmaW5lIHByaWNpbmcgc2NoZWR1bGUgdXNpbmcgdHJhbmNoZXMuDQogICovDQogIHN0cnVjdCBUcmFuY2hlIHsNCg0KICAgICAgLy8gQW1vdW50IGluIHdlaXMgd2hlbiB0aGlzIHRyYW5jaGUgYmVjb21lcyBhY3RpdmUNCiAgICAgIHVpbnQgYW1vdW50Ow0KDQogICAgICAvLyBIb3cgbWFueSB0b2tlbnMgcGVyIHNhdG9zaGkgeW91IHdpbGwgZ2V0IHdoaWxlIHRoaXMgdHJhbmNoZSBpcyBhY3RpdmUNCiAgICAgIHVpbnQgcHJpY2U7DQogIH0NCg0KICAvLyBTdG9yZSB0cmFuY2hlcyBpbiBhIGZpeGVkIGFycmF5LCBzbyB0aGF0IGl0IGNhbiBiZSBzZWVuIGluIGEgYmxvY2tjaGFpbiBleHBsb3Jlcg0KICAvLyBUcmFuY2hlIDAgaXMgYWx3YXlzICgwLCAwKQ0KICAvLyAoVE9ETzogY2hhbmdlIHRoaXMgd2hlbiB3ZSBjb25maXJtIGR5bmFtaWMgYXJyYXlzIGFyZSBleHBsb3JhYmxlKQ0KICBUcmFuY2hlWzEwXSBwdWJsaWMgdHJhbmNoZXM7DQoNCiAgLy8gSG93IG1hbnkgYWN0aXZlIHRyYW5jaGVzIHdlIGhhdmUNCiAgdWludCBwdWJsaWMgdHJhbmNoZUNvdW50Ow0KDQogIC8vLyBAZGV2IENvbnRydWN0aW9uLCBjcmVhdGluZyBhIGxpc3Qgb2YgdHJhbmNoZXMNCiAgLy8vIEBwYXJhbSBfdHJhbmNoZXMgdWludFtdIHRyYW5jaGVzIFBhaXJzIG9mIChzdGFydCBhbW91bnQsIHByaWNlKQ0KICBmdW5jdGlvbiBFdGhUcmFuY2hlUHJpY2luZyh1aW50W10gX3RyYW5jaGVzKSB7DQogICAgLy8gTmVlZCB0byBoYXZlIHR1cGxlcywgbGVuZ3RoIGNoZWNrDQogICAgaWYoX3RyYW5jaGVzLmxlbmd0aCAlIDIgPT0gMSB8fCBfdHJhbmNoZXMubGVuZ3RoID49IE1BWF9UUkFOQ0hFUyoyKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICB0cmFuY2hlQ291bnQgPSBfdHJhbmNoZXMubGVuZ3RoIC8gMjsNCg0KICAgIHVpbnQgaGlnaGVzdEFtb3VudCA9IDA7DQoNCiAgICAvLyBXZSBuZWVkIHRvIHN0YXJ0IGZyb20gemVybw0KICAgIGlmKHRyYW5jaGVzW2ldLmFtb3VudCAhPSAwKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBmb3IodWludCBpPTA7IGk8X3RyYW5jaGVzLmxlbmd0aC8yOyBpKyspIHsNCiAgICAgIHRyYW5jaGVzW2ldLmFtb3VudCA9IF90cmFuY2hlc1tpKjJdOw0KICAgICAgdHJhbmNoZXNbaV0ucHJpY2UgPSBfdHJhbmNoZXNbaSoyKzFdOw0KDQogICAgICAvLyBObyBpbnZhbGlkIHN0ZXBzDQogICAgICBpZigoaGlnaGVzdEFtb3VudCAhPSAwKSAmJiAodHJhbmNoZXNbaV0uYW1vdW50IDw9IGhpZ2hlc3RBbW91bnQpKSB7DQogICAgICAgIHRocm93Ow0KICAgICAgfQ0KDQogICAgICBoaWdoZXN0QW1vdW50ID0gdHJhbmNoZXNbaV0uYW1vdW50Ow0KICAgIH0NCg0KICAgIC8vIExhc3QgdHJhbmNoZSBwcmljZSBtdXN0IGJlIHplcm8sIHRlcm1pbmF0aW5nIHRoZSBjcm93ZGFsZQ0KICAgIGlmKHRyYW5jaGVzW3RyYW5jaGVDb3VudC0xXS5wcmljZSAhPSAwKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogIH0NCg0KICAvLy8gQGRldiBUaGlzIGlzIGludm9rZWQgb25jZSBmb3IgZXZlcnkgcHJlLUlDTyBhZGRyZXNzLCBzZXQgcHJpY2VQZXJUb2tlbg0KICAvLy8gICAgICB0byAwIHRvIGRpc2FibGUNCiAgLy8vIEBwYXJhbSBwcmVpY29BZGRyZXNzIFByZXNhbGVGdW5kQ29sbGVjdG9yIGFkZHJlc3MNCiAgLy8vIEBwYXJhbSBwcmljZVBlclRva2VuIEhvdyBtYW55IHdlaXMgb25lIHRva2VuIGNvc3QgZm9yIHByZS1pY28gaW52ZXN0b3JzDQogIGZ1bmN0aW9uIHNldFByZWljb0FkZHJlc3MoYWRkcmVzcyBwcmVpY29BZGRyZXNzLCB1aW50IHByaWNlUGVyVG9rZW4pDQogICAgcHVibGljDQogICAgb25seU93bmVyDQogIHsNCiAgICBwcmVpY29BZGRyZXNzZXNbcHJlaWNvQWRkcmVzc10gPSBwcmljZVBlclRva2VuOw0KICB9DQoNCiAgLy8vIEBkZXYgSXRlcmF0ZSB0aHJvdWdoIHRyYW5jaGVzLiBZb3UgcmVhY2ggZW5kIG9mIHRyYW5jaGVzIHdoZW4gcHJpY2UgPSAwDQogIC8vLyBAcmV0dXJuIHR1cGxlICh0aW1lLCBwcmljZSkNCiAgZnVuY3Rpb24gZ2V0VHJhbmNoZSh1aW50IG4pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50LCB1aW50KSB7DQogICAgcmV0dXJuICh0cmFuY2hlc1tuXS5hbW91bnQsIHRyYW5jaGVzW25dLnByaWNlKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldEZpcnN0VHJhbmNoZSgpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoVHJhbmNoZSkgew0KICAgIHJldHVybiB0cmFuY2hlc1swXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldExhc3RUcmFuY2hlKCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChUcmFuY2hlKSB7DQogICAgcmV0dXJuIHRyYW5jaGVzW3RyYW5jaGVDb3VudC0xXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldFByaWNpbmdTdGFydHNBdCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgcmV0dXJuIGdldEZpcnN0VHJhbmNoZSgpLmFtb3VudDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldFByaWNpbmdFbmRzQXQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgIHJldHVybiBnZXRMYXN0VHJhbmNoZSgpLmFtb3VudDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIF9jcm93ZHNhbGUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsNCiAgICAvLyBPdXIgdHJhbmNoZXMgYXJlIG5vdCBib3VuZCBieSB0aW1lLCBzbyB3ZSBjYW4ndCByZWFsbHkgY2hlY2sgYXJlIHdlIHNhbmUNCiAgICAvLyBzbyB3ZSBwcmVzdW1lIHdlIGFyZSA7KQ0KICAgIC8vIEluIHRoZSBmdXR1cmUgd2UgY291bGQgc2F2ZSBhbmQgdHJhY2sgcmFpc2VkIHRva2VucywgYW5kIGNvbXBhcmUgaXQgdG8NCiAgICAvLyB0aGUgQ3Jvd2RzYWxlIGNvbnRyYWN0Lg0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLy8vIEBkZXYgR2V0IHRoZSBjdXJyZW50IHRyYW5jaGUgb3IgYmFpbCBvdXQgaWYgd2UgYXJlIG5vdCBpbiB0aGUgdHJhbmNoZSBwZXJpb2RzLg0KICAvLy8gQHBhcmFtIHdlaVJhaXNlZCB0b3RhbCBhbW91bnQgb2Ygd2VpcyByYWlzZWQsIGZvciBjYWxjdWxhdGluZyB0aGUgY3VycmVudCB0cmFuY2hlDQogIC8vLyBAcmV0dXJuIHtbdHlwZV19IFtkZXNjcmlwdGlvbl0NCiAgZnVuY3Rpb24gZ2V0Q3VycmVudFRyYW5jaGUodWludCB3ZWlSYWlzZWQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoVHJhbmNoZSkgew0KICAgIHVpbnQgaTsNCg0KICAgIGZvcihpPTA7IGkgPCB0cmFuY2hlcy5sZW5ndGg7IGkrKykgew0KICAgICAgaWYod2VpUmFpc2VkIDwgdHJhbmNoZXNbaV0uYW1vdW50KSB7DQogICAgICAgIHJldHVybiB0cmFuY2hlc1tpLTFdOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIC8vLyBAZGV2IEdldCB0aGUgY3VycmVudCBwcmljZS4NCiAgLy8vIEBwYXJhbSB3ZWlSYWlzZWQgdG90YWwgYW1vdW50IG9mIHdlaXMgcmFpc2VkLCBmb3IgY2FsY3VsYXRpbmcgdGhlIGN1cnJlbnQgdHJhbmNoZQ0KICAvLy8gQHJldHVybiBUaGUgY3VycmVudCBwcmljZSBvciAwIGlmIHdlIGFyZSBvdXRzaWRlIHRyYWNoZSByYW5nZXMNCiAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKHVpbnQgd2VpUmFpc2VkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpIHsNCiAgICByZXR1cm4gZ2V0Q3VycmVudFRyYW5jaGUod2VpUmFpc2VkKS5wcmljZTsNCiAgfQ0KDQogIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgY3VycmVudCBwcmljZSBmb3IgYnV5IGluIGFtb3VudC4NCiAgZnVuY3Rpb24gY2FsY3VsYXRlUHJpY2UodWludCB2YWx1ZSwgdWludCB0b2tlbnNTb2xkLCB1aW50IHdlaVJhaXNlZCwgYWRkcmVzcyBtc2dTZW5kZXIsIHVpbnQgZGVjaW1hbHMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQoNCiAgICB1aW50IG11bHRpcGxpZXIgPSAxMCAqKiBkZWNpbWFsczsNCg0KICAgIC8vIFRoaXMgaW52ZXN0b3IgaXMgY29taW5nIHRocm91Z2ggcHJlLWljbw0KICAgIGlmKHByZWljb0FkZHJlc3Nlc1ttc2dTZW5kZXJdID4gMCkgew0KICAgICAgcmV0dXJuIHZhbHVlLnRpbWVzKG11bHRpcGxpZXIpIC8gcHJlaWNvQWRkcmVzc2VzW21zZ1NlbmRlcl07DQogICAgfQ0KDQogICAgdWludCBwcmljZSA9IGdldEN1cnJlbnRQcmljZSh3ZWlSYWlzZWQpOw0KICAgIHJldHVybiB2YWx1ZS50aW1lcyhtdWx0aXBsaWVyKSAvIHByaWNlOw0KICB9DQoNCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsNCiAgICB0aHJvdzsgLy8gTm8gbW9uZXkgb24gdGhpcyBjb250cmFjdA0KICB9DQoNCn0='