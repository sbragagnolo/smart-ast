base 64 content
base64ethTranchePricing8
	^'LyoqDQogKiBJbnRlcmZhY2UgZm9yIGRlZmluaW5nIGNyb3dkc2FsZSBwcmljaW5nLg0KICovDQpjb250cmFjdCBQcmljaW5nU3RyYXRlZ3kgew0KDQogIC8qKiBJbnRlcmZhY2UgZGVjbGFyYXRpb24uICovDQogIGZ1bmN0aW9uIGlzUHJpY2luZ1N0cmF0ZWd5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKiBTZWxmIGNoZWNrIGlmIGFsbCByZWZlcmVuY2VzIGFyZSBjb3JyZWN0bHkgc2V0Lg0KICAgKg0KICAgKiBDaGVja3MgdGhhdCBwcmljaW5nIHN0cmF0ZWd5IG1hdGNoZXMgY3Jvd2RzYWxlIHBhcmFtZXRlcnMuDQogICAqLw0KICBmdW5jdGlvbiBpc1NhbmUoYWRkcmVzcyBjcm93ZHNhbGUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICAvKioNCiAgICogV2hlbiBzb21lYm9keSB0cmllcyB0byBidXkgdG9rZW5zIGZvciBYIGV0aCwgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGV5IGdldC4NCiAgICoNCiAgICoNCiAgICogQHBhcmFtIHZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbmQgaW4gYXMgd2VpDQogICAqIEBwYXJhbSB0b2tlbnNTb2xkIC0gaG93IG11Y2ggdG9rZW5zIGhhdmUgYmVlbiBzb2xkIHRoaXMgZmFyDQogICAqIEBwYXJhbSB3ZWlSYWlzZWQgLSBob3cgbXVjaCBtb25leSBoYXMgYmVlbiByYWlzZWQgdGhpcyBmYXINCiAgICogQHBhcmFtIG1zZ1NlbmRlciAtIHdobyBpcyB0aGUgaW52ZXN0b3Igb2YgdGhpcyB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gZGVjaW1hbHMgLSBob3cgbWFueSBkZWNpbWFsIHVuaXRzIHRoZSB0b2tlbiBoYXMNCiAgICogQHJldHVybiBBbW91bnQgb2YgdG9rZW5zIHRoZSBpbnZlc3RvciByZWNlaXZlcw0KICAgKi8NCiAgZnVuY3Rpb24gY2FsY3VsYXRlUHJpY2UodWludCB2YWx1ZSwgdWludCB3ZWlSYWlzZWQsIHVpbnQgdG9rZW5zU29sZCwgYWRkcmVzcyBtc2dTZW5kZXIsIHVpbnQgZGVjaW1hbHMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IHRva2VuQW1vdW50KTsNCn0NCg0KDQoNCi8qKg0KICogU2FmZSB1bnNpZ25lZCBzYWZlIG1hdGguDQogKg0KICogaHR0cHM6Ly9ibG9nLmFyYWdvbi5vbmUvbGlicmFyeS1kcml2ZW4tZGV2ZWxvcG1lbnQtaW4tc29saWRpdHktMmJlYmNhZjg4NzM2Iy43NTBnd3R3bGkNCiAqDQogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYWdvbk9uZS96ZXBwZWxpbi1zb2xpZGl0eS9tYXN0ZXIvY29udHJhY3RzL1NhZmVNYXRoTGliLnNvbA0KICoNCiAqIE1haW50YWluZWQgaGVyZSB1bnRpbCBtZXJnZWQgdG8gbWFpbmxpbmUgemVwcGVsaW4tc29saWRpdHkuDQogKg0KICovDQpsaWJyYXJ5IFNhZmVNYXRoTGliIHsNCg0KICBmdW5jdGlvbiB0aW1lcyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKiBiOw0KICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBtaW51cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiIDw9IGEpOw0KICAgIHJldHVybiBhIC0gYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHBsdXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYz49YSk7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIHByaXZhdGUgew0KICAgIGlmICghYXNzZXJ0aW9uKSB0aHJvdzsNCiAgfQ0KfQ0KDQoNCg0KDQovKg0KICogT3duYWJsZQ0KICoNCiAqIEJhc2UgY29udHJhY3Qgd2l0aCBhbiBvd25lci4NCiAqIFByb3ZpZGVzIG9ubHlPd25lciBtb2RpZmllciwgd2hpY2ggcHJldmVudHMgZnVuY3Rpb24gZnJvbSBydW5uaW5nIGlmIGl0IGlzIGNhbGxlZCBieSBhbnlvbmUgb3RoZXIgdGhhbiB0aGUgb3duZXIuDQogKi8NCmNvbnRyYWN0IE93bmFibGUgew0KICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCg0KICBmdW5jdGlvbiBPd25hYmxlKCkgew0KICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsNCiAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICAgIF87DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgew0KICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7DQogICAgICBvd25lciA9IG5ld093bmVyOw0KICAgIH0NCiAgfQ0KDQp9DQoNCg0KLyoNCiAqIEhhbHRhYmxlDQogKg0KICogQWJzdHJhY3QgY29udHJhY3QgdGhhdCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuDQogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuDQogKg0KICoNCiAqIE9yaWdpbmFsbHkgZW52aXNpb25lZCBpbiBGaXJzdEJsb29kIElDTyBjb250cmFjdC4NCiAqLw0KY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7DQogIGJvb2wgcHVibGljIGhhbHRlZDsNCg0KICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgew0KICAgIGlmIChoYWx0ZWQpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5SW5FbWVyZ2VuY3kgew0KICAgIGlmICghaGFsdGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUNCiAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7DQogICAgaGFsdGVkID0gdHJ1ZTsNCiAgfQ0KDQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUNCiAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7DQogICAgaGFsdGVkID0gZmFsc2U7DQogIH0NCg0KfQ0KDQoNCg0KLyoqDQogKiBGaW5hbGl6ZSBhZ2VudCBkZWZpbmVzIHdoYXQgaGFwcGVucyBhdCB0aGUgZW5kIG9mIHN1Y2Nlc2VmdWwgY3Jvd2RzYWxlLg0KICoNCiAqIC0gQWxsb2NhdGUgdG9rZW5zIGZvciBmb3VuZGVycywgYm91bnRpZXMgYW5kIGNvbW11bml0eQ0KICogLSBNYWtlIHRva2VucyB0cmFuc2ZlcmFibGUNCiAqIC0gZXRjLg0KICovDQpjb250cmFjdCBGaW5hbGl6ZUFnZW50IHsNCg0KICBmdW5jdGlvbiBpc0ZpbmFsaXplQWdlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICAvKiogUmV0dXJuIHRydWUgaWYgd2UgY2FuIHJ1biBmaW5hbGl6ZUNyb3dkc2FsZSgpIHByb3Blcmx5Lg0KICAgKg0KICAgKiBUaGlzIGlzIGEgc2FmZXR5IGNoZWNrIGZ1bmN0aW9uIHRoYXQgZG9lc24ndCBhbGxvdyBjcm93ZHNhbGUgdG8gYmVnaW4NCiAgICogdW5sZXNzIHRoZSBmaW5hbGl6ZXIgaGFzIGJlZW4gc2V0IHVwIHByb3Blcmx5Lg0KICAgKi8NCiAgZnVuY3Rpb24gaXNTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOw0KDQogIC8qKiBDYWxsZWQgb25jZSBieSBjcm93ZHNhbGUgZmluYWxpemUoKSBpZiB0aGUgc2FsZSB3YXMgc3VjY2Vzcy4gKi8NCiAgZnVuY3Rpb24gZmluYWxpemVDcm93ZHNhbGUoKTsNCg0KfQ0KDQoNCg0KDQovKg0KICogRVJDMjAgaW50ZXJmYWNlDQogKiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQogKi8NCmNvbnRyYWN0IEVSQzIwIHsNCiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7DQogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOw0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOw0KICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7DQp9DQoNCg0KLyoqDQogKiBBIHRva2VuIHRoYXQgZGVmaW5lcyBmcmFjdGlvbmFsIHVuaXRzIGFzIGRlY2ltYWxzLg0KICovDQpjb250cmFjdCBGcmFjdGlvbmFsRVJDMjAgaXMgRVJDMjAgew0KDQogIHVpbnQgcHVibGljIGRlY2ltYWxzOw0KDQp9DQoNCg0KDQovKioNCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLg0KICoNCiAqIEhhbmRsZQ0KICogLSBzdGFydCBhbmQgZW5kIGRhdGVzDQogKiAtIGFjY2VwdGluZyBpbnZlc3RtZW50cw0KICogLSBtaW5pbXVtIGZ1bmRpbmcgZ29hbCBhbmQgcmVmdW5kDQogKiAtIHZhcmlvdXMgc3RhdGlzdGljcyBkdXJpbmcgdGhlIGNyb3dkZnVuZA0KICogLSBkaWZmZXJlbnQgcHJpY2luZyBzdHJhdGVnaWVzDQogKiAtIGRpZmZlcmVudCBpbnZlc3RtZW50IHBvbGljaWVzIChyZXF1aXJlIHNlcnZlciBzaWRlIGN1c3RvbWVyIGlkLCBhbGxvdyBvbmx5IHdoaXRlbGlzdGVkIGFkZHJlc3NlcykNCiAqDQogKi8NCmNvbnRyYWN0IENyb3dkc2FsZSBpcyBIYWx0YWJsZSB7DQoNCiAgLyogTWF4IGludmVzdG1lbnQgY291bnQgd2hlbiB3ZSBhcmUgc3RpbGwgYWxsb3dlZCB0byBjaGFuZ2UgdGhlIG11bHRpc2lnIGFkZHJlc3MgKi8NCiAgdWludCBwdWJsaWMgTUFYX0lOVkVTVE1FTlRTX0JFRk9SRV9NVUxUSVNJR19DSEFOR0UgPSA1Ow0KDQogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50Ow0KDQogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLw0KICBGcmFjdGlvbmFsRVJDMjAgcHVibGljIHRva2VuOw0KDQogIC8qIEhvdyB3ZSBhcmUgZ29pbmcgdG8gcHJpY2Ugb3VyIG9mZmVyaW5nICovDQogIFByaWNpbmdTdHJhdGVneSBwdWJsaWMgcHJpY2luZ1N0cmF0ZWd5Ow0KDQogIC8qIFBvc3Qtc3VjY2VzcyBjYWxsYmFjayAqLw0KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50Ow0KDQogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8NCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7DQoNCiAgLyogaWYgdGhlIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZCwgaW52ZXN0b3JzIG1heSB3aXRoZHJhdyB0aGVpciBmdW5kcyAqLw0KICB1aW50IHB1YmxpYyBtaW5pbXVtRnVuZGluZ0dvYWw7DQoNCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLw0KICB1aW50IHB1YmxpYyBzdGFydHNBdDsNCg0KICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLw0KICB1aW50IHB1YmxpYyBlbmRzQXQ7DQoNCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovDQogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOw0KDQogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovDQogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7DQoNCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8NCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7DQoNCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLw0KICB1aW50IHB1YmxpYyBsb2FkZWRSZWZ1bmQgPSAwOw0KDQogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIGdpdmVuIGJhY2sgdG8gaW52ZXN0b3JzLiovDQogIHVpbnQgcHVibGljIHdlaVJlZnVuZGVkID0gMDsNCg0KICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8NCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOw0KDQogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8NCiAgYm9vbCBwdWJsaWMgcmVxdWlyZUN1c3RvbWVySWQ7DQoNCiAgLyoqDQogICAgKiBEbyB3ZSB2ZXJpZnkgdGhhdCBjb250cmlidXRvciBoYXMgYmVlbiBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSAoYWNjcmVkaXRlZCBpbnZlc3RvcnMgb25seSkuDQogICAgKiBUaGlzIG1ldGhvZCB3YXMgZmlyc3QgdXNlZCBpbiBGaXJzdEJsb29kIGNyb3dkc2FsZSB0byBlbnN1cmUgYWxsIGNvbnRyaWJ1dG9ycyBoYXZlIGFjY2VwdGVkIHRlcm1zIG9uIHNhbGUgKG9uIHRoZSB3ZWIpLg0KICAgICovDQogIGJvb2wgcHVibGljIHJlcXVpcmVkU2lnbmVkQWRkcmVzczsNCg0KICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8NCiAgYWRkcmVzcyBwdWJsaWMgc2lnbmVyQWRkcmVzczsNCg0KICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaW52ZXN0ZWRBbW91bnRPZjsNCg0KICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2VuQW1vdW50T2Y7DQoNCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNhbCBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdDsNCg0KICAvKiogVGhpcyBpcyBmb3IgbWFudWwgdGVzdGluZyBmb3IgdGhlIGludGVyYWN0aW9uIGZyb20gb3duZXIgd2FsbGV0LiBZb3UgY2FuIHNldCBpdCB0byBhbnkgdmFsdWUgYW5kIGluc3BlY3QgdGhpcyBpbiBibG9ja2NoYWluIGV4cGxvcmVyIHRvIHNlZSB0aGF0IGNyb3dkc2FsZSBpbnRlcmFjdGlvbiB3b3Jrcy4gKi8NCiAgdWludCBwdWJsaWMgb3duZXJUZXN0VmFsdWU7DQoNCiAgLyoqIFN0YXRlIG1hY2hpbmUNCiAgICoNCiAgICogLSBQcmVwYXJpbmc6IEFsbCBjb250cmFjdCBpbml0aWFsaXphdGlvbiBjYWxscyBhbmQgdmFyaWFibGVzIGhhdmUgbm90IGJlZW4gc2V0IHlldA0KICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHBhc3NlZCBzdGFydCB0aW1lIHlldA0KICAgKiAtIEZ1bmRpbmc6IEFjdGl2ZSBjcm93ZHNhbGUNCiAgICogLSBTdWNjZXNzOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCByZWFjaGVkDQogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lDQogICAqIC0gRmluYWxpemVkOiBUaGUgZmluYWxpemVkIGhhcyBiZWVuIGNhbGxlZCBhbmQgc3VjY2VzZnVsbHkgZXhlY3V0ZWQNCiAgICogLSBSZWZ1bmRpbmc6IFJlZnVuZHMgYXJlIGxvYWRlZCBvbiB0aGUgY29udHJhY3QgZm9yIHJlY2xhaW0uDQogICAqLw0KICBlbnVtIFN0YXRle1Vua25vd24sIFByZXBhcmluZywgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmFpbHVyZSwgRmluYWxpemVkLCBSZWZ1bmRpbmd9DQoNCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQ0KICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludDEyOCBjdXN0b21lcklkKTsNCg0KICAvLyBSZWZ1bmQgd2FzIHByb2Nlc3NlZCBmb3IgYSBjb250cmlidXRvcg0KICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOw0KDQogIC8vIFRoZSBydWxlcyB3ZXJlIGNoYW5nZWQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdA0KICBldmVudCBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChib29sIHJlcXVpcmVDdXN0b21lcklkLCBib29sIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgYWRkcmVzcyBzaWduZXJBZGRyZXNzKTsNCg0KICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkDQogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpOw0KDQogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkDQogIGV2ZW50IEVuZHNBdENoYW5nZWQodWludCBlbmRzQXQpOw0KDQogIGZ1bmN0aW9uIENyb3dkc2FsZShhZGRyZXNzIF90b2tlbiwgUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3ksIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCB1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF9taW5pbXVtRnVuZGluZ0dvYWwpIHsNCg0KICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCg0KICAgIHRva2VuID0gRnJhY3Rpb25hbEVSQzIwKF90b2tlbik7DQoNCiAgICBzZXRQcmljaW5nU3RyYXRlZ3koX3ByaWNpbmdTdHJhdGVneSk7DQoNCiAgICBtdWx0aXNpZ1dhbGxldCA9IF9tdWx0aXNpZ1dhbGxldDsNCiAgICBpZihtdWx0aXNpZ1dhbGxldCA9PSAwKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGlmKF9zdGFydCA9PSAwKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIHN0YXJ0c0F0ID0gX3N0YXJ0Ow0KDQogICAgaWYoX2VuZCA9PSAwKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGVuZHNBdCA9IF9lbmQ7DQoNCiAgICAvLyBEb24ndCBtZXNzIHRoZSBkYXRlcw0KICAgIGlmKHN0YXJ0c0F0ID49IGVuZHNBdCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBjYW4gYmUgemVybw0KICAgIG1pbmltdW1GdW5kaW5nR29hbCA9IF9taW5pbXVtRnVuZGluZ0dvYWw7DQogIH0NCg0KICAvKioNCiAgICogRG9uJ3QgZXhwZWN0IHRvIGp1c3Qgc2VuZCBpbiBtb25leSBhbmQgZ2V0IHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uKCkgcGF5YWJsZSB7DQogICAgdGhyb3c7DQogIH0NCg0KICAvKioNCiAgICogTWFrZSBhbiBpbnZlc3RtZW50Lg0KICAgKg0KICAgKiBDcm93ZHNhbGUgbXVzdCBiZSBydW5uaW5nIGZvciBvbmUgdG8gaW52ZXN0Lg0KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4NCiAgICoNCiAgICogQHBhcmFtIHJlY2VpdmVyIFRoZSBFdGhlcmV1bSBhZGRyZXNzIHdobyByZWNlaXZlcyB0aGUgdG9rZW5zDQogICAqIEBwYXJhbSBjdXN0b21lcklkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUNCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgc3RvcEluRW1lcmdlbmN5IHByaXZhdGUgew0KDQogICAgLy8gRGV0ZXJtaW5lIGlmIGl0J3MgYSBnb29kIHRpbWUgdG8gYWNjZXB0IGludmVzdG1lbnQgZnJvbSB0aGlzIHBhcnRpY2lwYW50DQogICAgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5QcmVGdW5kaW5nKSB7DQogICAgICAvLyBBcmUgd2Ugd2hpdGVsaXN0ZWQgZm9yIGVhcmx5IGRlcG9zaXQNCiAgICAgIGlmKCFlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W3JlY2VpdmVyXSkgew0KICAgICAgICB0aHJvdzsNCiAgICAgIH0NCiAgICB9IGVsc2UgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5GdW5kaW5nKSB7DQogICAgICAvLyBSZXRhaWwgcGFydGljaXBhbnRzIGNhbiBvbmx5IGNvbWUgaW4gd2hlbiB0aGUgY3Jvd2RzYWxlIGlzIHJ1bm5pbmcNCiAgICAgIC8vIHBhc3MNCiAgICB9IGVsc2Ugew0KICAgICAgLy8gVW53YW50ZWQgc3RhdGUNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIHVpbnQgd2VpQW1vdW50ID0gbXNnLnZhbHVlOw0KICAgIHVpbnQgdG9rZW5BbW91bnQgPSBwcmljaW5nU3RyYXRlZ3kuY2FsY3VsYXRlUHJpY2Uod2VpQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQsIG1zZy5zZW5kZXIsIHRva2VuLmRlY2ltYWxzKCkpOw0KDQogICAgaWYodG9rZW5BbW91bnQgPT0gMCkgew0KICAgICAgLy8gRHVzdCB0cmFuc2FjdGlvbg0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgew0KICAgICAgIC8vIEEgbmV3IGludmVzdG9yDQogICAgICAgaW52ZXN0b3JDb3VudCsrOw0KICAgIH0NCg0KICAgIC8vIFVwZGF0ZSBpbnZlc3Rvcg0KICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOw0KICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0ucGx1cyh0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBVcGRhdGUgdG90YWxzDQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsNCiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5wbHVzKHRva2VuQW1vdW50KTsNCg0KICAgIC8vIENoZWNrIHRoYXQgd2UgZGlkIG5vdCBidXN0IHRoZSBjYXANCiAgICBpZihpc0JyZWFraW5nQ2FwKHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIHdlaVJhaXNlZCwgdG9rZW5zU29sZCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOw0KDQogICAgLy8gUG9ja2V0IHRoZSBtb25leQ0KICAgIGlmKCFtdWx0aXNpZ1dhbGxldC5zZW5kKHdlaUFtb3VudCkpIHRocm93Ow0KDQogICAgLy8gVGVsbCB1cyBpbnZlc3Qgd2FzIHN1Y2Nlc3MNCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7DQogIH0NCg0KICAvKioNCiAgICogUHJlYWxsb2NhdGUgdG9rZW5zIGZvciB0aGUgZWFybHkgaW52ZXN0b3JzLg0KICAgKg0KICAgKiBQcmVhbGxvY2F0ZWQgdG9rZW5zIGhhdmUgYmVlbiBzb2xkIGJlZm9yZSB0aGUgYWN0dWFsIGNyb3dkc2FsZSBvcGVucy4NCiAgICogVGhpcyBmdW5jdGlvbiBtaW50cyB0aGUgdG9rZW5zIGFuZCBtb3ZlcyB0aGUgY3Jvd2RzYWxlIG5lZWRsZS4NCiAgICoNCiAgICogSW52ZXN0b3IgY291bnQgaXMgbm90IGhhbmRsZWQ7IGl0IGlzIGFzc3VtZWQgdGhpcyBnb2VzIGZvciBtdWx0aXBsZSBpbnZlc3RvcnMNCiAgICogYW5kIHRoZSB0b2tlbiBkaXN0cmlidXRpb24gaGFwcGVucyBvdXRzaWRlIHRoZSBzbWFydCBjb250cmFjdCBmbG93Lg0KICAgKg0KICAgKiBObyBtb25leSBpcyBleGNoYW5nZWQsIGFzIHRoZSBjcm93ZHNhbGUgdGVhbSBhbHJlYWR5IGhhdmUgcmVjZWl2ZWQgdGhlIHBheW1lbnQuDQogICAqDQogICAqIEBwYXJhbSBmdWxsVG9rZW5zIHRva2VucyBhcyBmdWxsIHRva2VucyAtIGRlY2ltYWwgcGxhY2VzIGFkZGVkIGludGVybmFsbHkNCiAgICogQHBhcmFtIHdlaVByaWNlIFByaWNlIG9mIGEgc2luZ2xlIGZ1bGwgdG9rZW4gaW4gd2VpDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBwcmVhbGxvY2F0ZShhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGZ1bGxUb2tlbnMsIHVpbnQgd2VpUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgew0KDQogICAgdWludCB0b2tlbkFtb3VudCA9IGZ1bGxUb2tlbnMgKiAxMCoqdG9rZW4uZGVjaW1hbHMoKTsNCiAgICB1aW50IHdlaUFtb3VudCA9IHdlaVByaWNlICogZnVsbFRva2VuczsgLy8gVGhpcyBjYW4gYmUgYWxzbyAwLCB3ZSBnaXZlIG91dCB0b2tlbnMgZm9yIGZyZWUNCg0KICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5wbHVzKHdlaUFtb3VudCk7DQogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7DQoNCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXMod2VpQW1vdW50KTsNCiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOw0KDQogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2Vzcw0KICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50LCAwKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4NCiAgICovDQogIGZ1bmN0aW9uIGludmVzdFdpdGhTaWduZWRBZGRyZXNzKGFkZHJlc3MgYWRkciwgdWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgew0KICAgICBieXRlczMyIGhhc2ggPSBzaGEyNTYoYWRkcik7DQogICAgIGlmIChlY3JlY292ZXIoaGFzaCwgdiwgciwgcykgIT0gc2lnbmVyQWRkcmVzcykgdGhyb3c7DQogICAgIGlmKGN1c3RvbWVySWQgPT0gMCkgdGhyb3c7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrDQogICAgIGludmVzdEludGVybmFsKGFkZHIsIGN1c3RvbWVySWQpOw0KICB9DQoNCiAgLyoqDQogICAqIFRyYWNrIHdobyBpcyB0aGUgY3VzdG9tZXIgbWFraW5nIHRoZSBwYXltZW50IHNvIHdlIGNhbiBzZW5kIHRoYW5rIHlvdSBlbWFpbC4NCiAgICovDQogIGZ1bmN0aW9uIGludmVzdFdpdGhDdXN0b21lcklkKGFkZHJlc3MgYWRkciwgdWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaWYocmVxdWlyZWRTaWduZWRBZGRyZXNzKSB0aHJvdzsgLy8gQ3Jvd2RzYWxlIGFsbG93cyBvbmx5IHNlcnZlci1zaWRlIHNpZ25lZCBwYXJ0aWNpcGFudHMNCiAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjaw0KICAgIGludmVzdEludGVybmFsKGFkZHIsIGN1c3RvbWVySWQpOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGFub255bW91cyBjb250cmlidXRpb25zIHRvIHRoaXMgY3Jvd2RzYWxlLg0KICAgKi8NCiAgZnVuY3Rpb24gaW52ZXN0KGFkZHJlc3MgYWRkcikgcHVibGljIHBheWFibGUgew0KICAgIGlmKHJlcXVpcmVDdXN0b21lcklkKSB0aHJvdzsgLy8gQ3Jvd2RzYWxlIG5lZWRzIHRvIHRyYWNrIHBhcnRpcGFudHMgZm9yIHRoYW5rIHlvdSBlbWFpbA0KICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzDQogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgMCk7DQogIH0NCg0KICAvKioNCiAgICogSW52ZXN0IHRvIHRva2VucywgcmVjb2duaXplIHRoZSBwYXllciBhbmQgY2xlYXIgaGlzIGFkZHJlc3MuDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBidXlXaXRoU2lnbmVkQWRkcmVzcyh1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaW52ZXN0V2l0aFNpZ25lZEFkZHJlc3MobXNnLnNlbmRlciwgY3VzdG9tZXJJZCwgdiwgciwgcyk7DQogIH0NCg0KICAvKioNCiAgICogSW52ZXN0IHRvIHRva2VucywgcmVjb2duaXplIHRoZSBwYXllci4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIGJ1eVdpdGhDdXN0b21lcklkKHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgew0KICAgIGludmVzdFdpdGhDdXN0b21lcklkKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQpOw0KICB9DQoNCiAgLyoqDQogICAqIFRoZSBiYXNpYyBlbnRyeSBwb2ludCB0byBwYXJ0aWNpcGF0ZSB0aGUgY3Jvd2RzYWxlIHByb2Nlc3MuDQogICAqDQogICAqIFBheSBmb3IgZnVuZGluZywgZ2V0IGludmVzdGVkIHRva2VucyBiYWNrIGluIHRoZSBzZW5kZXIgYWRkcmVzcy4NCiAgICovDQogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpbnZlc3QobXNnLnNlbmRlcik7DQogIH0NCg0KICAvKioNCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4NCiAgICoNCiAgICogVGhlIG93bmVyIGNhbiB0cmlnZ3JlIGEgY2FsbCB0aGUgY29udHJhY3QgdGhhdCBwcm92aWRlcyBwb3N0LWNyb3dkc2FsZSBhY3Rpb25zLCBsaWtlIHJlbGVhc2luZyB0aGUgdG9rZW5zLg0KICAgKi8NCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsNCg0KICAgIC8vIEFscmVhZHkgZmluYWxpemVkDQogICAgaWYoZmluYWxpemVkKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyBGaW5hbGl6aW5nIGlzIG9wdGlvbmFsLiBXZSBvbmx5IGNhbGwgaXQgaWYgd2UgYXJlIGdpdmVuIGEgZmluYWxpemluZyBhZ2VudC4NCiAgICBpZihhZGRyZXNzKGZpbmFsaXplQWdlbnQpICE9IDApIHsNCiAgICAgIGZpbmFsaXplQWdlbnQuZmluYWxpemVDcm93ZHNhbGUoKTsNCiAgICB9DQoNCiAgICBmaW5hbGl6ZWQgPSB0cnVlOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IHRvIChyZSlzZXQgZmluYWxpemUgYWdlbnQuDQogICAqDQogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiBzZXR0aW5nIHRoaXMsIHNvIHRoYXQgd2UgY2FuIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0RmluYWxpemVBZ2VudChGaW5hbGl6ZUFnZW50IGFkZHIpIG9ubHlPd25lciB7DQogICAgZmluYWxpemVBZ2VudCA9IGFkZHI7DQoNCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudA0KICAgIGlmKCFmaW5hbGl6ZUFnZW50LmlzRmluYWxpemVBZ2VudCgpKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogIH0NCg0KICAvKioNCiAgICogU2V0IHBvbGljeSBkbyB3ZSBuZWVkIHRvIGhhdmUgc2VydmVyLXNpZGUgY3VzdG9tZXIgaWRzIGZvciB0aGUgaW52ZXN0bWVudHMuDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBzZXRSZXF1aXJlQ3VzdG9tZXJJZChib29sIHZhbHVlKSBvbmx5T3duZXIgew0KICAgIHJlcXVpcmVDdXN0b21lcklkID0gdmFsdWU7DQogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7DQogIH0NCg0KICAvKioNCiAgICogU2V0IHBvbGljeSBpZiBhbGwgaW52ZXN0b3JzIG11c3QgYmUgY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgZmlyc3QuDQogICAqDQogICAqIFRoaXMgaXMgZS5nLiBmb3IgdGhlIGFjY3JlZGl0ZWQgaW52ZXN0b3IgY2xlYXJpbmcuDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBzZXRSZXF1aXJlU2lnbmVkQWRkcmVzcyhib29sIHZhbHVlLCBhZGRyZXNzIF9zaWduZXJBZGRyZXNzKSBvbmx5T3duZXIgew0KICAgIHJlcXVpcmVkU2lnbmVkQWRkcmVzcyA9IHZhbHVlOw0KICAgIHNpZ25lckFkZHJlc3MgPSBfc2lnbmVyQWRkcmVzczsNCiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4NCiAgICoNCiAgICogVE9ETzogRml4IHNwZWxsaW5nIGVycm9yIGluIHRoZSBuYW1lDQogICAqLw0KICBmdW5jdGlvbiBzZXRFYXJseVBhcmljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cykgb25seU93bmVyIHsNCiAgICBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdID0gc3RhdHVzOw0KICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgY3Jvd2RzYWxlIG93bmVyIHRvIGNsb3NlIGVhcmx5IG9yIGV4dGVuZCB0aGUgY3Jvd2RzYWxlLg0KICAgKg0KICAgKiBUaGlzIGlzIHVzZWZ1bCBlLmcuIGZvciBhIG1hbnVhbCBzb2Z0IGNhcCBpbXBsZW1lbnRhdGlvbjoNCiAgICogLSBhZnRlciBYIGFtb3VudCBpcyByZWFjaGVkIGRldGVybWluZSBtYW51YWwgY2xvc2luZw0KICAgKg0KICAgKiBUaGlzIG1heSBwdXQgdGhlIGNyb3dkc2FsZSB0byBhbiBpbnZhbGlkIHN0YXRlLA0KICAgKiBidXQgd2UgdHJ1c3Qgb3duZXJzIGtub3cgd2hhdCB0aGV5IGFyZSBkb2luZy4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIHNldEVuZHNBdCh1aW50IHRpbWUpIG9ubHlPd25lciB7DQoNCiAgICBpZihub3cgPiB0aW1lKSB7DQogICAgICB0aHJvdzsgLy8gRG9uJ3QgY2hhbmdlIHBhc3QNCiAgICB9DQoNCiAgICBlbmRzQXQgPSB0aW1lOw0KICAgIEVuZHNBdENoYW5nZWQoZW5kc0F0KTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuDQogICAqDQogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiB0aGUgc2V0LCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4NCiAgICovDQogIGZ1bmN0aW9uIHNldFByaWNpbmdTdHJhdGVneShQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSkgb25seU93bmVyIHsNCiAgICBwcmljaW5nU3RyYXRlZ3kgPSBfcHJpY2luZ1N0cmF0ZWd5Ow0KDQogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQNCiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byBjaGFuZ2UgdGhlIHRlYW0gbXVsdGlzaWcgYWRkcmVzcyBpbiB0aGUgY2FzZSBvZiBlbWVyZ2VuY3kuDQogICAqDQogICAqIFRoaXMgYWxsb3dzIHRvIHNhdmUgYSBkZXBsb3llZCBjcm93ZHNhbGUgd2FsbGV0IGluIHRoZSBjYXNlIHRoZSBjcm93ZHNhbGUgaGFzIG5vdCB5ZXQgYmVndW4NCiAgICogKHdlIGhhdmUgZG9uZSBvbmx5IGZldyB0ZXN0IHRyYW5zYWN0aW9ucykuIEFmdGVyIHRoZSBjcm93ZHNhbGUgaXMgZ29pbmcNCiAgICogdGhlbiBtdWx0aXNpZyBhZGRyZXNzIHN0YXlzIGxvY2tlZCBmb3IgdGhlIHNhZmV0eSByZWFzb25zLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0TXVsdGlzaWcoYWRkcmVzcyBhZGRyKSBwdWJsaWMgb25seU93bmVyIHsNCg0KICAgIC8vIENoYW5nZQ0KICAgIGlmKGludmVzdG9yQ291bnQgPiBNQVhfSU5WRVNUTUVOVFNfQkVGT1JFX01VTFRJU0lHX0NIQU5HRSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgbXVsdGlzaWdXYWxsZXQgPSBhZGRyOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGxvYWQgcmVmdW5kcyBiYWNrIG9uIHRoZSBjb250cmFjdCBmb3IgdGhlIHJlZnVuZGluZy4NCiAgICoNCiAgICogVGhlIHRlYW0gY2FuIHRyYW5zZmVyIHRoZSBmdW5kcyBiYWNrIG9uIHRoZSBzbWFydCBjb250cmFjdCBpbiB0aGUgY2FzZSB0aGUgbWluaW11bSBnb2FsIHdhcyBub3QgcmVhY2hlZC4uDQogICAqLw0KICBmdW5jdGlvbiBsb2FkUmVmdW5kKCkgcHVibGljIHBheWFibGUgaW5TdGF0ZShTdGF0ZS5GYWlsdXJlKSB7DQogICAgaWYobXNnLnZhbHVlID09IDApIHRocm93Ow0KICAgIGxvYWRlZFJlZnVuZCA9IGxvYWRlZFJlZnVuZC5wbHVzKG1zZy52YWx1ZSk7DQogIH0NCg0KICAvKioNCiAgICogSW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmQuDQogICAqDQogICAqIE5vdGUgdGhhdCBhbnkgcmVmdW5kcyBmcm9tIHByb3h5IGJ1eWVycyBzaG91bGQgYmUgaGFuZGxlZCBzZXBhcmF0ZWx5LA0KICAgKiBhbmQgbm90IHRocm91Z2ggdGhpcyBjb250cmFjdC4NCiAgICovDQogIGZ1bmN0aW9uIHJlZnVuZCgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlJlZnVuZGluZykgew0KICAgIHVpbnQyNTYgd2VpVmFsdWUgPSBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdOw0KICAgIGlmICh3ZWlWYWx1ZSA9PSAwKSB0aHJvdzsNCiAgICBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdID0gMDsNCiAgICB3ZWlSZWZ1bmRlZCA9IHdlaVJlZnVuZGVkLnBsdXMod2VpVmFsdWUpOw0KICAgIFJlZnVuZChtc2cuc2VuZGVyLCB3ZWlWYWx1ZSk7DQogICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQod2VpVmFsdWUpKSB0aHJvdzsNCiAgfQ0KDQogIC8qKg0KICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNyb3dkc2FsZSBoYXMgcmFpc2VkIGVub3VnaCBtb25leSB0byBiZSBhIHN1Y2Nlc3NmdWwuDQogICAqLw0KICBmdW5jdGlvbiBpc01pbmltdW1Hb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHJlYWNoZWQpIHsNCiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbmltdW1GdW5kaW5nR29hbDsNCiAgfQ0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuDQogICAqLw0KICBmdW5jdGlvbiBpc0ZpbmFsaXplclNhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzYW5lKSB7DQogICAgcmV0dXJuIGZpbmFsaXplQWdlbnQuaXNTYW5lKCk7DQogIH0NCg0KICAvKioNCiAgICogQ2hlY2sgaWYgdGhlIGNvbnRyYWN0IHJlbGF0aW9uc2hpcCBsb29rcyBnb29kLg0KICAgKi8NCiAgZnVuY3Rpb24gaXNQcmljaW5nU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsNCiAgICByZXR1cm4gcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50Lg0KICAgKg0KICAgKiBXZSBtYWtlIGl0IGEgZnVuY3Rpb24gYW5kIGRvIG5vdCBhc3NpZ24gdGhlIHJlc3VsdCB0byBhIHZhcmlhYmxlLCBzbyB0aGVyZSBpcyBubyBjaGFuY2Ugb2YgdGhlIHZhcmlhYmxlIGJlaW5nIHN0YWxlLg0KICAgKi8NCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoU3RhdGUpIHsNCiAgICBpZihmaW5hbGl6ZWQpIHJldHVybiBTdGF0ZS5GaW5hbGl6ZWQ7DQogICAgZWxzZSBpZiAoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSA9PSAwKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOw0KICAgIGVsc2UgaWYgKCFmaW5hbGl6ZUFnZW50LmlzU2FuZSgpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOw0KICAgIGVsc2UgaWYgKCFwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOw0KICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsNCiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPD0gZW5kc0F0ICYmICFpc0Nyb3dkc2FsZUZ1bGwoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7DQogICAgZWxzZSBpZiAoaXNNaW5pbXVtR29hbFJlYWNoZWQoKSkgcmV0dXJuIFN0YXRlLlN1Y2Nlc3M7DQogICAgZWxzZSBpZiAoIWlzTWluaW11bUdvYWxSZWFjaGVkKCkgJiYgd2VpUmFpc2VkID4gMCAmJiBsb2FkZWRSZWZ1bmQgPj0gd2VpUmFpc2VkKSByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOw0KICAgIGVsc2UgcmV0dXJuIFN0YXRlLkZhaWx1cmU7DQogIH0NCg0KICAvKiogVGhpcyBpcyBmb3IgbWFudWFsIHRlc3Rpbmcgb2YgbXVsdGlzaWcgd2FsbGV0IGludGVyYWN0aW9uICovDQogIGZ1bmN0aW9uIHNldE93bmVyVGVzdFZhbHVlKHVpbnQgdmFsKSBvbmx5T3duZXIgew0KICAgIG93bmVyVGVzdFZhbHVlID0gdmFsOw0KICB9DQoNCiAgLyoqIEludGVyZmFjZSBtYXJrZXIuICovDQogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8vDQogIC8vIE1vZGlmaWVycw0KICAvLw0KDQogIC8qKiBNb2RpZmllZCBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8NCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgew0KICAgIGlmKGdldFN0YXRlKCkgIT0gc3RhdGUpIHRocm93Ow0KICAgIF87DQogIH0NCg0KDQogIC8vDQogIC8vIEFic3RyYWN0IGZ1bmN0aW9ucw0KICAvLw0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBpbnZlc3RlZCBicmVha3Mgb3VyIGNhcCBydWxlcy4NCiAgICoNCiAgICoNCiAgICogVGhlIGNoaWxkIGNvbnRyYWN0IG11c3QgZGVmaW5lIHRoZWlyIG93biBjYXAgc2V0dGluZyBydWxlcy4NCiAgICogV2UgYWxsb3cgYSBsb3Qgb2YgZmxleGliaWxpdHkgdGhyb3VnaCBkaWZmZXJlbnQgY2FwcGluZyBzdHJhdGVnaWVzIChFVEgsIHRva2VuIGNvdW50KQ0KICAgKiBDYWxsZWQgZnJvbSBpbnZlc3QoKS4NCiAgICoNCiAgICogQHBhcmFtIHdlaUFtb3VudCBUaGUgYW1vdW50IG9mIHdlaSB0aGUgaW52ZXN0b3IgdHJpZXMgdG8gaW52ZXN0IGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB3ZSB0cnkgdG8gZ2l2ZSB0byB0aGUgaW52ZXN0b3IgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHdlaVJhaXNlZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHJhaXNlZCBiYWxhbmNlIGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHRva2Vuc1NvbGRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCBzb2xkIHRva2VucyBjb3VudCBhZnRlciB0aGlzIHRyYW5zYWN0aW9uDQogICAqDQogICAqIEByZXR1cm4gdHJ1ZSBpZiB0YWtpbmcgdGhpcyBpbnZlc3RtZW50IHdvdWxkIGJyZWFrIG91ciBjYXAgcnVsZXMNCiAgICovDQogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpUmFpc2VkVG90YWwsIHVpbnQgdG9rZW5zU29sZFRvdGFsKSBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKTsNCg0KICAvKioNCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIGZ1bGwgYW5kIHdlIGNhbiBubyBsb25nZXIgc2VsbCBhbnkgdG9rZW5zLg0KICAgKi8NCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGVGdWxsKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOw0KDQogIC8qKg0KICAgKiBDcmVhdGUgbmV3IHRva2VucyBvciB0cmFuc2ZlciBpc3N1ZWQgdG9rZW5zIHRvIHRoZSBpbnZlc3RvciBkZXBlbmRpbmcgb24gdGhlIGNhcCBtb2RlbC4NCiAgICovDQogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBwcml2YXRlOw0KfQ0KDQoNCg0KDQovLy8gQGRldiBUcmFuY2hlIGJhc2VkIHByaWNpbmcgd2l0aCBzcGVjaWFsIHN1cHBvcnQgZm9yIHByZS1pY28gZGVhbHMuDQovLy8gICAgICBJbXBsZW1lbnRpbmcgImZpcnN0IHByaWNlIiB0cmFuY2hlcywgbWVhbmluZywgdGhhdCBpZiBieWVycyBvcmRlciBpcw0KLy8vICAgICAgY292ZXJpbmcgbW9yZSB0aGFuIG9uZSB0cmFuY2hlLCB0aGUgcHJpY2Ugb2YgdGhlIGxvd2VzdCB0cmFuY2hlIHdpbGwgYXBwbHkNCi8vLyAgICAgIHRvIHRoZSB3aG9sZSBvcmRlci4NCmNvbnRyYWN0IEV0aFRyYW5jaGVQcmljaW5nIGlzIFByaWNpbmdTdHJhdGVneSwgT3duYWJsZSB7DQoNCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7DQoNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgTUFYX1RSQU5DSEVTID0gMTA7DQoNCiAgLy8gVGhpcyBjb250YWlucyBhbGwgcHJlLUlDTyBhZGRyZXNzZXMsIGFuZCB0aGVpciBwcmljZXMgKHdlaXMgcGVyIHRva2VuKQ0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBwcmVpY29BZGRyZXNzZXM7DQoNCiAgLyoqDQogICogRGVmaW5lIHByaWNpbmcgc2NoZWR1bGUgdXNpbmcgdHJhbmNoZXMuDQogICovDQogIHN0cnVjdCBUcmFuY2hlIHsNCg0KICAgICAgLy8gQW1vdW50IGluIHdlaXMgd2hlbiB0aGlzIHRyYW5jaGUgYmVjb21lcyBhY3RpdmUNCiAgICAgIHVpbnQgYW1vdW50Ow0KDQogICAgICAvLyBIb3cgbWFueSB0b2tlbnMgcGVyIHNhdG9zaGkgeW91IHdpbGwgZ2V0IHdoaWxlIHRoaXMgdHJhbmNoZSBpcyBhY3RpdmUNCiAgICAgIHVpbnQgcHJpY2U7DQogIH0NCg0KICAvLyBTdG9yZSB0cmFuY2hlcyBpbiBhIGZpeGVkIGFycmF5LCBzbyB0aGF0IGl0IGNhbiBiZSBzZWVuIGluIGEgYmxvY2tjaGFpbiBleHBsb3Jlcg0KICAvLyBUcmFuY2hlIDAgaXMgYWx3YXlzICgwLCAwKQ0KICAvLyAoVE9ETzogY2hhbmdlIHRoaXMgd2hlbiB3ZSBjb25maXJtIGR5bmFtaWMgYXJyYXlzIGFyZSBleHBsb3JhYmxlKQ0KICBUcmFuY2hlWzEwXSBwdWJsaWMgdHJhbmNoZXM7DQoNCiAgLy8gSG93IG1hbnkgYWN0aXZlIHRyYW5jaGVzIHdlIGhhdmUNCiAgdWludCBwdWJsaWMgdHJhbmNoZUNvdW50Ow0KDQogIC8vLyBAZGV2IENvbnRydWN0aW9uLCBjcmVhdGluZyBhIGxpc3Qgb2YgdHJhbmNoZXMNCiAgLy8vIEBwYXJhbSBfdHJhbmNoZXMgdWludFtdIHRyYW5jaGVzIFBhaXJzIG9mIChzdGFydCBhbW91bnQsIHByaWNlKQ0KICBmdW5jdGlvbiBFdGhUcmFuY2hlUHJpY2luZyh1aW50W10gX3RyYW5jaGVzKSB7DQogICAgLy8gTmVlZCB0byBoYXZlIHR1cGxlcywgbGVuZ3RoIGNoZWNrDQogICAgaWYoX3RyYW5jaGVzLmxlbmd0aCAlIDIgPT0gMSB8fCBfdHJhbmNoZXMubGVuZ3RoID49IE1BWF9UUkFOQ0hFUyoyKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICB0cmFuY2hlQ291bnQgPSBfdHJhbmNoZXMubGVuZ3RoIC8gMjsNCg0KICAgIHVpbnQgaGlnaGVzdEFtb3VudCA9IDA7DQoNCiAgICBmb3IodWludCBpPTA7IGk8X3RyYW5jaGVzLmxlbmd0aC8yOyBpKyspIHsNCiAgICAgIHRyYW5jaGVzW2ldLmFtb3VudCA9IF90cmFuY2hlc1tpKjJdOw0KICAgICAgdHJhbmNoZXNbaV0ucHJpY2UgPSBfdHJhbmNoZXNbaSoyKzFdOw0KDQogICAgICAvLyBObyBpbnZhbGlkIHN0ZXBzDQogICAgICBpZigoaGlnaGVzdEFtb3VudCAhPSAwKSAmJiAodHJhbmNoZXNbaV0uYW1vdW50IDw9IGhpZ2hlc3RBbW91bnQpKSB7DQogICAgICAgIHRocm93Ow0KICAgICAgfQ0KDQogICAgICBoaWdoZXN0QW1vdW50ID0gdHJhbmNoZXNbaV0uYW1vdW50Ow0KICAgIH0NCg0KICAgIC8vIFdlIG5lZWQgdG8gc3RhcnQgZnJvbSB6ZXJvLCBvdGhlcndpc2Ugd2UgYmxvdyB1cCBvdXIgZGVwbG95bWVudA0KICAgIGlmKHRyYW5jaGVzWzBdLmFtb3VudCAhPSAwKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyBMYXN0IHRyYW5jaGUgcHJpY2UgbXVzdCBiZSB6ZXJvLCB0ZXJtaW5hdGluZyB0aGUgY3Jvd2RhbGUNCiAgICBpZih0cmFuY2hlc1t0cmFuY2hlQ291bnQtMV0ucHJpY2UgIT0gMCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQoNCiAgLy8vIEBkZXYgVGhpcyBpcyBpbnZva2VkIG9uY2UgZm9yIGV2ZXJ5IHByZS1JQ08gYWRkcmVzcywgc2V0IHByaWNlUGVyVG9rZW4NCiAgLy8vICAgICAgdG8gMCB0byBkaXNhYmxlDQogIC8vLyBAcGFyYW0gcHJlaWNvQWRkcmVzcyBQcmVzYWxlRnVuZENvbGxlY3RvciBhZGRyZXNzDQogIC8vLyBAcGFyYW0gcHJpY2VQZXJUb2tlbiBIb3cgbWFueSB3ZWlzIG9uZSB0b2tlbiBjb3N0IGZvciBwcmUtaWNvIGludmVzdG9ycw0KICBmdW5jdGlvbiBzZXRQcmVpY29BZGRyZXNzKGFkZHJlc3MgcHJlaWNvQWRkcmVzcywgdWludCBwcmljZVBlclRva2VuKQ0KICAgIHB1YmxpYw0KICAgIG9ubHlPd25lcg0KICB7DQogICAgcHJlaWNvQWRkcmVzc2VzW3ByZWljb0FkZHJlc3NdID0gcHJpY2VQZXJUb2tlbjsNCiAgfQ0KDQogIC8vLyBAZGV2IEl0ZXJhdGUgdGhyb3VnaCB0cmFuY2hlcy4gWW91IHJlYWNoIGVuZCBvZiB0cmFuY2hlcyB3aGVuIHByaWNlID0gMA0KICAvLy8gQHJldHVybiB0dXBsZSAodGltZSwgcHJpY2UpDQogIGZ1bmN0aW9uIGdldFRyYW5jaGUodWludCBuKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCwgdWludCkgew0KICAgIHJldHVybiAodHJhbmNoZXNbbl0uYW1vdW50LCB0cmFuY2hlc1tuXS5wcmljZSk7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRGaXJzdFRyYW5jaGUoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKFRyYW5jaGUpIHsNCiAgICByZXR1cm4gdHJhbmNoZXNbMF07DQogIH0NCg0KICBmdW5jdGlvbiBnZXRMYXN0VHJhbmNoZSgpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoVHJhbmNoZSkgew0KICAgIHJldHVybiB0cmFuY2hlc1t0cmFuY2hlQ291bnQtMV07DQogIH0NCg0KICBmdW5jdGlvbiBnZXRQcmljaW5nU3RhcnRzQXQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgIHJldHVybiBnZXRGaXJzdFRyYW5jaGUoKS5hbW91bnQ7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRQcmljaW5nRW5kc0F0KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICByZXR1cm4gZ2V0TGFzdFRyYW5jaGUoKS5hbW91bnQ7DQogIH0NCg0KICBmdW5jdGlvbiBpc1NhbmUoYWRkcmVzcyBfY3Jvd2RzYWxlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7DQogICAgLy8gT3VyIHRyYW5jaGVzIGFyZSBub3QgYm91bmQgYnkgdGltZSwgc28gd2UgY2FuJ3QgcmVhbGx5IGNoZWNrIGFyZSB3ZSBzYW5lDQogICAgLy8gc28gd2UgcHJlc3VtZSB3ZSBhcmUgOykNCiAgICAvLyBJbiB0aGUgZnV0dXJlIHdlIGNvdWxkIHNhdmUgYW5kIHRyYWNrIHJhaXNlZCB0b2tlbnMsIGFuZCBjb21wYXJlIGl0IHRvDQogICAgLy8gdGhlIENyb3dkc2FsZSBjb250cmFjdC4NCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8vLyBAZGV2IEdldCB0aGUgY3VycmVudCB0cmFuY2hlIG9yIGJhaWwgb3V0IGlmIHdlIGFyZSBub3QgaW4gdGhlIHRyYW5jaGUgcGVyaW9kcy4NCiAgLy8vIEBwYXJhbSB3ZWlSYWlzZWQgdG90YWwgYW1vdW50IG9mIHdlaXMgcmFpc2VkLCBmb3IgY2FsY3VsYXRpbmcgdGhlIGN1cnJlbnQgdHJhbmNoZQ0KICAvLy8gQHJldHVybiB7W3R5cGVdfSBbZGVzY3JpcHRpb25dDQogIGZ1bmN0aW9uIGdldEN1cnJlbnRUcmFuY2hlKHVpbnQgd2VpUmFpc2VkKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKFRyYW5jaGUpIHsNCiAgICB1aW50IGk7DQoNCiAgICBmb3IoaT0wOyBpIDwgdHJhbmNoZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgIGlmKHdlaVJhaXNlZCA8IHRyYW5jaGVzW2ldLmFtb3VudCkgew0KICAgICAgICByZXR1cm4gdHJhbmNoZXNbaS0xXTsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICAvLy8gQGRldiBHZXQgdGhlIGN1cnJlbnQgcHJpY2UuDQogIC8vLyBAcGFyYW0gd2VpUmFpc2VkIHRvdGFsIGFtb3VudCBvZiB3ZWlzIHJhaXNlZCwgZm9yIGNhbGN1bGF0aW5nIHRoZSBjdXJyZW50IHRyYW5jaGUNCiAgLy8vIEByZXR1cm4gVGhlIGN1cnJlbnQgcHJpY2Ugb3IgMCBpZiB3ZSBhcmUgb3V0c2lkZSB0cmFjaGUgcmFuZ2VzDQogIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSh1aW50IHdlaVJhaXNlZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KSB7DQogICAgcmV0dXJuIGdldEN1cnJlbnRUcmFuY2hlKHdlaVJhaXNlZCkucHJpY2U7DQogIH0NCg0KICAvLy8gQGRldiBDYWxjdWxhdGUgdGhlIGN1cnJlbnQgcHJpY2UgZm9yIGJ1eSBpbiBhbW91bnQuDQogIGZ1bmN0aW9uIGNhbGN1bGF0ZVByaWNlKHVpbnQgdmFsdWUsIHVpbnQgd2VpUmFpc2VkLCB1aW50IHRva2Vuc1NvbGQsIGFkZHJlc3MgbXNnU2VuZGVyLCB1aW50IGRlY2ltYWxzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KDQogICAgdWludCBtdWx0aXBsaWVyID0gMTAgKiogZGVjaW1hbHM7DQoNCiAgICAvLyBUaGlzIGludmVzdG9yIGlzIGNvbWluZyB0aHJvdWdoIHByZS1pY28NCiAgICBpZihwcmVpY29BZGRyZXNzZXNbbXNnU2VuZGVyXSA+IDApIHsNCiAgICAgIHJldHVybiB2YWx1ZS50aW1lcyhtdWx0aXBsaWVyKSAvIHByZWljb0FkZHJlc3Nlc1ttc2dTZW5kZXJdOw0KICAgIH0NCg0KICAgIHVpbnQgcHJpY2UgPSBnZXRDdXJyZW50UHJpY2Uod2VpUmFpc2VkKTsNCiAgICByZXR1cm4gdmFsdWUudGltZXMobXVsdGlwbGllcikgLyBwcmljZTsNCiAgfQ0KDQogIGZ1bmN0aW9uKCkgcGF5YWJsZSB7DQogICAgdGhyb3c7IC8vIE5vIG1vbmV5IG9uIHRoaXMgY29udHJhY3QNCiAgfQ0KDQp9'