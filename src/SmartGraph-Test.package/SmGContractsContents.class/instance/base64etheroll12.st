base 64 content
base64etheroll12
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4yOw0KDQovLyA8T1JBQ0xJWkVfQVBJPg0KLyoNCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTA0KQ29weXJpZ2h0IChjKSAyMDE2IE9yYWNsaXplIExURA0KDQoNCg0KUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQ0Kb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwNCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMNCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwNCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcw0KZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoNCg0KDQoNClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCg0KDQoNClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQpPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQpUSEUgU09GVFdBUkUuDQoqLw0KDQpjb250cmFjdCBPcmFjbGl6ZUkgew0KICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsNCiAgICBmdW5jdGlvbiBxdWVyeSh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5Tih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04pIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7DQogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsNCiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOw0KICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7DQogICAgZnVuY3Rpb24gc2V0UHJvb2ZUeXBlKGJ5dGUgX3Byb29mVHlwZSk7DQogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7DQogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOw0KfQ0KY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsNCiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7DQp9DQpjb250cmFjdCB1c2luZ09yYWNsaXplIHsNCiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0Ow0KICAgIHVpbnQgY29uc3RhbnQgd2VlayA9IDYwKjYwKjI0Kjc7DQogICAgdWludCBjb25zdGFudCBtb250aCA9IDYwKjYwKjI0KjMwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX1RMU05vdGFyeSA9IDB4MTA7DQogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsNCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsNCg0KICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7DQoNCiAgICBPcmFjbGl6ZUkgb3JhY2xpemU7DQogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgew0KICAgICAgICBpZigoYWRkcmVzcyhPQVIpPT0wKXx8KGdldENvZGVTaXplKGFkZHJlc3MoT0FSKSk9PTApKSBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsNCiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7DQogICAgICAgIF87DQogICAgfQ0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7DQogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOw0KICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yayh1aW50OCBuZXR3b3JrSUQpIGludGVybmFsIHJldHVybnMoYm9vbCl7DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpPjApeyAvL21haW5uZXQNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk+MCl7IC8vcm9wc3RlbiB0ZXN0bmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpPjApeyAvL2tvdmFuIHRlc3RuZXQNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk+MCl7IC8vZXRoZXJldW0tYnJpZGdlDQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpPjApeyAvL2V0aGVyLmNhbXAgaWRlDQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpPjApeyAvL2Jyb3dzZXItc29saWRpdHkNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7DQogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOw0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOw0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsgICAgICAgDQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRQcm9vZihieXRlIHByb29mUCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q29uZmlnKGJ5dGVzMzIgY29uZmlnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDb25maWcoY29uZmlnKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQgX3NpemUpIHsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwYXJzZUFkZHIoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRtcCA9IGJ5dGVzKF9hKTsNCiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7DQogICAgICAgIHVpbnQxNjAgYjE7DQogICAgICAgIHVpbnQxNjAgYjI7DQogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsNCiAgICAgICAgICAgIGlhZGRyICo9IDI1NjsNCiAgICAgICAgICAgIGIxID0gdWludDE2MCh0bXBbaV0pOw0KICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsNCiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpJiYoYjEgPD0gMTAyKSkgYjEgLT0gODc7DQogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNjUpJiYoYjEgPD0gNzApKSBiMSAtPSA1NTsNCiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA0OCkmJihiMSA8PSA1NykpIGIxIC09IDQ4Ow0KICAgICAgICAgICAgaWYgKChiMiA+PSA5NykmJihiMiA8PSAxMDIpKSBiMiAtPSA4NzsNCiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA2NSkmJihiMiA8PSA3MCkpIGIyIC09IDU1Ow0KICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7DQogICAgICAgICAgICBpYWRkciArPSAoYjEqMTYrYjIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb21wYXJlKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGEgPSBieXRlcyhfYSk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMoX2IpOw0KICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGEubGVuZ3RoOw0KICAgICAgICBpZiAoYi5sZW5ndGggPCBtaW5MZW5ndGgpIG1pbkxlbmd0aCA9IGIubGVuZ3RoOw0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtaW5MZW5ndGg7IGkgKyspDQogICAgICAgICAgICBpZiAoYVtpXSA8IGJbaV0pDQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICAgICAgZWxzZSBpZiAoYVtpXSA+IGJbaV0pDQogICAgICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIGlmIChhLmxlbmd0aCA8IGIubGVuZ3RoKQ0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICBlbHNlIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKQ0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBuID0gYnl0ZXMoX25lZWRsZSk7DQogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKQ0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICBlbHNlIGlmKGgubGVuZ3RoID4gKDIqKjEyOCAtMSkpDQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIGVsc2UNCiAgICAgICAgew0KICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7DQogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoLmxlbmd0aDsgaSArKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXggPSAxOw0KICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCsrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmKHN1YmluZGV4ID09IG4ubGVuZ3RoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOw0KICAgICAgICBieXRlcyBtZW1vcnkgX2JiID0gYnl0ZXMoX2IpOw0KICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOw0KICAgICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOw0KICAgICAgICBieXRlcyBtZW1vcnkgX2JlID0gYnl0ZXMoX2UpOw0KICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7DQogICAgICAgIHVpbnQgayA9IDA7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JjLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iY1tpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOw0KICAgICAgICByZXR1cm4gc3RyaW5nKGJhYmNkZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgIiIsICIiLCAiIik7DQogICAgfQ0KDQogICAgLy8gcGFyc2VJbnQNCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsNCiAgICB9DQoNCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQ0KICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsNCiAgICAgICAgdWludCBtaW50ID0gMDsNCiAgICAgICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOw0KICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspew0KICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsNCiAgICAgICAgICAgICAgICBpZiAoZGVjaW1hbHMpew0KICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSBfYi0tOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOw0KICAgICAgICAgICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4Ow0KICAgICAgICAgICAgfSBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCoqX2I7DQogICAgICAgIHJldHVybiBtaW50Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHVpbnQyc3RyKHVpbnQgaSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsNCiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsNCiAgICAgICAgdWludCBqID0gaTsNCiAgICAgICAgdWludCBsZW47DQogICAgICAgIHdoaWxlIChqICE9IDApew0KICAgICAgICAgICAgbGVuKys7DQogICAgICAgICAgICBqIC89IDEwOw0KICAgICAgICB9DQogICAgICAgIGJ5dGVzIG1lbW9yeSBic3RyID0gbmV3IGJ5dGVzKGxlbik7DQogICAgICAgIHVpbnQgayA9IGxlbiAtIDE7DQogICAgICAgIHdoaWxlIChpICE9IDApew0KICAgICAgICAgICAgYnN0cltrLS1dID0gYnl0ZSg0OCArIGkgJSAxMCk7DQogICAgICAgICAgICBpIC89IDEwOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzdHJpbmcoYnN0cik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsNCiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsNCg0KICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoDQogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7DQogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOw0KICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsNCiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7DQogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsNCiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7DQogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7DQogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7DQoNCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgew0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOw0KICAgICAgICAgICAgICAgIGN0cisrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7DQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOw0KICAgICAgICAgICAgICAgIGN0cisrOw0KICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgew0KICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0DQogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7DQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07DQogICAgICAgICAgICAgICAgICAgIGN0cisrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7DQogICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gcmVzOw0KICAgICAgICB9DQp9DQovLyA8L09SQUNMSVpFX0FQST4NCg0KLyoNCiAqIEB0aXRsZSBTdHJpbmcgJiBzbGljZSB1dGlsaXR5IGxpYnJhcnkgZm9yIFNvbGlkaXR5IGNvbnRyYWN0cy4NCiAqIEBhdXRob3IgTmljayBKb2huc29uIDxhcmFjaG5pZEBub3Rkb3QubmV0Pg0KICoNCiAqIEBkZXYgRnVuY3Rpb25hbGl0eSBpbiB0aGlzIGxpYnJhcnkgaXMgbGFyZ2VseSBpbXBsZW1lbnRlZCB1c2luZyBhbg0KICogICAgICBhYnN0cmFjdGlvbiBjYWxsZWQgYSAnc2xpY2UnLiBBIHNsaWNlIHJlcHJlc2VudHMgYSBwYXJ0IG9mIGEgc3RyaW5nIC0NCiAqICAgICAgYW55dGhpbmcgZnJvbSB0aGUgZW50aXJlIHN0cmluZyB0byBhIHNpbmdsZSBjaGFyYWN0ZXIsIG9yIGV2ZW4gbm8NCiAqICAgICAgY2hhcmFjdGVycyBhdCBhbGwgKGEgMC1sZW5ndGggc2xpY2UpLiBTaW5jZSBhIHNsaWNlIG9ubHkgaGFzIHRvIHNwZWNpZnkNCiAqICAgICAgYW4gb2Zmc2V0IGFuZCBhIGxlbmd0aCwgY29weWluZyBhbmQgbWFuaXB1bGF0aW5nIHNsaWNlcyBpcyBhIGxvdCBsZXNzDQogKiAgICAgIGV4cGVuc2l2ZSB0aGFuIGNvcHlpbmcgYW5kIG1hbmlwdWxhdGluZyB0aGUgc3RyaW5ncyB0aGV5IHJlZmVyZW5jZS4NCiAqDQogKiAgICAgIFRvIGZ1cnRoZXIgcmVkdWNlIGdhcyBjb3N0cywgbW9zdCBmdW5jdGlvbnMgb24gc2xpY2UgdGhhdCBuZWVkIHRvIHJldHVybg0KICogICAgICBhIHNsaWNlIG1vZGlmeSB0aGUgb3JpZ2luYWwgb25lIGluc3RlYWQgb2YgYWxsb2NhdGluZyBhIG5ldyBvbmU7IGZvcg0KICogICAgICBpbnN0YW5jZSwgYHMuc3BsaXQoIi4iKWAgd2lsbCByZXR1cm4gdGhlIHRleHQgdXAgdG8gdGhlIGZpcnN0ICcuJywNCiAqICAgICAgbW9kaWZ5aW5nIHMgdG8gb25seSBjb250YWluIHRoZSByZW1haW5kZXIgb2YgdGhlIHN0cmluZyBhZnRlciB0aGUgJy4nLg0KICogICAgICBJbiBzaXR1YXRpb25zIHdoZXJlIHlvdSBkbyBub3Qgd2FudCB0byBtb2RpZnkgdGhlIG9yaWdpbmFsIHNsaWNlLCB5b3UNCiAqICAgICAgY2FuIG1ha2UgYSBjb3B5IGZpcnN0IHdpdGggYC5jb3B5KClgLCBmb3IgZXhhbXBsZToNCiAqICAgICAgYHMuY29weSgpLnNwbGl0KCIuIilgLiBUcnkgYW5kIGF2b2lkIHVzaW5nIHRoaXMgaWRpb20gaW4gbG9vcHM7IHNpbmNlDQogKiAgICAgIFNvbGlkaXR5IGhhcyBubyBtZW1vcnkgbWFuYWdlbWVudCwgaXQgd2lsbCByZXN1bHQgaW4gYWxsb2NhdGluZyBtYW55DQogKiAgICAgIHNob3J0LWxpdmVkIHNsaWNlcyB0aGF0IGFyZSBsYXRlciBkaXNjYXJkZWQuDQogKg0KICogICAgICBGdW5jdGlvbnMgdGhhdCByZXR1cm4gdHdvIHNsaWNlcyBjb21lIGluIHR3byB2ZXJzaW9uczogYSBub24tYWxsb2NhdGluZw0KICogICAgICB2ZXJzaW9uIHRoYXQgdGFrZXMgdGhlIHNlY29uZCBzbGljZSBhcyBhbiBhcmd1bWVudCwgbW9kaWZ5aW5nIGl0IGluDQogKiAgICAgIHBsYWNlLCBhbmQgYW4gYWxsb2NhdGluZyB2ZXJzaW9uIHRoYXQgYWxsb2NhdGVzIGFuZCByZXR1cm5zIHRoZSBzZWNvbmQNCiAqICAgICAgc2xpY2U7IHNlZSBgbmV4dFJ1bmVgIGZvciBleGFtcGxlLg0KICoNCiAqICAgICAgRnVuY3Rpb25zIHRoYXQgaGF2ZSB0byBjb3B5IHN0cmluZyBkYXRhIHdpbGwgcmV0dXJuIHN0cmluZ3MgcmF0aGVyIHRoYW4NCiAqICAgICAgc2xpY2VzOyB0aGVzZSBjYW4gYmUgY2FzdCBiYWNrIHRvIHNsaWNlcyBmb3IgZnVydGhlciBwcm9jZXNzaW5nIGlmDQogKiAgICAgIHJlcXVpcmVkLg0KICoNCiAqICAgICAgRm9yIGNvbnZlbmllbmNlLCBzb21lIGZ1bmN0aW9ucyBhcmUgcHJvdmlkZWQgd2l0aCBub24tbW9kaWZ5aW5nDQogKiAgICAgIHZhcmlhbnRzIHRoYXQgY3JlYXRlIGEgbmV3IHNsaWNlIGFuZCByZXR1cm4gYm90aDsgZm9yIGluc3RhbmNlLA0KICogICAgICBgcy5zcGxpdE5ldygnLicpYCBsZWF2ZXMgcyB1bm1vZGlmaWVkLCBhbmQgcmV0dXJucyB0d28gdmFsdWVzDQogKiAgICAgIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGxlZnQgYW5kIHJpZ2h0IHBhcnRzIG9mIHRoZSBzdHJpbmcuDQogKi8NCmxpYnJhcnkgc3RyaW5ncyB7DQogICAgc3RydWN0IHNsaWNlIHsNCiAgICAgICAgdWludCBfbGVuOw0KICAgICAgICB1aW50IF9wdHI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbWVtY3B5KHVpbnQgZGVzdCwgdWludCBzcmMsIHVpbnQgbGVuKSBwcml2YXRlIHsNCiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUNCiAgICAgICAgZm9yKDsgbGVuID49IDMyOyBsZW4gLT0gMzIpIHsNCiAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICBtc3RvcmUoZGVzdCwgbWxvYWQoc3JjKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRlc3QgKz0gMzI7DQogICAgICAgICAgICBzcmMgKz0gMzI7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcw0KICAgICAgICB1aW50IG1hc2sgPSAyNTYgKiogKDMyIC0gbGVuKSAtIDE7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIGxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChzcmMpLCBub3QobWFzaykpDQogICAgICAgICAgICBsZXQgZGVzdHBhcnQgOj0gYW5kKG1sb2FkKGRlc3QpLCBtYXNrKQ0KICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG9yKGRlc3RwYXJ0LCBzcmNwYXJ0KSkNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc3RyaW5nIHRvIG1ha2UgYSBzbGljZSBmcm9tLg0KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0b1NsaWNlKHN0cmluZyBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0cjsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmLCAweDIwKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzbGljZShieXRlcyhzZWxmKS5sZW5ndGgsIHB0cik7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBvZiBhIG51bGwtdGVybWluYXRlZCBieXRlczMyIHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgdmFsdWUgdG8gZmluZCB0aGUgbGVuZ3RoIG9mLg0KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc3RyaW5nLCBmcm9tIDAgdG8gMzIuDQogICAgICovDQogICAgZnVuY3Rpb24gbGVuKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICB1aW50IHJldDsNCiAgICAgICAgaWYgKHNlbGYgPT0gMCkNCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDE2Ow0KICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7DQogICAgICAgICAgICByZXQgKz0gODsNCiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDQ7DQogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDApOw0KICAgICAgICB9DQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmID09IDApIHsNCiAgICAgICAgICAgIHJldCArPSAyOw0KICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDApOw0KICAgICAgICB9DQogICAgICAgIGlmIChzZWxmICYgMHhmZiA9PSAwKSB7DQogICAgICAgICAgICByZXQgKz0gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMzIgLSByZXQ7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgYnl0ZXMzMiwgaW50ZXJwcmV0ZWQgYXMgYQ0KICAgICAqICAgICAgbnVsbC10ZXJtaW50YWVkIHV0Zi04IHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgYnl0ZXMzMiB2YWx1ZSB0byBjb252ZXJ0IHRvIGEgc2xpY2UuDQogICAgICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgYXJndW1lbnQgdXAgdG8gdGhlDQogICAgICogICAgICAgICBmaXJzdCBudWxsLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRvU2xpY2VCMzIoYnl0ZXMzMiBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsNCiAgICAgICAgLy8gQWxsb2NhdGUgc3BhY2UgZm9yIGBzZWxmYCBpbiBtZW1vcnksIGNvcHkgaXQgdGhlcmUsIGFuZCBwb2ludCByZXQgYXQgaXQNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgbGV0IHB0ciA6PSBtbG9hZCgweDQwKQ0KICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFkZChwdHIsIDB4MjApKQ0KICAgICAgICAgICAgbXN0b3JlKHB0ciwgc2VsZikNCiAgICAgICAgICAgIG1zdG9yZShhZGQocmV0LCAweDIwKSwgcHRyKQ0KICAgICAgICB9DQogICAgICAgIHJldC5fbGVuID0gbGVuKHNlbGYpOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIGEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyB0aGUgY3VycmVudCBzbGljZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4NCiAgICAgKiBAcmV0dXJuIEEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gY29weShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICByZXR1cm4gc2xpY2Uoc2VsZi5fbGVuLCBzZWxmLl9wdHIpOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuDQogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgc2xpY2UncyB0ZXh0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4pOw0KICAgICAgICB1aW50IHJldHB0cjsNCiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0NCg0KICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBpbiBydW5lcyBvZiB0aGUgc2xpY2UuIE5vdGUgdGhhdCB0aGlzIG9wZXJhdGlvbg0KICAgICAqICAgICAgdGFrZXMgdGltZSBwcm9wb3J0aW9uYWwgdG8gdGhlIGxlbmd0aCBvZiB0aGUgc2xpY2U7IGF2b2lkIHVzaW5nIGl0DQogICAgICogICAgICBpbiBsb29wcywgYW5kIGNhbGwgYHNsaWNlLmVtcHR5KClgIGlmIHlvdSBvbmx5IG5lZWQgdG8ga25vdyB3aGV0aGVyDQogICAgICogICAgICB0aGUgc2xpY2UgaXMgZW1wdHkgb3Igbm90Lg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc2xpY2UgaW4gcnVuZXMuDQogICAgICovDQogICAgZnVuY3Rpb24gbGVuKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgLy8gU3RhcnRpbmcgYXQgcHRyLTMxIG1lYW5zIHRoZSBMU0Igd2lsbCBiZSB0aGUgYnl0ZSB3ZSBjYXJlIGFib3V0DQogICAgICAgIHZhciBwdHIgPSBzZWxmLl9wdHIgLSAzMTsNCiAgICAgICAgdmFyIGVuZCA9IHB0ciArIHNlbGYuX2xlbjsNCiAgICAgICAgZm9yICh1aW50IGxlbiA9IDA7IHB0ciA8IGVuZDsgbGVuKyspIHsNCiAgICAgICAgICAgIHVpbnQ4IGI7DQogICAgICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHB0ciksIDB4RkYpIH0NCiAgICAgICAgICAgIGlmIChiIDwgMHg4MCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSAxOw0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDI7DQogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gMzsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGOCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSA0Ow0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEZDKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHB0ciArPSA2Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBsZW47DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgaXMgZW1wdHkgKGhhcyBhIGxlbmd0aCBvZiAwKS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5LCBGYWxzZSBvdGhlcndpc2UuDQogICAgICovDQogICAgZnVuY3Rpb24gZW1wdHkoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gc2VsZi5fbGVuID09IDA7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFJldHVybnMgYSBwb3NpdGl2ZSBudW1iZXIgaWYgYG90aGVyYCBjb21lcyBsZXhpY29ncmFwaGljYWxseSBhZnRlcg0KICAgICAqICAgICAgYHNlbGZgLCBhIG5lZ2F0aXZlIG51bWJlciBpZiBpdCBjb21lcyBiZWZvcmUsIG9yIHplcm8gaWYgdGhlDQogICAgICogICAgICBjb250ZW50cyBvZiB0aGUgdHdvIHNsaWNlcyBhcmUgZXF1YWwuIENvbXBhcmlzb24gaXMgZG9uZSBwZXItcnVuZSwNCiAgICAgKiAgICAgIG9uIHVuaWNvZGUgY29kZXBvaW50cy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29tcGFyZS4NCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLg0KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBvZiB0aGUgY29tcGFyaXNvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb21wYXJlKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsNCiAgICAgICAgdWludCBzaG9ydGVzdCA9IHNlbGYuX2xlbjsNCiAgICAgICAgaWYgKG90aGVyLl9sZW4gPCBzZWxmLl9sZW4pDQogICAgICAgICAgICBzaG9ydGVzdCA9IG90aGVyLl9sZW47DQoNCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHI7DQogICAgICAgIHZhciBvdGhlcnB0ciA9IG90aGVyLl9wdHI7DQogICAgICAgIGZvciAodWludCBpZHggPSAwOyBpZHggPCBzaG9ydGVzdDsgaWR4ICs9IDMyKSB7DQogICAgICAgICAgICB1aW50IGE7DQogICAgICAgICAgICB1aW50IGI7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgYSA6PSBtbG9hZChzZWxmcHRyKQ0KICAgICAgICAgICAgICAgIGIgOj0gbWxvYWQob3RoZXJwdHIpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYSAhPSBiKSB7DQogICAgICAgICAgICAgICAgLy8gTWFzayBvdXQgaXJyZWxldmFudCBieXRlcyBhbmQgY2hlY2sgYWdhaW4NCiAgICAgICAgICAgICAgICB1aW50IG1hc2sgPSB+KDIgKiogKDggKiAoMzIgLSBzaG9ydGVzdCArIGlkeCkpIC0gMSk7DQogICAgICAgICAgICAgICAgdmFyIGRpZmYgPSAoYSAmIG1hc2spIC0gKGIgJiBtYXNrKTsNCiAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPSAwKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGRpZmYpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2VsZnB0ciArPSAzMjsNCiAgICAgICAgICAgIG90aGVycHRyICs9IDMyOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBpbnQoc2VsZi5fbGVuKSAtIGludChvdGhlci5fbGVuKTsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSB0d28gc2xpY2VzIGNvbnRhaW4gdGhlIHNhbWUgdGV4dC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29tcGFyZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbXBhcmUuDQogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuDQogICAgICovDQogICAgZnVuY3Rpb24gZXF1YWxzKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiBjb21wYXJlKHNlbGYsIG90aGVyKSA9PSAwOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBFeHRyYWN0cyB0aGUgZmlyc3QgcnVuZSBpbiB0aGUgc2xpY2UgaW50byBgcnVuZWAsIGFkdmFuY2luZyB0aGUNCiAgICAgKiAgICAgIHNsaWNlIHRvIHBvaW50IHRvIHRoZSBuZXh0IHJ1bmUgYW5kIHJldHVybmluZyBgc2VsZmAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIHJ1bmUgVGhlIHNsaWNlIHRoYXQgd2lsbCBjb250YWluIHRoZSBmaXJzdCBydW5lLg0KICAgICAqIEByZXR1cm4gYHJ1bmVgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG5leHRSdW5lKHNsaWNlIHNlbGYsIHNsaWNlIHJ1bmUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHJ1bmUuX3B0ciA9IHNlbGYuX3B0cjsNCg0KICAgICAgICBpZiAoc2VsZi5fbGVuID09IDApIHsNCiAgICAgICAgICAgIHJ1bmUuX2xlbiA9IDA7DQogICAgICAgICAgICByZXR1cm4gcnVuZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHVpbnQgbGVuOw0KICAgICAgICB1aW50IGI7DQogICAgICAgIC8vIExvYWQgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIHJ1bmUgaW50byB0aGUgTFNCcyBvZiBiDQogICAgICAgIGFzc2VtYmx5IHsgYiA6PSBhbmQobWxvYWQoc3ViKG1sb2FkKGFkZChzZWxmLCAzMikpLCAzMSkpLCAweEZGKSB9DQogICAgICAgIGlmIChiIDwgMHg4MCkgew0KICAgICAgICAgICAgbGVuID0gMTsNCiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7DQogICAgICAgICAgICBsZW4gPSAyOw0KICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsNCiAgICAgICAgICAgIGxlbiA9IDM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBsZW4gPSA0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzDQogICAgICAgIGlmIChsZW4gPiBzZWxmLl9sZW4pIHsNCiAgICAgICAgICAgIHJ1bmUuX2xlbiA9IHNlbGYuX2xlbjsNCiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBzZWxmLl9sZW47DQogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOw0KICAgICAgICAgICAgcmV0dXJuIHJ1bmU7DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLl9wdHIgKz0gbGVuOw0KICAgICAgICBzZWxmLl9sZW4gLT0gbGVuOw0KICAgICAgICBydW5lLl9sZW4gPSBsZW47DQogICAgICAgIHJldHVybiBydW5lOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSwgYWR2YW5jaW5nIHRoZSBzbGljZSB0byBwb2ludA0KICAgICAqICAgICAgdG8gdGhlIG5leHQgcnVuZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcmV0dXJuIEEgc2xpY2UgY29udGFpbmluZyBvbmx5IHRoZSBmaXJzdCBydW5lIGZyb20gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG5leHRSdW5lKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHJldCkgew0KICAgICAgICBuZXh0UnVuZShzZWxmLCByZXQpOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdGhlIGZpcnN0IGNvZGVwb2ludCBpbiB0aGUgc2xpY2UuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG9yZChzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IHJldCkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuID09IDApIHsNCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICB9DQoNCiAgICAgICAgdWludCB3b3JkOw0KICAgICAgICB1aW50IGxlbjsNCiAgICAgICAgdWludCBkaXYgPSAyICoqIDI0ODsNCg0KICAgICAgICAvLyBMb2FkIHRoZSBydW5lIGludG8gdGhlIE1TQnMgb2YgYg0KICAgICAgICBhc3NlbWJseSB7IHdvcmQ6PSBtbG9hZChtbG9hZChhZGQoc2VsZiwgMzIpKSkgfQ0KICAgICAgICB2YXIgYiA9IHdvcmQgLyBkaXY7DQogICAgICAgIGlmIChiIDwgMHg4MCkgew0KICAgICAgICAgICAgcmV0ID0gYjsNCiAgICAgICAgICAgIGxlbiA9IDE7DQogICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgew0KICAgICAgICAgICAgcmV0ID0gYiAmIDB4MUY7DQogICAgICAgICAgICBsZW4gPSAyOw0KICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsNCiAgICAgICAgICAgIHJldCA9IGIgJiAweDBGOw0KICAgICAgICAgICAgbGVuID0gMzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldCA9IGIgJiAweDA3Ow0KICAgICAgICAgICAgbGVuID0gNDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cw0KICAgICAgICBpZiAobGVuID4gc2VsZi5fbGVuKSB7DQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgICAgICBkaXYgPSBkaXYgLyAyNTY7DQogICAgICAgICAgICBiID0gKHdvcmQgLyBkaXYpICYgMHhGRjsNCiAgICAgICAgICAgIGlmIChiICYgMHhDMCAhPSAweDgwKSB7DQogICAgICAgICAgICAgICAgLy8gSW52YWxpZCBVVEYtOCBzZXF1ZW5jZQ0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0ID0gKHJldCAqIDY0KSB8IChiICYgMHgzRik7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBrZWNjYWstMjU2IGhhc2ggb2YgdGhlIHNsaWNlLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBoYXNoLg0KICAgICAqIEByZXR1cm4gVGhlIGhhc2ggb2YgdGhlIHNsaWNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGtlY2NhayhzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIHJldCkgew0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICByZXQgOj0gc2hhMyhtbG9hZChhZGQoc2VsZiwgMzIpKSwgbWxvYWQoc2VsZikpDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdGFydHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLl9wdHIgPT0gbmVlZGxlLl9wdHIpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgYm9vbCBlcXVhbDsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpDQogICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpDQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQ0KICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZXF1YWw7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IElmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQ0KICAgICAqICAgICAgYmVnaW5uaW5nIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gYHNlbGZgDQogICAgICovDQogICAgZnVuY3Rpb24gYmV5b25kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgfQ0KDQogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOw0KICAgICAgICBpZiAoc2VsZi5fcHRyICE9IG5lZWRsZS5fcHRyKSB7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpDQogICAgICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQ0KICAgICAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpDQogICAgICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChlcXVhbCkgew0KICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOw0KICAgICAgICAgICAgc2VsZi5fcHRyICs9IG5lZWRsZS5fbGVuOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgZW5kcyB3aXRoIGBuZWVkbGVgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuDQogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVuZHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47DQoNCiAgICAgICAgaWYgKHNlbGZwdHIgPT0gbmVlZGxlLl9wdHIpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgYm9vbCBlcXVhbDsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpDQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQ0KICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBlcXVhbDsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgSWYgYHNlbGZgIGVuZHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQ0KICAgICAqICAgICAgZW5kIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gYHNlbGZgDQogICAgICovDQogICAgZnVuY3Rpb24gdW50aWwoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsNCiAgICAgICAgYm9vbCBlcXVhbCA9IHRydWU7DQogICAgICAgIGlmIChzZWxmcHRyICE9IG5lZWRsZS5fcHRyKSB7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpDQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCiAgICAgICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGVxdWFsKSB7DQogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICB9DQoNCiAgICAvLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZg0KICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgYHNlbGZgIGlmIG5vdCBmb3VuZC4NCiAgICBmdW5jdGlvbiBmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgew0KICAgICAgICB1aW50IHB0cjsNCiAgICAgICAgdWludCBpZHg7DQoNCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7DQogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7DQogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OCBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spDQogICAgICAgICAgICAgICAgICAgIGxldCBlbmQgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cg0KICAgICAgICAgICAgICAgICAgICBsb29wOg0KICAgICAgICAgICAgICAgICAgICBqdW1waShleGl0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgMSkNCiAgICAgICAgICAgICAgICAgICAganVtcGkobG9vcCwgbHQoc3ViKHB0ciwgMSksIGVuZCkpDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc2VsZmxlbikNCiAgICAgICAgICAgICAgICAgICAgZXhpdDoNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gRm9yIGxvbmcgbmVlZGxlcywgdXNlIGhhc2hpbmcNCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7DQogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0NCiAgICAgICAgICAgICAgICBwdHIgPSBzZWxmcHRyOw0KICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDw9IHNlbGZsZW4gLSBuZWVkbGVsZW47IGlkeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7DQogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgdGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbikgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaCA9PSB0ZXN0SGFzaCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHI7DQogICAgICAgICAgICAgICAgICAgIHB0ciArPSAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2VsZnB0ciArIHNlbGZsZW47DQogICAgfQ0KDQogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZg0KICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGFkZHJlc3Mgb2YgYHNlbGZgIGlmIG5vdCBmb3VuZC4NCiAgICBmdW5jdGlvbiByZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdWludCBwdHI7DQoNCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7DQogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7DQogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OSBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc3ViKHNlbGZsZW4sIG5lZWRsZWxlbikpDQogICAgICAgICAgICAgICAgICAgIGxvb3A6DQogICAgICAgICAgICAgICAgICAgIGp1bXBpKHJldCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHN1YihwdHIsIDEpDQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGd0KGFkZChwdHIsIDEpLCBzZWxmcHRyKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHNlbGZwdHINCiAgICAgICAgICAgICAgICAgICAganVtcChleGl0KQ0KICAgICAgICAgICAgICAgICAgICByZXQ6DQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCBuZWVkbGVsZW4pDQogICAgICAgICAgICAgICAgICAgIGV4aXQ6DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nDQogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgaGFzaCA6PSBzaGEzKG5lZWRsZXB0ciwgbmVlZGxlbGVuKSB9DQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0ciArIChzZWxmbGVuIC0gbmVlZGxlbGVuKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAocHRyID49IHNlbGZwdHIpIHsNCiAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiB0ZXN0SGFzaDsNCiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9DQogICAgICAgICAgICAgICAgICAgIGlmIChoYXNoID09IHRlc3RIYXNoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB0ciArIG5lZWRsZWxlbjsNCiAgICAgICAgICAgICAgICAgICAgcHRyIC09IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzZWxmcHRyOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBNb2RpZmllcyBgc2VsZmAgdG8gY29udGFpbiBldmVyeXRoaW5nIGZyb20gdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YNCiAgICAgKiAgICAgIGBuZWVkbGVgIHRvIHRoZSBlbmQgb2YgdGhlIHNsaWNlLiBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZQ0KICAgICAqICAgICAgaWYgYG5lZWRsZWAgaXMgbm90IGZvdW5kLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2ggYW5kIG1vZGlmeS4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuDQogICAgICogQHJldHVybiBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCiAgICAgICAgc2VsZi5fbGVuIC09IHB0ciAtIHNlbGYuX3B0cjsNCiAgICAgICAgc2VsZi5fcHRyID0gcHRyOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gdGhlIHBhcnQgb2YgdGhlIHN0cmluZyBmcm9tIHRoZSBzdGFydCBvZg0KICAgICAqICAgICAgYHNlbGZgIHRvIHRoZSBlbmQgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAuIElmIGBuZWVkbGVgDQogICAgICogICAgICBpcyBub3QgZm91bmQsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2ggYW5kIG1vZGlmeS4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuDQogICAgICogQHJldHVybiBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gcmZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOw0KICAgICAgICBzZWxmLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdA0KICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmDQogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLA0KICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uDQogICAgICogQHJldHVybiBgdG9rZW5gLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCiAgICAgICAgdG9rZW4uX3B0ciA9IHNlbGYuX3B0cjsNCiAgICAgICAgdG9rZW4uX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsNCiAgICAgICAgaWYgKHB0ciA9PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsNCiAgICAgICAgICAgIC8vIE5vdCBmb3VuZA0KICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47DQogICAgICAgICAgICBzZWxmLl9wdHIgPSBwdHIgKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdG9rZW47DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0DQogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZg0KICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwNCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIHVwIHRvIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuDQogICAgICovDQogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgew0KICAgICAgICBzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QNCiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuIElmDQogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLA0KICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uDQogICAgICogQHJldHVybiBgdG9rZW5gLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOw0KICAgICAgICB0b2tlbi5fcHRyID0gcHRyOw0KICAgICAgICB0b2tlbi5fbGVuID0gc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0cik7DQogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyKSB7DQogICAgICAgICAgICAvLyBOb3QgZm91bmQNCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0b2tlbjsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QNCiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBhZnRlciBpdC4gSWYNCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsDQogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuDQogICAgICovDQogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsNCiAgICAgICAgcnNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBDb3VudHMgdGhlIG51bWJlciBvZiBub25vdmVybGFwcGluZyBvY2N1cnJlbmNlcyBvZiBgbmVlZGxlYCBpbiBgc2VsZmAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEByZXR1cm4gVGhlIG51bWJlciBvZiBvY2N1cnJlbmNlcyBvZiBgbmVlZGxlYCBmb3VuZCBpbiBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gY291bnQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGNvdW50KSB7DQogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOw0KICAgICAgICB3aGlsZSAocHRyIDw9IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgew0KICAgICAgICAgICAgY291bnQrKzsNCiAgICAgICAgICAgIHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0ciksIHB0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFJldHVybnMgVHJ1ZSBpZiBgc2VsZmAgY29udGFpbnMgYG5lZWRsZWAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBgbmVlZGxlYCBpcyBmb3VuZCBpbiBgc2VsZmAsIGZhbHNlIG90aGVyd2lzZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb250YWlucyhzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICE9IHNlbGYuX3B0cjsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgUmV0dXJucyBhIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgY29uY2F0ZW5hdGlvbiBvZg0KICAgICAqICAgICAgYHNlbGZgIGFuZCBgb3RoZXJgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb25jYXRlbmF0ZS4NCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb25jYXRlbmF0ZS4NCiAgICAgKiBAcmV0dXJuIFRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZSB0d28gc3RyaW5ncy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb25jYXQoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4gKyBvdGhlci5fbGVuKTsNCiAgICAgICAgdWludCByZXRwdHI7DQogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9DQogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsNCiAgICAgICAgbWVtY3B5KHJldHB0ciArIHNlbGYuX2xlbiwgb3RoZXIuX3B0ciwgb3RoZXIuX2xlbik7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IEpvaW5zIGFuIGFycmF5IG9mIHNsaWNlcywgdXNpbmcgYHNlbGZgIGFzIGEgZGVsaW1pdGVyLCByZXR1cm5pbmcgYQ0KICAgICAqICAgICAgbmV3bHkgYWxsb2NhdGVkIHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZGVsaW1pdGVyIHRvIHVzZS4NCiAgICAgKiBAcGFyYW0gcGFydHMgQSBsaXN0IG9mIHNsaWNlcyB0byBqb2luLg0KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgYWxsIHRoZSBzbGljZXMgaW4gYHBhcnRzYCwNCiAgICAgKiAgICAgICAgIGpvaW5lZCB3aXRoIGBzZWxmYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBqb2luKHNsaWNlIHNlbGYsIHNsaWNlW10gcGFydHMpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICBpZiAocGFydHMubGVuZ3RoID09IDApDQogICAgICAgICAgICByZXR1cm4gIiI7DQoNCiAgICAgICAgdWludCBsZW4gPSBzZWxmLl9sZW4gKiAocGFydHMubGVuZ3RoIC0gMSk7DQogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspDQogICAgICAgICAgICBsZW4gKz0gcGFydHNbaV0uX2xlbjsNCg0KICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhsZW4pOw0KICAgICAgICB1aW50IHJldHB0cjsNCiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0NCg0KICAgICAgICBmb3IoaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgbWVtY3B5KHJldHB0ciwgcGFydHNbaV0uX3B0ciwgcGFydHNbaV0uX2xlbik7DQogICAgICAgICAgICByZXRwdHIgKz0gcGFydHNbaV0uX2xlbjsNCiAgICAgICAgICAgIGlmIChpIDwgcGFydHMubGVuZ3RoIC0gMSkgew0KICAgICAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsNCiAgICAgICAgICAgICAgICByZXRwdHIgKz0gc2VsZi5fbGVuOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQp9DQoNCg0KY29udHJhY3QgRFNTYWZlQWRkU3ViIHsNCiAgICBmdW5jdGlvbiBzYWZlVG9BZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIChhICsgYiA+PSBhKTsNCiAgICB9DQogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICBpZiAoIXNhZmVUb0FkZChhLCBiKSkgdGhyb3c7DQogICAgICAgIHJldHVybiBhICsgYjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzYWZlVG9TdWJ0cmFjdCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gKGIgPD0gYSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICBpZiAoIXNhZmVUb1N1YnRyYWN0KGEsIGIpKSB0aHJvdzsNCiAgICAgICAgcmV0dXJuIGEgLSBiOw0KICAgIH0gDQp9DQoNCg0KDQpjb250cmFjdCBFdGhlcm9sbCBpcyB1c2luZ09yYWNsaXplLCBEU1NhZmVBZGRTdWIgew0KICAgIA0KICAgICB1c2luZyBzdHJpbmdzIGZvciAqOw0KDQogICAgLyoNCiAgICAgKiBjaGVja3MgcGxheWVyIHByb2ZpdCwgYmV0IHNpemUgYW5kIHBsYXllciBudW1iZXIgaXMgd2l0aGluIHJhbmdlDQogICAgKi8NCiAgICBtb2RpZmllciBiZXRJc1ZhbGlkKHVpbnQgX2JldFNpemUsIHVpbnQgX3BsYXllck51bWJlcikgeyAgICAgIA0KICAgICAgICBpZigoKCgoX2JldFNpemUgKiAoMTAwLShzYWZlU3ViKF9wbGF5ZXJOdW1iZXIsMSkpKSkgLyAoc2FmZVN1YihfcGxheWVyTnVtYmVyLDEpKStfYmV0U2l6ZSkpKmhvdXNlRWRnZS9ob3VzZUVkZ2VEaXZpc29yKS1fYmV0U2l6ZSA+IG1heFByb2ZpdCB8fCBfYmV0U2l6ZSA8IG1pbkJldCB8fCBfcGxheWVyTnVtYmVyIDwgbWluTnVtYmVyIHx8IF9wbGF5ZXJOdW1iZXIgPiBtYXhOdW1iZXIpIHRocm93OyAgICAgICAgDQoJCV87DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBjaGVja3MgZ2FtZSBpcyBjdXJyZW50bHkgYWN0aXZlDQogICAgKi8NCiAgICBtb2RpZmllciBnYW1lSXNBY3RpdmUgew0KICAgICAgICBpZihnYW1lUGF1c2VkID09IHRydWUpIHRocm93Ow0KCQlfOw0KICAgIH0gICAgDQoNCiAgICAvKg0KICAgICAqIGNoZWNrcyBwYXlvdXRzIGFyZSBjdXJyZW50bHkgYWN0aXZlDQogICAgKi8NCiAgICBtb2RpZmllciBwYXlvdXRzQXJlQWN0aXZlIHsNCiAgICAgICAgaWYocGF5b3V0c1BhdXNlZCA9PSB0cnVlKSB0aHJvdzsNCgkJXzsNCiAgICB9ICAgIA0KDQogICAgLyoNCiAgICAgKiBjaGVja3Mgb25seSBPcmFjbGl6ZSBhZGRyZXNzIGlzIGNhbGxpbmcNCiAgICAqLw0KICAgIG1vZGlmaWVyIG9ubHlPcmFjbGl6ZSB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG9yYWNsaXplX2NiQWRkcmVzcygpKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIGNoZWNrcyBvbmx5IG93bmVyIGFkZHJlc3MgaXMgY2FsbGluZw0KICAgICovDQogICAgbW9kaWZpZXIgb25seU93bmVyIHsNCiAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsNCiAgICAgICAgIF87DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBjaGVja3Mgb25seSB0cmVhc3VyeSBhZGRyZXNzIGlzIGNhbGxpbmcNCiAgICAqLw0KICAgIG1vZGlmaWVyIG9ubHlUcmVhc3VyeSB7DQogICAgICAgICBpZiAobXNnLnNlbmRlciAhPSB0cmVhc3VyeSkgdGhyb3c7DQogICAgICAgICBfOw0KICAgIH0gICAgDQoNCiAgICAvKg0KICAgICAqIGdhbWUgdmFycw0KICAgICovIA0KICAgIHVpbnQgY29uc3RhbnQgcHVibGljIG1heFByb2ZpdERpdmlzb3IgPSAxMDAwMDAwOw0KICAgIHVpbnQgY29uc3RhbnQgcHVibGljIGhvdXNlRWRnZURpdmlzb3IgPSAxMDAwOyAgICANCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBtYXhOdW1iZXIgPSA5OTsgDQogICAgdWludCBjb25zdGFudCBwdWJsaWMgbWluTnVtYmVyID0gMjsNCglib29sIHB1YmxpYyBnYW1lUGF1c2VkOw0KICAgIHVpbnQzMiBwdWJsaWMgZ2FzRm9yT3JhY2xpemU7DQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQogICAgYm9vbCBwdWJsaWMgcGF5b3V0c1BhdXNlZDsgDQogICAgYWRkcmVzcyBwdWJsaWMgdHJlYXN1cnk7DQogICAgdWludCBwdWJsaWMgY29udHJhY3RCYWxhbmNlOw0KICAgIHVpbnQgcHVibGljIGhvdXNlRWRnZTsgICAgIA0KICAgIHVpbnQgcHVibGljIG1heFByb2ZpdDsgICANCiAgICB1aW50IHB1YmxpYyBtYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlOyAgICAgICAgICAgICAgICAgICAgDQogICAgdWludCBwdWJsaWMgbWluQmV0OyAgICAgICANCiAgICBpbnQgcHVibGljIHRvdGFsQmV0czsNCiAgICB1aW50IHB1YmxpYyBtYXhQZW5kaW5nUGF5b3V0czsNCiAgICB1aW50IHB1YmxpYyBjb3N0VG9DYWxsT3JhY2xpemVJbldlaTsNCiAgICB1aW50IHB1YmxpYyB0b3RhbFdlaVdvbjsNCg0KICAgIC8qDQogICAgICogcGxheWVyIHZhcnMNCiAgICAqLw0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYWRkcmVzcykgcGxheWVyQWRkcmVzczsNCiAgICBtYXBwaW5nIChieXRlczMyID0+IGFkZHJlc3MpIHBsYXllclRlbXBBZGRyZXNzOw0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYnl0ZXMzMikgcGxheWVyQmV0SWQ7DQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJCZXRWYWx1ZTsNCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHBsYXllclRlbXBCZXRWYWx1ZTsgIA0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyUmFuZG9tUmVzdWx0OyAgICAgDQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJEaWVSZXN1bHQ7DQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJOdW1iZXI7DQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHM7ICAgICAgDQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJQcm9maXQ7DQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJUZW1wUmV3YXJkOyAgICANCiAgICAgICAgDQoNCiAgICAvKg0KICAgICAqIGV2ZW50cw0KICAgICovDQogICAgLyogbG9nIGJldHMgKyBvdXRwdXQgdG8gd2ViMyBmb3IgcHJlY2lzZSAncGF5b3V0IG9uIHdpbicgZmllbGQgaW4gVUkgKi8NCiAgICBldmVudCBMb2dCZXQoYnl0ZXMzMiBpbmRleGVkIEJldElELCBhZGRyZXNzIGluZGV4ZWQgUGxheWVyQWRkcmVzcywgdWludCBpbmRleGVkIFJld2FyZFZhbHVlLCB1aW50IFByb2ZpdFZhbHVlLCB1aW50IEJldFZhbHVlLCB1aW50IFBsYXllck51bWJlcik7ICAgICAgDQogICAgLyogb3V0cHV0IHRvIHdlYjMgVUkgb24gYmV0IHJlc3VsdCovDQogICAgLyogU3RhdHVzOiAwPWxvc2UsIDE9d2luLCAyPXdpbiArIGZhaWxlZCBzZW5kLCAzPXJlZnVuZCwgND1yZWZ1bmQgKyBmYWlsZWQgc2VuZCovDQoJZXZlbnQgTG9nUmVzdWx0KHVpbnQgaW5kZXhlZCBSZXN1bHRTZXJpYWxOdW1iZXIsIGJ5dGVzMzIgaW5kZXhlZCBCZXRJRCwgYWRkcmVzcyBpbmRleGVkIFBsYXllckFkZHJlc3MsIHVpbnQgUGxheWVyTnVtYmVyLCB1aW50IERpY2VSZXN1bHQsIHVpbnQgVmFsdWUsIGludCBTdGF0dXMsIGJ5dGVzIFByb29mKTsgICANCiAgICAvKiBsb2cgbWFudWFsIHJlZnVuZHMgKi8NCiAgICBldmVudCBMb2dSZWZ1bmQoYnl0ZXMzMiBpbmRleGVkIEJldElELCBhZGRyZXNzIGluZGV4ZWQgUGxheWVyQWRkcmVzcywgdWludCBpbmRleGVkIFJlZnVuZFZhbHVlKTsNCiAgICAvKiBsb2cgb3duZXIgdHJhbnNmZXJzICovDQogICAgZXZlbnQgTG9nT3duZXJUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgU2VudFRvQWRkcmVzcywgdWludCBpbmRleGVkIEFtb3VudFRyYW5zZmVycmVkKTsgICAgICAgICAgICAgICANCg0KDQogICAgLyoNCiAgICAgKiBpbml0DQogICAgKi8NCiAgICBmdW5jdGlvbiBFdGhlcm9sbCgpIHsNCg0KICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogICAgICAgIHRyZWFzdXJ5ID0gbXNnLnNlbmRlcjsNCiAgICAgICAgDQogICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOyAgICAgICAgDQogICAgICAgIC8qIHVzZSBUTFNOb3RhcnkgZm9yIG9yYWNsaXplIGNhbGwgKi8NCgkJb3JhY2xpemVfc2V0UHJvb2YocHJvb2ZUeXBlX1RMU05vdGFyeSB8IHByb29mU3RvcmFnZV9JUEZTKTsNCiAgICAgICAgLyogaW5pdCA5OTAgPSA5OSUgKDElIGhvdXNlRWRnZSkqLw0KICAgICAgICBvd25lclNldEhvdXNlRWRnZSg5OTApOw0KICAgICAgICAvKiBpbml0IDEwLDAwMCA9IDElICAqLw0KICAgICAgICBvd25lclNldE1heFByb2ZpdEFzUGVyY2VudE9mSG91c2UoMTAwMDApOw0KICAgICAgICAvKiBpbml0IG1pbiBiZXQgKDAuMSBldGhlcikgKi8NCiAgICAgICAgb3duZXJTZXRNaW5CZXQoMTAwMDAwMDAwMDAwMDAwMDAwKTsgICAgICAgIA0KICAgICAgICAvKiBpbml0IGdhcyBmb3Igb3JhY2xpemUgKi8gICAgICAgIA0KICAgICAgICBnYXNGb3JPcmFjbGl6ZSA9IDI1MDAwMDsgICAgICAgIA0KDQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBwdWJsaWMgZnVuY3Rpb24NCiAgICAgKiBwbGF5ZXIgc3VibWl0IGJldA0KICAgICAqIG9ubHkgaWYgZ2FtZSBpcyBhY3RpdmUgJiBiZXQgaXMgdmFsaWQgY2FuIHF1ZXJ5IG9yYWNsaXplIGFuZCBzZXQgcGxheWVyIHZhcnMgICAgIA0KICAgICovDQogICAgZnVuY3Rpb24gcGxheWVyUm9sbERpY2UodWludCByb2xsVW5kZXIpIHB1YmxpYyANCiAgICAgICAgcGF5YWJsZQ0KICAgICAgICBnYW1lSXNBY3RpdmUNCiAgICAgICAgYmV0SXNWYWxpZChtc2cudmFsdWUsIHJvbGxVbmRlcikNCgl7ICAgICAgICANCiAgICAgICAgDQogICAgICAgIC8qDQogICAgICAgICogYXNzaWduIHBhcnRpYWxseSBlbmNyeXB0ZWQgcXVlcnkgdG8gb3JhY2xpemUNCiAgICAgICAgKiBvbmx5IHRoZSBhcGlLZXkgaXMgZW5jcnlwdGVkIA0KICAgICAgICAqIGludGVnZXIgcXVlcnkgaXMgaW4gcGxhaW4gdGV4dA0KICAgICAgICAqLw0KICAgICAgICBieXRlczMyIHJuZ0lkID0gb3JhY2xpemVfcXVlcnkoIm5lc3RlZCIsICJbVVJMXSBbJ2pzb24oaHR0cHM6Ly9hcGkucmFuZG9tLm9yZy9qc29uLXJwYy8xL2ludm9rZSkucmVzdWx0LnJhbmRvbVtcInNlcmlhbE51bWJlclwiLFwiZGF0YVwiXScsICdcXG57XCJqc29ucnBjXCI6XCIyLjBcIixcIm1ldGhvZFwiOlwiZ2VuZXJhdGVTaWduZWRJbnRlZ2Vyc1wiLFwicGFyYW1zXCI6e1wiYXBpS2V5XCI6JHtbZGVjcnlwdF0gQktqaGxtNlNmWUo3OWhXV215d1BXZHdhRkhaQ1U5eUJhdlFjbkRMYWpmOENieG85VzZ6OEtObnptUysvMGhtb05UbkJSWnhTZ0FDTGxJZ2hIK1ptNjVFQWhKQ3NFNnEvVzVZbFI1NW8rSGJHV3lNRWkwbzVuZ0t5MU10VWk0OWVnNEhoZWxFTnpETU1FeW5DM2VZNlNlSmVRTmU0TnNFPX0sXCJuXCI6MSxcIm1pblwiOjEsXCJtYXhcIjoxMDAsXCJyZXBsYWNlbWVudFwiOnRydWUsXCJiYXNlXCI6MTAke1tpZGVudGl0eV0gXCJ9XCJ9LFwiaWRcIjoxJHtbaWRlbnRpdHldIFwifVwifSddIiwgZ2FzRm9yT3JhY2xpemUpOw0KICAgICAgICANCiAgICAgICAgLyogc2FmZWx5IHVwZGF0ZSBjb250cmFjdCBiYWxhbmNlIHRvIGFjY291bnQgZm9yIGNvc3QgdG8gY2FsbCBvcmFjbGl6ZSovDQogICAgICAgIGNvbnRyYWN0QmFsYW5jZSAtPSA1NzI0NTkwMTYzOTM0NDsJICAgICAgICANCiAgICAgICAgLyogdG90YWwgbnVtYmVyIG9mIGJldHMgKi8NCiAgICAgICAgdG90YWxCZXRzICs9IDE7DQogICAgICAgIC8qIG1hcCBiZXQgaWQgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLw0KCQlwbGF5ZXJCZXRJZFtybmdJZF0gPSBybmdJZDsNCiAgICAgICAgLyogbWFwIHBsYXllciBsdWNreSBudW1iZXIgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLw0KCQlwbGF5ZXJOdW1iZXJbcm5nSWRdID0gcm9sbFVuZGVyOw0KICAgICAgICAvKiBtYXAgdmFsdWUgb2Ygd2FnZXIgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLw0KICAgICAgICBwbGF5ZXJCZXRWYWx1ZVtybmdJZF0gPSBtc2cudmFsdWU7DQogICAgICAgIC8qIG1hcCBwbGF5ZXIgYWRkcmVzcyB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovDQogICAgICAgIHBsYXllckFkZHJlc3Nbcm5nSWRdID0gbXNnLnNlbmRlcjsNCiAgICAgICAgLyogc2FmZWx5IG1hcCBwbGF5ZXIgcHJvZml0IHRvIHRoaXMgb3JhY2xpemUgcXVlcnkgKi8gICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgcGxheWVyUHJvZml0W3JuZ0lkXSA9ICgoKChtc2cudmFsdWUgKiAoMTAwLShzYWZlU3ViKHJvbGxVbmRlciwxKSkpKSAvIChzYWZlU3ViKHJvbGxVbmRlciwxKSkrbXNnLnZhbHVlKSkqaG91c2VFZGdlL2hvdXNlRWRnZURpdmlzb3IpLW1zZy52YWx1ZTsgICAgICAgIA0KICAgICAgICAvKiBzYWZlbHkgaW5jcmVhc2UgbWF4UGVuZGluZ1BheW91dHMgbGlhYmlsaXR5IC0gY2FsYyBhbGwgcGVuZGluZyBwYXlvdXRzIHVuZGVyIGFzc3VtcHRpb24gdGhleSB3aW4gKi8NCiAgICAgICAgbWF4UGVuZGluZ1BheW91dHMgPSBzYWZlQWRkKG1heFBlbmRpbmdQYXlvdXRzLCBwbGF5ZXJQcm9maXRbcm5nSWRdKTsNCiAgICAgICAgLyogY2hlY2sgY29udHJhY3QgY2FuIHBheW91dCBvbiB3aW4gKi8NCiAgICAgICAgaWYobWF4UGVuZGluZ1BheW91dHMgPj0gY29udHJhY3RCYWxhbmNlKSB0aHJvdzsNCiAgICAgICAgLyogcHJvdmlkZXMgYWNjdXJhdGUgbnVtYmVycyBmb3Igd2ViMyBhbmQgYWxsb3dzIGZvciBtYW51YWwgcmVmdW5kcyBpbiBjYXNlIG9mIG5vIG9yYWNsaXplIF9fY2FsbGJhY2sgKi8NCiAgICAgICAgTG9nQmV0KHBsYXllckJldElkW3JuZ0lkXSwgcGxheWVyQWRkcmVzc1tybmdJZF0sIHNhZmVBZGQocGxheWVyQmV0VmFsdWVbcm5nSWRdLCBwbGF5ZXJQcm9maXRbcm5nSWRdKSwgcGxheWVyUHJvZml0W3JuZ0lkXSwgcGxheWVyQmV0VmFsdWVbcm5nSWRdLCBwbGF5ZXJOdW1iZXJbcm5nSWRdKTsgICAgICAgICAgDQoNCiAgICB9ICAgDQogICAgICAgICAgICAgDQoNCiAgICAvKg0KICAgICogc2VtaS1wdWJsaWMgZnVuY3Rpb24gLSBvbmx5IG9yYWNsaXplIGNhbiBjYWxsDQogICAgKi8NCiAgICAvKlRMU05vdGFyeSBmb3Igb3JhY2xpemUgY2FsbCAqLw0KCWZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgcHVibGljICAgDQoJCW9ubHlPcmFjbGl6ZQ0KCQlwYXlvdXRzQXJlQWN0aXZlDQoJeyAgDQoNCiAgICAgICAgLyogcGxheWVyIGFkZHJlc3MgbWFwcGVkIHRvIHF1ZXJ5IGlkIGRvZXMgbm90IGV4aXN0ICovDQogICAgICAgIGlmIChwbGF5ZXJBZGRyZXNzW215aWRdPT0weDApIHRocm93Ow0KICAgICAgICANCiAgICAgICAgLyoga2VlcCBvcmFjbGl6ZSBob25lc3QgYnkgcmV0cmlldmluZyB0aGUgc2VyaWFsTnVtYmVyIGZyb20gcmFuZG9tLm9yZyByZXN1bHQgKi8NCiAgICAgICAgdmFyIHNsX3Jlc3VsdCA9IHJlc3VsdC50b1NsaWNlKCk7DQogICAgICAgIHNsX3Jlc3VsdC5iZXlvbmQoIlsiLnRvU2xpY2UoKSkudW50aWwoIl0iLnRvU2xpY2UoKSk7DQogICAgICAgIHVpbnQgc2VyaWFsTnVtYmVyT2ZSZXN1bHQgPSBwYXJzZUludChzbF9yZXN1bHQuc3BsaXQoJywgJy50b1NsaWNlKCkpLnRvU3RyaW5nKCkpOyAgICAgICAgICANCg0KCSAgICAvKiBtYXAgcmVzdWx0IHRvIHBsYXllciAqLw0KICAgICAgICBwbGF5ZXJSYW5kb21SZXN1bHRbbXlpZF0gPSBwYXJzZUludChzbF9yZXN1bHQuYmV5b25kKCJbIi50b1NsaWNlKCkpLnVudGlsKCJdIi50b1NsaWNlKCkpLnRvU3RyaW5nKCkpOw0KICAgICAgICANCiAgICAgICAgLyogcHJvZHVjZSBpbnRlZ2VyIGJvdW5kZWQgdG8gMS0xMDAgaW5jbHVzaXZlDQogICAgICAgICogIHZpYSBzaGEzIHJlc3VsdCBmcm9tIHJhbmRvbS5vcmcgYW5kIHByb29mIChJUEZTIGFkZHJlc3Mgb2YgVExTTm90YXJ5IHByb29mKQ0KICAgICAgICAqLw0KICAgICAgICBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0gPSB1aW50KHNoYTMocGxheWVyUmFuZG9tUmVzdWx0W215aWRdLCBwcm9vZikpICUgMTAwICsgMTsNCiAgICAgICAgDQogICAgICAgIC8qIGdldCB0aGUgcGxheWVyQWRkcmVzcyBmb3IgdGhpcyBxdWVyeSBpZCAqLw0KICAgICAgICBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSA9IHBsYXllckFkZHJlc3NbbXlpZF07DQogICAgICAgIC8qIGRlbGV0ZSBwbGF5ZXJBZGRyZXNzIGZvciB0aGlzIHF1ZXJ5IGlkICovDQogICAgICAgIGRlbGV0ZSBwbGF5ZXJBZGRyZXNzW215aWRdOw0KDQogICAgICAgIC8qIG1hcCB0aGUgcGxheWVyUHJvZml0IGZvciB0aGlzIHF1ZXJ5IGlkICovDQogICAgICAgIHBsYXllclRlbXBSZXdhcmRbbXlpZF0gPSBwbGF5ZXJQcm9maXRbbXlpZF07DQogICAgICAgIC8qIHNldCAgcGxheWVyUHJvZml0IGZvciB0aGlzIHF1ZXJ5IGlkIHRvIDAgKi8NCiAgICAgICAgcGxheWVyUHJvZml0W215aWRdID0gMDsgDQoNCiAgICAgICAgLyogc2FmZWx5IHJlZHVjZSBtYXhQZW5kaW5nUGF5b3V0cyBsaWFiaWxpdHkgKi8NCiAgICAgICAgbWF4UGVuZGluZ1BheW91dHMgPSBzYWZlU3ViKG1heFBlbmRpbmdQYXlvdXRzLCBwbGF5ZXJUZW1wUmV3YXJkW215aWRdKTsgICAgICAgICANCg0KICAgICAgICAvKiBtYXAgdGhlIHBsYXllckJldFZhbHVlIGZvciB0aGlzIHF1ZXJ5IGlkICovDQogICAgICAgIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSA9IHBsYXllckJldFZhbHVlW215aWRdOw0KICAgICAgICAvKiBzZXQgIHBsYXllckJldFZhbHVlIGZvciB0aGlzIHF1ZXJ5IGlkIHRvIDAgKi8NCiAgICAgICAgcGxheWVyQmV0VmFsdWVbbXlpZF0gPSAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgIC8qDQogICAgICAgICogcmVmdW5kDQogICAgICAgICogaWYgcmVzdWx0IGZyb20gb3JhY2xpemUgaXMgMCByZWZ1bmQgb25seSB0aGUgb3JpZ2luYWwgYmV0IHZhbHVlDQogICAgICAgICogaWYgcmVmdW5kIGZhaWxzIHNhdmUgcmVmdW5kIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fscw0KICAgICAgICAqLw0KICAgICAgICBpZihwbGF5ZXJEaWVSZXN1bHRbbXlpZF09PTApeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgICBMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgMywgcHJvb2YpOyAgICAgICAgICAgIA0KDQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgKiBzZW5kIHJlZnVuZCAtIGV4dGVybmFsIGNhbGwgdG8gYW4gdW50cnVzdGVkIGNvbnRyYWN0DQogICAgICAgICAgICAqIGlmIHNlbmQgZmFpbHMgbWFwIHJlZnVuZCB2YWx1ZSB0byBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbYWRkcmVzc10NCiAgICAgICAgICAgICogZm9yIHdpdGhkcmF3YWwgbGF0ZXIgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucw0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGlmKCFwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXS5zZW5kKHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSkpew0KICAgICAgICAgICAgICAgIExvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdLCA0LCBwcm9vZik7ICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvKiBpZiBzZW5kIGZhaWxlZCBsZXQgcGxheWVyIHdpdGhkcmF3IHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMgKi8NCiAgICAgICAgICAgICAgICBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dID0gc2FmZUFkZChwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dLCBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0pOyAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvKg0KICAgICAgICAqIHBheSB3aW5uZXINCiAgICAgICAgKiB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSB0byBjYWxjdWxhdGUgbmV3IG1heCBiZXQNCiAgICAgICAgKiBzZW5kIHJld2FyZA0KICAgICAgICAqIGlmIHNlbmQgb2YgcmV3YXJkIGZhaWxzIHNhdmUgdmFsdWUgdG8gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzICAgICAgICANCiAgICAgICAgKi8NCiAgICAgICAgaWYocGxheWVyRGllUmVzdWx0W215aWRdIDwgcGxheWVyTnVtYmVyW215aWRdKXsgDQoNCiAgICAgICAgICAgIC8qIHNhZmVseSByZWR1Y2UgY29udHJhY3QgYmFsYW5jZSBieSBwbGF5ZXIgcHJvZml0ICovDQogICAgICAgICAgICBjb250cmFjdEJhbGFuY2UgPSBzYWZlU3ViKGNvbnRyYWN0QmFsYW5jZSwgcGxheWVyVGVtcFJld2FyZFtteWlkXSk7IA0KDQogICAgICAgICAgICAvKiB1cGRhdGUgdG90YWwgd2VpIHdvbiAqLw0KICAgICAgICAgICAgdG90YWxXZWlXb24gPSBzYWZlQWRkKHRvdGFsV2VpV29uLCBwbGF5ZXJUZW1wUmV3YXJkW215aWRdKTsgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAvKiBzYWZlbHkgY2FsY3VsYXRlIHBheW91dCB2aWEgcHJvZml0IHBsdXMgb3JpZ2luYWwgd2FnZXIgKi8NCiAgICAgICAgICAgIHBsYXllclRlbXBSZXdhcmRbbXlpZF0gPSBzYWZlQWRkKHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSk7IA0KDQogICAgICAgICAgICBMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIDEsIHByb29mKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIC8qIHVwZGF0ZSBtYXhpbXVtIHByb2ZpdCAqLw0KICAgICAgICAgICAgc2V0TWF4UHJvZml0KCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICAqIHNlbmQgd2luIC0gZXh0ZXJuYWwgY2FsbCB0byBhbiB1bnRydXN0ZWQgY29udHJhY3QNCiAgICAgICAgICAgICogaWYgc2VuZCBmYWlscyBtYXAgcmV3YXJkIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1thZGRyZXNzXQ0KICAgICAgICAgICAgKiBmb3Igd2l0aGRyYXdhbCBsYXRlciB2aWEgcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zDQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgaWYoIXBsYXllclRlbXBBZGRyZXNzW215aWRdLnNlbmQocGxheWVyVGVtcFJld2FyZFtteWlkXSkpew0KICAgICAgICAgICAgICAgIExvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcFJld2FyZFtteWlkXSwgMiwgcHJvb2YpOyAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvKiBpZiBzZW5kIGZhaWxlZCBsZXQgcGxheWVyIHdpdGhkcmF3IHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMgKi8NCiAgICAgICAgICAgICAgICBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dID0gc2FmZUFkZChwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dLCBwbGF5ZXJUZW1wUmV3YXJkW215aWRdKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICB9DQoNCiAgICAgICAgLyoNCiAgICAgICAgKiBubyB3aW4NCiAgICAgICAgKiBzZW5kIDEgd2VpIHRvIGEgbG9zaW5nIGJldA0KICAgICAgICAqIHVwZGF0ZSBjb250cmFjdCBiYWxhbmNlIHRvIGNhbGN1bGF0ZSBuZXcgbWF4IGJldA0KICAgICAgICAqLw0KICAgICAgICBpZihwbGF5ZXJEaWVSZXN1bHRbbXlpZF0gPj0gcGxheWVyTnVtYmVyW215aWRdKXsNCg0KICAgICAgICAgICAgTG9nUmVzdWx0KHNlcmlhbE51bWJlck9mUmVzdWx0LCBwbGF5ZXJCZXRJZFtteWlkXSwgcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0sIHBsYXllck51bWJlcltteWlkXSwgcGxheWVyRGllUmVzdWx0W215aWRdLCBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0sIDAsIHByb29mKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAvKiAgDQogICAgICAgICAgICAqICBzYWZlIGFkanVzdCBjb250cmFjdEJhbGFuY2UNCiAgICAgICAgICAgICogIHNldE1heFByb2ZpdA0KICAgICAgICAgICAgKiAgc2VuZCAxIHdlaSB0byBsb3NpbmcgYmV0DQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgY29udHJhY3RCYWxhbmNlID0gc2FmZUFkZChjb250cmFjdEJhbGFuY2UsIChwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0tMSkpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgLyogdXBkYXRlIG1heGltdW0gcHJvZml0ICovDQogICAgICAgICAgICBzZXRNYXhQcm9maXQoKTsgDQoNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICAqIHNlbmQgMSB3ZWkgLSBleHRlcm5hbCBjYWxsIHRvIGFuIHVudHJ1c3RlZCBjb250cmFjdCAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGlmKCFwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXS5zZW5kKDEpKXsNCiAgICAgICAgICAgICAgICAvKiBpZiBzZW5kIGZhaWxlZCBsZXQgcGxheWVyIHdpdGhkcmF3IHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMgKi8gICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dID0gc2FmZUFkZChwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dLCAxKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICB9DQoNCiAgICB9DQogICAgDQogICAgLyoNCiAgICAqIHB1YmxpYyBmdW5jdGlvbg0KICAgICogaW4gY2FzZSBvZiBhIGZhaWxlZCByZWZ1bmQgb3Igd2luIHNlbmQNCiAgICAqLw0KICAgIGZ1bmN0aW9uIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucygpIHB1YmxpYyANCiAgICAgICAgcGF5b3V0c0FyZUFjdGl2ZQ0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgICB7DQogICAgICAgIHVpbnQgd2l0aGRyYXdBbW91bnQgPSBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl07DQogICAgICAgIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXSA9IDA7DQogICAgICAgIC8qIGV4dGVybmFsIGNhbGwgdG8gdW50cnVzdGVkIGNvbnRyYWN0ICovDQogICAgICAgIGlmIChtc2cuc2VuZGVyLmNhbGwudmFsdWUod2l0aGRyYXdBbW91bnQpKCkpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLyogaWYgc2VuZCBmYWlsZWQgcmV2ZXJ0IHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXSA9IDA7ICovDQogICAgICAgICAgICAvKiBwbGF5ZXIgY2FuIHRyeSB0byB3aXRoZHJhdyBhZ2FpbiBsYXRlciAqLw0KICAgICAgICAgICAgcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdID0gd2l0aGRyYXdBbW91bnQ7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKiBjaGVjayBmb3IgcGVuZGluZyB3aXRoZHJhd2FscyAgKi8NCiAgICBmdW5jdGlvbiBwbGF5ZXJHZXRQZW5kaW5nVHhCeUFkZHJlc3MoYWRkcmVzcyBhZGRyZXNzVG9DaGVjaykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1thZGRyZXNzVG9DaGVja107DQogICAgfQ0KDQogICAgLyoNCiAgICAqIGludGVybmFsIGZ1bmN0aW9uDQogICAgKiBzZXRzIG1heCBwcm9maXQNCiAgICAqLw0KICAgIGZ1bmN0aW9uIHNldE1heFByb2ZpdCgpIGludGVybmFsIHsNCiAgICAgICAgbWF4UHJvZml0ID0gKGNvbnRyYWN0QmFsYW5jZSptYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlKS9tYXhQcm9maXREaXZpc29yOyAgDQogICAgfSAgIA0KDQogICAgLyoNCiAgICAqIG93bmVyL3RyZWFzdXJ5IGFkZHJlc3Mgb25seSBmdW5jdGlvbnMNCiAgICAqLw0KICAgIGZ1bmN0aW9uICgpDQogICAgICAgIHBheWFibGUNCiAgICAgICAgb25seVRyZWFzdXJ5DQogICAgew0KICAgICAgICAvKiBzYWZlbHkgdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2UgKi8NCiAgICAgICAgY29udHJhY3RCYWxhbmNlID0gc2FmZUFkZChjb250cmFjdEJhbGFuY2UsIG1zZy52YWx1ZSk7ICAgICAgICANCiAgICAgICAgLyogdXBkYXRlIHRoZSBtYXhpbXVtIHByb2ZpdCAqLw0KICAgICAgICBzZXRNYXhQcm9maXQoKTsNCiAgICB9IA0KDQogICAgLyogc2V0IGdhcyBmb3Igb3JhY2xpemUgcXVlcnkgKi8NCiAgICBmdW5jdGlvbiBvd25lclNldE9yYWNsaXplU2FmZUdhcyh1aW50MzIgbmV3U2FmZUdhc1RvT3JhY2xpemUpIHB1YmxpYyANCgkJb25seU93bmVyDQoJew0KICAgIAlnYXNGb3JPcmFjbGl6ZSA9IG5ld1NhZmVHYXNUb09yYWNsaXplOw0KICAgIH0NCg0KICAgIC8qIHNldCBob3VzZSBjb3N0IHRvIGNhbGwgb3JhY2xpemUgcXVlcnkgKi8NCiAgICBmdW5jdGlvbiBvd25lclVwZGF0ZUNvc3RUb0NhbGxPcmFjbGl6ZSh1aW50IG5ld0Nvc3RUb0NhbGxPcmFjbGl6ZUluV2VpKSBwdWJsaWMgDQoJCW9ubHlPd25lcg0KICAgIHsgICAgICAgIA0KICAgICAgIGNvc3RUb0NhbGxPcmFjbGl6ZUluV2VpID0gbmV3Q29zdFRvQ2FsbE9yYWNsaXplSW5XZWk7DQogICAgfSAgICAgDQoNCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBob3VzZUVkZ2UgKi8NCiAgICBmdW5jdGlvbiBvd25lclNldEhvdXNlRWRnZSh1aW50IG5ld0hvdXNlRWRnZSkgcHVibGljIA0KCQlvbmx5T3duZXINCiAgICB7DQogICAgICAgIGhvdXNlRWRnZSA9IG5ld0hvdXNlRWRnZTsNCiAgICB9DQoNCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBtYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlICovDQogICAgZnVuY3Rpb24gb3duZXJTZXRNYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlKHVpbnQgbmV3TWF4UHJvZml0QXNQZXJjZW50KSBwdWJsaWMgDQoJCW9ubHlPd25lcg0KICAgIHsNCiAgICAgICAgLyogcmVzdHJpY3QgZWFjaCBiZXQgdG8gYSBtYXhpbXVtIHByb2ZpdCBvZiAxJSBjb250cmFjdEJhbGFuY2UgKi8NCiAgICAgICAgaWYobmV3TWF4UHJvZml0QXNQZXJjZW50ID4gMTAwMDApIHRocm93Ow0KICAgICAgICBtYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlID0gbmV3TWF4UHJvZml0QXNQZXJjZW50Ow0KICAgICAgICBzZXRNYXhQcm9maXQoKTsNCiAgICB9DQoNCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBtaW5CZXQgKi8NCiAgICBmdW5jdGlvbiBvd25lclNldE1pbkJldCh1aW50IG5ld01pbmltdW1CZXQpIHB1YmxpYyANCgkJb25seU93bmVyDQogICAgew0KICAgICAgICBtaW5CZXQgPSBuZXdNaW5pbXVtQmV0Ow0KICAgIH0gICAgICAgDQoNCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHRyYW5zZmVyIGV0aGVyICovDQogICAgZnVuY3Rpb24gb3duZXJUcmFuc2ZlckV0aGVyKGFkZHJlc3Mgc2VuZFRvLCB1aW50IGFtb3VudCkgcHVibGljIA0KCQlvbmx5T3duZXINCiAgICB7ICAgICAgICANCiAgICAgICAgLyogc2FmZWx5IHVwZGF0ZSBjb250cmFjdCBiYWxhbmNlIHdoZW4gc2VuZGluZyBvdXQgZnVuZHMqLw0KICAgICAgICBjb250cmFjdEJhbGFuY2UgPSBzYWZlU3ViKGNvbnRyYWN0QmFsYW5jZSwgYW1vdW50KTsJCQ0KICAgICAgICAvKiB1cGRhdGUgbWF4IHByb2ZpdCAqLw0KICAgICAgICBzZXRNYXhQcm9maXQoKTsNCiAgICAgICAgaWYoIXNlbmRUby5zZW5kKGFtb3VudCkpIHRocm93Ow0KICAgICAgICBMb2dPd25lclRyYW5zZmVyKHNlbmRUbywgYW1vdW50KTsgDQogICAgfQ0KDQogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBkbyBtYW51YWwgcmVmdW5kDQogICAgKiB1c2VkIG9ubHkgaWYgYmV0IHBsYWNlZCArIG9yYWNsaXplIGZhaWxlZCB0byBfX2NhbGxiYWNrDQogICAgKiBmaWx0ZXIgTG9nQmV0IGJ5IGFkZHJlc3MgYW5kL29yIHBsYXllckJldElkOg0KICAgICogTG9nQmV0KHBsYXllckJldElkW3JuZ0lkXSwgcGxheWVyQWRkcmVzc1tybmdJZF0sIHNhZmVBZGQocGxheWVyQmV0VmFsdWVbcm5nSWRdLCBwbGF5ZXJQcm9maXRbcm5nSWRdKSwgcGxheWVyUHJvZml0W3JuZ0lkXSwgcGxheWVyQmV0VmFsdWVbcm5nSWRdLCBwbGF5ZXJOdW1iZXJbcm5nSWRdKTsNCiAgICAqIGNoZWNrIHRoZSBmb2xsb3dpbmcgbG9ncyBkbyBub3QgZXhpc3QgZm9yIHBsYXllckJldElkIGFuZC9vciBwbGF5ZXJBZGRyZXNzW3JuZ0lkXSBiZWZvcmUgcmVmdW5kaW5nOg0KICAgICogTG9nUmVzdWx0IG9yIExvZ1JlZnVuZA0KICAgICogaWYgTG9nUmVzdWx0IGV4aXN0cyBwbGF5ZXIgc2hvdWxkIHVzZSB0aGUgd2l0aGRyYXcgcGF0dGVybiBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMgDQogICAgKi8NCiAgICBmdW5jdGlvbiBvd25lclJlZnVuZFBsYXllcihieXRlczMyIG9yaWdpbmFsUGxheWVyQmV0SWQsIGFkZHJlc3Mgc2VuZFRvLCB1aW50IG9yaWdpbmFsUGxheWVyUHJvZml0LCB1aW50IG9yaWdpbmFsUGxheWVyQmV0VmFsdWUpIHB1YmxpYyANCgkJb25seU93bmVyDQogICAgeyAgICAgICAgDQogICAgICAgIC8qIHNhZmVseSByZWR1Y2UgcGVuZGluZ1BheW91dHMgYnkgcGxheWVyUHJvZml0W3JuZ0lkXSAqLw0KICAgICAgICBtYXhQZW5kaW5nUGF5b3V0cyA9IHNhZmVTdWIobWF4UGVuZGluZ1BheW91dHMsIG9yaWdpbmFsUGxheWVyUHJvZml0KTsNCiAgICAgICAgLyogc2VuZCByZWZ1bmQgKi8NCiAgICAgICAgaWYoIXNlbmRUby5zZW5kKG9yaWdpbmFsUGxheWVyQmV0VmFsdWUpKSB0aHJvdzsNCiAgICAgICAgLyogbG9nIHJlZnVuZHMgKi8NCiAgICAgICAgTG9nUmVmdW5kKG9yaWdpbmFsUGxheWVyQmV0SWQsIHNlbmRUbywgb3JpZ2luYWxQbGF5ZXJCZXRWYWx1ZSk7ICAgICAgICANCiAgICB9ICAgIA0KDQogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgZW1lcmdlbmN5IHBhdXNlICMxICovDQogICAgZnVuY3Rpb24gb3duZXJQYXVzZUdhbWUoYm9vbCBuZXdTdGF0dXMpIHB1YmxpYyANCgkJb25seU93bmVyDQogICAgew0KCQlnYW1lUGF1c2VkID0gbmV3U3RhdHVzOw0KICAgIH0NCg0KICAgIC8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IGVtZXJnZW5jeSBwYXVzZSAjMiAqLw0KICAgIGZ1bmN0aW9uIG93bmVyUGF1c2VQYXlvdXRzKGJvb2wgbmV3UGF5b3V0U3RhdHVzKSBwdWJsaWMgDQoJCW9ubHlPd25lcg0KICAgIHsNCgkJcGF5b3V0c1BhdXNlZCA9IG5ld1BheW91dFN0YXR1czsNCiAgICB9IA0KDQogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgdHJlYXN1cnkgYWRkcmVzcyAqLw0KICAgIGZ1bmN0aW9uIG93bmVyU2V0VHJlYXN1cnkoYWRkcmVzcyBuZXdUcmVhc3VyeSkgcHVibGljIA0KCQlvbmx5T3duZXINCgl7DQogICAgICAgIHRyZWFzdXJ5ID0gbmV3VHJlYXN1cnk7DQogICAgfSAgICAgICAgIA0KDQogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgb3duZXIgYWRkcmVzcyAqLw0KICAgIGZ1bmN0aW9uIG93bmVyQ2hhbmdlT3duZXIoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIA0KCQlvbmx5T3duZXINCgl7DQogICAgICAgIG93bmVyID0gbmV3T3duZXI7DQogICAgfQ0KDQogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzdWljaWRlIC0gZW1lcmdlbmN5ICovDQogICAgZnVuY3Rpb24gb3duZXJraWxsKCkgcHVibGljIA0KCQlvbmx5T3duZXINCgl7DQoJCXN1aWNpZGUob3duZXIpOw0KCX0gICAgDQoNCg0KfQ=='