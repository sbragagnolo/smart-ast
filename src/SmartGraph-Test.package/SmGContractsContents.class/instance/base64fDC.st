base 64 content
base64fDC
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC42Ow0KDQovLyBpbXBvcnQgIlRva2VuVHJhY2tlci5zb2wiOw0KDQovKioNCiAqIHRpdGxlOiAgQSBjb250cmFjdCB0aGF0IHRyYWNrcyBudW1iZXJzIG9mIHRva2VucyBhc3NpZ25lZCB0byBhZGRyZXNzZXMuIA0KICogYXV0aG9yOiBUaW1vIEhhbmtlIA0KICoNCiAqIE9wdGlvbmFsbHksIGFzc2lnbm1lbnRzIGNhbiBiZSBjaG9zZW4gdG8gYmUgb2YgInJlc3RyaWN0ZWQgdHlwZSIuIA0KICogQmVpbmcgInJlc3RyaWN0ZWQiIG1lYW5zIHRoYXQgdGhlIHRva2VuIGFzc2lnbm1lbnQgbWF5IGxhdGVyIGJlIHBhcnRpYWxseQ0KICogcmV2ZXJ0ZWQgKG9yIHRoZSB0b2tlbnMgImJ1cm5lZCIpIGJ5IHRoZSBjb250cmFjdC4gDQogKg0KICogQWZ0ZXIgYWxsIHRva2VuIGFzc2lnbm1lbnRzIGFyZSBjb21wbGV0ZWQgdGhlIGNvbnRyYWN0DQogKiAgIC0gYnVybnMgc29tZSByZXN0cmljdGVkIHRva2Vucw0KICogICAtIHJlbGVhc2VzIHRoZSByZXN0cmljdGlvbiBvbiB0aGUgcmVtYWluaW5nIHRva2Vucw0KICogVGhlIHBlcmNlbnRhZ2Ugb2YgdG9rZW5zIHRoYXQgYnVybmVkIG91dCBvZiBlYWNoIGFzc2lnbm1lbnQgb2YgcmVzdHJpY3RlZA0KICogdG9rZW5zIGlzIGNhbGN1bGF0ZWQgdG8gYWNoaWV2ZSB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbjoNCiAqICAgLSB0aGUgcmVtYWluaW5nIGZvcm1lcmx5IHJlc3RyaWN0ZWQgdG9rZW5zIGNvbWJpbmVkIGhhdmUgYSBwcmUtY29uZmlndXJlZA0KICogICAgIHNoYXJlIChwZXJjZW50YWdlKSBhbW9uZyBhbGwgcmVtYWluaW5nIHRva2Vucy4NCiAqDQogKiBPbmNlIHRoZSBjb252ZXJzaW9uIHByb2Nlc3MgaGFzIHN0YXJ0ZWQgdGhlIGNvbnRyYWN0IGVudGVycyBhIHN0YXRlIGluIHdoaWNoDQogKiBubyBtb3JlIGFzc2lnbm1lbnRzIGNhbiBiZSBtYWRlLg0KICovDQoNCmNvbnRyYWN0IFRva2VuVHJhY2tlciB7DQogIC8vIFNoYXJlIG9mIGZvcm1lcmx5IHJlc3RyaWN0ZWQgdG9rZW5zIGFtb25nIGFsbCB0b2tlbnMgaW4gcGVyY2VudCANCiAgdWludCBwdWJsaWMgcmVzdHJpY3RlZFNoYXJlOyANCg0KICAvLyBNYXBwaW5nIGZyb20gYWRkcmVzcyB0byBudW1iZXIgb2YgdG9rZW5zIGFzc2lnbmVkIHRvIHRoZSBhZGRyZXNzDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgdG9rZW5zOw0KDQogIC8vIE1hcHBpbmcgZnJvbSBhZGRyZXNzIHRvIG51bWJlciBvZiB0b2tlbnMgYXNzaWduZWQgdG8gdGhlIGFkZHJlc3MgdGhhdA0KICAvLyB1bmRlcmx5IGEgcmVzdHJpY3Rpb24NCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyByZXN0cmljdGlvbnM7DQogIA0KICAvLyBUb3RhbCBudW1iZXIgb2YgKHVuKXJlc3RyaWN0ZWQgdG9rZW5zIGN1cnJlbnRseSBpbiBleGlzdGVuY2UNCiAgdWludCBwdWJsaWMgdG90YWxSZXN0cmljdGVkVG9rZW5zOyANCiAgdWludCBwdWJsaWMgdG90YWxVbnJlc3RyaWN0ZWRUb2tlbnM7IA0KICANCiAgLy8gVG90YWwgbnVtYmVyIG9mIGluZGl2aWR1YWwgYXNzaWdubWVudCBjYWxscyBoYXZlIGJlZW4gZm9yICh1bilyZXN0cmljdGVkDQogIC8vIHRva2Vucw0KICB1aW50IHB1YmxpYyB0b3RhbFJlc3RyaWN0ZWRBc3NpZ25tZW50czsgDQogIHVpbnQgcHVibGljIHRvdGFsVW5yZXN0cmljdGVkQXNzaWdubWVudHM7IA0KDQogIC8vIFN0YXRlIGZsYWcuIEFzc2lnbm1lbnRzIGNhbiBvbmx5IGJlIG1hZGUgaWYgZmFsc2UuIA0KICAvLyBTdGFydGluZyB0aGUgY29udmVyc2lvbiAoYnVybikgcHJvY2VzcyBpcnJldmVyc2libHkgc2V0cyB0aGlzIHRvIHRydWUuIA0KICBib29sIHB1YmxpYyBhc3NpZ25tZW50c0Nsb3NlZCA9IGZhbHNlOw0KICANCiAgLy8gVGhlIG11bHRpcGxpZXIgKGRlZmluZWQgYnkgbm9taW5hdG9yIGFuZCBkZW5vbWluYXRvcikgdGhhdCBkZWZpbmVzIHRoZQ0KICAvLyBmcmFjdGlvbiBvZiBhbGwgcmVzdHJpY3RlZCB0b2tlbnMgdG8gYmUgYnVybmVkLiANCiAgLy8gVGhpcyBpcyBjb21wdXRlZCBhZnRlciBhc3NpZ25tZW50cyBoYXZlIGVuZGVkIGFuZCBiZWZvcmUgdGhlIGNvbnZlcnNpb24NCiAgLy8gcHJvY2VzcyBzdGFydHMuDQogIHVpbnQgcHVibGljIGJ1cm5NdWx0RGVuOw0KICB1aW50IHB1YmxpYyBidXJuTXVsdE5vbTsNCg0KICBmdW5jdGlvbiBUb2tlblRyYWNrZXIodWludCBfcmVzdHJpY3RlZFNoYXJlKSB7DQogICAgLy8gVGhyb3cgaWYgcmVzdHJpY3RlZCBzaGFyZSA+PSAxMDANCiAgICBpZiAoX3Jlc3RyaWN0ZWRTaGFyZSA+PSAxMDApIHsgdGhyb3c7IH0NCiAgICANCiAgICByZXN0cmljdGVkU2hhcmUgPSBfcmVzdHJpY3RlZFNoYXJlOw0KICB9DQogIA0KICAvKiogDQogICAqIFBVQkxJQyBmdW5jdGlvbnMNCiAgICoNCiAgICogIC0gaXNVbnJlc3RyaWN0ZWQgKGdldHRlcikNCiAgICogIC0gbXVsdEZyYWNDZWlsaW5nIChsaWJyYXJ5IGZ1bmN0aW9uKQ0KICAgKiAgLSBpc1JlZ2lzdGVyZWQoYWRkcikgKGdldHRlcikNCiAgICovDQogIA0KICAvKioNCiAgICogUmV0dXJuIHRydWUgaWZmIHRoZSBhc3NpZ25tZW50cyBhcmUgY2xvc2VkIGFuZCB0aGVyZSBhcmUgbm8gcmVzdHJpY3RlZA0KICAgKiB0b2tlbnMgbGVmdCANCiAgICovDQogIGZ1bmN0aW9uIGlzVW5yZXN0cmljdGVkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiAoYXNzaWdubWVudHNDbG9zZWQgJiYgdG90YWxSZXN0cmljdGVkVG9rZW5zID09IDApOw0KICB9DQoNCiAgLyoqDQogICAqIFJldHVybiB0aGUgY2VpbGluZyBvZiAoeCphKS9iDQogICAqDQogICAqIEVkZ2UgY2FzZXM6DQogICAqICAgYSA9IDA6IHJldHVybiAwDQogICAqICAgYiA9IDAsIGEgIT0gMDogZXJyb3IgKHNvbGlkaXR5IHRocm93cyBvbiBkaXZpc2lvbiBieSAwKQ0KICAgKi8NCiAgZnVuY3Rpb24gbXVsdEZyYWNDZWlsaW5nKHVpbnQgeCwgdWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsNCiAgICAvLyBDYXRjaCB0aGUgY2FzZSBhID0gMA0KICAgIGlmIChhID09IDApIHsgcmV0dXJuIDA7IH0NCiAgICANCiAgICAvLyBSb3VuZGluZyB1cCBpcyB0aGUgc2FtZSBhcyBhZGRpbmcgMS1lcHNpbG9uIGFuZCByb3VuZGluZyBkb3duLg0KICAgIC8vIDEtZXBzaWxvbiBpcyBtb2RlbGVkIGFzIChiLTEpL2IgYmVsb3cuDQogICAgcmV0dXJuICh4ICogYSArIChiIC0gMSkpIC8gYjsgDQogIH0NCiAgICANCiAgLyoqDQogICAqIFJldHVybiB0cnVlIGlmZiB0aGUgYWRkcmVzcyBoYXMgdG9rZW5zIGFzc2lnbmVkIChyZXNwLiByZXN0cmljdGVkIHRva2VucykNCiAgICovDQogIGZ1bmN0aW9uIGlzUmVnaXN0ZXJlZChhZGRyZXNzIGFkZHIsIGJvb2wgcmVzdHJpY3RlZCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIGlmIChyZXN0cmljdGVkKSB7DQogICAgICByZXR1cm4gKHJlc3RyaWN0aW9uc1thZGRyXSA+IDApOw0KICAgIH0gZWxzZSB7DQogICAgICByZXR1cm4gKHRva2Vuc1thZGRyXSA+IDApOw0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBJTlRFUk5BTCBmdW5jdGlvbnMNCiAgICoNCiAgICogIC0gYXNzaWduDQogICAqICAtIGNsb3NlQXNzaWdubWVudHMgDQogICAqICAtIHVucmVzdHJpY3QgDQogICAqLw0KICAgDQogIC8qKg0KICAgKiBBc3NpZ24gKHVuKXJlc3RyaWN0ZWQgdG9rZW5zIHRvIGdpdmVuIGFkZHJlc3MNCiAgICovDQogIGZ1bmN0aW9uIGFzc2lnbihhZGRyZXNzIGFkZHIsIHVpbnQgdG9rZW5BbW91bnQsIGJvb2wgcmVzdHJpY3RlZCkgaW50ZXJuYWwgew0KICAgIC8vIFRocm93IGlmIGFzc2lnbm1lbnRzIGhhdmUgYmVlbiBjbG9zZWQNCiAgICBpZiAoYXNzaWdubWVudHNDbG9zZWQpIHsgdGhyb3c7IH0NCg0KICAgIC8vIEFzc2lnbiB0b2tlbnMNCiAgICB0b2tlbnNbYWRkcl0gKz0gdG9rZW5BbW91bnQ7DQoNCiAgICAvLyBSZWNvcmQgcmVzdHJpY3Rpb25zIGFuZCB1cGRhdGUgdG90YWwgY291bnRlcnMNCiAgICBpZiAocmVzdHJpY3RlZCkgew0KICAgICAgdG90YWxSZXN0cmljdGVkVG9rZW5zICs9IHRva2VuQW1vdW50Ow0KICAgICAgdG90YWxSZXN0cmljdGVkQXNzaWdubWVudHMgKz0gMTsNCiAgICAgIHJlc3RyaWN0aW9uc1thZGRyXSArPSB0b2tlbkFtb3VudDsNCiAgICB9IGVsc2Ugew0KICAgICAgdG90YWxVbnJlc3RyaWN0ZWRUb2tlbnMgKz0gdG9rZW5BbW91bnQ7DQogICAgICB0b3RhbFVucmVzdHJpY3RlZEFzc2lnbm1lbnRzICs9IDE7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIENsb3NlIGZ1dHVyZSBhc3NpZ25tZW50cy4NCiAgICoNCiAgICogVGhpcyBpcyBpcnJldmVyc2libGUgYW5kIGNsb3NlcyBhbGwgZnV0dXJlIGFzc2lnbm1lbnRzLg0KICAgKiBUaGUgZnVuY3Rpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uY2UuDQogICAqDQogICAqIEEgY2FsbCB0cmlnZ2VycyB0aGUgY2FsY3VsYXRpb24gb2Ygd2hhdCBmcmFjdGlvbiBvZiByZXN0cmljdGVkIHRva2Vucw0KICAgKiBzaG91bGQgYmUgYnVybmVkIGJ5IHN1YnNlcXVlbnQgY2FsbHMgdG8gdGhlIHVucmVzdHJpY3QoKSBmdW5jdGlvbi4NCiAgICogVGhlIHJlc3VsdCBvZiB0aGlzIGNhbGN1bGF0aW9uIGlzIGEgbXVsdGlwbGljYXRpb24gZmFjdG9yIHdob3NlIG5vbWluYXRvcg0KICAgKiBhbmQgZGVub21pbmF0b3IgYXJlIHN0b3JlZCBpbiB0aGUgY29udHJhY3QgdmFyaWFibGVzIGJ1cm5NdWx0Tm9tLA0KICAgKiBidXJuTXVsdERlbi4NCiAgICovDQogIGZ1bmN0aW9uIGNsb3NlQXNzaWdubWVudHNJZk9wZW4oKSBpbnRlcm5hbCB7DQogICAgLy8gUmV0dXJuIGlmIGFzc2lnbm1lbnRzIGFyZSBub3Qgb3Blbg0KICAgIGlmIChhc3NpZ25tZW50c0Nsb3NlZCkgeyByZXR1cm47IH0gDQogICAgDQogICAgLy8gU2V0IHRoZSBzdGF0ZSB0byAiY2xvc2VkIg0KICAgIGFzc2lnbm1lbnRzQ2xvc2VkID0gdHJ1ZTsNCg0KICAgIC8qDQogICAgICogIENhbGN1bGF0ZSB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VucyB0aGF0IHNob3VsZCByZW1haW4gYWZ0ZXINCiAgICAgKiAgY29udmVyc2lvbi4gIFRoaXMgaXMgYmFzZWQgb24gdGhlIHRvdGFsIG51bWJlciBvZiB1bnJlc3RyaWN0ZWQgdG9rZW5zDQogICAgICogIGFzc2lnbmVkIHNvIGZhciBhbmQgdGhlIHByZS1jb25maWd1cmVkIHNoYXJlIHRoYXQgdGhlIHJlbWFpbmluZw0KICAgICAqICBmb3JtZXJseSByZXN0cmljdGVkIHRva2VucyBzaG91bGQgaGF2ZS4NCiAgICAgKi8NCiAgICB1aW50IHRvdGFsVG9rZW5zVGFyZ2V0ID0gKHRvdGFsVW5yZXN0cmljdGVkVG9rZW5zICogMTAwKSAvIA0KICAgICAgKDEwMCAtIHJlc3RyaWN0ZWRTaGFyZSk7DQogICAgDQogICAgLy8gVGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMgaW4gZXhpc3RlbmNlIG5vdy4NCiAgICB1aW50IHRvdGFsVG9rZW5zRXhpc3RpbmcgPSB0b3RhbFJlc3RyaWN0ZWRUb2tlbnMgKyB0b3RhbFVucmVzdHJpY3RlZFRva2VuczsNCiAgICAgIA0KICAgIC8qDQogICAgICogVGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMgdGhhdCBuZWVkIHRvIGJlIGJ1cm5lZCB0byBicmluZyB0aGUgZXhpc3RpbmcNCiAgICAgKiBudW1iZXIgZG93biB0byB0aGUgdGFyZ2V0IG51bWJlci4gSWYgdGhlIGV4aXN0aW5nIG51bWJlciBpcyBsb3dlciB0aGFuDQogICAgICogdGhlIHRhcmdldCB0aGVuIHdlIHdvbid0IGJ1cm4gYW55dGhpbmcuDQogICAgICovDQogICAgdWludCB0b3RhbEJ1cm4gPSAwOyANCiAgICBpZiAodG90YWxUb2tlbnNFeGlzdGluZyA+IHRvdGFsVG9rZW5zVGFyZ2V0KSB7DQogICAgICB0b3RhbEJ1cm4gPSB0b3RhbFRva2Vuc0V4aXN0aW5nIC0gdG90YWxUb2tlbnNUYXJnZXQ7IA0KICAgIH0NCg0KICAgIC8vIFRoZSBmcmFjdGlvbiBvZiByZXN0cmljdGVkIHRva2VucyB0byBiZSBidXJuZWQgKGJ5IG5vbWluYXRvciBhbmQNCiAgICAvLyBkZW5vbWluYXRvcikuDQogICAgYnVybk11bHROb20gPSB0b3RhbEJ1cm47DQogICAgYnVybk11bHREZW4gPSB0b3RhbFJlc3RyaWN0ZWRUb2tlbnM7DQogICAgDQogICAgLyoNCiAgICAgKiBGb3IgdmVyaWZ5aW5nIHRoZSBjb3JyZWN0bmVzcyBvZiB0aGUgYWJvdmUgY2FsY3VsYXRpb24gaXQgbWF5IGhlbHAgdG8NCiAgICAgKiBub3RlIHRoZSBmb2xsb3dpbmcuDQogICAgICogR2l2ZW4gMCA8PSByZXN0cmljdGVkU2hhcmUgPCAxMDAsIHdlIGhhdmU6DQogICAgICogIC0gdG90YWxUb2tlbnNUYXJnZXQgPj0gdG90YWxVbnJlc3RyaWN0ZWRUb2tlbnMNCiAgICAgKiAgLSB0b3RhbFRva2Vuc0V4aXN0aW5nIDw9IHRvdGFsUmVzdHJpY3RlZFRva2VucyArIHRvdGFsVG9rZW5zVGFyZ2V0DQogICAgICogIC0gdG90YWxCdXJuIDw9IHRvdGFsUmVzdHJpY3RlZFRva2Vucw0KICAgICAqICAtIGJ1cm5NdWx0Tm9tIDw9IGJ1cm5NdWx0RGVuDQogICAgICogQWxzbyBub3RlIHRoYXQgYnVybk11bHREZW4gPSAwIG1lYW5zIHRvdGFsUmVzdHJpY3RlZFRva2VucyA9IDAsIGluIHdoaWNoDQogICAgICogYnVybk11bHROb20gPSAwIGFzIHdlbGwuDQogICAgICovDQogIH0NCg0KICAvKioNCiAgICogVW5yZXN0cmljdCAoY29udmVydCkgYWxsIHJlc3RyaWN0ZWQgdG9rZW5zIGFzc2lnbmVkIHRvIHRoZSBnaXZlbiBhZGRyZXNzDQogICAqDQogICAqIFRoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGFzc2lnbm1lbnRzIGhhdmUgYmVlbiBjbG9zZWQgdmlhDQogICAqIGNsb3NlQXNzaWdubWVudHMoKS4NCiAgICogVGhlIHJldHVybiB2YWx1ZSBpcyB0aGUgbnVtYmVyIG9mIHJlc3RyaWN0ZWQgdG9rZW5zIHRoYXQgd2VyZSBidXJuZWQgaW4NCiAgICogdGhlIGNvbnZlcnNpb24uDQogICAqLw0KICBmdW5jdGlvbiB1bnJlc3RyaWN0KGFkZHJlc3MgYWRkcikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIC8vIFRocm93IGlzIGFzc2lnbm1lbnRzIGFyZSBub3QgeWV0IGNsb3NlZA0KICAgIGlmICghYXNzaWdubWVudHNDbG9zZWQpIHsgdGhyb3c7IH0NCg0KICAgIC8vIFRoZSBiYWxhbmNlIG9mIHJlc3RyaWN0ZWQgdG9rZW5zIGZvciB0aGUgZ2l2ZW4gYWRkcmVzcyANCiAgICB1aW50IHJlc3RyaWN0aW9uc0ZvckFkZHIgPSByZXN0cmljdGlvbnNbYWRkcl07DQogICAgDQogICAgLy8gVGhyb3cgaWYgdGhlcmUgYXJlIG5vbmUNCiAgICBpZiAocmVzdHJpY3Rpb25zRm9yQWRkciA9PSAwKSB7IHRocm93OyB9DQoNCiAgICAvLyBBcHBseSB0aGUgYnVybiBtdWx0aXBsaWVyIHRvIHRoZSBiYWxhbmNlIG9mIHJlc3RyaWN0ZWQgdG9rZW5zDQogICAgLy8gVGhlIHJlc3VsdCBpcyB0aGUgY2VpbGluZyBvZiB0aGUgdmFsdWU6IA0KICAgIC8vIChyZXN0cmljdGlvbkZvckFkZHIgKiBidXJuTXVsdE5vbSkgLyBidXJuTXVsdERlbg0KICAgIHVpbnQgYnVybiA9IG11bHRGcmFjQ2VpbGluZyhyZXN0cmljdGlvbnNGb3JBZGRyLCBidXJuTXVsdE5vbSwgYnVybk11bHREZW4pOw0KDQogICAgLy8gUmVtb3ZlIHRoZSB0b2tlbnMgdG8gYmUgYnVybmVkIGZyb20gdGhlIGFkZHJlc3MncyBiYWxhbmNlDQogICAgdG9rZW5zW2FkZHJdIC09IGJ1cm47DQogICAgDQogICAgLy8gRGVsZXRlIHJlY29yZCBvZiByZXN0cmljdGlvbnMgDQogICAgZGVsZXRlIHJlc3RyaWN0aW9uc1thZGRyXTsNCiAgICANCiAgICAvLyBVcGRhdGUgdGhlIGNvdW50ZXJzIGZvciB0b3RhbCAodW4pcmVzdHJpY3RlZCB0b2tlbnMNCiAgICB0b3RhbFJlc3RyaWN0ZWRUb2tlbnMgICAtPSByZXN0cmljdGlvbnNGb3JBZGRyOw0KICAgIHRvdGFsVW5yZXN0cmljdGVkVG9rZW5zICs9IHJlc3RyaWN0aW9uc0ZvckFkZHIgLSBidXJuOw0KICAgICAgDQogICAgcmV0dXJuIGJ1cm47DQogIH0NCn0NCg0KLy8gaW1wb3J0ICJQaGFzZWQuc29sIjsNCg0KLyoNCiAqIHRpdGxlOiBDb250cmFjdCB0aGF0IGFkdmFuY2VzIHRocm91Z2ggbXVsdGlwbGUgY29uZmlndXJhYmxlIHBoYXNlcyBvdmVyIHRpbWUNCiAqIGF1dGhvcjogVGltbyBIYW5rZSANCiAqIA0KICogUGhhc2VzIGFyZSBkZWZpbmVkIGJ5IHRoZWlyIHRyYW5zaXRpb24gdGltZXMuIFRoZSBtb21lbnQgb25lIHBoYXNlIGVuZHMgdGhlDQogKiBuZXh0IG9uZSBzdGFydHMuIEVhY2ggdGltZSBiZWxvbmdzIHRvIGV4YWN0bHkgb25lIHBoYXNlLg0KICoNCiAqIFRoZSBjb250cmFjdCBhbGxvd3MgYSBsaW1pdGVkIHNldCBvZiBjaGFuZ2VzIHRvIGJlIGFwcGxpZWQgdG8gdGhlIHBoYXNlDQogKiB0cmFuc2l0aW9ucyB3aGlsZSB0aGUgY29udHJhY3QgaXMgYWN0aXZlLiAgQXMgYSBtYXR0ZXIgb2YgcHJpbmNpcGxlLCBjaGFuZ2VzDQogKiBhcmUgcHJvaGliaXRlZCBmcm9tIGVmZmVjdGluZyB0aGUgcGFzdC4gVGhleSBtYXkgb25seSBldmVyIGFmZmVjdCBmdXR1cmUNCiAqIHBoYXNlIHRyYW5zaXRpb25zLg0KICoNCiAqIFRoZSBwZXJtaXR0ZWQgY2hhbmdlcyBhcmU6DQogKiAgIC0gYWRkIGEgbmV3IHBoYXNlIGFmdGVyIHRoZSBsYXN0IG9uZQ0KICogICAtIGVuZCB0aGUgY3VycmVudCBwaGFzZSByaWdodCBub3cgYW5kIHRyYW5zaXRpb24gdG8gdGhlIG5leHQgcGhhc2UNCiAqICAgICBpbW1lZGlhdGVseSANCiAqICAgLSBkZWxheSB0aGUgc3RhcnQgb2YgYSBmdXR1cmUgcGhhc2UgKHRoZXJlYnkgcHVzaGluZyBvdXQgYWxsIHN1YnNlcXVlbnQNCiAqICAgICBwaGFzZXMgYnkgYW4gZXF1YWwgYW1vdW50IG9mIHRpbWUpDQogKiAgIC0gZGVmaW5lIGEgbWF4aW11bSBkZWxheSBmb3IgYSBzcGVjaWZpZWQgcGhhc2UgDQogKi8NCiANCg0KY29udHJhY3QgUGhhc2VkIHsNCiAgLyoqDQogICAqIEFycmF5IG9mIHRyYW5zaXRpb24gdGltZXMgZGVmaW5pbmcgdGhlIHBoYXNlcw0KICAgKiAgIA0KICAgKiBwaGFzZUVuZFRpbWVbaV0gaXMgdGhlIHRpbWUgd2hlbiBwaGFzZSBpIGhhcyBqdXN0IGVuZGVkLg0KICAgKiBQaGFzZSBpIGlzIGRlZmluZWQgYXMgdGhlIGZvbGxvd2luZyB0aW1lIGludGVydmFsOiANCiAgICogICBbIHBoYXNlRW5kVGltZVtpLTFdLCAqIHBoYXNlRW5kVGltZVtpXSApDQogICAqLw0KICB1aW50W10gcHVibGljIHBoYXNlRW5kVGltZTsNCg0KICAvKioNCiAgICogTnVtYmVyIG9mIHBoYXNlIHRyYW5zaXRpb25zIE4gPSBwaGFzZUVuZFRpbWUubGVuZ3RoIA0KICAgKg0KICAgKiBUaGVyZSBhcmUgTisxIHBoYXNlcywgbnVtYmVyZWQgMCwuLixOLg0KICAgKiBUaGUgZmlyc3QgcGhhc2UgaGFzIG5vIHN0YXJ0IGFuZCB0aGUgbGFzdCBwaGFzZSBoYXMgbm8gZW5kLg0KICAgKi8NCiAgdWludCBwdWJsaWMgTjsgDQoNCiAgLyoqDQogICAqICBNYXhpbXVtIGRlbGF5IGZvciBwaGFzZSB0cmFuc2l0aW9ucw0KICAgKg0KICAgKiAgbWF4RGVsYXlbaV0gaXMgdGhlIG1heGltdW0gYW1vdW50IG9mIHRpbWUgYnkgd2hpY2ggdGhlIHRyYW5zaXRpb24NCiAgICogIHBoYXNlRW5kVGltZVtpXSBjYW4gYmUgZGVsYXllZC4NCiAgKi8NCiAgbWFwcGluZyh1aW50ID0+IHVpbnQpIHB1YmxpYyBtYXhEZWxheTsgDQoNCiAgLyoNCiAgICogVGhlIGNvbnRyYWN0IGhhcyBubyBjb25zdHJ1Y3Rvci4NCiAgICogVGhlIGNvbnRyYWN0IGluaXRpYWxpemVkIGl0c2VsZiB3aXRoIG5vIHBoYXNlIHRyYW5zaXRpb25zIChOID0gMCkgYW5kIG9uZQ0KICAgKiBwaGFzZSAoTisxPTEpLg0KICAgKg0KICAgKiBUaGVyZSBhcmUgdHdvIFBVQkxJQyBmdW5jdGlvbnMgKGdldHRlcnMpOg0KICAgKiAgLSBnZXRQaGFzZUF0VGltZQ0KICAgKiAgLSBpc1BoYXNlDQogICAqICAtIGdldFBoYXNlU3RhcnRUaW1lDQogICAqDQogICAqIE5vdGUgdGhhdCBib3RoIGZ1bmN0aW9ucyBhcmUgZ3VhcmFudGVlZCB0byByZXR1cm4gdGhlIHNhbWUgdmFsdWUgd2hlbg0KICAgKiBjYWxsZWQgdHdpY2Ugd2l0aCB0aGUgc2FtZSBhcmd1bWVudCAoYnV0IGF0IGRpZmZlcmVudCB0aW1lcykuDQogICAqLw0KDQogIC8qKg0KICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiB0aGUgcGhhc2UgdG8gd2hpY2ggdGhlIGdpdmVuIHRpbWUgYmVsb25ncy4NCiAgICoNCiAgICogUmV0dXJuIHZhbHVlIGkgbWVhbnMgcGhhc2VFbmRUaW1lW2ktMV0gPD0gdGltZSA8IHBoYXNlRW5kVGltZVtpXS4NCiAgICogVGhlIGdpdmVuIHRpbWUgbXVzdCBub3QgYmUgaW4gdGhlIGZ1dHVyZSAoYmVjYXVzZSBmdXR1cmUgcGhhc2UgbnVtYmVycyBtYXkNCiAgICogc3RpbGwgYmUgc3ViamVjdCB0byBjaGFuZ2UpLg0KICAgKi8NCiAgZnVuY3Rpb24gZ2V0UGhhc2VBdFRpbWUodWludCB0aW1lKSBjb25zdGFudCByZXR1cm5zICh1aW50IG4pIHsNCiAgICAvLyBUaHJvdyBpZiB0aW1lIGlzIGluIHRoZSBmdXR1cmUNCiAgICBpZiAodGltZSA+IG5vdykgeyB0aHJvdzsgfQ0KICAgIA0KICAgIC8vIExvb3AgdW50aWwgd2UgaGF2ZSBmb3VuZCB0aGUgImFjdGl2ZSIgcGhhc2UNCiAgICB3aGlsZSAobiA8IE4gJiYgcGhhc2VFbmRUaW1lW25dIDw9IHRpbWUpIHsNCiAgICAgIG4rKzsNCiAgICB9DQogIH0NCg0KICAvKioNCiAgICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIHRpbWUgYmVsb25ncyB0byB0aGUgZ2l2ZW4gcGhhc2UuDQogICAqDQogICAqIFJldHVybnMgdGhlIGxvZ2ljYWwgZXF1aXZhbGVudCBvZiB0aGUgZXhwcmVzc2lvbiANCiAgICogICAocGhhc2VFbmRUaW1lW2ktMV0gPD0gdGltZSA8IHBoYXNlRW5kVGltZVtpXSkuDQogICAqDQogICAqIFRoZSBnaXZlbiB0aW1lIG11c3Qgbm90IGJlIGluIHRoZSBmdXR1cmUgKGJlY2F1c2UgZnV0dXJlIHBoYXNlIG51bWJlcnMgbWF5DQogICAqIHN0aWxsIGJlIHN1YmplY3QgdG8gY2hhbmdlKS4NCiAgICovDQogIGZ1bmN0aW9uIGlzUGhhc2UodWludCB0aW1lLCB1aW50IG4pIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAvLyBUaHJvdyBpZiB0aW1lIGlzIGluIHRoZSBmdXR1cmUNCiAgICBpZiAodGltZSA+IG5vdykgeyB0aHJvdzsgfQ0KICAgIA0KICAgIC8vIFRocm93IGlmIGluZGV4IGlzIG91dC1vZi1yYW5nZQ0KICAgIGlmIChuID49IE4pIHsgdGhyb3c7IH0NCiAgICANCiAgICAvLyBDb25kaXRpb24gMQ0KICAgIGlmIChuID4gMCAmJiBwaGFzZUVuZFRpbWVbbi0xXSA+IHRpbWUpIHsgcmV0dXJuIGZhbHNlOyB9IA0KICAgIA0KICAgIC8vIENvbmRpdGlvbiAyDQogICAgaWYgKG4gPCBOICYmIHRpbWUgPj0gcGhhc2VFbmRUaW1lW25dKSB7IHJldHVybiBmYWxzZTsgfSANCiAgIA0KICAgIHJldHVybiB0cnVlOyANCiAgfQ0KICANCiAgLyoqDQogICAqIFJldHVybiB0aGUgc3RhcnQgdGltZSBvZiB0aGUgZ2l2ZW4gcGhhc2UuDQogICAqDQogICAqIFRoaXMgZnVuY3Rpb24gaXMgcHJvdmlkZWQgZm9yIGNvbnZlbmllbmNlLg0KICAgKiBUaGUgZ2l2ZW4gcGhhc2UgbnVtYmVyIG11c3Qgbm90IGJlIDAsIGFzIHRoZSBmaXJzdCBwaGFzZSBoYXMgbm8gc3RhcnQgdGltZS4NCiAgICogSWYgY2FsbGluZyBmb3IgYSBmdXR1cmUgcGhhc2UgbnVtYmVyIHRoZSBjYWxsZXIgbXVzdCBiZSBhd2FyZSB0aGF0IGZ1dHVyZQ0KICAgKiBwaGFzZSB0aW1lcyBjYW4gYmUgc3ViamVjdCB0byBjaGFuZ2UuDQogICAqLw0KICBmdW5jdGlvbiBnZXRQaGFzZVN0YXJ0VGltZSh1aW50IG4pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAvLyBUaHJvdyBpZiBwaGFzZSBpcyB0aGUgZmlyc3QgcGhhc2UNCiAgICBpZiAobiA9PSAwKSB7IHRocm93OyB9DQogICANCiAgICByZXR1cm4gcGhhc2VFbmRUaW1lW24tMV07DQogIH0NCiAgICANCiAgLyoNCiAgICogIFRoZXJlIGFyZSA0IElOVEVSTkFMIGZ1bmN0aW9uczoNCiAgICogICAgMS4gYWRkUGhhc2UNCiAgICogICAgMi4gc2V0TWF4RGVsYXkNCiAgICogICAgMy4gZGVsYXlQaGFzZUVuZEJ5DQogICAqICAgIDQuIGVuZEN1cnJlbnRQaGFzZUluDQogICAqDQogICAqICBUaGlzIGNvbnRyYWN0IGRvZXMgbm90IGltcGxlbWVudCBhY2Nlc3MgY29udHJvbCB0byB0aGVzZSBmdW5jdGlvbiwgc28NCiAgICogIHRoZXkgYXJlIG1hZGUgaW50ZXJuYWwuDQogICAqLw0KICAgDQogIC8qKg0KICAgKiAxLiBBZGQgYSBwaGFzZSBhZnRlciB0aGUgbGFzdCBwaGFzZS4NCiAgICoNCiAgICogVGhlIGFyZ3VtZW50IGlzIHRoZSBuZXcgZW5kVGltZSBvZiB0aGUgcGhhc2UgY3VycmVudGx5IGtub3duIGFzIHRoZSBsYXN0DQogICAqIHBoYXNlLCBvciwgaW4gb3RoZXIgd29yZHMgdGhlIHN0YXJ0IHRpbWUgb2YgdGhlIG5ld2x5IGludHJvZHVjZWQgcGhhc2UuICANCiAgICogQWxsIGNhbGxzIHRvIGFkZFBoYXNlKCkgTVVTVCBiZSB3aXRoIHN0cmljdGx5IGluY3JlYXNpbmcgdGltZSBhcmd1bWVudHMuDQogICAqIEl0IGlzIG5vdCBhbGxvd2VkIHRvIGFkZCBhIHBoYXNlIHRyYW5zaXRpb24gdGhhdCBsaWVzIGluIHRoZSBwYXN0IHJlbGF0aXZlDQogICAqIHRvIHRoZSBjdXJyZW50IGJsb2NrIHRpbWUuDQogICAqLw0KICBmdW5jdGlvbiBhZGRQaGFzZSh1aW50IHRpbWUpIGludGVybmFsIHsNCiAgICAvLyBUaHJvdyBpZiBuZXcgdHJhbnNpdGlvbiB0aW1lIGlzIG5vdCBzdHJpY3RseSBpbmNyZWFzaW5nDQogICAgaWYgKE4gPiAwICYmIHRpbWUgPD0gcGhhc2VFbmRUaW1lW04tMV0pIHsgdGhyb3c7IH0gDQoNCiAgICAvLyBUaHJvdyBpZiBuZXcgdHJhbnNpdGlvbiB0aW1lIGlzIG5vdCBpbiB0aGUgZnV0dXJlDQogICAgaWYgKHRpbWUgPD0gbm93KSB7IHRocm93OyB9DQogICANCiAgICAvLyBBcHBlbmQgbmV3IHRyYW5zaXRpb24gdGltZSB0byBhcnJheSANCiAgICBwaGFzZUVuZFRpbWUucHVzaCh0aW1lKTsNCiAgICBOKys7DQogIH0NCiAgDQogIC8qKg0KICAgKiAyLiBEZWZpbmUgYSBsaW1pdCBvbiB0aGUgYW1vdW50IG9mIHRpbWUgYnkgd2hpY2ggdGhlIGdpdmVuIHRyYW5zaXRpb24gKGkpDQogICAqICAgIGNhbiBiZSBkZWxheWVkLg0KICAgKg0KICAgKiBCeSBkZWZhdWx0LCB0cmFuc2l0aW9ucyBjYW4gbm90IGJlIGRlbGF5ZWQgKGxpbWl0ID0gMCkuDQogICAqLw0KICBmdW5jdGlvbiBzZXRNYXhEZWxheSh1aW50IGksIHVpbnQgdGltZURlbHRhKSBpbnRlcm5hbCB7DQogICAgLy8gVGhyb3cgaWYgaW5kZXggaXMgb3V0LW9mLXJhbmdlDQogICAgaWYgKGkgPj0gTikgeyB0aHJvdzsgfQ0KDQogICAgbWF4RGVsYXlbaV0gPSB0aW1lRGVsdGE7DQogIH0NCg0KICAvKioNCiAgICogMy4gRGVsYXkgdGhlIGVuZCBvZiB0aGUgZ2l2ZW4gcGhhc2UgKG4pIGJ5IHRoZSBnaXZlbiB0aW1lIGRlbHRhLiANCiAgICoNCiAgICogVGhlIGdpdmVuIHBoYXNlIG11c3Qgbm90IGhhdmUgZW5kZWQuDQogICAqDQogICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBmb3IgdGhlIHNhbWUgcGhhc2UuIA0KICAgKiBUaGUgZGVmaW5lZCBtYXhpbXVtIGRlbGF5IHdpbGwgYmUgZW5mb3JjZWQgYWNyb3NzIG11bHRpcGxlIGNhbGxzLg0KICAgKi8NCiAgZnVuY3Rpb24gZGVsYXlQaGFzZUVuZEJ5KHVpbnQgbiwgdWludCB0aW1lRGVsdGEpIGludGVybmFsIHsNCiAgICAvLyBUaHJvdyBpZiBpbmRleCBpcyBvdXQgb2YgcmFuZ2UNCiAgICBpZiAobiA+PSBOKSB7IHRocm93OyB9DQoNCiAgICAvLyBUaHJvdyBpZiBwaGFzZSBoYXMgYWxyZWFkeSBlbmRlZA0KICAgIGlmIChub3cgPj0gcGhhc2VFbmRUaW1lW25dKSB7IHRocm93OyB9DQoNCiAgICAvLyBUaHJvdyBpZiB0aGUgcmVxdWVzdGVkIGRlbGF5IGlzIGhpZ2hlciB0aGFuIHRoZSBkZWZpbmVkIG1heGltdW0gZm9yIHRoZQ0KICAgIC8vIHRyYW5zaXRpb24NCiAgICBpZiAodGltZURlbHRhID4gbWF4RGVsYXlbbl0pIHsgdGhyb3c7IH0NCg0KICAgIC8vIFN1YnRyYWN0IGZyb20gdGhlIGN1cnJlbnQgbWF4IGRlbGF5LCBzbyBtYXhEZWxheSBpcyBob25vcmVkIGFjcm9zcw0KICAgIC8vIG11bHRpcGxlIGNhbGxzDQogICAgbWF4RGVsYXlbbl0gLT0gdGltZURlbHRhOw0KDQogICAgLy8gUHVzaCBvdXQgYWxsIHN1YnNlcXVlbnQgdHJhbnNpdGlvbnMgYnkgdGhlIHNhbWUgYW1vdW50DQogICAgZm9yICh1aW50IGkgPSBuOyBpIDwgTjsgaSsrKSB7DQogICAgICBwaGFzZUVuZFRpbWVbaV0gKz0gdGltZURlbHRhOw0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiA0LiBFbmQgdGhlIGN1cnJlbnQgcGhhc2UgZWFybHkuDQogICAqDQogICAqIFRoZSBjdXJyZW50IHBoYXNlIG11c3Qgbm90IGJlIHRoZSBsYXN0IHBoYXNlLCBhcyB0aGUgbGFzdCBwaGFzZSBoYXMgbm8gZW5kLg0KICAgKiBUaGUgY3VycmVudCBwaGFzZSB3aWxsIGVuZCBhdCB0aW1lIG5vdyBwbHVzIHRoZSBnaXZlbiB0aW1lIGRlbHRhLg0KICAgKg0KICAgKiBUaGUgbWluaW1hbCBhbGxvd2VkIHRpbWUgZGVsdGEgaXMgMS4gVGhpcyBpcyBhdm9pZCBhIHJhY2UgY29uZGl0aW9uIGZvciANCiAgICogb3RoZXIgdHJhbnNhY3Rpb25zIHRoYXQgYXJlIHByb2Nlc3NlZCBpbiB0aGUgc2FtZSBibG9jay4gDQogICAqIFNldHRpbmcgcGhhc2VFbmRUaW1lW25dIHRvIG5vdyB3b3VsZCBwdXNoIGFsbCBsYXRlciB0cmFuc2FjdGlvbnMgZnJvbSB0aGUgDQogICAqIHNhbWUgYmxvY2sgaW50byB0aGUgbmV4dCBwaGFzZS4NCiAgICogSWYgdGhlIHNwZWNpZmllZCB0aW1lRGVsdGEgaXMgMCB0aGUgZnVuY3Rpb24gZ3JhY2VmdWxseSBidW1wcyBpdCB1cCB0byAxLg0KICAgKi8NCiAgZnVuY3Rpb24gZW5kQ3VycmVudFBoYXNlSW4odWludCB0aW1lRGVsdGEpIGludGVybmFsIHsNCiAgICAvLyBHZXQgdGhlIGN1cnJlbnQgcGhhc2UgbnVtYmVyDQogICAgdWludCBuID0gZ2V0UGhhc2VBdFRpbWUobm93KTsNCg0KICAgIC8vIFRocm93IGlmIHdlIGFyZSBpbiB0aGUgbGFzdCBwaGFzZQ0KICAgIGlmIChuID49IE4pIHsgdGhyb3c7IH0NCiAgIA0KICAgIC8vIFNldCB0aW1lRGVsdGEgdG8gdGhlIG1pbmltYWwgYWxsb3dlZCB2YWx1ZQ0KICAgIGlmICh0aW1lRGVsdGEgPT0gMCkgeyANCiAgICAgIHRpbWVEZWx0YSA9IDE7IA0KICAgIH0NCiAgICANCiAgICAvLyBUaGUgbmV3IHBoYXNlIGVuZCBzaG91bGQgYmUgZWFybGllciB0aGFuIHRoZSBjdXJyZW50bHkgZGVmaW5lZCBwaGFzZQ0KICAgIC8vIGVuZCwgb3RoZXJ3aXNlIHdlIGRvbid0IGNoYW5nZSBpdC4NCiAgICBpZiAobm93ICsgdGltZURlbHRhIDwgcGhhc2VFbmRUaW1lW25dKSB7IA0KICAgICAgcGhhc2VFbmRUaW1lW25dID0gbm93ICsgdGltZURlbHRhOw0KICAgIH0NCiAgfQ0KfQ0KDQovLyBpbXBvcnQgIlN0ZXBGdW5jdGlvbi5zb2wiOw0KDQovKg0KICogdGl0bGU6ICBBIGNvbmZpZ3VyYWJsZSBzdGVwIGZ1bmN0aW9uIA0KICogYXV0aG9yOiBUaW1vIEhhbmtlIA0KICoNCiAqIFRoZSBjb250cmFjdCBpbXBsZW1lbnRzIGEgc3RlcCBmdW5jdGlvbiBnb2luZyBkb3duIGZyb20gYW4gaW5pdGlhbFZhbHVlIHRvIDANCiAqIGluIGEgbnVtYmVyIG9mIHN0ZXBzIChuU3RlcHMpLg0KICogVGhlIHN0ZXBzIGFyZSBkaXN0cmlidXRlZCBlcXVhbGx5IG92ZXIgYSBnaXZlbiB0aW1lIChwaGFzZUxlbmd0aCkuDQogKiBIYXZpbmcgbiBzdGVwcyBtZWFucyB0aGF0IHRoZSB0aW1lIHBoYXNlTGVuZ3RoIGlzIGRpdmlkZWQgaW50byBuKzENCiAqIHN1Yi1pbnRlcnZhbGxzIG9mIGVxdWFsIGxlbmd0aCBkdXJpbmcgZWFjaCBvZiB3aGljaCB0aGUgZnVuY3Rpb24gdmFsdWUgaXMNCiAqIGNvbnN0YW50LiANCiAqLw0KDQpjb250cmFjdCBTdGVwRnVuY3Rpb24gew0KICB1aW50IHB1YmxpYyBwaGFzZUxlbmd0aDsNCiAgdWludCBwdWJsaWMgblN0ZXBzOw0KICB1aW50IHB1YmxpYyBzdGVwOw0KDQogIGZ1bmN0aW9uIFN0ZXBGdW5jdGlvbih1aW50IF9waGFzZUxlbmd0aCwgdWludCBfaW5pdGlhbFZhbHVlLCB1aW50IF9uU3RlcHMpIHsNCiAgICAvLyBUaHJvdyBpZiBwaGFzZUxlbmd0aCBkb2VzIG5vdCBsZWF2ZSBlbm91Z2ggcm9vbSBmb3IgbnVtYmVyIG9mIHN0ZXBzDQogICAgaWYgKF9uU3RlcHMgPiBfcGhhc2VMZW5ndGgpIHsgdGhyb3c7IH0gDQogIA0KICAgIC8vIFRoZSByZWR1Y3Rpb24gaW4gdmFsdWUgcGVyIHN0ZXAgDQogICAgc3RlcCA9IF9pbml0aWFsVmFsdWUgLyBfblN0ZXBzOw0KICAgIA0KICAgIC8vIFRocm93IGlmIF9pbml0aWFsVmFsdWUgd2FzIG5vdCBkaXZpc2libGUgYnkgX25TdGVwcw0KICAgIGlmICggc3RlcCAqIF9uU3RlcHMgIT0gX2luaXRpYWxWYWx1ZSkgeyB0aHJvdzsgfSANCg0KICAgIHBoYXNlTGVuZ3RoID0gX3BoYXNlTGVuZ3RoOw0KICAgIG5TdGVwcyA9IF9uU3RlcHM7IA0KICB9DQogDQogIC8qDQogICAqIE5vdGUgdGhlIGZvbGxvd2luZyBlZGdlIGNhc2VzLg0KICAgKiAgIGluaXRpYWxWYWx1ZSA9IDA6IGlzIHZhbGlkIGFuZCB3aWxsIGNyZWF0ZSB0aGUgY29uc3RhbnQgemVybyBmdW5jdGlvbg0KICAgKiAgIG5TdGVwcyA9IDA6IGlzIHZhbGlkIGFuZCB3aWxsIGNyZWF0ZSB0aGUgY29uc3RhbnQgemVybyBmdW5jdGlvbiAob25seSAxDQogICAqICAgc3ViLWludGVydmFsKQ0KICAgKiAgIHBoYXNlTGVuZ3RoIDwgblN0ZXBzOiBpcyB2YWxpZCwgYnV0IHVubGlrZWx5IHRvIGJlIGludGVuZGVkIChzbyB0aGUNCiAgICogICBjb25zdHJ1Y3RvciB0aHJvd3MpDQogICAqLw0KICANCiAgLyoqDQogICAqIEV2YWx1YXRlIHRoZSBzdGVwIGZ1bmN0aW9uIGF0IGEgZ2l2ZW4gdGltZSAgDQogICAqDQogICAqIGVsYXBzZWRUaW1lIE1VU1QgYmUgaW4gdGhlIGludGVydmFsbCBbMCxwaGFzZUxlbmd0aCkNCiAgICogVGhlIHJldHVybiB2YWx1ZSBpcyBiZXR3ZWVuIGluaXRpYWxWYWx1ZSBhbmQgMCwgbmV2ZXIgbmVnYXRpdmUuDQogICAqLw0KICBmdW5jdGlvbiBnZXRTdGVwRnVuY3Rpb24odWludCBlbGFwc2VkVGltZSkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgIC8vIFRocm93IGlzIGVsYXBzZWRUaW1lIGlzIG91dC1vZi1yYW5nZQ0KICAgIGlmIChlbGFwc2VkVGltZSA+PSBwaGFzZUxlbmd0aCkgeyB0aHJvdzsgfQ0KICAgIA0KICAgIC8vIFRoZSBmdW5jdGlvbiB2YWx1ZSB3aWxsIGJlbCBjYWxjdWxhdGVkIGZyb20gdGhlIGVuZCB2YWx1ZSBiYWNrd2FyZHMuDQogICAgLy8gSGVuY2Ugd2UgbmVlZCB0aGUgdGltZSBsZWZ0LCB3aGljaCB3aWxsIGxpZSBpbiB0aGUgaW50ZXJ2YWxsDQogICAgLy8gWzAscGhhc2VMZW5ndGgpDQogICAgdWludCB0aW1lTGVmdCAgPSBwaGFzZUxlbmd0aCAtIGVsYXBzZWRUaW1lIC0gMTsgDQoNCiAgICAvLyBDYWxjdWxhdGUgdGhlIG51bWJlciBvZiBzdGVwcyBhd2F5IGZyb20gcmVhY2hpbmcgZW5kIHZhbHVlDQogICAgLy8gV2hlbiB2ZXJpZnlpbmcgdGhlIGZvcnVtbGEgYmVsb3cgaXQgbWF5IGhlbHAgdG8gbm90ZToNCiAgICAvLyAgIGF0IGVsYXBzZWRUaW1lID0gMCBzdGVwc0xlZnQgZXZhbHVhdGVzIHRvIG5TdGVwcywNCiAgICAvLyAgIGF0IGVsYXBzZWRUaW1lID0gLTEgc3RlcHNMZWZ0IHdvdWxkIGV2YWx1YXRlIHRvIG5TdGVwcyArIDEuDQogICAgdWludCBzdGVwc0xlZnQgPSAoKG5TdGVwcyArIDEpICogdGltZUxlZnQpIC8gcGhhc2VMZW5ndGg7IA0KDQogICAgLy8gQXBwbHkgdGhlIHN0ZXAgZnVuY3Rpb24NCiAgICByZXR1cm4gc3RlcHNMZWZ0ICogc3RlcDsNCiAgfQ0KfQ0KDQovLyBpbXBvcnQgIlRhcmdldHMuc29sIjsNCg0KLyoNCiAqIHRpdGxlOiBDb250cmFjdCBpbXBsZW1lbnRpbmcgY291bnRlcnMgd2l0aCBjb25maWd1cmFibGUgdGFyZ2V0cw0KICogYXV0aG9yOiBUaW1vIEhhbmtlIA0KICoNCiAqIFRoZXJlIGlzIGFuIGFyYml0cmFyeSBudW1iZXIgb2YgY291bnRlcnMuIEVhY2ggY291bnRlciBpcyBpZGVudGlmaWVkIGJ5IGl0cw0KICogY291bnRlciBpZCwgYSB1aW50LiBDb3VudGVycyBjYW4gbmV2ZXIgZGVjcmVhc2UuDQogKiANCiAqIFRoZSBjb250cmFjdCBoYXMgbm8gY29uc3RydWN0b3IuIFRoZSB0YXJnZXQgdmFsdWVzIGFyZSBzZXQgYW5kIHJlLXNldCB2aWENCiAqIHNldFRhcmdldCgpLg0KICovDQoNCmNvbnRyYWN0IFRhcmdldHMgew0KDQogIC8vIE1hcHBpbmcgZnJvbSBjb3VudGVyIGlkIHRvIGNvdW50ZXIgdmFsdWUgDQogIG1hcHBpbmcodWludCA9PiB1aW50KSBwdWJsaWMgY291bnRlcjsNCiAgDQogIC8vIE1hcHBpbmcgZnJvbSBjb3VudGVyIGlkIHRvIHRhcmdldCB2YWx1ZSANCiAgbWFwcGluZyh1aW50ID0+IHVpbnQpIHB1YmxpYyB0YXJnZXQ7DQoNCiAgLy8gQSBwdWJsaWMgZ2V0dGVyIHRoYXQgcmV0dXJucyB3aGV0aGVyIHRoZSB0YXJnZXQgd2FzIHJlYWNoZWQNCiAgZnVuY3Rpb24gdGFyZ2V0UmVhY2hlZCh1aW50IGlkKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgcmV0dXJuIChjb3VudGVyW2lkXSA+PSB0YXJnZXRbaWRdKTsNCiAgfQ0KICANCiAgLyoNCiAgICogTW9kaWZ5aW5nIGNvdW50ZXIgb3IgdGFyZ2V0IGFyZSBpbnRlcm5hbCBmdW5jdGlvbnMuDQogICAqLw0KICANCiAgLy8gKFJlLSlzZXQgdGhlIHRhcmdldA0KICBmdW5jdGlvbiBzZXRUYXJnZXQodWludCBpZCwgdWludCBfdGFyZ2V0KSBpbnRlcm5hbCB7DQogICAgdGFyZ2V0W2lkXSA9IF90YXJnZXQ7DQogIH0NCiANCiAgLy8gQWRkIHRvIHRoZSBjb3VudGVyIA0KICAvLyBUaGUgZnVuY3Rpb24gcmV0dXJucyB3aGV0aGVyIHRoaXMgY3VycmVudCBhZGRpdGlvbiBtYWtlcyB0aGUgY291bnRlciByZWFjaA0KICAvLyBvciBjcm9zcyBpdHMgdGFyZ2V0IHZhbHVlIA0KICBmdW5jdGlvbiBhZGRUb3dhcmRzVGFyZ2V0KHVpbnQgaWQsIHVpbnQgYW1vdW50KSANCiAgICBpbnRlcm5hbCANCiAgICByZXR1cm5zIChib29sIGZpcnN0UmVhY2hlZCkgDQogIHsNCiAgICBmaXJzdFJlYWNoZWQgPSAoY291bnRlcltpZF0gPCB0YXJnZXRbaWRdKSAmJiANCiAgICAgICAgICAgICAgICAgICAoY291bnRlcltpZF0gKyBhbW91bnQgPj0gdGFyZ2V0W2lkXSk7DQogICAgY291bnRlcltpZF0gKz0gYW1vdW50Ow0KICB9DQp9DQoNCi8vIGltcG9ydCAiUGFyYW1ldGVycy5zb2wiOw0KDQovKioNCiAqIHRpdGxlOiAgQ29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzIGZvciB0aGUgRkRDDQogKiBhdXRob3I6IFRpbW8gSGFua2UgDQogKi8NCg0KY29udHJhY3QgUGFyYW1ldGVycyB7DQoNCiAgLyoNCiAgICogVGltZSBDb25zdGFudHMNCiAgICoNCiAgICogUGhhc2VzIGFyZSwgaW4gdGhpcyBvcmRlcjogDQogICAqICBlYXJseUNvbnRyaWJ1dGlvbiAoZGVmaW5lZCBieSBlbmQgdGltZSkNCiAgICogIHBhdXNlDQogICAqICBkb25hdGlvbiByb3VuZDAgKGRlZmluZWQgYnkgc3RhcnQgYW5kIGVuZCB0aW1lKQ0KICAgKiAgcGF1c2UNCiAgICogIGRvbmF0aW9uIHJvdW5kMSAoZGVmaW5lZCBieSBzdGFydCBhbmQgZW5kIHRpbWUpDQogICAqICBwYXVzZQ0KICAgKiAgZmluYWxpemF0aW9uIChkZWZpbmVkIGJ5IHN0YXJ0IHRpbWUsIGVuZHMgbWFudWFsbHkpDQogICAqICBkb25lDQogICAqLw0KDQogIC8vIFRoZSBzdGFydCBvZiByb3VuZCAwIGlzIHNldCB0byAyMDE3LTAxLTE3IDE5OjAwIG9mIHRpbWV6b25lIEV1cm9wZS9adXJpY2gNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgcm91bmQwU3RhcnRUaW1lICAgICAgPSAxNDg0Njc2MDAwOyANCiAgDQogIC8vIFRoZSBzdGFydCBvZiByb3VuZCAxIGlzIHNldCB0byAyMDE3LTA1LTE3IDE5OjAwIG9mIHRpbWV6b25lIEV1cm9wZS9adXJpY2gNCiAgLy8gVFo9IkV1cm9wZS9adXJpY2giIGRhdGUgLWQgIjIwMTctMDUtMTcgMTk6MDAiICIrJXMiDQogIHVpbnQgcHVibGljIGNvbnN0YW50IHJvdW5kMVN0YXJ0VGltZSAgICAgID0gMTQ5NTA0MDQwMDsgDQogIA0KICAvLyBUcmFuc2l0aW9uIHRpbWVzIHRoYXQgYXJlIGRlZmluZWQgYnkgZHVyYXRpb24NCiAgdWludCBwdWJsaWMgY29uc3RhbnQgcm91bmQwRW5kVGltZSAgICAgICAgPSByb3VuZDBTdGFydFRpbWUgKyA2IHdlZWtzOw0KICB1aW50IHB1YmxpYyBjb25zdGFudCByb3VuZDFFbmRUaW1lICAgICAgICA9IHJvdW5kMVN0YXJ0VGltZSArIDYgd2Vla3M7DQogIHVpbnQgcHVibGljIGNvbnN0YW50IGZpbmFsaXplU3RhcnRUaW1lICAgID0gcm91bmQxRW5kVGltZSAgICsgMSB3ZWVrczsNCiAgDQogIC8vIFRoZSBmaW5hbGl6YXRpb24gcGhhc2UgaGFzIGEgZHVtbXkgZW5kIHRpbWUgYmVjYXVzZSBpdCBpcyBlbmRlZCBtYW51YWxseQ0KICB1aW50IHB1YmxpYyBjb25zdGFudCBmaW5hbGl6ZUVuZFRpbWUgICAgICA9IGZpbmFsaXplU3RhcnRUaW1lICsgMTAwMCB5ZWFyczsNCiAgDQogIC8vIFRoZSBtYXhpbXVtIHRpbWUgYnkgd2hpY2ggZG9uYXRpb24gcm91bmQgMSBjYW4gYmUgZGVsYXllZCBmcm9tIHRoZSBzdGFydCANCiAgLy8gdGltZSBkZWZpbmVkIGFib3ZlDQogIHVpbnQgcHVibGljIGNvbnN0YW50IG1heFJvdW5kRGVsYXkgICAgID0gMjcwIGRheXM7DQoNCiAgLy8gVGhlIHRpbWUgZm9yIHdoaWNoIGRvbmF0aW9uIHJvdW5kcyByZW1haW4gb3BlbiBhZnRlciB0aGV5IHJlYWNoIHRoZWlyIA0KICAvLyByZXNwZWN0aXZlIHRhcmdldHMgICANCiAgdWludCBwdWJsaWMgY29uc3RhbnQgZ3JhY2VQZXJpb2RBZnRlclJvdW5kMFRhcmdldCAgPSAxIGRheXM7DQogIHVpbnQgcHVibGljIGNvbnN0YW50IGdyYWNlUGVyaW9kQWZ0ZXJSb3VuZDFUYXJnZXQgID0gMCBkYXlzOw0KDQogIC8qDQogICAqIFRva2VuIGlzc3VhbmNlDQogICAqIA0KICAgKiBUaGUgZm9sbG93aW5nIGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVycyBjb21wbGV0ZWx5IGdvdmVybiBhbGwgYXNwZWN0cyBvZiB0aGUgDQogICAqIHRva2VuIGlzc3VhbmNlLg0KICAgKi8NCiAgDQogIC8vIFRva2VucyBhc3NpZ25lZCBmb3IgdGhlIGVxdWl2YWxlbnQgb2YgMSBDSEYgaW4gZG9uYXRpb25zDQogIHVpbnQgcHVibGljIGNvbnN0YW50IHRva2Vuc1BlckNIRiA9IDEwOyANCiAgDQogIC8vIE1pbmltYWwgZG9uYXRpb24gYW1vdW50IGZvciBhIHNpbmdsZSBvbi1jaGFpbiBkb25hdGlvbg0KICB1aW50IHB1YmxpYyBjb25zdGFudCBtaW5Eb25hdGlvbiA9IDEgZXRoZXI7IA0KIA0KICAvLyBCb251cyBpbiBwZXJjZW50IGFkZGVkIHRvIGRvbmF0aW9ucyB0aHJvdWdob3V0IGRvbmF0aW9uIHJvdW5kIDAgDQogIHVpbnQgcHVibGljIGNvbnN0YW50IHJvdW5kMEJvbnVzID0gMjAwOyANCiAgDQogIC8vIEJvbnVzIGluIHBlcmNlbnQgYWRkZWQgdG8gZG9uYXRpb25zIGF0IGJlZ2lubmluZyBvZiBkb25hdGlvbiByb3VuZCAxICANCiAgdWludCBwdWJsaWMgY29uc3RhbnQgcm91bmQxSW5pdGlhbEJvbnVzID0gMjU7DQogIA0KICAvLyBOdW1iZXIgb2YgZG93bi1zdGVwcyBmb3IgdGhlIGJvbnVzIGR1cmluZyBkb25hdGlvbiByb3VuZCAxDQogIHVpbnQgcHVibGljIGNvbnN0YW50IHJvdW5kMUJvbnVzU3RlcHMgPSA1Ow0KIA0KICAvLyBUaGUgQ0hGIHRhcmdldHMgZm9yIGVhY2ggb2YgdGhlIGRvbmF0aW9uIHJvdW5kcywgbWVhc3VyZWQgaW4gY2VudHMgb2YgQ0hGIA0KICB1aW50IHB1YmxpYyBjb25zdGFudCBtaWxsaW9uSW5DZW50cyA9IDEwKio2ICogMTAwOw0KICB1aW50IHB1YmxpYyBjb25zdGFudCByb3VuZDBUYXJnZXQgPSAxICogbWlsbGlvbkluQ2VudHM7IA0KICB1aW50IHB1YmxpYyBjb25zdGFudCByb3VuZDFUYXJnZXQgPSAyMCAqIG1pbGxpb25JbkNlbnRzOw0KDQogIC8vIFNoYXJlIG9mIHRva2VucyBldmVudHVhbGx5IGFzc2lnbmVkIHRvIERGSU5JVFkgU3RpZnR1bmcgYW5kIGVhcmx5IA0KICAvLyBjb250cmlidXRvcnMgaW4gJSBvZiBhbGwgdG9rZW5zIGV2ZW50dWFsbHkgaW4gZXhpc3RlbmNlDQogIHVpbnQgcHVibGljIGNvbnN0YW50IGVhcmx5Q29udHJpYlNoYXJlID0gMjI7IA0KfQ0KDQovLyBGREMuc29sDQoNCmNvbnRyYWN0IEZEQyBpcyBUb2tlblRyYWNrZXIsIFBoYXNlZCwgU3RlcEZ1bmN0aW9uLCBUYXJnZXRzLCBQYXJhbWV0ZXJzIHsNCiAgLy8gQW4gaWRlbnRpZnlpbmcgc3RyaW5nLCBzZXQgYnkgdGhlIGNvbnN0cnVjdG9yDQogIHN0cmluZyBwdWJsaWMgbmFtZTsNCiAgDQogIC8qDQogICAqIFBoYXNlcw0KICAgKg0KICAgKiBUaGUgRkRDIG92ZXIgaXRzIGxpZmV0aW1lIHJ1bnMgdGhyb3VnaCBhIG51bWJlciBvZiBwaGFzZXMuIFRoZXNlIHBoYXNlcyBhcmUNCiAgICogdHJhY2tlZCBieSB0aGUgYmFzZSBjb250cmFjdCBQaGFzZWQuDQogICAqDQogICAqIFRoZSBGREMgbWFwcyB0aGUgY2hyb25vbG9naWNhbGx5IGRlZmluZWQgcGhhc2UgbnVtYmVycyB0byBzZW1hbnRpY2FsbHkgDQogICAqIGRlZmluZWQgc3RhdGVzLg0KICAgKi8NCg0KICAvLyBUaGUgRkRDIHN0YXRlcw0KICBlbnVtIHN0YXRlIHsNCiAgICBwYXVzZSwgICAgICAgICAvLyBQYXVzZSB3aXRob3V0IGFueSBhY3Rpdml0eSANCiAgICBlYXJseUNvbnRyaWIsICAvLyBSZWdpc3RyYXRpb24gb2YgREZJTklUWSBTdGlmdHVuZy9lYXJseSBjb250cmlidXRpb25zDQogICAgcm91bmQwLCAgICAgICAgLy8gRG9uYXRpb24gcm91bmQgMCAgDQogICAgcm91bmQxLCAgICAgICAgLy8gRG9uYXRpb24gcm91bmQgMSANCiAgICBvZmZDaGFpblJlZywgICAvLyBHcmFjZSBwZXJpb2QgZm9yIHJlZ2lzdHJhdGlvbiBvZiBvZmYtY2hhaW4gZG9uYXRpb25zDQogICAgZmluYWxpemF0aW9uLCAgLy8gQWRqdXN0bWVudCBvZiBERklOSVRZIFN0aWZ0dW5nL2Vhcmx5IGNvbnRyaWJ1dGlvbiB0b2tlbnMNCiAgICAgICAgICAgICAgICAgICAvLyBkb3duIHRvIHRoZWlyIHNoYXJlDQogICAgZG9uZSAgICAgICAgICAgLy8gUmVhZC1vbmx5IHBoYXNlDQogIH0NCg0KICAvLyBNYXBwaW5nIGZyb20gcGhhc2UgbnVtYmVyIChmcm9tIHRoZSBiYXNlIGNvbnRyYWN0IFBoYXNlZCkgdG8gRkRDIHN0YXRlIA0KICBtYXBwaW5nKHVpbnQgPT4gc3RhdGUpIHN0YXRlT2ZQaGFzZTsNCg0KICAvKg0KICAgKiBUb2tlbnMNCiAgICoNCiAgICogVGhlIEZEQyB1c2VzIGJhc2UgY29udHJhY3QgVG9rZW5UcmFja2VyIHRvOg0KICAgKiAgLSB0cmFjayB0b2tlbiBhc3NpZ25tZW50cyBmb3IgDQogICAqICAgICAgLSBkb25vcnMgKHVucmVzdHJpY3RlZCB0b2tlbnMpDQogICAqICAgICAgLSBERklOSVRZIFN0aWZ0dW5nL2Vhcmx5IGNvbnRyaWJ1dG9ycyAocmVzdHJpY3RlZCB0b2tlbnMpDQogICAqICAtIGNvbnZlcnQgREZJTklUWSBTdGlmdHVuZy9lYXJseSBjb250cmlidXRvciB0b2tlbnMgZG93biB0byB0aGVpciBzaGFyZQ0KICAgKg0KICAgKiBUaGUgRkRDIHVzZXMgdGhlIGJhc2UgY29udHJhY3QgVGFyZ2V0cyB0bzoNCiAgICogIC0gdHJhY2sgdGhlIHRhcmdldHMgbWVhc3VyZWQgaW4gQ0hGIGZvciBlYWNoIGRvbmF0aW9uIHJvdW5kDQogICAqDQogICAqIFRoZSBGREMgaXRzZWxmOg0KICAgKiAgLSB0cmFja3MgdGhlIG1lbW9zIG9mIG9mZi1jaGFpbiBkb25hdGlvbnMgKGFuZCBwcmV2ZW50cyBkdXBsaWNhdGVzKQ0KICAgKiAgLSB0cmFja3MgZG9ub3IgYW5kIGVhcmx5IGNvbnRyaWJ1dG9yIGFkZHJlc3NlcyBpbiB0d28gbGlzdHMNCiAgICovDQogICANCiAgLy8gTWFwcGluZyB0byBzdG9yZSBtZW1vcyB0aGF0IGhhdmUgYmVlbiB1c2VkIA0KICBtYXBwaW5nKGJ5dGVzMzIgPT4gYm9vbCkgbWVtb1VzZWQ7DQoNCiAgLy8gTGlzdCBvZiByZWdpc3RlcmVkIGFkZHJlc3NlcyAoZWFjaCBhZGRyZXNzIHdpbGwgYXBwZWFyIGluIG9uZSkNCiAgYWRkcmVzc1tdIHB1YmxpYyBkb25vckxpc3Q7ICANCiAgYWRkcmVzc1tdIHB1YmxpYyBlYXJseUNvbnRyaWJMaXN0OyAgDQogIA0KICAvKg0KICAgKiBFeGNoYW5nZSByYXRlIGFuZCBldGhlciBoYW5kbGluZw0KICAgKg0KICAgKiBUaGUgRkRDIGtlZXBzIHRyYWNrIG9mOg0KICAgKiAgLSB0aGUgZXhjaGFuZ2UgcmF0ZSBiZXR3ZWVuIGV0aGVyIGFuZCBTd2lzcyBmcmFuY3MNCiAgICogIC0gdGhlIHRvdGFsIGFuZCBwZXIgYWRkcmVzcyBldGhlciBkb25hdGlvbnMNCiAgICovDQogICANCiAgLy8gRXhjaGFuZ2UgcmF0ZSBiZXR3ZWVuIGV0aGVyIGFuZCBTd2lzcyBmcmFuY3MNCiAgdWludCBwdWJsaWMgd2VpUGVyQ0hGOyAgICAgICANCiAgDQogIC8vIFRvdGFsIG51bWJlciBvZiBXZWkgZG9uYXRlZCBvbi1jaGFpbiBzbyBmYXIgDQogIHVpbnQgcHVibGljIHRvdGFsV2VpRG9uYXRlZDsgDQogIA0KICAvLyBNYXBwaW5nIGZyb20gYWRkcmVzcyB0byB0b3RhbCBudW1iZXIgb2YgV2VpIGRvbmF0ZWQgZm9yIHRoZSBhZGRyZXNzDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgd2VpRG9uYXRlZDsgDQoNCiAgLyoNCiAgICogQWNjZXNzIGNvbnRyb2wgDQogICAqIA0KICAgKiBUaGUgZm9sbG93aW5nIHRocmVlIGFkZHJlc3NlcyBoYXZlIGFjY2VzcyB0byByZXN0cmljdGVkIGZ1bmN0aW9ucyBvZiB0aGUgDQogICAqIEZEQyBhbmQgdG8gdGhlIGRvbmF0ZWQgZnVuZHMuDQogICAqLw0KICAgDQogIC8vIFdhbGxldCBhZGRyZXNzIHRvIHdoaWNoIG9uLWNoYWluIGRvbmF0aW9ucyBhcmUgYmVpbmcgZm9yd2FyZGVkDQogIGFkZHJlc3MgcHVibGljIGZvdW5kYXRpb25XYWxsZXQ7IA0KICANCiAgLy8gQWRkcmVzcyB0aGF0IGlzIGFsbG93ZWQgdG8gcmVnaXN0ZXIgREZJTklUWSBTdGlmdHVuZy9lYXJseSBjb250cmlidXRpb25zDQogIC8vIGFuZCBvZmYtY2hhaW4gZG9uYXRpb25zIGFuZCB0byBkZWxheSBkb25hdGlvbiByb3VuZCAxDQogIGFkZHJlc3MgcHVibGljIHJlZ2lzdHJhckF1dGg7IA0KICANCiAgLy8gQWRkcmVzcyB0aGF0IGlzIGFsbG93ZWQgdG8gdXBkYXRlIHRoZSBleGNoYW5nZSByYXRlDQogIGFkZHJlc3MgcHVibGljIGV4Y2hhbmdlUmF0ZUF1dGg7IA0KDQogIC8vIEFkZHJlc3MgdGhhdCBpcyBhbGxvd2VkIHRvIHVwZGF0ZSB0aGUgb3RoZXIgYXV0aGVudGljYXRlZCBhZGRyZXNzZXMNCiAgYWRkcmVzcyBwdWJsaWMgbWFzdGVyQXV0aDsgDQoNCiAgLyoNCiAgICogR2xvYmFsIHZhcmlhYmxlcw0KICAgKi8NCiANCiAgLy8gVGhlIHBoYXNlIG51bWJlcnMgb2YgdGhlIGRvbmF0aW9uIHBoYXNlcyAoc2V0IGJ5IHRoZSBjb25zdHJ1Y3RvciwgDQogIC8vIHRoZXJlYWZ0ZXIgY29uc3RhbnQpDQogIHVpbnQgcGhhc2VPZlJvdW5kMDsNCiAgdWludCBwaGFzZU9mUm91bmQxOw0KICANCiAgLyoNCiAgICogRXZlbnRzDQogICAqDQogICAqICAtIERvbmF0aW9uUmVjZWlwdDogICAgIGxvZ3MgYW4gb24tY2hhaW4gb3Igb2ZmLWNoYWluIGRvbmF0aW9uDQogICAqICAtIEVhcmx5Q29udHJpYlJlY2VpcHQ6IGxvZ3MgdGhlIHJlZ2lzdHJhdGlvbiBvZiBlYXJseSBjb250cmlidXRpb24gDQogICAqICAtIEJ1cm5SZWNlaXB0OiAgICAgICAgIGxvZ3MgdGhlIGJ1cm5pbmcgb2YgdG9rZW4gZHVyaW5nIGZpbmFsaXphdGlvbg0KICAgKi8NCiAgZXZlbnQgRG9uYXRpb25SZWNlaXB0IChhZGRyZXNzIGluZGV4ZWQgYWRkciwgICAgICAgICAgLy8gREZOIGFkZHJlc3Mgb2YgZG9ub3INCiAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgaW5kZXhlZCBjdXJyZW5jeSwgICAgICAgLy8gZG9uYXRpb24gY3VycmVuY3kNCiAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IGluZGV4ZWQgYm9udXNNdWx0aXBsaWVyQXBwbGllZCwgLy8gZGVwZW5kcyBzdGFnZQ0KICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgdGltZXN0YW1wLCAgICAgICAgICAgICAgICAvLyB0aW1lIG9jY3VycmVkDQogICAgICAgICAgICAgICAgICAgICAgICAgdWludCB0b2tlbkFtb3VudCwgICAgICAgICAgICAgIC8vIERGTiB0byBiIHJlY29tbWVuZGVkDQogICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiBtZW1vKTsgICAgICAgICAgICAgICAgIC8vIHVuaXF1ZSBub3RlIGUuZyBUeElEDQogIGV2ZW50IEVhcmx5Q29udHJpYlJlY2VpcHQgKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCAgICAgIC8vIERGTiBhZGRyZXNzIG9mIGRvbm9yIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IHRva2VuQW1vdW50LCAgICAgICAgICAvLyAqcmVzdHJpY3RlZCogdG9rZW5zDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgbWVtbyk7ICAgICAgICAgICAgIC8vIGFyYml0cmFyeSBub3RlDQogIGV2ZW50IEJ1cm5SZWNlaXB0IChhZGRyZXNzIGluZGV4ZWQgYWRkciwgICAgICAgICAgICAgIC8vIERGTiBhZGRyZXNzIGFkanVzdGVkDQogICAgICAgICAgICAgICAgICAgICB1aW50IHRva2VuQW1vdW50QnVybmVkKTsgICAgICAgICAgIC8vIERGTiBkZWxldGVkIGJ5IGFkai4NCg0KICAvKioNCiAgICogQ29uc3RydWN0b3INCiAgICoNCiAgICogVGhlIGNvbnN0cnVjdG9yIGRlZmluZXMgDQogICAqICAtIHRoZSBwcml2aWxlZ2VkIGFkZHJlc3NlcyBmb3IgYWNjZXNzIGNvbnRyb2wNCiAgICogIC0gdGhlIHBoYXNlcyBpbiBiYXNlIGNvbnRyYWN0IFBoYXNlZA0KICAgKiAgLSB0aGUgbWFwcGluZyBiZXR3ZWVuIHBoYXNlIG51bWJlcnMgYW5kIHN0YXRlcw0KICAgKiAgLSB0aGUgdGFyZ2V0cyBpbiBiYXNlIGNvbnRyYWN0IFRhcmdldHMgDQogICAqICAtIHRoZSBzaGFyZSBmb3IgZWFybHkgY29udHJpYnV0b3JzIGluIGJhc2UgY29udHJhY3QgVG9rZW5UcmFja2VyDQogICAqICAtIHRoZSBzdGVwIGZ1bmN0aW9uIGZvciB0aGUgYm9udXMgY2FsY3VsYXRpb24gaW4gZG9uYXRpb24gcm91bmQgMSANCiAgICoNCiAgICogQWxsIGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVycyBhcmUgdGFrZW4gZnJvbSBiYXNlIGNvbnRyYWN0IFBhcmFtZXRlcnMuDQogICAqLw0KICBmdW5jdGlvbiBGREMoYWRkcmVzcyBfbWFzdGVyQXV0aCwgc3RyaW5nIF9uYW1lKQ0KICAgIFRva2VuVHJhY2tlcihlYXJseUNvbnRyaWJTaGFyZSkNCiAgICBTdGVwRnVuY3Rpb24ocm91bmQxRW5kVGltZS1yb3VuZDFTdGFydFRpbWUsIHJvdW5kMUluaXRpYWxCb251cywgDQogICAgICAgICAgICAgICAgIHJvdW5kMUJvbnVzU3RlcHMpIA0KICB7DQogICAgLyoNCiAgICAgKiBTZXQgaWRlbnRpZnlpbmcgc3RyaW5nDQogICAgICovDQogICAgbmFtZSA9IF9uYW1lOw0KDQogICAgLyoNCiAgICAgKiBTZXQgcHJpdmlsZWdlZCBhZGRyZXNzZXMgZm9yIGFjY2VzcyBjb250cm9sDQogICAgICovDQogICAgZm91bmRhdGlvbldhbGxldCAgPSBfbWFzdGVyQXV0aDsNCiAgICBtYXN0ZXJBdXRoICAgICA9IF9tYXN0ZXJBdXRoOw0KICAgIGV4Y2hhbmdlUmF0ZUF1dGggID0gX21hc3RlckF1dGg7DQogICAgcmVnaXN0cmFyQXV0aCAgPSBfbWFzdGVyQXV0aDsNCg0KICAgIC8qDQogICAgICogSW5pdGlhbGl6ZSBiYXNlIGNvbnRyYWN0IFBoYXNlZA0KICAgICAqIA0KICAgICAqICAgICAgICAgICB8LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBQaGFzZSBudW1iZXIgKDAtNykNCiAgICAgKiAgICAgICAgICAgfCAgICB8LS0tLS0tLS0tLS0tLS0tLS0tLS0gU3RhdGUgbmFtZQ0KICAgICAqICAgICAgICAgICB8ICAgIHwgICAgICAgICAgICAgICB8LS0tLSBUcmFuc2l0aW9uIG51bWJlciAoMC02KQ0KICAgICAqICAgICAgICAgICBWICAgIFYgICAgICAgICAgICAgICBWDQogICAgICovDQogICAgc3RhdGVPZlBoYXNlWzBdID0gc3RhdGUuZWFybHlDb250cmliOyANCiAgICBhZGRQaGFzZShyb3VuZDBTdGFydFRpbWUpOyAgICAgLy8gMA0KICAgIHN0YXRlT2ZQaGFzZVsxXSA9IHN0YXRlLnJvdW5kMDsNCiAgICBhZGRQaGFzZShyb3VuZDBFbmRUaW1lKTsgICAgICAgLy8gMSANCiAgICBzdGF0ZU9mUGhhc2VbMl0gPSBzdGF0ZS5vZmZDaGFpblJlZzsNCiAgICBhZGRQaGFzZShyb3VuZDFTdGFydFRpbWUpOyAgICAgLy8gMg0KICAgIHN0YXRlT2ZQaGFzZVszXSA9IHN0YXRlLnJvdW5kMTsNCiAgICBhZGRQaGFzZShyb3VuZDFFbmRUaW1lKTsgICAgICAgLy8gMyANCiAgICBzdGF0ZU9mUGhhc2VbNF0gPSBzdGF0ZS5vZmZDaGFpblJlZzsNCiAgICBhZGRQaGFzZShmaW5hbGl6ZVN0YXJ0VGltZSk7ICAgLy8gNCANCiAgICBzdGF0ZU9mUGhhc2VbNV0gPSBzdGF0ZS5maW5hbGl6YXRpb247DQogICAgYWRkUGhhc2UoZmluYWxpemVFbmRUaW1lKTsgICAgIC8vIDUgDQogICAgc3RhdGVPZlBoYXNlWzZdID0gc3RhdGUuZG9uZTsNCg0KICAgIC8vIExldCB0aGUgb3RoZXIgZnVuY3Rpb25zIGtub3cgd2hhdCBwaGFzZSBudW1iZXJzIHRoZSBkb25hdGlvbiByb3VuZHMgd2VyZQ0KICAgIC8vIGFzc2lnbmVkIHRvDQogICAgcGhhc2VPZlJvdW5kMCA9IDE7DQogICAgcGhhc2VPZlJvdW5kMSA9IDM7DQogICAgDQogICAgLy8gTWF4aW11bSBkZWxheSBmb3Igc3RhcnQgb2YgZG9uYXRpb24gcm91bmRzIA0KICAgIHNldE1heERlbGF5KHBoYXNlT2ZSb3VuZDAgLSAxLCBtYXhSb3VuZERlbGF5KTsNCiAgICBzZXRNYXhEZWxheShwaGFzZU9mUm91bmQxIC0gMSwgbWF4Um91bmREZWxheSk7DQoNCiAgICAvKg0KICAgICAqIEluaXRpYWxpemUgYmFzZSBjb250cmFjdCBUYXJnZXRzDQogICAgICovDQogICAgc2V0VGFyZ2V0KHBoYXNlT2ZSb3VuZDAsIHJvdW5kMFRhcmdldCk7DQogICAgc2V0VGFyZ2V0KHBoYXNlT2ZSb3VuZDEsIHJvdW5kMVRhcmdldCk7DQogIH0NCiAgDQogIC8qDQogICAqIFBVQkxJQyBmdW5jdGlvbnMNCiAgICogDQogICAqIFVuLWF1dGhlbnRpY2F0ZWQ6DQogICAqICAtIGdldFN0YXRlDQogICAqICAtIGdldE11bHRpcGxpZXJBdFRpbWUNCiAgICogIC0gZG9uYXRlQXNXaXRoQ2hlY2tzdW0NCiAgICogIC0gZmluYWxpemUNCiAgICogIC0gZW1wdHkNCiAgICogIC0gZ2V0U3RhdHVzDQogICAqDQogICAqIEF1dGhlbnRpY2F0ZWQ6DQogICAqICAtIHJlZ2lzdGVyRWFybHlDb250cmliDQogICAqICAtIHJlZ2lzdGVyT2ZmQ2hhaW5Eb25hdGlvbg0KICAgKiAgLSBzZXRFeGNoYW5nZVJhdGUNCiAgICogIC0gZGVsYXlSb3VuZDENCiAgICogIC0gc2V0Rm91bmRhdGlvbldhbGxldA0KICAgKiAgLSBzZXRSZWdpc3RyYXJBdXRoDQogICAqICAtIHNldEV4Y2hhbmdlUmF0ZUF1dGgNCiAgICogIC0gc2V0QWRtaW5BdXRoDQogICAqLw0KDQogIC8qKg0KICAgKiBHZXQgY3VycmVudCBzdGF0ZSBhdCB0aGUgY3VycmVudCBibG9jayB0aW1lIA0KICAgKi8NCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBjb25zdGFudCByZXR1cm5zIChzdGF0ZSkgew0KICAgIHJldHVybiBzdGF0ZU9mUGhhc2VbZ2V0UGhhc2VBdFRpbWUobm93KV07DQogIH0NCiAgDQogIC8qKg0KICAgKiBSZXR1cm4gdGhlIGJvbnVzIG11bHRpcGxpZXIgYXQgYSBnaXZlbiB0aW1lDQogICAqDQogICAqIFRoZSBnaXZlbiB0aW1lIG11c3QgIA0KICAgKiAgLSBsaWUgaW4gb25lIG9mIHRoZSBkb25hdGlvbiByb3VuZHMsIA0KICAgKiAgLSBub3QgbGllIGluIHRoZSBmdXR1cmUuDQogICAqIE90aGVyd2lzZSB0aGVyZSBpcyBubyB2YWxpZCBtdWx0aXBsaWVyLg0KICAgKi8NCiAgZnVuY3Rpb24gZ2V0TXVsdGlwbGllckF0VGltZSh1aW50IHRpbWUpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAvLyBHZXQgcGhhc2UgbnVtYmVyICh3aWxsIHRocm93IGlmIHRpbWUgbGllcyBpbiB0aGUgZnV0dXJlKQ0KICAgIHVpbnQgbiA9IGdldFBoYXNlQXRUaW1lKHRpbWUpOw0KDQogICAgLy8gSWYgdGltZSBsaWVzIGluIGRvbmF0aW9uIHJvdW5kIDAgd2UgcmV0dXJuIHRoZSBjb25zdGFudCBtdWx0aXBsaWVyIA0KICAgIGlmIChzdGF0ZU9mUGhhc2Vbbl0gPT0gc3RhdGUucm91bmQwKSB7DQogICAgICByZXR1cm4gMTAwICsgcm91bmQwQm9udXM7DQogICAgfQ0KDQogICAgLy8gSWYgdGltZSBsaWVzIGluIGRvbmF0aW9uIHJvdW5kIDEgd2UgcmV0dXJuIHRoZSBzdGVwIGZ1bmN0aW9uDQogICAgaWYgKHN0YXRlT2ZQaGFzZVtuXSA9PSBzdGF0ZS5yb3VuZDEpIHsNCiAgICAgIHJldHVybiAxMDAgKyBnZXRTdGVwRnVuY3Rpb24odGltZSAtIGdldFBoYXNlU3RhcnRUaW1lKG4pKTsNCiAgICB9DQoNCiAgICAvLyBUaHJvdyBvdXRzaWRlIG9mIGRvbmF0aW9uIHJvdW5kcw0KICAgIHRocm93Ow0KICB9DQoNCiAgLyoqDQogICAqIFNlbmQgZG9uYXRpb24gaW4gdGhlIG5hbWUgYSB0aGUgZ2l2ZW4gYWRkcmVzcyB3aXRoIGNoZWNrc3VtDQogICAqDQogICAqIFRoZSBzZWNvbmQgYXJndW1lbnQgaXMgYSBjaGVja3N1bSB3aGljaCBtdXN0IGVxdWFsIHRoZSBmaXJzdCA0IGJ5dGVzIG9mIHRoZQ0KICAgKiBTSEEtMjU2IGRpZ2VzdCBvZiB0aGUgYnl0ZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgYWRkcmVzcy4NCiAgICovDQogIGZ1bmN0aW9uIGRvbmF0ZUFzV2l0aENoZWNrc3VtKGFkZHJlc3MgYWRkciwgYnl0ZXM0IGNoZWNrc3VtKSANCiAgICBwYXlhYmxlIA0KICAgIHJldHVybnMgKGJvb2wpIA0KICB7DQogICAgLy8gQ2FsY3VsYXRlIFNIQS0yNTYgZGlnZXN0IG9mIHRoZSBhZGRyZXNzIA0KICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTI1NihhZGRyKTsNCiAgICANCiAgICAvLyBUaHJvdyBpcyB0aGUgY2hlY2tzdW0gZG9lcyBub3QgbWF0Y2ggdGhlIGZpcnN0IDQgYnl0ZXMNCiAgICBpZiAoYnl0ZXM0KGhhc2gpICE9IGNoZWNrc3VtKSB7IHRocm93IDsgfQ0KDQogICAgLy8gQ2FsbCB1bi1jaGVja3N1bW1lZCBkb25hdGUgZnVuY3Rpb24gDQogICAgcmV0dXJuIGRvbmF0ZUFzKGFkZHIpOw0KICB9DQoNCiAgLyoqDQogICAqIEZpbmFsaXplIHRoZSBiYWxhbmNlIGZvciB0aGUgZ2l2ZW4gYWRkcmVzcw0KICAgKg0KICAgKiBUaGlzIGZ1bmN0aW9uIHRyaWdnZXJzIHRoZSBjb252ZXJzaW9uIChhbmQgYnVybikgb2YgdGhlIHJlc3RyaWN0ZWQgdG9rZW5zDQogICAqIHRoYXQgYXJlIGFzc2lnbmVkIHRvIHRoZSBnaXZlbiBhZGRyZXNzLg0KICAgKg0KICAgKiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgYXZhaWxhYmxlIGR1cmluZyB0aGUgZmluYWxpemF0aW9uIHBoYXNlLiBJdCBtYW5hZ2VzDQogICAqIHRoZSBjYWxscyB0byBjbG9zZUFzc2lnbm1lbnRzKCkgYW5kIHVucmVzdHJpY3QoKSBvZiBUb2tlblRyYWNrZXIuDQogICAqLw0KICBmdW5jdGlvbiBmaW5hbGl6ZShhZGRyZXNzIGFkZHIpIHsNCiAgICAvLyBUaHJvdyBpZiB3ZSBhcmUgbm90IGluIHRoZSBmaW5hbGl6YXRpb24gcGhhc2UgDQogICAgaWYgKGdldFN0YXRlKCkgIT0gc3RhdGUuZmluYWxpemF0aW9uKSB7IHRocm93OyB9DQoNCiAgICAvLyBDbG9zZSBkb3duIGZ1cnRoZXIgYXNzaWdubWVudHMgaW4gVG9rZW5UcmFja2VyDQogICAgY2xvc2VBc3NpZ25tZW50c0lmT3BlbigpOyANCg0KICAgIC8vIEJ1cm4gdG9rZW5zDQogICAgdWludCB0b2tlbnNCdXJuZWQgPSB1bnJlc3RyaWN0KGFkZHIpOyANCiAgICANCiAgICAvLyBJc3N1ZSBidXJuIHJlY2VpcHQNCiAgICBCdXJuUmVjZWlwdChhZGRyLCB0b2tlbnNCdXJuZWQpOw0KDQogICAgLy8gSWYgbm8gcmVzdHJpY3RlZCB0b2tlbnMgbGVmdA0KICAgIGlmIChpc1VucmVzdHJpY3RlZCgpKSB7IA0KICAgICAgLy8gdGhlbiBlbmQgdGhlIGZpbmFsaXphdGlvbiBwaGFzZSBpbW1lZGlhdGVseQ0KICAgICAgZW5kQ3VycmVudFBoYXNlSW4oMCk7IA0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBTZW5kIGFueSByZW1haW5pbmcgYmFsYW5jZSB0byB0aGUgZm91bmRhdGlvbiB3YWxsZXQNCiAgICovDQogIGZ1bmN0aW9uIGVtcHR5KCkgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiBmb3VuZGF0aW9uV2FsbGV0LmNhbGwudmFsdWUodGhpcy5iYWxhbmNlKSgpOw0KICB9DQoNCiAgLyoqDQogICAqIEdldCBzdGF0dXMgaW5mb3JtYXRpb24gZnJvbSB0aGUgRkRDDQogICAqDQogICAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBhIG1peCBvZg0KICAgKiAgLSBnbG9iYWwgc3RhdHVzIG9mIHRoZSBGREMNCiAgICogIC0gZ2xvYmFsIHN0YXR1cyBvZiB0aGUgRkRDIHNwZWNpZmljIGZvciBvbmUgb2YgdGhlIHR3byBkb25hdGlvbiByb3VuZHMNCiAgICogIC0gc3RhdHVzIHJlbGF0ZWQgdG8gYSBzcGVjaWZpYyB0b2tlbiBhZGRyZXNzIChERklOSVRZIGFkZHJlc3MpDQogICAqICAtIHN0YXR1cyAoYmFsYW5jZSkgb2YgYW4gZXh0ZXJuYWwgRXRoZXJldW0gYWNjb3VudCANCiAgICoNCiAgICogQXJndW1lbnRzIGFyZToNCiAgICogIC0gZG9uYXRpb25Sb3VuZDogZG9uYXRpb24gcm91bmQgdG8gcXVlcnkgKDAgb3IgMSkNCiAgICogIC0gZGZuQWRkcjogdG9rZW4gYWRkcmVzcyB0byBxdWVyeQ0KICAgKiAgLSBmd2RBZGRyOiBleHRlcm5hbCBFdGhlcmV1bSBhZGRyZXNzIHRvIHF1ZXJ5DQogICAqLw0KICBmdW5jdGlvbiBnZXRTdGF0dXModWludCBkb25hdGlvblJvdW5kLCBhZGRyZXNzIGRmbkFkZHIsIGFkZHJlc3MgZndkQWRkcikNCiAgICBwdWJsaWMgY29uc3RhbnQNCiAgICByZXR1cm5zICgNCiAgICAgIHN0YXRlIGN1cnJlbnRTdGF0ZSwgICAgIC8vIGN1cnJlbnQgc3RhdGUgKGFuIGVudW0pDQogICAgICB1aW50IGZ4UmF0ZSwgICAgICAgICAgICAvLyBleGNoYW5nZSByYXRlIG9mIENIRiAtPiBFVEggKFdlaS9DSEYpDQogICAgICB1aW50IGN1cnJlbnRNdWx0aXBsaWVyLCAvLyBjdXJyZW50IGJvbnVzIG11bHRpcGxpZXIgKDAgaWYgaW52YWxpZCkNCiAgICAgIHVpbnQgZG9uYXRpb25Db3VudCwgICAgIC8vIHRvdGFsIGluZGl2aWR1YWwgZG9uYXRpb25zIG1hZGUgKGEgY291bnQpDQogICAgICB1aW50IHRvdGFsVG9rZW5BbW91bnQsICAvLyB0b3RhbCBERk4gcGxhbm5lZCBhbGxvY2F0ZWQgdG8gZG9ub3JzDQogICAgICB1aW50IHN0YXJ0VGltZSwgICAgICAgICAvLyBleHBlY3RlZCBzdGFydCB0aW1lIG9mIHNwZWNpZmllZCBkb25hdGlvbiByb3VuZA0KICAgICAgdWludCBlbmRUaW1lLCAgICAgICAgICAgLy8gZXhwZWN0ZWQgZW5kIHRpbWUgb2Ygc3BlY2lmaWVkIGRvbmF0aW9uIHJvdW5kDQogICAgICBib29sIGlzVGFyZ2V0UmVhY2hlZCwgICAvLyB3aGV0aGVyIHJvdW5kIHRhcmdldCBoYXMgYmVlbiByZWFjaGVkDQogICAgICB1aW50IGNoZkNlbnRzRG9uYXRlZCwgICAvLyB0b3RhbCB2YWx1ZSBkb25hdGVkIGluIHNwZWNpZmllZCByb3VuZCBhcyBDSEYNCiAgICAgIHVpbnQgdG9rZW5BbW91bnQsICAgICAgIC8vIHRvdGFsIERGTiBwbGFubmVkIGFsbG9jdGVkIHRvIGRvbm9yICh1c2VyKQ0KICAgICAgdWludCBmd2RCYWxhbmNlLCAgICAgICAgLy8gdG90YWwgRVRIIChpbiBXZWkpIHdhaXRpbmcgaW4gZm93YXJkaW5nIGFkZHJlc3MNCiAgICAgIHVpbnQgZG9uYXRlZCkgICAgICAgICAgIC8vIHRvdGFsIEVUSCAoaW4gV2VpKSBkb25hdGVkIGJ5IERGTiBhZGRyZXNzIA0KICB7DQogICAgLy8gVGhlIGdsb2JhbCBzdGF0dXMNCiAgICBjdXJyZW50U3RhdGUgPSBnZXRTdGF0ZSgpOw0KICAgIGlmIChjdXJyZW50U3RhdGUgPT0gc3RhdGUucm91bmQwIHx8IGN1cnJlbnRTdGF0ZSA9PSBzdGF0ZS5yb3VuZDEpIHsNCiAgICAgIGN1cnJlbnRNdWx0aXBsaWVyID0gZ2V0TXVsdGlwbGllckF0VGltZShub3cpOw0KICAgIH0gDQogICAgZnhSYXRlID0gd2VpUGVyQ0hGOw0KICAgIGRvbmF0aW9uQ291bnQgPSB0b3RhbFVucmVzdHJpY3RlZEFzc2lnbm1lbnRzOw0KICAgIHRvdGFsVG9rZW5BbW91bnQgPSB0b3RhbFVucmVzdHJpY3RlZFRva2VuczsNCiAgIA0KICAgIC8vIFRoZSByb3VuZCBzcGVjaWZpYyBzdGF0dXMNCiAgICBpZiAoZG9uYXRpb25Sb3VuZCA9PSAwKSB7DQogICAgICBzdGFydFRpbWUgPSBnZXRQaGFzZVN0YXJ0VGltZShwaGFzZU9mUm91bmQwKTsNCiAgICAgIGVuZFRpbWUgPSBnZXRQaGFzZVN0YXJ0VGltZShwaGFzZU9mUm91bmQwICsgMSk7DQogICAgICBpc1RhcmdldFJlYWNoZWQgPSB0YXJnZXRSZWFjaGVkKHBoYXNlT2ZSb3VuZDApOw0KICAgICAgY2hmQ2VudHNEb25hdGVkID0gY291bnRlcltwaGFzZU9mUm91bmQwXTsNCiAgICB9IGVsc2Ugew0KICAgICAgc3RhcnRUaW1lID0gZ2V0UGhhc2VTdGFydFRpbWUocGhhc2VPZlJvdW5kMSk7DQogICAgICBlbmRUaW1lID0gZ2V0UGhhc2VTdGFydFRpbWUocGhhc2VPZlJvdW5kMSArIDEpOw0KICAgICAgaXNUYXJnZXRSZWFjaGVkID0gdGFyZ2V0UmVhY2hlZChwaGFzZU9mUm91bmQxKTsNCiAgICAgIGNoZkNlbnRzRG9uYXRlZCA9IGNvdW50ZXJbcGhhc2VPZlJvdW5kMV07DQogICAgfQ0KICAgIA0KICAgIC8vIFRoZSBzdGF0dXMgc3BlY2lmaWMgdG8gdGhlIERGTiBhZGRyZXNzDQogICAgdG9rZW5BbW91bnQgPSB0b2tlbnNbZGZuQWRkcl07DQogICAgZG9uYXRlZCA9IHdlaURvbmF0ZWRbZGZuQWRkcl07DQogICAgDQogICAgLy8gVGhlIHN0YXR1cyBzcGVjaWZpYyB0byB0aGUgRXRoZXJldW0gYWRkcmVzcw0KICAgIGZ3ZEJhbGFuY2UgPSBmd2RBZGRyLmJhbGFuY2U7DQogIH0NCiAgDQogIC8qKg0KICAgKiBTZXQgdGhlIGV4Y2hhbmdlIHJhdGUgYmV0d2VlbiBldGhlciBhbmQgU3dpc3MgZnJhbmNzIGluIFdlaSBwZXIgQ0hGDQogICAqDQogICAqIE11c3QgYmUgY2FsbGVkIGZyb20gZXhjaGFuZ2VSYXRlQXV0aC4NCiAgICovDQogIGZ1bmN0aW9uIHNldFdlaVBlckNIRih1aW50IHdlaXMpIHsNCiAgICAvLyBSZXF1aXJlIHBlcm1pc3Npb24NCiAgICBpZiAobXNnLnNlbmRlciAhPSBleGNoYW5nZVJhdGVBdXRoKSB7IHRocm93OyB9DQoNCiAgICAvLyBTZXQgdGhlIGdsb2JhbCBzdGF0ZSB2YXJpYWJsZSBmb3IgZXhjaGFuZ2UgcmF0ZSANCiAgICB3ZWlQZXJDSEYgPSB3ZWlzOw0KICB9DQoNCiAgLyoqDQogICAqIFJlZ2lzdGVyIGVhcmx5IGNvbnRyaWJ1dGlvbiBpbiB0aGUgbmFtZSBvZiB0aGUgZ2l2ZW4gYWRkcmVzcw0KICAgKg0KICAgKiBNdXN0IGJlIGNhbGxlZCBmcm9tIHJlZ2lzdHJhckF1dGguDQogICAqDQogICAqIEFyZ3VtZW50cyBhcmU6DQogICAqICAtIGFkZHI6IGFkZHJlc3MgdG8gdGhlIHRva2VucyBhcmUgYXNzaWduZWQNCiAgICogIC0gdG9rZW5BbW91bnQ6IG51bWJlciBvZiByZXN0cmljdGVkIHRva2VucyB0byBhc3NpZ24NCiAgICogIC0gbWVtbzogb3B0aW9uYWwgZHluYW1pYyBieXRlcyBvZiBkYXRhIHRvIGFwcGVhciBpbiB0aGUgcmVjZWlwdA0KICAgKi8NCiAgZnVuY3Rpb24gcmVnaXN0ZXJFYXJseUNvbnRyaWIoYWRkcmVzcyBhZGRyLCB1aW50IHRva2VuQW1vdW50LCBieXRlczMyIG1lbW8pIHsNCiAgICAvLyBSZXF1aXJlIHBlcm1pc3Npb24NCiAgICBpZiAobXNnLnNlbmRlciAhPSByZWdpc3RyYXJBdXRoKSB7IHRocm93OyB9DQoNCiAgICAvLyBSZWplY3QgcmVnaXN0cmF0aW9ucyBvdXRzaWRlIHRoZSBlYXJseSBjb250cmlidXRpb24gcGhhc2UNCiAgICBpZiAoZ2V0U3RhdGUoKSAhPSBzdGF0ZS5lYXJseUNvbnRyaWIpIHsgdGhyb3c7IH0NCg0KICAgIC8vIEFkZCBhZGRyZXNzIHRvIGxpc3QgaWYgbmV3DQogICAgaWYgKCFpc1JlZ2lzdGVyZWQoYWRkciwgdHJ1ZSkpIHsNCiAgICAgIGVhcmx5Q29udHJpYkxpc3QucHVzaChhZGRyKTsNCiAgICB9DQogICAgDQogICAgLy8gQXNzaWduIHJlc3RyaWN0ZWQgdG9rZW5zIGluIFRva2VuVHJhY2tlcg0KICAgIGFzc2lnbihhZGRyLCB0b2tlbkFtb3VudCwgdHJ1ZSk7DQogICAgDQogICAgLy8gSXNzdWUgZWFybHkgY29udHJpYnV0aW9uIHJlY2VpcHQNCiAgICBFYXJseUNvbnRyaWJSZWNlaXB0KGFkZHIsIHRva2VuQW1vdW50LCBtZW1vKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBSZWdpc3RlciBvZmYtY2hhaW4gZG9uYXRpb24gaW4gdGhlIG5hbWUgb2YgdGhlIGdpdmVuIGFkZHJlc3MNCiAgICoNCiAgICogTXVzdCBiZSBjYWxsZWQgZnJvbSByZWdpc3RyYXJBdXRoLg0KICAgKg0KICAgKiBBcmd1bWVudHMgYXJlOg0KICAgKiAgLSBhZGRyOiBhZGRyZXNzIHRvIHRoZSB0b2tlbnMgYXJlIGFzc2lnbmVkDQogICAqICAtIHRpbWVzdGFtcDogdGltZSB3aGVuIHRoZSBkb25hdGlvbiBjYW1lIGluIChkZXRlcm1pbmVzIHJvdW5kIGFuZCBib251cykNCiAgICogIC0gY2hmQ2VudHM6IHZhbHVlIG9mIHRoZSBkb25hdGlvbiBpbiBjZW50cyBvZiBTd2lzcyBmcmFuY3MNCiAgICogIC0gY3VycmVuY3k6IHRoZSBvcmlnaW5hbCBjdXJyZW5jeSBvZiB0aGUgZG9uYXRpb24gKHRocmVlIGxldHRlciBzdHJpbmcpDQogICAqICAtIG1lbW86IG9wdGlvbmFsIGJ5dGVzIG9mIGRhdGEgdG8gYXBwZWFyIGluIHRoZSByZWNlaXB0DQogICAqDQogICAqIFRoZSB0aW1lc3RhbXAgbXVzdCBub3QgYmUgaW4gdGhlIGZ1dHVyZS4gVGhpcyBpcyBiZWNhdXNlIHRoZSB0aW1lc3RhbXAgDQogICAqIGRlZmluZXMgdGhlIGRvbmF0aW9uIHJvdW5kIGFuZCB0aGUgbXVsdGlwbGllciBhbmQgZnV0dXJlIHBoYXNlIHRpbWVzIGFyZQ0KICAgKiBzdGlsbCBzdWJqZWN0IHRvIGNoYW5nZS4NCiAgICoNCiAgICogSWYgY2FsbGVkIGR1cmluZyBhIGRvbmF0aW9uIHJvdW5kIHRoZW4gdGhlIHRpbWVzdGFtcCBtdXN0IGxpZSBpbiB0aGUgc2FtZSANCiAgICogcGhhc2UgYW5kIGlmIGNhbGxlZCBkdXJpbmcgdGhlIGV4dGVuZGVkIHBlcmlvZCBmb3Igb2ZmLWNoYWluIGRvbmF0aW9ucyB0aGVuDQogICAqIHRoZSB0aW1lc3RhbXAgbXVzdCBsaWUgaW4gdGhlIGltbWVkaWF0ZWx5IHByZWNlZGluZyBkb25hdGlvbiByb3VuZC4gDQogICAqLw0KICBmdW5jdGlvbiByZWdpc3Rlck9mZkNoYWluRG9uYXRpb24oYWRkcmVzcyBhZGRyLCB1aW50IHRpbWVzdGFtcCwgdWludCBjaGZDZW50cywgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgY3VycmVuY3ksIGJ5dGVzMzIgbWVtbykNCiAgew0KICAgIC8vIFJlcXVpcmUgcGVybWlzc2lvbg0KICAgIGlmIChtc2cuc2VuZGVyICE9IHJlZ2lzdHJhckF1dGgpIHsgdGhyb3c7IH0NCg0KICAgIC8vIFRoZSBjdXJyZW50IHBoYXNlIG51bWJlciBhbmQgc3RhdGUgY29ycmVzcG9uZGluZyBzdGF0ZQ0KICAgIHVpbnQgY3VycmVudFBoYXNlID0gZ2V0UGhhc2VBdFRpbWUobm93KTsNCiAgICBzdGF0ZSBjdXJyZW50U3RhdGUgPSBzdGF0ZU9mUGhhc2VbY3VycmVudFBoYXNlXTsNCiAgICANCiAgICAvLyBSZWplY3QgcmVnaXN0cmF0aW9ucyBvdXRzaWRlIHRoZSB0d28gZG9uYXRpb24gcm91bmRzIChpbmNsLiB0aGVpcg0KICAgIC8vIGV4dGVuZGVkIHJlZ2lzdHJhdGlvbiBwZXJpb2RzIGZvciBvZmYtY2hhaW4gZG9uYXRpb25zKQ0KICAgIGlmIChjdXJyZW50U3RhdGUgIT0gc3RhdGUucm91bmQwICYmIGN1cnJlbnRTdGF0ZSAhPSBzdGF0ZS5yb3VuZDEgJiYNCiAgICAgICAgY3VycmVudFN0YXRlICE9IHN0YXRlLm9mZkNoYWluUmVnKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogICANCiAgICAvLyBUaHJvdyBpZiB0aW1lc3RhbXAgaXMgaW4gdGhlIGZ1dHVyZQ0KICAgIGlmICh0aW1lc3RhbXAgPiBub3cpIHsgdGhyb3c7IH0NCiAgIA0KICAgIC8vIFBoYXNlIG51bWJlciBhbmQgY29ycmVzcG9uZGluZyBzdGF0ZSBvZiB0aGUgdGltZXN0YW1wICANCiAgICB1aW50IHRpbWVzdGFtcFBoYXNlID0gZ2V0UGhhc2VBdFRpbWUodGltZXN0YW1wKTsNCiAgICBzdGF0ZSB0aW1lc3RhbXBTdGF0ZSA9IHN0YXRlT2ZQaGFzZVt0aW1lc3RhbXBQaGFzZV07DQogICANCiAgICAvLyBUaHJvdyBpZiBjYWxsZWQgZHVyaW5nIGEgZG9uYXRpb24gcm91bmQgYW5kIHRoZSB0aW1lc3RhbXAgZG9lcyBub3QgbWF0Y2gNCiAgICAvLyB0aGF0IHBoYXNlLg0KICAgIGlmICgoY3VycmVudFN0YXRlID09IHN0YXRlLnJvdW5kMCB8fCBjdXJyZW50U3RhdGUgPT0gc3RhdGUucm91bmQxKSAmJg0KICAgICAgICAodGltZXN0YW1wU3RhdGUgIT0gY3VycmVudFN0YXRlKSkgeyANCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICANCiAgICAvLyBUaHJvdyBpZiBjYWxsZWQgZHVyaW5nIHRoZSBleHRlbmRlZCBwZXJpb2QgZm9yIG9mZi1jaGFpbiBkb25hdGlvbnMgYW5kDQogICAgLy8gdGhlIHRpbWVzdGFtcCBkb2VzIG5vdCBsaWUgaW4gdGhlIGltbWVkaWF0ZWx5IHByZWNlZGluZyBkb25hdGlvbiBwaGFzZS4NCiAgICBpZiAoY3VycmVudFN0YXRlID09IHN0YXRlLm9mZkNoYWluUmVnICYmIHRpbWVzdGFtcFBoYXNlICE9IGN1cnJlbnRQaGFzZS0xKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyBUaHJvdyBpZiB0aGUgbWVtbyBpcyBkdXBsaWNhdGVkDQogICAgaWYgKG1lbW9Vc2VkW21lbW9dKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyBTZXQgdGhlIG1lbW8gaXRlbSB0byB0cnVlDQogICAgbWVtb1VzZWRbbWVtb10gPSB0cnVlOw0KDQogICAgLy8gRG8gdGhlIGJvb2sta2VlcGluZw0KICAgIGJvb2tEb25hdGlvbihhZGRyLCB0aW1lc3RhbXAsIGNoZkNlbnRzLCBjdXJyZW5jeSwgbWVtbyk7DQogIH0NCg0KICAvKioNCiAgICogRGVsYXkgYSBkb25hdGlvbiByb3VuZA0KICAgKg0KICAgKiBNdXN0IGJlIGNhbGxlZCBmcm9tIHRoZSBhZGRyZXNzIHJlZ2lzdHJhckF1dGguDQogICAqDQogICAqIFRoaXMgZnVuY3Rpb24gZGVsYXlzIHRoZSBzdGFydCBvZiBkb25hdGlvbiByb3VuZCAxIGJ5IHRoZSBnaXZlbiB0aW1lIGRlbHRhDQogICAqIHVubGVzcyB0aGUgdGltZSBkZWx0YSBpcyBiaWdnZXIgdGhhbiB0aGUgY29uZmlndXJlZCBtYXhpbXVtIGRlbGF5Lg0KICAgKi8NCiAgZnVuY3Rpb24gZGVsYXlEb25QaGFzZSh1aW50IGRvblBoYXNlLCB1aW50IHRpbWVkZWx0YSkgew0KICAgIC8vIFJlcXVpcmUgcGVybWlzc2lvbg0KICAgIGlmIChtc2cuc2VuZGVyICE9IHJlZ2lzdHJhckF1dGgpIHsgdGhyb3c7IH0NCg0KICAgIC8vIFBhc3MgdGhlIGNhbGwgb24gdG8gYmFzZSBjb250cmFjdCBQaGFzZWQNCiAgICAvLyBEZWxheWluZyB0aGUgc3RhcnQgb2YgYSBkb25hdGlvbiByb3VuZCBpcyB0aGUgc2FtZSBhcyBkZWxheWluZyB0aGUgZW5kIA0KICAgIC8vIG9mIHRoZSBwcmVjZWRpbmcgcGhhc2UNCiAgICBpZiAoZG9uUGhhc2UgPT0gMCkgew0KICAgICAgZGVsYXlQaGFzZUVuZEJ5KHBoYXNlT2ZSb3VuZDAgLSAxLCB0aW1lZGVsdGEpOw0KICAgIH0gZWxzZSBpZiAoZG9uUGhhc2UgPT0gMSkgew0KICAgICAgZGVsYXlQaGFzZUVuZEJ5KHBoYXNlT2ZSb3VuZDEgLSAxLCB0aW1lZGVsdGEpOw0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBTZXQgdGhlIGZvcndhcmRpbmcgYWRkcmVzcyBmb3IgZG9uYXRlZCBldGhlcg0KICAgKiANCiAgICogTXVzdCBiZSBjYWxsZWQgZnJvbSB0aGUgYWRkcmVzcyBtYXN0ZXJBdXRoIGJlZm9yZSBkb25hdGlvbiByb3VuZCAwIHN0YXJ0cy4NCiAgICovDQogIGZ1bmN0aW9uIHNldEZvdW5kYXRpb25XYWxsZXQoYWRkcmVzcyBuZXdBZGRyKSB7DQogICAgLy8gUmVxdWlyZSBwZXJtaXNzaW9uDQogICAgaWYgKG1zZy5zZW5kZXIgIT0gbWFzdGVyQXV0aCkgeyB0aHJvdzsgfQ0KICAgIA0KICAgIC8vIFJlcXVpcmUgcGhhc2UgYmVmb3JlIHJvdW5kIDANCiAgICBpZiAoZ2V0UGhhc2VBdFRpbWUobm93KSA+PSBwaGFzZU9mUm91bmQwKSB7IHRocm93OyB9DQogDQogICAgZm91bmRhdGlvbldhbGxldCA9IG5ld0FkZHI7DQogIH0NCg0KICAvKioNCiAgICogU2V0IG5ldyBhdXRoZW50aWNhdGVkIGFkZHJlc3MgZm9yIHNldHRpbmcgZXhjaGFuZ2UgcmF0ZQ0KICAgKiANCiAgICogTXVzdCBiZSBjYWxsZWQgZnJvbSB0aGUgYWRkcmVzcyBtYXN0ZXJBdXRoLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0RXhjaGFuZ2VSYXRlQXV0aChhZGRyZXNzIG5ld0F1dGgpIHsNCiAgICAvLyBSZXF1aXJlIHBlcm1pc3Npb24NCiAgICBpZiAobXNnLnNlbmRlciAhPSBtYXN0ZXJBdXRoKSB7IHRocm93OyB9DQogDQogICAgZXhjaGFuZ2VSYXRlQXV0aCA9IG5ld0F1dGg7DQogIH0NCg0KICAvKioNCiAgICogU2V0IG5ldyBhdXRoZW50aWNhdGVkIGFkZHJlc3MgZm9yIHJlZ2lzdHJhdGlvbnMNCiAgICogDQogICAqIE11c3QgYmUgY2FsbGVkIGZyb20gdGhlIGFkZHJlc3MgbWFzdGVyQXV0aC4NCiAgICovDQogIGZ1bmN0aW9uIHNldFJlZ2lzdHJhckF1dGgoYWRkcmVzcyBuZXdBdXRoKSB7DQogICAgLy8gUmVxdWlyZSBwZXJtaXNzaW9uDQogICAgaWYgKG1zZy5zZW5kZXIgIT0gbWFzdGVyQXV0aCkgeyB0aHJvdzsgfQ0KIA0KICAgIHJlZ2lzdHJhckF1dGggPSBuZXdBdXRoOw0KICB9DQoNCiAgLyoqDQogICAqIFNldCBuZXcgYXV0aGVudGljYXRlZCBhZGRyZXNzIGZvciBhZG1pbg0KICAgKiANCiAgICogTXVzdCBiZSBjYWxsZWQgZnJvbSB0aGUgYWRkcmVzcyBtYXN0ZXJBdXRoLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0TWFzdGVyQXV0aChhZGRyZXNzIG5ld0F1dGgpIHsNCiAgICAvLyBSZXF1aXJlIHBlcm1pc3Npb24NCiAgICBpZiAobXNnLnNlbmRlciAhPSBtYXN0ZXJBdXRoKSB7IHRocm93OyB9DQogDQogICAgbWFzdGVyQXV0aCA9IG5ld0F1dGg7DQogIH0NCg0KICAvKg0KICAgKiBQUklWQVRFIGZ1bmN0aW9ucw0KICAgKg0KICAgKiAgLSBkb25hdGVBcw0KICAgKiAgLSBib29rRG9uYXRpb24NCiAgICovDQogIA0KICAvKioNCiAgICogUHJvY2VzcyBvbi1jaGFpbiBkb25hdGlvbiBpbiB0aGUgbmFtZSBvZiB0aGUgZ2l2ZW4gYWRkcmVzcyANCiAgICoNCiAgICogVGhpcyBmdW5jdGlvbiBpcyBwcml2YXRlIGJlY2F1c2UgaXQgc2hhbGwgb25seSBiZSBjYWxsZWQgdGhyb3VnaCBpdHMgDQogICAqIHdyYXBwZXIgZG9uYXRlQXNXaXRoQ2hlY2tzdW0uDQogICAqLw0KICBmdW5jdGlvbiBkb25hdGVBcyhhZGRyZXNzIGFkZHIpIHByaXZhdGUgcmV0dXJucyAoYm9vbCkgew0KICAgIC8vIFRoZSBjdXJyZW50IHN0YXRlDQogICAgc3RhdGUgc3QgPSBnZXRTdGF0ZSgpOw0KICAgIA0KICAgIC8vIFRocm93IGlmIGN1cnJlbnQgc3RhdGUgaXMgbm90IGEgZG9uYXRpb24gcm91bmQNCiAgICBpZiAoc3QgIT0gc3RhdGUucm91bmQwICYmIHN0ICE9IHN0YXRlLnJvdW5kMSkgeyB0aHJvdzsgfQ0KDQogICAgLy8gVGhyb3cgaWYgZG9uYXRpb24gYW1vdW50IGlzIGJlbG93IG1pbmltdW0NCiAgICBpZiAobXNnLnZhbHVlIDwgbWluRG9uYXRpb24pIHsgdGhyb3c7IH0NCg0KICAgIC8vIFRocm93IGlmIHRoZSBleGNoYW5nZSByYXRlIGlzIG5vdCB5ZXQgZGVmaW5lZA0KICAgIGlmICh3ZWlQZXJDSEYgPT0gMCkgeyB0aHJvdzsgfSANCg0KICAgIC8vIFVwZGF0ZSBjb3VudGVycyBmb3IgZXRoZXIgZG9uYXRpb25zDQogICAgdG90YWxXZWlEb25hdGVkICs9IG1zZy52YWx1ZTsNCiAgICB3ZWlEb25hdGVkW2FkZHJdICs9IG1zZy52YWx1ZTsNCg0KICAgIC8vIENvbnZlcnQgZXRoZXIgdG8gU3dpc3MgZnJhbmNzDQogICAgdWludCBjaGZDZW50cyA9IChtc2cudmFsdWUgKiAxMDApIC8gd2VpUGVyQ0hGOw0KICAgIA0KICAgIC8vIERvIHRoZSBib29rLWtlZXBpbmcNCiAgICBib29rRG9uYXRpb24oYWRkciwgbm93LCBjaGZDZW50cywgIkVUSCIsICIiKTsNCg0KICAgIC8vIEZvcndhcmQgYmFsYW5jZSB0byB0aGUgZm91bmRhdGlvbiB3YWxsZXQNCiAgICByZXR1cm4gZm91bmRhdGlvbldhbGxldC5jYWxsLnZhbHVlKHRoaXMuYmFsYW5jZSkoKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBQdXQgYW4gYWNjZXB0ZWQgZG9uYXRpb24gaW4gdGhlIGJvb2tzLg0KICAgKg0KICAgKiBUaGlzIGZ1bmN0aW9uDQogICAqICAtIGNhbm5vdCB0aHJvdyBhcyBhbGwgY2hlY2tzIGhhdmUgYmVlbiBkb25lIGJlZm9yZSwgDQogICAqICAtIGlzIGFnbm9zdGljIHRvIHRoZSBzb3VyY2Ugb2YgdGhlIGRvbmF0aW9uIChvbi1jaGFpbiBvciBvZmYtY2hhaW4pDQogICAqICAtIGlzIGFnbm9zdGljIHRvIHRoZSBjdXJyZW5jeSANCiAgICogICAgKHRoZSBjdXJyZW5jeSBhcmd1bWVudCBpcyBzaW1wbHkgcGFzc2VkIHRocm91Z2ggdG8gdGhlIERvbmF0aW9uUmVjZWlwdCkNCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIGJvb2tEb25hdGlvbihhZGRyZXNzIGFkZHIsIHVpbnQgdGltZXN0YW1wLCB1aW50IGNoZkNlbnRzLCANCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBjdXJyZW5jeSwgYnl0ZXMzMiBtZW1vKSBwcml2YXRlDQogIHsNCiAgICAvLyBUaGUgY3VycmVudCBwaGFzZQ0KICAgIHVpbnQgcGhhc2UgPSBnZXRQaGFzZUF0VGltZSh0aW1lc3RhbXApOw0KICAgIA0KICAgIC8vIEFkZCBhbW91bnQgdG8gdGhlIGNvdW50ZXIgb2YgdGhlIGN1cnJlbnQgcGhhc2UNCiAgICBib29sIHRhcmdldFJlYWNoZWQgPSBhZGRUb3dhcmRzVGFyZ2V0KHBoYXNlLCBjaGZDZW50cyk7DQogICAgDQogICAgLy8gSWYgdGhlIHRhcmdldCB3YXMgY3Jvc3NlZCB0aGVuIHN0YXJ0IHRoZSBncmFjZSBwZXJpb2QNCiAgICBpZiAodGFyZ2V0UmVhY2hlZCAmJiBwaGFzZSA9PSBnZXRQaGFzZUF0VGltZShub3cpKSB7DQogICAgICBpZiAocGhhc2UgPT0gcGhhc2VPZlJvdW5kMCkgew0KICAgICAgICBlbmRDdXJyZW50UGhhc2VJbihncmFjZVBlcmlvZEFmdGVyUm91bmQwVGFyZ2V0KTsNCiAgICAgIH0gZWxzZSBpZiAocGhhc2UgPT0gcGhhc2VPZlJvdW5kMSkgew0KICAgICAgICBlbmRDdXJyZW50UGhhc2VJbihncmFjZVBlcmlvZEFmdGVyUm91bmQxVGFyZ2V0KTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBCb251cyBtdWx0aXBsaWVyIHRoYXQgd2FzIHZhbGlkIGF0IHRoZSBnaXZlbiB0aW1lIA0KICAgIHVpbnQgYm9udXNNdWx0aXBsaWVyID0gZ2V0TXVsdGlwbGllckF0VGltZSh0aW1lc3RhbXApOw0KICAgIA0KICAgIC8vIEFwcGx5IGJvbnVzIHRvIGFtb3VudCBpbiBTd2lzcyBmcmFuY3MNCiAgICBjaGZDZW50cyA9IChjaGZDZW50cyAqIGJvbnVzTXVsdGlwbGllcikgLyAxMDA7DQoNCiAgICAvLyBDb252ZXJ0IFN3aXNzIGZyYW5jcyB0byBhbW91bnQgb2YgdG9rZW5zDQogICAgdWludCB0b2tlbkFtb3VudCA9IChjaGZDZW50cyAqIHRva2Vuc1BlckNIRikgLyAxMDA7DQoNCiAgICAvLyBBZGQgYWRkcmVzcyB0byBsaXN0IGlmIG5ldw0KICAgIGlmICghaXNSZWdpc3RlcmVkKGFkZHIsIGZhbHNlKSkgew0KICAgICAgZG9ub3JMaXN0LnB1c2goYWRkcik7DQogICAgfQ0KICAgIA0KICAgIC8vIEFzc2lnbiB1bnJlc3RyaWN0ZWQgdG9rZW5zIGluIFRva2VuVHJhY2tlcg0KICAgIGFzc2lnbihhZGRyLHRva2VuQW1vdW50LGZhbHNlKTsNCg0KICAgIC8vIElzc3VlIGRvbmF0aW9uIHJlY2VpcHQNCiAgICBEb25hdGlvblJlY2VpcHQoYWRkciwgY3VycmVuY3ksIGJvbnVzTXVsdGlwbGllciwgdGltZXN0YW1wLCB0b2tlbkFtb3VudCwgDQogICAgICAgICAgICAgICAgICAgIG1lbW8pOw0KICB9DQp9'