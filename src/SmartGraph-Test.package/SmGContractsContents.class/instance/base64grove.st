base 64 content
base64grove
	^'Ly8gR3JvdmUgdjAuMg0KDQoNCi8vLyBAdGl0bGUgR3JvdmVMaWIgLSBMaWJyYXJ5IGZvciBxdWVyaWFibGUgaW5kZXhlZCBvcmRlcmVkIGRhdGEuDQovLy8gQGF1dGhvciBQaXBlck1lcnJpYW0gLSA8cGlwZXJtZXJyaWFtQGdtYWlsLmNvbT4NCmxpYnJhcnkgR3JvdmVMaWIgew0KICAgICAgICAvKg0KICAgICAgICAgKiAgSW5kZXhlcyBmb3Igb3JkZXJlZCBkYXRhDQogICAgICAgICAqDQogICAgICAgICAqICBBZGRyZXNzOiAweGQwN2NlNDMyOWIyN2ViODg5NmM1MTQ1ODQ2OGQ5OGEwZTRjMDM5NGMNCiAgICAgICAgICovDQogICAgICAgIHN0cnVjdCBJbmRleCB7DQogICAgICAgICAgICAgICAgYnl0ZXMzMiBpZDsNCiAgICAgICAgICAgICAgICBieXRlczMyIG5hbWU7DQogICAgICAgICAgICAgICAgYnl0ZXMzMiByb290Ow0KICAgICAgICAgICAgICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gTm9kZSkgbm9kZXM7DQogICAgICAgIH0NCg0KICAgICAgICBzdHJ1Y3QgTm9kZSB7DQogICAgICAgICAgICAgICAgYnl0ZXMzMiBub2RlSWQ7DQogICAgICAgICAgICAgICAgYnl0ZXMzMiBpbmRleElkOw0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgaWQ7DQogICAgICAgICAgICAgICAgaW50IHZhbHVlOw0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgcGFyZW50Ow0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgbGVmdDsNCiAgICAgICAgICAgICAgICBieXRlczMyIHJpZ2h0Ow0KICAgICAgICAgICAgICAgIHVpbnQgaGVpZ2h0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgVGhpcyBpcyBtZXJlbHkgYSBzaG9ydGN1dCBmb3IgYHNoYTMob3duZXIsIGluZGV4TmFtZSlgDQogICAgICAgIC8vLyBAcGFyYW0gb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG93bmVyIG9mIHRoaXMgaW5kZXguDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXhOYW1lIFRoZSBodW1hbiByZWFkYWJsZSBuYW1lIGZvciB0aGlzIGluZGV4Lg0KICAgICAgICBmdW5jdGlvbiBjb21wdXRlSW5kZXhJZChhZGRyZXNzIG93bmVyLCBieXRlczMyIGluZGV4TmFtZSkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgICAgIHJldHVybiBzaGEzKG93bmVyLCBpbmRleE5hbWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgVGhpcyBpcyBtZXJlbHkgYSBzaG9ydGN1dCBmb3IgYHNoYTMoaW5kZXhJZCwgaWQpYA0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4SWQgVGhlIGlkIGZvciB0aGUgaW5kZXggdGhlIG5vZGUgYmVsb25ncyB0by4NCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSBkYXRhIHRoaXMgbm9kZSByZXByZXNlbnRzLg0KICAgICAgICBmdW5jdGlvbiBjb21wdXRlTm9kZUlkKGJ5dGVzMzIgaW5kZXhJZCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgICAgIHJldHVybiBzaGEzKGluZGV4SWQsIGlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIG1heCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICAgICAgaWYgKGEgPj0gYikgew0KICAgICAgICAgICAgICAgIHJldHVybiBhOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0NCg0KICAgICAgICAvKg0KICAgICAgICAgKiAgTm9kZSBnZXR0ZXJzDQogICAgICAgICAqLw0KICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSBub2RlLg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuDQogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUgdG8gYmUgbG9va2VkIHVwLg0KICAgICAgICBmdW5jdGlvbiBnZXROb2RlSWQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsNCiAgICAgICAgICAgIHJldHVybiBpbmRleC5ub2Rlc1tub2RlSWRdLmlkOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIGluZGV4IGlkIGZvciB0aGUgbm9kZS4NCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLg0KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4NCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZUluZGV4SWQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsNCiAgICAgICAgICAgIHJldHVybiBpbmRleC5ub2Rlc1tub2RlSWRdLmluZGV4SWQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgdmFsdWUgZm9yIHRoZSBub2RlLg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuDQogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUgdG8gYmUgbG9va2VkIHVwLg0KICAgICAgICBmdW5jdGlvbiBnZXROb2RlVmFsdWUoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGludCkgew0KICAgICAgICAgICAgcmV0dXJuIGluZGV4Lm5vZGVzW25vZGVJZF0udmFsdWU7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgaGVpZ2h0IG9mIHRoZSBub2RlLg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuDQogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUgdG8gYmUgbG9va2VkIHVwLg0KICAgICAgICBmdW5jdGlvbiBnZXROb2RlSGVpZ2h0KEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgICAgICByZXR1cm4gaW5kZXgubm9kZXNbbm9kZUlkXS5oZWlnaHQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgcGFyZW50IGlkIG9mIHRoZSBub2RlLg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuDQogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUgdG8gYmUgbG9va2VkIHVwLg0KICAgICAgICBmdW5jdGlvbiBnZXROb2RlUGFyZW50KEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7DQogICAgICAgICAgICByZXR1cm4gaW5kZXgubm9kZXNbbm9kZUlkXS5wYXJlbnQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgbGVmdCBjaGlsZCBpZCBvZiB0aGUgbm9kZS4NCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLg0KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4NCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZUxlZnRDaGlsZChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgcmV0dXJuIGluZGV4Lm5vZGVzW25vZGVJZF0ubGVmdDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSByaWdodCBjaGlsZCBpZCBvZiB0aGUgbm9kZS4NCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLg0KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4NCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZVJpZ2h0Q2hpbGQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsNCiAgICAgICAgICAgIHJldHVybiBpbmRleC5ub2Rlc1tub2RlSWRdLnJpZ2h0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIG5vZGUgaWQgb2YgdGhlIG5leHQgbm9kZSBpbiB0aGUgdHJlZS4NCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLg0KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4NCiAgICAgICAgZnVuY3Rpb24gZ2V0UHJldmlvdXNOb2RlKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7DQogICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tub2RlSWRdOw0KDQogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubm9kZUlkID09IDB4MCkgew0KICAgICAgICAgICAgICAgIC8vIFVua25vd24gbm9kZSwganVzdCByZXR1cm4gMHgwOw0KICAgICAgICAgICAgICAgIHJldHVybiAweDA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIE5vZGUgbWVtb3J5IGNoaWxkOw0KDQogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubGVmdCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBUcmFjZSBsZWZ0IHRvIGxhdGVzdCBjaGlsZCBpbiBsZWZ0IHRyZWUuDQogICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5sZWZ0XTsNCg0KICAgICAgICAgICAgICAgIHdoaWxlIChjaGlsZC5yaWdodCAhPSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGNoaWxkID0gaW5kZXgubm9kZXNbY2hpbGQucmlnaHRdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQubm9kZUlkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucGFyZW50ICE9IDB4MCkgew0KICAgICAgICAgICAgICAgIC8vIE5vdyB3ZSB0cmFjZSBiYWNrIHVwIHRocm91Z2ggcGFyZW50IHJlbGF0aW9uc2hpcHMsIGxvb2tpbmcNCiAgICAgICAgICAgICAgICAvLyBmb3IgYSBsaW5rIHdoZXJlIHRoZSBjaGlsZCBpcyB0aGUgcmlnaHQgY2hpbGQgb2YgaXQncw0KICAgICAgICAgICAgICAgIC8vIHBhcmVudC4NCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcGFyZW50ID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUucGFyZW50XTsNCiAgICAgICAgICAgICAgICBjaGlsZCA9IGN1cnJlbnROb2RlOw0KDQogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBjaGlsZC5ub2RlSWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnQubm9kZUlkOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5wYXJlbnQgPT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHBhcmVudDsNCiAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gaW5kZXgubm9kZXNbcGFyZW50LnBhcmVudF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBmaXJzdCBub2RlLCBhbmQgaGFzIG5vIHByZXZpb3VzIG5vZGUuDQogICAgICAgICAgICByZXR1cm4gMHgwOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIG5vZGUgaWQgb2YgdGhlIHByZXZpb3VzIG5vZGUgaW4gdGhlIHRyZWUuDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4NCiAgICAgICAgLy8vIEBwYXJhbSBub2RlSWQgVGhlIGlkIGZvciB0aGUgbm9kZSB0byBiZSBsb29rZWQgdXAuDQogICAgICAgIGZ1bmN0aW9uIGdldE5leHROb2RlKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7DQogICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tub2RlSWRdOw0KDQogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubm9kZUlkID09IDB4MCkgew0KICAgICAgICAgICAgICAgIC8vIFVua25vd24gbm9kZSwganVzdCByZXR1cm4gMHgwOw0KICAgICAgICAgICAgICAgIHJldHVybiAweDA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIE5vZGUgbWVtb3J5IGNoaWxkOw0KDQogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucmlnaHQgIT0gMHgwKSB7DQogICAgICAgICAgICAgICAgLy8gVHJhY2UgcmlnaHQgdG8gZWFybGllc3QgY2hpbGQgaW4gcmlnaHQgdHJlZS4NCiAgICAgICAgICAgICAgICBjaGlsZCA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnJpZ2h0XTsNCg0KICAgICAgICAgICAgICAgIHdoaWxlIChjaGlsZC5sZWZ0ICE9IDApIHsNCiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tjaGlsZC5sZWZ0XTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkLm5vZGVJZDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnBhcmVudCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgbm9kZSBpcyB0aGUgbGVmdCBjaGlsZCBvZiBpdCdzIHBhcmVudCwgdGhlbiB0aGUNCiAgICAgICAgICAgICAgICAvLyBwYXJlbnQgaXMgdGhlIG5leHQgb25lLg0KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBwYXJlbnQgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5wYXJlbnRdOw0KICAgICAgICAgICAgICAgIGNoaWxkID0gY3VycmVudE5vZGU7DQoNCiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gY2hpbGQubm9kZUlkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50Lm5vZGVJZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucGFyZW50ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBwYXJlbnQ7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IGluZGV4Lm5vZGVzW3BhcmVudC5wYXJlbnRdOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIE5vdyB3ZSBuZWVkIHRvIHRyYWNlIGFsbCB0aGUgd2F5IHVwIGNoZWNraW5nIHRvIHNlZSBpZiBhbnkgcGFyZW50IGlzIHRoZSANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgZmluYWwgbm9kZS4NCiAgICAgICAgICAgIHJldHVybiAweDA7DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vLyBAZGV2IFVwZGF0ZXMgb3IgSW5zZXJ0cyB0aGUgaWQgaW50byB0aGUgaW5kZXggYXQgaXRzIGFwcHJvcHJpYXRlIGxvY2F0aW9uIGJhc2VkIG9uIHRoZSB2YWx1ZSBwcm92aWRlZC4NCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLg0KICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBlbGVtZW50IHRoZSBpbmRleCBub2RlIHdpbGwgcmVwcmVzZW50Lg0KICAgICAgICAvLy8gQHBhcmFtIHZhbHVlIFRoZSB2YWx1ZSBvZiB0aGUgZGF0YSBlbGVtZW50IHRoYXQgcmVwcmVzZW50cyBpdCdzIHRvdGFsIG9yZGVyaW5nIHdpdGggcmVzcGVjdCB0byBvdGhlciBlbGVtZW50ZXMuDQogICAgICAgIGZ1bmN0aW9uIGluc2VydChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkLCBpbnQgdmFsdWUpIHB1YmxpYyB7DQogICAgICAgICAgICAgICAgYnl0ZXMzMiBub2RlSWQgPSBjb21wdXRlTm9kZUlkKGluZGV4LmlkLCBpZCk7DQoNCiAgICAgICAgICAgICAgICBpZiAoaW5kZXgubm9kZXNbbm9kZUlkXS5ub2RlSWQgPT0gbm9kZUlkKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIEEgbm9kZSB3aXRoIHRoaXMgaWQgYWxyZWFkeSBleGlzdHMuICBJZiB0aGUgdmFsdWUgaXMNCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHNhbWUsIHRoZW4ganVzdCByZXR1cm4gZWFybHksIG90aGVyd2lzZSwgcmVtb3ZlIGl0DQogICAgICAgICAgICAgICAgICAgIC8vIGFuZCByZWluc2VydCBpdC4NCiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4Lm5vZGVzW25vZGVJZF0udmFsdWUgPT0gdmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZW1vdmUoaW5kZXgsIGlkKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB1aW50IGxlZnRIZWlnaHQ7DQogICAgICAgICAgICAgICAgdWludCByaWdodEhlaWdodDsNCg0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgcHJldmlvdXNOb2RlSWQgPSAweDA7DQoNCiAgICAgICAgICAgICAgICBieXRlczMyIHJvb3ROb2RlSWQgPSBpbmRleC5yb290Ow0KDQogICAgICAgICAgICAgICAgaWYgKHJvb3ROb2RlSWQgPT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgIHJvb3ROb2RlSWQgPSBub2RlSWQ7DQogICAgICAgICAgICAgICAgICAgIGluZGV4LnJvb3QgPSBub2RlSWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW3Jvb3ROb2RlSWRdOw0KDQogICAgICAgICAgICAgICAgLy8gRG8gaW5zZXJ0aW9uDQogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmluZGV4SWQgPT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgbmV3IHVucG9wdWxhdGVkIG5vZGUuDQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS5ub2RlSWQgPSBub2RlSWQ7DQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS5wYXJlbnQgPSBwcmV2aW91c05vZGVJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlLmluZGV4SWQgPSBpbmRleC5pZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlLmlkID0gaWQ7DQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS52YWx1ZSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHByZXZpb3VzIG5vZGUgaWQuDQogICAgICAgICAgICAgICAgICAgIHByZXZpb3VzTm9kZUlkID0gY3VycmVudE5vZGUubm9kZUlkOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBuZXcgbm9kZSBiZWxvbmdzIGluIHRoZSByaWdodCBzdWJ0cmVlDQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+PSBjdXJyZW50Tm9kZS52YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnJpZ2h0ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlLnJpZ2h0ID0gbm9kZUlkOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBuZXcgbm9kZSBiZWxvbmdzIGluIHRoZSBsZWZ0IHN1YnRyZWUuDQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5sZWZ0ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUubGVmdCA9IG5vZGVJZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLmxlZnRdOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIFJlYmFsYW5jZSB0aGUgdHJlZQ0KICAgICAgICAgICAgICAgIF9yZWJhbGFuY2VUcmVlKGluZGV4LCBjdXJyZW50Tm9kZS5ub2RlSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgQ2hlY2tzIHdoZXRoZXIgYSBub2RlIGZvciB0aGUgZ2l2ZW4gdW5pcXVlIGlkZW50aWZpZXIgZXhpc3RzIHdpdGhpbiB0aGUgZ2l2ZW4gaW5kZXguDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgc2hvdWxkIGJlIHNlYXJjaGVkDQogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBkYXRhIGVsZW1lbnQgdG8gY2hlY2sgZm9yLg0KICAgICAgICBmdW5jdGlvbiBleGlzdHMoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICAgICAgYnl0ZXMzMiBub2RlSWQgPSBjb21wdXRlTm9kZUlkKGluZGV4LmlkLCBpZCk7DQogICAgICAgICAgICByZXR1cm4gKGluZGV4Lm5vZGVzW25vZGVJZF0ubm9kZUlkID09IG5vZGVJZCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gQGRldiBSZW1vdmUgdGhlIG5vZGUgZm9yIHRoZSBnaXZlbiB1bmlxdWUgaWRlbnRpZmllciBmcm9tIHRoZSBpbmRleC4NCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCBzaG91bGQgYmUgcmVtb3ZlZA0KICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBlbGVtZW50IHRvIHJlbW92ZS4NCiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgaWQpIHB1YmxpYyB7DQogICAgICAgICAgICBieXRlczMyIG5vZGVJZCA9IGNvbXB1dGVOb2RlSWQoaW5kZXguaWQsIGlkKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgTm9kZSBzdG9yYWdlIHJlcGxhY2VtZW50Tm9kZTsNCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBwYXJlbnQ7DQogICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY2hpbGQ7DQogICAgICAgICAgICBieXRlczMyIHJlYmFsYW5jZU9yaWdpbjsNCg0KICAgICAgICAgICAgTm9kZSBzdG9yYWdlIG5vZGVUb0RlbGV0ZSA9IGluZGV4Lm5vZGVzW25vZGVJZF07DQoNCiAgICAgICAgICAgIGlmIChub2RlVG9EZWxldGUuaWQgIT0gaWQpIHsNCiAgICAgICAgICAgICAgICAvLyBUaGUgaWQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIHRyZWUuDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAobm9kZVRvRGVsZXRlLmxlZnQgIT0gMHgwIHx8IG5vZGVUb0RlbGV0ZS5yaWdodCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgbm90IGEgbGVhZiBub2RlIGFuZCB0aHVzIG11c3QgcmVwbGFjZSBpdHNlbGYgaW4NCiAgICAgICAgICAgICAgICAvLyBpdCdzIHRyZWUgYnkgZWl0aGVyIHRoZSBwcmV2aW91cyBvciBuZXh0IG5vZGUuDQogICAgICAgICAgICAgICAgaWYgKG5vZGVUb0RlbGV0ZS5sZWZ0ICE9IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgZ3VhcmFudGVlZCB0byBub3QgaGF2ZSBhIHJpZ2h0IGNoaWxkLg0KICAgICAgICAgICAgICAgICAgICByZXBsYWNlbWVudE5vZGUgPSBpbmRleC5ub2Rlc1tnZXRQcmV2aW91c05vZGUoaW5kZXgsIG5vZGVUb0RlbGV0ZS5ub2RlSWQpXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBndWFyYW50ZWVkIHRvIG5vdCBoYXZlIGEgbGVmdCBjaGlsZC4NCiAgICAgICAgICAgICAgICAgICAgcmVwbGFjZW1lbnROb2RlID0gaW5kZXgubm9kZXNbZ2V0TmV4dE5vZGUoaW5kZXgsIG5vZGVUb0RlbGV0ZS5ub2RlSWQpXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gVGhlIHJlcGxhY2VtZW50Tm9kZSBpcyBndWFyYW50ZWVkIHRvIGhhdmUgYSBwYXJlbnQuDQogICAgICAgICAgICAgICAgcGFyZW50ID0gaW5kZXgubm9kZXNbcmVwbGFjZW1lbnROb2RlLnBhcmVudF07DQoNCiAgICAgICAgICAgICAgICAvLyBLZWVwIG5vdGUgb2YgdGhlIGxvY2F0aW9uIHRoYXQgb3VyIHRyZWUgcmViYWxhbmNpbmcgc2hvdWxkDQogICAgICAgICAgICAgICAgLy8gc3RhcnQgYXQuDQogICAgICAgICAgICAgICAgcmViYWxhbmNlT3JpZ2luID0gcmVwbGFjZW1lbnROb2RlLm5vZGVJZDsNCg0KICAgICAgICAgICAgICAgIC8vIEpvaW4gdGhlIHBhcmVudCBvZiB0aGUgcmVwbGFjZW1lbnQgbm9kZSB3aXRoIGFueSBzdWJ0cmVlIG9mDQogICAgICAgICAgICAgICAgLy8gdGhlIHJlcGxhY2VtZW50IG5vZGUuICBXZSBjYW4gZ3VhcmFudGVlIHRoYXQgdGhlIHJlcGxhY2VtZW50DQogICAgICAgICAgICAgICAgLy8gbm9kZSBoYXMgYXQgbW9zdCBvbmUgc3VidHJlZSBiZWNhdXNlIG9mIGhvdyBnZXROZXh0Tm9kZSBhbmQNCiAgICAgICAgICAgICAgICAvLyBnZXRQcmV2aW91c05vZGUgYXJlIHVzZWQuDQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5sZWZ0ID09IHJlcGxhY2VtZW50Tm9kZS5ub2RlSWQpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyZW50LmxlZnQgPSByZXBsYWNlbWVudE5vZGUucmlnaHQ7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlbWVudE5vZGUucmlnaHQgIT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IGluZGV4Lm5vZGVzW3JlcGxhY2VtZW50Tm9kZS5yaWdodF07DQogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5wYXJlbnQgPSBwYXJlbnQubm9kZUlkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucmlnaHQgPT0gcmVwbGFjZW1lbnROb2RlLm5vZGVJZCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmlnaHQgPSByZXBsYWNlbWVudE5vZGUubGVmdDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcGxhY2VtZW50Tm9kZS5sZWZ0ICE9IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tyZXBsYWNlbWVudE5vZGUubGVmdF07DQogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5wYXJlbnQgPSBwYXJlbnQubm9kZUlkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gTm93IHdlIHJlcGxhY2UgdGhlIG5vZGVUb0RlbGV0ZSB3aXRoIHRoZSByZXBsYWNlbWVudE5vZGUuDQogICAgICAgICAgICAgICAgLy8gVGhpcyBpbmNsdWRlcyBwYXJlbnQvY2hpbGQgcmVsYXRpb25zaGlwcyBmb3IgYWxsIG9mIHRoZQ0KICAgICAgICAgICAgICAgIC8vIHBhcmVudCwgdGhlIGxlZnQgY2hpbGQsIGFuZCB0aGUgcmlnaHQgY2hpbGQuDQogICAgICAgICAgICAgICAgcmVwbGFjZW1lbnROb2RlLnBhcmVudCA9IG5vZGVUb0RlbGV0ZS5wYXJlbnQ7DQogICAgICAgICAgICAgICAgaWYgKG5vZGVUb0RlbGV0ZS5wYXJlbnQgIT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IGluZGV4Lm5vZGVzW25vZGVUb0RlbGV0ZS5wYXJlbnRdOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gbm9kZVRvRGVsZXRlLm5vZGVJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmxlZnQgPSByZXBsYWNlbWVudE5vZGUubm9kZUlkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucmlnaHQgPT0gbm9kZVRvRGVsZXRlLm5vZGVJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJpZ2h0ID0gcmVwbGFjZW1lbnROb2RlLm5vZGVJZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5vZGUgd2UgYXJlIGRlbGV0aW5nIGlzIHRoZSByb290IG5vZGUgc28gdXBkYXRlDQogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBpbmRleElkIHRvIHJvb3Qgbm9kZSBtYXBwaW5nLg0KICAgICAgICAgICAgICAgICAgICBpbmRleC5yb290ID0gcmVwbGFjZW1lbnROb2RlLm5vZGVJZDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXBsYWNlbWVudE5vZGUubGVmdCA9IG5vZGVUb0RlbGV0ZS5sZWZ0Ow0KICAgICAgICAgICAgICAgIGlmIChub2RlVG9EZWxldGUubGVmdCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tub2RlVG9EZWxldGUubGVmdF07DQogICAgICAgICAgICAgICAgICAgIGNoaWxkLnBhcmVudCA9IHJlcGxhY2VtZW50Tm9kZS5ub2RlSWQ7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmVwbGFjZW1lbnROb2RlLnJpZ2h0ID0gbm9kZVRvRGVsZXRlLnJpZ2h0Ow0KICAgICAgICAgICAgICAgIGlmIChub2RlVG9EZWxldGUucmlnaHQgIT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgIGNoaWxkID0gaW5kZXgubm9kZXNbbm9kZVRvRGVsZXRlLnJpZ2h0XTsNCiAgICAgICAgICAgICAgICAgICAgY2hpbGQucGFyZW50ID0gcmVwbGFjZW1lbnROb2RlLm5vZGVJZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChub2RlVG9EZWxldGUucGFyZW50ICE9IDB4MCkgew0KICAgICAgICAgICAgICAgIC8vIFRoZSBub2RlIGJlaW5nIGRlbGV0ZWQgaXMgYSBsZWFmIG5vZGUgc28gd2Ugb25seSBlcmFzZSBpdCdzDQogICAgICAgICAgICAgICAgLy8gcGFyZW50IGxpbmthZ2UuDQogICAgICAgICAgICAgICAgcGFyZW50ID0gaW5kZXgubm9kZXNbbm9kZVRvRGVsZXRlLnBhcmVudF07DQoNCiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gbm9kZVRvRGVsZXRlLm5vZGVJZCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQubGVmdCA9IDB4MDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBub2RlVG9EZWxldGUubm9kZUlkKSB7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudC5yaWdodCA9IDB4MDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBrZWVwIG5vdGUgb2Ygd2hlcmUgdGhlIHJlYmFsYW5jaW5nIHNob3VsZCBiZWdpbi4NCiAgICAgICAgICAgICAgICByZWJhbGFuY2VPcmlnaW4gPSBwYXJlbnQubm9kZUlkOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBib3RoIGEgbGVhZiBub2RlIGFuZCB0aGUgcm9vdCBub2RlLCBzbyB3ZSBuZWVkIHRvDQogICAgICAgICAgICAgICAgLy8gdW5zZXQgdGhlIHJvb3Qgbm9kZSBwb2ludGVyLg0KICAgICAgICAgICAgICAgIGluZGV4LnJvb3QgPSAweDA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIE5vdyB3ZSB6ZXJvIG91dCBhbGwgb2YgdGhlIGZpZWxkcyBvbiB0aGUgbm9kZVRvRGVsZXRlLg0KICAgICAgICAgICAgbm9kZVRvRGVsZXRlLmlkID0gMHgwOw0KICAgICAgICAgICAgbm9kZVRvRGVsZXRlLm5vZGVJZCA9IDB4MDsNCiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS5pbmRleElkID0gMHgwOw0KICAgICAgICAgICAgbm9kZVRvRGVsZXRlLnZhbHVlID0gMDsNCiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS5wYXJlbnQgPSAweDA7DQogICAgICAgICAgICBub2RlVG9EZWxldGUubGVmdCA9IDB4MDsNCiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS5yaWdodCA9IDB4MDsNCg0KICAgICAgICAgICAgLy8gV2FsayBiYWNrIHVwIHRoZSB0cmVlIHJlYmFsYW5jaW5nDQogICAgICAgICAgICBpZiAocmViYWxhbmNlT3JpZ2luICE9IDB4MCkgew0KICAgICAgICAgICAgICAgIF9yZWJhbGFuY2VUcmVlKGluZGV4LCByZWJhbGFuY2VPcmlnaW4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgYnl0ZXMyIGNvbnN0YW50IEdUID0gIj4iOw0KICAgICAgICBieXRlczIgY29uc3RhbnQgTFQgPSAiPCI7DQogICAgICAgIGJ5dGVzMiBjb25zdGFudCBHVEUgPSAiPj0iOw0KICAgICAgICBieXRlczIgY29uc3RhbnQgTFRFID0gIjw9IjsNCiAgICAgICAgYnl0ZXMyIGNvbnN0YW50IEVRID0gIj09IjsNCg0KICAgICAgICBmdW5jdGlvbiBfY29tcGFyZShpbnQgbGVmdCwgYnl0ZXMyIG9wZXJhdG9yLCBpbnQgcmlnaHQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PSBHVCkgew0KICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA+IHJpZ2h0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PSBMVCkgew0KICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA8IHJpZ2h0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PSBHVEUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gKGxlZnQgPj0gcmlnaHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG9wZXJhdG9yID09IExURSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA8PSByaWdodCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAob3BlcmF0b3IgPT0gRVEpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gKGxlZnQgPT0gcmlnaHQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBJbnZhbGlkIG9wZXJhdG9yLg0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBfZ2V0TWF4aW11bShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIG5vZGVJZCkgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbbm9kZUlkXTsNCg0KICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5yaWdodCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS52YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnJpZ2h0XTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBfZ2V0TWluaW11bShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIG5vZGVJZCkgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbbm9kZUlkXTsNCg0KICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5sZWZ0ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLnZhbHVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUubGVmdF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICAvKiogQGRldiBRdWVyeSB0aGUgaW5kZXggZm9yIHRoZSBlZGdlLW1vc3Qgbm9kZSB0aGF0IHNhdGlzZmllcyB0aGUNCiAgICAgICAgICogIGdpdmVuIHF1ZXJ5LiAgRm9yID4sID49LCBhbmQgPT0sIHRoaXMgd2lsbCBiZSB0aGUgbGVmdC1tb3N0IG5vZGUNCiAgICAgICAgICogIHRoYXQgc2F0aXNmaWVzIHRoZSBjb21wYXJpc29uLiAgRm9yIDwgYW5kIDw9IHRoaXMgd2lsbCBiZSB0aGUNCiAgICAgICAgICogIHJpZ2h0LW1vc3Qgbm9kZSB0aGF0IHNhdGlzZmllcyB0aGUgY29tcGFyaXNvbi4NCiAgICAgICAgICovDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgc2hvdWxkIGJlIHF1ZXJpZWQNCiAgICAgICAgLyoqIEBwYXJhbSBvcGVyYXRvciBPbmUgb2YgJz4nLCAnPj0nLCAnPCcsICc8PScsICc9PScgdG8gc3BlY2lmeSB3aGF0DQogICAgICAgICAqICB0eXBlIG9mIGNvbXBhcmlzb24gb3BlcmF0b3Igc2hvdWxkIGJlIHVzZWQuDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBxdWVyeShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczIgb3BlcmF0b3IsIGludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJ5dGVzMzIpIHsNCiAgICAgICAgICAgICAgICBieXRlczMyIHJvb3ROb2RlSWQgPSBpbmRleC5yb290Ow0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChyb290Tm9kZUlkID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBFbXB0eSB0cmVlLg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMHgwOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW3Jvb3ROb2RlSWRdOw0KDQogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKF9jb21wYXJlKGN1cnJlbnROb2RlLnZhbHVlLCBvcGVyYXRvciwgdmFsdWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIGZvdW5kIGEgbWF0Y2ggYnV0IGl0IG1pZ2h0IG5vdCBiZSB0aGUNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICpjb3JyZWN0KiBtYXRjaC4NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgob3BlcmF0b3IgPT0gTFQpIHx8IChvcGVyYXRvciA9PSBMVEUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTmVlZCB0byBrZWVwIHRyYXZlcnNpbmcgcmlnaHQgdW50aWwgdGhpcyBpcyBubw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvbmdlciB0cnVlLg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5yaWdodCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLm5vZGVJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9jb21wYXJlKF9nZXRNaW5pbXVtKGluZGV4LCBjdXJyZW50Tm9kZS5yaWdodCksIG9wZXJhdG9yLCB2YWx1ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgYXJlIHN0aWxsIG5vZGVzIHRvIHRoZSByaWdodCB0aGF0DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1hdGNoLg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnJpZ2h0XTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5ub2RlSWQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgob3BlcmF0b3IgPT0gR1QpIHx8IChvcGVyYXRvciA9PSBHVEUpIHx8IChvcGVyYXRvciA9PSBFUSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOZWVkIHRvIGtlZXAgdHJhdmVyc2luZyBsZWZ0IHVudGlsIHRoaXMgaXMgbm8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb25nZXIgdHJ1ZS4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubGVmdCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLm5vZGVJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9jb21wYXJlKF9nZXRNYXhpbXVtKGluZGV4LCBjdXJyZW50Tm9kZS5sZWZ0KSwgb3BlcmF0b3IsIHZhbHVlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLmxlZnRdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLm5vZGVJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGlmICgob3BlcmF0b3IgPT0gTFQpIHx8IChvcGVyYXRvciA9PSBMVEUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubGVmdCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSBhcmUgbm8gbm9kZXMgdGhhdCBhcmUgbGVzcyB0aGFuIHRoZSB2YWx1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHJldHVybiBudWxsLg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAweDA7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLmxlZnRdOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBpZiAoKG9wZXJhdG9yID09IEdUKSB8fCAob3BlcmF0b3IgPT0gR1RFKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnJpZ2h0ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZXJlIGFyZSBubyBub2RlcyB0aGF0IGFyZSBncmVhdGVyIHRoYW4gdGhlIHZhbHVlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc28gcmV0dXJuIG51bGwuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDB4MDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUucmlnaHRdOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBpZiAob3BlcmF0b3IgPT0gRVEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS52YWx1ZSA8IHZhbHVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnJpZ2h0ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMHgwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnJpZ2h0XTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnZhbHVlID4gdmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubGVmdCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDB4MDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5sZWZ0XTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIF9yZWJhbGFuY2VUcmVlKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBpbnRlcm5hbCB7DQogICAgICAgICAgICAvLyBUcmFjZSBiYWNrIHVwIHJlYmFsYW5jaW5nIHRoZSB0cmVlIGFuZCB1cGRhdGluZyBoZWlnaHRzIGFzDQogICAgICAgICAgICAvLyBuZWVkZWQuLg0KICAgICAgICAgICAgTm9kZSBzdG9yYWdlIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbbm9kZUlkXTsNCg0KICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsNCiAgICAgICAgICAgICAgICBpbnQgYmFsYW5jZUZhY3RvciA9IF9nZXRCYWxhbmNlRmFjdG9yKGluZGV4LCBjdXJyZW50Tm9kZS5ub2RlSWQpOw0KDQogICAgICAgICAgICAgICAgaWYgKGJhbGFuY2VGYWN0b3IgPT0gMikgew0KICAgICAgICAgICAgICAgICAgICAvLyBSaWdodCByb3RhdGlvbiAodHJlZSBpcyBoZWF2eSBvbiB0aGUgbGVmdCkNCiAgICAgICAgICAgICAgICAgICAgaWYgKF9nZXRCYWxhbmNlRmFjdG9yKGluZGV4LCBjdXJyZW50Tm9kZS5sZWZ0KSA9PSAtMSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHN1YnRyZWUgaXMgbGVhbmluZyByaWdodCBzbyBpdCBuZWVkIHRvIGJlDQogICAgICAgICAgICAgICAgICAgICAgICAvLyByb3RhdGVkIGxlZnQgYmVmb3JlIHRoZSBjdXJyZW50IG5vZGUgaXMgcm90YXRlZA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmlnaHQuDQogICAgICAgICAgICAgICAgICAgICAgICBfcm90YXRlTGVmdChpbmRleCwgY3VycmVudE5vZGUubGVmdCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgX3JvdGF0ZVJpZ2h0KGluZGV4LCBjdXJyZW50Tm9kZS5ub2RlSWQpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlRmFjdG9yID09IC0yKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIExlZnQgcm90YXRpb24gKHRyZWUgaXMgaGVhdnkgb24gdGhlIHJpZ2h0KQ0KICAgICAgICAgICAgICAgICAgICBpZiAoX2dldEJhbGFuY2VGYWN0b3IoaW5kZXgsIGN1cnJlbnROb2RlLnJpZ2h0KSA9PSAxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgc3VidHJlZSBpcyBsZWFuaW5nIGxlZnQgc28gaXQgbmVlZCB0byBiZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gcm90YXRlZCByaWdodCBiZWZvcmUgdGhlIGN1cnJlbnQgbm9kZSBpcyByb3RhdGVkDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBsZWZ0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgX3JvdGF0ZVJpZ2h0KGluZGV4LCBjdXJyZW50Tm9kZS5yaWdodCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgX3JvdGF0ZUxlZnQoaW5kZXgsIGN1cnJlbnROb2RlLm5vZGVJZCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKCgtMSA8PSBiYWxhbmNlRmFjdG9yKSAmJiAoYmFsYW5jZUZhY3RvciA8PSAxKSkgew0KICAgICAgICAgICAgICAgICAgICBfdXBkYXRlTm9kZUhlaWdodChpbmRleCwgY3VycmVudE5vZGUubm9kZUlkKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucGFyZW50ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBSZWFjaGVkIHRoZSByb290IHdoaWNoIG1heSBiZSBuZXcgZHVlIHRvIHRyZWUNCiAgICAgICAgICAgICAgICAgICAgLy8gcm90YXRpb24sIHNvIHNldCBpdCBhcyB0aGUgcm9vdCBhbmQgdGhlbiBicmVhay4NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5wYXJlbnRdOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gX2dldEJhbGFuY2VGYWN0b3IoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBub2RlID0gaW5kZXgubm9kZXNbbm9kZUlkXTsNCg0KICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaW5kZXgubm9kZXNbbm9kZS5sZWZ0XS5oZWlnaHQpIC0gaW50KGluZGV4Lm5vZGVzW25vZGUucmlnaHRdLmhlaWdodCk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBfdXBkYXRlTm9kZUhlaWdodChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIG5vZGVJZCkgaW50ZXJuYWwgew0KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBub2RlID0gaW5kZXgubm9kZXNbbm9kZUlkXTsNCg0KICAgICAgICAgICAgICAgIG5vZGUuaGVpZ2h0ID0gbWF4KGluZGV4Lm5vZGVzW25vZGUubGVmdF0uaGVpZ2h0LCBpbmRleC5ub2Rlc1tub2RlLnJpZ2h0XS5oZWlnaHQpICsgMTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIF9yb3RhdGVMZWZ0KEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBpbnRlcm5hbCB7DQogICAgICAgICAgICBOb2RlIHN0b3JhZ2Ugb3JpZ2luYWxSb290ID0gaW5kZXgubm9kZXNbbm9kZUlkXTsNCg0KICAgICAgICAgICAgaWYgKG9yaWdpbmFsUm9vdC5yaWdodCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBDYW5ub3Qgcm90YXRlIGxlZnQgaWYgdGhlcmUgaXMgbm8gcmlnaHQgb3JpZ2luYWxSb290IHRvIHJvdGF0ZSBpbnRvDQogICAgICAgICAgICAgICAgLy8gcGxhY2UuDQogICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFRoZSByaWdodCBjaGlsZCBpcyB0aGUgbmV3IHJvb3QsIHNvIGl0IGdldHMgdGhlIG9yaWdpbmFsDQogICAgICAgICAgICAvLyBgb3JpZ2luYWxSb290LnBhcmVudGAgYXMgaXQncyBwYXJlbnQuDQogICAgICAgICAgICBOb2RlIHN0b3JhZ2UgbmV3Um9vdCA9IGluZGV4Lm5vZGVzW29yaWdpbmFsUm9vdC5yaWdodF07DQogICAgICAgICAgICBuZXdSb290LnBhcmVudCA9IG9yaWdpbmFsUm9vdC5wYXJlbnQ7DQoNCiAgICAgICAgICAgIC8vIFRoZSBvcmlnaW5hbCByb290IG5lZWRzIHRvIGhhdmUgaXQncyByaWdodCBjaGlsZCBudWxsZWQgb3V0Lg0KICAgICAgICAgICAgb3JpZ2luYWxSb290LnJpZ2h0ID0gMHgwOw0KDQogICAgICAgICAgICBpZiAob3JpZ2luYWxSb290LnBhcmVudCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIHBhcmVudCBub2RlLCBpdCBuZWVkcyB0byBub3cgcG9pbnQgZG93bndhcmQgYXQNCiAgICAgICAgICAgICAgICAvLyB0aGUgbmV3Um9vdCB3aGljaCBpcyByb3RhdGluZyBpbnRvIHRoZSBwbGFjZSB3aGVyZSBgbm9kZWAgd2FzLg0KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBwYXJlbnQgPSBpbmRleC5ub2Rlc1tvcmlnaW5hbFJvb3QucGFyZW50XTsNCg0KICAgICAgICAgICAgICAgIC8vIGZpZ3VyZSBvdXQgaWYgd2UncmUgYSBsZWZ0IG9yIHJpZ2h0IGNoaWxkIGFuZCBoYXZlIHRoZQ0KICAgICAgICAgICAgICAgIC8vIHBhcmVudCBwb2ludCB0byB0aGUgbmV3IG5vZGUuDQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5sZWZ0ID09IG9yaWdpbmFsUm9vdC5ub2RlSWQpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyZW50LmxlZnQgPSBuZXdSb290Lm5vZGVJZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBvcmlnaW5hbFJvb3Qubm9kZUlkKSB7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudC5yaWdodCA9IG5ld1Jvb3Qubm9kZUlkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICBpZiAobmV3Um9vdC5sZWZ0ICE9IDApIHsNCiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV3IHJvb3QgaGFkIGEgbGVmdCBjaGlsZCwgdGhhdCBtb3ZlcyB0byBiZSB0aGUNCiAgICAgICAgICAgICAgICAvLyBuZXcgcmlnaHQgY2hpbGQgb2YgdGhlIG9yaWdpbmFsIHJvb3Qgbm9kZQ0KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBsZWZ0Q2hpbGQgPSBpbmRleC5ub2Rlc1tuZXdSb290LmxlZnRdOw0KICAgICAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5yaWdodCA9IGxlZnRDaGlsZC5ub2RlSWQ7DQogICAgICAgICAgICAgICAgbGVmdENoaWxkLnBhcmVudCA9IG9yaWdpbmFsUm9vdC5ub2RlSWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbmV3Um9vdCdzIGxlZnQgbm9kZSB0byBwb2ludCBhdCB0aGUgb3JpZ2luYWwgbm9kZS4NCiAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5wYXJlbnQgPSBuZXdSb290Lm5vZGVJZDsNCiAgICAgICAgICAgIG5ld1Jvb3QubGVmdCA9IG9yaWdpbmFsUm9vdC5ub2RlSWQ7DQoNCiAgICAgICAgICAgIGlmIChuZXdSb290LnBhcmVudCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICBpbmRleC5yb290ID0gbmV3Um9vdC5ub2RlSWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFRPRE86IGFyZSBib3RoIG9mIHRoZXNlIHVwZGF0ZXMgbmVjZXNzYXJ5Pw0KICAgICAgICAgICAgX3VwZGF0ZU5vZGVIZWlnaHQoaW5kZXgsIG9yaWdpbmFsUm9vdC5ub2RlSWQpOw0KICAgICAgICAgICAgX3VwZGF0ZU5vZGVIZWlnaHQoaW5kZXgsIG5ld1Jvb3Qubm9kZUlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIF9yb3RhdGVSaWdodChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIG5vZGVJZCkgaW50ZXJuYWwgew0KICAgICAgICAgICAgTm9kZSBzdG9yYWdlIG9yaWdpbmFsUm9vdCA9IGluZGV4Lm5vZGVzW25vZGVJZF07DQoNCiAgICAgICAgICAgIGlmIChvcmlnaW5hbFJvb3QubGVmdCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBDYW5ub3Qgcm90YXRlIHJpZ2h0IGlmIHRoZXJlIGlzIG5vIGxlZnQgbm9kZSB0byByb3RhdGUgaW50bw0KICAgICAgICAgICAgICAgIC8vIHBsYWNlLg0KICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBUaGUgbGVmdCBjaGlsZCBpcyB0YWtpbmcgdGhlIHBsYWNlIG9mIG5vZGUsIHNvIHdlIHVwZGF0ZSBpdCdzDQogICAgICAgICAgICAvLyBwYXJlbnQgdG8gYmUgdGhlIG9yaWdpbmFsIHBhcmVudCBvZiB0aGUgbm9kZS4NCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBuZXdSb290ID0gaW5kZXgubm9kZXNbb3JpZ2luYWxSb290LmxlZnRdOw0KICAgICAgICAgICAgbmV3Um9vdC5wYXJlbnQgPSBvcmlnaW5hbFJvb3QucGFyZW50Ow0KDQogICAgICAgICAgICAvLyBOdWxsIG91dCB0aGUgb3JpZ2luYWxSb290LmxlZnQNCiAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5sZWZ0ID0gMHgwOw0KDQogICAgICAgICAgICBpZiAob3JpZ2luYWxSb290LnBhcmVudCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbm9kZSBoYXMgYSBwYXJlbnQsIHVwZGF0ZSB0aGUgY29ycmVjdCBjaGlsZCB0byBwb2ludA0KICAgICAgICAgICAgICAgIC8vIGF0IHRoZSBuZXdSb290IG5vdy4NCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcGFyZW50ID0gaW5kZXgubm9kZXNbb3JpZ2luYWxSb290LnBhcmVudF07DQoNCiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gb3JpZ2luYWxSb290Lm5vZGVJZCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQubGVmdCA9IG5ld1Jvb3Qubm9kZUlkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAocGFyZW50LnJpZ2h0ID09IG9yaWdpbmFsUm9vdC5ub2RlSWQpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJpZ2h0ID0gbmV3Um9vdC5ub2RlSWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAobmV3Um9vdC5yaWdodCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcmlnaHRDaGlsZCA9IGluZGV4Lm5vZGVzW25ld1Jvb3QucmlnaHRdOw0KICAgICAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5sZWZ0ID0gbmV3Um9vdC5yaWdodDsNCiAgICAgICAgICAgICAgICByaWdodENoaWxkLnBhcmVudCA9IG9yaWdpbmFsUm9vdC5ub2RlSWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbmV3IHJvb3QncyByaWdodCBub2RlIHRvIHBvaW50IHRvIHRoZSBvcmlnaW5hbCBub2RlLg0KICAgICAgICAgICAgb3JpZ2luYWxSb290LnBhcmVudCA9IG5ld1Jvb3Qubm9kZUlkOw0KICAgICAgICAgICAgbmV3Um9vdC5yaWdodCA9IG9yaWdpbmFsUm9vdC5ub2RlSWQ7DQoNCiAgICAgICAgICAgIGlmIChuZXdSb290LnBhcmVudCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICBpbmRleC5yb290ID0gbmV3Um9vdC5ub2RlSWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFJlY29tcHV0ZSBoZWlnaHRzLg0KICAgICAgICAgICAgX3VwZGF0ZU5vZGVIZWlnaHQoaW5kZXgsIG9yaWdpbmFsUm9vdC5ub2RlSWQpOw0KICAgICAgICAgICAgX3VwZGF0ZU5vZGVIZWlnaHQoaW5kZXgsIG5ld1Jvb3Qubm9kZUlkKTsNCiAgICAgICAgfQ0KfQ0KDQoNCi8vLyBAdGl0bGUgR3JvdmUgLSBxdWVyeWFibGUgaW5kZXhlcyBmb3Igb3JkZXJlZCBkYXRhLg0KLy8vIEBhdXRob3IgUGlwZXIgTWVycmlhbSA8cGlwZXJtZXJyaWFtQGdtYWlsLmNvbT4NCmNvbnRyYWN0IEdyb3ZlIHsNCiAgICAgICAgLyoNCiAgICAgICAgICogIEluZGV4ZXMgZm9yIG9yZGVyZWQgZGF0YQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgQWRkcmVzczogMHg4MDE3ZjI0YTQ3Yzg4OWIxZWU4MDUwMWZmODRiZWIzYzAxN2VkZjBiDQogICAgICAgICAqLw0KICAgICAgICAvLyBNYXAgaW5kZXhfaWQgdG8gaW5kZXgNCiAgICAgICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBHcm92ZUxpYi5JbmRleCkgaW5kZXhfbG9va3VwOw0KDQogICAgICAgIC8vIE1hcCBub2RlX2lkIHRvIGluZGV4X2lkLg0KICAgICAgICBtYXBwaW5nIChieXRlczMyID0+IGJ5dGVzMzIpIG5vZGVfdG9faW5kZXg7DQoNCiAgICAgICAgLy8vIEBub3RpY2UgQ29tcHV0ZXMgdGhlIGlkIGZvciBhIEdyb3ZlIGluZGV4IHdoaWNoIGlzIHNoYTMob3duZXIsIGluZGV4TmFtZSkNCiAgICAgICAgLy8vIEBwYXJhbSBvd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgaW5kZXggb3duZXIuDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXhOYW1lIFRoZSBuYW1lIG9mIHRoZSBpbmRleC4NCiAgICAgICAgZnVuY3Rpb24gY29tcHV0ZUluZGV4SWQoYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBpbmRleE5hbWUpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gR3JvdmVMaWIuY29tcHV0ZUluZGV4SWQob3duZXIsIGluZGV4TmFtZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gQG5vdGljZSBDb21wdXRlcyB0aGUgaWQgZm9yIGEgbm9kZSBpbiBhIGdpdmVuIEdyb3ZlIGluZGV4IHdoaWNoIGlzIHNoYTMoaW5kZXhJZCwgaWQpDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXhJZCBUaGUgaWQgZm9yIHRoZSBpbmRleCB0aGUgbm9kZSBiZWxvbmdzIHRvLg0KICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIGRhdGEgdGhpcyBub2RlIHJlcHJlc2VudHMuDQogICAgICAgIGZ1bmN0aW9uIGNvbXB1dGVOb2RlSWQoYnl0ZXMzMiBpbmRleElkLCBieXRlczMyIGlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLmNvbXB1dGVOb2RlSWQoaW5kZXhJZCwgaWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoNCiAgICAgICAgICogIE5vZGUgZ2V0dGVycw0KICAgICAgICAgKi8NCiAgICAgICAgLy8vIEBub3RpY2UgUmV0cmlldmVzIHRoZSBuYW1lIG9mIGFuIGluZGV4Lg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4SWQgVGhlIGlkIG9mIHRoZSBpbmRleC4NCiAgICAgICAgZnVuY3Rpb24gZ2V0SW5kZXhOYW1lKGJ5dGVzMzIgaW5kZXhJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgcmV0dXJuIGluZGV4X2xvb2t1cFtpbmRleElkXS5uYW1lOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBub3RpY2UgUmV0cmlldmVzIHRoZSBpZCBvZiB0aGUgcm9vdCBub2RlIGZvciB0aGlzIGluZGV4Lg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4SWQgVGhlIGlkIG9mIHRoZSBpbmRleC4NCiAgICAgICAgZnVuY3Rpb24gZ2V0SW5kZXhSb290KGJ5dGVzMzIgaW5kZXhJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgcmV0dXJuIGluZGV4X2xvb2t1cFtpbmRleElkXS5yb290Ow0KICAgICAgICB9DQoNCg0KICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgdW5pcXVlIGlkZW50aWZpZXIgdGhpcyBub2RlIHJlcHJlc2VudHMuDQogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUNCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZUlkKGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7DQogICAgICAgICAgICByZXR1cm4gR3JvdmVMaWIuZ2V0Tm9kZUlkKGluZGV4X2xvb2t1cFtub2RlX3RvX2luZGV4W25vZGVJZF1dLCBub2RlSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIGluZGV4IGlkIGZvciB0aGUgbm9kZS4NCiAgICAgICAgLy8vIEBwYXJhbSBub2RlSWQgVGhlIGlkIGZvciB0aGUgbm9kZQ0KICAgICAgICBmdW5jdGlvbiBnZXROb2RlSW5kZXhJZChieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLmdldE5vZGVJbmRleElkKGluZGV4X2xvb2t1cFtub2RlX3RvX2luZGV4W25vZGVJZF1dLCBub2RlSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIHZhbHVlIG9mIHRoZSBub2RlLg0KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlDQogICAgICAgIGZ1bmN0aW9uIGdldE5vZGVWYWx1ZShieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoaW50KSB7DQogICAgICAgICAgICByZXR1cm4gR3JvdmVMaWIuZ2V0Tm9kZVZhbHVlKGluZGV4X2xvb2t1cFtub2RlX3RvX2luZGV4W25vZGVJZF1dLCBub2RlSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIGhlaWdodCBvZiB0aGUgbm9kZS4NCiAgICAgICAgLy8vIEBwYXJhbSBub2RlSWQgVGhlIGlkIGZvciB0aGUgbm9kZQ0KICAgICAgICBmdW5jdGlvbiBnZXROb2RlSGVpZ2h0KGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgICAgICByZXR1cm4gR3JvdmVMaWIuZ2V0Tm9kZUhlaWdodChpbmRleF9sb29rdXBbbm9kZV90b19pbmRleFtub2RlSWRdXSwgbm9kZUlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSBwYXJlbnQgaWQgb2YgdGhlIG5vZGUuDQogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUNCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZVBhcmVudChieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLmdldE5vZGVQYXJlbnQoaW5kZXhfbG9va3VwW25vZGVfdG9faW5kZXhbbm9kZUlkXV0sIG5vZGVJZCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgbGVmdCBjaGlsZCBpZCBvZiB0aGUgbm9kZS4NCiAgICAgICAgLy8vIEBwYXJhbSBub2RlSWQgVGhlIGlkIGZvciB0aGUgbm9kZQ0KICAgICAgICBmdW5jdGlvbiBnZXROb2RlTGVmdENoaWxkKGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7DQogICAgICAgICAgICByZXR1cm4gR3JvdmVMaWIuZ2V0Tm9kZUxlZnRDaGlsZChpbmRleF9sb29rdXBbbm9kZV90b19pbmRleFtub2RlSWRdXSwgbm9kZUlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSByaWdodCBjaGlsZCBpZCBvZiB0aGUgbm9kZS4NCiAgICAgICAgLy8vIEBwYXJhbSBub2RlSWQgVGhlIGlkIGZvciB0aGUgbm9kZQ0KICAgICAgICBmdW5jdGlvbiBnZXROb2RlUmlnaHRDaGlsZChieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLmdldE5vZGVSaWdodENoaWxkKGluZGV4X2xvb2t1cFtub2RlX3RvX2luZGV4W25vZGVJZF1dLCBub2RlSWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqIEBkZXYgUmV0cmlldmUgdGhlIGlkIG9mIHRoZSBub2RlIHRoYXQgY29tZXMgaW1tZWRpYXRlbHkgYmVmb3JlIHRoaXMNCiAgICAgICAgICogIG9uZS4gIFJldHVybnMgMHgwIGlmIHRoZXJlIGlzIG5vIHByZXZpb3VzIG5vZGUuDQogICAgICAgICAqLw0KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlDQogICAgICAgIGZ1bmN0aW9uIGdldFByZXZpb3VzTm9kZShieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLmdldFByZXZpb3VzTm9kZShpbmRleF9sb29rdXBbbm9kZV90b19pbmRleFtub2RlSWRdXSwgbm9kZUlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKiBAZGV2IFJldHJpZXZlIHRoZSBpZCBvZiB0aGUgbm9kZSB0aGF0IGNvbWVzIGltbWVkaWF0ZWx5IGFmdGVyIHRoaXMNCiAgICAgICAgICogIG9uZS4gIFJldHVybnMgMHgwIGlmIHRoZXJlIGlzIG5vIHByZXZpb3VzIG5vZGUuDQogICAgICAgICAqLw0KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlDQogICAgICAgIGZ1bmN0aW9uIGdldE5leHROb2RlKGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7DQogICAgICAgICAgICByZXR1cm4gR3JvdmVMaWIuZ2V0TmV4dE5vZGUoaW5kZXhfbG9va3VwW25vZGVfdG9faW5kZXhbbm9kZUlkXV0sIG5vZGVJZCk7DQogICAgICAgIH0NCg0KICAgICAgICAvKiogQGRldiBVcGRhdGUgb3IgSW5zZXJ0IGEgZGF0YSBlbGVtZW50IHJlcHJlc2VudGVkIGJ5IHRoZSB1bmlxdWUNCiAgICAgICAgICogIGlkZW50aWZpZXIgYGlkYCBpbnRvIHRoZSBpbmRleC4NCiAgICAgICAgICovDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXhOYW1lIFRoZSBodW1hbiByZWFkYWJsZSBuYW1lIGZvciB0aGUgaW5kZXggdGhhdCB0aGUgbm9kZSBzaG91bGQgYmUgdXBzZXJ0ZWQgaW50by4NCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgdGhhdCB0aGUgaW5kZXggbm9kZSByZXByZXNlbnRzLg0KICAgICAgICAvLy8gQHBhcmFtIHZhbHVlIFRoZSBudW1iZXIgd2hpY2ggcmVwcmVzZW50cyB0aGlzIGRhdGEgZWxlbWVudHMgdG90YWwgb3JkZXJpbmcuDQogICAgICAgIGZ1bmN0aW9uIGluc2VydChieXRlczMyIGluZGV4TmFtZSwgYnl0ZXMzMiBpZCwgaW50IHZhbHVlKSBwdWJsaWMgew0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgaW5kZXhJZCA9IGNvbXB1dGVJbmRleElkKG1zZy5zZW5kZXIsIGluZGV4TmFtZSk7DQogICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gaW5kZXhfbG9va3VwW2luZGV4SWRdOw0KDQogICAgICAgICAgICAgICAgaWYgKGluZGV4Lm5hbWUgIT0gaW5kZXhOYW1lKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgbmV3IGluZGV4LCBzdG9yZSBpdCdzIG5hbWUgYW5kIGlkDQogICAgICAgICAgICAgICAgICAgICAgICBpbmRleC5uYW1lID0gaW5kZXhOYW1lOw0KICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXguaWQgPSBpbmRleElkOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBtYXBwaW5nIGZyb20gbm9kZUlkIHRvIHRoZSBpbmRleElkDQogICAgICAgICAgICAgICAgbm9kZV90b19pbmRleFtjb21wdXRlTm9kZUlkKGluZGV4SWQsIGlkKV0gPSBpbmRleElkOw0KDQogICAgICAgICAgICAgICAgR3JvdmVMaWIuaW5zZXJ0KGluZGV4LCBpZCwgdmFsdWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgUXVlcnkgd2hldGhlciBhIG5vZGUgZXhpc3RzIHdpdGhpbiB0aGUgc3BlY2lmaWVkIGluZGV4IGZvciB0aGUgdW5pcXVlIGlkZW50aWZpZXIuDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXhJZCBUaGUgaWQgZm9yIHRoZSBpbmRleC4NCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGRhdGEgZWxlbWVudC4NCiAgICAgICAgZnVuY3Rpb24gZXhpc3RzKGJ5dGVzMzIgaW5kZXhJZCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLmV4aXN0cyhpbmRleF9sb29rdXBbaW5kZXhJZF0sIGlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyBAZGV2IFJlbW92ZSB0aGUgaW5kZXggbm9kZSBmb3IgdGhlIGdpdmVuIHVuaXF1ZSBpZGVudGlmaWVyLg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4TmFtZSBUaGUgbmFtZSBvZiB0aGUgaW5kZXguDQogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBkYXRhIGVsZW1lbnQuDQogICAgICAgIGZ1bmN0aW9uIHJlbW92ZShieXRlczMyIGluZGV4TmFtZSwgYnl0ZXMzMiBpZCkgcHVibGljIHsNCiAgICAgICAgICAgIEdyb3ZlTGliLnJlbW92ZShpbmRleF9sb29rdXBbY29tcHV0ZUluZGV4SWQobXNnLnNlbmRlciwgaW5kZXhOYW1lKV0sIGlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKiBAZGV2IFF1ZXJ5IHRoZSBpbmRleCBmb3IgdGhlIGVkZ2UtbW9zdCBub2RlIHRoYXQgc2F0aXNmaWVzIHRoZQ0KICAgICAgICAgKiBnaXZlbiBxdWVyeS4gIEZvciA+LCA+PSwgYW5kID09LCB0aGlzIHdpbGwgYmUgdGhlIGxlZnQtbW9zdCBub2RlDQogICAgICAgICAqIHRoYXQgc2F0aXNmaWVzIHRoZSBjb21wYXJpc29uLiAgRm9yIDwgYW5kIDw9IHRoaXMgd2lsbCBiZSB0aGUNCiAgICAgICAgICogcmlnaHQtbW9zdCBub2RlIHRoYXQgc2F0aXNmaWVzIHRoZSBjb21wYXJpc29uLg0KICAgICAgICAgKi8NCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleElkIFRoZSBpZCBvZiB0aGUgaW5kZXggdGhhdCBzaG91bGQgYmUgcXVlcmllZA0KICAgICAgICAvKiogQHBhcmFtIG9wZXJhdG9yIE9uZSBvZiAnPicsICc+PScsICc8JywgJzw9JywgJz09JyB0byBzcGVjaWZ5IHdoYXQNCiAgICAgICAgICogIHR5cGUgb2YgY29tcGFyaXNvbiBvcGVyYXRvciBzaG91bGQgYmUgdXNlZC4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHF1ZXJ5KGJ5dGVzMzIgaW5kZXhJZCwgYnl0ZXMyIG9wZXJhdG9yLCBpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChieXRlczMyKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLnF1ZXJ5KGluZGV4X2xvb2t1cFtpbmRleElkXSwgb3BlcmF0b3IsIHZhbHVlKTsNCiAgICAgICAgfQ0KfQ=='