base 64 content
base64groveLib1
	^'Ly8gR3JvdmUgdjAuMg0KDQoNCi8vLyBAdGl0bGUgR3JvdmVMaWIgLSBMaWJyYXJ5IGZvciBxdWVyaWFibGUgaW5kZXhlZCBvcmRlcmVkIGRhdGEuDQovLy8gQGF1dGhvciBQaXBlck1lcnJpYW0gLSA8cGlwZXJtZXJyaWFtQGdtYWlsLmNvbT4NCmxpYnJhcnkgR3JvdmVMaWIgew0KICAgICAgICAvKg0KICAgICAgICAgKiAgSW5kZXhlcyBmb3Igb3JkZXJlZCBkYXRhDQogICAgICAgICAqDQogICAgICAgICAqICBBZGRyZXNzOiAweDdjMWViMjA3YzA3ZTdhYjEzY2YyNDU1ODViZDAzZDBmYTQ3OGQwMzQNCiAgICAgICAgICovDQogICAgICAgIHN0cnVjdCBJbmRleCB7DQogICAgICAgICAgICAgICAgYnl0ZXMzMiByb290Ow0KICAgICAgICAgICAgICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gTm9kZSkgbm9kZXM7DQogICAgICAgIH0NCg0KICAgICAgICBzdHJ1Y3QgTm9kZSB7DQogICAgICAgICAgICAgICAgYnl0ZXMzMiBpZDsNCiAgICAgICAgICAgICAgICBpbnQgdmFsdWU7DQogICAgICAgICAgICAgICAgYnl0ZXMzMiBwYXJlbnQ7DQogICAgICAgICAgICAgICAgYnl0ZXMzMiBsZWZ0Ow0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgcmlnaHQ7DQogICAgICAgICAgICAgICAgdWludCBoZWlnaHQ7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBtYXgodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgICAgIGlmIChhID49IGIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoNCiAgICAgICAgICogIE5vZGUgZ2V0dGVycw0KICAgICAgICAgKi8NCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgbm9kZS4NCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLg0KICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSBpZCBmb3IgdGhlIG5vZGUgdG8gYmUgbG9va2VkIHVwLg0KICAgICAgICBmdW5jdGlvbiBnZXROb2RlSWQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgcmV0dXJuIGluZGV4Lm5vZGVzW2lkXS5pZDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSB2YWx1ZSBmb3IgdGhlIG5vZGUuDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4NCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4NCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZVZhbHVlKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgaWQpIGNvbnN0YW50IHJldHVybnMgKGludCkgew0KICAgICAgICAgICAgcmV0dXJuIGluZGV4Lm5vZGVzW2lkXS52YWx1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSBoZWlnaHQgb2YgdGhlIG5vZGUuDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4NCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4NCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZUhlaWdodChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgICAgICByZXR1cm4gaW5kZXgubm9kZXNbaWRdLmhlaWdodDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSBwYXJlbnQgaWQgb2YgdGhlIG5vZGUuDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4NCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4NCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZVBhcmVudChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7DQogICAgICAgICAgICByZXR1cm4gaW5kZXgubm9kZXNbaWRdLnBhcmVudDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSBsZWZ0IGNoaWxkIGlkIG9mIHRoZSBub2RlLg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuDQogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIGlkIGZvciB0aGUgbm9kZSB0byBiZSBsb29rZWQgdXAuDQogICAgICAgIGZ1bmN0aW9uIGdldE5vZGVMZWZ0Q2hpbGQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgcmV0dXJuIGluZGV4Lm5vZGVzW2lkXS5sZWZ0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIHJpZ2h0IGNoaWxkIGlkIG9mIHRoZSBub2RlLg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuDQogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIGlkIGZvciB0aGUgbm9kZSB0byBiZSBsb29rZWQgdXAuDQogICAgICAgIGZ1bmN0aW9uIGdldE5vZGVSaWdodENoaWxkKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgaWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsNCiAgICAgICAgICAgIHJldHVybiBpbmRleC5ub2Rlc1tpZF0ucmlnaHQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgbm9kZSBpZCBvZiB0aGUgbmV4dCBub2RlIGluIHRoZSB0cmVlLg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuDQogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIGlkIGZvciB0aGUgbm9kZSB0byBiZSBsb29rZWQgdXAuDQogICAgICAgIGZ1bmN0aW9uIGdldFByZXZpb3VzTm9kZShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7DQogICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tpZF07DQoNCiAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5pZCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBVbmtub3duIG5vZGUsIGp1c3QgcmV0dXJuIDB4MDsNCiAgICAgICAgICAgICAgICByZXR1cm4gMHgwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBOb2RlIG1lbW9yeSBjaGlsZDsNCg0KICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmxlZnQgIT0gMHgwKSB7DQogICAgICAgICAgICAgICAgLy8gVHJhY2UgbGVmdCB0byBsYXRlc3QgY2hpbGQgaW4gbGVmdCB0cmVlLg0KICAgICAgICAgICAgICAgIGNoaWxkID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUubGVmdF07DQoNCiAgICAgICAgICAgICAgICB3aGlsZSAoY2hpbGQucmlnaHQgIT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IGluZGV4Lm5vZGVzW2NoaWxkLnJpZ2h0XTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkLmlkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucGFyZW50ICE9IDB4MCkgew0KICAgICAgICAgICAgICAgIC8vIE5vdyB3ZSB0cmFjZSBiYWNrIHVwIHRocm91Z2ggcGFyZW50IHJlbGF0aW9uc2hpcHMsIGxvb2tpbmcNCiAgICAgICAgICAgICAgICAvLyBmb3IgYSBsaW5rIHdoZXJlIHRoZSBjaGlsZCBpcyB0aGUgcmlnaHQgY2hpbGQgb2YgaXQncw0KICAgICAgICAgICAgICAgIC8vIHBhcmVudC4NCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcGFyZW50ID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUucGFyZW50XTsNCiAgICAgICAgICAgICAgICBjaGlsZCA9IGN1cnJlbnROb2RlOw0KDQogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBjaGlsZC5pZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudC5pZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucGFyZW50ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBwYXJlbnQ7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IGluZGV4Lm5vZGVzW3BhcmVudC5wYXJlbnRdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgZmlyc3Qgbm9kZSwgYW5kIGhhcyBubyBwcmV2aW91cyBub2RlLg0KICAgICAgICAgICAgcmV0dXJuIDB4MDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSBub2RlIGlkIG9mIHRoZSBwcmV2aW91cyBub2RlIGluIHRoZSB0cmVlLg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuDQogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIGlkIGZvciB0aGUgbm9kZSB0byBiZSBsb29rZWQgdXAuDQogICAgICAgIGZ1bmN0aW9uIGdldE5leHROb2RlKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgaWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsNCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2lkXTsNCg0KICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmlkID09IDB4MCkgew0KICAgICAgICAgICAgICAgIC8vIFVua25vd24gbm9kZSwganVzdCByZXR1cm4gMHgwOw0KICAgICAgICAgICAgICAgIHJldHVybiAweDA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIE5vZGUgbWVtb3J5IGNoaWxkOw0KDQogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucmlnaHQgIT0gMHgwKSB7DQogICAgICAgICAgICAgICAgLy8gVHJhY2UgcmlnaHQgdG8gZWFybGllc3QgY2hpbGQgaW4gcmlnaHQgdHJlZS4NCiAgICAgICAgICAgICAgICBjaGlsZCA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnJpZ2h0XTsNCg0KICAgICAgICAgICAgICAgIHdoaWxlIChjaGlsZC5sZWZ0ICE9IDApIHsNCiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tjaGlsZC5sZWZ0XTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkLmlkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucGFyZW50ICE9IDB4MCkgew0KICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBub2RlIGlzIHRoZSBsZWZ0IGNoaWxkIG9mIGl0J3MgcGFyZW50LCB0aGVuIHRoZQ0KICAgICAgICAgICAgICAgIC8vIHBhcmVudCBpcyB0aGUgbmV4dCBvbmUuDQogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIHBhcmVudCA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnBhcmVudF07DQogICAgICAgICAgICAgICAgY2hpbGQgPSBjdXJyZW50Tm9kZTsNCg0KICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQubGVmdCA9PSBjaGlsZC5pZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudC5pZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucGFyZW50ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBwYXJlbnQ7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IGluZGV4Lm5vZGVzW3BhcmVudC5wYXJlbnRdOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIE5vdyB3ZSBuZWVkIHRvIHRyYWNlIGFsbCB0aGUgd2F5IHVwIGNoZWNraW5nIHRvIHNlZSBpZiBhbnkgcGFyZW50IGlzIHRoZSANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgZmluYWwgbm9kZS4NCiAgICAgICAgICAgIHJldHVybiAweDA7DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vLyBAZGV2IFVwZGF0ZXMgb3IgSW5zZXJ0cyB0aGUgaWQgaW50byB0aGUgaW5kZXggYXQgaXRzIGFwcHJvcHJpYXRlIGxvY2F0aW9uIGJhc2VkIG9uIHRoZSB2YWx1ZSBwcm92aWRlZC4NCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLg0KICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBlbGVtZW50IHRoZSBpbmRleCBub2RlIHdpbGwgcmVwcmVzZW50Lg0KICAgICAgICAvLy8gQHBhcmFtIHZhbHVlIFRoZSB2YWx1ZSBvZiB0aGUgZGF0YSBlbGVtZW50IHRoYXQgcmVwcmVzZW50cyBpdCdzIHRvdGFsIG9yZGVyaW5nIHdpdGggcmVzcGVjdCB0byBvdGhlciBlbGVtZW50ZXMuDQogICAgICAgIGZ1bmN0aW9uIGluc2VydChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkLCBpbnQgdmFsdWUpIHB1YmxpYyB7DQogICAgICAgICAgICAgICAgaWYgKGluZGV4Lm5vZGVzW2lkXS5pZCA9PSBpZCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBBIG5vZGUgd2l0aCB0aGlzIGlkIGFscmVhZHkgZXhpc3RzLiAgSWYgdGhlIHZhbHVlIGlzDQogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzYW1lLCB0aGVuIGp1c3QgcmV0dXJuIGVhcmx5LCBvdGhlcndpc2UsIHJlbW92ZSBpdA0KICAgICAgICAgICAgICAgICAgICAvLyBhbmQgcmVpbnNlcnQgaXQuDQogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleC5ub2Rlc1tpZF0udmFsdWUgPT0gdmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZW1vdmUoaW5kZXgsIGlkKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB1aW50IGxlZnRIZWlnaHQ7DQogICAgICAgICAgICAgICAgdWludCByaWdodEhlaWdodDsNCg0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgcHJldmlvdXNOb2RlSWQgPSAweDA7DQoNCiAgICAgICAgICAgICAgICBpZiAoaW5kZXgucm9vdCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgaW5kZXgucm9vdCA9IGlkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tpbmRleC5yb290XTsNCg0KICAgICAgICAgICAgICAgIC8vIERvIGluc2VydGlvbg0KICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5pZCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBuZXcgdW5wb3B1bGF0ZWQgbm9kZS4NCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlLmlkID0gaWQ7DQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS5wYXJlbnQgPSBwcmV2aW91c05vZGVJZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlLnZhbHVlID0gdmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgcHJldmlvdXMgbm9kZSBpZC4NCiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNOb2RlSWQgPSBjdXJyZW50Tm9kZS5pZDsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBUaGUgbmV3IG5vZGUgYmVsb25ncyBpbiB0aGUgcmlnaHQgc3VidHJlZQ0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPj0gY3VycmVudE5vZGUudmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5yaWdodCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS5yaWdodCA9IGlkOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBuZXcgbm9kZSBiZWxvbmdzIGluIHRoZSBsZWZ0IHN1YnRyZWUuDQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5sZWZ0ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUubGVmdCA9IGlkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUubGVmdF07DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gUmViYWxhbmNlIHRoZSB0cmVlDQogICAgICAgICAgICAgICAgX3JlYmFsYW5jZVRyZWUoaW5kZXgsIGN1cnJlbnROb2RlLmlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLyBAZGV2IENoZWNrcyB3aGV0aGVyIGEgbm9kZSBmb3IgdGhlIGdpdmVuIHVuaXF1ZSBpZGVudGlmaWVyIGV4aXN0cyB3aXRoaW4gdGhlIGdpdmVuIGluZGV4Lg0KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHNob3VsZCBiZSBzZWFyY2hlZA0KICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBlbGVtZW50IHRvIGNoZWNrIGZvci4NCiAgICAgICAgZnVuY3Rpb24gZXhpc3RzKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgaWQpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgICAgIHJldHVybiAoaW5kZXgubm9kZXNbaWRdLmhlaWdodCA+IDApOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8vIEBkZXYgUmVtb3ZlIHRoZSBub2RlIGZvciB0aGUgZ2l2ZW4gdW5pcXVlIGlkZW50aWZpZXIgZnJvbSB0aGUgaW5kZXguDQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgc2hvdWxkIGJlIHJlbW92ZWQNCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGRhdGEgZWxlbWVudCB0byByZW1vdmUuDQogICAgICAgIGZ1bmN0aW9uIHJlbW92ZShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBwdWJsaWMgew0KICAgICAgICAgICAgTm9kZSBzdG9yYWdlIHJlcGxhY2VtZW50Tm9kZTsNCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBwYXJlbnQ7DQogICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY2hpbGQ7DQogICAgICAgICAgICBieXRlczMyIHJlYmFsYW5jZU9yaWdpbjsNCg0KICAgICAgICAgICAgTm9kZSBzdG9yYWdlIG5vZGVUb0RlbGV0ZSA9IGluZGV4Lm5vZGVzW2lkXTsNCg0KICAgICAgICAgICAgaWYgKG5vZGVUb0RlbGV0ZS5pZCAhPSBpZCkgew0KICAgICAgICAgICAgICAgIC8vIFRoZSBpZCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgdHJlZS4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChub2RlVG9EZWxldGUubGVmdCAhPSAweDAgfHwgbm9kZVRvRGVsZXRlLnJpZ2h0ICE9IDB4MCkgew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBub3QgYSBsZWFmIG5vZGUgYW5kIHRodXMgbXVzdCByZXBsYWNlIGl0c2VsZiBpbg0KICAgICAgICAgICAgICAgIC8vIGl0J3MgdHJlZSBieSBlaXRoZXIgdGhlIHByZXZpb3VzIG9yIG5leHQgbm9kZS4NCiAgICAgICAgICAgICAgICBpZiAobm9kZVRvRGVsZXRlLmxlZnQgIT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBndWFyYW50ZWVkIHRvIG5vdCBoYXZlIGEgcmlnaHQgY2hpbGQuDQogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2dldFByZXZpb3VzTm9kZShpbmRleCwgbm9kZVRvRGVsZXRlLmlkKV07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgZ3VhcmFudGVlZCB0byBub3QgaGF2ZSBhIGxlZnQgY2hpbGQuDQogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2dldE5leHROb2RlKGluZGV4LCBub2RlVG9EZWxldGUuaWQpXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gVGhlIHJlcGxhY2VtZW50Tm9kZSBpcyBndWFyYW50ZWVkIHRvIGhhdmUgYSBwYXJlbnQuDQogICAgICAgICAgICAgICAgcGFyZW50ID0gaW5kZXgubm9kZXNbcmVwbGFjZW1lbnROb2RlLnBhcmVudF07DQoNCiAgICAgICAgICAgICAgICAvLyBLZWVwIG5vdGUgb2YgdGhlIGxvY2F0aW9uIHRoYXQgb3VyIHRyZWUgcmViYWxhbmNpbmcgc2hvdWxkDQogICAgICAgICAgICAgICAgLy8gc3RhcnQgYXQuDQogICAgICAgICAgICAgICAgcmViYWxhbmNlT3JpZ2luID0gcmVwbGFjZW1lbnROb2RlLmlkOw0KDQogICAgICAgICAgICAgICAgLy8gSm9pbiB0aGUgcGFyZW50IG9mIHRoZSByZXBsYWNlbWVudCBub2RlIHdpdGggYW55IHN1YnRyZWUgb2YNCiAgICAgICAgICAgICAgICAvLyB0aGUgcmVwbGFjZW1lbnQgbm9kZS4gIFdlIGNhbiBndWFyYW50ZWUgdGhhdCB0aGUgcmVwbGFjZW1lbnQNCiAgICAgICAgICAgICAgICAvLyBub2RlIGhhcyBhdCBtb3N0IG9uZSBzdWJ0cmVlIGJlY2F1c2Ugb2YgaG93IGdldE5leHROb2RlIGFuZA0KICAgICAgICAgICAgICAgIC8vIGdldFByZXZpb3VzTm9kZSBhcmUgdXNlZC4NCiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gcmVwbGFjZW1lbnROb2RlLmlkKSB7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudC5sZWZ0ID0gcmVwbGFjZW1lbnROb2RlLnJpZ2h0Ow0KICAgICAgICAgICAgICAgICAgICBpZiAocmVwbGFjZW1lbnROb2RlLnJpZ2h0ICE9IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tyZXBsYWNlbWVudE5vZGUucmlnaHRdOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQucGFyZW50ID0gcGFyZW50LmlkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucmlnaHQgPT0gcmVwbGFjZW1lbnROb2RlLmlkKSB7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudC5yaWdodCA9IHJlcGxhY2VtZW50Tm9kZS5sZWZ0Ow0KICAgICAgICAgICAgICAgICAgICBpZiAocmVwbGFjZW1lbnROb2RlLmxlZnQgIT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IGluZGV4Lm5vZGVzW3JlcGxhY2VtZW50Tm9kZS5sZWZ0XTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnBhcmVudCA9IHBhcmVudC5pZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIE5vdyB3ZSByZXBsYWNlIHRoZSBub2RlVG9EZWxldGUgd2l0aCB0aGUgcmVwbGFjZW1lbnROb2RlLg0KICAgICAgICAgICAgICAgIC8vIFRoaXMgaW5jbHVkZXMgcGFyZW50L2NoaWxkIHJlbGF0aW9uc2hpcHMgZm9yIGFsbCBvZiB0aGUNCiAgICAgICAgICAgICAgICAvLyBwYXJlbnQsIHRoZSBsZWZ0IGNoaWxkLCBhbmQgdGhlIHJpZ2h0IGNoaWxkLg0KICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50Tm9kZS5wYXJlbnQgPSBub2RlVG9EZWxldGUucGFyZW50Ow0KICAgICAgICAgICAgICAgIGlmIChub2RlVG9EZWxldGUucGFyZW50ICE9IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBpbmRleC5ub2Rlc1tub2RlVG9EZWxldGUucGFyZW50XTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5sZWZ0ID09IG5vZGVUb0RlbGV0ZS5pZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmxlZnQgPSByZXBsYWNlbWVudE5vZGUuaWQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBub2RlVG9EZWxldGUuaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5yaWdodCA9IHJlcGxhY2VtZW50Tm9kZS5pZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5vZGUgd2UgYXJlIGRlbGV0aW5nIGlzIHRoZSByb290IG5vZGUgdXBkYXRlIHRoZQ0KICAgICAgICAgICAgICAgICAgICAvLyBpbmRleCByb290IG5vZGUgcG9pbnRlci4NCiAgICAgICAgICAgICAgICAgICAgaW5kZXgucm9vdCA9IHJlcGxhY2VtZW50Tm9kZS5pZDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXBsYWNlbWVudE5vZGUubGVmdCA9IG5vZGVUb0RlbGV0ZS5sZWZ0Ow0KICAgICAgICAgICAgICAgIGlmIChub2RlVG9EZWxldGUubGVmdCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tub2RlVG9EZWxldGUubGVmdF07DQogICAgICAgICAgICAgICAgICAgIGNoaWxkLnBhcmVudCA9IHJlcGxhY2VtZW50Tm9kZS5pZDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXBsYWNlbWVudE5vZGUucmlnaHQgPSBub2RlVG9EZWxldGUucmlnaHQ7DQogICAgICAgICAgICAgICAgaWYgKG5vZGVUb0RlbGV0ZS5yaWdodCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tub2RlVG9EZWxldGUucmlnaHRdOw0KICAgICAgICAgICAgICAgICAgICBjaGlsZC5wYXJlbnQgPSByZXBsYWNlbWVudE5vZGUuaWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAobm9kZVRvRGVsZXRlLnBhcmVudCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBUaGUgbm9kZSBiZWluZyBkZWxldGVkIGlzIGEgbGVhZiBub2RlIHNvIHdlIG9ubHkgZXJhc2UgaXQncw0KICAgICAgICAgICAgICAgIC8vIHBhcmVudCBsaW5rYWdlLg0KICAgICAgICAgICAgICAgIHBhcmVudCA9IGluZGV4Lm5vZGVzW25vZGVUb0RlbGV0ZS5wYXJlbnRdOw0KDQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5sZWZ0ID09IG5vZGVUb0RlbGV0ZS5pZCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQubGVmdCA9IDB4MDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBub2RlVG9EZWxldGUuaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJpZ2h0ID0gMHgwOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIGtlZXAgbm90ZSBvZiB3aGVyZSB0aGUgcmViYWxhbmNpbmcgc2hvdWxkIGJlZ2luLg0KICAgICAgICAgICAgICAgIHJlYmFsYW5jZU9yaWdpbiA9IHBhcmVudC5pZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYm90aCBhIGxlYWYgbm9kZSBhbmQgdGhlIHJvb3Qgbm9kZSwgc28gd2UgbmVlZCB0bw0KICAgICAgICAgICAgICAgIC8vIHVuc2V0IHRoZSByb290IG5vZGUgcG9pbnRlci4NCiAgICAgICAgICAgICAgICBpbmRleC5yb290ID0gMHgwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBOb3cgd2UgemVybyBvdXQgYWxsIG9mIHRoZSBmaWVsZHMgb24gdGhlIG5vZGVUb0RlbGV0ZS4NCiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS5pZCA9IDB4MDsNCiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS52YWx1ZSA9IDA7DQogICAgICAgICAgICBub2RlVG9EZWxldGUucGFyZW50ID0gMHgwOw0KICAgICAgICAgICAgbm9kZVRvRGVsZXRlLmxlZnQgPSAweDA7DQogICAgICAgICAgICBub2RlVG9EZWxldGUucmlnaHQgPSAweDA7DQogICAgICAgICAgICBub2RlVG9EZWxldGUuaGVpZ2h0ID0gMDsNCg0KICAgICAgICAgICAgLy8gV2FsayBiYWNrIHVwIHRoZSB0cmVlIHJlYmFsYW5jaW5nDQogICAgICAgICAgICBpZiAocmViYWxhbmNlT3JpZ2luICE9IDB4MCkgew0KICAgICAgICAgICAgICAgIF9yZWJhbGFuY2VUcmVlKGluZGV4LCByZWJhbGFuY2VPcmlnaW4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgYnl0ZXMyIGNvbnN0YW50IEdUID0gIj4iOw0KICAgICAgICBieXRlczIgY29uc3RhbnQgTFQgPSAiPCI7DQogICAgICAgIGJ5dGVzMiBjb25zdGFudCBHVEUgPSAiPj0iOw0KICAgICAgICBieXRlczIgY29uc3RhbnQgTFRFID0gIjw9IjsNCiAgICAgICAgYnl0ZXMyIGNvbnN0YW50IEVRID0gIj09IjsNCg0KICAgICAgICBmdW5jdGlvbiBfY29tcGFyZShpbnQgbGVmdCwgYnl0ZXMyIG9wZXJhdG9yLCBpbnQgcmlnaHQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PSBHVCkgew0KICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA+IHJpZ2h0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PSBMVCkgew0KICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA8IHJpZ2h0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PSBHVEUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gKGxlZnQgPj0gcmlnaHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG9wZXJhdG9yID09IExURSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA8PSByaWdodCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAob3BlcmF0b3IgPT0gRVEpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gKGxlZnQgPT0gcmlnaHQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBJbnZhbGlkIG9wZXJhdG9yLg0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBfZ2V0TWF4aW11bShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsNCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tpZF07DQoNCiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucmlnaHQgPT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE5vZGUudmFsdWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gX2dldE1pbmltdW0oSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbaWRdOw0KDQogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmxlZnQgPT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE5vZGUudmFsdWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5sZWZ0XTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIC8qKiBAZGV2IFF1ZXJ5IHRoZSBpbmRleCBmb3IgdGhlIGVkZ2UtbW9zdCBub2RlIHRoYXQgc2F0aXNmaWVzIHRoZQ0KICAgICAgICAgKiAgZ2l2ZW4gcXVlcnkuICBGb3IgPiwgPj0sIGFuZCA9PSwgdGhpcyB3aWxsIGJlIHRoZSBsZWZ0LW1vc3Qgbm9kZQ0KICAgICAgICAgKiAgdGhhdCBzYXRpc2ZpZXMgdGhlIGNvbXBhcmlzb24uICBGb3IgPCBhbmQgPD0gdGhpcyB3aWxsIGJlIHRoZQ0KICAgICAgICAgKiAgcmlnaHQtbW9zdCBub2RlIHRoYXQgc2F0aXNmaWVzIHRoZSBjb21wYXJpc29uLg0KICAgICAgICAgKi8NCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCBzaG91bGQgYmUgcXVlcmllZA0KICAgICAgICAvKiogQHBhcmFtIG9wZXJhdG9yIE9uZSBvZiAnPicsICc+PScsICc8JywgJzw9JywgJz09JyB0byBzcGVjaWZ5IHdoYXQNCiAgICAgICAgICogIHR5cGUgb2YgY29tcGFyaXNvbiBvcGVyYXRvciBzaG91bGQgYmUgdXNlZC4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHF1ZXJ5KEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMiBvcGVyYXRvciwgaW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgcm9vdE5vZGVJZCA9IGluZGV4LnJvb3Q7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHJvb3ROb2RlSWQgPT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIEVtcHR5IHRyZWUuDQogICAgICAgICAgICAgICAgICAgIHJldHVybiAweDA7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbcm9vdE5vZGVJZF07DQoNCiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoX2NvbXBhcmUoY3VycmVudE5vZGUudmFsdWUsIG9wZXJhdG9yLCB2YWx1ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGhhdmUgZm91bmQgYSBtYXRjaCBidXQgaXQgbWlnaHQgbm90IGJlIHRoZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gKmNvcnJlY3QqIG1hdGNoLg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChvcGVyYXRvciA9PSBMVCkgfHwgKG9wZXJhdG9yID09IExURSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOZWVkIHRvIGtlZXAgdHJhdmVyc2luZyByaWdodCB1bnRpbCB0aGlzIGlzIG5vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9uZ2VyIHRydWUuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnJpZ2h0ID09IDB4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE5vZGUuaWQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfY29tcGFyZShfZ2V0TWluaW11bShpbmRleCwgY3VycmVudE5vZGUucmlnaHQpLCBvcGVyYXRvciwgdmFsdWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZXJlIGFyZSBzdGlsbCBub2RlcyB0byB0aGUgcmlnaHQgdGhhdA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtYXRjaC4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE5vZGUuaWQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgob3BlcmF0b3IgPT0gR1QpIHx8IChvcGVyYXRvciA9PSBHVEUpIHx8IChvcGVyYXRvciA9PSBFUSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOZWVkIHRvIGtlZXAgdHJhdmVyc2luZyBsZWZ0IHVudGlsIHRoaXMgaXMgbm8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb25nZXIgdHJ1ZS4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubGVmdCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLmlkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2NvbXBhcmUoX2dldE1heGltdW0oaW5kZXgsIGN1cnJlbnROb2RlLmxlZnQpLCBvcGVyYXRvciwgdmFsdWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUubGVmdF07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE5vZGUuaWQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBpZiAoKG9wZXJhdG9yID09IExUKSB8fCAob3BlcmF0b3IgPT0gTFRFKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmxlZnQgPT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgYXJlIG5vIG5vZGVzIHRoYXQgYXJlIGxlc3MgdGhhbiB0aGUgdmFsdWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzbyByZXR1cm4gbnVsbC4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMHgwOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5sZWZ0XTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKChvcGVyYXRvciA9PSBHVCkgfHwgKG9wZXJhdG9yID09IEdURSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5yaWdodCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSBhcmUgbm8gbm9kZXMgdGhhdCBhcmUgZ3JlYXRlciB0aGFuIHRoZSB2YWx1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHJldHVybiBudWxsLg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAweDA7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnJpZ2h0XTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9wZXJhdG9yID09IEVRKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUudmFsdWUgPCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5yaWdodCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDB4MDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS52YWx1ZSA+IHZhbHVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmxlZnQgPT0gMHgwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAweDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUubGVmdF07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBfcmViYWxhbmNlVHJlZShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBpbnRlcm5hbCB7DQogICAgICAgICAgICAvLyBUcmFjZSBiYWNrIHVwIHJlYmFsYW5jaW5nIHRoZSB0cmVlIGFuZCB1cGRhdGluZyBoZWlnaHRzIGFzDQogICAgICAgICAgICAvLyBuZWVkZWQuLg0KICAgICAgICAgICAgTm9kZSBzdG9yYWdlIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbaWRdOw0KDQogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgICAgIGludCBiYWxhbmNlRmFjdG9yID0gX2dldEJhbGFuY2VGYWN0b3IoaW5kZXgsIGN1cnJlbnROb2RlLmlkKTsNCg0KICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlRmFjdG9yID09IDIpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmlnaHQgcm90YXRpb24gKHRyZWUgaXMgaGVhdnkgb24gdGhlIGxlZnQpDQogICAgICAgICAgICAgICAgICAgIGlmIChfZ2V0QmFsYW5jZUZhY3RvcihpbmRleCwgY3VycmVudE5vZGUubGVmdCkgPT0gLTEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBzdWJ0cmVlIGlzIGxlYW5pbmcgcmlnaHQgc28gaXQgbmVlZCB0byBiZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gcm90YXRlZCBsZWZ0IGJlZm9yZSB0aGUgY3VycmVudCBub2RlIGlzIHJvdGF0ZWQNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJpZ2h0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgX3JvdGF0ZUxlZnQoaW5kZXgsIGN1cnJlbnROb2RlLmxlZnQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIF9yb3RhdGVSaWdodChpbmRleCwgY3VycmVudE5vZGUuaWQpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlRmFjdG9yID09IC0yKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIExlZnQgcm90YXRpb24gKHRyZWUgaXMgaGVhdnkgb24gdGhlIHJpZ2h0KQ0KICAgICAgICAgICAgICAgICAgICBpZiAoX2dldEJhbGFuY2VGYWN0b3IoaW5kZXgsIGN1cnJlbnROb2RlLnJpZ2h0KSA9PSAxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgc3VidHJlZSBpcyBsZWFuaW5nIGxlZnQgc28gaXQgbmVlZCB0byBiZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gcm90YXRlZCByaWdodCBiZWZvcmUgdGhlIGN1cnJlbnQgbm9kZSBpcyByb3RhdGVkDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBsZWZ0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgX3JvdGF0ZVJpZ2h0KGluZGV4LCBjdXJyZW50Tm9kZS5yaWdodCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgX3JvdGF0ZUxlZnQoaW5kZXgsIGN1cnJlbnROb2RlLmlkKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoKC0xIDw9IGJhbGFuY2VGYWN0b3IpICYmIChiYWxhbmNlRmFjdG9yIDw9IDEpKSB7DQogICAgICAgICAgICAgICAgICAgIF91cGRhdGVOb2RlSGVpZ2h0KGluZGV4LCBjdXJyZW50Tm9kZS5pZCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnBhcmVudCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmVhY2hlZCB0aGUgcm9vdCB3aGljaCBtYXkgYmUgbmV3IGR1ZSB0byB0cmVlDQogICAgICAgICAgICAgICAgICAgIC8vIHJvdGF0aW9uLCBzbyBzZXQgaXQgYXMgdGhlIHJvb3QgYW5kIHRoZW4gYnJlYWsuDQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUucGFyZW50XTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIF9nZXRCYWxhbmNlRmFjdG9yKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgaWQpIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBub2RlID0gaW5kZXgubm9kZXNbaWRdOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuIGludChpbmRleC5ub2Rlc1tub2RlLmxlZnRdLmhlaWdodCkgLSBpbnQoaW5kZXgubm9kZXNbbm9kZS5yaWdodF0uaGVpZ2h0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIF91cGRhdGVOb2RlSGVpZ2h0KEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgaWQpIGludGVybmFsIHsNCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2Ugbm9kZSA9IGluZGV4Lm5vZGVzW2lkXTsNCg0KICAgICAgICAgICAgICAgIG5vZGUuaGVpZ2h0ID0gbWF4KGluZGV4Lm5vZGVzW25vZGUubGVmdF0uaGVpZ2h0LCBpbmRleC5ub2Rlc1tub2RlLnJpZ2h0XS5oZWlnaHQpICsgMTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIF9yb3RhdGVMZWZ0KEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgaWQpIGludGVybmFsIHsNCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBvcmlnaW5hbFJvb3QgPSBpbmRleC5ub2Rlc1tpZF07DQoNCiAgICAgICAgICAgIGlmIChvcmlnaW5hbFJvb3QucmlnaHQgPT0gMHgwKSB7DQogICAgICAgICAgICAgICAgLy8gQ2Fubm90IHJvdGF0ZSBsZWZ0IGlmIHRoZXJlIGlzIG5vIHJpZ2h0IG9yaWdpbmFsUm9vdCB0byByb3RhdGUgaW50bw0KICAgICAgICAgICAgICAgIC8vIHBsYWNlLg0KICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBUaGUgcmlnaHQgY2hpbGQgaXMgdGhlIG5ldyByb290LCBzbyBpdCBnZXRzIHRoZSBvcmlnaW5hbA0KICAgICAgICAgICAgLy8gYG9yaWdpbmFsUm9vdC5wYXJlbnRgIGFzIGl0J3MgcGFyZW50Lg0KICAgICAgICAgICAgTm9kZSBzdG9yYWdlIG5ld1Jvb3QgPSBpbmRleC5ub2Rlc1tvcmlnaW5hbFJvb3QucmlnaHRdOw0KICAgICAgICAgICAgbmV3Um9vdC5wYXJlbnQgPSBvcmlnaW5hbFJvb3QucGFyZW50Ow0KDQogICAgICAgICAgICAvLyBUaGUgb3JpZ2luYWwgcm9vdCBuZWVkcyB0byBoYXZlIGl0J3MgcmlnaHQgY2hpbGQgbnVsbGVkIG91dC4NCiAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5yaWdodCA9IDB4MDsNCg0KICAgICAgICAgICAgaWYgKG9yaWdpbmFsUm9vdC5wYXJlbnQgIT0gMHgwKSB7DQogICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBwYXJlbnQgbm9kZSwgaXQgbmVlZHMgdG8gbm93IHBvaW50IGRvd253YXJkIGF0DQogICAgICAgICAgICAgICAgLy8gdGhlIG5ld1Jvb3Qgd2hpY2ggaXMgcm90YXRpbmcgaW50byB0aGUgcGxhY2Ugd2hlcmUgYG5vZGVgIHdhcy4NCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcGFyZW50ID0gaW5kZXgubm9kZXNbb3JpZ2luYWxSb290LnBhcmVudF07DQoNCiAgICAgICAgICAgICAgICAvLyBmaWd1cmUgb3V0IGlmIHdlJ3JlIGEgbGVmdCBvciByaWdodCBjaGlsZCBhbmQgaGF2ZSB0aGUNCiAgICAgICAgICAgICAgICAvLyBwYXJlbnQgcG9pbnQgdG8gdGhlIG5ldyBub2RlLg0KICAgICAgICAgICAgICAgIGlmIChwYXJlbnQubGVmdCA9PSBvcmlnaW5hbFJvb3QuaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyZW50LmxlZnQgPSBuZXdSb290LmlkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAocGFyZW50LnJpZ2h0ID09IG9yaWdpbmFsUm9vdC5pZCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmlnaHQgPSBuZXdSb290LmlkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICBpZiAobmV3Um9vdC5sZWZ0ICE9IDApIHsNCiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV3IHJvb3QgaGFkIGEgbGVmdCBjaGlsZCwgdGhhdCBtb3ZlcyB0byBiZSB0aGUNCiAgICAgICAgICAgICAgICAvLyBuZXcgcmlnaHQgY2hpbGQgb2YgdGhlIG9yaWdpbmFsIHJvb3Qgbm9kZQ0KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBsZWZ0Q2hpbGQgPSBpbmRleC5ub2Rlc1tuZXdSb290LmxlZnRdOw0KICAgICAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5yaWdodCA9IGxlZnRDaGlsZC5pZDsNCiAgICAgICAgICAgICAgICBsZWZ0Q2hpbGQucGFyZW50ID0gb3JpZ2luYWxSb290LmlkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBVcGRhdGUgdGhlIG5ld1Jvb3QncyBsZWZ0IG5vZGUgdG8gcG9pbnQgYXQgdGhlIG9yaWdpbmFsIG5vZGUuDQogICAgICAgICAgICBvcmlnaW5hbFJvb3QucGFyZW50ID0gbmV3Um9vdC5pZDsNCiAgICAgICAgICAgIG5ld1Jvb3QubGVmdCA9IG9yaWdpbmFsUm9vdC5pZDsNCg0KICAgICAgICAgICAgaWYgKG5ld1Jvb3QucGFyZW50ID09IDB4MCkgew0KICAgICAgICAgICAgICAgIGluZGV4LnJvb3QgPSBuZXdSb290LmlkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBUT0RPOiBhcmUgYm90aCBvZiB0aGVzZSB1cGRhdGVzIG5lY2Vzc2FyeT8NCiAgICAgICAgICAgIF91cGRhdGVOb2RlSGVpZ2h0KGluZGV4LCBvcmlnaW5hbFJvb3QuaWQpOw0KICAgICAgICAgICAgX3VwZGF0ZU5vZGVIZWlnaHQoaW5kZXgsIG5ld1Jvb3QuaWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gX3JvdGF0ZVJpZ2h0KEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgaWQpIGludGVybmFsIHsNCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBvcmlnaW5hbFJvb3QgPSBpbmRleC5ub2Rlc1tpZF07DQoNCiAgICAgICAgICAgIGlmIChvcmlnaW5hbFJvb3QubGVmdCA9PSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBDYW5ub3Qgcm90YXRlIHJpZ2h0IGlmIHRoZXJlIGlzIG5vIGxlZnQgbm9kZSB0byByb3RhdGUgaW50bw0KICAgICAgICAgICAgICAgIC8vIHBsYWNlLg0KICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBUaGUgbGVmdCBjaGlsZCBpcyB0YWtpbmcgdGhlIHBsYWNlIG9mIG5vZGUsIHNvIHdlIHVwZGF0ZSBpdCdzDQogICAgICAgICAgICAvLyBwYXJlbnQgdG8gYmUgdGhlIG9yaWdpbmFsIHBhcmVudCBvZiB0aGUgbm9kZS4NCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBuZXdSb290ID0gaW5kZXgubm9kZXNbb3JpZ2luYWxSb290LmxlZnRdOw0KICAgICAgICAgICAgbmV3Um9vdC5wYXJlbnQgPSBvcmlnaW5hbFJvb3QucGFyZW50Ow0KDQogICAgICAgICAgICAvLyBOdWxsIG91dCB0aGUgb3JpZ2luYWxSb290LmxlZnQNCiAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5sZWZ0ID0gMHgwOw0KDQogICAgICAgICAgICBpZiAob3JpZ2luYWxSb290LnBhcmVudCAhPSAweDApIHsNCiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbm9kZSBoYXMgYSBwYXJlbnQsIHVwZGF0ZSB0aGUgY29ycmVjdCBjaGlsZCB0byBwb2ludA0KICAgICAgICAgICAgICAgIC8vIGF0IHRoZSBuZXdSb290IG5vdy4NCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcGFyZW50ID0gaW5kZXgubm9kZXNbb3JpZ2luYWxSb290LnBhcmVudF07DQoNCiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gb3JpZ2luYWxSb290LmlkKSB7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudC5sZWZ0ID0gbmV3Um9vdC5pZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBvcmlnaW5hbFJvb3QuaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJpZ2h0ID0gbmV3Um9vdC5pZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChuZXdSb290LnJpZ2h0ICE9IDB4MCkgew0KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSByaWdodENoaWxkID0gaW5kZXgubm9kZXNbbmV3Um9vdC5yaWdodF07DQogICAgICAgICAgICAgICAgb3JpZ2luYWxSb290LmxlZnQgPSBuZXdSb290LnJpZ2h0Ow0KICAgICAgICAgICAgICAgIHJpZ2h0Q2hpbGQucGFyZW50ID0gb3JpZ2luYWxSb290LmlkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBVcGRhdGUgdGhlIG5ldyByb290J3MgcmlnaHQgbm9kZSB0byBwb2ludCB0byB0aGUgb3JpZ2luYWwgbm9kZS4NCiAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5wYXJlbnQgPSBuZXdSb290LmlkOw0KICAgICAgICAgICAgbmV3Um9vdC5yaWdodCA9IG9yaWdpbmFsUm9vdC5pZDsNCg0KICAgICAgICAgICAgaWYgKG5ld1Jvb3QucGFyZW50ID09IDB4MCkgew0KICAgICAgICAgICAgICAgIGluZGV4LnJvb3QgPSBuZXdSb290LmlkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBSZWNvbXB1dGUgaGVpZ2h0cy4NCiAgICAgICAgICAgIF91cGRhdGVOb2RlSGVpZ2h0KGluZGV4LCBvcmlnaW5hbFJvb3QuaWQpOw0KICAgICAgICAgICAgX3VwZGF0ZU5vZGVIZWlnaHQoaW5kZXgsIG5ld1Jvb3QuaWQpOw0KICAgICAgICB9DQp9'