base 64 content
base64iCO2
	^'cHJhZ21hIHNvbGlkaXR5ID49MC40LjQ7DQoNCmNvbnRyYWN0IFNhbGUgew0KICAgIHVpbnQgcHVibGljIHN0YXJ0VGltZTsNCiAgICB1aW50IHB1YmxpYyBzdG9wVGltZTsNCiAgICB1aW50IHB1YmxpYyB0YXJnZXQ7DQogICAgdWludCBwdWJsaWMgcmFpc2VkOw0KICAgIHVpbnQgcHVibGljIGNvbGxlY3RlZDsNCiAgICB1aW50IHB1YmxpYyBudW1Db250cmlidXRvcnM7DQogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBiYWxhbmNlczsNCg0KICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIF9hLCB1aW50IF9ldGgsIHVpbnQgX3RpbWUpIHJldHVybnMgKHVpbnQpOyANCiAgICBmdW5jdGlvbiBnZXRUb2tlbnMoYWRkcmVzcyBob2xkZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOyANCiAgICBmdW5jdGlvbiBnZXRSZWZ1bmQoYWRkcmVzcyBob2xkZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOyANCiAgICBmdW5jdGlvbiBnZXRTb2xkVG9rZW5zKCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7IA0KICAgIGZ1bmN0aW9uIGdldE93bmVyRXRoKCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7IA0KICAgIGZ1bmN0aW9uIHRva2Vuc1BlckV0aCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICAgIGZ1bmN0aW9uIGlzQWN0aXZlKHVpbnQgdGltZSkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7IA0KICAgIGZ1bmN0aW9uIGlzQ29tcGxldGUodWludCB0aW1lKSBjb25zdGFudCByZXR1cm5zIChib29sKTsgDQp9DQoNCmNvbnRyYWN0IENvbnN0YW50cyB7DQogICAgdWludCBERUNJTUFMUyA9IDg7DQp9DQoNCmNvbnRyYWN0IEV2ZW50RGVmaW5pdGlvbnMgew0KICAgIGV2ZW50IGxvZ1NhbGVTdGFydCh1aW50IHN0YXJ0VGltZSwgdWludCBzdG9wVGltZSk7DQogICAgZXZlbnQgbG9nUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgdWludCBldGgpOw0KICAgIGV2ZW50IGxvZ0NsYWltKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIHVpbnQgcmVmdW5kLCB1aW50IHRva2Vucyk7DQoNCiAgICAvL1Rva2VuIHN0YW5kYXJkIGV2ZW50cw0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfSANCg0KY29udHJhY3QgVGVzdGFibGUgew0KICAgIHVpbnQgZmFrZVRpbWU7DQogICAgYm9vbCBwdWJsaWMgdGVzdGluZzsNCiAgICBtb2RpZmllciBvbmx5VGVzdGluZygpIHsNCiAgICAgICAgaWYgKCF0ZXN0aW5nKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQogICAgZnVuY3Rpb24gc2V0RmFrZVRpbWUodWludCB0KSBvbmx5VGVzdGluZyB7DQogICAgICAgIGZha2VUaW1lID0gdDsNCiAgICB9DQogICAgZnVuY3Rpb24gYWRkTWludXRlcyh1aW50IG0pIG9ubHlUZXN0aW5nIHsNCiAgICAgICAgZmFrZVRpbWUgPSBmYWtlVGltZSArIChtICogMSBtaW51dGVzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gYWRkRGF5cyh1aW50IGQpIG9ubHlUZXN0aW5nIHsNCiAgICAgICAgZmFrZVRpbWUgPSBmYWtlVGltZSArIChkICogMSBkYXlzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gY3VyclRpbWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIGlmICh0ZXN0aW5nKSB7DQogICAgICAgICAgICByZXR1cm4gZmFrZVRpbWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gYmxvY2sudGltZXN0YW1wOw0KICAgICAgICB9DQogICAgfQ0KICAgIGZ1bmN0aW9uIHdlaVBlckV0aCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgaWYgKHRlc3RpbmcpIHsNCiAgICAgICAgICAgIHJldHVybiAyMDA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gMTAqKjE4Ow0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpjb250cmFjdCBPd25lZCB7DQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQogICAgDQogICAgbW9kaWZpZXIgb25seU93bmVyKCkgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgYWRkcmVzcyBuZXdPd25lcjsNCg0KICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX25ld093bmVyKSBvbmx5T3duZXIgew0KICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyID09IG5ld093bmVyKSB7DQogICAgICAgICAgICBvd25lciA9IG5ld093bmVyOw0KICAgICAgICB9DQogICAgfSAgICANCn0NCg0KLy9mcm9tIFplcHBlbGluDQpjb250cmFjdCBTYWZlTWF0aCB7DQogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICB1aW50IGMgPSBhICogYjsNCiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICAgICAgcmV0dXJuIGM7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICBhc3NlcnQoYiA8PSBhKTsNCiAgICAgICAgcmV0dXJuIGEgLSBiOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdWludCBjID0gYSArIGI7DQogICAgICAgIGFzc2VydChjPj1hICYmIGM+PWIpOw0KICAgICAgICByZXR1cm4gYzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsNCiAgICAgICAgaWYgKCFhc3NlcnRpb24pIHRocm93Ow0KICAgIH0NCn0NCg0KY29udHJhY3QgVG9rZW4gaXMgU2FmZU1hdGgsIE93bmVkLCBDb25zdGFudHMgew0KICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KDQogICAgYWRkcmVzcyBpY287DQogICAgYWRkcmVzcyBjb250cm9sbGVyOw0KDQogICAgc3RyaW5nIHB1YmxpYyBuYW1lOw0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgDQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICANCg0KICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVycygpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gaWNvICYmDQogICAgICAgICAgICBtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IG51bXdvcmRzKSB7DQogICAgICAgIGFzc2VydChtc2cuZGF0YS5sZW5ndGggPT0gbnVtd29yZHMgKiAzMiArIDQpOw0KICAgICAgICBfOw0KICAgIH0gDQoNCiAgICBmdW5jdGlvbiBUb2tlbigpIHsgDQogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgICAgICAgbmFtZSA9ICJNb25vbGl0aCBUS04iOw0KICAgICAgICBkZWNpbWFscyA9IHVpbnQ4KERFQ0lNQUxTKTsNCiAgICAgICAgc3ltYm9sID0gIlRLTiI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0SUNPKGFkZHJlc3MgX2ljbykgb25seU93bmVyIHsNCiAgICAgICAgaWYgKGljbyAhPSAwKSB0aHJvdzsNCiAgICAgICAgaWNvID0gX2ljbzsNCiAgICB9DQogICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlcihhZGRyZXNzIF9jb250cm9sbGVyKSBvbmx5T3duZXIgew0KICAgICAgICBpZiAoY29udHJvbGxlciAhPSAwKSB0aHJvdzsNCiAgICAgICAgY29udHJvbGxlciA9IF9jb250cm9sbGVyOw0KICAgIH0NCiAgICANCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsNCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsNCiAgICBldmVudCBNaW50KGFkZHJlc3Mgb3duZXIsIHVpbnQgYW1vdW50KTsNCg0KICAgIC8vb25seSBjYWxsZWQgZnJvbSBjb250cmFjdHMgc28gZG9uJ3QgbmVlZCBtc2cuZGF0YS5sZW5ndGggY2hlY2sNCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgYWRkciwgdWludCBhbW91bnQpIG9ubHlDb250cm9sbGVycyB7DQogICAgICAgIGlmIChtYXhTdXBwbHkgPiAwICYmIHNhZmVBZGQodG90YWxTdXBwbHksIGFtb3VudCkgPiBtYXhTdXBwbHkpIHRocm93Ow0KICAgICAgICBiYWxhbmNlT2ZbYWRkcl0gPSBzYWZlQWRkKGJhbGFuY2VPZlthZGRyXSwgYW1vdW50KTsNCiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBhbW91bnQpOw0KICAgICAgICBNaW50KGFkZHIsIGFtb3VudCk7DQogICAgfQ0KDQogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBiYWxhbmNlT2Y7DQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBwdWJsaWMgYWxsb3dhbmNlOw0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSANCiAgICBvbmx5UGF5bG9hZFNpemUoMikNCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKGJhbGFuY2VPZlttc2cuc2VuZGVyXSA8IF92YWx1ZSkgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSA9IGJhbGFuY2VPZlttc2cuc2VuZGVyXSAtIF92YWx1ZTsNCiAgICAgICAgYmFsYW5jZU9mW190b10gPSBzYWZlQWRkKGJhbGFuY2VPZltfdG9dLCBfdmFsdWUpOw0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIA0KICAgIG9ubHlQYXlsb2FkU2l6ZSgzKQ0KICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoYmFsYW5jZU9mW19mcm9tXSA8IF92YWx1ZSkgcmV0dXJuIGZhbHNlOyANCg0KICAgICAgICB2YXIgYWxsb3dlZCA9IGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl07DQogICAgICAgIGlmIChhbGxvd2VkIDwgX3ZhbHVlKSByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAgYmFsYW5jZU9mW190b10gPSBzYWZlQWRkKGJhbGFuY2VPZltfdG9dLCBfdmFsdWUpOw0KICAgICAgICBiYWxhbmNlT2ZbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlT2ZbX2Zyb21dLCBfdmFsdWUpOw0KICAgICAgICBhbGxvd2FuY2VbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihhbGxvd2VkLCBfdmFsdWUpOw0KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSANCiAgICBvbmx5UGF5bG9hZFNpemUoMikNCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgLy9yZXF1aXJlIHVzZXIgdG8gc2V0IHRvIHplcm8gYmVmb3JlIHJlc2V0dGluZyB0byBub256ZXJvDQogICAgICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2FuY2VbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIA0KICAgIG9ubHlQYXlsb2FkU2l6ZSgyKQ0KICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXTsNCiAgICAgICAgYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IHNhZmVBZGQob2xkVmFsdWUsIF9hZGRlZFZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSANCiAgICBvbmx5UGF5bG9hZFNpemUoMikNCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93YW5jZVttc2cuc2VuZGVyXVtfc3BlbmRlcl07DQogICAgICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsNCiAgICAgICAgICAgIGFsbG93YW5jZVttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IHNhZmVTdWIob2xkVmFsdWUsIF9zdWJ0cmFjdGVkVmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vSG9sZHMgYWNjdW11bGF0ZWQgZGl2aWRlbmQgdG9rZW5zIG90aGVyIHRoYW4gVEtODQogICAgVG9rZW5Ib2xkZXIgdG9rZW5ob2xkZXI7DQoNCiAgICAvL29uY2UgbG9ja2VkLCBjYW4gbm8gbG9uZ2VyIHVwZ3JhZGUgdG9rZW5ob2xkZXINCiAgICBib29sIGxvY2tlZFRva2VuSG9sZGVyOw0KDQogICAgZnVuY3Rpb24gbG9ja1Rva2VuSG9sZGVyKCkgb25seU93bmVyIHsNCiAgICAgICAgbG9ja2VkVG9rZW5Ib2xkZXIgPSB0cnVlOw0KICAgIH0NCg0KICAgIC8vd2hpbGUgdW5sb2NrZWQsIA0KICAgIC8vdGhpcyBnaXZlcyBvd25lciBsb3RzIG9mIHBvd2VyIG92ZXIgaGVsZCBkaXZpZGVuZCB0b2tlbnMNCiAgICAvL2VmZmVjdGl2ZWx5IGNhbiBkZW55IGFjY2VzcyB0byBhbGwgYWNjdW11bGF0ZWQgdG9rZW5zDQogICAgLy90aHVzIGNyYXNoaW5nIFRLTiB2YWx1ZQ0KICAgIGZ1bmN0aW9uIHNldFRva2VuSG9sZGVyKGFkZHJlc3MgX3RoKSBvbmx5T3duZXIgew0KICAgICAgICBpZiAobG9ja2VkVG9rZW5Ib2xkZXIpIHRocm93Ow0KICAgICAgICB0b2tlbmhvbGRlciA9IFRva2VuSG9sZGVyKF90aCk7DQogICAgfQ0KDQogICAgZXZlbnQgQnVybihhZGRyZXNzIGJ1cm5lciwgdWludCBhbW91bnQpOw0KDQogICAgZnVuY3Rpb24gYnVybih1aW50IF9hbW91bnQpIHJldHVybnMgKGJvb2wgcmVzdWx0KSB7DQogICAgICAgIGlmIChfYW1vdW50ID4gYmFsYW5jZU9mW21zZy5zZW5kZXJdKSByZXR1cm4gZmFsc2U7DQogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZU9mW21zZy5zZW5kZXJdLCBfYW1vdW50KTsNCiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCBfYW1vdW50KTsNCiAgICAgICAgcmVzdWx0ID0gdG9rZW5ob2xkZXIuYnVybihtc2cuc2VuZGVyLCBfYW1vdW50KTsNCiAgICAgICAgaWYgKCFyZXN1bHQpIHRocm93Ow0KICAgICAgICBCdXJuKG1zZy5zZW5kZXIsIF9hbW91bnQpOw0KICAgIH0NCg0KICAgIHVpbnQgcHVibGljIG1heFN1cHBseTsNCg0KICAgIGZ1bmN0aW9uIHNldE1heFN1cHBseSh1aW50IF9tYXhTdXBwbHkpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgdGhyb3c7DQogICAgICAgIGlmIChtYXhTdXBwbHkgPiAwKSB0aHJvdzsNCiAgICAgICAgbWF4U3VwcGx5ID0gX21heFN1cHBseTsNCiAgICB9DQp9DQoNCmNvbnRyYWN0IFRva2VuSG9sZGVyIHsNCiAgICBmdW5jdGlvbiBidXJuKGFkZHJlc3MgX2J1cm5lciwgdWludCBfYW1vdW50KQ0KICAgIHJldHVybnMgKGJvb2wgcmVzdWx0KSB7IA0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KfQ0KDQoNCmNvbnRyYWN0IElDTyBpcyBFdmVudERlZmluaXRpb25zLCBUZXN0YWJsZSwgU2FmZU1hdGgsIE93bmVkIHsNCiAgICBUb2tlbiBwdWJsaWMgdG9rZW47DQogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsNCiAgICBhZGRyZXNzIHB1YmxpYyBwYXllZTsNCg0KICAgIFNhbGVbXSBwdWJsaWMgc2FsZXM7DQogICAgDQogICAgLy9zYWxlbnVtID0+IG1pbmltdW0gd2VpDQogICAgbWFwcGluZyAodWludCA9PiB1aW50KSBzYWxlTWluaW11bVB1cmNoYXNlczsNCg0KICAgIC8vbmV4dCBzYWxlIG51bWJlciB1c2VyIGNhbiBjbGFpbSBmcm9tDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgbmV4dENsYWltOw0KDQogICAgLy9uZXQgY29udHJpYnV0ZWQgRVRIIGJ5IGVhY2ggdXNlciAoaW4gY2FzZSBvZiBzdG9wL3JlZnVuZCkNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHJlZnVuZEluU3RvcDsNCg0KICAgIG1vZGlmaWVyIHRva2VuSXNTZXQoKSB7DQogICAgICAgIGlmIChhZGRyZXNzKHRva2VuKSA9PSAwKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlcigpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyhjb250cm9sbGVyKSkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gSUNPKCkgeyANCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgICAgICBwYXllZSA9IG1zZy5zZW5kZXI7DQogICAgICAgIGFsbFN0b3BwZXIgPSBtc2cuc2VuZGVyOw0KICAgIH0NCg0KICAgIC8vcGF5ZWUgY2FuIG9ubHkgYmUgY2hhbmdlZCBvbmNlDQogICAgLy9pbnRlbnQgaXMgdG8gbG9jayBwYXllZSB0byBhIGNvbnRyYWN0IHRoYXQgaG9sZHMgb3IgZGlzdHJpYnV0ZXMgZnVuZHMNCiAgICAvL2luIGRlcGxveW1lbnQsIGJlIHN1cmUgdG8gZG8gdGhpcyBiZWZvcmUgY2hhbmdpbmcgb3duZXIhDQogICAgLy93ZSBpbml0aWFsaXplIHRvIG93bmVyIHRvIGtlZXAgdGhpbmdzIHNpbXBsZSBpZiB0aGVyZSdzIG5vIHBheWVlIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gY2hhbmdlUGF5ZWUoYWRkcmVzcyBuZXdQYXllZSkgDQogICAgb25seU93bmVyIG5vdEFsbFN0b3BwZWQgew0KICAgICAgICBwYXllZSA9IG5ld1BheWVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldFRva2VuKGFkZHJlc3MgX3Rva2VuKSBvbmx5T3duZXIgew0KICAgICAgICBpZiAoYWRkcmVzcyh0b2tlbikgIT0gMHgwKSB0aHJvdzsNCiAgICAgICAgdG9rZW4gPSBUb2tlbihfdG9rZW4pOw0KICAgIH0NCg0KICAgIC8vYmVmb3JlIGFkZGluZyBzYWxlcywgd2UgY2FuIHNldCB0aGlzIHRvIGJlIGEgdGVzdCBpY28NCiAgICAvL3RoaXMgbGV0cyB1cyBtYW5pcHVsYXRlIHRpbWUgYW5kIGRyYXN0aWNhbGx5IGxvd2VycyB3ZWlQZXJFdGgNCiAgICBmdW5jdGlvbiBzZXRBc1Rlc3QoKSBvbmx5T3duZXIgew0KICAgICAgICBpZiAoc2FsZXMubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgIHRlc3RpbmcgPSB0cnVlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlcihhZGRyZXNzIF9jb250cm9sbGVyKSANCiAgICBvbmx5T3duZXIgbm90QWxsU3RvcHBlZCB7DQogICAgICAgIGlmIChhZGRyZXNzKGNvbnRyb2xsZXIpICE9IDB4MCkgdGhyb3c7DQogICAgICAgIGNvbnRyb2xsZXIgPSBfY29udHJvbGxlcjsgLy9JQ09Db250cm9sbGVyKF9jb250cm9sbGVyKTsNCiAgICB9DQoNCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy9TYWxlcw0KICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KICAgIGZ1bmN0aW9uIGFkZFNhbGUoYWRkcmVzcyBzYWxlLCB1aW50IG1pbmltdW1QdXJjaGFzZSkgDQogICAgb25seUNvbnRyb2xsZXIgbm90QWxsU3RvcHBlZCB7DQogICAgICAgIHVpbnQgc2FsZW51bSA9IHNhbGVzLmxlbmd0aDsNCiAgICAgICAgc2FsZXMucHVzaChTYWxlKHNhbGUpKTsNCiAgICAgICAgc2FsZU1pbmltdW1QdXJjaGFzZXNbc2FsZW51bV0gPSBtaW5pbXVtUHVyY2hhc2U7DQogICAgICAgIGxvZ1NhbGVTdGFydChTYWxlKHNhbGUpLnN0YXJ0VGltZSgpLCBTYWxlKHNhbGUpLnN0b3BUaW1lKCkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFkZFNhbGUoYWRkcmVzcyBzYWxlKSBvbmx5Q29udHJvbGxlciB7DQogICAgICAgIGFkZFNhbGUoc2FsZSwgMCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0Q3VyclNhbGUoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIGlmIChzYWxlcy5sZW5ndGggPT0gMCkgdGhyb3c7IC8vbm8gcmVhc29uIHRvIGNhbGwgYmVmb3JlIHN0YXJ0Rmlyc3RTYWxlDQogICAgICAgIHJldHVybiBzYWxlcy5sZW5ndGggLSAxOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGN1cnJTYWxlQWN0aXZlKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gc2FsZXNbZ2V0Q3VyclNhbGUoKV0uaXNBY3RpdmUoY3VyclRpbWUoKSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY3VyclNhbGVDb21wbGV0ZSgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIHNhbGVzW2dldEN1cnJTYWxlKCldLmlzQ29tcGxldGUoY3VyclRpbWUoKSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbnVtU2FsZXMoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBzYWxlcy5sZW5ndGg7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbnVtQ29udHJpYnV0b3JzKHVpbnQgc2FsZW51bSkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gc2FsZXNbc2FsZW51bV0ubnVtQ29udHJpYnV0b3JzKCk7DQogICAgfQ0KDQogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vRVRIIFB1cmNoYXNlcw0KICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KICAgIGV2ZW50IGxvZ1B1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIHVpbnQgdmFsdWUpOw0KDQogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7DQogICAgICAgIGRlcG9zaXQoKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBkZXBvc2l0KCkgcGF5YWJsZSBub3RBbGxTdG9wcGVkIHsNCiAgICAgICAgZG9EZXBvc2l0KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7DQoNCiAgICAgICAgLy9ub3QgaW4gZG9EZXBvc2l0IGJlY2F1c2Ugb25seSBmb3IgRXRoOg0KICAgICAgICB1aW50IGNvbnRyaWIgPSByZWZ1bmRJblN0b3BbbXNnLnNlbmRlcl07DQogICAgICAgIHJlZnVuZEluU3RvcFttc2cuc2VuZGVyXSA9IGNvbnRyaWIgKyBtc2cudmFsdWU7DQoNCiAgICAgICAgbG9nUHVyY2hhc2UobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsNCiAgICB9DQoNCiAgICAvL2lzIGFsc28gY2FsbGVkIGJ5IHRva2VuIGNvbnRyaWJ1dGlvbnMNCiAgICBmdW5jdGlvbiBkb0RlcG9zaXQoYWRkcmVzcyBfZm9yLCB1aW50IF92YWx1ZSkgcHJpdmF0ZSB7DQogICAgICAgIHVpbnQgY3VyclNhbGUgPSBnZXRDdXJyU2FsZSgpOw0KICAgICAgICBpZiAoIWN1cnJTYWxlQWN0aXZlKCkpIHRocm93Ow0KICAgICAgICBpZiAoX3ZhbHVlIDwgc2FsZU1pbmltdW1QdXJjaGFzZXNbY3VyclNhbGVdKSB0aHJvdzsNCg0KICAgICAgICB1aW50IHRva2Vuc1RvTWludE5vdyA9IHNhbGVzW2N1cnJTYWxlXS5idXlUb2tlbnMoX2ZvciwgX3ZhbHVlLCBjdXJyVGltZSgpKTsNCg0KICAgICAgICBpZiAodG9rZW5zVG9NaW50Tm93ID4gMCkgew0KICAgICAgICAgICAgdG9rZW4ubWludChfZm9yLCB0b2tlbnNUb01pbnROb3cpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vVG9rZW4gUHVyY2hhc2VzDQogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy9TdXBwb3J0IGZvciBwdXJjaGFzZSB2aWEgb3RoZXIgdG9rZW5zDQogICAgLy9XZSBkb24ndCBhdHRlbXB0IHRvIGRlYWwgd2l0aCB0aG9zZSB0b2tlbnMgZGlyZWN0bHkNCiAgICAvL1dlIGp1c3QgZ2l2ZSBhZG1pbiBhYmlsaXR5IHRvIHRlbGwgdXMgd2hhdCBkZXBvc2l0IHRvIGNyZWRpdA0KICAgIC8vV2Ugb25seSBhbGxvdyBmb3IgZmlyc3Qgc2FsZSANCiAgICAvL2JlY2F1c2UgZmlyc3Qgc2FsZSBub3JtYWxseSBoYXMgbm8gcmVmdW5kcw0KICAgIC8vQXMgd3JpdHRlbiwgdGhlIHJlZnVuZCB3b3VsZCBiZSBpbiBFVEgNCg0KICAgIGV2ZW50IGxvZ1B1cmNoYXNlVmlhVG9rZW4oDQogICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgdG9rZW4sIA0KICAgICAgICAgICAgICAgICAgICAgICAgdWludCBkZXBvc2l0ZWRUb2tlbnMsIHVpbnQgZXRoVmFsdWUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiBfcmVmZXJlbmNlKTsNCg0KICAgIGV2ZW50IGxvZ1B1cmNoYXNlVmlhRmlhdCgNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIHVpbnQgZXRoVmFsdWUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiBfcmVmZXJlbmNlKTsNCg0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYm9vbCkgcHVibGljIG1pbnRSZWZzOw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIHJhaXNlZEZyb21Ub2tlbjsNCiAgICB1aW50IHB1YmxpYyByYWlzZWRGcm9tRmlhdDsNCg0KICAgIGZ1bmN0aW9uIGRlcG9zaXRGaWF0KGFkZHJlc3MgX2ZvciwgdWludCBfZXRoVmFsdWUsIGJ5dGVzMzIgX3JlZmVyZW5jZSkgDQogICAgbm90QWxsU3RvcHBlZCBvbmx5T3duZXIgew0KICAgICAgICBpZiAoZ2V0Q3VyclNhbGUoKSA+IDApIHRocm93OyAvL29ubHkgZmlyc3Qgc2FsZSBhbGxvd3MgdGhpcw0KICAgICAgICBpZiAobWludFJlZnNbX3JlZmVyZW5jZV0pIHRocm93OyAvL2FscmVhZHkgbWludGVkIGZvciB0aGlzIHJlZmVyZW5jZQ0KICAgICAgICBtaW50UmVmc1tfcmVmZXJlbmNlXSA9IHRydWU7DQogICAgICAgIHJhaXNlZEZyb21GaWF0ID0gc2FmZUFkZChyYWlzZWRGcm9tRmlhdCwgX2V0aFZhbHVlKTsNCg0KICAgICAgICBkb0RlcG9zaXQoX2ZvciwgX2V0aFZhbHVlKTsNCiAgICAgICAgbG9nUHVyY2hhc2VWaWFGaWF0KF9mb3IsIF9ldGhWYWx1ZSwgX3JlZmVyZW5jZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGVwb3NpdFRva2VucyhhZGRyZXNzIF9mb3IsIGFkZHJlc3MgX3Rva2VuLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX2V0aFZhbHVlLCB1aW50IF9kZXBvc2l0ZWRUb2tlbnMsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiBfcmVmZXJlbmNlKSANCiAgICBub3RBbGxTdG9wcGVkIG9ubHlPd25lciB7DQogICAgICAgIGlmIChnZXRDdXJyU2FsZSgpID4gMCkgdGhyb3c7IC8vb25seSBmaXJzdCBzYWxlIGFsbG93cyB0aGlzDQogICAgICAgIGlmIChtaW50UmVmc1tfcmVmZXJlbmNlXSkgdGhyb3c7IC8vYWxyZWFkeSBtaW50ZWQgZm9yIHRoaXMgcmVmZXJlbmNlDQogICAgICAgIG1pbnRSZWZzW19yZWZlcmVuY2VdID0gdHJ1ZTsNCiAgICAgICAgcmFpc2VkRnJvbVRva2VuW190b2tlbl0gPSBzYWZlQWRkKHJhaXNlZEZyb21Ub2tlbltfdG9rZW5dLCBfZXRoVmFsdWUpOw0KDQogICAgICAgIC8vdG9rZW5zIGRvIG5vdCBjb3VudCB0b3dhcmQgcHJpY2UgY2hhbmdlcyBhbmQgbGltaXRzDQogICAgICAgIC8vd2UgaGF2ZSB0byBsb29rIHVwIHByaWNpbmcsIGFuZCBkbyBvdXIgb3duIG1pbnQoKQ0KICAgICAgICB1aW50IHRva2Vuc1BlckV0aCA9IHNhbGVzWzBdLnRva2Vuc1BlckV0aCgpOw0KICAgICAgICB1aW50IHRrbiA9IHNhZmVNdWwoX2V0aFZhbHVlLCB0b2tlbnNQZXJFdGgpIC8gd2VpUGVyRXRoKCk7DQogICAgICAgIHRva2VuLm1pbnQoX2ZvciwgdGtuKTsNCiAgICAgICAgDQogICAgICAgIGxvZ1B1cmNoYXNlVmlhVG9rZW4oX2ZvciwgX3Rva2VuLCBfZGVwb3NpdGVkVG9rZW5zLCBfZXRoVmFsdWUsIF9yZWZlcmVuY2UpOw0KICAgIH0NCg0KICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvL1JvdW5kb2ZmIFByb3RlY3Rpb24NCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy9wcm90ZWN0IGFnYWluc3Qgcm91bmRvZmYgaW4gcGF5b3V0cw0KICAgIC8vdGhpcyBwcmV2ZW50cyBsYXN0IHBlcnNvbiBnZXR0aW5nIHJlZnVuZCBmcm9tIG5vdCBiZWluZyBhYmxlIHRvIGNvbGxlY3QNCiAgICBmdW5jdGlvbiBzYWZlYmFsYW5jZSh1aW50IGJhbCkgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7DQogICAgICAgIGlmIChiYWwgPiB0aGlzLmJhbGFuY2UpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmJhbGFuY2U7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gYmFsOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy9JdCdkIGJlIG5pY2VyIGlmIGxhc3QgcGVyc29uIGdvdCBmdWxsIGFtb3VudA0KICAgIC8vaW5zdGVhZCBvZiBnZXR0aW5nIHNob3J0ZWQgYnkgc2FmZWJhbGFuY2UoKQ0KICAgIC8vdG9wVXAoKSBhbGxvd3MgYWRtaW4gdG8gZGVwb3NpdCBleGNlc3MgZXRoZXIgdG8gY292ZXIgaXQNCiAgICAvL2FuZCBsYXRlciBnZXQgYmFjayBhbnkgbGVmdCBvdmVyIA0KDQogICAgdWludCBwdWJsaWMgdG9wVXBBbW91bnQ7DQoNCiAgICBmdW5jdGlvbiB0b3BVcCgpIHBheWFibGUgb25seU93bmVyIG5vdEFsbFN0b3BwZWQgew0KICAgICAgICB0b3BVcEFtb3VudCA9IHNhZmVBZGQodG9wVXBBbW91bnQsIG1zZy52YWx1ZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gd2l0aGRyYXdUb3BVcCgpIG9ubHlPd25lciBub3RBbGxTdG9wcGVkIHsNCiAgICAgICAgdWludCBhbW91bnQgPSB0b3BVcEFtb3VudDsNCiAgICAgICAgdG9wVXBBbW91bnQgPSAwOw0KICAgICAgICBpZiAoIW1zZy5zZW5kZXIuY2FsbC52YWx1ZShzYWZlYmFsYW5jZShhbW91bnQpKSgpKSB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy9DbGFpbXMNCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICAvL0NsYWltIHdoYXRldmVyIHlvdSdyZSBvd2VkLCANCiAgICAvL2Zyb20gd2hhdGV2ZXIgY29tcGxldGVkIHNhbGVzIHlvdSBoYXZlbid0IGFscmVhZHkgY2xhaW1lZA0KICAgIC8vdGhpcyBjb3ZlcnMgcmVmdW5kcywgYW5kIGFueSB0b2tlbnMgbm90IG1pbnRlZCBpbW1lZGlhdGVseQ0KICAgIC8vKGkuZS4gYXVjdGlvbiB0b2tlbnMsIG5vdCBmaXJzdHNhbGUgdG9rZW5zKQ0KICAgIGZ1bmN0aW9uIGNsYWltKCkgbm90QWxsU3RvcHBlZCB7DQogICAgICAgIHZhciAodG9rZW5zLCByZWZ1bmQsIG5jKSA9IGNsYWltYWJsZShtc2cuc2VuZGVyLCB0cnVlKTsNCiAgICAgICAgbmV4dENsYWltW21zZy5zZW5kZXJdID0gbmM7DQogICAgICAgIGxvZ0NsYWltKG1zZy5zZW5kZXIsIHJlZnVuZCwgdG9rZW5zKTsNCiAgICAgICAgaWYgKHRva2VucyA+IDApIHsNCiAgICAgICAgICAgIHRva2VuLm1pbnQobXNnLnNlbmRlciwgdG9rZW5zKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocmVmdW5kID4gMCkgew0KICAgICAgICAgICAgcmVmdW5kSW5TdG9wW21zZy5zZW5kZXJdID0gc2FmZVN1YihyZWZ1bmRJblN0b3BbbXNnLnNlbmRlcl0sIHJlZnVuZCk7DQogICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChzYWZlYmFsYW5jZShyZWZ1bmQpKSkgdGhyb3c7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvL0FsbG93IGFkbWluIHRvIGNsYWltIG9uIGJlaGFsZiBvZiB1c2VyIGFuZCBzZW5kIHRvIGFueSBhZGRyZXNzLg0KICAgIC8vU2NlbmFyaW9zOg0KICAgIC8vICB1c2VyIGxvc3Qga2V5DQogICAgLy8gIHVzZXIgc2VudCBmcm9tIGFuIGV4Y2hhbmdlDQogICAgLy8gIHVzZXIgaGFzIGV4cGVuc2l2ZSBmYWxsYmFjayBmdW5jdGlvbg0KICAgIC8vICB1c2VyIGlzIHVua25vd24sIGZ1bmRzIHByZXN1bWVkIGFiYW5kb25lZA0KICAgIC8vV2Ugb25seSBhbGxvdyB0aGlzIGFmdGVyIG9uZSB5ZWFyIGhhcyBwYXNzZWQuDQogICAgZnVuY3Rpb24gY2xhaW1Gb3IoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIA0KICAgIG9ubHlPd25lciBub3RBbGxTdG9wcGVkIHsNCiAgICAgICAgdmFyICh0b2tlbnMsIHJlZnVuZCwgbmMpID0gY2xhaW1hYmxlKF9mcm9tLCBmYWxzZSk7DQogICAgICAgIG5leHRDbGFpbVtfZnJvbV0gPSBuYzsNCg0KICAgICAgICBsb2dDbGFpbShfZnJvbSwgcmVmdW5kLCB0b2tlbnMpOw0KDQogICAgICAgIGlmICh0b2tlbnMgPiAwKSB7DQogICAgICAgICAgICB0b2tlbi5taW50KF90bywgdG9rZW5zKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocmVmdW5kID4gMCkgew0KICAgICAgICAgICAgcmVmdW5kSW5TdG9wW19mcm9tXSA9IHNhZmVTdWIocmVmdW5kSW5TdG9wW19mcm9tXSwgcmVmdW5kKTsNCiAgICAgICAgICAgIGlmICghX3RvLnNlbmQoc2FmZWJhbGFuY2UocmVmdW5kKSkpIHRocm93Ow0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2xhaW1hYmxlKGFkZHJlc3MgX2EsIGJvb2wgX2luY2x1ZGVSZWNlbnQpIA0KICAgIGNvbnN0YW50IHByaXZhdGUgdG9rZW5Jc1NldCANCiAgICByZXR1cm5zICh1aW50IHRva2VucywgdWludCByZWZ1bmQsIHVpbnQgbmMpIHsNCiAgICAgICAgbmMgPSBuZXh0Q2xhaW1bX2FdOw0KDQogICAgICAgIHdoaWxlIChuYyA8IHNhbGVzLmxlbmd0aCAmJg0KICAgICAgICAgICAgICAgc2FsZXNbbmNdLmlzQ29tcGxldGUoY3VyclRpbWUoKSkgJiYNCiAgICAgICAgICAgICAgICggX2luY2x1ZGVSZWNlbnQgfHwgDQogICAgICAgICAgICAgICAgIHNhbGVzW25jXS5zdG9wVGltZSgpICsgMSB5ZWFycyA8IGN1cnJUaW1lKCkgKSkgDQogICAgICAgIHsNCiAgICAgICAgICAgIHJlZnVuZCA9IHNhZmVBZGQocmVmdW5kLCBzYWxlc1tuY10uZ2V0UmVmdW5kKF9hKSk7DQogICAgICAgICAgICB0b2tlbnMgPSBzYWZlQWRkKHRva2Vucywgc2FsZXNbbmNdLmdldFRva2VucyhfYSkpOw0KICAgICAgICAgICAgbmMgKz0gMTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNsYWltYWJsZVRva2VucyhhZGRyZXNzIGEpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdmFyICh0b2tlbnMsIHJlZnVuZCwgbmMpID0gY2xhaW1hYmxlKGEsIHRydWUpOw0KICAgICAgICByZXR1cm4gdG9rZW5zOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNsYWltYWJsZVJlZnVuZChhZGRyZXNzIGEpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdmFyICh0b2tlbnMsIHJlZnVuZCwgbmMpID0gY2xhaW1hYmxlKGEsIHRydWUpOw0KICAgICAgICByZXR1cm4gcmVmdW5kOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNsYWltYWJsZVRva2VucygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIGNsYWltYWJsZVRva2Vucyhtc2cuc2VuZGVyKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjbGFpbWFibGVSZWZ1bmQoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBjbGFpbWFibGVSZWZ1bmQobXNnLnNlbmRlcik7DQogICAgfQ0KDQogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vV2l0aGRyYXcgRVRIDQogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgbWFwcGluZyAodWludCA9PiBib29sKSBvd25lckNsYWltZWQ7DQoNCiAgICBmdW5jdGlvbiBjbGFpbWFibGVPd25lckV0aCh1aW50IHNhbGVudW0pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdWludCB0aW1lID0gY3VyclRpbWUoKTsNCiAgICAgICAgaWYgKCFzYWxlc1tzYWxlbnVtXS5pc0NvbXBsZXRlKHRpbWUpKSByZXR1cm4gMDsNCiAgICAgICAgcmV0dXJuIHNhbGVzW3NhbGVudW1dLmdldE93bmVyRXRoKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2xhaW1Pd25lckV0aCh1aW50IHNhbGVudW0pIG9ubHlPd25lciBub3RBbGxTdG9wcGVkIHsNCiAgICAgICAgaWYgKG93bmVyQ2xhaW1lZFtzYWxlbnVtXSkgdGhyb3c7DQoNCiAgICAgICAgdWludCBvd25lcmV0aCA9IGNsYWltYWJsZU93bmVyRXRoKHNhbGVudW0pOw0KICAgICAgICBpZiAob3duZXJldGggPiAwKSB7DQogICAgICAgICAgICBvd25lckNsYWltZWRbc2FsZW51bV0gPSB0cnVlOw0KICAgICAgICAgICAgaWYgKCAhcGF5ZWUuY2FsbC52YWx1ZShzYWZlYmFsYW5jZShvd25lcmV0aCkpKCkgKSB0aHJvdzsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvL1N3ZWVwIHRva2VucyBzZW50IGhlcmUNCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICAvL1N1cHBvcnQgdHJhbnNmZXIgb2YgZXJjMjAgdG9rZW5zIG91dCBvZiB0aGlzIGNvbnRyYWN0J3MgYWRkcmVzcw0KICAgIC8vRXZlbiBpZiB3ZSBkb24ndCBpbnRlbmQgZm9yIHBlb3BsZSB0byBzZW5kIHRoZW0gaGVyZSwgc29tZWJvZHkgd2lsbA0KDQogICAgZXZlbnQgbG9nVG9rZW5UcmFuc2ZlcihhZGRyZXNzIHRva2VuLCBhZGRyZXNzIHRvLCB1aW50IGFtb3VudCk7DQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRva2VucyhhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfdG8pIG9ubHlPd25lciB7DQogICAgICAgIFRva2VuIHRva2VuID0gVG9rZW4oX3Rva2VuKTsNCiAgICAgICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOw0KICAgICAgICB0b2tlbi50cmFuc2ZlcihfdG8sIGJhbGFuY2UpOw0KICAgICAgICBsb2dUb2tlblRyYW5zZmVyKF90b2tlbiwgX3RvLCBiYWxhbmNlKTsNCiAgICB9DQoNCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy9FbWVyZ2VuY3kgU3RvcA0KICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KICAgIGJvb2wgYWxsc3RvcHBlZDsNCiAgICBib29sIHBlcm1hc3RvcHBlZDsNCg0KICAgIC8vYWxsb3cgYWxsU3RvcHBlciB0byBiZSBtb3JlIHNlY3VyZSBhZGRyZXNzIHRoYW4gb3duZXINCiAgICAvL2luIHdoaWNoIGNhc2UgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGxldCBvd25lciBjaGFuZ2UgaXQgYWdhaW4NCiAgICBhZGRyZXNzIGFsbFN0b3BwZXI7DQogICAgZnVuY3Rpb24gc2V0QWxsU3RvcHBlcihhZGRyZXNzIF9hKSBvbmx5T3duZXIgew0KICAgICAgICBpZiAoYWxsU3RvcHBlciAhPSBvd25lcikgcmV0dXJuOw0KICAgICAgICBhbGxTdG9wcGVyID0gX2E7DQogICAgfQ0KICAgIG1vZGlmaWVyIG9ubHlBbGxTdG9wcGVyKCkgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhbGxTdG9wcGVyKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBldmVudCBsb2dBbGxTdG9wKCk7DQogICAgZXZlbnQgbG9nQWxsU3RhcnQoKTsNCg0KICAgIG1vZGlmaWVyIGFsbFN0b3BwZWQoKSB7DQogICAgICAgIGlmICghYWxsc3RvcHBlZCkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgbm90QWxsU3RvcHBlZCgpIHsNCiAgICAgICAgaWYgKGFsbHN0b3BwZWQpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFsbFN0b3AoKSBvbmx5QWxsU3RvcHBlciB7DQogICAgICAgIGFsbHN0b3BwZWQgPSB0cnVlOyAgICANCiAgICAgICAgbG9nQWxsU3RvcCgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFsbFN0YXJ0KCkgb25seUFsbFN0b3BwZXIgew0KICAgICAgICBpZiAoIXBlcm1hc3RvcHBlZCkgew0KICAgICAgICAgICAgYWxsc3RvcHBlZCA9IGZhbHNlOw0KICAgICAgICAgICAgbG9nQWxsU3RhcnQoKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGVtZXJnZW5jeVJlZnVuZChhZGRyZXNzIF9hLCB1aW50IF9hbXQpIA0KICAgIGFsbFN0b3BwZWQgDQogICAgb25seUFsbFN0b3BwZXIgew0KICAgICAgICAvL2lmIHlvdSBzdGFydCBhY3R1YWxseSBjYWxsaW5nIHRoaXMgcmVmdW5kLCB0aGUgZGlzYXN0ZXIgaXMgcmVhbC4NCiAgICAgICAgLy9Eb24ndCBhbGxvdyByZXN0YXJ0LCBzbyB0aGlzIGNhbid0IGJlIGFidXNlZCANCiAgICAgICAgcGVybWFzdG9wcGVkID0gdHJ1ZTsNCg0KICAgICAgICB1aW50IGFtdCA9IF9hbXQ7DQoNCiAgICAgICAgdWludCBldGhiYWwgPSByZWZ1bmRJblN0b3BbX2FdOw0KDQogICAgICAgIC8vY29udmVuaWVudCBkZWZhdWx0IHNvIG93bmVyIGRvZXNuJ3QgaGF2ZSB0byBsb29rIHVwIGJhbGFuY2VzDQogICAgICAgIC8vdGhpcyBpcyBmaW5lIGFzIGxvbmcgYXMgbm8gZnVuZHMgaGF2ZSBiZWVuIHN0b2xlbg0KICAgICAgICBpZiAoYW10ID09IDApIGFtdCA9IGV0aGJhbDsgDQoNCiAgICAgICAgLy9ub2JvZHkgY2FuIGJlIHJlZnVuZGVkIG1vcmUgdGhhbiB0aGV5IGNvbnRyaWJ1dGVkDQogICAgICAgIGlmIChhbXQgPiBldGhiYWwpIGFtdCA9IGV0aGJhbDsNCg0KICAgICAgICAvL3NpbmNlIGV2ZXJ5dGhpbmcgaXMgaGFsdGVkLCBzYWZlciB0byBjYWxsLnZhbHVlDQogICAgICAgIC8vc28gd2UgZG9uJ3QgaGF2ZSB0byB3b3JyeSBhYm91dCBleHBlbnNpdmUgZmFsbGJhY2tzDQogICAgICAgIGlmICggIV9hLmNhbGwudmFsdWUoc2FmZWJhbGFuY2UoYW10KSkoKSApIHRocm93Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJhaXNlZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHNhbGVzW2dldEN1cnJTYWxlKCldLnJhaXNlZCgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRva2Vuc1BlckV0aCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHNhbGVzW2dldEN1cnJTYWxlKCldLnRva2Vuc1BlckV0aCgpOw0KICAgIH0NCn0='