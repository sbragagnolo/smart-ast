base 64 content
base64iDice
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4yOw0KDQovLyA8T1JBQ0xJWkVfQVBJPg0KLyoNCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTA0KQ29weXJpZ2h0IChjKSAyMDE2IE9yYWNsaXplIExURA0KDQoNCg0KUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQ0Kb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwNCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMNCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwNCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcw0KZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoNCg0KDQoNClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCg0KDQoNClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQpPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQpUSEUgU09GVFdBUkUuDQoqLw0KDQovL3BsZWFzZSBpbXBvcnQgb3JhY2xpemVBUElfcHJlMC40LnNvbCB3aGVuIHNvbGlkaXR5IDwgMC40LjANCg0KY29udHJhY3QgT3JhY2xpemVJIHsNCiAgICBhZGRyZXNzIHB1YmxpYyBjYkFkZHJlc3M7DQogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7DQogICAgZnVuY3Rpb24gcXVlcnkyKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMikgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7DQogICAgZnVuY3Rpb24gcXVlcnkyX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeU5fd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcmV0dXJucyAodWludCBfZHNwcmljZSk7DQogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsNCiAgICBmdW5jdGlvbiB1c2VDb3Vwb24oc3RyaW5nIF9jb3Vwb24pOw0KICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpOw0KICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOw0KICAgIGZ1bmN0aW9uIHNldEN1c3RvbUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKTsNCn0NCmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7DQogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOw0KfQ0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7DQogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCo2MCoyNDsNCiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCo2MCoyNCo3Ow0KICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsNCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OT05FID0gMHgwMDsNCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZTdG9yYWdlX0lQRlMgPSAweDAxOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsNCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX3Rlc3RuZXQgPSAyOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7DQoNCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOw0KDQogICAgT3JhY2xpemVJIG9yYWNsaXplOw0KICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsNCiAgICAgICAgaWYoKGFkZHJlc3MoT0FSKT09MCl8fChnZXRDb2RlU2l6ZShhZGRyZXNzKE9BUikpPT0wKSkgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7DQogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOw0KICAgICAgICBfOw0KICAgIH0NCiAgICBtb2RpZmllciBjb3Vwb24oc3RyaW5nIGNvZGUpew0KICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsNCiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsodWludDggbmV0d29ya0lEKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpew0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKT4wKXsgLy9tYWlubmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldA0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKT4wKXsgLy9rb3ZhbiB0ZXN0bmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQ0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKT4wKXsgLy9ldGhlci5jYW1wIGlkZQ0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKT4wKXsgLy9icm93c2VyLXNvbGlkaXR5DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgew0KICAgICAgICBfX2NhbGxiYWNrKG15aWQsIHJlc3VsdCwgbmV3IGJ5dGVzKDApKTsNCiAgICB9DQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOw0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOw0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRQcm9vZihieXRlIHByb29mUCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q29uZmlnKGJ5dGVzMzIgY29uZmlnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDb25maWcoY29uZmlnKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQgX3NpemUpIHsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwYXJzZUFkZHIoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRtcCA9IGJ5dGVzKF9hKTsNCiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7DQogICAgICAgIHVpbnQxNjAgYjE7DQogICAgICAgIHVpbnQxNjAgYjI7DQogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsNCiAgICAgICAgICAgIGlhZGRyICo9IDI1NjsNCiAgICAgICAgICAgIGIxID0gdWludDE2MCh0bXBbaV0pOw0KICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsNCiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpJiYoYjEgPD0gMTAyKSkgYjEgLT0gODc7DQogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpJiYoYjEgPD0gNTcpKSBiMSAtPSA0ODsNCiAgICAgICAgICAgIGlmICgoYjIgPj0gOTcpJiYoYjIgPD0gMTAyKSkgYjIgLT0gODc7DQogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNDgpJiYoYjIgPD0gNTcpKSBiMiAtPSA0ODsNCiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGFkZHJlc3MoaWFkZHIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbXBhcmUoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7DQogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gYS5sZW5ndGg7DQogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykNCiAgICAgICAgICAgIGlmIChhW2ldIDwgYltpXSkNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkNCiAgICAgICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpDQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpDQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gaW5kZXhPZihzdHJpbmcgX2hheXN0YWNrLCBzdHJpbmcgX25lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IG4gPSBieXRlcyhfbmVlZGxlKTsNCiAgICAgICAgaWYoaC5sZW5ndGggPCAxIHx8IG4ubGVuZ3RoIDwgMSB8fCAobi5sZW5ndGggPiBoLmxlbmd0aCkpDQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkNCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgZWxzZQ0KICAgICAgICB7DQogICAgICAgICAgICB1aW50IHN1YmluZGV4ID0gMDsNCiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChoW2ldID09IG5bMF0pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlKHN1YmluZGV4IDwgbi5sZW5ndGggJiYgKGkgKyBzdWJpbmRleCkgPCBoLmxlbmd0aCAmJiBoW2kgKyBzdWJpbmRleF0gPT0gbltzdWJpbmRleF0pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QsIHN0cmluZyBfZSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmMgPSBieXRlcyhfYyk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7DQogICAgICAgIHN0cmluZyBtZW1vcnkgYWJjZGUgPSBuZXcgc3RyaW5nKF9iYS5sZW5ndGggKyBfYmIubGVuZ3RoICsgX2JjLmxlbmd0aCArIF9iZC5sZW5ndGggKyBfYmUubGVuZ3RoKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsNCiAgICAgICAgdWludCBrID0gMDsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2JhLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYVtpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JkLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZFtpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07DQogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsNCiAgICB9DQoNCiAgICAvLyBwYXJzZUludA0KICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOw0KICAgIH0NCg0KICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpDQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOw0KICAgICAgICB1aW50IG1pbnQgPSAwOw0KICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7DQogICAgICAgIGZvciAodWludCBpPTA7IGk8YnJlc3VsdC5sZW5ndGg7IGkrKyl7DQogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1Nykpew0KICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7DQogICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7DQogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsNCiAgICAgICAgcmV0dXJuIG1pbnQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpew0KICAgICAgICBpZiAoaSA9PSAwKSByZXR1cm4gIjAiOw0KICAgICAgICB1aW50IGogPSBpOw0KICAgICAgICB1aW50IGxlbjsNCiAgICAgICAgd2hpbGUgKGogIT0gMCl7DQogICAgICAgICAgICBsZW4rKzsNCiAgICAgICAgICAgIGogLz0gMTA7DQogICAgICAgIH0NCiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsNCiAgICAgICAgdWludCBrID0gbGVuIC0gMTsNCiAgICAgICAgd2hpbGUgKGkgIT0gMCl7DQogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsNCiAgICAgICAgICAgIGkgLz0gMTA7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJhMmNib3Ioc3RyaW5nW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgew0KICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOw0KDQogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgNCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsNCiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7DQogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgew0KICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsNCiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdWludCBjdHIgPSAwOw0KICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsNCiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsNCiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsNCg0KICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7DQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07DQogICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsNCiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7DQogICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQNCiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4Ow0KICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsNCiAgICAgICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsNCiAgICAgICAgICAgICAgICBjdHIrKzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXM7DQogICAgICAgIH0NCn0NCi8vIDwvT1JBQ0xJWkVfQVBJPg0KDQovLyBFdGhlcm9sbCBGdW5jdGlvbnMNCmNvbnRyYWN0IERTU2FmZUFkZFN1YiB7DQogICAgZnVuY3Rpb24gc2FmZVRvQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiAoYSArIGIgPj0gYSk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgaWYgKCFzYWZlVG9BZGQoYSwgYikpIHRocm93Ow0KICAgICAgICByZXR1cm4gYSArIGI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2FmZVRvU3VidHJhY3QodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIChiIDw9IGEpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgaWYgKCFzYWZlVG9TdWJ0cmFjdChhLCBiKSkgdGhyb3c7DQogICAgICAgIHJldHVybiBhIC0gYjsNCiAgICB9DQp9DQoNCmNvbnRyYWN0IElEaWNlIGlzIHVzaW5nT3JhY2xpemUsIERTU2FmZUFkZFN1YiB7DQoNCiAgICAvKg0KICAgICAqIGNoZWNrcyBwbGF5ZXIgcHJvZml0IGFuZCBudW1iZXIgaXMgd2l0aGluIHJhbmdlDQogICAgKi8NCiAgICBtb2RpZmllciBiZXRJc1ZhbGlkKHVpbnQgX2JldFNpemUsIHVpbnQgX3BsYXllck51bWJlcikgew0KICAgICAgICBpZigoKCgoX2JldFNpemUgKiAoMTAwLShzYWZlU3ViKF9wbGF5ZXJOdW1iZXIsMSkpKSkgLyAoc2FmZVN1YihfcGxheWVyTnVtYmVyLDEpKStfYmV0U2l6ZSkpKmhvdXNlRWRnZS9ob3VzZUVkZ2VEaXZpc29yKS1fYmV0U2l6ZSA+IG1heFByb2ZpdCB8fCBfYmV0U2l6ZSA8IG1pbkJldCB8fCBfcGxheWVyTnVtYmVyIDwgbWluTnVtYmVyIHx8IF9wbGF5ZXJOdW1iZXIgPiBtYXhOdW1iZXIpIHRocm93Ow0KCQlfOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogY2hlY2tzIGdhbWUgaXMgY3VycmVudGx5IGFjdGl2ZQ0KICAgICovDQogICAgbW9kaWZpZXIgZ2FtZUlzQWN0aXZlIHsNCiAgICAgICAgaWYoZ2FtZVBhdXNlZCA9PSB0cnVlKSB0aHJvdzsNCgkJXzsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIGNoZWNrcyBwYXlvdXRzIGFyZSBjdXJyZW50bHkgYWN0aXZlDQogICAgKi8NCiAgICBtb2RpZmllciBwYXlvdXRzQXJlQWN0aXZlIHsNCiAgICAgICAgaWYocGF5b3V0c1BhdXNlZCA9PSB0cnVlKSB0aHJvdzsNCgkJXzsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIGNoZWNrcyBvbmx5IE9yYWNsaXplIGFkZHJlc3MgaXMgY2FsbGluZw0KICAgICovDQogICAgbW9kaWZpZXIgb25seU9yYWNsaXplIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3JhY2xpemVfY2JBZGRyZXNzKCkpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogY2hlY2tzIG9ubHkgb3duZXIgYWRkcmVzcyBpcyBjYWxsaW5nDQogICAgKi8NCiAgICBtb2RpZmllciBvbmx5T3duZXIgew0KICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93Ow0KICAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIGNoZWNrcyBvbmx5IHRyZWFzdXJ5IGFkZHJlc3MgaXMgY2FsbGluZw0KICAgICovDQogICAgbW9kaWZpZXIgb25seVRyZWFzdXJ5IHsNCiAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHRyZWFzdXJ5KSB0aHJvdzsNCiAgICAgICAgIF87DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBnYW1lIHZhcnMNCiAgICAqLw0KDQogICAgdWludCBjb25zdGFudCBwdWJsaWMgbWF4QmV0RGl2aXNvciA9IDEwMDAwMDA7DQogICAgdWludCBjb25zdGFudCBwdWJsaWMgaG91c2VFZGdlRGl2aXNvciA9IDEwMDA7DQogICAgdWludCBjb25zdGFudCBwdWJsaWMgbWF4TnVtYmVyID0gOTk7DQogICAgdWludCBjb25zdGFudCBwdWJsaWMgbWluTnVtYmVyID0gMjsNCglib29sIHB1YmxpYyBnYW1lUGF1c2VkOw0KICAgIHVpbnQzMiBwdWJsaWMgZ2FzRm9yT3JhY2xpemU7DQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQogICAgYm9vbCBwdWJsaWMgcGF5b3V0c1BhdXNlZDsNCiAgICBhZGRyZXNzIHB1YmxpYyB0cmVhc3VyeTsNCiAgICB1aW50IHB1YmxpYyBjb250cmFjdEJhbGFuY2U7DQogICAgdWludCBwdWJsaWMgaG91c2VFZGdlOw0KICAgIHVpbnQgcHVibGljIG1heFByb2ZpdDsNCiAgICB1aW50IHB1YmxpYyBtYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlOw0KICAgIHVpbnQgcHVibGljIG1pbkJldDsNCiAgICBpbnQgcHVibGljIHRvdGFsQmV0czsNCiAgICB1aW50IHB1YmxpYyB0b3RhbFVzZXJQcm9maXQ7DQogICAgdWludCBwdWJsaWMgbWF4UGVuZGluZ1BheW91dHM7DQoNCiAgICAvKg0KICAgICAqIHBsYXllciB2YXJzDQogICAgKi8NCiAgICBtYXBwaW5nIChieXRlczMyID0+IGFkZHJlc3MpIHBsYXllckFkZHJlc3M7DQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBhZGRyZXNzKSBwbGF5ZXJUZW1wQWRkcmVzczsNCiAgICBtYXBwaW5nIChieXRlczMyID0+IGJ5dGVzMzIpIHBsYXllckJldElkOw0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyQmV0VmFsdWU7DQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJUZW1wQmV0VmFsdWU7DQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJSYW5kb21SZXN1bHQ7DQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJEaWVSZXN1bHQ7DQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJOdW1iZXI7DQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHM7DQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJQcm9maXQ7DQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJUZW1wUmV3YXJkOw0KDQoNCiAgICAvKg0KICAgICAqIGV2ZW50cw0KICAgICovDQogICAgLyogbG9nIGJldHMgKyBvdXRwdXQgdG8gd2ViMyBmb3IgcHJlY2lzZSAncGF5b3V0IG9uIHdpbicgZmllbGQgaW4gVUkgKi8NCiAgICBldmVudCBMb2dCZXQoYnl0ZXMzMiBpbmRleGVkIEJldElELCBhZGRyZXNzIGluZGV4ZWQgUGxheWVyQWRkcmVzcywgdWludCBpbmRleGVkIFJld2FyZFZhbHVlLCB1aW50IFByb2ZpdFZhbHVlLCB1aW50IEJldFZhbHVlLCB1aW50IFBsYXllck51bWJlcik7DQogICAgLyogb3V0cHV0IHRvIHdlYjMgVUkgb24gYmV0IHJlc3VsdCovDQogICAgLyogU3RhdHVzOiAwPWxvc2UsIDE9d2luLCAyPXdpbiArIGZhaWxlZCBzZW5kLCAzPXJlZnVuZCwgND1yZWZ1bmQgKyBmYWlsZWQgc2VuZCovDQoJZXZlbnQgTG9nUmVzdWx0KGJ5dGVzMzIgaW5kZXhlZCBCZXRJRCwgYWRkcmVzcyBpbmRleGVkIFBsYXllckFkZHJlc3MsIHVpbnQgaW5kZXhlZCBQbGF5ZXJOdW1iZXIsIHVpbnQgRGljZVJlc3VsdCwgdWludCBWYWx1ZSwgaW50IFN0YXR1cywgYnl0ZXMgUHJvb2YpOw0KICAgIC8qIGxvZyBtYW51YWwgcmVmdW5kcyAqLw0KICAgIGV2ZW50IExvZ1JlZnVuZChieXRlczMyIGluZGV4ZWQgQmV0SUQsIGFkZHJlc3MgaW5kZXhlZCBQbGF5ZXJBZGRyZXNzLCB1aW50IGluZGV4ZWQgUmVmdW5kVmFsdWUpOw0KICAgIC8qIGxvZyBvd25lciB0cmFuc2ZlcnMgKi8NCiAgICBldmVudCBMb2dPd25lclRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBTZW50VG9BZGRyZXNzLCB1aW50IGluZGV4ZWQgQW1vdW50VHJhbnNmZXJyZWQpOw0KDQoNCiAgICAvKg0KICAgICAqIGluaXQNCiAgICAqLw0KICAgIGZ1bmN0aW9uIElEaWNlKCkgew0KDQogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgICAgICAgdHJlYXN1cnkgPSBtc2cuc2VuZGVyOw0KDQogICAgICAgIC8vIFRoaXMgc2V0bmV0d29yayBpcyB1bm5jZXNzYXJ5DQogICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOw0KICAgICAgICAvKiB1c2UgVExTTm90YXJ5IGZvciBvcmFjbGl6ZSBjYWxsICovDQoJCW9yYWNsaXplX3NldFByb29mKHByb29mVHlwZV9UTFNOb3RhcnkgfCBwcm9vZlN0b3JhZ2VfSVBGUyk7DQoNCiAgICAgICAgLyogaW5pdCA5OTAgPSA5OSUgKDElIGhvdXNlRWRnZSkqLw0KICAgICAgICBvd25lclNldEhvdXNlRWRnZSg5MzUpOw0KDQogICAgICAgIC8vIDI1LDAwMCA9IDIuNSUgaXMgb3VyIG1heCBwcm9maXQgb2YgdGhlIGhvdXNlDQogICAgICAgIG93bmVyU2V0TWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSgyNTAwMCk7DQogICAgICAgIC8qIGluaXQgbWluIGJldCAoMC4yIGV0aGVyKSAqLw0KDQogICAgICAgIG93bmVyU2V0TWluQmV0KDIwMDAwMDAwMDAwMDAwMDAwMCk7DQogICAgICAgIC8qIGluaXQgZ2FzIGZvciBvcmFjbGl6ZSAqLw0KICAgICAgICBnYXNGb3JPcmFjbGl6ZSA9IDI1MDAwMDsNCg0KICAgIH0NCg0KICAgIC8qDQogICAgICogcHVibGljIGZ1bmN0aW9uDQogICAgICogcGxheWVyIHN1Ym1pdCBiZXQNCiAgICAgKiBvbmx5IGlmIGdhbWUgaXMgYWN0aXZlICYgYmV0IGlzIHZhbGlkIGNhbiBxdWVyeSBvcmFjbGl6ZSBhbmQgc2V0IHBsYXllciB2YXJzDQogICAgKi8NCiAgICBmdW5jdGlvbiBwbGF5ZXJSb2xsRGljZSh1aW50IHJvbGxVbmRlcikgcHVibGljDQogICAgICAgIHBheWFibGUNCiAgICAgICAgZ2FtZUlzQWN0aXZlDQogICAgICAgIGJldElzVmFsaWQobXNnLnZhbHVlLCByb2xsVW5kZXIpDQoJew0KDQogICAgICAgIC8qDQogICAgICAgICogYXNzaWduIHBhcnRpYWxseSBlbmNyeXB0ZWQgcXVlcnkgdG8gb3JhY2xpemUNCiAgICAgICAgKiBvbmx5IHRoZSBhcGlLZXkgaXMgZW5jcnlwdGVkDQogICAgICAgICogaW50ZWdlciBxdWVyeSBpcyBpbiBwbGFpbiB0ZXh0DQogICAgICAgICovDQogICAgICAgIGJ5dGVzMzIgcm5nSWQgPSBvcmFjbGl6ZV9xdWVyeSgibmVzdGVkIiwgIltVUkxdIFsnanNvbihodHRwczovL2FwaS5yYW5kb20ub3JnL2pzb24tcnBjLzEvaW52b2tlKS5yZXN1bHQucmFuZG9tLmRhdGEuMCcsICdcXG57XCJqc29ucnBjXCI6XCIyLjBcIixcIm1ldGhvZFwiOlwiZ2VuZXJhdGVTaWduZWRJbnRlZ2Vyc1wiLFwicGFyYW1zXCI6e1wiYXBpS2V5XCI6JHtbZGVjcnlwdF0gQkRDODE5blRZYkVpQnlyL2l3bmR6TmRTSjlKR0pHUld3T1RuRkxockZjeHRXaDUzSDdzemNxSGFDK1ovNlVLSDZUNk41N1JpUE5tQldHZUZTbXFVUkhVcUNTeU44dm1ValZqOWdFaTdIbUNvUWxMU3B4OFFKVFY5T3hoRmY0M3U4Vm43RHVnWmNneVZjUEVrRXMybFRQMUJYaUFkfSxcIm5cIjoxLFwibWluXCI6MSxcIm1heFwiOjEwMCxcInJlcGxhY2VtZW50XCI6dHJ1ZSxcImJhc2VcIjoxMCR7W2lkZW50aXR5XSBcIn1cIn0sXCJpZFwiOjEke1tpZGVudGl0eV0gXCJ9XCJ9J10iLCBnYXNGb3JPcmFjbGl6ZSk7DQogICAgICAgIC8qIHRvdGFsIG51bWJlciBvZiBiZXRzIChkaXNwbGF5IHB1cnBvc2Ugb25seSkgKi8NCiAgICAgICAgdG90YWxCZXRzICs9IDE7DQogICAgICAgIC8qIG1hcCBiZXQgaWQgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLw0KCQlwbGF5ZXJCZXRJZFtybmdJZF0gPSBybmdJZDsNCiAgICAgICAgLyogbWFwIHBsYXllciBsdWNreSBudW1iZXIgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLw0KCQlwbGF5ZXJOdW1iZXJbcm5nSWRdID0gcm9sbFVuZGVyOw0KICAgICAgICAvKiBtYXAgdmFsdWUgb2Ygd2FnZXIgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLw0KICAgICAgICBwbGF5ZXJCZXRWYWx1ZVtybmdJZF0gPSBtc2cudmFsdWU7DQogICAgICAgIC8qIG1hcCBwbGF5ZXIgYWRkcmVzcyB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovDQogICAgICAgIHBsYXllckFkZHJlc3Nbcm5nSWRdID0gbXNnLnNlbmRlcjsNCiAgICAgICAgLyogc2FmZWx5IG1hcCBwbGF5ZXIgcmV3YXJkIHRvIHRoaXMgb3JhY2xpemUgcXVlcnkgKi8NCiAgICAgICAgcGxheWVyUHJvZml0W3JuZ0lkXSA9ICgoKChtc2cudmFsdWUgKiAoMTAwLShzYWZlU3ViKHJvbGxVbmRlciwxKSkpKSAvIChzYWZlU3ViKHJvbGxVbmRlciwxKSkrbXNnLnZhbHVlKSkqaG91c2VFZGdlL2hvdXNlRWRnZURpdmlzb3IpLW1zZy52YWx1ZTsNCiAgICAgICAgLyogc2FmZWx5IGluY3JlYXNlIG1heFBlbmRpbmdQYXlvdXRzIGxpYWJpbGl0eSAtIGNhbGMgYWxsIHBlbmRpbmcgcGF5b3V0cyB1bmRlciBhc3N1bXB0aW9uIHRoZXkgd2luICovDQogICAgICAgIG1heFBlbmRpbmdQYXlvdXRzID0gc2FmZUFkZChtYXhQZW5kaW5nUGF5b3V0cywgcGxheWVyUHJvZml0W3JuZ0lkXSk7DQogICAgICAgIC8qIGNoZWNrIGNvbnRyYWN0IGNhbiBwYXlvdXQgb24gd2luICovDQogICAgICAgIGlmKG1heFBlbmRpbmdQYXlvdXRzID49IGNvbnRyYWN0QmFsYW5jZSkgdGhyb3c7DQogICAgICAgIC8qIHByb3ZpZGVzIGFjY3VyYXRlIG51bWJlcnMgZm9yIHdlYjMgYW5kIG1hbnVhbCByZWZ1bmRzIGluIGNhc2Ugb2Ygbm8gb3JhY2xpemUgX19jYWxsYmFjayAqLw0KICAgICAgICBMb2dCZXQocGxheWVyQmV0SWRbcm5nSWRdLCBwbGF5ZXJBZGRyZXNzW3JuZ0lkXSwgc2FmZUFkZChwbGF5ZXJCZXRWYWx1ZVtybmdJZF0sIHBsYXllclByb2ZpdFtybmdJZF0pLCBwbGF5ZXJQcm9maXRbcm5nSWRdLCBwbGF5ZXJCZXRWYWx1ZVtybmdJZF0sIHBsYXllck51bWJlcltybmdJZF0pOw0KDQogICAgfQ0KDQoNCiAgICAvKg0KICAgICogc2VtaS1wdWJsaWMgZnVuY3Rpb24gLSBvbmx5IG9yYWNsaXplIGNhbiBjYWxsDQogICAgKi8NCiAgICAvKlRMU05vdGFyeSBmb3Igb3JhY2xpemUgY2FsbCAqLw0KCWZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgcHVibGljDQogICAgLy9mdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgcHVibGljDQoJCW9ubHlPcmFjbGl6ZQ0KCQlwYXlvdXRzQXJlQWN0aXZlDQoJew0KDQogICAgICAgIC8qIHBsYXllciBhZGRyZXNzIG1hcHBlZCB0byBxdWVyeSBpZCBkb2VzIG5vdCBleGlzdCAqLw0KICAgICAgICBpZiAocGxheWVyQWRkcmVzc1tteWlkXT09MHgwKSB0aHJvdzsNCg0KCSAgICAvKiBtYXAgcmVzdWx0IHRvIHBsYXllciAqLw0KICAgICAgICBwbGF5ZXJSYW5kb21SZXN1bHRbbXlpZF0gPSBwYXJzZUludChyZXN1bHQpOw0KDQogICAgICAgIC8qIHByb3ZhYmx5LWZhaXIgcmFuZG9tIGludGVnZXIgZm9yIHBsYXllciBib3VuZGVkIHRvIDEtMTAwIGluY2x1c2l2ZQ0KICAgICAgICAqICBzaGEzIHRoZSByZXN1bHQgZnJvbSByYW5kb20ub3JnIGFuZCBwcm9vZiAoSVBGUyBhZGRyZXNzIG9mIFRMU05vdGFyeSBwcm9vZikNCiAgICAgICAgKi8NCiAgICAgICAgcGxheWVyRGllUmVzdWx0W215aWRdID0gdWludChzaGEzKHBsYXllclJhbmRvbVJlc3VsdFtteWlkXSwgcHJvb2YpKSAlICgxMDAgLSAxKSArIDE7DQoNCiAgICAgICAgLyogZ2V0IHRoZSBwbGF5ZXJBZGRyZXNzIGZvciB0aGlzIHF1ZXJ5IGlkICovDQogICAgICAgIHBsYXllclRlbXBBZGRyZXNzW215aWRdID0gcGxheWVyQWRkcmVzc1tteWlkXTsNCiAgICAgICAgLyogZGVsZXRlIHBsYXllckFkZHJlc3MgZm9yIHRoaXMgcXVlcnkgaWQgKi8NCiAgICAgICAgZGVsZXRlIHBsYXllckFkZHJlc3NbbXlpZF07DQoNCiAgICAgICAgLyogbWFwIHRoZSBwbGF5ZXJQcm9maXQgZm9yIHRoaXMgcXVlcnkgaWQgKi8NCiAgICAgICAgcGxheWVyVGVtcFJld2FyZFtteWlkXSA9IHBsYXllclByb2ZpdFtteWlkXTsNCiAgICAgICAgLyogc2V0ICBwbGF5ZXJQcm9maXQgZm9yIHRoaXMgcXVlcnkgaWQgdG8gMCAqLw0KICAgICAgICBwbGF5ZXJQcm9maXRbbXlpZF0gPSAwOw0KDQogICAgICAgIC8qIHNhZmVseSByZWR1Y2UgbWF4UGVuZGluZ1BheW91dHMgbGlhYmlsaXR5ICovDQogICAgICAgIG1heFBlbmRpbmdQYXlvdXRzID0gc2FmZVN1YihtYXhQZW5kaW5nUGF5b3V0cywgcGxheWVyVGVtcFJld2FyZFtteWlkXSk7DQoNCiAgICAgICAgLyogbWFwIHRoZSBwbGF5ZXJCZXRWYWx1ZSBmb3IgdGhpcyBxdWVyeSBpZCAqLw0KICAgICAgICBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0gPSBwbGF5ZXJCZXRWYWx1ZVtteWlkXTsNCiAgICAgICAgLyogc2V0ICBwbGF5ZXJCZXRWYWx1ZSBmb3IgdGhpcyBxdWVyeSBpZCB0byAwICovDQogICAgICAgIHBsYXllckJldFZhbHVlW215aWRdID0gMDsNCg0KICAgICAgICAvKg0KICAgICAgICAqIHJlZnVuZA0KICAgICAgICAqIGlmIHJlc3VsdCBmcm9tIG9yYWNsaXplIGlzIDAgcmVmdW5kIG9ubHkgdGhlIG9yaWdpbmFsIGJldCB2YWx1ZQ0KICAgICAgICAqIGlmIHJlZnVuZCBmYWlscyBzYXZlIHJlZnVuZCB2YWx1ZSB0byBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHMNCiAgICAgICAgKi8NCiAgICAgICAgaWYocGxheWVyRGllUmVzdWx0W215aWRdPT0wKXsNCg0KICAgICAgICAgICAgIExvZ1Jlc3VsdChwbGF5ZXJCZXRJZFtteWlkXSwgcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0sIHBsYXllck51bWJlcltteWlkXSwgcGxheWVyRGllUmVzdWx0W215aWRdLCBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0sIDMsIHByb29mKTsNCiAgICAgICAgICAgIC8vTG9nUmVzdWx0KHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgMyk7DQoNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICAqIHNlbmQgcmVmdW5kIC0gZXh0ZXJuYWwgY2FsbCB0byBhbiB1bnRydXN0ZWQgY29udHJhY3QNCiAgICAgICAgICAgICogaWYgc2VuZCBmYWlscyBtYXAgcmVmdW5kIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1thZGRyZXNzXQ0KICAgICAgICAgICAgKiBmb3Igd2l0aGRyYXdhbCBsYXRlciB2aWEgcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zDQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgaWYoIXBsYXllclRlbXBBZGRyZXNzW215aWRdLnNlbmQocGxheWVyVGVtcEJldFZhbHVlW215aWRdKSl7DQogICAgICAgICAgICAgICAgTG9nUmVzdWx0KHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgNCwgcHJvb2YpOw0KICAgICAgICAgICAgICAgIC8vTG9nUmVzdWx0KHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgNCk7DQogICAgICAgICAgICAgICAgLyogaWYgc2VuZCBmYWlsZWQgbGV0IHBsYXllciB3aXRoZHJhdyB2aWEgcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zICovDQogICAgICAgICAgICAgICAgcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSA9IHNhZmVBZGQocGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoNCiAgICAgICAgKiBwYXkgd2lubmVyDQogICAgICAgICogdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2UgdG8gY2FsY3VsYXRlIG5ldyBtYXggYmV0DQogICAgICAgICogc2VuZCByZXdhcmQNCiAgICAgICAgKiBpZiBzZW5kIG9mIHJld2FyZCBmYWlscyBzYXZlIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fscw0KICAgICAgICAqLw0KICAgICAgICBpZihwbGF5ZXJEaWVSZXN1bHRbbXlpZF0gPCBwbGF5ZXJOdW1iZXJbbXlpZF0pew0KDQogICAgICAgICAgICAvKiBzYWZlbHkgcmVkdWNlIGNvbnRyYWN0IGJhbGFuY2UgYnkgcGxheWVyIHByb2ZpdCAqLw0KICAgICAgICAgICAgY29udHJhY3RCYWxhbmNlID0gc2FmZVN1Yihjb250cmFjdEJhbGFuY2UsIHBsYXllclRlbXBSZXdhcmRbbXlpZF0pOw0KDQogICAgICAgICAgICAvKiBzYWZlbHkgY2FsY3VsYXRlIHRvdGFsIHBheW91dCBhcyBwbGF5ZXIgcHJvZml0IHBsdXMgb3JpZ2luYWwgd2FnZXIgKi8NCiAgICAgICAgICAgIHBsYXllclRlbXBSZXdhcmRbbXlpZF0gPSBzYWZlQWRkKHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSk7DQoNCiAgICAgICAgICAgIHRvdGFsVXNlclByb2ZpdCA9IHRvdGFsVXNlclByb2ZpdCArIHBsYXllclRlbXBSZXdhcmRbbXlpZF07IC8vIHRvdGFsIHByb2ZpdHMNCg0KICAgICAgICAgICAgTG9nUmVzdWx0KHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIDEsIHByb29mKTsNCiAgICAgICAgICAgIC8vTG9nUmVzdWx0KHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIDEpOw0KDQogICAgICAgICAgICAvKiB1cGRhdGUgbWF4aW11bSBwcm9maXQgKi8NCiAgICAgICAgICAgIHNldE1heFByb2ZpdCgpOw0KDQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgKiBzZW5kIHdpbiAtIGV4dGVybmFsIGNhbGwgdG8gYW4gdW50cnVzdGVkIGNvbnRyYWN0DQogICAgICAgICAgICAqIGlmIHNlbmQgZmFpbHMgbWFwIHJld2FyZCB2YWx1ZSB0byBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbYWRkcmVzc10NCiAgICAgICAgICAgICogZm9yIHdpdGhkcmF3YWwgbGF0ZXIgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucw0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGlmKCFwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXS5zZW5kKHBsYXllclRlbXBSZXdhcmRbbXlpZF0pKXsNCiAgICAgICAgICAgICAgICBMb2dSZXN1bHQocGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcFJld2FyZFtteWlkXSwgMiwgcHJvb2YpOw0KICAgICAgICAgICAgICAgIC8vTG9nUmVzdWx0KHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIDIpOw0KICAgICAgICAgICAgICAgIC8qIGlmIHNlbmQgZmFpbGVkIGxldCBwbGF5ZXIgd2l0aGRyYXcgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucyAqLw0KICAgICAgICAgICAgICAgIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0gPSBzYWZlQWRkKHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvKg0KICAgICAgICAqIG5vIHdpbg0KICAgICAgICAqIHNlbmQgMSB3ZWkgdG8gYSBsb3NpbmcgYmV0DQogICAgICAgICogdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2UgdG8gY2FsY3VsYXRlIG5ldyBtYXggYmV0DQogICAgICAgICovDQogICAgICAgIGlmKHBsYXllckRpZVJlc3VsdFtteWlkXSA+PSBwbGF5ZXJOdW1iZXJbbXlpZF0pew0KDQogICAgICAgICAgICBMb2dSZXN1bHQocGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdLCAwLCBwcm9vZik7DQogICAgICAgICAgICAvL0xvZ1Jlc3VsdChwbGF5ZXJCZXRJZFtteWlkXSwgcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0sIHBsYXllck51bWJlcltteWlkXSwgcGxheWVyRGllUmVzdWx0W215aWRdLCBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0sIDApOw0KDQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgKiAgc2FmZSBhZGp1c3QgY29udHJhY3RCYWxhbmNlDQogICAgICAgICAgICAqICBzZXRNYXhQcm9maXQNCiAgICAgICAgICAgICogIHNlbmQgMSB3ZWkgdG8gbG9zaW5nIGJldA0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGNvbnRyYWN0QmFsYW5jZSA9IHNhZmVBZGQoY29udHJhY3RCYWxhbmNlLCAocGxheWVyVGVtcEJldFZhbHVlW215aWRdLTEpKTsNCg0KICAgICAgICAgICAgLyogdXBkYXRlIG1heGltdW0gcHJvZml0ICovDQogICAgICAgICAgICBzZXRNYXhQcm9maXQoKTsNCg0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICogc2VuZCAxIHdlaSAtIGV4dGVybmFsIGNhbGwgdG8gYW4gdW50cnVzdGVkIGNvbnRyYWN0DQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgaWYoIXBsYXllclRlbXBBZGRyZXNzW215aWRdLnNlbmQoMSkpew0KICAgICAgICAgICAgICAgIC8qIGlmIHNlbmQgZmFpbGVkIGxldCBwbGF5ZXIgd2l0aGRyYXcgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucyAqLw0KICAgICAgICAgICAgICAgcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSA9IHNhZmVBZGQocGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSwgMSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICB9DQoNCiAgICB9DQoNCiAgICAvKg0KICAgICogcHVibGljIGZ1bmN0aW9uDQogICAgKiBpbiBjYXNlIG9mIGEgZmFpbGVkIHJlZnVuZCBvciB3aW4gc2VuZA0KICAgICovDQogICAgZnVuY3Rpb24gcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zKCkgcHVibGljDQogICAgICAgIHBheW91dHNBcmVBY3RpdmUNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICAgew0KICAgICAgICB1aW50IHdpdGhkcmF3QW1vdW50ID0gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdOw0KICAgICAgICBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSAwOw0KICAgICAgICAvKiBleHRlcm5hbCBjYWxsIHRvIHVudHJ1c3RlZCBjb250cmFjdCAqLw0KICAgICAgICBpZiAobXNnLnNlbmRlci5jYWxsLnZhbHVlKHdpdGhkcmF3QW1vdW50KSgpKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8qIGlmIHNlbmQgZmFpbGVkIHJldmVydCBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSAwOyAqLw0KICAgICAgICAgICAgLyogcGxheWVyIGNhbiB0cnkgdG8gd2l0aGRyYXcgYWdhaW4gbGF0ZXIgKi8NCiAgICAgICAgICAgIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXSA9IHdpdGhkcmF3QW1vdW50Ow0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyogY2hlY2sgZm9yIHBlbmRpbmcgd2l0aGRyYXdhbHMgICovDQogICAgZnVuY3Rpb24gcGxheWVyR2V0UGVuZGluZ1R4QnlBZGRyZXNzKGFkZHJlc3MgYWRkcmVzc1RvQ2hlY2spIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbYWRkcmVzc1RvQ2hlY2tdOw0KICAgIH0NCg0KICAgIC8qDQogICAgKiBpbnRlcm5hbCBmdW5jdGlvbg0KICAgICogc2V0cyBtYXggcHJvZml0DQogICAgKi8NCiAgICBmdW5jdGlvbiBzZXRNYXhQcm9maXQoKSBpbnRlcm5hbCB7DQogICAgICAgIG1heFByb2ZpdCA9IChjb250cmFjdEJhbGFuY2UqbWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSkvbWF4QmV0RGl2aXNvcjsNCiAgICB9DQoNCiAgICAvKg0KICAgICogb3duZXIvdHJlYXN1cnkgYWRkcmVzcyBvbmx5IGZ1bmN0aW9ucw0KICAgICovDQogICAgZnVuY3Rpb24gKCkNCiAgICAgICAgcGF5YWJsZQ0KICAgIHsNCiAgICAgICAgcGxheWVyUm9sbERpY2UoNDcpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG93bmVyQWRkQmFua3JvbGwgKCkNCiAgICBwYXlhYmxlDQogICAgb25seVRyZWFzdXJ5DQogICAgew0KICAgICAgICAvKiBzYWZlbHkgdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2UgKi8NCiAgICAgICAgY29udHJhY3RCYWxhbmNlID0gc2FmZUFkZChjb250cmFjdEJhbGFuY2UsIG1zZy52YWx1ZSk7DQogICAgICAgIC8qIHVwZGF0ZSB0aGUgbWF4aW11bSBwcm9maXQgKi8NCiAgICAgICAgc2V0TWF4UHJvZml0KCk7DQogICAgfQ0KDQogICAgLyogc2V0IGdhcyBmb3Igb3JhY2xpemUgcXVlcnkgKi8NCiAgICBmdW5jdGlvbiBvd25lclNldE9yYWNsaXplU2FmZUdhcyh1aW50MzIgbmV3U2FmZUdhc1RvT3JhY2xpemUpIHB1YmxpYw0KCQlvbmx5T3duZXINCgl7DQogICAgCWdhc0Zvck9yYWNsaXplID0gbmV3U2FmZUdhc1RvT3JhY2xpemU7DQogICAgfQ0KDQogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgaG91c2VFZGdlICovDQogICAgZnVuY3Rpb24gb3duZXJTZXRIb3VzZUVkZ2UodWludCBuZXdIb3VzZUVkZ2UpIHB1YmxpYw0KCQlvbmx5T3duZXINCiAgICB7DQogICAgICAgIGhvdXNlRWRnZSA9IG5ld0hvdXNlRWRnZTsNCiAgICB9DQoNCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBtYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlICovDQogICAgZnVuY3Rpb24gb3duZXJTZXRNYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlKHVpbnQgbmV3TWF4UHJvZml0QXNQZXJjZW50KSBwdWJsaWMNCgkJb25seU93bmVyDQogICAgew0KICAgICAgICAvKiByZXN0cmljdCB0byBtYXhpbXVtIHByb2ZpdCBvZiA1JSBvZiB0b3RhbCBob3VzZSBiYWxhbmNlKi8NCiAgICAgICAgaWYobmV3TWF4UHJvZml0QXNQZXJjZW50ID4gNTAwMDApIHRocm93Ow0KICAgICAgICBtYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlID0gbmV3TWF4UHJvZml0QXNQZXJjZW50Ow0KICAgICAgICBzZXRNYXhQcm9maXQoKTsNCiAgICB9DQoNCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBtaW5CZXQgKi8NCiAgICBmdW5jdGlvbiBvd25lclNldE1pbkJldCh1aW50IG5ld01pbmltdW1CZXQpIHB1YmxpYw0KCQlvbmx5T3duZXINCiAgICB7DQogICAgICAgIG1pbkJldCA9IG5ld01pbmltdW1CZXQ7DQogICAgfQ0KDQogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiB0cmFuc2ZlciBldGhlciAqLw0KICAgIGZ1bmN0aW9uIG93bmVyVHJhbnNmZXJFdGhlcihhZGRyZXNzIHNlbmRUbywgdWludCBhbW91bnQpIHB1YmxpYw0KCQlvbmx5T3duZXINCiAgICB7DQogICAgICAgIC8qIHNhZmVseSB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSB3aGVuIHNlbmRpbmcgb3V0IGZ1bmRzKi8NCiAgICAgICAgY29udHJhY3RCYWxhbmNlID0gc2FmZVN1Yihjb250cmFjdEJhbGFuY2UsIGFtb3VudCk7DQogICAgICAgIC8qIHVwZGF0ZSBtYXggcHJvZml0ICovDQogICAgICAgIHNldE1heFByb2ZpdCgpOw0KICAgICAgICBpZighc2VuZFRvLnNlbmQoYW1vdW50KSkgdGhyb3c7DQogICAgICAgIExvZ093bmVyVHJhbnNmZXIoc2VuZFRvLCBhbW91bnQpOw0KICAgIH0NCg0KICAgIC8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gZG8gbWFudWFsIHJlZnVuZA0KICAgICogdXNlZCBvbmx5IGlmIGJldCBwbGFjZWQgKyBvcmFjbGl6ZSBmYWlsZWQgdG8gX19jYWxsYmFjaw0KICAgICogZmlsdGVyIExvZ0JldCBieSBhZGRyZXNzIGFuZC9vciBwbGF5ZXJCZXRJZDoNCiAgICAqIExvZ0JldChwbGF5ZXJCZXRJZFtybmdJZF0sIHBsYXllckFkZHJlc3Nbcm5nSWRdLCBzYWZlQWRkKHBsYXllckJldFZhbHVlW3JuZ0lkXSwgcGxheWVyUHJvZml0W3JuZ0lkXSksIHBsYXllclByb2ZpdFtybmdJZF0sIHBsYXllckJldFZhbHVlW3JuZ0lkXSwgcGxheWVyTnVtYmVyW3JuZ0lkXSk7DQogICAgKiBjaGVjayB0aGUgZm9sbG93aW5nIGxvZ3MgZG8gbm90IGV4aXN0IGZvciBwbGF5ZXJCZXRJZCBhbmQvb3IgcGxheWVyQWRkcmVzc1tybmdJZF0gYmVmb3JlIHJlZnVuZGluZzoNCiAgICAqIExvZ1Jlc3VsdCBvciBMb2dSZWZ1bmQNCiAgICAqIGlmIExvZ1Jlc3VsdCBleGlzdHMgcGxheWVyIHNob3VsZCB1c2UgdGhlIHdpdGhkcmF3IHBhdHRlcm4gcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zDQogICAgKi8NCiAgICBmdW5jdGlvbiBvd25lclJlZnVuZFBsYXllcihieXRlczMyIG9yaWdpbmFsUGxheWVyQmV0SWQsIGFkZHJlc3Mgc2VuZFRvLCB1aW50IG9yaWdpbmFsUGxheWVyUHJvZml0LCB1aW50IG9yaWdpbmFsUGxheWVyQmV0VmFsdWUpIHB1YmxpYw0KCQlvbmx5T3duZXINCiAgICB7DQogICAgICAgIC8qIHNhZmVseSByZWR1Y2UgcGVuZGluZ1BheW91dHMgYnkgcGxheWVyUHJvZml0W3JuZ0lkXSAqLw0KICAgICAgICBtYXhQZW5kaW5nUGF5b3V0cyA9IHNhZmVTdWIobWF4UGVuZGluZ1BheW91dHMsIG9yaWdpbmFsUGxheWVyUHJvZml0KTsNCiAgICAgICAgLyogc2VuZCByZWZ1bmQgKi8NCiAgICAgICAgaWYoIXNlbmRUby5zZW5kKG9yaWdpbmFsUGxheWVyQmV0VmFsdWUpKSB0aHJvdzsNCiAgICAgICAgLyogbG9nIHJlZnVuZHMgKi8NCiAgICAgICAgTG9nUmVmdW5kKG9yaWdpbmFsUGxheWVyQmV0SWQsIHNlbmRUbywgb3JpZ2luYWxQbGF5ZXJCZXRWYWx1ZSk7DQogICAgfQ0KDQogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgZW1lcmdlbmN5IHBhdXNlICMxICovDQogICAgZnVuY3Rpb24gb3duZXJQYXVzZUdhbWUoYm9vbCBuZXdTdGF0dXMpIHB1YmxpYw0KCQlvbmx5T3duZXINCiAgICB7DQoJCWdhbWVQYXVzZWQgPSBuZXdTdGF0dXM7DQogICAgfQ0KDQogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgZW1lcmdlbmN5IHBhdXNlICMyICovDQogICAgZnVuY3Rpb24gb3duZXJQYXVzZVBheW91dHMoYm9vbCBuZXdQYXlvdXRTdGF0dXMpIHB1YmxpYw0KCQlvbmx5T3duZXINCiAgICB7DQoJCXBheW91dHNQYXVzZWQgPSBuZXdQYXlvdXRTdGF0dXM7DQogICAgfQ0KDQogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgdHJlYXN1cnkgYWRkcmVzcyAqLw0KICAgIGZ1bmN0aW9uIG93bmVyU2V0VHJlYXN1cnkoYWRkcmVzcyBuZXdUcmVhc3VyeSkgcHVibGljDQoJCW9ubHlPd25lcg0KCXsNCiAgICAgICAgdHJlYXN1cnkgPSBuZXdUcmVhc3VyeTsNCiAgICB9DQoNCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBvd25lciBhZGRyZXNzICovDQogICAgZnVuY3Rpb24gb3duZXJDaGFuZ2VPd25lcihhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMNCgkJb25seU93bmVyDQoJew0KICAgICAgICBvd25lciA9IG5ld093bmVyOw0KICAgIH0NCg0KICAgIC8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc3VpY2lkZSAtIGVtZXJnZW5jeSAqLw0KICAgIGZ1bmN0aW9uIG93bmVya2lsbCgpIHB1YmxpYw0KCQlvbmx5T3duZXINCgl7DQoJCXN1aWNpZGUob3duZXIpOw0KCX0NCg0KDQp9'