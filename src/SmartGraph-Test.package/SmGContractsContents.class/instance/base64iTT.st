base 64 content
base64iTT
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4wOw0KDQpjb250cmFjdCBCYXNlDQp7DQovKiBDb25zdGFudHMgKi8NCg0KICAgIHN0cmluZyBjb25zdGFudCBWRVJTSU9OID0gIkJhc2UgMC4xLjEgXG4iOw0KDQovKiBTdGF0ZSBWYXJpYWJsZXMgKi8NCg0KICAgIGJvb2wgbXV0ZXg7DQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCi8qIEV2ZW50cyAqLw0KDQogICAgZXZlbnQgTG9nKHN0cmluZyBtZXNzYWdlKTsNCiAgICBldmVudCBDaGFuZ2VkT3duZXIoYWRkcmVzcyBpbmRleGVkIG9sZE93bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOw0KDQovKiBNb2RpZmllcnMgKi8NCg0KICAgIC8vIFRvIHRocm93IGNhbGwgbm90IG1hZGUgYnkgb3duZXINCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvLyBUaGlzIG1vZGlmaWVyIGNhbiBiZSB1c2VkIG9uIGZ1bmN0aW9ucyB3aXRoIGV4dGVybmFsIGNhbGxzIHRvDQogICAgLy8gcHJldmVudCByZWVudHJ5IGF0dGFja3MuDQogICAgLy8gQ29uc3RyYWludHM6DQogICAgLy8gICBQcm90ZWN0ZWQgZnVuY3Rpb25zIG11c3QgaGF2ZSBvbmx5IG9uZSBwb2ludCBvZiBleGl0Lg0KICAgIC8vICAgUHJvdGVjdGVkIGZ1bmN0aW9ucyBjYW5ub3QgdXNlIHRoZSBgcmV0dXJuYCBrZXl3b3JkDQogICAgLy8gICBQcm90ZWN0ZWQgZnVuY3Rpb25zIHJldHVybiB2YWx1ZXMgbXVzdCBiZSB0aHJvdWdoIHJldHVybiBwYXJhbWV0ZXJzLg0KICAgIG1vZGlmaWVyIHByZXZlbnRSZWVudHJ5KCkgew0KICAgICAgICBpZiAobXV0ZXgpIHRocm93Ow0KICAgICAgICBlbHNlIG11dGV4ID0gdHJ1ZTsNCiAgICAgICAgXzsNCiAgICAgICAgZGVsZXRlIG11dGV4Ow0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gVGhpcyBtb2RpZmllciBjYW4gYmUgYXBwbGllZCB0byBwdWxpYyBhY2Nlc3Mgc3RhdGUgbXV0YXRpb24gZnVuY3Rpb25zDQogICAgLy8gdG8gcHJvdGVjdCBhZ2FpbnN0IHJlZW50cnkgaWYgYSBgbXV0ZXh0UHJvdGVjdGAgZnVuY3Rpb24gaXMgYWxyZWFkeQ0KICAgIC8vIG9uIHRoZSBjYWxsIHN0YWNrLg0KICAgIG1vZGlmaWVyIG5vUmVlbnRyeSgpIHsNCiAgICAgICAgaWYgKG11dGV4KSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvLyBTYW1lIGFzIG5vUmVlbnRyeSgpIGJ1dCBpbnRlbmRlZCB0byBiZSBvdmVybG9hZGVkDQogICAgbW9kaWZpZXIgY2FuRW50ZXIoKSB7DQogICAgICAgIGlmIChtdXRleCkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KICAgIA0KLyogRnVuY3Rpb25zICovDQoNCiAgICBmdW5jdGlvbiBCYXNlKCkgeyBvd25lciA9IG1zZy5zZW5kZXI7IH0NCg0KICAgIGZ1bmN0aW9uIHZlcnNpb24oKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBWRVJTSU9OOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNvbnRyYWN0QmFsYW5jZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZTsNCiAgICB9DQoNCiAgICAvLyBDaGFuZ2UgdGhlIG93bmVyIG9mIGEgY29udHJhY3QNCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikNCiAgICAgICAgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7DQogICAgICAgIENoYW5nZWRPd25lcihtc2cuc2VuZGVyLCBvd25lcik7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBzYWZlU2VuZChhZGRyZXNzIF9yZWNpcGllbnQsIHVpbnQgX2V0aGVyKQ0KICAgICAgICBpbnRlcm5hbA0KICAgICAgICBwcmV2ZW50UmVlbnRyeSgpDQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzc18pDQogICAgew0KICAgICAgICBpZighX3JlY2lwaWVudC5jYWxsLnZhbHVlKF9ldGhlcikoKSkgdGhyb3c7DQogICAgICAgIHN1Y2Nlc3NfID0gdHJ1ZTsNCiAgICB9DQp9DQoNCi8qIEVuZCBvZiBCYXNlICovDQoNCi8qDQpmaWxlOiAgIE1hdGguc29sDQp2ZXI6ICAgIDAuMi4wDQp1cGRhdGVkOjE4LU5vdi0yMDE2DQphdXRob3I6IERhcnJ5bCBNb3JyaXMNCmVtYWlsOiAgbzByYWdtYW4wbyBBVCBnbWFpbC5jb20NCg0KQW4gaW5oZXJpdGFibGUgY29udHJhY3QgY29udGFpbmluZyBtYXRoIGZ1bmN0aW9ucyBhbmQgY29tcGFyaXRvcnMuDQoNClRoaXMgc29mdHdhcmUgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwNCmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQpNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQpHTlUgbGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCjxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4NCiovDQoNCnByYWdtYSBzb2xpZGl0eSBeMC40LjA7DQoNCmNvbnRyYWN0IE1hdGgNCnsNCg0KLyogQ29uc3RhbnRzICovDQoNCiAgICBzdHJpbmcgY29uc3RhbnQgVkVSU0lPTiA9ICJNYXRoIDAuMC4xIFxuIjsNCiAgICB1aW50IGNvbnN0YW50IE5VTEwgPSAwOw0KICAgIGJvb2wgY29uc3RhbnQgTFQgPSBmYWxzZTsNCiAgICBib29sIGNvbnN0YW50IEdUID0gdHJ1ZTsNCiAgICAvLyBObyB0eXBlIGJvb2wgPC0+IGludCB0eXBlIGNvbnZlcnN0aW9uIGluIHNvbGlkaXR5IDp+KA0KICAgIHVpbnQgY29uc3RhbnQgaVRSVUUgPSAxOw0KICAgIHVpbnQgY29uc3RhbnQgaUZBTFNFID0gMDsNCiAgICB1aW50IGNvbnN0YW50IGlQT1MgPSAxOw0KICAgIHVpbnQgY29uc3RhbnQgaVpFUk8gPSAwOw0KICAgIHVpbnQgY29uc3RhbnQgaU5FRyA9IHVpbnQoLTEpOw0KDQoNCi8qIE1vZGlmaWVycyAqLw0KDQovKiBGdW5jdGlvbnMgKi8NCiAgICBmdW5jdGlvbiB2ZXJzaW9uKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykNCiAgICB7DQogICAgICAgIHJldHVybiBWRVJTSU9OOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgY29uc3RhbnQNCiAgICB7DQogICAgICBpZiAoIWFzc2VydGlvbikgdGhyb3c7DQogICAgfQ0KICAgIA0KICAgIC8vIEBkZXYgUGFyYW1ldHJpYyBjb21wYXJpdG9yIGZvciA+IG9yIDwNCiAgICAvLyAhX3N5bSByZXR1cm5zIGEgPCBiDQogICAgLy8gX3N5bSAgcmV0dXJucyBhID4gYg0KICAgIGZ1bmN0aW9uIGNtcCAodWludCBhLCB1aW50IGIsIGJvb2wgX3N5bSkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIHJldHVybiAoYSE9YikgJiYgKChhIDwgYikgIT0gX3N5bSk7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgUGFyYW1ldHJpYyBjb21wYXJpdG9yIGZvciA+PSBvciA8PQ0KICAgIC8vLyAhX3N5bSByZXR1cm5zIGEgPD0gYg0KICAgIC8vLyBfc3ltICByZXR1cm5zIGEgPj0gYg0KICAgIGZ1bmN0aW9uIGNtcEVxICh1aW50IGEsIHVpbnQgYiwgYm9vbCBfc3ltKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuIChhPT1iKSB8fCAoKGEgPCBiKSAhPSBfc3ltKTsNCiAgICB9DQogICAgDQogICAgLy8vIFRyaWNob3RvbW91cyBjb21wYXJpdG9yDQogICAgLy8vIGEgPCBiIHJldHVybnMgLTENCiAgICAvLy8gYSA9PSBiIHJldHVybnMgMA0KICAgIC8vLyBhID4gYiByZXR1cm5zIDENCi8qICAgIGZ1bmN0aW9uIHRyaUNtcCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIHVpbnQgYyA9IGEgLSBiOw0KICAgICAgICByZXR1cm4gYyAmIGMgJiAoMCAtIDEpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBuU2lnbih1aW50IGEpIGludGVybmFsIHJldHVybnMgKHVpbnQpDQogICAgew0KICAgICAgICByZXR1cm4gYSAmIDJeMjU1Ow0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBuZWcodWludCBhKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiAwIC0gYTsNCiAgICB9DQoqLyAgICANCiAgICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KQ0KICAgIHsNCiAgICAgIHVpbnQgYyA9IGEgKiBiOw0KICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICAgIHJldHVybiBjOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpDQogICAgew0KICAgICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgICByZXR1cm4gYSAtIGI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkNCiAgICB7DQogICAgICB1aW50IGMgPSBhICsgYjsNCiAgICAgIGFzc2VydChjPj1hICYmIGM+PWIpOw0KICAgICAgcmV0dXJuIGM7DQogICAgfQ0KfQ0KDQovKiBFbmQgb2YgTWF0aCAqLw0KDQoNCi8qDQpmaWxlOiAgIEVSQzIwLnNvbA0KdmVyOiAgICAwLjIuMw0KdXBkYXRlZDoxOC1Ob3YtMjAxNg0KYXV0aG9yOiBEYXJyeWwgTW9ycmlzDQplbWFpbDogIG8wcmFnbWFuMG8gQVQgZ21haWwuY29tDQoNCkFuIEVSQzIwIGNvbXBsaWFudCB0b2tlbi4NCg0KVGhpcyBzb2Z0d2FyZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUNCkdOVSBsZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLg0KPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lg0KKi8NCg0KLy9wcmFnbWEgc29saWRpdHkgXjAuNC4wOw0KDQovL2ltcG9ydCAiTWF0aC5zb2wiOw0KLy9pbXBvcnQgIkJhc2Uuc29sIjsNCg0KLy8gRVJDMjAgU3RhbmRhcmQgVG9rZW4gSW50ZXJmYWNlIHdpdGggc2FmZSBtYXRocyBhbmQgcmVlbnRyeSBwcm90ZWN0aW9uDQpjb250cmFjdCBFUkMyMEludGVyZmFjZQ0Kew0KLyogU3RydWN0cyAqLw0KDQovKiBDb25zdGFudHMgKi8NCiAgICBzdHJpbmcgY29uc3RhbnQgVkVSU0lPTiA9ICJFUkMyMCAwLjIuMy1vMHJhZ21hbjBvXG5NYXRoIDAuMC4xXG5CYXNlIDAuMS4xXG4iOw0KDQovKiBTdGF0ZSBWYWxpYWJsZXMgKi8NCiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsNCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbFBsYWNlczsNCiAgICBzdHJpbmcgcHVibGljIG5hbWU7DQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7DQogICAgDQogICAgLy8gVG9rZW4gb3duZXJzaGlwIG1hcHBpbmcNCiAgICAvLyBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBiYWxhbmNlT2Y7DQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlOw0KICAgIA0KICAgIC8vIFRyYW5zZmVyIGFsbG93YW5jZXMgbWFwcGluZw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgcHVibGljIGFsbG93YW5jZTsNCg0KLyogRXZlbnRzICovDQogICAgLy8gVHJpZ2dlcmVkIHdoZW4gdG9rZW5zIGFyZSB0cmFuc2ZlcnJlZC4NCiAgICBldmVudCBUcmFuc2ZlcigNCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9mcm9tLA0KICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3RvLA0KICAgICAgICB1aW50MjU2IF92YWx1ZSk7DQoNCiAgICAvLyBUcmlnZ2VyZWQgd2hlbmV2ZXIgYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgaXMgY2FsbGVkLg0KICAgIGV2ZW50IEFwcHJvdmFsKA0KICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX293bmVyLA0KICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsDQogICAgICAgIHVpbnQyNTYgX3ZhbHVlKTsNCg0KLyogTW9kaWZpZXJzICovDQoNCi8qIEZ1bmN0aW9uIEFic3RyYWN0cyAqLw0KDQogICAgLyogU3RhdGUgdmFyaWFibGUgQWNjZXNzb3IgRnVuY3Rpb25zIChmb3IgcmVmZXJlbmNlIC0gbGVhdmUgY29tbWVudGVkKSAqLw0KDQogICAgLy8gUmV0dXJucyB0aGUgYWxsb3dhYmxlIHRyYW5zZmVyIG9mIHRva2VucyBieSBhIHByb3h5DQogICAgLy8gZnVuY3Rpb24gYWxsb3dhbmNlIChhZGRyZXNzIHRva2VuSG9sZGVycywgYWRkcmVzcyBwcm94eSwgdWludCBhbGxvd2FuY2UpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCg0KICAgIC8vIEdldCB0aGUgdG90YWwgdG9rZW4gc3VwcGx5DQogICAgLy8gZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQoNCiAgICAvLyBSZXR1cm5zIHRva2VuIHN5bWJvbA0KICAgIC8vIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHN0cmluZyk7DQoNCiAgICAvLyBSZXR1cm5zIHRva2VuIHN5bWJvbA0KICAgIC8vIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcpOw0KDQogICAgLy8gUmV0dXJucyBkZWNpbWFsIHBsYWNlcyBkZXNpZ25hdGVkIGZvciB1bml0IG9mIHRva2VuLg0KICAgIC8vIGZ1bmN0aW9uIGRlY2ltYWxQbGFjZXMoKSBwdWJsaWMgcmV0dXJucyh1aW50KTsNCg0KICAgIC8vIFNlbmQgX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgdG8gYWRkcmVzcyBfdG8NCiAgICAvLyBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KDQogICAgLy8gU2VuZCBfdmFsdWUgYW1vdW50IG9mIHRva2VucyBmcm9tIGFkZHJlc3MgX2Zyb20gdG8gYWRkcmVzcyBfdG8NCiAgICAvLyBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIC8vIEFsbG93IF9zcGVuZGVyIHRvIHdpdGhkcmF3IGZyb20geW91ciBhY2NvdW50LCBtdWx0aXBsZSB0aW1lcywgdXAgdG8gdGhlDQogICAgLy8gX3ZhbHVlIGFtb3VudC4NCiAgICAvLyBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCn0NCg0KY29udHJhY3QgRVJDMjBUb2tlbiBpcyBCYXNlLCBNYXRoLCBFUkMyMEludGVyZmFjZQ0Kew0KDQovKiBFdmVudHMgKi8NCg0KLyogU3RydWN0cyAqLw0KDQovKiBDb25zdGFudHMgKi8NCg0KLyogU3RhdGUgVmFsaWFibGVzICovDQoNCi8qIE1vZGlmaWVycyAqLw0KDQogICAgbW9kaWZpZXIgaXNBdmFpbGFibGUodWludCBfYW1vdW50KSB7DQogICAgICAgIGlmIChfYW1vdW50ID4gYmFsYW5jZVttc2cuc2VuZGVyXSkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgaXNBbGxvd2VkKGFkZHJlc3MgX2Zyb20sIHVpbnQgX2Ftb3VudCkgew0KICAgICAgICBpZiAoX2Ftb3VudCA+IGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0gfHwNCiAgICAgICAgICAgX2Ftb3VudCA+IGJhbGFuY2VbX2Zyb21dKSB0aHJvdzsNCiAgICAgICAgXzsgICAgICAgIA0KICAgIH0NCg0KLyogRnVudGlvbnMgUHVibGljICovDQoNCiAgICBmdW5jdGlvbiBFUkMyMFRva2VuKA0KICAgICAgICB1aW50IF9zdXBwbHksDQogICAgICAgIHVpbnQ4IF9kZWNpbWFsUGxhY2VzLA0KICAgICAgICBzdHJpbmcgX3N5bWJvbCwNCiAgICAgICAgc3RyaW5nIF9uYW1lKQ0KICAgIHsNCiAgICAgICAgdG90YWxTdXBwbHkgPSBfc3VwcGx5Ow0KICAgICAgICBkZWNpbWFsUGxhY2VzID0gX2RlY2ltYWxQbGFjZXM7DQogICAgICAgIHN5bWJvbCA9IF9zeW1ib2w7DQogICAgICAgIG5hbWUgPSBfbmFtZTsNCiAgICAgICAgYmFsYW5jZVttc2cuc2VuZGVyXSA9IHRvdGFsU3VwcGx5Ow0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiB2ZXJzaW9uKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBWRVJTSU9OOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfYWRkcikNCiAgICAgICAgcHVibGljDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIHJldHVybnMgKHVpbnQpDQogICAgew0KICAgICAgICByZXR1cm4gYmFsYW5jZVtfYWRkcl07DQogICAgfQ0KDQogICAgLy8gU2VuZCBfdmFsdWUgYW1vdW50IG9mIHRva2VucyB0byBhZGRyZXNzIF90bw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkNCiAgICAgICAgZXh0ZXJuYWwNCiAgICAgICAgY2FuRW50ZXINCiAgICAgICAgaXNBdmFpbGFibGUoX3ZhbHVlKQ0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgYmFsYW5jZVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZVttc2cuc2VuZGVyXSwgX3ZhbHVlKTsNCiAgICAgICAgYmFsYW5jZVtfdG9dID0gc2FmZUFkZChiYWxhbmNlW190b10sIF92YWx1ZSk7DQogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8gU2VuZCBfdmFsdWUgYW1vdW50IG9mIHRva2VucyBmcm9tIGFkZHJlc3MgX2Zyb20gdG8gYWRkcmVzcyBfdG8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQ0KICAgICAgICBleHRlcm5hbA0KICAgICAgICBjYW5FbnRlcg0KICAgICAgICBpc0FsbG93ZWQoX2Zyb20sIF92YWx1ZSkNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIGJhbGFuY2VbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlW19mcm9tXSwgX3ZhbHVlKTsNCiAgICAgICAgYmFsYW5jZVtfdG9dID0gc2FmZUFkZChiYWxhbmNlW190b10sIF92YWx1ZSk7DQogICAgICAgIGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0sIF92YWx1ZSk7DQogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8gQWxsb3cgX3NwZW5kZXIgdG8gd2l0aGRyYXcgZnJvbSB5b3VyIGFjY291bnQsIG11bHRpcGxlIHRpbWVzLCB1cCB0byB0aGUNCiAgICAvLyBfdmFsdWUgYW1vdW50LiBJZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhZ2FpbiBpdCBvdmVyd3JpdGVzIHRoZSBjdXJyZW50DQogICAgLy8gYWxsb3dhbmNlIHdpdGggX3ZhbHVlLg0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpDQogICAgICAgIGV4dGVybmFsDQogICAgICAgIGNhbkVudGVyDQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykNCiAgICB7DQogICAgICAgIGlmIChiYWxhbmNlW21zZy5zZW5kZXJdID09IDApIHRocm93Ow0KICAgICAgICBhbGxvd2FuY2VbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KfQ0KDQovKiBFbmQgb2YgRVJDMjAgKi8NCg0KDQovKg0KZmlsZTogICBMaWJDTEwuc29sDQp2ZXI6ICAgIDAuMy4xDQp1cGRhdGVkOjIxLVNlcC0yMDE2DQphdXRob3I6IERhcnJ5bCBNb3JyaXMNCmVtYWlsOiAgbzByYWdtYW4wbyBBVCBnbWFpbC5jb20NCg0KQSBTb2xpZGl0eSBsaWJyYXJ5IGZvciBpbXBsZW1lbnRpbmcgYSBkYXRhIGluZGV4aW5nIHJlZ2ltZSB1c2luZw0KYSBjaXJjdWxhciBsaW5rZWQgbGlzdC4NCg0KVGhpcyBsaWJyYXJ5IHByb3Zpc2lvbnMgbG9va3VwLCBuYXZpZ2F0aW9uIGFuZCBrZXkvaW5kZXggc3RvcmFnZQ0KZnVuY3Rpb25hbGl0eSB3aGljaCBjYW4gYmUgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoIGFuIGFycmF5IG9yIG1hcHBpbmcuDQoNCk5PVElDRTogVGhpcyBsaWJyYXJ5IHVzZXMgaW50ZXJuYWwgZnVuY3Rpb25zIG9ubHkgYW5kIHNvIGNhbm5vdCBiZSBjb21waWxlZA0KYW5kIGRlcGxveWVkIGluZGVwZW5kZW50bHkgZnJvbSBpdHMgY2FsbGluZyBjb250cmFjdC4NCg0KVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQpidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZg0KTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQo8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQoqLw0KDQovL3ByYWdtYSBzb2xpZGl0eSBeMC40LjA7DQoNCi8vIExpYkNMTCB1c2luZyBgdWludGAga2V5cw0KbGlicmFyeSBMaWJDTEx1IHsNCg0KICAgIHN0cmluZyBjb25zdGFudCBWRVJTSU9OID0gIkxpYkNMTHUgMC4zLjEiOw0KICAgIHVpbnQgY29uc3RhbnQgTlVMTCA9IDA7DQogICAgdWludCBjb25zdGFudCBIRUFEID0gTlVMTDsNCiAgICBib29sIGNvbnN0YW50IFBSRVYgPSBmYWxzZTsNCiAgICBib29sIGNvbnN0YW50IE5FWFQgPSB0cnVlOw0KICAgIA0KICAgIHN0cnVjdCBDTEx7DQogICAgICAgIG1hcHBpbmcgKHVpbnQgPT4gbWFwcGluZyAoYm9vbCA9PiB1aW50KSkgY2xsOw0KICAgIH0NCg0KICAgIC8vIG46IG5vZGUgaWQgIGQ6IGRpcmVjdGlvbiAgcjogcmV0dXJuIG5vZGUgaWQNCg0KICAgIGZ1bmN0aW9uIHZlcnNpb24oKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIFZFUlNJT047DQogICAgfQ0KDQogICAgLy8gUmV0dXJuIGV4aXN0ZW50aWFsIHN0YXRlIG9mIGEgbGlzdC4NCiAgICBmdW5jdGlvbiBleGlzdHMoQ0xMIHN0b3JhZ2Ugc2VsZikNCiAgICAgICAgaW50ZXJuYWwNCiAgICAgICAgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIGlmIChzZWxmLmNsbFtIRUFEXVtQUkVWXSAhPSBIRUFEIHx8IHNlbGYuY2xsW0hFQURdW05FWFRdICE9IEhFQUQpDQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgDQogICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHRoZSBsaXN0DQogICAgZnVuY3Rpb24gc2l6ZU9mKENMTCBzdG9yYWdlIHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcikgew0KICAgICAgICB1aW50IGkgPSBzdGVwKHNlbGYsIEhFQUQsIE5FWFQpOw0KICAgICAgICB3aGlsZSAoaSAhPSBIRUFEKSB7DQogICAgICAgICAgICBpID0gc3RlcChzZWxmLCBpLCBORVhUKTsNCiAgICAgICAgICAgIHIrKzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gUmV0dXJucyB0aGUgbGlua3Mgb2YgYSBub2RlIGFzIGFuZCBhcnJheQ0KICAgIGZ1bmN0aW9uIGdldE5vZGUoQ0xMIHN0b3JhZ2Ugc2VsZiwgdWludCBuKQ0KICAgICAgICBpbnRlcm5hbCAgY29uc3RhbnQgcmV0dXJucyAodWludFsyXSkNCiAgICB7DQogICAgICAgIHJldHVybiBbc2VsZi5jbGxbbl1bUFJFVl0sIHNlbGYuY2xsW25dW05FWFRdXTsNCiAgICB9DQoNCiAgICAvLyBSZXR1cm5zIHRoZSBsaW5rIG9mIGEgbm9kZSBgbmAgaW4gZGlyZWN0aW9uIGBkYC4NCiAgICBmdW5jdGlvbiBzdGVwKENMTCBzdG9yYWdlIHNlbGYsIHVpbnQgbiwgYm9vbCBkKQ0KICAgICAgICBpbnRlcm5hbCAgY29uc3RhbnQgcmV0dXJucyAodWludCkNCiAgICB7DQogICAgICAgIHJldHVybiBzZWxmLmNsbFtuXVtkXTsNCiAgICB9DQoNCiAgICAvLyBDYW4gYmUgdXNlZCBiZWZvcmUgYGluc2VydGAgdG8gYnVpbGQgYW4gb3JkZXJlZCBsaXN0DQogICAgLy8gYGFgIGFuIGV4aXN0aW5nIG5vZGUgdG8gc2VhcmNoIGZyb20sIGUuZy4gSEVBRC4NCiAgICAvLyBgYmAgdmFsdWUgdG8gc2Vlaw0KICAgIC8vIGByYCBmaXJzdCBub2RlIGJleW9uZCBgYmAgaW4gZGlyZWN0aW9uIGBkYA0KICAgIGZ1bmN0aW9uIHNlZWsoQ0xMIHN0b3JhZ2Ugc2VsZiwgdWludCBhLCB1aW50IGIsIGJvb2wgZCkNCiAgICAgICAgaW50ZXJuYWwgIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcikNCiAgICB7DQogICAgICAgIHIgPSBzdGVwKHNlbGYsIGEsIGQpOw0KICAgICAgICB3aGlsZSAgKChiIT1yKSAmJiAoKGIgPCByKSAhPSBkKSkgciA9IHNlbGYuY2xsW3JdW2RdOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLy8gQ3JlYXRlcyBhIGJpZGlyZWN0aW9uYWwgbGluayBiZXR3ZWVuIHR3byBub2RlcyBvbiBkaXJlY3Rpb24gYGRgDQogICAgZnVuY3Rpb24gc3RpdGNoKENMTCBzdG9yYWdlIHNlbGYsIHVpbnQgYSwgdWludCBiLCBib29sIGQpIGludGVybmFsICB7DQogICAgICAgIHNlbGYuY2xsW2JdWyFkXSA9IGE7DQogICAgICAgIHNlbGYuY2xsW2FdW2RdID0gYjsNCiAgICB9DQoNCiAgICAvLyBJbnNlcnQgbm9kZSBgYmAgYmVzaWRlIGFuZCBleGlzdGluZyBub2RlIGBhYCBpbiBkaXJlY3Rpb24gYGRgLg0KICAgIGZ1bmN0aW9uIGluc2VydCAoQ0xMIHN0b3JhZ2Ugc2VsZiwgdWludCBhLCB1aW50IGIsIGJvb2wgZCkgaW50ZXJuYWwgIHsNCiAgICAgICAgdWludCBjID0gc2VsZi5jbGxbYV1bZF07DQogICAgICAgIHN0aXRjaCAoc2VsZiwgYSwgYiwgZCk7DQogICAgICAgIHN0aXRjaCAoc2VsZiwgYiwgYywgZCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHJlbW92ZShDTEwgc3RvcmFnZSBzZWxmLCB1aW50IG4pIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgaWYgKG4gPT0gTlVMTCkgcmV0dXJuOw0KICAgICAgICBzdGl0Y2goc2VsZiwgc2VsZi5jbGxbbl1bUFJFVl0sIHNlbGYuY2xsW25dW05FWFRdLCBORVhUKTsNCiAgICAgICAgZGVsZXRlIHNlbGYuY2xsW25dW1BSRVZdOw0KICAgICAgICBkZWxldGUgc2VsZi5jbGxbbl1bTkVYVF07DQogICAgICAgIHJldHVybiBuOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHB1c2goQ0xMIHN0b3JhZ2Ugc2VsZiwgdWludCBuLCBib29sIGQpIGludGVybmFsICB7DQogICAgICAgIGluc2VydChzZWxmLCBIRUFELCBuLCBkKTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gcG9wKENMTCBzdG9yYWdlIHNlbGYsIGJvb2wgZCkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gcmVtb3ZlKHNlbGYsIHN0ZXAoc2VsZiwgSEVBRCwgZCkpOw0KICAgIH0NCn0NCg0KLy8gTGliQ0xMIHVzaW5nIGBpbnRgIGtleXMNCmxpYnJhcnkgTGliQ0xMaSB7DQoNCiAgICBzdHJpbmcgY29uc3RhbnQgVkVSU0lPTiA9ICJMaWJDTExpIDAuMy4xIjsNCiAgICBpbnQgY29uc3RhbnQgTlVMTCA9IDA7DQogICAgaW50IGNvbnN0YW50IEhFQUQgPSBOVUxMOw0KICAgIGJvb2wgY29uc3RhbnQgUFJFViA9IGZhbHNlOw0KICAgIGJvb2wgY29uc3RhbnQgTkVYVCA9IHRydWU7DQogICAgDQogICAgc3RydWN0IENMTHsNCiAgICAgICAgbWFwcGluZyAoaW50ID0+IG1hcHBpbmcgKGJvb2wgPT4gaW50KSkgY2xsOw0KICAgIH0NCg0KICAgIC8vIG46IG5vZGUgaWQgIGQ6IGRpcmVjdGlvbiAgcjogcmV0dXJuIG5vZGUgaWQNCg0KICAgIGZ1bmN0aW9uIHZlcnNpb24oKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIFZFUlNJT047DQogICAgfQ0KDQogICAgLy8gUmV0dXJuIGV4aXN0ZW50aWFsIHN0YXRlIG9mIGEgbm9kZS4gbiA9PSBIRUFEIHJldHVybnMgbGlzdCBleGlzdGVuY2UuDQogICAgZnVuY3Rpb24gZXhpc3RzKENMTCBzdG9yYWdlIHNlbGYsIGludCBuKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgICAgIGlmIChzZWxmLmNsbFtIRUFEXVtQUkVWXSAhPSBIRUFEIHx8IHNlbGYuY2xsW0hFQURdW05FWFRdICE9IEhFQUQpDQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHRoZSBsaXN0DQogICAgZnVuY3Rpb24gc2l6ZU9mKENMTCBzdG9yYWdlIHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcikgew0KICAgICAgICBpbnQgaSA9IHN0ZXAoc2VsZiwgSEVBRCwgTkVYVCk7DQogICAgICAgIHdoaWxlIChpICE9IEhFQUQpIHsNCiAgICAgICAgICAgIGkgPSBzdGVwKHNlbGYsIGksIE5FWFQpOw0KICAgICAgICAgICAgcisrOw0KICAgICAgICB9DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyBSZXR1cm5zIHRoZSBsaW5rcyBvZiBhIG5vZGUgYXMgYW5kIGFycmF5DQogICAgZnVuY3Rpb24gZ2V0Tm9kZShDTEwgc3RvcmFnZSBzZWxmLCBpbnQgbikNCiAgICAgICAgaW50ZXJuYWwgIGNvbnN0YW50IHJldHVybnMgKGludFsyXSkNCiAgICB7DQogICAgICAgIHJldHVybiBbc2VsZi5jbGxbbl1bUFJFVl0sIHNlbGYuY2xsW25dW05FWFRdXTsNCiAgICB9DQoNCiAgICAvLyBSZXR1cm5zIHRoZSBsaW5rIG9mIGEgbm9kZSBgbmAgaW4gZGlyZWN0aW9uIGBkYC4NCiAgICBmdW5jdGlvbiBzdGVwKENMTCBzdG9yYWdlIHNlbGYsIGludCBuLCBib29sIGQpDQogICAgICAgIGludGVybmFsICBjb25zdGFudCByZXR1cm5zIChpbnQpDQogICAgew0KICAgICAgICByZXR1cm4gc2VsZi5jbGxbbl1bZF07DQogICAgfQ0KDQogICAgLy8gQ2FuIGJlIHVzZWQgYmVmb3JlIGBpbnNlcnRgIHRvIGJ1aWxkIGFuIG9yZGVyZWQgbGlzdA0KICAgIC8vIGBhYCBhbiBleGlzdGluZyBub2RlIHRvIHNlYXJjaCBmcm9tLCBlLmcuIEhFQUQuDQogICAgLy8gYGJgIHZhbHVlIHRvIHNlZWsNCiAgICAvLyBgcmAgZmlyc3Qgbm9kZSBiZXlvbmQgYGJgIGluIGRpcmVjdGlvbiBgZGANCiAgICBmdW5jdGlvbiBzZWVrKENMTCBzdG9yYWdlIHNlbGYsIGludCBhLCBpbnQgYiwgYm9vbCBkKQ0KICAgICAgICBpbnRlcm5hbCAgY29uc3RhbnQgcmV0dXJucyAoaW50IHIpDQogICAgew0KICAgICAgICByID0gc3RlcChzZWxmLCBhLCBkKTsNCiAgICAgICAgd2hpbGUgICgoYiE9cikgJiYgKChiIDwgcikgIT0gZCkpIHIgPSBzZWxmLmNsbFtyXVtkXTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIENyZWF0ZXMgYSBiaWRpcmVjdGlvbmFsIGxpbmsgYmV0d2VlbiB0d28gbm9kZXMgb24gZGlyZWN0aW9uIGBkYA0KICAgIGZ1bmN0aW9uIHN0aXRjaChDTEwgc3RvcmFnZSBzZWxmLCBpbnQgYSwgaW50IGIsIGJvb2wgZCkgaW50ZXJuYWwgIHsNCiAgICAgICAgc2VsZi5jbGxbYl1bIWRdID0gYTsNCiAgICAgICAgc2VsZi5jbGxbYV1bZF0gPSBiOw0KICAgIH0NCg0KICAgIC8vIEluc2VydCBub2RlIGBiYCBiZXNpZGUgZXhpc3Rpbmcgbm9kZSBgYWAgaW4gZGlyZWN0aW9uIGBkYC4NCiAgICBmdW5jdGlvbiBpbnNlcnQgKENMTCBzdG9yYWdlIHNlbGYsIGludCBhLCBpbnQgYiwgYm9vbCBkKSBpbnRlcm5hbCAgew0KICAgICAgICBpbnQgYyA9IHNlbGYuY2xsW2FdW2RdOw0KICAgICAgICBzdGl0Y2ggKHNlbGYsIGEsIGIsIGQpOw0KICAgICAgICBzdGl0Y2ggKHNlbGYsIGIsIGMsIGQpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiByZW1vdmUoQ0xMIHN0b3JhZ2Ugc2VsZiwgaW50IG4pIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICBpZiAobiA9PSBOVUxMKSByZXR1cm47DQogICAgICAgIHN0aXRjaChzZWxmLCBzZWxmLmNsbFtuXVtQUkVWXSwgc2VsZi5jbGxbbl1bTkVYVF0sIE5FWFQpOw0KICAgICAgICBkZWxldGUgc2VsZi5jbGxbbl1bUFJFVl07DQogICAgICAgIGRlbGV0ZSBzZWxmLmNsbFtuXVtORVhUXTsNCiAgICAgICAgcmV0dXJuIG47DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHVzaChDTEwgc3RvcmFnZSBzZWxmLCBpbnQgbiwgYm9vbCBkKSBpbnRlcm5hbCAgew0KICAgICAgICBpbnNlcnQoc2VsZiwgSEVBRCwgbiwgZCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHBvcChDTEwgc3RvcmFnZSBzZWxmLCBib29sIGQpIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICByZXR1cm4gcmVtb3ZlKHNlbGYsIHN0ZXAoc2VsZiwgSEVBRCwgZCkpOw0KICAgIH0NCn0NCg0KDQovKiBFbmQgb2YgTGliQ0xMaSAqLw0KDQovKg0KZmlsZTogICBJVFQuc29sDQp2ZXI6ICAgIDAuMy42DQp1cGRhdGVkOjE4LU5vdi0yMDE2DQphdXRob3I6IERhcnJ5bCBNb3JyaXMgKG8wcmFnbWFuMG8pDQplbWFpbDogIG8wcmFnbWFuMG8gQVQgZ21haWwuY29tDQoNCkFuIEVSQzIwIGNvbXBsaWFudCB0b2tlbiB3aXRoIGN1cnJlbmN5DQpleGNoYW5nZSBmdW5jdGlvbmFsaXR5IGhlcmUgY2FsbGVkIGFuICdJbnRyaW5zaWNhbGx5IFRyYWRhYmxlDQpUb2tlbicgKElUVCkuDQoNClRoaXMgc29mdHdhcmUgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwNCmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQpNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQpHTlUgbGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCjxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4NCiovDQoNCi8vcHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsNCg0KLy9pbXBvcnQgIkJhc2Uuc29sIjsNCi8vaW1wb3J0ICJNYXRoLnNvbCI7DQovL2ltcG9ydCAiRVJDMjAuc29sIjsNCi8vaW1wb3J0ICJMaWJDTEwuc29sIjsNCg0KY29udHJhY3QgSVRUSW50ZXJmYWNlDQp7DQoNCiAgICB1c2luZyBMaWJDTEx1IGZvciBMaWJDTEx1LkNMTDsNCg0KLyogQ29uc3RhbnRzICovDQoNCiAgICBzdHJpbmcgY29uc3RhbnQgVkVSU0lPTiA9ICJJVFQgMC4zLjZcbkVSQzIwIDAuMi4zLW8wcmFnbWFuMG9cbk1hdGggMC4wLjFcbkJhc2UgMC4xLjFcbiI7DQogICAgdWludCBjb25zdGFudCBIRUFEID0gMDsNCiAgICB1aW50IGNvbnN0YW50IE1JTk5VTSA9IHVpbnQoMSk7DQogICAgLy8gdXNlIG9ubHkgMTI4IGJpdHMgb2YgdWludCB0byBwcmV2ZW50IG11bCBvdmVyZmxvd3MuDQogICAgdWludCBjb25zdGFudCBNQVhOVU0gPSAyKioxMjg7DQogICAgdWludCBjb25zdGFudCBNSU5QUklDRSA9IHVpbnQoMSk7DQogICAgdWludCBjb25zdGFudCBORUcgPSB1aW50KC0xKTsgLy8yKioyNTYgLSAxDQogICAgYm9vbCBjb25zdGFudCBQUkVWID0gZmFsc2U7DQogICAgYm9vbCBjb25zdGFudCBORVhUID0gdHJ1ZTsNCiAgICBib29sIGNvbnN0YW50IEJJRCA9IGZhbHNlOw0KICAgIGJvb2wgY29uc3RhbnQgQVNLID0gdHJ1ZTsNCg0KICAgIC8vIG1pbmltdW0gZ2FzIHJlcXVpcmVkIHRvIHByZXZlbnQgb3V0IG9mIGdhcyBvbiAndGFrZScgbG9vcA0KICAgIHVpbnQgY29uc3RhbnQgTUlOR0FTID0gMTAwMDAwOw0KDQogICAgLy8gRm9yIHN0YWdpbmcgYW5kIGNvbW1pdGluZyB0cmFkZSBkZXRhaWxzLiAgVGhpcyBzYXZlcyB1bm5lY2Nlc3Nhcnkgc3RhdGUNCiAgICAvLyBjaGFuZ2UgZ2FzIHVzYWdlIGR1cmluZyBtdWx0aSBvcmRlciB0YWtlcyBidXQgZG9lcyBpbmNyZWFzZSBsb2dpYw0KICAgIC8vIGNvbXBsZXhpdHkgd2hlbiBlbmNvdW50ZXJpbmcgJ3RyYWRlIHdpdGggc2VsZicgb3JkZXJzDQogICAgc3RydWN0IFRyYWRlTWVzc2FnZSB7DQogICAgICAgIGJvb2wgbWFrZTsNCiAgICAgICAgYm9vbCBzaWRlOw0KICAgICAgICB1aW50IHByaWNlOw0KICAgICAgICB1aW50IHRyYWRlQW1vdW50Ow0KICAgICAgICB1aW50IGJhbGFuY2U7DQogICAgICAgIHVpbnQgZXRoZXJCYWxhbmNlOw0KICAgIH0NCg0KLyogU3RhdGUgVmFsaWFibGVzICovDQoNCiAgICAvLyBUbyBhbGxvdyBmb3IgdHJhZGUgaGFsdGluZyBieSBvd25lci4NCiAgICBib29sIHB1YmxpYyB0cmFkaW5nOw0KDQogICAgLy8gTWFwcGluZyBmb3IgZXRoZXIgb3duZXJzaGlwIG9mIGFjY3VtdWxhdGVkIGRlcG9zaXRzLCBzYWxlcyBhbmQgcmVmdW5kcy4NCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGV0aGVyQmFsYW5jZTsNCg0KICAgIC8vIE9yZGVycyBhcmUgc3RvcmVkIGluIGNpcmN1bGFyIGxpbmtlZCBsaXN0IEZJRk8ncyB3aGljaCBhcmUgbWFwcGluZ3Mgd2l0aA0KICAgIC8vIHByaWNlIGFzIGtleSBhbmQgdmFsdWUgYXMgdHJhZGVyIGFkZHJlc3MuICBBIHRyYWRlciBjYW4gaGF2ZSBvbmx5IG9uZQ0KICAgIC8vIG9yZGVyIG9wZW4gYXQgZWFjaCBwcmljZS4gUmVvcmRlcmluZyBhdCB0aGF0IHByaWNlIHdpbGwgY2FuY2VsIHRoZSBmaXJzdA0KICAgIC8vIG9yZGVyIGFuZCBwdXNoIHRoZSBuZXcgb25lIG9udG8gdGhlIGJhY2sgb2YgdGhlIHF1ZXVlLg0KICAgIG1hcHBpbmcgKHVpbnQgPT4gTGliQ0xMdS5DTEwpIG9yZGVyRklGT3M7DQogICAgDQogICAgLy8gT3JkZXIgYW1vdW50cyBhcmUgc3RvcmVkIGluIGEgc2VwZXJhdGUgbG9va3VwLiBUaGUga2V5cyBvZiB0aGlzIG1hcHBpbmcNCiAgICAvLyBhcmUgYHNoYTNgIGhhc2hlcyBvZiB0aGUgcHJpY2UgYW5kIHRyYWRlciBhZGRyZXNzLg0KICAgIC8vIFRoaXMgbWFwcGluZyBwcmV2ZW50cyBtb3JlIHRoYW4gb25lIG9yZGVyIGF0IGEgcGFydGljdWxhciBwcmljZS4NCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIGFtb3VudHM7DQoNCiAgICAvLyBUaGUgcHJpY2Vib29rIGlzIGEgbGlua2VkIGxpc3QgaG9sZGluZyBrZXlzIHRvIGxvb2t1cCB0aGUgcHJpY2UgRklGTydzDQogICAgTGliQ0xMdS5DTEwgcHJpY2VCb29rID0gb3JkZXJGSUZPc1swXTsNCg0KDQovKiBFdmVudHMgKi8NCg0KICAgIC8vIFRyaWdnZXJlZCBvbiBhIG1ha2Ugc2VsbCBvcmRlcg0KICAgIGV2ZW50IEFzayAodWludCBpbmRleGVkIHByaWNlLCB1aW50IGFtb3VudCwgYWRkcmVzcyBpbmRleGVkIHRyYWRlcik7DQoNCiAgICAvLyBUcmlnZ2VyZWQgb24gYSBtYWtlIGJ1eSBvcmRlcg0KICAgIGV2ZW50IEJpZCAodWludCBpbmRleGVkIHByaWNlLCB1aW50IGFtb3VudCwgYWRkcmVzcyBpbmRleGVkIHRyYWRlcik7DQoNCiAgICAvLyBUcmlnZ2VyZWQgb24gYSBmaWxsZWQgb3JkZXINCiAgICBldmVudCBTYWxlICh1aW50IGluZGV4ZWQgcHJpY2UsIHVpbnQgYW1vdW50LCBhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIGFkZHJlc3MgaW5kZXhlZCBzZWxsZXIpOw0KDQogICAgLy8gVHJpZ2dlcmVkIHdoZW4gdHJhZGluZyBpcyBzdGFydGVkIG9yIGhhbHRlZA0KICAgIGV2ZW50IFRyYWRpbmcoYm9vbCB0cmFkaW5nKTsNCg0KLyogRnVuY3Rpb25zIFB1YmxpYyBjb25zdGFudCAqLw0KDQogICAgLy8vIEBub3RpY2UgUmV0dXJucyBiZXN0IGJpZCBvciBhc2sgcHJpY2UuIA0KICAgIGZ1bmN0aW9uIHNwcmVhZChib29sIF9zaWRlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KTsNCiAgICANCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBvcmRlciBhbW91bnQgZm9yIHRyYWRlciBgX3RyYWRlcmAgYXQgJ19wcmljZScNCiAgICAvLy8gQHBhcmFtIF90cmFkZXIgQWRkcmVzcyBvZiB0cmFkZXINCiAgICAvLy8gQHBhcmFtIF9wcmljZSBQcmljZSBvZiBvcmRlcg0KICAgIGZ1bmN0aW9uIGdldEFtb3VudCh1aW50IF9wcmljZSwgYWRkcmVzcyBfdHJhZGVyKSANCiAgICAgICAgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCk7DQoNCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBjb2xsZWN0aXZlIG9yZGVyIHZvbHVtZSBhdCBhIGBfcHJpY2VgLg0KICAgIC8vLyBAcGFyYW0gX3ByaWNlIEZJRk8gZm9yIHByaWNlLg0KICAgIGZ1bmN0aW9uIGdldFByaWNlVm9sdW1lKHVpbnQgX3ByaWNlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQoNCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGFuIGFycmF5IG9mIGFsbCBwcmljZXMgYW5kIHRoZWlyIHZvbHVtZXMuDQogICAgLy8vIEBkZXYgW2V2ZW5dIGluZGVjaWVzIGFyZSB0aGUgcHJpY2UuIFtvZGRdIGFyZSB0aGUgdm9sdW1lLiBbMF0gaXMgdGhlDQogICAgLy8vIGluZGV4IG9mIHRoZSBzcHJlYWQuDQogICAgZnVuY3Rpb24gZ2V0Qm9vaygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50W10pOw0KDQovKiBGdW5jdGlvbnMgUHVibGljIG5vbi1jb25zdGFudCovDQoNCiAgICAvLy8gQG5vdGljZSBXaWxsIGJ1eSBgX2Ftb3VudGAgdG9rZW5zIGF0IG9yIGJlbG93IGBfcHJpY2VgIGVhY2guDQogICAgLy8vIEBwYXJhbSBfYmlkUHJpY2UgSGlnaGVzdCBwcmljZSB0byBiaWQuDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSByZXF1ZXN0ZWQgYW1vdW50IG9mIHRva2VucyB0byBidXkuDQogICAgLy8vIEBwYXJhbSBfbWFrZSBWYWx1ZSBvZiB0cnVlIHdpbGwgbWFrZSBvcmRlciBpZiBub3QgZmlsbGVkLg0KICAgIGZ1bmN0aW9uIGJ1eSAodWludCBfYmlkUHJpY2UsIHVpbnQgX2Ftb3VudCwgYm9vbCBfbWFrZSkNCiAgICAgICAgcGF5YWJsZSByZXR1cm5zIChib29sKTsNCg0KICAgIC8vLyBAbm90aWNlIFdpbGwgc2VsbCBgX2Ftb3VudGAgdG9rZW5zIGF0IG9yIGFib3ZlIGBfcHJpY2VgIGVhY2guDQogICAgLy8vIEBwYXJhbSBfYXNrUHJpY2UgTG93ZXN0IHByaWNlIHRvIGFzay4NCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHJlcXVlc3RlZCBhbW91bnQgb2YgdG9rZW5zIHRvIGJ1eS4NCiAgICAvLy8gQHBhcmFtIF9tYWtlIEEgdmFsdWUgb2YgdHJ1ZSB3aWxsIG1ha2UgYW4gb3JkZXIgaWYgbm90IG1hcmtldCBmaWxsZWQuDQogICAgZnVuY3Rpb24gc2VsbCAodWludCBfYXNrUHJpY2UsIHVpbnQgX2Ftb3VudCwgYm9vbCBfbWFrZSkNCiAgICAgICAgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy8gQG5vdGljZSBXaWxsIHdpdGhkcmF3IGBfZXRoZXJgIHRvIHlvdXIgYWNjb3VudC4NCiAgICAvLy8gQHBhcmFtIF9ldGhlciBUaGUgYW1vdW50IHRvIHdpdGhkcmF3DQogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludCBfZXRoZXIpDQogICAgICAgIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2Vzc18pOw0KDQogICAgLy8vIEBub3RpY2UgQ2FuY2VsIG9yZGVyIGF0IGBfcHJpY2VgDQogICAgLy8vIEBwYXJhbSBfcHJpY2UgVGhlIHByaWNlIGF0IHdoaWNoIHRoZSBvcmRlciB3YXMgcGxhY2VkLg0KICAgIGZ1bmN0aW9uIGNhbmNlbCh1aW50IF9wcmljZSkgDQogICAgICAgIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOw0KDQogICAgLy8vIEBub3RpY2UgV2lsbCBzZXQgdHJhZGluZyBzdGF0ZSB0byBgX3RyYWRpbmdgDQogICAgLy8vIEBwYXJhbSBfdHJhZGluZyBTdGF0ZSB0byBzZXQgdHJhZGluZyB0by4NCiAgICBmdW5jdGlvbiBzZXRUcmFkaW5nKGJvb2wgX3RyYWRpbmcpIA0KICAgICAgICBleHRlcm5hbCByZXR1cm5zIChib29sKTsNCn0NCg0KDQovKiBJbnRyaW5zaWNhbGx5IFRyYWRhYmxlIFRva2VuIGNvZGUgKi8gDQoNCmNvbnRyYWN0IElUVCBpcyBFUkMyMFRva2VuLCBJVFRJbnRlcmZhY2UNCnsNCg0KLyogU3RydWN0cyAqLw0KDQovKiBNb2RpZmllcnMgKi8NCg0KICAgIC8vLyBAZGV2IFBhc3NlcyBpZiB0b2tlbiBpcyBjdXJyZW50bHkgdHJhZGluZw0KICAgIG1vZGlmaWVyIGlzVHJhZGluZygpIHsNCiAgICAgICAgaWYgKCF0cmFkaW5nKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBWYWxpZGF0ZSBidXkgcGFyYW1ldGVycw0KICAgIG1vZGlmaWVyIGlzVmFsaWRCdXkodWludCBfYmlkUHJpY2UsIHVpbnQgX2Ftb3VudCkgew0KICAgICAgICBpZiAoKGV0aGVyQmFsYW5jZVttc2cuc2VuZGVyXSArIG1zZy52YWx1ZSkgPCAoX2Ftb3VudCAqIF9iaWRQcmljZSkgfHwNCiAgICAgICAgICAgIF9hbW91bnQgPT0gMCB8fCBfYW1vdW50ID4gdG90YWxTdXBwbHkgfHwNCiAgICAgICAgICAgIF9iaWRQcmljZSA8PSBNSU5QUklDRSB8fCBfYmlkUHJpY2UgPj0gTUFYTlVNKSB0aHJvdzsgLy8gaGFzIGluc3VmZmljaWVudCBldGhlci4NCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBWYWxpZGF0ZXMgc2VsbCBwYXJhbWV0ZXJzLiBQcmljZSBtdXN0IGJlIGxhcmdlciB0aGFuIDEuDQogICAgbW9kaWZpZXIgaXNWYWxpZFNlbGwodWludCBfYXNrUHJpY2UsIHVpbnQgX2Ftb3VudCkgew0KICAgICAgICBpZiAoX2Ftb3VudCA+IGJhbGFuY2VbbXNnLnNlbmRlcl0gfHwgX2Ftb3VudCA9PSAwIHx8DQogICAgICAgICAgICBfYXNrUHJpY2UgPCBNSU5QUklDRSB8fCBfYXNrUHJpY2UgPiBNQVhOVU0pIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCiAgICANCiAgICAvLy8gQGRldiBWYWxpZGF0ZXMgZXRoZXIgYmFsYW5jZQ0KICAgIG1vZGlmaWVyIGhhc0V0aGVyKGFkZHJlc3MgX21lbWJlciwgdWludCBfZXRoZXIpIHsNCiAgICAgICAgaWYgKGV0aGVyQmFsYW5jZVtfbWVtYmVyXSA8IF9ldGhlcikgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLy8vIEBkZXYgVmFsaWRhdGVzIHRva2VuIGJhbGFuY2UNCiAgICBtb2RpZmllciBoYXNCYWxhbmNlKGFkZHJlc3MgX21lbWJlciwgdWludCBfYW1vdW50KSB7DQogICAgICAgIGlmIChiYWxhbmNlW19tZW1iZXJdIDwgX2Ftb3VudCkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQovKiBGdW5jdGlvbnMgKi8NCg0KICAgIGZ1bmN0aW9uIElUVCgNCiAgICAgICAgdWludCBfdG90YWxTdXBwbHksDQogICAgICAgIHVpbnQ4IF9kZWNpbWFsUGxhY2VzLA0KICAgICAgICBzdHJpbmcgX3N5bWJvbCwNCiAgICAgICAgc3RyaW5nIF9uYW1lDQogICAgICAgICkNCiAgICAgICAgICAgIEVSQzIwVG9rZW4oDQogICAgICAgICAgICAgICAgX3RvdGFsU3VwcGx5LA0KICAgICAgICAgICAgICAgIF9kZWNpbWFsUGxhY2VzLA0KICAgICAgICAgICAgICAgIF9zeW1ib2wsDQogICAgICAgICAgICAgICAgX25hbWUNCiAgICAgICAgICAgICAgICApDQogICAgew0KICAgICAgICAvLyBzZXR1cCBwcmljZWJvb2sgYW5kIG1heGltdW0gc3ByZWFkLg0KICAgICAgICBwcmljZUJvb2suY2xsW0hFQURdW1BSRVZdID0gTUlOUFJJQ0U7DQogICAgICAgIHByaWNlQm9vay5jbGxbTUlOUFJJQ0VdW1BSRVZdID0gTUFYTlVNOw0KICAgICAgICBwcmljZUJvb2suY2xsW0hFQURdW05FWFRdID0gTUFYTlVNOw0KICAgICAgICBwcmljZUJvb2suY2xsW01BWE5VTV1bTkVYVF0gPSBNSU5QUklDRTsNCiAgICAgICAgdHJhZGluZyA9IHRydWU7DQogICAgICAgIGJhbGFuY2Vbb3duZXJdID0gdG90YWxTdXBwbHk7DQogICAgfQ0KDQovKiBGdW5jdGlvbnMgR2V0dGVycyAqLw0KDQogICAgZnVuY3Rpb24gdmVyc2lvbigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHN0cmluZykgew0KICAgICAgICByZXR1cm4gVkVSU0lPTjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBldGhlckJhbGFuY2VPZihhZGRyZXNzIF9hZGRyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gZXRoZXJCYWxhbmNlW19hZGRyXTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzcHJlYWQoYm9vbCBfc2lkZSkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgew0KICAgICAgICByZXR1cm4gcHJpY2VCb29rLnN0ZXAoSEVBRCwgX3NpZGUpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldEFtb3VudCh1aW50IF9wcmljZSwgYWRkcmVzcyBfdHJhZGVyKSANCiAgICAgICAgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgew0KICAgICAgICByZXR1cm4gYW1vdW50c1tzaGEzKF9wcmljZSwgX3RyYWRlcildOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNpemVPZih1aW50IGwpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcykgew0KICAgICAgICBpZihsID09IDApIHJldHVybiBwcmljZUJvb2suc2l6ZU9mKCk7DQogICAgICAgIHJldHVybiBvcmRlckZJRk9zW2xdLnNpemVPZigpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBnZXRQcmljZVZvbHVtZSh1aW50IF9wcmljZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdl8pDQogICAgew0KICAgICAgICB1aW50IG4gPSBvcmRlckZJRk9zW19wcmljZV0uc3RlcChIRUFELE5FWFQpOw0KICAgICAgICB3aGlsZSAobiAhPSBIRUFEKSB7IA0KICAgICAgICAgICAgdl8gKz0gYW1vdW50c1tzaGEzKF9wcmljZSwgYWRkcmVzcyhuKSldOw0KICAgICAgICAgICAgbiA9IG9yZGVyRklGT3NbX3ByaWNlXS5zdGVwKG4sIE5FWFQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRCb29rKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnRbXSkNCiAgICB7DQogICAgICAgIHVpbnQgaTsgDQogICAgICAgIHVpbnQgcCA9IHByaWNlQm9vay5zdGVwKE1JTk5VTSwgTkVYVCk7DQogICAgICAgIHVpbnRbXSBtZW1vcnkgdm9sdW1lcyA9IG5ldyB1aW50W10ocHJpY2VCb29rLnNpemVPZigpICogMiAtIDIpOw0KICAgICAgICB3aGlsZSAocCA8IE1BWE5VTSkgew0KICAgICAgICAgICAgdm9sdW1lc1tpKytdID0gcDsNCiAgICAgICAgICAgIHZvbHVtZXNbaSsrXSA9IGdldFByaWNlVm9sdW1lKHApOw0KICAgICAgICAgICAgcCA9IHByaWNlQm9vay5zdGVwKHAsIE5FWFQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB2b2x1bWVzOyANCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gbnVtT3JkZXJzT2YoYWRkcmVzcyBfYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpDQogICAgew0KICAgICAgICB1aW50IGM7DQogICAgICAgIHVpbnQgcCA9IE1JTk5VTTsNCiAgICAgICAgd2hpbGUgKHAgPCBNQVhOVU0pIHsNCiAgICAgICAgICAgIGlmIChhbW91bnRzW3NoYTMocCwgX2FkZHIpXSA+IDApIGMrKzsNCiAgICAgICAgICAgIHAgPSBwcmljZUJvb2suc3RlcChwLCBORVhUKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYzsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gZ2V0T3Blbk9yZGVyc09mKGFkZHJlc3MgX2FkZHIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50W10pDQogICAgew0KICAgICAgICB1aW50IGk7DQogICAgICAgIHVpbnQgYzsNCiAgICAgICAgdWludCBwID0gTUlOTlVNOw0KICAgICAgICB1aW50W10gbWVtb3J5IG9wZW4gPSBuZXcgdWludFtdKG51bU9yZGVyc09mKF9hZGRyKSoyKTsNCiAgICAgICAgcCA9IE1JTk5VTTsNCiAgICAgICAgd2hpbGUgKHAgPCBNQVhOVU0pIHsNCiAgICAgICAgICAgIGlmIChhbW91bnRzW3NoYTMocCwgX2FkZHIpXSA+IDApIHsNCiAgICAgICAgICAgICAgICBvcGVuW2krK10gPSBwOw0KICAgICAgICAgICAgICAgIG9wZW5baSsrXSA9IGFtb3VudHNbc2hhMyhwLCBfYWRkcildOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcCA9IHByaWNlQm9vay5zdGVwKHAsIE5FWFQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBvcGVuOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldE5vZGUodWludCBfbGlzdCwgdWludCBfbm9kZSkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludFsyXSkNCiAgICB7DQogICAgICAgIHJldHVybiBbb3JkZXJGSUZPc1tfbGlzdF0uY2xsW19ub2RlXVtQUkVWXSwgDQogICAgICAgICAgICBvcmRlckZJRk9zW19saXN0XS5jbGxbX25vZGVdW05FWFRdXTsNCiAgICB9DQogICAgDQovKiBGdW5jdGlvbnMgUHVibGljICovDQoNCi8vIEhlcmUgbm9uLWNvbnN0YW50IHB1YmxpYyBmdW5jdGlvbnMgYWN0IGFzIGEgc2VjdXJpdHkgbGF5ZXIuIFRoZXkgYXJlIHJlLWVudHJ5DQovLyBwcm90ZWN0ZWQgc28gY2Fubm90IGNhbGwgZWFjaCBvdGhlci4gRm9yIHRoaXMgcmVhc29uLCB0aGV5DQovLyBhcmUgYmVpbmcgdXNlZCBmb3IgcGFyYW1ldGVyIGFuZCBlbnRlcmFuY2UgdmFsaWRhdGlvbiwgd2hpbGUgaW50ZXJuYWwNCi8vIGZ1bmN0aW9ucyBtYW5hZ2UgdGhlIGxvZ2ljLiBUaGlzIGFsc28gYWxsb3dzIGZvciBkZXJpdmluZyBjb250cmFjdHMgdG8NCi8vIG92ZXJsb2FkIHRoZSBwdWJsaWMgZnVuY3Rpb24gd2l0aCBjdXN0b21pc2VkIHZhbGlkYXRpb25zIGFuZCBub3QgaGF2ZSB0bw0KLy8gd29ycnkgYWJvdXQgcmV3cml0dGluZyB0aGUgbG9naWMuDQoNCiAgICBmdW5jdGlvbiBidXkgKHVpbnQgX2JpZFByaWNlLCB1aW50IF9hbW91bnQsIGJvb2wgX21ha2UpDQogICAgICAgIHBheWFibGUNCiAgICAgICAgY2FuRW50ZXINCiAgICAgICAgaXNUcmFkaW5nDQogICAgICAgIGlzVmFsaWRCdXkoX2JpZFByaWNlLCBfYW1vdW50KQ0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgdHJhZGUoX2JpZFByaWNlLCBfYW1vdW50LCBCSUQsIF9tYWtlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2VsbCAodWludCBfYXNrUHJpY2UsIHVpbnQgX2Ftb3VudCwgYm9vbCBfbWFrZSkNCiAgICAgICAgZXh0ZXJuYWwNCiAgICAgICAgY2FuRW50ZXINCiAgICAgICAgaXNUcmFkaW5nDQogICAgICAgIGlzVmFsaWRTZWxsKF9hc2tQcmljZSwgX2Ftb3VudCkNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIHRyYWRlKF9hc2tQcmljZSwgX2Ftb3VudCwgQVNLLCBfbWFrZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgX2V0aGVyKQ0KICAgICAgICBleHRlcm5hbA0KICAgICAgICBjYW5FbnRlcg0KICAgICAgICBoYXNFdGhlcihtc2cuc2VuZGVyLCBfZXRoZXIpDQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzc18pDQogICAgew0KICAgICAgICBldGhlckJhbGFuY2VbbXNnLnNlbmRlcl0gLT0gX2V0aGVyOw0KICAgICAgICBzYWZlU2VuZChtc2cuc2VuZGVyLCBfZXRoZXIpOw0KICAgICAgICBzdWNjZXNzXyA9IHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2FuY2VsKHVpbnQgX3ByaWNlKQ0KICAgICAgICBleHRlcm5hbA0KICAgICAgICBjYW5FbnRlcg0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgVHJhZGVNZXNzYWdlIG1lbW9yeSB0bXNnOw0KICAgICAgICB0bXNnLnByaWNlID0gX3ByaWNlOw0KICAgICAgICB0bXNnLmJhbGFuY2UgPSBiYWxhbmNlW21zZy5zZW5kZXJdOw0KICAgICAgICB0bXNnLmV0aGVyQmFsYW5jZSA9IGV0aGVyQmFsYW5jZVttc2cuc2VuZGVyXTsNCiAgICAgICAgY2FuY2VsSW50bCh0bXNnKTsNCiAgICAgICAgYmFsYW5jZVttc2cuc2VuZGVyXSA9IHRtc2cuYmFsYW5jZTsNCiAgICAgICAgZXRoZXJCYWxhbmNlW21zZy5zZW5kZXJdID0gdG1zZy5ldGhlckJhbGFuY2U7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBzZXRUcmFkaW5nKGJvb2wgX3RyYWRpbmcpDQogICAgICAgIGV4dGVybmFsDQogICAgICAgIG9ubHlPd25lcg0KICAgICAgICBjYW5FbnRlcg0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgdHJhZGluZyA9IF90cmFkaW5nOw0KICAgICAgICBUcmFkaW5nKHRydWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCi8qIEZ1bmN0aW9ucyBJbnRlcm5hbCAqLw0KDQovLyBJbnRlcm5hbCBmdW5jdGlvbnMgaGFuZGxlIHRoaXMgY29udHJhY3QncyBsb2dpYy4NCg0KICAgIGZ1bmN0aW9uIHRyYWRlICh1aW50IF9wcmljZSwgdWludCBfYW1vdW50LCBib29sIF9zaWRlLCBib29sIF9tYWtlKSBpbnRlcm5hbCB7DQogICAgICAgIFRyYWRlTWVzc2FnZSBtZW1vcnkgdG1zZzsNCiAgICAgICAgdG1zZy5wcmljZSA9IF9wcmljZTsNCiAgICAgICAgdG1zZy50cmFkZUFtb3VudCA9IF9hbW91bnQ7DQogICAgICAgIHRtc2cuc2lkZSA9IF9zaWRlOw0KICAgICAgICB0bXNnLm1ha2UgPSBfbWFrZTsNCiAgICAgICAgDQogICAgICAgIC8vIENhY2hlIHN0YXRlIGJhbGFuY2VzIHRvIG1lbW9yeSBhbmQgY29tbWl0IHRvIHN0b3JhZ2Ugb25seSBvbmNlIGFmdGVyIHRyYWRlLg0KICAgICAgICB0bXNnLmJhbGFuY2UgID0gYmFsYW5jZVttc2cuc2VuZGVyXTsNCiAgICAgICAgdG1zZy5ldGhlckJhbGFuY2UgPSBldGhlckJhbGFuY2VbbXNnLnNlbmRlcl0gKyBtc2cudmFsdWU7DQoNCiAgICAgICAgdGFrZSh0bXNnKTsNCiAgICAgICAgbWFrZSh0bXNnKTsNCiAgICAgICAgDQogICAgICAgIGJhbGFuY2VbbXNnLnNlbmRlcl0gPSB0bXNnLmJhbGFuY2U7DQogICAgICAgIGV0aGVyQmFsYW5jZVttc2cuc2VuZGVyXSA9IHRtc2cuZXRoZXJCYWxhbmNlOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiB0YWtlIChUcmFkZU1lc3NhZ2UgdG1zZykNCiAgICAgICAgaW50ZXJuYWwNCiAgICB7DQogICAgICAgIGFkZHJlc3MgbWFrZXI7DQogICAgICAgIGJ5dGVzMzIgb3JkZXJIYXNoOw0KICAgICAgICB1aW50IHRha2VBbW91bnQ7DQogICAgICAgIHVpbnQgdGFrZUV0aGVyOw0KICAgICAgICAvLyB1c2Ugb2Ygc2lnbmVkIG1hdGggb24gdW5zaWduZWQgaW50cyBpcyBpbnRlbnRpb25hbA0KICAgICAgICB1aW50IHNpZ24gPSB0bXNnLnNpZGUgPyB1aW50KDEpIDogdWludCgtMSk7DQogICAgICAgIHVpbnQgYmVzdFByaWNlID0gc3ByZWFkKCF0bXNnLnNpZGUpOw0KDQogICAgICAgIC8vIExvb3Agd2l0aCBhdmFpbGFibGUgZ2FzIHRvIHRha2Ugb3JkZXJzDQogICAgICAgIHdoaWxlICgNCiAgICAgICAgICAgIHRtc2cudHJhZGVBbW91bnQgPiAwICYmDQogICAgICAgICAgICBjbXBFcSh0bXNnLnByaWNlLCBiZXN0UHJpY2UsICF0bXNnLnNpZGUpICYmIA0KICAgICAgICAgICAgbXNnLmdhcyA+IE1JTkdBUw0KICAgICAgICApDQogICAgICAgIHsNCiAgICAgICAgICAgIG1ha2VyID0gYWRkcmVzcyhvcmRlckZJRk9zW2Jlc3RQcmljZV0uc3RlcChIRUFELCBORVhUKSk7DQogICAgICAgICAgICBvcmRlckhhc2ggPSBzaGEzKGJlc3RQcmljZSwgbWFrZXIpOw0KICAgICAgICAgICAgaWYgKHRtc2cudHJhZGVBbW91bnQgPCBhbW91bnRzW29yZGVySGFzaF0pIHsNCiAgICAgICAgICAgICAgICAvLyBQcmVwYXJlIHRvIHRha2UgcGFydGlhbCBvcmRlcg0KICAgICAgICAgICAgICAgIGFtb3VudHNbb3JkZXJIYXNoXSA9IHNhZmVTdWIoYW1vdW50c1tvcmRlckhhc2hdLCB0bXNnLnRyYWRlQW1vdW50KTsNCiAgICAgICAgICAgICAgICB0YWtlQW1vdW50ID0gdG1zZy50cmFkZUFtb3VudDsNCiAgICAgICAgICAgICAgICB0bXNnLnRyYWRlQW1vdW50ID0gMDsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gUHJlcGFyZSB0byB0YWtlIGZ1bGwgb3JkZXINCiAgICAgICAgICAgICAgICB0YWtlQW1vdW50ID0gYW1vdW50c1tvcmRlckhhc2hdOw0KICAgICAgICAgICAgICAgIHRtc2cudHJhZGVBbW91bnQgPSBzYWZlU3ViKHRtc2cudHJhZGVBbW91bnQsIHRha2VBbW91bnQpOw0KICAgICAgICAgICAgICAgIGNsb3NlT3JkZXIoYmVzdFByaWNlLCBtYWtlcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0YWtlRXRoZXIgPSBzYWZlTXVsKGJlc3RQcmljZSwgdGFrZUFtb3VudCk7DQogICAgICAgICAgICAvLyBzaWduZWQgbXVsdGlwbHkgb24gdWludHMgaXMgaW50ZW50aW9uYWwgYW5kIHNvIHNhZmVNYXRocyB3aWxsIA0KICAgICAgICAgICAgLy8gYnJlYWsgaGVyZS4gVmFsaWQgcmFuZ2UgZm9yIGV4aXQgYmFsYW5jZXMgYXJlIDAuLjIqKjEyOCANCiAgICAgICAgICAgIHRtc2cuZXRoZXJCYWxhbmNlICs9IHRha2VFdGhlciAqIHNpZ247DQogICAgICAgICAgICB0bXNnLmJhbGFuY2UgLT0gdGFrZUFtb3VudCAqIHNpZ247DQogICAgICAgICAgICBpZiAodG1zZy5zaWRlKSB7DQogICAgICAgICAgICAgICAgLy8gU2VsbCB0byBiaWRkZXINCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBtYWtlcikgew0KICAgICAgICAgICAgICAgICAgICAvLyBiaWRkZXIgaXMgc2VsZg0KICAgICAgICAgICAgICAgICAgICB0bXNnLmJhbGFuY2UgKz0gdGFrZUFtb3VudDsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBiYWxhbmNlW21ha2VyXSArPSB0YWtlQW1vdW50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gQnV5IGZyb20gYXNrZXI7DQogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gbWFrZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gYXNrZXIgaXMgc2VsZg0KICAgICAgICAgICAgICAgICAgICB0bXNnLmV0aGVyQmFsYW5jZSArPSB0YWtlRXRoZXI7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGV0aGVyQmFsYW5jZVttYWtlcl0gKz0gdGFrZUV0aGVyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIHByZXAgZm9yIG5leHQgb3JkZXINCiAgICAgICAgICAgIGJlc3RQcmljZSA9IHNwcmVhZCghdG1zZy5zaWRlKTsNCiAgICAgICAgICAgIFNhbGUgKGJlc3RQcmljZSwgdGFrZUFtb3VudCwgbXNnLnNlbmRlciwgbWFrZXIpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbWFrZShUcmFkZU1lc3NhZ2UgdG1zZykNCiAgICAgICAgaW50ZXJuYWwNCiAgICB7DQogICAgICAgIGJ5dGVzMzIgb3JkZXJIYXNoOw0KICAgICAgICBpZiAodG1zZy50cmFkZUFtb3VudCA9PSAwIHx8ICF0bXNnLm1ha2UgfHwgbXNnLmdhcyA8IE1JTkdBUykgcmV0dXJuOw0KICAgICAgICBvcmRlckhhc2ggPSBzaGEzKHRtc2cucHJpY2UsIG1zZy5zZW5kZXIpOw0KICAgICAgICBpZiAoYW1vdW50c1tvcmRlckhhc2hdICE9IDApIHsNCiAgICAgICAgICAgIC8vIENhbmNlbCBhbnkgcHJlLWV4aXN0aW5nIG93bmVkIG9yZGVyIGF0IHRoaXMgcHJpY2UNCiAgICAgICAgICAgIGNhbmNlbEludGwodG1zZyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvcmRlckZJRk9zW3Rtc2cucHJpY2VdLmV4aXN0cygpKSB7DQogICAgICAgICAgICAvLyBSZWdpc3RlciBwcmljZSBpbiBwcmljZWJvb2sNCiAgICAgICAgICAgIHByaWNlQm9vay5pbnNlcnQoDQogICAgICAgICAgICAgICAgcHJpY2VCb29rLnNlZWsoSEVBRCwgdG1zZy5wcmljZSwgdG1zZy5zaWRlKSwNCiAgICAgICAgICAgICAgICB0bXNnLnByaWNlLCAhdG1zZy5zaWRlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGFtb3VudHNbb3JkZXJIYXNoXSA9IHRtc2cudHJhZGVBbW91bnQ7DQogICAgICAgIG9yZGVyRklGT3NbdG1zZy5wcmljZV0ucHVzaCh1aW50KG1zZy5zZW5kZXIpLCBQUkVWKTsgDQoNCiAgICAgICAgaWYgKHRtc2cuc2lkZSkgew0KICAgICAgICAgICAgdG1zZy5iYWxhbmNlIC09IHRtc2cudHJhZGVBbW91bnQ7DQogICAgICAgICAgICBBc2sgKHRtc2cucHJpY2UsIHRtc2cudHJhZGVBbW91bnQsIG1zZy5zZW5kZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdG1zZy5ldGhlckJhbGFuY2UgLT0gdG1zZy50cmFkZUFtb3VudCAqIHRtc2cucHJpY2U7DQogICAgICAgICAgICBCaWQgKHRtc2cucHJpY2UsIHRtc2cudHJhZGVBbW91bnQsIG1zZy5zZW5kZXIpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2FuY2VsSW50bChUcmFkZU1lc3NhZ2UgdG1zZykgaW50ZXJuYWwgew0KICAgICAgICB1aW50IGFtb3VudCA9IGFtb3VudHNbc2hhMyh0bXNnLnByaWNlLCBtc2cuc2VuZGVyKV07DQogICAgICAgIGlmIChhbW91bnQgPT0gMCkgcmV0dXJuOw0KICAgICAgICBpZiAodG1zZy5wcmljZSA+IHNwcmVhZChCSUQpKSB0bXNnLmJhbGFuY2UgKz0gYW1vdW50OyAvLyB3YXMgYXNrDQogICAgICAgIGVsc2UgdG1zZy5ldGhlckJhbGFuY2UgKz0gdG1zZy5wcmljZSAqIGFtb3VudDsgLy8gd2FzIGJpZA0KICAgICAgICBjbG9zZU9yZGVyKHRtc2cucHJpY2UsIG1zZy5zZW5kZXIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNsb3NlT3JkZXIodWludCBfcHJpY2UsIGFkZHJlc3MgX3RyYWRlcikgaW50ZXJuYWwgew0KICAgICAgICBvcmRlckZJRk9zW19wcmljZV0ucmVtb3ZlKHVpbnQoX3RyYWRlcikpOw0KICAgICAgICBpZiAoIW9yZGVyRklGT3NbX3ByaWNlXS5leGlzdHMoKSkgIHsNCiAgICAgICAgICAgIHByaWNlQm9vay5yZW1vdmUoX3ByaWNlKTsNCiAgICAgICAgfQ0KICAgICAgICBkZWxldGUgYW1vdW50c1tzaGEzKF9wcmljZSwgX3RyYWRlcildOw0KICAgIH0NCn0='