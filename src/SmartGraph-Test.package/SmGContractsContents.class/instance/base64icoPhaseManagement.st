base 64 content
base64icoPhaseManagement
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLyoqDQogKiBAdGl0bGUgU2FmZU1hdGgNCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yDQogKi8NCmxpYnJhcnkgU2FmZU1hdGggew0KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICB1aW50MjU2IGMgPSBhICogYjsNCiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwDQogICAgdWludDI1NiBjID0gYSAvIGI7DQogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIGFzc2VydChiIDw9IGEpOw0KICAgIHJldHVybiBhIC0gYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHVpbnQyNTYgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjID49IGEpOw0KICAgIHJldHVybiBjOw0KICB9DQp9DQoNCi8qIFRoZSBhdXRoZW50aWNhdGlvbiBtYW5hZ2VyIGRldGFpbHMgdXNlciBhY2NvdW50cyB0aGF0IGhhdmUgYWNjZXNzIHRvIGNlcnRhaW4gcHJpdmlsZWRnZXMgYW5kIGtlZXBzIGEgcGVybWFuZW50IGxlZGdlciBvZiB3aG8gaGFzIGFuZCBoYXMgaGFkIHRoZXNlIHJpZ2h0cy4gKi8NCmNvbnRyYWN0IEF1dGhlbnRpY2F0aW9uTWFuYWdlciB7DQogICAgLyogTWFwIGFkZHJlc3NlcyB0byBhZG1pbnMgKi8NCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGFkbWluQWRkcmVzc2VzOw0KDQogICAgLyogTWFwIGFkZHJlc3NlcyB0byBhY2NvdW50IHJlYWRlcnMgKi8NCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGFjY291bnRSZWFkZXJBZGRyZXNzZXM7DQoNCiAgICAvKiBEZXRhaWxzIG9mIGFsbCBhZG1pbnMgdGhhdCBoYXZlIGV2ZXIgZXhpc3RlZCAqLw0KICAgIGFkZHJlc3NbXSBhZG1pbkF1ZGl0Ow0KDQogICAgLyogRGV0YWlscyBvZiBhbGwgYWNjb3VudCByZWFkZXJzIHRoYXQgaGF2ZSBldmVyIGV4aXN0ZWQgKi8NCiAgICBhZGRyZXNzW10gYWNjb3VudFJlYWRlckF1ZGl0Ow0KDQogICAgLyogRmlyZWQgd2hlbmV2ZXIgYW4gYWRtaW4gaXMgYWRkZWQgdG8gdGhlIGNvbnRyYWN0LiAqLw0KICAgIGV2ZW50IEFkbWluQWRkZWQoYWRkcmVzcyBhZGRlZEJ5LCBhZGRyZXNzIGFkbWluKTsNCg0KICAgIC8qIEZpcmVkIHdoZW5ldmVyIGFuIGFkbWluIGlzIHJlbW92ZWQgZnJvbSB0aGUgY29udHJhY3QuICovDQogICAgZXZlbnQgQWRtaW5SZW1vdmVkKGFkZHJlc3MgcmVtb3ZlZEJ5LCBhZGRyZXNzIGFkbWluKTsNCg0KICAgIC8qIEZpcmVkIHdoZW5ldmVyIGFuIGFjY291bnQtcmVhZGVyIGNvbnRyYWN0IGlzIGFkZGVkLiAqLw0KICAgIGV2ZW50IEFjY291bnRSZWFkZXJBZGRlZChhZGRyZXNzIGFkZGVkQnksIGFkZHJlc3MgYWNjb3VudCk7DQoNCiAgICAvKiBGaXJlZCB3aGVuZXZlciBhbiBhY2NvdW50LXJlYWRlciBjb250cmFjdCBpcyByZW1vdmVkLiAqLw0KICAgIGV2ZW50IEFjY291bnRSZWFkZXJSZW1vdmVkKGFkZHJlc3MgcmVtb3ZlZEJ5LCBhZGRyZXNzIGFjY291bnQpOw0KDQogICAgLyogV2hlbiB0aGlzIGNvbnRyYWN0IGlzIGZpcnN0IHNldHVwIHdlIHVzZSB0aGUgY3JlYXRvciBhcyB0aGUgZmlyc3QgYWRtaW4gKi8gICAgDQogICAgZnVuY3Rpb24gQXV0aGVudGljYXRpb25NYW5hZ2VyKCkgew0KICAgICAgICAvKiBTZXQgdGhlIGZpcnN0IGFkbWluIHRvIGJlIHRoZSBwZXJzb24gY3JlYXRpbmcgdGhlIGNvbnRyYWN0ICovDQogICAgICAgIGFkbWluQWRkcmVzc2VzW21zZy5zZW5kZXJdID0gdHJ1ZTsNCiAgICAgICAgQWRtaW5BZGRlZCgwLCBtc2cuc2VuZGVyKTsNCiAgICAgICAgYWRtaW5BdWRpdC5sZW5ndGgrKzsNCiAgICAgICAgYWRtaW5BdWRpdFthZG1pbkF1ZGl0Lmxlbmd0aCAtIDFdID0gbXNnLnNlbmRlcjsNCiAgICB9DQoNCiAgICAvKiBHZXRzIHRoZSBjb250cmFjdCB2ZXJzaW9uIGZvciB2YWxpZGF0aW9uICovDQogICAgZnVuY3Rpb24gY29udHJhY3RWZXJzaW9uKCkgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7DQogICAgICAgIC8vIEFkbWluIGNvbnRyYWN0IGlkZW50aWZpZXMgYXMgMTAwWVlZWU1NRERISE1NDQogICAgICAgIHJldHVybiAxMDAyMDE3MDcxNzE1MDM7DQogICAgfQ0KDQogICAgLyogR2V0cyB3aGV0aGVyIG9yIG5vdCB0aGUgc3BlY2lmaWVkIGFkZHJlc3MgaXMgY3VycmVudGx5IGFuIGFkbWluICovDQogICAgZnVuY3Rpb24gaXNDdXJyZW50QWRtaW4oYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gYWRtaW5BZGRyZXNzZXNbX2FkZHJlc3NdOw0KICAgIH0NCg0KICAgIC8qIEdldHMgd2hldGhlciBvciBub3QgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGhhcyBldmVyIGJlZW4gYW4gYWRtaW4gKi8NCiAgICBmdW5jdGlvbiBpc0N1cnJlbnRPclBhc3RBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGFkbWluQXVkaXQubGVuZ3RoOyBpKyspDQogICAgICAgICAgICBpZiAoYWRtaW5BdWRpdFtpXSA9PSBfYWRkcmVzcykNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8qIEdldHMgd2hldGhlciBvciBub3QgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGlzIGN1cnJlbnRseSBhbiBhY2NvdW50IHJlYWRlciAqLw0KICAgIGZ1bmN0aW9uIGlzQ3VycmVudEFjY291bnRSZWFkZXIoYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gYWNjb3VudFJlYWRlckFkZHJlc3Nlc1tfYWRkcmVzc107DQogICAgfQ0KDQogICAgLyogR2V0cyB3aGV0aGVyIG9yIG5vdCB0aGUgc3BlY2lmaWVkIGFkZHJlc3MgaGFzIGV2ZXIgYmVlbiBhbiBhZG1pbiAqLw0KICAgIGZ1bmN0aW9uIGlzQ3VycmVudE9yUGFzdEFjY291bnRSZWFkZXIoYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBhY2NvdW50UmVhZGVyQXVkaXQubGVuZ3RoOyBpKyspDQogICAgICAgICAgICBpZiAoYWNjb3VudFJlYWRlckF1ZGl0W2ldID09IF9hZGRyZXNzKQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLyogQWRkcyBhIHVzZXIgdG8gb3VyIGxpc3Qgb2YgYWRtaW5zICovDQogICAgZnVuY3Rpb24gYWRkQWRtaW4oYWRkcmVzcyBfYWRkcmVzcykgew0KICAgICAgICAvKiBFbnN1cmUgd2UncmUgYW4gYWRtaW4gKi8NCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIC8vIEZhaWwgaWYgdGhpcyBhY2NvdW50IGlzIGFscmVhZHkgYWRtaW4NCiAgICAgICAgaWYgKGFkbWluQWRkcmVzc2VzW19hZGRyZXNzXSkNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICANCiAgICAgICAgLy8gQWRkIHRoZSB1c2VyDQogICAgICAgIGFkbWluQWRkcmVzc2VzW19hZGRyZXNzXSA9IHRydWU7DQogICAgICAgIEFkbWluQWRkZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOw0KICAgICAgICBhZG1pbkF1ZGl0Lmxlbmd0aCsrOw0KICAgICAgICBhZG1pbkF1ZGl0W2FkbWluQXVkaXQubGVuZ3RoIC0gMV0gPSBfYWRkcmVzczsNCiAgICB9DQoNCiAgICAvKiBSZW1vdmVzIGEgdXNlciBmcm9tIG91ciBsaXN0IG9mIGFkbWlucyBidXQga2VlcHMgdGhlbSBpbiB0aGUgaGlzdG9yeSBhdWRpdCAqLw0KICAgIGZ1bmN0aW9uIHJlbW92ZUFkbWluKGFkZHJlc3MgX2FkZHJlc3MpIHsNCiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovDQogICAgICAgIGlmICghaXNDdXJyZW50QWRtaW4obXNnLnNlbmRlcikpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvKiBEb24ndCBhbGxvdyByZW1vdmFsIG9mIHNlbGYgKi8NCiAgICAgICAgaWYgKF9hZGRyZXNzID09IG1zZy5zZW5kZXIpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvLyBGYWlsIGlmIHRoaXMgYWNjb3VudCBpcyBhbHJlYWR5IG5vbi1hZG1pbg0KICAgICAgICBpZiAoIWFkbWluQWRkcmVzc2VzW19hZGRyZXNzXSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIC8qIFJlbW92ZSB0aGlzIGFkbWluIHVzZXIgKi8NCiAgICAgICAgYWRtaW5BZGRyZXNzZXNbX2FkZHJlc3NdID0gZmFsc2U7DQogICAgICAgIEFkbWluUmVtb3ZlZChtc2cuc2VuZGVyLCBfYWRkcmVzcyk7DQogICAgfQ0KDQogICAgLyogQWRkcyBhIHVzZXIvY29udHJhY3QgdG8gb3VyIGxpc3Qgb2YgYWNjb3VudCByZWFkZXJzICovDQogICAgZnVuY3Rpb24gYWRkQWNjb3VudFJlYWRlcihhZGRyZXNzIF9hZGRyZXNzKSB7DQogICAgICAgIC8qIEVuc3VyZSB3ZSdyZSBhbiBhZG1pbiAqLw0KICAgICAgICBpZiAoIWlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLy8gRmFpbCBpZiB0aGlzIGFjY291bnQgaXMgYWxyZWFkeSBpbiB0aGUgbGlzdA0KICAgICAgICBpZiAoYWNjb3VudFJlYWRlckFkZHJlc3Nlc1tfYWRkcmVzc10pDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIC8vIEFkZCB0aGUgdXNlcg0KICAgICAgICBhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXSA9IHRydWU7DQogICAgICAgIEFjY291bnRSZWFkZXJBZGRlZChtc2cuc2VuZGVyLCBfYWRkcmVzcyk7DQogICAgICAgIGFjY291bnRSZWFkZXJBdWRpdC5sZW5ndGgrKzsNCiAgICAgICAgYWNjb3VudFJlYWRlckF1ZGl0W2FkbWluQXVkaXQubGVuZ3RoIC0gMV0gPSBfYWRkcmVzczsNCiAgICB9DQoNCiAgICAvKiBSZW1vdmVzIGEgdXNlci9jb250cmFjdHMgZnJvbSBvdXIgbGlzdCBvZiBhY2NvdW50IHJlYWRlcnMgYnV0IGtlZXBzIHRoZW0gaW4gdGhlIGhpc3RvcnkgYXVkaXQgKi8NCiAgICBmdW5jdGlvbiByZW1vdmVBY2NvdW50UmVhZGVyKGFkZHJlc3MgX2FkZHJlc3MpIHsNCiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovDQogICAgICAgIGlmICghaXNDdXJyZW50QWRtaW4obXNnLnNlbmRlcikpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvLyBGYWlsIGlmIHRoaXMgYWNjb3VudCBpcyBhbHJlYWR5IG5vdCBpbiB0aGUgbGlzdA0KICAgICAgICBpZiAoIWFjY291bnRSZWFkZXJBZGRyZXNzZXNbX2FkZHJlc3NdKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLyogUmVtb3ZlIHRoaXMgYWRtaW4gdXNlciAqLw0KICAgICAgICBhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXSA9IGZhbHNlOw0KICAgICAgICBBY2NvdW50UmVhZGVyUmVtb3ZlZChtc2cuc2VuZGVyLCBfYWRkcmVzcyk7DQogICAgfQ0KfQ0KDQovKiBUaGUgU0lGVCBpdHNlbGYgaXMgYSBzaW1wbGUgZXh0ZW5zaW9uIG9mIHRoZSBFUkMyMCB0aGF0IGFsbG93cyBmb3IgZ3JhbnRpbmcgb3RoZXIgU0lGVCBjb250cmFjdHMgc3BlY2lhbCByaWdodHMgdG8gYWN0IG9uIGJlaGFsZiBvZiBhbGwgdHJhbnNmZXJzLiAqLw0KY29udHJhY3QgU21hcnRJbnZlc3RtZW50RnVuZFRva2VuIHsNCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsNCg0KICAgIC8qIE1hcCBhbGwgb3VyIG91ciBiYWxhbmNlcyBmb3IgaXNzdWVkIHRva2VucyAqLw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7DQoNCiAgICAvKiBNYXAgYmV0d2VlbiB1c2VycyBhbmQgdGhlaXIgYXBwcm92YWwgYWRkcmVzc2VzIGFuZCBhbW91bnRzICovDQogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7DQoNCiAgICAvKiBMaXN0IG9mIGFsbCB0b2tlbiBob2xkZXJzICovDQogICAgYWRkcmVzc1tdIGFsbFRva2VuSG9sZGVyczsNCg0KICAgIC8qIFRoZSBuYW1lIG9mIHRoZSBjb250cmFjdCAqLw0KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsNCg0KICAgIC8qIFRoZSBzeW1ib2wgZm9yIHRoZSBjb250cmFjdCAqLw0KICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOw0KDQogICAgLyogSG93IG1hbnkgRFBzIGFyZSBpbiB1c2UgaW4gdGhpcyBjb250cmFjdCAqLw0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsNCg0KICAgIC8qIERlZmluZXMgdGhlIGN1cnJlbnQgc3VwcGx5IG9mIHRoZSB0b2tlbiBpbiBpdHMgb3duIHVuaXRzICovDQogICAgdWludDI1NiB0b3RhbFN1cHBseUFtb3VudCA9IDA7DQoNCiAgICAvKiBEZWZpbmVzIHRoZSBhZGRyZXNzIG9mIHRoZSBJQ08gY29udHJhY3Qgd2hpY2ggaXMgdGhlIG9ubHkgY29udHJhY3QgcGVybWl0dGVkIHRvIG1pbnQgdG9rZW5zLiAqLw0KICAgIGFkZHJlc3MgcHVibGljIGljb0NvbnRyYWN0QWRkcmVzczsNCg0KICAgIC8qIERlZmluZXMgd2hldGhlciBvciBub3QgdGhlIGZ1bmQgaXMgY2xvc2VkLiAqLw0KICAgIGJvb2wgcHVibGljIGlzQ2xvc2VkOw0KDQogICAgLyogRGVmaW5lcyB0aGUgY29udHJhY3QgaGFuZGxpbmcgdGhlIElDTyBwaGFzZS4gKi8NCiAgICBJY29QaGFzZU1hbmFnZW1lbnQgaWNvUGhhc2VNYW5hZ2VtZW50Ow0KDQogICAgLyogRGVmaW5lcyB0aGUgYWRtaW4gY29udHJhY3Qgd2UgaW50ZXJmYWNlIHdpdGggZm9yIGNyZWRlbnRhaWxzLiAqLw0KICAgIEF1dGhlbnRpY2F0aW9uTWFuYWdlciBhdXRoZW50aWNhdGlvbk1hbmFnZXI7DQoNCiAgICAvKiBGaXJlZCB3aGVuIHRoZSBmdW5kIGlzIGV2ZW50dWFsbHkgY2xvc2VkLiAqLw0KICAgIGV2ZW50IEZ1bmRDbG9zZWQoKTsNCiAgICANCiAgICAvKiBPdXIgdHJhbnNmZXIgZXZlbnQgdG8gZmlyZSB3aGVuZXZlciB3ZSBzaGlmdCBTTVJUIGFyb3VuZCAqLw0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOw0KICAgIA0KICAgIC8qIE91ciBhcHByb3ZhbCBldmVudCB3aGVuIG9uZSB1c2VyIGFwcHJvdmVzIGFub3RoZXIgdG8gY29udHJvbCAqLw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOw0KDQogICAgLyogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoaXMgZnVuZCB3aXRoIGxpbmtzIHRvIG90aGVyIGNvbnRyYWN0cyB0aGF0IGFyZSByZXF1aXJlZC4gKi8NCiAgICBmdW5jdGlvbiBTbWFydEludmVzdG1lbnRGdW5kVG9rZW4oYWRkcmVzcyBfaWNvQ29udHJhY3RBZGRyZXNzLCBhZGRyZXNzIF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKSB7DQogICAgICAgIC8vIFNldHVwIGRlZmF1bHRzDQogICAgICAgIG5hbWUgPSAiU21hcnQgSW52ZXN0bWVudCBGdW5kIFRva2VuIjsNCiAgICAgICAgc3ltYm9sID0gIlNJRlQiOw0KICAgICAgICBkZWNpbWFscyA9IDA7DQoNCiAgICAgICAgLyogU2V0dXAgYWNjZXNzIHRvIG91ciBvdGhlciBjb250cmFjdHMgYW5kIHZhbGlkYXRlIHRoZWlyIHZlcnNpb25zICovDQogICAgICAgIGljb1BoYXNlTWFuYWdlbWVudCA9IEljb1BoYXNlTWFuYWdlbWVudChfaWNvQ29udHJhY3RBZGRyZXNzKTsNCiAgICAgICAgaWYgKGljb1BoYXNlTWFuYWdlbWVudC5jb250cmFjdFZlcnNpb24oKSAhPSAzMDAyMDE3MDcxNzE0NDApDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgYXV0aGVudGljYXRpb25NYW5hZ2VyID0gQXV0aGVudGljYXRpb25NYW5hZ2VyKF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKTsNCiAgICAgICAgaWYgKGF1dGhlbnRpY2F0aW9uTWFuYWdlci5jb250cmFjdFZlcnNpb24oKSAhPSAxMDAyMDE3MDcxNzE1MDMpDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIC8qIFN0b3JlIG91ciBzcGVjaWFsIGFkZHJlc3NlcyAqLw0KICAgICAgICBpY29Db250cmFjdEFkZHJlc3MgPSBfaWNvQ29udHJhY3RBZGRyZXNzOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IG51bXdvcmRzKSB7DQogICAgICAgIGFzc2VydChtc2cuZGF0YS5sZW5ndGggPT0gbnVtd29yZHMgKiAzMiArIDQpOw0KICAgICAgICBfOw0KICAgIH0gDQoNCiAgICAvKiBUaGlzIG1vZGlmaWVyIGFsbG93cyBhIG1ldGhvZCB0byBvbmx5IGJlIGNhbGxlZCBieSBhY2NvdW50IHJlYWRlcnMgKi8NCiAgICBtb2RpZmllciBhY2NvdW50UmVhZGVyT25seSB7DQogICAgICAgIGlmICghYXV0aGVudGljYXRpb25NYW5hZ2VyLmlzQ3VycmVudEFjY291bnRSZWFkZXIobXNnLnNlbmRlcikpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIGZ1bmRTZW5kYWJsZVBoYXNlIHsNCiAgICAgICAgLy8gSWYgaXQncyBpbiBJQ08gcGhhc2UsIGZvcmJpZCBpdA0KICAgICAgICBpZiAoaWNvUGhhc2VNYW5hZ2VtZW50Lmljb1BoYXNlKCkpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvLyBJZiBpdCdzIGFiYW5kb25lZCwgZm9yYmlkIGl0DQogICAgICAgIGlmIChpY29QaGFzZU1hbmFnZW1lbnQuaWNvQWJhbmRvbmVkKCkpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvLyBXZSdyZSBnb29kLCBmdW5kcyBjYW4gbm93IGJlIHRyYW5zZmVycmVkDQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyogR2V0cyB0aGUgY29udHJhY3QgdmVyc2lvbiBmb3IgdmFsaWRhdGlvbiAqLw0KICAgIGZ1bmN0aW9uIGNvbnRyYWN0VmVyc2lvbigpIGNvbnN0YW50IHJldHVybnModWludDI1Nikgew0KICAgICAgICAvKiBTSUZUIGNvbnRyYWN0IGlkZW50aWZpZXMgYXMgNTAwWVlZWU1NRERISE1NICovDQogICAgICAgIHJldHVybiA1MDAyMDE3MDcxNzE0NDA7DQogICAgfQ0KICAgIA0KICAgIC8qIFRyYW5zZmVyIGZ1bmRzIGJldHdlZW4gdHdvIGFkZHJlc3NlcyB0aGF0IGFyZSBub3QgdGhlIGN1cnJlbnQgbXNnLnNlbmRlciAtIHRoaXMgcmVxdWlyZXMgYXBwcm92YWwgdG8gaGF2ZSBiZWVuIHNldCBzZXBhcmF0ZWx5IGFuZCBmb2xsb3dzIHN0YW5kYXJkIEVSQzIwIGd1aWRlbGluZXMgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgZnVuZFNlbmRhYmxlUGhhc2Ugb25seVBheWxvYWRTaXplKDMpIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfYW1vdW50ICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF9hbW91bnQgJiYgX2Ftb3VudCA+IDAgJiYgYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCkgPiBiYWxhbmNlc1tfdG9dKSB7DQogICAgICAgICAgICBib29sIGlzTmV3ID0gYmFsYW5jZXNbX3RvXSA9PSAwOw0KICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfYW1vdW50KTsNCiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF9hbW91bnQpOw0KICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOw0KICAgICAgICAgICAgaWYgKGlzTmV3KQ0KICAgICAgICAgICAgICAgIHRva2VuT3duZXJBZGQoX3RvKTsNCiAgICAgICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPT0gMCkNCiAgICAgICAgICAgICAgICB0b2tlbk93bmVyUmVtb3ZlKF9mcm9tKTsNCiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8qIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBob2xkZXJzIG9mIHRoaXMgY3VycmVuY3kuICovDQogICAgZnVuY3Rpb24gdG9rZW5Ib2xkZXJDb3VudCgpIGFjY291bnRSZWFkZXJPbmx5IGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgcmV0dXJuIGFsbFRva2VuSG9sZGVycy5sZW5ndGg7DQogICAgfQ0KDQogICAgLyogR2V0cyB0aGUgdG9rZW4gaG9sZGVyIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXguICovDQogICAgZnVuY3Rpb24gdG9rZW5Ib2xkZXIodWludDI1NiBfaW5kZXgpIGFjY291bnRSZWFkZXJPbmx5IGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsNCiAgICAgICAgcmV0dXJuIGFsbFRva2VuSG9sZGVyc1tfaW5kZXhdOw0KICAgIH0NCiANCiAgICAvKiBBZGRzIGFuIGFwcHJvdmFsIGZvciB0aGUgc3BlY2lmaWVkIGFjY291bnQgdG8gc3BlbmQgbW9uZXkgb2YgdGhlIG1lc3NhZ2Ugc2VuZGVyIHVwIHRvIHRoZSBkZWZpbmVkIGxpbWl0ICovDQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIGZ1bmRTZW5kYWJsZVBoYXNlIG9ubHlQYXlsb2FkU2l6ZSgyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfYW1vdW50Ow0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8qIEdldHMgdGhlIGN1cnJlbnQgYWxsb3dhbmNlIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgZm9yIHRoZSBzcGVjaWZpZWQgc3BlbmRlciBvZiB0aGUgb3duZXIgYWRkcmVzcyAqLw0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsNCiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogICAgfQ0KDQogICAgLyogR2V0cyB0aGUgdG90YWwgc3VwcGx5IGF2YWlsYWJsZSBvZiB0aGlzIHRva2VuICovDQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIHJldHVybiB0b3RhbFN1cHBseUFtb3VudDsNCiAgICB9DQoNCiAgICAvKiBHZXRzIHRoZSBiYWxhbmNlIG9mIGEgc3BlY2lmaWVkIGFjY291bnQgKi8NCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgew0KICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgICB9DQoNCiAgICAvKiBUcmFuc2ZlciB0aGUgYmFsYW5jZSBmcm9tIG93bmVyJ3MgYWNjb3VudCB0byBhbm90aGVyIGFjY291bnQgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBmdW5kU2VuZGFibGVQaGFzZSBvbmx5UGF5bG9hZFNpemUoMikgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICAvKiBDaGVjayBpZiBzZW5kZXIgaGFzIGJhbGFuY2UgYW5kIGZvciBvdmVyZmxvd3MgKi8NCiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgX2Ftb3VudCB8fCBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KSA8IGJhbGFuY2VzW190b10pDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAgLyogRG8gYSBjaGVjayB0byBzZWUgaWYgdGhleSBhcmUgbmV3LCBpZiBzbyB3ZSdsbCB3YW50IHRvIGFkZCBpdCB0byBvdXIgYXJyYXkgKi8NCiAgICAgICAgYm9vbCBpc1JlY2lwaWVudE5ldyA9IGJhbGFuY2VzW190b10gPCAxOw0KDQogICAgICAgIC8qIEFkZCBhbmQgc3VidHJhY3QgbmV3IGJhbGFuY2VzICovDQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF9hbW91bnQpOw0KICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7DQoNCiAgICAgICAgLyogQ29uc29saWRhdGUgYXJyYXlzIGlmIHRoZXkgYXJlIG5ldyBvciBpZiBzZW5kZXIgbm93IGhhcyBlbXB0eSBiYWxhbmNlICovDQogICAgICAgIGlmIChpc1JlY2lwaWVudE5ldykNCiAgICAgICAgICAgIHRva2VuT3duZXJBZGQoX3RvKTsNCiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgMSkNCiAgICAgICAgICAgIHRva2VuT3duZXJSZW1vdmUobXNnLnNlbmRlcik7DQoNCiAgICAgICAgLyogRmlyZSBub3RpZmljYXRpb24gZXZlbnQgKi8NCiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLyogSWYgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGlzIG5vdCBpbiBvdXIgb3duZXIgbGlzdCwgYWRkIHRoZW0gLSB0aGlzIGNhbiBiZSBjYWxsZWQgYnkgZGVzY2VuZGVudHMgdG8gZW5zdXJlIHRoZSBkYXRhYmFzZSBpcyBrZXB0IHVwIHRvIGRhdGUuICovDQogICAgZnVuY3Rpb24gdG9rZW5Pd25lckFkZChhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCB7DQogICAgICAgIC8qIEZpcnN0IGNoZWNrIGlmIHRoZXkgYWxyZWFkeSBleGlzdCAqLw0KICAgICAgICB1aW50MjU2IHRva2VuSG9sZGVyQ291bnQgPSBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoOw0KICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCB0b2tlbkhvbGRlckNvdW50OyBpKyspDQogICAgICAgICAgICBpZiAoYWxsVG9rZW5Ib2xkZXJzW2ldID09IF9hZGRyKQ0KICAgICAgICAgICAgICAgIC8qIEFscmVhZHkgZm91bmQgc28gd2UgY2FuIGFib3J0IG5vdyAqLw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgDQogICAgICAgIC8qIFRoZXkgZG9uJ3Qgc2VlbSB0byBleGlzdCwgc28gbGV0J3MgYWRkIHRoZW0gKi8NCiAgICAgICAgYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aCsrOw0KICAgICAgICBhbGxUb2tlbkhvbGRlcnNbYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aCAtIDFdID0gX2FkZHI7DQogICAgfQ0KDQogICAgLyogSWYgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGlzIGluIG91ciBvd25lciBsaXN0LCByZW1vdmUgdGhlbSAtIHRoaXMgY2FuIGJlIGNhbGxlZCBieSBkZXNjZW5kZW50cyB0byBlbnN1cmUgdGhlIGRhdGFiYXNlIGlzIGtlcHQgdXAgdG8gZGF0ZS4gKi8NCiAgICBmdW5jdGlvbiB0b2tlbk93bmVyUmVtb3ZlKGFkZHJlc3MgX2FkZHIpIGludGVybmFsIHsNCiAgICAgICAgLyogRmluZCBvdXQgd2hlcmUgaW4gb3VyIGFycmF5IHRoZXkgYXJlICovDQogICAgICAgIHVpbnQyNTYgdG9rZW5Ib2xkZXJDb3VudCA9IGFsbFRva2VuSG9sZGVycy5sZW5ndGg7DQogICAgICAgIHVpbnQyNTYgZm91bmRJbmRleCA9IDA7DQogICAgICAgIGJvb2wgZm91bmQgPSBmYWxzZTsNCiAgICAgICAgdWludDI1NiBpOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW5Ib2xkZXJDb3VudDsgaSsrKQ0KICAgICAgICAgICAgaWYgKGFsbFRva2VuSG9sZGVyc1tpXSA9PSBfYWRkcikgew0KICAgICAgICAgICAgICAgIGZvdW5kSW5kZXggPSBpOw0KICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qIElmIHdlIGRpZG4ndCBmaW5kIHRoZW0ganVzdCByZXR1cm4gKi8NCiAgICAgICAgaWYgKCFmb3VuZCkNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgDQogICAgICAgIC8qIFdlIG5vdyBuZWVkIHRvIHNodWZmbGUgZG93biB0aGUgYXJyYXkgKi8NCiAgICAgICAgZm9yIChpID0gZm91bmRJbmRleDsgaSA8IHRva2VuSG9sZGVyQ291bnQgLSAxOyBpKyspDQogICAgICAgICAgICBhbGxUb2tlbkhvbGRlcnNbaV0gPSBhbGxUb2tlbkhvbGRlcnNbaSArIDFdOw0KICAgICAgICBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoLS07DQogICAgfQ0KDQogICAgLyogTWludCBuZXcgdG9rZW5zIC0gdGhpcyBjYW4gb25seSBiZSBkb25lIGJ5IHNwZWNpYWwgY2FsbGVycyAoaS5lLiB0aGUgSUNPIG1hbmFnZW1lbnQpIGR1cmluZyB0aGUgSUNPIHBoYXNlLiAqLw0KICAgIGZ1bmN0aW9uIG1pbnRUb2tlbnMoYWRkcmVzcyBfYWRkcmVzcywgdWludDI1NiBfYW1vdW50KSBvbmx5UGF5bG9hZFNpemUoMikgew0KICAgICAgICAvKiBFbnN1cmUgd2UgYXJlIHRoZSBJQ08gY29udHJhY3QgY2FsbGluZyAqLw0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBpY29Db250cmFjdEFkZHJlc3MgfHwgIWljb1BoYXNlTWFuYWdlbWVudC5pY29QaGFzZSgpKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLyogTWludCB0aGUgdG9rZW5zIGZvciB0aGUgbmV3IGFkZHJlc3MqLw0KICAgICAgICBib29sIGlzTmV3ID0gYmFsYW5jZXNbX2FkZHJlc3NdID09IDA7DQogICAgICAgIHRvdGFsU3VwcGx5QW1vdW50ID0gdG90YWxTdXBwbHlBbW91bnQuYWRkKF9hbW91bnQpOw0KICAgICAgICBiYWxhbmNlc1tfYWRkcmVzc10gPSBiYWxhbmNlc1tfYWRkcmVzc10uYWRkKF9hbW91bnQpOw0KICAgICAgICBpZiAoaXNOZXcpDQogICAgICAgICAgICB0b2tlbk93bmVyQWRkKF9hZGRyZXNzKTsNCiAgICAgICAgVHJhbnNmZXIoMCwgX2FkZHJlc3MsIF9hbW91bnQpOw0KICAgIH0NCn0NCg0KDQovKiBUaGUgU0lGVCBpdHNlbGYgaXMgYSBzaW1wbGUgZXh0ZW5zaW9uIG9mIHRoZSBFUkMyMCB0aGF0IGFsbG93cyBmb3IgZ3JhbnRpbmcgb3RoZXIgU0lGVCBjb250cmFjdHMgc3BlY2lhbCByaWdodHMgdG8gYWN0IG9uIGJlaGFsZiBvZiBhbGwgdHJhbnNmZXJzLiAqLw0KDQpjb250cmFjdCBJY29QaGFzZU1hbmFnZW1lbnQgew0KICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2Ow0KICAgIA0KICAgIC8qIERlZmluZXMgd2hldGhlciBvciBub3Qgd2UgYXJlIGluIHRoZSBJQ08gcGhhc2UgKi8NCiAgICBib29sIHB1YmxpYyBpY29QaGFzZSA9IHRydWU7DQoNCiAgICAvKiBEZWZpbmVzIHdoZXRoZXIgb3Igbm90IHRoZSBJQ08gaGFzIGJlZW4gYWJhbmRvbmVkICovDQogICAgYm9vbCBwdWJsaWMgaWNvQWJhbmRvbmVkID0gZmFsc2U7DQoNCiAgICAvKiBEZWZpbmVzIHdoZXRoZXIgb3Igbm90IHRoZSBTSUZUIGNvbnRyYWN0IGFkZHJlc3MgaGFzIHlldCBiZWVuIHNldC4gICovDQogICAgYm9vbCBzaWZ0Q29udHJhY3REZWZpbmVkID0gZmFsc2U7DQogICAgDQogICAgLyogRGVmaW5lcyB0aGUgc2FsZSBwcmljZSBkdXJpbmcgSUNPICovDQogICAgdWludDI1NiBjb25zdGFudCBpY29Vbml0UHJpY2UgPSAxMCBmaW5uZXk7DQoNCiAgICAvKiBJZiBhbiBJQ08gaXMgYWJhbmRvbmVkIGFuZCBzb21lIHdpdGhkcmF3YWxzIGZhaWwgdGhlbiB0aGlzIG1hcCBhbGxvd3MgcGVvcGxlIHRvIHJlcXVlc3Qgd2l0aGRyYXdhbCBvZiBsb2NrZWQtaW4gZXRoZXIuICovDQogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBhYmFuZG9uZWRJY29CYWxhbmNlczsNCg0KICAgIC8qIERlZmluZXMgb3VyIGludGVyZmFjZSB0byB0aGUgU0lGVCBjb250cmFjdC4gKi8NCiAgICBTbWFydEludmVzdG1lbnRGdW5kVG9rZW4gc21hcnRJbnZlc3RtZW50RnVuZFRva2VuOw0KDQogICAgLyogRGVmaW5lcyB0aGUgYWRtaW4gY29udHJhY3Qgd2UgaW50ZXJmYWNlIHdpdGggZm9yIGNyZWRlbnRhaWxzLiAqLw0KICAgIEF1dGhlbnRpY2F0aW9uTWFuYWdlciBhdXRoZW50aWNhdGlvbk1hbmFnZXI7DQoNCiAgICAvKiBEZWZpbmVzIHRoZSB0aW1lIHRoYXQgdGhlIElDTyBzdGFydHMuICovDQogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgaWNvU3RhcnRUaW1lID0gMTUwMTU0NTYwMDsgLy8gQXVndXN0IDFzdCAyMDE3IGF0IDAwOjAwOjAwIFVUQw0KDQogICAgLyogRGVmaW5lcyB0aGUgdGltZSB0aGF0IHRoZSBJQ08gZW5kcy4gKi8NCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBpY29FbmRUaW1lID0gMTUwNTQzMzYwMDsgLy8gU2VwdGVtYmVyIDE1dGggMjAxNyBhdCAwMDowMDowMCBVVEMNCg0KICAgIC8qIERlZmluZXMgb3VyIGV2ZW50IGZpcmVkIHdoZW4gdGhlIElDTyBpcyBjbG9zZWQgKi8NCiAgICBldmVudCBJY29DbG9zZWQoKTsNCg0KICAgIC8qIERlZmluZXMgb3VyIGV2ZW50IGZpcmVkIGlmIHRoZSBJQ08gaXMgYWJhbmRvbmVkICovDQogICAgZXZlbnQgSWNvQWJhbmRvbmVkKHN0cmluZyBkZXRhaWxzKTsNCiAgICANCiAgICAvKiBFbnN1cmVzIHRoYXQgb25jZSB0aGUgSUNPIGlzIG92ZXIgdGhpcyBjb250cmFjdCBjYW5ub3QgYmUgdXNlZCB1bnRpbCB0aGUgcG9pbnQgaXQgaXMgZGVzdHJ1Y3RlZC4gKi8NCiAgICBtb2RpZmllciBvbmx5RHVyaW5nSWNvIHsNCiAgICAgICAgYm9vbCBjb250cmFjdFZhbGlkID0gc2lmdENvbnRyYWN0RGVmaW5lZCAmJiAhc21hcnRJbnZlc3RtZW50RnVuZFRva2VuLmlzQ2xvc2VkKCk7DQogICAgICAgIGlmICghY29udHJhY3RWYWxpZCB8fCAoIWljb1BoYXNlICYmICFpY29BYmFuZG9uZWQpKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvKiBUaGlzIG1vZGlmaWVyIGFsbG93cyBhIG1ldGhvZCB0byBvbmx5IGJlIGNhbGxlZCBieSBjdXJyZW50IGFkbWlucyAqLw0KICAgIG1vZGlmaWVyIGFkbWluT25seSB7DQogICAgICAgIGlmICghYXV0aGVudGljYXRpb25NYW5hZ2VyLmlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvKiBDcmVhdGUgdGhlIElDTyBwaGFzZSBtYW5hZ2VybWVudCBhbmQgZGVmaW5lIHRoZSBhZGRyZXNzIG9mIHRoZSBtYWluIFNJRlQgY29udHJhY3QuICovDQogICAgZnVuY3Rpb24gSWNvUGhhc2VNYW5hZ2VtZW50KGFkZHJlc3MgX2F1dGhlbnRpY2F0aW9uTWFuYWdlckFkZHJlc3MpIHsNCiAgICAgICAgLyogQSBiYXNpYyBzYW5pdHkgY2hlY2sgKi8NCiAgICAgICAgaWYgKGljb1N0YXJ0VGltZSA+PSBpY29FbmRUaW1lKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLyogU2V0dXAgYWNjZXNzIHRvIG91ciBvdGhlciBjb250cmFjdHMgYW5kIHZhbGlkYXRlIHRoZWlyIHZlcnNpb25zICovDQogICAgICAgIGF1dGhlbnRpY2F0aW9uTWFuYWdlciA9IEF1dGhlbnRpY2F0aW9uTWFuYWdlcihfYXV0aGVudGljYXRpb25NYW5hZ2VyQWRkcmVzcyk7DQogICAgICAgIGlmIChhdXRoZW50aWNhdGlvbk1hbmFnZXIuY29udHJhY3RWZXJzaW9uKCkgIT0gMTAwMjAxNzA3MTcxNTAzKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLyogU2V0IHRoZSBTSUZUIGNvbnRyYWN0IGFkZHJlc3MgYXMgYSBvbmUtdGltZSBvcGVyYXRpb24uICBUaGlzIGhhcHBlbnMgYWZ0ZXIgYWxsIHRoZSBjb250cmFjdHMgYXJlIGNyZWF0ZWQgYW5kIG5vDQogICAgICAgb3RoZXIgZnVuY3Rpb25hbGl0eSBjYW4gYmUgdXNlZCB1bnRpbCB0aGlzIGlzIHNldC4gKi8NCiAgICBmdW5jdGlvbiBzZXRTaWZ0Q29udHJhY3RBZGRyZXNzKGFkZHJlc3MgX3NpZnRDb250cmFjdEFkZHJlc3MpIGFkbWluT25seSB7DQogICAgICAgIC8qIFRoaXMgY2FuIG9ubHkgaGFwcGVuIG9uY2UgaW4gdGhlIGxpZmV0aW1lIG9mIHRoaXMgY29udHJhY3QgKi8NCiAgICAgICAgaWYgKHNpZnRDb250cmFjdERlZmluZWQpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvKiBTZXR1cCBhY2Nlc3MgdG8gb3VyIG90aGVyIGNvbnRyYWN0cyBhbmQgdmFsaWRhdGUgdGhlaXIgdmVyc2lvbnMgKi8NCiAgICAgICAgc21hcnRJbnZlc3RtZW50RnVuZFRva2VuID0gU21hcnRJbnZlc3RtZW50RnVuZFRva2VuKF9zaWZ0Q29udHJhY3RBZGRyZXNzKTsNCiAgICAgICAgaWYgKHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi5jb250cmFjdFZlcnNpb24oKSAhPSA1MDAyMDE3MDcxNzE0NDApDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgc2lmdENvbnRyYWN0RGVmaW5lZCA9IHRydWU7DQogICAgfQ0KDQogICAgLyogR2V0cyB0aGUgY29udHJhY3QgdmVyc2lvbiBmb3IgdmFsaWRhdGlvbiAqLw0KICAgIGZ1bmN0aW9uIGNvbnRyYWN0VmVyc2lvbigpIGNvbnN0YW50IHJldHVybnModWludDI1Nikgew0KICAgICAgICAvKiBJQ08gY29udHJhY3QgaWRlbnRpZmllcyBhcyAzMDBZWVlZTU1EREhITU0gKi8NCiAgICAgICAgcmV0dXJuIDMwMDIwMTcwNzE3MTQ0MDsNCiAgICB9DQoNCiAgICAvKiBDbG9zZSB0aGUgSUNPIHBoYXNlIGFuZCB0cmFuc2l0aW9uIHRvIGV4ZWN1dGlvbiBwaGFzZSAqLw0KICAgIGZ1bmN0aW9uIGNsb3NlKCkgYWRtaW5Pbmx5IG9ubHlEdXJpbmdJY28gew0KICAgICAgICAvLyBGb3JiaWQgY2xvc2luZyBjb250cmFjdCBiZWZvcmUgdGhlIGVuZCBvZiBJQ08NCiAgICAgICAgaWYgKG5vdyA8PSBpY29FbmRUaW1lKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLy8gQ2xvc2UgdGhlIElDTw0KICAgICAgICBpY29QaGFzZSA9IGZhbHNlOw0KICAgICAgICBJY29DbG9zZWQoKTsNCg0KICAgICAgICAvLyBXaXRoZHJhdyBmdW5kcyB0byB0aGUgY2FsbGVyDQogICAgICAgIGlmICghbXNnLnNlbmRlci5zZW5kKHRoaXMuYmFsYW5jZSkpDQogICAgICAgICAgICB0aHJvdzsNCiAgICB9DQogICAgDQogICAgLyogSGFuZGxlIHJlY2VpdmluZyBldGhlciBpbiBJQ08gcGhhc2UgLSB3ZSB3b3JrIG91dCBob3cgbXVjaCB0aGUgdXNlciBoYXMgYm91Z2h0LCBhbGxvY2F0ZSBhIHN1aXRhYmxlIGJhbGFuY2UgYW5kIHNlbmQgdGhlaXIgY2hhbmdlICovDQogICAgZnVuY3Rpb24gKCkgb25seUR1cmluZ0ljbyBwYXlhYmxlIHsNCiAgICAgICAgLy8gRm9yYmlkIGZ1bmRpbmcgb3V0c2lkZSBvZiBJQ08NCiAgICAgICAgaWYgKG5vdyA8IGljb1N0YXJ0VGltZSB8fCBub3cgPiBpY29FbmRUaW1lKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLyogRGV0ZXJtaW5lIGhvdyBtdWNoIHRoZXkndmUgYWN0dWFsbHkgcHVyaGNhc2VkIGFuZCBhbnkgZXRoZXIgY2hhbmdlICovDQogICAgICAgIHVpbnQyNTYgdG9rZW5zUHVyY2hhc2VkID0gbXNnLnZhbHVlIC8gaWNvVW5pdFByaWNlOw0KICAgICAgICB1aW50MjU2IHB1cmNoYXNlVG90YWxQcmljZSA9IHRva2Vuc1B1cmNoYXNlZCAqIGljb1VuaXRQcmljZTsNCiAgICAgICAgdWludDI1NiBjaGFuZ2UgPSBtc2cudmFsdWUuc3ViKHB1cmNoYXNlVG90YWxQcmljZSk7DQoNCiAgICAgICAgLyogSW5jcmVhc2UgdGhlaXIgbmV3IGJhbGFuY2UgaWYgdGhleSBhY3R1YWxseSBwdXJjaGFzZWQgYW55ICovDQogICAgICAgIGlmICh0b2tlbnNQdXJjaGFzZWQgPiAwKQ0KICAgICAgICAgICAgc21hcnRJbnZlc3RtZW50RnVuZFRva2VuLm1pbnRUb2tlbnMobXNnLnNlbmRlciwgdG9rZW5zUHVyY2hhc2VkKTsNCg0KICAgICAgICAvKiBTZW5kIGNoYW5nZSBiYWNrIHRvIHJlY2lwaWVudCAqLw0KICAgICAgICBpZiAoY2hhbmdlID4gMCAmJiAhbXNnLnNlbmRlci5zZW5kKGNoYW5nZSkpDQogICAgICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvKiBBYmFuZG9ucyB0aGUgSUNPIGFuZCByZXR1cm5zIGZ1bmRzIHRvIHNoYXJlaG9sZGVycy4gIEFueSBmYWlsZWQgZnVuZHMgY2FuIGJlIHNlcGFyYXRlbHkgd2l0aGRyYXduIG9uY2UgdGhlIElDTyBpcyBhYmFuZG9uZWQuICovDQogICAgZnVuY3Rpb24gYWJhbmRvbihzdHJpbmcgZGV0YWlscykgYWRtaW5Pbmx5IG9ubHlEdXJpbmdJY28gew0KICAgICAgICAvLyBGb3JiaWQgY2xvc2luZyBjb250cmFjdCBiZWZvcmUgdGhlIGVuZCBvZiBJQ08NCiAgICAgICAgaWYgKG5vdyA8PSBpY29FbmRUaW1lKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLyogSWYgYWxyZWFkeSBhYmFuZG9uZWQgdGhyb3cgYW4gZXJyb3IgKi8NCiAgICAgICAgaWYgKGljb0FiYW5kb25lZCkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIC8qIFdvcmsgb3V0IGEgcmVmdW5kIHBlciBzaGFyZSBwZXIgc2hhcmUgKi8NCiAgICAgICAgdWludDI1NiBwYXltZW50UGVyU2hhcmUgPSB0aGlzLmJhbGFuY2UgLyBzbWFydEludmVzdG1lbnRGdW5kVG9rZW4udG90YWxTdXBwbHkoKTsNCg0KICAgICAgICAvKiBFbnVtIGFsbCBhY2NvdW50cyBhbmQgc2VuZCB0aGVtIHJlZnVuZCAqLw0KICAgICAgICB1aW50IG51bWJlclRva2VuSG9sZGVycyA9IHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi50b2tlbkhvbGRlckNvdW50KCk7DQogICAgICAgIHVpbnQyNTYgdG90YWxBYmFuZG9uZWQgPSAwOw0KICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBudW1iZXJUb2tlbkhvbGRlcnM7IGkrKykgew0KICAgICAgICAgICAgLyogQ2FsY3VsYXRlIGhvdyBtdWNoIGdvZXMgdG8gdGhpcyBzaGFyZWhvbGRlciAqLw0KICAgICAgICAgICAgYWRkcmVzcyBhZGRyID0gc21hcnRJbnZlc3RtZW50RnVuZFRva2VuLnRva2VuSG9sZGVyKGkpOw0KICAgICAgICAgICAgdWludDI1NiBldGhlclRvU2VuZCA9IHBheW1lbnRQZXJTaGFyZSAqIHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi5iYWxhbmNlT2YoYWRkcik7DQogICAgICAgICAgICBpZiAoZXRoZXJUb1NlbmQgPCAxKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQogICAgICAgICAgICAvKiBBbGxvY2F0ZSBhcHByb3ByaWF0ZSBhbW91bnQgb2YgZnVuZCB0byB0aGVtICovDQogICAgICAgICAgICBhYmFuZG9uZWRJY29CYWxhbmNlc1thZGRyXSA9IGFiYW5kb25lZEljb0JhbGFuY2VzW2FkZHJdLmFkZChldGhlclRvU2VuZCk7DQogICAgICAgICAgICB0b3RhbEFiYW5kb25lZCA9IHRvdGFsQWJhbmRvbmVkLmFkZChldGhlclRvU2VuZCk7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBBdWRpdCB0aGUgYWJhbmRvbm1lbnQgKi8NCiAgICAgICAgaWNvQWJhbmRvbmVkID0gdHJ1ZTsNCiAgICAgICAgSWNvQWJhbmRvbmVkKGRldGFpbHMpOw0KDQogICAgICAgIC8vIFRoZXJlIHNob3VsZCBiZSBubyBtb25leSBsZWZ0LCBidXQgd2l0aGRyYXcganVzdCBpbmNhc2UgZm9yIG1hbnVhbCByZXNvbHV0aW9uDQogICAgICAgIHVpbnQyNTYgcmVtYWluZGVyID0gdGhpcy5iYWxhbmNlLnN1Yih0b3RhbEFiYW5kb25lZCk7DQogICAgICAgIGlmIChyZW1haW5kZXIgPiAwKQ0KICAgICAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQocmVtYWluZGVyKSkNCiAgICAgICAgICAgICAgICAvLyBBZGQgdGhpcyB0byB0aGUgY2FsbGVycyBiYWxhbmNlIGZvciBlbWVyZ2VuY3kgcmVmdW5kcw0KICAgICAgICAgICAgICAgIGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdID0gYWJhbmRvbmVkSWNvQmFsYW5jZXNbbXNnLnNlbmRlcl0uYWRkKHJlbWFpbmRlcik7DQogICAgfQ0KDQogICAgLyogQWxsb3dzIHBlb3BsZSB0byB3aXRoZHJhdyBmdW5kcyB0aGF0IGZhaWxlZCB0byBzZW5kIGR1cmluZyB0aGUgYWJhbmRvbm1lbnQgb2YgdGhlIElDTyBmb3IgYW55IHJlYXNvbi4gKi8NCiAgICBmdW5jdGlvbiBhYmFuZG9uZWRGdW5kV2l0aGRyYXdhbCgpIHsNCiAgICAgICAgLy8gVGhpcyBmdW5jdGlvbmFsaXR5IG9ubHkgZXhpc3RzIGlmIGFuIElDTyB3YXMgYWJhbmRvbmVkDQogICAgICAgIGlmICghaWNvQWJhbmRvbmVkIHx8IGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdID09IDApDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIC8vIEF0dGVtcHQgdG8gc2VuZCB0aGVtIHRvIGZ1bmRzDQogICAgICAgIHVpbnQyNTYgZnVuZHMgPSBhYmFuZG9uZWRJY29CYWxhbmNlc1ttc2cuc2VuZGVyXTsNCiAgICAgICAgYWJhbmRvbmVkSWNvQmFsYW5jZXNbbXNnLnNlbmRlcl0gPSAwOw0KICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChmdW5kcykpDQogICAgICAgICAgICB0aHJvdzsNCiAgICB9DQp9'