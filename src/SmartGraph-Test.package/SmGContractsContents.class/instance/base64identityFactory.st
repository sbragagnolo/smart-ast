base 64 content
base64identityFactory
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC40Ow0KDQpsaWJyYXJ5IEFycmF5TGliew0KICBmdW5jdGlvbiBmaW5kQWRkcmVzcyhhZGRyZXNzIGEsIGFkZHJlc3NbXSBzdG9yYWdlIGFycnkpIHJldHVybnMgKGludCl7DQogICAgZm9yICh1aW50IGkgPSAwIDsgaSA8IGFycnkubGVuZ3RoIDsgaSsrKXsNCiAgICAgIGlmKGFycnlbaV0gPT0gYSl7cmV0dXJuIGludChpKTt9DQogICAgfQ0KICAgIHJldHVybiAtMTsNCiAgfQ0KICBmdW5jdGlvbiByZW1vdmVBZGRyZXNzKHVpbnQgaSwgYWRkcmVzc1tdIHN0b3JhZ2UgYXJyeSl7DQogICAgdWludCBsZW5ndGhNaW51c09uZSA9IGFycnkubGVuZ3RoIC0gMTsNCiAgICBhcnJ5W2ldID0gYXJyeVtsZW5ndGhNaW51c09uZV07DQogICAgZGVsZXRlIGFycnlbbGVuZ3RoTWludXNPbmVdOw0KICAgIGFycnkubGVuZ3RoID0gbGVuZ3RoTWludXNPbmU7DQogIH0NCn0NCg0KY29udHJhY3QgT3duZWQgew0KICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCiAgbW9kaWZpZXIgb25seU93bmVyKCl7IGlmIChpc093bmVyKG1zZy5zZW5kZXIpKSBfOyB9DQogIG1vZGlmaWVyIGlmT3duZXIoYWRkcmVzcyBzZW5kZXIpIHsgaWYoaXNPd25lcihzZW5kZXIpKSBfOyB9DQoNCiAgZnVuY3Rpb24gT3duZWQoKXsgb3duZXIgPSBtc2cuc2VuZGVyOyB9DQoNCiAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIGFkZHIpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsgcmV0dXJuIGFkZHIgPT0gb3duZXI7IH0NCg0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF9vd25lcikgb25seU93bmVyIHsgb3duZXIgPSBfb3duZXI7IH0NCn0NCg0KY29udHJhY3QgUHJveHkgaXMgT3duZWQgew0KICBldmVudCBGb3J3YXJkZWQgKGFkZHJlc3MgaW5kZXhlZCBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSApOw0KICBldmVudCBSZWNlaXZlZCAoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCB2YWx1ZSk7DQoNCiAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7IFJlY2VpdmVkKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7IH0NCg0KICBmdW5jdGlvbiBmb3J3YXJkKGFkZHJlc3MgZGVzdGluYXRpb24sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpIG9ubHlPd25lciB7DQogICAgaWYgKCFkZXN0aW5hdGlvbi5jYWxsLnZhbHVlKHZhbHVlKShkYXRhKSkgeyB0aHJvdzsgfQ0KICAgIEZvcndhcmRlZChkZXN0aW5hdGlvbiwgdmFsdWUsIGRhdGEpOw0KICB9DQp9DQoNCmNvbnRyYWN0IFJlY292ZXJhYmxlQ29udHJvbGxlciB7DQogIHVpbnQgICAgcHVibGljIHZlcnNpb247DQogIFByb3h5ICAgcHVibGljIHByb3h5Ow0KDQogIGFkZHJlc3MgcHVibGljIHVzZXJLZXk7DQogIGFkZHJlc3MgcHVibGljIHByb3Bvc2VkVXNlcktleTsNCiAgdWludCAgICBwdWJsaWMgcHJvcG9zZWRVc2VyS2V5UGVuZGluZ1VudGlsOw0KDQogIGFkZHJlc3MgcHVibGljIHJlY292ZXJ5S2V5Ow0KICBhZGRyZXNzIHB1YmxpYyBwcm9wb3NlZFJlY292ZXJ5S2V5Ow0KICB1aW50ICAgIHB1YmxpYyBwcm9wb3NlZFJlY292ZXJ5S2V5UGVuZGluZ1VudGlsOw0KDQogIGFkZHJlc3MgcHVibGljIHByb3Bvc2VkQ29udHJvbGxlcjsNCiAgdWludCAgICBwdWJsaWMgcHJvcG9zZWRDb250cm9sbGVyUGVuZGluZ1VudGlsOw0KDQogIHVpbnQgICAgcHVibGljIHNob3J0VGltZUxvY2s7Ly8gdXNlIDkwMCBmb3IgMTUgbWludXRlcw0KICB1aW50ICAgIHB1YmxpYyBsb25nVGltZUxvY2s7IC8vIHVzZSAyNTkyMDAgZm9yIDMgZGF5cw0KDQogIGV2ZW50IFJlY292ZXJ5RXZlbnQoc3RyaW5nIGFjdGlvbiwgYWRkcmVzcyBpbml0aWF0ZWRCeSk7DQoNCiAgbW9kaWZpZXIgb25seVVzZXJLZXkoKSB7IGlmIChtc2cuc2VuZGVyID09IHVzZXJLZXkpIF87IH0NCiAgbW9kaWZpZXIgb25seVJlY292ZXJ5S2V5KCkgeyBpZiAobXNnLnNlbmRlciA9PSByZWNvdmVyeUtleSkgXzsgfQ0KDQogIGZ1bmN0aW9uIFJlY292ZXJhYmxlQ29udHJvbGxlcihhZGRyZXNzIHByb3h5QWRkcmVzcywgYWRkcmVzcyBfdXNlcktleSwgdWludCBfbG9uZ1RpbWVMb2NrLCB1aW50IF9zaG9ydFRpbWVMb2NrKSB7DQogICAgdmVyc2lvbiA9IDE7DQogICAgcHJveHkgPSBQcm94eShwcm94eUFkZHJlc3MpOw0KICAgIHVzZXJLZXkgPSBfdXNlcktleTsNCiAgICBzaG9ydFRpbWVMb2NrID0gX3Nob3J0VGltZUxvY2s7DQogICAgbG9uZ1RpbWVMb2NrID0gX2xvbmdUaW1lTG9jazsNCiAgICByZWNvdmVyeUtleSA9IG1zZy5zZW5kZXI7DQogIH0NCg0KICBmdW5jdGlvbiBmb3J3YXJkKGFkZHJlc3MgZGVzdGluYXRpb24sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpIG9ubHlVc2VyS2V5IHsNCiAgICBwcm94eS5mb3J3YXJkKGRlc3RpbmF0aW9uLCB2YWx1ZSwgZGF0YSk7DQogIH0NCiAgLy9wYXNzIDB4MCB0byBjYW5jZWwgDQogIGZ1bmN0aW9uIHNpZ25SZWNvdmVyeUNoYW5nZShhZGRyZXNzIF9wcm9wb3NlZFJlY292ZXJ5S2V5KSBvbmx5VXNlcktleXsNCiAgICBwcm9wb3NlZFJlY292ZXJ5S2V5UGVuZGluZ1VudGlsID0gbm93ICsgbG9uZ1RpbWVMb2NrOw0KICAgIHByb3Bvc2VkUmVjb3ZlcnlLZXkgPSBfcHJvcG9zZWRSZWNvdmVyeUtleTsNCiAgICBSZWNvdmVyeUV2ZW50KCJzaWduUmVjb3ZlcnlDaGFuZ2UiLCBtc2cuc2VuZGVyKTsNCiAgfQ0KICBmdW5jdGlvbiBjaGFuZ2VSZWNvdmVyeSgpIHsNCiAgICBpZihwcm9wb3NlZFJlY292ZXJ5S2V5UGVuZGluZ1VudGlsIDwgbm93ICYmIHByb3Bvc2VkUmVjb3ZlcnlLZXkgIT0gMHgwKXsNCiAgICAgIHJlY292ZXJ5S2V5ID0gcHJvcG9zZWRSZWNvdmVyeUtleTsNCiAgICAgIGRlbGV0ZSBwcm9wb3NlZFJlY292ZXJ5S2V5Ow0KICAgIH0NCiAgfQ0KICAvL3Bhc3MgMHgwIHRvIGNhbmNlbCANCiAgZnVuY3Rpb24gc2lnbkNvbnRyb2xsZXJDaGFuZ2UoYWRkcmVzcyBfcHJvcG9zZWRDb250cm9sbGVyKSBvbmx5VXNlcktleXsNCiAgICBwcm9wb3NlZENvbnRyb2xsZXJQZW5kaW5nVW50aWwgPSBub3cgKyBsb25nVGltZUxvY2s7DQogICAgcHJvcG9zZWRDb250cm9sbGVyID0gX3Byb3Bvc2VkQ29udHJvbGxlcjsNCiAgICBSZWNvdmVyeUV2ZW50KCJzaWduQ29udHJvbGxlckNoYW5nZSIsIG1zZy5zZW5kZXIpOw0KICB9DQogIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoKSB7DQogICAgaWYocHJvcG9zZWRDb250cm9sbGVyUGVuZGluZ1VudGlsIDwgbm93ICYmIHByb3Bvc2VkQ29udHJvbGxlciAhPSAweDApew0KICAgICAgcHJveHkudHJhbnNmZXIocHJvcG9zZWRDb250cm9sbGVyKTsNCiAgICAgIHN1aWNpZGUocHJvcG9zZWRDb250cm9sbGVyKTsNCiAgICB9DQogIH0NCiAgLy9wYXNzIDB4MCB0byBjYW5jZWwgDQogIGZ1bmN0aW9uIHNpZ25Vc2VyS2V5Q2hhbmdlKGFkZHJlc3MgX3Byb3Bvc2VkVXNlcktleSkgb25seVVzZXJLZXl7DQogICAgcHJvcG9zZWRVc2VyS2V5UGVuZGluZ1VudGlsID0gbm93ICsgc2hvcnRUaW1lTG9jazsNCiAgICBwcm9wb3NlZFVzZXJLZXkgPSBfcHJvcG9zZWRVc2VyS2V5Ow0KICAgIFJlY292ZXJ5RXZlbnQoInNpZ25Vc2VyS2V5Q2hhbmdlIiwgbXNnLnNlbmRlcik7DQogIH0NCiAgZnVuY3Rpb24gY2hhbmdlVXNlcktleSgpew0KICAgIGlmKHByb3Bvc2VkVXNlcktleVBlbmRpbmdVbnRpbCA8IG5vdyAmJiBwcm9wb3NlZFVzZXJLZXkgIT0gMHgwKXsNCiAgICAgIHVzZXJLZXkgPSBwcm9wb3NlZFVzZXJLZXk7DQogICAgICBkZWxldGUgcHJvcG9zZWRVc2VyS2V5Ow0KICAgICAgUmVjb3ZlcnlFdmVudCgiY2hhbmdlVXNlcktleSIsIG1zZy5zZW5kZXIpOw0KICAgIH0NCiAgfQ0KICANCiAgZnVuY3Rpb24gY2hhbmdlUmVjb3ZlcnlGcm9tUmVjb3ZlcnkoYWRkcmVzcyBfcmVjb3ZlcnlLZXkpIG9ubHlSZWNvdmVyeUtleXsgcmVjb3ZlcnlLZXkgPSBfcmVjb3ZlcnlLZXk7IH0NCiAgZnVuY3Rpb24gY2hhbmdlVXNlcktleUZyb21SZWNvdmVyeShhZGRyZXNzIF91c2VyS2V5KSBvbmx5UmVjb3ZlcnlLZXl7DQogICAgZGVsZXRlIHByb3Bvc2VkVXNlcktleTsNCiAgICB1c2VyS2V5ID0gX3VzZXJLZXk7DQogIH0NCn0NCg0KY29udHJhY3QgUmVjb3ZlcnlRdW9ydW0gew0KICBSZWNvdmVyYWJsZUNvbnRyb2xsZXIgcHVibGljIGNvbnRyb2xsZXI7DQoNCiAgYWRkcmVzc1tdIHB1YmxpYyBkZWxlZ2F0ZUFkZHJlc3NlczsgLy8gbmVlZGVkIGZvciBpdGVyYXRpb24gb2YgbWFwcGluZw0KICBtYXBwaW5nIChhZGRyZXNzID0+IERlbGVnYXRlKSBwdWJsaWMgZGVsZWdhdGVzOw0KICBzdHJ1Y3QgRGVsZWdhdGV7DQogICAgdWludCBkZWxldGVkQWZ0ZXI7IC8vIGRlbGVnYXRlIGV4aXN0cyBpZiBub3QgMA0KICAgIHVpbnQgcGVuZGluZ1VudGlsOw0KICAgIGFkZHJlc3MgcHJvcG9zZWRVc2VyS2V5Ow0KICB9DQoNCiAgZXZlbnQgUmVjb3ZlcnlFdmVudChzdHJpbmcgYWN0aW9uLCBhZGRyZXNzIGluaXRpYXRlZEJ5KTsNCg0KICBtb2RpZmllciBvbmx5VXNlcktleSgpeyBpZiAobXNnLnNlbmRlciA9PSBjb250cm9sbGVyLnVzZXJLZXkoKSkgXzsgfQ0KDQogIGZ1bmN0aW9uIFJlY292ZXJ5UXVvcnVtKGFkZHJlc3MgX2NvbnRyb2xsZXIsIGFkZHJlc3NbXSBfZGVsZWdhdGVzKXsNCiAgICBjb250cm9sbGVyID0gUmVjb3ZlcmFibGVDb250cm9sbGVyKF9jb250cm9sbGVyKTsNCiAgICBmb3IodWludCBpID0gMDsgaSA8IF9kZWxlZ2F0ZXMubGVuZ3RoOyBpKyspew0KICAgICAgZGVsZWdhdGVBZGRyZXNzZXMucHVzaChfZGVsZWdhdGVzW2ldKTsNCiAgICAgIGRlbGVnYXRlc1tfZGVsZWdhdGVzW2ldXSA9IERlbGVnYXRlKHtwcm9wb3NlZFVzZXJLZXk6IDB4MCwgcGVuZGluZ1VudGlsOiAwLCBkZWxldGVkQWZ0ZXI6IDMxNTM2MDAwMDAwMDAwfSk7DQogICAgfQ0KICB9DQogIGZ1bmN0aW9uIHNpZ25Vc2VyQ2hhbmdlKGFkZHJlc3MgcHJvcG9zZWRVc2VyS2V5KSB7DQogICAgaWYoZGVsZWdhdGVSZWNvcmRFeGlzdHMoZGVsZWdhdGVzW21zZy5zZW5kZXJdKSkgew0KICAgICAgZGVsZWdhdGVzW21zZy5zZW5kZXJdLnByb3Bvc2VkVXNlcktleSA9IHByb3Bvc2VkVXNlcktleTsNCiAgICAgIGNoYW5nZVVzZXJLZXkocHJvcG9zZWRVc2VyS2V5KTsNCiAgICAgIFJlY292ZXJ5RXZlbnQoInNpZ25Vc2VyQ2hhbmdlIiwgbXNnLnNlbmRlcik7DQogICAgfQ0KICB9DQogIGZ1bmN0aW9uIGNoYW5nZVVzZXJLZXkoYWRkcmVzcyBuZXdVc2VyS2V5KSB7DQogICAgaWYoY29sbGVjdGVkU2lnbmF0dXJlcyhuZXdVc2VyS2V5KSA+PSBuZWVkZWRTaWduYXR1cmVzKCkpew0KICAgICAgY29udHJvbGxlci5jaGFuZ2VVc2VyS2V5RnJvbVJlY292ZXJ5KG5ld1VzZXJLZXkpOw0KICAgICAgZm9yKHVpbnQgaSA9IDAgOyBpIDwgZGVsZWdhdGVBZGRyZXNzZXMubGVuZ3RoIDsgaSsrKXsNCiAgICAgICAgLy9yZW1vdmUgYW55IHBlbmRpbmcgZGVsZWdhdGVzIGFmdGVyIGEgcmVjb3ZlcnkNCiAgICAgICAgaWYoZGVsZWdhdGVzW2RlbGVnYXRlQWRkcmVzc2VzW2ldXS5wZW5kaW5nVW50aWwgPiBub3cpeyANCiAgICAgICAgICAgIGRlbGVnYXRlc1tkZWxlZ2F0ZUFkZHJlc3Nlc1tpXV0uZGVsZXRlZEFmdGVyID0gbm93Ow0KICAgICAgICB9DQogICAgICAgIGRlbGV0ZSBkZWxlZ2F0ZXNbZGVsZWdhdGVBZGRyZXNzZXNbaV1dLnByb3Bvc2VkVXNlcktleTsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiByZXBsYWNlRGVsZWdhdGVzKGFkZHJlc3NbXSBkZWxlZ2F0ZXNUb1JlbW92ZSwgYWRkcmVzc1tdIGRlbGVnYXRlc1RvQWRkKSBvbmx5VXNlcktleXsNCiAgICBmb3IodWludCBpID0gMCA7IGkgPCBkZWxlZ2F0ZXNUb1JlbW92ZS5sZW5ndGggOyBpKyspew0KICAgICAgcmVtb3ZlRGVsZWdhdGUoZGVsZWdhdGVzVG9SZW1vdmVbaV0pOw0KICAgIH0NCiAgICBnYXJiYWdlQ29sbGVjdCgpOw0KICAgIGZvcih1aW50IGogPSAwIDsgaiA8IGRlbGVnYXRlc1RvQWRkLmxlbmd0aCA7IGorKyl7DQogICAgICBhZGREZWxlZ2F0ZShkZWxlZ2F0ZXNUb0FkZFtqXSk7DQogICAgfQ0KICAgIFJlY292ZXJ5RXZlbnQoInJlcGxhY2VEZWxlZ2F0ZXMiLCBtc2cuc2VuZGVyKTsNCiAgfQ0KICBmdW5jdGlvbiBjb2xsZWN0ZWRTaWduYXR1cmVzKGFkZHJlc3MgX3Byb3Bvc2VkVXNlcktleSkgcmV0dXJucyAodWludCBzaWduYXR1cmVzKXsNCiAgICBmb3IodWludCBpID0gMCA7IGkgPCBkZWxlZ2F0ZUFkZHJlc3Nlcy5sZW5ndGggOyBpKyspew0KICAgICAgaWYgKGRlbGVnYXRlSGFzVmFsaWRTaWduYXR1cmUoZGVsZWdhdGVzW2RlbGVnYXRlQWRkcmVzc2VzW2ldXSkgJiYgZGVsZWdhdGVzW2RlbGVnYXRlQWRkcmVzc2VzW2ldXS5wcm9wb3NlZFVzZXJLZXkgPT0gX3Byb3Bvc2VkVXNlcktleSl7DQogICAgICAgIHNpZ25hdHVyZXMrKzsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBnZXRBZGRyZXNzZXMoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzW10peyByZXR1cm4gZGVsZWdhdGVBZGRyZXNzZXM7IH0NCg0KICBmdW5jdGlvbiBuZWVkZWRTaWduYXR1cmVzKCkgcmV0dXJucyAodWludCl7DQogICAgdWludCBjdXJyZW50RGVsZWdhdGVDb3VudDsgLy9hbHdheXMgMCBhdCB0aGlzIHBvaW50DQogICAgZm9yKHVpbnQgaSA9IDAgOyBpIDwgZGVsZWdhdGVBZGRyZXNzZXMubGVuZ3RoIDsgaSsrKXsNCiAgICAgIGlmKGRlbGVnYXRlSXNDdXJyZW50KGRlbGVnYXRlc1tkZWxlZ2F0ZUFkZHJlc3Nlc1tpXV0pKXsgY3VycmVudERlbGVnYXRlQ291bnQrKzsgfQ0KICAgIH0NCiAgICByZXR1cm4gY3VycmVudERlbGVnYXRlQ291bnQvMiArIDE7DQogIH0NCiAgZnVuY3Rpb24gYWRkRGVsZWdhdGUoYWRkcmVzcyBkZWxlZ2F0ZSkgcHJpdmF0ZSB7DQogICAgaWYoIWRlbGVnYXRlUmVjb3JkRXhpc3RzKGRlbGVnYXRlc1tkZWxlZ2F0ZV0pICYmIGRlbGVnYXRlQWRkcmVzc2VzLmxlbmd0aCA8IDE1KSB7DQogICAgICBkZWxlZ2F0ZXNbZGVsZWdhdGVdID0gRGVsZWdhdGUoe3Byb3Bvc2VkVXNlcktleTogMHgwLCBwZW5kaW5nVW50aWw6IG5vdyArIGNvbnRyb2xsZXIubG9uZ1RpbWVMb2NrKCksIGRlbGV0ZWRBZnRlcjogMzE1MzYwMDAwMDAwMDB9KTsNCiAgICAgIGRlbGVnYXRlQWRkcmVzc2VzLnB1c2goZGVsZWdhdGUpOw0KICAgIH0NCiAgfQ0KICBmdW5jdGlvbiByZW1vdmVEZWxlZ2F0ZShhZGRyZXNzIGRlbGVnYXRlKSBwcml2YXRlIHsNCiAgICBpZihkZWxlZ2F0ZXNbZGVsZWdhdGVdLmRlbGV0ZWRBZnRlciA+IGNvbnRyb2xsZXIubG9uZ1RpbWVMb2NrKCkgKyBub3cpeyANCiAgICAgIC8vcmVtb3ZlIHJpZ2h0IGF3YXkgaWYgdGhleSBhcmUgc3RpbGwgcGVuZGluZw0KICAgICAgaWYoZGVsZWdhdGVzW2RlbGVnYXRlXS5wZW5kaW5nVW50aWwgPiBub3cpeyANCiAgICAgICAgZGVsZWdhdGVzW2RlbGVnYXRlXS5kZWxldGVkQWZ0ZXIgPSBub3c7DQogICAgICB9IGVsc2V7DQogICAgICAgIGRlbGVnYXRlc1tkZWxlZ2F0ZV0uZGVsZXRlZEFmdGVyID0gY29udHJvbGxlci5sb25nVGltZUxvY2soKSArIG5vdzsNCiAgICAgIH0NCiAgICB9DQogIH0NCiAgZnVuY3Rpb24gZ2FyYmFnZUNvbGxlY3QoKSBwcml2YXRlew0KICAgIHVpbnQgaSA9IDA7DQogICAgd2hpbGUoaSA8IGRlbGVnYXRlQWRkcmVzc2VzLmxlbmd0aCl7DQogICAgICBpZihkZWxlZ2F0ZUlzRGVsZXRlZChkZWxlZ2F0ZXNbZGVsZWdhdGVBZGRyZXNzZXNbaV1dKSl7DQogICAgICAgIGRlbGVnYXRlc1tkZWxlZ2F0ZUFkZHJlc3Nlc1tpXV0uZGVsZXRlZEFmdGVyID0gMDsNCiAgICAgICAgZGVsZWdhdGVzW2RlbGVnYXRlQWRkcmVzc2VzW2ldXS5wZW5kaW5nVW50aWwgPSAwOw0KICAgICAgICBkZWxlZ2F0ZXNbZGVsZWdhdGVBZGRyZXNzZXNbaV1dLnByb3Bvc2VkVXNlcktleSA9IDA7DQogICAgICAgIEFycmF5TGliLnJlbW92ZUFkZHJlc3MoaSwgZGVsZWdhdGVBZGRyZXNzZXMpOw0KICAgICAgfWVsc2V7aSsrO30NCiAgICB9DQogIH0NCiAgZnVuY3Rpb24gZGVsZWdhdGVSZWNvcmRFeGlzdHMoRGVsZWdhdGUgZCkgcHJpdmF0ZSByZXR1cm5zIChib29sKXsNCiAgICAgIHJldHVybiBkLmRlbGV0ZWRBZnRlciAhPSAwOw0KICB9DQogIGZ1bmN0aW9uIGRlbGVnYXRlSXNEZWxldGVkKERlbGVnYXRlIGQpIHByaXZhdGUgcmV0dXJucyAoYm9vbCl7DQogICAgICByZXR1cm4gZC5kZWxldGVkQWZ0ZXIgPD0gbm93OyAvL2RvZXNudCBjaGVjayByZWNvcmQgZXhpc3RlbmNlDQogIH0NCiAgZnVuY3Rpb24gZGVsZWdhdGVJc0N1cnJlbnQoRGVsZWdhdGUgZCkgcHJpdmF0ZSByZXR1cm5zIChib29sKXsNCiAgICAgIHJldHVybiBkZWxlZ2F0ZVJlY29yZEV4aXN0cyhkKSAmJiAhZGVsZWdhdGVJc0RlbGV0ZWQoZCkgJiYgbm93ID4gZC5wZW5kaW5nVW50aWw7DQogIH0NCiAgZnVuY3Rpb24gZGVsZWdhdGVIYXNWYWxpZFNpZ25hdHVyZShEZWxlZ2F0ZSBkKSBwcml2YXRlIHJldHVybnMgKGJvb2wpew0KICAgICAgcmV0dXJuIGRlbGVnYXRlSXNDdXJyZW50KGQpICYmIGQucHJvcG9zZWRVc2VyS2V5ICE9IDB4MDsNCiAgfQ0KfQ0KDQpjb250cmFjdCBJZGVudGl0eUZhY3Rvcnkgew0KICAgIGV2ZW50IElkZW50aXR5Q3JlYXRlZCgNCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIHVzZXJLZXksDQogICAgICAgIGFkZHJlc3MgcHJveHksDQogICAgICAgIGFkZHJlc3MgY29udHJvbGxlciwNCiAgICAgICAgYWRkcmVzcyByZWNvdmVyeVF1b3J1bSk7DQoNCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYWRkcmVzcykgcHVibGljIHNlbmRlclRvUHJveHk7DQoNCiAgICAvL2Nvc3QgfjIuNE0gZ2FzDQogICAgZnVuY3Rpb24gQ3JlYXRlUHJveHlXaXRoQ29udHJvbGxlckFuZFJlY292ZXJ5KGFkZHJlc3MgdXNlcktleSwgYWRkcmVzc1tdIGRlbGVnYXRlcywgdWludCBsb25nVGltZUxvY2ssIHVpbnQgc2hvcnRUaW1lTG9jaykgew0KICAgICAgICBQcm94eSBwcm94eSA9IG5ldyBQcm94eSgpOw0KICAgICAgICBSZWNvdmVyYWJsZUNvbnRyb2xsZXIgY29udHJvbGxlciA9IG5ldyBSZWNvdmVyYWJsZUNvbnRyb2xsZXIocHJveHksIHVzZXJLZXksIGxvbmdUaW1lTG9jaywgc2hvcnRUaW1lTG9jayk7DQogICAgICAgIHByb3h5LnRyYW5zZmVyKGNvbnRyb2xsZXIpOw0KICAgICAgICBSZWNvdmVyeVF1b3J1bSByZWNvdmVyeVF1b3J1bSA9IG5ldyBSZWNvdmVyeVF1b3J1bShjb250cm9sbGVyLCBkZWxlZ2F0ZXMpOw0KICAgICAgICBjb250cm9sbGVyLmNoYW5nZVJlY292ZXJ5RnJvbVJlY292ZXJ5KHJlY292ZXJ5UXVvcnVtKTsNCg0KICAgICAgICBJZGVudGl0eUNyZWF0ZWQodXNlcktleSwgcHJveHksIGNvbnRyb2xsZXIsIHJlY292ZXJ5UXVvcnVtKTsNCiAgICAgICAgc2VuZGVyVG9Qcm94eVttc2cuc2VuZGVyXSA9IHByb3h5Ow0KICAgIH0NCn0='