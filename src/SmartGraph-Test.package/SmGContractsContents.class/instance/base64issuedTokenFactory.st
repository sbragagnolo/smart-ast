base 64 content
base64issuedTokenFactory
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC40Ow0KLyoNClRoaXMgZmlsZSBpcyBwYXJ0IG9mIFdlaUZ1bmQuDQoqLw0KDQovKg0KQSBjb21tb24gT3duZWQgY29udHJhY3QgdGhhdCBjb250YWlucyBwcm9wZXJ0aWVzIGZvciBjb250cmFjdCBvd25lcnNoaXAuDQoqLw0KDQoNCg0KLy8vIEB0aXRsZSBBIHNpbmdsZSBvd25lZCBjYW1wYWlnbiBjb250cmFjdCBmb3IgaW5zdGFudGlhdGluZyBvd25lcnNoaXAgcHJvcGVydGllcy4NCi8vLyBAYXV0aG9yIE5pY2sgRG9kc29uIDxuaWNrLmRvZHNvbkBjb25zZW5zeXMubmV0Pg0KY29udHJhY3QgT3duZWQgew0KICAvLyBvbmx5IHRoZSBvd25lciBjYW4gdXNlIHRoaXMgbWV0aG9kDQogIG1vZGlmaWVyIG9ubHlvd25lcigpIHsNCiAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgXzsNCiAgfQ0KDQogIC8vIHRoZSBvd25lciBwcm9wZXJ0eQ0KICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCn0NCg0KLyoNClRoaXMgZmlsZSBpcyBwYXJ0IG9mIFdlaUZ1bmQuDQoqLw0KDQoNCi8qDQpUaGlzIGltcGxlbWVudHMgT05MWSB0aGUgc3RhbmRhcmQgZnVuY3Rpb25zIGFuZCBOT1RISU5HIGVsc2UuDQpGb3IgYSB0b2tlbiBsaWtlIHlvdSB3b3VsZCB3YW50IHRvIGRlcGxveSBpbiBzb21ldGhpbmcgbGlrZSBNaXN0LCBzZWUgSHVtYW5TdGFuZGFyZFRva2VuLnNvbC4NCg0KSWYgeW91IGRlcGxveSB0aGlzLCB5b3Ugd29uJ3QgaGF2ZSBhbnl0aGluZyB1c2VmdWwuDQoNCkltcGxlbWVudHMgRVJDIDIwIFRva2VuIHN0YW5kYXJkOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCi4qLw0KLyoNClRoaXMgZmlsZSBpcyBwYXJ0IG9mIFdlaUZ1bmQuDQoqLw0KDQoNCmNvbnRyYWN0IFRva2VuIHsNCg0KICAgIC8vLyBAcmV0dXJuIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMNCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KSB7fQ0KDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZA0KICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHt9DQoNCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgDQogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudA0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykge30NCg0KICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYA0KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcg0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7fQ0KDQogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfYWRkcmAgdG8gc3BlbmQgYF92YWx1ZWAgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHdlaSB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXINCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHt9DQoNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50DQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykge30NCg0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOw0KfQ0KDQoNCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4gew0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7DQogICAgICAgIC8vRGVmYXVsdCBhc3N1bWVzIHRvdGFsU3VwcGx5IGNhbid0IGJlIG92ZXIgbWF4ICgyXjI1NiAtIDEpLg0KICAgICAgICAvL0lmIHlvdXIgdG9rZW4gbGVhdmVzIG91dCB0b3RhbFN1cHBseSBhbmQgY2FuIGlzc3VlIG1vcmUgdG9rZW5zIGFzIHRpbWUgZ29lcyBvbiwgeW91IG5lZWQgdG8gY2hlY2sgaWYgaXQgZG9lc24ndCB3cmFwLg0KICAgICAgICAvL1JlcGxhY2UgdGhlIGlmIHdpdGggdGhpcyBvbmUgaW5zdGVhZC4NCiAgICAgICAgLy9pZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7DQogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgew0KICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7DQogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIC8vc2FtZSBhcyBhYm92ZS4gUmVwbGFjZSB0aGlzIGxpbmUgd2l0aCB0aGUgZm9sbG93aW5nIGlmIHlvdSB3YW50IHRvIHByb3RlY3QgYWdhaW5zdCB3cmFwcGluZyB1aW50cy4NCiAgICAgICAgLy9pZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsNCiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDApIHsNCiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOw0KICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsNCiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsNCiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgew0KICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogICAgfQ0KDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7DQogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7DQp9DQoNCg0KLyoNClRoaXMgZmlsZSBpcyBwYXJ0IG9mIFdlaUZ1bmQuDQoqLw0KDQovKg0KVXNlZCBmb3IgY29udHJhY3RzIHRoYXQgaGF2ZSBhbiBpc3N1ZXIuDQoqLw0KDQoNCg0KLy8vIEB0aXRsZSBJc3N1ZWQgLSBpbnRlcmZhY2UgdXNlZCBmb3IgYnVpbGQgaXNzdWVkIGFzc2V0IGNvbnRyYWN0cw0KLy8vIEBhdXRob3IgTmljayBEb2Rzb24gPG5pY2suZG9kc29uQGNvbnNlbnN5cy5uZXQ+DQpjb250cmFjdCBJc3N1ZWQgew0KICAvLy8gQG5vdGljZSB3aWxsIHNldCB0aGUgYXNzZXQgaXNzdWVyIGFkZHJlc3MNCiAgLy8vIEBwYXJhbSBfaXNzdWVyIFRoZSBhZGRyZXNzIG9mIHRoZSBpc3N1ZXINCiAgZnVuY3Rpb24gc2V0SXNzdWVyKGFkZHJlc3MgX2lzc3VlcikgcHVibGljIHt9DQp9DQoNCg0KDQovLy8gQHRpdGxlIElzc3VlZCB0b2tlbiBjb250cmFjdCBhbGxvd3MgbmV3IHRva2VucyB0byBiZSBpc3N1ZWQgYnkgYW4gaXNzdWVyLg0KLy8vIEBhdXRob3IgTmljayBEb2Rzb24gPG5pY2suZG9kc29uQGNvbnNlbnN5cy5uZXQ+DQpjb250cmFjdCBJc3N1ZWRUb2tlbiBpcyBPd25lZCwgSXNzdWVkLCBTdGFuZGFyZFRva2VuIHsNCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgew0KICAgIC8vIGlmIHRoZSBpc3N1ZXIgaXMgYXR0ZW1wdGluZyB0cmFuc2Zlcg0KICAgIC8vIHRoZW4gbWludCBuZXcgY29pbnMgdG8gYWRkcmVzcyBvZiB0cmFuc2Zlcg0KICAgIC8vIGJ5IHVzaW5nIHRyYW5zZmVyLCB3ZSBkb250IG5lZWQgdG8gc3dpdGNoIFN0YW5kYXJkVG9rZW4gQVBJIG1ldGhvZA0KICAgIGlmIChtc2cuc2VuZGVyID09IGlzc3VlciAmJiAobGFzdElzc3VhbmNlID09IDAgfHwgYmxvY2subnVtYmVyIDwgbGFzdElzc3VhbmNlKSkgew0KICAgICAgLy8gaW5jcmVhc2UgdGhlIGJhbGFuY2Ugb2YgdXNlciBieSB0cmFuc2ZlciBhbW91bnQNCiAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOw0KDQogICAgICAvLyBpbmNyZWFzZSB0b3RhbCBzdXBwbHkgYnkgYmFsYW5jZQ0KICAgICAgdG90YWxTdXBwbHkgKz0gX3ZhbHVlOw0KDQogICAgICAvLyByZXR1cm4gcmVxdWlyZWQgdHJ1ZSB2YWx1ZSBmb3IgdHJhbnNmZXINCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0gZWxzZSB7DQogICAgICBpZiAoZnJlZXplUGVyaW9kID09IDAgfHwgYmxvY2subnVtYmVyID4gZnJlZXplUGVyaW9kKSB7DQogICAgICAgIC8vIGNvbnRpbnVlIHdpdGggYSBub3JtYWwgdHJhbnNmZXINCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQ0KICAgIHB1YmxpYw0KICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgIC8vIGlmIHdlIGFyZSBwYXNzZWQgdGhlIGZyZWUgcGVyaW9kLCB0aGVuIHRyYW5zZmVyRnJvbQ0KICAgIGlmIChmcmVlemVQZXJpb2QgPT0gMCB8fCBibG9jay5udW1iZXIgPiBmcmVlemVQZXJpb2QpIHsNCiAgICAgIC8vIHJldHVybiB0cmFuc2ZlckZyb20NCiAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzZXRJc3N1ZXIoYWRkcmVzcyBfaXNzdWVyKSBwdWJsaWMgb25seW93bmVyKCkgew0KICAgIC8vIHNldCB0aGUgaXNzdWVyDQogICAgaWYgKGlzc3VlciA9PSBhZGRyZXNzKDApKSB7DQogICAgICBpc3N1ZXIgPSBfaXNzdWVyOw0KICAgIH0gZWxzZSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBJc3N1ZWRUb2tlbigNCiAgICBhZGRyZXNzW10gX2FkZHJzLA0KICAgIHVpbnQyNTZbXSBfYW1vdW50cywNCiAgICB1aW50MjU2IF9mcmVlemVQZXJpb2QsDQogICAgdWludDI1NiBfbGFzdElzc3VhbmNlLA0KICAgIGFkZHJlc3MgX293bmVyLA0KICAgIHN0cmluZyBfbmFtZSwNCiAgICB1aW50OCBfZGVjaW1hbHMsDQogICAgc3RyaW5nIF9zeW1ib2wpIHsNCiAgICAvLyBpc3N1ZSB0aGUgaW5pdGlhbCB0b2tlbnMsIGlmIGFueQ0KICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9hZGRycy5sZW5ndGg7IGkgKyspIHsNCiAgICAgIC8vIGluY3JlYXNlIGJhbGFuY2Ugb2YgdGhhdCBhZGRyZXNzDQogICAgICBiYWxhbmNlc1tfYWRkcnNbaV1dICs9IF9hbW91bnRzW2ldOw0KDQogICAgICAvLyBpbmNyZWFzZSB0b2tlbiBzdXBwbHkgb2YgdGhhdCBhZGRyZXNzDQogICAgICB0b3RhbFN1cHBseSArPSBfYW1vdW50c1tpXTsNCiAgICB9DQoNCiAgICAvLyBzZXQgdGhlIHRyYW5zZmVyIGZyZWV6ZSBwZXJpb2QsIGlmIGFueQ0KICAgIGZyZWV6ZVBlcmlvZCA9IF9mcmVlemVQZXJpb2Q7DQoNCiAgICAvLyBzZXQgdGhlIHRva2VuIG93bmVyLCB3aG8gY2FuIHNldCB0aGUgaXNzdWVyDQogICAgb3duZXIgPSBfb3duZXI7DQoNCiAgICAvLyBzZXQgdGhlIGJsb2NrbnVtYmVyIG9mIGxhc3QgaXNzdWFuY2UsIGlmIGFueQ0KICAgIGxhc3RJc3N1YW5jZSA9IF9sYXN0SXNzdWFuY2U7DQoNCiAgICAvLyBzZXQgdG9rZW4gbmFtZQ0KICAgIG5hbWUgPSBfbmFtZTsNCg0KICAgIC8vIHNldCBkZWNpbWFscw0KICAgIGRlY2ltYWxzID0gX2RlY2ltYWxzOw0KDQogICAgLy8gc2V0IHN1bWJvbA0KICAgIHN5bWJvbCA9IF9zeW1ib2w7DQogIH0NCg0KICAvLyB0aGUgdHJhbnNmZXIgZnJlZXplIHBlcmlvZA0KICB1aW50MjU2IHB1YmxpYyBmcmVlemVQZXJpb2Q7DQoNCiAgLy8gdGhlIGJsb2NrIG51bWJlciBvZiBsYXN0IGlzc3VhbmNlIChzZXQgdG8gemVybywgaWYgbm9uZSkNCiAgdWludDI1NiBwdWJsaWMgbGFzdElzc3VhbmNlOw0KDQogIC8vIHRoZSB0b2tlbiBpc3N1ZXIgYWRkcmVzcywgaWYgYW55DQogIGFkZHJlc3MgcHVibGljIGlzc3VlcjsNCg0KICAvLyB0b2tlbiBuYW1lDQogIHN0cmluZyBwdWJsaWMgbmFtZTsNCg0KICAvLyB0b2tlbiBkZWNpbWFscw0KICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7DQoNCiAgLy8gc3ltYm9sDQogIHN0cmluZyBwdWJsaWMgc3ltYm9sOw0KDQogIC8vIHZlcmlzb24NCiAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gIldGSVQxLjAiOw0KfQ0KDQoNCi8vLyBAdGl0bGUgUHJpdmF0ZSBTZXJ2aWNlIFJlZ2lzdHJ5IC0gdXNlZCB0byByZWdpc3RlciBnZW5lcmF0ZWQgc2VydmljZSBjb250cmFjdHMuDQovLy8gQGF1dGhvciBOaWNrIERvZHNvbiA8bmljay5kb2Rzb25AY29uc2Vuc3lzLm5ldD4NCmNvbnRyYWN0IFByaXZhdGVTZXJ2aWNlUmVnaXN0cnlJbnRlcmZhY2Ugew0KICAvLy8gQG5vdGljZSByZWdpc3RlciB0aGUgc2VydmljZSAnX3NlcnZpY2UnIHdpdGggdGhlIHByaXZhdGUgc2VydmljZSByZWdpc3RyeQ0KICAvLy8gQHBhcmFtIF9zZXJ2aWNlIHRoZSBzZXJ2aWNlIGNvbnRyYWN0IHRvIGJlIHJlZ2lzdGVyZWQNCiAgLy8vIEByZXR1cm4gdGhlIHNlcnZpY2UgSUQgJ3NlcnZpY2VJZCcNCiAgZnVuY3Rpb24gcmVnaXN0ZXIoYWRkcmVzcyBfc2VydmljZSkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiBzZXJ2aWNlSWQpIHt9DQoNCiAgLy8vIEBub3RpY2UgaXMgdGhlIHNlcnZpY2UgaW4gcXVlc3Rpb24gJ19zZXJ2aWNlJyBhIHJlZ2lzdGVyZWQgc2VydmljZSB3aXRoIHRoaXMgcmVnaXN0cnkNCiAgLy8vIEBwYXJhbSBfc2VydmljZSB0aGUgc2VydmljZSBjb250cmFjdCBhZGRyZXNzDQogIC8vLyBAcmV0dXJuIGVpdGhlciB5ZXMgKHRydWUpIHRoZSBzZXJ2aWNlIGlzIHJlZ2lzdGVyZWQgb3Igbm8gKGZhbHNlKSB0aGUgc2VydmljZSBpcyBub3QNCiAgZnVuY3Rpb24gaXNTZXJ2aWNlKGFkZHJlc3MgX3NlcnZpY2UpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7fQ0KDQogIC8vLyBAbm90aWNlIGhlbHBzIHRvIGdldCBzZXJ2aWNlIGFkZHJlc3MNCiAgLy8vIEBwYXJhbSBfc2VydmljZUlkIHRoZSBzZXJ2aWNlIElEDQogIC8vLyBAcmV0dXJuIHJldHVybnMgdGhlIHNlcnZpY2UgYWRkcmVzcyBvZiBzZXJ2aWNlIElEDQogIGZ1bmN0aW9uIHNlcnZpY2VzKHVpbnQyNTYgX3NlcnZpY2VJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgX3NlcnZpY2UpIHt9DQoNCiAgLy8vIEBub3RpY2UgcmV0dXJucyB0aGUgaWQgb2YgYSBzZXJ2aWNlIGFkZHJlc3MsIGlmIGFueQ0KICAvLy8gQHBhcmFtIF9zZXJ2aWNlIHRoZSBzZXJ2aWNlIGNvbnRyYWN0IGFkZHJlc3MNCiAgLy8vIEByZXR1cm4gdGhlIHNlcnZpY2UgaWQgb2YgYSBzZXJ2aWNlDQogIGZ1bmN0aW9uIGlkcyhhZGRyZXNzIF9zZXJ2aWNlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzZXJ2aWNlSWQpIHt9DQoNCiAgZXZlbnQgU2VydmljZVJlZ2lzdGVyZWQoYWRkcmVzcyBfc2VuZGVyLCBhZGRyZXNzIF9zZXJ2aWNlKTsNCn0NCg0KY29udHJhY3QgUHJpdmF0ZVNlcnZpY2VSZWdpc3RyeSBpcyBQcml2YXRlU2VydmljZVJlZ2lzdHJ5SW50ZXJmYWNlIHsNCg0KICBtb2RpZmllciBpc1JlZ2lzdGVyZWRTZXJ2aWNlKGFkZHJlc3MgX3NlcnZpY2UpIHsNCiAgICAvLyBkb2VzIHRoZSBzZXJ2aWNlIGV4aXN0IGluIHRoZSByZWdpc3RyeSwgaXMgdGhlIHNlcnZpY2UgYWRkcmVzcyBub3QgZW1wdHkNCiAgICBpZiAoc2VydmljZXMubGVuZ3RoID4gMCkgew0KICAgICAgaWYgKHNlcnZpY2VzW2lkc1tfc2VydmljZV1dID09IF9zZXJ2aWNlICYmIF9zZXJ2aWNlICE9IGFkZHJlc3MoMCkpIHsNCiAgICAgICAgXzsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBtb2RpZmllciBpc05vdFJlZ2lzdGVyZWRTZXJ2aWNlKGFkZHJlc3MgX3NlcnZpY2UpIHsNCiAgICAvLyBpZiB0aGUgc2VydmljZSAnX3NlcnZpY2UnIGlzIG5vdCBhIHJlZ2lzdGVyZWQgc2VydmljZQ0KICAgIGlmICghaXNTZXJ2aWNlKF9zZXJ2aWNlKSkgew0KICAgICAgXzsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiByZWdpc3RlcihhZGRyZXNzIF9zZXJ2aWNlKQ0KICAgIGludGVybmFsDQogICAgaXNOb3RSZWdpc3RlcmVkU2VydmljZShfc2VydmljZSkNCiAgICByZXR1cm5zICh1aW50IHNlcnZpY2VJZCkgew0KICAgIC8vIGNyZWF0ZSBzZXJ2aWNlIElEIGJ5IGluY3JlYXNpbmcgc2VydmljZXMgbGVuZ3RoDQogICAgc2VydmljZUlkID0gc2VydmljZXMubGVuZ3RoKys7DQoNCiAgICAvLyBzZXQgdGhlIG5ldyBzZXJ2aWNlIElEIHRvIHRoZSAnX3NlcnZpY2UnIGFkZHJlc3MNCiAgICBzZXJ2aWNlc1tzZXJ2aWNlSWRdID0gX3NlcnZpY2U7DQoNCiAgICAvLyBzZXQgdGhlIGlkcyBzdG9yZSB0byBsaW5rIHRvIHRoZSAnc2VydmljZUlkJyBjcmVhdGVkDQogICAgaWRzW19zZXJ2aWNlXSA9IHNlcnZpY2VJZDsNCg0KICAgIC8vIGZpcmUgdGhlICdTZXJ2aWNlUmVnaXN0ZXJlZCcgZXZlbnQNCiAgICBTZXJ2aWNlUmVnaXN0ZXJlZChtc2cuc2VuZGVyLCBfc2VydmljZSk7DQogIH0NCg0KICBmdW5jdGlvbiBpc1NlcnZpY2UoYWRkcmVzcyBfc2VydmljZSkNCiAgICBwdWJsaWMNCiAgICBjb25zdGFudA0KICAgIGlzUmVnaXN0ZXJlZFNlcnZpY2UoX3NlcnZpY2UpDQogICAgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgYWRkcmVzc1tdIHB1YmxpYyBzZXJ2aWNlczsNCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpZHM7DQp9DQoNCi8vLyBAdGl0bGUgSXNzdWVkIFRva2VuIEZhY3RvcnkgLSB1c2VkIHRvIGdlbmVyYXRlIGFuZCByZWdpc3RlciBJc3N1ZWRUb2tlbiBjb250cmFjdHMNCi8vLyBAYXV0aG9yIE5pY2sgRG9kc29uIDxuaWNrLmRvZHNvbkBjb25zZW5zeXMubmV0Pg0KY29udHJhY3QgSXNzdWVkVG9rZW5GYWN0b3J5IGlzIFByaXZhdGVTZXJ2aWNlUmVnaXN0cnkgew0KICBmdW5jdGlvbiBjcmVhdGVJc3N1ZWRUb2tlbigNCiAgICBhZGRyZXNzW10gX2FkZHJzLA0KICAgIHVpbnQyNTZbXSBfYW1vdW50cywNCiAgICB1aW50MjU2IF9mcmVlemVQZXJpb2QsDQogICAgdWludDI1NiBfbGFzdElzc3VhbmNlLA0KICAgIHN0cmluZyBfbmFtZSwNCiAgICB1aW50OCBfZGVjaW1hbHMsDQogICAgc3RyaW5nIF9zeW1ib2wpDQogIHB1YmxpYw0KICByZXR1cm5zIChhZGRyZXNzIHRva2VuQWRkcmVzcykgew0KICAgIC8vIGNyZWF0ZSBhIG5ldyBtdWx0aSBzaWcgd2FsbGV0DQogICAgdG9rZW5BZGRyZXNzID0gYWRkcmVzcyhuZXcgSXNzdWVkVG9rZW4oDQogICAgICBfYWRkcnMsDQogICAgICBfYW1vdW50cywNCiAgICAgIF9mcmVlemVQZXJpb2QsDQogICAgICBfbGFzdElzc3VhbmNlLA0KICAgICAgbXNnLnNlbmRlciwNCiAgICAgIF9uYW1lLA0KICAgICAgX2RlY2ltYWxzLA0KICAgICAgX3N5bWJvbCkpOw0KDQogICAgLy8gcmVnaXN0ZXIgdGhhdCBtdWx0aXNpZyB3YWxsZXQgYWRkcmVzcyBhcyBzZXJ2aWNlDQogICAgcmVnaXN0ZXIodG9rZW5BZGRyZXNzKTsNCiAgfQ0KfQ=='