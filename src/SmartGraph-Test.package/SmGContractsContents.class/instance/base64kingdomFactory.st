base 64 content
base64kingdomFactory
	^'Ly8gS2luZyBvZiB0aGUgRXRoZXIgVGhyb25lIENvbnRyYWN0cy4NCi8vIENvcHlyaWdodCAoYykgMjAxNiBLaWVyYW4gRWxieS4gUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLg0KLy8gVmVyc2lvbiAxLjAuMCwgMzEgSnVseSAyMDE2Lg0KLy8NCi8vIFNlZSBhbHNvIGh0dHA6Ly93d3cua2luZ29mdGhlZXRoZXIuY29tIGFuZA0KLy8gaHR0cHM6Ly9naXRodWIuY29tL2tpZXJhbmVsYnkvS2luZ09mVGhlRXRoZXJUaHJvbmUgLg0KLy8gDQovLyBUaGlzIGZpbGUgY29udGFpbnMgYSBudW1iZXIgb2YgY29udHJhY3RzLCBvZiB3aGljaCBvbmx5DQovLyB0aGVzZSB0aHJlZSBhcmUgbm9ybWFsbHkgY3JlYXRlZDoNCi8vDQovLyAtIEtpbmdkb20gICAgICAgID0gbWFpbnRhaW5zIHRoZSB0aHJvbmUgZm9yIGEga2luZ2RvbQ0KLy8gLSBXb3JsZCAgICAgICAgICA9IHJ1bnMgdGhlIHdvcmxkLCB3aGljaCBpcyBhIGNvbGxlY3Rpb24gb2Yga2luZ2RvbXMNCi8vIC0gS2luZ2RvbUZhY3RvcnkgPSB1c2VkIGludGVybmFsbHkgYnkgdGhlIFdvcmxkIGNvbnRyYWN0DQovLw0KLy8gVGhlICJNaXhpbiIgY29udHJhY3RzIChUaHJvbmVSdWxlc01peGluLCBSZWVudHJ5UHJvdGVjdG9yTWl4aW4sDQovLyBDYXJlZnVsU2VuZGVyTWl4aW4sIEZ1bmRzSG9sZGVyTWl4aW4sIE1vbmV5Um91bmRlck1peGluLA0KLy8gTmFtZWFibGVNaXhpbikgY29udGFpbiBmdW5jdGlvbnMgLyBkYXRhIC8gc3RydWN0dXJlcyB1c2VkDQovLyBieSB0aGUgdGhyZWUgbWFpbiBjb250cmFjdHMuDQovLyBUaGUgRXhwb3NlZEludGVybmFsc0ZvclRlc3RpbmcgY29udHJhY3QgaXMgdXNlZCBieSBhdXRvbWF0ZWQgdGVzdHMuDQoNCg0KLy8vIEB0aXRsZSBNaXhpbiB0byBoZWxwIGF2b2lkIHJlY3Vyc2l2ZS1jYWxsIGF0dGFja3MuDQpjb250cmFjdCBSZWVudHJ5UHJvdGVjdG9yTWl4aW4gew0KDQogICAgLy8gdHJ1ZSBpZiB3ZSBhcmUgaW5zaWRlIGFuIGV4dGVybmFsIGZ1bmN0aW9uDQogICAgYm9vbCByZWVudHJ5UHJvdGVjdG9yOw0KDQogICAgLy8gTWFyayBjb250cmFjdCBhcyBoYXZpbmcgZW50ZXJlZCBhbiBleHRlcm5hbCBmdW5jdGlvbi4NCiAgICAvLyBUaHJvd3MgYW4gZXhjZXB0aW9uIGlmIGNhbGxlZCB0d2ljZSB3aXRoIG5vIGV4dGVybmFsTGVhdmUoKS4NCiAgICAvLyBGb3IgdGhpcyB0byB3b3JrLCBDb250cmFjdHMgTVVTVDoNCiAgICAvLyAgLSBjYWxsIGV4dGVybmFsRW50ZXIoKSBhdCB0aGUgc3RhcnQgb2YgZWFjaCBleHRlcm5hbCBmdW5jdGlvbg0KICAgIC8vICAtIGNhbGwgZXh0ZXJuYWxMZWF2ZSgpIGF0IHRoZSBlbmQgb2YgZWFjaCBleHRlcm5hbCBmdW5jdGlvbg0KICAgIC8vICAtIG5ldmVyIHVzZSByZXR1cm4gc3RhdGVtZW50cyBpbiBiZXR3ZWVuIGVudGVyIGFuZCBsZWF2ZQ0KICAgIC8vICAtIG5ldmVyIGNhbGwgYW4gZXh0ZXJuYWwgZnVuY3Rpb24gZnJvbSBhbm90aGVyIGZ1bmN0aW9uDQogICAgLy8gV0FSTjogc2VyaW91cyByaXNrIG9mIGNvbnRyYWN0IGdldHRpbmcgc3R1Y2sgaWYgdXNlZCB3cm9uZ2x5Lg0KICAgIGZ1bmN0aW9uIGV4dGVybmFsRW50ZXIoKSBpbnRlcm5hbCB7DQogICAgICAgIGlmIChyZWVudHJ5UHJvdGVjdG9yKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICByZWVudHJ5UHJvdGVjdG9yID0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLyBNYXJrIGNvbnRyYWN0IGFzIGhhdmluZyBsZWZ0IGFuIGV4dGVybmFsIGZ1bmN0aW9uLg0KICAgIC8vIERvIHRoaXMgYWZ0ZXIgZWFjaCBjYWxsIHRvIGV4dGVybmFsRW50ZXIoKS4NCiAgICBmdW5jdGlvbiBleHRlcm5hbExlYXZlKCkgaW50ZXJuYWwgew0KICAgICAgICByZWVudHJ5UHJvdGVjdG9yID0gZmFsc2U7DQogICAgfQ0KDQp9DQoNCg0KLy8vIEB0aXRsZSBNaXhpbiB0byBoZWxwIHNlbmQgZXRoZXIgdG8gdW50cnVzdGVkIGFkZHJlc3Nlcy4NCmNvbnRyYWN0IENhcmVmdWxTZW5kZXJNaXhpbiB7DQoNCiAgICAvLyBTZWVtcyBhIHJlYXNvbmFibGUgYW1vdW50IGZvciBhIHdlbGwtd3JpdHRlbiBmYWxsYmFjayBmdW5jdGlvbi4NCiAgICB1aW50IGNvbnN0YW50IHN1Z2dlc3RlZEV4dHJhR2FzVG9JbmNsdWRlV2l0aFNlbmRzID0gMjMwMDA7DQoNCiAgICAvLyBTZW5kIGBfdmFsdWVXZWlgIG9mIG91ciBldGhlciB0byBgX3RvQWRkcmVzc2AsIGluY2x1ZGluZw0KICAgIC8vIGBfZXh0cmFHYXNJbmNsdWRlZGAgZ2FzIGFib3ZlIHRoZSB1c3VhbCAyMzAwIGdhcyBzdGlwZW5kDQogICAgLy8gd2l0aCB0aGUgc2VuZCBjYWxsLg0KICAgIC8vDQogICAgLy8gVGhpcyBuZWVkcyBjYXJlIGJlY2F1c2UgdGhlcmUgaXMgbm8gd2F5IHRvIHRlbGwgaWYgX3RvQWRkcmVzcw0KICAgIC8vIGlzIGV4dGVybmFsbHkgb3duZWQgb3IgaXMgYW5vdGhlciBjb250cmFjdCAtIGFuZCBzZW5kaW5nIGV0aGVyDQogICAgLy8gdG8gYSBjb250cmFjdCBhZGRyZXNzIHdpbGwgaW52b2tlIGl0cyBmYWxsYmFjayBmdW5jdGlvbjsgdGhpcw0KICAgIC8vIGhhcyB0aHJlZSBpbXBsaWNhdGlvbnM6DQogICAgLy8NCiAgICAvLyAxKSBEYW5nZXIgb2YgcmVjdXJzaXZlIGF0dGFjay4NCiAgICAvLyAgVGhlIGRlc3RpbmF0aW9uIGNvbnRyYWN0J3MgZmFsbGJhY2sgZnVuY3Rpb24gKG9yIGFub3RoZXINCiAgICAvLyAgY29udHJhY3QgaXQgY2FsbHMpIG1heSBjYWxsIGJhY2sgaW50byB0aGlzIGNvbnRyYWN0IChpbmNsdWRpbmcNCiAgICAvLyAgb3VyIGZhbGxiYWNrIGZ1bmN0aW9uIGFuZCBleHRlcm5hbCBmdW5jdGlvbnMgaW5oZXJpdGVkLCBvciBpbnRvDQogICAgLy8gIG90aGVyIGNvbnRyYWN0cyBpbiBvdXIgc3RhY2spLCBsZWFkaW5nIHRvIHVuZXhwZWN0ZWQgYmVoYXZpb3VyLg0KICAgIC8vICBNaXRpZ2F0aW9uczoNCiAgICAvLyAgIC0gcHJvdGVjdCBhbGwgZXh0ZXJuYWwgZnVuY3Rpb25zIGFnYWluc3QgcmUtZW50cnkgaW50bw0KICAgIC8vICAgICBhbnkgb2YgdGhlbSAoc2VlIFJlZW50cnlQcm90ZWN0b3JNaXhpbik7DQogICAgLy8gICAtIHByb2dyYW0gdmVyeSBkZWZlbnNpdmVseSAoZS5nLiBkZWJpdCBiYWxhbmNlIGJlZm9yZSBzZW5kKS4NCiAgICAvLw0KICAgIC8vIDIpIERlc3RpbmF0aW9uIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBmYWlsLg0KICAgIC8vICBJZiB0aGUgZGVzdGluYXRpb24gY29udHJhY3QncyBmYWxsYmFjayBmdW5jdGlvbiBmYWlscywgZXRoZXINCiAgICAvLyAgd2lsbCBub3QgYmUgc2VudCBhbmQgbWF5IGJlIGxvY2tlZCBpbnRvIHRoZSBzZW5kaW5nIGNvbnRyYWN0Lg0KICAgIC8vICBVbmxpa2UgbW9zdCBlcnJvcnMsIGl0IHdpbGwgTk9UIGNhdXNlIHRoaXMgY29udHJhY3QgdG8gdGhyb3cuDQogICAgLy8gIE1pdGlnYXRpb25zOg0KICAgIC8vICAgLSBjaGVjayB0aGUgcmV0dXJuIHZhbHVlIGZyb20gdGhpcyBmdW5jdGlvbiAoc2VlIGJlbG93KS4NCiAgICAvLw0KICAgIC8vIDMpIEdhcyB1c2FnZS4NCiAgICAvLyAgVGhlIGRlc3RpbmF0aW9uIGZhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgY29uc3VtZSB0aGUgZ2FzIHN1cHBsaWVkDQogICAgLy8gIGluIHRoaXMgdHJhbnNhY3Rpb24gKHdoaWNoIGlzIGZpeGVkIGFuZCBzZXQgYnkgdGhlIHRyYW5zYWN0aW9uDQogICAgLy8gIHN0YXJ0ZXIsIHRob3VnaCBzb21lIGNsaWVudHMgZG8gYSBnb29kIGpvYiBvZiBlc3RpbWF0aW5nIGl0Lg0KICAgIC8vICBUaGlzIGlzIGEgcHJvYmxlbSBmb3IgbG90dGVyeS10eXBlIGNvbnRyYWN0cyB3aGVyZSBvbmUgdmVyeQ0KICAgIC8vICBleHBlbnNpdmUtdG8tY2FsbCByZWNlaXZpbmcgY29udHJhY3QgY291bGQgJ3BvaXNvbicgdGhlIGxvdHRlcnkNCiAgICAvLyAgY29udHJhY3QgYnkgcHJldmVudGluZyBpdCBiZWluZyBpbnZva2VkIGJ5IGFub3RoZXIgcGVyc29uIHdobw0KICAgIC8vICBjYW5ub3Qgc3VwcGx5IGVub3VnaCBnYXMuDQogICAgLy8gIE1pdGlnYXRpb25zOg0KICAgIC8vICAgIC0gY2hvb3NlIHNlbnNpYmxlIHZhbHVlIGZvciBfZXh0cmFHYXNJbmNsdWRlZCAoYnkgZGVmYXVsdA0KICAgIC8vICAgICAgb25seSAyMzAwIGdhcyBpcyBzdXBwbGllZCB0byB0aGUgZGVzdGluYXRpb24gZnVuY3Rpb24pOw0KICAgIC8vICAgIC0gaWYgY2FsbCBmYWlscyBjb25zaWRlciB3aGV0aGVyIHRvIHRocm93IG9yIHRvIHJpbmctZmVuY2UNCiAgICAvLyAgICAgIGZ1bmRzIGZvciBsYXRlciB3aXRoZHJhd2FsLg0KICAgIC8vDQogICAgLy8gUmV0dXJuczoNCiAgICAvLw0KICAgIC8vICBUcnVlIGlmLWFuZC1vbmx5LWlmIHRoZSBzZW5kIGNhbGwgd2FzIG1hZGUgYW5kIGRpZCBub3QgdGhyb3cNCiAgICAvLyAgYW4gZXJyb3IuIEluIHRoaXMgY2FzZSwgd2Ugd2lsbCBubyBsb25nZXIgb3duIHRoZSBfdmFsdWVXZWkNCiAgICAvLyAgZXRoZXIuIE5vdGUgdGhhdCB3ZSBjYW5ub3QgZ2V0IHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIGZhbGxiYWNrDQogICAgLy8gIGZ1bmN0aW9uIGNhbGxlZCAoaWYgYW55KS4NCiAgICAvLw0KICAgIC8vICBGYWxzZSBpZiB0aGUgc2VuZCB3YXMgbWFkZSBidXQgdGhlIGRlc3RpbmF0aW9uIGZhbGxiYWNrIGZ1bmN0aW9uDQogICAgLy8gIHRocmV3IGFuIGVycm9yIChvciByYW4gb3V0IG9mIGdhcykuIElmIHRoaXMgaGFwZW5zLCB3ZSBzdGlsbCBvd24NCiAgICAvLyAgX3ZhbHVlV2VpIGV0aGVyIGFuZCB0aGUgZGVzdGluYXRpb24ncyBhY3Rpb25zIHdlcmUgdW5kb25lLg0KICAgIC8vDQogICAgLy8gIFRoaXMgZnVuY3Rpb24gc2hvdWxkIG5vdCBub3JtYWxseSB0aHJvdyBhbiBlcnJvciB1bmxlc3M6DQogICAgLy8gICAgLSBub3QgZW5vdWdoIGdhcyB0byBtYWtlIHRoZSBzZW5kL2NhbGwNCiAgICAvLyAgICAtIG1heCBjYWxsIHN0YWNrIGRlcHRoIHJlYWNoZWQNCiAgICAvLyAgICAtIGluc3VmZmljaWVudCBldGhlcg0KICAgIC8vDQogICAgZnVuY3Rpb24gY2FyZWZ1bFNlbmRXaXRoRml4ZWRHYXMoDQogICAgICAgIGFkZHJlc3MgX3RvQWRkcmVzcywNCiAgICAgICAgdWludCBfdmFsdWVXZWksDQogICAgICAgIHVpbnQgX2V4dHJhR2FzSW5jbHVkZWQNCiAgICApIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICByZXR1cm4gX3RvQWRkcmVzcy5jYWxsLnZhbHVlKF92YWx1ZVdlaSkuZ2FzKF9leHRyYUdhc0luY2x1ZGVkKSgpOw0KICAgIH0NCg0KfQ0KDQoNCi8vLyBAdGl0bGUgTWl4aW4gdG8gaGVscCB0cmFjayB3aG8gb3ducyBvdXIgZXRoZXIgYW5kIGFsbG93IHdpdGhkcmF3YWxzLg0KY29udHJhY3QgRnVuZHNIb2xkZXJNaXhpbiBpcyBSZWVudHJ5UHJvdGVjdG9yTWl4aW4sIENhcmVmdWxTZW5kZXJNaXhpbiB7DQoNCiAgICAvLyBSZWNvcmQgaGVyZSBob3cgbXVjaCB3ZWkgaXMgb3duZWQgYnkgYW4gYWRkcmVzcy4NCiAgICAvLyBPYnZpb3VzbHksIHRoZSBlbnRyaWVzIGhlcmUgTVVTVCBiZSBiYWNrZWQgYnkgYWN0dWFsIGV0aGVyDQogICAgLy8gb3duZWQgYnkgdGhlIGNvbnRyYWN0IC0gd2UgY2Fubm90IGVuZm9yY2UgdGhhdCBpbiB0aGlzIG1peGluLg0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgZnVuZHM7DQoNCiAgICBldmVudCBGdW5kc1dpdGhkcmF3bkV2ZW50KA0KICAgICAgICBhZGRyZXNzIGZyb21BZGRyZXNzLA0KICAgICAgICBhZGRyZXNzIHRvQWRkcmVzcywNCiAgICAgICAgdWludCB2YWx1ZVdlaQ0KICAgICk7DQoNCiAgICAvLy8gQG5vdGljZSBBbW91bnQgb2YgZXRoZXIgaGVsZCBmb3IgYF9hZGRyZXNzYC4NCiAgICBmdW5jdGlvbiBmdW5kc09mKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdmFsdWVXZWkpIHsNCiAgICAgICAgcmV0dXJuIGZ1bmRzW19hZGRyZXNzXTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBTZW5kIHRoZSBjYWxsZXIgKGBtc2cuc2VuZGVyYCkgYWxsIGV0aGVyIHRoZXkgb3duLg0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnVuZHMoKSB7DQogICAgICAgIGV4dGVybmFsRW50ZXIoKTsNCiAgICAgICAgd2l0aGRyYXdGdW5kc1JQKCk7DQogICAgICAgIGV4dGVybmFsTGVhdmUoKTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfdmFsdWVXZWlgIG9mIHRoZSBldGhlciBvd25lZCBieSB0aGUgY2FsbGVyDQogICAgLy8vIChgbXNnLnNlbmRlcmApIHRvIGBfdG9BZGRyZXNzYCwgaW5jbHVkaW5nIGBfZXh0cmFHYXNgIGdhcw0KICAgIC8vLyBiZXlvbmQgdGhlIG5vcm1hbCBzdGlwZW5kLg0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnVuZHNBZHZhbmNlZCgNCiAgICAgICAgYWRkcmVzcyBfdG9BZGRyZXNzLA0KICAgICAgICB1aW50IF92YWx1ZVdlaSwNCiAgICAgICAgdWludCBfZXh0cmFHYXMNCiAgICApIHsNCiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOw0KICAgICAgICB3aXRoZHJhd0Z1bmRzQWR2YW5jZWRSUChfdG9BZGRyZXNzLCBfdmFsdWVXZWksIF9leHRyYUdhcyk7DQogICAgICAgIGV4dGVybmFsTGVhdmUoKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBpbnRlcm5hbCB2ZXJzaW9uIG9mIHdpdGhkcmF3RnVuZHMoKQ0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnVuZHNSUCgpIGludGVybmFsIHsNCiAgICAgICAgYWRkcmVzcyBmcm9tQWRkcmVzcyA9IG1zZy5zZW5kZXI7DQogICAgICAgIGFkZHJlc3MgdG9BZGRyZXNzID0gZnJvbUFkZHJlc3M7DQogICAgICAgIHVpbnQgYWxsQXZhaWxhYmxlV2VpID0gZnVuZHNbZnJvbUFkZHJlc3NdOw0KICAgICAgICB3aXRoZHJhd0Z1bmRzQWR2YW5jZWRSUCgNCiAgICAgICAgICAgIHRvQWRkcmVzcywNCiAgICAgICAgICAgIGFsbEF2YWlsYWJsZVdlaSwNCiAgICAgICAgICAgIHN1Z2dlc3RlZEV4dHJhR2FzVG9JbmNsdWRlV2l0aFNlbmRzDQogICAgICAgICk7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgaW50ZXJuYWwgdmVyc2lvbiBvZiB3aXRoZHJhd0Z1bmRzQWR2YW5jZWQoKSwgYWxzbyB1c2VkDQogICAgLy8vIGJ5IHdpdGhkcmF3RnVuZHNSUCgpLg0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnVuZHNBZHZhbmNlZFJQKA0KICAgICAgICBhZGRyZXNzIF90b0FkZHJlc3MsDQogICAgICAgIHVpbnQgX3ZhbHVlV2VpLA0KICAgICAgICB1aW50IF9leHRyYUdhc0luY2x1ZGVkDQogICAgKSBpbnRlcm5hbCB7DQogICAgICAgIGlmIChtc2cudmFsdWUgIT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgYWRkcmVzcyBmcm9tQWRkcmVzcyA9IG1zZy5zZW5kZXI7DQogICAgICAgIGlmIChfdmFsdWVXZWkgPiBmdW5kc1tmcm9tQWRkcmVzc10pIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIGZ1bmRzW2Zyb21BZGRyZXNzXSAtPSBfdmFsdWVXZWk7DQogICAgICAgIGJvb2wgc2VudE9rID0gY2FyZWZ1bFNlbmRXaXRoRml4ZWRHYXMoDQogICAgICAgICAgICBfdG9BZGRyZXNzLA0KICAgICAgICAgICAgX3ZhbHVlV2VpLA0KICAgICAgICAgICAgX2V4dHJhR2FzSW5jbHVkZWQNCiAgICAgICAgKTsNCiAgICAgICAgaWYgKCFzZW50T2spIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIEZ1bmRzV2l0aGRyYXduRXZlbnQoZnJvbUFkZHJlc3MsIF90b0FkZHJlc3MsIF92YWx1ZVdlaSk7DQogICAgfQ0KDQp9DQoNCg0KLy8vIEB0aXRsZSBNaXhpbiB0byBoZWxwIG1ha2UgbmljZXIgbG9va2luZyBldGhlciBhbW91bnRzLg0KY29udHJhY3QgTW9uZXlSb3VuZGVyTWl4aW4gew0KDQogICAgLy8vIEBub3RpY2UgTWFrZSBgX3Jhd1ZhbHVlV2VpYCBpbnRvIGEgbmljZXIsIHJvdW5kZXIgbnVtYmVyLg0KICAgIC8vLyBAcmV0dXJuIEEgdmFsdWUgdGhhdDoNCiAgICAvLy8gICAtIGlzIG5vIGxhcmdlciB0aGFuIGBfcmF3VmFsdWVXZWlgDQogICAgLy8vICAgLSBpcyBubyBzbWFsbGVyIHRoYW4gYF9yYXdWYWx1ZVdlaWAgKiAwLjk5OQ0KICAgIC8vLyAgIC0gaGFzIG5vIG1vcmUgdGhhbiB0aHJlZSBzaWduaWZpY2FudCBmaWd1cmVzIFVOTEVTUyB0aGUNCiAgICAvLy8gICAgIG51bWJlciBpcyB2ZXJ5IHNtYWxsIG9yIHZlcnkgbGFyZ2UgaW4gbW9uZXRhcnkgdGVybXMNCiAgICAvLy8gICAgICh3aGljaCB3ZSBkZWZpbmUgYXMgPCAxIGZpbm5leSBvciA+IDEwMDAwIGV0aGVyKSwgaW4NCiAgICAvLy8gICAgIHdoaWNoIGNhc2Ugbm8gcHJlY2lzaW9uIHdpbGwgYmUgbG9zdC4NCiAgICBmdW5jdGlvbiByb3VuZE1vbmV5RG93bk5pY2VseSh1aW50IF9yYXdWYWx1ZVdlaSkgY29uc3RhbnQgaW50ZXJuYWwNCiAgICByZXR1cm5zICh1aW50IG5pY2VyVmFsdWVXZWkpIHsNCiAgICAgICAgaWYgKF9yYXdWYWx1ZVdlaSA8IDEgZmlubmV5KSB7DQogICAgICAgICAgICByZXR1cm4gX3Jhd1ZhbHVlV2VpOw0KICAgICAgICB9IGVsc2UgaWYgKF9yYXdWYWx1ZVdlaSA8IDEwIGZpbm5leSkgew0KICAgICAgICAgICAgcmV0dXJuIDEwIHN6YWJvICogKF9yYXdWYWx1ZVdlaSAvIDEwIHN6YWJvKTsNCiAgICAgICAgfSBlbHNlIGlmIChfcmF3VmFsdWVXZWkgPCAxMDAgZmlubmV5KSB7DQogICAgICAgICAgICByZXR1cm4gMTAwIHN6YWJvICogKF9yYXdWYWx1ZVdlaSAvIDEwMCBzemFibyk7DQogICAgICAgIH0gZWxzZSBpZiAoX3Jhd1ZhbHVlV2VpIDwgMSBldGhlcikgew0KICAgICAgICAgICAgcmV0dXJuIDEgZmlubmV5ICogKF9yYXdWYWx1ZVdlaSAvIDEgZmlubmV5KTsNCiAgICAgICAgfSBlbHNlIGlmIChfcmF3VmFsdWVXZWkgPCAxMCBldGhlcikgew0KICAgICAgICAgICAgcmV0dXJuIDEwIGZpbm5leSAqIChfcmF3VmFsdWVXZWkgLyAxMCBmaW5uZXkpOw0KICAgICAgICB9IGVsc2UgaWYgKF9yYXdWYWx1ZVdlaSA8IDEwMCBldGhlcikgew0KICAgICAgICAgICAgcmV0dXJuIDEwMCBmaW5uZXkgKiAoX3Jhd1ZhbHVlV2VpIC8gMTAwIGZpbm5leSk7DQogICAgICAgIH0gZWxzZSBpZiAoX3Jhd1ZhbHVlV2VpIDwgMTAwMCBldGhlcikgew0KICAgICAgICAgICAgcmV0dXJuIDEgZXRoZXIgKiAoX3Jhd1ZhbHVlV2VpIC8gMSBldGhlcik7DQogICAgICAgIH0gZWxzZSBpZiAoX3Jhd1ZhbHVlV2VpIDwgMTAwMDAgZXRoZXIpIHsNCiAgICAgICAgICAgIHJldHVybiAxMCBldGhlciAqIChfcmF3VmFsdWVXZWkgLyAxMCBldGhlcik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gX3Jhd1ZhbHVlV2VpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIC8vLyBAbm90aWNlIENvbnZlcnQgYF92YWx1ZVdlaWAgaW50byBhIHdob2xlIG51bWJlciBvZiBmaW5uZXkuDQogICAgLy8vIEByZXR1cm4gVGhlIHNtYWxsZXN0IHdob2xlIG51bWJlciBvZiBmaW5uZXkgd2hpY2ggaXMgZXF1YWwNCiAgICAvLy8gdG8gb3IgZ3JlYXRlciB0aGFuIGBfdmFsdWVXZWlgIHdoZW4gY29udmVydGVkIHRvIHdlaS4NCiAgICAvLy8gV0FSTjogTWF5IGJlIGluY29ycmVjdCBpZiBgX3ZhbHVlV2VpYCBpcyBhYm92ZSAyKioyNTQuDQogICAgZnVuY3Rpb24gcm91bmRNb25leVVwVG9XaG9sZUZpbm5leSh1aW50IF92YWx1ZVdlaSkgY29uc3RhbnQgaW50ZXJuYWwNCiAgICByZXR1cm5zICh1aW50IHZhbHVlRmlubmV5KSB7DQogICAgICAgIHJldHVybiAoMSBmaW5uZXkgKyBfdmFsdWVXZWkgLSAxIHdlaSkgLyAxIGZpbm5leTsNCiAgICB9DQoNCn0NCg0KDQovLy8gQHRpdGxlIE1peGluIHRvIGhlbHAgYWxsb3cgdXNlcnMgdG8gbmFtZSB0aGluZ3MuDQpjb250cmFjdCBOYW1lYWJsZU1peGluIHsNCg0KICAgIC8vIFN0cmluZyBtYW5pcHVsYXRpb24gaXMgZXhwZW5zaXZlIGluIHRoZSBFVk07IGtlZXAgdGhpbmdzIHNob3J0Lg0KDQogICAgdWludCBjb25zdGFudCBtaW5pbXVtTmFtZUxlbmd0aCA9IDE7DQogICAgdWludCBjb25zdGFudCBtYXhpbXVtTmFtZUxlbmd0aCA9IDI1Ow0KICAgIHN0cmluZyBjb25zdGFudCBuYW1lRGF0YVByZWZpeCA9ICJOQU1FOiI7DQoNCiAgICAvLy8gQG5vdGljZSBDaGVjayBpZiBgX25hbWVgIGlzIGEgcmVhc29uYWJsZSBjaG9pY2Ugb2YgbmFtZS4NCiAgICAvLy8gQHJldHVybiBUcnVlIGlmLWFuZC1vbmx5LWlmIGBfbmFtZV9gIG1lZXRzIHRoZSBjcml0ZXJpYQ0KICAgIC8vLyBiZWxvdywgb3IgZmFsc2Ugb3RoZXJ3aXNlOg0KICAgIC8vLyAgIC0gbm8gZmV3ZXIgdGhhbiAxIGNoYXJhY3Rlcg0KICAgIC8vLyAgIC0gbm8gbW9yZSB0aGFuIDI1IGNoYXJhY3RlcnMNCiAgICAvLy8gICAtIG5vIGNoYXJhY3RlcnMgb3RoZXIgdGhhbjoNCiAgICAvLy8gICAgIC0gInJvbWFuIiBhbHBoYWJldCBsZXR0ZXJzIChBLVogYW5kIGEteikNCiAgICAvLy8gICAgIC0gd2VzdGVybiBkaWdpdHMgKDAtOSkNCiAgICAvLy8gICAgIC0gInNhZmUiIHB1bmN0dWF0aW9uOiAhICggKSAtIC4gXyBTUEFDRQ0KICAgIC8vLyAgIC0gYXQgbGVhc3Qgb25lIG5vbi1wdW5jdHVhdGlvbiBjaGFyYWN0ZXINCiAgICAvLy8gTm90ZSB0aGF0IHdlIGRlbGliZXJhdGVseSBleGNsdWRlIGNoYXJhY3RlcnMgd2hpY2ggbWF5IGNhdXNlDQogICAgLy8vIHNlY3VyaXR5IHByb2JsZW1zIGZvciB3ZWJzaXRlcyBhbmQgZGF0YWJhc2VzIGlmIGVzY2FwaW5nIGlzDQogICAgLy8vIG5vdCBwZXJmb3JtZWQgY29ycmVjdGx5LCBzdWNoIGFzIDwgPiAiIGFuZCAnLg0KICAgIC8vLyBBcG9sb2dpZXMgZm9yIHRoZSBsYWNrIG9mIG5vbi1FbmdsaXNoIGxhbmd1YWdlIHN1cHBvcnQuDQogICAgZnVuY3Rpb24gdmFsaWRhdGVOYW1lSW50ZXJuYWwoc3RyaW5nIF9uYW1lKSBjb25zdGFudCBpbnRlcm5hbA0KICAgIHJldHVybnMgKGJvb2wgYWxsb3dlZCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgbmFtZUJ5dGVzID0gYnl0ZXMoX25hbWUpOw0KICAgICAgICB1aW50IGxlbmd0aEJ5dGVzID0gbmFtZUJ5dGVzLmxlbmd0aDsNCiAgICAgICAgaWYgKGxlbmd0aEJ5dGVzIDwgbWluaW11bU5hbWVMZW5ndGggfHwNCiAgICAgICAgICAgIGxlbmd0aEJ5dGVzID4gbWF4aW11bU5hbWVMZW5ndGgpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBib29sIGZvdW5kTm9uUHVuY3R1YXRpb24gPSBmYWxzZTsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuZ3RoQnl0ZXM7IGkrKykgew0KICAgICAgICAgICAgYnl0ZSBiID0gbmFtZUJ5dGVzW2ldOw0KICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgIChiID49IDQ4ICYmIGIgPD0gNTcpIHx8IC8vIDAgLSA5DQogICAgICAgICAgICAgICAgKGIgPj0gNjUgJiYgYiA8PSA5MCkgfHwgLy8gQSAtIFoNCiAgICAgICAgICAgICAgICAoYiA+PSA5NyAmJiBiIDw9IDEyMikgICAvLyBhIC0geg0KICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgZm91bmROb25QdW5jdHVhdGlvbiA9IHRydWU7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgYiA9PSAzMiB8fCAvLyBzcGFjZQ0KICAgICAgICAgICAgICAgIGIgPT0gMzMgfHwgLy8gIQ0KICAgICAgICAgICAgICAgIGIgPT0gNDAgfHwgLy8gKA0KICAgICAgICAgICAgICAgIGIgPT0gNDEgfHwgLy8gKQ0KICAgICAgICAgICAgICAgIGIgPT0gNDUgfHwgLy8gLQ0KICAgICAgICAgICAgICAgIGIgPT0gNDYgfHwgLy8gLg0KICAgICAgICAgICAgICAgIGIgPT0gOTUgICAgLy8gXw0KICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZvdW5kTm9uUHVuY3R1YXRpb247DQogICAgfQ0KDQogICAgLy8gRXh0cmFjdCBhIG5hbWUgZnJvbSBieXRlcyBgX2RhdGFgIChwcmVzdW1hYmx5IGZyb20gYG1zZy5kYXRhYCksDQogICAgLy8gb3IgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBkYXRhIGlzIG5vdCBpbiB0aGUgZXhwZWN0ZWQgZm9ybWF0Lg0KICAgIC8vIA0KICAgIC8vIFdlIHdhbnQgdG8gbWFrZSBpdCBlYXN5IGZvciBwZW9wbGUgdG8gbmFtZSB0aGluZ3MsIGV2ZW4gaWYNCiAgICAvLyB0aGV5J3JlIG5vdCBjb21mb3J0YWJsZSBjYWxsaW5nIGZ1bmN0aW9ucyBvbiBjb250cmFjdHMuDQogICAgLy8NCiAgICAvLyBTbyB3ZSBhbGxvdyBuYW1lcyB0byBiZSBzZW50IHRvIHRoZSBmYWxsYmFjayBmdW5jdGlvbiBlbmNvZGVkDQogICAgLy8gYXMgbWVzc2FnZSBkYXRhLg0KICAgIC8vDQogICAgLy8gVW5mb3J0dW5hdGVseSwgdGhlIHdheSB0aGUgRXRoZXJldW0gRnVuY3Rpb24gQUJJIHdvcmtzIG1lYW5zIHdlDQogICAgLy8gbXVzdCBiZSBjYXJlZnVsIHRvIGF2b2lkIGNsYXNoZXMgYmV0d2VlbiBtZXNzYWdlIGRhdGEgdGhhdA0KICAgIC8vIHJlcHJlc2VudHMgb3VyIG5hbWVzIGFuZCBtZXNzYWdlIGRhdGEgdGhhdCByZXByZXNlbnRzIGEgY2FsbA0KICAgIC8vIHRvIGFuIGV4dGVybmFsIGZ1bmN0aW9uIC0gb3RoZXJ3aXNlOg0KICAgIC8vICAgYSkgc29tZSBuYW1lcyB3b24ndCBiZSB1c2FibGU7DQogICAgLy8gICBiKSBzbWFsbCBwb3NzaWJpbGl0eSBvZiBhIHBoaXNoaW5nIGF0dGFjayB3aGVyZSB1c2VycyBhcmUNCiAgICAvLyAgICAgdHJpY2tlZCBpbnRvIHVzaW5nIGNlcnRhaW4gbmFtZXMgd2hpY2ggY2F1c2UgYW4gZXh0ZXJuYWwNCiAgICAvLyAgICAgZnVuY3Rpb24gY2FsbCAtIGUuZy4gaWYgdGhlIGRhdGEgc2VudCB0byB0aGUgY29udHJhY3QgaXMNCiAgICAvLyAgICAga2VjY2FrMjU2KCJ3aXRoZHJhd0Z1bmRzKCkiKSB0aGVuIGEgd2l0aGRyYXdhbCB3aWxsIG9jY3VyLg0KICAgIC8vDQogICAgLy8gU28gd2UgcmVxdWlyZSBhIHByZWZpeCAiTkFNRToiIGF0IHRoZSBzdGFydCBvZiB0aGUgbmFtZSAoZW5jb2RlZA0KICAgIC8vIGluIEFTQ0lJKSB3aGVuIHNlbnQgdmlhIHRoZSBmYWxsYmFjayBmdW5jdGlvbiAtIHRoaXMgcHJlZml4DQogICAgLy8gZG9lc24ndCBjbGFzaCB3aXRoIGFueSBleHRlcm5hbCBmdW5jdGlvbiBzaWduYXR1cmUgaGFzaGVzLg0KICAgIC8vDQogICAgLy8gZS5nLiB3ZWIzLmZyb21Bc2NpaSgnTkFNRTonICsgJ0pvZSBCbG9nZ3MnKQ0KICAgIC8vDQogICAgLy8gV0FSTjogdGhpcyBkb2VzIG5vdCBjaGVjayB0aGUgbmFtZSBmb3IgInJlYXNvbmFibGVuZXNzIjsNCiAgICAvLyB1c2UgdmFsaWRhdGVOYW1lSW50ZXJuYWwoKSBmb3IgdGhhdC4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIGV4dHJhY3ROYW1lRnJvbURhdGEoYnl0ZXMgX2RhdGEpIGNvbnN0YW50IGludGVybmFsDQogICAgcmV0dXJucyAoc3RyaW5nIGV4dHJhY3RlZE5hbWUpIHsNCiAgICAgICAgLy8gY2hlY2sgcHJlZml4IHByZXNlbnQNCiAgICAgICAgdWludCBleHBlY3RlZFByZWZpeExlbmd0aCA9IChieXRlcyhuYW1lRGF0YVByZWZpeCkpLmxlbmd0aDsNCiAgICAgICAgaWYgKF9kYXRhLmxlbmd0aCA8IGV4cGVjdGVkUHJlZml4TGVuZ3RoKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICB1aW50IGk7DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBleHBlY3RlZFByZWZpeExlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoKGJ5dGVzKG5hbWVEYXRhUHJlZml4KSlbaV0gIT0gX2RhdGFbaV0pIHsNCiAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBjb3B5IGRhdGEgYWZ0ZXIgcHJlZml4DQogICAgICAgIHVpbnQgcGF5bG9hZExlbmd0aCA9IF9kYXRhLmxlbmd0aCAtIGV4cGVjdGVkUHJlZml4TGVuZ3RoOw0KICAgICAgICBpZiAocGF5bG9hZExlbmd0aCA8IG1pbmltdW1OYW1lTGVuZ3RoIHx8DQogICAgICAgICAgICBwYXlsb2FkTGVuZ3RoID4gbWF4aW11bU5hbWVMZW5ndGgpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIHN0cmluZyBtZW1vcnkgbmFtZSA9IG5ldyBzdHJpbmcocGF5bG9hZExlbmd0aCk7DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXlsb2FkTGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIChieXRlcyhuYW1lKSlbaV0gPSBfZGF0YVtleHBlY3RlZFByZWZpeExlbmd0aCArIGldOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuYW1lOw0KICAgIH0NCg0KICAgIC8vIFR1cm4gYSBzaG9ydCBuYW1lIGludG8gYSAiZnV6enkgaGFzaCIgd2l0aCB0aGUgcHJvcGVydHkNCiAgICAvLyB0aGF0IGV4dHJlbWVseSBzaW1pbGFyIG5hbWVzIHdpbGwgaGF2ZSB0aGUgc2FtZSBmdXp6eSBoYXNoLg0KICAgIC8vDQogICAgLy8gVGhpcyBpcyB1c2VmdWwgdG86DQogICAgLy8gIC0gc3RvcCBwZW9wbGUgY2hvb3NpbmcgbmFtZXMgd2hpY2ggZGlmZmVyIG9ubHkgaW4gY2FzZSBvcg0KICAgIC8vICAgIHB1bmN0dWF0aW9uIGFuZCB3b3VsZCBsZWFkIHRvIGNvbmZ1c2lvbi4NCiAgICAvLyAgLSBmYWNpbGlhdGUgc2VhcmNoaW5nIGJ5IG5hbWUgd2l0aG91dCBuZWVkaW5nIGV4YWN0IG1hdGNoDQogICAgLy8NCiAgICAvLyBGb3IgZXhhbXBsZSwgdGhlc2UgbmFtZXMgYWxsIGhhdmUgdGhlIHNhbWUgZnV6enkgaGFzaDoNCiAgICAvLw0KICAgIC8vICAiQmFuYW5hIg0KICAgIC8vICAiQkFOQU5BIg0KICAgIC8vICAiQmEtbmEtbmEiDQogICAgLy8gICIgIGJhbmFuYSAgIg0KICAgIC8vICAiQmFuYW5hICAgICAgICAgICAgICAgICAgICAgICAgLi4gc28gbG9uZyB0aGUgZW5kIGlzIGlnbm9yZWQiDQogICAgLy8NCiAgICAvLyBPbiB0aGUgb3RoZXIgaGFuZCwgIkJhbmFuYTEiIGFuZCAiQSBCYW5hbmEiIGFyZSBkaWZmZXJlbnQgdG8NCiAgICAvLyB0aGUgYWJvdmUuDQogICAgLy8NCiAgICAvLyBXQVJOOiB0aGlzIGlzIGxpa2VseSB0byB3b3JrIHBvb3JseSBvbiBuYW1lcyB0aGF0IGRvIG5vdCBtZWV0DQogICAgLy8gdGhlIHZhbGlkYXRlTmFtZUludGVybmFsKCkgdGVzdC4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNvbXB1dGVOYW1lRnV6enlIYXNoKHN0cmluZyBfbmFtZSkgY29uc3RhbnQgaW50ZXJuYWwNCiAgICByZXR1cm5zICh1aW50IGZ1enp5SGFzaCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgbmFtZUJ5dGVzID0gYnl0ZXMoX25hbWUpOw0KICAgICAgICB1aW50IGggPSAwOw0KICAgICAgICB1aW50IGxlbiA9IG5hbWVCeXRlcy5sZW5ndGg7DQogICAgICAgIGlmIChsZW4gPiBtYXhpbXVtTmFtZUxlbmd0aCkgew0KICAgICAgICAgICAgbGVuID0gbWF4aW11bU5hbWVMZW5ndGg7DQogICAgICAgIH0NCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgICAgIHVpbnQgbXVsID0gMTI4Ow0KICAgICAgICAgICAgYnl0ZSBiID0gbmFtZUJ5dGVzW2ldOw0KICAgICAgICAgICAgdWludCB1YiA9IHVpbnQoYik7DQogICAgICAgICAgICBpZiAoYiA+PSA0OCAmJiBiIDw9IDU3KSB7DQogICAgICAgICAgICAgICAgLy8gMC05DQogICAgICAgICAgICAgICAgaCA9IGggKiBtdWwgKyB1YjsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoYiA+PSA2NSAmJiBiIDw9IDkwKSB7DQogICAgICAgICAgICAgICAgLy8gQS1aDQogICAgICAgICAgICAgICAgaCA9IGggKiBtdWwgKyB1YjsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoYiA+PSA5NyAmJiBiIDw9IDEyMikgew0KICAgICAgICAgICAgICAgIC8vIGZvbGQgYS16IHRvIEEtWg0KICAgICAgICAgICAgICAgIHVpbnQgdXBwZXIgPSB1YiAtIDMyOw0KICAgICAgICAgICAgICAgIGggPSBoICogbXVsICsgdXBwZXI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBvdGhlcnMNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaDsNCiAgICB9DQoNCn0NCg0KDQovLy8gQHRpdGxlIE1peGluIHRvIGhlbHAgZGVmaW5lIHRoZSBydWxlcyBvZiBhIHRocm9uZS4NCmNvbnRyYWN0IFRocm9uZVJ1bGVzTWl4aW4gew0KDQogICAgLy8gU2VlIFdvcmxkLmNyZWF0ZUtpbmdkb20oLi4pIGZvciBkb2N1bWVudGF0aW9uLg0KICAgIHN0cnVjdCBUaHJvbmVSdWxlcyB7DQogICAgICAgIHVpbnQgc3RhcnRpbmdDbGFpbVByaWNlV2VpOw0KICAgICAgICB1aW50IG1heGltdW1DbGFpbVByaWNlV2VpOw0KICAgICAgICB1aW50IGNsYWltUHJpY2VBZGp1c3RQZXJjZW50Ow0KICAgICAgICB1aW50IGN1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kczsNCiAgICAgICAgdWludCBjb21taXNzaW9uUGVyVGhvdXNhbmQ7DQogICAgfQ0KDQp9DQoNCg0KLy8vIEB0aXRsZSBNYWludGFpbnMgdGhlIHRocm9uZSBvZiBhIGtpbmdkb20uDQpjb250cmFjdCBLaW5nZG9tIGlzDQogIFJlZW50cnlQcm90ZWN0b3JNaXhpbiwNCiAgQ2FyZWZ1bFNlbmRlck1peGluLA0KICBGdW5kc0hvbGRlck1peGluLA0KICBNb25leVJvdW5kZXJNaXhpbiwNCiAgTmFtZWFibGVNaXhpbiwNCiAgVGhyb25lUnVsZXNNaXhpbiB7DQoNCiAgICAvLyBlLmcuICJLaW5nIG9mIHRoZSBFdGhlciINCiAgICBzdHJpbmcgcHVibGljIGtpbmdkb21OYW1lOw0KDQogICAgLy8gVGhlIFdvcmxkIGNvbnRyYWN0IHVzZWQgdG8gY3JlYXRlIHRoaXMga2luZ2RvbSwgb3IgMHgwIGlmIG5vbmUuDQogICAgYWRkcmVzcyBwdWJsaWMgd29ybGQ7DQoNCiAgICAvLyBUaGUgcnVsZXMgdGhhdCBnb3Zlcm4gdGhpcyBraW5nZG9tIC0gc2VlIFRocm9uZVJ1bGVzTWl4aW4uDQogICAgVGhyb25lUnVsZXMgcHVibGljIHJ1bGVzOw0KDQogICAgLy8gU29tZW9uZSB3aG8gaGFzIHJ1bGVkIChvciBpcyBydWxpbmcpIG91ciBraW5nZG9tLg0KICAgIHN0cnVjdCBNb25hcmNoIHsNCiAgICAgICAgLy8gd2hlcmUgdG8gc2VuZCB0aGVpciBjb21wZW5zYXRpb24NCiAgICAgICAgYWRkcmVzcyBjb21wZW5zYXRpb25BZGRyZXNzOw0KICAgICAgICAvLyB0aGVpciBuYW1lDQogICAgICAgIHN0cmluZyBuYW1lOw0KICAgICAgICAvLyB3aGVuIHRoZXkgYmVjYW1lIG91ciBydWxlcg0KICAgICAgICB1aW50IGNvcm9uYXRpb25UaW1lc3RhbXA7DQogICAgICAgIC8vIHRoZSBjbGFpbSBwcmljZSBwYWlkIChleGNsdWRpbmcgYW55IG92ZXItcGF5bWVudCkNCiAgICAgICAgdWludCBjbGFpbVByaWNlV2VpOw0KICAgICAgICAvLyB0aGUgY29tcGVuc2F0aW9uIHNlbnQgdG8gb3IgaGVsZCBmb3IgdGhlbSBzbyBmYXINCiAgICAgICAgdWludCBjb21wZW5zYXRpb25XZWk7DQogICAgfQ0KDQogICAgLy8gVGhlIGZpcnN0IHJ1bGVyIGlzIG51bWJlciAxOyB0aGUgemVyby10aCBlbnRyeSBpcyBhIGR1bW15IGVudHJ5Lg0KICAgIE1vbmFyY2hbXSBwdWJsaWMgbW9uYXJjaHNCeU51bWJlcjsNCg0KICAgIC8vIFRoZSB0b3BXaXphcmQgZWFybnMgaGFsZiB0aGUgY29tbWlzc2lvbi4NCiAgICAvLyBUaGV5IGFyZSBub3JtYWxseSB0aGUgb3duZXIgb2YgdGhlIFdvcmxkIGNvbnRyYWN0Lg0KICAgIGFkZHJlc3MgcHVibGljIHRvcFdpemFyZDsNCg0KICAgIC8vIFRoZSBzdWJXaXphcmQgZWFybnMgaGFsZiB0aGUgY29tbWlzc2lvbi4NCiAgICAvLyBUaGV5IGFyZSBub3JtYWxseSB0aGUgY3JlYXRvciBvZiB0aGlzIEtpbmdkb20uDQogICAgLy8gVGhlIHRvcFdpemFyZCBhbmQgc3ViV2l6YXJkIGNhbiBiZSB0aGUgc2FtZSBhZGRyZXNzLg0KICAgIGFkZHJlc3MgcHVibGljIHN1YldpemFyZDsNCg0KICAgIC8vIE5COiB3ZSBhbHNvIGhhdmUgYSBgZnVuZHNgIG1hcHBpbmcgZnJvbSBGdW5kc0hvbGRlck1peGluLA0KICAgIC8vIGFuZCBhIHJlbnRyeVByb3RlY3RvciBmcm9tIFJlZW50cnlQcm90ZWN0b3JNaXhpbi4NCg0KICAgIGV2ZW50IFRocm9uZUNsYWltZWRFdmVudCh1aW50IG1vbmFyY2hOdW1iZXIpOw0KICAgIGV2ZW50IENvbXBlbnNhdGlvblNlbnRFdmVudChhZGRyZXNzIHRvQWRkcmVzcywgdWludCB2YWx1ZVdlaSk7DQogICAgZXZlbnQgQ29tcGVuc2F0aW9uRmFpbEV2ZW50KGFkZHJlc3MgdG9BZGRyZXNzLCB1aW50IHZhbHVlV2VpKTsNCiAgICBldmVudCBDb21taXNzaW9uRWFybmVkRXZlbnQoYWRkcmVzcyBieUFkZHJlc3MsIHVpbnQgdmFsdWVXZWkpOw0KICAgIGV2ZW50IFdpemFyZFJlcGxhY2VkRXZlbnQoYWRkcmVzcyBvbGRXaXphcmQsIGFkZHJlc3MgbmV3V2l6YXJkKTsNCiAgICAvLyBOQjogd2UgYWxzbyBoYXZlIGEgYEZ1bmRzV2l0aGRyYXduRXZlbnRgIGZyb20gRnVuZHNIb2xkZXJNaXhpbg0KDQogICAgLy8gV0FSTiAtIGRvZXMgTk9UIHZhbGlkYXRlIGFyZ3VtZW50czsgeW91IE1VU1QgZWl0aGVyIGNhbGwNCiAgICAvLyBLaW5nZG9tRmFjdG9yeS52YWxpZGF0ZVByb3Bvc2VkVGhyb25lUnVsZXMoKSBvciBjcmVhdGUNCiAgICAvLyB0aGUgS2luZ2RvbSB2aWEgS2luZ2RvbUZhY3RvcnkvV29ybGQncyBjcmVhdGVLaW5nZG9tKCkuDQogICAgLy8gU2VlIFdvcmxkLmNyZWF0ZUtpbmdkb20oLi4pIGZvciBwYXJhbWV0ZXIgZG9jdW1lbnRhdGlvbi4NCiAgICBmdW5jdGlvbiBLaW5nZG9tKA0KICAgICAgICBzdHJpbmcgX2tpbmdkb21OYW1lLA0KICAgICAgICBhZGRyZXNzIF93b3JsZCwNCiAgICAgICAgYWRkcmVzcyBfdG9wV2l6YXJkLA0KICAgICAgICBhZGRyZXNzIF9zdWJXaXphcmQsDQogICAgICAgIHVpbnQgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwNCiAgICAgICAgdWludCBfbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgIHVpbnQgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICB1aW50IF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsDQogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICkgew0KICAgICAgICBraW5nZG9tTmFtZSA9IF9raW5nZG9tTmFtZTsNCiAgICAgICAgd29ybGQgPSBfd29ybGQ7DQogICAgICAgIHRvcFdpemFyZCA9IF90b3BXaXphcmQ7DQogICAgICAgIHN1YldpemFyZCA9IF9zdWJXaXphcmQ7DQogICAgICAgIHJ1bGVzID0gVGhyb25lUnVsZXMoDQogICAgICAgICAgICBfc3RhcnRpbmdDbGFpbVByaWNlV2VpLA0KICAgICAgICAgICAgX21heGltdW1DbGFpbVByaWNlV2VpLA0KICAgICAgICAgICAgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICAgICAgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcywNCiAgICAgICAgICAgIF9jb21taXNzaW9uUGVyVGhvdXNhbmQNCiAgICAgICAgKTsNCiAgICAgICAgLy8gV2UgbnVtYmVyIHRoZSBtb25hcmNocyBzdGFydGluZyBmcm9tIDE7IGl0J3Mgc29tZXRpbWVzIHVzZWZ1bA0KICAgICAgICAvLyB0byB1c2UgemVybyA9IGludmFsaWQsIHNvIHB1dCBpbiBhIGR1bW15IGVudHJ5IGZvciBudW1iZXIgMC4NCiAgICAgICAgbW9uYXJjaHNCeU51bWJlci5wdXNoKA0KICAgICAgICAgICAgTW9uYXJjaCgNCiAgICAgICAgICAgICAgICAwLA0KICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgIDAsDQogICAgICAgICAgICAgICAgMCwNCiAgICAgICAgICAgICAgICAwDQogICAgICAgICAgICApDQogICAgICAgICk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbnVtYmVyT2ZNb25hcmNocygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG90YWxDb3VudCkgew0KICAgICAgICAvLyB6ZXJvLXRoIGVudHJ5IGlzIGludmFsaWQNCiAgICAgICAgcmV0dXJuIG1vbmFyY2hzQnlOdW1iZXIubGVuZ3RoIC0gMTsNCiAgICB9DQoNCiAgICAvLyBGYWxzZSBpZiBlaXRoZXIgdGhlcmUgYXJlIG5vIG1vbmFyY2hzLCBvciBpZiB0aGUgbGF0ZXN0IG1vbmFyY2gNCiAgICAvLyBoYXMgcmVpZ25lZCB0b28gbG9uZyBhbmQgYmVlbiBzdHJ1Y2sgZG93biBieSB0aGUgY3Vyc2UuDQogICAgZnVuY3Rpb24gaXNMaXZpbmdNb25hcmNoKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBhbGl2ZSkgew0KICAgICAgICBpZiAobnVtYmVyT2ZNb25hcmNocygpID09IDApIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICB1aW50IHJlaWduU3RhcnRlZFRpbWVzdGFtcCA9IGxhdGVzdE1vbmFyY2hJbnRlcm5hbCgpLmNvcm9uYXRpb25UaW1lc3RhbXA7DQogICAgICAgIGlmIChub3cgPCByZWlnblN0YXJ0ZWRUaW1lc3RhbXApIHsNCiAgICAgICAgICAgIC8vIFNob3VsZCBub3QgYmUgcG9zc2libGUsIHRoaW5rIG1pbmVycyByZWplY3QgYmxvY2tzIHdpdGgNCiAgICAgICAgICAgIC8vIHRpbWVzdGFtcHMgdGhhdCBnbyBiYWNrd2FyZHM/IEJ1dCBzb21lIGRyaWZ0IHBvc3NpYmxlIGFuZA0KICAgICAgICAgICAgLy8gaXQgbmVlZHMgaGFuZGxpbmcgZm9yIHVuc2lnbmVkIG92ZXJmbG93IGF1ZGl0IGNoZWNrcyAuLi4NCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIHVpbnQgZWxhcHNlZFJlaWduRHVyYXRpb25TZWNvbmRzID0gbm93IC0gcmVpZ25TdGFydGVkVGltZXN0YW1wOw0KICAgICAgICBpZiAoZWxhcHNlZFJlaWduRHVyYXRpb25TZWNvbmRzID4gcnVsZXMuY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIEhvdyBtdWNoIHlvdSBtdXN0IHBheSB0byBjbGFpbSB0aGUgdGhyb25lIG5vdywgaW4gd2VpLg0KICAgIGZ1bmN0aW9uIGN1cnJlbnRDbGFpbVByaWNlV2VpKCkgY29uc3RhbnQgcmV0dXJucyAodWludCBwcmljZUluV2VpKSB7DQogICAgICAgIGlmICghaXNMaXZpbmdNb25hcmNoKCkpIHsNCiAgICAgICAgICAgIHJldHVybiBydWxlcy5zdGFydGluZ0NsYWltUHJpY2VXZWk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB1aW50IGxhc3RDbGFpbVByaWNlV2VpID0gbGF0ZXN0TW9uYXJjaEludGVybmFsKCkuY2xhaW1QcmljZVdlaTsNCiAgICAgICAgICAgIC8vIG5vIGRhbmdlciBvZiBvdmVyZmxvdyBiZWNhdXNlIGNsYWltIHByaWNlIG5ldmVyIGdldHMgdGhhdCBoaWdoDQogICAgICAgICAgICB1aW50IG5ld0NsYWltUHJpY2UgPQ0KICAgICAgICAgICAgICAobGFzdENsYWltUHJpY2VXZWkgKiAoMTAwICsgcnVsZXMuY2xhaW1QcmljZUFkanVzdFBlcmNlbnQpKSAvIDEwMDsNCiAgICAgICAgICAgIG5ld0NsYWltUHJpY2UgPSByb3VuZE1vbmV5RG93bk5pY2VseShuZXdDbGFpbVByaWNlKTsNCiAgICAgICAgICAgIGlmIChuZXdDbGFpbVByaWNlIDwgcnVsZXMuc3RhcnRpbmdDbGFpbVByaWNlV2VpKSB7DQogICAgICAgICAgICAgICAgbmV3Q2xhaW1QcmljZSA9IHJ1bGVzLnN0YXJ0aW5nQ2xhaW1QcmljZVdlaTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChuZXdDbGFpbVByaWNlID4gcnVsZXMubWF4aW11bUNsYWltUHJpY2VXZWkpIHsNCiAgICAgICAgICAgICAgICBuZXdDbGFpbVByaWNlID0gcnVsZXMubWF4aW11bUNsYWltUHJpY2VXZWk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbmV3Q2xhaW1QcmljZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIEhvdyBtdWNoIHlvdSBtdXN0IHBheSB0byBjbGFpbSB0aGUgdGhyb25lIG5vdywgaW4gZmlubmV5Lg0KICAgIGZ1bmN0aW9uIGN1cnJlbnRDbGFpbVByaWNlSW5GaW5uZXkoKSBjb25zdGFudA0KICAgIHJldHVybnMgKHVpbnQgcHJpY2VJbkZpbm5leSkgew0KICAgICAgICB1aW50IHZhbHVlV2VpID0gY3VycmVudENsYWltUHJpY2VXZWkoKTsNCiAgICAgICAgcmV0dXJuIHJvdW5kTW9uZXlVcFRvV2hvbGVGaW5uZXkodmFsdWVXZWkpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIENoZWNrIGlmIGEgbmFtZSBjYW4gYmUgdXNlZCBhcyBhIG1vbmFyY2ggbmFtZS4NCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBuYW1lIHNhdGlzZmllcyB0aGUgY3JpdGVyaWEgb2Y6DQogICAgLy8vICAgLSBubyBmZXdlciB0aGFuIDEgY2hhcmFjdGVyDQogICAgLy8vICAgLSBubyBtb3JlIHRoYW4gMjUgY2hhcmFjdGVycw0KICAgIC8vLyAgIC0gbm8gY2hhcmFjdGVycyBvdGhlciB0aGFuOg0KICAgIC8vLyAgICAgLSAicm9tYW4iIGFscGhhYmV0IGxldHRlcnMgKEEtWiBhbmQgYS16KQ0KICAgIC8vLyAgICAgLSB3ZXN0ZXJuIGRpZ2l0cyAoMC05KQ0KICAgIC8vLyAgICAgLSAic2FmZSIgcHVuY3R1YXRpb246ICEgKCApIC0gLiBfIFNQQUNFDQogICAgZnVuY3Rpb24gdmFsaWRhdGVQcm9wb3NlZE1vbmFyY2hOYW1lKHN0cmluZyBfbW9uYXJjaE5hbWUpIGNvbnN0YW50DQogICAgcmV0dXJucyAoYm9vbCBhbGxvd2VkKSB7DQogICAgICAgIHJldHVybiB2YWxpZGF0ZU5hbWVJbnRlcm5hbChfbW9uYXJjaE5hbWUpOw0KICAgIH0NCg0KICAgIC8vIEdldCBkZXRhaWxzIG9mIHRoZSBsYXRlc3QgbW9uYXJjaCAoZXZlbiBpZiB0aGV5IGFyZSBkZWFkKS4NCiAgICAvLw0KICAgIC8vIFdlIGRvbid0IGV4cG9zZSBleHRlcm5hbGx5IGJlY2F1c2UgcmV0dXJuaW5nIHN0cnVjdHMgaXMgbm90IHdlbGwNCiAgICAvLyBzdXBwb3J0ZWQgaW4gdGhlIEFCSSAoc3RyYW5nZSB0aGF0IG1vbmFyY2hzQnlOdW1iZXIgYXJyYXkgd29ya3MNCiAgICAvLyBmaW5lIHRob3VnaCkuIE5vdGUgdGhhdCB0aGUgcmVmZXJlbmNlIHJldHVybmVkIGlzIHdyaXRhYmxlIC0gaXQNCiAgICAvLyBjYW4gYmUgdXNlZCB0byB1cGRhdGUgZGV0YWlscyBvZiB0aGUgbGF0ZXN0IG1vbmFyY2guDQogICAgLy8gV0FSTjogeW91IHNob3VsZCBjaGVjayBudW1iZXJPZk1vbmFyY2hzKCkgPiAwIGZpcnN0Lg0KICAgIGZ1bmN0aW9uIGxhdGVzdE1vbmFyY2hJbnRlcm5hbCgpIGNvbnN0YW50IGludGVybmFsDQogICAgcmV0dXJucyAoTW9uYXJjaCBzdG9yYWdlIG1vbmFyY2gpIHsNCiAgICAgICAgcmV0dXJuIG1vbmFyY2hzQnlOdW1iZXJbbW9uYXJjaHNCeU51bWJlci5sZW5ndGggLSAxXTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBDbGFpbSB0aHJvbmUgYnkgc2VuZGluZyBmdW5kcyB0byB0aGUgY29udHJhY3QuDQogICAgLy8vIEFueSBmdXR1cmUgY29tcGVuc2F0aW9uIGVhcm5lZCB3aWxsIGJlIHNlbnQgdG8gdGhlIHNlbmRlcidzDQogICAgLy8vIGFkZHJlc3MgKGBtc2cuc2VuZGVyYCkuDQogICAgLy8vIFNlbmRpbmcgZnJvbSBhIGNvbnRyYWN0IGlzIG5vdCByZWNvbW1lbmRlZCB1bmxlc3MgeW91IGtub3cNCiAgICAvLy8gd2hhdCB5b3UncmUgZG9pbmcgKGFuZCB5b3UndmUgdGVzdGVkIGl0KS4NCiAgICAvLy8gSWYgbm8gbWVzc2FnZSBkYXRhIGlzIHN1cHBsaWVkLCB0aGUgdGhyb25lIHdpbGwgYmUgY2xhaW1lZCBpbg0KICAgIC8vLyB0aGUgbmFtZSBvZiAiQW5vbnltb3VzIi4gVG8gc3VwcGx5IGEgbmFtZSwgc2VuZCBkYXRhIGVuY29kZWQNCiAgICAvLy8gdXNpbmcgd2ViMy5mcm9tQXNjaWkoJ05BTUU6JyArICd5b3VyX2Nob3Nlbl92YWxpZF9uYW1lJykuDQogICAgLy8vIFNlbmRlciBtdXN0IGluY2x1ZGUgcGF5bWVudCBlcXVhbCB0byBjdXJyZW50Q2xhaW1QcmljZVdlaSgpLg0KICAgIC8vLyBXaWxsIGNvbnN1bWUgdXAgdG8gfjMwMCwwMDAgZ2FzLg0KICAgIC8vLyBXaWxsIHRocm93IGFuIGVycm9yIGlmOg0KICAgIC8vLyAgIC0gbmFtZSBpcyBpbnZhbGlkIChzZWUgYHZhbGlkYXRlUHJvcG9zZWRNb25hcmNoTmFtZShzdHJpbmcpYCkNCiAgICAvLy8gICAtIHBheW1lbnQgaXMgdG9vIGxvdyBvciB0b28gaGlnaA0KICAgIC8vLyBQcm9kdWNlcyBldmVudHM6DQogICAgLy8vICAgLSBgVGhyb25lQ2xhaW1lZEV2ZW50YA0KICAgIC8vLyAgIC0gYENvbXBlbnNhdGlvblNlbnRFdmVudGAgLyBgQ29tcGVuc2F0aW9uRmFpbEV2ZW50YA0KICAgIC8vLyAgIC0gYENvbW1pc3Npb25FYXJuZWRFdmVudGANCiAgICBmdW5jdGlvbiAoKSB7DQogICAgICAgIGV4dGVybmFsRW50ZXIoKTsNCiAgICAgICAgZmFsbGJhY2tSUCgpOw0KICAgICAgICBleHRlcm5hbExlYXZlKCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgQ2xhaW0gdGhyb25lIGluIHRoZSBnaXZlbiBgX21vbmFyY2hOYW1lYC4NCiAgICAvLy8gQW55IGZ1dHVyZSBjb21wZW5zYXRpb24gZWFybmVkIHdpbGwgYmUgc2VudCB0byB0aGUgY2FsbGVyJ3MNCiAgICAvLy8gYWRkcmVzcyAoYG1zZy5zZW5kZXJgKS4NCiAgICAvLy8gQ2FsbGVyIG11c3QgaW5jbHVkZSBwYXltZW50IGVxdWFsIHRvIGN1cnJlbnRDbGFpbVByaWNlV2VpKCkuDQogICAgLy8vIENhbGxpbmcgZnJvbSBhIGNvbnRyYWN0IGlzIG5vdCByZWNvbW1lbmRlZCB1bmxlc3MgeW91IGtub3cNCiAgICAvLy8gd2hhdCB5b3UncmUgZG9pbmcgKGFuZCB5b3UndmUgdGVzdGVkIGl0KS4NCiAgICAvLy8gV2lsbCBjb25zdW1lIHVwIHRvIH4zMDAsMDAwIGdhcy4NCiAgICAvLy8gV2lsbCB0aHJvdyBhbiBlcnJvciBpZjoNCiAgICAvLy8gICAtIG5hbWUgaXMgaW52YWxpZCAoc2VlIGB2YWxpZGF0ZVByb3Bvc2VkTW9uYXJjaE5hbWUoc3RyaW5nKWApDQogICAgLy8vICAgLSBwYXltZW50IGlzIHRvbyBsb3cgb3IgdG9vIGhpZ2gNCiAgICAvLy8gUHJvZHVjZXMgZXZlbnRzOg0KICAgIC8vLyAgIC0gYFRocm9uZUNsYWltZWRFdmVudA0KICAgIC8vLyAgIC0gYENvbXBlbnNhdGlvblNlbnRFdmVudGAgLyBgQ29tcGVuc2F0aW9uRmFpbEV2ZW50YA0KICAgIC8vLyAgIC0gYENvbW1pc3Npb25FYXJuZWRFdmVudGANCiAgICBmdW5jdGlvbiBjbGFpbVRocm9uZShzdHJpbmcgX21vbmFyY2hOYW1lKSB7DQogICAgICAgIGV4dGVybmFsRW50ZXIoKTsNCiAgICAgICAgY2xhaW1UaHJvbmVSUChfbW9uYXJjaE5hbWUpOw0KICAgICAgICBleHRlcm5hbExlYXZlKCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVXNlZCBieSBlaXRoZXIgdGhlIHRvcFdpemFyZCBvciBzdWJXaXphcmQgdG8gdHJhbnNmZXINCiAgICAvLy8gYWxsIHJpZ2h0cyB0byBmdXR1cmUgY29tbWlzc2lvbnMgdG8gdGhlIGBfcmVwbGFjZW1lbnRgIHdpemFyZC4NCiAgICAvLy8gV0FSTjogVGhlIG9yaWdpbmFsIHdpemFyZCByZXRhaW5zIG93bmVyc2hpcCBvZiBhbnkgcGFzdA0KICAgIC8vLyBjb21taXNzaW9uIGhlbGQgZm9yIHRoZW0gaW4gdGhlIGBmdW5kc2AgbWFwcGluZywgd2hpY2ggdGhleQ0KICAgIC8vLyBjYW4gc3RpbGwgd2l0aGRyYXcuDQogICAgLy8vIFByb2R1Y2VzIGV2ZW50IFdpemFyZFJlcGxhY2VkRXZlbnQuDQogICAgZnVuY3Rpb24gcmVwbGFjZVdpemFyZChhZGRyZXNzIF9yZXBsYWNlbWVudCkgew0KICAgICAgICBleHRlcm5hbEVudGVyKCk7DQogICAgICAgIHJlcGxhY2VXaXphcmRSUChfcmVwbGFjZW1lbnQpOw0KICAgICAgICBleHRlcm5hbExlYXZlKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZmFsbGJhY2tSUCgpIGludGVybmFsIHsNCiAgICAgICAgaWYgKG1zZy5kYXRhLmxlbmd0aCA9PSAwKSB7DQogICAgICAgICAgICBjbGFpbVRocm9uZVJQKCJBbm9ueW1vdXMiKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHN0cmluZyBtZW1vcnkgX21vbmFyY2hOYW1lID0gZXh0cmFjdE5hbWVGcm9tRGF0YShtc2cuZGF0YSk7DQogICAgICAgICAgICBjbGFpbVRocm9uZVJQKF9tb25hcmNoTmFtZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gY2xhaW1UaHJvbmVSUCgNCiAgICAgICAgc3RyaW5nIF9tb25hcmNoTmFtZQ0KICAgICkgaW50ZXJuYWwgew0KDQogICAgICAgIGFkZHJlc3MgX2NvbXBlbnNhdGlvbkFkZHJlc3MgPSBtc2cuc2VuZGVyOw0KDQogICAgICAgIGlmICghdmFsaWRhdGVOYW1lSW50ZXJuYWwoX21vbmFyY2hOYW1lKSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoX2NvbXBlbnNhdGlvbkFkZHJlc3MgPT0gMCB8fA0KICAgICAgICAgICAgX2NvbXBlbnNhdGlvbkFkZHJlc3MgPT0gYWRkcmVzcyh0aGlzKSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICB1aW50IHBhaWRXZWkgPSBtc2cudmFsdWU7DQogICAgICAgIHVpbnQgcHJpY2VXZWkgPSBjdXJyZW50Q2xhaW1QcmljZVdlaSgpOw0KICAgICAgICBpZiAocGFpZFdlaSA8IHByaWNlV2VpKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICAvLyBNYWtlIGl0IGVhc3kgZm9yIHBlb3BsZSB0byBwYXkgdXNpbmcgYSB3aG9sZSBudW1iZXIgb2YgZmlubmV5LA0KICAgICAgICAvLyB3aGljaCBjb3VsZCBiZSBhIHRlZW55IGJpdCBoaWdoZXIgdGhhbiB0aGUgcmF3IHdlaSB2YWx1ZS4NCiAgICAgICAgdWludCBleGNlc3NXZWkgPSBwYWlkV2VpIC0gcHJpY2VXZWk7DQogICAgICAgIGlmIChleGNlc3NXZWkgPiAxIGZpbm5leSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHVpbnQgY29tcGVuc2F0aW9uV2VpOw0KICAgICAgICB1aW50IGNvbW1pc3Npb25XZWk7DQogICAgICAgIGlmICghaXNMaXZpbmdNb25hcmNoKCkpIHsNCiAgICAgICAgICAgIC8vIGRlYWQgbWVuIGdldCBubyBjb21wZW5zYXRpb24NCiAgICAgICAgICAgIGNvbW1pc3Npb25XZWkgPSBwYWlkV2VpOw0KICAgICAgICAgICAgY29tcGVuc2F0aW9uV2VpID0gMDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbW1pc3Npb25XZWkgPSAocGFpZFdlaSAqIHJ1bGVzLmNvbW1pc3Npb25QZXJUaG91c2FuZCkgLyAxMDAwOw0KICAgICAgICAgICAgY29tcGVuc2F0aW9uV2VpID0gcGFpZFdlaSAtIGNvbW1pc3Npb25XZWk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoY29tbWlzc2lvbldlaSAhPSAwKSB7DQogICAgICAgICAgICByZWNvcmRDb21taXNzaW9uRWFybmVkKGNvbW1pc3Npb25XZWkpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGNvbXBlbnNhdGlvbldlaSAhPSAwKSB7DQogICAgICAgICAgICBjb21wZW5zYXRlTGF0ZXN0TW9uYXJjaChjb21wZW5zYXRpb25XZWkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gSW4gY2FzZSBvZiBhbnkgdGVlbnkgZXhjZXNzLCB3ZSB1c2UgdGhlIG9mZmljaWFsIHByaWNlIGhlcmUNCiAgICAgICAgLy8gc2luY2UgdGhhdCBzaG91bGQgZGV0ZXJtaW5lIHRoZSBuZXcgY2xhaW0gcHJpY2UsIG5vdCBwYWlkV2VpLg0KICAgICAgICBtb25hcmNoc0J5TnVtYmVyLnB1c2goTW9uYXJjaCgNCiAgICAgICAgICAgIF9jb21wZW5zYXRpb25BZGRyZXNzLA0KICAgICAgICAgICAgX21vbmFyY2hOYW1lLA0KICAgICAgICAgICAgbm93LA0KICAgICAgICAgICAgcHJpY2VXZWksDQogICAgICAgICAgICAwDQogICAgICAgICkpOw0KDQogICAgICAgIFRocm9uZUNsYWltZWRFdmVudChtb25hcmNoc0J5TnVtYmVyLmxlbmd0aCAtIDEpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlcGxhY2VXaXphcmRSUChhZGRyZXNzIHJlcGxhY2VtZW50KSBpbnRlcm5hbCB7DQogICAgICAgIGlmIChtc2cudmFsdWUgIT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgYm9vbCByZXBsYWNlZE9rID0gZmFsc2U7DQogICAgICAgIGFkZHJlc3Mgb2xkV2l6YXJkOw0KICAgICAgICBpZiAobXNnLnNlbmRlciA9PSB0b3BXaXphcmQpIHsNCiAgICAgICAgICAgIG9sZFdpemFyZCA9IHRvcFdpemFyZDsNCiAgICAgICAgICAgIHRvcFdpemFyZCA9IHJlcGxhY2VtZW50Ow0KICAgICAgICAgICAgV2l6YXJkUmVwbGFjZWRFdmVudChvbGRXaXphcmQsIHJlcGxhY2VtZW50KTsNCiAgICAgICAgICAgIHJlcGxhY2VkT2sgPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIC8vIENhcmVmdWwgLSB0b3BXaXphcmQgYW5kIHN1YldpemFyZCBjYW4gYmUgdGhlIHNhbWUgYWRkcmVzcywNCiAgICAgICAgLy8gaW4gd2hpY2ggY2FzZSB3ZSBtdXN0IHJlcGxhY2UgYm90aC4NCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gc3ViV2l6YXJkKSB7DQogICAgICAgICAgICBvbGRXaXphcmQgPSBzdWJXaXphcmQ7DQogICAgICAgICAgICBzdWJXaXphcmQgPSByZXBsYWNlbWVudDsNCiAgICAgICAgICAgIFdpemFyZFJlcGxhY2VkRXZlbnQob2xkV2l6YXJkLCByZXBsYWNlbWVudCk7DQogICAgICAgICAgICByZXBsYWNlZE9rID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXJlcGxhY2VkT2spIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gQWxsb3cgY29tbWlzc2lvbiBmdW5kcyB0byBidWlsZCB1cCBpbiBjb250cmFjdCBmb3IgdGhlIHdpemFyZHMNCiAgICAvLyB0byB3aXRoZHJhdyAoY2FyZWZ1bGx5IHJpbmctZmVuY2VkKS4NCiAgICBmdW5jdGlvbiByZWNvcmRDb21taXNzaW9uRWFybmVkKHVpbnQgX2NvbW1pc3Npb25XZWkpIGludGVybmFsIHsNCiAgICAgICAgLy8gZ2l2ZSB0aGUgc3ViV2l6YXJkIGFueSAib2RkIiBzaW5nbGUgd2VpDQogICAgICAgIHVpbnQgdG9wV2l6YXJkV2VpID0gX2NvbW1pc3Npb25XZWkgLyAyOw0KICAgICAgICB1aW50IHN1YldpemFyZFdlaSA9IF9jb21taXNzaW9uV2VpIC0gdG9wV2l6YXJkV2VpOw0KICAgICAgICBmdW5kc1t0b3BXaXphcmRdICs9IHRvcFdpemFyZFdlaTsNCiAgICAgICAgQ29tbWlzc2lvbkVhcm5lZEV2ZW50KHRvcFdpemFyZCwgdG9wV2l6YXJkV2VpKTsNCiAgICAgICAgZnVuZHNbc3ViV2l6YXJkXSArPSBzdWJXaXphcmRXZWk7DQogICAgICAgIENvbW1pc3Npb25FYXJuZWRFdmVudChzdWJXaXphcmQsIHN1YldpemFyZFdlaSk7DQogICAgfQ0KDQogICAgLy8gU2VuZCBjb21wZW5zYXRpb24gdG8gbGF0ZXN0IG1vbmFyY2ggKG9yIGhvbGQgZnVuZHMgZm9yIHRoZW0NCiAgICAvLyBpZiBjYW5ub3QgdGhyb3VnaCBubyBmYXVsdCBvZiBjdXJyZW50IGNhbGxlcikuDQogICAgZnVuY3Rpb24gY29tcGVuc2F0ZUxhdGVzdE1vbmFyY2godWludCBfY29tcGVuc2F0aW9uV2VpKSBpbnRlcm5hbCB7DQogICAgICAgIGFkZHJlc3MgY29tcGVuc2F0aW9uQWRkcmVzcyA9DQogICAgICAgICAgbGF0ZXN0TW9uYXJjaEludGVybmFsKCkuY29tcGVuc2F0aW9uQWRkcmVzczsNCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgd2UgY29tcGVuc2F0ZWQgdGhlbQ0KICAgICAgICBsYXRlc3RNb25hcmNoSW50ZXJuYWwoKS5jb21wZW5zYXRpb25XZWkgPSBfY29tcGVuc2F0aW9uV2VpOw0KICAgICAgICAvLyBXQVJOOiBpZiB0aGUgbGF0ZXN0IG1vbmFyY2ggaXMgYSBjb250cmFjdCB3aG9zZSBmYWxsYmFjaw0KICAgICAgICAvLyBmdW5jdGlvbiBuZWVkcyBtb3JlIDI1MzAwIGdhcyB0aGFuIHRoZW4gdGhleSB3aWxsIE5PVA0KICAgICAgICAvLyByZWNlaXZlIGNvbXBlbnNhdGlvbiBhdXRvbWF0aWNhbGx5Lg0KICAgICAgICBib29sIHNlbnRPayA9IGNhcmVmdWxTZW5kV2l0aEZpeGVkR2FzKA0KICAgICAgICAgICAgY29tcGVuc2F0aW9uQWRkcmVzcywNCiAgICAgICAgICAgIF9jb21wZW5zYXRpb25XZWksDQogICAgICAgICAgICBzdWdnZXN0ZWRFeHRyYUdhc1RvSW5jbHVkZVdpdGhTZW5kcw0KICAgICAgICApOw0KICAgICAgICBpZiAoc2VudE9rKSB7DQogICAgICAgICAgICBDb21wZW5zYXRpb25TZW50RXZlbnQoY29tcGVuc2F0aW9uQWRkcmVzcywgX2NvbXBlbnNhdGlvbldlaSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBUaGlzIHNob3VsZCBvbmx5IGhhcHBlbiBpZiB0aGUgbGF0ZXN0IG1vbmFyY2ggaXMgYSBjb250cmFjdA0KICAgICAgICAgICAgLy8gd2hvc2UgZmFsbGJhY2stZnVuY3Rpb24gZmFpbGVkIG9yIHJhbiBvdXQgb2YgZ2FzIChkZXNwaXRlDQogICAgICAgICAgICAvLyB1cyBpbmNsdWRpbmcgYSBmYWlyIGFtb3VudCBvZiBnYXMpLg0KICAgICAgICAgICAgLy8gV2UgZG8gbm90IHRocm93IHNpbmNlIHdlIGRvIG5vdCB3YW50IHRoZSB0aHJvbmUgdG8gZ2V0DQogICAgICAgICAgICAvLyAnc3R1Y2snIChpdCdzIG5vdCB0aGUgbmV3IHVzdXJwZXJzIGZhdWx0KSAtIGluc3RlYWQgc2F2ZQ0KICAgICAgICAgICAgLy8gdGhlIGZ1bmRzIHdlIGNvdWxkIG5vdCBzZW5kIHNvIGNhbiBiZSBjbGFpbWVkIGxhdGVyLg0KICAgICAgICAgICAgLy8gVGhlaXIgbW9uYXJjaCBjb250cmFjdCB3b3VsZCBuZWVkIHRvIGhhdmUgYmVlbiBkZXNpZ25lZA0KICAgICAgICAgICAgLy8gdG8gY2FsbCBvdXIgd2l0aGRyYXdGdW5kc0FkdmFuY2VkKC4uKSBmdW5jdGlvbiBtaW5kIHlvdS4NCiAgICAgICAgICAgIGZ1bmRzW2NvbXBlbnNhdGlvbkFkZHJlc3NdICs9IF9jb21wZW5zYXRpb25XZWk7DQogICAgICAgICAgICBDb21wZW5zYXRpb25GYWlsRXZlbnQoY29tcGVuc2F0aW9uQWRkcmVzcywgX2NvbXBlbnNhdGlvbldlaSk7DQogICAgICAgIH0NCiAgICB9DQoNCn0NCg0KDQovLy8gQHRpdGxlIFVzZWQgYnkgdGhlIFdvcmxkIGNvbnRyYWN0IHRvIGNyZWF0ZSBLaW5nZG9tIGluc3RhbmNlcy4NCi8vLyBAZGV2IE1vc3RseSBleGlzdHMgc28gdG9wV2l6YXJkIGNhbiBwb3RlbnRpYWxseSByZXBsYWNlIHRoaXMNCi8vLyBjb250cmFjdCB0byBtb2RpZnkgdGhlIEtpbmdkb20gY29udHJhY3QgYW5kL29yIHJ1bGUgdmFsaWRhdGlvbg0KLy8vIGxvZ2ljIHRvIGJlIHVzZWQgZm9yICpmdXR1cmUqIEtpbmdkb21zIGNyZWF0ZWQgYnkgdGhlIFdvcmxkLg0KLy8vIFdlIGRvIG5vdCBpbXBsZW1lbnQgcmVudHJ5IHByb3RlY3Rpb24gYmVjYXVzZSB3ZSBkb24ndCBzZW5kL2NhbGwuDQovLy8gV2UgZG8gbm90IGNoYXJnZSBhIGZlZSBoZXJlIC0gYnV0IGlmIHlvdSBieXBhc3MgdGhlIFdvcmxkIHRoZW4NCi8vLyB5b3Ugd29uJ3QgYmUgbGlzdGVkIG9uIHRoZSBvZmZpY2lhbCBXb3JsZCBwYWdlIG9mIGNvdXJzZS4NCmNvbnRyYWN0IEtpbmdkb21GYWN0b3J5IHsNCg0KICAgIGZ1bmN0aW9uIEtpbmdkb21GYWN0b3J5KCkgew0KICAgIH0NCg0KICAgIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgLy8gdGhpcyBjb250cmFjdCBzaG91bGQgbmV2ZXIgaGF2ZSBhIGJhbGFuY2UNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gU2VlIFdvcmxkLmNyZWF0ZUtpbmdkb20oLi4pIGZvciBwYXJhbWV0ZXIgZG9jdW1lbnRhdGlvbi4NCiAgICBmdW5jdGlvbiB2YWxpZGF0ZVByb3Bvc2VkVGhyb25lUnVsZXMoDQogICAgICAgIHVpbnQgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwNCiAgICAgICAgdWludCBfbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgIHVpbnQgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICB1aW50IF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsDQogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBhbGxvd2VkKSB7DQogICAgICAgIC8vIEkgc3VwcG9zZSB0aGVyZSBpcyBhIGRhbmdlciB0aGF0IG1hc3NpdmUgZGVmbGF0aW9uL2luZmxhdGlvbiBjb3VsZA0KICAgICAgICAvLyBjaGFuZ2UgdGhlIHJlYWwtd29ybGQgc2FuaXR5IG9mIHRoZXNlIGNoZWNrcywgYnV0IGluIHRoYXQgY2FzZSB3ZQ0KICAgICAgICAvLyBjYW4gZGVwbG95IGEgbmV3IGZhY3RvcnkgYW5kIHVwZGF0ZSB0aGUgd29ybGQuDQogICAgICAgIGlmIChfc3RhcnRpbmdDbGFpbVByaWNlV2VpIDwgMTAgZmlubmV5IHx8DQogICAgICAgICAgICBfc3RhcnRpbmdDbGFpbVByaWNlV2VpID4gMTAwIGV0aGVyKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF9tYXhpbXVtQ2xhaW1QcmljZVdlaSA8IDEgZXRoZXIgfHwNCiAgICAgICAgICAgIF9tYXhpbXVtQ2xhaW1QcmljZVdlaSA+IDEwMDAwMCBldGhlcikgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmIChfc3RhcnRpbmdDbGFpbVByaWNlV2VpICogMjAgPiBfbWF4aW11bUNsYWltUHJpY2VXZWkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50IDwgMTAgfHwNCiAgICAgICAgICAgIF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudCA+IDkwMCkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmIChfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzIDwgMiBob3VycyB8fA0KICAgICAgICAgICAgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcyA+IDEwMDAwIGRheXMpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX2NvbW1pc3Npb25QZXJUaG91c2FuZCA8IDEwIHx8DQogICAgICAgICAgICBfY29tbWlzc2lvblBlclRob3VzYW5kID4gMTAwKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgQ3JlYXRlIGEgbmV3IEtpbmdkb20uIE5vcm1hbGx5IGNhbGxlZCBieSBXb3JsZCBjb250cmFjdC4NCiAgICAvLy8gV0FSTjogRG9lcyBOT1QgdmFsaWRhdGUgdGhlIF9raW5nZG9tTmFtZSBvciBfd29ybGQgYXJndW1lbnRzLg0KICAgIC8vLyBXaWxsIGNvbnN1bWUgdXAgdG8gMSw4MDAsMDAwIGdhcyAoISkNCiAgICAvLy8gV2lsbCB0aHJvdyBhbiBlcnJvciBpZjoNCiAgICAvLy8gICAtIHJ1bGVzIGludmFsaWQgKHNlZSB2YWxpZGF0ZVByb3Bvc2VkVGhyb25lUnVsZXMpDQogICAgLy8vICAgLSB3aXphcmQgYWRkcmVzc2VzICJvYnZpb3VzbHkiIHdyb25nDQogICAgLy8vICAgLSBvdXQgb2YgZ2FzIHF1aXRlIGxpa2VseSAocGVyaGFwcyBpbiBmdXR1cmUgc2hvdWxkIGNvbnNpZGVyDQogICAgLy8vICAgICB1c2luZyBzb2xpZGl0eSBsaWJyYXJpZXMgdG8gcmVkdWNlIEtpbmdkb20gc2l6ZT8pDQogICAgLy8gU2VlIFdvcmxkLmNyZWF0ZUtpbmdkb20oLi4pIGZvciBwYXJhbWV0ZXIgZG9jdW1lbnRhdGlvbi4NCiAgICBmdW5jdGlvbiBjcmVhdGVLaW5nZG9tKA0KICAgICAgICBzdHJpbmcgX2tpbmdkb21OYW1lLA0KICAgICAgICBhZGRyZXNzIF93b3JsZCwNCiAgICAgICAgYWRkcmVzcyBfdG9wV2l6YXJkLA0KICAgICAgICBhZGRyZXNzIF9zdWJXaXphcmQsDQogICAgICAgIHVpbnQgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwNCiAgICAgICAgdWludCBfbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgIHVpbnQgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICB1aW50IF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsDQogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICkgcmV0dXJucyAoS2luZ2RvbSBuZXdLaW5nZG9tKSB7DQogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKSB7DQogICAgICAgICAgICAvLyB0aGlzIGNvbnRyYWN0IHNob3VsZCBuZXZlciBoYXZlIGEgYmFsYW5jZQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgLy8gTkI6IHRvcFdpemFyZCBhbmQgc3ViV2l6YXJkIENBTiBiZSB0aGUgc2FtZSBhcyBlYWNoIG90aGVyLg0KICAgICAgICBpZiAoX3RvcFdpemFyZCA9PSAwIHx8IF9zdWJXaXphcmQgPT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF90b3BXaXphcmQgPT0gX3dvcmxkIHx8IF9zdWJXaXphcmQgPT0gX3dvcmxkKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXZhbGlkYXRlUHJvcG9zZWRUaHJvbmVSdWxlcygNCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLA0KICAgICAgICAgICAgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICAgICApKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbmV3IEtpbmdkb20oDQogICAgICAgICAgICBfa2luZ2RvbU5hbWUsDQogICAgICAgICAgICBfd29ybGQsDQogICAgICAgICAgICBfdG9wV2l6YXJkLA0KICAgICAgICAgICAgX3N1YldpemFyZCwNCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLA0KICAgICAgICAgICAgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICAgICApOw0KICAgIH0NCg0KfQ0KDQoNCi8vLyBAdGl0bGUgUnVucyB0aGUgd29ybGQsIHdoaWNoIGlzIGEgY29sbGVjdGlvbiBvZiBLaW5nZG9tcy4NCmNvbnRyYWN0IFdvcmxkIGlzDQogIFJlZW50cnlQcm90ZWN0b3JNaXhpbiwNCiAgTmFtZWFibGVNaXhpbiwNCiAgTW9uZXlSb3VuZGVyTWl4aW4sDQogIEZ1bmRzSG9sZGVyTWl4aW4sDQogIFRocm9uZVJ1bGVzTWl4aW4gew0KDQogICAgLy8gVGhlIHRvcFdpemFyZCBydW5zIHRoZSB3b3JsZC4gVGhleSBjaGFyZ2UgZm9yIHRoZSBjcmVhdGlvbiBvZg0KICAgIC8vIGtpbmdkb21zIGFuZCBiZWNvbWUgdGhlIHRvcFdpemFyZCBpbiBlYWNoIGtpbmdkb20gY3JlYXRlZC4NCiAgICBhZGRyZXNzIHB1YmxpYyB0b3BXaXphcmQ7DQoNCiAgICAvLyBIb3cgbXVjaCBvbmUgbXVzdCBwYXkgdG8gY3JlYXRlIGEgbmV3IGtpbmdkb20gKGluIHdlaSkuDQogICAgLy8gQ2FuIGJlIGNoYW5nZWQgYnkgdGhlIHRvcFdpemFyZC4NCiAgICB1aW50IHB1YmxpYyBraW5nZG9tQ3JlYXRpb25GZWVXZWk7DQoNCiAgICBzdHJ1Y3QgS2luZ2RvbUxpc3Rpbmcgew0KICAgICAgICB1aW50IGtpbmdkb21OdW1iZXI7DQogICAgICAgIHN0cmluZyBraW5nZG9tTmFtZTsNCiAgICAgICAgYWRkcmVzcyBraW5nZG9tQ29udHJhY3Q7DQogICAgICAgIGFkZHJlc3Mga2luZ2RvbUNyZWF0b3I7DQogICAgICAgIHVpbnQgY3JlYXRpb25UaW1lc3RhbXA7DQogICAgICAgIGFkZHJlc3Mga2luZ2RvbUZhY3RvcnlVc2VkOw0KICAgIH0NCiAgICANCiAgICAvLyBUaGUgZmlyc3Qga2luZ2RvbSBpcyBudW1iZXIgMTsgdGhlIHplcm8tdGggZW50cnkgaXMgYSBkdW1teS4NCiAgICBLaW5nZG9tTGlzdGluZ1tdIHB1YmxpYyBraW5nZG9tc0J5TnVtYmVyOw0KDQogICAgLy8gRm9yIHNhZmV0eSwgd2UgY2FwIGp1c3QgaG93IGhpZ2ggdGhlIHByaWNlIGNhbiBnZXQuDQogICAgLy8gQ2FuIGJlIGNoYW5nZWQgYnkgdGhlIHRvcFdpemFyZCwgdGhvdWdoIGl0IHdpbGwgb25seSBhZmZlY3QNCiAgICAvLyBraW5nZG9tcyBjcmVhdGVkIGFmdGVyIHRoYXQuDQogICAgdWludCBwdWJsaWMgbWF4aW11bUNsYWltUHJpY2VXZWk7DQoNCiAgICAvLyBIZWxwZXIgY29udHJhY3QgZm9yIGNyZWF0aW5nIEtpbmdkb20gaW5zdGFuY2VzLiBDYW4gYmUNCiAgICAvLyB1cGdyYWRlZCBieSB0aGUgdG9wV2l6YXJkICh3b24ndCBhZmZlY3QgZXhpc3Rpbmcgb25lcykuDQogICAgS2luZ2RvbUZhY3RvcnkgcHVibGljIGtpbmdkb21GYWN0b3J5Ow0KDQogICAgLy8gQXZvaWRzIGR1cGxpY2F0ZSBraW5nZG9tIG5hbWVzIGFuZCBhbGxvd3Mgc2VhcmNoaW5nIGJ5IG5hbWUuDQogICAgbWFwcGluZyAodWludCA9PiB1aW50KSBraW5nZG9tTnVtYmVyc0J5ZnV6enlIYXNoOw0KDQogICAgLy8gTkI6IHdlIGFsc28gaGF2ZSBhIGBmdW5kc2AgbWFwcGluZyBmcm9tIEZ1bmRzSG9sZGVyTWl4aW4sDQogICAgLy8gYW5kIGEgcmVudHJ5UHJvdGVjdG9yIGZyb20gUmVlbnRyeVByb3RlY3Rvck1peGluLg0KDQogICAgZXZlbnQgS2luZ2RvbUNyZWF0ZWRFdmVudCh1aW50IGtpbmdkb21OdW1iZXIpOw0KICAgIGV2ZW50IENyZWF0aW9uRmVlQ2hhbmdlZEV2ZW50KHVpbnQgbmV3RmVlV2VpKTsNCiAgICBldmVudCBGYWN0b3J5Q2hhbmdlZEV2ZW50KGFkZHJlc3MgbmV3RmFjdG9yeSk7DQogICAgZXZlbnQgV2l6YXJkUmVwbGFjZWRFdmVudChhZGRyZXNzIG9sZFdpemFyZCwgYWRkcmVzcyBuZXdXaXphcmQpOw0KICAgIC8vIE5COiB3ZSBhbHNvIGhhdmUgYSBgRnVuZHNXaXRoZHJhd25FdmVudGAgZnJvbSBGdW5kc0hvbGRlck1peGluDQoNCiAgICAvLyBDcmVhdGUgdGhlIHdvcmxkIHdpdGggbm8ga2luZ2RvbXMgeWV0Lg0KICAgIC8vIENvc3RzIGFib3V0IDEuOU0gZ2FzIHRvIGRlcGxveS4NCiAgICBmdW5jdGlvbiBXb3JsZCgNCiAgICAgICAgYWRkcmVzcyBfdG9wV2l6YXJkLA0KICAgICAgICB1aW50IF9raW5nZG9tQ3JlYXRpb25GZWVXZWksDQogICAgICAgIEtpbmdkb21GYWN0b3J5IF9raW5nZG9tRmFjdG9yeSwNCiAgICAgICAgdWludCBfbWF4aW11bUNsYWltUHJpY2VXZWkNCiAgICApIHsNCiAgICAgICAgaWYgKF90b3BXaXphcmQgPT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF9tYXhpbXVtQ2xhaW1QcmljZVdlaSA8IDEgZXRoZXIpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIHRvcFdpemFyZCA9IF90b3BXaXphcmQ7DQogICAgICAgIGtpbmdkb21DcmVhdGlvbkZlZVdlaSA9IF9raW5nZG9tQ3JlYXRpb25GZWVXZWk7DQogICAgICAgIGtpbmdkb21GYWN0b3J5ID0gX2tpbmdkb21GYWN0b3J5Ow0KICAgICAgICBtYXhpbXVtQ2xhaW1QcmljZVdlaSA9IF9tYXhpbXVtQ2xhaW1QcmljZVdlaTsNCiAgICAgICAgLy8gV2UgbnVtYmVyIHRoZSBraW5nZG9tcyBzdGFydGluZyBmcm9tIDEgc2luY2UgaXQncyBzb21ldGltZXMNCiAgICAgICAgLy8gdXNlZnVsIHRvIHVzZSB6ZXJvID0gaW52YWxpZC4gQ3JlYXRlIGR1bW15IHplcm8tdGggZW50cnkuDQogICAgICAgIGtpbmdkb21zQnlOdW1iZXIucHVzaChLaW5nZG9tTGlzdGluZygwLCAiIiwgMCwgMCwgMCwgMCkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG51bWJlck9mS2luZ2RvbXMoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHRvdGFsQ291bnQpIHsNCiAgICAgICAgcmV0dXJuIGtpbmdkb21zQnlOdW1iZXIubGVuZ3RoIC0gMTsNCiAgICB9DQoNCiAgICAvLy8gQHJldHVybiBpbmRleCBpbnRvIGtpbmdkb21zQnlOdW1iZXIgaWYgZm91bmQsIG9yIHplcm8gaWYgbm90LiANCiAgICBmdW5jdGlvbiBmaW5kS2luZ2RvbUNhbGxlZChzdHJpbmcgX2tpbmdkb21OYW1lKSBjb25zdGFudA0KICAgIHJldHVybnMgKHVpbnQga2luZ2RvbU51bWJlcikgew0KICAgICAgICB1aW50IGZ1enp5SGFzaCA9IGNvbXB1dGVOYW1lRnV6enlIYXNoKF9raW5nZG9tTmFtZSk7DQogICAgICAgIHJldHVybiBraW5nZG9tTnVtYmVyc0J5ZnV6enlIYXNoW2Z1enp5SGFzaF07DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYSBuYW1lIGNhbiBiZSB1c2VkIGFzIGEga2luZ2RvbSBuYW1lLg0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIG5hbWUgc2F0aXNmaWVzIHRoZSBjcml0ZXJpYSBvZjoNCiAgICAvLy8gICAtIG5vIGZld2VyIHRoYW4gMSBjaGFyYWN0ZXINCiAgICAvLy8gICAtIG5vIG1vcmUgdGhhbiAyNSBjaGFyYWN0ZXJzDQogICAgLy8vICAgLSBubyBjaGFyYWN0ZXJzIG90aGVyIHRoYW46DQogICAgLy8vICAgICAtICJyb21hbiIgYWxwaGFiZXQgbGV0dGVycyAoQS1aIGFuZCBhLXopDQogICAgLy8vICAgICAtIHdlc3Rlcm4gZGlnaXRzICgwLTkpDQogICAgLy8vICAgICAtICJzYWZlIiBwdW5jdHVhdGlvbjogISAoICkgLSAuIF8gU1BBQ0UNCiAgICAvLy8NCiAgICAvLy8gV0FSTjogZG9lcyBub3QgY2hlY2sgaWYgdGhlIG5hbWUgaXMgYWxyZWFkeSBpbiB1c2U7DQogICAgLy8vIHVzZSBgZmluZEtpbmdkb21DYWxsZWQoc3RyaW5nKWAgZm9yIHRoYXQgYWZ0ZXJ3YXJkcy4NCiAgICBmdW5jdGlvbiB2YWxpZGF0ZVByb3Bvc2VkS2luZ2RvbU5hbWUoc3RyaW5nIF9raW5nZG9tTmFtZSkgY29uc3RhbnQNCiAgICByZXR1cm5zIChib29sIGFsbG93ZWQpIHsNCiAgICAgICAgcmV0dXJuIHZhbGlkYXRlTmFtZUludGVybmFsKF9raW5nZG9tTmFtZSk7DQogICAgfQ0KDQogICAgLy8gQ2hlY2sgaWYgcnVsZXMgd291bGQgYmUgYWxsb3dlZCBmb3IgYSBuZXcgY3VzdG9tIEtpbmdkb20uDQogICAgLy8gVHlwaWNhbGx5IHVzZWQgYmVmb3JlIGNhbGxpbmcgYGNyZWF0ZUtpbmdkb20oLi4uKWAuDQogICAgZnVuY3Rpb24gdmFsaWRhdGVQcm9wb3NlZFRocm9uZVJ1bGVzKA0KICAgICAgICB1aW50IF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgIHVpbnQgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICB1aW50IF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsDQogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBhbGxvd2VkKSB7DQogICAgICAgIHJldHVybiBraW5nZG9tRmFjdG9yeS52YWxpZGF0ZVByb3Bvc2VkVGhyb25lUnVsZXMoDQogICAgICAgICAgICBfc3RhcnRpbmdDbGFpbVByaWNlV2VpLA0KICAgICAgICAgICAgbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLA0KICAgICAgICAgICAgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICAgICApOw0KICAgIH0NCg0KICAgIC8vIEhvdyBtdWNoIG9uZSBtdXN0IHBheSB0byBjcmVhdGUgYSBuZXcga2luZ2RvbSAoaW4gZmlubmV5KS4NCiAgICAvLyBDYW4gYmUgY2hhbmdlZCBieSB0aGUgdG9wV2l6YXJkLg0KICAgIGZ1bmN0aW9uIGtpbmdkb21DcmVhdGlvbkZlZUluRmlubmV5KCkgY29uc3RhbnQNCiAgICByZXR1cm5zICh1aW50IGZlZUluRmlubmV5KSB7DQogICAgICAgIHJldHVybiByb3VuZE1vbmV5VXBUb1dob2xlRmlubmV5KGtpbmdkb21DcmVhdGlvbkZlZVdlaSk7DQogICAgfQ0KDQogICAgLy8gUmVqZWN0IGZ1bmRzIHNlbnQgdG8gdGhlIGNvbnRyYWN0IC0gd2l6YXJkcyB3aG8gY2Fubm90IGludGVyYWN0DQogICAgLy8gd2l0aCBpdCB2aWEgdGhlIEFQSSB3b24ndCBiZSBhYmxlIHRvIHdpdGhkcmF3IHRoZWlyIGNvbW1pc3Npb24uDQogICAgZnVuY3Rpb24gKCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgYSBuZXcga2luZ2RvbSB1c2luZyBjdXN0b20gcnVsZXMuDQogICAgLy8vIEBwYXJhbSBfa2luZ2RvbU5hbWUgXA0KICAgIC8vLyAgIGUuZy4gIktpbmcgb2YgdGhlIEV0aGVyIFRocm9uZSINCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ0NsYWltUHJpY2VXZWkgXA0KICAgIC8vLyAgIEhvdyBtdWNoIGl0IHdpbGwgY29zdCB0aGUgZmlyc3QgbW9uYXJjaCB0byBjbGFpbSB0aGUgdGhyb25lDQogICAgLy8vICAgKGFuZCBhbHNvIHRoZSBwcmljZSBhZnRlciB0aGUgZGVhdGggb2YgYSBtb25hcmNoKS4NCiAgICAvLy8gQHBhcmFtIF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudCBcDQogICAgLy8vICAgUGVyY2VudGFnZSBpbmNyZWFzZSBhZnRlciBlYWNoIGNsYWltIC0gZS5nLiBpZiBjbGFpbSBwcmljZQ0KICAgIC8vLyAgIHdhcyAyMDAgRVRILCBhbmQgYF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudGAgaXMgNTAsIHRoZSBuZXh0DQogICAgLy8vICAgY2xhaW0gcHJpY2Ugd2lsbCBiZSAyMDAgRVRIICsgKDUwJSBvZiAyMDAgRVRIKSA9PiAzMDAgRVRILg0KICAgIC8vLyBAcGFyYW0gX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcyBcDQogICAgLy8vICAgVGhlIG1heGltdW0gbGVuZ3RoIG9mIGEgdGltZSBhIG1vbmFyY2ggY2FuIHJ1bGUgYmVmb3JlIHRoZQ0KICAgIC8vLyAgIGN1cnNlIHN0cmlrZXMgYW5kIHRoZXkgYXJlIHJlbW92ZWQgd2l0aG91dCBjb21wZW5zYXRpb24uDQogICAgLy8vIEBwYXJhbSBfY29tbWlzc2lvblBlclRob3VzYW5kIFwNCiAgICAvLy8gICBIb3cgbXVjaCBvZiBlYWNoIHBheW1lbnQgaXMgZ2l2ZW4gdG8gdGhlIHdpemFyZHMgdG8gc2hhcmUsDQogICAgLy8vICAgZXhwcmVzc2VkIGluIHBhcnRzIHBlciB0aG91c2FuZCAtIGUuZy4gMjUgbWVhbnMgMjUvMTAwMCwNCiAgICAvLy8gICBvciAyLjUlLg0KICAgIC8vLyANCiAgICAvLy8gQ2FsbGVyIG11c3QgaW5jbHVkZSBwYXltZW50IGVxdWFsIHRvIGtpbmdkb21DcmVhdGlvbkZlZVdlaS4NCiAgICAvLy8gVGhlIGNhbGxlciB3aWxsIGJlY29tZSB0aGUgJ3N1Yi13aXphcmQnIGFuZCB3aWxsIGVhcm4gaGFsZg0KICAgIC8vLyBhbnkgY29tbWlzc2lvbiBjaGFyZ2VkIGJ5IHRoZSBLaW5nZG9tLiAgTm90ZSBob3dldmVyIHRoZXkNCiAgICAvLy8gd2lsbCBuZWVkIHRvIGNhbGwgd2l0aGRyYXdGdW5kcygpIG9uIHRoZSBLaW5nZG9tIGNvbnRyYWN0DQogICAgLy8vIHRvIGdldCB0aGVpciBjb21taXNzaW9uIC0gaXQncyBub3Qgc2VuZCBhdXRvbWF0aWNhbGx5Lg0KICAgIC8vLw0KICAgIC8vLyBXaWxsIGNvbnN1bWUgdXAgdG8gMSw5MDAsMDAwIGdhcyAoISkNCiAgICAvLy8gV2lsbCB0aHJvdyBhbiBlcnJvciBpZjoNCiAgICAvLy8gICAtIG5hbWUgaXMgaW52YWxpZCAoc2VlIGB2YWxpZGF0ZVByb3Bvc2VkS2luZ2RvbU5hbWUoc3RyaW5nKWApDQogICAgLy8vICAgLSBuYW1lIGlzIGFscmVhZHkgaW4gdXNlIChzZWUgYGZpbmRLaW5nZG9tQ2FsbGVkKHN0cmluZylgKQ0KICAgIC8vLyAgIC0gcnVsZXMgYXJlIGludmFsaWQgKHNlZSBgdmFsaWRhdGVQcm9wb3NlZEtpbmdkb21SdWxlcyguLi4pYCkNCiAgICAvLy8gICAtIHBheW1lbnQgaXMgdG9vIGxvdyBvciB0b28gaGlnaA0KICAgIC8vLyAgIC0gaW5zdWZmaWNpZW50IGdhcyAocXVpdGUgbGlrZWx5ISkNCiAgICAvLy8gUHJvZHVjZXMgZXZlbnQgS2luZ2RvbUNyZWF0ZWRFdmVudC4NCiAgICBmdW5jdGlvbiBjcmVhdGVLaW5nZG9tKA0KICAgICAgICBzdHJpbmcgX2tpbmdkb21OYW1lLA0KICAgICAgICB1aW50IF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgIHVpbnQgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICB1aW50IF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsDQogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICkgew0KICAgICAgICBleHRlcm5hbEVudGVyKCk7DQogICAgICAgIGNyZWF0ZUtpbmdkb21SUCgNCiAgICAgICAgICAgIF9raW5nZG9tTmFtZSwNCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLA0KICAgICAgICAgICAgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICAgICApOw0KICAgICAgICBleHRlcm5hbExlYXZlKCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVXNlZCBieSB0b3BXaXphcmQgdG8gdHJhbnNmZXIgYWxsIHJpZ2h0cyB0byBmdXR1cmUNCiAgICAvLy8gZmVlcyBhbmQgZnV0dXJlIGtpbmdkb20gd2l6YXJkc2hpcHMgdG8gYF9yZXBsYWNlbWVudGAgd2l6YXJkLg0KICAgIC8vLyBXQVJOOiBUaGUgb3JpZ2luYWwgd2l6YXJkIHJldGFpbnMgb3duZXJzaGlwIG9mIGFueSBwYXN0IGZlZXMNCiAgICAvLy8gaGVsZCBmb3IgdGhlbSBpbiB0aGUgYGZ1bmRzYCBtYXBwaW5nLCB3aGljaCB0aGV5IGNhbiBzdGlsbA0KICAgIC8vLyB3aXRoZHJhdy4gVGhleSBhbHNvIHJlbWFpbiB0b3BXaXphcmQgaW4gYW55IGV4aXN0aW5nIEtpbmdkb21zLg0KICAgIC8vLyBQcm9kdWNlcyBldmVudCBXaXphcmRSZXBsYWNlZEV2ZW50Lg0KICAgIGZ1bmN0aW9uIHJlcGxhY2VXaXphcmQoYWRkcmVzcyBfcmVwbGFjZW1lbnQpIHsNCiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOw0KICAgICAgICByZXBsYWNlV2l6YXJkUlAoX3JlcGxhY2VtZW50KTsNCiAgICAgICAgZXh0ZXJuYWxMZWF2ZSgpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFVzZWQgYnkgdG9wV2l6YXJkIHRvIHZhcnkgdGhlIGZlZSBmb3IgY3JlYXRpbmcga2luZ2RvbXMuDQogICAgZnVuY3Rpb24gc2V0S2luZ2RvbUNyZWF0aW9uRmVlV2VpKHVpbnQgX2tpbmdkb21DcmVhdGlvbkZlZVdlaSkgew0KICAgICAgICBleHRlcm5hbEVudGVyKCk7DQogICAgICAgIHNldEtpbmdkb21DcmVhdGlvbkZlZVdlaVJQKF9raW5nZG9tQ3JlYXRpb25GZWVXZWkpOw0KICAgICAgICBleHRlcm5hbExlYXZlKCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVXNlZCBieSB0b3BXaXphcmQgdG8gdmFyeSB0aGUgY2FwIG9uIGNsYWltIHByaWNlLg0KICAgIGZ1bmN0aW9uIHNldE1heGltdW1DbGFpbVByaWNlV2VpKHVpbnQgX21heGltdW1DbGFpbVByaWNlV2VpKSB7DQogICAgICAgIGV4dGVybmFsRW50ZXIoKTsNCiAgICAgICAgc2V0TWF4aW11bUNsYWltUHJpY2VXZWlSUChfbWF4aW11bUNsYWltUHJpY2VXZWkpOw0KICAgICAgICBleHRlcm5hbExlYXZlKCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVXNlZCBieSB0b3BXaXphcmQgdG8gdmFyeSB0aGUgZmFjdG9yeSBjb250cmFjdCB3aGljaA0KICAgIC8vLyB3aWxsIGJlIHVzZWQgdG8gY3JlYXRlIGZ1dHVyZSBLaW5nZG9tcy4NCiAgICBmdW5jdGlvbiBzZXRLaW5nZG9tRmFjdG9yeShLaW5nZG9tRmFjdG9yeSBfa2luZ2RvbUZhY3RvcnkpIHsNCiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOw0KICAgICAgICBzZXRLaW5nZG9tRmFjdG9yeVJQKF9raW5nZG9tRmFjdG9yeSk7DQogICAgICAgIGV4dGVybmFsTGVhdmUoKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjcmVhdGVLaW5nZG9tUlAoDQogICAgICAgIHN0cmluZyBfa2luZ2RvbU5hbWUsDQogICAgICAgIHVpbnQgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwNCiAgICAgICAgdWludCBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgIHVpbnQgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcywNCiAgICAgICAgdWludCBfY29tbWlzc2lvblBlclRob3VzYW5kDQogICAgKSBpbnRlcm5hbCB7DQoNCiAgICAgICAgYWRkcmVzcyBzdWJXaXphcmQgPSBtc2cuc2VuZGVyOw0KDQogICAgICAgIGlmICghdmFsaWRhdGVOYW1lSW50ZXJuYWwoX2tpbmdkb21OYW1lKSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICB1aW50IG5ld0tpbmdkb21OdW1iZXIgPSBraW5nZG9tc0J5TnVtYmVyLmxlbmd0aDsNCiAgICAgICAgY2hlY2tVbmlxdWVBbmRSZWdpc3Rlck5ld0tpbmdkb21OYW1lKA0KICAgICAgICAgICAgX2tpbmdkb21OYW1lLA0KICAgICAgICAgICAgbmV3S2luZ2RvbU51bWJlcg0KICAgICAgICApOw0KDQogICAgICAgIHVpbnQgcGFpZFdlaSA9IG1zZy52YWx1ZTsNCiAgICAgICAgaWYgKHBhaWRXZWkgPCBraW5nZG9tQ3JlYXRpb25GZWVXZWkpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIC8vIE1ha2UgaXQgZWFzeSBmb3IgcGVvcGxlIHRvIHBheSB1c2luZyBhIHdob2xlIG51bWJlciBvZiBmaW5uZXksDQogICAgICAgIC8vIHdoaWNoIGNvdWxkIGJlIGEgdGVlbnkgYml0IGhpZ2hlciB0aGFuIHRoZSByYXcgd2VpIHZhbHVlLg0KICAgICAgICB1aW50IGV4Y2Vzc1dlaSA9IHBhaWRXZWkgLSBraW5nZG9tQ3JlYXRpb25GZWVXZWk7DQogICAgICAgIGlmIChleGNlc3NXZWkgPiAxIGZpbm5leSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgZnVuZHNbdG9wV2l6YXJkXSArPSBwYWlkV2VpOw0KICAgICAgICANCiAgICAgICAgLy8gVGhpcyB3aWxsIHBlcmZvcm0gcnVsZSB2YWxpZGF0aW9uLg0KICAgICAgICBLaW5nZG9tIGtpbmdkb21Db250cmFjdCA9IGtpbmdkb21GYWN0b3J5LmNyZWF0ZUtpbmdkb20oDQogICAgICAgICAgICBfa2luZ2RvbU5hbWUsDQogICAgICAgICAgICBhZGRyZXNzKHRoaXMpLA0KICAgICAgICAgICAgdG9wV2l6YXJkLA0KICAgICAgICAgICAgc3ViV2l6YXJkLA0KICAgICAgICAgICAgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwNCiAgICAgICAgICAgIG1heGltdW1DbGFpbVByaWNlV2VpLA0KICAgICAgICAgICAgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICAgICAgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcywNCiAgICAgICAgICAgIF9jb21taXNzaW9uUGVyVGhvdXNhbmQNCiAgICAgICAgKTsNCg0KICAgICAgICBraW5nZG9tc0J5TnVtYmVyLnB1c2goS2luZ2RvbUxpc3RpbmcoDQogICAgICAgICAgICBuZXdLaW5nZG9tTnVtYmVyLA0KICAgICAgICAgICAgX2tpbmdkb21OYW1lLA0KICAgICAgICAgICAga2luZ2RvbUNvbnRyYWN0LA0KICAgICAgICAgICAgbXNnLnNlbmRlciwNCiAgICAgICAgICAgIG5vdywNCiAgICAgICAgICAgIGtpbmdkb21GYWN0b3J5DQogICAgICAgICkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlcGxhY2VXaXphcmRSUChhZGRyZXNzIHJlcGxhY2VtZW50KSBpbnRlcm5hbCB7IA0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSB0b3BXaXphcmQpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIGlmIChtc2cudmFsdWUgIT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgYWRkcmVzcyBvbGRXaXphcmQgPSB0b3BXaXphcmQ7DQogICAgICAgIHRvcFdpemFyZCA9IHJlcGxhY2VtZW50Ow0KICAgICAgICBXaXphcmRSZXBsYWNlZEV2ZW50KG9sZFdpemFyZCwgcmVwbGFjZW1lbnQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldEtpbmdkb21DcmVhdGlvbkZlZVdlaVJQKHVpbnQgX2tpbmdkb21DcmVhdGlvbkZlZVdlaSkgaW50ZXJuYWwgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSB0b3BXaXphcmQpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIGlmIChtc2cudmFsdWUgIT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAga2luZ2RvbUNyZWF0aW9uRmVlV2VpID0gX2tpbmdkb21DcmVhdGlvbkZlZVdlaTsNCiAgICAgICAgQ3JlYXRpb25GZWVDaGFuZ2VkRXZlbnQoa2luZ2RvbUNyZWF0aW9uRmVlV2VpKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZXRNYXhpbXVtQ2xhaW1QcmljZVdlaVJQKHVpbnQgX21heGltdW1DbGFpbVByaWNlV2VpKSBpbnRlcm5hbCB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHRvcFdpemFyZCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG1zZy52YWx1ZSAhPSAwKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX21heGltdW1DbGFpbVByaWNlV2VpIDwgMSBldGhlcikgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgbWF4aW11bUNsYWltUHJpY2VXZWkgPSBfbWF4aW11bUNsYWltUHJpY2VXZWk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0S2luZ2RvbUZhY3RvcnlSUChLaW5nZG9tRmFjdG9yeSBfa2luZ2RvbUZhY3RvcnkpIGludGVybmFsIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdG9wV2l6YXJkKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobXNnLnZhbHVlICE9IDApIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIGtpbmdkb21GYWN0b3J5ID0gX2tpbmdkb21GYWN0b3J5Ow0KICAgICAgICBGYWN0b3J5Q2hhbmdlZEV2ZW50KGtpbmdkb21GYWN0b3J5KTsNCiAgICB9DQoNCiAgICAvLyBJZiB0aGVyZSBpcyBubyBleGlzdGluZyBraW5nZG9tIGNhbGxlZCBgX2tpbmdkb21OYW1lYCwgY3JlYXRlDQogICAgLy8gYSByZWNvcmQgbWFwcGluZyB0aGF0IG5hbWUgdG8ga2luZ2RvbSBuby4gYF9uZXdLaW5nZG9tTnVtYmVyYC4NCiAgICAvLyBUaHJvd3MgYW4gZXJyb3IgaWYgYW4gZXhpc3Rpbmcga2luZ2RvbSB3aXRoIHRoZSBzYW1lIChvcg0KICAgIC8vIGZ1enppbHkgc2ltaWxhciAtIHNlZSBjb21wdXRlTmFtZUZ1enp5SGFzaCkgbmFtZSBleGlzdHMuDQogICAgZnVuY3Rpb24gY2hlY2tVbmlxdWVBbmRSZWdpc3Rlck5ld0tpbmdkb21OYW1lKA0KICAgICAgICBzdHJpbmcgX2tpbmdkb21OYW1lLA0KICAgICAgICB1aW50IF9uZXdLaW5nZG9tTnVtYmVyDQogICAgKSBpbnRlcm5hbCB7DQogICAgICAgIHVpbnQgZnV6enlIYXNoID0gY29tcHV0ZU5hbWVGdXp6eUhhc2goX2tpbmdkb21OYW1lKTsNCiAgICAgICAgaWYgKGtpbmdkb21OdW1iZXJzQnlmdXp6eUhhc2hbZnV6enlIYXNoXSAhPSAwKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBraW5nZG9tTnVtYmVyc0J5ZnV6enlIYXNoW2Z1enp5SGFzaF0gPSBfbmV3S2luZ2RvbU51bWJlcjsNCiAgICB9DQoNCn0NCg0KDQovLy8gQHRpdGxlIFVzZWQgb24gdGhlIHRlc3RuZXQgdG8gYWxsb3cgYXV0b21hdGVkIHRlc3Rpbmcgb2YgaW50ZXJuYWxzLg0KY29udHJhY3QgRXhwb3NlZEludGVybmFsc0ZvclRlc3RpbmcgaXMNCiAgTW9uZXlSb3VuZGVyTWl4aW4sIE5hbWVhYmxlTWl4aW4gew0KDQogICAgZnVuY3Rpb24gcm91bmRNb25leURvd25OaWNlbHlFVCh1aW50IF9yYXdWYWx1ZVdlaSkgY29uc3RhbnQNCiAgICByZXR1cm5zICh1aW50IG5pY2VyVmFsdWVXZWkpIHsNCiAgICAgICAgcmV0dXJuIHJvdW5kTW9uZXlEb3duTmljZWx5KF9yYXdWYWx1ZVdlaSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcm91bmRNb25leVVwVG9XaG9sZUZpbm5leUVUKHVpbnQgX3ZhbHVlV2VpKSBjb25zdGFudA0KICAgIHJldHVybnMgKHVpbnQgdmFsdWVGaW5uZXkpIHsNCiAgICAgICAgcmV0dXJuIHJvdW5kTW9uZXlVcFRvV2hvbGVGaW5uZXkoX3ZhbHVlV2VpKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB2YWxpZGF0ZU5hbWVJbnRlcm5hbEVUKHN0cmluZyBfbmFtZSkgY29uc3RhbnQNCiAgICByZXR1cm5zIChib29sIGFsbG93ZWQpIHsNCiAgICAgICAgcmV0dXJuIHZhbGlkYXRlTmFtZUludGVybmFsKF9uYW1lKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBleHRyYWN0TmFtZUZyb21EYXRhRVQoYnl0ZXMgX2RhdGEpIGNvbnN0YW50DQogICAgcmV0dXJucyAoc3RyaW5nIGV4dHJhY3RlZE5hbWUpIHsNCiAgICAgICAgcmV0dXJuIGV4dHJhY3ROYW1lRnJvbURhdGEoX2RhdGEpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBjb21wdXRlTmFtZUZ1enp5SGFzaEVUKHN0cmluZyBfbmFtZSkgY29uc3RhbnQNCiAgICByZXR1cm5zICh1aW50IGZ1enp5SGFzaCkgew0KICAgICAgICByZXR1cm4gY29tcHV0ZU5hbWVGdXp6eUhhc2goX25hbWUpOw0KICAgIH0NCg0KfQ=='