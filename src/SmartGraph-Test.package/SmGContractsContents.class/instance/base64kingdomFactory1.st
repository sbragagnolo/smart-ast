base 64 content
base64kingdomFactory1
	^'Ly8gS2luZyBvZiB0aGUgRXRoZXIgVGhyb25lIENvbnRyYWN0cy4NCi8vIENvcHlyaWdodCAoYykgMjAxNiBLaWVyYW4gRWxieS4gUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLg0KLy8gVmVyc2lvbiAwLjkuOS4yLCBKdWx5IDIwMTYuDQovLw0KLy8gU2VlIGFsc28gaHR0cDovL3d3dy5raW5nb2Z0aGVldGhlci5jb20gYW5kDQovLyBodHRwczovL2dpdGh1Yi5jb20va2llcmFuZWxieS9LaW5nT2ZUaGVFdGhlclRocm9uZSAuDQovLyANCi8vIFRoaXMgZmlsZSBjb250YWlucyBhIG51bWJlciBvZiBjb250cmFjdHMsIG9mIHdoaWNoIG9ubHkNCi8vIHRoZXNlIHRocmVlIGFyZSBub3JtYWxseSBjcmVhdGVkOg0KLy8NCi8vIC0gS2luZ2RvbSAgICAgICAgPSBtYWludGFpbnMgdGhlIHRocm9uZSBmb3IgYSBraW5nZG9tDQovLyAtIFdvcmxkICAgICAgICAgID0gcnVucyB0aGUgd29ybGQsIHdoaWNoIGlzIGEgY29sbGVjdGlvbiBvZiBraW5nZG9tcw0KLy8gLSBLaW5nZG9tRmFjdG9yeSA9IHVzZWQgaW50ZXJuYWxseSBieSB0aGUgV29ybGQgY29udHJhY3QNCi8vDQovLyBUaGUgIk1peGluIiBjb250cmFjdHMgKFRocm9uZVJ1bGVzTWl4aW4sIFJlZW50cnlQcm90ZWN0b3JNaXhpbiwNCi8vIENhcmVmdWxTZW5kZXJNaXhpbiwgRnVuZHNIb2xkZXJNaXhpbiwgTW9uZXlSb3VuZGVyTWl4aW4sDQovLyBOYW1lYWJsZU1peGluKSBjb250YWluIGZ1bmN0aW9ucyAvIGRhdGEgLyBzdHJ1Y3R1cmVzIHVzZWQNCi8vIGJ5IHRoZSB0aHJlZSBtYWluIGNvbnRyYWN0cy4NCi8vIFRoZSBFeHBvc2VkSW50ZXJuYWxzRm9yVGVzdGluZyBjb250cmFjdCBpcyB1c2VkIGJ5IGF1dG9tYXRlZCB0ZXN0cy4NCg0KDQovLy8gQHRpdGxlIE1peGluIHRvIGhlbHAgYXZvaWQgcmVjdXJzaXZlLWNhbGwgYXR0YWNrcy4NCmNvbnRyYWN0IFJlZW50cnlQcm90ZWN0b3JNaXhpbiB7DQoNCiAgICAvLyB0cnVlIGlmIHdlIGFyZSBpbnNpZGUgYW4gZXh0ZXJuYWwgZnVuY3Rpb24NCiAgICBib29sIHJlZW50cnlQcm90ZWN0b3I7DQoNCiAgICAvLyBNYXJrIGNvbnRyYWN0IGFzIGhhdmluZyBlbnRlcmVkIGFuIGV4dGVybmFsIGZ1bmN0aW9uLg0KICAgIC8vIFRocm93cyBhbiBleGNlcHRpb24gaWYgY2FsbGVkIHR3aWNlIHdpdGggbm8gZXh0ZXJuYWxMZWF2ZSgpLg0KICAgIC8vIEZvciB0aGlzIHRvIHdvcmssIENvbnRyYWN0cyBNVVNUOg0KICAgIC8vICAtIGNhbGwgZXh0ZXJuYWxFbnRlcigpIGF0IHRoZSBzdGFydCBvZiBlYWNoIGV4dGVybmFsIGZ1bmN0aW9uDQogICAgLy8gIC0gY2FsbCBleHRlcm5hbExlYXZlKCkgYXQgdGhlIGVuZCBvZiBlYWNoIGV4dGVybmFsIGZ1bmN0aW9uDQogICAgLy8gIC0gbmV2ZXIgdXNlIHJldHVybiBzdGF0ZW1lbnRzIGluIGJldHdlZW4gZW50ZXIgYW5kIGxlYXZlDQogICAgLy8gIC0gbmV2ZXIgY2FsbCBhbiBleHRlcm5hbCBmdW5jdGlvbiBmcm9tIGFub3RoZXIgZnVuY3Rpb24NCiAgICAvLyBXQVJOOiBzZXJpb3VzIHJpc2sgb2YgY29udHJhY3QgZ2V0dGluZyBzdHVjayBpZiB1c2VkIHdyb25nbHkuDQogICAgZnVuY3Rpb24gZXh0ZXJuYWxFbnRlcigpIGludGVybmFsIHsNCiAgICAgICAgaWYgKHJlZW50cnlQcm90ZWN0b3IpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIHJlZW50cnlQcm90ZWN0b3IgPSB0cnVlOw0KICAgIH0NCg0KICAgIC8vIE1hcmsgY29udHJhY3QgYXMgaGF2aW5nIGxlZnQgYW4gZXh0ZXJuYWwgZnVuY3Rpb24uDQogICAgLy8gRG8gdGhpcyBhZnRlciBlYWNoIGNhbGwgdG8gZXh0ZXJuYWxFbnRlcigpLg0KICAgIGZ1bmN0aW9uIGV4dGVybmFsTGVhdmUoKSBpbnRlcm5hbCB7DQogICAgICAgIHJlZW50cnlQcm90ZWN0b3IgPSBmYWxzZTsNCiAgICB9DQoNCn0NCg0KDQovLy8gQHRpdGxlIE1peGluIHRvIGhlbHAgc2VuZCBldGhlciB0byB1bnRydXN0ZWQgYWRkcmVzc2VzLg0KY29udHJhY3QgQ2FyZWZ1bFNlbmRlck1peGluIHsNCg0KICAgIC8vIFNlZW1zIGEgcmVhc29uYWJsZSBhbW91bnQgZm9yIGEgd2VsbC13cml0dGVuIGZhbGxiYWNrIGZ1bmN0aW9uLg0KICAgIHVpbnQgY29uc3RhbnQgc3VnZ2VzdGVkRXh0cmFHYXNUb0luY2x1ZGVXaXRoU2VuZHMgPSAyMzAwMDsNCg0KICAgIC8vIFNlbmQgYF92YWx1ZVdlaWAgb2Ygb3VyIGV0aGVyIHRvIGBfdG9BZGRyZXNzYCwgaW5jbHVkaW5nDQogICAgLy8gYF9leHRyYUdhc0luY2x1ZGVkYCBnYXMgYWJvdmUgdGhlIHVzdWFsIDIzMDAgZ2FzIHN0aXBlbmQNCiAgICAvLyB3aXRoIHRoZSBzZW5kIGNhbGwuDQogICAgLy8NCiAgICAvLyBUaGlzIG5lZWRzIGNhcmUgYmVjYXVzZSB0aGVyZSBpcyBubyB3YXkgdG8gdGVsbCBpZiBfdG9BZGRyZXNzDQogICAgLy8gaXMgZXh0ZXJuYWxseSBvd25lZCBvciBpcyBhbm90aGVyIGNvbnRyYWN0IC0gYW5kIHNlbmRpbmcgZXRoZXINCiAgICAvLyB0byBhIGNvbnRyYWN0IGFkZHJlc3Mgd2lsbCBpbnZva2UgaXRzIGZhbGxiYWNrIGZ1bmN0aW9uOyB0aGlzDQogICAgLy8gaGFzIHRocmVlIGltcGxpY2F0aW9uczoNCiAgICAvLw0KICAgIC8vIDEpIERhbmdlciBvZiByZWN1cnNpdmUgYXR0YWNrLg0KICAgIC8vICBUaGUgZGVzdGluYXRpb24gY29udHJhY3QncyBmYWxsYmFjayBmdW5jdGlvbiAob3IgYW5vdGhlcg0KICAgIC8vICBjb250cmFjdCBpdCBjYWxscykgbWF5IGNhbGwgYmFjayBpbnRvIHRoaXMgY29udHJhY3QgKGluY2x1ZGluZw0KICAgIC8vICBvdXIgZmFsbGJhY2sgZnVuY3Rpb24gYW5kIGV4dGVybmFsIGZ1bmN0aW9ucyBpbmhlcml0ZWQsIG9yIGludG8NCiAgICAvLyAgb3RoZXIgY29udHJhY3RzIGluIG91ciBzdGFjayksIGxlYWRpbmcgdG8gdW5leHBlY3RlZCBiZWhhdmlvdXIuDQogICAgLy8gIE1pdGlnYXRpb25zOg0KICAgIC8vICAgLSBwcm90ZWN0IGFsbCBleHRlcm5hbCBmdW5jdGlvbnMgYWdhaW5zdCByZS1lbnRyeSBpbnRvDQogICAgLy8gICAgIGFueSBvZiB0aGVtIChzZWUgUmVlbnRyeVByb3RlY3Rvck1peGluKTsNCiAgICAvLyAgIC0gcHJvZ3JhbSB2ZXJ5IGRlZmVuc2l2ZWx5IChlLmcuIGRlYml0IGJhbGFuY2UgYmVmb3JlIHNlbmQpLg0KICAgIC8vDQogICAgLy8gMikgRGVzdGluYXRpb24gZmFsbGJhY2sgZnVuY3Rpb24gY2FuIGZhaWwuDQogICAgLy8gIElmIHRoZSBkZXN0aW5hdGlvbiBjb250cmFjdCdzIGZhbGxiYWNrIGZ1bmN0aW9uIGZhaWxzLCBldGhlcg0KICAgIC8vICB3aWxsIG5vdCBiZSBzZW50IGFuZCBtYXkgYmUgbG9ja2VkIGludG8gdGhlIHNlbmRpbmcgY29udHJhY3QuDQogICAgLy8gIFVubGlrZSBtb3N0IGVycm9ycywgaXQgd2lsbCBOT1QgY2F1c2UgdGhpcyBjb250cmFjdCB0byB0aHJvdy4NCiAgICAvLyAgTWl0aWdhdGlvbnM6DQogICAgLy8gICAtIGNoZWNrIHRoZSByZXR1cm4gdmFsdWUgZnJvbSB0aGlzIGZ1bmN0aW9uIChzZWUgYmVsb3cpLg0KICAgIC8vDQogICAgLy8gMykgR2FzIHVzYWdlLg0KICAgIC8vICBUaGUgZGVzdGluYXRpb24gZmFsbGJhY2sgZnVuY3Rpb24gd2lsbCBjb25zdW1lIHRoZSBnYXMgc3VwcGxpZWQNCiAgICAvLyAgaW4gdGhpcyB0cmFuc2FjdGlvbiAod2hpY2ggaXMgZml4ZWQgYW5kIHNldCBieSB0aGUgdHJhbnNhY3Rpb24NCiAgICAvLyAgc3RhcnRlciwgdGhvdWdoIHNvbWUgY2xpZW50cyBkbyBhIGdvb2Qgam9iIG9mIGVzdGltYXRpbmcgaXQuDQogICAgLy8gIFRoaXMgaXMgYSBwcm9ibGVtIGZvciBsb3R0ZXJ5LXR5cGUgY29udHJhY3RzIHdoZXJlIG9uZSB2ZXJ5DQogICAgLy8gIGV4cGVuc2l2ZS10by1jYWxsIHJlY2VpdmluZyBjb250cmFjdCBjb3VsZCAncG9pc29uJyB0aGUgbG90dGVyeQ0KICAgIC8vICBjb250cmFjdCBieSBwcmV2ZW50aW5nIGl0IGJlaW5nIGludm9rZWQgYnkgYW5vdGhlciBwZXJzb24gd2hvDQogICAgLy8gIGNhbm5vdCBzdXBwbHkgZW5vdWdoIGdhcy4NCiAgICAvLyAgTWl0aWdhdGlvbnM6DQogICAgLy8gICAgLSBjaG9vc2Ugc2Vuc2libGUgdmFsdWUgZm9yIF9leHRyYUdhc0luY2x1ZGVkIChieSBkZWZhdWx0DQogICAgLy8gICAgICBvbmx5IDIzMDAgZ2FzIGlzIHN1cHBsaWVkIHRvIHRoZSBkZXN0aW5hdGlvbiBmdW5jdGlvbik7DQogICAgLy8gICAgLSBpZiBjYWxsIGZhaWxzIGNvbnNpZGVyIHdoZXRoZXIgdG8gdGhyb3cgb3IgdG8gcmluZy1mZW5jZQ0KICAgIC8vICAgICAgZnVuZHMgZm9yIGxhdGVyIHdpdGhkcmF3YWwuDQogICAgLy8NCiAgICAvLyBSZXR1cm5zOg0KICAgIC8vDQogICAgLy8gIFRydWUgaWYtYW5kLW9ubHktaWYgdGhlIHNlbmQgY2FsbCB3YXMgbWFkZSBhbmQgZGlkIG5vdCB0aHJvdw0KICAgIC8vICBhbiBlcnJvci4gSW4gdGhpcyBjYXNlLCB3ZSB3aWxsIG5vIGxvbmdlciBvd24gdGhlIF92YWx1ZVdlaQ0KICAgIC8vICBldGhlci4gTm90ZSB0aGF0IHdlIGNhbm5vdCBnZXQgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZmFsbGJhY2sNCiAgICAvLyAgZnVuY3Rpb24gY2FsbGVkIChpZiBhbnkpLg0KICAgIC8vDQogICAgLy8gIEZhbHNlIGlmIHRoZSBzZW5kIHdhcyBtYWRlIGJ1dCB0aGUgZGVzdGluYXRpb24gZmFsbGJhY2sgZnVuY3Rpb24NCiAgICAvLyAgdGhyZXcgYW4gZXJyb3IgKG9yIHJhbiBvdXQgb2YgZ2FzKS4gSWYgdGhpcyBoYXBlbnMsIHdlIHN0aWxsIG93bg0KICAgIC8vICBfdmFsdWVXZWkgZXRoZXIgYW5kIHRoZSBkZXN0aW5hdGlvbidzIGFjdGlvbnMgd2VyZSB1bmRvbmUuDQogICAgLy8NCiAgICAvLyAgVGhpcyBmdW5jdGlvbiBzaG91bGQgbm90IG5vcm1hbGx5IHRocm93IGFuIGVycm9yIHVubGVzczoNCiAgICAvLyAgICAtIG5vdCBlbm91Z2ggZ2FzIHRvIG1ha2UgdGhlIHNlbmQvY2FsbA0KICAgIC8vICAgIC0gbWF4IGNhbGwgc3RhY2sgZGVwdGggcmVhY2hlZA0KICAgIC8vICAgIC0gaW5zdWZmaWNpZW50IGV0aGVyDQogICAgLy8NCiAgICBmdW5jdGlvbiBjYXJlZnVsU2VuZFdpdGhGaXhlZEdhcygNCiAgICAgICAgYWRkcmVzcyBfdG9BZGRyZXNzLA0KICAgICAgICB1aW50IF92YWx1ZVdlaSwNCiAgICAgICAgdWludCBfZXh0cmFHYXNJbmNsdWRlZA0KICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIHJldHVybiBfdG9BZGRyZXNzLmNhbGwudmFsdWUoX3ZhbHVlV2VpKS5nYXMoX2V4dHJhR2FzSW5jbHVkZWQpKCk7DQogICAgfQ0KDQp9DQoNCg0KLy8vIEB0aXRsZSBNaXhpbiB0byBoZWxwIHRyYWNrIHdobyBvd25zIG91ciBldGhlciBhbmQgYWxsb3cgd2l0aGRyYXdhbHMuDQpjb250cmFjdCBGdW5kc0hvbGRlck1peGluIGlzIFJlZW50cnlQcm90ZWN0b3JNaXhpbiwgQ2FyZWZ1bFNlbmRlck1peGluIHsNCg0KICAgIC8vIFJlY29yZCBoZXJlIGhvdyBtdWNoIHdlaSBpcyBvd25lZCBieSBhbiBhZGRyZXNzLg0KICAgIC8vIE9idmlvdXNseSwgdGhlIGVudHJpZXMgaGVyZSBNVVNUIGJlIGJhY2tlZCBieSBhY3R1YWwgZXRoZXINCiAgICAvLyBvd25lZCBieSB0aGUgY29udHJhY3QgLSB3ZSBjYW5ub3QgZW5mb3JjZSB0aGF0IGluIHRoaXMgbWl4aW4uDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBmdW5kczsNCg0KICAgIGV2ZW50IEZ1bmRzV2l0aGRyYXduRXZlbnQoDQogICAgICAgIGFkZHJlc3MgZnJvbUFkZHJlc3MsDQogICAgICAgIGFkZHJlc3MgdG9BZGRyZXNzLA0KICAgICAgICB1aW50IHZhbHVlV2VpDQogICAgKTsNCg0KICAgIC8vLyBAbm90aWNlIEFtb3VudCBvZiBldGhlciBoZWxkIGZvciBgX2FkZHJlc3NgLg0KICAgIGZ1bmN0aW9uIGZ1bmRzT2YoYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAodWludCB2YWx1ZVdlaSkgew0KICAgICAgICByZXR1cm4gZnVuZHNbX2FkZHJlc3NdOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFNlbmQgdGhlIGNhbGxlciAoYG1zZy5zZW5kZXJgKSBhbGwgZXRoZXIgdGhleSBvd24uDQogICAgZnVuY3Rpb24gd2l0aGRyYXdGdW5kcygpIHsNCiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOw0KICAgICAgICB3aXRoZHJhd0Z1bmRzUlAoKTsNCiAgICAgICAgZXh0ZXJuYWxMZWF2ZSgpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFNlbmQgYF92YWx1ZVdlaWAgb2YgdGhlIGV0aGVyIG93bmVkIGJ5IHRoZSBjYWxsZXINCiAgICAvLy8gKGBtc2cuc2VuZGVyYCkgdG8gYF90b0FkZHJlc3NgLCBpbmNsdWRpbmcgYF9leHRyYUdhc2AgZ2FzDQogICAgLy8vIGJleW9uZCB0aGUgbm9ybWFsIHN0aXBlbmQuDQogICAgZnVuY3Rpb24gd2l0aGRyYXdGdW5kc0FkdmFuY2VkKA0KICAgICAgICBhZGRyZXNzIF90b0FkZHJlc3MsDQogICAgICAgIHVpbnQgX3ZhbHVlV2VpLA0KICAgICAgICB1aW50IF9leHRyYUdhcw0KICAgICkgew0KICAgICAgICBleHRlcm5hbEVudGVyKCk7DQogICAgICAgIHdpdGhkcmF3RnVuZHNBZHZhbmNlZFJQKF90b0FkZHJlc3MsIF92YWx1ZVdlaSwgX2V4dHJhR2FzKTsNCiAgICAgICAgZXh0ZXJuYWxMZWF2ZSgpOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IGludGVybmFsIHZlcnNpb24gb2Ygd2l0aGRyYXdGdW5kcygpDQogICAgZnVuY3Rpb24gd2l0aGRyYXdGdW5kc1JQKCkgaW50ZXJuYWwgew0KICAgICAgICBhZGRyZXNzIGZyb21BZGRyZXNzID0gbXNnLnNlbmRlcjsNCiAgICAgICAgYWRkcmVzcyB0b0FkZHJlc3MgPSBmcm9tQWRkcmVzczsNCiAgICAgICAgdWludCBhbGxBdmFpbGFibGVXZWkgPSBmdW5kc1tmcm9tQWRkcmVzc107DQogICAgICAgIHdpdGhkcmF3RnVuZHNBZHZhbmNlZFJQKA0KICAgICAgICAgICAgdG9BZGRyZXNzLA0KICAgICAgICAgICAgYWxsQXZhaWxhYmxlV2VpLA0KICAgICAgICAgICAgc3VnZ2VzdGVkRXh0cmFHYXNUb0luY2x1ZGVXaXRoU2VuZHMNCiAgICAgICAgKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBpbnRlcm5hbCB2ZXJzaW9uIG9mIHdpdGhkcmF3RnVuZHNBZHZhbmNlZCgpLCBhbHNvIHVzZWQNCiAgICAvLy8gYnkgd2l0aGRyYXdGdW5kc1JQKCkuDQogICAgZnVuY3Rpb24gd2l0aGRyYXdGdW5kc0FkdmFuY2VkUlAoDQogICAgICAgIGFkZHJlc3MgX3RvQWRkcmVzcywNCiAgICAgICAgdWludCBfdmFsdWVXZWksDQogICAgICAgIHVpbnQgX2V4dHJhR2FzSW5jbHVkZWQNCiAgICApIGludGVybmFsIHsNCiAgICAgICAgaWYgKG1zZy52YWx1ZSAhPSAwKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBhZGRyZXNzIGZyb21BZGRyZXNzID0gbXNnLnNlbmRlcjsNCiAgICAgICAgaWYgKF92YWx1ZVdlaSA+IGZ1bmRzW2Zyb21BZGRyZXNzXSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgZnVuZHNbZnJvbUFkZHJlc3NdIC09IF92YWx1ZVdlaTsNCiAgICAgICAgYm9vbCBzZW50T2sgPSBjYXJlZnVsU2VuZFdpdGhGaXhlZEdhcygNCiAgICAgICAgICAgIF90b0FkZHJlc3MsDQogICAgICAgICAgICBfdmFsdWVXZWksDQogICAgICAgICAgICBfZXh0cmFHYXNJbmNsdWRlZA0KICAgICAgICApOw0KICAgICAgICBpZiAoIXNlbnRPaykgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgRnVuZHNXaXRoZHJhd25FdmVudChmcm9tQWRkcmVzcywgX3RvQWRkcmVzcywgX3ZhbHVlV2VpKTsNCiAgICB9DQoNCn0NCg0KDQovLy8gQHRpdGxlIE1peGluIHRvIGhlbHAgbWFrZSBuaWNlciBsb29raW5nIGV0aGVyIGFtb3VudHMuDQpjb250cmFjdCBNb25leVJvdW5kZXJNaXhpbiB7DQoNCiAgICAvLy8gQG5vdGljZSBNYWtlIGBfcmF3VmFsdWVXZWlgIGludG8gYSBuaWNlciwgcm91bmRlciBudW1iZXIuDQogICAgLy8vIEByZXR1cm4gQSB2YWx1ZSB0aGF0Og0KICAgIC8vLyAgIC0gaXMgbm8gbGFyZ2VyIHRoYW4gYF9yYXdWYWx1ZVdlaWANCiAgICAvLy8gICAtIGlzIG5vIHNtYWxsZXIgdGhhbiBgX3Jhd1ZhbHVlV2VpYCAqIDAuOTk5DQogICAgLy8vICAgLSBoYXMgbm8gbW9yZSB0aGFuIHRocmVlIHNpZ25pZmljYW50IGZpZ3VyZXMgVU5MRVNTIHRoZQ0KICAgIC8vLyAgICAgbnVtYmVyIGlzIHZlcnkgc21hbGwgb3IgdmVyeSBsYXJnZSBpbiBtb25ldGFyeSB0ZXJtcw0KICAgIC8vLyAgICAgKHdoaWNoIHdlIGRlZmluZSBhcyA8IDEgZmlubmV5IG9yID4gMTAwMDAgZXRoZXIpLCBpbg0KICAgIC8vLyAgICAgd2hpY2ggY2FzZSBubyBwcmVjaXNpb24gd2lsbCBiZSBsb3N0Lg0KICAgIGZ1bmN0aW9uIHJvdW5kTW9uZXlEb3duTmljZWx5KHVpbnQgX3Jhd1ZhbHVlV2VpKSBjb25zdGFudCBpbnRlcm5hbA0KICAgIHJldHVybnMgKHVpbnQgbmljZXJWYWx1ZVdlaSkgew0KICAgICAgICBpZiAoX3Jhd1ZhbHVlV2VpIDwgMSBmaW5uZXkpIHsNCiAgICAgICAgICAgIHJldHVybiBfcmF3VmFsdWVXZWk7DQogICAgICAgIH0gZWxzZSBpZiAoX3Jhd1ZhbHVlV2VpIDwgMTAgZmlubmV5KSB7DQogICAgICAgICAgICByZXR1cm4gMTAgc3phYm8gKiAoX3Jhd1ZhbHVlV2VpIC8gMTAgc3phYm8pOw0KICAgICAgICB9IGVsc2UgaWYgKF9yYXdWYWx1ZVdlaSA8IDEwMCBmaW5uZXkpIHsNCiAgICAgICAgICAgIHJldHVybiAxMDAgc3phYm8gKiAoX3Jhd1ZhbHVlV2VpIC8gMTAwIHN6YWJvKTsNCiAgICAgICAgfSBlbHNlIGlmIChfcmF3VmFsdWVXZWkgPCAxIGV0aGVyKSB7DQogICAgICAgICAgICByZXR1cm4gMSBmaW5uZXkgKiAoX3Jhd1ZhbHVlV2VpIC8gMSBmaW5uZXkpOw0KICAgICAgICB9IGVsc2UgaWYgKF9yYXdWYWx1ZVdlaSA8IDEwIGV0aGVyKSB7DQogICAgICAgICAgICByZXR1cm4gMTAgZmlubmV5ICogKF9yYXdWYWx1ZVdlaSAvIDEwIGZpbm5leSk7DQogICAgICAgIH0gZWxzZSBpZiAoX3Jhd1ZhbHVlV2VpIDwgMTAwIGV0aGVyKSB7DQogICAgICAgICAgICByZXR1cm4gMTAwIGZpbm5leSAqIChfcmF3VmFsdWVXZWkgLyAxMDAgZmlubmV5KTsNCiAgICAgICAgfSBlbHNlIGlmIChfcmF3VmFsdWVXZWkgPCAxMDAwIGV0aGVyKSB7DQogICAgICAgICAgICByZXR1cm4gMSBldGhlciAqIChfcmF3VmFsdWVXZWkgLyAxIGV0aGVyKTsNCiAgICAgICAgfSBlbHNlIGlmIChfcmF3VmFsdWVXZWkgPCAxMDAwMCBldGhlcikgew0KICAgICAgICAgICAgcmV0dXJuIDEwIGV0aGVyICogKF9yYXdWYWx1ZVdlaSAvIDEwIGV0aGVyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBfcmF3VmFsdWVXZWk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgLy8vIEBub3RpY2UgQ29udmVydCBgX3ZhbHVlV2VpYCBpbnRvIGEgd2hvbGUgbnVtYmVyIG9mIGZpbm5leS4NCiAgICAvLy8gQHJldHVybiBUaGUgc21hbGxlc3Qgd2hvbGUgbnVtYmVyIG9mIGZpbm5leSB3aGljaCBpcyBlcXVhbA0KICAgIC8vLyB0byBvciBncmVhdGVyIHRoYW4gYF92YWx1ZVdlaWAgd2hlbiBjb252ZXJ0ZWQgdG8gd2VpLg0KICAgIC8vLyBXQVJOOiBNYXkgYmUgaW5jb3JyZWN0IGlmIGBfdmFsdWVXZWlgIGlzIGFib3ZlIDIqKjI1NC4NCiAgICBmdW5jdGlvbiByb3VuZE1vbmV5VXBUb1dob2xlRmlubmV5KHVpbnQgX3ZhbHVlV2VpKSBjb25zdGFudCBpbnRlcm5hbA0KICAgIHJldHVybnMgKHVpbnQgdmFsdWVGaW5uZXkpIHsNCiAgICAgICAgcmV0dXJuICgxIGZpbm5leSArIF92YWx1ZVdlaSAtIDEgd2VpKSAvIDEgZmlubmV5Ow0KICAgIH0NCg0KfQ0KDQoNCi8vLyBAdGl0bGUgTWl4aW4gdG8gaGVscCBhbGxvdyB1c2VycyB0byBuYW1lIHRoaW5ncy4NCmNvbnRyYWN0IE5hbWVhYmxlTWl4aW4gew0KDQogICAgLy8gU3RyaW5nIG1hbmlwdWxhdGlvbiBpcyBleHBlbnNpdmUgaW4gdGhlIEVWTTsga2VlcCB0aGluZ3Mgc2hvcnQuDQoNCiAgICB1aW50IGNvbnN0YW50IG1pbmltdW1OYW1lTGVuZ3RoID0gMTsNCiAgICB1aW50IGNvbnN0YW50IG1heGltdW1OYW1lTGVuZ3RoID0gMjU7DQogICAgc3RyaW5nIGNvbnN0YW50IG5hbWVEYXRhUHJlZml4ID0gIk5BTUU6IjsNCg0KICAgIC8vLyBAbm90aWNlIENoZWNrIGlmIGBfbmFtZWAgaXMgYSByZWFzb25hYmxlIGNob2ljZSBvZiBuYW1lLg0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYtYW5kLW9ubHktaWYgYF9uYW1lX2AgbWVldHMgdGhlIGNyaXRlcmlhDQogICAgLy8vIGJlbG93LCBvciBmYWxzZSBvdGhlcndpc2U6DQogICAgLy8vICAgLSBubyBmZXdlciB0aGFuIDEgY2hhcmFjdGVyDQogICAgLy8vICAgLSBubyBtb3JlIHRoYW4gMjUgY2hhcmFjdGVycw0KICAgIC8vLyAgIC0gbm8gY2hhcmFjdGVycyBvdGhlciB0aGFuOg0KICAgIC8vLyAgICAgLSAicm9tYW4iIGFscGhhYmV0IGxldHRlcnMgKEEtWiBhbmQgYS16KQ0KICAgIC8vLyAgICAgLSB3ZXN0ZXJuIGRpZ2l0cyAoMC05KQ0KICAgIC8vLyAgICAgLSAic2FmZSIgcHVuY3R1YXRpb246ICEgKCApIC0gLiBfIFNQQUNFDQogICAgLy8vICAgLSBhdCBsZWFzdCBvbmUgbm9uLXB1bmN0dWF0aW9uIGNoYXJhY3Rlcg0KICAgIC8vLyBOb3RlIHRoYXQgd2UgZGVsaWJlcmF0ZWx5IGV4Y2x1ZGUgY2hhcmFjdGVycyB3aGljaCBtYXkgY2F1c2UNCiAgICAvLy8gc2VjdXJpdHkgcHJvYmxlbXMgZm9yIHdlYnNpdGVzIGFuZCBkYXRhYmFzZXMgaWYgZXNjYXBpbmcgaXMNCiAgICAvLy8gbm90IHBlcmZvcm1lZCBjb3JyZWN0bHksIHN1Y2ggYXMgPCA+ICIgYW5kICcuDQogICAgLy8vIEFwb2xvZ2llcyBmb3IgdGhlIGxhY2sgb2Ygbm9uLUVuZ2xpc2ggbGFuZ3VhZ2Ugc3VwcG9ydC4NCiAgICBmdW5jdGlvbiB2YWxpZGF0ZU5hbWVJbnRlcm5hbChzdHJpbmcgX25hbWUpIGNvbnN0YW50IGludGVybmFsDQogICAgcmV0dXJucyAoYm9vbCBhbGxvd2VkKSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBuYW1lQnl0ZXMgPSBieXRlcyhfbmFtZSk7DQogICAgICAgIHVpbnQgbGVuZ3RoQnl0ZXMgPSBuYW1lQnl0ZXMubGVuZ3RoOw0KICAgICAgICBpZiAobGVuZ3RoQnl0ZXMgPCBtaW5pbXVtTmFtZUxlbmd0aCB8fA0KICAgICAgICAgICAgbGVuZ3RoQnl0ZXMgPiBtYXhpbXVtTmFtZUxlbmd0aCkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGJvb2wgZm91bmROb25QdW5jdHVhdGlvbiA9IGZhbHNlOw0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW5ndGhCeXRlczsgaSsrKSB7DQogICAgICAgICAgICBieXRlIGIgPSBuYW1lQnl0ZXNbaV07DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgKGIgPj0gNDggJiYgYiA8PSA1NykgfHwgLy8gMCAtIDkNCiAgICAgICAgICAgICAgICAoYiA+PSA2NSAmJiBiIDw9IDkwKSB8fCAvLyBBIC0gWg0KICAgICAgICAgICAgICAgIChiID49IDk3ICYmIGIgPD0gMTIyKSAgIC8vIGEgLSB6DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICBmb3VuZE5vblB1bmN0dWF0aW9uID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICBiID09IDMyIHx8IC8vIHNwYWNlDQogICAgICAgICAgICAgICAgYiA9PSAzMyB8fCAvLyAhDQogICAgICAgICAgICAgICAgYiA9PSA0MCB8fCAvLyAoDQogICAgICAgICAgICAgICAgYiA9PSA0MSB8fCAvLyApDQogICAgICAgICAgICAgICAgYiA9PSA0NSB8fCAvLyAtDQogICAgICAgICAgICAgICAgYiA9PSA0NiB8fCAvLyAuDQogICAgICAgICAgICAgICAgYiA9PSA5NSAgICAvLyBfDQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZm91bmROb25QdW5jdHVhdGlvbjsNCiAgICB9DQoNCiAgICAvLyBFeHRyYWN0IGEgbmFtZSBmcm9tIGJ5dGVzIGBfZGF0YWAgKHByZXN1bWFibHkgZnJvbSBgbXNnLmRhdGFgKSwNCiAgICAvLyBvciB0aHJvdyBhbiBleGNlcHRpb24gaWYgdGhlIGRhdGEgaXMgbm90IGluIHRoZSBleHBlY3RlZCBmb3JtYXQuDQogICAgLy8gDQogICAgLy8gV2Ugd2FudCB0byBtYWtlIGl0IGVhc3kgZm9yIHBlb3BsZSB0byBuYW1lIHRoaW5ncywgZXZlbiBpZg0KICAgIC8vIHRoZXkncmUgbm90IGNvbWZvcnRhYmxlIGNhbGxpbmcgZnVuY3Rpb25zIG9uIGNvbnRyYWN0cy4NCiAgICAvLw0KICAgIC8vIFNvIHdlIGFsbG93IG5hbWVzIHRvIGJlIHNlbnQgdG8gdGhlIGZhbGxiYWNrIGZ1bmN0aW9uIGVuY29kZWQNCiAgICAvLyBhcyBtZXNzYWdlIGRhdGEuDQogICAgLy8NCiAgICAvLyBVbmZvcnR1bmF0ZWx5LCB0aGUgd2F5IHRoZSBFdGhlcmV1bSBGdW5jdGlvbiBBQkkgd29ya3MgbWVhbnMgd2UNCiAgICAvLyBtdXN0IGJlIGNhcmVmdWwgdG8gYXZvaWQgY2xhc2hlcyBiZXR3ZWVuIG1lc3NhZ2UgZGF0YSB0aGF0DQogICAgLy8gcmVwcmVzZW50cyBvdXIgbmFtZXMgYW5kIG1lc3NhZ2UgZGF0YSB0aGF0IHJlcHJlc2VudHMgYSBjYWxsDQogICAgLy8gdG8gYW4gZXh0ZXJuYWwgZnVuY3Rpb24gLSBvdGhlcndpc2U6DQogICAgLy8gICBhKSBzb21lIG5hbWVzIHdvbid0IGJlIHVzYWJsZTsNCiAgICAvLyAgIGIpIHNtYWxsIHBvc3NpYmlsaXR5IG9mIGEgcGhpc2hpbmcgYXR0YWNrIHdoZXJlIHVzZXJzIGFyZQ0KICAgIC8vICAgICB0cmlja2VkIGludG8gdXNpbmcgY2VydGFpbiBuYW1lcyB3aGljaCBjYXVzZSBhbiBleHRlcm5hbA0KICAgIC8vICAgICBmdW5jdGlvbiBjYWxsIC0gZS5nLiBpZiB0aGUgZGF0YSBzZW50IHRvIHRoZSBjb250cmFjdCBpcw0KICAgIC8vICAgICBrZWNjYWsyNTYoIndpdGhkcmF3RnVuZHMoKSIpIHRoZW4gYSB3aXRoZHJhd2FsIHdpbGwgb2NjdXIuDQogICAgLy8NCiAgICAvLyBTbyB3ZSByZXF1aXJlIGEgcHJlZml4ICJOQU1FOiIgYXQgdGhlIHN0YXJ0IG9mIHRoZSBuYW1lIChlbmNvZGVkDQogICAgLy8gaW4gQVNDSUkpIHdoZW4gc2VudCB2aWEgdGhlIGZhbGxiYWNrIGZ1bmN0aW9uIC0gdGhpcyBwcmVmaXgNCiAgICAvLyBkb2Vzbid0IGNsYXNoIHdpdGggYW55IGV4dGVybmFsIGZ1bmN0aW9uIHNpZ25hdHVyZSBoYXNoZXMuDQogICAgLy8NCiAgICAvLyBlLmcuIHdlYjMuZnJvbUFzY2lpKCdOQU1FOicgKyAnSm9lIEJsb2dncycpDQogICAgLy8NCiAgICAvLyBXQVJOOiB0aGlzIGRvZXMgbm90IGNoZWNrIHRoZSBuYW1lIGZvciAicmVhc29uYWJsZW5lc3MiOw0KICAgIC8vIHVzZSB2YWxpZGF0ZU5hbWVJbnRlcm5hbCgpIGZvciB0aGF0Lg0KICAgIC8vDQogICAgZnVuY3Rpb24gZXh0cmFjdE5hbWVGcm9tRGF0YShieXRlcyBfZGF0YSkgY29uc3RhbnQgaW50ZXJuYWwNCiAgICByZXR1cm5zIChzdHJpbmcgZXh0cmFjdGVkTmFtZSkgew0KICAgICAgICAvLyBjaGVjayBwcmVmaXggcHJlc2VudA0KICAgICAgICB1aW50IGV4cGVjdGVkUHJlZml4TGVuZ3RoID0gKGJ5dGVzKG5hbWVEYXRhUHJlZml4KSkubGVuZ3RoOw0KICAgICAgICBpZiAoX2RhdGEubGVuZ3RoIDwgZXhwZWN0ZWRQcmVmaXhMZW5ndGgpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIHVpbnQgaTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGV4cGVjdGVkUHJlZml4TGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmICgoYnl0ZXMobmFtZURhdGFQcmVmaXgpKVtpXSAhPSBfZGF0YVtpXSkgew0KICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIGNvcHkgZGF0YSBhZnRlciBwcmVmaXgNCiAgICAgICAgdWludCBwYXlsb2FkTGVuZ3RoID0gX2RhdGEubGVuZ3RoIC0gZXhwZWN0ZWRQcmVmaXhMZW5ndGg7DQogICAgICAgIGlmIChwYXlsb2FkTGVuZ3RoIDwgbWluaW11bU5hbWVMZW5ndGggfHwNCiAgICAgICAgICAgIHBheWxvYWRMZW5ndGggPiBtYXhpbXVtTmFtZUxlbmd0aCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgc3RyaW5nIG1lbW9yeSBuYW1lID0gbmV3IHN0cmluZyhwYXlsb2FkTGVuZ3RoKTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBheWxvYWRMZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgKGJ5dGVzKG5hbWUpKVtpXSA9IF9kYXRhW2V4cGVjdGVkUHJlZml4TGVuZ3RoICsgaV07DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5hbWU7DQogICAgfQ0KDQogICAgLy8gVHVybiBhIHNob3J0IG5hbWUgaW50byBhICJmdXp6eSBoYXNoIiB3aXRoIHRoZSBwcm9wZXJ0eQ0KICAgIC8vIHRoYXQgZXh0cmVtZWx5IHNpbWlsYXIgbmFtZXMgd2lsbCBoYXZlIHRoZSBzYW1lIGZ1enp5IGhhc2guDQogICAgLy8NCiAgICAvLyBUaGlzIGlzIHVzZWZ1bCB0bzoNCiAgICAvLyAgLSBzdG9wIHBlb3BsZSBjaG9vc2luZyBuYW1lcyB3aGljaCBkaWZmZXIgb25seSBpbiBjYXNlIG9yDQogICAgLy8gICAgcHVuY3R1YXRpb24gYW5kIHdvdWxkIGxlYWQgdG8gY29uZnVzaW9uLg0KICAgIC8vICAtIGZhY2lsaWF0ZSBzZWFyY2hpbmcgYnkgbmFtZSB3aXRob3V0IG5lZWRpbmcgZXhhY3QgbWF0Y2gNCiAgICAvLw0KICAgIC8vIEZvciBleGFtcGxlLCB0aGVzZSBuYW1lcyBhbGwgaGF2ZSB0aGUgc2FtZSBmdXp6eSBoYXNoOg0KICAgIC8vDQogICAgLy8gICJCYW5hbmEiDQogICAgLy8gICJCQU5BTkEiDQogICAgLy8gICJCYS1uYS1uYSINCiAgICAvLyAgIiAgYmFuYW5hICAiDQogICAgLy8gICJCYW5hbmEgICAgICAgICAgICAgICAgICAgICAgICAuLiBzbyBsb25nIHRoZSBlbmQgaXMgaWdub3JlZCINCiAgICAvLw0KICAgIC8vIE9uIHRoZSBvdGhlciBoYW5kLCAiQmFuYW5hMSIgYW5kICJBIEJhbmFuYSIgYXJlIGRpZmZlcmVudCB0bw0KICAgIC8vIHRoZSBhYm92ZS4NCiAgICAvLw0KICAgIC8vIFdBUk46IHRoaXMgaXMgbGlrZWx5IHRvIHdvcmsgcG9vcmx5IG9uIG5hbWVzIHRoYXQgZG8gbm90IG1lZXQNCiAgICAvLyB0aGUgdmFsaWRhdGVOYW1lSW50ZXJuYWwoKSB0ZXN0Lg0KICAgIC8vDQogICAgZnVuY3Rpb24gY29tcHV0ZU5hbWVGdXp6eUhhc2goc3RyaW5nIF9uYW1lKSBjb25zdGFudCBpbnRlcm5hbA0KICAgIHJldHVybnMgKHVpbnQgZnV6enlIYXNoKSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBuYW1lQnl0ZXMgPSBieXRlcyhfbmFtZSk7DQogICAgICAgIHVpbnQgaCA9IDA7DQogICAgICAgIHVpbnQgbGVuID0gbmFtZUJ5dGVzLmxlbmd0aDsNCiAgICAgICAgaWYgKGxlbiA+IG1heGltdW1OYW1lTGVuZ3RoKSB7DQogICAgICAgICAgICBsZW4gPSBtYXhpbXVtTmFtZUxlbmd0aDsNCiAgICAgICAgfQ0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgICAgICAgdWludCBtdWwgPSAxMjg7DQogICAgICAgICAgICBieXRlIGIgPSBuYW1lQnl0ZXNbaV07DQogICAgICAgICAgICB1aW50IHViID0gdWludChiKTsNCiAgICAgICAgICAgIGlmIChiID49IDQ4ICYmIGIgPD0gNTcpIHsNCiAgICAgICAgICAgICAgICAvLyAwLTkNCiAgICAgICAgICAgICAgICBoID0gaCAqIG11bCArIHViOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChiID49IDY1ICYmIGIgPD0gOTApIHsNCiAgICAgICAgICAgICAgICAvLyBBLVoNCiAgICAgICAgICAgICAgICBoID0gaCAqIG11bCArIHViOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChiID49IDk3ICYmIGIgPD0gMTIyKSB7DQogICAgICAgICAgICAgICAgLy8gZm9sZCBhLXogdG8gQS1aDQogICAgICAgICAgICAgICAgdWludCB1cHBlciA9IHViIC0gMzI7DQogICAgICAgICAgICAgICAgaCA9IGggKiBtdWwgKyB1cHBlcjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gaWdub3JlIG90aGVycw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBoOw0KICAgIH0NCg0KfQ0KDQoNCi8vLyBAdGl0bGUgTWl4aW4gdG8gaGVscCBkZWZpbmUgdGhlIHJ1bGVzIG9mIGEgdGhyb25lLg0KY29udHJhY3QgVGhyb25lUnVsZXNNaXhpbiB7DQoNCiAgICAvLyBTZWUgV29ybGQuY3JlYXRlS2luZ2RvbSguLikgZm9yIGRvY3VtZW50YXRpb24uDQogICAgc3RydWN0IFRocm9uZVJ1bGVzIHsNCiAgICAgICAgdWludCBzdGFydGluZ0NsYWltUHJpY2VXZWk7DQogICAgICAgIHVpbnQgbWF4aW11bUNsYWltUHJpY2VXZWk7DQogICAgICAgIHVpbnQgY2xhaW1QcmljZUFkanVzdFBlcmNlbnQ7DQogICAgICAgIHVpbnQgY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzOw0KICAgICAgICB1aW50IGNvbW1pc3Npb25QZXJUaG91c2FuZDsNCiAgICB9DQoNCn0NCg0KDQovLy8gQHRpdGxlIE1haW50YWlucyB0aGUgdGhyb25lIG9mIGEga2luZ2RvbS4NCmNvbnRyYWN0IEtpbmdkb20gaXMNCiAgUmVlbnRyeVByb3RlY3Rvck1peGluLA0KICBDYXJlZnVsU2VuZGVyTWl4aW4sDQogIEZ1bmRzSG9sZGVyTWl4aW4sDQogIE1vbmV5Um91bmRlck1peGluLA0KICBOYW1lYWJsZU1peGluLA0KICBUaHJvbmVSdWxlc01peGluIHsNCg0KICAgIC8vIGUuZy4gIktpbmcgb2YgdGhlIEV0aGVyIg0KICAgIHN0cmluZyBwdWJsaWMga2luZ2RvbU5hbWU7DQoNCiAgICAvLyBUaGUgV29ybGQgY29udHJhY3QgdXNlZCB0byBjcmVhdGUgdGhpcyBraW5nZG9tLCBvciAweDAgaWYgbm9uZS4NCiAgICBhZGRyZXNzIHB1YmxpYyB3b3JsZDsNCg0KICAgIC8vIFRoZSBydWxlcyB0aGF0IGdvdmVybiB0aGlzIGtpbmdkb20gLSBzZWUgVGhyb25lUnVsZXNNaXhpbi4NCiAgICBUaHJvbmVSdWxlcyBwdWJsaWMgcnVsZXM7DQoNCiAgICAvLyBTb21lb25lIHdobyBoYXMgcnVsZWQgKG9yIGlzIHJ1bGluZykgb3VyIGtpbmdkb20uDQogICAgc3RydWN0IE1vbmFyY2ggew0KICAgICAgICAvLyB3aGVyZSB0byBzZW5kIHRoZWlyIGNvbXBlbnNhdGlvbg0KICAgICAgICBhZGRyZXNzIGNvbXBlbnNhdGlvbkFkZHJlc3M7DQogICAgICAgIC8vIHRoZWlyIG5hbWUNCiAgICAgICAgc3RyaW5nIG5hbWU7DQogICAgICAgIC8vIHdoZW4gdGhleSBiZWNhbWUgb3VyIHJ1bGVyDQogICAgICAgIHVpbnQgY29yb25hdGlvblRpbWVzdGFtcDsNCiAgICAgICAgLy8gdGhlIGNsYWltIHByaWNlIHBhaWQgKGV4Y2x1ZGluZyBhbnkgb3Zlci1wYXltZW50KQ0KICAgICAgICB1aW50IGNsYWltUHJpY2VXZWk7DQogICAgICAgIC8vIHRoZSBjb21wZW5zYXRpb24gc2VudCB0byBvciBoZWxkIGZvciB0aGVtIHNvIGZhcg0KICAgICAgICB1aW50IGNvbXBlbnNhdGlvbldlaTsNCiAgICB9DQoNCiAgICAvLyBUaGUgZmlyc3QgcnVsZXIgaXMgbnVtYmVyIDE7IHRoZSB6ZXJvLXRoIGVudHJ5IGlzIGEgZHVtbXkgZW50cnkuDQogICAgTW9uYXJjaFtdIHB1YmxpYyBtb25hcmNoc0J5TnVtYmVyOw0KDQogICAgLy8gVGhlIHRvcFdpemFyZCBlYXJucyBoYWxmIHRoZSBjb21taXNzaW9uLg0KICAgIC8vIFRoZXkgYXJlIG5vcm1hbGx5IHRoZSBvd25lciBvZiB0aGUgV29ybGQgY29udHJhY3QuDQogICAgYWRkcmVzcyBwdWJsaWMgdG9wV2l6YXJkOw0KDQogICAgLy8gVGhlIHN1YldpemFyZCBlYXJucyBoYWxmIHRoZSBjb21taXNzaW9uLg0KICAgIC8vIFRoZXkgYXJlIG5vcm1hbGx5IHRoZSBjcmVhdG9yIG9mIHRoaXMgS2luZ2RvbS4NCiAgICAvLyBUaGUgdG9wV2l6YXJkIGFuZCBzdWJXaXphcmQgY2FuIGJlIHRoZSBzYW1lIGFkZHJlc3MuDQogICAgYWRkcmVzcyBwdWJsaWMgc3ViV2l6YXJkOw0KDQogICAgLy8gTkI6IHdlIGFsc28gaGF2ZSBhIGBmdW5kc2AgbWFwcGluZyBmcm9tIEZ1bmRzSG9sZGVyTWl4aW4sDQogICAgLy8gYW5kIGEgcmVudHJ5UHJvdGVjdG9yIGZyb20gUmVlbnRyeVByb3RlY3Rvck1peGluLg0KDQogICAgZXZlbnQgVGhyb25lQ2xhaW1lZEV2ZW50KHVpbnQgbW9uYXJjaE51bWJlcik7DQogICAgZXZlbnQgQ29tcGVuc2F0aW9uU2VudEV2ZW50KGFkZHJlc3MgdG9BZGRyZXNzLCB1aW50IHZhbHVlV2VpKTsNCiAgICBldmVudCBDb21wZW5zYXRpb25GYWlsRXZlbnQoYWRkcmVzcyB0b0FkZHJlc3MsIHVpbnQgdmFsdWVXZWkpOw0KICAgIGV2ZW50IENvbW1pc3Npb25FYXJuZWRFdmVudChhZGRyZXNzIGJ5QWRkcmVzcywgdWludCB2YWx1ZVdlaSk7DQogICAgZXZlbnQgV2l6YXJkUmVwbGFjZWRFdmVudChhZGRyZXNzIG9sZFdpemFyZCwgYWRkcmVzcyBuZXdXaXphcmQpOw0KICAgIC8vIE5COiB3ZSBhbHNvIGhhdmUgYSBgRnVuZHNXaXRoZHJhd25FdmVudGAgZnJvbSBGdW5kc0hvbGRlck1peGluDQoNCiAgICAvLyBXQVJOIC0gZG9lcyBOT1QgdmFsaWRhdGUgYXJndW1lbnRzOyB5b3UgTVVTVCBlaXRoZXIgY2FsbA0KICAgIC8vIEtpbmdkb21GYWN0b3J5LnZhbGlkYXRlUHJvcG9zZWRUaHJvbmVSdWxlcygpIG9yIGNyZWF0ZQ0KICAgIC8vIHRoZSBLaW5nZG9tIHZpYSBLaW5nZG9tRmFjdG9yeS9Xb3JsZCdzIGNyZWF0ZUtpbmdkb20oKS4NCiAgICAvLyBTZWUgV29ybGQuY3JlYXRlS2luZ2RvbSguLikgZm9yIHBhcmFtZXRlciBkb2N1bWVudGF0aW9uLg0KICAgIGZ1bmN0aW9uIEtpbmdkb20oDQogICAgICAgIHN0cmluZyBfa2luZ2RvbU5hbWUsDQogICAgICAgIGFkZHJlc3MgX3dvcmxkLA0KICAgICAgICBhZGRyZXNzIF90b3BXaXphcmQsDQogICAgICAgIGFkZHJlc3MgX3N1YldpemFyZCwNCiAgICAgICAgdWludCBfc3RhcnRpbmdDbGFpbVByaWNlV2VpLA0KICAgICAgICB1aW50IF9tYXhpbXVtQ2xhaW1QcmljZVdlaSwNCiAgICAgICAgdWludCBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgIHVpbnQgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcywNCiAgICAgICAgdWludCBfY29tbWlzc2lvblBlclRob3VzYW5kDQogICAgKSB7DQogICAgICAgIGtpbmdkb21OYW1lID0gX2tpbmdkb21OYW1lOw0KICAgICAgICB3b3JsZCA9IF93b3JsZDsNCiAgICAgICAgdG9wV2l6YXJkID0gX3RvcFdpemFyZDsNCiAgICAgICAgc3ViV2l6YXJkID0gX3N1YldpemFyZDsNCiAgICAgICAgcnVsZXMgPSBUaHJvbmVSdWxlcygNCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLA0KICAgICAgICAgICAgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICAgICApOw0KICAgICAgICAvLyBXZSBudW1iZXIgdGhlIG1vbmFyY2hzIHN0YXJ0aW5nIGZyb20gMTsgaXQncyBzb21ldGltZXMgdXNlZnVsDQogICAgICAgIC8vIHRvIHVzZSB6ZXJvID0gaW52YWxpZCwgc28gcHV0IGluIGEgZHVtbXkgZW50cnkgZm9yIG51bWJlciAwLg0KICAgICAgICBtb25hcmNoc0J5TnVtYmVyLnB1c2goDQogICAgICAgICAgICBNb25hcmNoKA0KICAgICAgICAgICAgICAgIDAsDQogICAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICAgMCwNCiAgICAgICAgICAgICAgICAwLA0KICAgICAgICAgICAgICAgIDANCiAgICAgICAgICAgICkNCiAgICAgICAgKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBudW1iZXJPZk1vbmFyY2hzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCB0b3RhbENvdW50KSB7DQogICAgICAgIC8vIHplcm8tdGggZW50cnkgaXMgaW52YWxpZA0KICAgICAgICByZXR1cm4gbW9uYXJjaHNCeU51bWJlci5sZW5ndGggLSAxOw0KICAgIH0NCg0KICAgIC8vIEZhbHNlIGlmIGVpdGhlciB0aGVyZSBhcmUgbm8gbW9uYXJjaHMsIG9yIGlmIHRoZSBsYXRlc3QgbW9uYXJjaA0KICAgIC8vIGhhcyByZWlnbmVkIHRvbyBsb25nIGFuZCBiZWVuIHN0cnVjayBkb3duIGJ5IHRoZSBjdXJzZS4NCiAgICBmdW5jdGlvbiBpc0xpdmluZ01vbmFyY2goKSBjb25zdGFudCByZXR1cm5zIChib29sIGFsaXZlKSB7DQogICAgICAgIGlmIChudW1iZXJPZk1vbmFyY2hzKCkgPT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHVpbnQgcmVpZ25TdGFydGVkVGltZXN0YW1wID0gbGF0ZXN0TW9uYXJjaEludGVybmFsKCkuY29yb25hdGlvblRpbWVzdGFtcDsNCiAgICAgICAgaWYgKG5vdyA8IHJlaWduU3RhcnRlZFRpbWVzdGFtcCkgew0KICAgICAgICAgICAgLy8gU2hvdWxkIG5vdCBiZSBwb3NzaWJsZSwgdGhpbmsgbWluZXJzIHJlamVjdCBibG9ja3Mgd2l0aA0KICAgICAgICAgICAgLy8gdGltZXN0YW1wcyB0aGF0IGdvIGJhY2t3YXJkcz8gQnV0IHNvbWUgZHJpZnQgcG9zc2libGUgYW5kDQogICAgICAgICAgICAvLyBpdCBuZWVkcyBoYW5kbGluZyBmb3IgdW5zaWduZWQgb3ZlcmZsb3cgYXVkaXQgY2hlY2tzIC4uLg0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgdWludCBlbGFwc2VkUmVpZ25EdXJhdGlvblNlY29uZHMgPSBub3cgLSByZWlnblN0YXJ0ZWRUaW1lc3RhbXA7DQogICAgICAgIGlmIChlbGFwc2VkUmVpZ25EdXJhdGlvblNlY29uZHMgPiBydWxlcy5jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgSG93IG11Y2ggeW91IG11c3QgcGF5IHRvIGNsYWltIHRoZSB0aHJvbmUgbm93LCBpbiB3ZWkuDQogICAgZnVuY3Rpb24gY3VycmVudENsYWltUHJpY2VXZWkoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHByaWNlSW5XZWkpIHsNCiAgICAgICAgaWYgKCFpc0xpdmluZ01vbmFyY2goKSkgew0KICAgICAgICAgICAgcmV0dXJuIHJ1bGVzLnN0YXJ0aW5nQ2xhaW1QcmljZVdlaTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHVpbnQgbGFzdENsYWltUHJpY2VXZWkgPSBsYXRlc3RNb25hcmNoSW50ZXJuYWwoKS5jbGFpbVByaWNlV2VpOw0KICAgICAgICAgICAgLy8gbm8gZGFuZ2VyIG9mIG92ZXJmbG93IGJlY2F1c2UgY2xhaW0gcHJpY2UgbmV2ZXIgZ2V0cyB0aGF0IGhpZ2gNCiAgICAgICAgICAgIHVpbnQgbmV3Q2xhaW1QcmljZSA9DQogICAgICAgICAgICAgIChsYXN0Q2xhaW1QcmljZVdlaSAqICgxMDAgKyBydWxlcy5jbGFpbVByaWNlQWRqdXN0UGVyY2VudCkpIC8gMTAwOw0KICAgICAgICAgICAgbmV3Q2xhaW1QcmljZSA9IHJvdW5kTW9uZXlEb3duTmljZWx5KG5ld0NsYWltUHJpY2UpOw0KICAgICAgICAgICAgaWYgKG5ld0NsYWltUHJpY2UgPCBydWxlcy5zdGFydGluZ0NsYWltUHJpY2VXZWkpIHsNCiAgICAgICAgICAgICAgICBuZXdDbGFpbVByaWNlID0gcnVsZXMuc3RhcnRpbmdDbGFpbVByaWNlV2VpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG5ld0NsYWltUHJpY2UgPiBydWxlcy5tYXhpbXVtQ2xhaW1QcmljZVdlaSkgew0KICAgICAgICAgICAgICAgIG5ld0NsYWltUHJpY2UgPSBydWxlcy5tYXhpbXVtQ2xhaW1QcmljZVdlaTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBuZXdDbGFpbVByaWNlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgSG93IG11Y2ggeW91IG11c3QgcGF5IHRvIGNsYWltIHRoZSB0aHJvbmUgbm93LCBpbiBmaW5uZXkuDQogICAgZnVuY3Rpb24gY3VycmVudENsYWltUHJpY2VJbkZpbm5leSgpIGNvbnN0YW50DQogICAgcmV0dXJucyAodWludCBwcmljZUluRmlubmV5KSB7DQogICAgICAgIHVpbnQgdmFsdWVXZWkgPSBjdXJyZW50Q2xhaW1QcmljZVdlaSgpOw0KICAgICAgICByZXR1cm4gcm91bmRNb25leVVwVG9XaG9sZUZpbm5leSh2YWx1ZVdlaSk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYSBuYW1lIGNhbiBiZSB1c2VkIGFzIGEgbW9uYXJjaCBuYW1lLg0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIG5hbWUgc2F0aXNmaWVzIHRoZSBjcml0ZXJpYSBvZjoNCiAgICAvLy8gICAtIG5vIGZld2VyIHRoYW4gMSBjaGFyYWN0ZXINCiAgICAvLy8gICAtIG5vIG1vcmUgdGhhbiAyNSBjaGFyYWN0ZXJzDQogICAgLy8vICAgLSBubyBjaGFyYWN0ZXJzIG90aGVyIHRoYW46DQogICAgLy8vICAgICAtICJyb21hbiIgYWxwaGFiZXQgbGV0dGVycyAoQS1aIGFuZCBhLXopDQogICAgLy8vICAgICAtIHdlc3Rlcm4gZGlnaXRzICgwLTkpDQogICAgLy8vICAgICAtICJzYWZlIiBwdW5jdHVhdGlvbjogISAoICkgLSAuIF8gU1BBQ0UNCiAgICBmdW5jdGlvbiB2YWxpZGF0ZVByb3Bvc2VkTW9uYXJjaE5hbWUoc3RyaW5nIF9tb25hcmNoTmFtZSkgY29uc3RhbnQNCiAgICByZXR1cm5zIChib29sIGFsbG93ZWQpIHsNCiAgICAgICAgcmV0dXJuIHZhbGlkYXRlTmFtZUludGVybmFsKF9tb25hcmNoTmFtZSk7DQogICAgfQ0KDQogICAgLy8gR2V0IGRldGFpbHMgb2YgdGhlIGxhdGVzdCBtb25hcmNoIChldmVuIGlmIHRoZXkgYXJlIGRlYWQpLg0KICAgIC8vDQogICAgLy8gV2UgZG9uJ3QgZXhwb3NlIGV4dGVybmFsbHkgYmVjYXVzZSByZXR1cm5pbmcgc3RydWN0cyBpcyBub3Qgd2VsbA0KICAgIC8vIHN1cHBvcnRlZCBpbiB0aGUgQUJJIChzdHJhbmdlIHRoYXQgbW9uYXJjaHNCeU51bWJlciBhcnJheSB3b3Jrcw0KICAgIC8vIGZpbmUgdGhvdWdoKS4gTm90ZSB0aGF0IHRoZSByZWZlcmVuY2UgcmV0dXJuZWQgaXMgd3JpdGFibGUgLSBpdA0KICAgIC8vIGNhbiBiZSB1c2VkIHRvIHVwZGF0ZSBkZXRhaWxzIG9mIHRoZSBsYXRlc3QgbW9uYXJjaC4NCiAgICAvLyBXQVJOOiB5b3Ugc2hvdWxkIGNoZWNrIG51bWJlck9mTW9uYXJjaHMoKSA+IDAgZmlyc3QuDQogICAgZnVuY3Rpb24gbGF0ZXN0TW9uYXJjaEludGVybmFsKCkgY29uc3RhbnQgaW50ZXJuYWwNCiAgICByZXR1cm5zIChNb25hcmNoIHN0b3JhZ2UgbW9uYXJjaCkgew0KICAgICAgICByZXR1cm4gbW9uYXJjaHNCeU51bWJlclttb25hcmNoc0J5TnVtYmVyLmxlbmd0aCAtIDFdOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIENsYWltIHRocm9uZSBieSBzZW5kaW5nIGZ1bmRzIHRvIHRoZSBjb250cmFjdC4NCiAgICAvLy8gQW55IGZ1dHVyZSBjb21wZW5zYXRpb24gZWFybmVkIHdpbGwgYmUgc2VudCB0byB0aGUgc2VuZGVyJ3MNCiAgICAvLy8gYWRkcmVzcyAoYG1zZy5zZW5kZXJgKS4NCiAgICAvLy8gU2VuZGluZyBmcm9tIGEgY29udHJhY3QgaXMgbm90IHJlY29tbWVuZGVkIHVubGVzcyB5b3Uga25vdw0KICAgIC8vLyB3aGF0IHlvdSdyZSBkb2luZyAoYW5kIHlvdSd2ZSB0ZXN0ZWQgaXQpLg0KICAgIC8vLyBJZiBubyBtZXNzYWdlIGRhdGEgaXMgc3VwcGxpZWQsIHRoZSB0aHJvbmUgd2lsbCBiZSBjbGFpbWVkIGluDQogICAgLy8vIHRoZSBuYW1lIG9mICJBbm9ueW1vdXMiLiBUbyBzdXBwbHkgYSBuYW1lLCBzZW5kIGRhdGEgZW5jb2RlZA0KICAgIC8vLyB1c2luZyB3ZWIzLmZyb21Bc2NpaSgnTkFNRTonICsgJ3lvdXJfY2hvc2VuX3ZhbGlkX25hbWUnKS4NCiAgICAvLy8gU2VuZGVyIG11c3QgaW5jbHVkZSBwYXltZW50IGVxdWFsIHRvIGN1cnJlbnRDbGFpbVByaWNlV2VpKCkuDQogICAgLy8vIFdpbGwgY29uc3VtZSB1cCB0byB+MzAwLDAwMCBnYXMuDQogICAgLy8vIFdpbGwgdGhyb3cgYW4gZXJyb3IgaWY6DQogICAgLy8vICAgLSBuYW1lIGlzIGludmFsaWQgKHNlZSBgdmFsaWRhdGVQcm9wb3NlZE1vbmFyY2hOYW1lKHN0cmluZylgKQ0KICAgIC8vLyAgIC0gcGF5bWVudCBpcyB0b28gbG93IG9yIHRvbyBoaWdoDQogICAgLy8vIFByb2R1Y2VzIGV2ZW50czoNCiAgICAvLy8gICAtIGBUaHJvbmVDbGFpbWVkRXZlbnRgDQogICAgLy8vICAgLSBgQ29tcGVuc2F0aW9uU2VudEV2ZW50YCAvIGBDb21wZW5zYXRpb25GYWlsRXZlbnRgDQogICAgLy8vICAgLSBgQ29tbWlzc2lvbkVhcm5lZEV2ZW50YA0KICAgIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOw0KICAgICAgICBmYWxsYmFja1JQKCk7DQogICAgICAgIGV4dGVybmFsTGVhdmUoKTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBDbGFpbSB0aHJvbmUgaW4gdGhlIGdpdmVuIGBfbW9uYXJjaE5hbWVgLg0KICAgIC8vLyBBbnkgZnV0dXJlIGNvbXBlbnNhdGlvbiBlYXJuZWQgd2lsbCBiZSBzZW50IHRvIHRoZSBjYWxsZXIncw0KICAgIC8vLyBhZGRyZXNzIChgbXNnLnNlbmRlcmApLg0KICAgIC8vLyBDYWxsZXIgbXVzdCBpbmNsdWRlIHBheW1lbnQgZXF1YWwgdG8gY3VycmVudENsYWltUHJpY2VXZWkoKS4NCiAgICAvLy8gQ2FsbGluZyBmcm9tIGEgY29udHJhY3QgaXMgbm90IHJlY29tbWVuZGVkIHVubGVzcyB5b3Uga25vdw0KICAgIC8vLyB3aGF0IHlvdSdyZSBkb2luZyAoYW5kIHlvdSd2ZSB0ZXN0ZWQgaXQpLg0KICAgIC8vLyBXaWxsIGNvbnN1bWUgdXAgdG8gfjMwMCwwMDAgZ2FzLg0KICAgIC8vLyBXaWxsIHRocm93IGFuIGVycm9yIGlmOg0KICAgIC8vLyAgIC0gbmFtZSBpcyBpbnZhbGlkIChzZWUgYHZhbGlkYXRlUHJvcG9zZWRNb25hcmNoTmFtZShzdHJpbmcpYCkNCiAgICAvLy8gICAtIHBheW1lbnQgaXMgdG9vIGxvdyBvciB0b28gaGlnaA0KICAgIC8vLyBQcm9kdWNlcyBldmVudHM6DQogICAgLy8vICAgLSBgVGhyb25lQ2xhaW1lZEV2ZW50DQogICAgLy8vICAgLSBgQ29tcGVuc2F0aW9uU2VudEV2ZW50YCAvIGBDb21wZW5zYXRpb25GYWlsRXZlbnRgDQogICAgLy8vICAgLSBgQ29tbWlzc2lvbkVhcm5lZEV2ZW50YA0KICAgIGZ1bmN0aW9uIGNsYWltVGhyb25lKHN0cmluZyBfbW9uYXJjaE5hbWUpIHsNCiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOw0KICAgICAgICBjbGFpbVRocm9uZVJQKF9tb25hcmNoTmFtZSk7DQogICAgICAgIGV4dGVybmFsTGVhdmUoKTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBVc2VkIGJ5IGVpdGhlciB0aGUgdG9wV2l6YXJkIG9yIHN1YldpemFyZCB0byB0cmFuc2Zlcg0KICAgIC8vLyBhbGwgcmlnaHRzIHRvIGZ1dHVyZSBjb21taXNzaW9ucyB0byB0aGUgYF9yZXBsYWNlbWVudGAgd2l6YXJkLg0KICAgIC8vLyBXQVJOOiBUaGUgb3JpZ2luYWwgd2l6YXJkIHJldGFpbnMgb3duZXJzaGlwIG9mIGFueSBwYXN0DQogICAgLy8vIGNvbW1pc3Npb24gaGVsZCBmb3IgdGhlbSBpbiB0aGUgYGZ1bmRzYCBtYXBwaW5nLCB3aGljaCB0aGV5DQogICAgLy8vIGNhbiBzdGlsbCB3aXRoZHJhdy4NCiAgICAvLy8gUHJvZHVjZXMgZXZlbnQgV2l6YXJkUmVwbGFjZWRFdmVudC4NCiAgICBmdW5jdGlvbiByZXBsYWNlV2l6YXJkKGFkZHJlc3MgX3JlcGxhY2VtZW50KSB7DQogICAgICAgIGV4dGVybmFsRW50ZXIoKTsNCiAgICAgICAgcmVwbGFjZVdpemFyZFJQKF9yZXBsYWNlbWVudCk7DQogICAgICAgIGV4dGVybmFsTGVhdmUoKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBmYWxsYmFja1JQKCkgaW50ZXJuYWwgew0KICAgICAgICBpZiAobXNnLmRhdGEubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgIGNsYWltVGhyb25lUlAoIkFub255bW91cyIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc3RyaW5nIG1lbW9yeSBfbW9uYXJjaE5hbWUgPSBleHRyYWN0TmFtZUZyb21EYXRhKG1zZy5kYXRhKTsNCiAgICAgICAgICAgIGNsYWltVGhyb25lUlAoX21vbmFyY2hOYW1lKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBjbGFpbVRocm9uZVJQKA0KICAgICAgICBzdHJpbmcgX21vbmFyY2hOYW1lDQogICAgKSBpbnRlcm5hbCB7DQoNCiAgICAgICAgYWRkcmVzcyBfY29tcGVuc2F0aW9uQWRkcmVzcyA9IG1zZy5zZW5kZXI7DQoNCiAgICAgICAgaWYgKCF2YWxpZGF0ZU5hbWVJbnRlcm5hbChfbW9uYXJjaE5hbWUpKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChfY29tcGVuc2F0aW9uQWRkcmVzcyA9PSAwIHx8DQogICAgICAgICAgICBfY29tcGVuc2F0aW9uQWRkcmVzcyA9PSBhZGRyZXNzKHRoaXMpKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KDQogICAgICAgIHVpbnQgcGFpZFdlaSA9IG1zZy52YWx1ZTsNCiAgICAgICAgdWludCBwcmljZVdlaSA9IGN1cnJlbnRDbGFpbVByaWNlV2VpKCk7DQogICAgICAgIGlmIChwYWlkV2VpIDwgcHJpY2VXZWkpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIC8vIE1ha2UgaXQgZWFzeSBmb3IgcGVvcGxlIHRvIHBheSB1c2luZyBhIHdob2xlIG51bWJlciBvZiBmaW5uZXksDQogICAgICAgIC8vIHdoaWNoIGNvdWxkIGJlIGEgdGVlbnkgYml0IGhpZ2hlciB0aGFuIHRoZSByYXcgd2VpIHZhbHVlLg0KICAgICAgICB1aW50IGV4Y2Vzc1dlaSA9IHBhaWRXZWkgLSBwcmljZVdlaTsNCiAgICAgICAgaWYgKGV4Y2Vzc1dlaSA+IDEgZmlubmV5KSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgdWludCBjb21wZW5zYXRpb25XZWk7DQogICAgICAgIHVpbnQgY29tbWlzc2lvbldlaTsNCiAgICAgICAgaWYgKCFpc0xpdmluZ01vbmFyY2goKSkgew0KICAgICAgICAgICAgLy8gZGVhZCBtZW4gZ2V0IG5vIGNvbXBlbnNhdGlvbg0KICAgICAgICAgICAgY29tbWlzc2lvbldlaSA9IHBhaWRXZWk7DQogICAgICAgICAgICBjb21wZW5zYXRpb25XZWkgPSAwOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY29tbWlzc2lvbldlaSA9IChwYWlkV2VpICogcnVsZXMuY29tbWlzc2lvblBlclRob3VzYW5kKSAvIDEwMDA7DQogICAgICAgICAgICBjb21wZW5zYXRpb25XZWkgPSBwYWlkV2VpIC0gY29tbWlzc2lvbldlaTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChjb21taXNzaW9uV2VpICE9IDApIHsNCiAgICAgICAgICAgIHJlY29yZENvbW1pc3Npb25FYXJuZWQoY29tbWlzc2lvbldlaSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoY29tcGVuc2F0aW9uV2VpICE9IDApIHsNCiAgICAgICAgICAgIGNvbXBlbnNhdGVMYXRlc3RNb25hcmNoKGNvbXBlbnNhdGlvbldlaSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBJbiBjYXNlIG9mIGFueSB0ZWVueSBleGNlc3MsIHdlIHVzZSB0aGUgb2ZmaWNpYWwgcHJpY2UgaGVyZQ0KICAgICAgICAvLyBzaW5jZSB0aGF0IHNob3VsZCBkZXRlcm1pbmUgdGhlIG5ldyBjbGFpbSBwcmljZSwgbm90IHBhaWRXZWkuDQogICAgICAgIG1vbmFyY2hzQnlOdW1iZXIucHVzaChNb25hcmNoKA0KICAgICAgICAgICAgX2NvbXBlbnNhdGlvbkFkZHJlc3MsDQogICAgICAgICAgICBfbW9uYXJjaE5hbWUsDQogICAgICAgICAgICBub3csDQogICAgICAgICAgICBwcmljZVdlaSwNCiAgICAgICAgICAgIDANCiAgICAgICAgKSk7DQoNCiAgICAgICAgVGhyb25lQ2xhaW1lZEV2ZW50KG1vbmFyY2hzQnlOdW1iZXIubGVuZ3RoIC0gMSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcmVwbGFjZVdpemFyZFJQKGFkZHJlc3MgcmVwbGFjZW1lbnQpIGludGVybmFsIHsNCiAgICAgICAgaWYgKG1zZy52YWx1ZSAhPSAwKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBib29sIHJlcGxhY2VkT2sgPSBmYWxzZTsNCiAgICAgICAgYWRkcmVzcyBvbGRXaXphcmQ7DQogICAgICAgIGlmIChtc2cuc2VuZGVyID09IHRvcFdpemFyZCkgew0KICAgICAgICAgICAgb2xkV2l6YXJkID0gdG9wV2l6YXJkOw0KICAgICAgICAgICAgdG9wV2l6YXJkID0gcmVwbGFjZW1lbnQ7DQogICAgICAgICAgICBXaXphcmRSZXBsYWNlZEV2ZW50KG9sZFdpemFyZCwgcmVwbGFjZW1lbnQpOw0KICAgICAgICAgICAgcmVwbGFjZWRPayA9IHRydWU7DQogICAgICAgIH0NCiAgICAgICAgLy8gQ2FyZWZ1bCAtIHRvcFdpemFyZCBhbmQgc3ViV2l6YXJkIGNhbiBiZSB0aGUgc2FtZSBhZGRyZXNzLA0KICAgICAgICAvLyBpbiB3aGljaCBjYXNlIHdlIG11c3QgcmVwbGFjZSBib3RoLg0KICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBzdWJXaXphcmQpIHsNCiAgICAgICAgICAgIG9sZFdpemFyZCA9IHN1YldpemFyZDsNCiAgICAgICAgICAgIHN1YldpemFyZCA9IHJlcGxhY2VtZW50Ow0KICAgICAgICAgICAgV2l6YXJkUmVwbGFjZWRFdmVudChvbGRXaXphcmQsIHJlcGxhY2VtZW50KTsNCiAgICAgICAgICAgIHJlcGxhY2VkT2sgPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmICghcmVwbGFjZWRPaykgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBBbGxvdyBjb21taXNzaW9uIGZ1bmRzIHRvIGJ1aWxkIHVwIGluIGNvbnRyYWN0IGZvciB0aGUgd2l6YXJkcw0KICAgIC8vIHRvIHdpdGhkcmF3IChjYXJlZnVsbHkgcmluZy1mZW5jZWQpLg0KICAgIGZ1bmN0aW9uIHJlY29yZENvbW1pc3Npb25FYXJuZWQodWludCBfY29tbWlzc2lvbldlaSkgaW50ZXJuYWwgew0KICAgICAgICAvLyBnaXZlIHRoZSBzdWJXaXphcmQgYW55ICJvZGQiIHNpbmdsZSB3ZWkNCiAgICAgICAgdWludCB0b3BXaXphcmRXZWkgPSBfY29tbWlzc2lvbldlaSAvIDI7DQogICAgICAgIHVpbnQgc3ViV2l6YXJkV2VpID0gX2NvbW1pc3Npb25XZWkgLSB0b3BXaXphcmRXZWk7DQogICAgICAgIGZ1bmRzW3RvcFdpemFyZF0gKz0gdG9wV2l6YXJkV2VpOw0KICAgICAgICBDb21taXNzaW9uRWFybmVkRXZlbnQodG9wV2l6YXJkLCB0b3BXaXphcmRXZWkpOw0KICAgICAgICBmdW5kc1tzdWJXaXphcmRdICs9IHN1YldpemFyZFdlaTsNCiAgICAgICAgQ29tbWlzc2lvbkVhcm5lZEV2ZW50KHN1YldpemFyZCwgc3ViV2l6YXJkV2VpKTsNCiAgICB9DQoNCiAgICAvLyBTZW5kIGNvbXBlbnNhdGlvbiB0byBsYXRlc3QgbW9uYXJjaCAob3IgaG9sZCBmdW5kcyBmb3IgdGhlbQ0KICAgIC8vIGlmIGNhbm5vdCB0aHJvdWdoIG5vIGZhdWx0IG9mIGN1cnJlbnQgY2FsbGVyKS4NCiAgICBmdW5jdGlvbiBjb21wZW5zYXRlTGF0ZXN0TW9uYXJjaCh1aW50IF9jb21wZW5zYXRpb25XZWkpIGludGVybmFsIHsNCiAgICAgICAgYWRkcmVzcyBjb21wZW5zYXRpb25BZGRyZXNzID0NCiAgICAgICAgICBsYXRlc3RNb25hcmNoSW50ZXJuYWwoKS5jb21wZW5zYXRpb25BZGRyZXNzOw0KICAgICAgICAvLyByZWNvcmQgdGhhdCB3ZSBjb21wZW5zYXRlZCB0aGVtDQogICAgICAgIGxhdGVzdE1vbmFyY2hJbnRlcm5hbCgpLmNvbXBlbnNhdGlvbldlaSA9IF9jb21wZW5zYXRpb25XZWk7DQogICAgICAgIC8vIFdBUk46IGlmIHRoZSBsYXRlc3QgbW9uYXJjaCBpcyBhIGNvbnRyYWN0IHdob3NlIGZhbGxiYWNrDQogICAgICAgIC8vIGZ1bmN0aW9uIG5lZWRzIG1vcmUgMjUzMDAgZ2FzIHRoYW4gdGhlbiB0aGV5IHdpbGwgTk9UDQogICAgICAgIC8vIHJlY2VpdmUgY29tcGVuc2F0aW9uIGF1dG9tYXRpY2FsbHkuDQogICAgICAgIGJvb2wgc2VudE9rID0gY2FyZWZ1bFNlbmRXaXRoRml4ZWRHYXMoDQogICAgICAgICAgICBjb21wZW5zYXRpb25BZGRyZXNzLA0KICAgICAgICAgICAgX2NvbXBlbnNhdGlvbldlaSwNCiAgICAgICAgICAgIHN1Z2dlc3RlZEV4dHJhR2FzVG9JbmNsdWRlV2l0aFNlbmRzDQogICAgICAgICk7DQogICAgICAgIGlmIChzZW50T2spIHsNCiAgICAgICAgICAgIENvbXBlbnNhdGlvblNlbnRFdmVudChjb21wZW5zYXRpb25BZGRyZXNzLCBfY29tcGVuc2F0aW9uV2VpKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIFRoaXMgc2hvdWxkIG9ubHkgaGFwcGVuIGlmIHRoZSBsYXRlc3QgbW9uYXJjaCBpcyBhIGNvbnRyYWN0DQogICAgICAgICAgICAvLyB3aG9zZSBmYWxsYmFjay1mdW5jdGlvbiBmYWlsZWQgb3IgcmFuIG91dCBvZiBnYXMgKGRlc3BpdGUNCiAgICAgICAgICAgIC8vIHVzIGluY2x1ZGluZyBhIGZhaXIgYW1vdW50IG9mIGdhcykuDQogICAgICAgICAgICAvLyBXZSBkbyBub3QgdGhyb3cgc2luY2Ugd2UgZG8gbm90IHdhbnQgdGhlIHRocm9uZSB0byBnZXQNCiAgICAgICAgICAgIC8vICdzdHVjaycgKGl0J3Mgbm90IHRoZSBuZXcgdXN1cnBlcnMgZmF1bHQpIC0gaW5zdGVhZCBzYXZlDQogICAgICAgICAgICAvLyB0aGUgZnVuZHMgd2UgY291bGQgbm90IHNlbmQgc28gY2FuIGJlIGNsYWltZWQgbGF0ZXIuDQogICAgICAgICAgICAvLyBUaGVpciBtb25hcmNoIGNvbnRyYWN0IHdvdWxkIG5lZWQgdG8gaGF2ZSBiZWVuIGRlc2lnbmVkDQogICAgICAgICAgICAvLyB0byBjYWxsIG91ciB3aXRoZHJhd0Z1bmRzQWR2YW5jZWQoLi4pIGZ1bmN0aW9uIG1pbmQgeW91Lg0KICAgICAgICAgICAgZnVuZHNbY29tcGVuc2F0aW9uQWRkcmVzc10gKz0gX2NvbXBlbnNhdGlvbldlaTsNCiAgICAgICAgICAgIENvbXBlbnNhdGlvbkZhaWxFdmVudChjb21wZW5zYXRpb25BZGRyZXNzLCBfY29tcGVuc2F0aW9uV2VpKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KfQ0KDQoNCi8vLyBAdGl0bGUgVXNlZCBieSB0aGUgV29ybGQgY29udHJhY3QgdG8gY3JlYXRlIEtpbmdkb20gaW5zdGFuY2VzLg0KLy8vIEBkZXYgTW9zdGx5IGV4aXN0cyBzbyB0b3BXaXphcmQgY2FuIHBvdGVudGlhbGx5IHJlcGxhY2UgdGhpcw0KLy8vIGNvbnRyYWN0IHRvIG1vZGlmeSB0aGUgS2luZ2RvbSBjb250cmFjdCBhbmQvb3IgcnVsZSB2YWxpZGF0aW9uDQovLy8gbG9naWMgdG8gYmUgdXNlZCBmb3IgKmZ1dHVyZSogS2luZ2RvbXMgY3JlYXRlZCBieSB0aGUgV29ybGQuDQovLy8gV2UgZG8gbm90IGltcGxlbWVudCByZW50cnkgcHJvdGVjdGlvbiBiZWNhdXNlIHdlIGRvbid0IHNlbmQvY2FsbC4NCi8vLyBXZSBkbyBub3QgY2hhcmdlIGEgZmVlIGhlcmUgLSBidXQgaWYgeW91IGJ5cGFzcyB0aGUgV29ybGQgdGhlbg0KLy8vIHlvdSB3b24ndCBiZSBsaXN0ZWQgb24gdGhlIG9mZmljaWFsIFdvcmxkIHBhZ2Ugb2YgY291cnNlLg0KY29udHJhY3QgS2luZ2RvbUZhY3Rvcnkgew0KDQogICAgZnVuY3Rpb24gS2luZ2RvbUZhY3RvcnkoKSB7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gKCkgew0KICAgICAgICAvLyB0aGlzIGNvbnRyYWN0IHNob3VsZCBuZXZlciBoYXZlIGEgYmFsYW5jZQ0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyBTZWUgV29ybGQuY3JlYXRlS2luZ2RvbSguLikgZm9yIHBhcmFtZXRlciBkb2N1bWVudGF0aW9uLg0KICAgIGZ1bmN0aW9uIHZhbGlkYXRlUHJvcG9zZWRUaHJvbmVSdWxlcygNCiAgICAgICAgdWludCBfc3RhcnRpbmdDbGFpbVByaWNlV2VpLA0KICAgICAgICB1aW50IF9tYXhpbXVtQ2xhaW1QcmljZVdlaSwNCiAgICAgICAgdWludCBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgIHVpbnQgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcywNCiAgICAgICAgdWludCBfY29tbWlzc2lvblBlclRob3VzYW5kDQogICAgKSBjb25zdGFudCByZXR1cm5zIChib29sIGFsbG93ZWQpIHsNCiAgICAgICAgLy8gSSBzdXBwb3NlIHRoZXJlIGlzIGEgZGFuZ2VyIHRoYXQgbWFzc2l2ZSBkZWZsYXRpb24vaW5mbGF0aW9uIGNvdWxkDQogICAgICAgIC8vIGNoYW5nZSB0aGUgcmVhbC13b3JsZCBzYW5pdHkgb2YgdGhlc2UgY2hlY2tzLCBidXQgaW4gdGhhdCBjYXNlIHdlDQogICAgICAgIC8vIGNhbiBkZXBsb3kgYSBuZXcgZmFjdG9yeSBhbmQgdXBkYXRlIHRoZSB3b3JsZC4NCiAgICAgICAgaWYgKF9zdGFydGluZ0NsYWltUHJpY2VXZWkgPCAxIGZpbm5leSB8fA0KICAgICAgICAgICAgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSA+IDEwMCBldGhlcikgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmIChfbWF4aW11bUNsYWltUHJpY2VXZWkgPCAxIGV0aGVyIHx8DQogICAgICAgICAgICBfbWF4aW11bUNsYWltUHJpY2VXZWkgPiAxMDAwMDAgZXRoZXIpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSAqIDIwID4gX21heGltdW1DbGFpbVByaWNlV2VpKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudCA8IDEgfHwNCiAgICAgICAgICAgIF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudCA+IDkwMCkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmIChfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzIDwgMiBob3VycyB8fA0KICAgICAgICAgICAgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcyA+IDEwMDAwIGRheXMpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX2NvbW1pc3Npb25QZXJUaG91c2FuZCA8IDEwIHx8DQogICAgICAgICAgICBfY29tbWlzc2lvblBlclRob3VzYW5kID4gMTAwKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgQ3JlYXRlIGEgbmV3IEtpbmdkb20uIE5vcm1hbGx5IGNhbGxlZCBieSBXb3JsZCBjb250cmFjdC4NCiAgICAvLy8gV0FSTjogRG9lcyBOT1QgdmFsaWRhdGUgdGhlIF9raW5nZG9tTmFtZSBvciBfd29ybGQgYXJndW1lbnRzLg0KICAgIC8vLyBXaWxsIGNvbnN1bWUgdXAgdG8gMSw4MDAsMDAwIGdhcyAoISkNCiAgICAvLy8gV2lsbCB0aHJvdyBhbiBlcnJvciBpZjoNCiAgICAvLy8gICAtIHJ1bGVzIGludmFsaWQgKHNlZSB2YWxpZGF0ZVByb3Bvc2VkVGhyb25lUnVsZXMpDQogICAgLy8vICAgLSB3aXphcmQgYWRkcmVzc2VzICJvYnZpb3VzbHkiIHdyb25nDQogICAgLy8vICAgLSBvdXQgb2YgZ2FzIHF1aXRlIGxpa2VseSAocGVyaGFwcyBpbiBmdXR1cmUgc2hvdWxkIGNvbnNpZGVyDQogICAgLy8vICAgICB1c2luZyBzb2xpZGl0eSBsaWJyYXJpZXMgdG8gcmVkdWNlIEtpbmdkb20gc2l6ZT8pDQogICAgLy8gU2VlIFdvcmxkLmNyZWF0ZUtpbmdkb20oLi4pIGZvciBwYXJhbWV0ZXIgZG9jdW1lbnRhdGlvbi4NCiAgICBmdW5jdGlvbiBjcmVhdGVLaW5nZG9tKA0KICAgICAgICBzdHJpbmcgX2tpbmdkb21OYW1lLA0KICAgICAgICBhZGRyZXNzIF93b3JsZCwNCiAgICAgICAgYWRkcmVzcyBfdG9wV2l6YXJkLA0KICAgICAgICBhZGRyZXNzIF9zdWJXaXphcmQsDQogICAgICAgIHVpbnQgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwNCiAgICAgICAgdWludCBfbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgIHVpbnQgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICB1aW50IF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsDQogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICkgcmV0dXJucyAoS2luZ2RvbSBuZXdLaW5nZG9tKSB7DQogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKSB7DQogICAgICAgICAgICAvLyB0aGlzIGNvbnRyYWN0IHNob3VsZCBuZXZlciBoYXZlIGEgYmFsYW5jZQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgLy8gTkI6IHRvcFdpemFyZCBhbmQgc3ViV2l6YXJkIENBTiBiZSB0aGUgc2FtZSBhcyBlYWNoIG90aGVyLg0KICAgICAgICBpZiAoX3RvcFdpemFyZCA9PSAwIHx8IF9zdWJXaXphcmQgPT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF90b3BXaXphcmQgPT0gX3dvcmxkIHx8IF9zdWJXaXphcmQgPT0gX3dvcmxkKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXZhbGlkYXRlUHJvcG9zZWRUaHJvbmVSdWxlcygNCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLA0KICAgICAgICAgICAgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICAgICApKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbmV3IEtpbmdkb20oDQogICAgICAgICAgICBfa2luZ2RvbU5hbWUsDQogICAgICAgICAgICBfd29ybGQsDQogICAgICAgICAgICBfdG9wV2l6YXJkLA0KICAgICAgICAgICAgX3N1YldpemFyZCwNCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLA0KICAgICAgICAgICAgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICAgICApOw0KICAgIH0NCg0KfQ0KDQoNCi8vLyBAdGl0bGUgUnVucyB0aGUgd29ybGQsIHdoaWNoIGlzIGEgY29sbGVjdGlvbiBvZiBLaW5nZG9tcy4NCmNvbnRyYWN0IFdvcmxkIGlzDQogIFJlZW50cnlQcm90ZWN0b3JNaXhpbiwNCiAgTmFtZWFibGVNaXhpbiwNCiAgTW9uZXlSb3VuZGVyTWl4aW4sDQogIEZ1bmRzSG9sZGVyTWl4aW4sDQogIFRocm9uZVJ1bGVzTWl4aW4gew0KDQogICAgLy8gVGhlIHRvcFdpemFyZCBydW5zIHRoZSB3b3JsZC4gVGhleSBjaGFyZ2UgZm9yIHRoZSBjcmVhdGlvbiBvZg0KICAgIC8vIGtpbmdkb21zIGFuZCBiZWNvbWUgdGhlIHRvcFdpemFyZCBpbiBlYWNoIGtpbmdkb20gY3JlYXRlZC4NCiAgICBhZGRyZXNzIHB1YmxpYyB0b3BXaXphcmQ7DQoNCiAgICAvLyBIb3cgbXVjaCBvbmUgbXVzdCBwYXkgdG8gY3JlYXRlIGEgbmV3IGtpbmdkb20gKGluIHdlaSkuDQogICAgLy8gQ2FuIGJlIGNoYW5nZWQgYnkgdGhlIHRvcFdpemFyZC4NCiAgICB1aW50IHB1YmxpYyBraW5nZG9tQ3JlYXRpb25GZWVXZWk7DQoNCiAgICBzdHJ1Y3QgS2luZ2RvbUxpc3Rpbmcgew0KICAgICAgICB1aW50IGtpbmdkb21OdW1iZXI7DQogICAgICAgIHN0cmluZyBraW5nZG9tTmFtZTsNCiAgICAgICAgYWRkcmVzcyBraW5nZG9tQ29udHJhY3Q7DQogICAgICAgIGFkZHJlc3Mga2luZ2RvbUNyZWF0b3I7DQogICAgICAgIHVpbnQgY3JlYXRpb25UaW1lc3RhbXA7DQogICAgICAgIGFkZHJlc3Mga2luZ2RvbUZhY3RvcnlVc2VkOw0KICAgIH0NCiAgICANCiAgICAvLyBUaGUgZmlyc3Qga2luZ2RvbSBpcyBudW1iZXIgMTsgdGhlIHplcm8tdGggZW50cnkgaXMgYSBkdW1teS4NCiAgICBLaW5nZG9tTGlzdGluZ1tdIHB1YmxpYyBraW5nZG9tc0J5TnVtYmVyOw0KDQogICAgLy8gRm9yIHNhZmV0eSwgd2UgY2FwIGp1c3QgaG93IGhpZ2ggdGhlIHByaWNlIGNhbiBnZXQuDQogICAgLy8gQ2FuIGJlIGNoYW5nZWQgYnkgdGhlIHRvcFdpemFyZCwgdGhvdWdoIGl0IHdpbGwgb25seSBhZmZlY3QNCiAgICAvLyBraW5nZG9tcyBjcmVhdGVkIGFmdGVyIHRoYXQuDQogICAgdWludCBwdWJsaWMgbWF4aW11bUNsYWltUHJpY2VXZWk7DQoNCiAgICAvLyBIZWxwZXIgY29udHJhY3QgZm9yIGNyZWF0aW5nIEtpbmdkb20gaW5zdGFuY2VzLiBDYW4gYmUNCiAgICAvLyB1cGdyYWRlZCBieSB0aGUgdG9wV2l6YXJkICh3b24ndCBhZmZlY3QgZXhpc3Rpbmcgb25lcykuDQogICAgS2luZ2RvbUZhY3RvcnkgcHVibGljIGtpbmdkb21GYWN0b3J5Ow0KDQogICAgLy8gQXZvaWRzIGR1cGxpY2F0ZSBraW5nZG9tIG5hbWVzIGFuZCBhbGxvd3Mgc2VhcmNoaW5nIGJ5IG5hbWUuDQogICAgbWFwcGluZyAodWludCA9PiB1aW50KSBraW5nZG9tTnVtYmVyc0J5ZnV6enlIYXNoOw0KDQogICAgLy8gTkI6IHdlIGFsc28gaGF2ZSBhIGBmdW5kc2AgbWFwcGluZyBmcm9tIEZ1bmRzSG9sZGVyTWl4aW4sDQogICAgLy8gYW5kIGEgcmVudHJ5UHJvdGVjdG9yIGZyb20gUmVlbnRyeVByb3RlY3Rvck1peGluLg0KDQogICAgZXZlbnQgS2luZ2RvbUNyZWF0ZWRFdmVudCh1aW50IGtpbmdkb21OdW1iZXIpOw0KICAgIGV2ZW50IENyZWF0aW9uRmVlQ2hhbmdlZEV2ZW50KHVpbnQgbmV3RmVlV2VpKTsNCiAgICBldmVudCBGYWN0b3J5Q2hhbmdlZEV2ZW50KGFkZHJlc3MgbmV3RmFjdG9yeSk7DQogICAgZXZlbnQgV2l6YXJkUmVwbGFjZWRFdmVudChhZGRyZXNzIG9sZFdpemFyZCwgYWRkcmVzcyBuZXdXaXphcmQpOw0KICAgIC8vIE5COiB3ZSBhbHNvIGhhdmUgYSBgRnVuZHNXaXRoZHJhd25FdmVudGAgZnJvbSBGdW5kc0hvbGRlck1peGluDQoNCiAgICAvLyBDcmVhdGUgdGhlIHdvcmxkIHdpdGggbm8ga2luZ2RvbXMgeWV0Lg0KICAgIC8vIENvc3RzIGFib3V0IDEuOU0gZ2FzIHRvIGRlcGxveS4NCiAgICBmdW5jdGlvbiBXb3JsZCgNCiAgICAgICAgYWRkcmVzcyBfdG9wV2l6YXJkLA0KICAgICAgICB1aW50IF9raW5nZG9tQ3JlYXRpb25GZWVXZWksDQogICAgICAgIEtpbmdkb21GYWN0b3J5IF9raW5nZG9tRmFjdG9yeSwNCiAgICAgICAgdWludCBfbWF4aW11bUNsYWltUHJpY2VXZWkNCiAgICApIHsNCiAgICAgICAgaWYgKF90b3BXaXphcmQgPT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF9tYXhpbXVtQ2xhaW1QcmljZVdlaSA8IDEgZXRoZXIpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIHRvcFdpemFyZCA9IF90b3BXaXphcmQ7DQogICAgICAgIGtpbmdkb21DcmVhdGlvbkZlZVdlaSA9IF9raW5nZG9tQ3JlYXRpb25GZWVXZWk7DQogICAgICAgIGtpbmdkb21GYWN0b3J5ID0gX2tpbmdkb21GYWN0b3J5Ow0KICAgICAgICBtYXhpbXVtQ2xhaW1QcmljZVdlaSA9IF9tYXhpbXVtQ2xhaW1QcmljZVdlaTsNCiAgICAgICAgLy8gV2UgbnVtYmVyIHRoZSBraW5nZG9tcyBzdGFydGluZyBmcm9tIDEgc2luY2UgaXQncyBzb21ldGltZXMNCiAgICAgICAgLy8gdXNlZnVsIHRvIHVzZSB6ZXJvID0gaW52YWxpZC4gQ3JlYXRlIGR1bW15IHplcm8tdGggZW50cnkuDQogICAgICAgIGtpbmdkb21zQnlOdW1iZXIucHVzaChLaW5nZG9tTGlzdGluZygwLCAiIiwgMCwgMCwgMCwgMCkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG51bWJlck9mS2luZ2RvbXMoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHRvdGFsQ291bnQpIHsNCiAgICAgICAgcmV0dXJuIGtpbmdkb21zQnlOdW1iZXIubGVuZ3RoIC0gMTsNCiAgICB9DQoNCiAgICAvLy8gQHJldHVybiBpbmRleCBpbnRvIGtpbmdkb21zQnlOdW1iZXIgaWYgZm91bmQsIG9yIHplcm8gaWYgbm90LiANCiAgICBmdW5jdGlvbiBmaW5kS2luZ2RvbUNhbGxlZChzdHJpbmcgX2tpbmdkb21OYW1lKSBjb25zdGFudA0KICAgIHJldHVybnMgKHVpbnQga2luZ2RvbU51bWJlcikgew0KICAgICAgICB1aW50IGZ1enp5SGFzaCA9IGNvbXB1dGVOYW1lRnV6enlIYXNoKF9raW5nZG9tTmFtZSk7DQogICAgICAgIHJldHVybiBraW5nZG9tTnVtYmVyc0J5ZnV6enlIYXNoW2Z1enp5SGFzaF07DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYSBuYW1lIGNhbiBiZSB1c2VkIGFzIGEga2luZ2RvbSBuYW1lLg0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIG5hbWUgc2F0aXNmaWVzIHRoZSBjcml0ZXJpYSBvZjoNCiAgICAvLy8gICAtIG5vIGZld2VyIHRoYW4gMSBjaGFyYWN0ZXINCiAgICAvLy8gICAtIG5vIG1vcmUgdGhhbiAyNSBjaGFyYWN0ZXJzDQogICAgLy8vICAgLSBubyBjaGFyYWN0ZXJzIG90aGVyIHRoYW46DQogICAgLy8vICAgICAtICJyb21hbiIgYWxwaGFiZXQgbGV0dGVycyAoQS1aIGFuZCBhLXopDQogICAgLy8vICAgICAtIHdlc3Rlcm4gZGlnaXRzICgwLTkpDQogICAgLy8vICAgICAtICJzYWZlIiBwdW5jdHVhdGlvbjogISAoICkgLSAuIF8gU1BBQ0UNCiAgICAvLy8NCiAgICAvLy8gV0FSTjogZG9lcyBub3QgY2hlY2sgaWYgdGhlIG5hbWUgaXMgYWxyZWFkeSBpbiB1c2U7DQogICAgLy8vIHVzZSBgZmluZEtpbmdkb21DYWxsZWQoc3RyaW5nKWAgZm9yIHRoYXQgYWZ0ZXJ3YXJkcy4NCiAgICBmdW5jdGlvbiB2YWxpZGF0ZVByb3Bvc2VkS2luZ2RvbU5hbWUoc3RyaW5nIF9raW5nZG9tTmFtZSkgY29uc3RhbnQNCiAgICByZXR1cm5zIChib29sIGFsbG93ZWQpIHsNCiAgICAgICAgcmV0dXJuIHZhbGlkYXRlTmFtZUludGVybmFsKF9raW5nZG9tTmFtZSk7DQogICAgfQ0KDQogICAgLy8gQ2hlY2sgaWYgcnVsZXMgd291bGQgYmUgYWxsb3dlZCBmb3IgYSBuZXcgY3VzdG9tIEtpbmdkb20uDQogICAgLy8gVHlwaWNhbGx5IHVzZWQgYmVmb3JlIGNhbGxpbmcgYGNyZWF0ZUtpbmdkb20oLi4uKWAuDQogICAgZnVuY3Rpb24gdmFsaWRhdGVQcm9wb3NlZFRocm9uZVJ1bGVzKA0KICAgICAgICB1aW50IF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgIHVpbnQgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICB1aW50IF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsDQogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBhbGxvd2VkKSB7DQogICAgICAgIHJldHVybiBraW5nZG9tRmFjdG9yeS52YWxpZGF0ZVByb3Bvc2VkVGhyb25lUnVsZXMoDQogICAgICAgICAgICBfc3RhcnRpbmdDbGFpbVByaWNlV2VpLA0KICAgICAgICAgICAgbWF4aW11bUNsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLA0KICAgICAgICAgICAgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICAgICApOw0KICAgIH0NCg0KICAgIC8vIEhvdyBtdWNoIG9uZSBtdXN0IHBheSB0byBjcmVhdGUgYSBuZXcga2luZ2RvbSAoaW4gZmlubmV5KS4NCiAgICAvLyBDYW4gYmUgY2hhbmdlZCBieSB0aGUgdG9wV2l6YXJkLg0KICAgIGZ1bmN0aW9uIGtpbmdkb21DcmVhdGlvbkZlZUluRmlubmV5KCkgY29uc3RhbnQNCiAgICByZXR1cm5zICh1aW50IGZlZUluRmlubmV5KSB7DQogICAgICAgIHJldHVybiByb3VuZE1vbmV5VXBUb1dob2xlRmlubmV5KGtpbmdkb21DcmVhdGlvbkZlZVdlaSk7DQogICAgfQ0KDQogICAgLy8gUmVqZWN0IGZ1bmRzIHNlbnQgdG8gdGhlIGNvbnRyYWN0IC0gd2l6YXJkcyB3aG8gY2Fubm90IGludGVyYWN0DQogICAgLy8gd2l0aCBpdCB2aWEgdGhlIEFQSSB3b24ndCBiZSBhYmxlIHRvIHdpdGhkcmF3IHRoZWlyIGNvbW1pc3Npb24uDQogICAgZnVuY3Rpb24gKCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgYSBuZXcga2luZ2RvbSB1c2luZyBjdXN0b20gcnVsZXMuDQogICAgLy8vIEBwYXJhbSBfa2luZ2RvbU5hbWUgXA0KICAgIC8vLyAgIGUuZy4gIktpbmcgb2YgdGhlIEV0aGVyIFRocm9uZSINCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ0NsYWltUHJpY2VXZWkgXA0KICAgIC8vLyAgIEhvdyBtdWNoIGl0IHdpbGwgY29zdCB0aGUgZmlyc3QgbW9uYXJjaCB0byBjbGFpbSB0aGUgdGhyb25lDQogICAgLy8vICAgKGFuZCBhbHNvIHRoZSBwcmljZSBhZnRlciB0aGUgZGVhdGggb2YgYSBtb25hcmNoKS4NCiAgICAvLy8gQHBhcmFtIF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudCBcDQogICAgLy8vICAgUGVyY2VudGFnZSBpbmNyZWFzZSBhZnRlciBlYWNoIGNsYWltIC0gZS5nLiBpZiBjbGFpbSBwcmljZQ0KICAgIC8vLyAgIHdhcyAyMDAgRVRILCBhbmQgYF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudGAgaXMgNTAsIHRoZSBuZXh0DQogICAgLy8vICAgY2xhaW0gcHJpY2Ugd2lsbCBiZSAyMDAgRVRIICsgKDUwJSBvZiAyMDAgRVRIKSA9PiAzMDAgRVRILg0KICAgIC8vLyBAcGFyYW0gX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcyBcDQogICAgLy8vICAgVGhlIG1heGltdW0gbGVuZ3RoIG9mIGEgdGltZSBhIG1vbmFyY2ggY2FuIHJ1bGUgYmVmb3JlIHRoZQ0KICAgIC8vLyAgIGN1cnNlIHN0cmlrZXMgYW5kIHRoZXkgYXJlIHJlbW92ZWQgd2l0aG91dCBjb21wZW5zYXRpb24uDQogICAgLy8vIEBwYXJhbSBfY29tbWlzc2lvblBlclRob3VzYW5kIFwNCiAgICAvLy8gICBIb3cgbXVjaCBvZiBlYWNoIHBheW1lbnQgaXMgZ2l2ZW4gdG8gdGhlIHdpemFyZHMgdG8gc2hhcmUsDQogICAgLy8vICAgZXhwcmVzc2VkIGluIHBhcnRzIHBlciB0aG91c2FuZCAtIGUuZy4gMjUgbWVhbnMgMjUvMTAwMCwNCiAgICAvLy8gICBvciAyLjUlLg0KICAgIC8vLyANCiAgICAvLy8gQ2FsbGVyIG11c3QgaW5jbHVkZSBwYXltZW50IGVxdWFsIHRvIGtpbmdkb21DcmVhdGlvbkZlZVdlaS4NCiAgICAvLy8gVGhlIGNhbGxlciB3aWxsIGJlY29tZSB0aGUgJ3N1Yi13aXphcmQnIGFuZCB3aWxsIGVhcm4gaGFsZg0KICAgIC8vLyBhbnkgY29tbWlzc2lvbiBjaGFyZ2VkIGJ5IHRoZSBLaW5nZG9tLiAgTm90ZSBob3dldmVyIHRoZXkNCiAgICAvLy8gd2lsbCBuZWVkIHRvIGNhbGwgd2l0aGRyYXdGdW5kcygpIG9uIHRoZSBLaW5nZG9tIGNvbnRyYWN0DQogICAgLy8vIHRvIGdldCB0aGVpciBjb21taXNzaW9uIC0gaXQncyBub3Qgc2VuZCBhdXRvbWF0aWNhbGx5Lg0KICAgIC8vLw0KICAgIC8vLyBXaWxsIGNvbnN1bWUgdXAgdG8gMSw5MDAsMDAwIGdhcyAoISkNCiAgICAvLy8gV2lsbCB0aHJvdyBhbiBlcnJvciBpZjoNCiAgICAvLy8gICAtIG5hbWUgaXMgaW52YWxpZCAoc2VlIGB2YWxpZGF0ZVByb3Bvc2VkS2luZ2RvbU5hbWUoc3RyaW5nKWApDQogICAgLy8vICAgLSBuYW1lIGlzIGFscmVhZHkgaW4gdXNlIChzZWUgYGZpbmRLaW5nZG9tQ2FsbGVkKHN0cmluZylgKQ0KICAgIC8vLyAgIC0gcnVsZXMgYXJlIGludmFsaWQgKHNlZSBgdmFsaWRhdGVQcm9wb3NlZEtpbmdkb21SdWxlcyguLi4pYCkNCiAgICAvLy8gICAtIHBheW1lbnQgaXMgdG9vIGxvdyBvciB0b28gaGlnaA0KICAgIC8vLyAgIC0gaW5zdWZmaWNpZW50IGdhcyAocXVpdGUgbGlrZWx5ISkNCiAgICAvLy8gUHJvZHVjZXMgZXZlbnQgS2luZ2RvbUNyZWF0ZWRFdmVudC4NCiAgICBmdW5jdGlvbiBjcmVhdGVLaW5nZG9tKA0KICAgICAgICBzdHJpbmcgX2tpbmdkb21OYW1lLA0KICAgICAgICB1aW50IF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgIHVpbnQgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICB1aW50IF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsDQogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICkgew0KICAgICAgICBleHRlcm5hbEVudGVyKCk7DQogICAgICAgIGNyZWF0ZUtpbmdkb21SUCgNCiAgICAgICAgICAgIF9raW5nZG9tTmFtZSwNCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksDQogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLA0KICAgICAgICAgICAgX2NvbW1pc3Npb25QZXJUaG91c2FuZA0KICAgICAgICApOw0KICAgICAgICBleHRlcm5hbExlYXZlKCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVXNlZCBieSB0b3BXaXphcmQgdG8gdHJhbnNmZXIgYWxsIHJpZ2h0cyB0byBmdXR1cmUNCiAgICAvLy8gZmVlcyBhbmQgZnV0dXJlIGtpbmdkb20gd2l6YXJkc2hpcHMgdG8gYF9yZXBsYWNlbWVudGAgd2l6YXJkLg0KICAgIC8vLyBXQVJOOiBUaGUgb3JpZ2luYWwgd2l6YXJkIHJldGFpbnMgb3duZXJzaGlwIG9mIGFueSBwYXN0IGZlZXMNCiAgICAvLy8gaGVsZCBmb3IgdGhlbSBpbiB0aGUgYGZ1bmRzYCBtYXBwaW5nLCB3aGljaCB0aGV5IGNhbiBzdGlsbA0KICAgIC8vLyB3aXRoZHJhdy4gVGhleSBhbHNvIHJlbWFpbiB0b3BXaXphcmQgaW4gYW55IGV4aXN0aW5nIEtpbmdkb21zLg0KICAgIC8vLyBQcm9kdWNlcyBldmVudCBXaXphcmRSZXBsYWNlZEV2ZW50Lg0KICAgIGZ1bmN0aW9uIHJlcGxhY2VXaXphcmQoYWRkcmVzcyBfcmVwbGFjZW1lbnQpIHsNCiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOw0KICAgICAgICByZXBsYWNlV2l6YXJkUlAoX3JlcGxhY2VtZW50KTsNCiAgICAgICAgZXh0ZXJuYWxMZWF2ZSgpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFVzZWQgYnkgdG9wV2l6YXJkIHRvIHZhcnkgdGhlIGZlZSBmb3IgY3JlYXRpbmcga2luZ2RvbXMuDQogICAgZnVuY3Rpb24gc2V0S2luZ2RvbUNyZWF0aW9uRmVlV2VpKHVpbnQgX2tpbmdkb21DcmVhdGlvbkZlZVdlaSkgew0KICAgICAgICBleHRlcm5hbEVudGVyKCk7DQogICAgICAgIHNldEtpbmdkb21DcmVhdGlvbkZlZVdlaVJQKF9raW5nZG9tQ3JlYXRpb25GZWVXZWkpOw0KICAgICAgICBleHRlcm5hbExlYXZlKCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVXNlZCBieSB0b3BXaXphcmQgdG8gdmFyeSB0aGUgY2FwIG9uIGNsYWltIHByaWNlLg0KICAgIGZ1bmN0aW9uIHNldE1heGltdW1DbGFpbVByaWNlV2VpKHVpbnQgX21heGltdW1DbGFpbVByaWNlV2VpKSB7DQogICAgICAgIGV4dGVybmFsRW50ZXIoKTsNCiAgICAgICAgc2V0TWF4aW11bUNsYWltUHJpY2VXZWlSUChfbWF4aW11bUNsYWltUHJpY2VXZWkpOw0KICAgICAgICBleHRlcm5hbExlYXZlKCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVXNlZCBieSB0b3BXaXphcmQgdG8gdmFyeSB0aGUgZmFjdG9yeSBjb250cmFjdCB3aGljaA0KICAgIC8vLyB3aWxsIGJlIHVzZWQgdG8gY3JlYXRlIGZ1dHVyZSBLaW5nZG9tcy4NCiAgICBmdW5jdGlvbiBzZXRLaW5nZG9tRmFjdG9yeShLaW5nZG9tRmFjdG9yeSBfa2luZ2RvbUZhY3RvcnkpIHsNCiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOw0KICAgICAgICBzZXRLaW5nZG9tRmFjdG9yeVJQKF9raW5nZG9tRmFjdG9yeSk7DQogICAgICAgIGV4dGVybmFsTGVhdmUoKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjcmVhdGVLaW5nZG9tUlAoDQogICAgICAgIHN0cmluZyBfa2luZ2RvbU5hbWUsDQogICAgICAgIHVpbnQgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwNCiAgICAgICAgdWludCBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsDQogICAgICAgIHVpbnQgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcywNCiAgICAgICAgdWludCBfY29tbWlzc2lvblBlclRob3VzYW5kDQogICAgKSBpbnRlcm5hbCB7DQoNCiAgICAgICAgYWRkcmVzcyBzdWJXaXphcmQgPSBtc2cuc2VuZGVyOw0KDQogICAgICAgIGlmICghdmFsaWRhdGVOYW1lSW50ZXJuYWwoX2tpbmdkb21OYW1lKSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICB1aW50IG5ld0tpbmdkb21OdW1iZXIgPSBraW5nZG9tc0J5TnVtYmVyLmxlbmd0aDsNCiAgICAgICAgY2hlY2tVbmlxdWVBbmRSZWdpc3Rlck5ld0tpbmdkb21OYW1lKA0KICAgICAgICAgICAgX2tpbmdkb21OYW1lLA0KICAgICAgICAgICAgbmV3S2luZ2RvbU51bWJlcg0KICAgICAgICApOw0KDQogICAgICAgIHVpbnQgcGFpZFdlaSA9IG1zZy52YWx1ZTsNCiAgICAgICAgaWYgKHBhaWRXZWkgPCBraW5nZG9tQ3JlYXRpb25GZWVXZWkpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIC8vIE1ha2UgaXQgZWFzeSBmb3IgcGVvcGxlIHRvIHBheSB1c2luZyBhIHdob2xlIG51bWJlciBvZiBmaW5uZXksDQogICAgICAgIC8vIHdoaWNoIGNvdWxkIGJlIGEgdGVlbnkgYml0IGhpZ2hlciB0aGFuIHRoZSByYXcgd2VpIHZhbHVlLg0KICAgICAgICB1aW50IGV4Y2Vzc1dlaSA9IHBhaWRXZWkgLSBraW5nZG9tQ3JlYXRpb25GZWVXZWk7DQogICAgICAgIGlmIChleGNlc3NXZWkgPiAxIGZpbm5leSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgZnVuZHNbdG9wV2l6YXJkXSArPSBwYWlkV2VpOw0KICAgICAgICANCiAgICAgICAgLy8gVGhpcyB3aWxsIHBlcmZvcm0gcnVsZSB2YWxpZGF0aW9uLg0KICAgICAgICBLaW5nZG9tIGtpbmdkb21Db250cmFjdCA9IGtpbmdkb21GYWN0b3J5LmNyZWF0ZUtpbmdkb20oDQogICAgICAgICAgICBfa2luZ2RvbU5hbWUsDQogICAgICAgICAgICBhZGRyZXNzKHRoaXMpLA0KICAgICAgICAgICAgdG9wV2l6YXJkLA0KICAgICAgICAgICAgc3ViV2l6YXJkLA0KICAgICAgICAgICAgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwNCiAgICAgICAgICAgIG1heGltdW1DbGFpbVByaWNlV2VpLA0KICAgICAgICAgICAgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LA0KICAgICAgICAgICAgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcywNCiAgICAgICAgICAgIF9jb21taXNzaW9uUGVyVGhvdXNhbmQNCiAgICAgICAgKTsNCg0KICAgICAgICBraW5nZG9tc0J5TnVtYmVyLnB1c2goS2luZ2RvbUxpc3RpbmcoDQogICAgICAgICAgICBuZXdLaW5nZG9tTnVtYmVyLA0KICAgICAgICAgICAgX2tpbmdkb21OYW1lLA0KICAgICAgICAgICAga2luZ2RvbUNvbnRyYWN0LA0KICAgICAgICAgICAgbXNnLnNlbmRlciwNCiAgICAgICAgICAgIG5vdywNCiAgICAgICAgICAgIGtpbmdkb21GYWN0b3J5DQogICAgICAgICkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlcGxhY2VXaXphcmRSUChhZGRyZXNzIHJlcGxhY2VtZW50KSBpbnRlcm5hbCB7IA0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSB0b3BXaXphcmQpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIGlmIChtc2cudmFsdWUgIT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgYWRkcmVzcyBvbGRXaXphcmQgPSB0b3BXaXphcmQ7DQogICAgICAgIHRvcFdpemFyZCA9IHJlcGxhY2VtZW50Ow0KICAgICAgICBXaXphcmRSZXBsYWNlZEV2ZW50KG9sZFdpemFyZCwgcmVwbGFjZW1lbnQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldEtpbmdkb21DcmVhdGlvbkZlZVdlaVJQKHVpbnQgX2tpbmdkb21DcmVhdGlvbkZlZVdlaSkgaW50ZXJuYWwgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSB0b3BXaXphcmQpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIGlmIChtc2cudmFsdWUgIT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAga2luZ2RvbUNyZWF0aW9uRmVlV2VpID0gX2tpbmdkb21DcmVhdGlvbkZlZVdlaTsNCiAgICAgICAgQ3JlYXRpb25GZWVDaGFuZ2VkRXZlbnQoa2luZ2RvbUNyZWF0aW9uRmVlV2VpKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZXRNYXhpbXVtQ2xhaW1QcmljZVdlaVJQKHVpbnQgX21heGltdW1DbGFpbVByaWNlV2VpKSBpbnRlcm5hbCB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHRvcFdpemFyZCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF9tYXhpbXVtQ2xhaW1QcmljZVdlaSA8IDEgZXRoZXIpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIG1heGltdW1DbGFpbVByaWNlV2VpID0gX21heGltdW1DbGFpbVByaWNlV2VpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldEtpbmdkb21GYWN0b3J5UlAoS2luZ2RvbUZhY3RvcnkgX2tpbmdkb21GYWN0b3J5KSBpbnRlcm5hbCB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHRvcFdpemFyZCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG1zZy52YWx1ZSAhPSAwKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBraW5nZG9tRmFjdG9yeSA9IF9raW5nZG9tRmFjdG9yeTsNCiAgICAgICAgRmFjdG9yeUNoYW5nZWRFdmVudChraW5nZG9tRmFjdG9yeSk7DQogICAgfQ0KDQogICAgLy8gSWYgdGhlcmUgaXMgbm8gZXhpc3Rpbmcga2luZ2RvbSBjYWxsZWQgYF9raW5nZG9tTmFtZWAsIGNyZWF0ZQ0KICAgIC8vIGEgcmVjb3JkIG1hcHBpbmcgdGhhdCBuYW1lIHRvIGtpbmdkb20gbm8uIGBfbmV3S2luZ2RvbU51bWJlcmAuDQogICAgLy8gVGhyb3dzIGFuIGVycm9yIGlmIGFuIGV4aXN0aW5nIGtpbmdkb20gd2l0aCB0aGUgc2FtZSAob3INCiAgICAvLyBmdXp6aWx5IHNpbWlsYXIgLSBzZWUgY29tcHV0ZU5hbWVGdXp6eUhhc2gpIG5hbWUgZXhpc3RzLg0KICAgIGZ1bmN0aW9uIGNoZWNrVW5pcXVlQW5kUmVnaXN0ZXJOZXdLaW5nZG9tTmFtZSgNCiAgICAgICAgc3RyaW5nIF9raW5nZG9tTmFtZSwNCiAgICAgICAgdWludCBfbmV3S2luZ2RvbU51bWJlcg0KICAgICkgaW50ZXJuYWwgew0KICAgICAgICB1aW50IGZ1enp5SGFzaCA9IGNvbXB1dGVOYW1lRnV6enlIYXNoKF9raW5nZG9tTmFtZSk7DQogICAgICAgIGlmIChraW5nZG9tTnVtYmVyc0J5ZnV6enlIYXNoW2Z1enp5SGFzaF0gIT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAga2luZ2RvbU51bWJlcnNCeWZ1enp5SGFzaFtmdXp6eUhhc2hdID0gX25ld0tpbmdkb21OdW1iZXI7DQogICAgfQ0KDQp9DQoNCg0KLy8vIEB0aXRsZSBVc2VkIG9uIHRoZSB0ZXN0bmV0IHRvIGFsbG93IGF1dG9tYXRlZCB0ZXN0aW5nIG9mIGludGVybmFscy4NCmNvbnRyYWN0IEV4cG9zZWRJbnRlcm5hbHNGb3JUZXN0aW5nIGlzDQogIE1vbmV5Um91bmRlck1peGluLCBOYW1lYWJsZU1peGluIHsNCg0KICAgIGZ1bmN0aW9uIHJvdW5kTW9uZXlEb3duTmljZWx5RVQodWludCBfcmF3VmFsdWVXZWkpIGNvbnN0YW50DQogICAgcmV0dXJucyAodWludCBuaWNlclZhbHVlV2VpKSB7DQogICAgICAgIHJldHVybiByb3VuZE1vbmV5RG93bk5pY2VseShfcmF3VmFsdWVXZWkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJvdW5kTW9uZXlVcFRvV2hvbGVGaW5uZXlFVCh1aW50IF92YWx1ZVdlaSkgY29uc3RhbnQNCiAgICByZXR1cm5zICh1aW50IHZhbHVlRmlubmV5KSB7DQogICAgICAgIHJldHVybiByb3VuZE1vbmV5VXBUb1dob2xlRmlubmV5KF92YWx1ZVdlaSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdmFsaWRhdGVOYW1lSW50ZXJuYWxFVChzdHJpbmcgX25hbWUpIGNvbnN0YW50DQogICAgcmV0dXJucyAoYm9vbCBhbGxvd2VkKSB7DQogICAgICAgIHJldHVybiB2YWxpZGF0ZU5hbWVJbnRlcm5hbChfbmFtZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZXh0cmFjdE5hbWVGcm9tRGF0YUVUKGJ5dGVzIF9kYXRhKSBjb25zdGFudA0KICAgIHJldHVybnMgKHN0cmluZyBleHRyYWN0ZWROYW1lKSB7DQogICAgICAgIHJldHVybiBleHRyYWN0TmFtZUZyb21EYXRhKF9kYXRhKTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gY29tcHV0ZU5hbWVGdXp6eUhhc2hFVChzdHJpbmcgX25hbWUpIGNvbnN0YW50DQogICAgcmV0dXJucyAodWludCBmdXp6eUhhc2gpIHsNCiAgICAgICAgcmV0dXJuIGNvbXB1dGVOYW1lRnV6enlIYXNoKF9uYW1lKTsNCiAgICB9DQoNCn0='