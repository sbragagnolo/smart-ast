base 64 content
base64krakenPriceTicker
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4wOy8vcGxlYXNlIGltcG9ydCBvcmFjbGl6ZUFQSV9wcmUwLjQuc29sIHdoZW4gc29saWRpdHkgPCAwLjQuMA0KDQpjb250cmFjdCBPcmFjbGl6ZUkgew0KICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsNCiAgICBmdW5jdGlvbiBxdWVyeSh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5Tih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04pIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7DQogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsNCiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOw0KICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7DQogICAgZnVuY3Rpb24gc2V0UHJvb2ZUeXBlKGJ5dGUgX3Byb29mVHlwZSk7DQogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7DQogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOw0KICAgIGZ1bmN0aW9uIHJhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgcmV0dXJucyhieXRlczMyKTsNCn0NCmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7DQogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOw0KfQ0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7DQogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCo2MCoyNDsNCiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCo2MCoyNCo3Ow0KICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsNCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OT05FID0gMHgwMDsNCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0FuZHJvaWQgPSAweDIwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0xlZGdlciA9IDB4MzA7DQogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTmF0aXZlID0gMHhGMDsNCiAgICBieXRlIGNvbnN0YW50IHByb29mU3RvcmFnZV9JUEZTID0gMHgwMTsNCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfYXV0byA9IDA7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21haW5uZXQgPSAxOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF90ZXN0bmV0ID0gMjsNCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbW9yZGVuID0gMjsNCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfY29uc2Vuc3lzID0gMTYxOw0KDQogICAgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIE9BUjsNCg0KICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsNCiAgICBtb2RpZmllciBvcmFjbGl6ZUFQSSB7DQogICAgICAgIGlmKChhZGRyZXNzKE9BUik9PTApfHwoZ2V0Q29kZVNpemUoYWRkcmVzcyhPQVIpKT09MCkpIG9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOw0KICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsNCiAgICAgICAgXzsNCiAgICB9DQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsNCiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7DQogICAgICAgIG9yYWNsaXplLnVzZUNvdXBvbihjb2RlKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsNCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk+MCl7IC8vbWFpbm5ldA0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk7DQogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldA0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk7DQogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JvcHN0ZW4zIik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKT4wKXsgLy9rb3ZhbiB0ZXN0bmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsNCiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfa292YW4iKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpPjApeyAvL3JpbmtlYnkgdGVzdG5ldA0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk7DQogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQ0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKT4wKXsgLy9ldGhlci5jYW1wIGlkZQ0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKT4wKXsgLy9icm93c2VyLXNvbGlkaXR5DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgew0KICAgICAgICBfX2NhbGxiYWNrKG15aWQsIHJlc3VsdCwgbmV3IGJ5dGVzKDApKTsNCiAgICB9DQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3VzZUNvdXBvbihzdHJpbmcgY29kZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgew0KICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07ICAgICAgIA0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07ICAgICAgIA0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5jYkFkZHJlc3MoKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldFByb29mVHlwZShwcm9vZlApOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q29uZmlnKGNvbmZpZyk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgew0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3Mpew0KICAgICAgICBieXRlcyBtZW1vcnkgdG1wID0gYnl0ZXMoX2EpOw0KICAgICAgICB1aW50MTYwIGlhZGRyID0gMDsNCiAgICAgICAgdWludDE2MCBiMTsNCiAgICAgICAgdWludDE2MCBiMjsNCiAgICAgICAgZm9yICh1aW50IGk9MjsgaTwyKzIqMjA7IGkrPTIpew0KICAgICAgICAgICAgaWFkZHIgKj0gMjU2Ow0KICAgICAgICAgICAgYjEgPSB1aW50MTYwKHRtcFtpXSk7DQogICAgICAgICAgICBiMiA9IHVpbnQxNjAodG1wW2krMV0pOw0KICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsNCiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA2NSkmJihiMSA8PSA3MCkpIGIxIC09IDU1Ow0KICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDQ4KSYmKGIxIDw9IDU3KSkgYjEgLT0gNDg7DQogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3Ow0KICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDY1KSYmKGIyIDw9IDcwKSkgYjIgLT0gNTU7DQogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNDgpJiYoYjIgPD0gNTcpKSBiMiAtPSA0ODsNCiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGFkZHJlc3MoaWFkZHIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbXBhcmUoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7DQogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gYS5sZW5ndGg7DQogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykNCiAgICAgICAgICAgIGlmIChhW2ldIDwgYltpXSkNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkNCiAgICAgICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpDQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpDQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gaW5kZXhPZihzdHJpbmcgX2hheXN0YWNrLCBzdHJpbmcgX25lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IG4gPSBieXRlcyhfbmVlZGxlKTsNCiAgICAgICAgaWYoaC5sZW5ndGggPCAxIHx8IG4ubGVuZ3RoIDwgMSB8fCAobi5sZW5ndGggPiBoLmxlbmd0aCkpDQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkNCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgZWxzZQ0KICAgICAgICB7DQogICAgICAgICAgICB1aW50IHN1YmluZGV4ID0gMDsNCiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChoW2ldID09IG5bMF0pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlKHN1YmluZGV4IDwgbi5sZW5ndGggJiYgKGkgKyBzdWJpbmRleCkgPCBoLmxlbmd0aCAmJiBoW2kgKyBzdWJpbmRleF0gPT0gbltzdWJpbmRleF0pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QsIHN0cmluZyBfZSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmMgPSBieXRlcyhfYyk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7DQogICAgICAgIHN0cmluZyBtZW1vcnkgYWJjZGUgPSBuZXcgc3RyaW5nKF9iYS5sZW5ndGggKyBfYmIubGVuZ3RoICsgX2JjLmxlbmd0aCArIF9iZC5sZW5ndGggKyBfYmUubGVuZ3RoKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsNCiAgICAgICAgdWludCBrID0gMDsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2JhLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYVtpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JkLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZFtpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07DQogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsNCiAgICB9DQoNCiAgICAvLyBwYXJzZUludA0KICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOw0KICAgIH0NCg0KICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpDQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOw0KICAgICAgICB1aW50IG1pbnQgPSAwOw0KICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7DQogICAgICAgIGZvciAodWludCBpPTA7IGk8YnJlc3VsdC5sZW5ndGg7IGkrKyl7DQogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1Nykpew0KICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7DQogICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7DQogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsNCiAgICAgICAgcmV0dXJuIG1pbnQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpew0KICAgICAgICBpZiAoaSA9PSAwKSByZXR1cm4gIjAiOw0KICAgICAgICB1aW50IGogPSBpOw0KICAgICAgICB1aW50IGxlbjsNCiAgICAgICAgd2hpbGUgKGogIT0gMCl7DQogICAgICAgICAgICBsZW4rKzsNCiAgICAgICAgICAgIGogLz0gMTA7DQogICAgICAgIH0NCiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsNCiAgICAgICAgdWludCBrID0gbGVuIC0gMTsNCiAgICAgICAgd2hpbGUgKGkgIT0gMCl7DQogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsNCiAgICAgICAgICAgIGkgLz0gMTA7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsNCiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsNCg0KICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoDQogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7DQogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOw0KICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsNCiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7DQogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsNCiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7DQogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7DQogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7DQoNCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgew0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOw0KICAgICAgICAgICAgICAgIGN0cisrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7DQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOw0KICAgICAgICAgICAgICAgIGN0cisrOw0KICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgew0KICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0DQogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7DQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07DQogICAgICAgICAgICAgICAgICAgIGN0cisrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7DQogICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gcmVzOw0KICAgICAgICB9DQoNCiAgICBmdW5jdGlvbiBiYTJjYm9yKGJ5dGVzW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgew0KICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOw0KDQogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgNCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsNCiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7DQogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgew0KICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsNCiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdWludCBjdHIgPSAwOw0KICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsNCiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsNCiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsNCg0KICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7DQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07DQogICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsNCiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7DQogICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQNCiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4Ow0KICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsNCiAgICAgICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsNCiAgICAgICAgICAgICAgICBjdHIrKzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXM7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIA0KICAgIHN0cmluZyBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7DQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29ya05hbWUoc3RyaW5nIF9uZXR3b3JrX25hbWUpIGludGVybmFsIHsNCiAgICAgICAgb3JhY2xpemVfbmV0d29ya19uYW1lID0gX25ldHdvcmtfbmFtZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX25ldHdvcmtfbmFtZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gb3JhY2xpemVfbmV3UmFuZG9tRFNRdWVyeSh1aW50IF9kZWxheSwgdWludCBfbmJ5dGVzLCB1aW50IF9jdXN0b21HYXNMaW1pdCkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7DQogICAgICAgIGlmICgoX25ieXRlcyA9PSAwKXx8KF9uYnl0ZXMgPiAzMikpIHRocm93Ow0KICAgICAgICBieXRlcyBtZW1vcnkgbmJ5dGVzID0gbmV3IGJ5dGVzKDEpOw0KICAgICAgICBuYnl0ZXNbMF0gPSBieXRlKF9uYnl0ZXMpOw0KICAgICAgICBieXRlcyBtZW1vcnkgdW5vbmNlOw0KICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvbktleUhhc2g7DQogICAgICAgIGJ5dGVzMzIgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMiA9IG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIG1zdG9yZSh1bm9uY2UsIDB4MjApDQogICAgICAgICAgICBtc3RvcmUoYWRkKHVub25jZSwgMHgyMCksIHhvcihibG9ja2hhc2goc3ViKG51bWJlciwgMSkpLCB4b3IoY29pbmJhc2UsIHRpbWVzdGFtcCkpKQ0KICAgICAgICAgICAgbXN0b3JlKHNlc3Npb25LZXlIYXNoLCAweDIwKQ0KICAgICAgICAgICAgbXN0b3JlKGFkZChzZXNzaW9uS2V5SGFzaCwgMHgyMCksIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIpDQogICAgICAgIH0NCiAgICAgICAgYnl0ZXNbM10gbWVtb3J5IGFyZ3MgPSBbdW5vbmNlLCBuYnl0ZXMsIHNlc3Npb25LZXlIYXNoXTsgDQogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KF9kZWxheSwgInJhbmRvbSIsIGFyZ3MsIF9jdXN0b21HYXNMaW1pdCk7DQogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQocXVlcnlJZCwgc2hhMyhieXRlczgoX2RlbGF5KSwgYXJnc1sxXSwgc2hhMjU2KGFyZ3NbMF0pLCBhcmdzWzJdKSk7DQogICAgICAgIHJldHVybiBxdWVyeUlkOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7DQogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPSBjb21taXRtZW50Ow0KICAgIH0NCiAgICANCiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJ5dGVzMzIpIG9yYWNsaXplX3JhbmRvbURTX2FyZ3M7DQogICAgbWFwcGluZyhieXRlczMyPT5ib29sKSBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZDsNCg0KICAgIGZ1bmN0aW9uIHZlcmlmeVNpZyhieXRlczMyIHRvc2lnbmgsIGJ5dGVzIGRlcnNpZywgYnl0ZXMgcHVia2V5KSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsNCiAgICAgICAgYm9vbCBzaWdvazsNCiAgICAgICAgYWRkcmVzcyBzaWduZXI7DQogICAgICAgIA0KICAgICAgICBieXRlczMyIHNpZ3I7DQogICAgICAgIGJ5dGVzMzIgc2lnczsNCiAgICAgICAgDQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdyXyA9IG5ldyBieXRlcygzMik7DQogICAgICAgIHVpbnQgb2Zmc2V0ID0gNCsodWludChkZXJzaWdbM10pIC0gMHgyMCk7DQogICAgICAgIHNpZ3JfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0LCAzMiwgc2lncl8sIDApOw0KICAgICAgICBieXRlcyBtZW1vcnkgc2lnc18gPSBuZXcgYnl0ZXMoMzIpOw0KICAgICAgICBvZmZzZXQgKz0gMzIgKyAyOw0KICAgICAgICBzaWdzXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCsodWludChkZXJzaWdbb2Zmc2V0LTFdKSAtIDB4MjApLCAzMiwgc2lnc18sIDApOw0KDQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIHNpZ3IgOj0gbWxvYWQoYWRkKHNpZ3JfLCAzMikpDQogICAgICAgICAgICBzaWdzIDo9IG1sb2FkKGFkZChzaWdzXywgMzIpKQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI3LCBzaWdyLCBzaWdzKTsNCiAgICAgICAgaWYgKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpIHJldHVybiB0cnVlOw0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyOCwgc2lnciwgc2lncyk7DQogICAgICAgICAgICByZXR1cm4gKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShieXRlcyBwcm9vZiwgdWludCBzaWcyb2Zmc2V0KSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIGJvb2wgc2lnb2s7DQogICAgICAgIA0KICAgICAgICAvLyBTdGVwIDY6IHZlcmlmeSB0aGUgYXR0ZXN0YXRpb24gc2lnbmF0dXJlLCBBUFBLRVkxIG11c3Qgc2lnbiB0aGUgc2Vzc2lvbktleSBmcm9tIHRoZSBjb3JyZWN0IGxlZGdlciBhcHAgKENPREVIQVNIKQ0KICAgICAgICBieXRlcyBtZW1vcnkgc2lnMiA9IG5ldyBieXRlcyh1aW50KHByb29mW3NpZzJvZmZzZXQrMV0pKzIpOw0KICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQsIHNpZzIubGVuZ3RoLCBzaWcyLCAwKTsNCiAgICAgICAgDQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcHBrZXkxX3B1YmtleSA9IG5ldyBieXRlcyg2NCk7DQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMysxLCA2NCwgYXBwa2V5MV9wdWJrZXksIDApOw0KICAgICAgICANCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjIgPSBuZXcgYnl0ZXMoMSs2NSszMik7DQogICAgICAgIHRvc2lnbjJbMF0gPSAxOyAvL3JvbGUNCiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LTY1LCA2NSwgdG9zaWduMiwgMSk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBDT0RFSEFTSCA9IGhleCJmZDk0ZmE3MWJjMGJhMTBkMzlkNDY0ZDBkOGY0NjVlZmVlZjBhMjc2NGUzODg3ZmNjOWRmNDFkZWQyMGY1MDVjIjsNCiAgICAgICAgY29weUJ5dGVzKENPREVIQVNILCAwLCAzMiwgdG9zaWduMiwgMSs2NSk7DQogICAgICAgIHNpZ29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24yKSwgc2lnMiwgYXBwa2V5MV9wdWJrZXkpOw0KICAgICAgICANCiAgICAgICAgaWYgKHNpZ29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gU3RlcCA3OiB2ZXJpZnkgdGhlIEFQUEtFWTEgcHJvdmVuYW5jZSAobXVzdCBiZSBzaWduZWQgYnkgTGVkZ2VyKQ0KICAgICAgICBieXRlcyBtZW1vcnkgTEVER0VSS0VZID0gaGV4IjdmYjk1NjQ2OWM1YzliODk4NDBkNTViNDM1MzdlNjZhOThkZDQ4MTFlYTBhMjcyMjQyNzJjMmU1NjIyOTExZTg1MzdhMmY4ZTg2YTQ2YmFlYzgyODY0ZTk4ZGQwMWU5Y2NjMmY4YmM1ZGZjOWNiZTVhOTFhMjkwNDk4ZGQ5NmU0IjsNCiAgICAgICAgDQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24zID0gbmV3IGJ5dGVzKDErNjUpOw0KICAgICAgICB0b3NpZ24zWzBdID0gMHhGRTsNCiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzLCA2NSwgdG9zaWduMywgMSk7DQogICAgICAgIA0KICAgICAgICBieXRlcyBtZW1vcnkgc2lnMyA9IG5ldyBieXRlcyh1aW50KHByb29mWzMrNjUrMV0pKzIpOw0KICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrNjUsIHNpZzMubGVuZ3RoLCBzaWczLCAwKTsNCiAgICAgICAgDQogICAgICAgIHNpZ29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24zKSwgc2lnMywgTEVER0VSS0VZKTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBzaWdvazsNCiAgICB9DQogICAgDQogICAgbW9kaWZpZXIgb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgew0KICAgICAgICAvLyBTdGVwIDE6IHRoZSBwcmVmaXggaGFzIHRvIG1hdGNoICdMUFx4MDEnIChMZWRnZXIgUHJvb2YgdmVyc2lvbiAxKQ0KICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHRocm93Ow0KICAgICAgICANCiAgICAgICAgYm9vbCBwcm9vZlZlcmlmaWVkID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oX3Byb29mLCBfcXVlcnlJZCwgYnl0ZXMoX3Jlc3VsdCksIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkpOw0KICAgICAgICBpZiAocHJvb2ZWZXJpZmllZCA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICBfOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBtYXRjaEJ5dGVzMzJQcmVmaXgoYnl0ZXMzMiBjb250ZW50LCBieXRlcyBwcmVmaXgpIGludGVybmFsIHJldHVybnMgKGJvb2wpew0KICAgICAgICBib29sIG1hdGNoXyA9IHRydWU7DQogICAgICAgIA0KICAgICAgICBmb3IgKHZhciBpPTA7IGk8cHJlZml4Lmxlbmd0aDsgaSsrKXsNCiAgICAgICAgICAgIGlmIChjb250ZW50W2ldICE9IHByZWZpeFtpXSkgbWF0Y2hfID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHJldHVybiBtYXRjaF87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsNCiAgICAgICAgYm9vbCBjaGVja29rOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIC8vIFN0ZXAgMjogdGhlIHVuaXF1ZSBrZXloYXNoIGhhcyB0byBtYXRjaCB3aXRoIHRoZSBzaGEyNTYgb2YgKGNvbnRleHQgbmFtZSArIHF1ZXJ5SWQpDQogICAgICAgIHVpbnQgbGVkZ2VyUHJvb2ZMZW5ndGggPSAzKzY1Kyh1aW50KHByb29mWzMrNjUrMV0pKzIpKzMyOw0KICAgICAgICBieXRlcyBtZW1vcnkga2V5aGFzaCA9IG5ldyBieXRlcygzMik7DQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgsIDMyLCBrZXloYXNoLCAwKTsNCiAgICAgICAgY2hlY2tvayA9IChzaGEzKGtleWhhc2gpID09IHNoYTMoc2hhMjU2KGNvbnRleHRfbmFtZSwgcXVlcnlJZCkpKTsNCiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsNCiAgICAgICAgDQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcxID0gbmV3IGJ5dGVzKHVpbnQocHJvb2ZbbGVkZ2VyUHJvb2ZMZW5ndGgrKDMyKzgrMSszMikrMV0pKzIpOw0KICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpLCBzaWcxLmxlbmd0aCwgc2lnMSwgMCk7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gU3RlcCAzOiB3ZSBhc3N1bWUgc2lnMSBpcyB2YWxpZCAoaXQgd2lsbCBiZSB2ZXJpZmllZCBkdXJpbmcgc3RlcCA1KSBhbmQgd2UgdmVyaWZ5IGlmICdyZXN1bHQnIGlzIHRoZSBwcmVmaXggb2Ygc2hhMjU2KHNpZzEpDQogICAgICAgIGNoZWNrb2sgPSBtYXRjaEJ5dGVzMzJQcmVmaXgoc2hhMjU2KHNpZzEpLCByZXN1bHQpOw0KICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIC8vIFN0ZXAgNDogY29tbWl0bWVudCBtYXRjaCB2ZXJpZmljYXRpb24sIHNoYTMoZGVsYXksIG5ieXRlcywgdW5vbmNlLCBzZXNzaW9uS2V5SGFzaCkgPT0gY29tbWl0bWVudCBpbiBzdG9yYWdlLg0KICAgICAgICAvLyBUaGlzIGlzIHRvIHZlcmlmeSB0aGF0IHRoZSBjb21wdXRlZCBhcmdzIG1hdGNoIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkIGluIHRoZSBxdWVyeS4NCiAgICAgICAgYnl0ZXMgbWVtb3J5IGNvbW1pdG1lbnRTbGljZTEgPSBuZXcgYnl0ZXMoOCsxKzMyKTsNCiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCszMiwgOCsxKzMyLCBjb21taXRtZW50U2xpY2UxLCAwKTsNCiAgICAgICAgDQogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uUHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsNCiAgICAgICAgdWludCBzaWcyb2Zmc2V0ID0gbGVkZ2VyUHJvb2ZMZW5ndGgrMzIrKDgrMSszMikrc2lnMS5sZW5ndGgrNjU7DQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NCwgNjQsIHNlc3Npb25QdWJrZXksIDApOw0KICAgICAgICANCiAgICAgICAgYnl0ZXMzMiBzZXNzaW9uUHVia2V5SGFzaCA9IHNoYTI1NihzZXNzaW9uUHVia2V5KTsNCiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPT0gc2hhMyhjb21taXRtZW50U2xpY2UxLCBzZXNzaW9uUHVia2V5SGFzaCkpeyAvL3Vub25jZSwgbmJ5dGVzIGFuZCBzZXNzaW9uS2V5SGFzaCBtYXRjaA0KICAgICAgICAgICAgZGVsZXRlIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF07DQogICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gU3RlcCA1OiB2YWxpZGl0eSB2ZXJpZmljYXRpb24gZm9yIHNpZzEgKGtleWhhc2ggYW5kIGFyZ3Mgc2lnbmVkIHdpdGggdGhlIHNlc3Npb25LZXkpDQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24xID0gbmV3IGJ5dGVzKDMyKzgrMSszMik7DQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgsIDMyKzgrMSszMiwgdG9zaWduMSwgMCk7DQogICAgICAgIGNoZWNrb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjEpLCBzaWcxLCBzZXNzaW9uUHVia2V5KTsNCiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsNCiAgICAgICAgDQogICAgICAgIC8vIHZlcmlmeSBpZiBzZXNzaW9uUHVia2V5SGFzaCB3YXMgdmVyaWZpZWQgYWxyZWFkeSwgaWYgbm90Li4gbGV0J3MgZG8gaXQhDQogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPT0gZmFsc2Upew0KICAgICAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShwcm9vZiwgc2lnMm9mZnNldCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF07DQogICAgfQ0KDQogICAgDQogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UNCiAgICBmdW5jdGlvbiBjb3B5Qnl0ZXMoYnl0ZXMgZnJvbSwgdWludCBmcm9tT2Zmc2V0LCB1aW50IGxlbmd0aCwgYnl0ZXMgdG8sIHVpbnQgdG9PZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7DQogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gbGVuZ3RoICsgdG9PZmZzZXQ7DQoNCiAgICAgICAgaWYgKHRvLmxlbmd0aCA8IG1pbkxlbmd0aCkgew0KICAgICAgICAgICAgLy8gQnVmZmVyIHRvbyBzbWFsbA0KICAgICAgICAgICAgdGhyb3c7IC8vIFNob3VsZCBiZSBhIGJldHRlciB3YXk/DQogICAgICAgIH0NCg0KICAgICAgICAvLyBOT1RFOiB0aGUgb2Zmc2V0IDMyIGlzIGFkZGVkIHRvIHNraXAgdGhlIGBzaXplYCBmaWVsZCBvZiBib3RoIGJ5dGVzIHZhcmlhYmxlcw0KICAgICAgICB1aW50IGkgPSAzMiArIGZyb21PZmZzZXQ7DQogICAgICAgIHVpbnQgaiA9IDMyICsgdG9PZmZzZXQ7DQoNCiAgICAgICAgd2hpbGUgKGkgPCAoMzIgKyBmcm9tT2Zmc2V0ICsgbGVuZ3RoKSkgew0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIGxldCB0bXAgOj0gbWxvYWQoYWRkKGZyb20sIGkpKQ0KICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodG8sIGopLCB0bXApDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpICs9IDMyOw0KICAgICAgICAgICAgaiArPSAzMjsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0bzsNCiAgICB9DQogICAgDQogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UNCiAgICAvLyBEdXBsaWNhdGUgU29saWRpdHkncyBlY3JlY292ZXIsIGJ1dCBjYXRjaGluZyB0aGUgQ0FMTCByZXR1cm4gdmFsdWUNCiAgICBmdW5jdGlvbiBzYWZlcl9lY3JlY292ZXIoYnl0ZXMzMiBoYXNoLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCwgYWRkcmVzcykgew0KICAgICAgICAvLyBXZSBkbyBvdXIgb3duIG1lbW9yeSBtYW5hZ2VtZW50IGhlcmUuIFNvbGlkaXR5IHVzZXMgbWVtb3J5IG9mZnNldA0KICAgICAgICAvLyAweDQwIHRvIHN0b3JlIHRoZSBjdXJyZW50IGVuZCBvZiBtZW1vcnkuIFdlIHdyaXRlIHBhc3QgaXQgKGFzDQogICAgICAgIC8vIHdyaXRlcyBhcmUgbWVtb3J5IGV4dGVuc2lvbnMpLCBidXQgZG9uJ3QgdXBkYXRlIHRoZSBvZmZzZXQgc28NCiAgICAgICAgLy8gU29saWRpdHkgd2lsbCByZXVzZSBpdC4gVGhlIG1lbW9yeSB1c2VkIGhlcmUgaXMgb25seSBuZWVkZWQgZm9yDQogICAgICAgIC8vIHRoaXMgY29udGV4dC4NCg0KICAgICAgICAvLyBGSVhNRTogaW5saW5lIGFzc2VtYmx5IGNhbid0IGFjY2VzcyByZXR1cm4gdmFsdWVzDQogICAgICAgIGJvb2wgcmV0Ow0KICAgICAgICBhZGRyZXNzIGFkZHI7DQoNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgbGV0IHNpemUgOj0gbWxvYWQoMHg0MCkNCiAgICAgICAgICAgIG1zdG9yZShzaXplLCBoYXNoKQ0KICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCAzMiksIHYpDQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDY0KSwgcikNCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgOTYpLCBzKQ0KDQogICAgICAgICAgICAvLyBOT1RFOiB3ZSBjYW4gcmV1c2UgdGhlIHJlcXVlc3QgbWVtb3J5IGJlY2F1c2Ugd2UgZGVhbCB3aXRoDQogICAgICAgICAgICAvLyAgICAgICB0aGUgcmV0dXJuIGNvZGUNCiAgICAgICAgICAgIHJldCA6PSBjYWxsKDMwMDAsIDEsIDAsIHNpemUsIDEyOCwgc2l6ZSwgMzIpDQogICAgICAgICAgICBhZGRyIDo9IG1sb2FkKHNpemUpDQogICAgICAgIH0NCiAgDQogICAgICAgIHJldHVybiAocmV0LCBhZGRyKTsNCiAgICB9DQoNCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQ0KICAgIGZ1bmN0aW9uIGVjcmVjb3ZlcnkoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsNCiAgICAgICAgYnl0ZXMzMiByOw0KICAgICAgICBieXRlczMyIHM7DQogICAgICAgIHVpbnQ4IHY7DQoNCiAgICAgICAgaWYgKHNpZy5sZW5ndGggIT0gNjUpDQogICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7DQoNCiAgICAgICAgLy8gVGhlIHNpZ25hdHVyZSBmb3JtYXQgaXMgYSBjb21wYWN0IGZvcm0gb2Y6DQogICAgICAgIC8vICAge2J5dGVzMzIgcn17Ynl0ZXMzMiBzfXt1aW50OCB2fQ0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLg0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkNCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQ0KDQogICAgICAgICAgICAvLyBIZXJlIHdlIGFyZSBsb2FkaW5nIHRoZSBsYXN0IDMyIGJ5dGVzLiBXZSBleHBsb2l0IHRoZSBmYWN0IHRoYXQNCiAgICAgICAgICAgIC8vICdtbG9hZCcgd2lsbCBwYWQgd2l0aCB6ZXJvZXMgaWYgd2Ugb3ZlcnJlYWQuDQogICAgICAgICAgICAvLyBUaGVyZSBpcyBubyAnbWxvYWQ4JyB0byBkbyB0aGlzLCBidXQgdGhhdCB3b3VsZCBiZSBuaWNlci4NCiAgICAgICAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQ0KDQogICAgICAgICAgICAvLyBBbHRlcm5hdGl2ZSBzb2x1dGlvbjoNCiAgICAgICAgICAgIC8vICdieXRlJyBpcyBub3Qgd29ya2luZyBkdWUgdG8gdGhlIFNvbGlkaXR5IHBhcnNlciwgc28gbGV0cw0KICAgICAgICAgICAgLy8gdXNlIHRoZSBzZWNvbmQgYmVzdCBvcHRpb24sICdhbmQnDQogICAgICAgICAgICAvLyB2IDo9IGFuZChtbG9hZChhZGQoc2lnLCA2NSkpLCAyNTUpDQogICAgICAgIH0NCg0KICAgICAgICAvLyBhbGJlaXQgbm9uLXRyYW5zYWN0aW9uYWwgc2lnbmF0dXJlcyBhcmUgbm90IHNwZWNpZmllZCBieSB0aGUgWVAsIG9uZSB3b3VsZCBleHBlY3QgaXQNCiAgICAgICAgLy8gdG8gbWF0Y2ggdGhlIFlQIHJhbmdlIG9mIFsyNywgMjhdDQogICAgICAgIC8vDQogICAgICAgIC8vIGdldGggdXNlcyBbMCwgMV0gYW5kIHNvbWUgY2xpZW50cyBoYXZlIGZvbGxvd2VkLiBUaGlzIG1pZ2h0IGNoYW5nZSwgc2VlOg0KICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVtL2lzc3Vlcy8yMDUzDQogICAgICAgIGlmICh2IDwgMjcpDQogICAgICAgICAgdiArPSAyNzsNCg0KICAgICAgICBpZiAodiAhPSAyNyAmJiB2ICE9IDI4KQ0KICAgICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7DQoNCiAgICAgICAgcmV0dXJuIHNhZmVyX2VjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsNCiAgICB9DQogICAgICAgIA0KfQ0KLy8gPC9PUkFDTElaRV9BUEk+DQoNCnByYWdtYSBzb2xpZGl0eSBeMC40LjA7DQoNCmNvbnRyYWN0IEtyYWtlblByaWNlVGlja2VyIGlzIHVzaW5nT3JhY2xpemUgew0KICAgIA0KICAgIHN0cmluZyBwdWJsaWMgRVRIWEJUOw0KICAgIA0KICAgIGV2ZW50IG5ld09yYWNsaXplUXVlcnkoc3RyaW5nIGRlc2NyaXB0aW9uKTsNCiAgICBldmVudCBuZXdLcmFrZW5QcmljZVRpY2tlcihzdHJpbmcgcHJpY2UpOw0KICAgIA0KICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsNCiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoMHg2ZjI4YjE0NjgwNGRiYTJkNmY5NDRjMDM1MjhhOGZkYmM2NzNkZjJjKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBLcmFrZW5QcmljZVRpY2tlcigpIHsNCiAgICAgICAgb3JhY2xpemVfc2V0UHJvb2YocHJvb2ZUeXBlX1RMU05vdGFyeSB8IHByb29mU3RvcmFnZV9JUEZTKTsNCiAgICAgICAgdXBkYXRlKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG9yYWNsaXplX2NiQWRkcmVzcygpKSB0aHJvdzsNCiAgICAgICAgRVRIWEJUID0gcmVzdWx0Ow0KICAgICAgICBuZXdLcmFrZW5QcmljZVRpY2tlcihFVEhYQlQpOw0KICAgICAgICB1cGRhdGUoKTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gdXBkYXRlKCkgcGF5YWJsZSB7DQogICAgICAgIGlmIChvcmFjbGl6ZS5nZXRQcmljZSgiVVJMIikgPiB0aGlzLmJhbGFuY2UpIHsNCiAgICAgICAgICAgIG5ld09yYWNsaXplUXVlcnkoIk9yYWNsaXplIHF1ZXJ5IHdhcyBOT1Qgc2VudCwgcGxlYXNlIGFkZCBzb21lIEVUSCB0byBjb3ZlciBmb3IgdGhlIHF1ZXJ5IGZlZSIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbmV3T3JhY2xpemVRdWVyeSgiT3JhY2xpemUgcXVlcnkgd2FzIHNlbnQsIHN0YW5kaW5nIGJ5IGZvciB0aGUgYW5zd2VyLi4iKTsNCiAgICAgICAgICAgIG9yYWNsaXplX3F1ZXJ5KDYwLCAiVVJMIiwgImpzb24oaHR0cHM6Ly9hcGkua3Jha2VuLmNvbS8wL3B1YmxpYy9UaWNrZXI/cGFpcj1FVEhYQlQpLnJlc3VsdC5YRVRIWFhCVC5jLjAiKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCn0='