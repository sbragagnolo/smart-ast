base 64 content
base64mRVToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KDQovKioNCiAqIEB0aXRsZSBFUkMyMEJhc2ljDQogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UNCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMEJhc2ljIHsNCiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7DQogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7DQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpOw0KICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsNCn0NCg0KLyoqDQogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlDQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqLw0KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7DQogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOw0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKTsNCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOw0KICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsNCn0NCg0KLyoqDQogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzDQogKi8NCmxpYnJhcnkgU2FmZU1hdGggew0KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICB1aW50MjU2IGMgPSBhICogYjsNCiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwDQogICAgdWludDI1NiBjID0gYSAvIGI7DQogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1Nikgew0KICAgIGFzc2VydChiIDw9IGEpOw0KICAgIHJldHVybiBhIC0gYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1Nikgew0KICAgIHVpbnQyNTYgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjID49IGEpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogIH0NCg0KfQ0KDQovKioNCiAqIEB0aXRsZSBCYXNpYyB0b2tlbg0KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4gDQogKi8NCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7DQogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2Ow0KDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsNCg0KICAvKioNCiAgICogQGRldiBGaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjay4NCiAgICovDQogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50MjU2IHNpemUpIHsNCiAgICAgaWYobXNnLmRhdGEubGVuZ3RoIDwgc2l6ZSArIDQpIHsNCiAgICAgICB0aHJvdzsNCiAgICAgfQ0KICAgICBfOw0KICB9DQoNCiAgLyoqDQogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcw0KICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uDQogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLg0KICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHsNCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOw0KICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuDQogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuIA0KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuDQogICovDQogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7DQogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogIH0NCg0KfQ0KDQovKioNCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbg0KICoNCiAqIEBkZXYgSW1wbGVtYW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJ0IHRva2VuLg0KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wNCiAqLw0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBCYXNpY1Rva2VuLCBFUkMyMCB7DQoNCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOw0KDQoNCiAgLyoqDQogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcg0KICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tDQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bw0KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkDQogICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMyAqIDMyKSB7DQogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsNCg0KICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldA0KICAgIC8vIGlmIChfdmFsdWUgPiBfYWxsb3dhbmNlKSB0aHJvdzsNCg0KICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsNCiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7DQogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLg0KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuDQogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuDQogICAqLw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSB7DQoNCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYA0KICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90DQogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6DQogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5DQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsNCg0KICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4NCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLg0KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4NCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLg0KICAgKi8NCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgew0KICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICB9DQoNCn0NCg0KLyoqDQogKiBAdGl0bGUgT3duYWJsZQ0KICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbCANCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuIA0KICovDQpjb250cmFjdCBPd25hYmxlIHsNCiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCg0KICAvKiogDQogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcg0KICAgKiBhY2NvdW50Lg0KICAgKi8NCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsNCiAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogIH0NCg0KDQogIC8qKg0KICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuIA0KICAgKi8NCiAgbW9kaWZpZXIgb25seU93bmVyKCkgew0KICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogICAgXzsNCiAgfQ0KDQoNCiAgLyoqDQogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuDQogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uIA0KICAgKi8NCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsNCiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgew0KICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICB9DQogIH0NCg0KfQ0KDQovKiogDQogKiBAdGl0bGUgQ29udHJhY3RzIHRoYXQgc2hvdWxkIG5vdCBvd24gVG9rZW5zDQogKiBAYXV0aG9yIFJlbWNvIEJsb2VtZW4gPHJlbWNvQDLPgC5jb20+DQogKiBAZGV2IFRoaXMgYmxvY2tzIGluY29taW5nIEVSQzIzIHRva2VucyB0byBwcmV2ZW50IGFjY2lkZW50YWwgbG9zcyBvZiB0b2tlbnMuDQogKiBTaG91bGQgdG9rZW5zIChhbnkgRVJDMjBCYXNpYyBjb21wYXRpYmxlKSBlbmQgdXAgaW4gdGhlIGNvbnRyYWN0LCBpdCBhbGxvd3MgdGhlDQogKiBvd25lciB0byByZWNsYWltIHRoZSB0b2tlbnMuDQogKi8NCmNvbnRyYWN0IEhhc05vVG9rZW5zIGlzIE93bmFibGUgew0KDQogLyoqIA0KICAqIEBkZXYgUmVqZWN0IGFsbCBFUkMyMyBjb21wYXRpYmxlIHRva2Vucw0KICAqIEBwYXJhbSBmcm9tXyBhZGRyZXNzIFRoZSBhZGRyZXNzIHRoYXQgaXMgdHJhbnNmZXJyaW5nIHRoZSB0b2tlbnMNCiAgKiBAcGFyYW0gdmFsdWVfIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0aGUgc3BlY2lmaWVkIHRva2VuDQogICogQHBhcmFtIGRhdGFfIEJ5dGVzIFRoZSBkYXRhIHBhc3NlZCBmcm9tIHRoZSBjYWxsZXIuDQogICovDQogIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soYWRkcmVzcyBmcm9tXywgdWludDI1NiB2YWx1ZV8sIGJ5dGVzIGRhdGFfKSBleHRlcm5hbCB7DQogICAgdGhyb3c7DQogIH0NCg0KICAvKioNCiAgICogQGRldiBSZWNsYWltIGFsbCBFUkMyMEJhc2ljIGNvbXBhdGlibGUgdG9rZW5zDQogICAqIEBwYXJhbSB0b2tlbkFkZHIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QNCiAgICovDQogIGZ1bmN0aW9uIHJlY2xhaW1Ub2tlbihhZGRyZXNzIHRva2VuQWRkcikgZXh0ZXJuYWwgb25seU93bmVyIHsNCiAgICBFUkMyMEJhc2ljIHRva2VuSW5zdCA9IEVSQzIwQmFzaWModG9rZW5BZGRyKTsNCiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbkluc3QuYmFsYW5jZU9mKHRoaXMpOw0KICAgIHRva2VuSW5zdC50cmFuc2Zlcihvd25lciwgYmFsYW5jZSk7DQogIH0NCn0NCg0KLyoqIA0KICogQHRpdGxlIENvbnRyYWN0cyB0aGF0IHNob3VsZCBub3Qgb3duIENvbnRyYWN0cw0KICogQGF1dGhvciBSZW1jbyBCbG9lbWVuIDxyZW1jb0Ayz4AuY29tPg0KICogQGRldiBTaG91bGQgY29udHJhY3RzIChhbnl0aGluZyBPd25hYmxlKSBlbmQgdXAgYmVpbmcgb3duZWQgYnkgdGhpcyBjb250cmFjdCwgaXQgYWxsb3dzIHRoZSBvd25lcg0KICogb2YgdGhpcyBjb250cmFjdCB0byByZWNsYWltIG93bmVyc2hpcCBvZiB0aGUgY29udHJhY3RzLg0KICovDQpjb250cmFjdCBIYXNOb0NvbnRyYWN0cyBpcyBPd25hYmxlIHsNCg0KICAvKioNCiAgICogQGRldiBSZWNsYWltIG93bmVyc2hpcCBvZiBPd25hYmxlIGNvbnRyYWN0cw0KICAgKiBAcGFyYW0gY29udHJhY3RBZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSBPd25hYmxlIHRvIGJlIHJlY2xhaW1lZC4NCiAgICovDQogIGZ1bmN0aW9uIHJlY2xhaW1Db250cmFjdChhZGRyZXNzIGNvbnRyYWN0QWRkcikgZXh0ZXJuYWwgb25seU93bmVyIHsNCiAgICBPd25hYmxlIGNvbnRyYWN0SW5zdCA9IE93bmFibGUoY29udHJhY3RBZGRyKTsNCiAgICBjb250cmFjdEluc3QudHJhbnNmZXJPd25lcnNoaXAob3duZXIpOw0KICB9DQp9DQoNCi8qKg0KICogTVJWIHRva2VuLCBkaXN0cmlidXRlZCBieSBjcm93ZHNhbGUuIFRva2VuIGFuZCBjcm93ZHNhbGUgZnVuY3Rpb25hbGl0eSBhcmUgdW5pZmllZCBpbiBhIHNpbmdsZQ0KICogY29udHJhY3QsIHRvIG1ha2UgY2xlYXIgYW5kIHJlc3RyaWN0IHRoZSBjb25kaXRpb25zIHVuZGVyIHdoaWNoIHRva2VucyBjYW4gYmUgY3JlYXRlZCBvciBkZXN0cm95ZWQuDQogKiBEZXJpdmVkIGZyb20gT3BlblplcHBlbGluIENyb3dkc2FsZVRva2VuIHRlbXBsYXRlLg0KICoNCiAqIEtleSBDcm93ZHNhbGUgRmFjdHM6DQogKiANCiAqICogTVJWIHRva2VucyB3aWxsIGJlIHNvbGQgYXQgYSByYXRlIG9mIDUsMDAwIHBlciBFVEguDQogKg0KICogKiBBbGwgTVJWIHRva2VuIHNhbGVzIGFyZSBmaW5hbC4gTm8gcmVmdW5kcyBjYW4gYmUgaXNzdWVkIGJ5IHRoZSBjb250cmFjdC4NCiAqDQogKiAqIFVubGVzcyBhZGp1c3RlZCBsYXRlciBieSB0aGUgY3Jvd2RzYWxlIG9wZXJhdG9yLCB1cCB0byAxMDAgbWlsbGlvbiB0b2tlbnMgd2lsbCBiZSBhdmFpbGFibGUuDQogKg0KICogKiBBbiBhZGRpdGlvbmFsIDUsMDAwIHRva2VucyBhcmUgcmVzZXJ2ZWQuIA0KICoNCiAqICogUGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZSBieSBzZW5kaW5nIEVUSCB0byB0aGlzIGNvbnRyYWN0LCB3aGVuIHRoZSBjcm93ZHNhbGUgaXMgb3Blbi4NCiAqDQogKiAqIFNlbmRpbmcgbW9yZSBFVEggdGhhbiByZXF1aXJlZCB0byBwdXJjaGFzZSBhbGwgdGhlIHJlbWFpbmluZyB0b2tlbnMgd2lsbCBmYWlsLg0KICoNCiAqICogVGltZXJzIGNhbiBiZSBzZXQgdG8gYWxsb3cgYW55b25lIHRvIG9wZW4vY2xvc2UgdGhlIGNyb3dkc2FsZSBhdCB0aGUgcHJvcGVyIHRpbWUuIFRoZSBjcm93ZHNhbGUNCiAqICAgb3BlcmF0b3IgcmVzZXJ2ZXMgdGhlIHJpZ2h0IHRvIHNldCwgdW5zZXQsIGFuZCByZXNldCB0aGVzZSB0aW1lcnMgYXQgYW55IHRpbWUsIGZvciBhbnkgcmVhc29uLA0KICogICBhbmQgd2l0aG91dCBub3RpY2UuDQogKg0KICogKiBUaGUgb3BlcmF0b3Igb2YgdGhlIGNyb3dkc2FsZSBoYXMgdGhlIGFiaWxpdHkgdG8gbWFudWFsbHkgb3BlbiBpdCBhbmQgY2xvc2UgaXQsIGFuZCByZXNlcnZlcw0KICogICB0aGUgcmlnaHQgdG8gZG8gc28gYXQgYW55IHRpbWUsIGZvciBhbnkgcmVhc29uLCBhbmQgd2l0aG91dCBub3RpY2UuDQogKg0KICogKiBUaGUgY3Jvd2RzYWxlIGNhbm5vdCBiZSByZW9wZW5lZCwgYW5kIG5vIHRva2VucyBjYW4gYmUgY3JlYXRlZCwgYWZ0ZXIgdGhlIGNyb3dkc2FsZSBjbG9zZXMuDQogKg0KICogKiBUaGUgY3Jvd2RzYWxlIG9wZXJhdG9yIHJlc2VydmVzIHRoZSByaWdodCB0byBhZGp1c3QgdGhlIGRlY2ltYWwgcGxhY2VzIG9mIHRoZSBNUlYgdG9rZW4gYXQNCiAqICAgYW55IHRpbWUgYWZ0ZXIgdGhlIGNyb3dkc2FsZSBjbG9zZXMsIGZvciBhbnkgcmVhc29uLCBhbmQgd2l0aG91dCBub3RpY2UuIE1SViB0b2tlbnMgYXJlDQogKiAgIGluaXRpYWxseSBkaXZpc2libGUgdG8gMTggZGVjaW1hbCBwbGFjZXMuDQogKg0KICogKiBUaGUgY3Jvd2RzYWxlIG9wZXJhdG9yIHJlc2VydmVzIHRoZSByaWdodCB0byBub3Qgb3BlbiBvciBjbG9zZSB0aGUgY3Jvd2RzYWxlLCBub3Qgc2V0IHRoZQ0KICogICBvcGVuIG9yIGNsb3NlIHRpbWVyLCBhbmQgZ2VuZXJhbGx5IHJlZnJhaW4gZnJvbSBkb2luZyB0aGluZ3MgdGhhdCB0aGUgY29udHJhY3Qgd291bGQgb3RoZXJ3aXNlDQogKiAgIGF1dGhvcml6ZSB0aGVtIHRvIGRvLg0KICoNCiAqICogVGhlIGNyb3dkc2FsZSBvcGVyYXRvciByZXNlcnZlcyB0aGUgcmlnaHQgdG8gY2xhaW0gYW5kIGtlZXAgYW55IEVUSCBvciB0b2tlbnMgdGhhdCBlbmQgdXAgaW4NCiAqICAgdGhlIGNvbnRyYWN0J3MgYWNjb3VudC4gRHVyaW5nIG5vcm1hbCBjcm93ZHNhbGUgb3BlcmF0aW9uLCBFVEggaXMgbm90IHN0b3JlZCBpbiB0aGUgY29udHJhY3Qncw0KICogICBhY2NvdW50LCBhbmQgaXMgaW5zdGVhZCBzZW50IGRpcmVjdGx5IHRvIHRoZSBiZW5lZmljaWFyeS4NCiAqLw0KY29udHJhY3QgTVJWVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSwgSGFzTm9Ub2tlbnMsIEhhc05vQ29udHJhY3RzIHsNCg0KICAgIC8vIFRva2VuIFBhcmFtZXRlcnMNCg0KICAgIC8vIEZyb20gU3RhbmRhcmRUb2tlbiB3ZSBpbmhlcml0IGJhbGFuY2VzIGFuZCB0b3RhbFN1cHBseS4NCiAgICANCiAgICAvLyBXaGF0IGlzIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHRva2VuPw0KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJNYWNyb3ZlcnNlIFRva2VuIjsNCiAgICAvLyBXaGF0IGlzIGl0cyBzdWdnZXN0ZWQgc3ltYm9sPw0KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIk1SViI7DQogICAgLy8gSG93IG1hbnkgb2YgdGhlIGxvdyBiYXNlLTEwIGRpZ2l0cyBhcmUgdG8gdGhlIHJpZ2h0IG9mIHRoZSBkZWNpbWFsIHBvaW50Pw0KICAgIC8vIE5vdGUgdGhhdCB0aGlzIGlzIG5vdCBjb25zdGFudCEgQWZ0ZXIgdGhlIGNyb3dkc2FsZSwgdGhlIGNvbnRyYWN0IG93bmVyIGNhbg0KICAgIC8vIGFkanVzdCB0aGUgZGVjaW1hbCBwbGFjZXMsIGFsbG93aW5nIGZvciAxMC10by0xIHNwbGl0cyBhbmQgbWVyZ2VzLg0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsNCiAgICANCiAgICAvLyBDcm93ZHNhbGUgUGFyYW1ldGVycw0KICAgIA0KICAgIC8vIFdoZXJlIHdpbGwgZnVuZHMgY29sbGVjdGVkIGR1cmluZyB0aGUgY3Jvd2RzYWxlIGJlIHNlbnQ/DQogICAgYWRkcmVzcyBiZW5lZmljaWFyeTsNCiAgICAvLyBIb3cgbWFueSBNUlYgY2FuIGJlIHNvbGQgaW4gdGhlIGNyb3dkc2FsZT8NCiAgICB1aW50IHB1YmxpYyBtYXhDcm93ZHNhbGVTdXBwbHlJbldob2xlVG9rZW5zOw0KICAgIC8vIEhvdyBtYW55IHdob2xlIHRva2VucyBhcmUgcmVzZXJ2ZWQgZm9yIHRoZSBiZW5lZmljaWFyeT8NCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCB3aG9sZVRva2Vuc1Jlc2VydmVkID0gNTAwMDsNCiAgICAvLyBIb3cgbWFueSB0b2tlbnMgcGVyIEVUSCBkdXJpbmcgdGhlIGNyb3dkc2FsZT8NCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCB3aG9sZVRva2Vuc1BlckV0aCA9IDUwMDA7DQogICAgDQogICAgLy8gU2V0IHRvIHRydWUgd2hlbiB0aGUgY3Jvd2RzYWxlIHN0YXJ0cw0KICAgIC8vIEludGVybmFsIGZsYWcuIFVzZSBpc0Nyb3dkc2FsZUFjdGl2ZSBpbnN0ZWFkKCkuDQogICAgYm9vbCBjcm93ZHNhbGVTdGFydGVkOw0KICAgIC8vIFNldCB0byB0cnVlIHdoZW4gdGhlIGNyb3dkc2FsZSBlbmRzDQogICAgLy8gSW50ZXJuYWwgZmxhZy4gVXNlIGlzQ3Jvd2RzYWxlQWN0aXZlIGluc3RlYWQoKS4NCiAgICBib29sIGNyb3dkc2FsZUVuZGVkOw0KICAgIC8vIFdlIGNhbiBhbHNvIHNldCBzb21lIHRpbWVycyB0byBvcGVuIGFuZCBjbG9zZSB0aGUgY3Jvd2RzYWxlLiAwID0gdGltZXIgaXMgbm90IHNldC4NCiAgICAvLyBBZnRlciB0aGlzIHRpbWUsIHRoZSBjcm93ZHNhbGUgd2lsbCBvcGVuIHdpdGggYSBjYWxsIHRvIGNoZWNrT3BlblRpbWVyKCkuDQogICAgdWludCBwdWJsaWMgb3BlblRpbWVyID0gMDsNCiAgICAvLyBBZnRlciB0aGlzIHRpbWUsIG5vIGNvbnRyaWJ1dGlvbnMgd2lsbCBiZSBhY2NlcHRlZCwgYW5kIHRoZSBjcm93ZHNhbGUgd2lsbCBjbG9zZSB3aXRoIGEgY2FsbCB0byBjaGVja0Nsb3NlVGltZXIoKS4NCiAgICB1aW50IHB1YmxpYyBjbG9zZVRpbWVyID0gMDsNCiAgICANCiAgICAvLy8vLy8vLy8vLy8NCiAgICAvLyBDb25zdHJ1Y3Rvcg0KICAgIC8vLy8vLy8vLy8vLw0KICAgIA0KICAgIC8qKg0KICAgICogRGVwbG95IGEgbmV3IE1SVlRva2VuIGNvbnRyYWN0LCBwYXlpbmcgY3Jvd2RzYWxlIHByb2NlZWRzIHRvIHRoZSBnaXZlbiBhZGRyZXNzLA0KICAgICogYW5kIGF3YXJkaW5nIHJlc2VydmVkIHRva2VucyB0byB0aGUgb3RoZXIgZ2l2ZW4gYWRkcmVzcy4NCiAgICAqLw0KICAgIGZ1bmN0aW9uIE1SVlRva2VuKGFkZHJlc3Mgc2VuZFByb2NlZWRzVG8sIGFkZHJlc3Mgc2VuZFRva2Vuc1RvKSB7DQogICAgICAgIC8vIFByb2NlZWRzIG9mIHRoZSBjcm93ZHNhbGUgZ28gaGVyZS4NCiAgICAgICAgYmVuZWZpY2lhcnkgPSBzZW5kUHJvY2VlZHNUbzsNCiAgICAgICAgDQogICAgICAgIC8vIFN0YXJ0IHdpdGggMTggZGVjaW1hbHMsIHNhbWUgYXMgRVRIDQogICAgICAgIGRlY2ltYWxzID0gMTg7DQogICAgICAgIA0KICAgICAgICAvLyBJbml0aWFsbHksIHRoZSByZXNlcnZlZCB0b2tlbnMgYmVsb25nIHRvIHRoZSBnaXZlbiBhZGRyZXNzLg0KICAgICAgICB0b3RhbFN1cHBseSA9IHdob2xlVG9rZW5zUmVzZXJ2ZWQgKiAxMCAqKiAxODsNCiAgICAgICAgYmFsYW5jZXNbc2VuZFRva2Vuc1RvXSA9IHRvdGFsU3VwcGx5Ow0KICAgICAgICANCiAgICAgICAgLy8gSW5pdGlhbGx5IHRoZSBjcm93ZHNhbGUgaGFzIG5vdCB5ZXQgc3RhcnRlZCBvciBlbmRlZC4NCiAgICAgICAgY3Jvd2RzYWxlU3RhcnRlZCA9IGZhbHNlOw0KICAgICAgICBjcm93ZHNhbGVFbmRlZCA9IGZhbHNlOw0KICAgICAgICAvLyBEZWZhdWx0IHRvIGEgbWF4IHN1cHBseSBvZiAxMDAgbWlsbGlvbiB0b2tlbnMgYXZhaWxhYmxlLg0KICAgICAgICBtYXhDcm93ZHNhbGVTdXBwbHlJbldob2xlVG9rZW5zID0gMTAwMDAwMDAwOw0KICAgIH0NCiAgICANCiAgICAvLy8vLy8vLy8vLy8NCiAgICAvLyBGYWxsYmFjayBmdW5jdGlvbg0KICAgIC8vLy8vLy8vLy8vLw0KICAgIA0KICAgIC8qKg0KICAgICogVGhpcyBpcyB0aGUgTUFJTiBDUk9XRFNBTEUgRU5UUlkgUE9JTlQuIFlvdSBwYXJ0aWNpcGF0ZSBpbiB0aGUgY3Jvd2RzYWxlIGJ5IA0KICAgICogc2VuZGluZyBFVEggdG8gdGhpcyBjb250cmFjdC4gVGhhdCBjYWxscyB0aGlzIGZ1bmN0aW9uLCB3aGljaCBjcmVkaXRzIHRva2Vucw0KICAgICogdG8gdGhlIGFkZHJlc3Mgb3IgY29udHJhY3QgdGhhdCBzZW50IHRoZSBFVEguDQogICAgKg0KICAgICogU2luY2UgTVJWIHRva2VucyBhcmUgc29sZCBhdCBhIHJhdGUgb2YgbW9yZSB0aGFuIG9uZSBwZXIgZXRoZXIsIGFuZCBzaW5jZQ0KICAgICogdGhleSwgbGlrZSBFVEgsIGhhdmUgMTggZGVjaW1hbCBwbGFjZXMgKGF0IHRoZSB0aW1lIG9mIHNhbGUpLCBhbnkgZnJhY3Rpb25hbA0KICAgICogYW1vdW50IG9mIEVUSCBzaG91bGQgYmUgaGFuZGxlZCBzYWZlbHkuDQogICAgKg0KICAgICogTm90ZSB0aGF0IGFsbCBvcmRlcnMgYXJlIGZpbGwtb3Ita2lsbC4gSWYgeW91IHNlbmQgaW4gbW9yZSBldGhlciB0aGFuIHRoZXJlIGFyZQ0KICAgICogdG9rZW5zIHJlbWFpbmluZyB0byBiZSBib3VnaHQsIHlvdXIgdHJhbnNhY3Rpb24gd2lsbCBiZSByb2xsZWQgYmFjayBhbmQgeW91IHdpbGwNCiAgICAqIGdldCBubyB0b2tlbnMgYW5kIHdhc3RlIHlvdXIgZ2FzLg0KICAgICovDQogICAgZnVuY3Rpb24oKSBwYXlhYmxlIG9ubHlEdXJpbmdDcm93ZHNhbGUgew0KICAgICAgICBjcmVhdGVUb2tlbnMobXNnLnNlbmRlcik7DQogICAgfQ0KICAgIA0KICAgIC8vLy8vLy8vLy8vLw0KICAgIC8vIEV2ZW50cw0KICAgIC8vLy8vLy8vLy8vLw0KICAgIA0KICAgIC8vIEZpcmVkIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyByZWNvcmRlZCBhcyBzdGFydGVkLg0KICAgIGV2ZW50IENyb3dkc2FsZU9wZW4odWludCB0aW1lKTsNCiAgICAvLyBGaXJlZCB3aGVuIHNvbWVvbmUgY29udHJpYnV0ZXMgdG8gdGhlIGNyb3dkc2FsZSBhbmQgYnV5cyBNUlYNCiAgICBldmVudCBUb2tlblB1cmNoYXNlKHVpbnQgdGltZSwgdWludCBldGhlckFtb3VudCwgYWRkcmVzcyBmcm9tKTsNCiAgICAvLyBGaXJlZCB3aGVuIHRoZSBjcm93ZHNhbGUgaXMgcmVjb3JkZWQgYXMgZW5kZWQuDQogICAgZXZlbnQgQ3Jvd2RzYWxlQ2xvc2UodWludCB0aW1lKTsNCiAgICAvLyBGaXJlZCB3aGVuIHRoZSBkZWNpbWFsIHBvaW50IG1vdmVzDQogICAgZXZlbnQgRGVjaW1hbENoYW5nZSh1aW50OCBuZXdEZWNpbWFscyk7DQogICAgDQogICAgLy8vLy8vLy8vLy8vDQogICAgLy8gTW9kaWZpZXJzIChlbmNvZGluZyBpbXBvcnRhbnQgY3Jvd2RzYWxlIGxvZ2ljKQ0KICAgIC8vLy8vLy8vLy8vLw0KICAgIA0KICAgIC8qKg0KICAgICAqIE9ubHkgYWxsb3cgc29tZSBhY3Rpb25zIGJlZm9yZSB0aGUgY3Jvd2RzYWxlIGNsb3Nlcywgd2hldGhlciBpdCdzIG9wZW4gb3Igbm90Lg0KICAgICAqLw0KICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVDbG9zZWQgew0KICAgICAgICBjaGVja0Nsb3NlVGltZXIoKTsNCiAgICAgICAgaWYgKGNyb3dkc2FsZUVuZGVkKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogT25seSBhbGxvdyBzb21lIGFjdGlvbnMgYWZ0ZXIgdGhlIGNyb3dkc2FsZSBpcyBvdmVyLg0KICAgICAqIFdpbGwgc2V0IHRoZSBjcm93ZHNhbGUgY2xvc2VkIGlmIGl0IHNob3VsZCBiZS4NCiAgICAgKi8NCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJDbG9zZWQgew0KICAgICAgICBjaGVja0Nsb3NlVGltZXIoKTsNCiAgICAgICAgaWYgKCFjcm93ZHNhbGVFbmRlZCkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIE9ubHkgYWxsb3cgc29tZSBhY3Rpb25zIGJlZm9yZSB0aGUgY3Jvd2RzYWxlIHN0YXJ0cy4NCiAgICAgKi8NCiAgICBtb2RpZmllciBvbmx5QmVmb3JlT3BlbmVkIHsNCiAgICAgICAgY2hlY2tPcGVuVGltZXIoKTsNCiAgICAgICAgaWYgKGNyb3dkc2FsZVN0YXJ0ZWQpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBPbmx5IGFsbG93IHNvbWUgYWN0aW9ucyB3aGlsZSB0aGUgY3Jvd2RzYWxlIGlzIGFjdGl2ZS4NCiAgICAgKiBXaWxsIHNldCB0aGUgY3Jvd2RzYWxlIG9wZW4gaWYgaXQgc2hvdWxkIGJlLg0KICAgICAqLw0KICAgIG1vZGlmaWVyIG9ubHlEdXJpbmdDcm93ZHNhbGUgew0KICAgICAgICBjaGVja09wZW5UaW1lcigpOw0KICAgICAgICBjaGVja0Nsb3NlVGltZXIoKTsNCiAgICAgICAgaWYgKGNyb3dkc2FsZUVuZGVkKSB0aHJvdzsNCiAgICAgICAgaWYgKCFjcm93ZHNhbGVTdGFydGVkKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vLy8NCiAgICAvLyBTdGF0dXMgYW5kIHV0aWxpdHkgZnVuY3Rpb25zDQogICAgLy8vLy8vLy8vLy8vDQogICAgDQogICAgLyoqDQogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBjcm93ZHNhbGUgc2hvdWxkIG9wZW4gYnkgdGltZXIuDQogICAgICovDQogICAgZnVuY3Rpb24gb3BlblRpbWVyRWxhcHNlZCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIChvcGVuVGltZXIgIT0gMCAmJiBub3cgPiBvcGVuVGltZXIpOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGNyb3dkc2FsZSBzaG91bGQgY2xvc2UgYnkgdGltZXIuDQogICAgICovDQogICAgZnVuY3Rpb24gY2xvc2VUaW1lckVsYXBzZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiAoY2xvc2VUaW1lciAhPSAwICYmIG5vdyA+IGNsb3NlVGltZXIpOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBJZiB0aGUgb3BlbiB0aW1lciBoYXMgZWxhcHNlZCwgc3RhcnQgdGhlIGNyb3dkc2FsZS4NCiAgICAgKiBDYW4gYmUgY2FsbGVkIGJ5IHBlb3BsZSwgYnV0IGFsc28gZ2V0cyBjYWxsZWQgd2hlbiBwZW9wbGUgdHJ5IHRvIGNvbnRyaWJ1dGUuDQogICAgICovDQogICAgZnVuY3Rpb24gY2hlY2tPcGVuVGltZXIoKSB7DQogICAgICAgIGlmIChvcGVuVGltZXJFbGFwc2VkKCkpIHsNCiAgICAgICAgICAgIGNyb3dkc2FsZVN0YXJ0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgb3BlblRpbWVyID0gMDsNCiAgICAgICAgICAgIENyb3dkc2FsZU9wZW4obm93KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBJZiB0aGUgY2xvc2UgdGltZXIgaGFzIGVsYXBzZWQsIHN0b3AgdGhlIGNyb3dkc2FsZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjaGVja0Nsb3NlVGltZXIoKSB7DQogICAgICAgIGlmIChjbG9zZVRpbWVyRWxhcHNlZCgpKSB7DQogICAgICAgICAgICBjcm93ZHNhbGVFbmRlZCA9IHRydWU7DQogICAgICAgICAgICBjbG9zZVRpbWVyID0gMDsNCiAgICAgICAgICAgIENyb3dkc2FsZUNsb3NlKG5vdyk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IGhhcHBlbmluZy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUFjdGl2ZSgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgLy8gVGhlIGNyb3dkc2FsZSBpcyBoYXBwZW5pbmcgaWYgaXQgaXMgb3BlbiBvciBkdWUgdG8gb3BlbiwgYW5kIGl0IGlzbid0IGNsb3NlZCBvciBkdWUgdG8gY2xvc2UuDQogICAgICAgIHJldHVybiAoKGNyb3dkc2FsZVN0YXJ0ZWQgfHwgb3BlblRpbWVyRWxhcHNlZCgpKSAmJiAhKGNyb3dkc2FsZUVuZGVkIHx8IGNsb3NlVGltZXJFbGFwc2VkKCkpKTsNCiAgICB9DQogICAgDQogICAgLy8vLy8vLy8vLy8vDQogICAgLy8gQmVmb3JlIHRoZSBjcm93ZHNhbGU6IGNvbmZpZ3VyYXRpb24NCiAgICAvLy8vLy8vLy8vLy8NCiAgICANCiAgICAvKioNCiAgICAgKiBCZWZvcmUgdGhlIGNyb3dkc2FsZSBvcGVucywgdGhlIG1heCB0b2tlbiBjb3VudCBjYW4gYmUgY29uZmlndXJlZC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzZXRNYXhTdXBwbHkodWludCBuZXdNYXhJbldob2xlVG9rZW5zKSBvbmx5T3duZXIgb25seUJlZm9yZU9wZW5lZCB7DQogICAgICAgIG1heENyb3dkc2FsZVN1cHBseUluV2hvbGVUb2tlbnMgPSBuZXdNYXhJbldob2xlVG9rZW5zOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBBbGxvdyB0aGUgb3duZXIgdG8gc3RhcnQgdGhlIGNyb3dkc2FsZSBtYW51YWxseS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBvcGVuQ3Jvd2RzYWxlKCkgb25seU93bmVyIG9ubHlCZWZvcmVPcGVuZWQgew0KICAgICAgICBjcm93ZHNhbGVTdGFydGVkID0gdHJ1ZTsNCiAgICAgICAgb3BlblRpbWVyID0gMDsNCiAgICAgICAgQ3Jvd2RzYWxlT3Blbihub3cpOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBMZXQgdGhlIG93bmVyIHN0YXJ0IHRoZSB0aW1lciBmb3IgdGhlIGNyb3dkc2FsZSBzdGFydC4gV2l0aG91dCBmdXJ0aGVyIG93bmVyIGludGVydmVudGlvbiwNCiAgICAgKiBhbnlvbmUgd2lsbCBiZSBhYmxlIHRvIG9wZW4gdGhlIGNyb3dkc2FsZSB3aGVuIHRoZSB0aW1lciBleHBpcmVzLg0KICAgICAqIEZ1cnRoZXIgY2FsbHMgd2lsbCByZS1zZXQgdGhlIHRpbWVyIHRvIGNvdW50IGZyb20gdGhlIHRpbWUgdGhlIHRyYW5zYWN0aW9uIGlzIHByb2Nlc3NlZC4NCiAgICAgKiBUaGUgdGltZXIgY2FuIGJlIHJlLXNldCBhZnRlciBpdCBoYXMgdHJpcHBlZCwgdW5sZXNzIHNvbWVvbmUgaGFzIGFscmVhZHkgb3BlbmVkIHRoZSBjcm93ZHNhbGUuDQogICAgICovDQogICAgZnVuY3Rpb24gc2V0Q3Jvd2RzYWxlT3BlblRpbWVyRm9yKHVpbnQgbWludXRlc0Zyb21Ob3cpIG9ubHlPd25lciBvbmx5QmVmb3JlT3BlbmVkIHsNCiAgICAgICAgb3BlblRpbWVyID0gbm93ICsgbWludXRlc0Zyb21Ob3cgKiAxIG1pbnV0ZXM7DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIExldCB0aGUgb3duZXIgc3RvcCB0aGUgY3Jvd2RzYWxlIG9wZW4gdGltZXIsIGFzIGxvbmcgYXMgdGhlIGNyb3dkc2FsZSBoYXMgbm90IHlldCBvcGVuZWQuDQogICAgICovDQogICAgZnVuY3Rpb24gY2xlYXJDcm93ZHNhbGVPcGVuVGltZXIoKSBvbmx5T3duZXIgb25seUJlZm9yZU9wZW5lZCB7DQogICAgICAgIG9wZW5UaW1lciA9IDA7DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIExldCB0aGUgb3duZXIgc3RhcnQgdGhlIHRpbWVyIGZvciB0aGUgY3Jvd2RzYWxlIGVuZC4gQ291bnRzIGZyb20gd2hlbiB0aGUgZnVuY3Rpb24gaXMgY2FsbGVkLA0KICAgICAqICpub3QqIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBjcm93ZHNhbGUuDQogICAgICogSXQgaXMgcG9zc2libGUsIGJ1dCBhIGJhZCBpZGVhLCB0byBzZXQgdGhpcyBiZWZvcmUgdGhlIG9wZW4gdGltZXIuDQogICAgICovDQogICAgZnVuY3Rpb24gc2V0Q3Jvd2RzYWxlQ2xvc2VUaW1lckZvcih1aW50IG1pbnV0ZXNGcm9tTm93KSBvbmx5T3duZXIgb25seUJlZm9yZUNsb3NlZCB7DQogICAgICAgIGNsb3NlVGltZXIgPSBub3cgKyBtaW51dGVzRnJvbU5vdyAqIDEgbWludXRlczsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogTGV0IHRoZSBvd25lciBzdG9wIHRoZSBjcm93ZHNhbGUgY2xvc2UgdGltZXIsIGFzIGxvbmcgYXMgaXQgaGFzIG5vdCB5ZXQgZXhwaXJlZC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjbGVhckNyb3dkc2FsZUNsb3NlVGltZXIoKSBvbmx5T3duZXIgb25seUJlZm9yZUNsb3NlZCB7DQogICAgICAgIGNsb3NlVGltZXIgPSAwOw0KICAgIH0NCiAgICANCiAgICANCiAgICAvLy8vLy8vLy8vLy8NCiAgICAvLyBEdXJpbmcgdGhlIGNyb3dkc2FsZQ0KICAgIC8vLy8vLy8vLy8vLw0KICAgIA0KICAgIC8qKg0KICAgICAqIENyZWF0ZSB0b2tlbnMgZm9yIHRoZSBnaXZlbiBhZGRyZXNzLCBpbiByZXNwb25zZSB0byBhIHBheW1lbnQuDQogICAgICogQ2Fubm90IGJlIGNhbGxlZCBieSBvdXRzaWRlIGNhbGxlcnM7IHVzZSB0aGUgZmFsbGJhY2sgZnVuY3Rpb24sIHdoaWNoIHdpbGwgY3JlYXRlIHRva2VucyBmb3Igd2hvZXZlciBwYXlzIGl0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZVRva2VucyhhZGRyZXNzIHJlY2lwaWVudCkgaW50ZXJuYWwgb25seUR1cmluZ0Nyb3dkc2FsZSB7DQogICAgICAgIGlmIChtc2cudmFsdWUgPT0gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICB1aW50IHRva2VucyA9IG1zZy52YWx1ZS5tdWwod2hvbGVUb2tlbnNQZXJFdGgpOyAvLyBFeHBsb2l0cyB0aGUgZmFjdCB0aGF0IHdlIGhhdmUgMTggZGVjaW1hbHMsIGxpa2UgRVRILg0KICAgICAgICANCiAgICAgICAgdmFyIG5ld1RvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKHRva2Vucyk7DQogICAgICAgIA0KICAgICAgICBpZiAobmV3VG90YWxTdXBwbHkgPiAod2hvbGVUb2tlbnNSZXNlcnZlZCArIG1heENyb3dkc2FsZVN1cHBseUluV2hvbGVUb2tlbnMpICogMTAgKiogMTgpIHsNCiAgICAgICAgICAgIC8vIFRoaXMgd291bGQgYmUgdG9vIG1hbnkgdG9rZW5zIGlzc3VlZC4NCiAgICAgICAgICAgIC8vIERvbid0IG1lc3MgYXJvdW5kIHdpdGggcGFydGlhbCBvcmRlciBmaWxscy4NCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBPdGhlcndpc2UsIHdlIGNhbiBmaWxsIHRoZSBvcmRlciBlbnRpcmVseSwgc28gbWFrZSB0aGUgdG9rZW5zIGFuZCBwdXQgdGhlbSBpbiB0aGUgc3BlY2lmaWVkIGFjY291bnQuDQogICAgICAgIHRvdGFsU3VwcGx5ID0gbmV3VG90YWxTdXBwbHk7DQogICAgICAgIGJhbGFuY2VzW3JlY2lwaWVudF0gPSBiYWxhbmNlc1tyZWNpcGllbnRdLmFkZCh0b2tlbnMpOw0KICAgICAgICANCiAgICAgICAgLy8gQW5ub3VuY2UgdGhlIHB1cmNoYXNlDQogICAgICAgIFRva2VuUHVyY2hhc2Uobm93LCBtc2cudmFsdWUsIHJlY2lwaWVudCk7DQoNCiAgICAgICAgLy8gTGFzdGx5IChhZnRlciBhbGwgc3RhdGUgY2hhbmdlcyksIHNlbmQgdGhlIG1vbmV5IHRvIHRoZSBjcm93ZHNhbGUgYmVuZWZpY2lhcnkuDQogICAgICAgIC8vIFRoaXMgYWxsb3dzIHRoZSBjcm93ZHNhbGUgY29udHJhY3QgaXRzZWxmIG5vdCB0byBob2xkIGFueSBFVEguDQogICAgICAgIC8vIEl0IGFsc28gbWVhbnMgdGhhdCBBTEwgU0FMRVMgQVJFIEZJTkFMIQ0KICAgICAgICBpZiAoIWJlbmVmaWNpYXJ5LnNlbmQobXNnLnZhbHVlKSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQWxsb3cgdGhlIG93bmVyIHRvIGVuZCB0aGUgY3Jvd2RzYWxlIG1hbnVhbGx5Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNsb3NlQ3Jvd2RzYWxlKCkgb25seU93bmVyIG9ubHlEdXJpbmdDcm93ZHNhbGUgew0KICAgICAgICBjcm93ZHNhbGVFbmRlZCA9IHRydWU7DQogICAgICAgIGNsb3NlVGltZXIgPSAwOw0KICAgICAgICBDcm93ZHNhbGVDbG9zZShub3cpOw0KICAgIH0gIA0KICAgIA0KICAgIC8vLy8vLy8vLy8vLw0KICAgIC8vIEFmdGVyIHRoZSBjcm93ZHNhbGU6IHRva2VuIG1haW50YWluYW5jZQ0KICAgIC8vLy8vLy8vLy8vLw0KICAgIA0KICAgIC8qKg0KICAgICAqIFdoZW4gdGhlIGNyb3dkc2FsZSBpcyBmaW5pc2hlZCwgdGhlIGNvbnRyYWN0IG93bmVyIG1heSBhZGp1c3QgdGhlIGRlY2ltYWwgcGxhY2VzIGZvciBkaXNwbGF5IHB1cnBvc2VzLg0KICAgICAqIFRoaXMgc2hvdWxkIHdvcmsgbGlrZSBhIDEwLXRvLTEgc3BsaXQgb3IgcmV2ZXJzZS1zcGxpdC4NCiAgICAgKiBUaGUgcG9pbnQgb2YgdGhpcyBtZWNoYW5pc20gaXMgdG8ga2VlcCB0aGUgaW5kaXZpZHVhbCBNUlYgdG9rZW5zIGZyb20gZ2V0dGluZyBpbmNvbnZlbmllbnRseSB2YWx1YWJsZSBvciBjaGVhcC4NCiAgICAgKiBIb3dldmVyLCBpdCByZWxpZXMgb24gdGhlIGNvbnRyYWN0IG93bmVyIHRha2luZyB0aGUgdGltZSB0byB1cGRhdGUgdGhlIGRlY2ltYWwgcGxhY2UgdmFsdWUuDQogICAgICogTm90ZSB0aGF0IHRoaXMgY2hhbmdlcyB0aGUgZGVjaW1hbHMgSU1NRURJQVRFTFkgd2l0aCBOTyBOT1RJQ0UgdG8gdXNlcnMuDQogICAgICovDQogICAgZnVuY3Rpb24gc2V0RGVjaW1hbHModWludDggbmV3RGVjaW1hbHMpIG9ubHlPd25lciBvbmx5QWZ0ZXJDbG9zZWQgew0KICAgICAgICBkZWNpbWFscyA9IG5ld0RlY2ltYWxzOw0KICAgICAgICAvLyBBbm5vdW5jZSB0aGUgY2hhbmdlDQogICAgICAgIERlY2ltYWxDaGFuZ2UoZGVjaW1hbHMpOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBJZiBFdGhlciBzb21laG93IG1hbmFnZXMgdG8gZ2V0IGludG8gdGhpcyBjb250cmFjdCwgcHJvdmlkZSBhIHdheSB0byBnZXQgaXQgb3V0IGFnYWluLg0KICAgICAqIER1cmluZyBub3JtYWwgY3Jvd2RzYWxlIG9wZXJhdGlvbiwgRVRIIGlzIGltbWVkaWF0ZWx5IGZvcndhcmRlZCB0byB0aGUgYmVuZWZpY2lhcnkuDQogICAgICovDQogICAgZnVuY3Rpb24gcmVjbGFpbUV0aGVyKCkgZXh0ZXJuYWwgb25seU93bmVyIHsNCiAgICAgICAgLy8gU2VuZCB0aGUgRVRILiBNYWtlIHN1cmUgaXQgd29ya2VkLg0KICAgICAgICBhc3NlcnQob3duZXIuc2VuZCh0aGlzLmJhbGFuY2UpKTsNCiAgICB9DQoNCn0='