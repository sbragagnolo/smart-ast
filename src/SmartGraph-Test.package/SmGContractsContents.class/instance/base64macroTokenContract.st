base 64 content
base64macroTokenContract
	^'Y29udHJhY3QgSVByb3h5TWFuYWdlbWVudCB7IA0KICAgIGZ1bmN0aW9uIGlzUHJveHlMZWdpdChhZGRyZXNzIF9hZGRyZXNzKSByZXR1cm5zIChib29sKXt9DQogICAgZnVuY3Rpb24gcmFpc2VUcmFuc2ZlckV2ZW50KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW1vdW50KXt9DQogICAgZnVuY3Rpb24gcmFpc2VBcHByb3ZhbEV2ZW50KGFkZHJlc3MgX3NlbmRlcixhZGRyZXNzIF9zcGVuZGVyLHVpbnQgX3ZhbHVlKXt9DQogICAgZnVuY3Rpb24gZGVkaWNhdGVkUHJveHlBZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBjb250cmFjdEFkZHJlc3Mpe30NCn0NCg0KY29udHJhY3QgSVRva2VuUmVjaXBpZW50IHsgDQoJZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ZhbHVlLCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2V4dHJhRGF0YSk7IA0KfQ0KDQpjb250cmFjdCBJRnVuZE1hbmFnZW1lbnQgew0KCWZ1bmN0aW9uIGZ1bmRzQ29tYmluZWRWYWx1ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdmFsdWUpe30NCiAgICBmdW5jdGlvbiBnZXRGdW5kQWx0ZXJhdGlvbnMoKSByZXR1cm5zICh1aW50IGFsdGVyYXRpb25zKXt9DQp9DQoNCmNvbnRyYWN0IElFUkMyMFRva2VuIHsNCg0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOw0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOw0KDQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7DQogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7DQp9DQoNCmNvbnRyYWN0IE1hY3JvVG9rZW5Db250cmFjdHsNCiAgICANCiAgICBhZGRyZXNzIHB1YmxpYyBkZXY7DQogICAgYWRkcmVzcyBwdWJsaWMgY3VyYXRvcjsNCiAgICBhZGRyZXNzIHB1YmxpYyBtaW50aW5nQ29udHJhY3RBZGRyZXNzOw0KICAgIGFkZHJlc3MgcHVibGljIGRlc3RydWN0aW9uQ29udHJhY3RBZGRyZXNzOw0KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5ID0gMDsNCiAgICBib29sIHB1YmxpYyBsb2NrZG93biA9IGZhbHNlOw0KDQogICAgc3RyaW5nIHB1YmxpYyBzdGFuZGFyZCA9ICdNYWNybyB0b2tlbic7DQogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gJ01hY3JvJzsNCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICdNQ1InOw0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFscyA9IDg7DQoNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsNCiAgICBJUHJveHlNYW5hZ2VtZW50IHByb3h5TWFuYWdlbWVudENvbnRyYWN0Ow0KICAgIElGdW5kTWFuYWdlbWVudCBmdW5kTWFuYWdlbWVudENvbnRyYWN0Ow0KDQogICAgdWludCBwdWJsaWMgd2VpRm9yTWNyOw0KICAgIHVpbnQgcHVibGljIG1jckFtbW91bnRGb3JHYXM7DQoNCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBNaW50KGFkZHJlc3MgX2Rlc3RpbmF0aW9uLCB1aW50IF9hbW91bnQpOw0KICAgIGV2ZW50IERlc3Ryb3koYWRkcmVzcyBfZGVzdGluYXRpb24sIHVpbnQgX2Ftb3VudCk7DQogICAgZXZlbnQgTWNyRm9yR2FzRmFpbGVkKGFkZHJlc3MgX2ZhaWxlZEFkZHJlc3MsIHVpbnQgX2FtbW91bnQpOw0KDQogICAgZnVuY3Rpb24gTWFjcm9Ub2tlbkNvbnRyYWN0KCkgeyANCiAgICAgICAgZGV2ID0gbXNnLnNlbmRlcjsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3Mpew0KICAgICAgICBpZihiYWxhbmNlc1ttc2cuc2VuZGVyXSA8IF92YWx1ZSkgdGhyb3c7DQogICAgICAgIGlmKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPD0gYmFsYW5jZXNbX3RvXSkgdGhyb3c7DQogICAgICAgIGlmKGxvY2tkb3duKSB0aHJvdzsNCg0KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7DQogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOw0KICAgICAgICBjcmVhdGVUcmFuc2ZlckV2ZW50KHRydWUsIG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsgICAgICAgICAgICAgIA0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYoYmFsYW5jZXNbX2Zyb21dIDwgX3ZhbHVlKSB0aHJvdzsNCiAgICAgICAgaWYoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA8PSBiYWxhbmNlc1tfdG9dKSB0aHJvdzsNCiAgICAgICAgaWYoX3ZhbHVlID4gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pIHRocm93Ow0KICAgICAgICBpZihsb2NrZG93bikgdGhyb3c7DQoNCiAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsNCiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7DQogICAgICAgIGNyZWF0ZVRyYW5zZmVyRXZlbnQodHJ1ZSwgX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYobG9ja2Rvd24pIHRocm93Ow0KICAgICAgICANCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgICAgIGNyZWF0ZUFwcHJvdmFsRXZlbnQodHJ1ZSwgbXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsNCiAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyVmlhUHJveHkoYWRkcmVzcyBfc291cmNlLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3Mpew0KICAgICAgICBpZiAoIXByb3h5TWFuYWdlbWVudENvbnRyYWN0LmlzUHJveHlMZWdpdChtc2cuc2VuZGVyKSkgdGhyb3c7DQogICAgICAgIGlmIChiYWxhbmNlc1tfc291cmNlXSA8IF9hbW91bnQpIHRocm93Ow0KICAgICAgICBpZiAoYmFsYW5jZXNbX3RvXSArIF9hbW91bnQgPD0gYmFsYW5jZXNbX3RvXSkgdGhyb3c7DQogICAgICAgIGlmIChsb2NrZG93bikgdGhyb3c7DQoNCiAgICAgICAgYmFsYW5jZXNbX3NvdXJjZV0gLT0gX2Ftb3VudDsNCiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfYW1vdW50Ow0KDQogICAgICAgIGlmIChtc2cuc2VuZGVyID09IHByb3h5TWFuYWdlbWVudENvbnRyYWN0LmRlZGljYXRlZFByb3h5QWRkcmVzcygpKXsNCiAgICAgICAgICAgIGNyZWF0ZVRyYW5zZmVyRXZlbnQoZmFsc2UsIF9zb3VyY2UsIF90bywgX2Ftb3VudCk7IA0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIGNyZWF0ZVRyYW5zZmVyRXZlbnQodHJ1ZSwgX3NvdXJjZSwgX3RvLCBfYW1vdW50KTsgDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbVZpYVByb3h5KGFkZHJlc3MgX3NvdXJjZSwgYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmICghcHJveHlNYW5hZ2VtZW50Q29udHJhY3QuaXNQcm94eUxlZ2l0KG1zZy5zZW5kZXIpKSB0aHJvdzsNCiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA8IF9hbW91bnQpIHRocm93Ow0KICAgICAgICBpZiAoYmFsYW5jZXNbX3RvXSArIF9hbW91bnQgPD0gYmFsYW5jZXNbX3RvXSkgdGhyb3c7DQogICAgICAgIGlmIChsb2NrZG93bikgdGhyb3c7DQogICAgICAgIGlmIChfYW1vdW50ID4gYWxsb3dlZFtfZnJvbV1bX3NvdXJjZV0pIHRocm93Ow0KDQogICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfYW1vdW50Ow0KICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF9hbW91bnQ7DQogICAgICAgIGFsbG93ZWRbX2Zyb21dW19zb3VyY2VdIC09IF9hbW91bnQ7DQoNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gcHJveHlNYW5hZ2VtZW50Q29udHJhY3QuZGVkaWNhdGVkUHJveHlBZGRyZXNzKCkpew0KICAgICAgICAgICAgY3JlYXRlVHJhbnNmZXJFdmVudChmYWxzZSwgX3NvdXJjZSwgX3RvLCBfYW1vdW50KTsgDQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgY3JlYXRlVHJhbnNmZXJFdmVudCh0cnVlLCBfc291cmNlLCBfdG8sIF9hbW91bnQpOyANCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gYXBwcm92ZVZpYVByb3h5KGFkZHJlc3MgX3NvdXJjZSwgYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoIXByb3h5TWFuYWdlbWVudENvbnRyYWN0LmlzUHJveHlMZWdpdChtc2cuc2VuZGVyKSkgdGhyb3c7DQogICAgICAgIGlmKGxvY2tkb3duKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIGFsbG93ZWRbX3NvdXJjZV1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBwcm94eU1hbmFnZW1lbnRDb250cmFjdC5kZWRpY2F0ZWRQcm94eUFkZHJlc3MoKSl7DQogICAgICAgICAgICBjcmVhdGVBcHByb3ZhbEV2ZW50KGZhbHNlLCBfc291cmNlLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBjcmVhdGVBcHByb3ZhbEV2ZW50KHRydWUsIF9zb3VyY2UsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfZGVzdGluYXRpb24sIHVpbnQgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKXsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gbWludGluZ0NvbnRyYWN0QWRkcmVzcykgdGhyb3c7DQogICAgICAgIGlmKGJhbGFuY2VzW19kZXN0aW5hdGlvbl0gKyBfYW1vdW50IDwgYmFsYW5jZXNbX2Rlc3RpbmF0aW9uXSkgdGhyb3c7DQogICAgICAgIGlmKHRvdGFsU3VwcGx5ICsgX2Ftb3VudCA8IHRvdGFsU3VwcGx5KSB0aHJvdzsNCg0KICAgICAgICB0b3RhbFN1cHBseSArPSBfYW1vdW50Ow0KICAgICAgICBiYWxhbmNlc1tfZGVzdGluYXRpb25dICs9IF9hbW91bnQ7DQogICAgICAgIE1pbnQoX2Rlc3RpbmF0aW9uLCBfYW1vdW50KTsNCiAgICAgICAgY3JlYXRlVHJhbnNmZXJFdmVudCh0cnVlLCAweDAsIF9kZXN0aW5hdGlvbiwgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGRlc3Ryb3koYWRkcmVzcyBfZGVzdGluYXRpb24sIHVpbnQgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGRlc3RydWN0aW9uQ29udHJhY3RBZGRyZXNzKSB0aHJvdzsNCiAgICAgICAgaWYgKGJhbGFuY2VzW19kZXN0aW5hdGlvbl0gPCBfYW1vdW50KSB0aHJvdzsNCg0KICAgICAgICB0b3RhbFN1cHBseSAtPSBfYW1vdW50Ow0KICAgICAgICBiYWxhbmNlc1tfZGVzdGluYXRpb25dIC09IF9hbW91bnQ7DQogICAgICAgIERlc3Ryb3koX2Rlc3RpbmF0aW9uLCBfYW1vdW50KTsNCiAgICAgICAgY3JlYXRlVHJhbnNmZXJFdmVudCh0cnVlLCBfZGVzdGluYXRpb24sIDB4MCwgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldFRva2VuQ3VyYXRvcihhZGRyZXNzIF9jdXJhdG9yQWRkcmVzcyl7DQogICAgICAgIGlmKCBtc2cuc2VuZGVyICE9IGRldikgdGhyb3c7DQogICAgICAgIGN1cmF0b3IgPSBfY3VyYXRvckFkZHJlc3M7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHNldE1pbnRpbmdDb250cmFjdEFkZHJlc3MoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzKXsgDQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGN1cmF0b3IpIHRocm93Ow0KICAgICAgICBtaW50aW5nQ29udHJhY3RBZGRyZXNzID0gX2NvbnRyYWN0QWRkcmVzczsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZXREZXNjcnV0aW9uQ29udHJhY3RBZGRyZXNzKGFkZHJlc3MgX2NvbnRyYWN0QWRkcmVzcyl7IA0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjdXJhdG9yKSB0aHJvdzsNCiAgICAgICAgZGVzdHJ1Y3Rpb25Db250cmFjdEFkZHJlc3MgPSBfY29udHJhY3RBZGRyZXNzOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldFByb3h5TWFuYWdlbWVudENvbnRyYWN0KGFkZHJlc3MgX2NvbnRyYWN0QWRkcmVzcyl7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGN1cmF0b3IpIHRocm93Ow0KICAgICAgICBwcm94eU1hbmFnZW1lbnRDb250cmFjdCA9IElQcm94eU1hbmFnZW1lbnQoX2NvbnRyYWN0QWRkcmVzcyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0RnVuZE1hbmFnZW1lbnRDb250cmFjdChhZGRyZXNzIF9jb250cmFjdEFkZHJlc3Mpew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjdXJhdG9yKSB0aHJvdzsNCiAgICAgICAgZnVuZE1hbmFnZW1lbnRDb250cmFjdCA9IElGdW5kTWFuYWdlbWVudChfY29udHJhY3RBZGRyZXNzKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBlbWVyZ2VuY3lMb2NrKCkgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjdXJhdG9yICYmIG1zZy5zZW5kZXIgIT0gZGV2KSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIGxvY2tkb3duID0gIWxvY2tkb3duOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGtpbGxDb250cmFjdCgpew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBkZXYpIHRocm93Ow0KICAgICAgICBzZWxmZGVzdHJ1Y3QoZGV2KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZXRXZWlGb3JNY3IodWludCBfdmFsdWUpew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjdXJhdG9yKSB0aHJvdzsNCiAgICAgICAgd2VpRm9yTWNyID0gX3ZhbHVlOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBzZXRNY3JBbW91bnRGb3JHYXModWludCBfdmFsdWUpew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjdXJhdG9yKSB0aHJvdzsNCiAgICAgICAgbWNyQW1tb3VudEZvckdhcyA9IF92YWx1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRHYXNGb3JNY3IoKXsNCiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgbWNyQW1tb3VudEZvckdhcykgdGhyb3c7DQogICAgICAgIGlmIChiYWxhbmNlc1tjdXJhdG9yXSA+IGJhbGFuY2VzW2N1cmF0b3JdICsgbWNyQW1tb3VudEZvckdhcykgdGhyb3c7DQogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPCB3ZWlGb3JNY3IgKiBtY3JBbW1vdW50Rm9yR2FzKSB0aHJvdzsNCg0KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBtY3JBbW1vdW50Rm9yR2FzOw0KICAgICAgICBiYWxhbmNlc1tjdXJhdG9yXSArPSBtY3JBbW1vdW50Rm9yR2FzOw0KICAgICAgICBjcmVhdGVUcmFuc2ZlckV2ZW50KHRydWUsIG1zZy5zZW5kZXIsIGN1cmF0b3IsIHdlaUZvck1jciAqIG1jckFtbW91bnRGb3JHYXMpOw0KICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh3ZWlGb3JNY3IgKiBtY3JBbW1vdW50Rm9yR2FzKSkgew0KICAgICAgICAgICAgTWNyRm9yR2FzRmFpbGVkKG1zZy5zZW5kZXIsIHdlaUZvck1jciAqIG1jckFtbW91bnRGb3JHYXMpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZnVuZE1hbmFnZW1lbnRBZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBmdW5kTWFuYWdlbWVudEFkZHJlc3Mpew0KICAgICAgICByZXR1cm4gYWRkcmVzcyhmdW5kTWFuYWdlbWVudENvbnRyYWN0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwcm94eU1hbmFnZW1lbnRBZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBwcm94eU1hbmFnZW1lbnRBZGRyZXNzKXsNCiAgICAgICAgcmV0dXJuIGFkZHJlc3MocHJveHlNYW5hZ2VtZW50Q29udHJhY3QpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGZ1bmRzQ29tYmluZWRWYWx1ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdmFsdWUpew0KICAgICAgICByZXR1cm4gZnVuZE1hbmFnZW1lbnRDb250cmFjdC5mdW5kc0NvbWJpbmVkVmFsdWUoKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRHYXNGb3JNY3JEYXRhKCkgY29uc3RhbnQgcmV0dXJucyAodWludCwgdWludCl7DQogICAgICAgIHJldHVybiAod2VpRm9yTWNyLCBtY3JBbW1vdW50Rm9yR2FzKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2V4dHJhRGF0YSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgICAgICBJVG9rZW5SZWNpcGllbnQgc3BlbmRlciA9IElUb2tlblJlY2lwaWVudChfc3BlbmRlcik7DQogICAgICAgIHNwZW5kZXIucmVjZWl2ZUFwcHJvdmFsKG1zZy5zZW5kZXIsIF92YWx1ZSwgdGhpcywgX2V4dHJhRGF0YSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNyZWF0ZVRyYW5zZmVyRXZlbnQoYm9vbCBfcmVsYXlFdmVudCwgYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCB7DQogICAgICAgIGlmIChfcmVsYXlFdmVudCl7DQogICAgICAgICAgICBwcm94eU1hbmFnZW1lbnRDb250cmFjdC5yYWlzZVRyYW5zZmVyRXZlbnQoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNyZWF0ZUFwcHJvdmFsRXZlbnQoYm9vbCBfcmVsYXlFdmVudCwgYWRkcmVzcyBfc2VuZGVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgaW50ZXJuYWwgew0KICAgICAgICBpZiAoX3JlbGF5RXZlbnQpew0KICAgICAgICAgICAgcHJveHlNYW5hZ2VtZW50Q29udHJhY3QucmFpc2VBcHByb3ZhbEV2ZW50KF9zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIEFwcHJvdmFsKF9zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBmaWxsQ29udHJhY3QoKSBwYXlhYmxlew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjdXJhdG9yKSB0aHJvdzsNCiAgICB9DQp9'