base 64 content
base64market
	^'Y29udHJhY3QgTWFya2V0IHsNCg0KICBzdHJ1Y3QgT3B0aW9uIHsNCiAgICBpbnQgc3RyaWtlOw0KICB9DQogIHN0cnVjdCBQb3NpdGlvbiB7DQogICAgbWFwcGluZyh1aW50ID0+IGludCkgcG9zaXRpb25zOw0KICAgIGludCBjYXNoOw0KICAgIGJvb2wgZXhwaXJlZDsNCiAgICBib29sIGhhc1Bvc2l0aW9uOw0KICB9DQogIHN0cnVjdCBPcHRpb25DaGFpbiB7DQogICAgdWludCBleHBpcmF0aW9uOw0KICAgIHN0cmluZyB1bmRlcmx5aW5nOw0KICAgIHVpbnQgbWFyZ2luOw0KICAgIHVpbnQgcmVhbGl0eUlEOw0KICAgIGJ5dGVzMzIgZmFjdEhhc2g7DQogICAgYWRkcmVzcyBldGhBZGRyOw0KICAgIG1hcHBpbmcodWludCA9PiBPcHRpb24pIG9wdGlvbnM7DQogICAgdWludCBudW1PcHRpb25zOw0KICAgIGJvb2wgZXhwaXJlZDsNCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gUG9zaXRpb24pIHBvc2l0aW9uczsNCiAgICB1aW50IG51bVBvc2l0aW9uczsNCiAgICB1aW50IG51bVBvc2l0aW9uc0V4cGlyZWQ7DQogIH0NCiAgbWFwcGluZyh1aW50ID0+IE9wdGlvbkNoYWluKSBvcHRpb25DaGFpbnM7DQogIHVpbnQgbnVtT3B0aW9uQ2hhaW5zOw0KICBzdHJ1Y3QgQWNjb3VudCB7DQogICAgYWRkcmVzcyB1c2VyOw0KICAgIGludCBjYXBpdGFsOw0KICB9DQogIG1hcHBpbmcoYnl0ZXMzMiA9PiBpbnQpIG9yZGVyRmlsbHM7IC8va2VlcHMgdHJhY2sgb2YgY3VtdWxhdGl2ZSBvcmRlciBmaWxscw0KICBzdHJ1Y3QgTWFya2V0TWFrZXIgew0KICAgIGFkZHJlc3MgdXNlcjsNCiAgICBzdHJpbmcgc2VydmVyOw0KICB9DQogIG1hcHBpbmcodWludCA9PiBNYXJrZXRNYWtlcikgbWFya2V0TWFrZXJzOyAvL3N0YXJ0cyBhdCAxDQogIHVpbnQgcHVibGljIG51bU1hcmtldE1ha2VycyA9IDA7DQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBtYXJrZXRNYWtlcklEczsNCiAgbWFwcGluZyh1aW50ID0+IEFjY291bnQpIGFjY291bnRzOw0KICB1aW50IG51bUFjY291bnRzOw0KICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYWNjb3VudElEczsgLy9zdGFydHMgYXQgMQ0KDQogIGZ1bmN0aW9uIE1hcmtldCgpIHsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFkZEZ1bmRzKCkgew0KICAgIGlmIChhY2NvdW50SURzW21zZy5zZW5kZXJdPjApIHsNCiAgICAgIGFjY291bnRzW2FjY291bnRJRHNbbXNnLnNlbmRlcl1dLmNhcGl0YWwgKz0gaW50KG1zZy52YWx1ZSk7DQogICAgfSBlbHNlIHsNCiAgICAgIHVpbnQgYWNjb3VudElEID0gKytudW1BY2NvdW50czsNCiAgICAgIGFjY291bnRzW2FjY291bnRJRF0udXNlciA9IG1zZy5zZW5kZXI7DQogICAgICBhY2NvdW50c1thY2NvdW50SURdLmNhcGl0YWwgKz0gaW50KG1zZy52YWx1ZSk7DQogICAgICBhY2NvdW50SURzW21zZy5zZW5kZXJdID0gYWNjb3VudElEOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHdpdGhkcmF3RnVuZHModWludCBhbW91bnQpIHsNCiAgICBpZiAoYWNjb3VudElEc1ttc2cuc2VuZGVyXT4wKSB7DQogICAgICBpZiAoaW50KGFtb3VudCk8PWdldEZ1bmRzKG1zZy5zZW5kZXIsIHRydWUpICYmIGludChhbW91bnQpPjApIHsNCiAgICAgICAgYWNjb3VudHNbYWNjb3VudElEc1ttc2cuc2VuZGVyXV0uY2FwaXRhbCAtPSBpbnQoYW1vdW50KTsNCiAgICAgICAgbXNnLnNlbmRlci5zZW5kKGFtb3VudCk7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0RnVuZHMoYWRkcmVzcyB1c2VyLCBib29sIG9ubHlBdmFpbGFibGUpIGNvbnN0YW50IHJldHVybnMoaW50KSB7DQogICAgaWYgKGFjY291bnRJRHNbdXNlcl0+MCkgew0KICAgICAgaWYgKG9ubHlBdmFpbGFibGUgPT0gZmFsc2UpIHsNCiAgICAgICAgcmV0dXJuIGFjY291bnRzW2FjY291bnRJRHNbdXNlcl1dLmNhcGl0YWw7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gYWNjb3VudHNbYWNjb3VudElEc1t1c2VyXV0uY2FwaXRhbCArIGdldE1heExvc3NBZnRlclRyYWRlKHVzZXIsIDAsIDAsIDAsIDApOw0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICByZXR1cm4gMDsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBnZXRGdW5kc0FuZEF2YWlsYWJsZShhZGRyZXNzIHVzZXIpIGNvbnN0YW50IHJldHVybnMoaW50LCBpbnQpIHsNCiAgICByZXR1cm4gKGdldEZ1bmRzKHVzZXIsIGZhbHNlKSwgZ2V0RnVuZHModXNlciwgdHJ1ZSkpOw0KICB9DQoNCiAgZnVuY3Rpb24gbWFya2V0TWFrZXIoc3RyaW5nIHNlcnZlcikgew0KICAgIGlmIChtc2cudmFsdWU+MCkgdGhyb3c7DQogICAgaWYgKG1hcmtldE1ha2VySURzW21zZy5zZW5kZXJdPjApIHsNCiAgICAgIG1hcmtldE1ha2Vyc1ttYXJrZXRNYWtlcklEc1ttc2cuc2VuZGVyXV0uc2VydmVyID0gc2VydmVyOw0KICAgIH0gZWxzZSB7DQogICAgICBpbnQgZnVuZHMgPSBnZXRGdW5kcyhtYXJrZXRNYWtlcnNbaV0udXNlciwgZmFsc2UpOw0KICAgICAgdWludCBtYXJrZXRNYWtlcklEID0gMDsNCiAgICAgIGlmIChudW1NYXJrZXRNYWtlcnM8Nikgew0KICAgICAgICBtYXJrZXRNYWtlcklEID0gKytudW1NYXJrZXRNYWtlcnM7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBmb3IgKHVpbnQgaT0yOyBpPD1udW1NYXJrZXRNYWtlcnM7IGkrKykgew0KICAgICAgICAgIGlmIChnZXRGdW5kcyhtYXJrZXRNYWtlcnNbaV0udXNlciwgZmFsc2UpPD1mdW5kcyAmJiAobWFya2V0TWFrZXJJRD09MCB8fCBnZXRGdW5kcyhtYXJrZXRNYWtlcnNbaV0udXNlciwgZmFsc2UpPGdldEZ1bmRzKG1hcmtldE1ha2Vyc1ttYXJrZXRNYWtlcklEXS51c2VyLCBmYWxzZSkpKSB7DQogICAgICAgICAgICBtYXJrZXRNYWtlcklEID0gaTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGlmIChtYXJrZXRNYWtlcklEPjApIHsNCiAgICAgICAgbWFya2V0TWFrZXJJRHNbbWFya2V0TWFrZXJzW21hcmtldE1ha2VySURdLnVzZXJdID0gMDsNCiAgICAgICAgbWFya2V0TWFrZXJzW21hcmtldE1ha2VySURdLnVzZXIgPSBtc2cuc2VuZGVyOw0KICAgICAgICBtYXJrZXRNYWtlcnNbbWFya2V0TWFrZXJJRF0uc2VydmVyID0gc2VydmVyOw0KICAgICAgICBtYXJrZXRNYWtlcklEc1ttc2cuc2VuZGVyXSA9IG1hcmtldE1ha2VySUQ7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aHJvdzsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBnZXRNYXJrZXRNYWtlcnMoKSBjb25zdGFudCByZXR1cm5zKHN0cmluZywgc3RyaW5nLCBzdHJpbmcsIHN0cmluZywgc3RyaW5nLCBzdHJpbmcpIHsNCiAgICBzdHJpbmdbXSBtZW1vcnkgc2VydmVycyA9IG5ldyBzdHJpbmdbXSg2KTsNCiAgICBmb3IgKHVpbnQgaT0xOyBpPD1udW1NYXJrZXRNYWtlcnM7IGkrKykgew0KICAgICAgc2VydmVyc1tpLTFdID0gbWFya2V0TWFrZXJzW2ldLnNlcnZlcjsNCiAgICB9DQogICAgcmV0dXJuIChzZXJ2ZXJzWzBdLCBzZXJ2ZXJzWzFdLCBzZXJ2ZXJzWzJdLCBzZXJ2ZXJzWzNdLCBzZXJ2ZXJzWzRdLCBzZXJ2ZXJzWzVdKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldE1hcmtldE1ha2VyRnVuZHMoKSBjb25zdGFudCByZXR1cm5zKGludCwgaW50LCBpbnQsIGludCwgaW50LCBpbnQpIHsNCiAgICBpbnRbXSBtZW1vcnkgZnVuZHMgPSBuZXcgaW50W10oNik7DQogICAgZm9yICh1aW50IGk9MTsgaTw9bnVtTWFya2V0TWFrZXJzOyBpKyspIHsNCiAgICAgIGZ1bmRzW2ktMV0gPSBnZXRGdW5kcyhtYXJrZXRNYWtlcnNbaV0udXNlciwgZmFsc2UpOw0KICAgIH0NCiAgICByZXR1cm4gKGZ1bmRzWzBdLCBmdW5kc1sxXSwgZnVuZHNbMl0sIGZ1bmRzWzNdLCBmdW5kc1s0XSwgZnVuZHNbNV0pOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0T3B0aW9uQ2hhaW4odWludCBvcHRpb25DaGFpbklEKSBjb25zdGFudCByZXR1cm5zICh1aW50LCBzdHJpbmcsIHVpbnQsIHVpbnQsIGJ5dGVzMzIsIGFkZHJlc3MpIHsNCiAgICByZXR1cm4gKG9wdGlvbkNoYWluc1tvcHRpb25DaGFpbklEXS5leHBpcmF0aW9uLCBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0udW5kZXJseWluZywgb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLm1hcmdpbiwgb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLnJlYWxpdHlJRCwgb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLmZhY3RIYXNoLCBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0uZXRoQWRkcik7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRNYXJrZXQoYWRkcmVzcyB1c2VyKSBjb25zdGFudCByZXR1cm5zKHVpbnRbXSwgaW50W10sIGludFtdLCBpbnRbXSkgew0KICAgIHVpbnRbXSBtZW1vcnkgb3B0aW9uSURzID0gbmV3IHVpbnRbXSg2MCk7DQogICAgaW50W10gbWVtb3J5IHN0cmlrZXMgPSBuZXcgaW50W10oNjApOw0KICAgIGludFtdIG1lbW9yeSBwb3NpdGlvbnMgPSBuZXcgaW50W10oNjApOw0KICAgIGludFtdIG1lbW9yeSBjYXNoZXMgPSBuZXcgaW50W10oNjApOw0KICAgIHVpbnQgeiA9IDA7DQogICAgZm9yIChpbnQgb3B0aW9uQ2hhaW5JRD1pbnQobnVtT3B0aW9uQ2hhaW5zKS0xOyBvcHRpb25DaGFpbklEPj0wICYmIHo8NjA7IG9wdGlvbkNoYWluSUQtLSkgew0KICAgICAgaWYgKG9wdGlvbkNoYWluc1t1aW50KG9wdGlvbkNoYWluSUQpXS5leHBpcmVkID09IGZhbHNlKSB7DQogICAgICAgIGZvciAodWludCBvcHRpb25JRD0wOyBvcHRpb25JRDxvcHRpb25DaGFpbnNbdWludChvcHRpb25DaGFpbklEKV0ubnVtT3B0aW9uczsgb3B0aW9uSUQrKykgew0KICAgICAgICAgIG9wdGlvbklEc1t6XSA9IHVpbnQob3B0aW9uQ2hhaW5JRCkqMTAwMCArIG9wdGlvbklEOw0KICAgICAgICAgIHN0cmlrZXNbel0gPSBvcHRpb25DaGFpbnNbdWludChvcHRpb25DaGFpbklEKV0ub3B0aW9uc1tvcHRpb25JRF0uc3RyaWtlOw0KICAgICAgICAgIHBvc2l0aW9uc1t6XSA9IG9wdGlvbkNoYWluc1t1aW50KG9wdGlvbkNoYWluSUQpXS5wb3NpdGlvbnNbdXNlcl0ucG9zaXRpb25zW29wdGlvbklEXTsNCiAgICAgICAgICBjYXNoZXNbel0gPSBvcHRpb25DaGFpbnNbdWludChvcHRpb25DaGFpbklEKV0ucG9zaXRpb25zW3VzZXJdLmNhc2g7DQogICAgICAgICAgeisrOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiAob3B0aW9uSURzLCBzdHJpa2VzLCBwb3NpdGlvbnMsIGNhc2hlcyk7DQogIH0NCg0KICBmdW5jdGlvbiBleHBpcmUodWludCBhY2NvdW50SUQsIHVpbnQgb3B0aW9uQ2hhaW5JRCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMsIGJ5dGVzMzIgdmFsdWUpIHsNCiAgICBpZiAob3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLmV4cGlyZWQgPT0gZmFsc2UpIHsNCiAgICAgIGlmIChlY3JlY292ZXIoc2hhMyhvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0uZmFjdEhhc2gsIHZhbHVlKSwgdiwgciwgcykgPT0gb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLmV0aEFkZHIpIHsNCiAgICAgICAgdWludCBsYXN0QWNjb3VudCA9IG51bUFjY291bnRzOw0KICAgICAgICBpZiAoYWNjb3VudElEPT0wKSB7DQogICAgICAgICAgYWNjb3VudElEID0gMTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBsYXN0QWNjb3VudCA9IGFjY291bnRJRDsNCiAgICAgICAgfQ0KICAgICAgICBmb3IgKGFjY291bnRJRD1hY2NvdW50SUQ7IGFjY291bnRJRDw9bGFzdEFjY291bnQ7IGFjY291bnRJRCsrKSB7DQogICAgICAgICAgaWYgKG9wdGlvbkNoYWluc1tvcHRpb25DaGFpbklEXS5wb3NpdGlvbnNbYWNjb3VudHNbYWNjb3VudElEXS51c2VyXS5leHBpcmVkID09IGZhbHNlKSB7DQogICAgICAgICAgICBpbnQgcmVzdWx0ID0gb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLnBvc2l0aW9uc1thY2NvdW50c1thY2NvdW50SURdLnVzZXJdLmNhc2ggLyAxMDAwMDAwMDAwMDAwMDAwMDAwOw0KICAgICAgICAgICAgZm9yICh1aW50IG9wdGlvbklEPTA7IG9wdGlvbklEPG9wdGlvbkNoYWluc1tvcHRpb25DaGFpbklEXS5udW1PcHRpb25zOyBvcHRpb25JRCsrKSB7DQogICAgICAgICAgICAgIGludCBtb25leW5lc3MgPSBnZXRNb25leW5lc3Mob3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLm9wdGlvbnNbb3B0aW9uSURdLnN0cmlrZSwgdWludCh2YWx1ZSksIG9wdGlvbkNoYWluc1tvcHRpb25DaGFpbklEXS5tYXJnaW4pOw0KICAgICAgICAgICAgICByZXN1bHQgKz0gbW9uZXluZXNzICogb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLnBvc2l0aW9uc1thY2NvdW50c1thY2NvdW50SURdLnVzZXJdLnBvc2l0aW9uc1tvcHRpb25JRF0gLyAxMDAwMDAwMDAwMDAwMDAwMDAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYWNjb3VudHNbYWNjb3VudElEXS5jYXBpdGFsID0gYWNjb3VudHNbYWNjb3VudElEXS5jYXBpdGFsICsgcmVzdWx0Ow0KICAgICAgICAgICAgb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLnBvc2l0aW9uc1thY2NvdW50c1thY2NvdW50SURdLnVzZXJdLmV4cGlyZWQgPSB0cnVlOw0KICAgICAgICAgICAgb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLm51bVBvc2l0aW9uc0V4cGlyZWQrKzsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKG9wdGlvbkNoYWluc1tvcHRpb25DaGFpbklEXS5udW1Qb3NpdGlvbnNFeHBpcmVkID09IG9wdGlvbkNoYWluc1tvcHRpb25DaGFpbklEXS5udW1Qb3NpdGlvbnMpIHsNCiAgICAgICAgICBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0uZXhwaXJlZCA9IHRydWU7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBnZXRNb25leW5lc3MoaW50IHN0cmlrZSwgdWludCBzZXR0bGVtZW50LCB1aW50IG1hcmdpbikgY29uc3RhbnQgcmV0dXJucyhpbnQpIHsNCiAgICBpZiAoc3RyaWtlPj0wKSB7IC8vY2FsbA0KICAgICAgaWYgKHNldHRsZW1lbnQ+dWludChzdHJpa2UpKSB7DQogICAgICAgIGlmIChzZXR0bGVtZW50LXVpbnQoc3RyaWtlKTxtYXJnaW4pIHsNCiAgICAgICAgICByZXR1cm4gaW50KHNldHRsZW1lbnQtdWludChzdHJpa2UpKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gaW50KG1hcmdpbik7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAwOw0KICAgICAgfQ0KICAgIH0gZWxzZSB7IC8vcHV0DQogICAgICBpZiAoc2V0dGxlbWVudDx1aW50KC1zdHJpa2UpKSB7DQogICAgICAgIGlmICh1aW50KC1zdHJpa2UpLXNldHRsZW1lbnQ8bWFyZ2luKSB7DQogICAgICAgICAgcmV0dXJuIGludCh1aW50KC1zdHJpa2UpLXNldHRsZW1lbnQpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBpbnQobWFyZ2luKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gYWRkT3B0aW9uQ2hhaW4odWludCBleHBpcmF0aW9uLCBzdHJpbmcgdW5kZXJseWluZywgdWludCBtYXJnaW4sIHVpbnQgcmVhbGl0eUlELCBieXRlczMyIGZhY3RIYXNoLCBhZGRyZXNzIGV0aEFkZHIsIGludFtdIHN0cmlrZXMpIHsNCiAgICB1aW50IG9wdGlvbkNoYWluSUQgPSA2Ow0KICAgIGlmIChudW1PcHRpb25DaGFpbnM8Nikgew0KICAgICAgb3B0aW9uQ2hhaW5JRCA9IG51bU9wdGlvbkNoYWlucysrOw0KICAgIH0gZWxzZSB7DQogICAgICBmb3IgKHVpbnQgaT0wOyBpIDwgbnVtT3B0aW9uQ2hhaW5zICYmIG9wdGlvbkNoYWluSUQ+PTY7IGkrKykgew0KICAgICAgICBpZiAob3B0aW9uQ2hhaW5zW2ldLmV4cGlyZWQ9PXRydWUgfHwgb3B0aW9uQ2hhaW5zW2ldLm51bVBvc2l0aW9ucz09MCB8fCBvcHRpb25DaGFpbnNbaV0ubnVtT3B0aW9ucz09MCkgew0KICAgICAgICAgIG9wdGlvbkNoYWluSUQgPSBpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIGlmIChvcHRpb25DaGFpbklEPDYpIHsNCiAgICAgIGRlbGV0ZSBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF07DQogICAgICBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0uZXhwaXJhdGlvbiA9IGV4cGlyYXRpb247DQogICAgICBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0udW5kZXJseWluZyA9IHVuZGVybHlpbmc7DQogICAgICBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0ubWFyZ2luID0gbWFyZ2luOw0KICAgICAgb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLnJlYWxpdHlJRCA9IHJlYWxpdHlJRDsNCiAgICAgIG9wdGlvbkNoYWluc1tvcHRpb25DaGFpbklEXS5mYWN0SGFzaCA9IGZhY3RIYXNoOw0KICAgICAgb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLmV0aEFkZHIgPSBldGhBZGRyOw0KICAgICAgZm9yIChpPTA7IGkgPCBzdHJpa2VzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGlmIChvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0ubnVtT3B0aW9uczwxMCkgew0KICAgICAgICAgIHVpbnQgb3B0aW9uSUQgPSBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0ubnVtT3B0aW9ucysrOw0KICAgICAgICAgIE9wdGlvbiBvcHRpb24gPSBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0ub3B0aW9uc1tpXTsNCiAgICAgICAgICBvcHRpb24uc3RyaWtlID0gc3RyaWtlc1tpXTsNCiAgICAgICAgICBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0ub3B0aW9uc1tpXSA9IG9wdGlvbjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIG9yZGVyTWF0Y2hUZXN0KHVpbnQgb3B0aW9uQ2hhaW5JRCwgdWludCBvcHRpb25JRCwgdWludCBwcmljZSwgaW50IHNpemUsIHVpbnQgb3JkZXJJRCwgdWludCBibG9ja0V4cGlyZXMsIGFkZHJlc3MgYWRkciwgYWRkcmVzcyBzZW5kZXIsIGludCBtYXRjaFNpemUpIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgIGlmIChibG9jay5udW1iZXI8PWJsb2NrRXhwaXJlcyAmJiAoKHNpemU+MCAmJiBtYXRjaFNpemU8MCAmJiBvcmRlckZpbGxzW3NoYTMob3B0aW9uQ2hhaW5JRCwgb3B0aW9uSUQsIHByaWNlLCBzaXplLCBvcmRlcklELCBibG9ja0V4cGlyZXMpXS1tYXRjaFNpemU8PXNpemUpIHx8IChzaXplPDAgJiYgbWF0Y2hTaXplPjAgJiYgb3JkZXJGaWxsc1tzaGEzKG9wdGlvbkNoYWluSUQsIG9wdGlvbklELCBwcmljZSwgc2l6ZSwgb3JkZXJJRCwgYmxvY2tFeHBpcmVzKV0tbWF0Y2hTaXplPj1zaXplKSkgJiYgZ2V0RnVuZHMoYWRkciwgZmFsc2UpK2dldE1heExvc3NBZnRlclRyYWRlKGFkZHIsIG9wdGlvbkNoYWluSUQsIG9wdGlvbklELCAtbWF0Y2hTaXplLCBtYXRjaFNpemUgKiBpbnQocHJpY2UpKT4wICYmIGdldEZ1bmRzKHNlbmRlciwgZmFsc2UpK2dldE1heExvc3NBZnRlclRyYWRlKHNlbmRlciwgb3B0aW9uQ2hhaW5JRCwgb3B0aW9uSUQsIG1hdGNoU2l6ZSwgLW1hdGNoU2l6ZSAqIGludChwcmljZSkpPjApIHsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICBmdW5jdGlvbiBvcmRlck1hdGNoKHVpbnQgb3B0aW9uQ2hhaW5JRCwgdWludCBvcHRpb25JRCwgdWludCBwcmljZSwgaW50IHNpemUsIHVpbnQgb3JkZXJJRCwgdWludCBibG9ja0V4cGlyZXMsIGFkZHJlc3MgYWRkciwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMsIGludCBtYXRjaFNpemUpIHsNCiAgICBieXRlczMyIGhhc2ggPSBzaGEyNTYob3B0aW9uQ2hhaW5JRCwgb3B0aW9uSUQsIHByaWNlLCBzaXplLCBvcmRlcklELCBibG9ja0V4cGlyZXMpOw0KICAgIGlmIChlY3JlY292ZXIoaGFzaCwgdiwgciwgcykgPT0gYWRkciAmJiBibG9jay5udW1iZXI8PWJsb2NrRXhwaXJlcyAmJiAoKHNpemU+MCAmJiBtYXRjaFNpemU8MCAmJiBvcmRlckZpbGxzW2hhc2hdLW1hdGNoU2l6ZTw9c2l6ZSkgfHwgKHNpemU8MCAmJiBtYXRjaFNpemU+MCAmJiBvcmRlckZpbGxzW2hhc2hdLW1hdGNoU2l6ZT49c2l6ZSkpICYmIGdldEZ1bmRzKGFkZHIsIGZhbHNlKStnZXRNYXhMb3NzQWZ0ZXJUcmFkZShhZGRyLCBvcHRpb25DaGFpbklELCBvcHRpb25JRCwgLW1hdGNoU2l6ZSwgbWF0Y2hTaXplICogaW50KHByaWNlKSk+MCAmJiBnZXRGdW5kcyhtc2cuc2VuZGVyLCBmYWxzZSkrZ2V0TWF4TG9zc0FmdGVyVHJhZGUobXNnLnNlbmRlciwgb3B0aW9uQ2hhaW5JRCwgb3B0aW9uSUQsIG1hdGNoU2l6ZSwgLW1hdGNoU2l6ZSAqIGludChwcmljZSkpPjApIHsNCiAgICAgIGlmIChvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0ucG9zaXRpb25zW21zZy5zZW5kZXJdLmhhc1Bvc2l0aW9uID09IGZhbHNlKSB7DQogICAgICAgIG9wdGlvbkNoYWluc1tvcHRpb25DaGFpbklEXS5wb3NpdGlvbnNbbXNnLnNlbmRlcl0uaGFzUG9zaXRpb24gPSB0cnVlOw0KICAgICAgICBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0ubnVtUG9zaXRpb25zKys7DQogICAgICB9DQogICAgICBpZiAob3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLnBvc2l0aW9uc1thZGRyXS5oYXNQb3NpdGlvbiA9PSBmYWxzZSkgew0KICAgICAgICBvcHRpb25DaGFpbnNbb3B0aW9uQ2hhaW5JRF0ucG9zaXRpb25zW2FkZHJdLmhhc1Bvc2l0aW9uID0gdHJ1ZTsNCiAgICAgICAgb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLm51bVBvc2l0aW9ucysrOw0KICAgICAgfQ0KICAgICAgb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLnBvc2l0aW9uc1ttc2cuc2VuZGVyXS5wb3NpdGlvbnNbb3B0aW9uSURdICs9IG1hdGNoU2l6ZTsNCiAgICAgIG9wdGlvbkNoYWluc1tvcHRpb25DaGFpbklEXS5wb3NpdGlvbnNbbXNnLnNlbmRlcl0uY2FzaCAtPSBtYXRjaFNpemUgKiBpbnQocHJpY2UpOw0KICAgICAgb3B0aW9uQ2hhaW5zW29wdGlvbkNoYWluSURdLnBvc2l0aW9uc1thZGRyXS5wb3NpdGlvbnNbb3B0aW9uSURdIC09IG1hdGNoU2l6ZTsNCiAgICAgIG9wdGlvbkNoYWluc1tvcHRpb25DaGFpbklEXS5wb3NpdGlvbnNbYWRkcl0uY2FzaCArPSBtYXRjaFNpemUgKiBpbnQocHJpY2UpOw0KICAgICAgb3JkZXJGaWxsc1toYXNoXSAtPSBtYXRjaFNpemU7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0TWF4TG9zc0FmdGVyVHJhZGUoYWRkcmVzcyB1c2VyLCB1aW50IG9wdGlvbkNoYWluSUQsIHVpbnQgb3B0aW9uSUQsIGludCBwb3NpdGlvbkNoYW5nZSwgaW50IGNhc2hDaGFuZ2UpIGNvbnN0YW50IHJldHVybnMoaW50KSB7DQogICAgaW50IHRvdGFsTWF4TG9zcyA9IDA7DQogICAgZm9yICh1aW50IGk9MDsgaTxudW1PcHRpb25DaGFpbnM7IGkrKykgew0KICAgICAgaWYgKG9wdGlvbkNoYWluc1tpXS5wb3NpdGlvbnNbdXNlcl0uZXhwaXJlZCA9PSBmYWxzZSAmJiBvcHRpb25DaGFpbnNbaV0ubnVtT3B0aW9ucz4wKSB7DQogICAgICAgIGJvb2wgbWF4TG9zc0luaXRpYWxpemVkID0gZmFsc2U7DQogICAgICAgIGludCBtYXhMb3NzID0gMDsNCiAgICAgICAgZm9yICh1aW50IHM9MDsgczxvcHRpb25DaGFpbnNbaV0ubnVtT3B0aW9uczsgcysrKSB7DQogICAgICAgICAgaW50IHBubCA9IG9wdGlvbkNoYWluc1tpXS5wb3NpdGlvbnNbdXNlcl0uY2FzaCAvIDEwMDAwMDAwMDAwMDAwMDAwMDA7DQogICAgICAgICAgaWYgKGk9PW9wdGlvbkNoYWluSUQpIHsNCiAgICAgICAgICAgIHBubCArPSBjYXNoQ2hhbmdlIC8gMTAwMDAwMDAwMDAwMDAwMDAwMDsNCiAgICAgICAgICB9DQogICAgICAgICAgdWludCBzZXR0bGVtZW50ID0gMDsNCiAgICAgICAgICBpZiAob3B0aW9uQ2hhaW5zW2ldLm9wdGlvbnNbc10uc3RyaWtlPDApIHsNCiAgICAgICAgICAgIHNldHRsZW1lbnQgPSB1aW50KC1vcHRpb25DaGFpbnNbaV0ub3B0aW9uc1tzXS5zdHJpa2UpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzZXR0bGVtZW50ID0gdWludChvcHRpb25DaGFpbnNbaV0ub3B0aW9uc1tzXS5zdHJpa2UpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBwbmwgKz0gbW9uZXlTdW1BdFNldHRsZW1lbnQodXNlciwgb3B0aW9uQ2hhaW5JRCwgb3B0aW9uSUQsIHBvc2l0aW9uQ2hhbmdlLCBpLCBzZXR0bGVtZW50KTsNCiAgICAgICAgICBpZiAocG5sPG1heExvc3MgfHwgbWF4TG9zc0luaXRpYWxpemVkPT1mYWxzZSkgew0KICAgICAgICAgICAgbWF4TG9zc0luaXRpYWxpemVkID0gdHJ1ZTsNCiAgICAgICAgICAgIG1heExvc3MgPSBwbmw7DQogICAgICAgICAgfQ0KICAgICAgICAgIHBubCA9IG9wdGlvbkNoYWluc1tpXS5wb3NpdGlvbnNbdXNlcl0uY2FzaCAvIDEwMDAwMDAwMDAwMDAwMDAwMDA7DQogICAgICAgICAgaWYgKGk9PW9wdGlvbkNoYWluSUQpIHsNCiAgICAgICAgICAgIHBubCArPSBjYXNoQ2hhbmdlIC8gMTAwMDAwMDAwMDAwMDAwMDAwMDsNCiAgICAgICAgICB9DQogICAgICAgICAgc2V0dGxlbWVudCA9IDA7DQogICAgICAgICAgaWYgKG9wdGlvbkNoYWluc1tpXS5vcHRpb25zW3NdLnN0cmlrZTwwKSB7DQogICAgICAgICAgICBpZiAodWludCgtb3B0aW9uQ2hhaW5zW2ldLm9wdGlvbnNbc10uc3RyaWtlKT5vcHRpb25DaGFpbnNbaV0ubWFyZ2luKSB7DQogICAgICAgICAgICAgIHNldHRsZW1lbnQgPSB1aW50KC1vcHRpb25DaGFpbnNbaV0ub3B0aW9uc1tzXS5zdHJpa2UpLW9wdGlvbkNoYWluc1tpXS5tYXJnaW47DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBzZXR0bGVtZW50ID0gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2V0dGxlbWVudCA9IHVpbnQob3B0aW9uQ2hhaW5zW2ldLm9wdGlvbnNbc10uc3RyaWtlKStvcHRpb25DaGFpbnNbaV0ubWFyZ2luOw0KICAgICAgICAgIH0NCiAgICAgICAgICBwbmwgKz0gbW9uZXlTdW1BdFNldHRsZW1lbnQodXNlciwgb3B0aW9uQ2hhaW5JRCwgb3B0aW9uSUQsIHBvc2l0aW9uQ2hhbmdlLCBpLCBzZXR0bGVtZW50KTsNCiAgICAgICAgICBpZiAocG5sPG1heExvc3MpIHsNCiAgICAgICAgICAgIG1heExvc3MgPSBwbmw7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRvdGFsTWF4TG9zcyArPSBtYXhMb3NzOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdG90YWxNYXhMb3NzOw0KICB9DQoNCiAgZnVuY3Rpb24gbW9uZXlTdW1BdFNldHRsZW1lbnQoYWRkcmVzcyB1c2VyLCB1aW50IG9wdGlvbkNoYWluSUQsIHVpbnQgb3B0aW9uSUQsIGludCBwb3NpdGlvbkNoYW5nZSwgdWludCBpLCB1aW50IHNldHRsZW1lbnQpIGludGVybmFsIHJldHVybnMoaW50KSB7DQogICAgaW50IHBubCA9IDA7DQogICAgZm9yICh1aW50IGo9MDsgajxvcHRpb25DaGFpbnNbaV0ubnVtT3B0aW9uczsgaisrKSB7DQogICAgICBwbmwgKz0gb3B0aW9uQ2hhaW5zW2ldLnBvc2l0aW9uc1t1c2VyXS5wb3NpdGlvbnNbal0gKiBnZXRNb25leW5lc3Mob3B0aW9uQ2hhaW5zW2ldLm9wdGlvbnNbal0uc3RyaWtlLCBzZXR0bGVtZW50LCBvcHRpb25DaGFpbnNbaV0ubWFyZ2luKSAvIDEwMDAwMDAwMDAwMDAwMDAwMDA7DQogICAgICBpZiAoaT09b3B0aW9uQ2hhaW5JRCAmJiBqPT1vcHRpb25JRCkgew0KICAgICAgICBwbmwgKz0gcG9zaXRpb25DaGFuZ2UgKiBnZXRNb25leW5lc3Mob3B0aW9uQ2hhaW5zW2ldLm9wdGlvbnNbal0uc3RyaWtlLCBzZXR0bGVtZW50LCBvcHRpb25DaGFpbnNbaV0ubWFyZ2luKSAvIDEwMDAwMDAwMDAwMDAwMDAwMDA7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBwbmw7DQogIH0NCg0KICBmdW5jdGlvbiBtaW4odWludCBhLCB1aW50IGIpIGNvbnN0YW50IHJldHVybnModWludCkgew0KICAgIGlmIChhPGIpIHsNCiAgICAgIHJldHVybiBhOw0KICAgIH0gZWxzZSB7DQogICAgICByZXR1cm4gYjsNCiAgICB9DQogIH0NCn0='