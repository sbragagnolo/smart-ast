base 64 content
base64milestoneTracker
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC42Ow0KDQovKg0KICAgIENvcHlyaWdodCAyMDE2LCBKb3JkaSBCYXlsaW5hDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQ0KICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5DQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCg0KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQogKi8NCg0KLy8vIEB0aXRsZSBNaWxlc3RvbmVUcmFja2VyIENvbnRyYWN0DQovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hDQovLy8gQGRldiBUaGlzIGNvbnRyYWN0IHRyYWNrcyB0aGUNCg0KDQovLy8gaXMgcnVsZXMgdGhlIHJlbGF0aW9uIGJldHdlbiBhIGRvbm9yIGFuZCBhIHJlY2lwaWVudA0KLy8vICBpbiBvcmRlciB0byBndWFyYW50eSB0byB0aGUgZG9ub3IgdGhhdCB0aGUgam9iIHdpbGwgYmUgZG9uZSBhbmQgdG8gZ3VhcmFudHkNCi8vLyAgdG8gdGhlIHJlY2lwaWVudCB0aGF0IGhlIHdpbGwgYmUgcGFpZA0KDQoNCi8vLyBAZGV2IFdlIHVzZSB0aGUgUkxQIGxpYnJhcnkgdG8gZGVjb2RlIFJMUCBzbyB0aGF0IHRoZSBkb25vciBjYW4gYXBwcm92ZSBvbmUNCi8vLyAgc2V0IG9mIG1pbGVzdG9uZSBjaGFuZ2VzIGF0IGEgdGltZS4NCi8vLyAgaHR0cHM6Ly9naXRodWIuY29tL2FuZHJvbG8vc3RhbmRhcmQtY29udHJhY3RzL2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy9zcmMvY29kZWMvUkxQLnNvbA0KDQoNCi8qKg0KKiBAdGl0bGUgUkxQUmVhZGVyDQoqDQoqIFJMUFJlYWRlciBpcyB1c2VkIHRvIHJlYWQgYW5kIHBhcnNlIFJMUCBlbmNvZGVkIGRhdGEgaW4gbWVtb3J5Lg0KKg0KKiBAYXV0aG9yIEFuZHJlYXMgT2xvZnNzb24gKGFuZHJvbG8xOTgwQGdtYWlsLmNvbSkNCiovDQpsaWJyYXJ5IFJMUCB7DQoNCiB1aW50IGNvbnN0YW50IERBVEFfU0hPUlRfU1RBUlQgPSAweDgwOw0KIHVpbnQgY29uc3RhbnQgREFUQV9MT05HX1NUQVJUID0gMHhCODsNCiB1aW50IGNvbnN0YW50IExJU1RfU0hPUlRfU1RBUlQgPSAweEMwOw0KIHVpbnQgY29uc3RhbnQgTElTVF9MT05HX1NUQVJUID0gMHhGODsNCg0KIHVpbnQgY29uc3RhbnQgREFUQV9MT05HX09GRlNFVCA9IDB4Qjc7DQogdWludCBjb25zdGFudCBMSVNUX0xPTkdfT0ZGU0VUID0gMHhGNzsNCg0KDQogc3RydWN0IFJMUEl0ZW0gew0KICAgICB1aW50IF91bnNhZmVfbWVtUHRyOyAgICAvLyBQb2ludGVyIHRvIHRoZSBSTFAtZW5jb2RlZCBieXRlcy4NCiAgICAgdWludCBfdW5zYWZlX2xlbmd0aDsgICAgLy8gTnVtYmVyIG9mIGJ5dGVzLiBUaGlzIGlzIHRoZSBmdWxsIGxlbmd0aCBvZiB0aGUgc3RyaW5nLg0KIH0NCg0KIHN0cnVjdCBJdGVyYXRvciB7DQogICAgIFJMUEl0ZW0gX3Vuc2FmZV9pdGVtOyAgIC8vIEl0ZW0gdGhhdCdzIGJlaW5nIGl0ZXJhdGVkIG92ZXIuDQogICAgIHVpbnQgX3Vuc2FmZV9uZXh0UHRyOyAgIC8vIFBvc2l0aW9uIG9mIHRoZSBuZXh0IGl0ZW0gaW4gdGhlIGxpc3QuDQogfQ0KDQogLyogSXRlcmF0b3IgKi8NCg0KIGZ1bmN0aW9uIG5leHQoSXRlcmF0b3IgbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5IHN1Ykl0ZW0pIHsNCiAgICAgaWYoaGFzTmV4dChzZWxmKSkgew0KICAgICAgICAgdmFyIHB0ciA9IHNlbGYuX3Vuc2FmZV9uZXh0UHRyOw0KICAgICAgICAgdmFyIGl0ZW1MZW5ndGggPSBfaXRlbUxlbmd0aChwdHIpOw0KICAgICAgICAgc3ViSXRlbS5fdW5zYWZlX21lbVB0ciA9IHB0cjsNCiAgICAgICAgIHN1Ykl0ZW0uX3Vuc2FmZV9sZW5ndGggPSBpdGVtTGVuZ3RoOw0KICAgICAgICAgc2VsZi5fdW5zYWZlX25leHRQdHIgPSBwdHIgKyBpdGVtTGVuZ3RoOw0KICAgICB9DQogICAgIGVsc2UNCiAgICAgICAgIHRocm93Ow0KIH0NCg0KIGZ1bmN0aW9uIG5leHQoSXRlcmF0b3IgbWVtb3J5IHNlbGYsIGJvb2wgc3RyaWN0KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSBzdWJJdGVtKSB7DQogICAgIHN1Ykl0ZW0gPSBuZXh0KHNlbGYpOw0KICAgICBpZihzdHJpY3QgJiYgIV92YWxpZGF0ZShzdWJJdGVtKSkNCiAgICAgICAgIHRocm93Ow0KICAgICByZXR1cm47DQogfQ0KDQogZnVuY3Rpb24gaGFzTmV4dChJdGVyYXRvciBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICB2YXIgaXRlbSA9IHNlbGYuX3Vuc2FmZV9pdGVtOw0KICAgICByZXR1cm4gc2VsZi5fdW5zYWZlX25leHRQdHIgPCBpdGVtLl91bnNhZmVfbWVtUHRyICsgaXRlbS5fdW5zYWZlX2xlbmd0aDsNCiB9DQoNCiAvKiBSTFBJdGVtICovDQoNCiAvLy8gQGRldiBDcmVhdGVzIGFuIFJMUEl0ZW0gZnJvbSBhbiBhcnJheSBvZiBSTFAgZW5jb2RlZCBieXRlcy4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBlbmNvZGVkIGJ5dGVzLg0KIC8vLyBAcmV0dXJuIEFuIFJMUEl0ZW0NCiBmdW5jdGlvbiB0b1JMUEl0ZW0oYnl0ZXMgbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5KSB7DQogICAgIHVpbnQgbGVuID0gc2VsZi5sZW5ndGg7DQogICAgIGlmIChsZW4gPT0gMCkgew0KICAgICAgICAgcmV0dXJuIFJMUEl0ZW0oMCwgMCk7DQogICAgIH0NCiAgICAgdWludCBtZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIG1lbVB0ciA6PSBhZGQoc2VsZiwgMHgyMCkNCiAgICAgfQ0KICAgICByZXR1cm4gUkxQSXRlbShtZW1QdHIsIGxlbik7DQogfQ0KDQogLy8vIEBkZXYgQ3JlYXRlcyBhbiBSTFBJdGVtIGZyb20gYW4gYXJyYXkgb2YgUkxQIGVuY29kZWQgYnl0ZXMuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgZW5jb2RlZCBieXRlcy4NCiAvLy8gQHBhcmFtIHN0cmljdCBXaWxsIHRocm93IGlmIHRoZSBkYXRhIGlzIG5vdCBSTFAgZW5jb2RlZC4NCiAvLy8gQHJldHVybiBBbiBSTFBJdGVtDQogZnVuY3Rpb24gdG9STFBJdGVtKGJ5dGVzIG1lbW9yeSBzZWxmLCBib29sIHN0cmljdCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoUkxQSXRlbSBtZW1vcnkpIHsNCiAgICAgdmFyIGl0ZW0gPSB0b1JMUEl0ZW0oc2VsZik7DQogICAgIGlmKHN0cmljdCkgew0KICAgICAgICAgdWludCBsZW4gPSBzZWxmLmxlbmd0aDsNCiAgICAgICAgIGlmKF9wYXlsb2FkT2Zmc2V0KGl0ZW0pID4gbGVuKQ0KICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgaWYoX2l0ZW1MZW5ndGgoaXRlbS5fdW5zYWZlX21lbVB0cikgIT0gbGVuKQ0KICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgaWYoIV92YWxpZGF0ZShpdGVtKSkNCiAgICAgICAgICAgICB0aHJvdzsNCiAgICAgfQ0KICAgICByZXR1cm4gaXRlbTsNCiB9DQoNCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgbnVsbC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLg0KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBudWxsLg0KIGZ1bmN0aW9uIGlzTnVsbChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgew0KICAgICByZXR1cm4gc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwOw0KIH0NCg0KIC8vLyBAZGV2IENoZWNrIGlmIHRoZSBSTFAgaXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgYSBsaXN0Lg0KIGZ1bmN0aW9uIGlzTGlzdChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgew0KICAgICBpZiAoc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwKQ0KICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIHJldCA6PSBpc3plcm8obHQoYnl0ZSgwLCBtbG9hZChtZW1QdHIpKSwgMHhDMCkpDQogICAgIH0NCiB9DQoNCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgZGF0YS4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLg0KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBkYXRhLg0KIGZ1bmN0aW9uIGlzRGF0YShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgew0KICAgICBpZiAoc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwKQ0KICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIHJldCA6PSBsdChieXRlKDAsIG1sb2FkKG1lbVB0cikpLCAweEMwKQ0KICAgICB9DQogfQ0KDQogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIGVtcHR5IChzdHJpbmcgb3IgbGlzdCkuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgbnVsbC4NCiBmdW5jdGlvbiBpc0VtcHR5KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmV0KSB7DQogICAgIGlmKGlzTnVsbChzZWxmKSkNCiAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgdWludCBiMDsNCiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpDQogICAgIH0NCiAgICAgcmV0dXJuIChiMCA9PSBEQVRBX1NIT1JUX1NUQVJUIHx8IGIwID09IExJU1RfU0hPUlRfU1RBUlQpOw0KIH0NCg0KIC8vLyBAZGV2IEdldCB0aGUgbnVtYmVyIG9mIGl0ZW1zIGluIGFuIFJMUCBlbmNvZGVkIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIGl0ZW1zLg0KIGZ1bmN0aW9uIGl0ZW1zKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgaWYgKCFpc0xpc3Qoc2VsZikpDQogICAgICAgICByZXR1cm4gMDsNCiAgICAgdWludCBiMDsNCiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpDQogICAgIH0NCiAgICAgdWludCBwb3MgPSBtZW1QdHIgKyBfcGF5bG9hZE9mZnNldChzZWxmKTsNCiAgICAgdWludCBsYXN0ID0gbWVtUHRyICsgc2VsZi5fdW5zYWZlX2xlbmd0aCAtIDE7DQogICAgIHVpbnQgaXRtczsNCiAgICAgd2hpbGUocG9zIDw9IGxhc3QpIHsNCiAgICAgICAgIHBvcyArPSBfaXRlbUxlbmd0aChwb3MpOw0KICAgICAgICAgaXRtcysrOw0KICAgICB9DQogICAgIHJldHVybiBpdG1zOw0KIH0NCg0KIC8vLyBAZGV2IENyZWF0ZSBhbiBpdGVyYXRvci4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLg0KIC8vLyBAcmV0dXJuIEFuICdJdGVyYXRvcicgb3ZlciB0aGUgaXRlbS4NCiBmdW5jdGlvbiBpdGVyYXRvcihSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChJdGVyYXRvciBtZW1vcnkgaXQpIHsNCiAgICAgaWYgKCFpc0xpc3Qoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdWludCBwdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyICsgX3BheWxvYWRPZmZzZXQoc2VsZik7DQogICAgIGl0Ll91bnNhZmVfaXRlbSA9IHNlbGY7DQogICAgIGl0Ll91bnNhZmVfbmV4dFB0ciA9IHB0cjsNCiB9DQoNCiAvLy8gQGRldiBSZXR1cm4gdGhlIFJMUCBlbmNvZGVkIGJ5dGVzLg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgYnl0ZXMuDQogZnVuY3Rpb24gdG9CeXRlcyhSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlcyBtZW1vcnkgYnRzKSB7DQogICAgIHZhciBsZW4gPSBzZWxmLl91bnNhZmVfbGVuZ3RoOw0KICAgICBpZiAobGVuID09IDApDQogICAgICAgICByZXR1cm47DQogICAgIGJ0cyA9IG5ldyBieXRlcyhsZW4pOw0KICAgICBfY29weVRvQnl0ZXMoc2VsZi5fdW5zYWZlX21lbVB0ciwgYnRzLCBsZW4pOw0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYnl0ZXMuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0RhdGEoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMgbWVtb3J5IGJ0cykgew0KICAgICBpZighaXNEYXRhKHNlbGYpKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsNCiAgICAgYnRzID0gbmV3IGJ5dGVzKGxlbik7DQogICAgIF9jb3B5VG9CeXRlcyhyU3RhcnRQb3MsIGJ0cywgbGVuKTsNCiB9DQoNCiAvLy8gQGRldiBHZXQgdGhlIGxpc3Qgb2Ygc3ViLWl0ZW1zIGZyb20gYW4gUkxQIGVuY29kZWQgbGlzdC4NCiAvLy8gV2FybmluZzogVGhpcyBpcyBpbmVmZmljaWVudCwgYXMgaXQgcmVxdWlyZXMgdGhhdCB0aGUgbGlzdCBpcyByZWFkIHR3aWNlLg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gQXJyYXkgb2YgUkxQSXRlbXMuDQogZnVuY3Rpb24gdG9MaXN0KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW1bXSBtZW1vcnkgbGlzdCkgew0KICAgICBpZighaXNMaXN0KHNlbGYpKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHZhciBudW1JdGVtcyA9IGl0ZW1zKHNlbGYpOw0KICAgICBsaXN0ID0gbmV3IFJMUEl0ZW1bXShudW1JdGVtcyk7DQogICAgIHZhciBpdCA9IGl0ZXJhdG9yKHNlbGYpOw0KICAgICB1aW50IGlkeDsNCiAgICAgd2hpbGUoaGFzTmV4dChpdCkpIHsNCiAgICAgICAgIGxpc3RbaWR4XSA9IG5leHQoaXQpOw0KICAgICAgICAgaWR4Kys7DQogICAgIH0NCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGFzY2lpIHN0cmluZy4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvQXNjaWkoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIG1lbW9yeSBzdHIpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGJ5dGVzIG1lbW9yeSBidHMgPSBuZXcgYnl0ZXMobGVuKTsNCiAgICAgX2NvcHlUb0J5dGVzKHJTdGFydFBvcywgYnRzLCBsZW4pOw0KICAgICBzdHIgPSBzdHJpbmcoYnRzKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGEgdWludC4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvVWludChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50IGRhdGEpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGlmIChsZW4gPiAzMiB8fCBsZW4gPT0gMCkNCiAgICAgICAgIHRocm93Ow0KICAgICBhc3NlbWJseSB7DQogICAgICAgICBkYXRhIDo9IGRpdihtbG9hZChyU3RhcnRQb3MpLCBleHAoMjU2LCBzdWIoMzIsIGxlbikpKQ0KICAgICB9DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIGJvb2xlYW4uIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0Jvb2woUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuICE9IDEpDQogICAgICAgICB0aHJvdzsNCiAgICAgdWludCB0ZW1wOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICB0ZW1wIDo9IGJ5dGUoMCwgbWxvYWQoclN0YXJ0UG9zKSkNCiAgICAgfQ0KICAgICBpZiAodGVtcCA+IDEpDQogICAgICAgICB0aHJvdzsNCiAgICAgcmV0dXJuIHRlbXAgPT0gMSA/IHRydWUgOiBmYWxzZTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGEgYnl0ZS4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvQnl0ZShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlIGRhdGEpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGlmIChsZW4gIT0gMSkNCiAgICAgICAgIHRocm93Ow0KICAgICB1aW50IHRlbXA7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIHRlbXAgOj0gYnl0ZSgwLCBtbG9hZChyU3RhcnRQb3MpKQ0KICAgICB9DQogICAgIHJldHVybiBieXRlKHRlbXApOw0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYW4gaW50LiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlDQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuDQogZnVuY3Rpb24gdG9JbnQoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoaW50IGRhdGEpIHsNCiAgICAgcmV0dXJuIGludCh0b1VpbnQoc2VsZikpOw0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYSBieXRlczMyLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlDQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuDQogZnVuY3Rpb24gdG9CeXRlczMyKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIgZGF0YSkgew0KICAgICByZXR1cm4gYnl0ZXMzMih0b1VpbnQoc2VsZikpOw0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYW4gYWRkcmVzcy4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvQWRkcmVzcyhSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIGRhdGEpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGlmIChsZW4gIT0gMjApDQogICAgICAgICB0aHJvdzsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgZGF0YSA6PSBkaXYobWxvYWQoclN0YXJ0UG9zKSwgZXhwKDI1NiwgMTIpKQ0KICAgICB9DQogfQ0KDQogLy8gR2V0IHRoZSBwYXlsb2FkIG9mZnNldC4NCiBmdW5jdGlvbiBfcGF5bG9hZE9mZnNldChSTFBJdGVtIG1lbW9yeSBzZWxmKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgaWYoc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwKQ0KICAgICAgICAgcmV0dXJuIDA7DQogICAgIHVpbnQgYjA7DQogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICB9DQogICAgIGlmKGIwIDwgREFUQV9TSE9SVF9TVEFSVCkNCiAgICAgICAgIHJldHVybiAwOw0KICAgICBpZihiMCA8IERBVEFfTE9OR19TVEFSVCB8fCAoYjAgPj0gTElTVF9TSE9SVF9TVEFSVCAmJiBiMCA8IExJU1RfTE9OR19TVEFSVCkpDQogICAgICAgICByZXR1cm4gMTsNCiAgICAgaWYoYjAgPCBMSVNUX1NIT1JUX1NUQVJUKQ0KICAgICAgICAgcmV0dXJuIGIwIC0gREFUQV9MT05HX09GRlNFVCArIDE7DQogICAgIHJldHVybiBiMCAtIExJU1RfTE9OR19PRkZTRVQgKyAxOw0KIH0NCg0KIC8vIEdldCB0aGUgZnVsbCBsZW5ndGggb2YgYW4gUkxQIGl0ZW0uDQogZnVuY3Rpb24gX2l0ZW1MZW5ndGgodWludCBtZW1QdHIpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCBsZW4pIHsNCiAgICAgdWludCBiMDsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICB9DQogICAgIGlmIChiMCA8IERBVEFfU0hPUlRfU1RBUlQpDQogICAgICAgICBsZW4gPSAxOw0KICAgICBlbHNlIGlmIChiMCA8IERBVEFfTE9OR19TVEFSVCkNCiAgICAgICAgIGxlbiA9IGIwIC0gREFUQV9TSE9SVF9TVEFSVCArIDE7DQogICAgIGVsc2UgaWYgKGIwIDwgTElTVF9TSE9SVF9TVEFSVCkgew0KICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgIGxldCBiTGVuIDo9IHN1YihiMCwgMHhCNykgLy8gYnl0ZXMgbGVuZ3RoIChEQVRBX0xPTkdfT0ZGU0VUKQ0KICAgICAgICAgICAgIGxldCBkTGVuIDo9IGRpdihtbG9hZChhZGQobWVtUHRyLCAxKSksIGV4cCgyNTYsIHN1YigzMiwgYkxlbikpKSAvLyBkYXRhIGxlbmd0aA0KICAgICAgICAgICAgIGxlbiA6PSBhZGQoMSwgYWRkKGJMZW4sIGRMZW4pKSAvLyB0b3RhbCBsZW5ndGgNCiAgICAgICAgIH0NCiAgICAgfQ0KICAgICBlbHNlIGlmIChiMCA8IExJU1RfTE9OR19TVEFSVCkNCiAgICAgICAgIGxlbiA9IGIwIC0gTElTVF9TSE9SVF9TVEFSVCArIDE7DQogICAgIGVsc2Ugew0KICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgIGxldCBiTGVuIDo9IHN1YihiMCwgMHhGNykgLy8gYnl0ZXMgbGVuZ3RoIChMSVNUX0xPTkdfT0ZGU0VUKQ0KICAgICAgICAgICAgIGxldCBkTGVuIDo9IGRpdihtbG9hZChhZGQobWVtUHRyLCAxKSksIGV4cCgyNTYsIHN1YigzMiwgYkxlbikpKSAvLyBkYXRhIGxlbmd0aA0KICAgICAgICAgICAgIGxlbiA6PSBhZGQoMSwgYWRkKGJMZW4sIGRMZW4pKSAvLyB0b3RhbCBsZW5ndGgNCiAgICAgICAgIH0NCiAgICAgfQ0KIH0NCg0KIC8vIEdldCBzdGFydCBwb3NpdGlvbiBhbmQgbGVuZ3RoIG9mIHRoZSBkYXRhLg0KIGZ1bmN0aW9uIF9kZWNvZGUoUkxQSXRlbSBtZW1vcnkgc2VsZikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50IG1lbVB0ciwgdWludCBsZW4pIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB1aW50IGIwOw0KICAgICB1aW50IHN0YXJ0ID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChzdGFydCkpDQogICAgIH0NCiAgICAgaWYgKGIwIDwgREFUQV9TSE9SVF9TVEFSVCkgew0KICAgICAgICAgbWVtUHRyID0gc3RhcnQ7DQogICAgICAgICBsZW4gPSAxOw0KICAgICAgICAgcmV0dXJuOw0KICAgICB9DQogICAgIGlmIChiMCA8IERBVEFfTE9OR19TVEFSVCkgew0KICAgICAgICAgbGVuID0gc2VsZi5fdW5zYWZlX2xlbmd0aCAtIDE7DQogICAgICAgICBtZW1QdHIgPSBzdGFydCArIDE7DQogICAgIH0gZWxzZSB7DQogICAgICAgICB1aW50IGJMZW47DQogICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgYkxlbiA6PSBzdWIoYjAsIDB4QjcpIC8vIERBVEFfTE9OR19PRkZTRVQNCiAgICAgICAgIH0NCiAgICAgICAgIGxlbiA9IHNlbGYuX3Vuc2FmZV9sZW5ndGggLSAxIC0gYkxlbjsNCiAgICAgICAgIG1lbVB0ciA9IHN0YXJ0ICsgYkxlbiArIDE7DQogICAgIH0NCiAgICAgcmV0dXJuOw0KIH0NCg0KIC8vIEFzc3VtZXMgdGhhdCBlbm91Z2ggbWVtb3J5IGhhcyBiZWVuIGFsbG9jYXRlZCB0byBzdG9yZSBpbiB0YXJnZXQuDQogZnVuY3Rpb24gX2NvcHlUb0J5dGVzKHVpbnQgYnRzUHRyLCBieXRlcyBtZW1vcnkgdGd0LCB1aW50IGJ0c0xlbikgcHJpdmF0ZSBjb25zdGFudCB7DQogICAgIC8vIEV4cGxvaXRpbmcgdGhlIGZhY3QgdGhhdCAndGd0JyB3YXMgdGhlIGxhc3QgdGhpbmcgdG8gYmUgYWxsb2NhdGVkLA0KICAgICAvLyB3ZSBjYW4gd3JpdGUgZW50aXJlIHdvcmRzLCBhbmQganVzdCBvdmVyd3JpdGUgYW55IGV4Y2Vzcy4NCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgew0KICAgICAgICAgICAgICAgICBsZXQgaSA6PSAwIC8vIFN0YXJ0IGF0IGFyciArIDB4MjANCiAgICAgICAgICAgICAgICAgbGV0IHdvcmRzIDo9IGRpdihhZGQoYnRzTGVuLCAzMSksIDMyKQ0KICAgICAgICAgICAgICAgICBsZXQgck9mZnNldCA6PSBidHNQdHINCiAgICAgICAgICAgICAgICAgbGV0IHdPZmZzZXQgOj0gYWRkKHRndCwgMHgyMCkNCiAgICAgICAgICAgICB0YWdfbG9vcDoNCiAgICAgICAgICAgICAgICAganVtcGkoZW5kLCBlcShpLCB3b3JkcykpDQogICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgOj0gbXVsKGksIDB4MjApDQogICAgICAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHdPZmZzZXQsIG9mZnNldCksIG1sb2FkKGFkZChyT2Zmc2V0LCBvZmZzZXQpKSkNCiAgICAgICAgICAgICAgICAgICAgIGkgOj0gYWRkKGksIDEpDQogICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAganVtcCh0YWdfbG9vcCkNCiAgICAgICAgICAgICBlbmQ6DQogICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodGd0LCBhZGQoMHgyMCwgbWxvYWQodGd0KSkpLCAwKQ0KICAgICAgICAgfQ0KICAgICB9DQogfQ0KDQogLy8gQ2hlY2sgdGhhdCBhbiBSTFAgaXRlbSBpcyB2YWxpZC4NCiAgICAgZnVuY3Rpb24gX3ZhbGlkYXRlKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsNCiAgICAgICAgIC8vIENoZWNrIHRoYXQgUkxQIGlzIHdlbGwtZm9ybWVkLg0KICAgICAgICAgdWludCBiMDsNCiAgICAgICAgIHVpbnQgYjE7DQogICAgICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICAgICAgICAgIGIxIDo9IGJ5dGUoMSwgbWxvYWQobWVtUHRyKSkNCiAgICAgICAgIH0NCiAgICAgICAgIGlmKGIwID09IERBVEFfU0hPUlRfU1RBUlQgKyAxICYmIGIxIDwgREFUQV9TSE9SVF9TVEFSVCkNCiAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgfQ0KfQ0KDQoNCg0KLy8vIEBkZXYgVGhpcyBjb250cmFjdCBhbGxvd3MgZm9yIGByZWNpcGllbnRgIHRvIHNldCBhbmQgbW9kaWZ5IG1pbGVzdG9uZXMNCmNvbnRyYWN0IE1pbGVzdG9uZVRyYWNrZXIgew0KICAgIHVzaW5nIFJMUCBmb3IgUkxQLlJMUEl0ZW07DQogICAgdXNpbmcgUkxQIGZvciBSTFAuSXRlcmF0b3I7DQogICAgdXNpbmcgUkxQIGZvciBieXRlczsNCg0KICAgIHN0cnVjdCBNaWxlc3RvbmUgew0KICAgICAgICBzdHJpbmcgZGVzY3JpcHRpb247ICAgICAvLyBEZXNjcmlwdGlvbiBvZiB0aGlzIG1pbGVzdG9uZQ0KICAgICAgICBzdHJpbmcgdXJsOyAgICAgICAgICAgICAvLyBBIGxpbmsgdG8gbW9yZSBpbmZvcm1hdGlvbiAoc3dhcm0gZ2F0ZXdheSkNCiAgICAgICAgdWludCBtaW5Db21wbGV0aW9uRGF0ZTsgLy8gRWFybGllc3QgVU5JWCB0aW1lIHRoZSBtaWxlc3RvbmUgY2FuIGJlIHBhaWQNCiAgICAgICAgdWludCBtYXhDb21wbGV0aW9uRGF0ZTsgLy8gTGF0ZXN0IFVOSVggdGltZSB0aGUgbWlsZXN0b25lIGNhbiBiZSBwYWlkDQogICAgICAgIGFkZHJlc3MgbWlsZXN0b25lTGVhZExpbms7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNpbWlsYXIgdG8gYHJlY2lwaWVudGBidXQgZm9yIHRoaXMgbWlsZXN0b25lDQogICAgICAgIGFkZHJlc3MgcmV2aWV3ZXI7ICAgICAgIC8vIENhbiByZWplY3QgdGhlIGNvbXBsZXRpb24gb2YgdGhpcyBtaWxlc3RvbmUNCiAgICAgICAgdWludCByZXZpZXdUaW1lOyAgICAgICAgLy8gSG93IG1hbnkgc2Vjb25kcyB0aGUgcmV2aWV3ZXIgaGFzIHRvIHJldmlldw0KICAgICAgICBhZGRyZXNzIHBheW1lbnRTb3VyY2U7ICAvLyBXaGVyZSB0aGUgbWlsZXN0b25lIHBheW1lbnQgaXMgc2VudCBmcm9tDQogICAgICAgIGJ5dGVzIHBheURhdGE7ICAgICAgICAgIC8vIERhdGEgZGVmaW5pbmcgaG93IG11Y2ggZXRoZXIgaXMgc2VudCB3aGVyZQ0KDQogICAgICAgIE1pbGVzdG9uZVN0YXR1cyBzdGF0dXM7IC8vIEN1cnJlbnQgc3RhdHVzIG9mIHRoZSBtaWxlc3RvbmUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gKENvbXBsZXRlZCwgQXV0aG9yaXplZEZvclBheW1lbnQuLi4pDQogICAgICAgIHVpbnQgZG9uZVRpbWU7ICAgICAgICAgIC8vIFVOSVggdGltZSB3aGVuIHRoZSBtaWxlc3RvbmUgd2FzIG1hcmtlZCBET05FDQogICAgfQ0KDQogICAgLy8gVGhlIGxpc3Qgb2YgYWxsIHRoZSBtaWxlc3RvbmVzLg0KICAgIE1pbGVzdG9uZVtdIHB1YmxpYyBtaWxlc3RvbmVzOw0KDQogICAgYWRkcmVzcyBwdWJsaWMgcmVjaXBpZW50OyAgIC8vIENhbGxzIGZ1bmN0aW9ucyBpbiB0aGUgbmFtZSBvZiB0aGUgcmVjaXBpZW50DQogICAgYWRkcmVzcyBwdWJsaWMgZG9ub3I7ICAgICAgIC8vIENhbGxzIGZ1bmN0aW9ucyBpbiB0aGUgbmFtZSBvZiB0aGUgZG9ub3INCiAgICBhZGRyZXNzIHB1YmxpYyBhcmJpdHJhdG9yOyAgLy8gQ2FsbHMgZnVuY3Rpb25zIGluIHRoZSBuYW1lIG9mIHRoZSBhcmJpdHJhdG9yDQoNCiAgICBlbnVtIE1pbGVzdG9uZVN0YXR1cyB7DQogICAgICAgIEFjY2VwdGVkQW5kSW5Qcm9ncmVzcywNCiAgICAgICAgQ29tcGxldGVkLA0KICAgICAgICBBdXRob3JpemVkRm9yUGF5bWVudCwNCiAgICAgICAgQ2FuY2VsZWQNCiAgICB9DQoNCiAgICAvLyBUcnVlIGlmIHRoZSBjYW1wYWlnbiBoYXMgYmVlbiBjYW5jZWxlZA0KICAgIGJvb2wgcHVibGljIGNhbXBhaWduQ2FuY2VsZWQ7DQoNCiAgICAvLyBUcnVlIGlmIGFuIGFwcHJvdmFsIG9uIGEgY2hhbmdlIHRvIGBtaWxlc3RvbmVzYCBpcyBhIHBlbmRpbmcNCiAgICBib29sIHB1YmxpYyBjaGFuZ2luZ01pbGVzdG9uZXM7DQoNCiAgICAvLyBUaGUgcGVuZGluZyBjaGFuZ2UgdG8gYG1pbGVzdG9uZXNgIGVuY29kZWQgaW4gUkxQDQogICAgYnl0ZXMgcHVibGljIHByb3Bvc2VkTWlsZXN0b25lczsNCg0KDQogICAgLy8vIEBkZXYgVGhlIGZvbGxvd2luZyBtb2RpZmllcnMgb25seSBhbGxvdyBzcGVjaWZpYyByb2xlcyB0byBjYWxsIGZ1bmN0aW9ucw0KICAgIC8vLyB3aXRoIHRoZXNlIG1vZGlmaWVycw0KICAgIG1vZGlmaWVyIG9ubHlSZWNpcGllbnQgeyBpZiAobXNnLnNlbmRlciAhPSAgcmVjaXBpZW50KSB0aHJvdzsgXzsgfQ0KICAgIG1vZGlmaWVyIG9ubHlBcmJpdHJhdG9yIHsgaWYgKG1zZy5zZW5kZXIgIT0gYXJiaXRyYXRvcikgdGhyb3c7IF87IH0NCiAgICBtb2RpZmllciBvbmx5RG9ub3IgeyBpZiAobXNnLnNlbmRlciAhPSBkb25vcikgdGhyb3c7IF87IH0NCg0KICAgIC8vLyBAZGV2IFRoZSBmb2xsb3dpbmcgbW9kaWZpZXJzIHByZXZlbnQgZnVuY3Rpb25zIGZyb20gYmVpbmcgY2FsbGVkIGlmIHRoZQ0KICAgIC8vLyBjYW1wYWlnbiBoYXMgYmVlbiBjYW5jZWxlZCBvciBpZiBuZXcgbWlsZXN0b25lcyBhcmUgYmVpbmcgcHJvcG9zZWQNCiAgICBtb2RpZmllciBjYW1wYWlnbk5vdENhbmNlbGVkIHsgaWYgKGNhbXBhaWduQ2FuY2VsZWQpIHRocm93OyBfOyB9DQogICAgbW9kaWZpZXIgbm90Q2hhbmdpbmcgeyBpZiAoY2hhbmdpbmdNaWxlc3RvbmVzKSB0aHJvdzsgXzsgfQ0KDQogLy8gQGRldiBFdmVudHMgdG8gbWFrZSB0aGUgcGF5bWVudCBtb3ZlbWVudHMgZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluDQogICAgZXZlbnQgTmV3TWlsZXN0b25lTGlzdFByb3Bvc2VkKCk7DQogICAgZXZlbnQgTmV3TWlsZXN0b25lTGlzdFVucHJvcG9zZWQoKTsNCiAgICBldmVudCBOZXdNaWxlc3RvbmVMaXN0QWNjZXB0ZWQoKTsNCiAgICBldmVudCBQcm9wb3NhbFN0YXR1c0NoYW5nZWQodWludCBpZFByb3Bvc2FsLCBNaWxlc3RvbmVTdGF0dXMgbmV3UHJvcG9zYWwpOw0KICAgIGV2ZW50IENhbXBhaWduQ2FuY2VsZWQoKTsNCg0KDQovLy8vLy8vLy8vLw0KLy8gQ29uc3RydWN0b3INCi8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGUgQ29uc3RydWN0b3IgY3JlYXRlcyB0aGUgTWlsZXN0b25lIGNvbnRyYWN0IG9uIHRoZSBibG9ja2NoYWluDQogICAgLy8vIEBwYXJhbSBfYXJiaXRyYXRvciBBZGRyZXNzIGFzc2lnbmVkIHRvIGJlIHRoZSBhcmJpdHJhdG9yDQogICAgLy8vIEBwYXJhbSBfZG9ub3IgQWRkcmVzcyBhc3NpZ25lZCB0byBiZSB0aGUgZG9ub3INCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgQWRkcmVzcyBhc3NpZ25lZCB0byBiZSB0aGUgcmVjaXBpZW50DQogICAgZnVuY3Rpb24gTWlsZXN0b25lVHJhY2tlciAoDQogICAgICAgIGFkZHJlc3MgX2FyYml0cmF0b3IsDQogICAgICAgIGFkZHJlc3MgX2Rvbm9yLA0KICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQNCiAgICApIHsNCiAgICAgICAgYXJiaXRyYXRvciA9IF9hcmJpdHJhdG9yOw0KICAgICAgICBkb25vciA9IF9kb25vcjsNCiAgICAgICAgcmVjaXBpZW50ID0gX3JlY2lwaWVudDsNCiAgICB9DQoNCg0KLy8vLy8vLy8vDQovLyBIZWxwZXIgZnVuY3Rpb25zDQovLy8vLy8vLy8NCg0KICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgbWlsZXN0b25lcyBldmVyIGNyZWF0ZWQgZXZlbiBpZiB0aGV5IHdlcmUgY2FuY2VsZWQNCiAgICBmdW5jdGlvbiBudW1iZXJPZk1pbGVzdG9uZXMoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBtaWxlc3RvbmVzLmxlbmd0aDsNCiAgICB9DQoNCg0KLy8vLy8vLy8NCi8vIENoYW5nZSBwbGF5ZXJzDQovLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlBcmJpdHJhdG9yYCBSZWFzc2lnbnMgdGhlIGFyYml0cmF0b3IgdG8gYSBuZXcgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gX25ld0FyYml0cmF0b3IgVGhlIG5ldyBhcmJpdHJhdG9yDQogICAgZnVuY3Rpb24gY2hhbmdlQXJiaXRyYXRvcihhZGRyZXNzIF9uZXdBcmJpdHJhdG9yKSBvbmx5QXJiaXRyYXRvciB7DQogICAgICAgIGFyYml0cmF0b3IgPSBfbmV3QXJiaXRyYXRvcjsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBgb25seURvbm9yYCBSZWFzc2lnbnMgdGhlIGBkb25vcmAgdG8gYSBuZXcgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gX25ld0Rvbm9yIFRoZSBuZXcgZG9ub3INCiAgICBmdW5jdGlvbiBjaGFuZ2VEb25vcihhZGRyZXNzIF9uZXdEb25vcikgb25seURvbm9yIHsNCiAgICAgICAgZG9ub3IgPSBfbmV3RG9ub3I7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRgIFJlYXNzaWducyB0aGUgYHJlY2lwaWVudGAgdG8gYSBuZXcgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gX25ld1JlY2lwaWVudCBUaGUgbmV3IHJlY2lwaWVudA0KICAgIGZ1bmN0aW9uIGNoYW5nZVJlY2lwaWVudChhZGRyZXNzIF9uZXdSZWNpcGllbnQpIG9ubHlSZWNpcGllbnQgew0KICAgICAgICByZWNpcGllbnQgPSBfbmV3UmVjaXBpZW50Ow0KICAgIH0NCg0KDQovLy8vLy8vLy8vLy8NCi8vIENyZWF0aW9uIGFuZCBtb2RpZmljYXRpb24gb2YgTWlsZXN0b25lcw0KLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBgb25seVJlY2lwaWVudGAgUHJvcG9zZXMgbmV3IG1pbGVzdG9uZXMgb3IgY2hhbmdlcyBvbGQNCiAgICAvLy8gIG1pbGVzdG9uZXMsIHRoaXMgd2lsbCByZXF1aXJlIGEgdXNlciBpbnRlcmZhY2UgdG8gYmUgYnVpbHQgdXAgdG8NCiAgICAvLy8gIHN1cHBvcnQgdGhpcyBmdW5jdGlvbmFsaXR5IGFzIGFza3MgZm9yIFJMUCBlbmNvZGVkIGJ5dGVjb2RlIHRvIGJlDQogICAgLy8vICBnZW5lcmF0ZWQsIHVudGlsIHRoaXMgaW50ZXJmYWNlIGlzIGJ1aWx0IHlvdSBjYW4gdXNlIHRoaXMgc2NyaXB0Og0KICAgIC8vLyAgaHR0cHM6Ly9naXRodWIuY29tL0dpdmV0aC9taWxlc3RvbmV0cmFja2VyL2Jsb2IvbWFzdGVyL2pzL21pbGVzdG9uZXRyYWNrZXJfaGVscGVyLmpzDQogICAgLy8vICB0aGUgZnVuY3Rpb25zIG1pbGVzdG9uZXMyYnl0ZXMgYW5kIGJ5dGVzMm1pbGVzdG9uZXMgd2lsbCBlbmFibGUgdGhlDQogICAgLy8vICByZWNpcGllbnQgdG8gZW5jb2RlIGFuZCBkZWNvZGUgYSBsaXN0IG9mIG1pbGVzdG9uZXMsIGFsc28gc2VlDQogICAgLy8vICBodHRwczovL2dpdGh1Yi5jb20vR2l2ZXRoL21pbGVzdG9uZXRyYWNrZXIvYmxvYi9tYXN0ZXIvUkVBRE1FLm1kDQogICAgLy8vIEBwYXJhbSBfbmV3TWlsZXN0b25lcyBUaGUgUkxQIGVuY29kZWQgbGlzdCBvZiBtaWxlc3RvbmVzOyBlYWNoIG1pbGVzdG9uZQ0KICAgIC8vLyAgaGFzIHRoZXNlIGZpZWxkczoNCiAgICAvLy8gICAgICAgc3RyaW5nIGRlc2NyaXB0aW9uLA0KICAgIC8vLyAgICAgICBzdHJpbmcgdXJsLA0KICAgIC8vLyAgICAgICB1aW50IG1pbkNvbXBsZXRpb25EYXRlLCAgLy8gc2Vjb25kcyBzaW5jZSAxLzEvMTk3MCAoVU5JWCB0aW1lKQ0KICAgIC8vLyAgICAgICB1aW50IG1heENvbXBsZXRpb25EYXRlLCAgLy8gc2Vjb25kcyBzaW5jZSAxLzEvMTk3MCAoVU5JWCB0aW1lKQ0KICAgIC8vLyAgICAgICBhZGRyZXNzIG1pbGVzdG9uZUxlYWRMaW5rLA0KICAgIC8vLyAgICAgICBhZGRyZXNzIHJldmlld2VyLA0KICAgIC8vLyAgICAgICB1aW50IHJldmlld1RpbWUNCiAgICAvLy8gICAgICAgYWRkcmVzcyBwYXltZW50U291cmNlLA0KICAgIC8vLyAgICAgICBieXRlcyBwYXlEYXRhLA0KICAgIGZ1bmN0aW9uIHByb3Bvc2VNaWxlc3RvbmVzKGJ5dGVzIF9uZXdNaWxlc3RvbmVzDQogICAgKSBvbmx5UmVjaXBpZW50IGNhbXBhaWduTm90Q2FuY2VsZWQgew0KICAgICAgICBwcm9wb3NlZE1pbGVzdG9uZXMgPSBfbmV3TWlsZXN0b25lczsNCiAgICAgICAgY2hhbmdpbmdNaWxlc3RvbmVzID0gdHJ1ZTsNCiAgICAgICAgTmV3TWlsZXN0b25lTGlzdFByb3Bvc2VkKCk7DQogICAgfQ0KDQoNCi8vLy8vLy8vLy8vLw0KLy8gTm9ybWFsIGFjdGlvbnMgdGhhdCB3aWxsIGNoYW5nZSB0aGUgc3RhdGUgb2YgdGhlIG1pbGVzdG9uZXMNCi8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRgIENhbmNlbHMgdGhlIHByb3Bvc2VkIG1pbGVzdG9uZXMgYW5kIHJlYWN0aXZhdGVzDQogICAgLy8vICB0aGUgcHJldmlvdXMgc2V0IG9mIG1pbGVzdG9uZXMNCiAgICBmdW5jdGlvbiB1bnByb3Bvc2VNaWxlc3RvbmVzKCkgb25seVJlY2lwaWVudCBjYW1wYWlnbk5vdENhbmNlbGVkIHsNCiAgICAgICAgZGVsZXRlIHByb3Bvc2VkTWlsZXN0b25lczsNCiAgICAgICAgY2hhbmdpbmdNaWxlc3RvbmVzID0gZmFsc2U7DQogICAgICAgIE5ld01pbGVzdG9uZUxpc3RVbnByb3Bvc2VkKCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlEb25vcmAgQXBwcm92ZXMgdGhlIHByb3Bvc2VkIG1pbGVzdG9uZSBsaXN0DQogICAgLy8vIEBwYXJhbSBfaGFzaFByb3Bvc2FscyBUaGUgc2hhMygpIG9mIHRoZSBwcm9wb3NlZCBtaWxlc3RvbmUgbGlzdCdzDQogICAgLy8vICBieXRlY29kZTsgdGhpcyBjb25maXJtcyB0aGF0IHRoZSBgZG9ub3JgIGtub3dzIHRoZSBzZXQgb2YgbWlsZXN0b25lcw0KICAgIC8vLyAgdGhleSBhcmUgYXBwcm92aW5nDQogICAgZnVuY3Rpb24gYWNjZXB0UHJvcG9zZWRNaWxlc3RvbmVzKGJ5dGVzMzIgX2hhc2hQcm9wb3NhbHMNCiAgICApIG9ubHlEb25vciBjYW1wYWlnbk5vdENhbmNlbGVkIHsNCg0KICAgICAgICB1aW50IGk7DQoNCiAgICAgICAgaWYgKCFjaGFuZ2luZ01pbGVzdG9uZXMpIHRocm93Ow0KICAgICAgICBpZiAoc2hhMyhwcm9wb3NlZE1pbGVzdG9uZXMpICE9IF9oYXNoUHJvcG9zYWxzKSB0aHJvdzsNCg0KICAgICAgICAvLyBDYW5jZWwgYWxsIHRoZSB1bmZpbmlzaGVkIG1pbGVzdG9uZXMNCiAgICAgICAgZm9yIChpPTA7IGk8bWlsZXN0b25lcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKG1pbGVzdG9uZXNbaV0uc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5BdXRob3JpemVkRm9yUGF5bWVudCkgew0KICAgICAgICAgICAgICAgIG1pbGVzdG9uZXNbaV0uc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkNhbmNlbGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIERlY29kZSB0aGUgUkxQIGVuY29kZWQgbWlsZXN0b25lcyBhbmQgYWRkIHRoZW0gdG8gdGhlIG1pbGVzdG9uZXMgbGlzdA0KICAgICAgICBieXRlcyBtZW1vcnkgbVByb3Bvc2VkTWlsZXN0b25lcyA9IHByb3Bvc2VkTWlsZXN0b25lczsNCg0KICAgICAgICB2YXIgaXRtUHJvcG9zYWxzID0gbVByb3Bvc2VkTWlsZXN0b25lcy50b1JMUEl0ZW0odHJ1ZSk7DQoNCiAgICAgICAgaWYgKCFpdG1Qcm9wb3NhbHMuaXNMaXN0KCkpIHRocm93Ow0KDQogICAgICAgIHZhciBpdHJQcm9wb3NhbHMgPSBpdG1Qcm9wb3NhbHMuaXRlcmF0b3IoKTsNCg0KICAgICAgICB3aGlsZShpdHJQcm9wb3NhbHMuaGFzTmV4dCgpKSB7DQoNCg0KICAgICAgICAgICAgdmFyIGl0bVByb3Bvc2FsID0gaXRyUHJvcG9zYWxzLm5leHQoKTsNCg0KICAgICAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbbWlsZXN0b25lcy5sZW5ndGggKytdOw0KDQogICAgICAgICAgICBpZiAoIWl0bVByb3Bvc2FsLmlzTGlzdCgpKSB0aHJvdzsNCg0KICAgICAgICAgICAgdmFyIGl0clByb3Bvc2FsID0gaXRtUHJvcG9zYWwuaXRlcmF0b3IoKTsNCg0KICAgICAgICAgICAgbWlsZXN0b25lLmRlc2NyaXB0aW9uID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvQXNjaWkoKTsNCiAgICAgICAgICAgIG1pbGVzdG9uZS51cmwgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9Bc2NpaSgpOw0KICAgICAgICAgICAgbWlsZXN0b25lLm1pbkNvbXBsZXRpb25EYXRlID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvVWludCgpOw0KICAgICAgICAgICAgbWlsZXN0b25lLm1heENvbXBsZXRpb25EYXRlID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvVWludCgpOw0KICAgICAgICAgICAgbWlsZXN0b25lLm1pbGVzdG9uZUxlYWRMaW5rID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvQWRkcmVzcygpOw0KICAgICAgICAgICAgbWlsZXN0b25lLnJldmlld2VyID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvQWRkcmVzcygpOw0KICAgICAgICAgICAgbWlsZXN0b25lLnJldmlld1RpbWUgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9VaW50KCk7DQogICAgICAgICAgICBtaWxlc3RvbmUucGF5bWVudFNvdXJjZSA9IGl0clByb3Bvc2FsLm5leHQoKS50b0FkZHJlc3MoKTsNCiAgICAgICAgICAgIG1pbGVzdG9uZS5wYXlEYXRhID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvRGF0YSgpOw0KDQogICAgICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzczsNCg0KICAgICAgICB9DQoNCiAgICAgICAgZGVsZXRlIHByb3Bvc2VkTWlsZXN0b25lczsNCiAgICAgICAgY2hhbmdpbmdNaWxlc3RvbmVzID0gZmFsc2U7DQogICAgICAgIE5ld01pbGVzdG9uZUxpc3RBY2NlcHRlZCgpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5UmVjaXBpZW50T3JMZWFkTGlua2BNYXJrcyBhIG1pbGVzdG9uZSBhcyBET05FIGFuZA0KICAgIC8vLyAgcmVhZHkgZm9yIHJldmlldw0KICAgIC8vLyBAcGFyYW0gX2lkTWlsZXN0b25lIElEIG9mIHRoZSBtaWxlc3RvbmUgdGhhdCBoYXMgYmVlbiBjb21wbGV0ZWQNCiAgICBmdW5jdGlvbiBtYXJrTWlsZXN0b25lQ29tcGxldGUodWludCBfaWRNaWxlc3RvbmUpDQogICAgICAgIGNhbXBhaWduTm90Q2FuY2VsZWQgbm90Q2hhbmdpbmcNCiAgICB7DQogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93Ow0KICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOw0KICAgICAgICBpZiAoICAobXNnLnNlbmRlciAhPSBtaWxlc3RvbmUubWlsZXN0b25lTGVhZExpbmspDQogICAgICAgICAgICAmJihtc2cuc2VuZGVyICE9IHJlY2lwaWVudCkpDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgaWYgKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzcykgdGhyb3c7DQogICAgICAgIGlmIChub3cgPCBtaWxlc3RvbmUubWluQ29tcGxldGlvbkRhdGUpIHRocm93Ow0KICAgICAgICBpZiAobm93ID4gbWlsZXN0b25lLm1heENvbXBsZXRpb25EYXRlKSB0aHJvdzsNCiAgICAgICAgbWlsZXN0b25lLnN0YXR1cyA9IE1pbGVzdG9uZVN0YXR1cy5Db21wbGV0ZWQ7DQogICAgICAgIG1pbGVzdG9uZS5kb25lVGltZSA9IG5vdzsNCiAgICAgICAgUHJvcG9zYWxTdGF0dXNDaGFuZ2VkKF9pZE1pbGVzdG9uZSwgbWlsZXN0b25lLnN0YXR1cyk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZXZpZXdlcmAgQXBwcm92ZXMgYSBzcGVjaWZpYyBtaWxlc3RvbmUNCiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRoYXQgaXMgYXBwcm92ZWQNCiAgICBmdW5jdGlvbiBhcHByb3ZlQ29tcGxldGVkTWlsZXN0b25lKHVpbnQgX2lkTWlsZXN0b25lKQ0KICAgICAgICBjYW1wYWlnbk5vdENhbmNlbGVkIG5vdENoYW5naW5nDQogICAgew0KICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsNCiAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbX2lkTWlsZXN0b25lXTsNCiAgICAgICAgaWYgKChtc2cuc2VuZGVyICE9IG1pbGVzdG9uZS5yZXZpZXdlcikgfHwNCiAgICAgICAgICAgIChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5Db21wbGV0ZWQpKSB0aHJvdzsNCg0KICAgICAgICBhdXRob3JpemVQYXltZW50KF9pZE1pbGVzdG9uZSk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZXZpZXdlcmAgUmVqZWN0cyBhIHNwZWNpZmljIG1pbGVzdG9uZSdzIGNvbXBsZXRpb24gYW5kDQogICAgLy8vICByZXZlcnRzIHRoZSBgbWlsZXN0b25lLnN0YXR1c2AgYmFjayB0byB0aGUgYEFjY2VwdGVkQW5kSW5Qcm9ncmVzc2ANCiAgICAvLy8gIHN0YXRlDQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0aGF0IGlzIGJlaW5nIHJlamVjdGVkDQogICAgZnVuY3Rpb24gcmVqZWN0TWlsZXN0b25lKHVpbnQgX2lkTWlsZXN0b25lKQ0KICAgICAgICBjYW1wYWlnbk5vdENhbmNlbGVkIG5vdENoYW5naW5nDQogICAgew0KICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsNCiAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbX2lkTWlsZXN0b25lXTsNCiAgICAgICAgaWYgKChtc2cuc2VuZGVyICE9IG1pbGVzdG9uZS5yZXZpZXdlcikgfHwNCiAgICAgICAgICAgIChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5Db21wbGV0ZWQpKSB0aHJvdzsNCg0KICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzczsNCiAgICAgICAgUHJvcG9zYWxTdGF0dXNDaGFuZ2VkKF9pZE1pbGVzdG9uZSwgbWlsZXN0b25lLnN0YXR1cyk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRPckxlYWRMaW5rYCBTZW5kcyB0aGUgbWlsZXN0b25lIHBheW1lbnQgYXMNCiAgICAvLy8gIHNwZWNpZmllZCBpbiBgcGF5RGF0YWA7IHRoZSByZWNpcGllbnQgY2FuIG9ubHkgY2FsbCB0aGlzIGFmdGVyIHRoZQ0KICAgIC8vLyAgYHJldmlld1RpbWVgIGhhcyBlbGFwc2VkDQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0byBiZSBwYWlkIG91dA0KICAgIGZ1bmN0aW9uIHJlcXVlc3RNaWxlc3RvbmVQYXltZW50KHVpbnQgX2lkTWlsZXN0b25lDQogICAgICAgICkgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZyB7DQogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93Ow0KICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOw0KICAgICAgICBpZiAoICAobXNnLnNlbmRlciAhPSBtaWxlc3RvbmUubWlsZXN0b25lTGVhZExpbmspDQogICAgICAgICAgICAmJihtc2cuc2VuZGVyICE9IHJlY2lwaWVudCkpDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgaWYgICgobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQ29tcGxldGVkKSB8fA0KICAgICAgICAgICAgIChub3cgPCBtaWxlc3RvbmUuZG9uZVRpbWUgKyBtaWxlc3RvbmUucmV2aWV3VGltZSkpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICBhdXRob3JpemVQYXltZW50KF9pZE1pbGVzdG9uZSk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRgIENhbmNlbHMgYSBwcmV2aW91c2x5IGFjY2VwdGVkIG1pbGVzdG9uZQ0KICAgIC8vLyBAcGFyYW0gX2lkTWlsZXN0b25lIElEIG9mIHRoZSBtaWxlc3RvbmUgdG8gYmUgY2FuY2VsZWQNCiAgICBmdW5jdGlvbiBjYW5jZWxNaWxlc3RvbmUodWludCBfaWRNaWxlc3RvbmUpDQogICAgICAgIG9ubHlSZWNpcGllbnQgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZw0KICAgIHsNCiAgICAgICAgaWYgKF9pZE1pbGVzdG9uZSA+PSBtaWxlc3RvbmVzLmxlbmd0aCkgdGhyb3c7DQogICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW19pZE1pbGVzdG9uZV07DQogICAgICAgIGlmICAoKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzcykgJiYNCiAgICAgICAgICAgICAobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQ29tcGxldGVkKSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIG1pbGVzdG9uZS5zdGF0dXMgPSBNaWxlc3RvbmVTdGF0dXMuQ2FuY2VsZWQ7DQogICAgICAgIFByb3Bvc2FsU3RhdHVzQ2hhbmdlZChfaWRNaWxlc3RvbmUsIG1pbGVzdG9uZS5zdGF0dXMpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5QXJiaXRyYXRvcmAgRm9yY2VzIGEgbWlsZXN0b25lIHRvIGJlIHBhaWQgb3V0IGFzIGxvbmcgYXMgaXQNCiAgICAvLy8gaGFzIG5vdCBiZWVuIHBhaWQgb3IgY2FuY2VsZWQNCiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRvIGJlIHBhaWQgb3V0DQogICAgZnVuY3Rpb24gYXJiaXRyYXRlQXBwcm92ZU1pbGVzdG9uZSh1aW50IF9pZE1pbGVzdG9uZQ0KICAgICkgb25seUFyYml0cmF0b3IgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZyB7DQogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93Ow0KICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOw0KICAgICAgICBpZiAgKChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5BY2NlcHRlZEFuZEluUHJvZ3Jlc3MpICYmDQogICAgICAgICAgICAgKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZCkpDQogICAgICAgICAgIHRocm93Ow0KICAgICAgICBhdXRob3JpemVQYXltZW50KF9pZE1pbGVzdG9uZSk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlBcmJpdHJhdG9yYCBDYW5jZWxzIHRoZSBlbnRpcmUgY2FtcGFpZ24gdm9pZGluZyBhbGwNCiAgICAvLy8gIG1pbGVzdG9uZXMgdm8NCiAgICBmdW5jdGlvbiBhcmJpdHJhdGVDYW5jZWxDYW1wYWlnbigpIG9ubHlBcmJpdHJhdG9yIGNhbXBhaWduTm90Q2FuY2VsZWQgew0KICAgICAgICBjYW1wYWlnbkNhbmNlbGVkID0gdHJ1ZTsNCiAgICAgICAgQ2FtcGFpZ25DYW5jZWxlZCgpOw0KICAgIH0NCg0KICAgIC8vIEBkZXYgVGhpcyBpbnRlcm5hbCBmdW5jdGlvbiBpcyBleGVjdXRlZCB3aGVuIHRoZSBtaWxlc3RvbmUgaXMgcGFpZCBvdXQNCiAgICBmdW5jdGlvbiBhdXRob3JpemVQYXltZW50KHVpbnQgX2lkTWlsZXN0b25lKSBpbnRlcm5hbCB7DQogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93Ow0KICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOw0KICAgICAgICAvLyBSZWNoZWNrIGFnYWluIHRvIG5vdCBwYXkgdHdpY2UNCiAgICAgICAgaWYgKG1pbGVzdG9uZS5zdGF0dXMgPT0gTWlsZXN0b25lU3RhdHVzLkF1dGhvcml6ZWRGb3JQYXltZW50KSB0aHJvdzsNCiAgICAgICAgbWlsZXN0b25lLnN0YXR1cyA9IE1pbGVzdG9uZVN0YXR1cy5BdXRob3JpemVkRm9yUGF5bWVudDsNCiAgICAgICAgaWYgKCFtaWxlc3RvbmUucGF5bWVudFNvdXJjZS5jYWxsLnZhbHVlKDApKG1pbGVzdG9uZS5wYXlEYXRhKSkNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICBQcm9wb3NhbFN0YXR1c0NoYW5nZWQoX2lkTWlsZXN0b25lLCBtaWxlc3RvbmUuc3RhdHVzKTsNCiAgICB9DQp9'