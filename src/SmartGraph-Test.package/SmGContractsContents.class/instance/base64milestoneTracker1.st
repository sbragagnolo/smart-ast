base 64 content
base64milestoneTracker1
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC42Ow0KDQovKioNCiogQHRpdGxlIFJMUFJlYWRlcg0KKg0KKiBSTFBSZWFkZXIgaXMgdXNlZCB0byByZWFkIGFuZCBwYXJzZSBSTFAgZW5jb2RlZCBkYXRhIGluIG1lbW9yeS4NCioNCiogQGF1dGhvciBBbmRyZWFzIE9sb2Zzc29uIChhbmRyb2xvMTk4MEBnbWFpbC5jb20pDQoqLw0KbGlicmFyeSBSTFAgew0KDQogdWludCBjb25zdGFudCBEQVRBX1NIT1JUX1NUQVJUID0gMHg4MDsNCiB1aW50IGNvbnN0YW50IERBVEFfTE9OR19TVEFSVCA9IDB4Qjg7DQogdWludCBjb25zdGFudCBMSVNUX1NIT1JUX1NUQVJUID0gMHhDMDsNCiB1aW50IGNvbnN0YW50IExJU1RfTE9OR19TVEFSVCA9IDB4Rjg7DQoNCiB1aW50IGNvbnN0YW50IERBVEFfTE9OR19PRkZTRVQgPSAweEI3Ow0KIHVpbnQgY29uc3RhbnQgTElTVF9MT05HX09GRlNFVCA9IDB4Rjc7DQoNCg0KIHN0cnVjdCBSTFBJdGVtIHsNCiAgICAgdWludCBfdW5zYWZlX21lbVB0cjsgICAgLy8gUG9pbnRlciB0byB0aGUgUkxQLWVuY29kZWQgYnl0ZXMuDQogICAgIHVpbnQgX3Vuc2FmZV9sZW5ndGg7ICAgIC8vIE51bWJlciBvZiBieXRlcy4gVGhpcyBpcyB0aGUgZnVsbCBsZW5ndGggb2YgdGhlIHN0cmluZy4NCiB9DQoNCiBzdHJ1Y3QgSXRlcmF0b3Igew0KICAgICBSTFBJdGVtIF91bnNhZmVfaXRlbTsgICAvLyBJdGVtIHRoYXQncyBiZWluZyBpdGVyYXRlZCBvdmVyLg0KICAgICB1aW50IF91bnNhZmVfbmV4dFB0cjsgICAvLyBQb3NpdGlvbiBvZiB0aGUgbmV4dCBpdGVtIGluIHRoZSBsaXN0Lg0KIH0NCg0KIC8qIEl0ZXJhdG9yICovDQoNCiBmdW5jdGlvbiBuZXh0KEl0ZXJhdG9yIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSBzdWJJdGVtKSB7DQogICAgIGlmKGhhc05leHQoc2VsZikpIHsNCiAgICAgICAgIHZhciBwdHIgPSBzZWxmLl91bnNhZmVfbmV4dFB0cjsNCiAgICAgICAgIHZhciBpdGVtTGVuZ3RoID0gX2l0ZW1MZW5ndGgocHRyKTsNCiAgICAgICAgIHN1Ykl0ZW0uX3Vuc2FmZV9tZW1QdHIgPSBwdHI7DQogICAgICAgICBzdWJJdGVtLl91bnNhZmVfbGVuZ3RoID0gaXRlbUxlbmd0aDsNCiAgICAgICAgIHNlbGYuX3Vuc2FmZV9uZXh0UHRyID0gcHRyICsgaXRlbUxlbmd0aDsNCiAgICAgfQ0KICAgICBlbHNlDQogICAgICAgICB0aHJvdzsNCiB9DQoNCiBmdW5jdGlvbiBuZXh0KEl0ZXJhdG9yIG1lbW9yeSBzZWxmLCBib29sIHN0cmljdCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoUkxQSXRlbSBtZW1vcnkgc3ViSXRlbSkgew0KICAgICBzdWJJdGVtID0gbmV4dChzZWxmKTsNCiAgICAgaWYoc3RyaWN0ICYmICFfdmFsaWRhdGUoc3ViSXRlbSkpDQogICAgICAgICB0aHJvdzsNCiAgICAgcmV0dXJuOw0KIH0NCg0KIGZ1bmN0aW9uIGhhc05leHQoSXRlcmF0b3IgbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgdmFyIGl0ZW0gPSBzZWxmLl91bnNhZmVfaXRlbTsNCiAgICAgcmV0dXJuIHNlbGYuX3Vuc2FmZV9uZXh0UHRyIDwgaXRlbS5fdW5zYWZlX21lbVB0ciArIGl0ZW0uX3Vuc2FmZV9sZW5ndGg7DQogfQ0KDQogLyogUkxQSXRlbSAqLw0KDQogLy8vIEBkZXYgQ3JlYXRlcyBhbiBSTFBJdGVtIGZyb20gYW4gYXJyYXkgb2YgUkxQIGVuY29kZWQgYnl0ZXMuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgZW5jb2RlZCBieXRlcy4NCiAvLy8gQHJldHVybiBBbiBSTFBJdGVtDQogZnVuY3Rpb24gdG9STFBJdGVtKGJ5dGVzIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSkgew0KICAgICB1aW50IGxlbiA9IHNlbGYubGVuZ3RoOw0KICAgICBpZiAobGVuID09IDApIHsNCiAgICAgICAgIHJldHVybiBSTFBJdGVtKDAsIDApOw0KICAgICB9DQogICAgIHVpbnQgbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICBtZW1QdHIgOj0gYWRkKHNlbGYsIDB4MjApDQogICAgIH0NCiAgICAgcmV0dXJuIFJMUEl0ZW0obWVtUHRyLCBsZW4pOw0KIH0NCg0KIC8vLyBAZGV2IENyZWF0ZXMgYW4gUkxQSXRlbSBmcm9tIGFuIGFycmF5IG9mIFJMUCBlbmNvZGVkIGJ5dGVzLg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGVuY29kZWQgYnl0ZXMuDQogLy8vIEBwYXJhbSBzdHJpY3QgV2lsbCB0aHJvdyBpZiB0aGUgZGF0YSBpcyBub3QgUkxQIGVuY29kZWQuDQogLy8vIEByZXR1cm4gQW4gUkxQSXRlbQ0KIGZ1bmN0aW9uIHRvUkxQSXRlbShieXRlcyBtZW1vcnkgc2VsZiwgYm9vbCBzdHJpY3QpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5KSB7DQogICAgIHZhciBpdGVtID0gdG9STFBJdGVtKHNlbGYpOw0KICAgICBpZihzdHJpY3QpIHsNCiAgICAgICAgIHVpbnQgbGVuID0gc2VsZi5sZW5ndGg7DQogICAgICAgICBpZihfcGF5bG9hZE9mZnNldChpdGVtKSA+IGxlbikNCiAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgIGlmKF9pdGVtTGVuZ3RoKGl0ZW0uX3Vuc2FmZV9tZW1QdHIpICE9IGxlbikNCiAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgIGlmKCFfdmFsaWRhdGUoaXRlbSkpDQogICAgICAgICAgICAgdGhyb3c7DQogICAgIH0NCiAgICAgcmV0dXJuIGl0ZW07DQogfQ0KDQogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIG51bGwuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgbnVsbC4NCiBmdW5jdGlvbiBpc051bGwoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsNCiAgICAgcmV0dXJuIHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMDsNCiB9DQoNCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gJ3RydWUnIGlmIHRoZSBpdGVtIGlzIGEgbGlzdC4NCiBmdW5jdGlvbiBpc0xpc3QoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsNCiAgICAgaWYgKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkNCiAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICByZXQgOj0gaXN6ZXJvKGx0KGJ5dGUoMCwgbWxvYWQobWVtUHRyKSksIDB4QzApKQ0KICAgICB9DQogfQ0KDQogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIGRhdGEuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgZGF0YS4NCiBmdW5jdGlvbiBpc0RhdGEoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsNCiAgICAgaWYgKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkNCiAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICByZXQgOj0gbHQoYnl0ZSgwLCBtbG9hZChtZW1QdHIpKSwgMHhDMCkNCiAgICAgfQ0KIH0NCg0KIC8vLyBAZGV2IENoZWNrIGlmIHRoZSBSTFAgaXRlbSBpcyBlbXB0eSAoc3RyaW5nIG9yIGxpc3QpLg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gJ3RydWUnIGlmIHRoZSBpdGVtIGlzIG51bGwuDQogZnVuY3Rpb24gaXNFbXB0eShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgew0KICAgICBpZihpc051bGwoc2VsZikpDQogICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgIHVpbnQgYjA7DQogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICB9DQogICAgIHJldHVybiAoYjAgPT0gREFUQV9TSE9SVF9TVEFSVCB8fCBiMCA9PSBMSVNUX1NIT1JUX1NUQVJUKTsNCiB9DQoNCiAvLy8gQGRldiBHZXQgdGhlIG51bWJlciBvZiBpdGVtcyBpbiBhbiBSTFAgZW5jb2RlZCBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBpdGVtcy4NCiBmdW5jdGlvbiBpdGVtcyhSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgIGlmICghaXNMaXN0KHNlbGYpKQ0KICAgICAgICAgcmV0dXJuIDA7DQogICAgIHVpbnQgYjA7DQogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICB9DQogICAgIHVpbnQgcG9zID0gbWVtUHRyICsgX3BheWxvYWRPZmZzZXQoc2VsZik7DQogICAgIHVpbnQgbGFzdCA9IG1lbVB0ciArIHNlbGYuX3Vuc2FmZV9sZW5ndGggLSAxOw0KICAgICB1aW50IGl0bXM7DQogICAgIHdoaWxlKHBvcyA8PSBsYXN0KSB7DQogICAgICAgICBwb3MgKz0gX2l0ZW1MZW5ndGgocG9zKTsNCiAgICAgICAgIGl0bXMrKzsNCiAgICAgfQ0KICAgICByZXR1cm4gaXRtczsNCiB9DQoNCiAvLy8gQGRldiBDcmVhdGUgYW4gaXRlcmF0b3IuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiBBbiAnSXRlcmF0b3InIG92ZXIgdGhlIGl0ZW0uDQogZnVuY3Rpb24gaXRlcmF0b3IoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoSXRlcmF0b3IgbWVtb3J5IGl0KSB7DQogICAgIGlmICghaXNMaXN0KHNlbGYpKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHVpbnQgcHRyID0gc2VsZi5fdW5zYWZlX21lbVB0ciArIF9wYXlsb2FkT2Zmc2V0KHNlbGYpOw0KICAgICBpdC5fdW5zYWZlX2l0ZW0gPSBzZWxmOw0KICAgICBpdC5fdW5zYWZlX25leHRQdHIgPSBwdHI7DQogfQ0KDQogLy8vIEBkZXYgUmV0dXJuIHRoZSBSTFAgZW5jb2RlZCBieXRlcy4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGJ5dGVzLg0KIGZ1bmN0aW9uIHRvQnl0ZXMoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMgbWVtb3J5IGJ0cykgew0KICAgICB2YXIgbGVuID0gc2VsZi5fdW5zYWZlX2xlbmd0aDsNCiAgICAgaWYgKGxlbiA9PSAwKQ0KICAgICAgICAgcmV0dXJuOw0KICAgICBidHMgPSBuZXcgYnl0ZXMobGVuKTsNCiAgICAgX2NvcHlUb0J5dGVzKHNlbGYuX3Vuc2FmZV9tZW1QdHIsIGJ0cywgbGVuKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGJ5dGVzLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlDQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuDQogZnVuY3Rpb24gdG9EYXRhKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzIG1lbW9yeSBidHMpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGJ0cyA9IG5ldyBieXRlcyhsZW4pOw0KICAgICBfY29weVRvQnl0ZXMoclN0YXJ0UG9zLCBidHMsIGxlbik7DQogfQ0KDQogLy8vIEBkZXYgR2V0IHRoZSBsaXN0IG9mIHN1Yi1pdGVtcyBmcm9tIGFuIFJMUCBlbmNvZGVkIGxpc3QuDQogLy8vIFdhcm5pbmc6IFRoaXMgaXMgaW5lZmZpY2llbnQsIGFzIGl0IHJlcXVpcmVzIHRoYXQgdGhlIGxpc3QgaXMgcmVhZCB0d2ljZS4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLg0KIC8vLyBAcmV0dXJuIEFycmF5IG9mIFJMUEl0ZW1zLg0KIGZ1bmN0aW9uIHRvTGlzdChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtW10gbWVtb3J5IGxpc3QpIHsNCiAgICAgaWYoIWlzTGlzdChzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgbnVtSXRlbXMgPSBpdGVtcyhzZWxmKTsNCiAgICAgbGlzdCA9IG5ldyBSTFBJdGVtW10obnVtSXRlbXMpOw0KICAgICB2YXIgaXQgPSBpdGVyYXRvcihzZWxmKTsNCiAgICAgdWludCBpZHg7DQogICAgIHdoaWxlKGhhc05leHQoaXQpKSB7DQogICAgICAgICBsaXN0W2lkeF0gPSBuZXh0KGl0KTsNCiAgICAgICAgIGlkeCsrOw0KICAgICB9DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhbiBhc2NpaSBzdHJpbmcuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0FzY2lpKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBtZW1vcnkgc3RyKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBieXRlcyBtZW1vcnkgYnRzID0gbmV3IGJ5dGVzKGxlbik7DQogICAgIF9jb3B5VG9CeXRlcyhyU3RhcnRQb3MsIGJ0cywgbGVuKTsNCiAgICAgc3RyID0gc3RyaW5nKGJ0cyk7DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIHVpbnQuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b1VpbnQoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuID4gMzIgfHwgbGVuID09IDApDQogICAgICAgICB0aHJvdzsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgZGF0YSA6PSBkaXYobWxvYWQoclN0YXJ0UG9zKSwgZXhwKDI1Niwgc3ViKDMyLCBsZW4pKSkNCiAgICAgfQ0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYSBib29sZWFuLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlDQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuDQogZnVuY3Rpb24gdG9Cb29sKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZGF0YSkgew0KICAgICBpZighaXNEYXRhKHNlbGYpKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsNCiAgICAgaWYgKGxlbiAhPSAxKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHVpbnQgdGVtcDsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgdGVtcCA6PSBieXRlKDAsIG1sb2FkKHJTdGFydFBvcykpDQogICAgIH0NCiAgICAgaWYgKHRlbXAgPiAxKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHJldHVybiB0ZW1wID09IDEgPyB0cnVlIDogZmFsc2U7DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIGJ5dGUuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0J5dGUoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZSBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuICE9IDEpDQogICAgICAgICB0aHJvdzsNCiAgICAgdWludCB0ZW1wOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICB0ZW1wIDo9IGJ5dGUoMCwgbWxvYWQoclN0YXJ0UG9zKSkNCiAgICAgfQ0KICAgICByZXR1cm4gYnl0ZSh0ZW1wKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGludC4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvSW50KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGludCBkYXRhKSB7DQogICAgIHJldHVybiBpbnQodG9VaW50KHNlbGYpKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGEgYnl0ZXMzMi4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvQnl0ZXMzMihSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlczMyIGRhdGEpIHsNCiAgICAgcmV0dXJuIGJ5dGVzMzIodG9VaW50KHNlbGYpKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGFkZHJlc3MuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0FkZHJlc3MoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuICE9IDIwKQ0KICAgICAgICAgdGhyb3c7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGRhdGEgOj0gZGl2KG1sb2FkKHJTdGFydFBvcyksIGV4cCgyNTYsIDEyKSkNCiAgICAgfQ0KIH0NCg0KIC8vIEdldCB0aGUgcGF5bG9hZCBvZmZzZXQuDQogZnVuY3Rpb24gX3BheWxvYWRPZmZzZXQoUkxQSXRlbSBtZW1vcnkgc2VsZikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgIGlmKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkNCiAgICAgICAgIHJldHVybiAwOw0KICAgICB1aW50IGIwOw0KICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkNCiAgICAgfQ0KICAgICBpZihiMCA8IERBVEFfU0hPUlRfU1RBUlQpDQogICAgICAgICByZXR1cm4gMDsNCiAgICAgaWYoYjAgPCBEQVRBX0xPTkdfU1RBUlQgfHwgKGIwID49IExJU1RfU0hPUlRfU1RBUlQgJiYgYjAgPCBMSVNUX0xPTkdfU1RBUlQpKQ0KICAgICAgICAgcmV0dXJuIDE7DQogICAgIGlmKGIwIDwgTElTVF9TSE9SVF9TVEFSVCkNCiAgICAgICAgIHJldHVybiBiMCAtIERBVEFfTE9OR19PRkZTRVQgKyAxOw0KICAgICByZXR1cm4gYjAgLSBMSVNUX0xPTkdfT0ZGU0VUICsgMTsNCiB9DQoNCiAvLyBHZXQgdGhlIGZ1bGwgbGVuZ3RoIG9mIGFuIFJMUCBpdGVtLg0KIGZ1bmN0aW9uIF9pdGVtTGVuZ3RoKHVpbnQgbWVtUHRyKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQgbGVuKSB7DQogICAgIHVpbnQgYjA7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkNCiAgICAgfQ0KICAgICBpZiAoYjAgPCBEQVRBX1NIT1JUX1NUQVJUKQ0KICAgICAgICAgbGVuID0gMTsNCiAgICAgZWxzZSBpZiAoYjAgPCBEQVRBX0xPTkdfU1RBUlQpDQogICAgICAgICBsZW4gPSBiMCAtIERBVEFfU0hPUlRfU1RBUlQgKyAxOw0KICAgICBlbHNlIGlmIChiMCA8IExJU1RfU0hPUlRfU1RBUlQpIHsNCiAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICBsZXQgYkxlbiA6PSBzdWIoYjAsIDB4QjcpIC8vIGJ5dGVzIGxlbmd0aCAoREFUQV9MT05HX09GRlNFVCkNCiAgICAgICAgICAgICBsZXQgZExlbiA6PSBkaXYobWxvYWQoYWRkKG1lbVB0ciwgMSkpLCBleHAoMjU2LCBzdWIoMzIsIGJMZW4pKSkgLy8gZGF0YSBsZW5ndGgNCiAgICAgICAgICAgICBsZW4gOj0gYWRkKDEsIGFkZChiTGVuLCBkTGVuKSkgLy8gdG90YWwgbGVuZ3RoDQogICAgICAgICB9DQogICAgIH0NCiAgICAgZWxzZSBpZiAoYjAgPCBMSVNUX0xPTkdfU1RBUlQpDQogICAgICAgICBsZW4gPSBiMCAtIExJU1RfU0hPUlRfU1RBUlQgKyAxOw0KICAgICBlbHNlIHsNCiAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICBsZXQgYkxlbiA6PSBzdWIoYjAsIDB4RjcpIC8vIGJ5dGVzIGxlbmd0aCAoTElTVF9MT05HX09GRlNFVCkNCiAgICAgICAgICAgICBsZXQgZExlbiA6PSBkaXYobWxvYWQoYWRkKG1lbVB0ciwgMSkpLCBleHAoMjU2LCBzdWIoMzIsIGJMZW4pKSkgLy8gZGF0YSBsZW5ndGgNCiAgICAgICAgICAgICBsZW4gOj0gYWRkKDEsIGFkZChiTGVuLCBkTGVuKSkgLy8gdG90YWwgbGVuZ3RoDQogICAgICAgICB9DQogICAgIH0NCiB9DQoNCiAvLyBHZXQgc3RhcnQgcG9zaXRpb24gYW5kIGxlbmd0aCBvZiB0aGUgZGF0YS4NCiBmdW5jdGlvbiBfZGVjb2RlKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCBtZW1QdHIsIHVpbnQgbGVuKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdWludCBiMDsNCiAgICAgdWludCBzdGFydCA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQoc3RhcnQpKQ0KICAgICB9DQogICAgIGlmIChiMCA8IERBVEFfU0hPUlRfU1RBUlQpIHsNCiAgICAgICAgIG1lbVB0ciA9IHN0YXJ0Ow0KICAgICAgICAgbGVuID0gMTsNCiAgICAgICAgIHJldHVybjsNCiAgICAgfQ0KICAgICBpZiAoYjAgPCBEQVRBX0xPTkdfU1RBUlQpIHsNCiAgICAgICAgIGxlbiA9IHNlbGYuX3Vuc2FmZV9sZW5ndGggLSAxOw0KICAgICAgICAgbWVtUHRyID0gc3RhcnQgKyAxOw0KICAgICB9IGVsc2Ugew0KICAgICAgICAgdWludCBiTGVuOw0KICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgIGJMZW4gOj0gc3ViKGIwLCAweEI3KSAvLyBEQVRBX0xPTkdfT0ZGU0VUDQogICAgICAgICB9DQogICAgICAgICBsZW4gPSBzZWxmLl91bnNhZmVfbGVuZ3RoIC0gMSAtIGJMZW47DQogICAgICAgICBtZW1QdHIgPSBzdGFydCArIGJMZW4gKyAxOw0KICAgICB9DQogICAgIHJldHVybjsNCiB9DQoNCiAvLyBBc3N1bWVzIHRoYXQgZW5vdWdoIG1lbW9yeSBoYXMgYmVlbiBhbGxvY2F0ZWQgdG8gc3RvcmUgaW4gdGFyZ2V0Lg0KIGZ1bmN0aW9uIF9jb3B5VG9CeXRlcyh1aW50IGJ0c1B0ciwgYnl0ZXMgbWVtb3J5IHRndCwgdWludCBidHNMZW4pIHByaXZhdGUgY29uc3RhbnQgew0KICAgICAvLyBFeHBsb2l0aW5nIHRoZSBmYWN0IHRoYXQgJ3RndCcgd2FzIHRoZSBsYXN0IHRoaW5nIHRvIGJlIGFsbG9jYXRlZCwNCiAgICAgLy8gd2UgY2FuIHdyaXRlIGVudGlyZSB3b3JkcywgYW5kIGp1c3Qgb3ZlcndyaXRlIGFueSBleGNlc3MuDQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgbGV0IGkgOj0gMCAvLyBTdGFydCBhdCBhcnIgKyAweDIwDQogICAgICAgICAgICAgICAgIGxldCB3b3JkcyA6PSBkaXYoYWRkKGJ0c0xlbiwgMzEpLCAzMikNCiAgICAgICAgICAgICAgICAgbGV0IHJPZmZzZXQgOj0gYnRzUHRyDQogICAgICAgICAgICAgICAgIGxldCB3T2Zmc2V0IDo9IGFkZCh0Z3QsIDB4MjApDQogICAgICAgICAgICAgdGFnX2xvb3A6DQogICAgICAgICAgICAgICAgIGp1bXBpKGVuZCwgZXEoaSwgd29yZHMpKQ0KICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0IDo9IG11bChpLCAweDIwKQ0KICAgICAgICAgICAgICAgICAgICAgbXN0b3JlKGFkZCh3T2Zmc2V0LCBvZmZzZXQpLCBtbG9hZChhZGQock9mZnNldCwgb2Zmc2V0KSkpDQogICAgICAgICAgICAgICAgICAgICBpIDo9IGFkZChpLCAxKQ0KICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgIGp1bXAodGFnX2xvb3ApDQogICAgICAgICAgICAgZW5kOg0KICAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRndCwgYWRkKDB4MjAsIG1sb2FkKHRndCkpKSwgMCkNCiAgICAgICAgIH0NCiAgICAgfQ0KIH0NCg0KIC8vIENoZWNrIHRoYXQgYW4gUkxQIGl0ZW0gaXMgdmFsaWQuDQogICAgIGZ1bmN0aW9uIF92YWxpZGF0ZShSTFBJdGVtIG1lbW9yeSBzZWxmKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmV0KSB7DQogICAgICAgICAvLyBDaGVjayB0aGF0IFJMUCBpcyB3ZWxsLWZvcm1lZC4NCiAgICAgICAgIHVpbnQgYjA7DQogICAgICAgICB1aW50IGIxOw0KICAgICAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkNCiAgICAgICAgICAgICBiMSA6PSBieXRlKDEsIG1sb2FkKG1lbVB0cikpDQogICAgICAgICB9DQogICAgICAgICBpZihiMCA9PSBEQVRBX1NIT1JUX1NUQVJUICsgMSAmJiBiMSA8IERBVEFfU0hPUlRfU1RBUlQpDQogICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgIH0NCn0NCg0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuNjsNCg0KLyoNCiAgICBDb3B5cmlnaHQgMjAxNiwgSm9yZGkgQmF5bGluYQ0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yDQogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lg0KICovDQoNCi8vLyBAdGl0bGUgTWlsZXN0b25lVHJhY2tlciBDb250cmFjdA0KLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQ0KLy8vIEBkZXYgVGhpcyBjb250cmFjdCB0cmFja3MgdGhlDQoNCg0KLy8vIGlzIHJ1bGVzIHRoZSByZWxhdGlvbiBiZXR3ZW4gYSBkb25vciBhbmQgYSByZWNpcGllbnQNCi8vLyAgaW4gb3JkZXIgdG8gZ3VhcmFudHkgdG8gdGhlIGRvbm9yIHRoYXQgdGhlIGpvYiB3aWxsIGJlIGRvbmUgYW5kIHRvIGd1YXJhbnR5DQovLy8gIHRvIHRoZSByZWNpcGllbnQgdGhhdCBoZSB3aWxsIGJlIHBhaWQNCg0KDQovLy8gQGRldiBXZSB1c2UgdGhlIFJMUCBsaWJyYXJ5IHRvIGRlY29kZSBSTFAgc28gdGhhdCB0aGUgZG9ub3IgY2FuIGFwcHJvdmUgb25lDQovLy8gIHNldCBvZiBtaWxlc3RvbmUgY2hhbmdlcyBhdCBhIHRpbWUuDQovLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmRyb2xvL3N0YW5kYXJkLWNvbnRyYWN0cy9ibG9iL21hc3Rlci9jb250cmFjdHMvc3JjL2NvZGVjL1JMUC5zb2wNCg0KDQoNCg0KLy8vIEBkZXYgVGhpcyBjb250cmFjdCBhbGxvd3MgZm9yIGByZWNpcGllbnRgIHRvIHNldCBhbmQgbW9kaWZ5IG1pbGVzdG9uZXMNCmNvbnRyYWN0IE1pbGVzdG9uZVRyYWNrZXIgew0KICAgIHVzaW5nIFJMUCBmb3IgUkxQLlJMUEl0ZW07DQogICAgdXNpbmcgUkxQIGZvciBSTFAuSXRlcmF0b3I7DQogICAgdXNpbmcgUkxQIGZvciBieXRlczsNCg0KICAgIHN0cnVjdCBNaWxlc3RvbmUgew0KICAgICAgICBzdHJpbmcgZGVzY3JpcHRpb247ICAgICAvLyBEZXNjcmlwdGlvbiBvZiB0aGlzIG1pbGVzdG9uZQ0KICAgICAgICBzdHJpbmcgdXJsOyAgICAgICAgICAgICAvLyBBIGxpbmsgdG8gbW9yZSBpbmZvcm1hdGlvbiAoc3dhcm0gZ2F0ZXdheSkNCiAgICAgICAgdWludCBtaW5Db21wbGV0aW9uRGF0ZTsgLy8gRWFybGllc3QgVU5JWCB0aW1lIHRoZSBtaWxlc3RvbmUgY2FuIGJlIHBhaWQNCiAgICAgICAgdWludCBtYXhDb21wbGV0aW9uRGF0ZTsgLy8gTGF0ZXN0IFVOSVggdGltZSB0aGUgbWlsZXN0b25lIGNhbiBiZSBwYWlkDQogICAgICAgIGFkZHJlc3MgbWlsZXN0b25lTGVhZExpbms7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNpbWlsYXIgdG8gYHJlY2lwaWVudGBidXQgZm9yIHRoaXMgbWlsZXN0b25lDQogICAgICAgIGFkZHJlc3MgcmV2aWV3ZXI7ICAgICAgIC8vIENhbiByZWplY3QgdGhlIGNvbXBsZXRpb24gb2YgdGhpcyBtaWxlc3RvbmUNCiAgICAgICAgdWludCByZXZpZXdUaW1lOyAgICAgICAgLy8gSG93IG1hbnkgc2Vjb25kcyB0aGUgcmV2aWV3ZXIgaGFzIHRvIHJldmlldw0KICAgICAgICBhZGRyZXNzIHBheW1lbnRTb3VyY2U7ICAvLyBXaGVyZSB0aGUgbWlsZXN0b25lIHBheW1lbnQgaXMgc2VudCBmcm9tDQogICAgICAgIGJ5dGVzIHBheURhdGE7ICAgICAgICAgIC8vIERhdGEgZGVmaW5pbmcgaG93IG11Y2ggZXRoZXIgaXMgc2VudCB3aGVyZQ0KDQogICAgICAgIE1pbGVzdG9uZVN0YXR1cyBzdGF0dXM7IC8vIEN1cnJlbnQgc3RhdHVzIG9mIHRoZSBtaWxlc3RvbmUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gKENvbXBsZXRlZCwgQXV0aG9yaXplZEZvclBheW1lbnQuLi4pDQogICAgICAgIHVpbnQgZG9uZVRpbWU7ICAgICAgICAgIC8vIFVOSVggdGltZSB3aGVuIHRoZSBtaWxlc3RvbmUgd2FzIG1hcmtlZCBET05FDQogICAgfQ0KDQogICAgLy8gVGhlIGxpc3Qgb2YgYWxsIHRoZSBtaWxlc3RvbmVzLg0KICAgIE1pbGVzdG9uZVtdIHB1YmxpYyBtaWxlc3RvbmVzOw0KDQogICAgYWRkcmVzcyBwdWJsaWMgcmVjaXBpZW50OyAgIC8vIENhbGxzIGZ1bmN0aW9ucyBpbiB0aGUgbmFtZSBvZiB0aGUgcmVjaXBpZW50DQogICAgYWRkcmVzcyBwdWJsaWMgZG9ub3I7ICAgICAgIC8vIENhbGxzIGZ1bmN0aW9ucyBpbiB0aGUgbmFtZSBvZiB0aGUgZG9ub3INCiAgICBhZGRyZXNzIHB1YmxpYyBhcmJpdHJhdG9yOyAgLy8gQ2FsbHMgZnVuY3Rpb25zIGluIHRoZSBuYW1lIG9mIHRoZSBhcmJpdHJhdG9yDQoNCiAgICBlbnVtIE1pbGVzdG9uZVN0YXR1cyB7DQogICAgICAgIEFjY2VwdGVkQW5kSW5Qcm9ncmVzcywNCiAgICAgICAgQ29tcGxldGVkLA0KICAgICAgICBBdXRob3JpemVkRm9yUGF5bWVudCwNCiAgICAgICAgQ2FuY2VsZWQNCiAgICB9DQoNCiAgICAvLyBUcnVlIGlmIHRoZSBjYW1wYWlnbiBoYXMgYmVlbiBjYW5jZWxlZA0KICAgIGJvb2wgcHVibGljIGNhbXBhaWduQ2FuY2VsZWQ7DQoNCiAgICAvLyBUcnVlIGlmIGFuIGFwcHJvdmFsIG9uIGEgY2hhbmdlIHRvIGBtaWxlc3RvbmVzYCBpcyBhIHBlbmRpbmcNCiAgICBib29sIHB1YmxpYyBjaGFuZ2luZ01pbGVzdG9uZXM7DQoNCiAgICAvLyBUaGUgcGVuZGluZyBjaGFuZ2UgdG8gYG1pbGVzdG9uZXNgIGVuY29kZWQgaW4gUkxQDQogICAgYnl0ZXMgcHVibGljIHByb3Bvc2VkTWlsZXN0b25lczsNCg0KDQogICAgLy8vIEBkZXYgVGhlIGZvbGxvd2luZyBtb2RpZmllcnMgb25seSBhbGxvdyBzcGVjaWZpYyByb2xlcyB0byBjYWxsIGZ1bmN0aW9ucw0KICAgIC8vLyB3aXRoIHRoZXNlIG1vZGlmaWVycw0KICAgIG1vZGlmaWVyIG9ubHlSZWNpcGllbnQgeyBpZiAobXNnLnNlbmRlciAhPSAgcmVjaXBpZW50KSB0aHJvdzsgXzsgfQ0KICAgIG1vZGlmaWVyIG9ubHlBcmJpdHJhdG9yIHsgaWYgKG1zZy5zZW5kZXIgIT0gYXJiaXRyYXRvcikgdGhyb3c7IF87IH0NCiAgICBtb2RpZmllciBvbmx5RG9ub3IgeyBpZiAobXNnLnNlbmRlciAhPSBkb25vcikgdGhyb3c7IF87IH0NCg0KICAgIC8vLyBAZGV2IFRoZSBmb2xsb3dpbmcgbW9kaWZpZXJzIHByZXZlbnQgZnVuY3Rpb25zIGZyb20gYmVpbmcgY2FsbGVkIGlmIHRoZQ0KICAgIC8vLyBjYW1wYWlnbiBoYXMgYmVlbiBjYW5jZWxlZCBvciBpZiBuZXcgbWlsZXN0b25lcyBhcmUgYmVpbmcgcHJvcG9zZWQNCiAgICBtb2RpZmllciBjYW1wYWlnbk5vdENhbmNlbGVkIHsgaWYgKGNhbXBhaWduQ2FuY2VsZWQpIHRocm93OyBfOyB9DQogICAgbW9kaWZpZXIgbm90Q2hhbmdpbmcgeyBpZiAoY2hhbmdpbmdNaWxlc3RvbmVzKSB0aHJvdzsgXzsgfQ0KDQogLy8gQGRldiBFdmVudHMgdG8gbWFrZSB0aGUgcGF5bWVudCBtb3ZlbWVudHMgZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluDQogICAgZXZlbnQgTmV3TWlsZXN0b25lTGlzdFByb3Bvc2VkKCk7DQogICAgZXZlbnQgTmV3TWlsZXN0b25lTGlzdFVucHJvcG9zZWQoKTsNCiAgICBldmVudCBOZXdNaWxlc3RvbmVMaXN0QWNjZXB0ZWQoKTsNCiAgICBldmVudCBQcm9wb3NhbFN0YXR1c0NoYW5nZWQodWludCBpZFByb3Bvc2FsLCBNaWxlc3RvbmVTdGF0dXMgbmV3UHJvcG9zYWwpOw0KICAgIGV2ZW50IENhbXBhaWduQ2FuY2VsZWQoKTsNCg0KDQovLy8vLy8vLy8vLw0KLy8gQ29uc3RydWN0b3INCi8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGUgQ29uc3RydWN0b3IgY3JlYXRlcyB0aGUgTWlsZXN0b25lIGNvbnRyYWN0IG9uIHRoZSBibG9ja2NoYWluDQogICAgLy8vIEBwYXJhbSBfYXJiaXRyYXRvciBBZGRyZXNzIGFzc2lnbmVkIHRvIGJlIHRoZSBhcmJpdHJhdG9yDQogICAgLy8vIEBwYXJhbSBfZG9ub3IgQWRkcmVzcyBhc3NpZ25lZCB0byBiZSB0aGUgZG9ub3INCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgQWRkcmVzcyBhc3NpZ25lZCB0byBiZSB0aGUgcmVjaXBpZW50DQogICAgZnVuY3Rpb24gTWlsZXN0b25lVHJhY2tlciAoDQogICAgICAgIGFkZHJlc3MgX2FyYml0cmF0b3IsDQogICAgICAgIGFkZHJlc3MgX2Rvbm9yLA0KICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQNCiAgICApIHsNCiAgICAgICAgYXJiaXRyYXRvciA9IF9hcmJpdHJhdG9yOw0KICAgICAgICBkb25vciA9IF9kb25vcjsNCiAgICAgICAgcmVjaXBpZW50ID0gX3JlY2lwaWVudDsNCiAgICB9DQoNCg0KLy8vLy8vLy8vDQovLyBIZWxwZXIgZnVuY3Rpb25zDQovLy8vLy8vLy8NCg0KICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgbWlsZXN0b25lcyBldmVyIGNyZWF0ZWQgZXZlbiBpZiB0aGV5IHdlcmUgY2FuY2VsZWQNCiAgICBmdW5jdGlvbiBudW1iZXJPZk1pbGVzdG9uZXMoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBtaWxlc3RvbmVzLmxlbmd0aDsNCiAgICB9DQoNCg0KLy8vLy8vLy8NCi8vIENoYW5nZSBwbGF5ZXJzDQovLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlBcmJpdHJhdG9yYCBSZWFzc2lnbnMgdGhlIGFyYml0cmF0b3IgdG8gYSBuZXcgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gX25ld0FyYml0cmF0b3IgVGhlIG5ldyBhcmJpdHJhdG9yDQogICAgZnVuY3Rpb24gY2hhbmdlQXJiaXRyYXRvcihhZGRyZXNzIF9uZXdBcmJpdHJhdG9yKSBvbmx5QXJiaXRyYXRvciB7DQogICAgICAgIGFyYml0cmF0b3IgPSBfbmV3QXJiaXRyYXRvcjsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBgb25seURvbm9yYCBSZWFzc2lnbnMgdGhlIGBkb25vcmAgdG8gYSBuZXcgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gX25ld0Rvbm9yIFRoZSBuZXcgZG9ub3INCiAgICBmdW5jdGlvbiBjaGFuZ2VEb25vcihhZGRyZXNzIF9uZXdEb25vcikgb25seURvbm9yIHsNCiAgICAgICAgZG9ub3IgPSBfbmV3RG9ub3I7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRgIFJlYXNzaWducyB0aGUgYHJlY2lwaWVudGAgdG8gYSBuZXcgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gX25ld1JlY2lwaWVudCBUaGUgbmV3IHJlY2lwaWVudA0KICAgIGZ1bmN0aW9uIGNoYW5nZVJlY2lwaWVudChhZGRyZXNzIF9uZXdSZWNpcGllbnQpIG9ubHlSZWNpcGllbnQgew0KICAgICAgICByZWNpcGllbnQgPSBfbmV3UmVjaXBpZW50Ow0KICAgIH0NCg0KDQovLy8vLy8vLy8vLy8NCi8vIENyZWF0aW9uIGFuZCBtb2RpZmljYXRpb24gb2YgTWlsZXN0b25lcw0KLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBgb25seVJlY2lwaWVudGAgUHJvcG9zZXMgbmV3IG1pbGVzdG9uZXMgb3IgY2hhbmdlcyBvbGQNCiAgICAvLy8gIG1pbGVzdG9uZXMsIHRoaXMgd2lsbCByZXF1aXJlIGEgdXNlciBpbnRlcmZhY2UgdG8gYmUgYnVpbHQgdXAgdG8NCiAgICAvLy8gIHN1cHBvcnQgdGhpcyBmdW5jdGlvbmFsaXR5IGFzIGFza3MgZm9yIFJMUCBlbmNvZGVkIGJ5dGVjb2RlIHRvIGJlDQogICAgLy8vICBnZW5lcmF0ZWQsIHVudGlsIHRoaXMgaW50ZXJmYWNlIGlzIGJ1aWx0IHlvdSBjYW4gdXNlIHRoaXMgc2NyaXB0Og0KICAgIC8vLyAgaHR0cHM6Ly9naXRodWIuY29tL0dpdmV0aC9taWxlc3RvbmV0cmFja2VyL2Jsb2IvbWFzdGVyL2pzL21pbGVzdG9uZXRyYWNrZXJfaGVscGVyLmpzDQogICAgLy8vICB0aGUgZnVuY3Rpb25zIG1pbGVzdG9uZXMyYnl0ZXMgYW5kIGJ5dGVzMm1pbGVzdG9uZXMgd2lsbCBlbmFibGUgdGhlDQogICAgLy8vICByZWNpcGllbnQgdG8gZW5jb2RlIGFuZCBkZWNvZGUgYSBsaXN0IG9mIG1pbGVzdG9uZXMsIGFsc28gc2VlDQogICAgLy8vICBodHRwczovL2dpdGh1Yi5jb20vR2l2ZXRoL21pbGVzdG9uZXRyYWNrZXIvYmxvYi9tYXN0ZXIvUkVBRE1FLm1kDQogICAgLy8vIEBwYXJhbSBfbmV3TWlsZXN0b25lcyBUaGUgUkxQIGVuY29kZWQgbGlzdCBvZiBtaWxlc3RvbmVzOyBlYWNoIG1pbGVzdG9uZQ0KICAgIC8vLyAgaGFzIHRoZXNlIGZpZWxkczoNCiAgICAvLy8gICAgICAgc3RyaW5nIGRlc2NyaXB0aW9uLA0KICAgIC8vLyAgICAgICBzdHJpbmcgdXJsLA0KICAgIC8vLyAgICAgICB1aW50IG1pbkNvbXBsZXRpb25EYXRlLCAgLy8gc2Vjb25kcyBzaW5jZSAxLzEvMTk3MCAoVU5JWCB0aW1lKQ0KICAgIC8vLyAgICAgICB1aW50IG1heENvbXBsZXRpb25EYXRlLCAgLy8gc2Vjb25kcyBzaW5jZSAxLzEvMTk3MCAoVU5JWCB0aW1lKQ0KICAgIC8vLyAgICAgICBhZGRyZXNzIG1pbGVzdG9uZUxlYWRMaW5rLA0KICAgIC8vLyAgICAgICBhZGRyZXNzIHJldmlld2VyLA0KICAgIC8vLyAgICAgICB1aW50IHJldmlld1RpbWUNCiAgICAvLy8gICAgICAgYWRkcmVzcyBwYXltZW50U291cmNlLA0KICAgIC8vLyAgICAgICBieXRlcyBwYXlEYXRhLA0KICAgIGZ1bmN0aW9uIHByb3Bvc2VNaWxlc3RvbmVzKGJ5dGVzIF9uZXdNaWxlc3RvbmVzDQogICAgKSBvbmx5UmVjaXBpZW50IGNhbXBhaWduTm90Q2FuY2VsZWQgew0KICAgICAgICBwcm9wb3NlZE1pbGVzdG9uZXMgPSBfbmV3TWlsZXN0b25lczsNCiAgICAgICAgY2hhbmdpbmdNaWxlc3RvbmVzID0gdHJ1ZTsNCiAgICAgICAgTmV3TWlsZXN0b25lTGlzdFByb3Bvc2VkKCk7DQogICAgfQ0KDQoNCi8vLy8vLy8vLy8vLw0KLy8gTm9ybWFsIGFjdGlvbnMgdGhhdCB3aWxsIGNoYW5nZSB0aGUgc3RhdGUgb2YgdGhlIG1pbGVzdG9uZXMNCi8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRgIENhbmNlbHMgdGhlIHByb3Bvc2VkIG1pbGVzdG9uZXMgYW5kIHJlYWN0aXZhdGVzDQogICAgLy8vICB0aGUgcHJldmlvdXMgc2V0IG9mIG1pbGVzdG9uZXMNCiAgICBmdW5jdGlvbiB1bnByb3Bvc2VNaWxlc3RvbmVzKCkgb25seVJlY2lwaWVudCBjYW1wYWlnbk5vdENhbmNlbGVkIHsNCiAgICAgICAgZGVsZXRlIHByb3Bvc2VkTWlsZXN0b25lczsNCiAgICAgICAgY2hhbmdpbmdNaWxlc3RvbmVzID0gZmFsc2U7DQogICAgICAgIE5ld01pbGVzdG9uZUxpc3RVbnByb3Bvc2VkKCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlEb25vcmAgQXBwcm92ZXMgdGhlIHByb3Bvc2VkIG1pbGVzdG9uZSBsaXN0DQogICAgLy8vIEBwYXJhbSBfaGFzaFByb3Bvc2FscyBUaGUgc2hhMygpIG9mIHRoZSBwcm9wb3NlZCBtaWxlc3RvbmUgbGlzdCdzDQogICAgLy8vICBieXRlY29kZTsgdGhpcyBjb25maXJtcyB0aGF0IHRoZSBgZG9ub3JgIGtub3dzIHRoZSBzZXQgb2YgbWlsZXN0b25lcw0KICAgIC8vLyAgdGhleSBhcmUgYXBwcm92aW5nDQogICAgZnVuY3Rpb24gYWNjZXB0UHJvcG9zZWRNaWxlc3RvbmVzKGJ5dGVzMzIgX2hhc2hQcm9wb3NhbHMNCiAgICApIG9ubHlEb25vciBjYW1wYWlnbk5vdENhbmNlbGVkIHsNCg0KICAgICAgICB1aW50IGk7DQoNCiAgICAgICAgaWYgKCFjaGFuZ2luZ01pbGVzdG9uZXMpIHRocm93Ow0KICAgICAgICBpZiAoc2hhMyhwcm9wb3NlZE1pbGVzdG9uZXMpICE9IF9oYXNoUHJvcG9zYWxzKSB0aHJvdzsNCg0KICAgICAgICAvLyBDYW5jZWwgYWxsIHRoZSB1bmZpbmlzaGVkIG1pbGVzdG9uZXMNCiAgICAgICAgZm9yIChpPTA7IGk8bWlsZXN0b25lcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKG1pbGVzdG9uZXNbaV0uc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5BdXRob3JpemVkRm9yUGF5bWVudCkgew0KICAgICAgICAgICAgICAgIG1pbGVzdG9uZXNbaV0uc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkNhbmNlbGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIERlY29kZSB0aGUgUkxQIGVuY29kZWQgbWlsZXN0b25lcyBhbmQgYWRkIHRoZW0gdG8gdGhlIG1pbGVzdG9uZXMgbGlzdA0KICAgICAgICBieXRlcyBtZW1vcnkgbVByb3Bvc2VkTWlsZXN0b25lcyA9IHByb3Bvc2VkTWlsZXN0b25lczsNCg0KICAgICAgICB2YXIgaXRtUHJvcG9zYWxzID0gbVByb3Bvc2VkTWlsZXN0b25lcy50b1JMUEl0ZW0odHJ1ZSk7DQoNCiAgICAgICAgaWYgKCFpdG1Qcm9wb3NhbHMuaXNMaXN0KCkpIHRocm93Ow0KDQogICAgICAgIHZhciBpdHJQcm9wb3NhbHMgPSBpdG1Qcm9wb3NhbHMuaXRlcmF0b3IoKTsNCg0KICAgICAgICB3aGlsZShpdHJQcm9wb3NhbHMuaGFzTmV4dCgpKSB7DQoNCg0KICAgICAgICAgICAgdmFyIGl0bVByb3Bvc2FsID0gaXRyUHJvcG9zYWxzLm5leHQoKTsNCg0KICAgICAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbbWlsZXN0b25lcy5sZW5ndGggKytdOw0KDQogICAgICAgICAgICBpZiAoIWl0bVByb3Bvc2FsLmlzTGlzdCgpKSB0aHJvdzsNCg0KICAgICAgICAgICAgdmFyIGl0clByb3Bvc2FsID0gaXRtUHJvcG9zYWwuaXRlcmF0b3IoKTsNCg0KICAgICAgICAgICAgbWlsZXN0b25lLmRlc2NyaXB0aW9uID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvQXNjaWkoKTsNCiAgICAgICAgICAgIG1pbGVzdG9uZS51cmwgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9Bc2NpaSgpOw0KICAgICAgICAgICAgbWlsZXN0b25lLm1pbkNvbXBsZXRpb25EYXRlID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvVWludCgpOw0KICAgICAgICAgICAgbWlsZXN0b25lLm1heENvbXBsZXRpb25EYXRlID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvVWludCgpOw0KICAgICAgICAgICAgbWlsZXN0b25lLm1pbGVzdG9uZUxlYWRMaW5rID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvQWRkcmVzcygpOw0KICAgICAgICAgICAgbWlsZXN0b25lLnJldmlld2VyID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvQWRkcmVzcygpOw0KICAgICAgICAgICAgbWlsZXN0b25lLnJldmlld1RpbWUgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9VaW50KCk7DQogICAgICAgICAgICBtaWxlc3RvbmUucGF5bWVudFNvdXJjZSA9IGl0clByb3Bvc2FsLm5leHQoKS50b0FkZHJlc3MoKTsNCiAgICAgICAgICAgIG1pbGVzdG9uZS5wYXlEYXRhID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvRGF0YSgpOw0KDQogICAgICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzczsNCg0KICAgICAgICB9DQoNCiAgICAgICAgZGVsZXRlIHByb3Bvc2VkTWlsZXN0b25lczsNCiAgICAgICAgY2hhbmdpbmdNaWxlc3RvbmVzID0gZmFsc2U7DQogICAgICAgIE5ld01pbGVzdG9uZUxpc3RBY2NlcHRlZCgpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5UmVjaXBpZW50T3JMZWFkTGlua2BNYXJrcyBhIG1pbGVzdG9uZSBhcyBET05FIGFuZA0KICAgIC8vLyAgcmVhZHkgZm9yIHJldmlldw0KICAgIC8vLyBAcGFyYW0gX2lkTWlsZXN0b25lIElEIG9mIHRoZSBtaWxlc3RvbmUgdGhhdCBoYXMgYmVlbiBjb21wbGV0ZWQNCiAgICBmdW5jdGlvbiBtYXJrTWlsZXN0b25lQ29tcGxldGUodWludCBfaWRNaWxlc3RvbmUpDQogICAgICAgIGNhbXBhaWduTm90Q2FuY2VsZWQgbm90Q2hhbmdpbmcNCiAgICB7DQogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93Ow0KICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOw0KICAgICAgICBpZiAoICAobXNnLnNlbmRlciAhPSBtaWxlc3RvbmUubWlsZXN0b25lTGVhZExpbmspDQogICAgICAgICAgICAmJihtc2cuc2VuZGVyICE9IHJlY2lwaWVudCkpDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgaWYgKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzcykgdGhyb3c7DQogICAgICAgIGlmIChub3cgPCBtaWxlc3RvbmUubWluQ29tcGxldGlvbkRhdGUpIHRocm93Ow0KICAgICAgICBpZiAobm93ID4gbWlsZXN0b25lLm1heENvbXBsZXRpb25EYXRlKSB0aHJvdzsNCiAgICAgICAgbWlsZXN0b25lLnN0YXR1cyA9IE1pbGVzdG9uZVN0YXR1cy5Db21wbGV0ZWQ7DQogICAgICAgIG1pbGVzdG9uZS5kb25lVGltZSA9IG5vdzsNCiAgICAgICAgUHJvcG9zYWxTdGF0dXNDaGFuZ2VkKF9pZE1pbGVzdG9uZSwgbWlsZXN0b25lLnN0YXR1cyk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZXZpZXdlcmAgQXBwcm92ZXMgYSBzcGVjaWZpYyBtaWxlc3RvbmUNCiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRoYXQgaXMgYXBwcm92ZWQNCiAgICBmdW5jdGlvbiBhcHByb3ZlQ29tcGxldGVkTWlsZXN0b25lKHVpbnQgX2lkTWlsZXN0b25lKQ0KICAgICAgICBjYW1wYWlnbk5vdENhbmNlbGVkIG5vdENoYW5naW5nDQogICAgew0KICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsNCiAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbX2lkTWlsZXN0b25lXTsNCiAgICAgICAgaWYgKChtc2cuc2VuZGVyICE9IG1pbGVzdG9uZS5yZXZpZXdlcikgfHwNCiAgICAgICAgICAgIChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5Db21wbGV0ZWQpKSB0aHJvdzsNCg0KICAgICAgICBhdXRob3JpemVQYXltZW50KF9pZE1pbGVzdG9uZSk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZXZpZXdlcmAgUmVqZWN0cyBhIHNwZWNpZmljIG1pbGVzdG9uZSdzIGNvbXBsZXRpb24gYW5kDQogICAgLy8vICByZXZlcnRzIHRoZSBgbWlsZXN0b25lLnN0YXR1c2AgYmFjayB0byB0aGUgYEFjY2VwdGVkQW5kSW5Qcm9ncmVzc2ANCiAgICAvLy8gIHN0YXRlDQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0aGF0IGlzIGJlaW5nIHJlamVjdGVkDQogICAgZnVuY3Rpb24gcmVqZWN0TWlsZXN0b25lKHVpbnQgX2lkTWlsZXN0b25lKQ0KICAgICAgICBjYW1wYWlnbk5vdENhbmNlbGVkIG5vdENoYW5naW5nDQogICAgew0KICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsNCiAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbX2lkTWlsZXN0b25lXTsNCiAgICAgICAgaWYgKChtc2cuc2VuZGVyICE9IG1pbGVzdG9uZS5yZXZpZXdlcikgfHwNCiAgICAgICAgICAgIChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5Db21wbGV0ZWQpKSB0aHJvdzsNCg0KICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzczsNCiAgICAgICAgUHJvcG9zYWxTdGF0dXNDaGFuZ2VkKF9pZE1pbGVzdG9uZSwgbWlsZXN0b25lLnN0YXR1cyk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRPckxlYWRMaW5rYCBTZW5kcyB0aGUgbWlsZXN0b25lIHBheW1lbnQgYXMNCiAgICAvLy8gIHNwZWNpZmllZCBpbiBgcGF5RGF0YWA7IHRoZSByZWNpcGllbnQgY2FuIG9ubHkgY2FsbCB0aGlzIGFmdGVyIHRoZQ0KICAgIC8vLyAgYHJldmlld1RpbWVgIGhhcyBlbGFwc2VkDQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0byBiZSBwYWlkIG91dA0KICAgIGZ1bmN0aW9uIHJlcXVlc3RNaWxlc3RvbmVQYXltZW50KHVpbnQgX2lkTWlsZXN0b25lDQogICAgICAgICkgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZyB7DQogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93Ow0KICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOw0KICAgICAgICBpZiAoICAobXNnLnNlbmRlciAhPSBtaWxlc3RvbmUubWlsZXN0b25lTGVhZExpbmspDQogICAgICAgICAgICAmJihtc2cuc2VuZGVyICE9IHJlY2lwaWVudCkpDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgaWYgICgobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQ29tcGxldGVkKSB8fA0KICAgICAgICAgICAgIChub3cgPCBtaWxlc3RvbmUuZG9uZVRpbWUgKyBtaWxlc3RvbmUucmV2aWV3VGltZSkpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICBhdXRob3JpemVQYXltZW50KF9pZE1pbGVzdG9uZSk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRgIENhbmNlbHMgYSBwcmV2aW91c2x5IGFjY2VwdGVkIG1pbGVzdG9uZQ0KICAgIC8vLyBAcGFyYW0gX2lkTWlsZXN0b25lIElEIG9mIHRoZSBtaWxlc3RvbmUgdG8gYmUgY2FuY2VsZWQNCiAgICBmdW5jdGlvbiBjYW5jZWxNaWxlc3RvbmUodWludCBfaWRNaWxlc3RvbmUpDQogICAgICAgIG9ubHlSZWNpcGllbnQgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZw0KICAgIHsNCiAgICAgICAgaWYgKF9pZE1pbGVzdG9uZSA+PSBtaWxlc3RvbmVzLmxlbmd0aCkgdGhyb3c7DQogICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW19pZE1pbGVzdG9uZV07DQogICAgICAgIGlmICAoKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzcykgJiYNCiAgICAgICAgICAgICAobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQ29tcGxldGVkKSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIG1pbGVzdG9uZS5zdGF0dXMgPSBNaWxlc3RvbmVTdGF0dXMuQ2FuY2VsZWQ7DQogICAgICAgIFByb3Bvc2FsU3RhdHVzQ2hhbmdlZChfaWRNaWxlc3RvbmUsIG1pbGVzdG9uZS5zdGF0dXMpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5QXJiaXRyYXRvcmAgRm9yY2VzIGEgbWlsZXN0b25lIHRvIGJlIHBhaWQgb3V0IGFzIGxvbmcgYXMgaXQNCiAgICAvLy8gaGFzIG5vdCBiZWVuIHBhaWQgb3IgY2FuY2VsZWQNCiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRvIGJlIHBhaWQgb3V0DQogICAgZnVuY3Rpb24gYXJiaXRyYXRlQXBwcm92ZU1pbGVzdG9uZSh1aW50IF9pZE1pbGVzdG9uZQ0KICAgICkgb25seUFyYml0cmF0b3IgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZyB7DQogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93Ow0KICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOw0KICAgICAgICBpZiAgKChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5BY2NlcHRlZEFuZEluUHJvZ3Jlc3MpICYmDQogICAgICAgICAgICAgKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZCkpDQogICAgICAgICAgIHRocm93Ow0KICAgICAgICBhdXRob3JpemVQYXltZW50KF9pZE1pbGVzdG9uZSk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlBcmJpdHJhdG9yYCBDYW5jZWxzIHRoZSBlbnRpcmUgY2FtcGFpZ24gdm9pZGluZyBhbGwNCiAgICAvLy8gIG1pbGVzdG9uZXMgdm8NCiAgICBmdW5jdGlvbiBhcmJpdHJhdGVDYW5jZWxDYW1wYWlnbigpIG9ubHlBcmJpdHJhdG9yIGNhbXBhaWduTm90Q2FuY2VsZWQgew0KICAgICAgICBjYW1wYWlnbkNhbmNlbGVkID0gdHJ1ZTsNCiAgICAgICAgQ2FtcGFpZ25DYW5jZWxlZCgpOw0KICAgIH0NCg0KICAgIC8vIEBkZXYgVGhpcyBpbnRlcm5hbCBmdW5jdGlvbiBpcyBleGVjdXRlZCB3aGVuIHRoZSBtaWxlc3RvbmUgaXMgcGFpZCBvdXQNCiAgICBmdW5jdGlvbiBhdXRob3JpemVQYXltZW50KHVpbnQgX2lkTWlsZXN0b25lKSBpbnRlcm5hbCB7DQogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93Ow0KICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOw0KICAgICAgICAvLyBSZWNoZWNrIGFnYWluIHRvIG5vdCBwYXkgdHdpY2UNCiAgICAgICAgaWYgKG1pbGVzdG9uZS5zdGF0dXMgPT0gTWlsZXN0b25lU3RhdHVzLkF1dGhvcml6ZWRGb3JQYXltZW50KSB0aHJvdzsNCiAgICAgICAgbWlsZXN0b25lLnN0YXR1cyA9IE1pbGVzdG9uZVN0YXR1cy5BdXRob3JpemVkRm9yUGF5bWVudDsNCiAgICAgICAgaWYgKCFtaWxlc3RvbmUucGF5bWVudFNvdXJjZS5jYWxsLnZhbHVlKDApKG1pbGVzdG9uZS5wYXlEYXRhKSkNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICBQcm9wb3NhbFN0YXR1c0NoYW5nZWQoX2lkTWlsZXN0b25lLCBtaWxlc3RvbmUuc3RhdHVzKTsNCiAgICB9DQp9'