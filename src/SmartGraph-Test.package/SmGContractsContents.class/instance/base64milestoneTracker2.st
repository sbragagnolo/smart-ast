base 64 content
base64milestoneTracker2
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC42Ow0KDQovKioNCiogQHRpdGxlIFJMUFJlYWRlcg0KKg0KKiBSTFBSZWFkZXIgaXMgdXNlZCB0byByZWFkIGFuZCBwYXJzZSBSTFAgZW5jb2RlZCBkYXRhIGluIG1lbW9yeS4NCioNCiogQGF1dGhvciBBbmRyZWFzIE9sb2Zzc29uIChhbmRyb2xvMTk4MEBnbWFpbC5jb20pDQoqLw0KbGlicmFyeSBSTFAgew0KDQogdWludCBjb25zdGFudCBEQVRBX1NIT1JUX1NUQVJUID0gMHg4MDsNCiB1aW50IGNvbnN0YW50IERBVEFfTE9OR19TVEFSVCA9IDB4Qjg7DQogdWludCBjb25zdGFudCBMSVNUX1NIT1JUX1NUQVJUID0gMHhDMDsNCiB1aW50IGNvbnN0YW50IExJU1RfTE9OR19TVEFSVCA9IDB4Rjg7DQoNCiB1aW50IGNvbnN0YW50IERBVEFfTE9OR19PRkZTRVQgPSAweEI3Ow0KIHVpbnQgY29uc3RhbnQgTElTVF9MT05HX09GRlNFVCA9IDB4Rjc7DQoNCg0KIHN0cnVjdCBSTFBJdGVtIHsNCiAgICAgdWludCBfdW5zYWZlX21lbVB0cjsgICAgLy8gUG9pbnRlciB0byB0aGUgUkxQLWVuY29kZWQgYnl0ZXMuDQogICAgIHVpbnQgX3Vuc2FmZV9sZW5ndGg7ICAgIC8vIE51bWJlciBvZiBieXRlcy4gVGhpcyBpcyB0aGUgZnVsbCBsZW5ndGggb2YgdGhlIHN0cmluZy4NCiB9DQoNCiBzdHJ1Y3QgSXRlcmF0b3Igew0KICAgICBSTFBJdGVtIF91bnNhZmVfaXRlbTsgICAvLyBJdGVtIHRoYXQncyBiZWluZyBpdGVyYXRlZCBvdmVyLg0KICAgICB1aW50IF91bnNhZmVfbmV4dFB0cjsgICAvLyBQb3NpdGlvbiBvZiB0aGUgbmV4dCBpdGVtIGluIHRoZSBsaXN0Lg0KIH0NCg0KIC8qIEl0ZXJhdG9yICovDQoNCiBmdW5jdGlvbiBuZXh0KEl0ZXJhdG9yIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSBzdWJJdGVtKSB7DQogICAgIGlmKGhhc05leHQoc2VsZikpIHsNCiAgICAgICAgIHZhciBwdHIgPSBzZWxmLl91bnNhZmVfbmV4dFB0cjsNCiAgICAgICAgIHZhciBpdGVtTGVuZ3RoID0gX2l0ZW1MZW5ndGgocHRyKTsNCiAgICAgICAgIHN1Ykl0ZW0uX3Vuc2FmZV9tZW1QdHIgPSBwdHI7DQogICAgICAgICBzdWJJdGVtLl91bnNhZmVfbGVuZ3RoID0gaXRlbUxlbmd0aDsNCiAgICAgICAgIHNlbGYuX3Vuc2FmZV9uZXh0UHRyID0gcHRyICsgaXRlbUxlbmd0aDsNCiAgICAgfQ0KICAgICBlbHNlDQogICAgICAgICB0aHJvdzsNCiB9DQoNCiBmdW5jdGlvbiBuZXh0KEl0ZXJhdG9yIG1lbW9yeSBzZWxmLCBib29sIHN0cmljdCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoUkxQSXRlbSBtZW1vcnkgc3ViSXRlbSkgew0KICAgICBzdWJJdGVtID0gbmV4dChzZWxmKTsNCiAgICAgaWYoc3RyaWN0ICYmICFfdmFsaWRhdGUoc3ViSXRlbSkpDQogICAgICAgICB0aHJvdzsNCiAgICAgcmV0dXJuOw0KIH0NCg0KIGZ1bmN0aW9uIGhhc05leHQoSXRlcmF0b3IgbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgdmFyIGl0ZW0gPSBzZWxmLl91bnNhZmVfaXRlbTsNCiAgICAgcmV0dXJuIHNlbGYuX3Vuc2FmZV9uZXh0UHRyIDwgaXRlbS5fdW5zYWZlX21lbVB0ciArIGl0ZW0uX3Vuc2FmZV9sZW5ndGg7DQogfQ0KDQogLyogUkxQSXRlbSAqLw0KDQogLy8vIEBkZXYgQ3JlYXRlcyBhbiBSTFBJdGVtIGZyb20gYW4gYXJyYXkgb2YgUkxQIGVuY29kZWQgYnl0ZXMuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgZW5jb2RlZCBieXRlcy4NCiAvLy8gQHJldHVybiBBbiBSTFBJdGVtDQogZnVuY3Rpb24gdG9STFBJdGVtKGJ5dGVzIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSkgew0KICAgICB1aW50IGxlbiA9IHNlbGYubGVuZ3RoOw0KICAgICBpZiAobGVuID09IDApIHsNCiAgICAgICAgIHJldHVybiBSTFBJdGVtKDAsIDApOw0KICAgICB9DQogICAgIHVpbnQgbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICBtZW1QdHIgOj0gYWRkKHNlbGYsIDB4MjApDQogICAgIH0NCiAgICAgcmV0dXJuIFJMUEl0ZW0obWVtUHRyLCBsZW4pOw0KIH0NCg0KIC8vLyBAZGV2IENyZWF0ZXMgYW4gUkxQSXRlbSBmcm9tIGFuIGFycmF5IG9mIFJMUCBlbmNvZGVkIGJ5dGVzLg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGVuY29kZWQgYnl0ZXMuDQogLy8vIEBwYXJhbSBzdHJpY3QgV2lsbCB0aHJvdyBpZiB0aGUgZGF0YSBpcyBub3QgUkxQIGVuY29kZWQuDQogLy8vIEByZXR1cm4gQW4gUkxQSXRlbQ0KIGZ1bmN0aW9uIHRvUkxQSXRlbShieXRlcyBtZW1vcnkgc2VsZiwgYm9vbCBzdHJpY3QpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5KSB7DQogICAgIHZhciBpdGVtID0gdG9STFBJdGVtKHNlbGYpOw0KICAgICBpZihzdHJpY3QpIHsNCiAgICAgICAgIHVpbnQgbGVuID0gc2VsZi5sZW5ndGg7DQogICAgICAgICBpZihfcGF5bG9hZE9mZnNldChpdGVtKSA+IGxlbikNCiAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgIGlmKF9pdGVtTGVuZ3RoKGl0ZW0uX3Vuc2FmZV9tZW1QdHIpICE9IGxlbikNCiAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgIGlmKCFfdmFsaWRhdGUoaXRlbSkpDQogICAgICAgICAgICAgdGhyb3c7DQogICAgIH0NCiAgICAgcmV0dXJuIGl0ZW07DQogfQ0KDQogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIG51bGwuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgbnVsbC4NCiBmdW5jdGlvbiBpc051bGwoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsNCiAgICAgcmV0dXJuIHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMDsNCiB9DQoNCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gJ3RydWUnIGlmIHRoZSBpdGVtIGlzIGEgbGlzdC4NCiBmdW5jdGlvbiBpc0xpc3QoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsNCiAgICAgaWYgKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkNCiAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICByZXQgOj0gaXN6ZXJvKGx0KGJ5dGUoMCwgbWxvYWQobWVtUHRyKSksIDB4QzApKQ0KICAgICB9DQogfQ0KDQogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIGRhdGEuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgZGF0YS4NCiBmdW5jdGlvbiBpc0RhdGEoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsNCiAgICAgaWYgKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkNCiAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICByZXQgOj0gbHQoYnl0ZSgwLCBtbG9hZChtZW1QdHIpKSwgMHhDMCkNCiAgICAgfQ0KIH0NCg0KIC8vLyBAZGV2IENoZWNrIGlmIHRoZSBSTFAgaXRlbSBpcyBlbXB0eSAoc3RyaW5nIG9yIGxpc3QpLg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gJ3RydWUnIGlmIHRoZSBpdGVtIGlzIG51bGwuDQogZnVuY3Rpb24gaXNFbXB0eShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgew0KICAgICBpZihpc051bGwoc2VsZikpDQogICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgIHVpbnQgYjA7DQogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICB9DQogICAgIHJldHVybiAoYjAgPT0gREFUQV9TSE9SVF9TVEFSVCB8fCBiMCA9PSBMSVNUX1NIT1JUX1NUQVJUKTsNCiB9DQoNCiAvLy8gQGRldiBHZXQgdGhlIG51bWJlciBvZiBpdGVtcyBpbiBhbiBSTFAgZW5jb2RlZCBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBpdGVtcy4NCiBmdW5jdGlvbiBpdGVtcyhSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgIGlmICghaXNMaXN0KHNlbGYpKQ0KICAgICAgICAgcmV0dXJuIDA7DQogICAgIHVpbnQgYjA7DQogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICB9DQogICAgIHVpbnQgcG9zID0gbWVtUHRyICsgX3BheWxvYWRPZmZzZXQoc2VsZik7DQogICAgIHVpbnQgbGFzdCA9IG1lbVB0ciArIHNlbGYuX3Vuc2FmZV9sZW5ndGggLSAxOw0KICAgICB1aW50IGl0bXM7DQogICAgIHdoaWxlKHBvcyA8PSBsYXN0KSB7DQogICAgICAgICBwb3MgKz0gX2l0ZW1MZW5ndGgocG9zKTsNCiAgICAgICAgIGl0bXMrKzsNCiAgICAgfQ0KICAgICByZXR1cm4gaXRtczsNCiB9DQoNCiAvLy8gQGRldiBDcmVhdGUgYW4gaXRlcmF0b3IuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiBBbiAnSXRlcmF0b3InIG92ZXIgdGhlIGl0ZW0uDQogZnVuY3Rpb24gaXRlcmF0b3IoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoSXRlcmF0b3IgbWVtb3J5IGl0KSB7DQogICAgIGlmICghaXNMaXN0KHNlbGYpKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHVpbnQgcHRyID0gc2VsZi5fdW5zYWZlX21lbVB0ciArIF9wYXlsb2FkT2Zmc2V0KHNlbGYpOw0KICAgICBpdC5fdW5zYWZlX2l0ZW0gPSBzZWxmOw0KICAgICBpdC5fdW5zYWZlX25leHRQdHIgPSBwdHI7DQogfQ0KDQogLy8vIEBkZXYgUmV0dXJuIHRoZSBSTFAgZW5jb2RlZCBieXRlcy4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGJ5dGVzLg0KIGZ1bmN0aW9uIHRvQnl0ZXMoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMgbWVtb3J5IGJ0cykgew0KICAgICB2YXIgbGVuID0gc2VsZi5fdW5zYWZlX2xlbmd0aDsNCiAgICAgaWYgKGxlbiA9PSAwKQ0KICAgICAgICAgcmV0dXJuOw0KICAgICBidHMgPSBuZXcgYnl0ZXMobGVuKTsNCiAgICAgX2NvcHlUb0J5dGVzKHNlbGYuX3Vuc2FmZV9tZW1QdHIsIGJ0cywgbGVuKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGJ5dGVzLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlDQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuDQogZnVuY3Rpb24gdG9EYXRhKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzIG1lbW9yeSBidHMpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGJ0cyA9IG5ldyBieXRlcyhsZW4pOw0KICAgICBfY29weVRvQnl0ZXMoclN0YXJ0UG9zLCBidHMsIGxlbik7DQogfQ0KDQogLy8vIEBkZXYgR2V0IHRoZSBsaXN0IG9mIHN1Yi1pdGVtcyBmcm9tIGFuIFJMUCBlbmNvZGVkIGxpc3QuDQogLy8vIFdhcm5pbmc6IFRoaXMgaXMgaW5lZmZpY2llbnQsIGFzIGl0IHJlcXVpcmVzIHRoYXQgdGhlIGxpc3QgaXMgcmVhZCB0d2ljZS4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLg0KIC8vLyBAcmV0dXJuIEFycmF5IG9mIFJMUEl0ZW1zLg0KIGZ1bmN0aW9uIHRvTGlzdChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtW10gbWVtb3J5IGxpc3QpIHsNCiAgICAgaWYoIWlzTGlzdChzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgbnVtSXRlbXMgPSBpdGVtcyhzZWxmKTsNCiAgICAgbGlzdCA9IG5ldyBSTFBJdGVtW10obnVtSXRlbXMpOw0KICAgICB2YXIgaXQgPSBpdGVyYXRvcihzZWxmKTsNCiAgICAgdWludCBpZHg7DQogICAgIHdoaWxlKGhhc05leHQoaXQpKSB7DQogICAgICAgICBsaXN0W2lkeF0gPSBuZXh0KGl0KTsNCiAgICAgICAgIGlkeCsrOw0KICAgICB9DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhbiBhc2NpaSBzdHJpbmcuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0FzY2lpKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBtZW1vcnkgc3RyKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBieXRlcyBtZW1vcnkgYnRzID0gbmV3IGJ5dGVzKGxlbik7DQogICAgIF9jb3B5VG9CeXRlcyhyU3RhcnRQb3MsIGJ0cywgbGVuKTsNCiAgICAgc3RyID0gc3RyaW5nKGJ0cyk7DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIHVpbnQuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b1VpbnQoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuID4gMzIgfHwgbGVuID09IDApDQogICAgICAgICB0aHJvdzsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgZGF0YSA6PSBkaXYobWxvYWQoclN0YXJ0UG9zKSwgZXhwKDI1Niwgc3ViKDMyLCBsZW4pKSkNCiAgICAgfQ0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYSBib29sZWFuLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlDQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuDQogZnVuY3Rpb24gdG9Cb29sKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZGF0YSkgew0KICAgICBpZighaXNEYXRhKHNlbGYpKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsNCiAgICAgaWYgKGxlbiAhPSAxKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHVpbnQgdGVtcDsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgdGVtcCA6PSBieXRlKDAsIG1sb2FkKHJTdGFydFBvcykpDQogICAgIH0NCiAgICAgaWYgKHRlbXAgPiAxKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHJldHVybiB0ZW1wID09IDEgPyB0cnVlIDogZmFsc2U7DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIGJ5dGUuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0J5dGUoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZSBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuICE9IDEpDQogICAgICAgICB0aHJvdzsNCiAgICAgdWludCB0ZW1wOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICB0ZW1wIDo9IGJ5dGUoMCwgbWxvYWQoclN0YXJ0UG9zKSkNCiAgICAgfQ0KICAgICByZXR1cm4gYnl0ZSh0ZW1wKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGludC4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvSW50KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGludCBkYXRhKSB7DQogICAgIHJldHVybiBpbnQodG9VaW50KHNlbGYpKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGEgYnl0ZXMzMi4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvQnl0ZXMzMihSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlczMyIGRhdGEpIHsNCiAgICAgcmV0dXJuIGJ5dGVzMzIodG9VaW50KHNlbGYpKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGFkZHJlc3MuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0FkZHJlc3MoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuICE9IDIwKQ0KICAgICAgICAgdGhyb3c7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGRhdGEgOj0gZGl2KG1sb2FkKHJTdGFydFBvcyksIGV4cCgyNTYsIDEyKSkNCiAgICAgfQ0KIH0NCg0KIC8vIEdldCB0aGUgcGF5bG9hZCBvZmZzZXQuDQogZnVuY3Rpb24gX3BheWxvYWRPZmZzZXQoUkxQSXRlbSBtZW1vcnkgc2VsZikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgIGlmKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkNCiAgICAgICAgIHJldHVybiAwOw0KICAgICB1aW50IGIwOw0KICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkNCiAgICAgfQ0KICAgICBpZihiMCA8IERBVEFfU0hPUlRfU1RBUlQpDQogICAgICAgICByZXR1cm4gMDsNCiAgICAgaWYoYjAgPCBEQVRBX0xPTkdfU1RBUlQgfHwgKGIwID49IExJU1RfU0hPUlRfU1RBUlQgJiYgYjAgPCBMSVNUX0xPTkdfU1RBUlQpKQ0KICAgICAgICAgcmV0dXJuIDE7DQogICAgIGlmKGIwIDwgTElTVF9TSE9SVF9TVEFSVCkNCiAgICAgICAgIHJldHVybiBiMCAtIERBVEFfTE9OR19PRkZTRVQgKyAxOw0KICAgICByZXR1cm4gYjAgLSBMSVNUX0xPTkdfT0ZGU0VUICsgMTsNCiB9DQoNCiAvLyBHZXQgdGhlIGZ1bGwgbGVuZ3RoIG9mIGFuIFJMUCBpdGVtLg0KIGZ1bmN0aW9uIF9pdGVtTGVuZ3RoKHVpbnQgbWVtUHRyKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQgbGVuKSB7DQogICAgIHVpbnQgYjA7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkNCiAgICAgfQ0KICAgICBpZiAoYjAgPCBEQVRBX1NIT1JUX1NUQVJUKQ0KICAgICAgICAgbGVuID0gMTsNCiAgICAgZWxzZSBpZiAoYjAgPCBEQVRBX0xPTkdfU1RBUlQpDQogICAgICAgICBsZW4gPSBiMCAtIERBVEFfU0hPUlRfU1RBUlQgKyAxOw0KICAgICBlbHNlIGlmIChiMCA8IExJU1RfU0hPUlRfU1RBUlQpIHsNCiAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICBsZXQgYkxlbiA6PSBzdWIoYjAsIDB4QjcpIC8vIGJ5dGVzIGxlbmd0aCAoREFUQV9MT05HX09GRlNFVCkNCiAgICAgICAgICAgICBsZXQgZExlbiA6PSBkaXYobWxvYWQoYWRkKG1lbVB0ciwgMSkpLCBleHAoMjU2LCBzdWIoMzIsIGJMZW4pKSkgLy8gZGF0YSBsZW5ndGgNCiAgICAgICAgICAgICBsZW4gOj0gYWRkKDEsIGFkZChiTGVuLCBkTGVuKSkgLy8gdG90YWwgbGVuZ3RoDQogICAgICAgICB9DQogICAgIH0NCiAgICAgZWxzZSBpZiAoYjAgPCBMSVNUX0xPTkdfU1RBUlQpDQogICAgICAgICBsZW4gPSBiMCAtIExJU1RfU0hPUlRfU1RBUlQgKyAxOw0KICAgICBlbHNlIHsNCiAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICBsZXQgYkxlbiA6PSBzdWIoYjAsIDB4RjcpIC8vIGJ5dGVzIGxlbmd0aCAoTElTVF9MT05HX09GRlNFVCkNCiAgICAgICAgICAgICBsZXQgZExlbiA6PSBkaXYobWxvYWQoYWRkKG1lbVB0ciwgMSkpLCBleHAoMjU2LCBzdWIoMzIsIGJMZW4pKSkgLy8gZGF0YSBsZW5ndGgNCiAgICAgICAgICAgICBsZW4gOj0gYWRkKDEsIGFkZChiTGVuLCBkTGVuKSkgLy8gdG90YWwgbGVuZ3RoDQogICAgICAgICB9DQogICAgIH0NCiB9DQoNCiAvLyBHZXQgc3RhcnQgcG9zaXRpb24gYW5kIGxlbmd0aCBvZiB0aGUgZGF0YS4NCiBmdW5jdGlvbiBfZGVjb2RlKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCBtZW1QdHIsIHVpbnQgbGVuKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdWludCBiMDsNCiAgICAgdWludCBzdGFydCA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQoc3RhcnQpKQ0KICAgICB9DQogICAgIGlmIChiMCA8IERBVEFfU0hPUlRfU1RBUlQpIHsNCiAgICAgICAgIG1lbVB0ciA9IHN0YXJ0Ow0KICAgICAgICAgbGVuID0gMTsNCiAgICAgICAgIHJldHVybjsNCiAgICAgfQ0KICAgICBpZiAoYjAgPCBEQVRBX0xPTkdfU1RBUlQpIHsNCiAgICAgICAgIGxlbiA9IHNlbGYuX3Vuc2FmZV9sZW5ndGggLSAxOw0KICAgICAgICAgbWVtUHRyID0gc3RhcnQgKyAxOw0KICAgICB9IGVsc2Ugew0KICAgICAgICAgdWludCBiTGVuOw0KICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgIGJMZW4gOj0gc3ViKGIwLCAweEI3KSAvLyBEQVRBX0xPTkdfT0ZGU0VUDQogICAgICAgICB9DQogICAgICAgICBsZW4gPSBzZWxmLl91bnNhZmVfbGVuZ3RoIC0gMSAtIGJMZW47DQogICAgICAgICBtZW1QdHIgPSBzdGFydCArIGJMZW4gKyAxOw0KICAgICB9DQogICAgIHJldHVybjsNCiB9DQoNCiAvLyBBc3N1bWVzIHRoYXQgZW5vdWdoIG1lbW9yeSBoYXMgYmVlbiBhbGxvY2F0ZWQgdG8gc3RvcmUgaW4gdGFyZ2V0Lg0KIGZ1bmN0aW9uIF9jb3B5VG9CeXRlcyh1aW50IGJ0c1B0ciwgYnl0ZXMgbWVtb3J5IHRndCwgdWludCBidHNMZW4pIHByaXZhdGUgY29uc3RhbnQgew0KICAgICAvLyBFeHBsb2l0aW5nIHRoZSBmYWN0IHRoYXQgJ3RndCcgd2FzIHRoZSBsYXN0IHRoaW5nIHRvIGJlIGFsbG9jYXRlZCwNCiAgICAgLy8gd2UgY2FuIHdyaXRlIGVudGlyZSB3b3JkcywgYW5kIGp1c3Qgb3ZlcndyaXRlIGFueSBleGNlc3MuDQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgbGV0IGkgOj0gMCAvLyBTdGFydCBhdCBhcnIgKyAweDIwDQogICAgICAgICAgICAgICAgIGxldCB3b3JkcyA6PSBkaXYoYWRkKGJ0c0xlbiwgMzEpLCAzMikNCiAgICAgICAgICAgICAgICAgbGV0IHJPZmZzZXQgOj0gYnRzUHRyDQogICAgICAgICAgICAgICAgIGxldCB3T2Zmc2V0IDo9IGFkZCh0Z3QsIDB4MjApDQogICAgICAgICAgICAgdGFnX2xvb3A6DQogICAgICAgICAgICAgICAgIGp1bXBpKGVuZCwgZXEoaSwgd29yZHMpKQ0KICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0IDo9IG11bChpLCAweDIwKQ0KICAgICAgICAgICAgICAgICAgICAgbXN0b3JlKGFkZCh3T2Zmc2V0LCBvZmZzZXQpLCBtbG9hZChhZGQock9mZnNldCwgb2Zmc2V0KSkpDQogICAgICAgICAgICAgICAgICAgICBpIDo9IGFkZChpLCAxKQ0KICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgIGp1bXAodGFnX2xvb3ApDQogICAgICAgICAgICAgZW5kOg0KICAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRndCwgYWRkKDB4MjAsIG1sb2FkKHRndCkpKSwgMCkNCiAgICAgICAgIH0NCiAgICAgfQ0KIH0NCg0KIC8vIENoZWNrIHRoYXQgYW4gUkxQIGl0ZW0gaXMgdmFsaWQuDQogICAgIGZ1bmN0aW9uIF92YWxpZGF0ZShSTFBJdGVtIG1lbW9yeSBzZWxmKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmV0KSB7DQogICAgICAgICAvLyBDaGVjayB0aGF0IFJMUCBpcyB3ZWxsLWZvcm1lZC4NCiAgICAgICAgIHVpbnQgYjA7DQogICAgICAgICB1aW50IGIxOw0KICAgICAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkNCiAgICAgICAgICAgICBiMSA6PSBieXRlKDEsIG1sb2FkKG1lbVB0cikpDQogICAgICAgICB9DQogICAgICAgICBpZihiMCA9PSBEQVRBX1NIT1JUX1NUQVJUICsgMSAmJiBiMSA8IERBVEFfU0hPUlRfU1RBUlQpDQogICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgIH0NCn0NCg0KLyoNCiAgICBDb3B5cmlnaHQgMjAxNiwgSm9yZGkgQmF5bGluYQ0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yDQogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lg0KICovDQoNCi8vLyBAdGl0bGUgTWlsZXN0b25lVHJhY2tlciBDb250cmFjdA0KLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQ0KLy8vIEBkZXYgVGhpcyBjb250cmFjdCB0cmFja3MgdGhlDQoNCg0KLy8vIGlzIHJ1bGVzIHRoZSByZWxhdGlvbiBiZXR3ZW4gYSBkb25vciBhbmQgYSByZWNpcGllbnQNCi8vLyAgaW4gb3JkZXIgdG8gZ3VhcmFudHkgdG8gdGhlIGRvbm9yIHRoYXQgdGhlIGpvYiB3aWxsIGJlIGRvbmUgYW5kIHRvIGd1YXJhbnR5DQovLy8gIHRvIHRoZSByZWNpcGllbnQgdGhhdCBoZSB3aWxsIGJlIHBhaWQNCg0KDQovLy8gQGRldiBXZSB1c2UgdGhlIFJMUCBsaWJyYXJ5IHRvIGRlY29kZSBSTFAgc28gdGhhdCB0aGUgZG9ub3IgY2FuIGFwcHJvdmUgb25lDQovLy8gIHNldCBvZiBtaWxlc3RvbmUgY2hhbmdlcyBhdCBhIHRpbWUuDQovLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmRyb2xvL3N0YW5kYXJkLWNvbnRyYWN0cy9ibG9iL21hc3Rlci9jb250cmFjdHMvc3JjL2NvZGVjL1JMUC5zb2wNCi8vIGltcG9ydCAiUkxQLnNvbCI7DQoNCg0KDQovLy8gQGRldiBUaGlzIGNvbnRyYWN0IGFsbG93cyBmb3IgYHJlY2lwaWVudGAgdG8gc2V0IGFuZCBtb2RpZnkgbWlsZXN0b25lcw0KY29udHJhY3QgTWlsZXN0b25lVHJhY2tlciB7DQogICAgdXNpbmcgUkxQIGZvciBSTFAuUkxQSXRlbTsNCiAgICB1c2luZyBSTFAgZm9yIFJMUC5JdGVyYXRvcjsNCiAgICB1c2luZyBSTFAgZm9yIGJ5dGVzOw0KDQogICAgc3RydWN0IE1pbGVzdG9uZSB7DQogICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbjsgICAgIC8vIERlc2NyaXB0aW9uIG9mIHRoZSBtaWxlc3RvbmUNCiAgICAgICAgc3RyaW5nIHVybDsgICAgICAgICAgICAgLy8gQSBsaW5rIHRvIG1vcmUgaW5mb3JtYXRpb24gKHN3YXJtIGdhdGV3YXkpDQogICAgICAgIHVpbnQgbWluQ29tcGxldGlvbkRhdGU7ICAgICAgIC8vIEVhcmxpZXN0IFVOSVggdGltZSB0aGUgbWlsZXN0b25lIGNhbiBiZSBwYWlkDQogICAgICAgIHVpbnQgbWF4Q29tcGxldGlvbkRhdGU7ICAgICAgIC8vIExhdGVzdCBVTklYIHRpbWUgdGhlIG1pbGVzdG9uZSBjYW4gYmUgcGFpZA0KICAgICAgICBhZGRyZXNzIHJldmlld2VyOyAgICAgICAvLyBXaG8gd2lsbCBjaGVjayB0aGUgbWlsZXN0b25lIGhhcyBjb21wbGV0ZWQNCiAgICAgICAgdWludCByZXZpZXdUaW1lOyAgICAgICAgLy8gSG93IG1hbnkgc2Vjb25kcyB0aGUgcmV2aWV3ZXIgaGFzIHRvIHJldmlldw0KICAgICAgICBhZGRyZXNzIHBheW1lbnRTb3VyY2U7ICAvLyBXaGVyZSB0aGUgbWlsZXN0b25lIHBheW1lbnQgaXMgc2VudCBmcm9tDQogICAgICAgIGJ5dGVzIHBheURhdGE7ICAgICAgICAgIC8vIERhdGEgZGVmaW5pbmcgaG93IG11Y2ggZXRoZXIgaXMgc2VudCB3aGVyZQ0KDQogICAgICAgIE1pbGVzdG9uZVN0YXR1cyBzdGF0dXM7IC8vIEN1cnJlbnQgc3RhdHVzIG9mIHRoZSBtaWxlc3RvbmUgKENvbXBsZXRlZCwgUGFpZC4uLikNCiAgICAgICAgdWludCBkb25lVGltZTsgICAgICAgICAgLy8gVU5JWCB0aW1lIHdoZW4gdGhlIG1pbGVzdG9uZSB3YXMgbWFya2VkIERPTkUNCiAgICB9DQoNCiAgICAvLyBUaGUgbGlzdCBvZiBhbGwgdGhlIG1pbGVzdG9uZXMuDQogICAgTWlsZXN0b25lW10gcHVibGljIG1pbGVzdG9uZXM7DQoNCiAgICBhZGRyZXNzIHB1YmxpYyByZWNpcGllbnQ7ICAgLy8gQ2FsbHMgZnVuY3Rpb25zIGluIHRoZSBuYW1lIG9mIHRoZSByZWNpcGllbnQNCiAgICBhZGRyZXNzIHB1YmxpYyBkb25vcjsgICAgICAgLy8gQ2FsbHMgZnVuY3Rpb25zIGluIHRoZSBuYW1lIG9mIHRoZSBkb25vcg0KICAgIGFkZHJlc3MgcHVibGljIGFyYml0cmF0b3I7ICAvLyBDYWxscyBmdW5jdGlvbnMgaW4gdGhlIG5hbWUgb2YgdGhlIGFyYml0cmF0b3INCg0KICAgIGVudW0gTWlsZXN0b25lU3RhdHVzIHsgQWNjZXB0ZWRBbmRJblByb2dyZXNzLCBDb21wbGV0ZWQsIFBhaWQsIENhbmNlbGVkIH0NCg0KICAgIC8vIFRydWUgaWYgdGhlIGNhbXBhaWduIGhhcyBiZWVuIGNhbmNlbGVkDQogICAgYm9vbCBwdWJsaWMgY2FtcGFpZ25DYW5jZWxlZDsNCg0KICAgIC8vIFRydWUgaWYgYW4gYXBwcm92YWwgb24gYSBjaGFuZ2UgdG8gYG1pbGVzdG9uZXNgIGlzIGEgcGVuZGluZw0KICAgIGJvb2wgcHVibGljIGNoYW5naW5nTWlsZXN0b25lczsNCg0KICAgIC8vIFRoZSBwZW5kaW5nIGNoYW5nZSB0byBgbWlsZXN0b25lc2AgZW5jb2RlZCBpbiBSTFANCiAgICBieXRlcyBwdWJsaWMgcHJvcG9zZWRNaWxlc3RvbmVzOw0KDQoNCiAgICAvLy8gQGRldiBUaGUgZm9sbG93aW5nIG1vZGlmaWVycyBvbmx5IGFsbG93IHNwZWNpZmljIHJvbGVzIHRvIGNhbGwgZnVuY3Rpb25zDQogICAgLy8vIHdpdGggdGhlc2UgbW9kaWZpZXJzDQogICAgbW9kaWZpZXIgb25seVJlY2lwaWVudCB7IGlmIChtc2cuc2VuZGVyICE9ICByZWNpcGllbnQpIHRocm93OyBfOyB9DQogICAgbW9kaWZpZXIgb25seUFyYml0cmF0b3IgeyBpZiAobXNnLnNlbmRlciAhPSBhcmJpdHJhdG9yKSB0aHJvdzsgXzsgfQ0KICAgIG1vZGlmaWVyIG9ubHlEb25vciB7IGlmIChtc2cuc2VuZGVyICE9IGRvbm9yKSB0aHJvdzsgXzsgfQ0KDQogICAgLy8vIEBkZXYgVGhlIGZvbGxvd2luZyBtb2RpZmllcnMgcHJldmVudCBmdW5jdGlvbnMgZnJvbSBiZWluZyBjYWxsZWQgaWYgdGhlDQogICAgLy8vIGNhbXBhaWduIGhhcyBiZWVuIGNhbmNlbGVkIG9yIGlmIG5ldyBtaWxlc3RvbmVzIGFyZSBiZWluZyBwcm9wb3NlZA0KICAgIG1vZGlmaWVyIGNhbXBhaWduTm90Q2FuY2VsZWQgeyBpZiAoY2FtcGFpZ25DYW5jZWxlZCkgdGhyb3c7IF87IH0NCiAgICBtb2RpZmllciBub3RDaGFuZ2luZyB7IGlmIChjaGFuZ2luZ01pbGVzdG9uZXMpIHRocm93OyBfOyB9DQoNCiAvLyBAZGV2IEV2ZW50cyB0byBtYWtlIHRoZSBwYXltZW50IG1vdmVtZW50cyBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4NCiAgICBldmVudCBOZXdNaWxlc3RvbmVMaXN0UHJvcG9zZWQoKTsNCiAgICBldmVudCBOZXdNaWxlc3RvbmVMaXN0VW5wcm9wb3NlZCgpOw0KICAgIGV2ZW50IE5ld01pbGVzdG9uZUxpc3RBY2NlcHRlZCgpOw0KICAgIGV2ZW50IFByb3Bvc2FsU3RhdHVzQ2hhbmdlZCh1aW50IGlkUHJvcG9zYWwsIE1pbGVzdG9uZVN0YXR1cyBuZXdQcm9wb3NhbCk7DQogICAgZXZlbnQgQ2FtcGFpZ25DYWxuY2VsbGVkKCk7DQoNCg0KLy8vLy8vLy8vLy8NCi8vIENvbnN0cnVjdG9yDQovLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGNyZWF0ZXMgdGhlIE1pbGVzdG9uZSBjb250cmFjdCBvbiB0aGUgYmxvY2tjaGFpbg0KICAgIC8vLyBAcGFyYW0gX2FyYml0cmF0b3IgQWRkcmVzcyBhc3NpZ25lZCB0byBiZSB0aGUgYXJiaXRyYXRvcg0KICAgIC8vLyBAcGFyYW0gX2Rvbm9yIEFkZHJlc3MgYXNzaWduZWQgdG8gYmUgdGhlIGRvbm9yDQogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IEFkZHJlc3MgYXNzaWduZWQgdG8gYmUgdGhlIHJlY2lwaWVudA0KICAgIGZ1bmN0aW9uIE1pbGVzdG9uZVRyYWNrZXIgKA0KICAgICAgICBhZGRyZXNzIF9hcmJpdHJhdG9yLA0KICAgICAgICBhZGRyZXNzIF9kb25vciwNCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50DQogICAgKSB7DQogICAgICAgIGFyYml0cmF0b3IgPSBfYXJiaXRyYXRvcjsNCiAgICAgICAgZG9ub3IgPSBfZG9ub3I7DQogICAgICAgIHJlY2lwaWVudCA9IF9yZWNpcGllbnQ7DQogICAgfQ0KDQoNCi8vLy8vLy8vLw0KLy8gSGVscGVyIGZ1bmN0aW9ucw0KLy8vLy8vLy8vDQoNCiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIG1pbGVzdG9uZXMgZXZlciBjcmVhdGVkIGV2ZW4gaWYgdGhleSB3ZXJlIGNhbmNlbGVkDQogICAgZnVuY3Rpb24gbnVtYmVyT2ZNaWxlc3RvbmVzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gbWlsZXN0b25lcy5sZW5ndGg7DQogICAgfQ0KDQoNCi8vLy8vLy8vDQovLyBDaGFuZ2UgcGxheWVycw0KLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5QXJiaXRyYXRvcmAgUmVhc3NpZ25zIHRoZSBhcmJpdHJhdG9yIHRvIGEgbmV3IGFkZHJlc3MNCiAgICAvLy8gQHBhcmFtIF9uZXdBcmJpdHJhdG9yIFRoZSBuZXcgYXJiaXRyYXRvcg0KICAgIGZ1bmN0aW9uIGNoYW5nZUFyYml0cmF0b3IoYWRkcmVzcyBfbmV3QXJiaXRyYXRvcikgb25seUFyYml0cmF0b3Igew0KICAgICAgICBhcmJpdHJhdG9yID0gX25ld0FyYml0cmF0b3I7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlEb25vcmAgUmVhc3NpZ25zIHRoZSBgZG9ub3JgIHRvIGEgbmV3IGFkZHJlc3MNCiAgICAvLy8gQHBhcmFtIF9uZXdEb25vciBUaGUgbmV3IGRvbm9yDQogICAgZnVuY3Rpb24gY2hhbmdlRG9ub3IoYWRkcmVzcyBfbmV3RG9ub3IpIG9ubHlEb25vciB7DQogICAgICAgIGRvbm9yID0gX25ld0Rvbm9yOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5UmVjaXBpZW50YCBSZWFzc2lnbnMgdGhlIGByZWNpcGllbnRgIHRvIGEgbmV3IGFkZHJlc3MNCiAgICAvLy8gQHBhcmFtIF9uZXdSZWNpcGllbnQgVGhlIG5ldyByZWNpcGllbnQNCiAgICBmdW5jdGlvbiBjaGFuZ2VSZWNpcGllbnQoYWRkcmVzcyBfbmV3UmVjaXBpZW50KSBvbmx5UmVjaXBpZW50IHsNCiAgICAgICAgcmVjaXBpZW50ID0gX25ld1JlY2lwaWVudDsNCiAgICB9DQoNCg0KLy8vLy8vLy8vLy8vDQovLyBDcmVhdGlvbiBhbmQgbW9kaWZpY2F0aW9uIG9mIE1pbGVzdG9uZXMNCi8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRgIFByb3Bvc2VzIG5ldyBtaWxlc3RvbmVzIG9yIGNoYW5nZXMgb2xkDQogICAgLy8vICBtaWxlc3RvbmVzLCB0aGlzIHdpbGwgcmVxdWlyZSBhIHVzZXIgaW50ZXJmYWNlIHRvIGJlIGJ1aWx0IHVwIHRvDQogICAgLy8vICBzdXBwb3J0IHRoaXMgZnVuY3Rpb25hbGl0eSBhcyBhc2tzIGZvciBSTFAgZW5jb2RlZCBieXRlY29kZSB0byBiZQ0KICAgIC8vLyAgZ2VuZXJhdGVkLCB1bnRpbCB0aGlzIGludGVyZmFjZSBpcyBidWlsdCB5b3UgY2FuIHVzZSB0aGlzIHNjcmlwdDoNCiAgICAvLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9HaXZldGgvbWlsZXN0b25ldHJhY2tlci9ibG9iL21hc3Rlci9qcy9taWxlc3RvbmV0cmFja2VyX2hlbHBlci5qcw0KICAgIC8vLyAgdGhlIGZ1bmN0aW9ucyBtaWxlc3RvbmVzMmJ5dGVzIGFuZCBieXRlczJtaWxlc3RvbmVzIHdpbGwgZW5hYmxlIHRoZQ0KICAgIC8vLyAgcmVjaXBpZW50IHRvIGVuY29kZSBhbmQgZGVjb2RlIGEgbGlzdCBvZiBtaWxlc3RvbmVzLCBhbHNvIHNlZQ0KICAgIC8vLyAgaHR0cHM6Ly9naXRodWIuY29tL0dpdmV0aC9taWxlc3RvbmV0cmFja2VyL2Jsb2IvbWFzdGVyL1JFQURNRS5tZA0KICAgIC8vLyBAcGFyYW0gX25ld01pbGVzdG9uZXMgVGhlIFJMUCBlbmNvZGVkIGxpc3Qgb2YgbWlsZXN0b25lczsgZWFjaCBtaWxlc3RvbmUNCiAgICAvLy8gIGhhcyB0aGVzZSBmaWVsZHM6DQogICAgLy8vICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbiwNCiAgICAvLy8gICAgICAgc3RyaW5nIHVybCwNCiAgICAvLy8gICAgICAgYWRkcmVzcyBwYXltZW50U291cmNlLA0KICAgIC8vLyAgICAgICBieXRlcyBwYXlEYXRhLA0KICAgIC8vLyAgICAgICB1aW50IG1pbkNvbXBsZXRpb25EYXRlLA0KICAgIC8vLyAgICAgICB1aW50IG1heENvbXBsZXRpb25EYXRlLA0KICAgIC8vLyAgICAgICBhZGRyZXNzIHJldmlld2VyLA0KICAgIC8vLyAgICAgICB1aW50IHJldmlld1RpbWUNCiAgICBmdW5jdGlvbiBwcm9wb3NlTWlsZXN0b25lcyhieXRlcyBfbmV3TWlsZXN0b25lcw0KICAgICkgb25seVJlY2lwaWVudCBjYW1wYWlnbk5vdENhbmNlbGVkIHsNCiAgICAgICAgcHJvcG9zZWRNaWxlc3RvbmVzID0gX25ld01pbGVzdG9uZXM7DQogICAgICAgIGNoYW5naW5nTWlsZXN0b25lcyA9IHRydWU7DQogICAgICAgIE5ld01pbGVzdG9uZUxpc3RQcm9wb3NlZCgpOw0KICAgIH0NCg0KDQovLy8vLy8vLy8vLy8NCi8vIE5vcm1hbCBhY3Rpb25zIHRoYXQgd2lsbCBjaGFuZ2UgdGhlIHN0YXRlIG9mIHRoZSBtaWxlc3RvbmVzDQovLy8vLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5UmVjaXBpZW50YCBDYW5jZWxzIHRoZSBwcm9wb3NlZCBtaWxlc3RvbmVzIGFuZCByZWFjdGl2YXRlcw0KICAgIC8vLyAgdGhlIHByZXZpb3VzIHNldCBvZiBtaWxlc3RvbmVzDQogICAgZnVuY3Rpb24gdW5wcm9wb3NlTWlsZXN0b25lcygpIG9ubHlSZWNpcGllbnQgY2FtcGFpZ25Ob3RDYW5jZWxlZCB7DQogICAgICAgIGRlbGV0ZSBwcm9wb3NlZE1pbGVzdG9uZXM7DQogICAgICAgIGNoYW5naW5nTWlsZXN0b25lcyA9IGZhbHNlOw0KICAgICAgICBOZXdNaWxlc3RvbmVMaXN0VW5wcm9wb3NlZCgpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5RG9ub3JgIEFwcHJvdmVzIHRoZSBwcm9wb3NlZCBtaWxlc3RvbmUgbGlzdA0KICAgIC8vLyBAcGFyYW0gX2hhc2hQcm9wb3NhbHMgVGhlIHNoYTMoKSBvZiB0aGUgcHJvcG9zZWQgbWlsZXN0b25lIGxpc3Qncw0KICAgIC8vLyAgYnl0ZWNvZGU7IHRoaXMgY29uZmlybXMgdGhhdCB0aGUgYGRvbm9yYCBrbm93cyB0aGUgc2V0IG9mIG1pbGVzdG9uZXMNCiAgICAvLy8gIHRoZXkgYXJlIGFwcHJvdmluZw0KICAgIGZ1bmN0aW9uIGFjY2VwdFByb3Bvc2VkTWlsZXN0b25lcyhieXRlczMyIF9oYXNoUHJvcG9zYWxzDQogICAgKSBvbmx5RG9ub3IgY2FtcGFpZ25Ob3RDYW5jZWxlZCB7DQoNCiAgICAgICAgdWludCBpOw0KDQogICAgICAgIGlmICghY2hhbmdpbmdNaWxlc3RvbmVzKSB0aHJvdzsNCiAgICAgICAgaWYgKHNoYTMocHJvcG9zZWRNaWxlc3RvbmVzKSAhPSBfaGFzaFByb3Bvc2FscykgdGhyb3c7DQoNCiAgICAgICAgLy8gQ2FuY2VsIGFsbCB0aGUgdW5maW5pc2hlZCBtaWxlc3RvbmVzDQogICAgICAgIGZvciAoaT0wOyBpPG1pbGVzdG9uZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmIChtaWxlc3RvbmVzW2ldLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuUGFpZCkgew0KICAgICAgICAgICAgICAgIG1pbGVzdG9uZXNbaV0uc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkNhbmNlbGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIERlY29kZSB0aGUgUkxQIGVuY29kZWQgbWlsZXN0b25lcyBhbmQgYWRkIHRoZW0gdG8gdGhlIG1pbGVzdG9uZXMgbGlzdA0KICAgICAgICBieXRlcyBtZW1vcnkgbVByb3Bvc2VkTWlsZXN0b25lcyA9IHByb3Bvc2VkTWlsZXN0b25lczsNCg0KICAgICAgICB2YXIgaXRtUHJvcG9zYWxzID0gbVByb3Bvc2VkTWlsZXN0b25lcy50b1JMUEl0ZW0odHJ1ZSk7DQoNCiAgICAgICAgaWYgKCFpdG1Qcm9wb3NhbHMuaXNMaXN0KCkpIHRocm93Ow0KDQogICAgICAgIHZhciBpdHJQcm9wb3NhbHMgPSBpdG1Qcm9wb3NhbHMuaXRlcmF0b3IoKTsNCg0KICAgICAgICB3aGlsZShpdHJQcm9wb3NhbHMuaGFzTmV4dCgpKSB7DQoNCg0KICAgICAgICAgICAgdmFyIGl0bVByb3Bvc2FsID0gaXRyUHJvcG9zYWxzLm5leHQoKTsNCg0KICAgICAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbbWlsZXN0b25lcy5sZW5ndGggKytdOw0KDQogICAgICAgICAgICBpZiAoIWl0bVByb3Bvc2FsLmlzTGlzdCgpKSB0aHJvdzsNCg0KICAgICAgICAgICAgdmFyIGl0clByb3Bvc2FsID0gaXRtUHJvcG9zYWwuaXRlcmF0b3IoKTsNCg0KICAgICAgICAgICAgbWlsZXN0b25lLmRlc2NyaXB0aW9uID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvQXNjaWkoKTsNCiAgICAgICAgICAgIG1pbGVzdG9uZS51cmwgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9Bc2NpaSgpOw0KICAgICAgICAgICAgbWlsZXN0b25lLm1pbkNvbXBsZXRpb25EYXRlID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvVWludCgpOw0KICAgICAgICAgICAgbWlsZXN0b25lLm1heENvbXBsZXRpb25EYXRlID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvVWludCgpOw0KICAgICAgICAgICAgbWlsZXN0b25lLnJldmlld2VyID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvQWRkcmVzcygpOw0KICAgICAgICAgICAgbWlsZXN0b25lLnJldmlld1RpbWUgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9VaW50KCk7DQogICAgICAgICAgICBtaWxlc3RvbmUucGF5bWVudFNvdXJjZSA9IGl0clByb3Bvc2FsLm5leHQoKS50b0FkZHJlc3MoKTsNCiAgICAgICAgICAgIG1pbGVzdG9uZS5wYXlEYXRhID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvRGF0YSgpOw0KDQogICAgICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzczsNCg0KICAgICAgICB9DQoNCiAgICAgICAgZGVsZXRlIHByb3Bvc2VkTWlsZXN0b25lczsNCiAgICAgICAgY2hhbmdpbmdNaWxlc3RvbmVzID0gZmFsc2U7DQogICAgICAgIE5ld01pbGVzdG9uZUxpc3RBY2NlcHRlZCgpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5UmV2aWV3ZXJgIEFwcHJvdmVzIGEgc3BlY2lmaWMgbWlsZXN0b25lDQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0aGF0IGlzIGFwcHJvdmVkDQogICAgZnVuY3Rpb24gYXBwcm92ZUNvbXBsZXRlZE1pbGVzdG9uZSh1aW50IF9pZE1pbGVzdG9uZSkgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZyB7DQogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93Ow0KICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOw0KICAgICAgICBpZiAoKG1zZy5zZW5kZXIgIT0gbWlsZXN0b25lLnJldmlld2VyKSB8fA0KICAgICAgICAgICAgKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZCkpIHRocm93Ow0KDQogICAgICAgIGRvUGF5bWVudChfaWRNaWxlc3RvbmUpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5UmV2aWV3ZXJgIFJlamVjdHMgYSBzcGVjaWZpYyBtaWxlc3RvbmUncyBjb21wbGV0aW9uIGFuZA0KICAgIC8vLyAgcmV2ZXJ0cyB0aGUgYG1pbGVzdG9uZS5zdGF0dXNgIGJhY2sgdG8gdGhlIGBBY2NlcHRlZEFuZEluUHJvZ3Jlc3NgIHN0YXRlDQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0aGF0IGlzIGJlaW5nIHJlamVjdGVkDQogICAgZnVuY3Rpb24gcmVqZWN0TWlsZXN0b25lKHVpbnQgX2lkTWlsZXN0b25lKSBjYW1wYWlnbk5vdENhbmNlbGVkIG5vdENoYW5naW5nIHsNCiAgICAgICAgaWYgKF9pZE1pbGVzdG9uZSA+PSBtaWxlc3RvbmVzLmxlbmd0aCkgdGhyb3c7DQogICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW19pZE1pbGVzdG9uZV07DQogICAgICAgIGlmICgobXNnLnNlbmRlciAhPSBtaWxlc3RvbmUucmV2aWV3ZXIpIHx8DQogICAgICAgICAgICAobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQ29tcGxldGVkKSkgdGhyb3c7DQoNCiAgICAgICAgbWlsZXN0b25lLnN0YXR1cyA9IE1pbGVzdG9uZVN0YXR1cy5BY2NlcHRlZEFuZEluUHJvZ3Jlc3M7DQogICAgICAgIFByb3Bvc2FsU3RhdHVzQ2hhbmdlZChfaWRNaWxlc3RvbmUsIG1pbGVzdG9uZS5zdGF0dXMpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5UmVjaXBpZW50YCBNYXJrcyBhIG1pbGVzdG9uZSBhcyBET05FIGFuZCByZWFkeSBmb3IgcmV2aWV3DQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0aGF0IGhhcyBiZWVuIGNvbXBsZXRlZA0KICAgIGZ1bmN0aW9uIG1pbGVzdG9uZUNvbXBsZXRlZCh1aW50IF9pZE1pbGVzdG9uZSkgb25seVJlY2lwaWVudCBjYW1wYWlnbk5vdENhbmNlbGVkIG5vdENoYW5naW5nIHsNCiAgICAgICAgaWYgKF9pZE1pbGVzdG9uZSA+PSBtaWxlc3RvbmVzLmxlbmd0aCkgdGhyb3c7DQogICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW19pZE1pbGVzdG9uZV07DQogICAgICAgIGlmIChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5BY2NlcHRlZEFuZEluUHJvZ3Jlc3MpIHRocm93Ow0KICAgICAgICBpZiAobm93IDwgbWlsZXN0b25lLm1pbkNvbXBsZXRpb25EYXRlKSB0aHJvdzsNCiAgICAgICAgaWYgKG5vdyA+IG1pbGVzdG9uZS5tYXhDb21wbGV0aW9uRGF0ZSkgdGhyb3c7DQogICAgICAgIG1pbGVzdG9uZS5zdGF0dXMgPSBNaWxlc3RvbmVTdGF0dXMuQ29tcGxldGVkOw0KICAgICAgICBtaWxlc3RvbmUuZG9uZVRpbWUgPSBub3c7DQogICAgICAgIFByb3Bvc2FsU3RhdHVzQ2hhbmdlZChfaWRNaWxlc3RvbmUsIG1pbGVzdG9uZS5zdGF0dXMpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBvbmx5UmVjaXBpZW50YCBTZW5kcyB0aGUgbWlsZXN0b25lIHBheW1lbnQgYXMgc3BlY2lmaWVkIGluDQogICAgLy8vICBgcGF5RGF0YWA7IHRoZSByZWNpcGllbnQgY2FuIG9ubHkgY2FsbCB0aGlzIGFmdGVyIHRoZSBgcmV2aWV3VGltZWAgaGFzDQogICAgLy8vICBlbGFwc2VkDQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0byBiZSBwYWlkIG91dA0KICAgIGZ1bmN0aW9uIGNvbGxlY3RNaWxlc3RvbmVQYXltZW50KHVpbnQgX2lkTWlsZXN0b25lDQogICAgICAgICkgb25seVJlY2lwaWVudCBjYW1wYWlnbk5vdENhbmNlbGVkIG5vdENoYW5naW5nIHsNCiAgICAgICAgaWYgKF9pZE1pbGVzdG9uZSA+PSBtaWxlc3RvbmVzLmxlbmd0aCkgdGhyb3c7DQogICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW19pZE1pbGVzdG9uZV07DQogICAgICAgIGlmICAoKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZCkgfHwNCiAgICAgICAgICAgICAobm93IDwgbWlsZXN0b25lLmRvbmVUaW1lICsgbWlsZXN0b25lLnJldmlld1RpbWUpKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgZG9QYXltZW50KF9pZE1pbGVzdG9uZSk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRgIENhbmNlbHMgYSBwcmV2aW91c2x5IGFjY2VwdGVkIG1pbGVzdG9uZQ0KICAgIC8vLyBAcGFyYW0gX2lkTWlsZXN0b25lIElEIG9mIHRoZSBtaWxlc3RvbmUgdG8gYmUgY2FuY2VsZWQNCiAgICBmdW5jdGlvbiBjYW5jZWxNaWxlc3RvbmUodWludCBfaWRNaWxlc3RvbmUpIG9ubHlSZWNpcGllbnQgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZyB7DQogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93Ow0KICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOw0KICAgICAgICBpZiAgKChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5BY2NlcHRlZEFuZEluUHJvZ3Jlc3MpICYmDQogICAgICAgICAgICAgKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZCkpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkNhbmNlbGVkOw0KICAgICAgICBQcm9wb3NhbFN0YXR1c0NoYW5nZWQoX2lkTWlsZXN0b25lLCBtaWxlc3RvbmUuc3RhdHVzKTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBgb25seUFyYml0cmF0b3JgIEZvcmNlcyBhIG1pbGVzdG9uZSB0byBiZSBwYWlkIG91dCBhcyBsb25nIGFzIGl0DQogICAgLy8vIGhhcyBub3QgYmVlbiBwYWlkIG9yIGNhbmNlbGVkDQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0byBiZSBwYWlkIG91dA0KICAgIGZ1bmN0aW9uIGFyYml0cmF0ZUFwcHJvdmVNaWxlc3RvbmUodWludCBfaWRNaWxlc3RvbmUNCiAgICApIG9ubHlBcmJpdHJhdG9yIGNhbXBhaWduTm90Q2FuY2VsZWQgbm90Q2hhbmdpbmcgew0KICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsNCiAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbX2lkTWlsZXN0b25lXTsNCiAgICAgICAgaWYgICgobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQWNjZXB0ZWRBbmRJblByb2dyZXNzKSAmJg0KICAgICAgICAgICAgIChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5Db21wbGV0ZWQpKQ0KICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgZG9QYXltZW50KF9pZE1pbGVzdG9uZSk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG9ubHlBcmJpdHJhdG9yYCBDYW5jZWxzIHRoZSBlbnRpcmUgY2FtcGFpZ24gdm9pZGluZyBhbGwNCiAgICAvLy8gIG1pbGVzdG9uZXMgdm8NCiAgICBmdW5jdGlvbiBhcmJpdHJhdGVDYW5jZWxDYW1wYWlnbigpIG9ubHlBcmJpdHJhdG9yIGNhbXBhaWduTm90Q2FuY2VsZWQgew0KICAgICAgICBjYW1wYWlnbkNhbmNlbGVkID0gdHJ1ZTsNCiAgICAgICAgQ2FtcGFpZ25DYWxuY2VsbGVkKCk7DQogICAgfQ0KDQogICAgLy8gQGRldiBUaGlzIGludGVybmFsIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIHdoZW4gdGhlIG1pbGVzdG9uZSBpcyBwYWlkIG91dA0KICAgIGZ1bmN0aW9uIGRvUGF5bWVudCh1aW50IF9pZE1pbGVzdG9uZSkgaW50ZXJuYWwgew0KICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsNCiAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbX2lkTWlsZXN0b25lXTsNCiAgICAgICAgLy8gUmVjaGVjayBhZ2FpbiB0byBub3QgcGF5IHR3aWNlDQogICAgICAgIGlmIChtaWxlc3RvbmUuc3RhdHVzID09IE1pbGVzdG9uZVN0YXR1cy5QYWlkKSB0aHJvdzsNCiAgICAgICAgbWlsZXN0b25lLnN0YXR1cyA9IE1pbGVzdG9uZVN0YXR1cy5QYWlkOw0KICAgICAgICBpZiAoIW1pbGVzdG9uZS5wYXltZW50U291cmNlLmNhbGwudmFsdWUoMCkobWlsZXN0b25lLnBheURhdGEpKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIFByb3Bvc2FsU3RhdHVzQ2hhbmdlZChfaWRNaWxlc3RvbmUsIG1pbGVzdG9uZS5zdGF0dXMpOw0KICAgIH0NCn0='