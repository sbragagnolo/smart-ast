base 64 content
base64miniMeToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMzsNCg0KLyoNCiAgICBDb3B5cmlnaHQgMjAxNiwgSm9yZGkgQmF5bGluYQ0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yDQogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lg0KICovDQoNCi8vIEFic3RyYWN0IGNvbnRyYWN0IGZvciB0aGUgZnVsbCBFUkMgMjAgVG9rZW4gc3RhbmRhcmQNCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KDQpjb250cmFjdCBFUkMyMFRva2VuIHsNCiAgICAvKiBUaGlzIGlzIGEgc2xpZ2h0IGNoYW5nZSB0byB0aGUgRVJDMjAgYmFzZSBzdGFuZGFyZC4NCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KTsNCiAgICBpcyByZXBsYWNlZCB3aXRoOg0KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5Ow0KICAgIFRoaXMgYXV0b21hdGljYWxseSBjcmVhdGVzIGEgZ2V0dGVyIGZ1bmN0aW9uIGZvciB0aGUgdG90YWxTdXBwbHkuDQogICAgVGhpcyBpcyBtb3ZlZCB0byB0aGUgYmFzZSBjb250cmFjdCBzaW5jZSBwdWJsaWMgZ2V0dGVyIGZ1bmN0aW9ucyBhcmUgbm90DQogICAgY3VycmVudGx5IHJlY29nbmlzZWQgYXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIG1hdGNoaW5nIGFic3RyYWN0DQogICAgZnVuY3Rpb24gYnkgdGhlIGNvbXBpbGVyLg0KICAgICovDQogICAgLy8vIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMNCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsNCg0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQNCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZQ0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsNCg0KICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmANCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYA0KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcg0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2Vucw0KICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQNCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsNCg0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOw0KfQ0KDQoNCg0KLy8vIEB0aXRsZSBNaW5pTWVUb2tlbiBDb250cmFjdA0KLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQ0KLy8vIEBkZXYgVGhpcyB0b2tlbiBjb250cmFjdCdzIGdvYWwgaXMgdG8gbWFrZSBpdCBlYXN5IGZvciBhbnlvbmUgdG8gY2xvbmUgdGhpcw0KLy8vICB0b2tlbiB1c2luZyB0aGUgdG9rZW4gZGlzdHJpYnV0aW9uIGF0IGEgZ2l2ZW4gYmxvY2ssIHRoaXMgd2lsbCBhbGxvdyBEQU8ncw0KLy8vICBhbmQgREFwcHMgdG8gdXBncmFkZSB0aGVpciBmZWF0dXJlcyBpbiBhIGRlY2VudHJhbGl6ZWQgbWFubmVyIHdpdGhvdXQNCi8vLyAgYWZmZWN0aW5nIHRoZSBvcmlnaW5hbCB0b2tlbg0KLy8vIEBkZXYgSXQgaXMgRVJDMjAgY29tcGxpYW50LCBidXQgc3RpbGwgbmVlZHMgdG8gdW5kZXIgZ28gZnVydGhlciB0ZXN0aW5nLg0KDQoNCi8vLyBAZGV2IFRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0IG11c3QgaW1wbGVtZW50IHRoZXNlIGZ1bmN0aW9ucw0KY29udHJhY3QgVG9rZW5Db250cm9sbGVyIHsNCiAgICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0DQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZXRoZXIgaXMgYWNjZXB0ZWQsIGZhbHNlIGlmIGl0IHRocm93cw0KICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcGF5YWJsZSByZXR1cm5zKGJvb2wpOw0KDQogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0b2tlbiB0cmFuc2ZlciBhbGxvd2luZyB0aGUNCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZA0KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXINCiAgICAvLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyDQogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2Zlcg0KICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcmV0dXJucyhib29sKTsNCg0KICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQ0KICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYA0KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwNCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkNCiAgICAgICAgcmV0dXJucyhib29sKTsNCn0NCg0KY29udHJhY3QgQ29udHJvbGxlZCB7DQogICAgLy8vIEBub3RpY2UgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyb2xsZXIgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsDQogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcg0KICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgdGhyb3c7IF87IH0NCg0KICAgIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7DQoNCiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgeyBjb250cm9sbGVyID0gbXNnLnNlbmRlcjt9DQoNCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgVGhlIG5ldyBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdA0KICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgb25seUNvbnRyb2xsZXIgew0KICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7DQogICAgfQ0KfQ0KDQpjb250cmFjdCBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrIHsNCiAgICBmdW5jdGlvbiByZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBmcm9tLCB1aW50MjU2IF9hbW91bnQsIGFkZHJlc3MgX3Rva2VuLCBieXRlcyBfZGF0YSk7DQp9DQoNCi8vLyBAZGV2IFRoZSBhY3R1YWwgdG9rZW4gY29udHJhY3QsIHRoZSBkZWZhdWx0IGNvbnRyb2xsZXIgaXMgdGhlIG1zZy5zZW5kZXINCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQ0KLy8vICB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0LCB3aGljaCBHaXZldGggd2lsbCBjYWxsIGEgIkNhbXBhaWduIg0KY29udHJhY3QgTWluaU1lVG9rZW4gaXMgQ29udHJvbGxlZCB7DQoNCiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgIC8vVGhlIFRva2VuJ3MgbmFtZTogZS5nLiBEaWdpeERBTyBUb2tlbnMNCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgIC8vTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0DQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGUuZy4gUkVQDQogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJ01NVF8wLjEnOyAvL0FuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZQ0KDQoNCiAgICAvLy8gQGRldiBgQ2hlY2twb2ludGAgaXMgdGhlIHN0cnVjdHVyZSB0aGF0IGF0dGFjaGVzIGEgYmxvY2sgbnVtYmVyIHRvIGENCiAgICAvLy8gIGdpdmVuIHZhbHVlLCB0aGUgYmxvY2sgbnVtYmVyIGF0dGFjaGVkIGlzIHRoZSBvbmUgdGhhdCBsYXN0IGNoYW5nZWQgdGhlDQogICAgLy8vICB2YWx1ZQ0KICAgIHN0cnVjdCAgQ2hlY2twb2ludCB7DQoNCiAgICAgICAgLy8gYGZyb21CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSB2YWx1ZSB3YXMgZ2VuZXJhdGVkIGZyb20NCiAgICAgICAgdWludDEyOCBmcm9tQmxvY2s7DQoNCiAgICAgICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcg0KICAgICAgICB1aW50MTI4IHZhbHVlOw0KICAgIH0NCg0KICAgIC8vIGBwYXJlbnRUb2tlbmAgaXMgdGhlIFRva2VuIGFkZHJlc3MgdGhhdCB3YXMgY2xvbmVkIHRvIHByb2R1Y2UgdGhpcyB0b2tlbjsNCiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZA0KICAgIE1pbmlNZVRva2VuIHB1YmxpYyBwYXJlbnRUb2tlbjsNCg0KICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcw0KICAgIC8vICB1c2VkIHRvIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIENsb25lIFRva2VuDQogICAgdWludCBwdWJsaWMgcGFyZW50U25hcFNob3RCbG9jazsNCg0KICAgIC8vIGBjcmVhdGlvbkJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIENsb25lIFRva2VuIHdhcyBjcmVhdGVkDQogICAgdWludCBwdWJsaWMgY3JlYXRpb25CbG9jazsNCg0KICAgIC8vIGBiYWxhbmNlc2AgaXMgdGhlIG1hcCB0aGF0IHRyYWNrcyB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGluIHRoaXMNCiAgICAvLyAgY29udHJhY3Qgd2hlbiB0aGUgYmFsYW5jZSBjaGFuZ2VzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgY2hhbmdlDQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcA0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsNCg0KICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOw0KDQogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbg0KICAgIENoZWNrcG9pbnRbXSB0b3RhbFN1cHBseUhpc3Rvcnk7DQoNCiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4NCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOw0KDQogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2Vucw0KICAgIE1pbmlNZVRva2VuRmFjdG9yeSBwdWJsaWMgdG9rZW5GYWN0b3J5Ow0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBDb25zdHJ1Y3Rvcg0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgTWluaU1lVG9rZW4NCiAgICAvLy8gQHBhcmFtIF90b2tlbkZhY3RvcnkgVGhlIGFkZHJlc3Mgb2YgdGhlIE1pbmlNZVRva2VuRmFjdG9yeSBjb250cmFjdCB0aGF0DQogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQ0KICAgIC8vLyAgZGVwbG95ZWQgZmlyc3QNCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSBwYXJlbnQgdG9rZW4sIHNldCB0byAweDAgaWYgaXQgaXMgYQ0KICAgIC8vLyAgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfcGFyZW50U25hcFNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbA0KICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4sIHNldCB0byAwIGlmIGl0DQogICAgLy8vICBpcyBhIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICBmdW5jdGlvbiBNaW5pTWVUb2tlbigNCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LA0KICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwNCiAgICAgICAgdWludCBfcGFyZW50U25hcFNob3RCbG9jaywNCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsDQogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsDQogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsDQogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQNCiAgICApIHsNCiAgICAgICAgdG9rZW5GYWN0b3J5ID0gTWluaU1lVG9rZW5GYWN0b3J5KF90b2tlbkZhY3RvcnkpOw0KICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUNCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscw0KICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbA0KICAgICAgICBwYXJlbnRUb2tlbiA9IE1pbmlNZVRva2VuKF9wYXJlbnRUb2tlbik7DQogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsNCiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOw0KICAgICAgICBjcmVhdGlvbkJsb2NrID0gYmxvY2subnVtYmVyOw0KICAgIH0NCg0KDQovLy8vLy8vLy8vLy8vLy8vLy8vDQovLyBFUkMyMCBNZXRob2RzDQovLy8vLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmANCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7DQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0DQogICAgLy8vICBpcyBhcHByb3ZlZCBieSBgX2Zyb21gDQogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudA0KICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQoNCiAgICAgICAgLy8gVGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCBjYW4gbW92ZSB0b2tlbnMgYXJvdW5kIGF0IHdpbGwsDQogICAgICAgIC8vICB0aGlzIGlzIGltcG9ydGFudCB0byByZWNvZ25pemUhIENvbmZpcm0gdGhhdCB5b3UgdHJ1c3QgdGhlDQogICAgICAgIC8vICBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QsIHdoaWNoIGluIG1vc3Qgc2l0dWF0aW9ucyBzaG91bGQgYmUNCiAgICAgICAgLy8gIGFub3RoZXIgb3BlbiBzb3VyY2Ugc21hcnQgY29udHJhY3Qgb3IgMHgwDQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHsNCiAgICAgICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7DQoNCiAgICAgICAgICAgIC8vIFRoZSBzdGFuZGFyZCBFUkMgMjAgdHJhbnNmZXJGcm9tIGZ1bmN0aW9uYWxpdHkNCiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgVGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGluIHRoZSB0b2tlbiBjb250cmFjdCwgaXQgY2FuDQogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4NCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudA0KICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7DQoNCiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgew0KICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgIH0NCg0KICAgICAgICAgICBpZiAocGFyZW50U25hcFNob3RCbG9jayA+PSBibG9jay5udW1iZXIpIHRocm93Ow0KDQogICAgICAgICAgIC8vIERvIG5vdCBhbGxvdyB0cmFuc2ZlciB0byAweDAgb3IgdGhlIHRva2VuIGNvbnRyYWN0IGl0c2VsZg0KICAgICAgICAgICBpZiAoKF90byA9PSAwKSB8fCAoX3RvID09IGFkZHJlc3ModGhpcykpKSB0aHJvdzsNCg0KICAgICAgICAgICAvLyBJZiB0aGUgYW1vdW50IGJlaW5nIHRyYW5zZmVyZWQgaXMgbW9yZSB0aGFuIHRoZSBiYWxhbmNlIG9mIHRoZQ0KICAgICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV0dXJucyBmYWxzZQ0KICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZkF0KF9mcm9tLCBibG9jay5udW1iZXIpOw0KICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHsNCiAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgfQ0KDQogICAgICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgdHJhbnNmZXINCiAgICAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsNCiAgICAgICAgICAgICAgIGlmICghVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCkpDQogICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgfQ0KDQogICAgICAgICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzDQogICAgICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMNCiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfZnJvbV0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsNCg0KICAgICAgICAgICAvLyBUaGVuIHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzDQogICAgICAgICAgIC8vICByZWNlaXZpbmcgdGhlIHRva2Vucw0KICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGJsb2NrLm51bWJlcik7DQogICAgICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPCBwcmV2aW91c0JhbGFuY2VUbykgdGhyb3c7IC8vIENoZWNrIGZvciBvdmVyZmxvdw0KICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7DQoNCiAgICAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdHJhbnNmZXIgZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluDQogICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOw0KDQogICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQncyBiYWxhbmNlIGlzIGJlaW5nIHJlcXVlc3RlZA0KICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IHRoZSBjdXJyZW50IGJsb2NrDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0KF9vd25lciwgYmxvY2subnVtYmVyKTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX2Ftb3VudGAgdG9rZW5zIG9uDQogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbg0KICAgIC8vLyAgdG8gYmUgYSBsaXR0bGUgYml0IHNhZmVyDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7DQoNCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2ANCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdA0KICAgICAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToNCiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5DQogICAgICAgIGlmICgoX2Ftb3VudCE9MCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9MCkpIHRocm93Ow0KDQogICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgYXBwcm92ZSBmdW5jdGlvbiBjYWxsDQogICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7DQogICAgICAgICAgICBpZiAoIVRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKQ0KICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQoNCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfYW1vdW50Ow0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byByZWFkIHRoZSBgYWxsb3dlZFtdYCBtYXANCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCB0aGF0IG93bnMgdGhlIHRva2VuDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBvZiBfb3duZXIgdGhhdCBfc3BlbmRlciBpcyBhbGxvd2VkDQogICAgLy8vICB0byBzcGVuZA0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcg0KICAgICkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsNCiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc2VuZCBgX2Ftb3VudGAgdG9rZW5zIG9uDQogICAgLy8vICBpdHMgYmVoYWxmLCBhbmQgdGhlbiBhIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpbiB0aGUgY29udHJhY3QgdGhhdCBpcw0KICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8NCiAgICAvLy8gIGludGVyYWN0IHdpdGggY29udHJhY3RzIGluIG9uZSBmdW5jdGlvbiBjYWxsIGluc3RlYWQgb2YgdHdvDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2Zlcg0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGZ1bmN0aW9uIGNhbGwgd2FzIHN1Y2Nlc3NmdWwNCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIF9leHRyYURhdGENCiAgICApIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoIWFwcHJvdmUoX3NwZW5kZXIsIF9hbW91bnQpKSB0aHJvdzsNCg0KICAgICAgICBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrKF9zcGVuZGVyKS5yZWNlaXZlQXBwcm92YWwoDQogICAgICAgICAgICBtc2cuc2VuZGVyLA0KICAgICAgICAgICAgX2Ftb3VudCwNCiAgICAgICAgICAgIHRoaXMsDQogICAgICAgICAgICBfZXh0cmFEYXRhDQogICAgICAgICk7DQoNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIGdldCB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2Vucw0KICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zDQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiB0b3RhbFN1cHBseUF0KGJsb2NrLm51bWJlcik7DQogICAgfQ0KDQoNCi8vLy8vLy8vLy8vLy8vLy8NCi8vIFF1ZXJ5IGJhbGFuY2UgYW5kIHRvdGFsU3VwcGx5IGluIEhpc3RvcnkNCi8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIC8vLyBAZGV2IFF1ZXJpZXMgdGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYA0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQNCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZA0KICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIGF0IGBfYmxvY2tOdW1iZXJgDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mQXQoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudA0KICAgICAgICByZXR1cm5zICh1aW50KSB7DQoNCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgYmFsYW5jZSBvZiB0aGUgdG9rZW4gaXMNCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdA0KICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQ0KICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhhdCB0b2tlbiBhcyB0aGlzIGNvbnRhaW5zIGluaXRpYWwgYmFsYW5jZSBvZg0KICAgICAgICAvLyAgdGhpcyB0b2tlbg0KICAgICAgICBpZiAoKGJhbGFuY2VzW19vd25lcl0ubGVuZ3RoID09IDApDQogICAgICAgICAgICB8fCAoYmFsYW5jZXNbX293bmVyXVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7DQogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gSGFzIG5vIHBhcmVudA0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdChiYWxhbmNlc1tfb3duZXJdLCBfYmxvY2tOdW1iZXIpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLg0KICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgdG90YWxTdXBwbHkgaXMgcXVlcmllZA0KICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGBfYmxvY2tOdW1iZXJgDQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7DQoNCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgdG90YWxTdXBwbHkgb2YgdGhlIHRva2VuIGlzDQogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQNCiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0YCBiZSBxdWVyaWVkIGF0IHRoZQ0KICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhpcyB0b2tlbiBhcyB0aGF0IGNvbnRhaW5zIHRvdGFsU3VwcGx5IG9mIHRoaXMNCiAgICAgICAgLy8gIHRva2VuIGF0IHRoaXMgYmxvY2sgbnVtYmVyLg0KICAgICAgICBpZiAoKHRvdGFsU3VwcGx5SGlzdG9yeS5sZW5ndGggPT0gMCkNCiAgICAgICAgICAgIHx8ICh0b3RhbFN1cHBseUhpc3RvcnlbMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgew0KICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdChtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIHRvdGFsU3VwcGx5IGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBfYmxvY2tOdW1iZXIpOw0KICAgICAgICB9DQogICAgfQ0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBDbG9uZSBUb2tlbiBNZXRob2QNCi8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgYSBuZXcgY2xvbmUgdG9rZW4gd2l0aCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gYmVpbmcNCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYA0KICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5OYW1lIE5hbWUgb2YgdGhlIGNsb25lIHRva2VuDQogICAgLy8vIEBwYXJhbSBfY2xvbmVEZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0DQogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuDQogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayB3aGVuIHRoZSBkaXN0cmlidXRpb24gb2YgdGhlIHBhcmVudCB0b2tlbiBpcw0KICAgIC8vLyAgY29waWVkIHRvIHNldCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIG5ldyBjbG9uZSB0b2tlbjsNCiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyB6ZXJvIHRoYW4gdGhlIGFjdHVhbCBibG9jaywgdGhlIGN1cnJlbnQgYmxvY2sgaXMgdXNlZA0KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lDQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBNaW5pTWVUb2tlbiBDb250cmFjdA0KICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oDQogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlbk5hbWUsDQogICAgICAgIHVpbnQ4IF9jbG9uZURlY2ltYWxVbml0cywNCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuU3ltYm9sLA0KICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLA0KICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkDQogICAgICAgICkgcmV0dXJucyhhZGRyZXNzKSB7DQogICAgICAgIGlmIChfc25hcHNob3RCbG9jayA9PSAwKSBfc25hcHNob3RCbG9jayA9IGJsb2NrLm51bWJlcjsNCiAgICAgICAgTWluaU1lVG9rZW4gY2xvbmVUb2tlbiA9IHRva2VuRmFjdG9yeS5jcmVhdGVDbG9uZVRva2VuKA0KICAgICAgICAgICAgdGhpcywNCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLA0KICAgICAgICAgICAgX2Nsb25lVG9rZW5OYW1lLA0KICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLA0KICAgICAgICAgICAgX2Nsb25lVG9rZW5TeW1ib2wsDQogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZA0KICAgICAgICAgICAgKTsNCg0KICAgICAgICBjbG9uZVRva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7DQoNCiAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdG9rZW4gZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluDQogICAgICAgIE5ld0Nsb25lVG9rZW4oYWRkcmVzcyhjbG9uZVRva2VuKSwgX3NuYXBzaG90QmxvY2spOw0KICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsNCiAgICB9DQoNCi8vLy8vLy8vLy8vLy8vLy8NCi8vIEdlbmVyYXRlIGFuZCBkZXN0cm95IHRva2Vucw0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgR2VuZXJhdGVzIGBfYW1vdW50YCB0b2tlbnMgdGhhdCBhcmUgYXNzaWduZWQgdG8gYF9vd25lcmANCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgYXNzaWduZWQgdGhlIG5ldyB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQNCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGdlbmVyYXRlZCBjb3JyZWN0bHkNCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50DQogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7DQogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgYmxvY2subnVtYmVyKTsNCiAgICAgICAgaWYgKGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCA8IGN1clRvdGFsU3VwcGx5KSB0aHJvdzsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93DQogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIF9hbW91bnQpOw0KICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2YoX293bmVyKTsNCiAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA8IHByZXZpb3VzQmFsYW5jZVRvKSB0aHJvdzsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93DQogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsNCiAgICAgICAgVHJhbnNmZXIoMCwgX293bmVyLCBfYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQoNCiAgICAvLy8gQG5vdGljZSBCdXJucyBgX2Ftb3VudGAgdG9rZW5zIGZyb20gYF9vd25lcmANCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbG9zZSB0aGUgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gYnVybg0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgYnVybmVkIGNvcnJlY3RseQ0KICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudA0KICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGJsb2NrLm51bWJlcik7DQogICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSA8IF9hbW91bnQpIHRocm93Ow0KICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgLSBfYW1vdW50KTsNCiAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsNCiAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB0aHJvdzsNCiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7DQogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMNCi8vLy8vLy8vLy8vLy8vLy8NCg0KDQogICAgLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQ0KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lDQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIG9ubHlDb250cm9sbGVyIHsNCiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOw0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gSW50ZXJuYWwgaGVscGVyIGZ1bmN0aW9ucyB0byBxdWVyeSBhbmQgc2V0IGEgdmFsdWUgaW4gYSBzbmFwc2hvdCBhcnJheQ0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBkZXYgYGdldFZhbHVlQXRgIHJldHJpZXZlcyB0aGUgbnVtYmVyIG9mIHRva2VucyBhdCBhIGdpdmVuIGJsb2NrIG51bWJlcg0KICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQNCiAgICAvLy8gQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgbnVtYmVyIHRvIHJldHJpZXZlIHRoZSB2YWx1ZSBhdA0KICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdG9rZW5zIGJlaW5nIHF1ZXJpZWQNCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jaw0KICAgICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICBpZiAoY2hlY2twb2ludHMubGVuZ3RoID09IDApIHJldHVybiAwOw0KDQogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlDQogICAgICAgIGlmIChfYmxvY2sgPj0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLmZyb21CbG9jaykNCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7DQogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOw0KDQogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQ0KICAgICAgICB1aW50IG1pbiA9IDA7DQogICAgICAgIHVpbnQgbWF4ID0gY2hlY2twb2ludHMubGVuZ3RoLTE7DQogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsNCiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOw0KICAgICAgICAgICAgaWYgKGNoZWNrcG9pbnRzW21pZF0uZnJvbUJsb2NrPD1fYmxvY2spIHsNCiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG1heCA9IG1pZC0xOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjaGVja3BvaW50c1ttaW5dLnZhbHVlOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IGB1cGRhdGVWYWx1ZUF0Tm93YCB1c2VkIHRvIHVwZGF0ZSB0aGUgYGJhbGFuY2VzYCBtYXAgYW5kIHRoZQ0KICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWANCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIGRhdGEgYmVpbmcgdXBkYXRlZA0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBuZXcgbnVtYmVyIG9mIHRva2Vucw0KICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlDQogICAgKSBpbnRlcm5hbCAgew0KICAgICAgICBpZiAoKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKQ0KICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7DQogICAgICAgICAgICAgICBDaGVja3BvaW50IG5ld0NoZWNrUG9pbnQgPSBjaGVja3BvaW50c1sgY2hlY2twb2ludHMubGVuZ3RoKysgXTsNCiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsNCiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7DQogICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICBDaGVja3BvaW50IG9sZENoZWNrUG9pbnQgPSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV07DQogICAgICAgICAgICAgICBvbGRDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOw0KICAgICAgICAgICB9DQogICAgfQ0KDQogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZA0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsNCiAgICAgICAgdWludCBzaXplOw0KICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzaXplPjA7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cw0KICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuDQogICAgLy8vICBzZXQgdG8gMCwgdGhlbiB0aGUgYHByb3h5UGF5bWVudGAgbWV0aG9kIGlzIGNhbGxlZCB3aGljaCByZWxheXMgdGhlDQogICAgLy8vICBldGhlciBhbmQgY3JlYXRlcyB0b2tlbnMgYXMgZGVzY3JpYmVkIGluIHRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gKCkgIHBheWFibGUgew0KICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgew0KICAgICAgICAgICAgaWYgKCEgVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKQ0KICAgICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkNCiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuDQogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3Zlcg0KICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLg0KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBvbmx5Q29udHJvbGxlciB7DQogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7DQogICAgICAgICAgICBjb250cm9sbGVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBFUkMyMFRva2VuIHRva2VuID0gRVJDMjBUb2tlbihfdG9rZW4pOw0KICAgICAgICB1aW50IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7DQogICAgICAgIHRva2VuLnRyYW5zZmVyKGNvbnRyb2xsZXIsIGJhbGFuY2UpOw0KICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7DQogICAgfQ0KDQoNCi8vLy8vLy8vLy8vLy8vLy8NCi8vIEV2ZW50cw0KLy8vLy8vLy8vLy8vLy8vLw0KICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50IF9hbW91bnQpOw0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsNCiAgICBldmVudCBOZXdDbG9uZVRva2VuKGFkZHJlc3MgaW5kZXhlZCBfY2xvbmVUb2tlbiwgdWludCBfc25hcHNob3RCbG9jayk7DQogICAgZXZlbnQgQXBwcm92YWwoDQogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsDQogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwNCiAgICAgICAgdWludDI1NiBfYW1vdW50DQogICAgICAgICk7DQoNCn0NCg0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBNaW5pTWVUb2tlbkZhY3RvcnkNCi8vLy8vLy8vLy8vLy8vLy8NCg0KLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuDQovLy8gIEluIHNvbGlkaXR5IHRoaXMgaXMgdGhlIHdheSB0byBjcmVhdGUgYSBjb250cmFjdCBmcm9tIGEgY29udHJhY3Qgb2YgdGhlDQovLy8gIHNhbWUgY2xhc3MNCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7DQoNCiAgICAvLy8gQG5vdGljZSBVcGRhdGUgdGhlIERBcHAgYnkgY3JlYXRpbmcgYSBuZXcgdG9rZW4gd2l0aCBuZXcgZnVuY3Rpb25hbGl0aWVzDQogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSB0b2tlbiBiZWluZyBjbG9uZWQNCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsDQogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IHRva2VuIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigNCiAgICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sDQogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssDQogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLA0KICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLA0KICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLA0KICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkDQogICAgKSByZXR1cm5zIChNaW5pTWVUb2tlbikgew0KICAgICAgICBNaW5pTWVUb2tlbiBuZXdUb2tlbiA9IG5ldyBNaW5pTWVUb2tlbigNCiAgICAgICAgICAgIHRoaXMsDQogICAgICAgICAgICBfcGFyZW50VG9rZW4sDQogICAgICAgICAgICBfc25hcHNob3RCbG9jaywNCiAgICAgICAgICAgIF90b2tlbk5hbWUsDQogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLA0KICAgICAgICAgICAgX3Rva2VuU3ltYm9sLA0KICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQNCiAgICAgICAgICAgICk7DQoNCiAgICAgICAgbmV3VG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsNCiAgICAgICAgcmV0dXJuIG5ld1Rva2VuOw0KICAgIH0NCn0NCg0KDQovLy8gQGRldiBgT3duZWRgIGlzIGEgYmFzZSBsZXZlbCBjb250cmFjdCB0aGF0IGFzc2lnbnMgYW4gYG93bmVyYCB0aGF0IGNhbiBiZQ0KLy8vICBsYXRlciBjaGFuZ2VkDQpjb250cmFjdCBPd25lZCB7DQogICAgLy8vIEBkZXYgYG93bmVyYCBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwgYSBmdW5jdGlvbiB3aXRoIHRoaXMNCiAgICAvLy8gbW9kaWZpZXINCiAgICBtb2RpZmllciBvbmx5T3duZXIgeyBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7IF87IH0NCg0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KDQogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGFzc2lnbnMgdGhlIG1lc3NhZ2Ugc2VuZGVyIHRvIGJlIGBvd25lcmANCiAgICBmdW5jdGlvbiBPd25lZCgpIHsgb3duZXIgPSBtc2cuc2VuZGVyO30NCg0KICAgIC8vLyBAbm90aWNlIGBvd25lcmAgY2FuIHN0ZXAgZG93biBhbmQgYXNzaWduIHNvbWUgb3RoZXIgYWRkcmVzcyB0byB0aGlzIHJvbGUNCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG93bmVyLiAweDAgY2FuIGJlIHVzZWQgdG8gY3JlYXRlDQogICAgLy8vICBhbiB1bm93bmVkIG5ldXRyYWwgdmF1bHQsIGhvd2V2ZXIgdGhhdCBjYW5ub3QgYmUgdW5kb25lDQogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfbmV3T3duZXIpIG9ubHlPd25lciB7DQogICAgICAgIG93bmVyID0gX25ld093bmVyOw0KICAgIH0NCn0NCg0KDQovLy8gQGRldiBUaGlzIGlzIGRlc2lnbmVkIHRvIGNvbnRyb2wgdGhlIGlzc3VhbmNlIG9mIGEgTWluaU1lIFRva2VuIGZvciBhDQovLy8gIG5vbi1wcm9maXQgQ2FtcGFpZ24uIFRoaXMgY29udHJhY3QgZWZmZWN0aXZlbHkgZGljdGF0ZXMgdGhlIHRlcm1zIG9mIHRoZQ0KLy8vICBmdW5kaW5nIHJvdW5kLg0KDQpjb250cmFjdCBHaXZldGhDYW1wYWlnbiBpcyBUb2tlbkNvbnRyb2xsZXIsIE93bmVkIHsNCg0KICAgIHVpbnQgcHVibGljIHN0YXJ0RnVuZGluZ1RpbWU7ICAgICAgIC8vIEluIFVOSVggVGltZSBGb3JtYXQNCiAgICB1aW50IHB1YmxpYyBlbmRGdW5kaW5nVGltZTsgICAgICAgICAvLyBJbiBVTklYIFRpbWUgRm9ybWF0DQogICAgdWludCBwdWJsaWMgbWF4aW11bUZ1bmRpbmc7ICAgICAgICAgLy8gSW4gd2VpDQogICAgdWludCBwdWJsaWMgdG90YWxDb2xsZWN0ZWQ7ICAgICAgICAgLy8gSW4gd2VpDQogICAgTWluaU1lVG9rZW4gcHVibGljIHRva2VuQ29udHJhY3Q7ICAgLy8gVGhlIG5ldyB0b2tlbiBmb3IgdGhpcyBDYW1wYWlnbg0KICAgIGFkZHJlc3MgcHVibGljIHZhdWx0QWRkcmVzczsgICAgICAgIC8vIFRoZSBhZGRyZXNzIHRvIGhvbGQgdGhlIGZ1bmRzIGRvbmF0ZWQNCg0KLy8vIEBub3RpY2UgJ0dpdmV0aENhbXBhaWduKCknIGluaXRpYXRlcyB0aGUgQ2FtcGFpZ24gYnkgc2V0dGluZyBpdHMgZnVuZGluZw0KLy8vIHBhcmFtZXRlcnMNCi8vLyBAZGV2IFRoZXJlIGFyZSBzZXZlcmFsIGNoZWNrcyB0byBtYWtlIHN1cmUgdGhlIHBhcmFtZXRlcnMgYXJlIGFjY2VwdGFibGUNCi8vLyBAcGFyYW0gX3N0YXJ0RnVuZGluZ1RpbWUgVGhlIFVOSVggdGltZSB0aGF0IHRoZSBDYW1wYWlnbiB3aWxsIGJlIGFibGUgdG8NCi8vLyBzdGFydCByZWNlaXZpbmcgZnVuZHMNCi8vLyBAcGFyYW0gX2VuZEZ1bmRpbmdUaW1lIFRoZSBVTklYIHRpbWUgdGhhdCB0aGUgQ2FtcGFpZ24gd2lsbCBzdG9wIGJlaW5nIGFibGUNCi8vLyB0byByZWNlaXZlIGZ1bmRzDQovLy8gQHBhcmFtIF9tYXhpbXVtRnVuZGluZyBJbiB3ZWksIHRoZSBNYXhpbXVtIGFtb3VudCB0aGF0IHRoZSBDYW1wYWlnbiBjYW4NCi8vLyByZWNlaXZlIChjdXJyZW50bHkgdGhlIG1heCBpcyBzZXQgYXQgMTAsMDAwIEVUSCBmb3IgdGhlIGJldGEpDQovLy8gQHBhcmFtIF92YXVsdEFkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHN0b3JlIHRoZSBkb25hdGVkIGZ1bmRzDQovLy8gQHBhcmFtIF90b2tlbkFkZHJlc3MgQWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhpcyBjb250cmFjdCBjb250cm9scw0KDQogICAgZnVuY3Rpb24gR2l2ZXRoQ2FtcGFpZ24oDQogICAgICAgIHVpbnQgX3N0YXJ0RnVuZGluZ1RpbWUsDQogICAgICAgIHVpbnQgX2VuZEZ1bmRpbmdUaW1lLA0KICAgICAgICB1aW50IF9tYXhpbXVtRnVuZGluZywNCiAgICAgICAgYWRkcmVzcyBfdmF1bHRBZGRyZXNzLA0KICAgICAgICBhZGRyZXNzIF90b2tlbkFkZHJlc3MNCg0KICAgICkgew0KICAgICAgICBpZiAoKF9lbmRGdW5kaW5nVGltZSA8IG5vdykgfHwgICAgICAgICAgICAgICAgLy8gQ2Fubm90IGVuZCBpbiB0aGUgcGFzdA0KICAgICAgICAgICAgKF9lbmRGdW5kaW5nVGltZSA8PSBfc3RhcnRGdW5kaW5nVGltZSkgfHwNCiAgICAgICAgICAgIChfbWF4aW11bUZ1bmRpbmcgPiAxMDAwMCBldGhlcikgfHwgICAgICAgIC8vIFRoZSBCZXRhIGlzIGxpbWl0ZWQNCiAgICAgICAgICAgIChfdmF1bHRBZGRyZXNzID09IDApKSAgICAgICAgICAgICAgICAgICAgIC8vIFRvIHByZXZlbnQgYnVybmluZyBFVEgNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgICAgfQ0KICAgICAgICBzdGFydEZ1bmRpbmdUaW1lID0gX3N0YXJ0RnVuZGluZ1RpbWU7DQogICAgICAgIGVuZEZ1bmRpbmdUaW1lID0gX2VuZEZ1bmRpbmdUaW1lOw0KICAgICAgICBtYXhpbXVtRnVuZGluZyA9IF9tYXhpbXVtRnVuZGluZzsNCiAgICAgICAgdG9rZW5Db250cmFjdCA9IE1pbmlNZVRva2VuKF90b2tlbkFkZHJlc3MpOy8vIFRoZSBEZXBsb3llZCBUb2tlbiBDb250cmFjdA0KICAgICAgICB2YXVsdEFkZHJlc3MgPSBfdmF1bHRBZGRyZXNzOw0KICAgIH0NCg0KLy8vIEBkZXYgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIGV0aGVyIGlzIHNlbnQgdG8gdGhlIGNvbnRyYWN0LCBpdA0KLy8vIHNpbXBseSBjYWxscyBgZG9QYXltZW50KClgIHdpdGggdGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciBhcyB0aGUNCi8vLyBgX293bmVyYC4gUGF5YWJsZSBpcyBhIHJlcXVpcmVkIHNvbGlkaXR5IG1vZGlmaWVyIGZvciBmdW5jdGlvbnMgdG8gcmVjZWl2ZQ0KLy8vIGV0aGVyLCB3aXRob3V0IHRoaXMgbW9kaWZpZXIgZnVuY3Rpb25zIHdpbGwgdGhyb3cgaWYgZXRoZXIgaXMgc2VudCB0byB0aGVtDQoNCiAgICBmdW5jdGlvbiAoKSAgcGF5YWJsZSB7DQogICAgICAgIGRvUGF5bWVudChtc2cuc2VuZGVyKTsNCiAgICB9DQoNCi8vLy8vLy8vLy8vLy8vLy8vDQovLyBUb2tlbkNvbnRyb2xsZXIgaW50ZXJmYWNlDQovLy8vLy8vLy8vLy8vLy8vLw0KDQovLy8gQG5vdGljZSBgcHJveHlQYXltZW50KClgIGFsbG93cyB0aGUgY2FsbGVyIHRvIHNlbmQgZXRoZXIgdG8gdGhlIENhbXBhaWduIGFuZA0KLy8vIGhhdmUgdGhlIHRva2VucyBjcmVhdGVkIGluIGFuIGFkZHJlc3Mgb2YgdGhlaXIgY2hvb3NpbmcNCi8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSBuZXdseSBjcmVhdGVkIHRva2Vucw0KDQogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHJldHVybnMoYm9vbCkgew0KICAgICAgICBkb1BheW1lbnQoX293bmVyKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQovLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRyYW5zZmVyLCBmb3IgdGhpcyBDYW1wYWlnbiBhbGwNCi8vLyAgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGJ5IGRlZmF1bHQgYW5kIG5vIGV4dHJhIG5vdGlmaWNhdGlvbnMgYXJlIG5lZWRlZA0KLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2Zlcg0KLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2Zlcg0KLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyDQovLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyDQogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQovLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCwgZm9yIHRoaXMgQ2FtcGFpZ24gYWxsDQovLy8gIGFwcHJvdmFscyBhcmUgYWxsb3dlZCBieSBkZWZhdWx0IGFuZCBubyBleHRyYSBub3RpZmljYXRpb25zIGFyZSBuZWVkZWQNCi8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWANCi8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwNCi8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsDQovLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsDQogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpDQogICAgICAgIHJldHVybnMoYm9vbCkNCiAgICB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KDQovLy8gQGRldiBgZG9QYXltZW50KClgIGlzIGFuIGludGVybmFsIGZ1bmN0aW9uIHRoYXQgc2VuZHMgdGhlIGV0aGVyIHRoYXQgdGhpcw0KLy8vICBjb250cmFjdCByZWNlaXZlcyB0byB0aGUgYHZhdWx0YCBhbmQgY3JlYXRlcyB0b2tlbnMgaW4gdGhlIGFkZHJlc3Mgb2YgdGhlDQovLy8gIGBfb3duZXJgIGFzc3VtaW5nIHRoZSBDYW1wYWlnbiBpcyBzdGlsbCBhY2NlcHRpbmcgZnVuZHMNCi8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSBuZXdseSBjcmVhdGVkIHRva2Vucw0KDQogICAgZnVuY3Rpb24gZG9QYXltZW50KGFkZHJlc3MgX293bmVyKSBpbnRlcm5hbCB7DQoNCi8vIEZpcnN0IGNoZWNrIHRoYXQgdGhlIENhbXBhaWduIGlzIGFsbG93ZWQgdG8gcmVjZWl2ZSB0aGlzIGRvbmF0aW9uDQogICAgICAgIGlmICgobm93PHN0YXJ0RnVuZGluZ1RpbWUpIHx8DQogICAgICAgICAgICAobm93PmVuZEZ1bmRpbmdUaW1lKSB8fA0KICAgICAgICAgICAgKHRva2VuQ29udHJhY3QuY29udHJvbGxlcigpID09IDApIHx8ICAgICAgICAgICAvLyBFeHRyYSBjaGVjaw0KICAgICAgICAgICAgKG1zZy52YWx1ZSA9PSAwKSB8fA0KICAgICAgICAgICAgKHRvdGFsQ29sbGVjdGVkICsgbXNnLnZhbHVlID4gbWF4aW11bUZ1bmRpbmcpKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KDQovL1RyYWNrIGhvdyBtdWNoIHRoZSBDYW1wYWlnbiBoYXMgY29sbGVjdGVkDQogICAgICAgIHRvdGFsQ29sbGVjdGVkICs9IG1zZy52YWx1ZTsNCg0KLy9TZW5kIHRoZSBldGhlciB0byB0aGUgdmF1bHQNCiAgICAgICAgaWYgKCF2YXVsdEFkZHJlc3Muc2VuZChtc2cudmFsdWUpKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KDQovLyBDcmVhdGVzIGFuIGVxdWFsIGFtb3VudCBvZiB0b2tlbnMgYXMgZXRoZXIgc2VudC4gVGhlIG5ldyB0b2tlbnMgYXJlIGNyZWF0ZWQNCi8vICBpbiB0aGUgYF9vd25lcmAgYWRkcmVzcw0KICAgICAgICBpZiAoIXRva2VuQ29udHJhY3QuZ2VuZXJhdGVUb2tlbnMoX293bmVyLCBtc2cudmFsdWUpKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCi8vLyBAbm90aWNlIGBmaW5hbGl6ZUZ1bmRpbmcoKWAgZW5kcyB0aGUgQ2FtcGFpZ24gYnkgY2FsbGluZyBzZXR0aW5nIHRoZQ0KLy8vICBjb250cm9sbGVyIHRvIDAsIHRoZXJlYnkgZW5kaW5nIHRoZSBpc3N1YW5jZSBvZiBuZXcgdG9rZW5zIGFuZCBzdG9wcGluZyB0aGUNCi8vLyAgQ2FtcGFpZ24gZnJvbSByZWNlaXZpbmcgbW9yZSBldGhlcg0KLy8vIEBkZXYgYGZpbmFsaXplRnVuZGluZygpYCBjYW4gb25seSBiZSBjYWxsZWQgYWZ0ZXIgdGhlIGVuZCBvZiB0aGUgZnVuZGluZyBwZXJpb2QuDQoNCiAgICBmdW5jdGlvbiBmaW5hbGl6ZUZ1bmRpbmcoKSB7DQogICAgICAgIGlmIChub3cgPCBlbmRGdW5kaW5nVGltZSkgdGhyb3c7DQogICAgICAgIHRva2VuQ29udHJhY3QuY2hhbmdlQ29udHJvbGxlcigwKTsNCiAgICB9DQoNCg0KLy8vIEBub3RpY2UgYG9ubHlPd25lcmAgY2hhbmdlcyB0aGUgbG9jYXRpb24gdGhhdCBldGhlciBpcyBzZW50DQovLy8gQHBhcmFtIF9uZXdWYXVsdEFkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIGV0aGVyIHNlbnQgdG8gdGhpcw0KLy8vICBDYW1wYWlnbg0KICAgIGZ1bmN0aW9uIHNldFZhdWx0KGFkZHJlc3MgX25ld1ZhdWx0QWRkcmVzcykgb25seU93bmVyIHsNCiAgICAgICAgdmF1bHRBZGRyZXNzID0gX25ld1ZhdWx0QWRkcmVzczsNCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vDQogICAgLy8gU2FmZXR5IE1ldGhvZHMNCiAgICAvLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkNCiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuDQogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3Zlcg0KICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLg0KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsNCiAgICAgICAgaWYgKHRva2VuQ29udHJhY3QuY29udHJvbGxlcigpID09IGFkZHJlc3ModGhpcykpIHsNCiAgICAgICAgICAgIHRva2VuQ29udHJhY3QuY2xhaW1Ub2tlbnMoX3Rva2VuKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX3Rva2VuID09IDB4MCkgew0KICAgICAgICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIEVSQzIwVG9rZW4gdG9rZW4gPSBFUkMyMFRva2VuKF90b2tlbik7DQogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsNCiAgICAgICAgdG9rZW4udHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOw0KICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgb3duZXIsIGJhbGFuY2UpOw0KICAgIH0NCg0KICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50IF9hbW91bnQpOw0KDQp9'