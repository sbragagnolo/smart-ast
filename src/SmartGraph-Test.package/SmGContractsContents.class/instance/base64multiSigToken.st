base 64 content
base64multiSigToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KDQpjb250cmFjdCBvd25lZCB7DQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCiAgICBmdW5jdGlvbiBvd25lZCgpIHsNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG9ubHlPd25lciB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgew0KICAgICAgICBvd25lciA9IG5ld093bmVyOw0KICAgIH0NCn0NCg0KLy8vIEB0aXRsZSBNdWx0aXNpZ25hdHVyZSB3YWxsZXQgLSBBbGxvd3MgbXVsdGlwbGUgcGFydGllcyB0byBhZ3JlZSBvbiB0cmFuc2FjdGlvbnMgYmVmb3JlIGV4ZWN1dGlvbi4NCi8vLyBAYXV0aG9yIFN0ZWZhbiBHZW9yZ2UgLSA8c3RlZmFuLmdlb3JnZUBjb25zZW5zeXMubmV0Pg0KY29udHJhY3QgTXVsdGlTaWcgaXMgb3duZWQgew0KICAgIHVpbnQgY29uc3RhbnQgcHVibGljIE1BWF9PV05FUl9DT1VOVCA9IDUwOw0KDQogICAgZXZlbnQgQ29uZmlybWF0aW9uKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsNCiAgICBldmVudCBSZXZvY2F0aW9uKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsNCiAgICBldmVudCBTdWJtaXNzaW9uKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsNCiAgICBldmVudCBFeGVjdXRpb24odWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOw0KICAgIGV2ZW50IEV4ZWN1dGlvbkZhaWx1cmUodWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOw0KICAgIGV2ZW50IERlcG9zaXQoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCB2YWx1ZSk7DQogICAgZXZlbnQgT3duZXJBZGRpdGlvbihhZGRyZXNzIGluZGV4ZWQgb3duZXIpOw0KICAgIGV2ZW50IE93bmVyUmVtb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIpOw0KICAgIGV2ZW50IFJlcXVpcmVtZW50Q2hhbmdlKHVpbnQgcmVxdWlyZWQpOw0KDQogICAgbWFwcGluZyAodWludCA9PiBUcmFuc2FjdGlvbikgcHVibGljIHRyYW5zYWN0aW9uczsNCiAgICBtYXBwaW5nICh1aW50ID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkpIHB1YmxpYyBjb25maXJtYXRpb25zOw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzT3duZXI7DQogICAgYWRkcmVzc1tdIHB1YmxpYyBvd25lcnM7DQogICAgdWludCBwdWJsaWMgcmVxdWlyZWQ7DQogICAgdWludCBwdWJsaWMgdHJhbnNhY3Rpb25Db3VudDsNCg0KICAgIHN0cnVjdCBUcmFuc2FjdGlvbiB7DQogICAgICAgIGFkZHJlc3MgZGVzdGluYXRpb247DQogICAgICAgIHVpbnQgdmFsdWU7DQogICAgICAgIGJ5dGVzIGRhdGE7DQogICAgICAgIGJvb2wgZXhlY3V0ZWQ7DQogICAgfQ0KDQogICAgbW9kaWZpZXIgb25seVdhbGxldCgpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyh0aGlzKSkNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG93bmVyRG9lc05vdEV4aXN0KGFkZHJlc3Mgb3duZXIpIHsNCiAgICAgICAgaWYgKGlzT3duZXJbb3duZXJdKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgb3duZXJFeGlzdHMoYWRkcmVzcyBvd25lcikgew0KICAgICAgICBpZiAoIWlzT3duZXJbb3duZXJdKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgdHJhbnNhY3Rpb25FeGlzdHModWludCB0cmFuc2FjdGlvbklkKSB7DQogICAgICAgIGlmICh0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0uZGVzdGluYXRpb24gPT0gMCkNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIGNvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQsIGFkZHJlc3Mgb3duZXIpIHsNCiAgICAgICAgaWYgKCFjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyXSkNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG5vdENvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQsIGFkZHJlc3Mgb3duZXIpIHsNCiAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJdKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgbm90RXhlY3V0ZWQodWludCB0cmFuc2FjdGlvbklkKSB7DQogICAgICAgIGlmICh0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0uZXhlY3V0ZWQpDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBub3ROdWxsKGFkZHJlc3MgX2FkZHJlc3MpIHsNCiAgICAgICAgaWYgKF9hZGRyZXNzID09IDApDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciB2YWxpZFJlcXVpcmVtZW50KHVpbnQgb3duZXJDb3VudCwgdWludCBfcmVxdWlyZWQpIHsNCiAgICAgICAgaWYgKCAgIG93bmVyQ291bnQgPiBNQVhfT1dORVJfQ09VTlQNCiAgICAgICAgICAgIHx8IF9yZXF1aXJlZCA+IG93bmVyQ291bnQNCiAgICAgICAgICAgIHx8IF9yZXF1aXJlZCA9PSAwDQogICAgICAgICAgICB8fCBvd25lckNvdW50ID09IDApDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIFB1YmxpYyBmdW5jdGlvbnMNCiAgICAgKi8NCiAgICAvLy8gQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBzZXRzIGluaXRpYWwgb3duZXJzIGFuZCByZXF1aXJlZCBudW1iZXIgb2YgY29uZmlybWF0aW9ucy4NCiAgICAvLy8gQHBhcmFtIF9vd25lcnMgTGlzdCBvZiBpbml0aWFsIG93bmVycy4NCiAgICAvLy8gQHBhcmFtIF9yZXF1aXJlZCBOdW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4NCiAgICBmdW5jdGlvbiBNdWx0aVNpZyhhZGRyZXNzW10gX293bmVycywgdWludCBfcmVxdWlyZWQpDQogICAgICAgIHB1YmxpYw0KICAgICAgICB2YWxpZFJlcXVpcmVtZW50KF9vd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpDQogICAgew0KICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPF9vd25lcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmIChpc093bmVyW19vd25lcnNbaV1dIHx8IF9vd25lcnNbaV0gPT0gMCkNCiAgICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgIGlzT3duZXJbX293bmVyc1tpXV0gPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIG93bmVycyA9IF9vd25lcnM7DQogICAgICAgIHJlcXVpcmVkID0gX3JlcXVpcmVkOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IEFsbG93cyB0byBhZGQgYSBuZXcgb3duZXIuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4NCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2YgbmV3IG93bmVyLg0KICAgIGZ1bmN0aW9uIGFkZE93bmVyKGFkZHJlc3Mgb3duZXIpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBvbmx5V2FsbGV0DQogICAgICAgIG93bmVyRG9lc05vdEV4aXN0KG93bmVyKQ0KICAgICAgICBub3ROdWxsKG93bmVyKQ0KICAgICAgICB2YWxpZFJlcXVpcmVtZW50KG93bmVycy5sZW5ndGggKyAxLCByZXF1aXJlZCkNCiAgICB7DQogICAgICAgIGlzT3duZXJbb3duZXJdID0gdHJ1ZTsNCiAgICAgICAgb3duZXJzLnB1c2gob3duZXIpOw0KDQogICAgICAgIGNoYW5nZVJlcXVpcmVtZW50KG93bmVycy5sZW5ndGggLyAyICsgMSk7DQoNCiAgICAgICAgT3duZXJBZGRpdGlvbihvd25lcik7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHJlbW92ZSBhbiBvd25lci4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0Lg0KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBvd25lci4NCiAgICBmdW5jdGlvbiByZW1vdmVPd25lcihhZGRyZXNzIG93bmVyKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgb25seVdhbGxldA0KICAgICAgICBvd25lckV4aXN0cyhvd25lcikNCiAgICB7DQogICAgICAgIGlzT3duZXJbb3duZXJdID0gZmFsc2U7DQogICAgICAgIGZvciAodWludCBpPTA7IGk8b3duZXJzLmxlbmd0aCAtIDE7IGkrKykNCiAgICAgICAgICAgIGlmIChvd25lcnNbaV0gPT0gb3duZXIpIHsNCiAgICAgICAgICAgICAgICBvd25lcnNbaV0gPSBvd25lcnNbb3duZXJzLmxlbmd0aCAtIDFdOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICBvd25lcnMubGVuZ3RoIC09IDE7DQoNCiAgICAgICAgLy9pZiAocmVxdWlyZWQgPiBvd25lcnMubGVuZ3RoKQ0KICAgICAgICAvLyAgICBjaGFuZ2VSZXF1aXJlbWVudChvd25lcnMubGVuZ3RoKTsNCiAgICAgICAgY2hhbmdlUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCAvIDIgKyAxKTsNCiAgICAgICAgT3duZXJSZW1vdmFsKG93bmVyKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gcmVwbGFjZSBhbiBvd25lciB3aXRoIGEgbmV3IG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuDQogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG93bmVyIHRvIGJlIHJlcGxhY2VkLg0KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBuZXcgb3duZXIuDQogICAgZnVuY3Rpb24gcmVwbGFjZU93bmVyKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgbmV3T3duZXIpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBvbmx5V2FsbGV0DQogICAgICAgIG93bmVyRXhpc3RzKG93bmVyKQ0KICAgICAgICBvd25lckRvZXNOb3RFeGlzdChuZXdPd25lcikNCiAgICB7DQogICAgICAgIGZvciAodWludCBpPTA7IGk8b3duZXJzLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgaWYgKG93bmVyc1tpXSA9PSBvd25lcikgew0KICAgICAgICAgICAgICAgIG93bmVyc1tpXSA9IG5ld093bmVyOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICBpc093bmVyW293bmVyXSA9IGZhbHNlOw0KICAgICAgICBpc093bmVyW25ld093bmVyXSA9IHRydWU7DQogICAgICAgIE93bmVyUmVtb3ZhbChvd25lcik7DQogICAgICAgIE93bmVyQWRkaXRpb24obmV3T3duZXIpOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IEFsbG93cyB0byBjaGFuZ2UgdGhlIG51bWJlciBvZiByZXF1aXJlZCBjb25maXJtYXRpb25zLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuDQogICAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuDQogICAgZnVuY3Rpb24gY2hhbmdlUmVxdWlyZW1lbnQodWludCBfcmVxdWlyZWQpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBvbmx5V2FsbGV0DQogICAgICAgIHZhbGlkUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCwgX3JlcXVpcmVkKQ0KICAgIHsNCiAgICAgICAgcmVxdWlyZWQgPSBfcmVxdWlyZWQ7DQogICAgICAgIFJlcXVpcmVtZW50Q2hhbmdlKF9yZXF1aXJlZCk7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgQWxsb3dzIGFuIG93bmVyIHRvIHN1Ym1pdCBhbmQgY29uZmlybSBhIHRyYW5zYWN0aW9uLg0KICAgIC8vLyBAcGFyYW0gZGVzdGluYXRpb24gVHJhbnNhY3Rpb24gdGFyZ2V0IGFkZHJlc3MuDQogICAgLy8vIEBwYXJhbSB2YWx1ZSBUcmFuc2FjdGlvbiBldGhlciB2YWx1ZS4NCiAgICAvLy8gQHBhcmFtIGRhdGEgVHJhbnNhY3Rpb24gZGF0YSBwYXlsb2FkLg0KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgdHJhbnNhY3Rpb24gSUQuDQogICAgZnVuY3Rpb24gc3VibWl0VHJhbnNhY3Rpb24oYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkNCiAgICAgICAgcHVibGljDQogICAgICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpDQogICAgICAgIHJldHVybnMgKHVpbnQgdHJhbnNhY3Rpb25JZCkNCiAgICB7DQogICAgICAgIHRyYW5zYWN0aW9uSWQgPSBhZGRUcmFuc2FjdGlvbihkZXN0aW5hdGlvbiwgdmFsdWUsIGRhdGEpOw0KICAgICAgICBjb25maXJtVHJhbnNhY3Rpb24odHJhbnNhY3Rpb25JZCk7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgQWxsb3dzIGFuIG93bmVyIHRvIGNvbmZpcm0gYSB0cmFuc2FjdGlvbi4NCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuDQogICAgZnVuY3Rpb24gY29uZmlybVRyYW5zYWN0aW9uKHVpbnQgdHJhbnNhY3Rpb25JZCkNCiAgICAgICAgcHVibGljDQogICAgICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpDQogICAgICAgIHRyYW5zYWN0aW9uRXhpc3RzKHRyYW5zYWN0aW9uSWQpDQogICAgICAgIG5vdENvbmZpcm1lZCh0cmFuc2FjdGlvbklkLCBtc2cuc2VuZGVyKQ0KICAgIHsNCiAgICAgICAgY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVttc2cuc2VuZGVyXSA9IHRydWU7DQogICAgICAgIENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCB0cmFuc2FjdGlvbklkKTsNCiAgICAgICAgZXhlY3V0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byByZXZva2UgYSBjb25maXJtYXRpb24gZm9yIGEgdHJhbnNhY3Rpb24uDQogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELg0KICAgIGZ1bmN0aW9uIHJldm9rZUNvbmZpcm1hdGlvbih1aW50IHRyYW5zYWN0aW9uSWQpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBvd25lckV4aXN0cyhtc2cuc2VuZGVyKQ0KICAgICAgICBjb25maXJtZWQodHJhbnNhY3Rpb25JZCwgbXNnLnNlbmRlcikNCiAgICAgICAgbm90RXhlY3V0ZWQodHJhbnNhY3Rpb25JZCkNCiAgICB7DQogICAgICAgIGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bbXNnLnNlbmRlcl0gPSBmYWxzZTsNCiAgICAgICAgUmV2b2NhdGlvbihtc2cuc2VuZGVyLCB0cmFuc2FjdGlvbklkKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBBbGxvd3MgYW55b25lIHRvIGV4ZWN1dGUgYSBjb25maXJtZWQgdHJhbnNhY3Rpb24uDQogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELg0KICAgIGZ1bmN0aW9uIGV4ZWN1dGVUcmFuc2FjdGlvbih1aW50IHRyYW5zYWN0aW9uSWQpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBub3RFeGVjdXRlZCh0cmFuc2FjdGlvbklkKQ0KICAgIHsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBjb25maXJtYXRpb24gc3RhdHVzIG9mIGEgdHJhbnNhY3Rpb24uDQogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELg0KICAgIC8vLyBAcmV0dXJuIENvbmZpcm1hdGlvbiBzdGF0dXMuDQogICAgZnVuY3Rpb24gaXNDb25maXJtZWQodWludCB0cmFuc2FjdGlvbklkKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIHVpbnQgY291bnQgPSAwOw0KICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPG93bmVycy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkNCiAgICAgICAgICAgICAgICBjb3VudCArPSAxOw0KICAgICAgICAgICAgaWYgKGNvdW50ID09IHJlcXVpcmVkKQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBJbnRlcm5hbCBmdW5jdGlvbnMNCiAgICAgKi8NCiAgICAvLy8gQGRldiBBZGRzIGEgbmV3IHRyYW5zYWN0aW9uIHRvIHRoZSB0cmFuc2FjdGlvbiBtYXBwaW5nLCBpZiB0cmFuc2FjdGlvbiBkb2VzIG5vdCBleGlzdCB5ZXQuDQogICAgLy8vIEBwYXJhbSBkZXN0aW5hdGlvbiBUcmFuc2FjdGlvbiB0YXJnZXQgYWRkcmVzcy4NCiAgICAvLy8gQHBhcmFtIHZhbHVlIFRyYW5zYWN0aW9uIGV0aGVyIHZhbHVlLg0KICAgIC8vLyBAcGFyYW0gZGF0YSBUcmFuc2FjdGlvbiBkYXRhIHBheWxvYWQuDQogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0cmFuc2FjdGlvbiBJRC4NCiAgICBmdW5jdGlvbiBhZGRUcmFuc2FjdGlvbihhZGRyZXNzIGRlc3RpbmF0aW9uLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKQ0KICAgICAgICBpbnRlcm5hbA0KICAgICAgICBub3ROdWxsKGRlc3RpbmF0aW9uKQ0KICAgICAgICByZXR1cm5zICh1aW50IHRyYW5zYWN0aW9uSWQpDQogICAgew0KICAgICAgICB0cmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25Db3VudDsNCiAgICAgICAgdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdID0gVHJhbnNhY3Rpb24oew0KICAgICAgICAgICAgZGVzdGluYXRpb246IGRlc3RpbmF0aW9uLA0KICAgICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgICAgZGF0YTogZGF0YSwNCiAgICAgICAgICAgIGV4ZWN1dGVkOiBmYWxzZQ0KICAgICAgICB9KTsNCiAgICAgICAgdHJhbnNhY3Rpb25Db3VudCArPSAxOw0KICAgICAgICBTdWJtaXNzaW9uKHRyYW5zYWN0aW9uSWQpOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogV2ViMyBjYWxsIGZ1bmN0aW9ucw0KICAgICAqLw0KICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMgb2YgYSB0cmFuc2FjdGlvbi4NCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuDQogICAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMuDQogICAgZnVuY3Rpb24gZ2V0Q29uZmlybWF0aW9uQ291bnQodWludCB0cmFuc2FjdGlvbklkKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAodWludCBjb3VudCkNCiAgICB7DQogICAgICAgIGZvciAodWludCBpPTA7IGk8b3duZXJzLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkNCiAgICAgICAgICAgICAgICBjb3VudCArPSAxOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFJldHVybnMgdG90YWwgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBhZnRlciBmaWxlcnMgYXJlIGFwcGxpZWQuDQogICAgLy8vIEBwYXJhbSBwZW5kaW5nIEluY2x1ZGUgcGVuZGluZyB0cmFuc2FjdGlvbnMuDQogICAgLy8vIEBwYXJhbSBleGVjdXRlZCBJbmNsdWRlIGV4ZWN1dGVkIHRyYW5zYWN0aW9ucy4NCiAgICAvLy8gQHJldHVybiBUb3RhbCBudW1iZXIgb2YgdHJhbnNhY3Rpb25zIGFmdGVyIGZpbHRlcnMgYXJlIGFwcGxpZWQuDQogICAgZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25Db3VudChib29sIHBlbmRpbmcsIGJvb2wgZXhlY3V0ZWQpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBjb25zdGFudA0KICAgICAgICByZXR1cm5zICh1aW50IGNvdW50KQ0KICAgIHsNCiAgICAgICAgZm9yICh1aW50IGk9MDsgaTx0cmFuc2FjdGlvbkNvdW50OyBpKyspDQogICAgICAgICAgICBpZiAoICAgcGVuZGluZyAmJiAhdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkDQogICAgICAgICAgICAgICAgfHwgZXhlY3V0ZWQgJiYgdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKQ0KICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIG93bmVycy4NCiAgICAvLy8gQHJldHVybiBMaXN0IG9mIG93bmVyIGFkZHJlc3Nlcy4NCiAgICBmdW5jdGlvbiBnZXRPd25lcnMoKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAoYWRkcmVzc1tdKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuIG93bmVyczsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBSZXR1cm5zIGFycmF5IHdpdGggb3duZXIgYWRkcmVzc2VzLCB3aGljaCBjb25maXJtZWQgdHJhbnNhY3Rpb24uDQogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELg0KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYXJyYXkgb2Ygb3duZXIgYWRkcmVzc2VzLg0KICAgIGZ1bmN0aW9uIGdldENvbmZpcm1hdGlvbnModWludCB0cmFuc2FjdGlvbklkKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAoYWRkcmVzc1tdIF9jb25maXJtYXRpb25zKQ0KICAgIHsNCiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBjb25maXJtYXRpb25zVGVtcCA9IG5ldyBhZGRyZXNzW10ob3duZXJzLmxlbmd0aCk7DQogICAgICAgIHVpbnQgY291bnQgPSAwOw0KICAgICAgICB1aW50IGk7DQogICAgICAgIGZvciAoaT0wOyBpPG93bmVycy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyc1tpXV0pIHsNCiAgICAgICAgICAgICAgICBjb25maXJtYXRpb25zVGVtcFtjb3VudF0gPSBvd25lcnNbaV07DQogICAgICAgICAgICAgICAgY291bnQgKz0gMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgX2NvbmZpcm1hdGlvbnMgPSBuZXcgYWRkcmVzc1tdKGNvdW50KTsNCiAgICAgICAgZm9yIChpPTA7IGk8Y291bnQ7IGkrKykNCiAgICAgICAgICAgIF9jb25maXJtYXRpb25zW2ldID0gY29uZmlybWF0aW9uc1RlbXBbaV07DQogICAgfQ0KDQogICAgLy8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIHRyYW5zYWN0aW9uIElEcyBpbiBkZWZpbmVkIHJhbmdlLg0KICAgIC8vLyBAcGFyYW0gZnJvbSBJbmRleCBzdGFydCBwb3NpdGlvbiBvZiB0cmFuc2FjdGlvbiBhcnJheS4NCiAgICAvLy8gQHBhcmFtIHRvIEluZGV4IGVuZCBwb3NpdGlvbiBvZiB0cmFuc2FjdGlvbiBhcnJheS4NCiAgICAvLy8gQHBhcmFtIHBlbmRpbmcgSW5jbHVkZSBwZW5kaW5nIHRyYW5zYWN0aW9ucy4NCiAgICAvLy8gQHBhcmFtIGV4ZWN1dGVkIEluY2x1ZGUgZXhlY3V0ZWQgdHJhbnNhY3Rpb25zLg0KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYXJyYXkgb2YgdHJhbnNhY3Rpb24gSURzLg0KICAgIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uSWRzKHVpbnQgZnJvbSwgdWludCB0bywgYm9vbCBwZW5kaW5nLCBib29sIGV4ZWN1dGVkKQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgcmV0dXJucyAodWludFtdIF90cmFuc2FjdGlvbklkcykNCiAgICB7DQogICAgICAgIHVpbnRbXSBtZW1vcnkgdHJhbnNhY3Rpb25JZHNUZW1wID0gbmV3IHVpbnRbXSh0cmFuc2FjdGlvbkNvdW50KTsNCiAgICAgICAgdWludCBjb3VudCA9IDA7DQogICAgICAgIHVpbnQgaTsNCiAgICAgICAgZm9yIChpPTA7IGk8dHJhbnNhY3Rpb25Db3VudDsgaSsrKQ0KICAgICAgICAgICAgaWYgKCAgIHBlbmRpbmcgJiYgIXRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZA0KICAgICAgICAgICAgICAgIHx8IGV4ZWN1dGVkICYmIHRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbklkc1RlbXBbY291bnRdID0gaTsNCiAgICAgICAgICAgICAgICBjb3VudCArPSAxOw0KICAgICAgICAgICAgfQ0KICAgICAgICBfdHJhbnNhY3Rpb25JZHMgPSBuZXcgdWludFtdKHRvIC0gZnJvbSk7DQogICAgICAgIGZvciAoaT1mcm9tOyBpPHRvOyBpKyspDQogICAgICAgICAgICBfdHJhbnNhY3Rpb25JZHNbaSAtIGZyb21dID0gdHJhbnNhY3Rpb25JZHNUZW1wW2ldOw0KICAgIH0NCn0NCg0KY29udHJhY3QgTXVsdGlTaWdXYWxsZXQgaXMgTXVsdGlTaWcgew0KICAgIGZ1bmN0aW9uIE11bHRpU2lnV2FsbGV0KGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkNCiAgICAgICAgcHVibGljDQogICAgICAgIE11bHRpU2lnKCBfb3duZXJzLCBfcmVxdWlyZWQpDQogICAgeyAgICANCiAgICB9DQoNCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiBhbGxvd3MgdG8gZGVwb3NpdCBldGhlci4NCiAgICBmdW5jdGlvbigpDQogICAgICAgIHBheWFibGUNCiAgICB7DQogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKQ0KICAgICAgICAgICAgRGVwb3NpdChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IEFsbG93cyBhbnlvbmUgdG8gZXhlY3V0ZSBhIGNvbmZpcm1lZCB0cmFuc2FjdGlvbi4NCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuDQogICAgZnVuY3Rpb24gZXhlY3V0ZVRyYW5zYWN0aW9uKHVpbnQgdHJhbnNhY3Rpb25JZCkNCiAgICAgICAgcHVibGljDQogICAgICAgIG5vdEV4ZWN1dGVkKHRyYW5zYWN0aW9uSWQpDQogICAgew0KICAgICAgICBpZiAoaXNDb25maXJtZWQodHJhbnNhY3Rpb25JZCkpIHsNCiAgICAgICAgICAgIFRyYW5zYWN0aW9uIHR4ID0gdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdOw0KDQogICAgICAgICAgICBpZiAodHguZGVzdGluYXRpb24uY2FsbC52YWx1ZSh0eC52YWx1ZSkodHguZGF0YSkpIHsNCiAgICAgICAgICAgICAgICB0eC5leGVjdXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgRXhlY3V0aW9uKHRyYW5zYWN0aW9uSWQpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBFeGVjdXRpb25GYWlsdXJlKHRyYW5zYWN0aW9uSWQpOw0KICAgICAgICAgICAgICAgIHR4LmV4ZWN1dGVkID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQoNCg0KDQpjb250cmFjdCB0b2tlbiB7ZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7fQ0KDQpjb250cmFjdCBNdWx0aVNpZ1Rva2VuIGlzIE11bHRpU2lnIHsNCiAgICB0b2tlbiBwdWJsaWMgdG9rZW5GYWN0b3J5IDsNCg0KICAgIGZ1bmN0aW9uIE11bHRpU2lnVG9rZW4oYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3JlcXVpcmVkLCB0b2tlbiBfYWRkcmVzc09mVG9rZW5GYWN0b3J5KQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgTXVsdGlTaWcoIF9vd25lcnMsIF9yZXF1aXJlZCkNCiAgICB7ICAgIA0KICAgICAgICB0b2tlbkZhY3RvcnkgPSB0b2tlbihfYWRkcmVzc09mVG9rZW5GYWN0b3J5KTsNCiAgICB9DQoNCiAgICAvLyBAZGV2IFRoaXMgdW5uYW1lZCBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIgc29tZW9uZSB0cmllcyB0byBzZW5kIGV0aGVyIHRvIGl0IA0KICAgIGZ1bmN0aW9uKCkNCiAgICB7DQogICAgICAgIHRocm93OyAvLyBQcmV2ZW50cyBhY2NpZGVudGFsIHNlbmRpbmcgb2YgZXRoZXINCiAgICB9DQoNCiAgICAvLy8gQGRldiBBbGxvd3MgYW55b25lIHRvIGV4ZWN1dGUgYSBjb25maXJtZWQgdHJhbnNhY3Rpb24uDQogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELg0KICAgIGZ1bmN0aW9uIGV4ZWN1dGVUcmFuc2FjdGlvbih1aW50IHRyYW5zYWN0aW9uSWQpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBub3RFeGVjdXRlZCh0cmFuc2FjdGlvbklkKQ0KICAgIHsNCiAgICAgICAgaWYgKGlzQ29uZmlybWVkKHRyYW5zYWN0aW9uSWQpKSB7DQogICAgICAgICAgICBUcmFuc2FjdGlvbiB0eCA9IHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXTsNCg0KICAgICAgICAgICAgaWYgKHRva2VuRmFjdG9yeS50cmFuc2Zlcih0eC5kZXN0aW5hdGlvbiwgdHgudmFsdWUpKSB7DQogICAgICAgICAgICAgICAgdHguZXhlY3V0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIEV4ZWN1dGlvbih0cmFuc2FjdGlvbklkKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdHguZXhlY3V0ZWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBFeGVjdXRpb25GYWlsdXJlKHRyYW5zYWN0aW9uSWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ=='