base 64 content
base64multiVault4
	^'LyoqDQogKiBTYWZlIHVuc2lnbmVkIHNhZmUgbWF0aC4NCiAqDQogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQ0KICoNCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQXJhZ29uT25lL3plcHBlbGluLXNvbGlkaXR5L21hc3Rlci9jb250cmFjdHMvU2FmZU1hdGhMaWIuc29sDQogKg0KICogTWFpbnRhaW5lZCBoZXJlIHVudGlsIG1lcmdlZCB0byBtYWlubGluZSB6ZXBwZWxpbi1zb2xpZGl0eS4NCiAqDQogKi8NCmxpYnJhcnkgU2FmZU1hdGhMaWIgew0KDQogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gcGx1cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjPj1hICYmIGM+PWIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBwcml2YXRlIHsNCiAgICBpZiAoIWFzc2VydGlvbikgdGhyb3c7DQogIH0NCn0NCg0KDQoNCg0KLyoNCiAqIE93bmFibGUNCiAqDQogKiBCYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIuDQogKiBQcm92aWRlcyBvbmx5T3duZXIgbW9kaWZpZXIsIHdoaWNoIHByZXZlbnRzIGZ1bmN0aW9uIGZyb20gcnVubmluZyBpZiBpdCBpcyBjYWxsZWQgYnkgYW55b25lIG90aGVyIHRoYW4gdGhlIG93bmVyLg0KICovDQpjb250cmFjdCBPd25hYmxlIHsNCiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsNCiAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogIH0NCg0KICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICBfOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsNCiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgew0KICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICB9DQogIH0NCg0KfQ0KDQoNCi8qDQogKiBIYWx0YWJsZQ0KICoNCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbg0KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLg0KICoNCiAqDQogKiBPcmlnaW5hbGx5IGVudmlzaW9uZWQgaW4gRmlyc3RCbG9vZCBJQ08gY29udHJhY3QuDQogKi8NCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgew0KICBib29sIHB1YmxpYyBoYWx0ZWQ7DQoNCiAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsNCiAgICBpZiAoaGFsdGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsNCiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlDQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgew0KICAgIGhhbHRlZCA9IHRydWU7DQogIH0NCg0KICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlDQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgew0KICAgIGhhbHRlZCA9IGZhbHNlOw0KICB9DQoNCn0NCg0KDQovKioNCiAqIEludGVyZmFjZSBmb3IgZGVmaW5pbmcgY3Jvd2RzYWxlIHByaWNpbmcuDQogKi8NCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7DQoNCiAgLyoqIEludGVyZmFjZSBkZWNsYXJhdGlvbi4gKi8NCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFNlbGYgY2hlY2sgaWYgYWxsIHJlZmVyZW5jZXMgYXJlIGNvcnJlY3RseSBzZXQuDQogICAqDQogICAqIENoZWNrcyB0aGF0IHByaWNpbmcgc3RyYXRlZ3kgbWF0Y2hlcyBjcm93ZHNhbGUgcGFyYW1ldGVycy4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIGNyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0Lg0KICAgKg0KICAgKg0KICAgKiBAcGFyYW0gdmFsdWUgLSBXaGF0IGlzIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VuZCBpbiBhcyB3ZWkNCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXINCiAgICogQHBhcmFtIHdlaVJhaXNlZCAtIGhvdyBtdWNoIG1vbmV5IGhhcyBiZWVuIHJhaXNlZCB0aGlzIGZhcg0KICAgKiBAcGFyYW0gbXNnU2VuZGVyIC0gd2hvIGlzIHRoZSBpbnZlc3RvciBvZiB0aGlzIHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcw0KICAgKiBAcmV0dXJuIEFtb3VudCBvZiB0b2tlbnMgdGhlIGludmVzdG9yIHJlY2VpdmVzDQogICAqLw0KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHRva2Vuc1NvbGQsIHVpbnQgd2VpUmFpc2VkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOw0KfQ0KDQoNCi8qKg0KICogRmluYWxpemUgYWdlbnQgZGVmaW5lcyB3aGF0IGhhcHBlbnMgYXQgdGhlIGVuZCBvZiBzdWNjZXNlZnVsIGNyb3dkc2FsZS4NCiAqDQogKiAtIEFsbG9jYXRlIHRva2VucyBmb3IgZm91bmRlcnMsIGJvdW50aWVzIGFuZCBjb21tdW5pdHkNCiAqIC0gTWFrZSB0b2tlbnMgdHJhbnNmZXJhYmxlDQogKiAtIGV0Yy4NCiAqLw0KY29udHJhY3QgRmluYWxpemVBZ2VudCB7DQoNCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFJldHVybiB0cnVlIGlmIHdlIGNhbiBydW4gZmluYWxpemVDcm93ZHNhbGUoKSBwcm9wZXJseS4NCiAgICoNCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luDQogICAqIHVubGVzcyB0aGUgZmluYWxpemVyIGhhcyBiZWVuIHNldCB1cCBwcm9wZXJseS4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsNCg0KICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovDQogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7DQoNCn0NCg0KDQoNCg0KLyoNCiAqIEVSQzIwIGludGVyZmFjZQ0KICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMCB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCg0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQoNCi8qKg0KICogQSB0b2tlbiB0aGF0IGRlZmluZXMgZnJhY3Rpb25hbCB1bml0cyBhcyBkZWNpbWFscy4NCiAqLw0KY29udHJhY3QgRnJhY3Rpb25hbEVSQzIwIGlzIEVSQzIwIHsNCg0KICB1aW50IHB1YmxpYyBkZWNpbWFsczsNCg0KfQ0KDQoNCg0KLyoqDQogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcy4NCiAqDQogKiBIYW5kbGUNCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcw0KICogLSBhY2NlcHRpbmcgaW52ZXN0bWVudHMNCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZA0KICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQNCiAqIC0gZGlmZmVyZW50IHByaWNpbmcgc3RyYXRlZ2llcw0KICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpDQogKg0KICovDQpjb250cmFjdCBDcm93ZHNhbGUgaXMgSGFsdGFibGUgew0KDQogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50Ow0KDQogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLw0KICBGcmFjdGlvbmFsRVJDMjAgcHVibGljIHRva2VuOw0KDQogIC8qIEhvdyB3ZSBhcmUgZ29pbmcgdG8gcHJpY2Ugb3VyIG9mZmVyaW5nICovDQogIFByaWNpbmdTdHJhdGVneSBwdWJsaWMgcHJpY2luZ1N0cmF0ZWd5Ow0KDQogIC8qIFBvc3Qtc3VjY2VzcyBjYWxsYmFjayAqLw0KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50Ow0KDQogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8NCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7DQoNCiAgLyogaWYgdGhlIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZCwgaW52ZXN0b3JzIG1heSB3aXRoZHJhdyB0aGVpciBmdW5kcyAqLw0KICB1aW50IHB1YmxpYyBtaW5pbXVtRnVuZGluZ0dvYWw7DQoNCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLw0KICB1aW50IHB1YmxpYyBzdGFydHNBdDsNCg0KICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLw0KICB1aW50IHB1YmxpYyBlbmRzQXQ7DQoNCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovDQogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOw0KDQogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovDQogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7DQoNCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8NCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7DQoNCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLw0KICB1aW50IHB1YmxpYyBsb2FkZWRSZWZ1bmQgPSAwOw0KDQogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIGdpdmVuIGJhY2sgdG8gaW52ZXN0b3JzLiovDQogIHVpbnQgcHVibGljIHdlaVJlZnVuZGVkID0gMDsNCg0KICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8NCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOw0KDQogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8NCiAgYm9vbCBwdWJsaWMgcmVxdWlyZUN1c3RvbWVySWQ7DQoNCiAgLyoqDQogICAgKiBEbyB3ZSB2ZXJpZnkgdGhhdCBjb250cmlidXRvciBoYXMgYmVlbiBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSAoYWNjcmVkaXRlZCBpbnZlc3RvcnMgb25seSkuDQogICAgKiBUaGlzIG1ldGhvZCB3YXMgZmlyc3QgdXNlZCBpbiBGaXJzdEJsb29kIGNyb3dkc2FsZSB0byBlbnN1cmUgYWxsIGNvbnRyaWJ1dG9ycyBoYXZlIGFjY2VwdGVkIHRlcm1zIG9uIHNhbGUgKG9uIHRoZSB3ZWIpLg0KICAgICovDQogIGJvb2wgcHVibGljIHJlcXVpcmVkU2lnbmVkQWRkcmVzczsNCg0KICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8NCiAgYWRkcmVzcyBwdWJsaWMgc2lnbmVyQWRkcmVzczsNCg0KICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaW52ZXN0ZWRBbW91bnRPZjsNCg0KICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2VuQW1vdW50T2Y7DQoNCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNhbCBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdDsNCg0KICAvKiogVGhpcyBpcyBmb3IgbWFudWwgdGVzdGluZyBmb3IgdGhlIGludGVyYWN0aW9uIGZyb20gb3duZXIgd2FsbGV0LiBZb3UgY2FuIHNldCBpdCB0byBhbnkgdmFsdWUgYW5kIGluc3BlY3QgdGhpcyBpbiBibG9ja2NoYWluIGV4cGxvcmVyIHRvIHNlZSB0aGF0IGNyb3dkc2FsZSBpbnRlcmFjdGlvbiB3b3Jrcy4gKi8NCiAgdWludCBwdWJsaWMgb3duZXJUZXN0VmFsdWU7DQoNCiAgLyoqIFN0YXRlIG1hY2hpbmUNCiAgICoNCiAgICogLSBQcmVwYXJpbmc6IEFsbCBjb250cmFjdCBpbml0aWFsaXphdGlvbiBjYWxscyBhbmQgdmFyaWFibGVzIGhhdmUgbm90IGJlZW4gc2V0IHlldA0KICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHBhc3NlZCBzdGFydCB0aW1lIHlldA0KICAgKiAtIEZ1bmRpbmc6IEFjdGl2ZSBjcm93ZHNhbGUNCiAgICogLSBTdWNjZXNzOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCByZWFjaGVkDQogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lDQogICAqIC0gRmluYWxpemVkOiBUaGUgZmluYWxpemVkIGhhcyBiZWVuIGNhbGxlZCBhbmQgc3VjY2VzZnVsbHkgZXhlY3V0ZWQNCiAgICogLSBSZWZ1bmRpbmc6IFJlZnVuZHMgYXJlIGxvYWRlZCBvbiB0aGUgY29udHJhY3QgZm9yIHJlY2xhaW0uDQogICAqLw0KICBlbnVtIFN0YXRle1Vua25vd24sIFByZXBhcmluZywgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmFpbHVyZSwgRmluYWxpemVkLCBSZWZ1bmRpbmd9DQoNCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQ0KICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludDEyOCBjdXN0b21lcklkKTsNCg0KICAvLyBSZWZ1bmQgd2FzIHByb2Nlc3NlZCBmb3IgYSBjb250cmlidXRvcg0KICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOw0KDQogIC8vIFRoZSBydWxlcyB3ZXJlIGNoYW5nZWQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdA0KICBldmVudCBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChib29sIHJlcXVpcmVDdXN0b21lcklkLCBib29sIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgYWRkcmVzcyBzaWduZXJBZGRyZXNzKTsNCg0KICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkDQogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpOw0KDQogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkDQogIGV2ZW50IEVuZHNBdENoYW5nZWQodWludCBlbmRzQXQpOw0KDQogIGZ1bmN0aW9uIENyb3dkc2FsZShhZGRyZXNzIF90b2tlbiwgUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3ksIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCB1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF9taW5pbXVtRnVuZGluZ0dvYWwpIHsNCg0KICAgIGlmKF9taW5pbXVtRnVuZGluZ0dvYWwgIT0gMCkgew0KICAgICAgLy8gTXlzdGVyaXVtIHNwZWNpZmljIGZpeCB0byBhbGxvdyBmdW5kaW5nIGdvYWwgb25seSBiZSBzZXQgaW4gQ0hGDQogICAgfQ0KDQogICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KDQogICAgdG9rZW4gPSBGcmFjdGlvbmFsRVJDMjAoX3Rva2VuKTsNCg0KICAgIHNldFByaWNpbmdTdHJhdGVneShfcHJpY2luZ1N0cmF0ZWd5KTsNCg0KICAgIG11bHRpc2lnV2FsbGV0ID0gX211bHRpc2lnV2FsbGV0Ow0KICAgIGlmKG11bHRpc2lnV2FsbGV0ID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYoX3N0YXJ0ID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgc3RhcnRzQXQgPSBfc3RhcnQ7DQoNCiAgICBpZihfZW5kID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgZW5kc0F0ID0gX2VuZDsNCg0KICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzDQogICAgaWYoc3RhcnRzQXQgPj0gZW5kc0F0KSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICB9DQoNCiAgLyoqDQogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbigpIHBheWFibGUgew0KICAgIHRocm93Ow0KICB9DQoNCiAgLyoqDQogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4NCiAgICoNCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4NCiAgICogV2UgbXVzdCBoYXZlIG5vdCBwcmVzc2VkIHRoZSBlbWVyZ2VuY3kgYnJha2UuDQogICAqDQogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2Vucw0KICAgKiBAcGFyYW0gY3VzdG9tZXJJZCAob3B0aW9uYWwpIFVVSUQgdjQgdG8gdHJhY2sgdGhlIHN1Y2Nlc3NmdWwgcGF5bWVudHMgb24gdGhlIHNlcnZlciBzaWRlDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3RJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQpIHN0b3BJbkVtZXJnZW5jeSBwcml2YXRlIHsNCg0KICAgIC8vIERldGVybWluZSBpZiBpdCdzIGEgZ29vZCB0aW1lIHRvIGFjY2VwdCBpbnZlc3RtZW50IGZyb20gdGhpcyBwYXJ0aWNpcGFudA0KICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgew0KICAgICAgLy8gQXJlIHdlIHdoaXRlbGlzdGVkIGZvciBlYXJseSBkZXBvc2l0DQogICAgICBpZighZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0pIHsNCiAgICAgICAgdGhyb3c7DQogICAgICB9DQogICAgfSBlbHNlIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuRnVuZGluZykgew0KICAgICAgLy8gUmV0YWlsIHBhcnRpY2lwYW50cyBjYW4gb25seSBjb21lIGluIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyBydW5uaW5nDQogICAgICAvLyBwYXNzDQogICAgfSBlbHNlIHsNCiAgICAgIC8vIFVud2FudGVkIHN0YXRlDQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICB1aW50IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsNCiAgICB1aW50IHRva2VuQW1vdW50ID0gcHJpY2luZ1N0cmF0ZWd5LmNhbGN1bGF0ZVByaWNlKHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsNCg0KICAgIGlmKHRva2VuQW1vdW50ID09IDApIHsNCiAgICAgIC8vIER1c3QgdHJhbnNhY3Rpb24NCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGlmKGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID09IDApIHsNCiAgICAgICAvLyBBIG5ldyBpbnZlc3Rvcg0KICAgICAgIGludmVzdG9yQ291bnQrKzsNCiAgICB9DQoNCiAgICAvLyBVcGRhdGUgaW52ZXN0b3INCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXMod2VpQW1vdW50KTsNCiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOw0KDQogICAgLy8gVXBkYXRlIHRvdGFscw0KICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5wbHVzKHdlaUFtb3VudCk7DQogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBDaGVjayB0aGF0IHdlIGRpZCBub3QgYnVzdCB0aGUgY2FwDQogICAgaWYoaXNCcmVha2luZ0NhcCh0b2tlbkFtb3VudCwgd2VpQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQpKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsNCg0KICAgIC8vIFBvY2tldCB0aGUgbW9uZXkNCiAgICBpZighbXVsdGlzaWdXYWxsZXQuc2VuZCh3ZWlBbW91bnQpKSB0aHJvdzsNCg0KICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzDQogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGN1c3RvbWVySWQpOw0KDQogICAgLy8gQ2FsbCB0aGUgaW52ZXN0IGhvb2tzDQogICAgb25JbnZlc3QoKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBUcmFjayB3aG8gaXMgdGhlIGN1c3RvbWVyIG1ha2luZyB0aGUgcGF5bWVudCBzbyB3ZSBjYW4gc2VuZCB0aGFuayB5b3UgZW1haWwuDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3RXaXRoQ3VzdG9tZXJJZChhZGRyZXNzIGFkZHIsIHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgew0KICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzDQogICAgaWYoY3VzdG9tZXJJZCA9PSAwKSB0aHJvdzsgIC8vIFVVSUR2NCBzYW5pdHkgY2hlY2sNCiAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCBjdXN0b21lcklkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4NCiAgICovDQogIGZ1bmN0aW9uIGludmVzdChhZGRyZXNzIGFkZHIpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpZihyZXF1aXJlQ3VzdG9tZXJJZCkgdGhyb3c7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aXBhbnRzIGZvciB0aGFuayB5b3UgZW1haWwNCiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cw0KICAgIGludmVzdEludGVybmFsKGFkZHIsIDApOw0KICB9DQoNCiAgLyoqDQogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIuDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpbnZlc3RXaXRoQ3VzdG9tZXJJZChtc2cuc2VuZGVyLCBjdXN0b21lcklkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLg0KICAgKg0KICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuDQogICAqLw0KICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaW52ZXN0KG1zZy5zZW5kZXIpOw0KICB9DQoNCiAgLyoqDQogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuDQogICAqDQogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7DQoNCiAgICAvLyBBbHJlYWR5IGZpbmFsaXplZA0KICAgIGlmKGZpbmFsaXplZCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gRmluYWxpemluZyBpcyBvcHRpb25hbC4gV2Ugb25seSBjYWxsIGl0IGlmIHdlIGFyZSBnaXZlbiBhIGZpbmFsaXppbmcgYWdlbnQuDQogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSAwKSB7DQogICAgICBmaW5hbGl6ZUFnZW50LmZpbmFsaXplQ3Jvd2RzYWxlKCk7DQogICAgfQ0KDQogICAgZmluYWxpemVkID0gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byAocmUpc2V0IGZpbmFsaXplIGFnZW50Lg0KICAgKg0KICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gc2V0dGluZyB0aGlzLCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4NCiAgICovDQogIGZ1bmN0aW9uIHNldEZpbmFsaXplQWdlbnQoRmluYWxpemVBZ2VudCBhZGRyKSBvbmx5T3duZXIgew0KICAgIGZpbmFsaXplQWdlbnQgPSBhZGRyOw0KDQogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQNCiAgICBpZighZmluYWxpemVBZ2VudC5pc0ZpbmFsaXplQWdlbnQoKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIFNldCBwb2xpY3kgZG8gd2UgbmVlZCB0byBoYXZlIHNlcnZlci1zaWRlIGN1c3RvbWVyIGlkcyBmb3IgdGhlIGludmVzdG1lbnRzLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0UmVxdWlyZUN1c3RvbWVySWQoYm9vbCB2YWx1ZSkgb25seU93bmVyIHsNCiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOw0KICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLg0KICAgKg0KICAgKiBUT0RPOiBGaXggc3BlbGxpbmcgZXJyb3IgaW4gdGhlIG5hbWUNCiAgICovDQogIGZ1bmN0aW9uIHNldEVhcmx5UGFyaWNpcGFudFdoaXRlbGlzdChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKSBvbmx5T3duZXIgew0KICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBzdGF0dXM7DQogICAgV2hpdGVsaXN0ZWQoYWRkciwgc3RhdHVzKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuDQogICAqDQogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiB0aGUgc2V0LCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4NCiAgICovDQogIGZ1bmN0aW9uIHNldFByaWNpbmdTdHJhdGVneShQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSkgb25seU93bmVyIHsNCiAgICBwcmljaW5nU3RyYXRlZ3kgPSBfcHJpY2luZ1N0cmF0ZWd5Ow0KDQogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQNCiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyBsb2FkIHJlZnVuZHMgYmFjayBvbiB0aGUgY29udHJhY3QgZm9yIHRoZSByZWZ1bmRpbmcuDQogICAqDQogICAqIFRoZSB0ZWFtIGNhbiB0cmFuc2ZlciB0aGUgZnVuZHMgYmFjayBvbiB0aGUgc21hcnQgY29udHJhY3QgaW4gdGhlIGNhc2UgdGhlIG1pbmltdW0gZ29hbCB3YXMgbm90IHJlYWNoZWQuLg0KICAgKi8NCiAgZnVuY3Rpb24gbG9hZFJlZnVuZCgpIHB1YmxpYyBwYXlhYmxlIGluU3RhdGUoU3RhdGUuRmFpbHVyZSkgew0KICAgIGlmKG1zZy52YWx1ZSA9PSAwKSB0aHJvdzsNCiAgICBsb2FkZWRSZWZ1bmQgPSBsb2FkZWRSZWZ1bmQucGx1cyhtc2cudmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIEludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kLg0KICAgKi8NCiAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIGluU3RhdGUoU3RhdGUuUmVmdW5kaW5nKSB7DQogICAgdWludDI1NiB3ZWlWYWx1ZSA9IGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl07DQogICAgaWYgKHdlaVZhbHVlID09IDApIHRocm93Ow0KICAgIGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl0gPSAwOw0KICAgIHdlaVJlZnVuZGVkID0gd2VpUmVmdW5kZWQucGx1cyh3ZWlWYWx1ZSk7DQogICAgUmVmdW5kKG1zZy5zZW5kZXIsIHdlaVZhbHVlKTsNCiAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh3ZWlWYWx1ZSkpIHRocm93Ow0KICB9DQoNCiAgLyoqDQogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY3Jvd2RzYWxlIGhhcyByYWlzZWQgZW5vdWdoIG1vbmV5IHRvIGJlIGEgc3VjY2VzDQogICAqLw0KICBmdW5jdGlvbiBpc01pbmltdW1Hb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHJlYWNoZWQpIHsNCiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbmltdW1GdW5kaW5nR29hbDsNCiAgfQ0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuDQogICAqLw0KICBmdW5jdGlvbiBpc0ZpbmFsaXplclNhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzYW5lKSB7DQogICAgcmV0dXJuIGZpbmFsaXplQWdlbnQuaXNTYW5lKCk7DQogIH0NCg0KICAvKioNCiAgICogQ2hlY2sgaWYgdGhlIGNvbnRyYWN0IHJlbGF0aW9uc2hpcCBsb29rcyBnb29kLg0KICAgKi8NCiAgZnVuY3Rpb24gaXNQcmljaW5nU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsNCiAgICByZXR1cm4gcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50Lg0KICAgKg0KICAgKiBXZSBtYWtlIGl0IGEgZnVuY3Rpb24gYW5kIGRvIG5vdCBhc3NpZ24gdGhlIHJlc3VsdCB0byBhIHZhcmlhYmxlLCBzbyB0aGVyZSBpcyBubyBjaGFuY2Ugb2YgdGhlIHZhcmlhYmxlIGJlaW5nIHN0YWxlLg0KICAgKi8NCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoU3RhdGUpIHsNCiAgICBpZihmaW5hbGl6ZWQpIHJldHVybiBTdGF0ZS5GaW5hbGl6ZWQ7DQogICAgZWxzZSBpZiAoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSA9PSAwKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOw0KICAgIGVsc2UgaWYgKCFmaW5hbGl6ZUFnZW50LmlzU2FuZSgpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOw0KICAgIGVsc2UgaWYgKCFwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOw0KICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsNCiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPD0gZW5kc0F0ICYmICFpc0Nyb3dkc2FsZUZ1bGwoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7DQogICAgZWxzZSBpZiAoaXNNaW5pbXVtR29hbFJlYWNoZWQoKSkgcmV0dXJuIFN0YXRlLlN1Y2Nlc3M7DQogICAgZWxzZSBpZiAoIWlzTWluaW11bUdvYWxSZWFjaGVkKCkgJiYgd2VpUmFpc2VkID4gMCAmJiBsb2FkZWRSZWZ1bmQgPj0gd2VpUmFpc2VkKSByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOw0KICAgIGVsc2UgcmV0dXJuIFN0YXRlLkZhaWx1cmU7DQogIH0NCg0KICAvKiogVGhpcyBpcyBmb3IgbWFudWFsIHRlc3Rpbmcgb2YgbXVsdGlzaWcgd2FsbGV0IGludGVyYWN0aW9uICovDQogIGZ1bmN0aW9uIHNldE93bmVyVGVzdFZhbHVlKHVpbnQgdmFsKSBvbmx5T3duZXIgew0KICAgIG93bmVyVGVzdFZhbHVlID0gdmFsOw0KICB9DQoNCiAgLyoqIEludGVyZmFjZSBtYXJrZXIuICovDQogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQoNCiAgLyoqDQogICAqIEFsbG93IHN1YmNvbnRyYWN0cyB0byB0YWtlIGV4dHJhIGFjdGlvbnMgb24gYSBzdWNjZXNzZnVsIGludmV0Lg0KICAgKi8NCiAgZnVuY3Rpb24gb25JbnZlc3QoKSBpbnRlcm5hbCB7DQoNCiAgfQ0KDQogIC8vDQogIC8vIE1vZGlmaWVycw0KICAvLw0KDQogIC8qKiBNb2RpZmllZCBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8NCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgew0KICAgIGlmKGdldFN0YXRlKCkgIT0gc3RhdGUpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgY3Jvd2RzYWxlIG93bmVyIHRvIGNsb3NlIGVhcmx5IG9yIGV4dGVuZCB0aGUgY3Jvd2RzYWxlLg0KICAgKg0KICAgKiBUaGlzIGlzIHVzZWZ1bCBlLmcuIGZvciBhIG1hbnVhbCBzb2Z0IGNhcCBpbXBsZW1lbnRhdGlvbjoNCiAgICogLSBhZnRlciBYIGFtb3VudCBpcyByZWFjaGVkIGRldGVybWluZSBtYW51YWwgY2xvc2luZw0KICAgKg0KICAgKiBUaGlzIG1heSBwdXQgdGhlIGNyb3dkc2FsZSB0byBhbiBpbnZhbGlkIHN0YXRlLA0KICAgKiBidXQgd2UgdHJ1c3Qgb3duZXJzIGtub3cgd2hhdCB0aGV5IGFyZSBkb2luZy4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIHNldEVuZHNBdCh1aW50IHRpbWUpIG9ubHlPd25lciB7DQoNCiAgICBpZihub3cgPiB0aW1lKSB7DQogICAgICB0aHJvdzsgLy8gRG9uJ3QgY2hhbmdlIHBhc3QNCiAgICB9DQoNCiAgICBlbmRzQXQgPSB0aW1lOw0KICAgIEVuZHNBdENoYW5nZWQoZW5kc0F0KTsNCiAgfQ0KDQogIC8vDQogIC8vIEFic3RyYWN0IGZ1bmN0aW9ucw0KICAvLw0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBpbnZlc3RlZCBicmVha3Mgb3VyIGNhcCBydWxlcy4NCiAgICoNCiAgICoNCiAgICogVGhlIGNoaWxkIGNvbnRyYWN0IG11c3QgZGVmaW5lIHRoZWlyIG93biBjYXAgc2V0dGluZyBydWxlcy4NCiAgICogV2UgYWxsb3cgYSBsb3Qgb2YgZmxleGliaWxpdHkgdGhyb3VnaCBkaWZmZXJlbnQgY2FwcGluZyBzdHJhdGVnaWVzIChFVEgsIHRva2VuIGNvdW50KQ0KICAgKiBDYWxsZWQgZnJvbSBpbnZlc3QoKS4NCiAgICoNCiAgICogQHBhcmFtIHdlaUFtb3VudCBUaGUgYW1vdW50IG9mIHdlaSB0aGUgaW52ZXN0b3IgdHJpZXMgdG8gaW52ZXN0IGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB3ZSB0cnkgdG8gZ2l2ZSB0byB0aGUgaW52ZXN0b3IgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHdlaVJhaXNlZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHJhaXNlZCBiYWxhbmNlIGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHRva2Vuc1NvbGRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCBzb2xkIHRva2VucyBjb3VudCBhZnRlciB0aGlzIHRyYW5zYWN0aW9uDQogICAqDQogICAqIEByZXR1cm4gdHJ1ZSBpZiB0YWtpbmcgdGhpcyBpbnZlc3RtZW50IHdvdWxkIGJyZWFrIG91ciBjYXAgcnVsZXMNCiAgICovDQogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpUmFpc2VkVG90YWwsIHVpbnQgdG9rZW5zU29sZFRvdGFsKSBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKTsNCg0KICAvKioNCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIGZ1bGwgYW5kIHdlIGNhbiBubyBsb25nZXIgc2VsbCBhbnkgdG9rZW5zLg0KICAgKi8NCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGVGdWxsKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOw0KDQogIC8qKg0KICAgKiBDcmVhdGUgbmV3IHRva2VucyBvciB0cmFuc2ZlciBpc3N1ZWQgdG9rZW5zIHRvIHRoZSBpbnZlc3RvciBkZXBlbmRpbmcgb24gdGhlIGNhcCBtb2RlbC4NCiAgICovDQogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBwcml2YXRlOw0KfQ0KDQoNCg0KDQoNCg0KDQovKioNCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MNCiAqLw0KY29udHJhY3QgU2FmZU1hdGggew0KICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICBhc3NlcnQoYiA+IDApOw0KICAgIHVpbnQgYyA9IGEgLyBiOw0KICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiIDw9IGEpOw0KICAgIHJldHVybiBhIC0gYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7DQogICAgaWYgKCFhc3NlcnRpb24pIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KfQ0KDQoNCg0KLyoqDQogKiBTdGFuZGFyZCBFUkMyMCB0b2tlbiB3aXRoIFNob3J0IEhhbmQgQXR0YWNrIGFuZCBhcHByb3ZlKCkgcmFjZSBjb25kaXRpb24gbWl0aWdhdGlvbi4NCiAqDQogKiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6DQogKiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wNCiAqLw0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgU2FmZU1hdGggew0KDQogIC8qIFRva2VuIHN1cHBseSBnb3QgaW5jcmVhc2VkIGFuZCBhIG5ldyBvd25lciByZWNlaXZlZCB0aGVzZSB0b2tlbnMgKi8NCiAgZXZlbnQgTWludGVkKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KTsNCg0KICAvKiBBY3R1YWwgYmFsYW5jZXMgb2YgdG9rZW4gaG9sZGVycyAqLw0KICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7DQoNCiAgLyogYXBwcm92ZSgpIGFsbG93YW5jZXMgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOw0KDQogIC8qKg0KICAgKg0KICAgKiBGaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjaw0KICAgKg0KICAgKiBodHRwOi8vdmVzc2VuZXMuY29tL3RoZS1lcmMyMC1zaG9ydC1hZGRyZXNzLWF0dGFjay1leHBsYWluZWQvDQogICAqLw0KICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBzaXplKSB7DQogICAgIGlmKG1zZy5kYXRhLmxlbmd0aCAhPSBzaXplICsgNCkgew0KICAgICAgIHRocm93Ow0KICAgICB9DQogICAgIF87DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsNCiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOw0KICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgIHVpbnQgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOw0KDQogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldA0KICAgIC8vIGlmIChfdmFsdWUgPiBfYWxsb3dhbmNlKSB0aHJvdzsNCg0KICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7DQogICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sIF92YWx1ZSk7DQogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBzYWZlU3ViKF9hbGxvd2FuY2UsIF92YWx1ZSk7DQogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7DQogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogIH0NCg0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCg0KICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgDQogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QNCiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToNCiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkNCiAgICBpZiAoKF92YWx1ZSAhPSAwKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0gMCkpIHRocm93Ow0KDQogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7DQogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogIH0NCg0KICAvKioNCiAgICogQXRvbWljIGluY3JlbWVudCBvZiBhcHByb3ZlZCBzcGVuZGluZw0KICAgKg0KICAgKiBXb3JrcyBhcm91bmQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkNCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIGFkZEFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpDQogIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpDQogIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOw0KICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBzYWZlQWRkKG9sZFZhbHVlLCBfYWRkZWRWYWx1ZSk7DQogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOw0KICAgICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICAvKioNCiAgICogQXRvbWljIGRlY3JlbWVudCBvZiBhcHByb3ZlZCBzcGVuZGluZy4NCiAgICoNCiAgICogV29ya3MgYXJvdW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5DQogICAqLw0KICBmdW5jdGlvbiBzdWJBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpDQogIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpDQogIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KDQogICAgICB1aW50IG9sZFZhbCA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOw0KDQogICAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbCkgew0KICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBzYWZlU3ViKG9sZFZhbCwgX3N1YnRyYWN0ZWRWYWx1ZSk7DQogICAgICB9DQogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOw0KICAgICAgcmV0dXJuIHRydWU7DQogIH0NCg0KfQ0KDQoNCi8qKg0KICogQ29sbGVjdCBmdW5kcyBmcm9tIHByZXNhbGUgaW52ZXN0b3JzLCBidXkgdG9rZW5zIGZvciB0aGVtIGluIGEgc2luZ2xlIHRyYW5zYWN0aW9uIGFuZCBkaXN0cmlidXRlIG91dCB0b2tlbnMuDQogKg0KICogLSBDb2xsZWN0IGZ1bmRzIGZyb20gcHJlLXNhbGUgaW52ZXN0b3JzDQogKiAtIFNlbmQgZnVuZHMgdG8gdGhlIGNyb3dkc2FsZSB3aGVuIGl0IG9wZW5zDQogKiAtIEFsbG93IG93bmVyIHRvIHNldCB0aGUgY3Jvd2RzYWxlDQogKiAtIEhhdmUgcmVmdW5kIGFmdGVyIFggZGF5cyBhcyBhIHNhZmV0eSBoYXRjaCBpZiB0aGUgY3Jvd2RzYWxlIGRvZXNuJ3QgbWF0ZXJpbGl6ZQ0KICogLSBBbGxvdyB1bmxpbWl0ZWQgaW52ZXN0b3JzDQogKg0KICovDQpjb250cmFjdCBNdWx0aVZhdWx0IGlzIE93bmFibGUgew0KDQogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50Ow0KDQogIC8qKiBIb3cgbWFueSBpbnZlc3RvcnMgd2UgaGF2ZSBub3cgKi8NCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudDsNCg0KICAvKiogSG93IG1hbnkgd2VpIHdlIGhhdmUgcmFpc2VkIHRvdGFsLiBXZSB1c2UgdGhpcyBhcyB0aGUgZGlzdHJpYnV0aW9uIHRvdGFsIGFtb3VudC4gSG93ZXZlciBiZWNhdXNlIGludmVzdG9ycyBhcmUgYWRkZWQgYnkgaGFuZCB0aGlzIGNhbiBiZSBkaXJlY3QgcGVyY2VudGFnZXMgdG9vLiAqLw0KICB1aW50IHB1YmxpYyB3ZWlSYWlzZWRUb3RhbDsNCg0KICAvKiogV2hvIGFyZSBvdXIgaW52ZXN0b3JzIChpdGVyYWJsZSkgKi8NCiAgYWRkcmVzc1tdIHB1YmxpYyBpbnZlc3RvcnM7DQoNCiAgLyoqIEhvdyBtdWNoIHRoZXkgaGF2ZSBpbnZlc3RlZCAqLw0KICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJhbGFuY2VzOw0KDQogIC8qKiBIb3cgbWFueSB0b2tlbnMgaW52ZXN0b3JzIGhhdmUgY2xhaW1lZCAqLw0KICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGNsYWltZWQ7DQoNCiAgLyoqIFdoZW4gb3VyIGNsYWltIGZyZWV6ZSBpcyBvdmVyIChVTklUIHRpbWVzdGFtcCkgKi8NCiAgdWludCBwdWJsaWMgZnJlZXplRW5kc0F0Ow0KDQogIC8qKiBPdXIgSUNPIGNvbnRyYWN0IHdoZXJlIHdlIHdpbGwgbW92ZSB0aGUgZnVuZHMgKi8NCiAgQ3Jvd2RzYWxlIHB1YmxpYyBjcm93ZHNhbGU7DQoNCiAgLyoqIFdlIGNhbiBhbHNvIGRlZmluZSBvdXIgb3duIHRva2VuLCB3aGljaCB3aWxsIG92ZXJyaWRlIHRoZSBJQ08gb25lICoqKi8NCiAgRnJhY3Rpb25hbEVSQzIwIHB1YmxpYyB0b2tlbjsNCg0KICAvKiogSG93IG1hbnkgdG9rZW5zIHdlcmUgZGVwb3NpdGVkIG9uIHRoZSB2YXV0bCAqLw0KICB1aW50IHB1YmxpYyBpbml0aWFsVG9rZW5CYWxhbmNlOw0KDQogIC8qIEhhcyBvd25lciBzZXQgdGhlIGluaXRpYWwgYmFsYW5jZSAqLw0KICBib29sIHB1YmxpYyBpbml0aWFsVG9rZW5CYWxhbmNlRmV0Y2hlZDsNCg0KICAvKiogV2hhdCBpcyBvdXIgY3VycmVudCBzdGF0ZS4gKi8NCiAgZW51bSBTdGF0ZXtVbmtub3duLCBIb2xkaW5nLCBEaXN0cmlidXRpbmd9DQoNCiAgLyoqIFNvbWVib2R5IGxvYWRlZCB0aGVpciBpbnZlc3RtZW50IG1vbmV5ICovDQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgdmFsdWUpOw0KDQogIC8qKiBXZSBkaXN0cmlidXRlZCB0b2tlbnMgdG8gYW4gaW52ZXN0b3IgKi8NCiAgZXZlbnQgRGlzdHJpYnV0ZWQoYWRkcmVzcyBpbnZlc3RvcnMsIHVpbnQgY291bnQpOw0KDQogIC8qKg0KICAgKiBDcmVhdGUgcHJlc2FsZSBjb250cmFjdCB3aGVyZSBsb2NrIHVwIHBlcmlvZCBpcyBnaXZlbiBkYXlzDQogICAqLw0KICBmdW5jdGlvbiBNdWx0aVZhdWx0KGFkZHJlc3MgX293bmVyLCB1aW50IF9mcmVlemVFbmRzQXQpIHsNCg0KICAgIG93bmVyID0gX293bmVyOw0KDQogICAgLy8gR2l2ZSBhcmd1bWVudA0KICAgIGlmKF9mcmVlemVFbmRzQXQgPT0gMCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgZnJlZXplRW5kc0F0ID0gX2ZyZWV6ZUVuZHNBdDsNCiAgfQ0KDQogIC8qKg0KICAgKiBHZXQgdGhlIHRva2VuIHdlIGFyZSBkaXN0cmlidXRpbmcuDQogICAqLw0KICBmdW5jdGlvbiBnZXRUb2tlbigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKEZyYWN0aW9uYWxFUkMyMCkgew0KICAgIGlmIChhZGRyZXNzKHRva2VuKSA+IDApDQogICAgICByZXR1cm4gdG9rZW47DQoNCiAgICBpZihhZGRyZXNzKGNyb3dkc2FsZSkgPT0gMCkgIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIHJldHVybiBjcm93ZHNhbGUudG9rZW4oKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBQYXJ0aWNpcGF0ZSB0byBhIHByZXNhbGUuDQogICAqLw0KICBmdW5jdGlvbiBhZGRJbnZlc3RvcihhZGRyZXNzIGludmVzdG9yLCB1aW50IGFtb3VudCkgcHVibGljIG9ubHlPd25lciB7DQoNCiAgICAvLyBDYW5ub3QgaW52ZXN0IGFueW1vcmUgdGhyb3VnaCBjcm93ZHNhbGUgd2hlbiBtb3ZpbmcgaGFzIGJlZ3VuDQogICAgaWYoZ2V0U3RhdGUoKSAhPSBTdGF0ZS5Ib2xkaW5nKSB0aHJvdzsNCg0KICAgIGlmKGFtb3VudCA9PSAwKSB0aHJvdzsgLy8gTm8gZW1wdHkgYnV5cw0KDQogICAgYm9vbCBleGlzdGluZyA9IGJhbGFuY2VzW2ludmVzdG9yXSA+IDA7DQoNCiAgICBpZihleGlzdGluZykgew0KICAgICAgLy8gR3VhcmFudGVlIGRhdGEgbG9hZCBhZ2FpbnN0IHJhY2UgY29uZGl0aW9zbg0KICAgICAgLy8gYW5kIGZhdCBmaW5nZXJzLCBzbyB0aGF0IHdlIGNhbiBsb2FkIG9uZSBpbnZlc3RvciBvbmx5IG9uY2UNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGJhbGFuY2VzW2ludmVzdG9yXSA9IGJhbGFuY2VzW2ludmVzdG9yXS5wbHVzKGFtb3VudCk7DQoNCiAgICAvLyBUaGlzIGlzIGEgbmV3IGludmVzdG9yDQogICAgaWYoIWV4aXN0aW5nKSB7DQogICAgICBpbnZlc3RvcnMucHVzaChpbnZlc3Rvcik7DQogICAgICBpbnZlc3RvckNvdW50Kys7DQogICAgfQ0KDQogICAgd2VpUmFpc2VkVG90YWwgPSB3ZWlSYWlzZWRUb3RhbC5wbHVzKGFtb3VudCk7DQoNCiAgICBJbnZlc3RlZChpbnZlc3RvciwgYW1vdW50KTsNCiAgfQ0KDQogIC8qKg0KICAgKiBIb3cgbWF5IHRva2VucyBlYWNoIGludmVzdG9yIGdldHMuDQogICAqLw0KICBmdW5jdGlvbiBnZXRDbGFpbUFtb3VudChhZGRyZXNzIGludmVzdG9yKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KDQogICAgaWYoIWluaXRpYWxUb2tlbkJhbGFuY2VGZXRjaGVkKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICByZXR1cm4gaW5pdGlhbFRva2VuQmFsYW5jZS50aW1lcyhiYWxhbmNlc1tpbnZlc3Rvcl0pIC8gd2VpUmFpc2VkVG90YWw7DQogIH0NCg0KICAvKioNCiAgICogSG93IG1hbnkgdG9rZW5zIHJlbWFpbiB1bmNsYWltZWQgZm9yIGFuIGludmVzdG9yLg0KICAgKi8NCiAgZnVuY3Rpb24gZ2V0Q2xhaW1MZWZ0KGFkZHJlc3MgaW52ZXN0b3IpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgcmV0dXJuIGdldENsYWltQW1vdW50KGludmVzdG9yKS5taW51cyhjbGFpbWVkW2ludmVzdG9yXSk7DQogIH0NCg0KICAvKioNCiAgICogQ2xhaW0gYWxsIHJlbWFpbmluZyB0b2tlbnMgZm9yIHRoaXMgaW52ZXN0b3IuDQogICAqLw0KICBmdW5jdGlvbiBjbGFpbUFsbCgpIHsNCiAgICBjbGFpbShnZXRDbGFpbUxlZnQobXNnLnNlbmRlcikpOw0KICB9DQoNCiAgLyoqDQogICAqIE9ubHkgb3duZXIgaXMgYWxsb3dlZCB0byBzZXQgdGhlIHZhdWx0IGluaXRpYWwgdG9rZW4gYmFsYW5jZS4NCiAgICoNCiAgICogQmVjYXVzZSBvbmx5IG93bmVyIGNhbiBndWFyYW50ZWUgdGhhdCB0aGUgYWxsIHRva2VucyBoYXZlIGJlZW4gbW92ZWQNCiAgICogdG8gdGhlIHZhdWx0IGFuZCBpdCBjYW4gYmVnaW4gZGlzcmlidXRpb24uIE90aGVyd2lzZSBzb21lY29uZSBjYW4NCiAgICogY2FsbCB0aGlzIHRvbyBlYXJseSBhbmQgbG9jayB0aGUgYmFsYW5jZSB0byB6ZXJvIG9yIHNvbWUgb3RoZXIgYmFkIHZhbHVlLg0KICAgKi8NCiAgZnVuY3Rpb24gZmV0Y2hUb2tlbkJhbGFuY2UoKSBvbmx5T3duZXIgew0KICAgIC8vIENhY2hpbmcgZmV0Y2hlZCB0b2tlbiBhbW91bnQ6DQogICAgaWYgKCFpbml0aWFsVG9rZW5CYWxhbmNlRmV0Y2hlZCkgew0KICAgICAgICBpbml0aWFsVG9rZW5CYWxhbmNlID0gZ2V0VG9rZW4oKS5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7DQogICAgICAgIGlmKGluaXRpYWxUb2tlbkJhbGFuY2UgPT0gMCkgdGhyb3c7IC8vIFNvbWVob3cgaW4gaW52YWxpZCBzdGF0ZQ0KICAgICAgICBpbml0aWFsVG9rZW5CYWxhbmNlRmV0Y2hlZCA9IHRydWU7DQogICAgfSBlbHNlIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBDbGFpbSBOIGJvdWdodCB0b2tlbnMgdG8gdGhlIGludmVzdG9yIGFzIHRoZSBtc2cgc2VuZGVyLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gY2xhaW0odWludCBhbW91bnQpIHsNCiAgICBhZGRyZXNzIGludmVzdG9yID0gbXNnLnNlbmRlcjsNCg0KICAgIGlmKCFpbml0aWFsVG9rZW5CYWxhbmNlRmV0Y2hlZCkgew0KICAgICAgLy8gV2UgbmVlZCB0byBoYXZlIHRoZSBiYWxhbmNlIGJlZm9yZSB3ZSBzdGFydA0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYoZ2V0U3RhdGUoKSAhPSBTdGF0ZS5EaXN0cmlidXRpbmcpIHsNCiAgICAgIC8vIFdlIGFyZSBub3QgZGlzdHJpYnV0aW5nIHlldA0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYoZ2V0Q2xhaW1MZWZ0KGludmVzdG9yKSA8IGFtb3VudCkgew0KICAgICAgLy8gV29vcHMgd2UgY2Fubm90IGdldCBtb3JlIHRoYW4gd2UgaGF2ZSBsZWZ0DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBjbGFpbWVkW2ludmVzdG9yXSA9IGNsYWltZWRbaW52ZXN0b3JdLnBsdXMoYW1vdW50KTsNCiAgICBnZXRUb2tlbigpLnRyYW5zZmVyKGludmVzdG9yLCBhbW91bnQpOw0KDQogICAgRGlzdHJpYnV0ZWQoaW52ZXN0b3IsIGFtb3VudCk7DQogIH0NCg0KICAvKioNCiAgICogU2V0IHRoZSB0YXJnZXQgY3Jvd2RzYWxlIHdoZXJlIHdlIHdpbGwgbW92ZSBwcmVzYWxlIGZ1bmRzIHdoZW4gdGhlIGNyb3dkc2FsZSBvcGVucy4NCiAgICovDQogIGZ1bmN0aW9uIHNldENyb3dkc2FsZShDcm93ZHNhbGUgX2Nyb3dkc2FsZSkgcHVibGljIG9ubHlPd25lciB7DQogICAgY3Jvd2RzYWxlID0gX2Nyb3dkc2FsZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBTZXQgdGhlIHRhcmdldCB0b2tlbiwgd2hpY2ggb3ZlcnJpZGVzIHRoZSBJQ08gdG9rZW4uDQogICAqLw0KICBmdW5jdGlvbiBzZXRUb2tlbihGcmFjdGlvbmFsRVJDMjAgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsNCiAgICB0b2tlbiA9IF90b2tlbjsNCiAgfQ0KDQogIC8qKg0KICAgKiBSZXNvbHZlIHRoZSBjb250cmFjdCB1bWFtYmlnaW91cyBzdGF0ZS4NCiAgICovDQogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIHJldHVybnMoU3RhdGUpIHsNCiAgICBpZihub3cgPiBmcmVlemVFbmRzQXQgJiYgaW5pdGlhbFRva2VuQmFsYW5jZUZldGNoZWQpIHsNCiAgICAgIHJldHVybiBTdGF0ZS5EaXN0cmlidXRpbmc7DQogICAgfSBlbHNlIHsNCiAgICAgIHJldHVybiBTdGF0ZS5Ib2xkaW5nOw0KICAgIH0NCiAgfQ0KDQogIC8qKiBFeHBsaWNpdGx5IGNhbGwgZnVuY3Rpb24gZnJvbSB5b3VyIHdhbGxldC4gKi8NCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsNCiAgICB0aHJvdzsNCiAgfQ0KfQ=='