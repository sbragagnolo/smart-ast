base 64 content
base64nEToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLyogdGFraW5nIGlkZWFzIGZyb20gRmlyc3RCbG9vZCB0b2tlbiAqLw0KY29udHJhY3QgU2FmZU1hdGggew0KDQogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgaW50ZXJuYWwgcmV0dXJucyh1aW50MjU2KSB7DQogICAgICAgIHVpbnQyNTYgeiA9IHggKyB5Ow0KICAgICAgICBhc3NlcnQoKHogPj0geCkgJiYgKHogPj0geSkpOw0KICAgICAgICByZXR1cm4gejsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzYWZlU3VidHJhY3QodWludDI1NiB4LCB1aW50MjU2IHkpIGludGVybmFsIHJldHVybnModWludDI1Nikgew0KICAgICAgICBhc3NlcnQoeCA+PSB5KTsNCiAgICAgICAgdWludDI1NiB6ID0geCAtIHk7DQogICAgICAgIHJldHVybiB6Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNhZmVNdWx0KHVpbnQyNTYgeCwgdWludDI1NiB5KSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsNCiAgICAgICAgdWludDI1NiB6ID0geCAqIHk7DQogICAgICAgIGFzc2VydCgoeCA9PSAwKXx8KHoveCA9PSB5KSk7DQogICAgICAgIHJldHVybiB6Ow0KICAgIH0NCn0NCg0KY29udHJhY3QgVG9rZW4gew0KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5Ow0KDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7DQoNCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsNCn0NCg0KLyogIEVSQyAyMCB0b2tlbiAqLw0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBUb2tlbiwgU2FmZU1hdGggew0KDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7DQoNCiAgICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBudW13b3Jkcykgew0KICAgICAgICBhc3NlcnQobXNnLmRhdGEubGVuZ3RoID09IG51bXdvcmRzICogMzIgKyA0KTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpDQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQ0KICAgIHsNCiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7DQogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWJ0cmFjdChiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsNCiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7DQogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpDQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQ0KICAgIHsNCiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDAgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsNCiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7DQogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3VidHJhY3QoYmFsYW5jZXNbX2Zyb21dLCBfdmFsdWUpOw0KICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBzYWZlU3VidHJhY3QoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sIF92YWx1ZSk7DQogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgew0KICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKQ0KICAgIG9ubHlQYXlsb2FkU2l6ZSgyKQ0KICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykNCiAgICB7DQogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQ0KICAgIGNvbnN0YW50DQogICAgb25seVBheWxvYWRTaXplKDIpDQogICAgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpDQogICAgew0KICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgICB9DQp9DQoNCi8qIFRha2luZyBpZGVhcyBmcm9tIEJBVCB0b2tlbiAqLw0KY29udHJhY3QgTkVUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsNCg0KICAgIC8vIFRva2VuIG1ldGFkYXRhDQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIk5pbWlxIE5ldHdvcmsgSW50ZXJpbSBUb2tlbiI7DQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiTkVUIjsNCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4Ow0KICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICIwLjgiOw0KDQogICAgLy8gRGVwb3NpdCBhZGRyZXNzIG9mIE11bHRpc2lnIGFjY291bnQgY29udHJvbGxlZCBieSB0aGUgY3JlYXRvcnMNCiAgICBhZGRyZXNzIHB1YmxpYyBldGhGdW5kRGVwb3NpdDsNCg0KICAgIC8vIEZ1bmRyYWlzaW5nIHBhcmFtZXRlcnMNCiAgICBlbnVtIENvbnRyYWN0U3RhdGUgeyBGdW5kcmFpc2luZywgRmluYWxpemVkLCBSZWRlZW1pbmcsIFBhdXNlZCB9DQogICAgQ29udHJhY3RTdGF0ZSBwdWJsaWMgc3RhdGU7ICAgICAgICAgICAvLyBDdXJyZW50IHN0YXRlIG9mIHRoZSBjb250cmFjdA0KICAgIENvbnRyYWN0U3RhdGUgcHJpdmF0ZSBzYXZlZFN0YXRlOyAgICAgLy8gU3RhdGUgb2YgdGhlIGNvbnRyYWN0IGJlZm9yZSBwYXVzZQ0KDQogICAgdWludDI1NiBwdWJsaWMgZnVuZGluZ1N0YXJ0QmxvY2s7ICAgICAgICAvLyBUaGVzZSB0d28gYmxvY2tzIG5lZWQgdG8gYmUgY2hvc2VuIHRvIGNvbXBseSB3aXRoIHRoZQ0KICAgIHVpbnQyNTYgcHVibGljIGZ1bmRpbmdFbmRCbG9jazsgICAgICAgICAgLy8gc3RhcnQgZGF0ZSBhbmQgMjggZGF5IGR1cmF0aW9uIHJlcXVpcmVtZW50cw0KICAgIHVpbnQyNTYgcHVibGljIGV4Y2hhbmdlUmF0ZUNoYW5nZXNCbG9jazsgLy8gYmxvY2sgbnVtYmVyIHRoYXQgdHJpZ2dlcnMgdGhlIGV4Y2hhbmdlIHJhdGUgY2hhbmdlDQoNCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9GSVJTVF9FWENIQU5HRV9SQVRFID0gMTc1OyAvLyAxNzUgTkVUcyBwZXIgMSBFVEgNCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9TRUNPTkRfRVhDSEFOR0VfUkFURSA9IDEyNTsgLy8gMTI1IE5FVHMgcGVyIDEgRVRIDQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5fQ1JFQVRJT05fQ0FQID0gMTAuNSAqICgxMCoqNikgKiAxMCoqZGVjaW1hbHM7IC8vIDEwLjUgbWlsbGlvbiBORVRzDQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgRVRIX1JFQ0VJVkVEX0NBUCA9IDYwICogKDEwKiozKSAqIDEwKipkZWNpbWFsczsgLy8gNjAgMDAwIEVUSA0KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEVUSF9SRUNFSVZFRF9NSU4gPSA1ICogKDEwKiozKSAqIDEwKipkZWNpbWFsczsgLy8gNSAwMDAgRVRIDQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5fTUlOID0gMSAqIDEwKipkZWNpbWFsczsgLy8gMSBORVQNCg0KICAgIC8vIFdlIG5lZWQgdG8ga2VlcCB0cmFjayBvZiBob3cgbXVjaCBldGhlciBoYXZlIGJlZW4gY29udHJpYnV0ZWQsIHNpbmNlIHdlIGhhdmUgYSBjYXAgZm9yIEVUSCB0b28NCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFJlY2VpdmVkRXRoID0gMDsNCg0KICAgIC8vIFNpbmNlIHdlIGhhdmUgZGlmZmVyZW50IGV4Y2hhbmdlIHJhdGVzIGF0IGRpZmZlcmVudCBzdGFnZXMsIHdlIG5lZWQgdG8ga2VlcCB0cmFjaw0KICAgIC8vIG9mIGhvdyBtdWNoIGV0aGVyIGVhY2ggY29udHJpYnV0ZWQgaW4gY2FzZSB0aGF0IHdlIG5lZWQgdG8gaXNzdWUgYSByZWZ1bmQNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHByaXZhdGUgZXRoQmFsYW5jZXM7DQoNCiAgICAvLyBFdmVudHMgdXNlZCBmb3IgbG9nZ2luZw0KICAgIGV2ZW50IExvZ1JlZnVuZChhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7DQogICAgZXZlbnQgTG9nQ3JlYXRlTkVUKGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBMb2dSZWRlZW1ORVQoYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUsIGJ5dGVzMzIgX25pbWlxQWRkcmVzcyk7DQoNCiAgICBtb2RpZmllciBpc0ZpbmFsaXplZCgpIHsNCiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBDb250cmFjdFN0YXRlLkZpbmFsaXplZCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgaXNGdW5kcmFpc2luZygpIHsNCiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBDb250cmFjdFN0YXRlLkZ1bmRyYWlzaW5nKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBpc1JlZGVlbWluZygpIHsNCiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBDb250cmFjdFN0YXRlLlJlZGVlbWluZyk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgaXNQYXVzZWQoKSB7DQogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gQ29udHJhY3RTdGF0ZS5QYXVzZWQpOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG5vdFBhdXNlZCgpIHsNCiAgICAgICAgcmVxdWlyZShzdGF0ZSAhPSBDb250cmFjdFN0YXRlLlBhdXNlZCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgaXNGdW5kcmFpc2luZ0lnbm9yZVBhdXNlZCgpIHsNCiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBDb250cmFjdFN0YXRlLkZ1bmRyYWlzaW5nIHx8IChzdGF0ZSA9PSBDb250cmFjdFN0YXRlLlBhdXNlZCAmJiBzYXZlZFN0YXRlID09IENvbnRyYWN0U3RhdGUuRnVuZHJhaXNpbmcpKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBldGhGdW5kRGVwb3NpdCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgbWluaW11bVJlYWNoZWQoKSB7DQogICAgICAgIHJlcXVpcmUodG90YWxSZWNlaXZlZEV0aCA+PSBFVEhfUkVDRUlWRURfTUlOKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvLyBDb25zdHJ1Y3Rvcg0KICAgIGZ1bmN0aW9uIE5FVG9rZW4oDQogICAgYWRkcmVzcyBfZXRoRnVuZERlcG9zaXQsDQogICAgdWludDI1NiBfZnVuZGluZ1N0YXJ0QmxvY2ssDQogICAgdWludDI1NiBfZnVuZGluZ0VuZEJsb2NrLA0KICAgIHVpbnQyNTYgX2V4Y2hhbmdlUmF0ZUNoYW5nZXNCbG9jaykNCiAgICB7DQogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIHBhcmFtZXRlcnMgbWFrZSBzZW5zZQ0KICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA8PSBfZnVuZGluZ1N0YXJ0QmxvY2spOyAvLyBUaGUgc3RhcnQgb2YgdGhlIGZ1bmRyYWlzaW5nIHNob3VsZCBoYXBwZW4gaW4gdGhlIGZ1dHVyZQ0KICAgICAgICByZXF1aXJlKF9mdW5kaW5nU3RhcnRCbG9jayA8PSBfZXhjaGFuZ2VSYXRlQ2hhbmdlc0Jsb2NrKTsgLy8gVGhlIGV4Y2hhbmdlIHJhdGUgY2hhbmdlIHNob3VsZCBoYXBwZW4gYWZ0ZXIgdGhlIHN0YXJ0IG9mIHRoZSBmdW5kcmFpc2luZw0KICAgICAgICByZXF1aXJlKF9leGNoYW5nZVJhdGVDaGFuZ2VzQmxvY2sgPD0gX2Z1bmRpbmdFbmRCbG9jayk7IC8vIEFuZCB0aGUgZW5kIG9mIHRoZSBmdW5kcmFpc2luZyBzaG91bGQgaGFwcGVuIGFmdGVyIHRoZSBleGNoYW5nZSByYXRlIGNoYW5nZQ0KDQogICAgICAgIC8vIENvbnRyYWN0IHN0YXRlDQogICAgICAgIHN0YXRlID0gQ29udHJhY3RTdGF0ZS5GdW5kcmFpc2luZzsNCiAgICAgICAgc2F2ZWRTdGF0ZSA9IENvbnRyYWN0U3RhdGUuRnVuZHJhaXNpbmc7DQoNCiAgICAgICAgZXRoRnVuZERlcG9zaXQgPSBfZXRoRnVuZERlcG9zaXQ7DQogICAgICAgIGZ1bmRpbmdTdGFydEJsb2NrID0gX2Z1bmRpbmdTdGFydEJsb2NrOw0KICAgICAgICBmdW5kaW5nRW5kQmxvY2sgPSBfZnVuZGluZ0VuZEJsb2NrOw0KICAgICAgICBleGNoYW5nZVJhdGVDaGFuZ2VzQmxvY2sgPSBfZXhjaGFuZ2VSYXRlQ2hhbmdlc0Jsb2NrOw0KICAgICAgICB0b3RhbFN1cHBseSA9IDA7DQogICAgfQ0KDQogICAgLy8gT3ZlcnJpZGRlbiBtZXRob2QgdG8gY2hlY2sgZm9yIGVuZCBvZiBmdW5kcmFpc2luZyBiZWZvcmUgYWxsb3dpbmcgdHJhbnNmZXIgb2YgdG9rZW5zDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQ0KICAgIGlzRmluYWxpemVkIC8vIE9ubHkgYWxsb3cgdG9rZW4gdHJhbnNmZXIgYWZ0ZXIgdGhlIGZ1bmRyYWlzaW5nIGhhcyBlbmRlZA0KICAgIG9ubHlQYXlsb2FkU2l6ZSgyKQ0KICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykNCiAgICB7DQogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7DQogICAgfQ0KDQoNCiAgICAvLyBPdmVycmlkZGVuIG1ldGhvZCB0byBjaGVjayBmb3IgZW5kIG9mIGZ1bmRyYWlzaW5nIGJlZm9yZSBhbGxvd2luZyB0cmFuc2ZlciBvZiB0b2tlbnMNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQ0KICAgIGlzRmluYWxpemVkIC8vIE9ubHkgYWxsb3cgdG9rZW4gdHJhbnNmZXIgYWZ0ZXIgdGhlIGZ1bmRyYWlzaW5nIGhhcyBlbmRlZA0KICAgIG9ubHlQYXlsb2FkU2l6ZSgzKQ0KICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykNCiAgICB7DQogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICB9DQoNCg0KICAgIC8vLyBAZGV2IEFjY2VwdHMgZXRoZXIgYW5kIGNyZWF0ZXMgbmV3IE5FVCB0b2tlbnMNCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbnMoKQ0KICAgIHBheWFibGUNCiAgICBleHRlcm5hbA0KICAgIGlzRnVuZHJhaXNpbmcNCiAgICB7DQogICAgICAgIHJlcXVpcmUoYmxvY2subnVtYmVyID49IGZ1bmRpbmdTdGFydEJsb2NrKTsNCiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPD0gZnVuZGluZ0VuZEJsb2NrKTsNCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsNCg0KICAgICAgICAvLyBGaXJzdCB3ZSBjaGVjayB0aGUgRVRIIGNhcCwgYXMgaXQncyBlYXNpZXIgdG8gY2FsY3VsYXRlLCByZXR1cm4NCiAgICAgICAgLy8gdGhlIGNvbnRyaWJ1dGlvbiBpZiB0aGUgY2FwIGhhcyBiZWVuIHJlYWNoZWQgYWxyZWFkeQ0KICAgICAgICB1aW50MjU2IGNoZWNrZWRSZWNlaXZlZEV0aCA9IHNhZmVBZGQodG90YWxSZWNlaXZlZEV0aCwgbXNnLnZhbHVlKTsNCiAgICAgICAgcmVxdWlyZShjaGVja2VkUmVjZWl2ZWRFdGggPD0gRVRIX1JFQ0VJVkVEX0NBUCk7DQoNCiAgICAgICAgLy8gSWYgYWxsIGlzIGZpbmUgd2l0aCB0aGUgRVRIIGNhcCwgd2UgY29udGludWUgdG8gY2hlY2sgdGhlDQogICAgICAgIC8vIG1pbmltdW0gYW1vdW50IG9mIHRva2VucyBhbmQgdGhlIGNhcCBmb3IgaG93IG1hbnkgdG9rZW5zDQogICAgICAgIC8vIGhhdmUgYmVlbiBnZW5lcmF0ZWQgc28gZmFyDQogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gc2FmZU11bHQobXNnLnZhbHVlLCBnZXRDdXJyZW50VG9rZW5QcmljZSgpKTsNCiAgICAgICAgcmVxdWlyZSh0b2tlbnMgPj0gVE9LRU5fTUlOKTsNCiAgICAgICAgdWludDI1NiBjaGVja2VkU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgdG9rZW5zKTsNCiAgICAgICAgcmVxdWlyZShjaGVja2VkU3VwcGx5IDw9IFRPS0VOX0NSRUFUSU9OX0NBUCk7DQoNCiAgICAgICAgLy8gT25seSB3aGVuIGFsbCB0aGUgY2hlY2tzIGhhdmUgcGFzc2VkLCB0aGVuIHdlIHVwZGF0ZSB0aGUgc3RhdGUgKGV0aEJhbGFuY2VzLA0KICAgICAgICAvLyB0b3RhbFJlY2VpdmVkRXRoLCB0b3RhbFN1cHBseSwgYW5kIGJhbGFuY2VzKSBvZiB0aGUgY29udHJhY3QNCiAgICAgICAgZXRoQmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGV0aEJhbGFuY2VzW21zZy5zZW5kZXJdLCBtc2cudmFsdWUpOw0KICAgICAgICB0b3RhbFJlY2VpdmVkRXRoID0gY2hlY2tlZFJlY2VpdmVkRXRoOw0KICAgICAgICB0b3RhbFN1cHBseSA9IGNoZWNrZWRTdXBwbHk7DQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IHRva2VuczsgIC8vIHNhZmVBZGQgbm90IG5lZWRlZDsgYmFkIHNlbWFudGljcyB0byB1c2UgaGVyZQ0KDQogICAgICAgIC8vIExvZyB0aGUgY3JlYXRpb24gb2YgdGhpcyB0b2tlbnMNCiAgICAgICAgTG9nQ3JlYXRlTkVUKG1zZy5zZW5kZXIsIHRva2Vucyk7DQogICAgfQ0KDQoNCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBjdXJyZW50IHRva2VuIHByaWNlDQogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFRva2VuUHJpY2UoKQ0KICAgIHByaXZhdGUNCiAgICBjb25zdGFudA0KICAgIHJldHVybnMgKHVpbnQyNTYgY3VycmVudFByaWNlKQ0KICAgIHsNCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8IGV4Y2hhbmdlUmF0ZUNoYW5nZXNCbG9jaykgew0KICAgICAgICAgICAgcmV0dXJuIFRPS0VOX0ZJUlNUX0VYQ0hBTkdFX1JBVEU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gVE9LRU5fU0VDT05EX0VYQ0hBTkdFX1JBVEU7DQogICAgICAgIH0NCiAgICB9DQoNCg0KICAgIC8vLyBAZGV2IFJlZGVlbXMgTkVUcyBhbmQgcmVjb3JkcyB0aGUgTmltaXEgYWRkcmVzcyBvZiB0aGUgc2VuZGVyDQogICAgZnVuY3Rpb24gcmVkZWVtVG9rZW5zKGJ5dGVzMzIgbmltaXFBZGRyZXNzKQ0KICAgIGV4dGVybmFsDQogICAgaXNSZWRlZW1pbmcNCiAgICB7DQogICAgICAgIHVpbnQyNTYgbmV0VmFsID0gYmFsYW5jZXNbbXNnLnNlbmRlcl07DQogICAgICAgIHJlcXVpcmUobmV0VmFsID49IFRPS0VOX01JTik7IC8vIEF0IGxlYXN0IFRPS0VOX01JTiB0b2tlbnMgaGF2ZSB0byBiZSByZWRlZW1lZA0KDQogICAgICAgIC8vIE1vdmUgdGhlIHRva2VucyBvZiB0aGUgY2FsbGVyIHRvIE5pbWlxJ3MgYWRkcmVzcw0KICAgICAgICBpZiAoIXN1cGVyLnRyYW5zZmVyKGV0aEZ1bmREZXBvc2l0LCBuZXRWYWwpKSB0aHJvdzsNCg0KICAgICAgICAvLyBMb2cgdGhlIHJlZGVlbWluZyBvZiB0aGlzIHRva2Vucw0KICAgICAgICBMb2dSZWRlZW1ORVQobXNnLnNlbmRlciwgbmV0VmFsLCBuaW1pcUFkZHJlc3MpOw0KICAgIH0NCg0KDQogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHRyYW5zZmVyIGV0aGVyIGZyb20gdGhlIGNvbnRyYWN0IGFzIHNvb24gYXMgdGhlIG1pbmltdW0gaXMgcmVhY2hlZA0KICAgIGZ1bmN0aW9uIHJldHJpZXZlRXRoKHVpbnQyNTYgX3ZhbHVlKQ0KICAgIGV4dGVybmFsDQogICAgbWluaW11bVJlYWNoZWQNCiAgICBvbmx5T3duZXINCiAgICB7DQogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IHRoaXMuYmFsYW5jZSk7DQoNCiAgICAgICAgLy8gc2VuZCB0aGUgZXRoIHRvIE5pbWlxIENyZWF0b3JzDQogICAgICAgIGV0aEZ1bmREZXBvc2l0LnRyYW5zZmVyKF92YWx1ZSk7DQogICAgfQ0KDQoNCiAgICAvLy8gQGRldiBFbmRzIHRoZSBmdW5kcmFpc2luZyBwZXJpb2QgYW5kIHNlbmRzIHRoZSBFVEggdG8gdGhlIE11bHRpc2lnIHdhbGxldA0KICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkNCiAgICBleHRlcm5hbA0KICAgIGlzRnVuZHJhaXNpbmcNCiAgICBtaW5pbXVtUmVhY2hlZA0KICAgIG9ubHlPd25lciAvLyBPbmx5IHRoZSBvd25lciBvZiB0aGUgZXRoRnVuZERlcG9zaXQgYWRkcmVzcyBjYW4gZmluYWxpemUgdGhlIGNvbnRyYWN0DQogICAgew0KICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+IGZ1bmRpbmdFbmRCbG9jayB8fCB0b3RhbFN1cHBseSA+PSBUT0tFTl9DUkVBVElPTl9DQVAgfHwgdG90YWxSZWNlaXZlZEV0aCA+PSBFVEhfUkVDRUlWRURfQ0FQKTsgLy8gT25seSBhbGxvdyB0byBmaW5hbGl6ZSB0aGUgY29udHJhY3QgYmVmb3JlIHRoZSBlbmRpbmcgYmxvY2sgaWYgd2UgYWxyZWFkeSByZWFjaGVkIGFueSBvZiB0aGUgdHdvIGNhcHMNCg0KICAgICAgICAvLyBNb3ZlIHRoZSBjb250cmFjdCB0byBGaW5hbGl6ZWQgc3RhdGUNCiAgICAgICAgc3RhdGUgPSBDb250cmFjdFN0YXRlLkZpbmFsaXplZDsNCiAgICAgICAgc2F2ZWRTdGF0ZSA9IENvbnRyYWN0U3RhdGUuRmluYWxpemVkOw0KDQogICAgICAgIC8vIFNlbmQgdGhlIEVUSCB0byBOaW1pcSBDcmVhdG9ycw0KICAgICAgICBldGhGdW5kRGVwb3NpdC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOw0KICAgIH0NCg0KDQogICAgLy8vIEBkZXYgU3RhcnRzIHRoZSByZWRlZW1pbmcgcGVyaW9kDQogICAgZnVuY3Rpb24gc3RhcnRSZWRlZW1pbmcoKQ0KICAgIGV4dGVybmFsDQogICAgaXNGaW5hbGl6ZWQgLy8gVGhlIHJlZGVlbWluZyBwZXJpb2QgY2FuIG9ubHkgYmUgc3RhcnRlZCBhZnRlciB0aGUgY29udHJhY3QgaXMgZmluYWxpemVkDQogICAgb25seU93bmVyICAgLy8gT25seSB0aGUgb3duZXIgb2YgdGhlIGV0aEZ1bmREZXBvc2l0IGFkZHJlc3MgY2FuIHN0YXJ0IHRoZSByZWRlZW1pbmcgcGVyaW9kDQogICAgew0KICAgICAgICAvLyBNb3ZlIHRoZSBjb250cmFjdCB0byBSZWRlZW1pbmcgc3RhdGUNCiAgICAgICAgc3RhdGUgPSBDb250cmFjdFN0YXRlLlJlZGVlbWluZzsNCiAgICAgICAgc2F2ZWRTdGF0ZSA9IENvbnRyYWN0U3RhdGUuUmVkZWVtaW5nOw0KICAgIH0NCg0KDQogICAgLy8vIEBkZXYgUGF1c2VzIHRoZSBjb250cmFjdA0KICAgIGZ1bmN0aW9uIHBhdXNlKCkNCiAgICBleHRlcm5hbA0KICAgIG5vdFBhdXNlZCAgIC8vIFByZXZlbnQgdGhlIGNvbnRyYWN0IGdldHRpbmcgc3R1Y2sgaW4gdGhlIFBhdXNlZCBzdGF0ZQ0KICAgIG9ubHlPd25lciAgIC8vIE9ubHkgdGhlIG93bmVyIG9mIHRoZSBldGhGdW5kRGVwb3NpdCBhZGRyZXNzIGNhbiBwYXVzZSB0aGUgY29udHJhY3QNCiAgICB7DQogICAgICAgIC8vIE1vdmUgdGhlIGNvbnRyYWN0IHRvIFBhdXNlZCBzdGF0ZQ0KICAgICAgICBzYXZlZFN0YXRlID0gc3RhdGU7DQogICAgICAgIHN0YXRlID0gQ29udHJhY3RTdGF0ZS5QYXVzZWQ7DQogICAgfQ0KDQoNCiAgICAvLy8gQGRldiBQcm9jZWVkcyB3aXRoIHRoZSBjb250cmFjdA0KICAgIGZ1bmN0aW9uIHByb2NlZWQoKQ0KICAgIGV4dGVybmFsDQogICAgaXNQYXVzZWQNCiAgICBvbmx5T3duZXIgICAvLyBPbmx5IHRoZSBvd25lciBvZiB0aGUgZXRoRnVuZERlcG9zaXQgYWRkcmVzcyBjYW4gcHJvY2VlZCB3aXRoIHRoZSBjb250cmFjdA0KICAgIHsNCiAgICAgICAgLy8gTW92ZSB0aGUgY29udHJhY3QgdG8gdGhlIHByZXZpb3VzIHN0YXRlDQogICAgICAgIHN0YXRlID0gc2F2ZWRTdGF0ZTsNCiAgICB9DQoNCg0KICAgIC8vLyBAZGV2IEFsbG93cyBjb250cmlidXRvcnMgdG8gcmVjb3ZlciB0aGVpciBldGhlciBpbiBjYXNlIHRoZSBtaW5pbXVtIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZA0KICAgIGZ1bmN0aW9uIHJlZnVuZCgpDQogICAgZXh0ZXJuYWwNCiAgICBpc0Z1bmRyYWlzaW5nSWdub3JlUGF1c2VkIC8vIFJlZnVuZGluZyBpcyBvbmx5IHBvc3NpYmxlIGluIHRoZSBmdW5kcmFpc2luZyBwaGFzZSAobm8gbWF0dGVyIGlmIHBhdXNlZCkgYnkgZGVmaW5pdGlvbg0KICAgIHsNCiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPiBmdW5kaW5nRW5kQmxvY2spOyAvLyBQcmV2ZW50cyByZWZ1bmQgdW50aWwgZnVuZHJhaXNpbmcgcGVyaW9kIGlzIG92ZXINCiAgICAgICAgcmVxdWlyZSh0b3RhbFJlY2VpdmVkRXRoIDwgRVRIX1JFQ0VJVkVEX01JTik7ICAvLyBObyByZWZ1bmRzIGlmIHRoZSBtaW5pbXVtIGhhcyBiZWVuIHJlYWNoZWQNCg0KICAgICAgICB1aW50MjU2IG5ldFZhbCA9IGJhbGFuY2VzW21zZy5zZW5kZXJdOw0KICAgICAgICByZXF1aXJlKG5ldFZhbCA+IDApOw0KICAgICAgICB1aW50MjU2IGV0aFZhbCA9IGV0aEJhbGFuY2VzW21zZy5zZW5kZXJdOw0KICAgICAgICByZXF1aXJlKGV0aFZhbCA+IDApOw0KDQogICAgICAgIC8vIFVwZGF0ZSB0aGUgc3RhdGUgb25seSBhZnRlciBhbGwgdGhlIGNoZWNrcyBoYXZlIHBhc3NlZA0KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IDA7DQogICAgICAgIGV0aEJhbGFuY2VzW21zZy5zZW5kZXJdID0gMDsNCiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3VidHJhY3QodG90YWxTdXBwbHksIG5ldFZhbCk7IC8vIEV4dHJhIHNhZmUNCg0KICAgICAgICAvLyBMb2cgdGhpcyByZWZ1bmQNCiAgICAgICAgTG9nUmVmdW5kKG1zZy5zZW5kZXIsIGV0aFZhbCk7DQoNCiAgICAgICAgLy8gU2VuZCB0aGUgY29udHJpYnV0aW9ucyBvbmx5IGFmdGVyIHdlIGhhdmUgdXBkYXRlZCBhbGwgdGhlIGJhbGFuY2VzDQogICAgICAgIC8vIElmIHlvdSdyZSB1c2luZyBhIGNvbnRyYWN0LCBtYWtlIHN1cmUgaXQgd29ya3Mgd2l0aCAudHJhbnNmZXIoKSBnYXMgbGltaXRzDQogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXRoVmFsKTsNCiAgICB9DQp9'