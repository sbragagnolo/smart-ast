base 64 content
base64newHope
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCmxpYnJhcnkgU2FmZU1hdGggew0KICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICogYjsNCiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KICAgIHJldHVybiBjOw0KICB9DQogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiID4gMCk7DQogICAgdWludCBjID0gYSAvIGI7DQogICAgYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7DQogICAgcmV0dXJuIGM7DQogIH0NCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjID49IGEpOw0KICAgIHJldHVybiBjOw0KICB9DQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogIH0NCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgew0KICAgIGlmICghYXNzZXJ0aW9uKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogIH0NCn0NCmNvbnRyYWN0IE93bmFibGUgew0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KICAgIGZ1bmN0aW9uIE93bmFibGUoKSB7DQogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgICB9DQogICAgbW9kaWZpZXIgb25seU93bmVyIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgew0KICAgICAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgew0KICAgICAgICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICAgICAgfQ0KICAgIH0NCn0NCi8qDQogKiBQYXVzYWJsZQ0KICogQWJzdHJhY3QgY29udHJhY3QgdGhhdCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuDQogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uDQogKi8NCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgew0KICBib29sIHB1YmxpYyBzdG9wcGVkOw0KICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgew0KICAgIGlmIChzdG9wcGVkKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogICAgXzsNCiAgfQ0KICANCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsNCiAgICBpZiAoIXN0b3BwZWQpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICBfOw0KICB9DQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlDQogIGZ1bmN0aW9uIGVtZXJnZW5jeVN0b3AoKSBleHRlcm5hbCBvbmx5T3duZXIgew0KICAgIHN0b3BwZWQgPSB0cnVlOw0KICB9DQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUNCiAgZnVuY3Rpb24gcmVsZWFzZSgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgew0KICAgIHN0b3BwZWQgPSBmYWxzZTsNCiAgfQ0KfQ0KY29udHJhY3QgRVJDMjBCYXNpYyB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQp9DQpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KLyoNCiAqIFB1bGxQYXltZW50DQogKiBCYXNlIGNvbnRyYWN0IHN1cHBvcnRpbmcgYXN5bmMgc2VuZCBmb3IgcHVsbCBwYXltZW50cy4NCiAqIEluaGVyaXQgZnJvbSB0aGlzIGNvbnRyYWN0IGFuZCB1c2UgYXN5bmNTZW5kIGluc3RlYWQgb2Ygc2VuZC4NCiAqLw0KY29udHJhY3QgUHVsbFBheW1lbnQgew0KICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsNCiAgDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgcGF5bWVudHM7DQogIGV2ZW50IExvZ1JlZnVuZEVUSChhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsNCiAgLyoqDQogICogIFN0b3JlIHNlbnQgYW1vdW50IGFzIGNyZWRpdCB0byBiZSBwdWxsZWQsIGNhbGxlZCBieSBwYXllciANCiAgKiovDQogIGZ1bmN0aW9uIGFzeW5jU2VuZChhZGRyZXNzIGRlc3QsIHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7DQogICAgcGF5bWVudHNbZGVzdF0gPSBwYXltZW50c1tkZXN0XS5hZGQoYW1vdW50KTsNCiAgfQ0KICAvLyB3aXRoZHJhdyBhY2N1bXVsYXRlZCBiYWxhbmNlLCBjYWxsZWQgYnkgcGF5ZWUNCiAgZnVuY3Rpb24gd2l0aGRyYXdQYXltZW50cygpIHsNCiAgICBhZGRyZXNzIHBheWVlID0gbXNnLnNlbmRlcjsNCiAgICB1aW50IHBheW1lbnQgPSBwYXltZW50c1twYXllZV07DQogICAgDQogICAgaWYgKHBheW1lbnQgPT0gMCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICAgIGlmICh0aGlzLmJhbGFuY2UgPCBwYXltZW50KSB7DQogICAgICB0aHJvdzsNCiAgICB9DQogICAgcGF5bWVudHNbcGF5ZWVdID0gMDsNCiAgICBpZiAoIXBheWVlLnNlbmQocGF5bWVudCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICBMb2dSZWZ1bmRFVEgocGF5ZWUscGF5bWVudCk7DQogIH0NCn0NCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7DQogIA0KICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsNCiAgDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsNCiAgDQogIC8qDQogICAqIEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrICANCiAgKi8NCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgew0KICAgICBpZihtc2cuZGF0YS5sZW5ndGggPCBzaXplICsgNCkgew0KICAgICAgIHRocm93Ow0KICAgICB9DQogICAgIF87DQogIH0NCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKSB7DQogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsNCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsNCiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7DQogIH0NCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsNCiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgfQ0KfQ0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBCYXNpY1Rva2VuLCBFUkMyMCB7DQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgew0KICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07DQogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0DQogICAgLy8gaWYgKF92YWx1ZSA+IF9hbGxvd2FuY2UpIHRocm93Ow0KICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsNCiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7DQogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgfQ0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB7DQogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2ANCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdA0KICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOg0KICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQ0KICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgdGhyb3c7DQogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogIH0NCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgew0KICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICB9DQp9DQovKioNCiAqICBOZXdIb3BlIHRva2VuIGNvbnRyYWN0LiBJbXBsZW1lbnRzDQogKi8NCmNvbnRyYWN0IE5ld0hvcGUgaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7DQogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJOZXdIb3BlIjsNCiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiTmV3SCI7DQogIHVpbnQgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gNjsNCiAgLy8gQ29uc3RydWN0b3INCiAgZnVuY3Rpb24gTmV3SG9wZSgpIHsNCiAgICAgIHRvdGFsU3VwcGx5ID0gMTAwMDAwMDAwMDAwMDsvLzFNDQogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHRvdGFsU3VwcGx5OyAvLyBTZW5kIGFsbCB0b2tlbnMgdG8gb3duZXINCiAgfQ0KICAvKioNCiAgICogIEJ1cm4gYXdheSB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiBOZXdIb3BlIHRva2Vucw0KICAgKi8NCiAgZnVuY3Rpb24gYnVybih1aW50IF92YWx1ZSkgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsNCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOw0KICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKF92YWx1ZSk7DQogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgMHgwLCBfdmFsdWUpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQp9DQovKg0KICBDcm93ZHNhbGUgU21hcnQgQ29udHJhY3QgZm9yIHRoZSBOZXdIb3BlLm9yZyBwcm9qZWN0DQogIFRoaXMgc21hcnQgY29udHJhY3QgY29sbGVjdHMgRVRILCBhbmQgaW4gcmV0dXJuIGVtaXRzIE5ld0hvcGUgdG9rZW5zIHRvIHRoZSBiYWNrZXJzDQoqLw0KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIFBhdXNhYmxlLCBQdWxsUGF5bWVudCB7DQogICAgDQogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7DQogICAgc3RydWN0IEJhY2tlciB7DQogICAgICAgIHVpbnQgd2VpUmVjZWl2ZWQ7IC8vIEFtb3VudCBvZiBFdGhlciBnaXZlbg0KICAgICAgICB1aW50IGNvaW5TZW50Ow0KICAgIH0NCiAgICAvKg0KICAgICogQ29uc3RhbnRzDQogICAgKi8NCiAgICAvKiBNaW5pbXVtIG51bWJlciBvZiBOZXdIb3BlIHRvIHNlbGwgKi8NCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNSU5fQ0FQID0gNTAwMDAwMDAwMDA7IC8vIDUwLDAwMCBOZXdIb3Blcw0KICAgIC8qIE1heGltdW0gbnVtYmVyIG9mIE5ld0hvcGUgdG8gc2VsbCAqLw0KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWF9DQVAgPSA3MDAwMDAwMDAwMDA7IC8vIDcwMCwwMDAgTmV3SG9wZXMNCiAgICAvKiBNaW5pbXVtIGFtb3VudCB0byBpbnZlc3QgKi8NCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNSU5fSU5WRVNUX0VUSEVSID0gMTAwIGZpbm5leTsNCiAgICAvKiBDcm93ZHNhbGUgcGVyaW9kICovDQogICAgdWludCBwcml2YXRlIGNvbnN0YW50IENST1dEU0FMRV9QRVJJT0QgPSA1IGRheXM7DQogICAgLyogTnVtYmVyIG9mIE5ld0hvcGVzIHBlciBFdGhlciAqLw0KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IENPSU5fUEVSX0VUSEVSID0gOTAwMDAwMDAwMDsgLy8gOSwwMDAgTmV3SG9wZXMNCiAgICAvKg0KICAgICogVmFyaWFibGVzDQogICAgKi8NCiAgICAvKiBOZXdIb3BlIGNvbnRyYWN0IHJlZmVyZW5jZSAqLw0KICAgIE5ld0hvcGUgcHVibGljIGNvaW47DQogICAgLyogTXVsdGlzaWcgY29udHJhY3QgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIEV0aGVyICovDQogICAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdFdGhlcjsNCiAgICAvKiBOdW1iZXIgb2YgRXRoZXIgcmVjZWl2ZWQgKi8NCiAgICB1aW50IHB1YmxpYyBldGhlclJlY2VpdmVkOw0KICAgIC8qIE51bWJlciBvZiBOZXdIb3BlcyBzZW50IHRvIEV0aGVyIGNvbnRyaWJ1dG9ycyAqLw0KICAgIHVpbnQgcHVibGljIGNvaW5TZW50VG9FdGhlcjsNCiAgICAvKiBDcm93ZHNhbGUgc3RhcnQgdGltZSAqLw0KICAgIHVpbnQgcHVibGljIHN0YXJ0VGltZTsNCiAgICAvKiBDcm93ZHNhbGUgZW5kIHRpbWUgKi8NCiAgICB1aW50IHB1YmxpYyBlbmRUaW1lOw0KICAgIC8qIElzIGNyb3dkc2FsZSBzdGlsbCBvbiBnb2luZyAqLw0KICAgIGJvb2wgcHVibGljIGNyb3dkc2FsZUNsb3NlZDsNCiAgICAvKiBCYWNrZXJzIEV0aGVyIGluZGV4ZWQgYnkgdGhlaXIgRXRoZXJldW0gYWRkcmVzcyAqLw0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBCYWNrZXIpIHB1YmxpYyBiYWNrZXJzOw0KICAgIC8qDQogICAgKiBNb2RpZmllcnMNCiAgICAqLw0KICAgIG1vZGlmaWVyIG1pbkNhcE5vdFJlYWNoZWQoKSB7DQogICAgICAgIGlmICgobm93IDwgZW5kVGltZSkgfHwgY29pblNlbnRUb0V0aGVyID49IE1JTl9DQVAgKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQogICAgbW9kaWZpZXIgcmVzcGVjdFRpbWVGcmFtZSgpIHsNCiAgICAgICAgaWYgKChub3cgPCBzdGFydFRpbWUpIHx8IChub3cgPiBlbmRUaW1lICkpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCiAgICAvKg0KICAgICAqIEV2ZW50DQogICAgKi8NCiAgICBldmVudCBMb2dSZWNlaXZlZEVUSChhZGRyZXNzIGFkZHIsIHVpbnQgdmFsdWUpOw0KICAgIGV2ZW50IExvZ0NvaW5zRW1pdGVkKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50IGFtb3VudCk7DQogICAgLyoNCiAgICAgKiBDb25zdHJ1Y3Rvcg0KICAgICovDQogICAgZnVuY3Rpb24gQ3Jvd2RzYWxlKGFkZHJlc3MgX05ld0hvcGVBZGRyZXNzLCBhZGRyZXNzIF90bykgew0KICAgICAgICBjb2luID0gTmV3SG9wZShfTmV3SG9wZUFkZHJlc3MpOw0KICAgICAgICBtdWx0aXNpZ0V0aGVyID0gX3RvOw0KICAgIH0NCiAgICAvKiANCiAgICAgKiBUaGUgZmFsbGJhY2sgZnVuY3Rpb24gY29ycmVzcG9uZHMgdG8gYSBkb25hdGlvbiBpbiBFVEgNCiAgICAgKi8NCiAgICBmdW5jdGlvbigpIHN0b3BJbkVtZXJnZW5jeSByZXNwZWN0VGltZUZyYW1lIHBheWFibGUgew0KICAgICAgICByZWNlaXZlRVRIKG1zZy5zZW5kZXIpOw0KICAgIH0NCiAgICAvKiANCiAgICAgKiBUbyBjYWxsIHRvIHN0YXJ0IHRoZSBjcm93ZHNhbGUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdGFydCgpIG9ubHlPd25lciB7DQogICAgICAgIGlmIChzdGFydFRpbWUgIT0gMCkgdGhyb3c7IC8vIENyb3dkc2FsZSB3YXMgYWxyZWFkeSBzdGFydGVkDQogICAgICAgIHN0YXJ0VGltZSA9IG5vdyA7ICAgICAgICAgICAgDQogICAgICAgIGVuZFRpbWUgPSAgbm93ICsgQ1JPV0RTQUxFX1BFUklPRDsgICAgDQogICAgfQ0KICAgIC8qDQogICAgICogIFJlY2VpdmVzIGEgZG9uYXRpb24gaW4gRXRoZXINCiAgICAqLw0KICAgIGZ1bmN0aW9uIHJlY2VpdmVFVEgoYWRkcmVzcyBiZW5lZmljaWFyeSkgaW50ZXJuYWwgew0KICAgICAgICBpZiAobXNnLnZhbHVlIDwgTUlOX0lOVkVTVF9FVEhFUikgdGhyb3c7IC8vIERvbid0IGFjY2VwdCBmdW5kaW5nIHVuZGVyIGEgcHJlZGVmaW5lZCB0aHJlc2hvbGQNCiAgICAgICAgDQogICAgICAgIHVpbnQgY29pblRvU2VuZCA9IGJvbnVzKG1zZy52YWx1ZS5tdWwoQ09JTl9QRVJfRVRIRVIpLmRpdigxIGV0aGVyKSk7IC8vIENvbXB1dGUgdGhlIG51bWJlciBvZiBOZXdIb3BlIHRvIHNlbmQNCiAgICAgICAgaWYgKGNvaW5Ub1NlbmQuYWRkKGNvaW5TZW50VG9FdGhlcikgPiBNQVhfQ0FQKSB0aHJvdzsgICAgDQogICAgICAgIEJhY2tlciBiYWNrZXIgPSBiYWNrZXJzW2JlbmVmaWNpYXJ5XTsNCiAgICAgICAgY29pbi50cmFuc2ZlcihiZW5lZmljaWFyeSwgY29pblRvU2VuZCk7IC8vIFRyYW5zZmVyIE5ld0hvcGVzIHJpZ2h0IG5vdyANCiAgICAgICAgYmFja2VyLmNvaW5TZW50ID0gYmFja2VyLmNvaW5TZW50LmFkZChjb2luVG9TZW5kKTsNCiAgICAgICAgYmFja2VyLndlaVJlY2VpdmVkID0gYmFja2VyLndlaVJlY2VpdmVkLmFkZChtc2cudmFsdWUpOyAvLyBVcGRhdGUgdGhlIHRvdGFsIHdlaSBjb2xsZWN0ZWQgZHVyaW5nIHRoZSBjcm93ZGZ1bmRpbmcgZm9yIHRoaXMgYmFja2VyICAgIA0KICAgICAgICBldGhlclJlY2VpdmVkID0gZXRoZXJSZWNlaXZlZC5hZGQobXNnLnZhbHVlKTsgLy8gVXBkYXRlIHRoZSB0b3RhbCB3ZWkgY29sbGVjdGVkIGR1cmluZyB0aGUgY3Jvd2RmdW5kaW5nDQogICAgICAgIGNvaW5TZW50VG9FdGhlciA9IGNvaW5TZW50VG9FdGhlci5hZGQoY29pblRvU2VuZCk7DQogICAgICAgIC8vIFNlbmQgZXZlbnRzDQogICAgICAgIExvZ0NvaW5zRW1pdGVkKG1zZy5zZW5kZXIgLGNvaW5Ub1NlbmQpOw0KICAgICAgICBMb2dSZWNlaXZlZEVUSChiZW5lZmljaWFyeSwgZXRoZXJSZWNlaXZlZCk7IA0KICAgIH0NCiAgICANCiAgICAvKg0KICAgICAqQ29tcHV0ZSB0aGUgTmV3SG9wZSBib251cyBhY2NvcmRpbmcgdG8gdGhlIGludmVzdG1lbnQgcGVyaW9kDQogICAgICovDQogICAgZnVuY3Rpb24gYm9udXModWludCBhbW91bnQpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgaWYgKG5vdyA8IHN0YXJ0VGltZS5hZGQoMSBkYXlzKSkgcmV0dXJuIGFtb3VudC5hZGQoYW1vdW50LmRpdigyKSk7ICAgLy8gYm9udXMgNTAlDQogICAgICAgIHJldHVybiBhbW91bnQ7DQogICAgfQ0KICAgIC8qICANCiAgICAgKiBGaW5hbGl6ZSB0aGUgY3Jvd2RzYWxlLCBzaG91bGQgYmUgY2FsbGVkIGFmdGVyIHRoZSByZWZ1bmQgcGVyaW9kDQogICAgKi8NCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciBwdWJsaWMgew0KICAgICAgICBpZiAobm93IDwgZW5kVGltZSkgeyAvLyBDYW5ub3QgZmluYWxpc2UgYmVmb3JlIENST1dEU0FMRV9QRVJJT0Qgb3IgYmVmb3JlIHNlbGxpbmcgYWxsIGNvaW5zDQogICAgICAgICAgICBpZiAoY29pblNlbnRUb0V0aGVyID09IE1BWF9DQVApIHsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvaW5TZW50VG9FdGhlciA8IE1JTl9DQVAgJiYgbm93IDwgZW5kVGltZSArIDMgZGF5cykgdGhyb3c7IC8vIElmIE1JTl9DQVAgaXMgbm90IHJlYWNoZWQgZG9ub3JzIGhhdmUgMTVkYXlzIHRvIGdldCByZWZ1bmQgYmVmb3JlIHdlIGNhbiBmaW5hbGlzZQ0KICAgICAgICBpZiAoIW11bHRpc2lnRXRoZXIuc2VuZCh0aGlzLmJhbGFuY2UpKSB0aHJvdzsgLy8gTW92ZSB0aGUgcmVtYWluaW5nIEV0aGVyIHRvIHRoZSBtdWx0aXNpZyBhZGRyZXNzDQogICAgICAgIA0KICAgICAgICB1aW50IHJlbWFpbnMgPSBjb2luLmJhbGFuY2VPZih0aGlzKTsNCiAgICAgICAgaWYgKHJlbWFpbnMgPiAwKSB7IC8vIEJ1cm4gdGhlIHJlc3Qgb2YgTmV3SG9wZXMNCiAgICAgICAgICAgIGlmICghY29pbi5idXJuKHJlbWFpbnMpKSB0aHJvdyA7DQogICAgICAgIH0NCiAgICAgICAgY3Jvd2RzYWxlQ2xvc2VkID0gdHJ1ZTsNCiAgICB9DQogICAgLyogIA0KICAgICogRmFpbHNhZmUgZHJhaW4NCiAgICAqLw0KICAgIGZ1bmN0aW9uIGRyYWluKCkgb25seU93bmVyIHsNCiAgICAgICAgaWYgKCFvd25lci5zZW5kKHRoaXMuYmFsYW5jZSkpIHRocm93Ow0KICAgIH0NCiAgICAvKioNCiAgICAgKiBBbGxvdyB0byBjaGFuZ2UgdGhlIHRlYW0gbXVsdGlzaWcgYWRkcmVzcyBpbiB0aGUgY2FzZSBvZiBlbWVyZ2VuY3kuDQogICAgICovDQogICAgZnVuY3Rpb24gc2V0TXVsdGlzaWcoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgcHVibGljIHsNCiAgICAgICAgaWYgKGFkZHIgPT0gYWRkcmVzcygwKSkgdGhyb3c7DQogICAgICAgIG11bHRpc2lnRXRoZXIgPSBhZGRyOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBNYW51YWxseSBiYWNrIE5ld0hvcGUgb3duZXIgYWRkcmVzcy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiYWNrTmV3SG9wZU93bmVyKCkgb25seU93bmVyIHB1YmxpYyB7DQogICAgICAgIGNvaW4udHJhbnNmZXJPd25lcnNoaXAob3duZXIpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBUcmFuc2ZlciByZW1haW5zIHRvIG93bmVyIGluIGNhc2UgaWYgaW1wb3NzaWJsZSB0byBkbyBtaW4gaW52ZXN0DQogICAgICovDQogICAgZnVuY3Rpb24gZ2V0UmVtYWluQ29pbnMoKSBvbmx5T3duZXIgcHVibGljIHsNCiAgICAgICAgdmFyIHJlbWFpbnMgPSBNQVhfQ0FQIC0gY29pblNlbnRUb0V0aGVyOw0KICAgICAgICB1aW50IG1pbkNvaW5zVG9TZWxsID0gYm9udXMoTUlOX0lOVkVTVF9FVEhFUi5tdWwoQ09JTl9QRVJfRVRIRVIpIC8gKDEgZXRoZXIpKTsNCiAgICAgICAgaWYocmVtYWlucyA+IG1pbkNvaW5zVG9TZWxsKSB0aHJvdzsNCiAgICAgICAgQmFja2VyIGJhY2tlciA9IGJhY2tlcnNbb3duZXJdOw0KICAgICAgICBjb2luLnRyYW5zZmVyKG93bmVyLCByZW1haW5zKTsgLy8gVHJhbnNmZXIgTmV3SG9wZXMgcmlnaHQgbm93IA0KICAgICAgICBiYWNrZXIuY29pblNlbnQgPSBiYWNrZXIuY29pblNlbnQuYWRkKHJlbWFpbnMpOw0KICAgICAgICBjb2luU2VudFRvRXRoZXIgPSBjb2luU2VudFRvRXRoZXIuYWRkKHJlbWFpbnMpOw0KICAgICAgICAvLyBTZW5kIGV2ZW50cw0KICAgICAgICBMb2dDb2luc0VtaXRlZCh0aGlzICxyZW1haW5zKTsNCiAgICAgICAgTG9nUmVjZWl2ZWRFVEgob3duZXIsIGV0aGVyUmVjZWl2ZWQpOyANCiAgICB9DQogICAgLyogDQogICAgICogV2hlbiBNSU5fQ0FQIGlzIG5vdCByZWFjaDoNCiAgICAgKiAxKSBiYWNrZXIgY2FsbCB0aGUgImFwcHJvdmUiIGZ1bmN0aW9uIG9mIHRoZSBOZXdIb3BlIHRva2VuIGNvbnRyYWN0IHdpdGggdGhlIGFtb3VudCBvZiBhbGwgTmV3SG9wZXMgdGhleSBnb3QgaW4gb3JkZXIgdG8gYmUgcmVmdW5kDQogICAgICogMikgYmFja2VyIGNhbGwgdGhlICJyZWZ1bmQiIGZ1bmN0aW9uIG9mIHRoZSBDcm93ZHNhbGUgY29udHJhY3Qgd2l0aCB0aGUgc2FtZSBhbW91bnQgb2YgTmV3SG9wZXMNCiAgICAgKiAzKSBiYWNrZXIgY2FsbCB0aGUgIndpdGhkcmF3UGF5bWVudHMiIGZ1bmN0aW9uIG9mIHRoZSBDcm93ZHNhbGUgY29udHJhY3QgdG8gZ2V0IGEgcmVmdW5kIGluIEVUSA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlZnVuZCh1aW50IF92YWx1ZSkgbWluQ2FwTm90UmVhY2hlZCBwdWJsaWMgew0KICAgICAgICANCiAgICAgICAgaWYgKF92YWx1ZSAhPSBiYWNrZXJzW21zZy5zZW5kZXJdLmNvaW5TZW50KSB0aHJvdzsgLy8gY29tcGFyZSB2YWx1ZSBmcm9tIGJhY2tlciBiYWxhbmNlDQogICAgICAgIGNvaW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIGFkZHJlc3ModGhpcyksIF92YWx1ZSk7IC8vIGdldCB0aGUgdG9rZW4gYmFjayB0byB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0DQogICAgICAgIGlmICghY29pbi5idXJuKF92YWx1ZSkpIHRocm93IDsgLy8gdG9rZW4gc2VudCBmb3IgcmVmdW5kIGFyZSBidXJudA0KICAgICAgICB1aW50IEVUSFRvU2VuZCA9IGJhY2tlcnNbbXNnLnNlbmRlcl0ud2VpUmVjZWl2ZWQ7DQogICAgICAgIGJhY2tlcnNbbXNnLnNlbmRlcl0ud2VpUmVjZWl2ZWQ9MDsNCiAgICAgICAgaWYgKEVUSFRvU2VuZCA+IDApIHsNCiAgICAgICAgICAgIGFzeW5jU2VuZChtc2cuc2VuZGVyLCBFVEhUb1NlbmQpOyAvLyBwdWxsIHBheW1lbnQgdG8gZ2V0IHJlZnVuZCBpbiBFVEgNCiAgICAgICAgfQ0KICAgIH0NCn0='