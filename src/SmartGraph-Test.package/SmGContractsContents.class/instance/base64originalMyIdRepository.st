base 64 content
base64originalMyIdRepository
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMDsNCg0KY29udHJhY3QgYWNjZXNzQ29udHJvbGxlZCB7DQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCiAgICBmdW5jdGlvbiBvd25lZCgpIHsNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG9ubHlPd25lciB7DQogICAgICAgIGlmICggbXNnLnNlbmRlciAhPSBvd25lciApIHRocm93Ow0KICAgICAgICAvKiBvIGNhcmFjdGVyICJfIiAmIzIzMzsgc3Vic3RpdHUmIzIzNztkbyBwZWxvIGNvcnBvIGRhIGZ1bmNhbyBvbmRlIG8gbW9kaWZpZXIgJiMyMzM7IHV0aWxpemFkbyAqLw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKCBhZGRyZXNzIG5ld093bmVyICkgb25seU93bmVyIHsNCiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICB9DQoNCn0NCg0KY29udHJhY3QgT3JpZ2luYWxNeUlkUmVwb3NpdG9yeSBpcyBhY2Nlc3NDb250cm9sbGVkew0KICAgIHVzaW5nIHN0cmluZ3MgZm9yICo7DQoNCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFVzZXJzOw0KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsV2FsbGV0czsNCiAgICBpZFJlcG9zaXRvcnlbXSBwdWJsaWMgdXNlcklkczsNCg0KICAgIG1hcHBpbmcgKCB1aW50MjU2ID0+IHVpbnQyNTYgKSBwdWJsaWMgdXNlcklkSW5kZXg7DQoJbWFwcGluZyAoIHN0cmluZyA9PiB1aW50MjU2ICkgIHVzZXJCeVdhbGxldDsNCiAgICAvL21hcHBpbmcgKCB1aW50MjU2ID0+IHN0cmluZ1tdICkgcHVibGljIHdhbGxldHNGcm9tVXNlcjsNCg0KDQogICAgc3RydWN0IGlkUmVwb3NpdG9yeSB7DQogICAgICAgIHVpbnQyNTYgdXNlcklkOw0KICAgICAgICBzdHJpbmdbXSB1c2VyV2FsbGV0czsNCiAgICB9DQoNCglldmVudCBVc2VyKCB1aW50MjU2IGlkICk7DQoJZXZlbnQgQ2hlY2tVc2VyQnlXYWxsZXQoIHVpbnQyNTYgaWQgKTsNCiAgICBldmVudCBTaG93TGFzdFdhbGxldCggc3RyaW5nIHdhbGxldCApOw0KICAgIGV2ZW50IExvZ1MoIHN0cmluZyB0ZXh0ICk7DQogICAgZXZlbnQgTG9nTiggdWludCBudW1iZXIgKTsNCg0KCWZ1bmN0aW9uIE9yaWdpbmFsTXlJZFJlcG9zaXRvcnkoKSB7DQoJCW93bmVyID0gbXNnLnNlbmRlcjsNCgkJbmV3VXNlciggMCwgJ0ludmFsaWQgaW5kZXggMCcgKTsNCgkJdG90YWxVc2VycyAtPSAxOw0KCQl0b3RhbFdhbGxldHMgLT0gMTsNCgl9DQoNCiAgICAvKiBDcmlhciB1c3UmIzIyNTtyaW8gb3UgYWRpY2lvbmFyIHdhbGxldCBhIHVzdWFyaW8gZXhpc3RlbnRlICovDQogICAgZnVuY3Rpb24gbmV3VXNlciggdWludDI1NiBpZCwgc3RyaW5nIHdhbGxldCApIG9ubHlPd25lciByZXR1cm5zICggYm9vbCApIHsNCiAgICAgICAgaWYgKCB1c2VyQnlXYWxsZXRbd2FsbGV0XSA+IDAgKSB0aHJvdzsNCg0KICAgICAgICB1aW50IHVzZXJJbmRleDsNCiAgICAgICAgaWYgKCB1c2VySWRJbmRleFtpZF0gPiAwICkgew0KICAgICAgICAgICAgdXNlckluZGV4ID0gdXNlcklkSW5kZXhbaWRdOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdXNlckluZGV4ID0gdXNlcklkcy5sZW5ndGgrKzsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWRSZXBvc2l0b3J5IGkgPSB1c2VySWRzW3VzZXJJbmRleF07DQogICAgICAgIA0KICAgICAgICBpZiAoIHVzZXJJZEluZGV4W2lkXSA9PSAwICl7DQogICAgICAgICAgICBpLnVzZXJJZCA9IGlkOw0KICAgICAgICAgICAgdXNlcklkSW5kZXhbaWRdID0gdXNlckluZGV4Ow0KICAgICAgICAgICAgdG90YWxVc2VycysrOw0KICAgICAgICB9DQoNCiAgICAgICAgc3RyaW5nW10gd2FsbGV0TGlzdCA9IGkudXNlcldhbGxldHM7IA0KICAgICAgICB1aW50IHcgPSB3YWxsZXRMaXN0Lmxlbmd0aCsrOw0KICAgICAgICBpZiAoIHVzZXJCeVdhbGxldFt3YWxsZXRdID4gMCApIHRocm93Ow0KICAgICAgICBpLnVzZXJXYWxsZXRzW3ddID0gd2FsbGV0Ow0KICAgICAgICB1c2VyQnlXYWxsZXRbd2FsbGV0XSA9IGlkOw0KICAgICAgICAvL3dhbGxldHNGcm9tVXNlcltpZF0gPSBpLnVzZXJXYWxsZXRzOw0KICAgICAgICB0b3RhbFdhbGxldHMrKzsNCg0KICAgICAgICBVc2VyKGlkKTsNCg0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gY2hlY2tVc2VyQnlXYWxsZXQoIHN0cmluZyB3YWxsZXQgKSByZXR1cm5zICggdWludDI1NiApIHsNCiAgICAgICAgdWludDI1NiB1c2VySWQgPSB1c2VyQnlXYWxsZXRbd2FsbGV0XTsNCiAgICAgICAgQ2hlY2tVc2VyQnlXYWxsZXQoIHVzZXJJZCApOw0KICAgICAgICByZXR1cm4gdXNlcklkOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldExhc3RXYWxsZXQoIHVpbnQyNTYgaWQgKSByZXR1cm5zICggc3RyaW5nICkgew0KICAgICAgICB1aW50IHVzZXJJbmRleCA9IHVzZXJJZEluZGV4W2lkXTsNCiAgICAgICAgaWRSZXBvc2l0b3J5IGkgPSB1c2VySWRzW3VzZXJJbmRleF07DQogICAgICAgIHJldHVybiBpLnVzZXJXYWxsZXRzW2kudXNlcldhbGxldHMubGVuZ3RoLTFdOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldFdhbGxldHNGcm9tVXNlciggdWludDI1NiBpZCApIHJldHVybnMgKHN0cmluZyB3YWxsZXRzKXsNCiAgICAgICAgc3RyaW5nIG1lbW9yeSBzZXBhcmF0b3I7DQogICAgICAgIHNlcGFyYXRvciA9ICcsJzsNCiAgICAgICAgdWludCB1c2VySW5kZXggPSB1c2VySWRJbmRleFtpZF07DQogICAgICAgIGlkUmVwb3NpdG9yeSBpID0gdXNlcklkc1t1c2VySW5kZXhdOw0KICAgICAgICBmb3IgKHVpbnQgaj0wOyBqIDwgaS51c2VyV2FsbGV0cy5sZW5ndGg7IGorKyl7DQogICAgICAgICAgICBTaG93TGFzdFdhbGxldCggaS51c2VyV2FsbGV0c1tqXSApOw0KICAgICAgICAgICAgaWYgKGogPiAwICkgd2FsbGV0cyA9IHdhbGxldHMudG9TbGljZSgpLmNvbmNhdChzZXBhcmF0b3IudG9TbGljZSgpKTsNCiAgICAgICAgICAgIHdhbGxldHMgPSB3YWxsZXRzLnRvU2xpY2UoKS5jb25jYXQoaS51c2VyV2FsbGV0c1tqXS50b1NsaWNlKCkpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBpc1dhbGxldEZyb21Vc2VyKCB1aW50MjU2IGlkLCBzdHJpbmcgd2FsbGV0ICkgcmV0dXJucyAoIGJvb2wgKXsNCiAgICAgICAgaWYgKCB1c2VyQnlXYWxsZXRbd2FsbGV0XSA9PSBpZCApIHJldHVybiB0cnVlOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQoNCiAgICAvKiBTZSB0ZW50YXJlbSBlbnZpYXIgZXRoZXIgcGFyYSBvIGVuZCBkZXNzZSBjb250cmF0bywgZWxlIHJlamVpdGEgKi8NCiAgICBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCn0NCg0KLyoNCiAqIEB0aXRsZSBTdHJpbmcgJiBzbGljZSB1dGlsaXR5IGxpYnJhcnkgZm9yIFNvbGlkaXR5IGNvbnRyYWN0cy4NCiAqIEBhdXRob3IgTmljayBKb2huc29uIDxhcmFjaG5pZEBub3Rkb3QubmV0Pg0KICoNCiAqIEBkZXYgRnVuY3Rpb25hbGl0eSBpbiB0aGlzIGxpYnJhcnkgaXMgbGFyZ2VseSBpbXBsZW1lbnRlZCB1c2luZyBhbg0KICogICAgICBhYnN0cmFjdGlvbiBjYWxsZWQgYSAnc2xpY2UnLiBBIHNsaWNlIHJlcHJlc2VudHMgYSBwYXJ0IG9mIGEgc3RyaW5nIC0NCiAqICAgICAgYW55dGhpbmcgZnJvbSB0aGUgZW50aXJlIHN0cmluZyB0byBhIHNpbmdsZSBjaGFyYWN0ZXIsIG9yIGV2ZW4gbm8NCiAqICAgICAgY2hhcmFjdGVycyBhdCBhbGwgKGEgMC1sZW5ndGggc2xpY2UpLiBTaW5jZSBhIHNsaWNlIG9ubHkgaGFzIHRvIHNwZWNpZnkNCiAqICAgICAgYW4gb2Zmc2V0IGFuZCBhIGxlbmd0aCwgY29weWluZyBhbmQgbWFuaXB1bGF0aW5nIHNsaWNlcyBpcyBhIGxvdCBsZXNzDQogKiAgICAgIGV4cGVuc2l2ZSB0aGFuIGNvcHlpbmcgYW5kIG1hbmlwdWxhdGluZyB0aGUgc3RyaW5ncyB0aGV5IHJlZmVyZW5jZS4NCiAqDQogKiAgICAgIFRvIGZ1cnRoZXIgcmVkdWNlIGdhcyBjb3N0cywgbW9zdCBmdW5jdGlvbnMgb24gc2xpY2UgdGhhdCBuZWVkIHRvIHJldHVybg0KICogICAgICBhIHNsaWNlIG1vZGlmeSB0aGUgb3JpZ2luYWwgb25lIGluc3RlYWQgb2YgYWxsb2NhdGluZyBhIG5ldyBvbmU7IGZvcg0KICogICAgICBpbnN0YW5jZSwgYHMuc3BsaXQoIi4iKWAgd2lsbCByZXR1cm4gdGhlIHRleHQgdXAgdG8gdGhlIGZpcnN0ICcuJywNCiAqICAgICAgbW9kaWZ5aW5nIHMgdG8gb25seSBjb250YWluIHRoZSByZW1haW5kZXIgb2YgdGhlIHN0cmluZyBhZnRlciB0aGUgJy4nLg0KICogICAgICBJbiBzaXR1YXRpb25zIHdoZXJlIHlvdSBkbyBub3Qgd2FudCB0byBtb2RpZnkgdGhlIG9yaWdpbmFsIHNsaWNlLCB5b3UNCiAqICAgICAgY2FuIG1ha2UgYSBjb3B5IGZpcnN0IHdpdGggYC5jb3B5KClgLCBmb3IgZXhhbXBsZToNCiAqICAgICAgYHMuY29weSgpLnNwbGl0KCIuIilgLiBUcnkgYW5kIGF2b2lkIHVzaW5nIHRoaXMgaWRpb20gaW4gbG9vcHM7IHNpbmNlDQogKiAgICAgIFNvbGlkaXR5IGhhcyBubyBtZW1vcnkgbWFuYWdlbWVudCwgaXQgd2lsbCByZXN1bHQgaW4gYWxsb2NhdGluZyBtYW55DQogKiAgICAgIHNob3J0LWxpdmVkIHNsaWNlcyB0aGF0IGFyZSBsYXRlciBkaXNjYXJkZWQuDQogKg0KICogICAgICBGdW5jdGlvbnMgdGhhdCByZXR1cm4gdHdvIHNsaWNlcyBjb21lIGluIHR3byB2ZXJzaW9uczogYSBub24tYWxsb2NhdGluZw0KICogICAgICB2ZXJzaW9uIHRoYXQgdGFrZXMgdGhlIHNlY29uZCBzbGljZSBhcyBhbiBhcmd1bWVudCwgbW9kaWZ5aW5nIGl0IGluDQogKiAgICAgIHBsYWNlLCBhbmQgYW4gYWxsb2NhdGluZyB2ZXJzaW9uIHRoYXQgYWxsb2NhdGVzIGFuZCByZXR1cm5zIHRoZSBzZWNvbmQNCiAqICAgICAgc2xpY2U7IHNlZSBgbmV4dFJ1bmVgIGZvciBleGFtcGxlLg0KICoNCiAqICAgICAgRnVuY3Rpb25zIHRoYXQgaGF2ZSB0byBjb3B5IHN0cmluZyBkYXRhIHdpbGwgcmV0dXJuIHN0cmluZ3MgcmF0aGVyIHRoYW4NCiAqICAgICAgc2xpY2VzOyB0aGVzZSBjYW4gYmUgY2FzdCBiYWNrIHRvIHNsaWNlcyBmb3IgZnVydGhlciBwcm9jZXNzaW5nIGlmDQogKiAgICAgIHJlcXVpcmVkLg0KICoNCiAqICAgICAgRm9yIGNvbnZlbmllbmNlLCBzb21lIGZ1bmN0aW9ucyBhcmUgcHJvdmlkZWQgd2l0aCBub24tbW9kaWZ5aW5nDQogKiAgICAgIHZhcmlhbnRzIHRoYXQgY3JlYXRlIGEgbmV3IHNsaWNlIGFuZCByZXR1cm4gYm90aDsgZm9yIGluc3RhbmNlLA0KICogICAgICBgcy5zcGxpdE5ldygnLicpYCBsZWF2ZXMgcyB1bm1vZGlmaWVkLCBhbmQgcmV0dXJucyB0d28gdmFsdWVzDQogKiAgICAgIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGxlZnQgYW5kIHJpZ2h0IHBhcnRzIG9mIHRoZSBzdHJpbmcuDQogKi8NCnByYWdtYSBzb2xpZGl0eSBeMC40LjEwOw0KDQpsaWJyYXJ5IHN0cmluZ3Mgew0KICAgIHN0cnVjdCBzbGljZSB7DQogICAgICAgIHVpbnQgX2xlbjsNCiAgICAgICAgdWludCBfcHRyOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSB7DQogICAgICAgIC8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlDQogICAgICAgIGZvcig7IGxlbiA+PSAzMjsgbGVuIC09IDMyKSB7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG1sb2FkKHNyYykpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBkZXN0ICs9IDMyOw0KICAgICAgICAgICAgc3JjICs9IDMyOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ29weSByZW1haW5pbmcgYnl0ZXMNCiAgICAgICAgdWludCBtYXNrID0gMjU2ICoqICgzMiAtIGxlbikgLSAxOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoc3JjKSwgbm90KG1hc2spKQ0KICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChkZXN0KSwgbWFzaykNCiAgICAgICAgICAgIG1zdG9yZShkZXN0LCBvcihkZXN0cGFydCwgc3JjcGFydCkpDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHN0cmluZyB0byBtYWtlIGEgc2xpY2UgZnJvbS4NCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuDQogICAgICovDQogICAgZnVuY3Rpb24gdG9TbGljZShzdHJpbmcgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgdWludCBwdHI7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZiwgMHgyMCkNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2xpY2UoYnl0ZXMoc2VsZikubGVuZ3RoLCBwdHIpOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgYSBudWxsLXRlcm1pbmF0ZWQgYnl0ZXMzMiBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHZhbHVlIHRvIGZpbmQgdGhlIGxlbmd0aCBvZi4NCiAgICAgKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHN0cmluZywgZnJvbSAwIHRvIDMyLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxlbihieXRlczMyIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdWludCByZXQ7DQogICAgICAgIGlmIChzZWxmID09IDApDQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmID09IDApIHsNCiAgICAgICAgICAgIHJldCArPSAxNjsNCiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDg7DQogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDAwMDAwMDAwMCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmID09IDApIHsNCiAgICAgICAgICAgIHJldCArPSA0Ow0KICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZiA9PSAwKSB7DQogICAgICAgICAgICByZXQgKz0gMjsNCiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDE7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIDMyIC0gcmV0Ow0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIGJ5dGVzMzIsIGludGVycHJldGVkIGFzIGENCiAgICAgKiAgICAgIG51bGwtdGVybWludGFlZCB1dGYtOCBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGJ5dGVzMzIgdmFsdWUgdG8gY29udmVydCB0byBhIHNsaWNlLg0KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgdmFsdWUgb2YgdGhlIGlucHV0IGFyZ3VtZW50IHVwIHRvIHRoZQ0KICAgICAqICAgICAgICAgZmlyc3QgbnVsbC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0b1NsaWNlQjMyKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7DQogICAgICAgIC8vIEFsbG9jYXRlIHNwYWNlIGZvciBgc2VsZmAgaW4gbWVtb3J5LCBjb3B5IGl0IHRoZXJlLCBhbmQgcG9pbnQgcmV0IGF0IGl0DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIGxldCBwdHIgOj0gbWxvYWQoMHg0MCkNCiAgICAgICAgICAgIG1zdG9yZSgweDQwLCBhZGQocHRyLCAweDIwKSkNCiAgICAgICAgICAgIG1zdG9yZShwdHIsIHNlbGYpDQogICAgICAgICAgICBtc3RvcmUoYWRkKHJldCwgMHgyMCksIHB0cikNCiAgICAgICAgfQ0KICAgICAgICByZXQuX2xlbiA9IGxlbihzZWxmKTsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgUmV0dXJucyBhIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgdGhlIGN1cnJlbnQgc2xpY2UuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuDQogICAgICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNvcHkoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgcmV0dXJuIHNsaWNlKHNlbGYuX2xlbiwgc2VsZi5fcHRyKTsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgQ29waWVzIGEgc2xpY2UgdG8gYSBuZXcgc3RyaW5nLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5Lg0KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNsaWNlJ3MgdGV4dC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0b1N0cmluZyhzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuKTsNCiAgICAgICAgdWludCByZXRwdHI7DQogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9DQoNCiAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggaW4gcnVuZXMgb2YgdGhlIHNsaWNlLiBOb3RlIHRoYXQgdGhpcyBvcGVyYXRpb24NCiAgICAgKiAgICAgIHRha2VzIHRpbWUgcHJvcG9ydGlvbmFsIHRvIHRoZSBsZW5ndGggb2YgdGhlIHNsaWNlOyBhdm9pZCB1c2luZyBpdA0KICAgICAqICAgICAgaW4gbG9vcHMsIGFuZCBjYWxsIGBzbGljZS5lbXB0eSgpYCBpZiB5b3Ugb25seSBuZWVkIHRvIGtub3cgd2hldGhlcg0KICAgICAqICAgICAgdGhlIHNsaWNlIGlzIGVtcHR5IG9yIG5vdC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHNsaWNlIGluIHJ1bmVzLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxlbihzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIC8vIFN0YXJ0aW5nIGF0IHB0ci0zMSBtZWFucyB0aGUgTFNCIHdpbGwgYmUgdGhlIGJ5dGUgd2UgY2FyZSBhYm91dA0KICAgICAgICB2YXIgcHRyID0gc2VsZi5fcHRyIC0gMzE7DQogICAgICAgIHZhciBlbmQgPSBwdHIgKyBzZWxmLl9sZW47DQogICAgICAgIGZvciAodWludCBsZW4gPSAwOyBwdHIgPCBlbmQ7IGxlbisrKSB7DQogICAgICAgICAgICB1aW50OCBiOw0KICAgICAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChwdHIpLCAweEZGKSB9DQogICAgICAgICAgICBpZiAoYiA8IDB4ODApIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gMTsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSAyOw0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDM7DQogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjgpIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gNDsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGQykgew0KICAgICAgICAgICAgICAgIHB0ciArPSA1Ow0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gNjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbGVuOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5IChoYXMgYSBsZW5ndGggb2YgMCkuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSwgRmFsc2Ugb3RoZXJ3aXNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVtcHR5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIHNlbGYuX2xlbiA9PSAwOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIGEgcG9zaXRpdmUgbnVtYmVyIGlmIGBvdGhlcmAgY29tZXMgbGV4aWNvZ3JhcGhpY2FsbHkgYWZ0ZXINCiAgICAgKiAgICAgIGBzZWxmYCwgYSBuZWdhdGl2ZSBudW1iZXIgaWYgaXQgY29tZXMgYmVmb3JlLCBvciB6ZXJvIGlmIHRoZQ0KICAgICAqICAgICAgY29udGVudHMgb2YgdGhlIHR3byBzbGljZXMgYXJlIGVxdWFsLiBDb21wYXJpc29uIGlzIGRvbmUgcGVyLXJ1bmUsDQogICAgICogICAgICBvbiB1bmljb2RlIGNvZGVwb2ludHMuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuDQogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29tcGFyZS4NCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHQgb2YgdGhlIGNvbXBhcmlzb24uDQogICAgICovDQogICAgZnVuY3Rpb24gY29tcGFyZShzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQogICAgICAgIHVpbnQgc2hvcnRlc3QgPSBzZWxmLl9sZW47DQogICAgICAgIGlmIChvdGhlci5fbGVuIDwgc2VsZi5fbGVuKQ0KICAgICAgICAgICAgc2hvcnRlc3QgPSBvdGhlci5fbGVuOw0KDQogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyOw0KICAgICAgICB2YXIgb3RoZXJwdHIgPSBvdGhlci5fcHRyOw0KICAgICAgICBmb3IgKHVpbnQgaWR4ID0gMDsgaWR4IDwgc2hvcnRlc3Q7IGlkeCArPSAzMikgew0KICAgICAgICAgICAgdWludCBhOw0KICAgICAgICAgICAgdWludCBiOw0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIGEgOj0gbWxvYWQoc2VsZnB0cikNCiAgICAgICAgICAgICAgICBiIDo9IG1sb2FkKG90aGVycHRyKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGEgIT0gYikgew0KICAgICAgICAgICAgICAgIC8vIE1hc2sgb3V0IGlycmVsZXZhbnQgYnl0ZXMgYW5kIGNoZWNrIGFnYWluDQogICAgICAgICAgICAgICAgdWludCBtYXNrID0gfigyICoqICg4ICogKDMyIC0gc2hvcnRlc3QgKyBpZHgpKSAtIDEpOw0KICAgICAgICAgICAgICAgIHZhciBkaWZmID0gKGEgJiBtYXNrKSAtIChiICYgbWFzayk7DQogICAgICAgICAgICAgICAgaWYgKGRpZmYgIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChkaWZmKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNlbGZwdHIgKz0gMzI7DQogICAgICAgICAgICBvdGhlcnB0ciArPSAzMjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaW50KHNlbGYuX2xlbikgLSBpbnQob3RoZXIuX2xlbik7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgdHdvIHNsaWNlcyBjb250YWluIHRoZSBzYW1lIHRleHQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2VzIGFyZSBlcXVhbCwgZmFsc2Ugb3RoZXJ3aXNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVxdWFscyhzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gY29tcGFyZShzZWxmLCBvdGhlcikgPT0gMDsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgRXh0cmFjdHMgdGhlIGZpcnN0IHJ1bmUgaW4gdGhlIHNsaWNlIGludG8gYHJ1bmVgLCBhZHZhbmNpbmcgdGhlDQogICAgICogICAgICBzbGljZSB0byBwb2ludCB0byB0aGUgbmV4dCBydW5lIGFuZCByZXR1cm5pbmcgYHNlbGZgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEBwYXJhbSBydW5lIFRoZSBzbGljZSB0aGF0IHdpbGwgY29udGFpbiB0aGUgZmlyc3QgcnVuZS4NCiAgICAgKiBAcmV0dXJuIGBydW5lYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmLCBzbGljZSBydW5lKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICBydW5lLl9wdHIgPSBzZWxmLl9wdHI7DQoNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7DQogICAgICAgICAgICBydW5lLl9sZW4gPSAwOw0KICAgICAgICAgICAgcmV0dXJuIHJ1bmU7DQogICAgICAgIH0NCg0KICAgICAgICB1aW50IGxlbjsNCiAgICAgICAgdWludCBiOw0KICAgICAgICAvLyBMb2FkIHRoZSBmaXJzdCBieXRlIG9mIHRoZSBydW5lIGludG8gdGhlIExTQnMgb2YgYg0KICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHN1YihtbG9hZChhZGQoc2VsZiwgMzIpKSwgMzEpKSwgMHhGRikgfQ0KICAgICAgICBpZiAoYiA8IDB4ODApIHsNCiAgICAgICAgICAgIGxlbiA9IDE7DQogICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgew0KICAgICAgICAgICAgbGVuID0gMjsNCiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7DQogICAgICAgICAgICBsZW4gPSAzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbGVuID0gNDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cw0KICAgICAgICBpZiAobGVuID4gc2VsZi5fbGVuKSB7DQogICAgICAgICAgICBydW5lLl9sZW4gPSBzZWxmLl9sZW47DQogICAgICAgICAgICBzZWxmLl9wdHIgKz0gc2VsZi5fbGVuOw0KICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsNCiAgICAgICAgICAgIHJldHVybiBydW5lOw0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5fcHRyICs9IGxlbjsNCiAgICAgICAgc2VsZi5fbGVuIC09IGxlbjsNCiAgICAgICAgcnVuZS5fbGVuID0gbGVuOw0KICAgICAgICByZXR1cm4gcnVuZTsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUgZmlyc3QgcnVuZSBpbiB0aGUgc2xpY2UsIGFkdmFuY2luZyB0aGUgc2xpY2UgdG8gcG9pbnQNCiAgICAgKiAgICAgIHRvIHRoZSBuZXh0IHJ1bmUuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHJldHVybiBBIHNsaWNlIGNvbnRhaW5pbmcgb25seSB0aGUgZmlyc3QgcnVuZSBmcm9tIGBzZWxmYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsNCiAgICAgICAgbmV4dFJ1bmUoc2VsZiwgcmV0KTsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEByZXR1cm4gVGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBvcmQoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCByZXQpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIHVpbnQgd29yZDsNCiAgICAgICAgdWludCBsZW47DQogICAgICAgIHVpbnQgZGl2ID0gMiAqKiAyNDg7DQoNCiAgICAgICAgLy8gTG9hZCB0aGUgcnVuZSBpbnRvIHRoZSBNU0JzIG9mIGINCiAgICAgICAgYXNzZW1ibHkgeyB3b3JkOj0gbWxvYWQobWxvYWQoYWRkKHNlbGYsIDMyKSkpIH0NCiAgICAgICAgdmFyIGIgPSB3b3JkIC8gZGl2Ow0KICAgICAgICBpZiAoYiA8IDB4ODApIHsNCiAgICAgICAgICAgIHJldCA9IGI7DQogICAgICAgICAgICBsZW4gPSAxOw0KICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsNCiAgICAgICAgICAgIHJldCA9IGIgJiAweDFGOw0KICAgICAgICAgICAgbGVuID0gMjsNCiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7DQogICAgICAgICAgICByZXQgPSBiICYgMHgwRjsNCiAgICAgICAgICAgIGxlbiA9IDM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXQgPSBiICYgMHgwNzsNCiAgICAgICAgICAgIGxlbiA9IDQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMNCiAgICAgICAgaWYgKGxlbiA+IHNlbGYuX2xlbikgew0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPCBsZW47IGkrKykgew0KICAgICAgICAgICAgZGl2ID0gZGl2IC8gMjU2Ow0KICAgICAgICAgICAgYiA9ICh3b3JkIC8gZGl2KSAmIDB4RkY7DQogICAgICAgICAgICBpZiAoYiAmIDB4QzAgIT0gMHg4MCkgew0KICAgICAgICAgICAgICAgIC8vIEludmFsaWQgVVRGLTggc2VxdWVuY2UNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldCA9IChyZXQgKiA2NCkgfCAoYiAmIDB4M0YpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUga2VjY2FrLTI1NiBoYXNoIG9mIHRoZSBzbGljZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gaGFzaC4NCiAgICAgKiBAcmV0dXJuIFRoZSBoYXNoIG9mIHRoZSBzbGljZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBrZWNjYWsoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiByZXQpIHsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgcmV0IDo9IHNoYTMobWxvYWQoYWRkKHNlbGYsIDMyKSksIG1sb2FkKHNlbGYpKQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuDQogICAgICovDQogICAgZnVuY3Rpb24gc3RhcnRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5fcHRyID09IG5lZWRsZS5fcHRyKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGJvb2wgZXF1YWw7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQ0KICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCiAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGVxdWFsOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBJZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUNCiAgICAgKiAgICAgIGJlZ2lubmluZyBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIGBzZWxmYA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJleW9uZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIH0NCg0KICAgICAgICBib29sIGVxdWFsID0gdHJ1ZTsNCiAgICAgICAgaWYgKHNlbGYuX3B0ciAhPSBuZWVkbGUuX3B0cikgew0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KICAgICAgICAgICAgICAgIGxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkNCiAgICAgICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQ0KICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZXF1YWwpIHsNCiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSBuZWVkbGUuX2xlbjsNCiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHNsaWNlIGVuZHMgd2l0aCBgbmVlZGxlYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBlbmRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOw0KDQogICAgICAgIGlmIChzZWxmcHRyID09IG5lZWRsZS5fcHRyKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGJvb2wgZXF1YWw7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCiAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gZXF1YWw7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IElmIGBzZWxmYCBlbmRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUNCiAgICAgKiAgICAgIGVuZCBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIGBzZWxmYA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHVudGlsKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47DQogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOw0KICAgICAgICBpZiAoc2VsZnB0ciAhPSBuZWVkbGUuX3B0cikgew0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KICAgICAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpDQogICAgICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChlcXVhbCkgew0KICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KDQogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YNCiAgICAvLyBgbmVlZGxlYCBpbiBgc2VsZmAsIG9yIHRoZSBmaXJzdCBieXRlIGFmdGVyIGBzZWxmYCBpZiBub3QgZm91bmQuDQogICAgZnVuY3Rpb24gZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdWludCBwdHI7DQogICAgICAgIHVpbnQgaWR4Ow0KDQogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgew0KICAgICAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSAzMikgew0KICAgICAgICAgICAgICAgIC8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjggZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MNCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgICAgIGxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpDQogICAgICAgICAgICAgICAgICAgIGxldCBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKQ0KICAgICAgICAgICAgICAgICAgICBsZXQgZW5kIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHNlbGZwdHINCiAgICAgICAgICAgICAgICAgICAgbG9vcDoNCiAgICAgICAgICAgICAgICAgICAganVtcGkoZXhpdCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChwdHIsIDEpDQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGx0KHN1YihwdHIsIDEpLCBlbmQpKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHNlbGZsZW4pDQogICAgICAgICAgICAgICAgICAgIGV4aXQ6DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nDQogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgaGFzaCA6PSBzaGEzKG5lZWRsZXB0ciwgbmVlZGxlbGVuKSB9DQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0cjsNCiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8PSBzZWxmbGVuIC0gbmVlZGxlbGVuOyBpZHgrKykgew0KICAgICAgICAgICAgICAgICAgICBieXRlczMyIHRlc3RIYXNoOw0KICAgICAgICAgICAgICAgICAgICBhc3NlbWJseSB7IHRlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHRyOw0KICAgICAgICAgICAgICAgICAgICBwdHIgKz0gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHNlbGZwdHIgKyBzZWxmbGVuOw0KICAgIH0NCg0KICAgIC8vIFJldHVybnMgdGhlIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBmaXJzdCBieXRlIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YNCiAgICAvLyBgbmVlZGxlYCBpbiBgc2VsZmAsIG9yIHRoZSBhZGRyZXNzIG9mIGBzZWxmYCBpZiBub3QgZm91bmQuDQogICAgZnVuY3Rpb24gcmZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHVpbnQgcHRyOw0KDQogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgew0KICAgICAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSAzMikgew0KICAgICAgICAgICAgICAgIC8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjkgZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MNCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgICAgIGxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpDQogICAgICAgICAgICAgICAgICAgIGxldCBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQ0KICAgICAgICAgICAgICAgICAgICBsb29wOg0KICAgICAgICAgICAgICAgICAgICBqdW1waShyZXQsIGVxKGFuZChtbG9hZChwdHIpLCBtYXNrKSwgbmVlZGxlZGF0YSkpDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzdWIocHRyLCAxKQ0KICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBndChhZGQocHRyLCAxKSwgc2VsZnB0cikpDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzZWxmcHRyDQogICAgICAgICAgICAgICAgICAgIGp1bXAoZXhpdCkNCiAgICAgICAgICAgICAgICAgICAgcmV0Og0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgbmVlZGxlbGVuKQ0KICAgICAgICAgICAgICAgICAgICBleGl0Og0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gcHRyOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZw0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgaGFzaDsNCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQ0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHIgKyAoc2VsZmxlbiAtIG5lZWRsZWxlbik7DQogICAgICAgICAgICAgICAgd2hpbGUgKHB0ciA+PSBzZWxmcHRyKSB7DQogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7DQogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgdGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbikgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaCA9PSB0ZXN0SGFzaCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHIgKyBuZWVkbGVsZW47DQogICAgICAgICAgICAgICAgICAgIHB0ciAtPSAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2VsZnB0cjsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gZXZlcnl0aGluZyBmcm9tIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mDQogICAgICogICAgICBgbmVlZGxlYCB0byB0aGUgZW5kIG9mIHRoZSBzbGljZS4gYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UNCiAgICAgKiAgICAgIGlmIGBuZWVkbGVgIGlzIG5vdCBmb3VuZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQogICAgICAgIHNlbGYuX2xlbiAtPSBwdHIgLSBzZWxmLl9wdHI7DQogICAgICAgIHNlbGYuX3B0ciA9IHB0cjsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIHRoZSBwYXJ0IG9mIHRoZSBzdHJpbmcgZnJvbSB0aGUgc3RhcnQgb2YNCiAgICAgKiAgICAgIGBzZWxmYCB0byB0aGUgZW5kIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLiBJZiBgbmVlZGxlYA0KICAgICAqICAgICAgaXMgbm90IGZvdW5kLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJmaW5kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCiAgICAgICAgc2VsZi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QNCiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZg0KICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwNCiAgICAgKiAgICAgIGFuZCBgdG9rZW5gIGlzIHNldCB0byB0aGUgZW50aXJldHkgb2YgYHNlbGZgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEBwYXJhbSB0b2tlbiBBbiBvdXRwdXQgcGFyYW1ldGVyIHRvIHdoaWNoIHRoZSBmaXJzdCB0b2tlbiBpcyB3cml0dGVuLg0KICAgICAqIEByZXR1cm4gYHRva2VuYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQogICAgICAgIHRva2VuLl9wdHIgPSBzZWxmLl9wdHI7DQogICAgICAgIHRva2VuLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7DQogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7DQogICAgICAgICAgICAvLyBOb3QgZm91bmQNCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOw0KICAgICAgICAgICAgc2VsZi5fcHRyID0gcHRyICsgbmVlZGxlLl9sZW47DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRva2VuOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdA0KICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYNCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsDQogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCB1cCB0byB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgZGVsaW1gLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsNCiAgICAgICAgc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIHRoZSBsYXN0DQogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZg0KICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwNCiAgICAgKiAgICAgIGFuZCBgdG9rZW5gIGlzIHNldCB0byB0aGUgZW50aXJldHkgb2YgYHNlbGZgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEBwYXJhbSB0b2tlbiBBbiBvdXRwdXQgcGFyYW1ldGVyIHRvIHdoaWNoIHRoZSBmaXJzdCB0b2tlbiBpcyB3cml0dGVuLg0KICAgICAqIEByZXR1cm4gYHRva2VuYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiByc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCiAgICAgICAgdG9rZW4uX3B0ciA9IHB0cjsNCiAgICAgICAgdG9rZW4uX2xlbiA9IHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpOw0KICAgICAgICBpZiAocHRyID09IHNlbGYuX3B0cikgew0KICAgICAgICAgICAgLy8gTm90IGZvdW5kDQogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdG9rZW47DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIHRoZSBsYXN0DQogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuIElmDQogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLA0KICAgICAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZiBgZGVsaW1gLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHRva2VuKSB7DQogICAgICAgIHJzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqIEBkZXYgQ291bnRzIHRoZSBudW1iZXIgb2Ygbm9ub3ZlcmxhcHBpbmcgb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgaW4gYHNlbGZgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgZm91bmQgaW4gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNvdW50KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAodWludCBjb3VudCkgew0KICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgd2hpbGUgKHB0ciA8PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsNCiAgICAgICAgICAgIGNvdW50Kys7DQogICAgICAgICAgICBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpLCBwdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBSZXR1cm5zIFRydWUgaWYgYHNlbGZgIGNvbnRhaW5zIGBuZWVkbGVgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYG5lZWRsZWAgaXMgZm91bmQgaW4gYHNlbGZgLCBmYWxzZSBvdGhlcndpc2UuDQogICAgICovDQogICAgZnVuY3Rpb24gY29udGFpbnMoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSAhPSBzZWxmLl9wdHI7DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGNvbmNhdGVuYXRpb24gb2YNCiAgICAgKiAgICAgIGBzZWxmYCBhbmQgYG90aGVyYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29uY2F0ZW5hdGUuDQogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29uY2F0ZW5hdGUuDQogICAgICogQHJldHVybiBUaGUgY29uY2F0ZW5hdGlvbiBvZiB0aGUgdHdvIHN0cmluZ3MuDQogICAgICovDQogICAgZnVuY3Rpb24gY29uY2F0KHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuICsgb3RoZXIuX2xlbik7DQogICAgICAgIHVpbnQgcmV0cHRyOw0KICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQ0KICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7DQogICAgICAgIG1lbWNweShyZXRwdHIgKyBzZWxmLl9sZW4sIG90aGVyLl9wdHIsIG90aGVyLl9sZW4pOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIC8qDQogICAgICogQGRldiBKb2lucyBhbiBhcnJheSBvZiBzbGljZXMsIHVzaW5nIGBzZWxmYCBhcyBhIGRlbGltaXRlciwgcmV0dXJuaW5nIGENCiAgICAgKiAgICAgIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGRlbGltaXRlciB0byB1c2UuDQogICAgICogQHBhcmFtIHBhcnRzIEEgbGlzdCBvZiBzbGljZXMgdG8gam9pbi4NCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIGFsbCB0aGUgc2xpY2VzIGluIGBwYXJ0c2AsDQogICAgICogICAgICAgICBqb2luZWQgd2l0aCBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gam9pbihzbGljZSBzZWxmLCBzbGljZVtdIHBhcnRzKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgcmV0dXJuICIiOw0KDQogICAgICAgIHVpbnQgbGVuID0gc2VsZi5fbGVuICogKHBhcnRzLmxlbmd0aCAtIDEpOw0KICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgbGVuICs9IHBhcnRzW2ldLl9sZW47DQoNCiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcobGVuKTsNCiAgICAgICAgdWludCByZXRwdHI7DQogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9DQoNCiAgICAgICAgZm9yKGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHBhcnRzW2ldLl9wdHIsIHBhcnRzW2ldLl9sZW4pOw0KICAgICAgICAgICAgcmV0cHRyICs9IHBhcnRzW2ldLl9sZW47DQogICAgICAgICAgICBpZiAoaSA8IHBhcnRzLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7DQogICAgICAgICAgICAgICAgcmV0cHRyICs9IHNlbGYuX2xlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KfQ=='