base 64 content
base64passCommitteeRoom
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQovKg0KVGhpcyBmaWxlIGlzIHBhcnQgb2YgUGFzcyBEQU8uDQoNClBhc3MgREFPIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uDQoNClBhc3MgREFPIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQpidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZg0KTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBsZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KYWxvbmcgd2l0aCBQYXNzIERBTy4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4NCiovDQoNCi8qDQpTbWFydCBjb250cmFjdCBmb3IgYSBEZWNlbnRyYWxpemVkIEF1dG9ub21vdXMgT3JnYW5pemF0aW9uIChEQU8pDQp0byBhdXRvbWF0ZSBvcmdhbml6YXRpb25hbCBnb3Zlcm5hbmNlIGFuZCBkZWNpc2lvbi1tYWtpbmcuDQoqLw0KDQovLy8gQHRpdGxlIFBhc3MgRGFvIHNtYXJ0IGNvbnRyYWN0DQpjb250cmFjdCBQYXNzRGFvIHsNCiAgICANCiAgICBzdHJ1Y3QgcmV2aXNpb24gew0KICAgICAgICAvLyBBZGRyZXNzIG9mIHRoZSBDb21taXR0ZWUgUm9vbSBzbWFydCBjb250cmFjdA0KICAgICAgICBhZGRyZXNzIGNvbW1pdHRlZVJvb207DQogICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIHNoYXJlIG1hbmFnZXIgc21hcnQgY29udHJhY3QNCiAgICAgICAgYWRkcmVzcyBzaGFyZU1hbmFnZXI7DQogICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIHRva2VuIG1hbmFnZXIgc21hcnQgY29udHJhY3QNCiAgICAgICAgYWRkcmVzcyB0b2tlbk1hbmFnZXI7DQogICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIHByb2plY3QgY3JlYXRvciBzbWFydCBjb250cmFjdA0KICAgICAgICB1aW50IHN0YXJ0RGF0ZTsNCiAgICB9DQogICAgLy8gVGhlIHJldmlzaW9ucyBvZiB0aGUgYXBwbGljYXRpb24gdW50aWwgdG9kYXkNCiAgICByZXZpc2lvbltdIHB1YmxpYyByZXZpc2lvbnM7DQoNCiAgICBzdHJ1Y3QgcHJvamVjdCB7DQogICAgICAgIC8vIFRoZSBhZGRyZXNzIG9mIHRoZSBzbWFydCBjb250cmFjdA0KICAgICAgICBhZGRyZXNzIGNvbnRyYWN0QWRkcmVzczsNCiAgICAgICAgLy8gVGhlIHVuaXggZWZmZWN0aXZlIHN0YXJ0IGRhdGUgb2YgdGhlIGNvbnRyYWN0DQogICAgICAgIHVpbnQgc3RhcnREYXRlOw0KICAgIH0NCiAgICAvLyBUaGUgcHJvamVjdHMgb2YgdGhlIERhbw0KICAgIHByb2plY3RbXSBwdWJsaWMgcHJvamVjdHM7DQoNCiAgICAvLyBNYXAgd2l0aCB0aGUgaW5kZXhlcyBvZiB0aGUgcHJvamVjdHMNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHByb2plY3RJRDsNCiAgICANCiAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgbWV0YSBwcm9qZWN0DQogICAgYWRkcmVzcyBtZXRhUHJvamVjdDsNCg0KICAgIA0KLy8gRXZlbnRzDQoNCiAgICBldmVudCBVcGdyYWRlKHVpbnQgaW5kZXhlZCBSZXZpc2lvbklELCBhZGRyZXNzIENvbW1pdHRlZVJvb20sIGFkZHJlc3MgU2hhcmVNYW5hZ2VyLCBhZGRyZXNzIFRva2VuTWFuYWdlcik7DQogICAgZXZlbnQgTmV3UHJvamVjdChhZGRyZXNzIFByb2plY3QpOw0KDQovLyBDb25zdGFudCBmdW5jdGlvbnMgIA0KICAgIA0KICAgIC8vLyBAcmV0dXJuIFRoZSBlZmZlY3RpdmUgY29tbWl0dGVlIHJvb20NCiAgICBmdW5jdGlvbiBBY3R1YWxDb21taXR0ZWVSb29tKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgew0KICAgICAgICByZXR1cm4gcmV2aXNpb25zWzBdLmNvbW1pdHRlZVJvb207DQogICAgfQ0KICAgIA0KICAgIC8vLyBAcmV0dXJuIFRoZSBtZXRhIHByb2plY3QNCiAgICBmdW5jdGlvbiBNZXRhUHJvamVjdCgpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsNCiAgICAgICAgcmV0dXJuIG1ldGFQcm9qZWN0Ow0KICAgIH0NCg0KICAgIC8vLyBAcmV0dXJuIFRoZSBlZmZlY3RpdmUgc2hhcmUgbWFuYWdlcg0KICAgIGZ1bmN0aW9uIEFjdHVhbFNoYXJlTWFuYWdlcigpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsNCiAgICAgICAgcmV0dXJuIHJldmlzaW9uc1swXS5zaGFyZU1hbmFnZXI7DQogICAgfQ0KDQogICAgLy8vIEByZXR1cm4gVGhlIGVmZmVjdGl2ZSB0b2tlbiBtYW5hZ2VyDQogICAgZnVuY3Rpb24gQWN0dWFsVG9rZW5NYW5hZ2VyKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgew0KICAgICAgICByZXR1cm4gcmV2aXNpb25zWzBdLnRva2VuTWFuYWdlcjsNCiAgICB9DQoNCi8vIG1vZGlmaWVycw0KDQogICAgbW9kaWZpZXIgb25seVBhc3NDb21taXR0ZWVSb29tIHtpZiAobXNnLnNlbmRlciAhPSByZXZpc2lvbnNbMF0uY29tbWl0dGVlUm9vbSAgDQogICAgICAgICYmIHJldmlzaW9uc1swXS5jb21taXR0ZWVSb29tICE9IDApIHRocm93OyBfO30NCiAgICANCi8vIENvbnN0cnVjdG9yIGZ1bmN0aW9uDQoNCiAgICBmdW5jdGlvbiBQYXNzRGFvKCkgew0KICAgICAgICBwcm9qZWN0cy5sZW5ndGggPSAxOw0KICAgICAgICByZXZpc2lvbnMubGVuZ3RoID0gMTsNCiAgICB9DQogICAgDQovLyBSZWdpc3RlciBmdW5jdGlvbnMNCg0KICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRvIGFsbG93IHRoZSBhY3R1YWwgQ29tbWl0dGVlIFJvb20gdXBncmFkaW5nIHRoZSBhcHBsaWNhdGlvbg0KICAgIC8vLyBAcGFyYW0gX25ld0NvbW1pdHRlZVJvb20gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBjb21taXR0ZWUgcm9vbQ0KICAgIC8vLyBAcGFyYW0gX25ld1NoYXJlTWFuYWdlciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IHNoYXJlIG1hbmFnZXINCiAgICAvLy8gQHBhcmFtIF9uZXdUb2tlbk1hbmFnZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBtYW5hZ2VyDQogICAgLy8vIEByZXR1cm4gVGhlIGluZGV4IG9mIHRoZSByZXZpc2lvbg0KICAgIGZ1bmN0aW9uIHVwZ3JhZGUoDQogICAgICAgIGFkZHJlc3MgX25ld0NvbW1pdHRlZVJvb20sIA0KICAgICAgICBhZGRyZXNzIF9uZXdTaGFyZU1hbmFnZXIsIA0KICAgICAgICBhZGRyZXNzIF9uZXdUb2tlbk1hbmFnZXIpIG9ubHlQYXNzQ29tbWl0dGVlUm9vbSByZXR1cm5zICh1aW50KSB7DQogICAgICAgIA0KICAgICAgICB1aW50IF9yZXZpc2lvbklEID0gcmV2aXNpb25zLmxlbmd0aCsrOw0KICAgICAgICByZXZpc2lvbiByID0gcmV2aXNpb25zW19yZXZpc2lvbklEXTsNCg0KICAgICAgICBpZiAoX25ld0NvbW1pdHRlZVJvb20gIT0gMCkgci5jb21taXR0ZWVSb29tID0gX25ld0NvbW1pdHRlZVJvb207IGVsc2Ugci5jb21taXR0ZWVSb29tID0gcmV2aXNpb25zWzBdLmNvbW1pdHRlZVJvb207DQogICAgICAgIGlmIChfbmV3U2hhcmVNYW5hZ2VyICE9IDApIHIuc2hhcmVNYW5hZ2VyID0gX25ld1NoYXJlTWFuYWdlcjsgZWxzZSByLnNoYXJlTWFuYWdlciA9IHJldmlzaW9uc1swXS5zaGFyZU1hbmFnZXI7DQogICAgICAgIGlmIChfbmV3VG9rZW5NYW5hZ2VyICE9IDApIHIudG9rZW5NYW5hZ2VyID0gX25ld1Rva2VuTWFuYWdlcjsgZWxzZSByLnRva2VuTWFuYWdlciA9IHJldmlzaW9uc1swXS50b2tlbk1hbmFnZXI7DQoNCiAgICAgICAgci5zdGFydERhdGUgPSBub3c7DQogICAgICAgIA0KICAgICAgICByZXZpc2lvbnNbMF0gPSByOw0KICAgICAgICANCiAgICAgICAgVXBncmFkZShfcmV2aXNpb25JRCwgX25ld0NvbW1pdHRlZVJvb20sIF9uZXdTaGFyZU1hbmFnZXIsIF9uZXdUb2tlbk1hbmFnZXIpOw0KICAgICAgICAgICAgDQogICAgICAgIHJldHVybiBfcmV2aXNpb25JRDsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBGdW5jdGlvbiB0byBzZXQgdGhlIG1ldGEgcHJvamVjdA0KICAgIC8vLyBAcGFyYW0gX3Byb2plY3RBZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBtZXRhIHByb2plY3QNCiAgICBmdW5jdGlvbiBhZGRNZXRhUHJvamVjdChhZGRyZXNzIF9wcm9qZWN0QWRkcmVzcykgb25seVBhc3NDb21taXR0ZWVSb29tIHsNCg0KICAgICAgICBtZXRhUHJvamVjdCA9IF9wcm9qZWN0QWRkcmVzczsNCiAgICB9DQogICAgDQogICAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gYWxsb3cgdGhlIGNvbW1pdHRlZSByb29tIHRvIGFkZCBhIHByb2plY3Qgd2hlbiBvcmRlcmluZw0KICAgIC8vLyBAcGFyYW0gX3Byb2plY3RBZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBwcm9qZWN0DQogICAgZnVuY3Rpb24gYWRkUHJvamVjdChhZGRyZXNzIF9wcm9qZWN0QWRkcmVzcykgb25seVBhc3NDb21taXR0ZWVSb29tIHsNCg0KICAgICAgICBpZiAocHJvamVjdElEW19wcm9qZWN0QWRkcmVzc10gPT0gMCkgew0KDQogICAgICAgICAgICB1aW50IF9wcm9qZWN0SUQgPSBwcm9qZWN0cy5sZW5ndGgrKzsNCiAgICAgICAgICAgIHByb2plY3QgcCA9IHByb2plY3RzW19wcm9qZWN0SURdOw0KICAgICAgICANCiAgICAgICAgICAgIHByb2plY3RJRFtfcHJvamVjdEFkZHJlc3NdID0gX3Byb2plY3RJRDsNCiAgICAgICAgICAgIHAuY29udHJhY3RBZGRyZXNzID0gX3Byb2plY3RBZGRyZXNzOyANCiAgICAgICAgICAgIHAuc3RhcnREYXRlID0gbm93Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICBOZXdQcm9qZWN0KF9wcm9qZWN0QWRkcmVzcyk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQp9DQoNCnByYWdtYSBzb2xpZGl0eSBeMC40Ljg7DQoNCi8qDQogKg0KICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUGFzcyBEQU8uDQogKg0KICogVGhlIE1hbmFnZXIgc21hcnQgY29udHJhY3QgaXMgdXNlZCBmb3IgdGhlIG1hbmFnZW1lbnQgb2Ygc2hhcmVzIGFuZCB0b2tlbnMuDQogKg0KKi8NCg0KLy8vIEB0aXRsZSBUb2tlbiBNYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IG9mIHRoZSBQYXNzIERlY2VudHJhbGl6ZWQgQXV0b25vbW91cyBPcmdhbmlzYXRpb24NCmNvbnRyYWN0IFBhc3NUb2tlbk1hbmFnZXJJbnRlcmZhY2Ugew0KDQogICAgLy8gVGhlIFBhc3MgRGFvIHNtYXJ0IGNvbnRyYWN0DQogICAgUGFzc0RhbyBwdWJsaWMgcGFzc0RhbzsNCiAgICAvLyBUaGUgYWRyZXNzIG9mIHRoZSBjcmVhdG9yIG9mIHRoaXMgc21hcnQgY29udHJhY3QNCiAgICBhZGRyZXNzIGNyZWF0b3I7DQogICAgDQogICAgLy8gVGhlIHRva2VuIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZQ0KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsNCiAgICAvLyBUaGUgdG9rZW4gc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2UNCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsNCiAgICAvLyBUaGUgcXVhbnRpdHkgb2YgZGVjaW1hbHMgZm9yIGRpc3BsYXkgcHVycG9zZQ0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsNCiAgICAvLyBUb3RhbCBhbW91bnQgb2YgdG9rZW5zDQogICAgdWludDI1NiB0b3RhbFRva2VuU3VwcGx5Ow0KDQogICAgLy8gVHJ1ZSBpZiB0b2tlbnMsIGZhbHNlIGlmIERhbyBzaGFyZXMNCiAgICBib29sIHRva2VuOw0KICAgIC8vIElmIHRydWUsIHRoZSBzaGFyZXMgb3IgdG9rZW5zIGNhbiBiZSB0cmFuc2ZlcnJlZA0KICAgIGJvb2wgdHJhbnNmZXJhYmxlOw0KDQogICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIGxhc3QgTWFuYWdlciBiZWZvcmUgY2xvbmluZw0KICAgIGFkZHJlc3MgcHVibGljIGNsb25lZEZyb207DQogICAgLy8gVHJ1ZSBpZiB0aGUgaW5pdGlhbCB0b2tlbiBzdXBwbHkgaXMgb3Zlcg0KICAgIGJvb2wgaW5pdGlhbFRva2VuU3VwcGx5RG9uZTsNCg0KICAgIC8vIEFycmF5IG9mIHRva2VuIG9yIHNoYXJlIGhvbGRlcnMgKHVzZWQgZm9yIGNsb25pbmcpDQogICAgYWRkcmVzc1tdIGhvbGRlcnM7DQogICAgLy8gTWFwIHdpdGggdGhlIGluZGV4ZXMgb2YgdGhlIGhvbGRlcnMgKHVzZWQgZm9yIGNsb25pbmcpDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBob2xkZXJJRDsNCiAgICANCiAgICAvLyBBcnJheSB3aXRoIGFsbCBiYWxhbmNlcw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7DQogICAgLy8gQXJyYXkgd2l0aCBhbGwgYWxsb3dhbmNlcw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsNCg0KICAgIHN0cnVjdCBmdW5kaW5nIHsNCiAgICAgICAgLy8gVGhlIGFkZHJlc3Mgd2hpY2ggc2V0cyBwYXJ0bmVycyBhbmQgbWFuYWdlcyB0aGUgZnVuZGluZyAobm90IG1hbmRhdG9yeSkNCiAgICAgICAgYWRkcmVzcyBtb2RlcmF0b3I7DQogICAgICAgIC8vIFRoZSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIGZ1bmRpbmcNCiAgICAgICAgdWludCBhbW91bnRUb0Z1bmQ7DQogICAgICAgIC8vIFRoZSBmdW5kZWQgYW1vdW50IChpbiB3ZWkpDQogICAgICAgIHVpbnQgZnVuZGVkQW1vdW50Ow0KICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgc3RhcnQgdGltZSBvZiB0aGUgZnVuZGluZw0KICAgICAgICB1aW50IHN0YXJ0VGltZTsgDQogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBjbG9zaW5nIHRpbWUgb2YgdGhlIGZ1bmRpbmcNCiAgICAgICAgdWludCBjbG9zaW5nVGltZTsgIA0KICAgICAgICAvLyBUaGUgcHJpY2UgbXVsdGlwbGllciBmb3IgYSBzaGFyZSBvciBhIHRva2VuIHdpdGhvdXQgY29uc2lkZXJpbmcgdGhlIGluZmxhdGlvbiByYXRlDQogICAgICAgIHVpbnQgaW5pdGlhbFByaWNlTXVsdGlwbGllcjsNCiAgICAgICAgLy8gUmF0ZSBwZXIgeWVhciBpbiBwZXJjZW50YWdlIGFwcGxpZWQgdG8gdGhlIHNoYXJlIG9yIHRva2VuIHByaWNlIA0KICAgICAgICB1aW50IGluZmxhdGlvblJhdGU7IA0KICAgICAgICAvLyBUaGUgdG90YWwgYW1vdW50IG9mIHdlaSBnaXZlbg0KICAgICAgICB1aW50IHRvdGFsV2VpR2l2ZW47DQogICAgfSANCiAgICAvLyBNYXAgd2l0aCB0aGUgZnVuZGluZ3MgcnVsZXMgZm9yIGVhY2ggRGFvIHByb3Bvc2FsDQogICAgbWFwcGluZyAodWludCA9PiBmdW5kaW5nKSBwdWJsaWMgZnVuZGluZ3M7DQoNCiAgICAvLyBUaGUgaW5kZXggb2YgdGhlIGxhc3QgZnVuZGluZyBhbmQgcHJvcG9zYWwNCiAgICB1aW50IGxhc3RQcm9wb3NhbElEOw0KICAgIC8vIFRoZSBpbmRleCBvZiB0aGUgbGFzdCBmdWVsZWQgZnVuZGluZyBhbmQgcHJvcG9zYWwNCiAgICB1aW50IHB1YmxpYyBsYXN0RnVlbGVkRnVuZGluZ0lEOw0KICAgIA0KICAgIHN0cnVjdCBhbW91bnRzR2l2ZW4gew0KICAgICAgICB1aW50IHdlaUFtb3VudDsNCiAgICAgICAgdWludCB0b2tlbkFtb3VudDsNCiAgICB9DQogICAgLy8gTWFwIHdpdGggdGhlIGFtb3VudHMgZ2l2ZW4gZm9yIGVhY2ggcHJvcG9zYWwgDQogICAgbWFwcGluZyAodWludCA9PiBtYXBwaW5nIChhZGRyZXNzID0+IGFtb3VudHNHaXZlbikpIHB1YmxpYyBHaXZlbjsNCiAgICANCiAgICAvLyBNYXAgb2YgYmxvY2tlZCBEYW8gc2hhcmUgYWNjb3VudHMuIFBvaW50cyB0byB0aGUgZGF0ZSB3aGVuIHRoZSBzaGFyZSBob2xkZXIgY2FuIHRyYW5zZmVyIHNoYXJlcw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJsb2NrZWREZWFkTGluZTsgDQoNCiAgICAvLyBAcmV0dXJuIFRoZSBjbGllbnQgb2YgdGhpcyBtYW5hZ2VyDQogICAgZnVuY3Rpb24gQ2xpZW50KCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyk7DQogICAgDQogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIHN1cHBseSBvZiBzaGFyZXMgb3IgdG9rZW5zIA0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7DQoNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkDQogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UNCiAgICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOw0KDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0b2tlbnMgY2FuIGJlIHRyYW5zZmVycmVkDQogICAgZnVuY3Rpb24gVHJhbnNmZXJhYmxlKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCk7DQogICAgDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zDQogICAgLy8vIEByZXR1cm4gUXVhbnRpdHkgb2YgcmVtYWluaW5nIHRva2VucyBvZiBfb3duZXIgdGhhdCBfc3BlbmRlciBpcyBhbGxvd2VkIHRvIHNwZW5kDQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7DQogICAgDQogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBJbmRleCBvZiB0aGUgZnVuZGluZyBvciBwcm9wb3NhbA0KICAgIC8vLyBAcmV0dXJuIFRoZSByZXN1bHQgKGluIHdlaSkgb2YgdGhlIGZ1bmRpbmcNCiAgICBmdW5jdGlvbiBGdW5kZWRBbW91bnQodWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCk7DQoNCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBmdW5kaW5nIG9yIHByb3Bvc2FsDQogICAgLy8vIEByZXR1cm4gVGhlIGFtb3VudCB0byBmdW5kDQogICAgZnVuY3Rpb24gQW1vdW50VG9GdW5kKHVpbnQgX3Byb3Bvc2FsSUQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpOw0KICAgIA0KICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgSW5kZXggb2YgdGhlIGZ1bmRpbmcgb3IgcHJvcG9zYWwNCiAgICAvLy8gQHJldHVybiB0aGUgdG9rZW4gcHJpY2UgbXVsdGlwbGllcg0KICAgIGZ1bmN0aW9uIHByaWNlTXVsdGlwbGllcih1aW50IF9wcm9wb3NhbElEKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KTsNCiAgICANCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBmdW5kaW5nIG9yIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfc2FsZURhdGUgaW4gY2FzZSBvZiBwcmVzYWxlLCB0aGUgZGF0ZSBvZiB0aGUgcHJlc2FsZQ0KICAgIC8vLyBAcmV0dXJuIHRoZSBzaGFyZSBvciB0b2tlbiBwcmljZSBkaXZpc29yIGNvbmRpZGVyaW5nIHRoZSBzYWxlIGRhdGUgYW5kIHRoZSBpbmZsYXRpb24gcmF0ZQ0KICAgIGZ1bmN0aW9uIHByaWNlRGl2aXNvcigNCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwgDQogICAgICAgIHVpbnQgX3NhbGVEYXRlKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KTsNCiAgICANCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBmdW5kaW5nIG9yIHByb3Bvc2FsDQogICAgLy8vIEByZXR1cm4gdGhlIGFjdHVhbCBwcmljZSBkaXZpc29yIG9mIGEgc2hhcmUgb3IgdG9rZW4NCiAgICBmdW5jdGlvbiBhY3R1YWxQcmljZURpdmlzb3IodWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCk7DQoNCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBjYWxjdWxhdGUgdGhlIGFtb3VudCBpbiB0b2tlbnMgYWNjb3JkaW5nIHRvIGEgcHJpY2UgICAgDQogICAgLy8vIEBwYXJhbSBfd2VpQW1vdW50IFRoZSBhbW91bnQgKGluIHdlaSkNCiAgICAvLy8gQHBhcmFtIF9wcmljZU11bHRpcGxpZXIgVGhlIHByaWNlIG11bHRpcGxpZXINCiAgICAvLy8gQHBhcmFtIF9wcmljZURpdmlzb3IgVGhlIHByaWNlIGRpdmlzb3INCiAgICAvLy8gQHJldHVybiB0aGUgYW1vdW50IGluIHRva2VucyANCiAgICBmdW5jdGlvbiBUb2tlbkFtb3VudCgNCiAgICAgICAgdWludCBfd2VpQW1vdW50LA0KICAgICAgICB1aW50IF9wcmljZU11bHRpcGxpZXIsIA0KICAgICAgICB1aW50IF9wcmljZURpdmlzb3IpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpOw0KDQogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIHRoZSBhbW91bnQgaW4gd2VpIGFjY29yZGluZyB0byBhIHByaWNlICAgIA0KICAgIC8vLyBAcGFyYW0gX3Rva2VuQW1vdW50IFRoZSBhbW91bnQgKGluIHdlaSkNCiAgICAvLy8gQHBhcmFtIF9wcmljZU11bHRpcGxpZXIgVGhlIHByaWNlIG11bHRpcGxpZXINCiAgICAvLy8gQHBhcmFtIF9wcmljZURpdmlzb3IgVGhlIHByaWNlIGRpdmlzb3INCiAgICAvLy8gQHJldHVybiB0aGUgYW1vdW50IGluIHdlaQ0KICAgIGZ1bmN0aW9uIHdlaUFtb3VudCgNCiAgICAgICAgdWludCBfdG9rZW5BbW91bnQsIA0KICAgICAgICB1aW50IF9wcmljZU11bHRpcGxpZXIsIA0KICAgICAgICB1aW50IF9wcmljZURpdmlzb3IpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpOw0KICAgICAgICANCiAgICAvLy8gQHBhcmFtIF90b2tlbkFtb3VudCBUaGUgYW1vdW50IGluIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgSW5kZXggb2YgdGhlIGNsaWVudCBwcm9wb3NhbC4gMCBpZiBub3QgbGlua2VkIHRvIGEgcHJvcG9zYWwuDQogICAgLy8vIEByZXR1cm4gdGhlIGFjdHVhbCB0b2tlbiBwcmljZSBpbiB3ZWkNCiAgICBmdW5jdGlvbiBUb2tlblByaWNlSW5XZWkodWludCBfdG9rZW5BbW91bnQsIHVpbnQgX3Byb3Bvc2FsSUQpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICAgIA0KICAgIC8vLyBAcmV0dXJuIFRoZSBpbmRleCBvZiB0aGUgbGFzdCBmdW5kaW5nIGFuZCBjbGllbnQncyBwcm9wb3NhbCANCiAgICBmdW5jdGlvbiBMYXN0UHJvcG9zYWxJRCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KDQogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBzaGFyZSBvciB0b2tlbiBob2xkZXJzICh1c2VkIGZvciBjbG9uaW5nKQ0KICAgIGZ1bmN0aW9uIG51bWJlck9mSG9sZGVycygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KDQogICAgLy8vIEBwYXJhbSBfaW5kZXggVGhlIGluZGV4IG9mIHRoZSBob2xkZXINCiAgICAvLy8gQHJldHVybiB0aGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyDQogICAgZnVuY3Rpb24gSG9sZGVyQWRkcmVzcyh1aW50IF9pbmRleCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyk7DQogICANCiAgICAvLy8gQGRldiBUaGUgY29uc3RydWN0b3IgZnVuY3Rpb24NCiAgICAvLy8gQHBhcmFtIF9wYXNzRGFvIEFkZHJlc3Mgb2YgdGhlIHBhc3MgRGFvIHNtYXJ0IGNvbnRyYWN0DQogICAgLy8vIEBwYXJhbSBfY2xvbmVkRnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgbGFzdCBNYW5hZ2VyIGJlZm9yZSBjbG9uaW5nDQogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIFRoZSB0b2tlbiBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2UNCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUaGUgdG9rZW4gc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2UNCiAgICAvLy8gQHBhcmFtIF90b2tlbkRlY2ltYWxzIFRoZSBxdWFudGl0eSBvZiBkZWNpbWFscyBmb3IgZGlzcGxheSBwdXJwb3NlDQogICAgLy8vIEBwYXJhbSAgX3Rva2VuIFRydWUgaWYgdG9rZW5zLCBmYWxzZSBpZiBzaGFyZXMNCiAgICAvLy8gQHBhcmFtICBfdHJhbnNmZXJhYmxlIFRydWUgaWYgdG9rZW5zIGNhbiBiZSB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcGFyYW0gX2luaXRpYWxQcmljZU11bHRpcGxpZXIgUHJpY2UgbXVsdGlwbGllciB3aXRob3V0IGNvbnNpZGVyaW5nIGFueSBpbmZsYXRpb24gcmF0ZQ0KICAgIC8vLyBAcGFyYW0gX2luZmxhdGlvblJhdGUgSWYgMCwgdGhlIHRva2VuIHByaWNlIGRvZXNuJ3QgY2hhbmdlIGR1cmluZyB0aGUgZnVuZGluZw0KICAgIC8vZnVuY3Rpb24gUGFzc1Rva2VuTWFuYWdlcigNCiAgICAvLyAgICBhZGRyZXNzIF9wYXNzRGFvLA0KICAgIC8vICAgIGFkZHJlc3MgX2Nsb25lZEZyb20sDQogICAgLy8gICAgc3RyaW5nIF90b2tlbk5hbWUsDQogICAgLy8gICAgc3RyaW5nIF90b2tlblN5bWJvbCwNCiAgICAvLyAgICB1aW50OCBfdG9rZW5EZWNpbWFscywNCiAgICAvLyAgICBib29sIF90b2tlbiwNCiAgICAvLyAgICBib29sIF90cmFuc2ZlcmFibGUsDQogICAgLy8gICAgdWludCBfaW5pdGlhbFByaWNlTXVsdGlwbGllciwNCiAgICAvLyAgICB1aW50IF9pbmZsYXRpb25SYXRlKTsNCiAgICANCiAgICAvLy8gQGRldiBGdW5jdGlvbiB0byBjcmVhdGUgaW5pdGlhbCB0b2tlbnMgICAgDQogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBiZW5lZmljaWFyeSBvZiB0aGUgY3JlYXRlZCB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9xdWFudGl0eSBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIHRvIGNyZWF0ZSAgICANCiAgICAvLy8gQHBhcmFtIF9sYXN0IFRydWUgaWYgdGhlIGluaXRpYWwgdG9rZW4gc3VwcHkgaXMgb3Zlcg0KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGZ1bmN0aW9uIHdhcyBzdWNjZXNzZnVsIG9yIG5vdCAgICAgDQogICAgZnVuY3Rpb24gaW5pdGlhbFRva2VuU3VwcGx5KA0KICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQsIA0KICAgICAgICB1aW50IF9xdWFudGl0eSwNCiAgICAgICAgYm9vbCBfbGFzdCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICAgICAgDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gY2xvbmUgdG9rZW5zIGJlZm9yZSB1cGdyYWRpbmcNCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBpbmRleCBvZiB0aGUgZmlyc3QgaG9sZGVyDQogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGluZGV4IG9mIHRoZSBsYXN0IGhvbGRlcg0KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGZ1bmN0aW9uIHdhcyBzdWNjZXNzZnVsIG9yIG5vdCANCiAgICBmdW5jdGlvbiBjbG9uZVRva2VucygNCiAgICAgICAgdWludCBfZnJvbSwNCiAgICAgICAgdWludCBfdG8pIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQoNCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBhZGQgYSBuZXcgdG9rZW4gb3Igc2hhcmUgaG9sZGVyDQogICAgLy8vIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBvciBzaGFyZSBob2xkZXINCiAgICBmdW5jdGlvbiBhZGRIb2xkZXIoYWRkcmVzcyBfaG9sZGVyKSBpbnRlcm5hbDsNCiAgICANCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBjcmVhdGUgaW5pdGlhbCB0b2tlbnMgICAgDQogICAgLy8vIEBwYXJhbSBfaG9sZGVyIFRoZSBiZW5lZmljaWFyeSBvZiB0aGUgY3JlYXRlZCB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF90b2tlbkFtb3VudCBUaGUgYW1vdW50IGluIHRva2VucyB0byBjcmVhdGUNCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbnMoDQogICAgICAgIGFkZHJlc3MgX2hvbGRlciwgDQogICAgICAgIHVpbnQgX3Rva2VuQW1vdW50KSBpbnRlcm5hbDsNCiAgICAgICAgDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgY2xpZW50IHRvIHBheSB3aXRoIHNoYXJlcyBvciB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCBvZiBzaGFyZXMgb3IgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIFdlaSkgdG8gY2FsY3VsYXRlIHRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGNyZWF0ZQ0KICAgIC8vLyBAcmV0dXJuIHRoZSByZXdhcmRlZCBhbW91bnQgaW4gdG9rZW5zIG9yIHNoYXJlcw0KICAgIGZ1bmN0aW9uIHJld2FyZFRva2Vuc0ZvckNsaWVudCgNCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCANCiAgICAgICAgdWludCBfYW1vdW50KSBleHRlcm5hbCAgcmV0dXJucyAodWludCk7DQogICAgICAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNldCBhIGZ1bmRpbmcNCiAgICAvLy8gQHBhcmFtIF9tb2RlcmF0b3IgVGhlIGFkZHJlc3Mgb2YgdGhlIHNtYXJ0IGNvbnRyYWN0IHRvIG1hbmFnZSBhIHByaXZhdGUgZnVuZGluZw0KICAgIC8vLyBAcGFyYW0gX2luaXRpYWxQcmljZU11bHRpcGxpZXIgUHJpY2UgbXVsdGlwbGllciB3aXRob3V0IGNvbnNpZGVyaW5nIGFueSBpbmZsYXRpb24gcmF0ZQ0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudFRvRnVuZCBUaGUgYW1vdW50IChpbiB3ZWkpIG9mIHRoZSBmdW5kaW5nDQogICAgLy8vIEBwYXJhbSBfbWludXRlc0Z1bmRpbmdQZXJpb2QgUGVyaW9kIGluIG1pbnV0ZXMgb2YgdGhlIGZ1bmRpbmcNCiAgICAvLy8gQHBhcmFtIF9pbmZsYXRpb25SYXRlIElmIDAsIHRoZSB0b2tlbiBwcmljZSBkb2Vzbid0IGNoYW5nZSBkdXJpbmcgdGhlIGZ1bmRpbmcNCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBjbGllbnQgcHJvcG9zYWwNCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nUnVsZXMoDQogICAgICAgIGFkZHJlc3MgX21vZGVyYXRvciwNCiAgICAgICAgdWludCBfaW5pdGlhbFByaWNlTXVsdGlwbGllciwNCiAgICAgICAgdWludCBfYW1vdW50VG9GdW5kLA0KICAgICAgICB1aW50IF9taW51dGVzRnVuZGluZ1BlcmlvZCwgDQogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQpIGV4dGVybmFsOw0KDQogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gZm9yIHRoZSBzYWxlIG9mIHNoYXJlcyBvciB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBjbGllbnQgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIHJlY2lwaWVudCBhZGRyZXNzIG9mIHNoYXJlcyBvciB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGZ1bmRlZCBhbW91bnQgKGluIHdlaSkNCiAgICAvLy8gQHBhcmFtIF9zYWxlRGF0ZSBJbiBjYXNlIG9mIHByZXNhbGUsIHRoZSBkYXRlIG9mIHRoZSBwcmVzYWxlDQogICAgLy8vIEBwYXJhbSBfcHJlc2FsZSBUcnVlIGlmIHByZXNhbGUNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBjcmVhdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiBzYWxlKA0KICAgICAgICB1aW50IF9wcm9wb3NhbElELA0KICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQsIA0KICAgICAgICB1aW50IF9hbW91bnQsDQogICAgICAgIHVpbnQgX3NhbGVEYXRlLA0KICAgICAgICBib29sIF9wcmVzYWxlDQogICAgKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIA0KICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGNsb3NlIHRoZSBhY3R1YWwgZnVuZGluZw0KICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgSW5kZXggb2YgdGhlIGNsaWVudCBwcm9wb3NhbA0KICAgIGZ1bmN0aW9uIGNsb3NlRnVuZGluZyh1aW50IF9wcm9wb3NhbElEKSBpbnRlcm5hbDsNCiAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNlbmQgdG9rZW5zIG9yIHJlZnVuZCBhZnRlciB0aGUgY2xvc2luZyB0aW1lIG9mIHRoZSBmdW5kaW5nIHByb3Bvc2Fscw0KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGZpcnN0IHByb3Bvc2FsLiAwIGlmIG5vdCBsaW5rZWQgdG8gYSBwcm9wb3NhbA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBsYXN0IHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfYnV5ZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGJ1eWVyDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgZnVuY3Rpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90IA0KICAgIGZ1bmN0aW9uIHNlbmRQZW5kaW5nQW1vdW50cyggICAgICAgIA0KICAgICAgICB1aW50IF9mcm9tLA0KICAgICAgICB1aW50IF90bywNCiAgICAgICAgYWRkcmVzcyBfYnV5ZXIpIHJldHVybnMgKGJvb2wpOw0KICAgICAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBnZXQgZmVlcywgc2hhcmVzIG9yIHJlZnVuZCBhZnRlciB0aGUgY2xvc2luZyB0aW1lIG9mIHRoZSBmdW5kaW5nIHByb3Bvc2Fscw0KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGZ1bmN0aW9uIHdhcyBzdWNjZXNzZnVsIG9yIG5vdA0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3UGVuZGluZ0Ftb3VudHMoKSByZXR1cm5zIChib29sKTsNCiAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBtYWluIHBhcnRuZXIgdG8gc2V0IHRoZSBzdGFydCB0aW1lIG9mIHRoZSBmdW5kaW5nDQogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBJbmRleCBvZiB0aGUgY2xpZW50IHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfc3RhcnRUaW1lIFRoZSB1bml4IHN0YXJ0IGRhdGUgb2YgdGhlIGZ1bmRpbmcgDQogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1N0YXJ0VGltZSgNCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwgDQogICAgICAgIHVpbnQgX3N0YXJ0VGltZSkgZXh0ZXJuYWw7DQogICAgDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgbWFpbiBwYXJ0bmVyIHRvIHNldCB0aGUgZnVuZGluZyBmdWVsZWQNCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBjbGllbnQgcHJvcG9zYWwNCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nRnVlbGVkKHVpbnQgX3Byb3Bvc2FsSUQpIGV4dGVybmFsOw0KDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gYWJsZSB0aGUgdHJhbnNmZXIgb2YgRGFvIHNoYXJlcyBvciBjb250cmFjdG9yIHRva2Vucw0KICAgIGZ1bmN0aW9uIGFibGVUcmFuc2ZlcigpOw0KDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gZGlzYWJsZSB0aGUgdHJhbnNmZXIgb2YgRGFvIHNoYXJlcw0KICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcigpOw0KDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgY2xpZW50IHRvIGJsb2NrIHRoZSB0cmFuc2ZlciBvZiBzaGFyZXMgZnJvbSBhbmQgdG8gYSBzaGFyZSBob2xkZXINCiAgICAvLy8gQHBhcmFtIF9zaGFyZUhvbGRlciBUaGUgYWRkcmVzcyBvZiB0aGUgc2hhcmUgaG9sZGVyDQogICAgLy8vIEBwYXJhbSBfZGVhZExpbmUgV2hlbiB0aGUgYWNjb3VudCB3aWxsIGJlIHVuYmxvY2tlZA0KICAgIGZ1bmN0aW9uIGJsb2NrVHJhbnNmZXIoDQogICAgICAgIGFkZHJlc3MgX3NoYXJlSG9sZGVyLCANCiAgICAgICAgdWludCBfZGVhZExpbmUpIGV4dGVybmFsOw0KICAgIA0KICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX0Zyb21gDQogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyDQogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudA0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgZnVuY3Rpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90IA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbVRvKA0KICAgICAgICBhZGRyZXNzIF9mcm9tLA0KICAgICAgICBhZGRyZXNzIF90bywgDQogICAgICAgIHVpbnQyNTYgX3ZhbHVlDQogICAgICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICANCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgDQogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudA0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgZnVuY3Rpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90IA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYA0KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcg0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgcXVhbnRpdHkgb2Ygc2hhcmVzIG9yIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgNCiAgICAgICAgYWRkcmVzcyBfZnJvbSwgDQogICAgICAgIGFkZHJlc3MgX3RvLCANCiAgICAgICAgdWludDI1NiBfdmFsdWUNCiAgICAgICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KDQogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbiBpdHMgYmVoYWxmDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXINCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiBhcHByb3ZlKA0KICAgICAgICBhZGRyZXNzIF9zcGVuZGVyLCANCiAgICAgICAgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgDQogICAgZXZlbnQgVG9rZW5zQ3JlYXRlZChhZGRyZXNzIGluZGV4ZWQgU2VuZGVyLCBhZGRyZXNzIGluZGV4ZWQgVG9rZW5Ib2xkZXIsIHVpbnQgVG9rZW5BbW91bnQpOw0KICAgIGV2ZW50IEZ1bmRpbmdSdWxlc1NldChhZGRyZXNzIGluZGV4ZWQgTW9kZXJhdG9yLCB1aW50IGluZGV4ZWQgUHJvcG9zYWxJZCwgdWludCBBbW91bnRUb0Z1bmQsIHVpbnQgaW5kZXhlZCBTdGFydFRpbWUsIHVpbnQgQ2xvc2luZ1RpbWUpOw0KICAgIGV2ZW50IEZ1bmRpbmdGdWVsZWQodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgRnVuZGVkQW1vdW50KTsNCiAgICBldmVudCBUcmFuc2ZlckFibGUoKTsNCiAgICBldmVudCBUcmFuc2ZlckRpc2FibGUoKTsNCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbmRleGVkIEJ1eWVyLCB1aW50IEFtb3VudCk7DQogICAgDQp9ICAgIA0KDQpjb250cmFjdCBQYXNzVG9rZW5NYW5hZ2VyIGlzIFBhc3NUb2tlbk1hbmFnZXJJbnRlcmZhY2Ugew0KDQovLyBDb25zdGFudCBmdW5jdGlvbnMNCg0KICAgIGZ1bmN0aW9uIENsaWVudCgpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsNCiAgICAgICAgcmV0dXJuIHBhc3NEYW8uQWN0dWFsQ29tbWl0dGVlUm9vbSgpOw0KICAgIH0NCiAgIA0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nikgew0KICAgICAgICByZXR1cm4gdG90YWxUb2tlblN1cHBseTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogICAgfQ0KICAgICANCiAgICBmdW5jdGlvbiBUcmFuc2ZlcmFibGUoKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiB0cmFuc2ZlcmFibGU7DQogICAgfQ0KIA0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZSgNCiAgICAgICAgYWRkcmVzcyBfb3duZXIsIA0KICAgICAgICBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgew0KICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBGdW5kZWRBbW91bnQodWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmZ1bmRlZEFtb3VudDsNCiAgICB9DQogIA0KICAgIGZ1bmN0aW9uIEFtb3VudFRvRnVuZCh1aW50IF9wcm9wb3NhbElEKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7DQoNCiAgICAgICAgaWYgKG5vdyA+IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5jbG9zaW5nVGltZQ0KICAgICAgICAgICAgfHwgbm93IDwgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnN0YXJ0VGltZSkgew0KICAgICAgICAgICAgcmV0dXJuIDA7ICAgDQogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5hbW91bnRUb0Z1bmQ7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHByaWNlTXVsdGlwbGllcih1aW50IF9wcm9wb3NhbElEKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uaW5pdGlhbFByaWNlTXVsdGlwbGllcjsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gcHJpY2VEaXZpc29yKHVpbnQgX3Byb3Bvc2FsSUQsIHVpbnQgX3NhbGVEYXRlKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHVpbnQgX2RhdGUgPSBfc2FsZURhdGU7DQogICAgICAgIA0KICAgICAgICBpZiAoX3NhbGVEYXRlID4gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmNsb3NpbmdUaW1lKSBfZGF0ZSA9IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5jbG9zaW5nVGltZTsNCiAgICAgICAgaWYgKF9zYWxlRGF0ZSA8IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5zdGFydFRpbWUpIF9kYXRlID0gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnN0YXJ0VGltZTsNCg0KICAgICAgICByZXR1cm4gMTAwICsgMTAwKmZ1bmRpbmdzW19wcm9wb3NhbElEXS5pbmZsYXRpb25SYXRlKihfZGF0ZSAtIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5zdGFydFRpbWUpLygxMDAqMzY1IGRheXMpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBhY3R1YWxQcmljZURpdmlzb3IodWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gcHJpY2VEaXZpc29yKF9wcm9wb3NhbElELCBub3cpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBUb2tlbkFtb3VudCgNCiAgICAgICAgdWludCBfd2VpQW1vdW50LCANCiAgICAgICAgdWludCBfcHJpY2VNdWx0aXBsaWVyLCANCiAgICAgICAgdWludCBfcHJpY2VEaXZpc29yKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIA0KICAgICAgICB1aW50IF9hID0gX3dlaUFtb3VudCpfcHJpY2VNdWx0aXBsaWVyOw0KICAgICAgICB1aW50IF9tdWx0aXBsaWVyID0gMTAwKl9hOw0KICAgICAgICB1aW50IF9hbW91bnQgPSBfbXVsdGlwbGllci9fcHJpY2VEaXZpc29yOw0KICAgICAgICBpZiAoX2EvX3dlaUFtb3VudCAhPSBfcHJpY2VNdWx0aXBsaWVyDQogICAgICAgICAgICB8fCBfbXVsdGlwbGllci8xMDAgIT0gX2EpIHJldHVybiAwOyANCiAgICAgICAgDQogICAgICAgIHJldHVybiBfYW1vdW50Ow0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiB3ZWlBbW91bnQoDQogICAgICAgIHVpbnQgX3Rva2VuQW1vdW50LCANCiAgICAgICAgdWludCBfcHJpY2VNdWx0aXBsaWVyLCANCiAgICAgICAgdWludCBfcHJpY2VEaXZpc29yKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIA0KICAgICAgICB1aW50IF9tdWx0aXBsaWVyID0gX3Rva2VuQW1vdW50Kl9wcmljZURpdmlzb3I7DQogICAgICAgIHVpbnQgX2Rpdmlzb3IgPSAxMDAqX3ByaWNlTXVsdGlwbGllcjsNCiAgICAgICAgdWludCBfYW1vdW50ID0gX211bHRpcGxpZXIvX2Rpdmlzb3I7DQogICAgICAgIGlmIChfbXVsdGlwbGllci9fdG9rZW5BbW91bnQgIT0gX3ByaWNlRGl2aXNvcg0KICAgICAgICAgICAgfHwgX2Rpdmlzb3IvMTAwICE9IF9wcmljZU11bHRpcGxpZXIpIHJldHVybiAwOyANCg0KICAgICAgICByZXR1cm4gX2Ftb3VudDsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gVG9rZW5QcmljZUluV2VpKHVpbnQgX3Rva2VuQW1vdW50LCB1aW50IF9wcm9wb3NhbElEKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiB3ZWlBbW91bnQoX3Rva2VuQW1vdW50LCBwcmljZU11bHRpcGxpZXIoX3Byb3Bvc2FsSUQpLCBhY3R1YWxQcmljZURpdmlzb3IoX3Byb3Bvc2FsSUQpKTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gTGFzdFByb3Bvc2FsSUQoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBsYXN0UHJvcG9zYWxJRDsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gbnVtYmVyT2ZIb2xkZXJzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gaG9sZGVycy5sZW5ndGggLSAxOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBIb2xkZXJBZGRyZXNzKHVpbnQgX2luZGV4KSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zIChhZGRyZXNzKSB7DQogICAgICAgIHJldHVybiBob2xkZXJzW19pbmRleF07DQogICAgfQ0KDQovLyBNb2RpZmllcnMNCg0KICAgIC8vIE1vZGlmaWVyIHRoYXQgYWxsb3dzIG9ubHkgdGhlIGNsaWVudCAuLg0KICAgIG1vZGlmaWVyIG9ubHlDbGllbnQge2lmIChtc2cuc2VuZGVyICE9IENsaWVudCgpKSB0aHJvdzsgXzt9DQogICAgICANCiAgICAvLyBNb2RpZmllciBmb3Igc2hhcmUgTWFuYWdlciBmdW5jdGlvbnMNCiAgICBtb2RpZmllciBvbmx5U2hhcmVNYW5hZ2VyIHtpZiAodG9rZW4pIHRocm93OyBfO30NCg0KICAgIC8vIE1vZGlmaWVyIGZvciB0b2tlbiBNYW5hZ2VyIGZ1bmN0aW9ucw0KICAgIG1vZGlmaWVyIG9ubHlUb2tlbk1hbmFnZXIge2lmICghdG9rZW4pIHRocm93OyBfO30NCiAgDQovLyBDb25zdHJ1Y3RvciBmdW5jdGlvbg0KDQogICAgZnVuY3Rpb24gUGFzc1Rva2VuTWFuYWdlcigNCiAgICAgICAgUGFzc0RhbyBfcGFzc0RhbywNCiAgICAgICAgYWRkcmVzcyBfY2xvbmVkRnJvbSwNCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsDQogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsDQogICAgICAgIHVpbnQ4IF90b2tlbkRlY2ltYWxzLA0KICAgICAgICBib29sIF90b2tlbiwNCiAgICAgICAgYm9vbCBfdHJhbnNmZXJhYmxlLA0KICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLA0KICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlKSB7DQoNCiAgICAgICAgcGFzc0RhbyA9IF9wYXNzRGFvOw0KICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsNCiAgICAgICAgDQogICAgICAgIGNsb25lZEZyb20gPSBfY2xvbmVkRnJvbTsgICAgICAgICAgICANCg0KICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsNCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOw0KICAgICAgICBkZWNpbWFscyA9IF90b2tlbkRlY2ltYWxzOw0KDQogICAgICAgIHRva2VuID0gX3Rva2VuOw0KICAgICAgICB0cmFuc2ZlcmFibGUgPSBfdHJhbnNmZXJhYmxlOw0KDQogICAgICAgIGZ1bmRpbmdzWzBdLmluaXRpYWxQcmljZU11bHRpcGxpZXIgPSBfaW5pdGlhbFByaWNlTXVsdGlwbGllcjsNCiAgICAgICAgZnVuZGluZ3NbMF0uaW5mbGF0aW9uUmF0ZSA9IF9pbmZsYXRpb25SYXRlOw0KDQogICAgICAgIGhvbGRlcnMubGVuZ3RoID0gMTsNCiAgICB9DQoNCi8vIFNldHRpbmcgZnVuY3Rpb25zDQoNCiAgICBmdW5jdGlvbiBpbml0aWFsVG9rZW5TdXBwbHkoDQogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgDQogICAgICAgIHVpbnQgX3F1YW50aXR5LA0KICAgICAgICBib29sIF9sYXN0KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCg0KICAgICAgICBpZiAoaW5pdGlhbFRva2VuU3VwcGx5RG9uZSkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICBhZGRIb2xkZXIoX3JlY2lwaWVudCk7DQogICAgICAgIGlmIChfcmVjaXBpZW50ICE9IDAgJiYgX3F1YW50aXR5ICE9IDApIGNyZWF0ZVRva2VucyhfcmVjaXBpZW50LCBfcXVhbnRpdHkpOw0KICAgICAgICANCiAgICAgICAgaWYgKF9sYXN0KSBpbml0aWFsVG9rZW5TdXBwbHlEb25lID0gdHJ1ZTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNsb25lVG9rZW5zKA0KICAgICAgICB1aW50IF9mcm9tLA0KICAgICAgICB1aW50IF90bykgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIA0KICAgICAgICBpbml0aWFsVG9rZW5TdXBwbHlEb25lID0gdHJ1ZTsNCiAgICAgICAgaWYgKF9mcm9tID09IDApIF9mcm9tID0gMTsNCiAgICAgICAgDQogICAgICAgIFBhc3NUb2tlbk1hbmFnZXIgX2Nsb25lZEZyb20gPSBQYXNzVG9rZW5NYW5hZ2VyKGNsb25lZEZyb20pOw0KICAgICAgICB1aW50IF9udW1iZXJPZkhvbGRlcnMgPSBfY2xvbmVkRnJvbS5udW1iZXJPZkhvbGRlcnMoKTsNCiAgICAgICAgaWYgKF90byA9PSAwIHx8IF90byA+IF9udW1iZXJPZkhvbGRlcnMpIF90byA9IF9udW1iZXJPZkhvbGRlcnM7DQogICAgICAgIA0KICAgICAgICBhZGRyZXNzIF9ob2xkZXI7DQogICAgICAgIHVpbnQgX2JhbGFuY2U7DQoNCiAgICAgICAgZm9yICh1aW50IGkgPSBfZnJvbTsgaSA8PSBfdG87IGkrKykgew0KICAgICAgICAgICAgX2hvbGRlciA9IF9jbG9uZWRGcm9tLkhvbGRlckFkZHJlc3MoaSk7DQogICAgICAgICAgICBfYmFsYW5jZSA9IF9jbG9uZWRGcm9tLmJhbGFuY2VPZihfaG9sZGVyKTsNCiAgICAgICAgICAgIGlmIChiYWxhbmNlc1tfaG9sZGVyXSA9PSAwICYmIF9iYWxhbmNlICE9IDApIHsNCiAgICAgICAgICAgICAgICBhZGRIb2xkZXIoX2hvbGRlcik7DQogICAgICAgICAgICAgICAgY3JlYXRlVG9rZW5zKF9ob2xkZXIsIF9iYWxhbmNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAgICAgDQovLyBUb2tlbiBjcmVhdGlvbg0KDQogICAgZnVuY3Rpb24gYWRkSG9sZGVyKGFkZHJlc3MgX2hvbGRlcikgaW50ZXJuYWwgew0KICAgICAgICANCiAgICAgICAgaWYgKGhvbGRlcklEW19ob2xkZXJdID09IDApIHsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdWludCBfaG9sZGVySUQgPSBob2xkZXJzLmxlbmd0aCsrOw0KICAgICAgICAgICAgaG9sZGVyc1tfaG9sZGVySURdID0gX2hvbGRlcjsNCiAgICAgICAgICAgIGhvbGRlcklEW19ob2xkZXJdID0gX2hvbGRlcklEOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW5zKA0KICAgICAgICBhZGRyZXNzIF9ob2xkZXIsIA0KICAgICAgICB1aW50IF90b2tlbkFtb3VudCkgaW50ZXJuYWwgew0KDQogICAgICAgIGJhbGFuY2VzW19ob2xkZXJdICs9IF90b2tlbkFtb3VudDsgDQogICAgICAgIHRvdGFsVG9rZW5TdXBwbHkgKz0gX3Rva2VuQW1vdW50Ow0KICAgICAgICBUb2tlbnNDcmVhdGVkKG1zZy5zZW5kZXIsIF9ob2xkZXIsIF90b2tlbkFtb3VudCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHJld2FyZFRva2Vuc0ZvckNsaWVudCgNCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCANCiAgICAgICAgdWludCBfYW1vdW50DQogICAgICAgICkgZXh0ZXJuYWwgb25seUNsaWVudCByZXR1cm5zICh1aW50KSB7DQoNCiAgICAgICAgdWludCBfdG9rZW5BbW91bnQgPSBUb2tlbkFtb3VudChfYW1vdW50LCBwcmljZU11bHRpcGxpZXIoMCksIGFjdHVhbFByaWNlRGl2aXNvcigwKSk7DQogICAgICAgIGlmIChfdG9rZW5BbW91bnQgPT0gMCkgdGhyb3c7DQoNCiAgICAgICAgYWRkSG9sZGVyKF9yZWNpcGllbnQpOw0KICAgICAgICBjcmVhdGVUb2tlbnMoX3JlY2lwaWVudCwgX3Rva2VuQW1vdW50KTsNCg0KICAgICAgICByZXR1cm4gX3Rva2VuQW1vdW50Ow0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nUnVsZXMoDQogICAgICAgIGFkZHJlc3MgX21vZGVyYXRvciwNCiAgICAgICAgdWludCBfaW5pdGlhbFByaWNlTXVsdGlwbGllciwNCiAgICAgICAgdWludCBfYW1vdW50VG9GdW5kLA0KICAgICAgICB1aW50IF9taW51dGVzRnVuZGluZ1BlcmlvZCwgDQogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQNCiAgICApIGV4dGVybmFsIG9ubHlDbGllbnQgew0KDQogICAgICAgIGlmIChfbW9kZXJhdG9yID09IGFkZHJlc3ModGhpcykNCiAgICAgICAgICAgIHx8IF9tb2RlcmF0b3IgPT0gQ2xpZW50KCkNCiAgICAgICAgICAgIHx8IF9hbW91bnRUb0Z1bmQgPT0gMA0KICAgICAgICAgICAgfHwgX21pbnV0ZXNGdW5kaW5nUGVyaW9kID09IDANCiAgICAgICAgICAgIHx8IGZ1bmRpbmdzW19wcm9wb3NhbElEXS50b3RhbFdlaUdpdmVuICE9IDANCiAgICAgICAgICAgICkgdGhyb3c7DQogICAgICAgICAgICANCiAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLm1vZGVyYXRvciA9IF9tb2RlcmF0b3I7DQoNCiAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmFtb3VudFRvRnVuZCA9IF9hbW91bnRUb0Z1bmQ7DQogICAgICAgIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5mdW5kZWRBbW91bnQgPSAwOw0KDQogICAgICAgIGlmIChfaW5pdGlhbFByaWNlTXVsdGlwbGllciA9PSAwKSB7DQogICAgICAgICAgICBpZiAobm93IDwgZnVuZGluZ3NbMF0uY2xvc2luZ1RpbWUpIHsNCiAgICAgICAgICAgICAgICBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uaW5pdGlhbFByaWNlTXVsdGlwbGllciA9IDEwMCpwcmljZU11bHRpcGxpZXIobGFzdFByb3Bvc2FsSUQpL2FjdHVhbFByaWNlRGl2aXNvcihsYXN0UHJvcG9zYWxJRCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gMTAwKnByaWNlTXVsdGlwbGllcihsYXN0RnVlbGVkRnVuZGluZ0lEKS9hY3R1YWxQcmljZURpdmlzb3IobGFzdEZ1ZWxlZEZ1bmRpbmdJRCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmdW5kaW5nc1swXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmluaXRpYWxQcmljZU11bHRpcGxpZXI7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uaW5pdGlhbFByaWNlTXVsdGlwbGllciA9IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyOw0KICAgICAgICAgICAgZnVuZGluZ3NbMF0uaW5pdGlhbFByaWNlTXVsdGlwbGllciA9IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiAoX2luZmxhdGlvblJhdGUgPT0gMCkgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmluZmxhdGlvblJhdGUgPSBmdW5kaW5nc1swXS5pbmZsYXRpb25SYXRlOw0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5pbmZsYXRpb25SYXRlID0gX2luZmxhdGlvblJhdGU7DQogICAgICAgICAgICBmdW5kaW5nc1swXS5pbmZsYXRpb25SYXRlID0gX2luZmxhdGlvblJhdGU7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5zdGFydFRpbWUgPSBub3c7DQogICAgICAgIGZ1bmRpbmdzWzBdLnN0YXJ0VGltZSA9IG5vdzsNCiAgICAgICAgDQogICAgICAgIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5jbG9zaW5nVGltZSA9IG5vdyArIF9taW51dGVzRnVuZGluZ1BlcmlvZCAqIDEgbWludXRlczsNCiAgICAgICAgZnVuZGluZ3NbMF0uY2xvc2luZ1RpbWUgPSBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uY2xvc2luZ1RpbWU7DQogICAgICAgIA0KICAgICAgICBmdW5kaW5nc1tfcHJvcG9zYWxJRF0udG90YWxXZWlHaXZlbiA9IDA7DQogICAgICAgIA0KICAgICAgICBsYXN0UHJvcG9zYWxJRCA9IF9wcm9wb3NhbElEOw0KICAgICAgICANCiAgICAgICAgRnVuZGluZ1J1bGVzU2V0KF9tb2RlcmF0b3IsIF9wcm9wb3NhbElELCAgX2Ftb3VudFRvRnVuZCwgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnN0YXJ0VGltZSwgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmNsb3NpbmdUaW1lKTsNCiAgICB9IA0KICAgIA0KICAgIGZ1bmN0aW9uIHNhbGUoDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQsDQogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgDQogICAgICAgIHVpbnQgX2Ftb3VudCwNCiAgICAgICAgdWludCBfc2FsZURhdGUsDQogICAgICAgIGJvb2wgX3ByZXNhbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KDQogICAgICAgIGlmIChfc2FsZURhdGUgPT0gMCkgX3NhbGVEYXRlID0gbm93Ow0KDQogICAgICAgIGlmIChfc2FsZURhdGUgPiBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uY2xvc2luZ1RpbWUNCiAgICAgICAgICAgIHx8IF9zYWxlRGF0ZSA8IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5zdGFydFRpbWUNCiAgICAgICAgICAgIHx8IGZ1bmRpbmdzW19wcm9wb3NhbElEXS50b3RhbFdlaUdpdmVuICsgX2Ftb3VudCA+IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5hbW91bnRUb0Z1bmQpIHJldHVybjsNCg0KICAgICAgICB1aW50IF90b2tlbkFtb3VudCA9IFRva2VuQW1vdW50KF9hbW91bnQsIHByaWNlTXVsdGlwbGllcihfcHJvcG9zYWxJRCksIHByaWNlRGl2aXNvcihfcHJvcG9zYWxJRCwgX3NhbGVEYXRlKSk7DQogICAgICAgIGlmIChfdG9rZW5BbW91bnQgPT0gMCkgcmV0dXJuOw0KICAgICAgICANCiAgICAgICAgYWRkSG9sZGVyKF9yZWNpcGllbnQpOw0KICAgICAgICBpZiAoX3ByZXNhbGUpIHsNCiAgICAgICAgICAgIEdpdmVuW19wcm9wb3NhbElEXVtfcmVjaXBpZW50XS50b2tlbkFtb3VudCArPSBfdG9rZW5BbW91bnQ7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBjcmVhdGVUb2tlbnMoX3JlY2lwaWVudCwgX3Rva2VuQW1vdW50KTsNCg0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjbG9zZUZ1bmRpbmcodWludCBfcHJvcG9zYWxJRCkgaW50ZXJuYWwgew0KICAgICAgICBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uZnVuZGVkQW1vdW50ID0gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnRvdGFsV2VpR2l2ZW47DQogICAgICAgIGxhc3RGdWVsZWRGdW5kaW5nSUQgPSBfcHJvcG9zYWxJRDsNCiAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmNsb3NpbmdUaW1lID0gbm93Ow0KICAgICAgICBGdW5kaW5nRnVlbGVkKF9wcm9wb3NhbElELCBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uZnVuZGVkQW1vdW50KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZW5kUGVuZGluZ0Ftb3VudHMoICAgICAgICANCiAgICAgICAgdWludCBfZnJvbSwNCiAgICAgICAgdWludCBfdG8sDQogICAgICAgIGFkZHJlc3MgX2J1eWVyKSByZXR1cm5zIChib29sKSB7DQogICAgICAgIA0KICAgICAgICBpZiAoX2Zyb20gPT0gMCkgX2Zyb20gPSAxOw0KICAgICAgICBpZiAoX3RvID09IDApIF90byA9IGxhc3RQcm9wb3NhbElEOw0KICAgICAgICBpZiAoX2J1eWVyID09IDApIF9idXllciA9IG1zZy5zZW5kZXI7DQoNCiAgICAgICAgdWludCBfYW1vdW50Ow0KICAgICAgICB1aW50IF90b2tlbkFtb3VudDsNCiAgICAgICAgDQogICAgICAgIGZvciAodWludCBpID0gX2Zyb207IGkgPD0gX3RvOyBpKyspIHsNCg0KICAgICAgICAgICAgaWYgKG5vdyA+IGZ1bmRpbmdzW2ldLmNsb3NpbmdUaW1lICYmIEdpdmVuW2ldW19idXllcl0ud2VpQW1vdW50ICE9IDApIHsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoZnVuZGluZ3NbaV0uZnVuZGVkQW1vdW50ID09IDApIF9hbW91bnQgKz0gR2l2ZW5baV1bX2J1eWVyXS53ZWlBbW91bnQ7DQogICAgICAgICAgICAgICAgZWxzZSBfdG9rZW5BbW91bnQgKz0gR2l2ZW5baV1bX2J1eWVyXS50b2tlbkFtb3VudDsNCg0KICAgICAgICAgICAgICAgIGZ1bmRpbmdzW2ldLnRvdGFsV2VpR2l2ZW4gLT0gR2l2ZW5baV1bX2J1eWVyXS53ZWlBbW91bnQ7DQogICAgICAgICAgICAgICAgR2l2ZW5baV1bX2J1eWVyXS50b2tlbkFtb3VudCA9IDA7DQogICAgICAgICAgICAgICAgR2l2ZW5baV1bX2J1eWVyXS53ZWlBbW91bnQgPSAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKF90b2tlbkFtb3VudCA+IDApIHsNCiAgICAgICAgICAgIGNyZWF0ZVRva2VucyhfYnV5ZXIsIF90b2tlbkFtb3VudCk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYgKF9hbW91bnQgPiAwKSB7DQogICAgICAgICAgICBpZiAoIV9idXllci5zZW5kKF9hbW91bnQpKSB0aHJvdzsNCiAgICAgICAgICAgIFJlZnVuZChfYnV5ZXIsIF9hbW91bnQpOw0KICAgICAgICB9IGVsc2UgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KDQogICAgZnVuY3Rpb24gd2l0aGRyYXdQZW5kaW5nQW1vdW50cygpIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBzZW5kUGVuZGluZ0Ftb3VudHMoMCwgMCwgbXNnLnNlbmRlcik7DQogICAgfSAgICAgICAgDQoNCi8vIEZ1bmRpbmcgTW9kZXJhdG9yIGZ1bmN0aW9ucw0KDQogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1N0YXJ0VGltZSh1aW50IF9wcm9wb3NhbElELCB1aW50IF9zdGFydFRpbWUpIGV4dGVybmFsIHsNCiAgICAgICAgaWYgKChtc2cuc2VuZGVyICE9ICBmdW5kaW5nc1tfcHJvcG9zYWxJRF0ubW9kZXJhdG9yKSB8fCBub3cgPiBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uY2xvc2luZ1RpbWUpIHRocm93Ow0KICAgICAgICBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nRnVlbGVkKHVpbnQgX3Byb3Bvc2FsSUQpIGV4dGVybmFsIHsNCg0KICAgICAgICBpZiAoKG1zZy5zZW5kZXIgIT0gIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5tb2RlcmF0b3IpIHx8IG5vdyA+IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5jbG9zaW5nVGltZSkgdGhyb3c7DQoNCiAgICAgICAgY2xvc2VGdW5kaW5nKF9wcm9wb3NhbElEKTsNCiAgICB9DQogICAgDQovLyBUb2tlbnMgdHJhbnNmZXIgbWFuYWdlbWVudCAgICANCiAgICANCiAgICBmdW5jdGlvbiBhYmxlVHJhbnNmZXIoKSBvbmx5Q2xpZW50IHsNCiAgICAgICAgaWYgKCF0cmFuc2ZlcmFibGUpIHsNCiAgICAgICAgICAgIHRyYW5zZmVyYWJsZSA9IHRydWU7DQogICAgICAgICAgICBUcmFuc2ZlckFibGUoKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcigpIG9ubHlDbGllbnQgew0KICAgICAgICBpZiAodHJhbnNmZXJhYmxlKSB7DQogICAgICAgICAgICB0cmFuc2ZlcmFibGUgPSBmYWxzZTsNCiAgICAgICAgICAgIFRyYW5zZmVyRGlzYWJsZSgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGJsb2NrVHJhbnNmZXIoYWRkcmVzcyBfc2hhcmVIb2xkZXIsIHVpbnQgX2RlYWRMaW5lKSBleHRlcm5hbCBvbmx5Q2xpZW50IG9ubHlTaGFyZU1hbmFnZXIgew0KICAgICAgICBpZiAoX2RlYWRMaW5lID4gYmxvY2tlZERlYWRMaW5lW19zaGFyZUhvbGRlcl0pIHsNCiAgICAgICAgICAgIGJsb2NrZWREZWFkTGluZVtfc2hhcmVIb2xkZXJdID0gX2RlYWRMaW5lOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbVRvKA0KICAgICAgICBhZGRyZXNzIF9mcm9tLA0KICAgICAgICBhZGRyZXNzIF90bywgDQogICAgICAgIHVpbnQyNTYgX3ZhbHVlDQogICAgICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7ICANCg0KICAgICAgICBpZiAoKHRyYW5zZmVyYWJsZSkNCiAgICAgICAgICAgICYmIG5vdyA+IGJsb2NrZWREZWFkTGluZVtfZnJvbV0NCiAgICAgICAgICAgICYmIG5vdyA+IGJsb2NrZWREZWFkTGluZVtfdG9dDQogICAgICAgICAgICAmJiBfdG8gIT0gYWRkcmVzcyh0aGlzKQ0KICAgICAgICAgICAgJiYgYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZQ0KICAgICAgICAgICAgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsNCg0KICAgICAgICAgICAgYWRkSG9sZGVyKF90byk7DQogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7DQogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQoNCiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsgIA0KICAgICAgICBpZiAoIXRyYW5zZmVyRnJvbVRvKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKSkgdGhyb3c7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgNCiAgICAgICAgYWRkcmVzcyBfZnJvbSwgDQogICAgICAgIGFkZHJlc3MgX3RvLCANCiAgICAgICAgdWludDI1NiBfdmFsdWUNCiAgICAgICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsgDQogICAgICAgIA0KICAgICAgICBpZiAoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPCBfdmFsdWUNCiAgICAgICAgICAgIHx8ICF0cmFuc2ZlckZyb21UbyhfZnJvbSwgX3RvLCBfdmFsdWUpKSB0aHJvdzsNCiAgICAgICAgICAgIA0KICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KfQ0KICAgIA0KDQoNCnByYWdtYSBzb2xpZGl0eSBeMC40Ljg7DQoNCi8qDQogKg0KICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUGFzcyBEQU8uDQogKg0KICogVGhlIE1hbmFnZXIgc21hcnQgY29udHJhY3QgaXMgdXNlZCBmb3IgdGhlIG1hbmFnZW1lbnQgb2YgdGhlIERhbyBhY2NvdW50LCBzaGFyZXMgYW5kIHRva2Vucy4NCiAqDQoqLw0KDQovLy8gQHRpdGxlIE1hbmFnZXIgc21hcnQgY29udHJhY3Qgb2YgdGhlIFBhc3MgRGVjZW50cmFsaXplZCBBdXRvbm9tb3VzIE9yZ2FuaXNhdGlvbg0KY29udHJhY3QgUGFzc01hbmFnZXIgaXMgUGFzc1Rva2VuTWFuYWdlciB7DQogICAgDQogICAgc3RydWN0IG9yZGVyIHsNCiAgICAgICAgYWRkcmVzcyBidXllcjsNCiAgICAgICAgdWludCB3ZWlHaXZlbjsNCiAgICB9DQogICAgLy8gT3JkZXJzIHRvIGJ1eSB0b2tlbnMNCiAgICBvcmRlcltdIHB1YmxpYyBvcmRlcnM7DQogICAgLy8gTnVtYmVyIG9yIG9yZGVycyB0byBidXkgdG9rZW5zDQogICAgdWludCBudW1iZXJPZk9yZGVyczsNCg0KICAgIC8vIE1hcCB0byBrbm93IGlmIGFuIG9yZGVyIHdhcyBjbG9uZWQgZnJvbSB0aGUgcHJlY2VkZW50IG1hbmFnZXIgYWZ0ZXIgYW4gdXBncmFkZQ0KICAgIG1hcHBpbmcgKHVpbnQgPT4gYm9vbCkgb3JkZXJDbG9uZWQ7DQogICAgDQogICAgZnVuY3Rpb24gUGFzc01hbmFnZXIoDQogICAgICAgIFBhc3NEYW8gX3Bhc3NEYW8sDQogICAgICAgIGFkZHJlc3MgX2Nsb25lZEZyb20sDQogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLA0KICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLA0KICAgICAgICB1aW50OCBfdG9rZW5EZWNpbWFscywNCiAgICAgICAgYm9vbCBfdG9rZW4sDQogICAgICAgIGJvb2wgX3RyYW5zZmVyYWJsZSwNCiAgICAgICAgdWludCBfaW5pdGlhbFByaWNlTXVsdGlwbGllciwNCiAgICAgICAgdWludCBfaW5mbGF0aW9uUmF0ZSkgDQogICAgICAgIFBhc3NUb2tlbk1hbmFnZXIoIF9wYXNzRGFvLCBfY2xvbmVkRnJvbSwgX3Rva2VuTmFtZSwgX3Rva2VuU3ltYm9sLCBfdG9rZW5EZWNpbWFscywgDQogICAgICAgICAgICBfdG9rZW4sIF90cmFuc2ZlcmFibGUsIF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLCBfaW5mbGF0aW9uUmF0ZSkgeyB9DQogICAgDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gcmVjZWl2ZSBwYXltZW50cw0KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgb25seVNoYXJlTWFuYWdlciB7IH0NCiAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBjbGllbnQgdG8gc2VuZCBldGhlcnMNCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIGFkZHJlc3MgdG8gc2VuZCB0bw0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIHRvIHNlbmQNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiBzZW5kVG8oDQogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwNCiAgICAgICAgdWludCBfYW1vdW50DQogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IHJldHVybnMgKGJvb2wpIHsNCg0KICAgICAgICBpZiAoX3JlY2lwaWVudC5zZW5kKF9hbW91bnQpKSByZXR1cm4gdHJ1ZTsNCiAgICAgICAgZWxzZSByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gYnV5IHRva2VucyBhbmQgcHJvbW90ZSBhIHByb3Bvc2FsIA0KICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgVGhlIGluZGV4IG9mIHRoZSBwcm9wb3NhbA0KICAgIC8vLyBAcGFyYW0gX2J1eWVyIFRoZSBhZGRyZXNzIG9mIHRoZSBidXllcg0KICAgIC8vLyBAcGFyYW0gX2RhdGUgVGhlIHVuaXggZGF0ZSB0byBjb25zaWRlciBmb3IgdGhlIHNoYXJlIG9yIHRva2VuIHByaWNlIGNhbGN1bGF0aW9uDQogICAgLy8vIEBwYXJhbSBfcHJlc2FsZSBUcnVlIGlmIHByZXNhbGUNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgDQogICAgZnVuY3Rpb24gYnV5VG9rZW5zRm9yKA0KICAgICAgICB1aW50IF9wcm9wb3NhbElELA0KICAgICAgICBhZGRyZXNzIF9idXllciwgDQogICAgICAgIHVpbnQgX2RhdGUsDQogICAgICAgIGJvb2wgX3ByZXNhbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCg0KICAgICAgICBpZiAoX3Byb3Bvc2FsSUQgPT0gMCB8fCAhc2FsZShfcHJvcG9zYWxJRCwgX2J1eWVyLCBtc2cudmFsdWUsIF9kYXRlLCBfcHJlc2FsZSkpIHRocm93Ow0KDQogICAgICAgIGZ1bmRpbmdzW19wcm9wb3NhbElEXS50b3RhbFdlaUdpdmVuICs9IG1zZy52YWx1ZTsgICAgICAgIA0KICAgICAgICBpZiAoZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnRvdGFsV2VpR2l2ZW4gPT0gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmFtb3VudFRvRnVuZCkgY2xvc2VGdW5kaW5nKF9wcm9wb3NhbElEKTsNCg0KICAgICAgICBHaXZlbltfcHJvcG9zYWxJRF1bX2J1eWVyXS53ZWlBbW91bnQgKz0gbXNnLnZhbHVlOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGJ1eSB0b2tlbnMgYW5kIHByb21vdGUgYSBwcm9wb3NhbCANCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIFRoZSBpbmRleCBvZiB0aGUgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9idXllciBUaGUgYWRkcmVzcyBvZiB0aGUgYnV5ZXIgKG5vdCBtYW5kYXRvcnksIG1zZy5zZW5kZXIgaWYgMCkNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgDQogICAgZnVuY3Rpb24gYnV5VG9rZW5zRm9yUHJvcG9zYWwoDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQsIA0KICAgICAgICBhZGRyZXNzIF9idXllcikgcGF5YWJsZSByZXR1cm5zIChib29sKSB7DQoNCiAgICAgICAgaWYgKF9idXllciA9PSAwKSBfYnV5ZXIgPSBtc2cuc2VuZGVyOw0KDQogICAgICAgIGlmIChmdW5kaW5nc1tfcHJvcG9zYWxJRF0ubW9kZXJhdG9yICE9IDApIHRocm93Ow0KDQogICAgICAgIHJldHVybiBidXlUb2tlbnNGb3IoX3Byb3Bvc2FsSUQsIF9idXllciwgbm93LCB0cnVlKTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBtb2RlcmF0b3IgdG8gYnV5IHNoYXJlcyBvciB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBjbGllbnQgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9idXllciBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50IG9mIHNoYXJlcyBvciB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9kYXRlIFRoZSB1bml4IGRhdGUgdG8gY29uc2lkZXIgZm9yIHRoZSBzaGFyZSBvciB0b2tlbiBwcmljZSBjYWxjdWxhdGlvbg0KICAgIC8vLyBAcGFyYW0gX3ByZXNhbGUgVHJ1ZSBpZiBwcmVzYWxlDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgZnVuY3Rpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90IA0KICAgIGZ1bmN0aW9uIGJ1eVRva2VuRnJvbU1vZGVyYXRvcigNCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwNCiAgICAgICAgYWRkcmVzcyBfYnV5ZXIsIA0KICAgICAgICB1aW50IF9kYXRlLA0KICAgICAgICBib29sIF9wcmVzYWxlKSBwYXlhYmxlIGV4dGVybmFsIHJldHVybnMgKGJvb2wpew0KDQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5tb2RlcmF0b3IpIHRocm93Ow0KDQogICAgICAgIHJldHVybiBidXlUb2tlbnNGb3IoX3Byb3Bvc2FsSUQsIF9idXllciwgX2RhdGUsIF9wcmVzYWxlKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBjcmVhdGUgYSBidXkgb3JkZXINCiAgICAvLy8gQHBhcmFtIF9idXllciBUaGUgYWRkcmVzcyBvZiB0aGUgYnV5ZXINCiAgICAvLy8gQHBhcmFtIF93ZWlHaXZlbiBUaGUgYW1vdW50IGluIHdlaSBnaXZlbiBieSB0aGUgYnV5ZXINCiAgICBmdW5jdGlvbiBhZGRPcmRlcigNCiAgICAgICAgYWRkcmVzcyBfYnV5ZXIsIA0KICAgICAgICB1aW50IF93ZWlHaXZlbikgaW50ZXJuYWwgew0KDQogICAgICAgIHVpbnQgaTsNCiAgICAgICAgbnVtYmVyT2ZPcmRlcnMgKz0gMTsNCg0KICAgICAgICBpZiAobnVtYmVyT2ZPcmRlcnMgPiBvcmRlcnMubGVuZ3RoKSBpID0gb3JkZXJzLmxlbmd0aCsrOw0KICAgICAgICBlbHNlIGkgPSBudW1iZXJPZk9yZGVycyAtIDE7DQogICAgICAgIA0KICAgICAgICBvcmRlcnNbaV0uYnV5ZXIgPSBfYnV5ZXI7DQogICAgICAgIG9yZGVyc1tpXS53ZWlHaXZlbiA9IF93ZWlHaXZlbjsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byByZW1vdmUgYSBidXkgb3JkZXINCiAgICAvLy8gQHBhcmFtIF9vcmRlciBUaGUgaW5kZXggb2YgdGhlIG9yZGVyIHRvIHJlbW92ZQ0KICAgIGZ1bmN0aW9uIHJlbW92ZU9yZGVyKHVpbnQgX29yZGVyKSBpbnRlcm5hbCB7DQogICAgICAgIA0KICAgICAgICBpZiAobnVtYmVyT2ZPcmRlcnMgLSAxIDwgX29yZGVyKSByZXR1cm47DQoNCiAgICAgICAgbnVtYmVyT2ZPcmRlcnMgLT0gMTsNCiAgICAgICAgaWYgKG51bWJlck9mT3JkZXJzID4gMCkgew0KICAgICAgICAgICAgZm9yICh1aW50IGkgPSBfb3JkZXI7IGkgPD0gbnVtYmVyT2ZPcmRlcnMgLSAxOyBpKyspIHsNCiAgICAgICAgICAgICAgICBvcmRlcnNbaV0uYnV5ZXIgPSBvcmRlcnNbaSsxXS5idXllcjsNCiAgICAgICAgICAgICAgICBvcmRlcnNbaV0ud2VpR2l2ZW4gPSBvcmRlcnNbaSsxXS53ZWlHaXZlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBvcmRlcnNbbnVtYmVyT2ZPcmRlcnNdLmJ1eWVyID0gMDsNCiAgICAgICAgb3JkZXJzW251bWJlck9mT3JkZXJzXS53ZWlHaXZlbiA9IDA7DQogICAgfQ0KICAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGNyZWF0ZSBvcmRlcnMgdG8gYnV5IHRva2Vucw0KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGZ1bmN0aW9uIHdhcyBzdWNjZXNzZnVsIG9yIG5vdA0KICAgIGZ1bmN0aW9uIGJ1eVRva2VucygpIHBheWFibGUgcmV0dXJucyAoYm9vbCkgew0KDQogICAgICAgIGlmICghdHJhbnNmZXJhYmxlIHx8IG1zZy52YWx1ZSA8IDEwMCBmaW5uZXkpIHRocm93Ow0KICAgICAgICANCiAgICAgICAgYWRkT3JkZXIobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBzZWxsIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX3Rva2VuQW1vdW50IGluIHRva2VucyB0byBzZWxsDQogICAgLy8vIEBwYXJhbSBfZnJvbSBJbmRleCBvZiB0aGUgZmlyc3Qgb3JkZXINCiAgICAvLy8gQHBhcmFtIF90byBJbmRleCBvZiB0aGUgbGFzdCBvcmRlcg0KICAgIC8vLyBAcmV0dXJuIHRoZSByZXZlbnVlIGluIHdlaQ0KICAgIGZ1bmN0aW9uIHNlbGxUb2tlbnMoDQogICAgICAgIHVpbnQgX3Rva2VuQW1vdW50LA0KICAgICAgICB1aW50IF9mcm9tLA0KICAgICAgICB1aW50IF90bykgcmV0dXJucyAodWludCkgew0KDQogICAgICAgIGlmICghdHJhbnNmZXJhYmxlIA0KICAgICAgICAgICAgfHwgdWludChiYWxhbmNlc1ttc2cuc2VuZGVyXSkgPCBfYW1vdW50IA0KICAgICAgICAgICAgfHwgbnVtYmVyT2ZPcmRlcnMgPT0gMCkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICBpZiAoX3RvID09IDAgfHwgX3RvID4gbnVtYmVyT2ZPcmRlcnMgLSAxKSBfdG8gPSBudW1iZXJPZk9yZGVycyAtIDE7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgdWludCBfdG9rZW5BbW91bnRvOw0KICAgICAgICB1aW50IF9hbW91bnQ7DQogICAgICAgIHVpbnQgX3RvdGFsQW1vdW50Ow0KICAgICAgICB1aW50IG8gPSBfZnJvbTsNCg0KICAgICAgICBmb3IgKHVpbnQgaSA9IF9mcm9tOyBpIDw9IF90bzsgaSsrKSB7DQoNCiAgICAgICAgICAgIGlmIChfdG9rZW5BbW91bnQgPiAwICYmIG9yZGVyc1tvXS5idXllciAhPSBtc2cuc2VuZGVyKSB7DQoNCiAgICAgICAgICAgICAgICBfdG9rZW5BbW91bnRvID0gVG9rZW5BbW91bnQob3JkZXJzW29dLndlaUdpdmVuLCBwcmljZU11bHRpcGxpZXIoMCksIGFjdHVhbFByaWNlRGl2aXNvcigwKSk7DQoNCiAgICAgICAgICAgICAgICBpZiAoX3Rva2VuQW1vdW50ID49IF90b2tlbkFtb3VudG8gDQogICAgICAgICAgICAgICAgICAgICYmIHRyYW5zZmVyRnJvbVRvKG1zZy5zZW5kZXIsIG9yZGVyc1tvXS5idXllciwgX3Rva2VuQW1vdW50bykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX3Rva2VuQW1vdW50IC09IF90b2tlbkFtb3VudG87DQogICAgICAgICAgICAgICAgICAgIF90b3RhbEFtb3VudCArPSBvcmRlcnNbb10ud2VpR2l2ZW47DQogICAgICAgICAgICAgICAgICAgIHJlbW92ZU9yZGVyKG8pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChfdG9rZW5BbW91bnQgPCBfdG9rZW5BbW91bnRvDQogICAgICAgICAgICAgICAgICAgICYmIHRyYW5zZmVyRnJvbVRvKG1zZy5zZW5kZXIsIG9yZGVyc1tvXS5idXllciwgX3Rva2VuQW1vdW50KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9hbW91bnQgPSB3ZWlBbW91bnQoX3Rva2VuQW1vdW50LCBwcmljZU11bHRpcGxpZXIoMCksIGFjdHVhbFByaWNlRGl2aXNvcigwKSk7DQogICAgICAgICAgICAgICAgICAgIG9yZGVyc1tvXS53ZWlHaXZlbiAtPSBfYW1vdW50Ow0KICAgICAgICAgICAgICAgICAgICBfdG90YWxBbW91bnQgKz0gX2Ftb3VudDsNCiAgICAgICAgICAgICAgICAgICAgaSA9IF90byArIDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgbyArPSAxOw0KICAgICAgICAgICAgfSANCiAgICAgICAgICAgIGVsc2UgbyArPSAxOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChfdG90YWxBbW91bnQpKSB0aHJvdzsNCiAgICAgICAgZWxzZSByZXR1cm4gX3RvdGFsQW1vdW50Ow0KICAgIH0gICAgDQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byByZW1vdmUgeW91ciBvcmRlcnMgYW5kIHJlZnVuZA0KICAgIC8vLyBAcGFyYW0gX2Zyb20gSW5kZXggb2YgdGhlIGZpcnN0IG9yZGVyDQogICAgLy8vIEBwYXJhbSBfdG8gSW5kZXggb2YgdGhlIGxhc3Qgb3JkZXINCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiByZW1vdmVPcmRlcnMoDQogICAgICAgIHVpbnQgX2Zyb20sDQogICAgICAgIHVpbnQgX3RvKSByZXR1cm5zIChib29sKSB7DQoNCiAgICAgICAgaWYgKF90byA9PSAwIHx8IF90byA+IG51bWJlck9mT3JkZXJzKSBfdG8gPSBudW1iZXJPZk9yZGVycyAtMTsNCiAgICAgICAgDQogICAgICAgIHVpbnQgX3RvdGFsQW1vdW50Ow0KICAgICAgICB1aW50IG8gPSBfZnJvbTsNCg0KICAgICAgICBmb3IgKHVpbnQgaSA9IF9mcm9tOyBpIDw9IF90bzsgaSsrKSB7DQoNCiAgICAgICAgICAgIGlmIChvcmRlcnNbb10uYnV5ZXIgPT0gbXNnLnNlbmRlcikgew0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF90b3RhbEFtb3VudCArPSBvcmRlcnNbb10ud2VpR2l2ZW47DQogICAgICAgICAgICAgICAgcmVtb3ZlT3JkZXIobyk7DQoNCiAgICAgICAgICAgIH0gZWxzZSBvICs9IDE7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChfdG90YWxBbW91bnQpKSB0aHJvdzsNCiAgICAgICAgZWxzZSByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgDQp9ICAgIA0KDQoNCnByYWdtYSBzb2xpZGl0eSBeMC40Ljg7DQoNCi8qDQogKg0KICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUGFzcyBEQU8uDQogKg0KICogVGhlIFByb2plY3Qgc21hcnQgY29udHJhY3QgaXMgdXNlZCBmb3IgdGhlIG1hbmFnZW1lbnQgb2YgdGhlIFBhc3MgRGFvIHByb2plY3RzLg0KICoNCiovDQoNCi8vLyBAdGl0bGUgUHJvamVjdCBzbWFydCBjb250cmFjdCBvZiB0aGUgUGFzcyBEZWNlbnRyYWxpemVkIEF1dG9ub21vdXMgT3JnYW5pc2F0aW9uDQpjb250cmFjdCBQYXNzUHJvamVjdCB7DQoNCiAgICAvLyBUaGUgUGFzcyBEYW8gc21hcnQgY29udHJhY3QNCiAgICBQYXNzRGFvIHB1YmxpYyBwYXNzRGFvOw0KICAgIA0KICAgIC8vIFRoZSBwcm9qZWN0IG5hbWUNCiAgICBzdHJpbmcgcHVibGljIG5hbWU7DQogICAgLy8gVGhlIHByb2plY3QgZGVzY3JpcHRpb24NCiAgICBzdHJpbmcgcHVibGljIGRlc2NyaXB0aW9uOw0KICAgIC8vIFRoZSBIYXNoIE9mIHRoZSBwcm9qZWN0IERvY3VtZW50DQogICAgYnl0ZXMzMiBwdWJsaWMgaGFzaE9mVGhlRG9jdW1lbnQ7DQogICAgLy8gVGhlIHByb2plY3QgbWFuYWdlciBzbWFydCBjb250cmFjdA0KICAgIGFkZHJlc3MgcHJvamVjdE1hbmFnZXI7DQoNCiAgICBzdHJ1Y3Qgb3JkZXIgew0KICAgICAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3RvciBzbWFydCBjb250cmFjdA0KICAgICAgICBhZGRyZXNzIGNvbnRyYWN0b3JBZGRyZXNzOw0KICAgICAgICAvLyBUaGUgaW5kZXggb2YgdGhlIGNvbnRyYWN0b3IgcHJvcG9zYWwNCiAgICAgICAgdWludCBjb250cmFjdG9yUHJvcG9zYWxJRDsNCiAgICAgICAgLy8gVGhlIGFtb3VudCBvZiB0aGUgb3JkZXINCiAgICAgICAgdWludCBhbW91bnQ7DQogICAgICAgIC8vIFRoZSBkYXRlIG9mIHRoZSBvcmRlcg0KICAgICAgICB1aW50IG9yZGVyRGF0ZTsNCiAgICB9DQogICAgLy8gVGhlIG9yZGVycyBvZiB0aGUgRGFvIGZvciB0aGlzIHByb2plY3QNCiAgICBvcmRlcltdIHB1YmxpYyBvcmRlcnM7DQogICAgDQogICAgLy8gVGhlIHRvdGFsIGFtb3VudCBvZiBvcmRlcnMgaW4gd2VpIGZvciB0aGlzIHByb2plY3QNCiAgICB1aW50IHB1YmxpYyB0b3RhbEFtb3VudE9mT3JkZXJzOw0KDQogICAgc3RydWN0IHJlc29sdXRpb24gew0KICAgICAgICAvLyBUaGUgbmFtZSBvZiB0aGUgcmVzb2x1dGlvbg0KICAgICAgICBzdHJpbmcgbmFtZTsNCiAgICAgICAgLy8gQSBkZXNjcmlwdGlvbiBvZiB0aGUgcmVzb2x1dGlvbg0KICAgICAgICBzdHJpbmcgZGVzY3JpcHRpb247DQogICAgICAgIC8vIFRoZSBkYXRlIG9mIHRoZSByZXNvbHV0aW9uDQogICAgICAgIHVpbnQgY3JlYXRpb25EYXRlOw0KICAgIH0NCiAgICAvLyBSZXNvbHV0aW9ucyBvZiB0aGUgRGFvIGZvciB0aGlzIHByb2plY3QNCiAgICByZXNvbHV0aW9uW10gcHVibGljIHJlc29sdXRpb25zOw0KICAgIA0KLy8gRXZlbnRzDQoNCiAgICBldmVudCBPcmRlckFkZGVkKGFkZHJlc3MgaW5kZXhlZCBDbGllbnQsIGFkZHJlc3MgaW5kZXhlZCBDb250cmFjdG9yQWRkcmVzcywgdWludCBpbmRleGVkIENvbnRyYWN0b3JQcm9wb3NhbElELCB1aW50IEFtb3VudCwgdWludCBPcmRlckRhdGUpOw0KICAgIGV2ZW50IFByb2plY3REZXNjcmlwdGlvblVwZGF0ZWQoYWRkcmVzcyBpbmRleGVkIEJ5LCBzdHJpbmcgTmV3RGVzY3JpcHRpb24sIGJ5dGVzMzIgTmV3SGFzaE9mVGhlRG9jdW1lbnQpOw0KICAgIGV2ZW50IFJlc29sdXRpb25BZGRlZChhZGRyZXNzIGluZGV4ZWQgQ2xpZW50LCB1aW50IGluZGV4ZWQgUmVzb2x1dGlvbklELCBzdHJpbmcgTmFtZSwgc3RyaW5nIERlc2NyaXB0aW9uKTsNCg0KLy8gQ29uc3RhbnQgZnVuY3Rpb25zICANCg0KICAgIC8vLyBAcmV0dXJuIHRoZSBhY3R1YWwgY29tbWl0dGVlIHJvb20gb2YgdGhlIERhbyAgIA0KICAgIGZ1bmN0aW9uIENsaWVudCgpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsNCiAgICAgICAgcmV0dXJuIHBhc3NEYW8uQWN0dWFsQ29tbWl0dGVlUm9vbSgpOw0KICAgIH0NCiAgICANCiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIG9yZGVycyANCiAgICBmdW5jdGlvbiBudW1iZXJPZk9yZGVycygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIG9yZGVycy5sZW5ndGggLSAxOw0KICAgIH0NCiAgICANCiAgICAvLy8gQHJldHVybiBUaGUgcHJvamVjdCBNYW5hZ2VyIGFkZHJlc3MNCiAgICBmdW5jdGlvbiBQcm9qZWN0TWFuYWdlcigpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsNCiAgICAgICAgcmV0dXJuIHByb2plY3RNYW5hZ2VyOw0KICAgIH0NCg0KICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgcmVzb2x1dGlvbnMgDQogICAgZnVuY3Rpb24gbnVtYmVyT2ZSZXNvbHV0aW9ucygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHJlc29sdXRpb25zLmxlbmd0aCAtIDE7DQogICAgfQ0KICAgIA0KLy8gbW9kaWZpZXJzDQoNCiAgICAvLyBNb2RpZmllciBmb3IgcHJvamVjdCBtYW5hZ2VyIGZ1bmN0aW9ucyANCiAgICBtb2RpZmllciBvbmx5UHJvamVjdE1hbmFnZXIge2lmIChtc2cuc2VuZGVyICE9IHByb2plY3RNYW5hZ2VyKSB0aHJvdzsgXzt9DQoNCiAgICAvLyBNb2RpZmllciBmb3IgdGhlIERhbyBmdW5jdGlvbnMgDQogICAgbW9kaWZpZXIgb25seUNsaWVudCB7aWYgKG1zZy5zZW5kZXIgIT0gQ2xpZW50KCkpIHRocm93OyBfO30NCg0KLy8gQ29uc3RydWN0b3IgZnVuY3Rpb24NCg0KICAgIGZ1bmN0aW9uIFBhc3NQcm9qZWN0KA0KICAgICAgICBQYXNzRGFvIF9wYXNzRGFvLCANCiAgICAgICAgc3RyaW5nIF9uYW1lLA0KICAgICAgICBzdHJpbmcgX2Rlc2NyaXB0aW9uLA0KICAgICAgICBieXRlczMyIF9oYXNoT2ZUaGVEb2N1bWVudCkgew0KDQogICAgICAgIHBhc3NEYW8gPSBfcGFzc0RhbzsNCiAgICAgICAgbmFtZSA9IF9uYW1lOw0KICAgICAgICBkZXNjcmlwdGlvbiA9IF9kZXNjcmlwdGlvbjsNCiAgICAgICAgaGFzaE9mVGhlRG9jdW1lbnQgPSBfaGFzaE9mVGhlRG9jdW1lbnQ7DQogICAgICAgIA0KICAgICAgICBvcmRlcnMubGVuZ3RoID0gMTsNCiAgICAgICAgcmVzb2x1dGlvbnMubGVuZ3RoID0gMTsNCiAgICB9DQogICAgDQovLyBJbnRlcm5hbCBmdW5jdGlvbnMNCg0KICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIHJlZ2lzdGVyIGEgbmV3IG9yZGVyDQogICAgLy8vIEBwYXJhbSBfY29udHJhY3RvckFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0b3Igc21hcnQgY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9jb250cmFjdG9yUHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIGNvbnRyYWN0b3IgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB3ZWkgb2YgdGhlIG9yZGVyDQogICAgLy8vIEBwYXJhbSBfb3JkZXJEYXRlIFRoZSBkYXRlIG9mIHRoZSBvcmRlciANCiAgICBmdW5jdGlvbiBhZGRPcmRlcigNCg0KICAgICAgICBhZGRyZXNzIF9jb250cmFjdG9yQWRkcmVzcywgDQogICAgICAgIHVpbnQgX2NvbnRyYWN0b3JQcm9wb3NhbElELCANCiAgICAgICAgdWludCBfYW1vdW50LCANCiAgICAgICAgdWludCBfb3JkZXJEYXRlKSBpbnRlcm5hbCB7DQoNCiAgICAgICAgdWludCBfb3JkZXJJRCA9IG9yZGVycy5sZW5ndGgrKzsNCiAgICAgICAgb3JkZXIgZCA9IG9yZGVyc1tfb3JkZXJJRF07DQogICAgICAgIGQuY29udHJhY3RvckFkZHJlc3MgPSBfY29udHJhY3RvckFkZHJlc3M7DQogICAgICAgIGQuY29udHJhY3RvclByb3Bvc2FsSUQgPSBfY29udHJhY3RvclByb3Bvc2FsSUQ7DQogICAgICAgIGQuYW1vdW50ID0gX2Ftb3VudDsNCiAgICAgICAgZC5vcmRlckRhdGUgPSBfb3JkZXJEYXRlOw0KICAgICAgICANCiAgICAgICAgdG90YWxBbW91bnRPZk9yZGVycyArPSBfYW1vdW50Ow0KICAgICAgICANCiAgICAgICAgT3JkZXJBZGRlZChtc2cuc2VuZGVyLCBfY29udHJhY3RvckFkZHJlc3MsIF9jb250cmFjdG9yUHJvcG9zYWxJRCwgX2Ftb3VudCwgX29yZGVyRGF0ZSk7DQogICAgfQ0KICAgIA0KLy8gU2V0dGluZyBmdW5jdGlvbnMNCg0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGFsbG93IGNsb25pbmcgb3JkZXJzIGluIGNhc2Ugb2YgdXBncmFkZQ0KICAgIC8vLyBAcGFyYW0gX2NvbnRyYWN0b3JBZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdG9yIHNtYXJ0IGNvbnRyYWN0DQogICAgLy8vIEBwYXJhbSBfY29udHJhY3RvclByb3Bvc2FsSUQgVGhlIGluZGV4IG9mIHRoZSBjb250cmFjdG9yIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfb3JkZXJBbW91bnQgVGhlIGFtb3VudCBpbiB3ZWkgb2YgdGhlIG9yZGVyDQogICAgLy8vIEBwYXJhbSBfbGFzdE9yZGVyRGF0ZSBUaGUgdW5peCBkYXRlIG9mIHRoZSBsYXN0IG9yZGVyIA0KICAgIGZ1bmN0aW9uIGNsb25lT3JkZXIoDQogICAgICAgIGFkZHJlc3MgX2NvbnRyYWN0b3JBZGRyZXNzLCANCiAgICAgICAgdWludCBfY29udHJhY3RvclByb3Bvc2FsSUQsIA0KICAgICAgICB1aW50IF9vcmRlckFtb3VudCwgDQogICAgICAgIHVpbnQgX2xhc3RPcmRlckRhdGUpIHsNCiAgICAgICAgDQogICAgICAgIGlmIChwcm9qZWN0TWFuYWdlciAhPSAwKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIGFkZE9yZGVyKF9jb250cmFjdG9yQWRkcmVzcywgX2NvbnRyYWN0b3JQcm9wb3NhbElELCBfb3JkZXJBbW91bnQsIF9sYXN0T3JkZXJEYXRlKTsNCiAgICB9DQogICAgDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gc2V0IHRoZSBwcm9qZWN0IG1hbmFnZXINCiAgICAvLy8gQHBhcmFtIF9wcm9qZWN0TWFuYWdlciBUaGUgYWRkcmVzcyBvZiB0aGUgcHJvamVjdCBtYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0DQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBzdWNjZXNzZnVsDQogICAgZnVuY3Rpb24gc2V0UHJvamVjdE1hbmFnZXIoYWRkcmVzcyBfcHJvamVjdE1hbmFnZXIpIHJldHVybnMgKGJvb2wpIHsNCg0KICAgICAgICBpZiAoX3Byb2plY3RNYW5hZ2VyID09IDAgfHwgcHJvamVjdE1hbmFnZXIgIT0gMCkgcmV0dXJuOw0KICAgICAgICANCiAgICAgICAgcHJvamVjdE1hbmFnZXIgPSBfcHJvamVjdE1hbmFnZXI7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCi8vIFByb2plY3QgbWFuYWdlciBmdW5jdGlvbnMNCg0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGFsbG93IHRoZSBwcm9qZWN0IG1hbmFnZXIgdXBkYXRpbmcgdGhlIGRlc2NyaXB0aW9uIG9mIHRoZSBwcm9qZWN0DQogICAgLy8vIEBwYXJhbSBfcHJvamVjdERlc2NyaXB0aW9uIEEgZGVzY3JpcHRpb24gb2YgdGhlIHByb2plY3QNCiAgICAvLy8gQHBhcmFtIF9oYXNoT2ZUaGVEb2N1bWVudCBUaGUgaGFzaCBvZiB0aGUgbGFzdCBkb2N1bWVudA0KICAgIGZ1bmN0aW9uIHVwZGF0ZURlc2NyaXB0aW9uKHN0cmluZyBfcHJvamVjdERlc2NyaXB0aW9uLCBieXRlczMyIF9oYXNoT2ZUaGVEb2N1bWVudCkgb25seVByb2plY3RNYW5hZ2VyIHsNCiAgICAgICAgZGVzY3JpcHRpb24gPSBfcHJvamVjdERlc2NyaXB0aW9uOw0KICAgICAgICBoYXNoT2ZUaGVEb2N1bWVudCA9IF9oYXNoT2ZUaGVEb2N1bWVudDsNCiAgICAgICAgUHJvamVjdERlc2NyaXB0aW9uVXBkYXRlZChtc2cuc2VuZGVyLCBfcHJvamVjdERlc2NyaXB0aW9uLCBfaGFzaE9mVGhlRG9jdW1lbnQpOw0KICAgIH0NCg0KLy8gQ2xpZW50IGZ1bmN0aW9ucw0KDQogICAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gYWxsb3cgdGhlIERhbyB0byByZWdpc3RlciBhIG5ldyBvcmRlcg0KICAgIC8vLyBAcGFyYW0gX2NvbnRyYWN0b3JBZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdG9yIHNtYXJ0IGNvbnRyYWN0DQogICAgLy8vIEBwYXJhbSBfY29udHJhY3RvclByb3Bvc2FsSUQgVGhlIGluZGV4IG9mIHRoZSBjb250cmFjdG9yIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gd2VpIG9mIHRoZSBvcmRlcg0KICAgIGZ1bmN0aW9uIG5ld09yZGVyKA0KICAgICAgICBhZGRyZXNzIF9jb250cmFjdG9yQWRkcmVzcywgDQogICAgICAgIHVpbnQgX2NvbnRyYWN0b3JQcm9wb3NhbElELCANCiAgICAgICAgdWludCBfYW1vdW50KSBvbmx5Q2xpZW50IHsNCiAgICAgICAgICAgIA0KICAgICAgICBhZGRPcmRlcihfY29udHJhY3RvckFkZHJlc3MsIF9jb250cmFjdG9yUHJvcG9zYWxJRCwgX2Ftb3VudCwgbm93KTsNCiAgICB9DQogICAgDQogICAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gYWxsb3cgdGhlIERhbyB0byByZWdpc3RlciBhIG5ldyByZXNvbHV0aW9uDQogICAgLy8vIEBwYXJhbSBfbmFtZSBUaGUgbmFtZSBvZiB0aGUgcmVzb2x1dGlvbg0KICAgIC8vLyBAcGFyYW0gX2Rlc2NyaXB0aW9uIFRoZSBkZXNjcmlwdGlvbiBvZiB0aGUgcmVzb2x1dGlvbg0KICAgIGZ1bmN0aW9uIG5ld1Jlc29sdXRpb24oDQogICAgICAgIHN0cmluZyBfbmFtZSwgDQogICAgICAgIHN0cmluZyBfZGVzY3JpcHRpb24pIG9ubHlDbGllbnQgew0KDQogICAgICAgIHVpbnQgX3Jlc29sdXRpb25JRCA9IHJlc29sdXRpb25zLmxlbmd0aCsrOw0KICAgICAgICByZXNvbHV0aW9uIGQgPSByZXNvbHV0aW9uc1tfcmVzb2x1dGlvbklEXTsNCiAgICAgICAgDQogICAgICAgIGQubmFtZSA9IF9uYW1lOw0KICAgICAgICBkLmRlc2NyaXB0aW9uID0gX2Rlc2NyaXB0aW9uOw0KICAgICAgICBkLmNyZWF0aW9uRGF0ZSA9IG5vdzsNCg0KICAgICAgICBSZXNvbHV0aW9uQWRkZWQobXNnLnNlbmRlciwgX3Jlc29sdXRpb25JRCwgZC5uYW1lLCBkLmRlc2NyaXB0aW9uKTsNCiAgICB9DQp9DQoNCmNvbnRyYWN0IFBhc3NQcm9qZWN0Q3JlYXRvciB7DQogICAgDQogICAgZXZlbnQgTmV3UGFzc1Byb2plY3QoUGFzc0RhbyBpbmRleGVkIERhbywgUGFzc1Byb2plY3QgaW5kZXhlZCBQcm9qZWN0LCBzdHJpbmcgTmFtZSwgc3RyaW5nIERlc2NyaXB0aW9uLCBieXRlczMyIEhhc2hPZlRoZURvY3VtZW50KTsNCg0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGNyZWF0ZSBhIG5ldyBQYXNzIHByb2plY3QNCiAgICAvLy8gQHBhcmFtIF9wYXNzRGFvIFRoZSBQYXNzIERhbyBzbWFydCBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX25hbWUgVGhlIHByb2plY3QgbmFtZQ0KICAgIC8vLyBAcGFyYW0gX2Rlc2NyaXB0aW9uIFRoZSBwcm9qZWN0IGRlc2NyaXB0aW9uIChub3QgbWFuZGF0b3J5LCBjYW4gYmUgdXBkYXRlZCBhZnRlciBieSB0aGUgY3JlYXRvcikNCiAgICAvLy8gQHBhcmFtIF9oYXNoT2ZUaGVEb2N1bWVudCBUaGUgSGFzaCBPZiB0aGUgcHJvamVjdCBEb2N1bWVudCAobm90IG1hbmRhdG9yeSwgY2FuIGJlIHVwZGF0ZWQgYWZ0ZXIgYnkgdGhlIGNyZWF0b3IpDQogICAgZnVuY3Rpb24gY3JlYXRlUHJvamVjdCgNCiAgICAgICAgUGFzc0RhbyBfcGFzc0RhbywNCiAgICAgICAgc3RyaW5nIF9uYW1lLCANCiAgICAgICAgc3RyaW5nIF9kZXNjcmlwdGlvbiwgDQogICAgICAgIGJ5dGVzMzIgX2hhc2hPZlRoZURvY3VtZW50DQogICAgICAgICkgcmV0dXJucyAoUGFzc1Byb2plY3QpIHsNCg0KICAgICAgICBQYXNzUHJvamVjdCBfcGFzc1Byb2plY3QgPSBuZXcgUGFzc1Byb2plY3QoX3Bhc3NEYW8sIF9uYW1lLCBfZGVzY3JpcHRpb24sIF9oYXNoT2ZUaGVEb2N1bWVudCk7DQoNCiAgICAgICAgTmV3UGFzc1Byb2plY3QoX3Bhc3NEYW8sIF9wYXNzUHJvamVjdCwgX25hbWUsIF9kZXNjcmlwdGlvbiwgX2hhc2hPZlRoZURvY3VtZW50KTsNCg0KICAgICAgICByZXR1cm4gX3Bhc3NQcm9qZWN0Ow0KICAgIH0NCn0NCiAgICANCg0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuODsNCg0KLyoNCiAqDQogKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQYXNzIERBTy4NCiAqDQogKiBUaGUgUHJvamVjdCBzbWFydCBjb250cmFjdCBpcyB1c2VkIGZvciB0aGUgbWFuYWdlbWVudCBvZiB0aGUgUGFzcyBEYW8gcHJvamVjdHMuDQogKg0KKi8NCg0KLy8vIEB0aXRsZSBDb250cmFjdG9yIHNtYXJ0IGNvbnRyYWN0IG9mIHRoZSBQYXNzIERlY2VudHJhbGl6ZWQgQXV0b25vbW91cyBPcmdhbmlzYXRpb24NCmNvbnRyYWN0IFBhc3NDb250cmFjdG9yIHsNCiAgICANCiAgICAvLyBUaGUgcHJvamVjdCBzbWFydCBjb250cmFjdA0KICAgIFBhc3NQcm9qZWN0IHBhc3NQcm9qZWN0Ow0KICAgIA0KICAgIC8vIFRoZSBhZGRyZXNzIG9mIHRoZSBjcmVhdG9yIG9mIHRoaXMgc21hcnQgY29udHJhY3QNCiAgICBhZGRyZXNzIHB1YmxpYyBjcmVhdG9yOw0KICAgIC8vIEFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudDsNCiAgICBhZGRyZXNzIHB1YmxpYyByZWNpcGllbnQ7DQoNCiAgICAvLyBFbmQgZGF0ZSBvZiB0aGUgc2V0dXAgcHJvY2VkdXJlDQogICAgdWludCBwdWJsaWMgc21hcnRDb250cmFjdFN0YXJ0RGF0ZTsNCg0KICAgIHN0cnVjdCBwcm9wb3NhbCB7DQogICAgICAgIC8vIEFtb3VudCAoaW4gd2VpKSBvZiB0aGUgcHJvcG9zYWwNCiAgICAgICAgdWludCBhbW91bnQ7DQogICAgICAgIC8vIEEgZGVzY3JpcHRpb24gb2YgdGhlIHByb3Bvc2FsDQogICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbjsNCiAgICAgICAgLy8gVGhlIGhhc2ggb2YgdGhlIHByb3Bvc2FsJ3MgZG9jdW1lbnQNCiAgICAgICAgYnl0ZXMzMiBoYXNoT2ZUaGVEb2N1bWVudDsNCiAgICAgICAgLy8gQSB1bml4IHRpbWVzdGFtcCwgZGVub3RpbmcgdGhlIGRhdGUgd2hlbiB0aGUgcHJvcG9zYWwgd2FzIGNyZWF0ZWQNCiAgICAgICAgdWludCBkYXRlT2ZQcm9wb3NhbDsNCiAgICAgICAgLy8gVGhlIGFtb3VudCBzdWJtaXR0ZWQgdG8gYSB2b3RlDQogICAgICAgIHVpbnQgc3VibWl0dGVkQW1vdW50Ow0KICAgICAgICAvLyBUaGUgc3VtIGFtb3VudCAoaW4gd2VpKSBvcmRlcmVkIGZvciB0aGlzIHByb3Bvc2FsIA0KICAgICAgICB1aW50IG9yZGVyQW1vdW50Ow0KICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCBvcmRlciBmb3IgdGhlIGFwcHJvdmVkIHByb3Bvc2FsDQogICAgICAgIHVpbnQgZGF0ZU9mTGFzdE9yZGVyOw0KICAgIH0NCiAgICAvLyBQcm9wb3NhbHMgdG8gd29yayBmb3IgUGFzcyBEYW8NCiAgICBwcm9wb3NhbFtdIHB1YmxpYyBwcm9wb3NhbHM7DQoNCi8vIEV2ZW50cw0KDQogICAgZXZlbnQgUmVjaXBpZW50VXBkYXRlZChhZGRyZXNzIGluZGV4ZWQgQnksIGFkZHJlc3MgTGFzdFJlY2lwaWVudCwgYWRkcmVzcyBOZXdSZWNpcGllbnQpOw0KICAgIGV2ZW50IFdpdGhkcmF3YWwoYWRkcmVzcyBpbmRleGVkIEJ5LCBhZGRyZXNzIGluZGV4ZWQgUmVjaXBpZW50LCB1aW50IEFtb3VudCk7DQogICAgZXZlbnQgUHJvcG9zYWxBZGRlZChhZGRyZXNzIENyZWF0b3IsIHVpbnQgaW5kZXhlZCBQcm9wb3NhbElELCB1aW50IEFtb3VudCwgc3RyaW5nIERlc2NyaXB0aW9uLCBieXRlczMyIEhhc2hPZlRoZURvY3VtZW50KTsNCiAgICBldmVudCBQcm9wb3NhbFN1Ym1pdHRlZChhZGRyZXNzIGluZGV4ZWQgQ2xpZW50LCB1aW50IEFtb3VudCk7DQogICAgZXZlbnQgT3JkZXIoYWRkcmVzcyBpbmRleGVkIENsaWVudCwgdWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgQW1vdW50KTsNCg0KLy8gQ29uc3RhbnQgZnVuY3Rpb25zDQoNCiAgICAvLy8gQHJldHVybiB0aGUgYWN0dWFsIGNvbW1pdHRlZSByb29tIG9mIHRoZSBEYW8NCiAgICBmdW5jdGlvbiBDbGllbnQoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7DQogICAgICAgIHJldHVybiBwYXNzUHJvamVjdC5DbGllbnQoKTsNCiAgICB9DQoNCiAgICAvLy8gQHJldHVybiB0aGUgcHJvamVjdCBzbWFydCBjb250cmFjdA0KICAgIGZ1bmN0aW9uIFByb2plY3QoKSBjb25zdGFudCByZXR1cm5zIChQYXNzUHJvamVjdCkgew0KICAgICAgICByZXR1cm4gcGFzc1Byb2plY3Q7DQogICAgfQ0KICAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIGNsaWVudCB0byBjaGVjayB0aGUgcHJvcG9zYWwgYmVmb3JlIHN1Ym1pdHRpbmcNCiAgICAvLy8gQHBhcmFtIF9zZW5kZXIgVGhlIGNyZWF0b3Igb2YgdGhlIERhbyBwcm9wb3NhbA0KICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgVGhlIGluZGV4IG9mIHRoZSBwcm9wb3NhbA0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSBwcm9wb3NhbA0KICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIHByb3Bvc2FsIGNhbiBiZSBzdWJtaXR0ZWQNCiAgICBmdW5jdGlvbiBwcm9wb3NhbENoZWNrZWQoDQogICAgICAgIGFkZHJlc3MgX3NlbmRlciwNCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwgDQogICAgICAgIHVpbnQgX2Ftb3VudCkgY29uc3RhbnQgZXh0ZXJuYWwgb25seUNsaWVudCByZXR1cm5zIChib29sKSB7DQogICAgICAgIGlmIChfc2VuZGVyICE9IHJlY2lwaWVudCAmJiBfc2VuZGVyICE9IGNyZWF0b3IpIHJldHVybjsNCiAgICAgICAgaWYgKF9hbW91bnQgPD0gcHJvcG9zYWxzW19wcm9wb3NhbElEXS5hbW91bnQgLSBwcm9wb3NhbHNbX3Byb3Bvc2FsSURdLnN1Ym1pdHRlZEFtb3VudCkgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBwcm9wb3NhbHMgICAgIA0KICAgIGZ1bmN0aW9uIG51bWJlck9mUHJvcG9zYWxzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gcHJvcG9zYWxzLmxlbmd0aCAtIDE7DQogICAgfQ0KDQoNCi8vIE1vZGlmaWVycw0KDQogICAgLy8gTW9kaWZpZXIgZm9yIGNvbnRyYWN0b3IgZnVuY3Rpb25zDQogICAgbW9kaWZpZXIgb25seUNvbnRyYWN0b3Ige2lmIChtc2cuc2VuZGVyICE9IHJlY2lwaWVudCkgdGhyb3c7IF87fQ0KICAgIA0KICAgIC8vIE1vZGlmaWVyIGZvciBjbGllbnQgZnVuY3Rpb25zDQogICAgbW9kaWZpZXIgb25seUNsaWVudCB7aWYgKG1zZy5zZW5kZXIgIT0gQ2xpZW50KCkpIHRocm93OyBfO30NCg0KLy8gQ29uc3RydWN0b3IgZnVuY3Rpb24NCg0KICAgIGZ1bmN0aW9uIFBhc3NDb250cmFjdG9yKA0KICAgICAgICBhZGRyZXNzIF9jcmVhdG9yLCANCiAgICAgICAgUGFzc1Byb2plY3QgX3Bhc3NQcm9qZWN0LCANCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LA0KICAgICAgICBib29sIF9yZXN0b3JlKSB7IA0KDQogICAgICAgIGlmIChhZGRyZXNzKF9wYXNzUHJvamVjdCkgPT0gMCkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICBjcmVhdG9yID0gX2NyZWF0b3I7DQogICAgICAgIGlmIChfcmVjaXBpZW50ID09IDApIF9yZWNpcGllbnQgPSBfY3JlYXRvcjsNCiAgICAgICAgcmVjaXBpZW50ID0gX3JlY2lwaWVudDsNCiAgICAgICAgDQogICAgICAgIHBhc3NQcm9qZWN0ID0gX3Bhc3NQcm9qZWN0Ow0KICAgICAgICANCiAgICAgICAgaWYgKCFfcmVzdG9yZSkgc21hcnRDb250cmFjdFN0YXJ0RGF0ZSA9IG5vdzsNCg0KICAgICAgICBwcm9wb3NhbHMubGVuZ3RoID0gMTsNCiAgICB9DQoNCi8vIFNldHRpbmcgZnVuY3Rpb25zDQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBjbG9uZSBhIHByb3Bvc2FsIGZyb20gdGhlIGxhc3QgY29udHJhY3Rvcg0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBBbW91bnQgKGluIHdlaSkgb2YgdGhlIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfZGVzY3JpcHRpb24gQSBkZXNjcmlwdGlvbiBvZiB0aGUgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9oYXNoT2ZUaGVEb2N1bWVudCBUaGUgaGFzaCBvZiB0aGUgcHJvcG9zYWwncyBkb2N1bWVudA0KICAgIC8vLyBAcGFyYW0gX2RhdGVPZlByb3Bvc2FsIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBkYXRlIHdoZW4gdGhlIHByb3Bvc2FsIHdhcyBjcmVhdGVkDQogICAgLy8vIEBwYXJhbSBfb3JkZXJBbW91bnQgVGhlIHN1bSBhbW91bnQgKGluIHdlaSkgb3JkZXJlZCBmb3IgdGhpcyBwcm9wb3NhbCANCiAgICAvLy8gQHBhcmFtIF9kYXRlT2ZPcmRlciBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCBvcmRlciBmb3IgdGhlIGFwcHJvdmVkIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfY2xvbmVPcmRlciBUcnVlIGlmIHRoZSBvcmRlciBoYXMgdG8gYmUgY2xvbmVkIGluIHRoZSBwcm9qZWN0IHNtYXJ0IGNvbnRyYWN0DQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgZnVuY3Rpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90IA0KICAgIGZ1bmN0aW9uIGNsb25lUHJvcG9zYWwoDQogICAgICAgIHVpbnQgX2Ftb3VudCwNCiAgICAgICAgc3RyaW5nIF9kZXNjcmlwdGlvbiwNCiAgICAgICAgYnl0ZXMzMiBfaGFzaE9mVGhlRG9jdW1lbnQsDQogICAgICAgIHVpbnQgX2RhdGVPZlByb3Bvc2FsLA0KICAgICAgICB1aW50IF9vcmRlckFtb3VudCwNCiAgICAgICAgdWludCBfZGF0ZU9mT3JkZXIsDQogICAgICAgIGJvb2wgX2Nsb25lT3JkZXINCiAgICApIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICAgICAgDQogICAgICAgIGlmIChzbWFydENvbnRyYWN0U3RhcnREYXRlICE9IDAgfHwgcmVjaXBpZW50ID09IDANCiAgICAgICAgfHwgbXNnLnNlbmRlciAhPSBjcmVhdG9yKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQgPSBwcm9wb3NhbHMubGVuZ3RoKys7DQogICAgICAgIHByb3Bvc2FsIGMgPSBwcm9wb3NhbHNbX3Byb3Bvc2FsSURdOw0KDQogICAgICAgIGMuYW1vdW50ID0gX2Ftb3VudDsNCiAgICAgICAgYy5kZXNjcmlwdGlvbiA9IF9kZXNjcmlwdGlvbjsNCiAgICAgICAgYy5oYXNoT2ZUaGVEb2N1bWVudCA9IF9oYXNoT2ZUaGVEb2N1bWVudDsgDQogICAgICAgIGMuZGF0ZU9mUHJvcG9zYWwgPSBfZGF0ZU9mUHJvcG9zYWw7DQogICAgICAgIGMub3JkZXJBbW91bnQgPSBfb3JkZXJBbW91bnQ7DQogICAgICAgIGMuZGF0ZU9mTGFzdE9yZGVyID0gX2RhdGVPZk9yZGVyOw0KDQogICAgICAgIFByb3Bvc2FsQWRkZWQobXNnLnNlbmRlciwgX3Byb3Bvc2FsSUQsIF9hbW91bnQsIF9kZXNjcmlwdGlvbiwgX2hhc2hPZlRoZURvY3VtZW50KTsNCiAgICAgICAgDQogICAgICAgIGlmIChfY2xvbmVPcmRlcikgcGFzc1Byb2plY3QuY2xvbmVPcmRlcihhZGRyZXNzKHRoaXMpLCBfcHJvcG9zYWxJRCwgX29yZGVyQW1vdW50LCBfZGF0ZU9mT3JkZXIpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gY2xvc2UgdGhlIHNldHRpbmcgcHJvY2VkdXJlIGFuZCBzdGFydCB0byB1c2UgdGhpcyBzbWFydCBjb250cmFjdA0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIGNsb3NlU2V0dXAoKSByZXR1cm5zIChib29sKSB7DQogICAgICAgIA0KICAgICAgICBpZiAoc21hcnRDb250cmFjdFN0YXJ0RGF0ZSAhPSAwIA0KICAgICAgICAgICAgfHwgKG1zZy5zZW5kZXIgIT0gY3JlYXRvciAmJiBtc2cuc2VuZGVyICE9IENsaWVudCgpKSkgcmV0dXJuOw0KDQogICAgICAgIHNtYXJ0Q29udHJhY3RTdGFydERhdGUgPSBub3c7DQoNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KLy8gQWNjb3VudCBNYW5hZ2VtZW50DQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byB1cGRhdGUgdGhlIHJlY2lwZW50IGFkZHJlc3MNCiAgICAvLy8gQHBhcmFtIF9uZXdSZWNpcGllbnQgVGhlIGFkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgZnVuY3Rpb24gdXBkYXRlUmVjaXBpZW50KGFkZHJlc3MgX25ld1JlY2lwaWVudCkgb25seUNvbnRyYWN0b3Igew0KDQogICAgICAgIGlmIChfbmV3UmVjaXBpZW50ID09IDApIHRocm93Ow0KDQogICAgICAgIFJlY2lwaWVudFVwZGF0ZWQobXNnLnNlbmRlciwgcmVjaXBpZW50LCBfbmV3UmVjaXBpZW50KTsNCiAgICAgICAgcmVjaXBpZW50ID0gX25ld1JlY2lwaWVudDsNCiAgICB9IA0KDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gcmVjZWl2ZSBwYXltZW50cw0KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgeyB9DQogICAgDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gYWxsb3cgY29udHJhY3RvcnMgdG8gd2l0aGRyYXcgZXRoZXJzDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIHdlaSkgdG8gd2l0aGRyYXcNCiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50IF9hbW91bnQpIG9ubHlDb250cmFjdG9yIHsNCiAgICAgICAgaWYgKCFyZWNpcGllbnQuc2VuZChfYW1vdW50KSkgdGhyb3c7DQogICAgICAgIFdpdGhkcmF3YWwobXNnLnNlbmRlciwgcmVjaXBpZW50LCBfYW1vdW50KTsNCiAgICB9DQogICAgDQovLyBQcm9qZWN0IE1hbmFnZXIgRnVuY3Rpb25zICAgIA0KDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gYWxsb3cgdGhlIHByb2plY3QgbWFuYWdlciB1cGRhdGluZyB0aGUgZGVzY3JpcHRpb24gb2YgdGhlIHByb2plY3QNCiAgICAvLy8gQHBhcmFtIF9wcm9qZWN0RGVzY3JpcHRpb24gQSBkZXNjcmlwdGlvbiBvZiB0aGUgcHJvamVjdA0KICAgIC8vLyBAcGFyYW0gX2hhc2hPZlRoZURvY3VtZW50IFRoZSBoYXNoIG9mIHRoZSBsYXN0IGRvY3VtZW50DQogICAgZnVuY3Rpb24gdXBkYXRlUHJvamVjdERlc2NyaXB0aW9uKHN0cmluZyBfcHJvamVjdERlc2NyaXB0aW9uLCBieXRlczMyIF9oYXNoT2ZUaGVEb2N1bWVudCkgb25seUNvbnRyYWN0b3Igew0KICAgICAgICBwYXNzUHJvamVjdC51cGRhdGVEZXNjcmlwdGlvbihfcHJvamVjdERlc2NyaXB0aW9uLCBfaGFzaE9mVGhlRG9jdW1lbnQpOw0KICAgIH0NCiAgICANCi8vIE1hbmFnZW1lbnQgb2YgcHJvcG9zYWxzDQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBtYWtlIGEgcHJvcG9zYWwgdG8gd29yayBmb3IgdGhlIGNsaWVudA0KICAgIC8vLyBAcGFyYW0gX2NyZWF0b3IgVGhlIGFkZHJlc3Mgb2YgdGhlIGNyZWF0b3Igb2YgdGhlIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfZGVzY3JpcHRpb24gU3RyaW5nIGRlc2NyaWJpbmcgdGhlIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfaGFzaE9mVGhlRG9jdW1lbnQgVGhlIGhhc2ggb2YgdGhlIHByb3Bvc2FsIGRvY3VtZW50DQogICAgLy8vIEByZXR1cm4gVGhlIGluZGV4IG9mIHRoZSBjb250cmFjdG9yIHByb3Bvc2FsDQogICAgZnVuY3Rpb24gbmV3UHJvcG9zYWwoDQogICAgICAgIGFkZHJlc3MgX2NyZWF0b3IsDQogICAgICAgIHVpbnQgX2Ftb3VudCwNCiAgICAgICAgc3RyaW5nIF9kZXNjcmlwdGlvbiwgDQogICAgICAgIGJ5dGVzMzIgX2hhc2hPZlRoZURvY3VtZW50DQogICAgKSBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIA0KICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBDbGllbnQoKSAmJiBfY3JlYXRvciAhPSByZWNpcGllbnQgJiYgX2NyZWF0b3IgIT0gY3JlYXRvcikgdGhyb3c7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IENsaWVudCgpICYmIG1zZy5zZW5kZXIgIT0gcmVjaXBpZW50ICYmIG1zZy5zZW5kZXIgIT0gY3JlYXRvcikgdGhyb3c7DQoNCiAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICB1aW50IF9wcm9wb3NhbElEID0gcHJvcG9zYWxzLmxlbmd0aCsrOw0KICAgICAgICBwcm9wb3NhbCBjID0gcHJvcG9zYWxzW19wcm9wb3NhbElEXTsNCg0KICAgICAgICBjLmFtb3VudCA9IF9hbW91bnQ7DQogICAgICAgIGMuZGVzY3JpcHRpb24gPSBfZGVzY3JpcHRpb247DQogICAgICAgIGMuaGFzaE9mVGhlRG9jdW1lbnQgPSBfaGFzaE9mVGhlRG9jdW1lbnQ7IA0KICAgICAgICBjLmRhdGVPZlByb3Bvc2FsID0gbm93Ow0KICAgICAgICANCiAgICAgICAgUHJvcG9zYWxBZGRlZChtc2cuc2VuZGVyLCBfcHJvcG9zYWxJRCwgYy5hbW91bnQsIGMuZGVzY3JpcHRpb24sIGMuaGFzaE9mVGhlRG9jdW1lbnQpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIF9wcm9wb3NhbElEOw0KICAgIH0NCiAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBjbGllbnQgdG8gaW5mb3IgYWJvdXQgdGhlIHN1Ym1pdHRlZCBhbW91bnQNCiAgICAvLy8gQHBhcmFtIF9zZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlciB3aG8gc3VibWl0cyB0aGUgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIFRoZSBpbmRleCBvZiB0aGUgY29udHJhY3RvciBwcm9wb3NhbA0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIHN1Ym1pdHRlZA0KICAgIGZ1bmN0aW9uIHN1Ym1pdFByb3Bvc2FsKA0KICAgICAgICBhZGRyZXNzIF9zZW5kZXIsIA0KICAgICAgICB1aW50IF9wcm9wb3NhbElELCANCiAgICAgICAgdWludCBfYW1vdW50KSBvbmx5Q2xpZW50IHsNCg0KICAgICAgICBpZiAoX3NlbmRlciAhPSByZWNpcGllbnQgJiYgX3NlbmRlciAhPSBjcmVhdG9yKSB0aHJvdzsgICAgDQogICAgICAgIHByb3Bvc2Fsc1tfcHJvcG9zYWxJRF0uc3VibWl0dGVkQW1vdW50ICs9IF9hbW91bnQ7DQogICAgICAgIFByb3Bvc2FsU3VibWl0dGVkKG1zZy5zZW5kZXIsIF9hbW91bnQpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIGNsaWVudCB0byBvcmRlciBhY2NvcmRpbmcgdG8gdGhlIGNvbnRyYWN0b3IgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIFRoZSBpbmRleCBvZiB0aGUgY29udHJhY3RvciBwcm9wb3NhbA0KICAgIC8vLyBAcGFyYW0gX29yZGVyQW1vdW50IFRoZSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIG9yZGVyDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgb3JkZXIgd2FzIG1hZGUgb3Igbm90DQogICAgZnVuY3Rpb24gb3JkZXIoDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQsDQogICAgICAgIHVpbnQgX29yZGVyQW1vdW50DQogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IHJldHVybnMgKGJvb2wpIHsNCiAgICANCiAgICAgICAgcHJvcG9zYWwgYyA9IHByb3Bvc2Fsc1tfcHJvcG9zYWxJRF07DQogICAgICAgIA0KICAgICAgICB1aW50IF9zdW0gPSBjLm9yZGVyQW1vdW50ICsgX29yZGVyQW1vdW50Ow0KICAgICAgICBpZiAoX3N1bSA+IGMuYW1vdW50DQogICAgICAgICAgICB8fCBfc3VtIDwgYy5vcmRlckFtb3VudA0KICAgICAgICAgICAgfHwgX3N1bSA8IF9vcmRlckFtb3VudCkgcmV0dXJuOyANCg0KICAgICAgICBjLm9yZGVyQW1vdW50ID0gX3N1bTsNCiAgICAgICAgYy5kYXRlT2ZMYXN0T3JkZXIgPSBub3c7DQogICAgICAgIA0KICAgICAgICBPcmRlcihtc2cuc2VuZGVyLCBfcHJvcG9zYWxJRCwgX29yZGVyQW1vdW50KTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICANCn0NCg0KY29udHJhY3QgUGFzc0NvbnRyYWN0b3JDcmVhdG9yIHsNCiAgICANCiAgICAvLyBBZGRyZXNzIG9mIHRoZSBwYXNzIERhbyBzbWFydCBjb250cmFjdA0KICAgIFBhc3NEYW8gcHVibGljIHBhc3NEYW87DQogICAgLy8gQWRkcmVzcyBvZiB0aGUgUGFzcyBQcm9qZWN0IGNyZWF0b3INCiAgICBQYXNzUHJvamVjdENyZWF0b3IgcHVibGljIHByb2plY3RDcmVhdG9yOw0KICAgIA0KICAgIHN0cnVjdCBjb250cmFjdG9yIHsNCiAgICAgICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0b3INCiAgICAgICAgYWRkcmVzcyBjcmVhdG9yOw0KICAgICAgICAvLyBUaGUgY29udHJhY3RvciBzbWFydCBjb250cmFjdA0KICAgICAgICBQYXNzQ29udHJhY3RvciBjb250cmFjdG9yOw0KICAgICAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50IGZvciB3aXRoZHJhd2Fscw0KICAgICAgICBhZGRyZXNzIHJlY2lwaWVudDsNCiAgICAgICAgLy8gVHJ1ZSBpZiBtZXRhIHByb2plY3QNCiAgICAgICAgYm9vbCBtZXRhUHJvamVjdDsNCiAgICAgICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIGV4aXN0aW5nIHByb2plY3Qgc21hcnQgY29udHJhY3QNCiAgICAgICAgUGFzc1Byb2plY3QgcGFzc1Byb2plY3Q7DQogICAgICAgIC8vIFRoZSBuYW1lIG9mIHRoZSBwcm9qZWN0IChpZiB0aGUgcHJvamVjdCBzbWFydCBjb250cmFjdCBkb2Vzbid0IGV4aXN0KQ0KICAgICAgICBzdHJpbmcgcHJvamVjdE5hbWU7DQogICAgICAgIC8vIEEgZGVzY3JpcHRpb24gb2YgdGhlIHByb2plY3QgKGNhbiBiZSB1cGRhdGVkIGFmdGVyKQ0KICAgICAgICBzdHJpbmcgcHJvamVjdERlc2NyaXB0aW9uOw0KICAgICAgICAvLyBUaGUgdW5peCBjcmVhdGlvbiBkYXRlIG9mIHRoZSBjb250cmFjdG9yDQogICAgICAgIHVpbnQgY3JlYXRpb25EYXRlOw0KICAgIH0NCiAgICAvLyBjb250cmFjdG9ycyBjcmVhdGVkIHRvIHdvcmsgZm9yIFBhc3MgRGFvDQogICAgY29udHJhY3RvcltdIHB1YmxpYyBjb250cmFjdG9yczsNCiAgICANCiAgICBldmVudCBOZXdQYXNzQ29udHJhY3RvcihhZGRyZXNzIGluZGV4ZWQgQ3JlYXRvciwgYWRkcmVzcyBpbmRleGVkIFJlY2lwaWVudCwgUGFzc1Byb2plY3QgaW5kZXhlZCBQcm9qZWN0LCBQYXNzQ29udHJhY3RvciBDb250cmFjdG9yKTsNCg0KICAgIGZ1bmN0aW9uIFBhc3NDb250cmFjdG9yQ3JlYXRvcihQYXNzRGFvIF9wYXNzRGFvLCBQYXNzUHJvamVjdENyZWF0b3IgX3Byb2plY3RDcmVhdG9yKSB7DQogICAgICAgIHBhc3NEYW8gPSBfcGFzc0RhbzsNCiAgICAgICAgcHJvamVjdENyZWF0b3IgPSBfcHJvamVjdENyZWF0b3I7DQogICAgICAgIGNvbnRyYWN0b3JzLmxlbmd0aCA9IDA7DQogICAgfQ0KDQogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBjcmVhdGVkIGNvbnRyYWN0b3JzIA0KICAgIGZ1bmN0aW9uIG51bWJlck9mQ29udHJhY3RvcnMoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBjb250cmFjdG9ycy5sZW5ndGg7DQogICAgfQ0KICAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGNvbnRyYWN0b3Igc21hcnQgY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yIFRoZSBhZGRyZXNzIG9mIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdG9yDQogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQgZm9yIHdpdGhkcmF3YWxzDQogICAgLy8vIEBwYXJhbSBfbWV0YVByb2plY3QgVHJ1ZSBpZiBtZXRhIHByb2plY3QNCiAgICAvLy8gQHBhcmFtIF9wYXNzUHJvamVjdCBUaGUgYWRkcmVzcyBvZiB0aGUgZXhpc3RpbmcgcHJvamVjdCBzbWFydCBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX3Byb2plY3ROYW1lIFRoZSBuYW1lIG9mIHRoZSBwcm9qZWN0IChpZiB0aGUgcHJvamVjdCBzbWFydCBjb250cmFjdCBkb2Vzbid0IGV4aXN0KQ0KICAgIC8vLyBAcGFyYW0gX3Byb2plY3REZXNjcmlwdGlvbiBBIGRlc2NyaXB0aW9uIG9mIHRoZSBwcm9qZWN0IChjYW4gYmUgdXBkYXRlZCBhZnRlcikNCiAgICAvLy8gQHBhcmFtIF9yZXN0b3JlIFRydWUgaWYgb3JkZXJzIG9yIHByb3Bvc2FscyBhcmUgdG8gYmUgY2xvbmVkIGZyb20gb3RoZXIgY29udHJhY3RzDQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIGNyZWF0ZWQgY29udHJhY3RvciBzbWFydCBjb250cmFjdA0KICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbnRyYWN0b3IoDQogICAgICAgIGFkZHJlc3MgX2NyZWF0b3IsDQogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgDQogICAgICAgIGJvb2wgX21ldGFQcm9qZWN0LA0KICAgICAgICBQYXNzUHJvamVjdCBfcGFzc1Byb2plY3QsDQogICAgICAgIHN0cmluZyBfcHJvamVjdE5hbWUsIA0KICAgICAgICBzdHJpbmcgX3Byb2plY3REZXNjcmlwdGlvbiwNCiAgICAgICAgYm9vbCBfcmVzdG9yZSkgcmV0dXJucyAoUGFzc0NvbnRyYWN0b3IpIHsNCiANCiAgICAgICAgUGFzc1Byb2plY3QgX3Byb2plY3Q7DQoNCiAgICAgICAgaWYgKF9jcmVhdG9yID09IDApIF9jcmVhdG9yID0gbXNnLnNlbmRlcjsNCiAgICAgICAgDQogICAgICAgIGlmIChfbWV0YVByb2plY3QpIF9wcm9qZWN0ID0gUGFzc1Byb2plY3QocGFzc0Rhby5NZXRhUHJvamVjdCgpKTsNCiAgICAgICAgZWxzZSBpZiAoYWRkcmVzcyhfcGFzc1Byb2plY3QpID09IDApIA0KICAgICAgICAgICAgX3Byb2plY3QgPSBwcm9qZWN0Q3JlYXRvci5jcmVhdGVQcm9qZWN0KHBhc3NEYW8sIF9wcm9qZWN0TmFtZSwgX3Byb2plY3REZXNjcmlwdGlvbiwgMCk7DQogICAgICAgIGVsc2UgX3Byb2plY3QgPSBfcGFzc1Byb2plY3Q7DQoNCiAgICAgICAgUGFzc0NvbnRyYWN0b3IgX2NvbnRyYWN0b3IgPSBuZXcgUGFzc0NvbnRyYWN0b3IoX2NyZWF0b3IsIF9wcm9qZWN0LCBfcmVjaXBpZW50LCBfcmVzdG9yZSk7DQogICAgICAgIGlmICghX21ldGFQcm9qZWN0ICYmIGFkZHJlc3MoX3Bhc3NQcm9qZWN0KSA9PSAwICYmICFfcmVzdG9yZSkgX3Byb2plY3Quc2V0UHJvamVjdE1hbmFnZXIoYWRkcmVzcyhfY29udHJhY3RvcikpOw0KICAgICAgICANCiAgICAgICAgdWludCBfY29udHJhY3RvcklEID0gY29udHJhY3RvcnMubGVuZ3RoKys7DQogICAgICAgIGNvbnRyYWN0b3IgYyA9IGNvbnRyYWN0b3JzW19jb250cmFjdG9ySURdOw0KICAgICAgICBjLmNyZWF0b3IgPSBfY3JlYXRvcjsNCiAgICAgICAgYy5jb250cmFjdG9yID0gX2NvbnRyYWN0b3I7DQogICAgICAgIGMucmVjaXBpZW50ID0gX3JlY2lwaWVudDsNCiAgICAgICAgYy5tZXRhUHJvamVjdCA9IF9tZXRhUHJvamVjdDsNCiAgICAgICAgYy5wYXNzUHJvamVjdCA9IF9wYXNzUHJvamVjdDsNCiAgICAgICAgYy5wcm9qZWN0TmFtZSA9IF9wcm9qZWN0TmFtZTsNCiAgICAgICAgYy5wcm9qZWN0RGVzY3JpcHRpb24gPSBfcHJvamVjdERlc2NyaXB0aW9uOw0KICAgICAgICBjLmNyZWF0aW9uRGF0ZSA9IG5vdzsNCg0KICAgICAgICBOZXdQYXNzQ29udHJhY3RvcihfY3JlYXRvciwgX3JlY2lwaWVudCwgX3Byb2plY3QsIF9jb250cmFjdG9yKTsNCiANCiAgICAgICAgcmV0dXJuIF9jb250cmFjdG9yOw0KICAgIH0NCiAgICANCn0NCg0KDQpwcmFnbWEgc29saWRpdHkgXjAuNC44Ow0KDQovKg0KICoNCiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFBhc3MgREFPLg0KICoNCg0KLyoNClNtYXJ0IGNvbnRyYWN0IGZvciBhIERlY2VudHJhbGl6ZWQgQXV0b25vbW91cyBPcmdhbml6YXRpb24gKERBTykNCnRvIGF1dG9tYXRlIG9yZ2FuaXphdGlvbmFsIGdvdmVybmFuY2UgYW5kIGRlY2lzaW9uLW1ha2luZy4NCiovDQoNCi8vLyBAdGl0bGUgUGFzcyBDb21taXR0ZWUgUm9vbQ0KY29udHJhY3QgUGFzc0NvbW1pdHRlZVJvb21JbnRlcmZhY2Ugew0KDQogICAgLy8gVGhlIFBhc3MgRGFvIHNtYXJ0IGNvbnRyYWN0DQogICAgUGFzc0RhbyBwdWJsaWMgcGFzc0RhbzsNCg0KICAgIGVudW0gUHJvcG9zYWxUeXBlcyB7IGNvbnRyYWN0b3IsIHJlc29sdXRpb24sIHJ1bGVzLCB1cGdyYWRlIH0NCg0KICAgIHN0cnVjdCBDb21taXR0ZWUgeyAgICAgICAgDQogICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIGNyZWF0b3Igb2YgdGhlIGNvbW1pdHRlZQ0KICAgICAgICBhZGRyZXNzIGNyZWF0b3I7ICANCiAgICAgICAgLy8gVGhlIHR5cGUgb2YgdGhlIHByb3Bvc2FsDQogICAgICAgIFByb3Bvc2FsVHlwZXMgcHJvcG9zYWxUeXBlOw0KICAgICAgICAvLyBJbmRleCB0byBpZGVudGlmeSB0aGUgcHJvcG9zYWwNCiAgICAgICAgdWludCBwcm9wb3NhbElEOw0KICAgICAgICAvLyB1bml4IHRpbWVzdGFtcCwgZGVub3RpbmcgdGhlIGVuZCBvZiB0aGUgc2V0IHBlcmlvZCBvZiBhIHByb3Bvc2FsIGJlZm9yZSB0aGUgY29tbWl0dGVlIA0KICAgICAgICB1aW50IHNldERlYWRsaW5lOw0KICAgICAgICAvLyBGZWVzIChpbiB3ZWkpIHBhaWQgYnkgdGhlIGNyZWF0b3Igb2YgdGhlIHByb3Bvc2FsDQogICAgICAgIHVpbnQgZmVlczsNCiAgICAgICAgLy8gVG90YWwgb2YgZmVlcyAoaW4gd2VpKSByZXdhcmRlZCB0byB0aGUgdm90ZXJzDQogICAgICAgIHVpbnQgdG90YWxSZXdhcmRlZEFtb3VudDsNCiAgICAgICAgLy8gQSB1bml4IHRpbWVzdGFtcCwgZGVub3RpbmcgdGhlIGVuZCBvZiB0aGUgdm90aW5nIHBlcmlvZA0KICAgICAgICB1aW50IHZvdGluZ0RlYWRsaW5lOw0KICAgICAgICAvLyBUcnVlIGlmIHRoZSBwcm9wb3NhbCdzIHZvdGVzIGhhdmUgeWV0IHRvIGJlIGNvdW50ZWQsIG90aGVyd2lzZSBGYWxzZQ0KICAgICAgICBib29sIG9wZW47IA0KICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZGF0ZSBvZiB0aGUgZXhlY3V0aW9uIG9mIHRoZSBhcHByb3ZlZCBwcm9wb3NhbA0KICAgICAgICB1aW50IGRhdGVPZkV4ZWN1dGlvbjsNCiAgICAgICAgLy8gTnVtYmVyIG9mIHNoYXJlcyBpbiBmYXZvciBvZiB0aGUgcHJvcG9zYWwNCiAgICAgICAgdWludCB5ZWE7IA0KICAgICAgICAvLyBOdW1iZXIgb2Ygc2hhcmVzIG9wcG9zZWQgdG8gdGhlIHByb3Bvc2FsDQogICAgICAgIHVpbnQgbmF5OyANCiAgICB9DQogICAgLy8gQ29tbWl0dGVlcyBvcmdhbml6ZWQgdG8gdm90ZSBmb3Igb3IgYWdhaW5zdCBhIHByb3Bvc2FsDQogICAgQ29tbWl0dGVlW10gcHVibGljIENvbW1pdHRlZXM7IA0KICAgIC8vIG1hcHBpbmcgdG8gaW5kaWNhdGUgaWYgYSBzaGFyZWhvbGRlciBoYXMgdm90ZWQgYXQgYSBjb21taXR0ZWUgb3Igbm90DQogICAgbWFwcGluZyAodWludCA9PiBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpKSBoYXNWb3RlZDsNCg0KICAgIHN0cnVjdCBQcm9wb3NhbCB7DQogICAgICAgIC8vIEluZGV4IHRvIGlkZW50aWZ5IHRoZSBjb21taXR0ZWUNCiAgICAgICAgdWludCBjb21taXR0ZWVJRDsNCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0b3Igc21hcnQgY29udHJhY3QgKG5vdCBtYW5kYXRvcnkgaWYgZnVuZGluZykNCiAgICAgICAgUGFzc0NvbnRyYWN0b3IgY29udHJhY3RvcjsNCiAgICAgICAgLy8gVGhlIGluZGV4IG9mIHRoZSBjb250cmFjdG9yIHByb3Bvc2FsIGluIHRoZSBjb250cmFjdG9yIGNvbnRyYWN0IChub3QgbWFuZGF0b3J5IGlmIGZ1bmRpbmcpDQogICAgICAgIHVpbnQgY29udHJhY3RvclByb3Bvc2FsSUQ7DQogICAgICAgIC8vIFRoZSBhbW91bnQgb2YgdGhlIHByb3Bvc2FsIGZyb20gdGhlIHNoYXJlIG1hbmFnZXIgYmFsYW5jZSAoZm9yIGZ1bmRpbmcgb3IgY29udHJhY3RvciBwcm9wb3NhbHMpDQogICAgICAgIHVpbnQgYW1vdW50Ow0KICAgICAgICAvLyBUaGUgYWRkcmVzcyB3aGljaCBzZXRzIHBhcnRuZXJzIGFuZCBtYW5hZ2VzIHRoZSBmdW5kaW5nIChub3QgbWFuZGF0b3J5KQ0KICAgICAgICBhZGRyZXNzIG1vZGVyYXRvcjsNCiAgICAgICAgLy8gQW1vdW50IGZyb20gdGhlIHNhbGUgb2Ygc2hhcmVzIChmb3IgZnVuZGluZyBvciBjb250cmFjdG9yIHByb3Bvc2FscykNCiAgICAgICAgdWludCBhbW91bnRGb3JTaGFyZXM7DQogICAgICAgIC8vIFRoZSBpbml0aWFsIHByaWNlIG11bHRpcGxpZXIgb2YgRGFvIHNoYXJlcyBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBmdW5kaW5nIChub3QgbWFuZGF0b3J5KQ0KICAgICAgICB1aW50IGluaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllcjsgDQogICAgICAgIC8vIEFtb3VudCBmcm9tIHRoZSBzYWxlIG9mIHRva2VucyAoZm9yIHByb2plY3QgbWFuYWdlciBwcm9wb3NhbHMpDQogICAgICAgIHVpbnQgYW1vdW50Rm9yVG9rZW5zOw0KICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgc3RhcnQgdGltZSBvZiB0aGUgZnVuZGluZw0KICAgICAgICB1aW50IG1pbnV0ZXNGdW5kaW5nUGVyaW9kOw0KICAgICAgICAvLyBUcnVlIGlmIHRoZSBwcm9wb3NhbCBpcyBjbG9zZWQNCiAgICAgICAgYm9vbCBvcGVuOyANCiAgICB9DQogICAgLy8gUHJvcG9zYWxzIHRvIHBheSBhIGNvbnRyYWN0b3Igb3IvYW5kIGZ1bmQgdGhlIERhbw0KICAgIFByb3Bvc2FsW10gcHVibGljIFByb3Bvc2FsczsNCg0KICAgIHN0cnVjdCBRdWVzdGlvbiB7DQogICAgICAgIC8vIEluZGV4IHRvIGlkZW50aWZ5IGEgY29tbWl0dGVlDQogICAgICAgIHVpbnQgY29tbWl0dGVlSUQ7IA0KICAgICAgICAvLyBUaGUgcHJvamVjdCBzbWFydCBjb250cmFjdA0KICAgICAgICBQYXNzUHJvamVjdCBwcm9qZWN0Ow0KICAgICAgICAvLyBUaGUgbmFtZSBvZiB0aGUgcXVlc3Rpb24gZm9yIGRpc3BsYXkgcHVycG9zZQ0KICAgICAgICBzdHJpbmcgbmFtZTsNCiAgICAgICAgLy8gQSBkZXNjcmlwdGlvbiBvZiB0aGUgcXVlc3Rpb24NCiAgICAgICAgc3RyaW5nIGRlc2NyaXB0aW9uOw0KICAgIH0NCiAgICAvLyBRdWVzdGlvbnMgc3VibWl0dGVkIHRvIGEgdm90ZSBieSB0aGUgc2hhcmVob2xkZXJzIA0KICAgIFF1ZXN0aW9uW10gcHVibGljIFJlc29sdXRpb25Qcm9wb3NhbHM7DQogICAgDQogICAgc3RydWN0IFJ1bGVzIHsNCiAgICAgICAgLy8gSW5kZXggdG8gaWRlbnRpZnkgYSBjb21taXR0ZWUNCiAgICAgICAgdWludCBjb21taXR0ZWVJRDsgDQogICAgICAgIC8vIFRoZSBxdW9ydW0gbmVlZGVkIGZvciBlYWNoIHByb3Bvc2FsIGlzIGNhbGN1bGF0ZWQgYnkgdG90YWxTdXBwbHkgLyBtaW5RdW9ydW1EaXZpc29yDQogICAgICAgIHVpbnQgbWluUXVvcnVtRGl2aXNvcjsgIA0KICAgICAgICAvLyBNaW5pbXVtIGZlZXMgKGluIHdlaSkgdG8gY3JlYXRlIGEgcHJvcG9zYWwNCiAgICAgICAgdWludCBtaW5Db21taXR0ZWVGZWVzOyANCiAgICAgICAgLy8gTWluaW11bSBwZXJjZW50YWdlIG9mIHZvdGVzIGZvciBhIHByb3Bvc2FsIHRvIHJld2FyZCB0aGUgY3JlYXRvcg0KICAgICAgICB1aW50IG1pblBlcmNlbnRhZ2VPZkxpa2VzOw0KICAgICAgICAvLyBQZXJpb2QgaW4gbWludXRlcyB0byBjb25zaWRlciBvciBzZXQgYSBwcm9wb3NhbCBiZWZvcmUgdGhlIHZvdGluZyBwcm9jZWR1cmUNCiAgICAgICAgdWludCBtaW51dGVzU2V0UHJvcG9zYWxQZXJpb2Q7IA0KICAgICAgICAvLyBUaGUgbWluaW11bSBkZWJhdGUgcGVyaW9kIGluIG1pbnV0ZXMgdGhhdCBhIGdlbmVyaWMgcHJvcG9zYWwgY2FuIGhhdmUNCiAgICAgICAgdWludCBtaW5NaW51dGVzRGViYXRlUGVyaW9kOw0KICAgICAgICAvLyBUaGUgaW5mbGF0aW9uIHJhdGUgdG8gY2FsY3VsYXRlIHRoZSByZXdhcmQgb2YgZmVlcyB0byB2b3RlcnMNCiAgICAgICAgdWludCBmZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZTsNCiAgICAgICAgLy8gVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgdG9rZW4gcHJpY2UgKGZvciBwcm9qZWN0IG1hbmFnZXIgcHJvcG9zYWxzKSANCiAgICAgICAgdWludCB0b2tlblByaWNlSW5mbGF0aW9uUmF0ZTsNCiAgICAgICAgLy8gVGhlIGRlZmF1bHQgbWludXRlcyBmdW5kaW5nIHBlcmlvZA0KICAgICAgICB1aW50IGRlZmF1bHRNaW51dGVzRnVuZGluZ1BlcmlvZDsNCiAgICB9IA0KICAgIC8vIFByb3Bvc2FscyB0byB1cGRhdGUgdGhlIGNvbW1pdHRlZSBydWxlcw0KICAgIFJ1bGVzW10gcHVibGljIHJ1bGVzUHJvcG9zYWxzOw0KDQogICAgc3RydWN0IFVwZ3JhZGUgew0KICAgICAgICAvLyBJbmRleCB0byBpZGVudGlmeSBhIGNvbW1pdHRlZQ0KICAgICAgICB1aW50IGNvbW1pdHRlZUlEOyANCiAgICAgICAgLy8gQWRkcmVzcyBvZiB0aGUgcHJvcG9zZWQgQ29tbWl0dGVlIFJvb20gc21hcnQgY29udHJhY3QNCiAgICAgICAgYWRkcmVzcyBuZXdDb21taXR0ZWVSb29tOw0KICAgICAgICAvLyBBZGRyZXNzIG9mIHRoZSBwcm9wb3NlZCBzaGFyZSBtYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0DQogICAgICAgIGFkZHJlc3MgbmV3U2hhcmVNYW5hZ2VyOw0KICAgICAgICAvLyBBZGRyZXNzIG9mIHRoZSBwcm9wb3NlZCB0b2tlbiBtYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0DQogICAgICAgIGFkZHJlc3MgbmV3VG9rZW5NYW5hZ2VyOw0KICAgIH0NCiAgICAvLyBQcm9wb3NhbHMgdG8gdXBncmFkZQ0KICAgIFVwZ3JhZGVbXSBwdWJsaWMgVXBncmFkZVByb3Bvc2FsczsNCiAgICANCiAgICAvLyBUaGUgbWluaW11bSBwZXJpb2RzIGluIG1pbnV0ZXMgDQogICAgdWludCBtaW5NaW51dGVzUGVyaW9kczsNCiAgICAvLyBUaGUgbWF4aW11bSBpbmZsYXRpb24gcmF0ZSBmb3IgdG9rZW4gcHJpY2Ugb3IgcmV3YXJkcyB0byB2b3RlcnMNCiAgICB1aW50IG1heEluZmxhdGlvblJhdGU7DQogICAgDQogICAgLy8vIEByZXR1cm4gdGhlIGVmZmVjdGl2ZSBzaGFyZSBtYW5hZ2VyDQogICAgZnVuY3Rpb24gU2hhcmVNYW5hZ2VyKCkgY29uc3RhbnQgcmV0dXJucyAoUGFzc01hbmFnZXIpOw0KDQogICAgLy8vIEByZXR1cm4gdGhlIGVmZmVjdGl2ZSB0b2tlbiBtYW5hZ2VyDQogICAgZnVuY3Rpb24gVG9rZW5NYW5hZ2VyKCkgY29uc3RhbnQgcmV0dXJucyAoUGFzc01hbmFnZXIpOw0KDQogICAgLy8vIHJldHVybiB0aGUgYmFsYW5jZSBvZiB0aGUgREFPDQogICAgZnVuY3Rpb24gQmFsYW5jZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICAgIA0KICAgIC8vLyBAcGFyYW0gX2NvbW1pdHRlZUlEIFRoZSBpbmRleCBvZiB0aGUgY29tbWl0dGVlDQogICAgLy8vIEBwYXJhbSBfc2hhcmVIb2xkZXIgVGhlIHNoYXJlaG9sZGVyIChub3QgbWFuZGF0b3J5LCBkZWZhdWx0IDogbXNnLnNlbmRlcikNCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSBzaGFyZWhvbGRlciBoYXMgdm90ZWQgYXQgdGhlIGNvbW1pdHRlZQ0KICAgIGZ1bmN0aW9uIEhhc1ZvdGVkKA0KICAgICAgICB1aW50IF9jb21taXR0ZWVJRCwgDQogICAgICAgIGFkZHJlc3MgX3NoYXJlSG9sZGVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zIChib29sKTsNCiAgICANCiAgICAvLy8gQHJldHVybiBUaGUgbWluaW11bSBxdW9ydW0gZm9yIHByb3Bvc2FscyB0byBwYXNzIA0KICAgIGZ1bmN0aW9uIG1pblF1b3J1bSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KDQogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBjb21taXR0ZWVzIA0KICAgIGZ1bmN0aW9uIG51bWJlck9mQ29tbWl0dGVlcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICAgIA0KICAgIC8vLyBAZGV2IFRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbg0KICAgIC8vLyBAcGFyYW0gX3Bhc3NEYW8gQWRkcmVzcyBvZiBQYXNzIERhbw0KICAgIC8vZnVuY3Rpb24gUGFzc0NvbW1pdHRlZVJvb20oYWRkcmVzcyBfcGFzc0Rhbyk7DQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBpbml0IGFuIHNldCB0aGUgY29tbWl0dGVlIHJ1bGVzDQogICAgLy8vIEBwYXJhbSBfbWF4SW5mbGF0aW9uUmF0ZSBUaGUgbWF4aW11bSBpbmZsYXRpb24gcmF0ZSBmb3IgY29udHJhY3RvciBhbmQgZnVuZGluZyBwcm9wb3NhbHMNCiAgICAvLy8gQHBhcmFtIF9taW5NaW51dGVzUGVyaW9kcyBUaGUgbWluaW11bSBwZXJpb2RzIGluIG1pbnV0ZXMNCiAgICAvLy8gQHBhcmFtIF9taW5RdW9ydW1EaXZpc29yIFRoZSBpbml0aWFsIG1pbmltdW0gcXVvcnVtIGRpdmlzb3IgZm9yIHRoZSBwcm9wb3NhbHMNCiAgICAvLy8gQHBhcmFtIF9taW5Db21taXR0ZWVGZWVzIFRoZSBtaW5pbXVtIGFtb3VudCAoaW4gd2VpKSB0byBtYWtlIGEgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9taW5QZXJjZW50YWdlT2ZMaWtlcyBNaW5pbXVtIHBlcmNlbnRhZ2Ugb2Ygdm90ZXMgZm9yIGEgcHJvcG9zYWwgdG8gcmV3YXJkIHRoZSBjcmVhdG9yDQogICAgLy8vIEBwYXJhbSBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kIFRoZSBtaW5pbXVtIHBlcmlvZCBpbiBtaW51dGVzIGJlZm9yZSBhIGNvbW1pdHRlZQ0KICAgIC8vLyBAcGFyYW0gX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QgVGhlIG1pbmltdW0gcGVyaW9kIGluIG1pbnV0ZXMgb2YgdGhlIGJvYXJkIG1lZXRpbmdzDQogICAgLy8vIEBwYXJhbSBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgcmV3YXJkIG9mIGZlZXMgdG8gdm90ZXJzIGR1cmluZyBhIGNvbW1pdHRlZQ0KICAgIC8vLyBAcGFyYW0gX3Rva2VuUHJpY2VJbmZsYXRpb25SYXRlIFRoZSBpbmZsYXRpb24gcmF0ZSB0byBjYWxjdWxhdGUgdGhlIHRva2VuIHByaWNlIGZvciBwcm9qZWN0IG1hbmFnZXIgcHJvcG9zYWxzDQogICAgLy8vIEBwYXJhbSBfZGVmYXVsdE1pbnV0ZXNGdW5kaW5nUGVyaW9kIERlZmF1bHQgcGVyaW9kIGluIG1pbnV0ZXMgb2YgdGhlIGZ1bmRpbmcNCiAgICBmdW5jdGlvbiBpbml0KA0KICAgICAgICB1aW50IF9tYXhJbmZsYXRpb25SYXRlLA0KICAgICAgICB1aW50IF9taW5NaW51dGVzUGVyaW9kcywNCiAgICAgICAgdWludCBfbWluUXVvcnVtRGl2aXNvciwNCiAgICAgICAgdWludCBfbWluQ29tbWl0dGVlRmVlcywNCiAgICAgICAgdWludCBfbWluUGVyY2VudGFnZU9mTGlrZXMsDQogICAgICAgIHVpbnQgX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCwNCiAgICAgICAgdWludCBfbWluTWludXRlc0RlYmF0ZVBlcmlvZCwNCiAgICAgICAgdWludCBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUsDQogICAgICAgIHVpbnQgX3Rva2VuUHJpY2VJbmZsYXRpb25SYXRlLA0KICAgICAgICB1aW50IF9kZWZhdWx0TWludXRlc0Z1bmRpbmdQZXJpb2QpOw0KDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gY3JlYXRlIGEgY29udHJhY3RvciBzbWFydCBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX2NvbnRyYWN0b3JDcmVhdG9yIFRoZSBjb250cmFjdG9yIGNyZWF0b3Igc21hcnQgY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIHJlY2lwaWVudCBvZiB0aGUgY29udHJhY3RvciBzbWFydCBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX21ldGFQcm9qZWN0IFRydWUgaWYgbWV0YSBwcm9qZWN0DQogICAgLy8vIEBwYXJhbSBfcGFzc1Byb2plY3QgVGhlIHByb2plY3Qgc21hcnQgY29udHJhY3QgKG5vdCBtYW5kYXRvcnkpDQogICAgLy8vIEBwYXJhbSBfcHJvamVjdE5hbWUgVGhlIG5hbWUgb2YgdGhlIHByb2plY3QgKGlmIHRoZSBwcm9qZWN0IHNtYXJ0IGNvbnRyYWN0IGRvZXNuJ3QgZXhpc3QpDQogICAgLy8vIEBwYXJhbSBfcHJvamVjdERlc2NyaXB0aW9uIEEgZGVzY3JpcHRpb24gb2YgdGhlIHByb2plY3QgKG5vdCBtYW5kYXRvcnksIGNhbiBiZSB1cGRhdGVkIGFmdGVyKQ0KICAgIC8vLyBAcmV0dXJuIFRoZSBjb250cmFjdG9yIHNtYXJ0IGNvbnRyYWN0DQogICAgZnVuY3Rpb24gY3JlYXRlQ29udHJhY3RvcigNCiAgICAgICAgUGFzc0NvbnRyYWN0b3JDcmVhdG9yIF9jb250cmFjdG9yQ3JlYXRvciwNCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LA0KICAgICAgICBib29sIF9tZXRhUHJvamVjdCwNCiAgICAgICAgUGFzc1Byb2plY3QgX3Bhc3NQcm9qZWN0LA0KICAgICAgICBzdHJpbmcgX3Byb2plY3ROYW1lLCANCiAgICAgICAgc3RyaW5nIF9wcm9qZWN0RGVzY3JpcHRpb24pIHJldHVybnMgKFBhc3NDb250cmFjdG9yKTsNCiAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBtYWtlIGEgcHJvcG9zYWwgdG8gcGF5IGEgY29udHJhY3RvciBvci9hbmQgZnVuZCB0aGUgRGFvDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IEFtb3VudCBvZiB0aGUgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9jb250cmFjdG9yIFRoZSBjb250cmFjdG9yIHNtYXJ0IGNvbnRyYWN0DQogICAgLy8vIEBwYXJhbSBfY29udHJhY3RvclByb3Bvc2FsSUQgSW5kZXggb2YgdGhlIGNvbnRyYWN0b3IgcHJvcG9zYWwgaW4gdGhlIGNvbnRyYWN0b3Igc21hcnQgY29udHJhY3QgKG5vdCBtYW5kYXRvcnkpDQogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxEZXNjcmlwdGlvbiBTdHJpbmcgZGVzY3JpYmluZyB0aGUgcHJvcG9zYWwgKGlmIG5vdCBleGlzdGluZyBwcm9wb3NhbCkNCiAgICAvLy8gQHBhcmFtIF9oYXNoT2ZUaGVDb250cmFjdG9yUHJvcG9zYWxEb2N1bWVudCBUaGUgaGFzaCBvZiB0aGUgQ29udHJhY3RvciBwcm9wb3NhbCBkb2N1bWVudCAoaWYgbm90IGV4aXN0aW5nIHByb3Bvc2FsKQ0KICAgIC8vLyBAcGFyYW0gX21vZGVyYXRvciBUaGUgYWRkcmVzcyB3aGljaCBzZXRzIHBhcnRuZXJzIGFuZCBtYW5hZ2UgdGhlIGZ1bmRpbmcgKG5vdCBtYW5kYXRvcnkpDQogICAgLy8vIEBwYXJhbSBfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyIFRoZSBpbml0aWFsIHByaWNlIG11bHRpcGxpZXIgb2Ygc2hhcmVzIChmb3IgZnVuZGluZyBvciBjb250cmFjdG9yIHByb3Bvc2FscykNCiAgICAvLy8gQHBhcmFtIF9taW51dGVzRnVuZGluZ1BlcmlvZCBQZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgZnVuZGluZyAobm90IG1hbmRhdG9yeSkNCiAgICAvLy8gQHBhcmFtIF9taW51dGVzRGViYXRpbmdQZXJpb2QgUGVyaW9kIGluIG1pbnV0ZXMgb2YgdGhlIGJvYXJkIG1lZXRpbmcgdG8gdm90ZSBvbiB0aGUgcHJvcG9zYWwgKG5vdCBtYW5kYXRvcnkpDQogICAgLy8vIEByZXR1cm4gVGhlIGluZGV4IG9mIHRoZSBwcm9wb3NhbA0KICAgIGZ1bmN0aW9uIGNvbnRyYWN0b3JQcm9wb3NhbCgNCiAgICAgICAgdWludCBfYW1vdW50LA0KICAgICAgICBQYXNzQ29udHJhY3RvciBfY29udHJhY3RvciwNCiAgICAgICAgdWludCBfY29udHJhY3RvclByb3Bvc2FsSUQsDQogICAgICAgIHN0cmluZyBfcHJvcG9zYWxEZXNjcmlwdGlvbiwgDQogICAgICAgIGJ5dGVzMzIgX2hhc2hPZlRoZUNvbnRyYWN0b3JQcm9wb3NhbERvY3VtZW50LA0KICAgICAgICBhZGRyZXNzIF9tb2RlcmF0b3IsDQogICAgICAgIHVpbnQgX2luaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllciwgDQogICAgICAgIHVpbnQgX21pbnV0ZXNGdW5kaW5nUGVyaW9kLA0KICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QpIHBheWFibGUgcmV0dXJucyAodWludCk7DQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBzdWJtaXQgYSBxdWVzdGlvbg0KICAgIC8vLyBAcGFyYW0gX25hbWUgTmFtZSBvZiB0aGUgcXVlc3Rpb24gZm9yIGRpc3BsYXkgcHVycG9zZQ0KICAgIC8vLyBAcGFyYW0gX2Rlc2NyaXB0aW9uIEEgZGVzY3JpcHRpb24gb2YgdGhlIHF1ZXN0aW9uDQogICAgLy8vIEBwYXJhbSBfcHJvamVjdCBUaGUgcHJvamVjdCBzbWFydCBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCBQZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgYm9hcmQgbWVldGluZyB0byB2b3RlIG9uIHRoZSBwcm9wb3NhbA0KICAgIC8vLyBAcmV0dXJuIFRoZSBpbmRleCBvZiB0aGUgcHJvcG9zYWwNCiAgICBmdW5jdGlvbiByZXNvbHV0aW9uUHJvcG9zYWwoDQogICAgICAgIHN0cmluZyBfbmFtZSwNCiAgICAgICAgc3RyaW5nIF9kZXNjcmlwdGlvbiwNCiAgICAgICAgUGFzc1Byb2plY3QgX3Byb2plY3QsDQogICAgICAgIHVpbnQgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCkgcGF5YWJsZSByZXR1cm5zICh1aW50KTsNCiAgICAgICAgDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gbWFrZSBhIHByb3Bvc2FsIHRvIGNoYW5nZSB0aGUgcnVsZXMgb2YgdGhlIGNvbW1pdHRlZSByb29tIA0KICAgIC8vLyBAcGFyYW0gX21pblF1b3J1bURpdmlzb3IgSWYgNSwgdGhlIG1pbmltdW0gcXVvcnVtIGlzIDIwJQ0KICAgIC8vLyBAcGFyYW0gX21pbkNvbW1pdHRlZUZlZXMgVGhlIG1pbmltdW0gYW1vdW50IChpbiB3ZWkpIHRvIG1ha2UgYSBwcm9wb3NhbA0KICAgIC8vLyBAcGFyYW0gX21pblBlcmNlbnRhZ2VPZkxpa2VzIE1pbmltdW0gcGVyY2VudGFnZSBvZiB2b3RlcyBmb3IgYSBwcm9wb3NhbCB0byByZXdhcmQgdGhlIGNyZWF0b3INCiAgICAvLy8gQHBhcmFtIF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgTWluaW11bSBwZXJpb2QgaW4gbWludXRlcyBiZWZvcmUgYSBjb21taXR0ZWUNCiAgICAvLy8gQHBhcmFtIF9taW5NaW51dGVzRGViYXRlUGVyaW9kIFRoZSBtaW5pbXVtIHBlcmlvZCBpbiBtaW51dGVzIG9mIHRoZSBjb21taXR0ZWVzDQogICAgLy8vIEBwYXJhbSBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgcmV3YXJkIG9mIGZlZXMgdG8gdm90ZXJzIGR1cmluZyBhIGNvbW1pdHRlZQ0KICAgIC8vLyBAcGFyYW0gX2RlZmF1bHRNaW51dGVzRnVuZGluZ1BlcmlvZCBQZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgZnVuZGluZw0KICAgIC8vLyBAcGFyYW0gX3Rva2VuUHJpY2VJbmZsYXRpb25SYXRlIFRoZSBpbmZsYXRpb24gcmF0ZSB0byBjYWxjdWxhdGUgdGhlIHRva2VuIHByaWNlIGZvciBwcm9qZWN0IG1hbmFnZXIgcHJvcG9zYWxzDQogICAgLy8vIEByZXR1cm4gVGhlIGluZGV4IG9mIHRoZSBwcm9wb3NhbA0KICAgIGZ1bmN0aW9uIHJ1bGVzUHJvcG9zYWwoDQogICAgICAgIHVpbnQgX21pblF1b3J1bURpdmlzb3IsIA0KICAgICAgICB1aW50IF9taW5Db21taXR0ZWVGZWVzLA0KICAgICAgICB1aW50IF9taW5QZXJjZW50YWdlT2ZMaWtlcywNCiAgICAgICAgdWludCBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kLA0KICAgICAgICB1aW50IF9taW5NaW51dGVzRGViYXRlUGVyaW9kLA0KICAgICAgICB1aW50IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSwNCiAgICAgICAgdWludCBfZGVmYXVsdE1pbnV0ZXNGdW5kaW5nUGVyaW9kLA0KICAgICAgICB1aW50IF90b2tlblByaWNlSW5mbGF0aW9uUmF0ZSkgcGF5YWJsZSByZXR1cm5zICh1aW50KTsNCiAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBtYWtlIGEgcHJvcG9zYWwgdG8gdXBncmFkZSB0aGUgYXBwbGljYXRpb24NCiAgICAvLy8gQHBhcmFtIF9uZXdDb21taXR0ZWVSb29tIEFkZHJlc3Mgb2YgYSBuZXcgQ29tbWl0dGVlIFJvb20gc21hcnQgY29udHJhY3QgKG5vdCBtYW5kYXRvcnkpICAgDQogICAgLy8vIEBwYXJhbSBfbmV3U2hhcmVNYW5hZ2VyIEFkZHJlc3Mgb2YgYSBuZXcgc2hhcmUgbWFuYWdlciBzbWFydCBjb250cmFjdCAobm90IG1hbmRhdG9yeSkNCiAgICAvLy8gQHBhcmFtIF9uZXdUb2tlbk1hbmFnZXIgQWRkcmVzcyBvZiBhIG5ldyB0b2tlbiBtYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IChub3QgbWFuZGF0b3J5KQ0KICAgIC8vLyBAcGFyYW0gX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCBQZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgY29tbWl0dGVlIHRvIHZvdGUgb24gdGhlIHByb3Bvc2FsIChub3QgbWFuZGF0b3J5KQ0KICAgIC8vLyBAcmV0dXJuIFRoZSBpbmRleCBvZiB0aGUgcHJvcG9zYWwNCiAgICBmdW5jdGlvbiB1cGdyYWRlUHJvcG9zYWwoDQogICAgICAgIGFkZHJlc3MgX25ld0NvbW1pdHRlZVJvb20sDQogICAgICAgIGFkZHJlc3MgX25ld1NoYXJlTWFuYWdlciwNCiAgICAgICAgYWRkcmVzcyBfbmV3VG9rZW5NYW5hZ2VyLA0KICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QpIHBheWFibGUgcmV0dXJucyAodWludCk7DQoNCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBjcmVhdGUgYSBjb21taXR0ZWUNCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbFR5cGUgVGhlIHR5cGUgb2YgdGhlIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfbWludXRlc0RlYmF0aW5nUGVyaW9kIFRoZSBkdXJhdGlvbiBpbiBtaW51dGVzIG9mIHRoZSBjb21taXR0ZWUNCiAgICAvLy8gQHJldHVybiB0aGUgaW5kZXggb2YgdGhlIGJvYXJkIG1lZXRpbmcNCiAgICBmdW5jdGlvbiBuZXdDb21taXR0ZWUoDQogICAgICAgIFByb3Bvc2FsVHlwZXMgX3Byb3Bvc2FsVHlwZSwNCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwgDQogICAgICAgIHVpbnQgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCkgaW50ZXJuYWwgcmV0dXJucyAodWludCk7DQogICAgICAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHZvdGUgZm9yIG9yIGFnYWluc3QgYSBwcm9wb3NhbCBkdXJpbmcgYSBjb21taXR0ZWUNCiAgICAvLy8gQHBhcmFtIF9jb21taXR0ZWVJRCBUaGUgaW5kZXggb2YgdGhlIGNvbW1pdHRlZQ0KICAgIC8vLyBAcGFyYW0gX3N1cHBvcnRzUHJvcG9zYWwgVHJ1ZSBpZiB0aGUgcHJvcG9zYWwgaXMgc3VwcG9ydGVkDQogICAgZnVuY3Rpb24gdm90ZSgNCiAgICAgICAgdWludCBfY29tbWl0dGVlSUQsIA0KICAgICAgICBib29sIF9zdXBwb3J0c1Byb3Bvc2FsKTsNCiAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBleGVjdXRlIGEgZGVjaXNpb24gYW5kIGNsb3NlIHRoZSBjb21taXR0ZWUNCiAgICAvLy8gQHBhcmFtIF9jb21taXR0ZWVJRCBUaGUgaW5kZXggb2YgdGhlIGNvbW1pdHRlZQ0KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHByb3Bvc2FsIHdhcyBleGVjdXRlZCBvciBub3QNCiAgICBmdW5jdGlvbiBleGVjdXRlRGVjaXNpb24odWludCBfY29tbWl0dGVlSUQpIHJldHVybnMgKGJvb2wpOw0KICAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIG9yZGVyIHRvIGEgY29udHJhY3RvciBhbmQgY2xvc2UgYSBjb250cmFjdG9yIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIHByb3Bvc2FsDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgcHJvcG9zYWwgd2FzIG9yZGVyZWQgYW5kIHRoZSBwcm9wb3NhbCBhbW91bnQgc2VudCBvciBub3QNCiAgICBmdW5jdGlvbiBvcmRlclRvQ29udHJhY3Rvcih1aW50IF9wcm9wb3NhbElEKSByZXR1cm5zIChib29sKTsgICANCg0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGJ1eSBzaGFyZXMgYW5kIG9yL2FuZCBwcm9tb3RlIGEgY29udHJhY3RvciBwcm9wb3NhbCANCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIFRoZSBpbmRleCBvZiB0aGUgcHJvcG9zYWwNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiBidXlTaGFyZXNGb3JQcm9wb3NhbCh1aW50IF9wcm9wb3NhbElEKSBwYXlhYmxlIHJldHVybnMgKGJvb2wpOw0KICAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNlbmQgdG9rZW5zIG9yIHJlZnVuZCBhZnRlciB0aGUgY2xvc2luZyB0aW1lIG9mIHRoZSBmdW5kaW5nIHByb3Bvc2Fscw0KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGZpcnN0IHByb3Bvc2FsLiAwIGlmIG5vdCBsaW5rZWQgdG8gYSBwcm9wb3NhbA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBsYXN0IHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfYnV5ZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGJ1eWVyDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgZnVuY3Rpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90IA0KICAgIGZ1bmN0aW9uIHNlbmRQZW5kaW5nQW1vdW50cyggICAgICAgIA0KICAgICAgICB1aW50IF9mcm9tLA0KICAgICAgICB1aW50IF90bywNCiAgICAgICAgYWRkcmVzcyBfYnV5ZXIpIHJldHVybnMgKGJvb2wpOw0KICAgICAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byByZWNlaXZlIHRva2VucyBvciByZWZ1bmQgYWZ0ZXIgdGhlIGNsb3NpbmcgdGltZSBvZiB0aGUgZnVuZGluZyBwcm9wb3NhbHMNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiB3aXRoZHJhd1BlbmRpbmdBbW91bnRzKCkgcmV0dXJucyAoYm9vbCk7DQoNCiAgICBldmVudCBDb21taXR0ZWVMaW1pdHModWludCBtYXhJbmZsYXRpb25SYXRlLCB1aW50IG1pbk1pbnV0ZXNQZXJpb2RzKTsNCiAgICANCiAgICBldmVudCBDb250cmFjdG9yQ3JlYXRlZChQYXNzQ29udHJhY3RvckNyZWF0b3IgQ3JlYXRvciwgYWRkcmVzcyBpbmRleGVkIFNlbmRlciwgUGFzc0NvbnRyYWN0b3IgQ29udHJhY3RvciwgYWRkcmVzcyBSZWNpcGllbnQpOw0KDQogICAgZXZlbnQgUHJvcG9zYWxTdWJtaXR0ZWQodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgQ29tbWl0dGVlSUQsIFBhc3NDb250cmFjdG9yIGluZGV4ZWQgQ29udHJhY3RvciwgdWludCBpbmRleGVkIENvbnRyYWN0b3JQcm9wb3NhbElELCANCiAgICAgICAgdWludCBBbW91bnQsIHN0cmluZyBEZXNjcmlwdGlvbiwgYWRkcmVzcyBNb2RlcmF0b3IsIHVpbnQgU2hhcmVQcmljZU11bHRpcGxpZXIsIHVpbnQgTWludXRlc0Z1bmRpbmdQZXJpb2QpOw0KICAgIGV2ZW50IFJlc29sdXRpb25Qcm9wb3NhbFN1Ym1pdHRlZCh1aW50IGluZGV4ZWQgUXVlc3Rpb25JRCwgdWludCBpbmRleGVkIENvbW1pdHRlZUlELCBQYXNzUHJvamVjdCBpbmRleGVkIFByb2plY3QsIHN0cmluZyBOYW1lLCBzdHJpbmcgRGVzY3JpcHRpb24pOw0KICAgIGV2ZW50IFJ1bGVzUHJvcG9zYWxTdWJtaXR0ZWQodWludCBpbmRleGVkIHJ1bGVzUHJvcG9zYWxJRCwgdWludCBDb21taXR0ZWVJRCwgdWludCBNaW5RdW9ydW1EaXZpc29yLCB1aW50IE1pbkNvbW1pdHRlZUZlZXMsIHVpbnQgTWluUGVyY2VudGFnZU9mTGlrZXMsIA0KICAgICAgICB1aW50IE1pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCwgdWludCBNaW5NaW51dGVzRGViYXRlUGVyaW9kLCB1aW50IEZlZXNSZXdhcmRJbmZsYXRpb25SYXRlLCB1aW50IERlZmF1bHRNaW51dGVzRnVuZGluZ1BlcmlvZCwgdWludCBUb2tlblByaWNlSW5mbGF0aW9uUmF0ZSk7DQogICAgZXZlbnQgVXBncmFkZVByb3Bvc2FsU3VibWl0dGVkKHVpbnQgaW5kZXhlZCBVcGdyYWRlUHJvcG9zYWxJRCwgdWludCBpbmRleGVkIENvbW1pdHRlZUlELCBhZGRyZXNzIE5ld0NvbW1pdHRlZVJvb20sIA0KICAgICAgICBhZGRyZXNzIE5ld1NoYXJlTWFuYWdlciwgYWRkcmVzcyBOZXdUb2tlbk1hbmFnZXIpOw0KDQogICAgZXZlbnQgVm90ZWQodWludCBpbmRleGVkIENvbW1pdHRlZUlELCBib29sIFBvc2l0aW9uLCBhZGRyZXNzIGluZGV4ZWQgVm90ZXIsIHVpbnQgUmV3YXJkZWRBbW91bnQpOw0KDQogICAgZXZlbnQgUHJvcG9zYWxDbG9zZWQodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIFByb3Bvc2FsVHlwZXMgaW5kZXhlZCBQcm9wb3NhbFR5cGUsIHVpbnQgQ29tbWl0dGVlSUQsIA0KICAgICAgICB1aW50IFRvdGFsUmV3YXJkZWRBbW91bnQsIGJvb2wgUHJvcG9zYWxFeGVjdXRlZCwgdWludCBSZXdhcmRlZFNoYXJlc0Ftb3VudCwgdWludCBTZW50VG9NYW5hZ2VyKTsNCiAgICBldmVudCBDb250cmFjdG9yUHJvcG9zYWxDbG9zZWQodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgaW5kZXhlZCBDb250cmFjdG9yUHJvcG9zYWxJRCwgUGFzc0NvbnRyYWN0b3IgaW5kZXhlZCBDb250cmFjdG9yLCB1aW50IEFtb3VudFNlbnQpOw0KICAgIGV2ZW50IERhcHBVcGdyYWRlZChhZGRyZXNzIE5ld0NvbW1pdHRlZVJvb20sIGFkZHJlc3MgTmV3U2hhcmVNYW5hZ2VyLCBhZGRyZXNzIE5ld1Rva2VuTWFuYWdlcik7DQoNCn0NCg0KY29udHJhY3QgUGFzc0NvbW1pdHRlZVJvb20gaXMgUGFzc0NvbW1pdHRlZVJvb21JbnRlcmZhY2Ugew0KDQovLyBDb25zdGFudCBmdW5jdGlvbnMNCg0KICAgIGZ1bmN0aW9uIFNoYXJlTWFuYWdlcigpIGNvbnN0YW50IHJldHVybnMgKFBhc3NNYW5hZ2VyKSB7DQogICAgICAgIHJldHVybiBQYXNzTWFuYWdlcihwYXNzRGFvLkFjdHVhbFNoYXJlTWFuYWdlcigpKTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gVG9rZW5NYW5hZ2VyKCkgY29uc3RhbnQgcmV0dXJucyAoUGFzc01hbmFnZXIpIHsNCiAgICAgICAgcmV0dXJuIFBhc3NNYW5hZ2VyKHBhc3NEYW8uQWN0dWFsVG9rZW5NYW5hZ2VyKCkpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBCYWxhbmNlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gcGFzc0Rhby5BY3R1YWxTaGFyZU1hbmFnZXIoKS5iYWxhbmNlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEhhc1ZvdGVkKA0KICAgICAgICB1aW50IF9jb21taXR0ZWVJRCwgDQogICAgICAgIGFkZHJlc3MgX3NoYXJlSG9sZGVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zIChib29sKSB7DQoNCiAgICAgICAgaWYgKF9zaGFyZUhvbGRlciA9PSAwKSByZXR1cm4gaGFzVm90ZWRbX2NvbW1pdHRlZUlEXVttc2cuc2VuZGVyXTsNCiAgICAgICAgZWxzZSByZXR1cm4gaGFzVm90ZWRbX2NvbW1pdHRlZUlEXVtfc2hhcmVIb2xkZXJdOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBtaW5RdW9ydW0oKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiAodWludChTaGFyZU1hbmFnZXIoKS50b3RhbFN1cHBseSgpKSAvIHJ1bGVzUHJvcG9zYWxzWzBdLm1pblF1b3J1bURpdmlzb3IpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG51bWJlck9mQ29tbWl0dGVlcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIENvbW1pdHRlZXMubGVuZ3RoIC0gMTsNCiAgICB9DQogICAgDQovLyBDb25zdHJ1Y3RvciBhbmQgaW5pdCBmdW5jdGlvbnMNCg0KICAgIGZ1bmN0aW9uIFBhc3NDb21taXR0ZWVSb29tKGFkZHJlc3MgX3Bhc3NEYW8pIHsNCg0KICAgICAgICBwYXNzRGFvID0gUGFzc0RhbyhfcGFzc0Rhbyk7DQogICAgICAgIHJ1bGVzUHJvcG9zYWxzLmxlbmd0aCA9IDE7IA0KICAgICAgICBDb21taXR0ZWVzLmxlbmd0aCA9IDE7DQogICAgICAgIFByb3Bvc2Fscy5sZW5ndGggPSAxOw0KICAgICAgICBSZXNvbHV0aW9uUHJvcG9zYWxzLmxlbmd0aCA9IDE7DQogICAgICAgIFVwZ3JhZGVQcm9wb3NhbHMubGVuZ3RoID0gMTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gaW5pdCgNCiAgICAgICAgdWludCBfbWF4SW5mbGF0aW9uUmF0ZSwNCiAgICAgICAgdWludCBfbWluTWludXRlc1BlcmlvZHMsDQogICAgICAgIHVpbnQgX21pblF1b3J1bURpdmlzb3IsDQogICAgICAgIHVpbnQgX21pbkNvbW1pdHRlZUZlZXMsDQogICAgICAgIHVpbnQgX21pblBlcmNlbnRhZ2VPZkxpa2VzLA0KICAgICAgICB1aW50IF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QsDQogICAgICAgIHVpbnQgX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QsDQogICAgICAgIHVpbnQgX2ZlZXNSZXdhcmRJbmZsYXRpb25SYXRlLA0KICAgICAgICB1aW50IF90b2tlblByaWNlSW5mbGF0aW9uUmF0ZSwNCiAgICAgICAgdWludCBfZGVmYXVsdE1pbnV0ZXNGdW5kaW5nUGVyaW9kKSB7DQoNCiAgICAgICAgbWF4SW5mbGF0aW9uUmF0ZSA9IF9tYXhJbmZsYXRpb25SYXRlOw0KICAgICAgICBtaW5NaW51dGVzUGVyaW9kcyA9IF9taW5NaW51dGVzUGVyaW9kczsNCiAgICAgICAgQ29tbWl0dGVlTGltaXRzKG1heEluZmxhdGlvblJhdGUsIG1pbk1pbnV0ZXNQZXJpb2RzKTsNCiAgICAgICAgDQogICAgICAgIGlmIChydWxlc1Byb3Bvc2Fsc1swXS5taW5RdW9ydW1EaXZpc29yICE9IDApIHRocm93Ow0KICAgICAgICBydWxlc1Byb3Bvc2Fsc1swXS5taW5RdW9ydW1EaXZpc29yID0gX21pblF1b3J1bURpdmlzb3I7DQogICAgICAgIHJ1bGVzUHJvcG9zYWxzWzBdLm1pbkNvbW1pdHRlZUZlZXMgPSBfbWluQ29tbWl0dGVlRmVlczsNCiAgICAgICAgcnVsZXNQcm9wb3NhbHNbMF0ubWluUGVyY2VudGFnZU9mTGlrZXMgPSBfbWluUGVyY2VudGFnZU9mTGlrZXM7DQogICAgICAgIHJ1bGVzUHJvcG9zYWxzWzBdLm1pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCA9IF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2Q7DQogICAgICAgIHJ1bGVzUHJvcG9zYWxzWzBdLm1pbk1pbnV0ZXNEZWJhdGVQZXJpb2QgPSBfbWluTWludXRlc0RlYmF0ZVBlcmlvZDsNCiAgICAgICAgcnVsZXNQcm9wb3NhbHNbMF0uZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgPSBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGU7DQogICAgICAgIHJ1bGVzUHJvcG9zYWxzWzBdLnRva2VuUHJpY2VJbmZsYXRpb25SYXRlID0gX3Rva2VuUHJpY2VJbmZsYXRpb25SYXRlOw0KICAgICAgICBydWxlc1Byb3Bvc2Fsc1swXS5kZWZhdWx0TWludXRlc0Z1bmRpbmdQZXJpb2QgPSBfZGVmYXVsdE1pbnV0ZXNGdW5kaW5nUGVyaW9kOw0KDQogICAgfQ0KDQovLyBQcm9qZWN0IG1hbmFnZXIgYW5kIGNvbnRyYWN0b3IgbWFuYWdlbWVudA0KDQogICAgZnVuY3Rpb24gY3JlYXRlQ29udHJhY3RvcigNCiAgICAgICAgUGFzc0NvbnRyYWN0b3JDcmVhdG9yIF9jb250cmFjdG9yQ3JlYXRvciwNCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LA0KICAgICAgICBib29sIF9tZXRhUHJvamVjdCwNCiAgICAgICAgUGFzc1Byb2plY3QgX3Bhc3NQcm9qZWN0LA0KICAgICAgICBzdHJpbmcgX3Byb2plY3ROYW1lLCANCiAgICAgICAgc3RyaW5nIF9wcm9qZWN0RGVzY3JpcHRpb24pIHJldHVybnMgKFBhc3NDb250cmFjdG9yKSB7DQoNCiAgICAgICAgUGFzc0NvbnRyYWN0b3IgX2NvbnRyYWN0b3IgPSBfY29udHJhY3RvckNyZWF0b3IuY3JlYXRlQ29udHJhY3Rvcihtc2cuc2VuZGVyLCBfcmVjaXBpZW50LCANCiAgICAgICAgICAgIF9tZXRhUHJvamVjdCwgX3Bhc3NQcm9qZWN0LCBfcHJvamVjdE5hbWUsIF9wcm9qZWN0RGVzY3JpcHRpb24sIGZhbHNlKTsNCiAgICAgICAgQ29udHJhY3RvckNyZWF0ZWQoX2NvbnRyYWN0b3JDcmVhdG9yLCBtc2cuc2VuZGVyLCBfY29udHJhY3RvciwgX3JlY2lwaWVudCk7DQogICAgICAgIHJldHVybiBfY29udHJhY3RvcjsNCiAgICB9ICAgDQoNCi8vIFByb3Bvc2FscyBNYW5hZ2VtZW50DQoNCiAgICBmdW5jdGlvbiBjb250cmFjdG9yUHJvcG9zYWwoDQogICAgICAgIHVpbnQgX2Ftb3VudCwNCiAgICAgICAgUGFzc0NvbnRyYWN0b3IgX2NvbnRyYWN0b3IsDQogICAgICAgIHVpbnQgX2NvbnRyYWN0b3JQcm9wb3NhbElELA0KICAgICAgICBzdHJpbmcgX3Byb3Bvc2FsRGVzY3JpcHRpb24sIA0KICAgICAgICBieXRlczMyIF9oYXNoT2ZUaGVDb250cmFjdG9yUHJvcG9zYWxEb2N1bWVudCwgICAgICAgIA0KICAgICAgICBhZGRyZXNzIF9tb2RlcmF0b3IsDQogICAgICAgIHVpbnQgX2luaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllciwgDQogICAgICAgIHVpbnQgX21pbnV0ZXNGdW5kaW5nUGVyaW9kLA0KICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QNCiAgICApIHBheWFibGUgcmV0dXJucyAodWludCkgew0KDQogICAgICAgIGlmIChfbWludXRlc0Z1bmRpbmdQZXJpb2QgPT0gMCkgX21pbnV0ZXNGdW5kaW5nUGVyaW9kID0gcnVsZXNQcm9wb3NhbHNbMF0uZGVmYXVsdE1pbnV0ZXNGdW5kaW5nUGVyaW9kOw0KDQogICAgICAgIGlmIChhZGRyZXNzKF9jb250cmFjdG9yKSAhPSAwICYmIF9jb250cmFjdG9yUHJvcG9zYWxJRCAhPSAwKSB7DQogICAgICAgICAgICBpZiAoX2hhc2hPZlRoZUNvbnRyYWN0b3JQcm9wb3NhbERvY3VtZW50ICE9IDAgDQogICAgICAgICAgICAgICAgfHwhX2NvbnRyYWN0b3IucHJvcG9zYWxDaGVja2VkKG1zZy5zZW5kZXIsIF9jb250cmFjdG9yUHJvcG9zYWxJRCwgX2Ftb3VudCkpIHRocm93Ow0KICAgICAgICAgICAgZWxzZSBfcHJvcG9zYWxEZXNjcmlwdGlvbiA9ICJQcm9wb3NhbCBjaGVja2VkIjsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgoYWRkcmVzcyhfY29udHJhY3RvcikgIT0gMCAmJiBfY29udHJhY3RvclByb3Bvc2FsSUQgPT0gMCAmJiBfaGFzaE9mVGhlQ29udHJhY3RvclByb3Bvc2FsRG9jdW1lbnQgPT0gMCkNCiAgICAgICAgICAgIHx8IF9hbW91bnQgPT0gMA0KICAgICAgICAgICAgfHwgX21pbnV0ZXNGdW5kaW5nUGVyaW9kIDwgbWluTWludXRlc1BlcmlvZHMpIHRocm93Ow0KDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQgPSBQcm9wb3NhbHMubGVuZ3RoKys7DQogICAgICAgIFByb3Bvc2FsIHAgPSBQcm9wb3NhbHNbX3Byb3Bvc2FsSURdOw0KDQogICAgICAgIHAuY29udHJhY3RvciA9IF9jb250cmFjdG9yOw0KICAgICAgICANCiAgICAgICAgaWYgKF9jb250cmFjdG9yUHJvcG9zYWxJRCA9PSAwICYmIF9oYXNoT2ZUaGVDb250cmFjdG9yUHJvcG9zYWxEb2N1bWVudCAhPSAwKSB7DQogICAgICAgICAgICBfY29udHJhY3RvclByb3Bvc2FsSUQgPSBfY29udHJhY3Rvci5uZXdQcm9wb3NhbChtc2cuc2VuZGVyLCBfYW1vdW50LCBfcHJvcG9zYWxEZXNjcmlwdGlvbiwgX2hhc2hPZlRoZUNvbnRyYWN0b3JQcm9wb3NhbERvY3VtZW50KTsNCiAgICAgICAgfQ0KICAgICAgICBwLmNvbnRyYWN0b3JQcm9wb3NhbElEID0gX2NvbnRyYWN0b3JQcm9wb3NhbElEOw0KDQogICAgICAgIGlmIChhZGRyZXNzKF9jb250cmFjdG9yKSA9PSAwKSBwLmFtb3VudEZvclNoYXJlcyA9IF9hbW91bnQ7DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgX2NvbnRyYWN0b3Iuc3VibWl0UHJvcG9zYWwobXNnLnNlbmRlciwgX2NvbnRyYWN0b3JQcm9wb3NhbElELCBfYW1vdW50KTsNCiAgICAgICAgICAgIGlmIChfY29udHJhY3Rvci5Qcm9qZWN0KCkuUHJvamVjdE1hbmFnZXIoKSA9PSBhZGRyZXNzKF9jb250cmFjdG9yKSkgcC5hbW91bnRGb3JUb2tlbnMgPSBfYW1vdW50Ow0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcC5hbW91bnQgPSBCYWxhbmNlKCk7DQogICAgICAgICAgICAgICAgaWYgKF9hbW91bnQgPiBwLmFtb3VudCkgcC5hbW91bnRGb3JTaGFyZXMgPSBfYW1vdW50IC0gcC5hbW91bnQ7DQogICAgICAgICAgICAgICAgZWxzZSBwLmFtb3VudCA9IF9hbW91bnQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHAubW9kZXJhdG9yID0gX21vZGVyYXRvcjsNCg0KICAgICAgICBwLmluaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllciA9IF9pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXI7DQoNCiAgICAgICAgcC5taW51dGVzRnVuZGluZ1BlcmlvZCA9IF9taW51dGVzRnVuZGluZ1BlcmlvZDsNCg0KICAgICAgICBwLmNvbW1pdHRlZUlEID0gbmV3Q29tbWl0dGVlKFByb3Bvc2FsVHlwZXMuY29udHJhY3RvciwgX3Byb3Bvc2FsSUQsIF9taW51dGVzRGViYXRpbmdQZXJpb2QpOyAgIA0KDQogICAgICAgIHAub3BlbiA9IHRydWU7DQogICAgICAgIA0KICAgICAgICBQcm9wb3NhbFN1Ym1pdHRlZChfcHJvcG9zYWxJRCwgcC5jb21taXR0ZWVJRCwgcC5jb250cmFjdG9yLCBwLmNvbnRyYWN0b3JQcm9wb3NhbElELCBwLmFtb3VudCtwLmFtb3VudEZvclNoYXJlcytwLmFtb3VudEZvclRva2VucywgDQogICAgICAgICAgICBfcHJvcG9zYWxEZXNjcmlwdGlvbiwgcC5tb2RlcmF0b3IsIHAuaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyLCBwLm1pbnV0ZXNGdW5kaW5nUGVyaW9kKTsNCg0KICAgICAgICByZXR1cm4gX3Byb3Bvc2FsSUQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcmVzb2x1dGlvblByb3Bvc2FsKA0KICAgICAgICBzdHJpbmcgX25hbWUsDQogICAgICAgIHN0cmluZyBfZGVzY3JpcHRpb24sDQogICAgICAgIFBhc3NQcm9qZWN0IF9wcm9qZWN0LA0KICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QpIHBheWFibGUgcmV0dXJucyAodWludCkgew0KICAgICAgICANCiAgICAgICAgaWYgKGFkZHJlc3MoX3Byb2plY3QpID09IDApIF9wcm9qZWN0ID0gUGFzc1Byb2plY3QocGFzc0Rhby5NZXRhUHJvamVjdCgpKTsNCiAgICAgICAgDQogICAgICAgIHVpbnQgX3F1ZXN0aW9uSUQgPSBSZXNvbHV0aW9uUHJvcG9zYWxzLmxlbmd0aCsrOw0KICAgICAgICBRdWVzdGlvbiBxID0gUmVzb2x1dGlvblByb3Bvc2Fsc1tfcXVlc3Rpb25JRF07DQogICAgICAgIA0KICAgICAgICBxLnByb2plY3QgPSBfcHJvamVjdDsNCiAgICAgICAgcS5uYW1lID0gX25hbWU7DQogICAgICAgIHEuZGVzY3JpcHRpb24gPSBfZGVzY3JpcHRpb247DQogICAgICAgIA0KICAgICAgICBxLmNvbW1pdHRlZUlEID0gbmV3Q29tbWl0dGVlKFByb3Bvc2FsVHlwZXMucmVzb2x1dGlvbiwgX3F1ZXN0aW9uSUQsIF9taW51dGVzRGViYXRpbmdQZXJpb2QpOw0KICAgICAgICANCiAgICAgICAgUmVzb2x1dGlvblByb3Bvc2FsU3VibWl0dGVkKF9xdWVzdGlvbklELCBxLmNvbW1pdHRlZUlELCBxLnByb2plY3QsIHEubmFtZSwgcS5kZXNjcmlwdGlvbik7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gX3F1ZXN0aW9uSUQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcnVsZXNQcm9wb3NhbCgNCiAgICAgICAgdWludCBfbWluUXVvcnVtRGl2aXNvciwgDQogICAgICAgIHVpbnQgX21pbkNvbW1pdHRlZUZlZXMsDQogICAgICAgIHVpbnQgX21pblBlcmNlbnRhZ2VPZkxpa2VzLA0KICAgICAgICB1aW50IF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QsDQogICAgICAgIHVpbnQgX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QsDQogICAgICAgIHVpbnQgX2ZlZXNSZXdhcmRJbmZsYXRpb25SYXRlLA0KICAgICAgICB1aW50IF9kZWZhdWx0TWludXRlc0Z1bmRpbmdQZXJpb2QsDQogICAgICAgIHVpbnQgX3Rva2VuUHJpY2VJbmZsYXRpb25SYXRlKSBwYXlhYmxlIHJldHVybnMgKHVpbnQpIHsNCg0KICAgIA0KICAgICAgICBpZiAoX21pblF1b3J1bURpdmlzb3IgPD0gMQ0KICAgICAgICAgICAgfHwgX21pblF1b3J1bURpdmlzb3IgPiAxMA0KICAgICAgICAgICAgfHwgX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCA8IG1pbk1pbnV0ZXNQZXJpb2RzDQogICAgICAgICAgICB8fCBfbWluTWludXRlc0RlYmF0ZVBlcmlvZCA8IG1pbk1pbnV0ZXNQZXJpb2RzDQogICAgICAgICAgICB8fCBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgPiBtYXhJbmZsYXRpb25SYXRlDQogICAgICAgICAgICB8fCBfdG9rZW5QcmljZUluZmxhdGlvblJhdGUgPiBtYXhJbmZsYXRpb25SYXRlDQogICAgICAgICAgICB8fCBfZGVmYXVsdE1pbnV0ZXNGdW5kaW5nUGVyaW9kIDwgbWluTWludXRlc1BlcmlvZHMpIHRocm93OyANCiAgICAgICAgDQogICAgICAgIHVpbnQgX3J1bGVzUHJvcG9zYWxJRCA9IHJ1bGVzUHJvcG9zYWxzLmxlbmd0aCsrOw0KICAgICAgICBSdWxlcyByID0gcnVsZXNQcm9wb3NhbHNbX3J1bGVzUHJvcG9zYWxJRF07DQoNCiAgICAgICAgci5taW5RdW9ydW1EaXZpc29yID0gX21pblF1b3J1bURpdmlzb3I7DQogICAgICAgIHIubWluQ29tbWl0dGVlRmVlcyA9IF9taW5Db21taXR0ZWVGZWVzOw0KICAgICAgICByLm1pblBlcmNlbnRhZ2VPZkxpa2VzID0gX21pblBlcmNlbnRhZ2VPZkxpa2VzOw0KICAgICAgICByLm1pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCA9IF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2Q7DQogICAgICAgIHIubWluTWludXRlc0RlYmF0ZVBlcmlvZCA9IF9taW5NaW51dGVzRGViYXRlUGVyaW9kOw0KICAgICAgICByLmZlZXNSZXdhcmRJbmZsYXRpb25SYXRlID0gX2ZlZXNSZXdhcmRJbmZsYXRpb25SYXRlOw0KICAgICAgICByLmRlZmF1bHRNaW51dGVzRnVuZGluZ1BlcmlvZCA9IF9kZWZhdWx0TWludXRlc0Z1bmRpbmdQZXJpb2Q7DQogICAgICAgIHIudG9rZW5QcmljZUluZmxhdGlvblJhdGUgPSBfdG9rZW5QcmljZUluZmxhdGlvblJhdGU7DQoNCiAgICAgICAgci5jb21taXR0ZWVJRCA9IG5ld0NvbW1pdHRlZShQcm9wb3NhbFR5cGVzLnJ1bGVzLCBfcnVsZXNQcm9wb3NhbElELCAwKTsNCg0KICAgICAgICBSdWxlc1Byb3Bvc2FsU3VibWl0dGVkKF9ydWxlc1Byb3Bvc2FsSUQsIHIuY29tbWl0dGVlSUQsIF9taW5RdW9ydW1EaXZpc29yLCBfbWluQ29tbWl0dGVlRmVlcywgDQogICAgICAgICAgICBfbWluUGVyY2VudGFnZU9mTGlrZXMsIF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QsIF9taW5NaW51dGVzRGViYXRlUGVyaW9kLCANCiAgICAgICAgICAgIF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSwgX2RlZmF1bHRNaW51dGVzRnVuZGluZ1BlcmlvZCwgX3Rva2VuUHJpY2VJbmZsYXRpb25SYXRlKTsNCg0KICAgICAgICByZXR1cm4gX3J1bGVzUHJvcG9zYWxJRDsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gdXBncmFkZVByb3Bvc2FsKA0KICAgICAgICBhZGRyZXNzIF9uZXdDb21taXR0ZWVSb29tLA0KICAgICAgICBhZGRyZXNzIF9uZXdTaGFyZU1hbmFnZXIsDQogICAgICAgIGFkZHJlc3MgX25ld1Rva2VuTWFuYWdlciwNCiAgICAgICAgdWludCBfbWludXRlc0RlYmF0aW5nUGVyaW9kDQogICAgKSBwYXlhYmxlIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgDQogICAgICAgIHVpbnQgX3VwZ3JhZGVQcm9wb3NhbElEID0gVXBncmFkZVByb3Bvc2Fscy5sZW5ndGgrKzsNCiAgICAgICAgVXBncmFkZSB1ID0gVXBncmFkZVByb3Bvc2Fsc1tfdXBncmFkZVByb3Bvc2FsSURdOw0KICAgICAgICANCiAgICAgICAgdS5uZXdDb21taXR0ZWVSb29tID0gX25ld0NvbW1pdHRlZVJvb207DQogICAgICAgIHUubmV3U2hhcmVNYW5hZ2VyID0gX25ld1NoYXJlTWFuYWdlcjsNCiAgICAgICAgdS5uZXdUb2tlbk1hbmFnZXIgPSBfbmV3VG9rZW5NYW5hZ2VyOw0KDQogICAgICAgIHUuY29tbWl0dGVlSUQgPSBuZXdDb21taXR0ZWUoUHJvcG9zYWxUeXBlcy51cGdyYWRlLCBfdXBncmFkZVByb3Bvc2FsSUQsIF9taW51dGVzRGViYXRpbmdQZXJpb2QpOw0KICAgICAgICANCiAgICAgICAgVXBncmFkZVByb3Bvc2FsU3VibWl0dGVkKF91cGdyYWRlUHJvcG9zYWxJRCwgdS5jb21taXR0ZWVJRCwgdS5uZXdDb21taXR0ZWVSb29tLCB1Lm5ld1NoYXJlTWFuYWdlciwgdS5uZXdUb2tlbk1hbmFnZXIpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIF91cGdyYWRlUHJvcG9zYWxJRDsNCiAgICB9DQogICAgDQovLyBDb21taXR0ZWVzIG1hbmFnZW1lbnQNCg0KICAgIGZ1bmN0aW9uIG5ld0NvbW1pdHRlZSgNCiAgICAgICAgUHJvcG9zYWxUeXBlcyBfcHJvcG9zYWxUeXBlLA0KICAgICAgICB1aW50IF9wcm9wb3NhbElELCANCiAgICAgICAgdWludCBfbWludXRlc0RlYmF0aW5nUGVyaW9kDQogICAgKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQoNCiAgICAgICAgaWYgKF9taW51dGVzRGViYXRpbmdQZXJpb2QgPT0gMCkgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCA9IHJ1bGVzUHJvcG9zYWxzWzBdLm1pbk1pbnV0ZXNEZWJhdGVQZXJpb2Q7DQogICAgICAgIA0KICAgICAgICBpZiAocGFzc0Rhby5BY3R1YWxDb21taXR0ZWVSb29tKCkgIT0gYWRkcmVzcyh0aGlzKQ0KICAgICAgICAgICAgfHwgbXNnLnZhbHVlIDwgcnVsZXNQcm9wb3NhbHNbMF0ubWluQ29tbWl0dGVlRmVlcw0KICAgICAgICAgICAgfHwgbm93ICsgKChydWxlc1Byb3Bvc2Fsc1swXS5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgKyBfbWludXRlc0RlYmF0aW5nUGVyaW9kKSAqIDEgbWludXRlcykgPCBub3cNCiAgICAgICAgICAgIHx8IF9taW51dGVzRGViYXRpbmdQZXJpb2QgPCBydWxlc1Byb3Bvc2Fsc1swXS5taW5NaW51dGVzRGViYXRlUGVyaW9kDQogICAgICAgICAgICB8fCBtc2cuc2VuZGVyID09IGFkZHJlc3ModGhpcykpIHRocm93Ow0KDQogICAgICAgIHVpbnQgX2NvbW1pdHRlZUlEID0gQ29tbWl0dGVlcy5sZW5ndGgrKzsNCiAgICAgICAgQ29tbWl0dGVlIGIgPSBDb21taXR0ZWVzW19jb21taXR0ZWVJRF07DQoNCiAgICAgICAgYi5jcmVhdG9yID0gbXNnLnNlbmRlcjsNCg0KICAgICAgICBiLnByb3Bvc2FsVHlwZSA9IF9wcm9wb3NhbFR5cGU7DQogICAgICAgIGIucHJvcG9zYWxJRCA9IF9wcm9wb3NhbElEOw0KDQogICAgICAgIGIuZmVlcyA9IG1zZy52YWx1ZTsNCiAgICAgICAgDQogICAgICAgIGIuc2V0RGVhZGxpbmUgPSBub3cgKyAocnVsZXNQcm9wb3NhbHNbMF0ubWludXRlc1NldFByb3Bvc2FsUGVyaW9kICogMSBtaW51dGVzKTsgICAgICAgIA0KICAgICAgICBiLnZvdGluZ0RlYWRsaW5lID0gYi5zZXREZWFkbGluZSArIChfbWludXRlc0RlYmF0aW5nUGVyaW9kICogMSBtaW51dGVzKTsgDQoNCiAgICAgICAgYi5vcGVuID0gdHJ1ZTsgDQoNCiAgICAgICAgcmV0dXJuIF9jb21taXR0ZWVJRDsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gdm90ZSgNCiAgICAgICAgdWludCBfY29tbWl0dGVlSUQsIA0KICAgICAgICBib29sIF9zdXBwb3J0c1Byb3Bvc2FsKSB7DQogICAgICAgIA0KICAgICAgICBDb21taXR0ZWUgYiA9IENvbW1pdHRlZXNbX2NvbW1pdHRlZUlEXTsNCg0KICAgICAgICBpZiAoaGFzVm90ZWRbX2NvbW1pdHRlZUlEXVttc2cuc2VuZGVyXSANCiAgICAgICAgICAgIHx8IG5vdyA8IGIuc2V0RGVhZGxpbmUNCiAgICAgICAgICAgIHx8IG5vdyA+IGIudm90aW5nRGVhZGxpbmUpIHRocm93Ow0KICAgICAgICAgICAgDQogICAgICAgIFBhc3NNYW5hZ2VyIF9zaGFyZU1hbmFnZXIgPSBTaGFyZU1hbmFnZXIoKTsNCg0KICAgICAgICB1aW50IF9iYWxhbmNlID0gdWludChfc2hhcmVNYW5hZ2VyLmJhbGFuY2VPZihtc2cuc2VuZGVyKSk7DQogICAgICAgIGlmIChfYmFsYW5jZSA9PSAwKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIGhhc1ZvdGVkW19jb21taXR0ZWVJRF1bbXNnLnNlbmRlcl0gPSB0cnVlOw0KDQogICAgICAgIF9zaGFyZU1hbmFnZXIuYmxvY2tUcmFuc2Zlcihtc2cuc2VuZGVyLCBiLnZvdGluZ0RlYWRsaW5lKTsNCg0KICAgICAgICBpZiAoX3N1cHBvcnRzUHJvcG9zYWwpIGIueWVhICs9IF9iYWxhbmNlOw0KICAgICAgICBlbHNlIGIubmF5ICs9IF9iYWxhbmNlOyANCg0KICAgICAgICB1aW50IF9hID0gMTAwKmIuZmVlczsNCiAgICAgICAgaWYgKChfYS8xMDAgIT0gYi5mZWVzKSB8fCAoKF9hKl9iYWxhbmNlKS9fYSAhPSBfYmFsYW5jZSkpIHRocm93Ow0KICAgICAgICB1aW50IF9tdWx0aXBsaWVyID0gKF9hKl9iYWxhbmNlKS91aW50KF9zaGFyZU1hbmFnZXIudG90YWxTdXBwbHkoKSk7DQogICAgICAgIHVpbnQgX2Rpdmlzb3IgPSAxMDAgKyAxMDAqcnVsZXNQcm9wb3NhbHNbMF0uZmVlc1Jld2FyZEluZmxhdGlvblJhdGUqKG5vdyAtIGIuc2V0RGVhZGxpbmUpLygxMDAqMzY1IGRheXMpOw0KICAgICAgICB1aW50IF9yZXdhcmRlZGFtb3VudCA9IF9tdWx0aXBsaWVyL19kaXZpc29yOw0KICAgICAgICBpZiAoYi50b3RhbFJld2FyZGVkQW1vdW50ICsgX3Jld2FyZGVkYW1vdW50ID4gYi5mZWVzKSBfcmV3YXJkZWRhbW91bnQgPSBiLmZlZXMgLSBiLnRvdGFsUmV3YXJkZWRBbW91bnQ7DQogICAgICAgIGIudG90YWxSZXdhcmRlZEFtb3VudCArPSBfcmV3YXJkZWRhbW91bnQ7DQogICAgICAgIGlmICghbXNnLnNlbmRlci5zZW5kKF9yZXdhcmRlZGFtb3VudCkpIHRocm93Ow0KDQogICAgICAgIFZvdGVkKF9jb21taXR0ZWVJRCwgX3N1cHBvcnRzUHJvcG9zYWwsIG1zZy5zZW5kZXIsIF9yZXdhcmRlZGFtb3VudCk7ICAgIA0KfQ0KDQovLyBEZWNpc2lvbnMgbWFuYWdlbWVudA0KDQogICAgZnVuY3Rpb24gZXhlY3V0ZURlY2lzaW9uKHVpbnQgX2NvbW1pdHRlZUlEKSByZXR1cm5zIChib29sKSB7DQoNCiAgICAgICAgQ29tbWl0dGVlIGIgPSBDb21taXR0ZWVzW19jb21taXR0ZWVJRF07DQogICAgICAgIA0KICAgICAgICBpZiAobm93IDwgYi52b3RpbmdEZWFkbGluZSB8fCAhYi5vcGVuKSByZXR1cm47DQogICAgICAgIA0KICAgICAgICBiLm9wZW4gPSBmYWxzZTsNCg0KICAgICAgICBQYXNzTWFuYWdlciBfc2hhcmVNYW5hZ2VyID0gU2hhcmVNYW5hZ2VyKCk7DQogICAgICAgIHVpbnQgX3F1YW50aXR5T2ZTaGFyZXM7DQogICAgICAgIFBhc3NNYW5hZ2VyIF90b2tlbk1hbmFnZXIgPSBUb2tlbk1hbmFnZXIoKTsNCg0KICAgICAgICBpZiAoMTAwKmIueWVhID4gcnVsZXNQcm9wb3NhbHNbMF0ubWluUGVyY2VudGFnZU9mTGlrZXMgKiB1aW50KF9zaGFyZU1hbmFnZXIudG90YWxTdXBwbHkoKSkpIHsgICAgICAgDQogICAgICAgICAgICBfcXVhbnRpdHlPZlNoYXJlcyA9IF9zaGFyZU1hbmFnZXIucmV3YXJkVG9rZW5zRm9yQ2xpZW50KGIuY3JlYXRvciwgcnVsZXNQcm9wb3NhbHNbMF0ubWluQ29tbWl0dGVlRmVlcyk7DQogICAgICAgIH0gICAgICAgIA0KDQogICAgICAgIHVpbnQgX3NlbnRUb0Rhb01hbmFnZXIgPSBiLmZlZXMgLSBiLnRvdGFsUmV3YXJkZWRBbW91bnQ7DQogICAgICAgIGlmIChfc2VudFRvRGFvTWFuYWdlciA+IDApIHsNCiAgICAgICAgICAgIGlmICghYWRkcmVzcyhfc2hhcmVNYW5hZ2VyKS5zZW5kKF9zZW50VG9EYW9NYW5hZ2VyKSkgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmIChiLnllYSArIGIubmF5IDwgbWluUXVvcnVtKCkgfHwgYi55ZWEgPD0gYi5uYXkpIHsNCiAgICAgICAgICAgIGlmIChiLnByb3Bvc2FsVHlwZSA9PSBQcm9wb3NhbFR5cGVzLmNvbnRyYWN0b3IpIFByb3Bvc2Fsc1tiLnByb3Bvc2FsSURdLm9wZW4gPSBmYWxzZTsNCiAgICAgICAgICAgIFByb3Bvc2FsQ2xvc2VkKGIucHJvcG9zYWxJRCwgYi5wcm9wb3NhbFR5cGUsIF9jb21taXR0ZWVJRCwgYi50b3RhbFJld2FyZGVkQW1vdW50LCBmYWxzZSwgX3F1YW50aXR5T2ZTaGFyZXMsIF9zZW50VG9EYW9NYW5hZ2VyKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGIuZGF0ZU9mRXhlY3V0aW9uID0gbm93Ow0KDQogICAgICAgIGlmIChiLnByb3Bvc2FsVHlwZSA9PSBQcm9wb3NhbFR5cGVzLmNvbnRyYWN0b3IpIHsNCg0KICAgICAgICAgICAgUHJvcG9zYWwgcCA9IFByb3Bvc2Fsc1tiLnByb3Bvc2FsSURdOw0KICAgIA0KICAgICAgICAgICAgaWYgKHAuY29udHJhY3RvclByb3Bvc2FsSUQgPT0gMCkgcC5vcGVuID0gZmFsc2U7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChwLmFtb3VudEZvclNoYXJlcyA9PSAwICYmIHAuYW1vdW50Rm9yVG9rZW5zID09IDApIG9yZGVyVG9Db250cmFjdG9yKGIucHJvcG9zYWxJRCk7DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAocC5hbW91bnRGb3JTaGFyZXMgIT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBfc2hhcmVNYW5hZ2VyLnNldEZ1bmRpbmdSdWxlcyhwLm1vZGVyYXRvciwgcC5pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIsIHAuYW1vdW50Rm9yU2hhcmVzLCBwLm1pbnV0ZXNGdW5kaW5nUGVyaW9kLCAwLCBiLnByb3Bvc2FsSUQpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChwLmFtb3VudEZvclRva2VucyAhPSAwKSB7DQogICAgICAgICAgICAgICAgICAgIF90b2tlbk1hbmFnZXIuc2V0RnVuZGluZ1J1bGVzKHAubW9kZXJhdG9yLCAwLCBwLmFtb3VudEZvclRva2VucywgcC5taW51dGVzRnVuZGluZ1BlcmlvZCwgcnVsZXNQcm9wb3NhbHNbMF0udG9rZW5QcmljZUluZmxhdGlvblJhdGUsIGIucHJvcG9zYWxJRCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0gZWxzZSBpZiAoYi5wcm9wb3NhbFR5cGUgPT0gUHJvcG9zYWxUeXBlcy5yZXNvbHV0aW9uKSB7DQogICAgICAgICAgICANCiAgICAgICAgICAgIFF1ZXN0aW9uIHEgPSBSZXNvbHV0aW9uUHJvcG9zYWxzW2IucHJvcG9zYWxJRF07DQogICAgICAgICAgICANCiAgICAgICAgICAgIHEucHJvamVjdC5uZXdSZXNvbHV0aW9uKHEubmFtZSwgcS5kZXNjcmlwdGlvbik7DQogICAgICAgICAgICANCiAgICAgICAgfSBlbHNlIGlmIChiLnByb3Bvc2FsVHlwZSA9PSBQcm9wb3NhbFR5cGVzLnJ1bGVzKSB7DQoNCiAgICAgICAgICAgIFJ1bGVzIHIgPSBydWxlc1Byb3Bvc2Fsc1tiLnByb3Bvc2FsSURdOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBydWxlc1Byb3Bvc2Fsc1swXS5jb21taXR0ZWVJRCA9IHIuY29tbWl0dGVlSUQ7DQogICAgICAgICAgICBydWxlc1Byb3Bvc2Fsc1swXS5taW5RdW9ydW1EaXZpc29yID0gci5taW5RdW9ydW1EaXZpc29yOw0KICAgICAgICAgICAgcnVsZXNQcm9wb3NhbHNbMF0ubWluTWludXRlc0RlYmF0ZVBlcmlvZCA9IHIubWluTWludXRlc0RlYmF0ZVBlcmlvZDsgDQogICAgICAgICAgICBydWxlc1Byb3Bvc2Fsc1swXS5taW5Db21taXR0ZWVGZWVzID0gci5taW5Db21taXR0ZWVGZWVzOw0KICAgICAgICAgICAgcnVsZXNQcm9wb3NhbHNbMF0ubWluUGVyY2VudGFnZU9mTGlrZXMgPSByLm1pblBlcmNlbnRhZ2VPZkxpa2VzOw0KICAgICAgICAgICAgcnVsZXNQcm9wb3NhbHNbMF0ubWludXRlc1NldFByb3Bvc2FsUGVyaW9kID0gci5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2Q7DQogICAgICAgICAgICBydWxlc1Byb3Bvc2Fsc1swXS5mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSA9IHIuZmVlc1Jld2FyZEluZmxhdGlvblJhdGU7DQogICAgICAgICAgICBydWxlc1Byb3Bvc2Fsc1swXS50b2tlblByaWNlSW5mbGF0aW9uUmF0ZSA9IHIudG9rZW5QcmljZUluZmxhdGlvblJhdGU7DQogICAgICAgICAgICBydWxlc1Byb3Bvc2Fsc1swXS5kZWZhdWx0TWludXRlc0Z1bmRpbmdQZXJpb2QgPSByLmRlZmF1bHRNaW51dGVzRnVuZGluZ1BlcmlvZDsNCg0KICAgICAgICB9IGVsc2UgaWYgKGIucHJvcG9zYWxUeXBlID09IFByb3Bvc2FsVHlwZXMudXBncmFkZSkgew0KDQogICAgICAgICAgICBVcGdyYWRlIHUgPSBVcGdyYWRlUHJvcG9zYWxzW2IucHJvcG9zYWxJRF07DQoNCiAgICAgICAgICAgIGlmICgodS5uZXdTaGFyZU1hbmFnZXIgIT0gMCkgJiYgKHUubmV3U2hhcmVNYW5hZ2VyICE9IGFkZHJlc3MoX3NoYXJlTWFuYWdlcikpKSB7DQogICAgICAgICAgICAgICAgX3NoYXJlTWFuYWdlci5kaXNhYmxlVHJhbnNmZXIoKTsNCiAgICAgICAgICAgICAgICBpZiAoX3NoYXJlTWFuYWdlci5iYWxhbmNlID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIV9zaGFyZU1hbmFnZXIuc2VuZFRvKHUubmV3U2hhcmVNYW5hZ2VyLCBfc2hhcmVNYW5hZ2VyLmJhbGFuY2UpKSB0aHJvdzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICgodS5uZXdUb2tlbk1hbmFnZXIgIT0gMCkgJiYgKHUubmV3VG9rZW5NYW5hZ2VyICE9IGFkZHJlc3MoX3Rva2VuTWFuYWdlcikpKSB7DQogICAgICAgICAgICAgICAgX3Rva2VuTWFuYWdlci5kaXNhYmxlVHJhbnNmZXIoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcGFzc0Rhby51cGdyYWRlKHUubmV3Q29tbWl0dGVlUm9vbSwgdS5uZXdTaGFyZU1hbmFnZXIsIHUubmV3VG9rZW5NYW5hZ2VyKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIERhcHBVcGdyYWRlZCh1Lm5ld0NvbW1pdHRlZVJvb20sIHUubmV3U2hhcmVNYW5hZ2VyLCB1Lm5ld1Rva2VuTWFuYWdlcik7DQogICAgICAgICAgICANCiAgICAgICAgfQ0KDQogICAgICAgIFByb3Bvc2FsQ2xvc2VkKGIucHJvcG9zYWxJRCwgYi5wcm9wb3NhbFR5cGUsIF9jb21taXR0ZWVJRCAsIGIudG90YWxSZXdhcmRlZEFtb3VudCwgdHJ1ZSwgX3F1YW50aXR5T2ZTaGFyZXMsIF9zZW50VG9EYW9NYW5hZ2VyKTsNCiAgICAgICAgICAgIA0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gb3JkZXJUb0NvbnRyYWN0b3IodWludCBfcHJvcG9zYWxJRCkgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICANCiAgICAgICAgUHJvcG9zYWwgcCA9IFByb3Bvc2Fsc1tfcHJvcG9zYWxJRF07DQogICAgICAgIENvbW1pdHRlZSBiID0gQ29tbWl0dGVlc1twLmNvbW1pdHRlZUlEXTsNCg0KICAgICAgICBpZiAoYi5vcGVuIHx8ICFwLm9wZW4pIHJldHVybjsNCiAgICAgICAgDQogICAgICAgIHVpbnQgX2Ftb3VudEZvclNoYXJlczsNCiAgICAgICAgdWludCBfYW1vdW50Rm9yVG9rZW5zOw0KDQogICAgICAgIGlmIChwLmFtb3VudEZvclNoYXJlcyAhPSAwKSB7DQogICAgICAgICAgICBfYW1vdW50Rm9yU2hhcmVzID0gU2hhcmVNYW5hZ2VyKCkuRnVuZGVkQW1vdW50KF9wcm9wb3NhbElEKTsNCiAgICAgICAgICAgIGlmIChfYW1vdW50Rm9yU2hhcmVzID09IDAgJiYgbm93IDw9IGIuZGF0ZU9mRXhlY3V0aW9uICsgKHAubWludXRlc0Z1bmRpbmdQZXJpb2QgKiAxIG1pbnV0ZXMpKSByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBpZiAocC5hbW91bnRGb3JUb2tlbnMgIT0gMCkgew0KICAgICAgICAgICAgX2Ftb3VudEZvclRva2VucyA9IFRva2VuTWFuYWdlcigpLkZ1bmRlZEFtb3VudChfcHJvcG9zYWxJRCk7DQogICAgICAgICAgICBpZiAoX2Ftb3VudEZvclRva2VucyA9PSAwICYmIG5vdyA8PSBiLmRhdGVPZkV4ZWN1dGlvbiArIChwLm1pbnV0ZXNGdW5kaW5nUGVyaW9kICogMSBtaW51dGVzKSkgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwLm9wZW4gPSBmYWxzZTsgICANCg0KICAgICAgICB1aW50IF9hbW91bnQgPSBwLmFtb3VudCArIF9hbW91bnRGb3JTaGFyZXMgKyBfYW1vdW50Rm9yVG9rZW5zOw0KDQogICAgICAgIFBhc3NQcm9qZWN0IF9wcm9qZWN0ID0gUGFzc1Byb2plY3QocC5jb250cmFjdG9yLlByb2plY3QoKSk7DQoNCiAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgew0KICAgICAgICAgICAgQ29udHJhY3RvclByb3Bvc2FsQ2xvc2VkKF9wcm9wb3NhbElELCBwLmNvbnRyYWN0b3JQcm9wb3NhbElELCBwLmNvbnRyYWN0b3IsIDApOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9ICAgIA0KDQogICAgICAgIGlmICghcC5jb250cmFjdG9yLm9yZGVyKHAuY29udHJhY3RvclByb3Bvc2FsSUQsIF9hbW91bnQpKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIGlmIChwLmFtb3VudCArIF9hbW91bnRGb3JTaGFyZXMgPiAwKSB7DQogICAgICAgICAgICBpZiAoIVNoYXJlTWFuYWdlcigpLnNlbmRUbyhwLmNvbnRyYWN0b3IsIHAuYW1vdW50ICsgX2Ftb3VudEZvclNoYXJlcykpIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIGlmIChfYW1vdW50Rm9yVG9rZW5zID4gMCkgew0KICAgICAgICAgICAgaWYgKCFUb2tlbk1hbmFnZXIoKS5zZW5kVG8ocC5jb250cmFjdG9yLCBfYW1vdW50Rm9yVG9rZW5zKSkgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBDb250cmFjdG9yUHJvcG9zYWxDbG9zZWQoX3Byb3Bvc2FsSUQsIHAuY29udHJhY3RvclByb3Bvc2FsSUQsIHAuY29udHJhY3RvciwgX2Ftb3VudCk7DQogICAgICAgIA0KICAgICAgICBwYXNzRGFvLmFkZFByb2plY3QoX3Byb2plY3QpOw0KICAgICAgICBfcHJvamVjdC5uZXdPcmRlcihwLmNvbnRyYWN0b3IsIHAuY29udHJhY3RvclByb3Bvc2FsSUQsIF9hbW91bnQpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQovLyBIb2xkZXIgQWNjb3VudCBtYW5hZ2VtZW50DQoNCiAgICBmdW5jdGlvbiBidXlTaGFyZXNGb3JQcm9wb3NhbCh1aW50IF9wcm9wb3NhbElEKSBwYXlhYmxlIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBTaGFyZU1hbmFnZXIoKS5idXlUb2tlbnNGb3JQcm9wb3NhbC52YWx1ZShtc2cudmFsdWUpKF9wcm9wb3NhbElELCBtc2cuc2VuZGVyKTsNCiAgICB9ICAgDQoNCiAgICBmdW5jdGlvbiBzZW5kUGVuZGluZ0Ftb3VudHMoDQogICAgICAgIHVpbnQgX2Zyb20sDQogICAgICAgIHVpbnQgX3RvLA0KICAgICAgICBhZGRyZXNzIF9idXllcikgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICANCiAgICAgICAgcmV0dXJuIFNoYXJlTWFuYWdlcigpLnNlbmRQZW5kaW5nQW1vdW50cyhfZnJvbSwgX3RvLCBfYnV5ZXIpOw0KICAgIH0gICAgICAgIA0KICAgIA0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3UGVuZGluZ0Ftb3VudHMoKSByZXR1cm5zIChib29sKSB7DQogICAgICAgIA0KICAgICAgICBpZiAoIVNoYXJlTWFuYWdlcigpLnNlbmRQZW5kaW5nQW1vdW50cygwLCAwLCBtc2cuc2VuZGVyKSkgdGhyb3c7DQogICAgfSAgICAgICAgDQogICAgICAgICAgICANCn0='