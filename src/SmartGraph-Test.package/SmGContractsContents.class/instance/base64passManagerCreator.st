base 64 content
base64passManagerCreator
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4yOw0KDQovKg0KICoNCiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFBhc3MgREFPLg0KICoNCiAqIFRoZSBUb2tlbiBNYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IGlzIHVzZWQgZm9yIHRoZSBtYW5hZ2VtZW50IG9mIHRva2Vucw0KICogYnkgYSBjbGllbnQgc21hcnQgY29udHJhY3QgKHRoZSBEYW8pLiBEZWZpbmVzIHRoZSBmdW5jdGlvbnMgdG8gc2V0IG5ldyBmdW5kaW5nIHJ1bGVzLA0KICogY3JlYXRlIG9yIHJld2FyZCB0b2tlbnMsIGNoZWNrIHRva2VuIGJhbGFuY2VzLCBzZW5kIHRva2VucyBhbmQgc2VuZA0KICogdG9rZW5zIG9uIGJlaGFsZiBvZiBhIDNyZCBwYXJ0eSBhbmQgdGhlIGNvcnJlc3BvbmRpbmcgYXBwcm92YWwgcHJvY2Vzcy4NCiAqDQoqLw0KDQovLy8gQHRpdGxlIFRva2VuIE1hbmFnZXIgc21hcnQgY29udHJhY3Qgb2YgdGhlIFBhc3MgRGVjZW50cmFsaXplZCBBdXRvbm9tb3VzIE9yZ2FuaXNhdGlvbg0KY29udHJhY3QgUGFzc1Rva2VuTWFuYWdlckludGVyZmFjZSB7DQogICAgDQogICAgc3RydWN0IGZ1bmRpbmdEYXRhIHsNCiAgICAgICAgLy8gVHJ1ZSBpZiBwdWJsaWMgZnVuZGluZyB3aXRob3V0IGEgbWFpbiBwYXJ0bmVyDQogICAgICAgIGJvb2wgcHVibGljQ3JlYXRpb247IA0KICAgICAgICAvLyBUaGUgYWRkcmVzcyB3aGljaCBzZXRzIHBhcnRuZXJzIGFuZCBtYW5hZ2VzIHRoZSBmdW5kaW5nIGluIGNhc2Ugb2YgcHJpdmF0ZSBmdW5kaW5nDQogICAgICAgIGFkZHJlc3MgbWFpblBhcnRuZXI7DQogICAgICAgIC8vIFRoZSBtYXhpbXVtIGFtb3VudCAoaW4gd2VpKSBvZiB0aGUgZnVuZGluZw0KICAgICAgICB1aW50IG1heEFtb3VudFRvRnVuZDsNCiAgICAgICAgLy8gVGhlIGFjdHVhbCBmdW5kZWQgYW1vdW50IChpbiB3ZWkpDQogICAgICAgIHVpbnQgZnVuZGVkQW1vdW50Ow0KICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgc3RhcnQgdGltZSBvZiB0aGUgZnVuZGluZw0KICAgICAgICB1aW50IHN0YXJ0VGltZTsgDQogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBjbG9zaW5nIHRpbWUgb2YgdGhlIGZ1bmRpbmcNCiAgICAgICAgdWludCBjbG9zaW5nVGltZTsgIA0KICAgICAgICAvLyBUaGUgcHJpY2UgbXVsdGlwbGllciBmb3IgYSBzaGFyZSBvciBhIHRva2VuIHdpdGhvdXQgY29uc2lkZXJpbmcgdGhlIGluZmxhdGlvbiByYXRlDQogICAgICAgIHVpbnQgaW5pdGlhbFByaWNlTXVsdGlwbGllcjsNCiAgICAgICAgLy8gUmF0ZSBwZXIgeWVhciBpbiBwZXJjZW50YWdlIGFwcGxpZWQgdG8gdGhlIHNoYXJlIG9yIHRva2VuIHByaWNlIA0KICAgICAgICB1aW50IGluZmxhdGlvblJhdGU7IA0KICAgICAgICAvLyBJbmRleCBvZiB0aGUgY2xpZW50IHByb3Bvc2FsDQogICAgICAgIHVpbnQgcHJvcG9zYWxJRDsNCiAgICB9IA0KDQogICAgLy8gQWRkcmVzcyBvZiB0aGUgY3JlYXRvciBvZiB0aGUgc21hcnQgY29udHJhY3QNCiAgICBhZGRyZXNzIHB1YmxpYyBjcmVhdG9yOw0KICAgIC8vIEFkZHJlc3Mgb2YgdGhlIERhbyAgICANCiAgICBhZGRyZXNzIHB1YmxpYyBjbGllbnQ7DQogICAgLy8gQWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50Ow0KICAgIGFkZHJlc3MgcHVibGljIHJlY2lwaWVudDsNCiAgICANCiAgICAvLyBUaGUgdG9rZW4gbmFtZSBmb3IgZGlzcGxheSBwdXJwb3NlDQogICAgc3RyaW5nIHB1YmxpYyBuYW1lOw0KICAgIC8vIFRoZSB0b2tlbiBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZQ0KICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOw0KICAgIC8vIFRoZSBxdWFudGl0eSBvZiBkZWNpbWFscyBmb3IgZGlzcGxheSBwdXJwb3NlDQogICAgdWludDggcHVibGljIGRlY2ltYWxzOw0KDQogICAgLy8gVG90YWwgYW1vdW50IG9mIHRva2Vucw0KICAgIHVpbnQyNTYgdG90YWxTdXBwbHk7DQoNCiAgICAvLyBBcnJheSB3aXRoIGFsbCBiYWxhbmNlcw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7DQogICAgLy8gQXJyYXkgd2l0aCBhbGwgYWxsb3dhbmNlcw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsNCg0KICAgIC8vIE1hcCBvZiB0aGUgcmVzdWx0IChpbiB3ZWkpIG9mIGZ1bmRpbmdzDQogICAgbWFwcGluZyAodWludCA9PiB1aW50KSBmdW5kZWRBbW91bnQ7DQogICAgDQogICAgLy8gSWYgdHJ1ZSwgdGhlIHNoYXJlcyBvciB0b2tlbnMgY2FuIGJlIHRyYW5zZmVyZWQNCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcmFibGU7DQogICAgLy8gTWFwIG9mIGJsb2NrZWQgRGFvIHNoYXJlIGFjY291bnRzLiBQb2ludHMgdG8gdGhlIGRhdGUgd2hlbiB0aGUgc2hhcmUgaG9sZGVyIGNhbiB0cmFuc2ZlciBzaGFyZXMNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBibG9ja2VkRGVhZExpbmU7IA0KDQogICAgLy8gUnVsZXMgZm9yIHRoZSBhY3R1YWwgZnVuZGluZyBhbmQgdGhlIGNvbnRyYWN0b3IgdG9rZW4gcHJpY2UNCiAgICBmdW5kaW5nRGF0YVsyXSBwdWJsaWMgRnVuZGluZ1J1bGVzOw0KICAgIA0KICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBzdXBwbHkgb2Ygc2hhcmVzIG9yIHRva2VucyANCiAgICBmdW5jdGlvbiBUb3RhbFN1cHBseSgpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpOw0KDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZA0KICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlDQogICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsNCg0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2Vucw0KICAgIC8vLyBAcmV0dXJuIFF1YW50aXR5IG9mIHJlbWFpbmluZyB0b2tlbnMgb2YgX293bmVyIHRoYXQgX3NwZW5kZXIgaXMgYWxsb3dlZCB0byBzcGVuZA0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOw0KDQogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIERhbyBwcm9wb3NhbA0KICAgIC8vLyBAcmV0dXJuIFRoZSByZXN1bHQgKGluIHdlaSkgb2YgdGhlIGZ1bmRpbmcNCiAgICBmdW5jdGlvbiBGdW5kZWRBbW91bnQodWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCk7DQoNCiAgICAvLy8gQHBhcmFtIF9zYWxlRGF0ZSBpbiBjYXNlIG9mIHByZXNhbGUsIHRoZSBkYXRlIG9mIHRoZSBwcmVzYWxlDQogICAgLy8vIEByZXR1cm4gdGhlIHNoYXJlIG9yIHRva2VuIHByaWNlIGRpdmlzb3IgY29uZGlkZXJpbmcgdGhlIHNhbGUgZGF0ZSBhbmQgdGhlIGluZmxhdGlvbiByYXRlDQogICAgZnVuY3Rpb24gcHJpY2VEaXZpc29yKHVpbnQgX3NhbGVEYXRlKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KTsNCiAgICANCiAgICAvLy8gQHJldHVybiB0aGUgYWN0dWFsIHByaWNlIGRpdmlzb3Igb2YgYSBzaGFyZSBvciB0b2tlbg0KICAgIGZ1bmN0aW9uIGFjdHVhbFByaWNlRGl2aXNvcigpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpOw0KDQogICAgLy8vIEByZXR1cm4gVGhlIG1heGltYWwgYW1vdW50IGEgbWFpbiBwYXJ0bmVyIGNhbiBmdW5kIGF0IHRoaXMgbW9tZW50DQogICAgLy8vIEBwYXJhbSBfbWFpblBhcnRuZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG1haW4gcGFybmVyDQogICAgZnVuY3Rpb24gZnVuZGluZ01heEFtb3VudChhZGRyZXNzIF9tYWluUGFydG5lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCk7DQoNCiAgICAvLyBNb2RpZmllciB0aGF0IGFsbG93cyBvbmx5IHRoZSBjbGllbnQgdG8gbWFuYWdlIHRoaXMgYWNjb3VudCBtYW5hZ2VyDQogICAgbW9kaWZpZXIgb25seUNsaWVudCB7aWYgKG1zZy5zZW5kZXIgIT0gY2xpZW50KSB0aHJvdzsgXzt9DQoNCiAgICAvLyBNb2RpZmllciB0aGF0IGFsbG93cyBvbmx5IHRoZSBtYWluIHBhcnRuZXIgdG8gbWFuYWdlIHRoZSBhY3R1YWwgZnVuZGluZw0KICAgIG1vZGlmaWVyIG9ubHlNYWluUGFydG5lciB7aWYgKG1zZy5zZW5kZXIgIT0gIEZ1bmRpbmdSdWxlc1swXS5tYWluUGFydG5lcikgdGhyb3c7IF87fQ0KICAgIA0KICAgIC8vIE1vZGlmaWVyIHRoYXQgYWxsb3dzIG9ubHkgdGhlIGNvbnRyYWN0b3IgcHJvcG9zZSBzZXQgdGhlIHRva2VuIHByaWNlIG9yIHdpdGhkcmF3DQogICAgbW9kaWZpZXIgb25seUNvbnRyYWN0b3Ige2lmIChyZWNpcGllbnQgPT0gMCB8fCAobXNnLnNlbmRlciAhPSByZWNpcGllbnQgJiYgbXNnLnNlbmRlciAhPSBjcmVhdG9yKSkgdGhyb3c7IF87fQ0KICAgIA0KICAgIC8vIE1vZGlmaWVyIGZvciBEYW8gZnVuY3Rpb25zDQogICAgbW9kaWZpZXIgb25seURhbyB7aWYgKHJlY2lwaWVudCAhPSAwKSB0aHJvdzsgXzt9DQogICAgDQogICAgLy8vIEBkZXYgVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uDQogICAgLy8vIEBwYXJhbSBfY3JlYXRvciBUaGUgYWRkcmVzcyBvZiB0aGUgY3JlYXRvciBvZiB0aGUgc21hcnQgY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9jbGllbnQgVGhlIGFkZHJlc3Mgb2YgdGhlIGNsaWVudCBvciBEYW8NCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIHJlY2lwaWVudCBvZiB0aGlzIG1hbmFnZXINCiAgICAvL2Z1bmN0aW9uIFRva2VuTWFuYWdlcigNCiAgICAgICAgLy9hZGRyZXNzIF9jcmVhdG9yLA0KICAgICAgICAvL2FkZHJlc3MgX2NsaWVudCwNCiAgICAgICAgLy9hZGRyZXNzIF9yZWNpcGllbnQNCiAgICAvLyk7DQoNCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgVGhlIHRva2VuIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZQ0KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRoZSB0b2tlbiBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZQ0KICAgIC8vLyBAcGFyYW0gX3Rva2VuRGVjaW1hbHMgVGhlIHF1YW50aXR5IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2UNCiAgICAvLy8gQHBhcmFtIF9pbml0aWFsU3VwcGx5UmVjaXBpZW50IFRoZSByZWNpcGllbnQgb2YgdGhlIGluaXRpYWwgc3VwcGx5IChub3QgbWFuZGF0b3J5KQ0KICAgIC8vLyBAcGFyYW0gX2luaXRpYWxTdXBwbHkgVGhlIGluaXRpYWwgc3VwcGx5IG9mIHRva2VucyBmb3IgdGhlIHJlY2lwaWVudCAobm90IG1hbmRhdG9yeSkNCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcmFibGUgVHJ1ZSBpZiBhbGxvd3MgdGhlIHRyYW5zZmVyIG9mIHRva2Vucw0KICAgIGZ1bmN0aW9uIGluaXRUb2tlbigNCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsDQogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsDQogICAgICAgIHVpbnQ4IF90b2tlbkRlY2ltYWxzLA0KICAgICAgICBhZGRyZXNzIF9pbml0aWFsU3VwcGx5UmVjaXBpZW50LA0KICAgICAgICB1aW50MjU2IF9pbml0aWFsU3VwcGx5LA0KICAgICAgICBib29sIF90cmFuc2ZlcmFibGUNCiAgICAgICApOw0KDQogICAgLy8vIEBwYXJhbSBfaW5pdGlhbFByaWNlTXVsdGlwbGllciBUaGUgaW5pdGlhbCBwcmljZSBtdWx0aXBsaWVyIG9mIGNvbnRyYWN0b3IgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfaW5mbGF0aW9uUmF0ZSBJZiAwLCB0aGUgY29udHJhY3RvciB0b2tlbiBwcmljZSBkb2Vzbid0IGNoYW5nZSBkdXJpbmcgdGhlIGZ1bmRpbmcNCiAgICAvLy8gQHBhcmFtIF9jbG9zaW5nVGltZSBUaGUgaW5pdGlhbCBwcmljZSBhbmQgaW5mbGF0aW9uIHJhdGUgY2FuIGJlIGNoYW5nZWQgYWZ0ZXIgdGhpcyBkYXRlDQogICAgZnVuY3Rpb24gc2V0VG9rZW5QcmljZVByb3Bvc2FsKCAgICAgICAgDQogICAgICAgIHVpbnQgX2luaXRpYWxQcmljZU11bHRpcGxpZXIsIA0KICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLA0KICAgICAgICB1aW50IF9jbG9zaW5nVGltZQ0KICAgICk7DQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBzZXQgYSBmdW5kaW5nLiBDYW4gYmUgcHJpdmF0ZSBvciBwdWJsaWMNCiAgICAvLy8gQHBhcmFtIF9tYWluUGFydG5lciBUaGUgYWRkcmVzcyBvZiB0aGUgc21hcnQgY29udHJhY3QgdG8gbWFuYWdlIGEgcHJpdmF0ZSBmdW5kaW5nDQogICAgLy8vIEBwYXJhbSBfcHVibGljQ3JlYXRpb24gVHJ1ZSBpZiBwdWJsaWMgZnVuZGluZw0KICAgIC8vLyBAcGFyYW0gX2luaXRpYWxQcmljZU11bHRpcGxpZXIgUHJpY2UgbXVsdGlwbGllciB3aXRob3V0IGNvbnNpZGVyaW5nIGFueSBpbmZsYXRpb24gcmF0ZQ0KICAgIC8vLyBAcGFyYW0gX21heEFtb3VudFRvRnVuZCBUaGUgbWF4aW11bSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIGZ1bmRpbmcNCiAgICAvLy8gQHBhcmFtIF9taW51dGVzRnVuZGluZ1BlcmlvZCBQZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgZnVuZGluZw0KICAgIC8vLyBAcGFyYW0gX2luZmxhdGlvblJhdGUgSWYgMCwgdGhlIHRva2VuIHByaWNlIGRvZXNuJ3QgY2hhbmdlIGR1cmluZyB0aGUgZnVuZGluZw0KICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgSW5kZXggb2YgdGhlIGNsaWVudCBwcm9wb3NhbCAobm90IG1hbmRhdG9yeSkNCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nUnVsZXMoDQogICAgICAgIGFkZHJlc3MgX21haW5QYXJ0bmVyLA0KICAgICAgICBib29sIF9wdWJsaWNDcmVhdGlvbiwgDQogICAgICAgIHVpbnQgX2luaXRpYWxQcmljZU11bHRpcGxpZXIsIA0KICAgICAgICB1aW50IF9tYXhBbW91bnRUb0Z1bmQsIA0KICAgICAgICB1aW50IF9taW51dGVzRnVuZGluZ1BlcmlvZCwgDQogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQNCiAgICApIGV4dGVybmFsOw0KICAgIA0KICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIGZvciB0aGUgY3JlYXRpb24gb2Ygc2hhcmVzIG9yIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX3JlY2lwaWVudCBUaGUgcmVjaXBpZW50IGFkZHJlc3Mgb2Ygc2hhcmVzIG9yIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgZnVuZGVkIGFtb3VudCAoaW4gd2VpKQ0KICAgIC8vLyBAcGFyYW0gX3NhbGVEYXRlIEluIGNhc2Ugb2YgcHJlc2FsZSwgdGhlIGRhdGUgb2YgdGhlIHByZXNhbGUNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBjcmVhdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbigNCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCANCiAgICAgICAgdWludCBfYW1vdW50LA0KICAgICAgICB1aW50IF9zYWxlRGF0ZQ0KICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIG1haW4gcGFydG5lciB0byBzZXQgdGhlIHN0YXJ0IHRpbWUgb2YgdGhlIGZ1bmRpbmcNCiAgICAvLy8gQHBhcmFtIF9zdGFydFRpbWUgVGhlIHVuaXggc3RhcnQgZGF0ZSBvZiB0aGUgZnVuZGluZyANCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nU3RhcnRUaW1lKHVpbnQgX3N0YXJ0VGltZSkgZXh0ZXJuYWw7DQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBtYWluIHBhcnRuZXIgdG8gcmV3YXJkIHNoYXJlcyBvciB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCBvZiBzaGFyZXMgb3IgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIFdlaSkgdG8gY2FsY3VsYXRlIHRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGNyZWF0ZQ0KICAgIC8vLyBAcGFyYW0gX2RhdGUgVGhlIHVuaXggZGF0ZSB0byBjb25zaWRlciBmb3IgdGhlIHNoYXJlIG9yIHRva2VuIHByaWNlIGNhbGN1bGF0aW9uDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAgZnVuY3Rpb24gcmV3YXJkVG9rZW4oDQogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgDQogICAgICAgIHVpbnQgX2Ftb3VudCwNCiAgICAgICAgdWludCBfZGF0ZQ0KICAgICAgICApIGV4dGVybmFsOw0KDQogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2xvc2UgdGhlIGFjdHVhbCBmdW5kaW5nDQogICAgZnVuY3Rpb24gY2xvc2VGdW5kaW5nKCkgaW50ZXJuYWw7DQogICAgDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgbWFpbiBwYXJ0bmVyIHRvIHNldCB0aGUgZnVuZGluZyBmdWVsZWQNCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nRnVlbGVkKCkgZXh0ZXJuYWw7DQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBhYmxlIHRoZSB0cmFuc2ZlciBvZiBEYW8gc2hhcmVzIG9yIGNvbnRyYWN0b3IgdG9rZW5zDQogICAgZnVuY3Rpb24gYWJsZVRyYW5zZmVyKCk7DQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBkaXNhYmxlIHRoZSB0cmFuc2ZlciBvZiBEYW8gc2hhcmVzDQogICAgZnVuY3Rpb24gZGlzYWJsZVRyYW5zZmVyKCk7DQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBjbGllbnQgdG8gYmxvY2sgdGhlIHRyYW5zZmVyIG9mIHNoYXJlcyBmcm9tIGFuZCB0byBhIHNoYXJlIGhvbGRlcg0KICAgIC8vLyBAcGFyYW0gX3NoYXJlSG9sZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBzaGFyZSBob2xkZXINCiAgICAvLy8gQHBhcmFtIF9kZWFkTGluZSBXaGVuIHRoZSBhY2NvdW50IHdpbGwgYmUgdW5ibG9ja2VkDQogICAgZnVuY3Rpb24gYmxvY2tUcmFuc2ZlcihhZGRyZXNzIF9zaGFyZUhvbGRlciwgdWludCBfZGVhZExpbmUpIGV4dGVybmFsOw0KDQogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfRnJvbWANCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXINCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIHF1YW50aXR5IG9mIHNoYXJlcyBvciB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tVG8oDQogICAgICAgIGFkZHJlc3MgX2Zyb20sDQogICAgICAgIGFkZHJlc3MgX3RvLCANCiAgICAgICAgdWludDI1NiBfdmFsdWUNCiAgICAgICAgKSBpbnRlcm5hbCByZXR1cm5zIChib29sKTsNCg0KICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmANCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIHF1YW50aXR5IG9mIHNoYXJlcyBvciB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpOw0KDQogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gDQogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyDQogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudA0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKA0KICAgICAgICBhZGRyZXNzIF9mcm9tLCANCiAgICAgICAgYWRkcmVzcyBfdG8sIA0KICAgICAgICB1aW50MjU2IF92YWx1ZQ0KICAgICAgICApIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQoNCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX2Ftb3VudGAgdG9rZW5zIG9uIGl0cyBiZWhhbGYNCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2Zlcg0KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdA0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQoNCiAgICBldmVudCBUb2tlbnNDcmVhdGVkKGFkZHJlc3MgaW5kZXhlZCBTZW5kZXIsIGFkZHJlc3MgaW5kZXhlZCBUb2tlbkhvbGRlciwgdWludCBRdWFudGl0eSk7DQogICAgZXZlbnQgRnVuZGluZ1J1bGVzU2V0KGFkZHJlc3MgaW5kZXhlZCBNYWluUGFydG5lciwgdWludCBpbmRleGVkIEZ1bmRpbmdQcm9wb3NhbElkLCB1aW50IGluZGV4ZWQgU3RhcnRUaW1lLCB1aW50IENsb3NpbmdUaW1lKTsNCiAgICBldmVudCBGdW5kaW5nRnVlbGVkKHVpbnQgaW5kZXhlZCBGdW5kaW5nUHJvcG9zYWxJRCwgdWludCBGdW5kZWRBbW91bnQpOw0KICAgIGV2ZW50IFRyYW5zZmVyQWJsZSgpOw0KICAgIGV2ZW50IFRyYW5zZmVyRGlzYWJsZSgpOw0KDQp9ICAgIA0KDQpjb250cmFjdCBQYXNzVG9rZW5NYW5hZ2VyIGlzIFBhc3NUb2tlbk1hbmFnZXJJbnRlcmZhY2Ugew0KICAgIA0KICAgIGZ1bmN0aW9uIFRvdGFsU3VwcGx5KCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nikgew0KICAgICAgICByZXR1cm4gdG90YWxTdXBwbHk7DQogICAgfQ0KDQogICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7DQogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOw0KICAgICB9DQoNCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7DQogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEZ1bmRlZEFtb3VudCh1aW50IF9wcm9wb3NhbElEKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBmdW5kZWRBbW91bnRbX3Byb3Bvc2FsSURdOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHByaWNlRGl2aXNvcih1aW50IF9zYWxlRGF0ZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICB1aW50IF9kYXRlID0gX3NhbGVEYXRlOw0KICAgICAgICANCiAgICAgICAgaWYgKF9zYWxlRGF0ZSA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgX2RhdGUgPSBGdW5kaW5nUnVsZXNbMF0uY2xvc2luZ1RpbWU7DQogICAgICAgIGlmIChfc2FsZURhdGUgPCBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lKSBfZGF0ZSA9IEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWU7DQoNCiAgICAgICAgcmV0dXJuIDEwMCArIDEwMCpGdW5kaW5nUnVsZXNbMF0uaW5mbGF0aW9uUmF0ZSooX2RhdGUgLSBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lKS8oMTAwKjM2NSBkYXlzKTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gYWN0dWFsUHJpY2VEaXZpc29yKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gcHJpY2VEaXZpc29yKG5vdyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZnVuZGluZ01heEFtb3VudChhZGRyZXNzIF9tYWluUGFydG5lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICANCiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQ0KICAgICAgICAgICAgfHwgbm93IDwgRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZQ0KICAgICAgICAgICAgfHwgX21haW5QYXJ0bmVyICE9IEZ1bmRpbmdSdWxlc1swXS5tYWluUGFydG5lcikgew0KICAgICAgICAgICAgcmV0dXJuIDA7ICAgDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gRnVuZGluZ1J1bGVzWzBdLm1heEFtb3VudFRvRnVuZDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICB9DQoNCiAgICBmdW5jdGlvbiBQYXNzVG9rZW5NYW5hZ2VyKA0KICAgICAgICBhZGRyZXNzIF9jcmVhdG9yLA0KICAgICAgICBhZGRyZXNzIF9jbGllbnQsDQogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudA0KICAgICkgew0KICAgICAgICANCiAgICAgICAgaWYgKF9jcmVhdG9yID09IDAgDQogICAgICAgICAgICB8fCBfY2xpZW50ID09IDAgDQogICAgICAgICAgICB8fCBfY2xpZW50ID09IF9yZWNpcGllbnQgDQogICAgICAgICAgICB8fCBfY2xpZW50ID09IGFkZHJlc3ModGhpcykgDQogICAgICAgICAgICB8fCBfcmVjaXBpZW50ID09IGFkZHJlc3ModGhpcykpIHRocm93Ow0KDQogICAgICAgIGNyZWF0b3IgPSBfY3JlYXRvcjsgDQogICAgICAgIGNsaWVudCA9IF9jbGllbnQ7DQogICAgICAgIHJlY2lwaWVudCA9IF9yZWNpcGllbnQ7DQogICAgICAgIA0KICAgIH0NCiAgIA0KICAgIGZ1bmN0aW9uIGluaXRUb2tlbigNCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsDQogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsDQogICAgICAgIHVpbnQ4IF90b2tlbkRlY2ltYWxzLA0KICAgICAgICBhZGRyZXNzIF9pbml0aWFsU3VwcGx5UmVjaXBpZW50LA0KICAgICAgICB1aW50MjU2IF9pbml0aWFsU3VwcGx5LA0KICAgICAgICBib29sIF90cmFuc2ZlcmFibGUpIHsNCiAgICAgICAgICAgDQogICAgICAgIGlmIChfaW5pdGlhbFN1cHBseVJlY2lwaWVudCA9PSBhZGRyZXNzKHRoaXMpDQogICAgICAgICAgICB8fCBkZWNpbWFscyAhPSAwDQogICAgICAgICAgICB8fCBtc2cuc2VuZGVyICE9IGNyZWF0b3INCiAgICAgICAgICAgIHx8IHRvdGFsU3VwcGx5ICE9IDApIHRocm93Ow0KICAgICAgICAgICAgDQogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOw0KICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7DQogICAgICAgIGRlY2ltYWxzID0gX3Rva2VuRGVjaW1hbHM7DQogICAgICAgICAgDQogICAgICAgIGlmIChfdHJhbnNmZXJhYmxlKSB7DQogICAgICAgICAgICB0cmFuc2ZlcmFibGUgPSB0cnVlOw0KICAgICAgICAgICAgVHJhbnNmZXJBYmxlKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0cmFuc2ZlcmFibGUgPSBmYWxzZTsNCiAgICAgICAgICAgIFRyYW5zZmVyRGlzYWJsZSgpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBiYWxhbmNlc1tfaW5pdGlhbFN1cHBseVJlY2lwaWVudF0gPSBfaW5pdGlhbFN1cHBseTsgDQogICAgICAgIHRvdGFsU3VwcGx5ID0gX2luaXRpYWxTdXBwbHk7DQogICAgICAgIFRva2Vuc0NyZWF0ZWQobXNnLnNlbmRlciwgX2luaXRpYWxTdXBwbHlSZWNpcGllbnQsIF9pbml0aWFsU3VwcGx5KTsNCiAgICAgICAgICAgDQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHNldFRva2VuUHJpY2VQcm9wb3NhbCggICAgICAgIA0KICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLCANCiAgICAgICAgdWludCBfaW5mbGF0aW9uUmF0ZSwNCiAgICAgICAgdWludCBfY2xvc2luZ1RpbWUNCiAgICApIG9ubHlDb250cmFjdG9yIHsNCiAgICAgICAgDQogICAgICAgIGlmIChfY2xvc2luZ1RpbWUgPCBub3cgDQogICAgICAgICAgICB8fCBub3cgPCBGdW5kaW5nUnVsZXNbMV0uY2xvc2luZ1RpbWUpIHRocm93Ow0KICAgICAgICANCiAgICAgICAgRnVuZGluZ1J1bGVzWzFdLmluaXRpYWxQcmljZU11bHRpcGxpZXIgPSBfaW5pdGlhbFByaWNlTXVsdGlwbGllcjsNCiAgICAgICAgRnVuZGluZ1J1bGVzWzFdLmluZmxhdGlvblJhdGUgPSBfaW5mbGF0aW9uUmF0ZTsNCiAgICAgICAgRnVuZGluZ1J1bGVzWzFdLnN0YXJ0VGltZSA9IG5vdzsNCiAgICAgICAgRnVuZGluZ1J1bGVzWzFdLmNsb3NpbmdUaW1lID0gX2Nsb3NpbmdUaW1lOw0KICAgICAgICANCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1J1bGVzKA0KICAgICAgICBhZGRyZXNzIF9tYWluUGFydG5lciwNCiAgICAgICAgYm9vbCBfcHVibGljQ3JlYXRpb24sIA0KICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLA0KICAgICAgICB1aW50IF9tYXhBbW91bnRUb0Z1bmQsIA0KICAgICAgICB1aW50IF9taW51dGVzRnVuZGluZ1BlcmlvZCwgDQogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQNCiAgICApIGV4dGVybmFsIG9ubHlDbGllbnQgew0KDQogICAgICAgIGlmIChub3cgPCBGdW5kaW5nUnVsZXNbMF0uY2xvc2luZ1RpbWUNCiAgICAgICAgICAgIHx8IF9tYWluUGFydG5lciA9PSBhZGRyZXNzKHRoaXMpDQogICAgICAgICAgICB8fCBfbWFpblBhcnRuZXIgPT0gY2xpZW50DQogICAgICAgICAgICB8fCAoIV9wdWJsaWNDcmVhdGlvbiAmJiBfbWFpblBhcnRuZXIgPT0gMCkNCiAgICAgICAgICAgIHx8IChfcHVibGljQ3JlYXRpb24gJiYgX21haW5QYXJ0bmVyICE9IDApDQogICAgICAgICAgICB8fCAocmVjaXBpZW50ID09IDAgJiYgX2luaXRpYWxQcmljZU11bHRpcGxpZXIgPT0gMCkNCiAgICAgICAgICAgIHx8IChyZWNpcGllbnQgIT0gMCANCiAgICAgICAgICAgICAgICAmJiAoRnVuZGluZ1J1bGVzWzFdLmluaXRpYWxQcmljZU11bHRpcGxpZXIgPT0gMA0KICAgICAgICAgICAgICAgICAgICB8fCBfaW5mbGF0aW9uUmF0ZSA8IEZ1bmRpbmdSdWxlc1sxXS5pbmZsYXRpb25SYXRlDQogICAgICAgICAgICAgICAgICAgIHx8IG5vdyA8IEZ1bmRpbmdSdWxlc1sxXS5zdGFydFRpbWUNCiAgICAgICAgICAgICAgICAgICAgfHwgRnVuZGluZ1J1bGVzWzFdLmNsb3NpbmdUaW1lIDwgbm93ICsgKF9taW51dGVzRnVuZGluZ1BlcmlvZCAqIDEgbWludXRlcykpKQ0KICAgICAgICAgICAgfHwgX21heEFtb3VudFRvRnVuZCA9PSAwDQogICAgICAgICAgICB8fCBfbWludXRlc0Z1bmRpbmdQZXJpb2QgPT0gMA0KICAgICAgICAgICAgKSB0aHJvdzsNCg0KICAgICAgICBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lID0gbm93Ow0KICAgICAgICBGdW5kaW5nUnVsZXNbMF0uY2xvc2luZ1RpbWUgPSBub3cgKyBfbWludXRlc0Z1bmRpbmdQZXJpb2QgKiAxIG1pbnV0ZXM7DQogICAgICAgICAgICANCiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLm1haW5QYXJ0bmVyID0gX21haW5QYXJ0bmVyOw0KICAgICAgICBGdW5kaW5nUnVsZXNbMF0ucHVibGljQ3JlYXRpb24gPSBfcHVibGljQ3JlYXRpb247DQogICAgICAgIA0KICAgICAgICBpZiAocmVjaXBpZW50ID09IDApIEZ1bmRpbmdSdWxlc1swXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gX2luaXRpYWxQcmljZU11bHRpcGxpZXI7DQogICAgICAgIGVsc2UgRnVuZGluZ1J1bGVzWzBdLmluaXRpYWxQcmljZU11bHRpcGxpZXIgPSBGdW5kaW5nUnVsZXNbMV0uaW5pdGlhbFByaWNlTXVsdGlwbGllcjsNCiAgICAgICAgDQogICAgICAgIGlmIChyZWNpcGllbnQgPT0gMCkgRnVuZGluZ1J1bGVzWzBdLmluZmxhdGlvblJhdGUgPSBfaW5mbGF0aW9uUmF0ZTsNCiAgICAgICAgZWxzZSBGdW5kaW5nUnVsZXNbMF0uaW5mbGF0aW9uUmF0ZSA9IEZ1bmRpbmdSdWxlc1sxXS5pbmZsYXRpb25SYXRlOw0KICAgICAgICANCiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLmZ1bmRlZEFtb3VudCA9IDA7DQogICAgICAgIEZ1bmRpbmdSdWxlc1swXS5tYXhBbW91bnRUb0Z1bmQgPSBfbWF4QW1vdW50VG9GdW5kOw0KDQogICAgICAgIEZ1bmRpbmdSdWxlc1swXS5wcm9wb3NhbElEID0gX3Byb3Bvc2FsSUQ7DQoNCiAgICAgICAgRnVuZGluZ1J1bGVzU2V0KF9tYWluUGFydG5lciwgX3Byb3Bvc2FsSUQsIEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWUsIEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSk7DQogICAgICAgICAgICANCiAgICB9IA0KICAgIA0KICAgIGZ1bmN0aW9uIGNyZWF0ZVRva2VuKA0KICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQsIA0KICAgICAgICB1aW50IF9hbW91bnQsDQogICAgICAgIHVpbnQgX3NhbGVEYXRlDQogICAgKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCg0KICAgICAgICBpZiAobm93ID4gRnVuZGluZ1J1bGVzWzBdLmNsb3NpbmdUaW1lDQogICAgICAgICAgICB8fCBub3cgPCBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lDQogICAgICAgICAgICB8fF9zYWxlRGF0ZSA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQ0KICAgICAgICAgICAgfHwgX3NhbGVEYXRlIDwgRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZQ0KICAgICAgICAgICAgfHwgRnVuZGluZ1J1bGVzWzBdLmZ1bmRlZEFtb3VudCArIF9hbW91bnQgPiBGdW5kaW5nUnVsZXNbMF0ubWF4QW1vdW50VG9GdW5kKSByZXR1cm47DQoNCiAgICAgICAgdWludCBfYSA9IF9hbW91bnQqRnVuZGluZ1J1bGVzWzBdLmluaXRpYWxQcmljZU11bHRpcGxpZXI7DQogICAgICAgIHVpbnQgX211bHRpcGxpZXIgPSAxMDAqX2E7DQogICAgICAgIHVpbnQgX3F1YW50aXR5ID0gX211bHRpcGxpZXIvcHJpY2VEaXZpc29yKF9zYWxlRGF0ZSk7DQogICAgICAgIGlmIChfYS9fYW1vdW50ICE9IEZ1bmRpbmdSdWxlc1swXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyDQogICAgICAgICAgICB8fCBfbXVsdGlwbGllci8xMDAgIT0gX2ENCiAgICAgICAgICAgIHx8IHRvdGFsU3VwcGx5ICsgX3F1YW50aXR5IDw9IHRvdGFsU3VwcGx5IA0KICAgICAgICAgICAgfHwgdG90YWxTdXBwbHkgKyBfcXVhbnRpdHkgPD0gX3F1YW50aXR5KSByZXR1cm47DQoNCiAgICAgICAgYmFsYW5jZXNbX3JlY2lwaWVudF0gKz0gX3F1YW50aXR5Ow0KICAgICAgICB0b3RhbFN1cHBseSArPSBfcXVhbnRpdHk7DQogICAgICAgIEZ1bmRpbmdSdWxlc1swXS5mdW5kZWRBbW91bnQgKz0gX2Ftb3VudDsNCg0KICAgICAgICBUb2tlbnNDcmVhdGVkKG1zZy5zZW5kZXIsIF9yZWNpcGllbnQsIF9xdWFudGl0eSk7DQogICAgICAgIA0KICAgICAgICBpZiAoRnVuZGluZ1J1bGVzWzBdLmZ1bmRlZEFtb3VudCA9PSBGdW5kaW5nUnVsZXNbMF0ubWF4QW1vdW50VG9GdW5kKSBjbG9zZUZ1bmRpbmcoKTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiB0cnVlOw0KDQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1N0YXJ0VGltZSh1aW50IF9zdGFydFRpbWUpIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7DQogICAgICAgIGlmIChub3cgPiBGdW5kaW5nUnVsZXNbMF0uY2xvc2luZ1RpbWUpIHRocm93Ow0KICAgICAgICBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gcmV3YXJkVG9rZW4oDQogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgDQogICAgICAgIHVpbnQgX2Ftb3VudCwNCiAgICAgICAgdWludCBfZGF0ZQ0KICAgICAgICApIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7DQoNCiAgICAgICAgdWludCBfc2FsZURhdGU7DQogICAgICAgIGlmIChfZGF0ZSA9PSAwKSBfc2FsZURhdGUgPSBub3c7IGVsc2UgX3NhbGVEYXRlID0gX2RhdGU7DQoNCiAgICAgICAgaWYgKCFjcmVhdGVUb2tlbihfcmVjaXBpZW50LCBfYW1vdW50LCBfc2FsZURhdGUpKSB0aHJvdzsNCg0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNsb3NlRnVuZGluZygpIGludGVybmFsIHsNCiAgICAgICAgaWYgKHJlY2lwaWVudCA9PSAwKSBmdW5kZWRBbW91bnRbRnVuZGluZ1J1bGVzWzBdLnByb3Bvc2FsSURdID0gRnVuZGluZ1J1bGVzWzBdLmZ1bmRlZEFtb3VudDsNCiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLmNsb3NpbmdUaW1lID0gbm93Ow0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nRnVlbGVkKCkgZXh0ZXJuYWwgb25seU1haW5QYXJ0bmVyIHsNCiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgdGhyb3c7DQogICAgICAgIGNsb3NlRnVuZGluZygpOw0KICAgICAgICBpZiAocmVjaXBpZW50ID09IDApIEZ1bmRpbmdGdWVsZWQoRnVuZGluZ1J1bGVzWzBdLnByb3Bvc2FsSUQsIEZ1bmRpbmdSdWxlc1swXS5mdW5kZWRBbW91bnQpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBhYmxlVHJhbnNmZXIoKSBvbmx5Q2xpZW50IHsNCiAgICAgICAgaWYgKCF0cmFuc2ZlcmFibGUpIHsNCiAgICAgICAgICAgIHRyYW5zZmVyYWJsZSA9IHRydWU7DQogICAgICAgICAgICBUcmFuc2ZlckFibGUoKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcigpIG9ubHlDbGllbnQgew0KICAgICAgICBpZiAodHJhbnNmZXJhYmxlKSB7DQogICAgICAgICAgICB0cmFuc2ZlcmFibGUgPSBmYWxzZTsNCiAgICAgICAgICAgIFRyYW5zZmVyRGlzYWJsZSgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGJsb2NrVHJhbnNmZXIoYWRkcmVzcyBfc2hhcmVIb2xkZXIsIHVpbnQgX2RlYWRMaW5lKSBleHRlcm5hbCBvbmx5Q2xpZW50IG9ubHlEYW8gew0KICAgICAgICBpZiAoX2RlYWRMaW5lID4gYmxvY2tlZERlYWRMaW5lW19zaGFyZUhvbGRlcl0pIHsNCiAgICAgICAgICAgIGJsb2NrZWREZWFkTGluZVtfc2hhcmVIb2xkZXJdID0gX2RlYWRMaW5lOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbVRvKA0KICAgICAgICBhZGRyZXNzIF9mcm9tLA0KICAgICAgICBhZGRyZXNzIF90bywgDQogICAgICAgIHVpbnQyNTYgX3ZhbHVlDQogICAgICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgeyAgDQoNCiAgICAgICAgaWYgKHRyYW5zZmVyYWJsZQ0KICAgICAgICAgICAgJiYgbm93ID4gYmxvY2tlZERlYWRMaW5lW19mcm9tXQ0KICAgICAgICAgICAgJiYgbm93ID4gYmxvY2tlZERlYWRMaW5lW190b10NCiAgICAgICAgICAgICYmIF90byAhPSBhZGRyZXNzKHRoaXMpDQogICAgICAgICAgICAmJiBiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlDQogICAgICAgICAgICAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXQ0KICAgICAgICAgICAgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+PSBfdmFsdWUNCiAgICAgICAgKSB7DQogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHsgIA0KICAgICAgICBpZiAoIXRyYW5zZmVyRnJvbVRvKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKSkgdGhyb3c7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKA0KICAgICAgICBhZGRyZXNzIF9mcm9tLCANCiAgICAgICAgYWRkcmVzcyBfdG8sIA0KICAgICAgICB1aW50MjU2IF92YWx1ZQ0KICAgICAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgeyANCiAgICAgICAgDQogICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF92YWx1ZQ0KICAgICAgICAgICAgfHwgIXRyYW5zZmVyRnJvbVRvKF9mcm9tLCBfdG8sIF92YWx1ZSkpIHRocm93Ow0KICAgICAgICAgICAgDQogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsNCg0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQp9ICAgIA0KICANCg0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMjsNCg0KLyoNCiAqDQogKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBQYXNzIERBTy4NCiAqDQogKiBUaGUgTWFuYWdlciBzbWFydCBjb250cmFjdCBpcyB1c2VkIGZvciB0aGUgbWFuYWdlbWVudCBvZiBhY2NvdW50cyBhbmQgdG9rZW5zLg0KICogQWxsb3dzIHRvIHJlY2VpdmUgb3Igd2l0aGRyYXcgZXRoZXJzIGFuZCB0byBidXkgRGFvIHNoYXJlcy4NCiAqIFRoZSBjb250cmFjdCBkZXJpdmVzIHRvIHRoZSBUb2tlbiBNYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IGZvciB0aGUgbWFuYWdlbWVudCBvZiB0b2tlbnMuDQogKg0KICogUmVjaXBpZW50IGlzIDAgZm9yIHRoZSBEYW8gYWNjb3VudCBtYW5hZ2VyIGFuZCB0aGUgYWRkcmVzcyBvZg0KICogY29udHJhY3RvcidzIHJlY2lwaWVudCBmb3IgdGhlIGNvbnRyYWN0b3JzJ3MgbWFoYWdlcnMuDQogKg0KKi8NCg0KLy8vIEB0aXRsZSBNYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IG9mIHRoZSBQYXNzIERlY2VudHJhbGl6ZWQgQXV0b25vbW91cyBPcmdhbmlzYXRpb24NCmNvbnRyYWN0IFBhc3NNYW5hZ2VySW50ZXJmYWNlIGlzIFBhc3NUb2tlbk1hbmFnZXJJbnRlcmZhY2Ugew0KDQogICAgc3RydWN0IHByb3Bvc2FsIHsNCiAgICAgICAgLy8gQW1vdW50IChpbiB3ZWkpIG9mIHRoZSBwcm9wb3NhbA0KICAgICAgICB1aW50IGFtb3VudDsNCiAgICAgICAgLy8gQSBkZXNjcmlwdGlvbiBvZiB0aGUgcHJvcG9zYWwNCiAgICAgICAgc3RyaW5nIGRlc2NyaXB0aW9uOw0KICAgICAgICAvLyBUaGUgaGFzaCBvZiB0aGUgcHJvcG9zYWwncyBkb2N1bWVudA0KICAgICAgICBieXRlczMyIGhhc2hPZlRoZURvY3VtZW50Ow0KICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZGF0ZSB3aGVuIHRoZSBwcm9wb3NhbCB3YXMgY3JlYXRlZA0KICAgICAgICB1aW50IGRhdGVPZlByb3Bvc2FsOw0KICAgICAgICAvLyBUaGUgc3VtIGFtb3VudCAoaW4gd2VpKSBvcmRlcmVkIGZvciB0aGlzIHByb3Bvc2FsIA0KICAgICAgICB1aW50IG9yZGVyQW1vdW50Ow0KICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCBvcmRlciBmb3IgdGhlIGFwcHJvdmVkIHByb3Bvc2FsDQogICAgICAgIHVpbnQgZGF0ZU9mT3JkZXI7DQogICAgfQ0KICAgICAgICANCiAgICAvLyBQcm9wb3NhbHMgdG8gd29yayBmb3IgdGhlIGNsaWVudA0KICAgIHByb3Bvc2FsW10gcHVibGljIHByb3Bvc2FsczsNCiAgICANCiAgICAvLy8gQGRldiBUaGUgY29uc3RydWN0b3IgZnVuY3Rpb24NCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yIFRoZSBhZGRyZXNzIG9mIHRoZSBjcmVhdG9yDQogICAgLy8vIEBwYXJhbSBfY2xpZW50IFRoZSBhZGRyZXNzIG9mIHRoZSBEYW8NCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudC4gMCBmb3IgdGhlIERhbw0KICAgIC8vZnVuY3Rpb24gUGFzc01hbmFnZXIoDQogICAgICAgIC8vYWRkcmVzcyBfY3JlYXRvciwNCiAgICAgICAgLy9hZGRyZXNzIF9jbGllbnQsDQogICAgICAgIC8vYWRkcmVzcyBfcmVjaXBpZW50DQogICAgLy8pIFBhc3NUb2tlbk1hbmFnZXIoDQogICAgICAgIC8vX2NyZWF0b3IsDQogICAgICAgIC8vX2NsaWVudCwNCiAgICAgICAgLy9fcmVjaXBpZW50KTsNCg0KICAgIC8vLyBAbm90aWNlIEZhbGxiYWNrIGZ1bmN0aW9uIHRvIGFsbG93IHNlbmRpbmcgZXRoZXJzIHRvIHRoaXMgc21hcnQgY29udHJhY3QNCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlOw0KICAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHVwZGF0ZSB0aGUgcmVjaXBlbnQgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gX25ld1JlY2lwaWVudCBUaGUgYWRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICBmdW5jdGlvbiB1cGRhdGVSZWNpcGllbnQoYWRkcmVzcyBfbmV3UmVjaXBpZW50KTsNCg0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGJ1eSBEYW8gc2hhcmVzIGFjY29yZGluZyB0byB0aGUgZnVuZGluZyBydWxlcyANCiAgICAvLy8gd2l0aCBgbXNnLnNlbmRlcmAgYXMgdGhlIGJlbmVmaWNpYXJ5DQogICAgZnVuY3Rpb24gYnV5U2hhcmVzKCkgcGF5YWJsZTsNCiAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBidXkgRGFvIHNoYXJlcyBhY2NvcmRpbmcgdG8gdGhlIGZ1bmRpbmcgcnVsZXMgDQogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBiZW5lZmljaWFyeSBvZiB0aGUgY3JlYXRlZCBzaGFyZXMNCiAgICBmdW5jdGlvbiBidXlTaGFyZXNGb3IoYWRkcmVzcyBfcmVjaXBpZW50KSBwYXlhYmxlOw0KDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gbWFrZSBhIHByb3Bvc2FsIHRvIHdvcmsgZm9yIHRoZSBjbGllbnQNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCAoaW4gd2VpKSBvZiB0aGUgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9kZXNjcmlwdGlvbiBTdHJpbmcgZGVzY3JpYmluZyB0aGUgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9oYXNoT2ZUaGVEb2N1bWVudCBUaGUgaGFzaCBvZiB0aGUgcHJvcG9zYWwgZG9jdW1lbnQNCiAgICAvLy8gQHJldHVybiBUaGUgaW5kZXggb2YgdGhlIGNvbnRyYWN0b3IgcHJvcG9zYWwNCiAgICBmdW5jdGlvbiBuZXdQcm9wb3NhbCgNCiAgICAgICAgdWludCBfYW1vdW50LA0KICAgICAgICBzdHJpbmcgX2Rlc2NyaXB0aW9uLCANCiAgICAgICAgYnl0ZXMzMiBfaGFzaE9mVGhlRG9jdW1lbnQNCiAgICApIHJldHVybnMgKHVpbnQpOw0KICAgIA0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIGNsaWVudCB0byBvcmRlciBhY2NvcmRpbmcgdG8gdGhlIGNvbnRyYWN0b3IgcHJvcG9zYWwNCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIFRoZSBpbmRleCBvZiB0aGUgY29udHJhY3RvciBwcm9wb3NhbA0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIG9mIHRoZSBvcmRlcg0KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIG9yZGVyIHdhcyBtYWRlIG9yIG5vdA0KICAgIGZ1bmN0aW9uIG9yZGVyKA0KICAgICAgICB1aW50IF9wcm9wb3NhbElELA0KICAgICAgICB1aW50IF9hbW91bnQNCiAgICApIGV4dGVybmFsIHJldHVybnMgKGJvb2wpIDsNCiAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBjbGllbnQgdG8gc2VuZCBldGhlcnMgZnJvbSB0aGUgRGFvIG1hbmFnZXINCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIGFkZHJlc3MgdG8gc2VuZCB0bw0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIHRvIHNlbmQNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiBzZW5kVG8oDQogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgDQogICAgICAgIHVpbnQgX2Ftb3VudA0KICAgICkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBhbGxvdyBjb250cmFjdG9ycyB0byB3aXRoZHJhdyBldGhlcnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCAoaW4gd2VpKSB0byB3aXRoZHJhdw0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgX2Ftb3VudCk7DQogICAgDQogICAgZXZlbnQgUHJvcG9zYWxBZGRlZCh1aW50IGluZGV4ZWQgUHJvcG9zYWxJRCwgdWludCBBbW91bnQsIHN0cmluZyBEZXNjcmlwdGlvbik7DQogICAgZXZlbnQgT3JkZXIodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgQW1vdW50KTsNCiAgICBldmVudCBXaXRoZGF3YWwoYWRkcmVzcyBpbmRleGVkIFJlY2lwaWVudCwgdWludCBBbW91bnQpOw0KDQp9ICAgIA0KDQpjb250cmFjdCBQYXNzTWFuYWdlciBpcyBQYXNzTWFuYWdlckludGVyZmFjZSwgUGFzc1Rva2VuTWFuYWdlciB7DQoNCiAgICBmdW5jdGlvbiBQYXNzTWFuYWdlcigNCiAgICAgICAgYWRkcmVzcyBfY3JlYXRvciwNCiAgICAgICAgYWRkcmVzcyBfY2xpZW50LA0KICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQNCiAgICApIFBhc3NUb2tlbk1hbmFnZXIoDQogICAgICAgIF9jcmVhdG9yLA0KICAgICAgICBfY2xpZW50LA0KICAgICAgICBfcmVjaXBpZW50DQogICAgICAgICkgew0KICAgICAgICBwcm9wb3NhbHMubGVuZ3RoID0gMTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHt9DQoNCiAgICBmdW5jdGlvbiB1cGRhdGVSZWNpcGllbnQoYWRkcmVzcyBfbmV3UmVjaXBpZW50KSBvbmx5Q29udHJhY3RvciB7DQoNCiAgICAgICAgaWYgKF9uZXdSZWNpcGllbnQgPT0gMCANCiAgICAgICAgICAgIHx8IF9uZXdSZWNpcGllbnQgPT0gY2xpZW50KSB0aHJvdzsNCg0KICAgICAgICByZWNpcGllbnQgPSBfbmV3UmVjaXBpZW50Ow0KICAgIH0gDQoNCiAgICBmdW5jdGlvbiBidXlTaGFyZXMoKSBwYXlhYmxlIHsNCiAgICAgICAgYnV5U2hhcmVzRm9yKG1zZy5zZW5kZXIpOw0KICAgIH0gDQogICAgDQogICAgZnVuY3Rpb24gYnV5U2hhcmVzRm9yKGFkZHJlc3MgX3JlY2lwaWVudCkgcGF5YWJsZSBvbmx5RGFvIHsNCiAgICAgICAgDQogICAgICAgIGlmICghRnVuZGluZ1J1bGVzWzBdLnB1YmxpY0NyZWF0aW9uIA0KICAgICAgICAgICAgfHwgIWNyZWF0ZVRva2VuKF9yZWNpcGllbnQsIG1zZy52YWx1ZSwgbm93KSkgdGhyb3c7DQoNCiAgICB9DQogICANCiAgICBmdW5jdGlvbiBuZXdQcm9wb3NhbCgNCiAgICAgICAgdWludCBfYW1vdW50LA0KICAgICAgICBzdHJpbmcgX2Rlc2NyaXB0aW9uLCANCiAgICAgICAgYnl0ZXMzMiBfaGFzaE9mVGhlRG9jdW1lbnQNCiAgICApIG9ubHlDb250cmFjdG9yIHJldHVybnMgKHVpbnQpIHsNCg0KICAgICAgICB1aW50IF9wcm9wb3NhbElEID0gcHJvcG9zYWxzLmxlbmd0aCsrOw0KICAgICAgICBwcm9wb3NhbCBjID0gcHJvcG9zYWxzW19wcm9wb3NhbElEXTsNCg0KICAgICAgICBjLmFtb3VudCA9IF9hbW91bnQ7DQogICAgICAgIGMuZGVzY3JpcHRpb24gPSBfZGVzY3JpcHRpb247DQogICAgICAgIGMuaGFzaE9mVGhlRG9jdW1lbnQgPSBfaGFzaE9mVGhlRG9jdW1lbnQ7IA0KICAgICAgICBjLmRhdGVPZlByb3Bvc2FsID0gbm93Ow0KICAgICAgICANCiAgICAgICAgUHJvcG9zYWxBZGRlZChfcHJvcG9zYWxJRCwgYy5hbW91bnQsIGMuZGVzY3JpcHRpb24pOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIF9wcm9wb3NhbElEOw0KICAgICAgICANCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gb3JkZXIoDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQsDQogICAgICAgIHVpbnQgX29yZGVyQW1vdW50DQogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IHJldHVybnMgKGJvb2wpIHsNCiAgICANCiAgICAgICAgcHJvcG9zYWwgYyA9IHByb3Bvc2Fsc1tfcHJvcG9zYWxJRF07DQogICAgICAgIA0KICAgICAgICB1aW50IF9zdW0gPSBjLm9yZGVyQW1vdW50ICsgX29yZGVyQW1vdW50Ow0KICAgICAgICBpZiAoX3N1bSA+IGMuYW1vdW50DQogICAgICAgICAgICB8fCBfc3VtIDwgYy5vcmRlckFtb3VudA0KICAgICAgICAgICAgfHwgX3N1bSA8IF9vcmRlckFtb3VudCkgcmV0dXJuOyANCg0KICAgICAgICBjLm9yZGVyQW1vdW50ID0gX3N1bTsNCiAgICAgICAgYy5kYXRlT2ZPcmRlciA9IG5vdzsNCiAgICAgICAgDQogICAgICAgIE9yZGVyKF9wcm9wb3NhbElELCBfb3JkZXJBbW91bnQpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRydWU7DQoNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZW5kVG8oDQogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwNCiAgICAgICAgdWludCBfYW1vdW50DQogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IG9ubHlEYW8gcmV0dXJucyAoYm9vbCkgew0KICAgIA0KICAgICAgICBpZiAoX3JlY2lwaWVudC5zZW5kKF9hbW91bnQpKSByZXR1cm4gdHJ1ZTsNCiAgICAgICAgZWxzZSByZXR1cm4gZmFsc2U7DQoNCiAgICB9DQogICANCiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50IF9hbW91bnQpIG9ubHlDb250cmFjdG9yIHsNCiAgICAgICAgaWYgKCFyZWNpcGllbnQuc2VuZChfYW1vdW50KSkgdGhyb3c7DQogICAgICAgIFdpdGhkYXdhbChyZWNpcGllbnQsIF9hbW91bnQpOw0KICAgIH0NCiAgICANCn0gICAgDQoNCmNvbnRyYWN0IFBhc3NNYW5hZ2VyQ3JlYXRvciB7DQogICAgZXZlbnQgTmV3UGFzc01hbmFnZXIoYWRkcmVzcyBDcmVhdG9yLCBhZGRyZXNzIENsaWVudCwgYWRkcmVzcyBSZWNpcGllbnQsIGFkZHJlc3MgUGFzc01hbmFnZXIpOw0KICAgIGZ1bmN0aW9uIGNyZWF0ZU1hbmFnZXIoDQogICAgICAgIGFkZHJlc3MgX2NsaWVudCwNCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50DQogICAgICAgICkgcmV0dXJucyAoUGFzc01hbmFnZXIpIHsNCiAgICAgICAgUGFzc01hbmFnZXIgX3Bhc3NNYW5hZ2VyID0gbmV3IFBhc3NNYW5hZ2VyKA0KICAgICAgICAgICAgbXNnLnNlbmRlciwNCiAgICAgICAgICAgIF9jbGllbnQsDQogICAgICAgICAgICBfcmVjaXBpZW50DQogICAgICAgICk7DQogICAgICAgIE5ld1Bhc3NNYW5hZ2VyKG1zZy5zZW5kZXIsIF9jbGllbnQsIF9yZWNpcGllbnQsIF9wYXNzTWFuYWdlcik7DQogICAgICAgIHJldHVybiBfcGFzc01hbmFnZXI7DQogICAgfQ0KfQ0KDQpwcmFnbWEgc29saWRpdHkgXjAuNC4yOw0KDQovKg0KVGhpcyBmaWxlIGlzIHBhcnQgb2YgUGFzcyBEQU8uDQoNClBhc3MgREFPIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uDQoNClBhc3MgREFPIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQpidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZg0KTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBsZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KYWxvbmcgd2l0aCBQYXNzIERBTy4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4NCiovDQoNCi8qDQpTbWFydCBjb250cmFjdCBmb3IgYSBEZWNlbnRyYWxpemVkIEF1dG9ub21vdXMgT3JnYW5pemF0aW9uIChEQU8pDQp0byBhdXRvbWF0ZSBvcmdhbml6YXRpb25hbCBnb3Zlcm5hbmNlIGFuZCBkZWNpc2lvbi1tYWtpbmcuDQoqLw0KDQovLy8gQHRpdGxlIFBhc3MgRGVjZW50cmFsaXplZCBBdXRvbm9tb3VzIE9yZ2FuaXNhdGlvbg0KY29udHJhY3QgUGFzc0Rhb0ludGVyZmFjZSB7DQoNCiAgICBzdHJ1Y3QgQm9hcmRNZWV0aW5nIHsgICAgICAgIA0KICAgICAgICAvLyBBZGRyZXNzIG9mIHRoZSBjcmVhdG9yIG9mIHRoZSBib2FyZCBtZWV0aW5nIGZvciBhIHByb3Bvc2FsDQogICAgICAgIGFkZHJlc3MgY3JlYXRvcjsgIA0KICAgICAgICAvLyBJbmRleCB0byBpZGVudGlmeSB0aGUgcHJvcG9zYWwgdG8gcGF5IGEgY29udHJhY3RvciBvciBmdW5kIHRoZSBEYW8NCiAgICAgICAgdWludCBwcm9wb3NhbElEOw0KICAgICAgICAvLyBJbmRleCB0byBpZGVudGlmeSB0aGUgcHJvcG9zYWwgdG8gdXBkYXRlIHRoZSBEYW8gcnVsZXMgDQogICAgICAgIHVpbnQgZGFvUnVsZXNQcm9wb3NhbElEOyANCiAgICAgICAgLy8gdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBlbmQgb2YgdGhlIHNldCBwZXJpb2Qgb2YgYSBwcm9wb3NhbCBiZWZvcmUgdGhlIGJvYXJkIG1lZXRpbmcgDQogICAgICAgIHVpbnQgc2V0RGVhZGxpbmU7DQogICAgICAgIC8vIEZlZXMgKGluIHdlaSkgcGFpZCBieSB0aGUgY3JlYXRvciBvZiB0aGUgYm9hcmQgbWVldGluZw0KICAgICAgICB1aW50IGZlZXM7DQogICAgICAgIC8vIFRvdGFsIG9mIGZlZXMgKGluIHdlaSkgcmV3YXJkZWQgdG8gdGhlIHZvdGVycyBvciB0byB0aGUgRGFvIGFjY291bnQgbWFuYWdlciBmb3IgdGhlIGJhbGFuY2UNCiAgICAgICAgdWludCB0b3RhbFJld2FyZGVkQW1vdW50Ow0KICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZW5kIG9mIHRoZSB2b3RpbmcgcGVyaW9kDQogICAgICAgIHVpbnQgdm90aW5nRGVhZGxpbmU7DQogICAgICAgIC8vIFRydWUgaWYgdGhlIHByb3Bvc2FsJ3Mgdm90ZXMgaGF2ZSB5ZXQgdG8gYmUgY291bnRlZCwgb3RoZXJ3aXNlIEZhbHNlDQogICAgICAgIGJvb2wgb3BlbjsgDQogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBkYXRlIG9mIHRoZSBleGVjdXRpb24gb2YgdGhlIGFwcHJvdmVkIHByb3Bvc2FsDQogICAgICAgIHVpbnQgZGF0ZU9mRXhlY3V0aW9uOw0KICAgICAgICAvLyBOdW1iZXIgb2Ygc2hhcmVzIGluIGZhdm9yIG9mIHRoZSBwcm9wb3NhbA0KICAgICAgICB1aW50IHllYTsgDQogICAgICAgIC8vIE51bWJlciBvZiBzaGFyZXMgb3Bwb3NlZCB0byB0aGUgcHJvcG9zYWwNCiAgICAgICAgdWludCBuYXk7IA0KICAgICAgICAvLyBtYXBwaW5nIHRvIGluZGljYXRlIGlmIGEgc2hhcmVob2xkZXIgaGFzIHZvdGVkDQogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgaGFzVm90ZWQ7ICANCiAgICB9DQoNCiAgICBzdHJ1Y3QgUHJvcG9zYWwgew0KICAgICAgICAvLyBJbmRleCB0byBpZGVudGlmeSB0aGUgYm9hcmQgbWVldGluZyBvZiB0aGUgcHJvcG9zYWwNCiAgICAgICAgdWludCBib2FyZE1lZXRpbmdJRDsNCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0b3IgbWFuYWdlciBzbWFydCBjb250cmFjdA0KICAgICAgICBQYXNzTWFuYWdlciBjb250cmFjdG9yTWFuYWdlcjsNCiAgICAgICAgLy8gVGhlIGluZGV4IG9mIHRoZSBjb250cmFjdG9yIHByb3Bvc2FsDQogICAgICAgIHVpbnQgY29udHJhY3RvclByb3Bvc2FsSUQ7DQogICAgICAgIC8vIFRoZSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIHByb3Bvc2FsDQogICAgICAgIHVpbnQgYW1vdW50OyANCiAgICAgICAgLy8gVHJ1ZSBpZiB0aGUgcHJvcG9zYWwgZm9yZXNlZXMgYSBjb250cmFjdG9yIHRva2VuIGNyZWF0aW9uDQogICAgICAgIGJvb2wgdG9rZW5DcmVhdGlvbjsNCiAgICAgICAgLy8gVHJ1ZSBpZiBwdWJsaWMgZnVuZGluZyB3aXRob3V0IGEgbWFpbiBwYXJ0bmVyDQogICAgICAgIGJvb2wgcHVibGljU2hhcmVDcmVhdGlvbjsgDQogICAgICAgIC8vIFRoZSBhZGRyZXNzIHdoaWNoIHNldHMgcGFydG5lcnMgYW5kIG1hbmFnZXMgdGhlIGZ1bmRpbmcgaW4gY2FzZSBvZiBwcml2YXRlIGZ1bmRpbmcNCiAgICAgICAgYWRkcmVzcyBtYWluUGFydG5lcjsNCiAgICAgICAgLy8gVGhlIGluaXRpYWwgcHJpY2UgbXVsdGlwbGllciBvZiBEYW8gc2hhcmVzIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGZ1bmRpbmcNCiAgICAgICAgdWludCBpbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXI7IA0KICAgICAgICAvLyBUaGUgaW5mbGF0aW9uIHJhdGUgdG8gY2FsY3VsYXRlIHRoZSBhY3R1YWwgY29udHJhY3RvciBzaGFyZSBwcmljZQ0KICAgICAgICB1aW50IGluZmxhdGlvblJhdGU7DQogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBzdGFydCB0aW1lIG9mIHRoZSBmdW5kaW5nDQogICAgICAgIHVpbnQgbWludXRlc0Z1bmRpbmdQZXJpb2Q7DQogICAgICAgIC8vIFRydWUgaWYgdGhlIHByb3Bvc2FsIGlzIGNsb3NlZA0KICAgICAgICBib29sIG9wZW47IA0KICAgIH0NCg0KICAgIHN0cnVjdCBSdWxlcyB7DQogICAgICAgIC8vIEluZGV4IHRvIGlkZW50aWZ5IHRoZSBib2FyZCBtZWV0aW5nIHRoYXQgZGVjaWRlcyB0byBhcHBseSBvciBub3QgdGhlIERhbyBydWxlcw0KICAgICAgICB1aW50IGJvYXJkTWVldGluZ0lEOyAgDQogICAgICAgIC8vIFRoZSBxdW9ydW0gbmVlZGVkIGZvciBlYWNoIHByb3Bvc2FsIGlzIGNhbGN1bGF0ZWQgYnkgdG90YWxTdXBwbHkgLyBtaW5RdW9ydW1EaXZpc29yDQogICAgICAgIHVpbnQgbWluUXVvcnVtRGl2aXNvcjsgIA0KICAgICAgICAvLyBNaW5pbXVtIGZlZXMgKGluIHdlaSkgdG8gY3JlYXRlIGEgcHJvcG9zYWwNCiAgICAgICAgdWludCBtaW5Cb2FyZE1lZXRpbmdGZWVzOyANCiAgICAgICAgLy8gUGVyaW9kIGluIG1pbnV0ZXMgdG8gY29uc2lkZXIgb3Igc2V0IGEgcHJvcG9zYWwgYmVmb3JlIHRoZSB2b3RpbmcgcHJvY2VkdXJlDQogICAgICAgIHVpbnQgbWludXRlc1NldFByb3Bvc2FsUGVyaW9kOyANCiAgICAgICAgLy8gVGhlIG1pbmltdW0gZGViYXRlIHBlcmlvZCBpbiBtaW51dGVzIHRoYXQgYSBnZW5lcmljIHByb3Bvc2FsIGNhbiBoYXZlDQogICAgICAgIHVpbnQgbWluTWludXRlc0RlYmF0ZVBlcmlvZDsNCiAgICAgICAgLy8gVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgcmV3YXJkIG9mIGZlZXMgdG8gdm90ZXJzIGR1cmluZyBhIGJvYXJkIG1lZXRpbmcgDQogICAgICAgIHVpbnQgZmVlc1Jld2FyZEluZmxhdGlvblJhdGU7DQogICAgICAgIC8vIFRydWUgaWYgdGhlIGRhbyBydWxlcyBhbGxvdyB0aGUgdHJhbnNmZXIgb2Ygc2hhcmVzDQogICAgICAgIGJvb2wgdHJhbnNmZXJhYmxlOw0KICAgIH0gDQoNCiAgICAvLyBUaGUgY3JlYXRvciBvZiB0aGUgRGFvDQogICAgYWRkcmVzcyBjcmVhdG9yOw0KICAgIC8vIFRoZSBtaW5pbXVtIHBlcmlvZHMgaW4gbWludXRlcyANCiAgICB1aW50IHB1YmxpYyBtaW5NaW51dGVzUGVyaW9kczsNCiAgICAvLyBUaGUgbWF4aW11bSBwZXJpb2QgaW4gbWludXRlcyBmb3IgcHJvcG9zYWxzIChzZXQrZGViYXRlKQ0KICAgIHVpbnQgcHVibGljIG1heE1pbnV0ZXNQcm9wb3NhbFBlcmlvZDsNCiAgICAvLyBUaGUgbWF4aW11bSBmdW5kaW5nIHBlcmlvZCBpbiBtaW51dGVzIGZvciBmdW5kaW5nIHByb3Bvc2Fscw0KICAgIHVpbnQgcHVibGljIG1heE1pbnV0ZXNGdW5kaW5nUGVyaW9kOw0KICAgIC8vIFRoZSBtYXhpbXVtIGluZmxhdGlvbiByYXRlIGZvciBzaGFyZSBwcmljZSBvciByZXdhcmRzIHRvIHZvdGVycw0KICAgIHVpbnQgcHVibGljIG1heEluZmxhdGlvblJhdGU7DQoNCiAgICAvLyBUaGUgRGFvIG1hbmFnZXIgc21hcnQgY29udHJhY3QNCiAgICBQYXNzTWFuYWdlciBwdWJsaWMgZGFvTWFuYWdlcjsNCiAgICANCiAgICAvLyBNYXAgdG8gYWxsb3cgdGhlIHNoYXJlIGhvbGRlcnMgdG8gd2l0aGRyYXcgYm9hcmQgbWVldGluZyBmZWVzDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgcGVuZGluZ0ZlZXNXaXRoZHJhd2FsczsNCg0KICAgIC8vIEJvYXJkIG1lZXRpbmdzIHRvIHZvdGUgZm9yIG9yIGFnYWluc3QgYSBwcm9wb3NhbA0KICAgIEJvYXJkTWVldGluZ1tdIHB1YmxpYyBCb2FyZE1lZXRpbmdzOyANCiAgICAvLyBQcm9wb3NhbHMgdG8gcGF5IGEgY29udHJhY3RvciBvciBmdW5kIHRoZSBEYW8NCiAgICBQcm9wb3NhbFtdIHB1YmxpYyBQcm9wb3NhbHM7DQogICAgLy8gUHJvcG9zYWxzIHRvIHVwZGF0ZSB0aGUgRGFvIHJ1bGVzDQogICAgUnVsZXNbXSBwdWJsaWMgRGFvUnVsZXNQcm9wb3NhbHM7DQogICAgLy8gVGhlIGN1cnJlbnQgRGFvIHJ1bGVzDQogICAgUnVsZXMgcHVibGljIERhb1J1bGVzOyANCiAgICANCiAgICAvLy8gQGRldiBUaGUgY29uc3RydWN0b3IgZnVuY3Rpb24NCiAgICAvL2Z1bmN0aW9uIFBhc3NEYW8oKTsNCg0KICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRvIGluaXRpYWxpemUgdGhlIERhbw0KICAgIC8vLyBAcGFyYW0gX2Rhb01hbmFnZXIgQWRkcmVzcyBvZiB0aGUgRGFvIG1hbmFnZXIgc21hcnQgY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9tYXhJbmZsYXRpb25SYXRlIFRoZSBtYXhpbXVtIGluZmxhdGlvbiByYXRlIGZvciBjb250cmFjdG9yIGFuZCBmdW5kaW5nIHByb3Bvc2Fscw0KICAgIC8vLyBAcGFyYW0gX21pbk1pbnV0ZXNQZXJpb2RzIFRoZSBtaW5pbXVtIHBlcmlvZHMgaW4gbWludXRlcw0KICAgIC8vLyBAcGFyYW0gX21heE1pbnV0ZXNGdW5kaW5nUGVyaW9kIFRoZSBtYXhpbXVtIGZ1bmRpbmcgcGVyaW9kIGluIG1pbnV0ZXMgZm9yIGZ1bmRpbmcgcHJvcG9zYWxzDQogICAgLy8vIEBwYXJhbSBfbWF4TWludXRlc1Byb3Bvc2FsUGVyaW9kIFRoZSBtYXhpbXVtIHBlcmlvZCBpbiBtaW51dGVzIGZvciBwcm9wb3NhbHMgKHNldCtkZWJhdGUpDQogICAgLy8vIEBwYXJhbSBfbWluUXVvcnVtRGl2aXNvciBUaGUgaW5pdGlhbCBtaW5pbXVtIHF1b3J1bSBkaXZpc29yIGZvciB0aGUgcHJvcG9zYWxzDQogICAgLy8vIEBwYXJhbSBfbWluQm9hcmRNZWV0aW5nRmVlcyBUaGUgYW1vdW50IChpbiB3ZWkpIHRvIG1ha2UgYSBwcm9wb3NhbCBhbmQgYXNrIGZvciBhIGJvYXJkIG1lZXRpbmcNCiAgICAvLy8gQHBhcmFtIF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgVGhlIG1pbmltdW0gcGVyaW9kIGluIG1pbnV0ZXMgYmVmb3JlIGEgYm9hcmQgbWVldGluZw0KICAgIC8vLyBAcGFyYW0gX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QgVGhlIG1pbmltdW0gcGVyaW9kIGluIG1pbnV0ZXMgb2YgdGhlIGJvYXJkIG1lZXRpbmdzDQogICAgLy8vIEBwYXJhbSBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgcmV3YXJkIG9mIGZlZXMgdG8gdm90ZXJzIGR1cmluZyBhIGJvYXJkIG1lZXRpbmcNCiAgICBmdW5jdGlvbiBpbml0RGFvKA0KICAgICAgICBhZGRyZXNzIF9kYW9NYW5hZ2VyLA0KICAgICAgICB1aW50IF9tYXhJbmZsYXRpb25SYXRlLA0KICAgICAgICB1aW50IF9taW5NaW51dGVzUGVyaW9kcywNCiAgICAgICAgdWludCBfbWF4TWludXRlc0Z1bmRpbmdQZXJpb2QsDQogICAgICAgIHVpbnQgX21heE1pbnV0ZXNQcm9wb3NhbFBlcmlvZCwNCiAgICAgICAgdWludCBfbWluUXVvcnVtRGl2aXNvciwNCiAgICAgICAgdWludCBfbWluQm9hcmRNZWV0aW5nRmVlcywNCiAgICAgICAgdWludCBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kLA0KICAgICAgICB1aW50IF9taW5NaW51dGVzRGViYXRlUGVyaW9kLA0KICAgICAgICB1aW50IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZQ0KICAgICAgICApOw0KICAgIA0KICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGJvYXJkIG1lZXRpbmcNCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIFRoZSBpbmRleCBvZiB0aGUgcHJvcG9zYWwgaWYgZm9yIGEgY29udHJhY3RvciBvciBmb3IgYSBmdW5kaW5nDQogICAgLy8vIEBwYXJhbSBfZGFvUnVsZXNQcm9wb3NhbElEIFRoZSBpbmRleCBvZiB0aGUgcHJvcG9zYWwgaWYgRGFvIHJ1bGVzDQogICAgLy8vIEBwYXJhbSBfbWludXRlc0RlYmF0aW5nUGVyaW9kIFRoZSBkdXJhdGlvbiBpbiBtaW51dGVzIG9mIHRoZSBtZWV0aW5nDQogICAgLy8vIEByZXR1cm4gdGhlIGluZGV4IG9mIHRoZSBib2FyZCBtZWV0aW5nDQogICAgZnVuY3Rpb24gbmV3Qm9hcmRNZWV0aW5nKA0KICAgICAgICB1aW50IF9wcm9wb3NhbElELCANCiAgICAgICAgdWludCBfZGFvUnVsZXNQcm9wb3NhbElELCANCiAgICAgICAgdWludCBfbWludXRlc0RlYmF0aW5nUGVyaW9kDQogICAgKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KTsNCiAgICANCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBtYWtlIGEgcHJvcG9zYWwgdG8gcGF5IGEgY29udHJhY3RvciBvciBmdW5kIHRoZSBEYW8NCiAgICAvLy8gQHBhcmFtIF9jb250cmFjdG9yTWFuYWdlciBBZGRyZXNzIG9mIHRoZSBjb250cmFjdG9yIG1hbmFnZXIgc21hcnQgY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9jb250cmFjdG9yUHJvcG9zYWxJRCBJbmRleCBvZiB0aGUgY29udHJhY3RvciBwcm9wb3NhbCBvZiB0aGUgY29udHJhY3RvciBtYW5hZ2VyDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfdG9rZW5DcmVhdGlvbiBUcnVlIGlmIHRoZSBwcm9wb3NhbCBmb3Jlc2VlcyBhIGNvbnRyYWN0b3IgdG9rZW4gY3JlYXRpb24NCiAgICAvLy8gQHBhcmFtIF9wdWJsaWNTaGFyZUNyZWF0aW9uIFRydWUgaWYgcHVibGljIGZ1bmRpbmcgd2l0aG91dCBhIG1haW4gcGFydG5lcg0KICAgIC8vLyBAcGFyYW0gX21haW5QYXJ0bmVyIFRoZSBhZGRyZXNzIHdoaWNoIHNldHMgcGFydG5lcnMgYW5kIG1hbmFnZSB0aGUgZnVuZGluZyANCiAgICAvLy8gaW4gY2FzZSBvZiBwcml2YXRlIGZ1bmRpbmcgKG5vdCBtYW5kYXRvcnkpDQogICAgLy8vIEBwYXJhbSBfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyIFRoZSBpbml0aWFsIHByaWNlIG11bHRpcGxpZXIgb2Ygc2hhcmVzDQogICAgLy8vIEBwYXJhbSBfaW5mbGF0aW9uUmF0ZSBJZiAwLCB0aGUgc2hhcmUgcHJpY2UgZG9lc24ndCBjaGFuZ2UgZHVyaW5nIHRoZSBmdW5kaW5nIChub3QgbWFuZGF0b3J5KQ0KICAgIC8vLyBAcGFyYW0gX21pbnV0ZXNGdW5kaW5nUGVyaW9kIFBlcmlvZCBpbiBtaW51dGVzIG9mIHRoZSBmdW5kaW5nDQogICAgLy8vIEBwYXJhbSBfbWludXRlc0RlYmF0aW5nUGVyaW9kIFBlcmlvZCBpbiBtaW51dGVzIG9mIHRoZSBib2FyZCBtZWV0aW5nIHRvIHZvdGUgb24gdGhlIHByb3Bvc2FsDQogICAgLy8vIEByZXR1cm4gVGhlIGluZGV4IG9mIHRoZSBwcm9wb3NhbA0KICAgIGZ1bmN0aW9uIG5ld1Byb3Bvc2FsKA0KICAgICAgICBhZGRyZXNzIF9jb250cmFjdG9yTWFuYWdlciwNCiAgICAgICAgdWludCBfY29udHJhY3RvclByb3Bvc2FsSUQsDQogICAgICAgIHVpbnQgX2Ftb3VudCwgDQogICAgICAgIGJvb2wgX3B1YmxpY1NoYXJlQ3JlYXRpb24sDQogICAgICAgIGJvb2wgX3Rva2VuQ3JlYXRpb24sDQogICAgICAgIGFkZHJlc3MgX21haW5QYXJ0bmVyLA0KICAgICAgICB1aW50IF9pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIsIA0KICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLA0KICAgICAgICB1aW50IF9taW51dGVzRnVuZGluZ1BlcmlvZCwNCiAgICAgICAgdWludCBfbWludXRlc0RlYmF0aW5nUGVyaW9kDQogICAgKSBwYXlhYmxlIHJldHVybnMgKHVpbnQpOw0KDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gbWFrZSBhIHByb3Bvc2FsIHRvIGNoYW5nZSB0aGUgRGFvIHJ1bGVzIA0KICAgIC8vLyBAcGFyYW0gX21pblF1b3J1bURpdmlzb3IgSWYgNSwgdGhlIG1pbmltdW0gcXVvcnVtIGlzIDIwJQ0KICAgIC8vLyBAcGFyYW0gX21pbkJvYXJkTWVldGluZ0ZlZXMgVGhlIGFtb3VudCAoaW4gd2VpKSB0byBtYWtlIGEgcHJvcG9zYWwgYW5kIGFzayBmb3IgYSBib2FyZCBtZWV0aW5nDQogICAgLy8vIEBwYXJhbSBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kIE1pbmltdW0gcGVyaW9kIGluIG1pbnV0ZXMgYmVmb3JlIGEgYm9hcmQgbWVldGluZw0KICAgIC8vLyBAcGFyYW0gX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QgVGhlIG1pbmltdW0gcGVyaW9kIGluIG1pbnV0ZXMgb2YgdGhlIGJvYXJkIG1lZXRpbmdzDQogICAgLy8vIEBwYXJhbSBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgcmV3YXJkIG9mIGZlZXMgdG8gdm90ZXJzIGR1cmluZyBhIGJvYXJkIG1lZXRpbmcNCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcmFibGUgVHJ1ZSBpZiB0aGUgcHJvcG9zYWwgZm9yZXNlZXMgdG8gYWxsb3cgdGhlIHRyYW5zZmVyIG9mIERhbyBzaGFyZXMNCiAgICAvLy8gQHBhcmFtIF9taW51dGVzRGViYXRpbmdQZXJpb2QgUGVyaW9kIGluIG1pbnV0ZXMgb2YgdGhlIGJvYXJkIG1lZXRpbmcgdG8gdm90ZSBvbiB0aGUgcHJvcG9zYWwNCiAgICBmdW5jdGlvbiBuZXdEYW9SdWxlc1Byb3Bvc2FsKA0KICAgICAgICB1aW50IF9taW5RdW9ydW1EaXZpc29yLCANCiAgICAgICAgdWludCBfbWluQm9hcmRNZWV0aW5nRmVlcywNCiAgICAgICAgdWludCBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kLA0KICAgICAgICB1aW50IF9taW5NaW51dGVzRGViYXRlUGVyaW9kLA0KICAgICAgICB1aW50IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSwNCiAgICAgICAgYm9vbCBfdHJhbnNmZXJhYmxlLA0KICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QNCiAgICApIHBheWFibGUgcmV0dXJucyAodWludCk7DQogICAgDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gdm90ZSBkdXJpbmcgYSBib2FyZCBtZWV0aW5nDQogICAgLy8vIEBwYXJhbSBfYm9hcmRNZWV0aW5nSUQgVGhlIGluZGV4IG9mIHRoZSBib2FyZCBtZWV0aW5nDQogICAgLy8vIEBwYXJhbSBfc3VwcG9ydHNQcm9wb3NhbCBUcnVlIGlmIHRoZSBwcm9wb3NhbCBpcyBzdXBwb3J0ZWQNCiAgICBmdW5jdGlvbiB2b3RlKA0KICAgICAgICB1aW50IF9ib2FyZE1lZXRpbmdJRCwgDQogICAgICAgIGJvb2wgX3N1cHBvcnRzUHJvcG9zYWwNCiAgICApOw0KDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gZXhlY3V0ZSBhIGJvYXJkIG1lZXRpbmcgZGVjaXNpb24gYW5kIGNsb3NlIHRoZSBib2FyZCBtZWV0aW5nDQogICAgLy8vIEBwYXJhbSBfYm9hcmRNZWV0aW5nSUQgVGhlIGluZGV4IG9mIHRoZSBib2FyZCBtZWV0aW5nDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgcHJvcG9zYWwgd2FzIGV4ZWN1dGVkIG9yIG5vdA0KICAgIGZ1bmN0aW9uIGV4ZWN1dGVEZWNpc2lvbih1aW50IF9ib2FyZE1lZXRpbmdJRCkgcmV0dXJucyAoYm9vbCk7DQogICAgDQogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gb3JkZXIgYSBjb250cmFjdG9yIHByb3Bvc2FsDQogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIHByb3Bvc2FsDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgcHJvcG9zYWwgd2FzIG9yZGVyZWQgYW5kIHRoZSBwcm9wb3NhbCBhbW91bnQgc2VudCBvciBub3QNCiAgICBmdW5jdGlvbiBvcmRlckNvbnRyYWN0b3JQcm9wb3NhbCh1aW50IF9wcm9wb3NhbElEKSByZXR1cm5zIChib29sKTsgICANCg0KICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHdpdGhkcmF3IHRoZSByZXdhcmRlZCBib2FyZCBtZWV0aW5nIGZlZXMNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB3aXRoZHJhdyB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgICAgDQogICAgZnVuY3Rpb24gd2l0aGRyYXdCb2FyZE1lZXRpbmdGZWVzKCkgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy8gQHJldHVybiBUaGUgbWluaW11bSBxdW9ydW0gZm9yIHByb3Bvc2FscyB0byBwYXNzIA0KICAgIGZ1bmN0aW9uIG1pblF1b3J1bSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICAgIA0KICAgIGV2ZW50IFByb3Bvc2FsQWRkZWQodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIGFkZHJlc3MgaW5kZXhlZCBDb250cmFjdG9yTWFuYWdlciwgdWludCBDb250cmFjdG9yUHJvcG9zYWxJRCwgDQogICAgICAgICAgICB1aW50IGFtb3VudCwgYWRkcmVzcyBpbmRleGVkIE1haW5QYXJ0bmVyLCB1aW50IEluaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllciwgdWludCBNaW51dGVzRnVuZGluZ1BlcmlvZCk7DQogICAgZXZlbnQgRGFvUnVsZXNQcm9wb3NhbEFkZGVkKHVpbnQgaW5kZXhlZCBEYW9SdWxlc1Byb3Bvc2FsSUQsIHVpbnQgTWluUXVvcnVtRGl2aXNvciwgdWludCBNaW5Cb2FyZE1lZXRpbmdGZWVzLCANCiAgICAgICAgICAgIHVpbnQgTWludXRlc1NldFByb3Bvc2FsUGVyaW9kLCB1aW50IE1pbk1pbnV0ZXNEZWJhdGVQZXJpb2QsIHVpbnQgRmVlc1Jld2FyZEluZmxhdGlvblJhdGUsIGJvb2wgVHJhbnNmZXJhYmxlKTsNCiAgICBldmVudCBTZW50VG9Db250cmFjdG9yKHVpbnQgaW5kZXhlZCBDb250cmFjdG9yUHJvcG9zYWxJRCwgYWRkcmVzcyBpbmRleGVkIENvbnRyYWN0b3JNYW5hZ2VyQWRkcmVzcywgdWludCBBbW91bnRTZW50KTsNCiAgICBldmVudCBCb2FyZE1lZXRpbmdDbG9zZWQodWludCBpbmRleGVkIEJvYXJkTWVldGluZ0lELCB1aW50IEZlZXNHaXZlbkJhY2ssIGJvb2wgUHJvcG9zYWxFeGVjdXRlZCk7DQogICAgDQp9DQoNCmNvbnRyYWN0IFBhc3NEYW8gaXMgUGFzc0Rhb0ludGVyZmFjZSB7DQoNCiAgICBmdW5jdGlvbiBQYXNzRGFvKCkge30NCiAgICANCiAgICBmdW5jdGlvbiBpbml0RGFvKA0KICAgICAgICBhZGRyZXNzIF9kYW9NYW5hZ2VyLA0KICAgICAgICB1aW50IF9tYXhJbmZsYXRpb25SYXRlLA0KICAgICAgICB1aW50IF9taW5NaW51dGVzUGVyaW9kcywNCiAgICAgICAgdWludCBfbWF4TWludXRlc0Z1bmRpbmdQZXJpb2QsDQogICAgICAgIHVpbnQgX21heE1pbnV0ZXNQcm9wb3NhbFBlcmlvZCwNCiAgICAgICAgdWludCBfbWluUXVvcnVtRGl2aXNvciwNCiAgICAgICAgdWludCBfbWluQm9hcmRNZWV0aW5nRmVlcywNCiAgICAgICAgdWludCBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kLA0KICAgICAgICB1aW50IF9taW5NaW51dGVzRGViYXRlUGVyaW9kLA0KICAgICAgICB1aW50IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZQ0KICAgICAgICApIHsNCiAgICAgICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgKERhb1J1bGVzLm1pblF1b3J1bURpdmlzb3IgIT0gMCkgdGhyb3c7DQoNCiAgICAgICAgZGFvTWFuYWdlciA9IFBhc3NNYW5hZ2VyKF9kYW9NYW5hZ2VyKTsNCg0KICAgICAgICBtYXhJbmZsYXRpb25SYXRlID0gX21heEluZmxhdGlvblJhdGU7DQogICAgICAgIG1pbk1pbnV0ZXNQZXJpb2RzID0gX21pbk1pbnV0ZXNQZXJpb2RzOw0KICAgICAgICBtYXhNaW51dGVzRnVuZGluZ1BlcmlvZCA9IF9tYXhNaW51dGVzRnVuZGluZ1BlcmlvZDsNCiAgICAgICAgbWF4TWludXRlc1Byb3Bvc2FsUGVyaW9kID0gX21heE1pbnV0ZXNQcm9wb3NhbFBlcmlvZDsNCiAgICAgICAgDQogICAgICAgIERhb1J1bGVzLm1pblF1b3J1bURpdmlzb3IgPSBfbWluUXVvcnVtRGl2aXNvcjsNCiAgICAgICAgRGFvUnVsZXMubWluQm9hcmRNZWV0aW5nRmVlcyA9IF9taW5Cb2FyZE1lZXRpbmdGZWVzOw0KICAgICAgICBEYW9SdWxlcy5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgPSBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kOw0KICAgICAgICBEYW9SdWxlcy5taW5NaW51dGVzRGViYXRlUGVyaW9kID0gX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2Q7DQogICAgICAgIERhb1J1bGVzLmZlZXNSZXdhcmRJbmZsYXRpb25SYXRlID0gX2ZlZXNSZXdhcmRJbmZsYXRpb25SYXRlOw0KDQogICAgICAgIEJvYXJkTWVldGluZ3MubGVuZ3RoID0gMTsgDQogICAgICAgIFByb3Bvc2Fscy5sZW5ndGggPSAxOw0KICAgICAgICBEYW9SdWxlc1Byb3Bvc2Fscy5sZW5ndGggPSAxOw0KICAgICAgICANCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gbmV3Qm9hcmRNZWV0aW5nKA0KICAgICAgICB1aW50IF9wcm9wb3NhbElELCANCiAgICAgICAgdWludCBfZGFvUnVsZXNQcm9wb3NhbElELCANCiAgICAgICAgdWludCBfbWludXRlc0RlYmF0aW5nUGVyaW9kDQogICAgKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQoNCiAgICAgICAgaWYgKG1zZy52YWx1ZSA8IERhb1J1bGVzLm1pbkJvYXJkTWVldGluZ0ZlZXMNCiAgICAgICAgICAgIHx8IERhb1J1bGVzLm1pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCArIF9taW51dGVzRGViYXRpbmdQZXJpb2QgPiBtYXhNaW51dGVzUHJvcG9zYWxQZXJpb2QNCiAgICAgICAgICAgIHx8IG5vdyArICgoRGFvUnVsZXMubWludXRlc1NldFByb3Bvc2FsUGVyaW9kICsgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCkgKiAxIG1pbnV0ZXMpIDwgbm93DQogICAgICAgICAgICB8fCBfbWludXRlc0RlYmF0aW5nUGVyaW9kIDwgRGFvUnVsZXMubWluTWludXRlc0RlYmF0ZVBlcmlvZA0KICAgICAgICAgICAgfHwgbXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpKSB0aHJvdzsNCg0KICAgICAgICB1aW50IF9ib2FyZE1lZXRpbmdJRCA9IEJvYXJkTWVldGluZ3MubGVuZ3RoKys7DQogICAgICAgIEJvYXJkTWVldGluZyBiID0gQm9hcmRNZWV0aW5nc1tfYm9hcmRNZWV0aW5nSURdOw0KDQogICAgICAgIGIuY3JlYXRvciA9IG1zZy5zZW5kZXI7DQoNCiAgICAgICAgYi5wcm9wb3NhbElEID0gX3Byb3Bvc2FsSUQ7DQogICAgICAgIGIuZGFvUnVsZXNQcm9wb3NhbElEID0gX2Rhb1J1bGVzUHJvcG9zYWxJRDsNCg0KICAgICAgICBiLmZlZXMgPSBtc2cudmFsdWU7DQogICAgICAgIA0KICAgICAgICBiLnNldERlYWRsaW5lID0gbm93ICsgKERhb1J1bGVzLm1pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCAqIDEgbWludXRlcyk7ICAgICAgICANCiAgICAgICAgYi52b3RpbmdEZWFkbGluZSA9IGIuc2V0RGVhZGxpbmUgKyAoX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCAqIDEgbWludXRlcyk7IA0KDQogICAgICAgIGIub3BlbiA9IHRydWU7IA0KDQogICAgICAgIHJldHVybiBfYm9hcmRNZWV0aW5nSUQ7DQoNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBuZXdQcm9wb3NhbCgNCiAgICAgICAgYWRkcmVzcyBfY29udHJhY3Rvck1hbmFnZXIsDQogICAgICAgIHVpbnQgX2NvbnRyYWN0b3JQcm9wb3NhbElELA0KICAgICAgICB1aW50IF9hbW91bnQsIA0KICAgICAgICBib29sIF90b2tlbkNyZWF0aW9uLA0KICAgICAgICBib29sIF9wdWJsaWNTaGFyZUNyZWF0aW9uLA0KICAgICAgICBhZGRyZXNzIF9tYWluUGFydG5lciwNCiAgICAgICAgdWludCBfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyLCANCiAgICAgICAgdWludCBfaW5mbGF0aW9uUmF0ZSwNCiAgICAgICAgdWludCBfbWludXRlc0Z1bmRpbmdQZXJpb2QsDQogICAgICAgIHVpbnQgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZA0KICAgICkgcGF5YWJsZSByZXR1cm5zICh1aW50KSB7DQoNCiAgICAgICAgaWYgKChfY29udHJhY3Rvck1hbmFnZXIgIT0gMCAmJiBfY29udHJhY3RvclByb3Bvc2FsSUQgPT0gMCkNCiAgICAgICAgICAgIHx8IChfY29udHJhY3Rvck1hbmFnZXIgPT0gMCANCiAgICAgICAgICAgICAgICAmJiAoX2luaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllciA9PSAwDQogICAgICAgICAgICAgICAgICAgIHx8IF9jb250cmFjdG9yUHJvcG9zYWxJRCAhPSAwKQ0KICAgICAgICAgICAgfHwgKF90b2tlbkNyZWF0aW9uICYmIF9wdWJsaWNTaGFyZUNyZWF0aW9uKQ0KICAgICAgICAgICAgfHwgKF9pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIgIT0gMA0KICAgICAgICAgICAgICAgICYmIChfbWludXRlc0Z1bmRpbmdQZXJpb2QgPCBtaW5NaW51dGVzUGVyaW9kcw0KICAgICAgICAgICAgICAgICAgICB8fCBfaW5mbGF0aW9uUmF0ZSA+IG1heEluZmxhdGlvblJhdGUNCiAgICAgICAgICAgICAgICAgICAgfHwgX21pbnV0ZXNGdW5kaW5nUGVyaW9kID4gbWF4TWludXRlc0Z1bmRpbmdQZXJpb2QpKSkpIHRocm93Ow0KDQogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQgPSBQcm9wb3NhbHMubGVuZ3RoKys7DQogICAgICAgIFByb3Bvc2FsIHAgPSBQcm9wb3NhbHNbX3Byb3Bvc2FsSURdOw0KDQogICAgICAgIHAuY29udHJhY3Rvck1hbmFnZXIgPSBQYXNzTWFuYWdlcihfY29udHJhY3Rvck1hbmFnZXIpOw0KICAgICAgICBwLmNvbnRyYWN0b3JQcm9wb3NhbElEID0gX2NvbnRyYWN0b3JQcm9wb3NhbElEOw0KICAgICAgICANCiAgICAgICAgcC5hbW91bnQgPSBfYW1vdW50Ow0KICAgICAgICBwLnRva2VuQ3JlYXRpb24gPSBfdG9rZW5DcmVhdGlvbjsNCg0KICAgICAgICBwLnB1YmxpY1NoYXJlQ3JlYXRpb24gPSBfcHVibGljU2hhcmVDcmVhdGlvbjsNCiAgICAgICAgcC5tYWluUGFydG5lciA9IF9tYWluUGFydG5lcjsNCiAgICAgICAgcC5pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIgPSBfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyOw0KICAgICAgICBwLmluZmxhdGlvblJhdGUgPSBfaW5mbGF0aW9uUmF0ZTsNCiAgICAgICAgcC5taW51dGVzRnVuZGluZ1BlcmlvZCA9IF9taW51dGVzRnVuZGluZ1BlcmlvZDsNCg0KICAgICAgICBwLmJvYXJkTWVldGluZ0lEID0gbmV3Qm9hcmRNZWV0aW5nKF9wcm9wb3NhbElELCAwLCBfbWludXRlc0RlYmF0aW5nUGVyaW9kKTsgICANCg0KICAgICAgICBwLm9wZW4gPSB0cnVlOw0KICAgICAgICANCiAgICAgICAgUHJvcG9zYWxBZGRlZChfcHJvcG9zYWxJRCwgcC5jb250cmFjdG9yTWFuYWdlciwgcC5jb250cmFjdG9yUHJvcG9zYWxJRCwgcC5hbW91bnQsIHAubWFpblBhcnRuZXIsIA0KICAgICAgICAgICAgcC5pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIsIF9taW51dGVzRnVuZGluZ1BlcmlvZCk7DQoNCiAgICAgICAgcmV0dXJuIF9wcm9wb3NhbElEOw0KICAgICAgICANCiAgICB9DQoNCiAgICBmdW5jdGlvbiBuZXdEYW9SdWxlc1Byb3Bvc2FsKA0KICAgICAgICB1aW50IF9taW5RdW9ydW1EaXZpc29yLCANCiAgICAgICAgdWludCBfbWluQm9hcmRNZWV0aW5nRmVlcywNCiAgICAgICAgdWludCBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kLA0KICAgICAgICB1aW50IF9taW5NaW51dGVzRGViYXRlUGVyaW9kLA0KICAgICAgICB1aW50IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSwNCiAgICAgICAgYm9vbCBfdHJhbnNmZXJhYmxlLA0KICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QNCiAgICApIHBheWFibGUgcmV0dXJucyAodWludCkgew0KICAgIA0KICAgICAgICBpZiAoX21pblF1b3J1bURpdmlzb3IgPD0gMQ0KICAgICAgICAgICAgfHwgX21pblF1b3J1bURpdmlzb3IgPiAxMA0KICAgICAgICAgICAgfHwgX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCA8IG1pbk1pbnV0ZXNQZXJpb2RzDQogICAgICAgICAgICB8fCBfbWluTWludXRlc0RlYmF0ZVBlcmlvZCA8IG1pbk1pbnV0ZXNQZXJpb2RzDQogICAgICAgICAgICB8fCBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kICsgX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QgPiBtYXhNaW51dGVzUHJvcG9zYWxQZXJpb2QNCiAgICAgICAgICAgIHx8IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSA+IG1heEluZmxhdGlvblJhdGUNCiAgICAgICAgICAgICkgdGhyb3c7IA0KICAgICAgICANCiAgICAgICAgdWludCBfRGFvUnVsZXNQcm9wb3NhbElEID0gRGFvUnVsZXNQcm9wb3NhbHMubGVuZ3RoKys7DQogICAgICAgIFJ1bGVzIHIgPSBEYW9SdWxlc1Byb3Bvc2Fsc1tfRGFvUnVsZXNQcm9wb3NhbElEXTsNCg0KICAgICAgICByLm1pblF1b3J1bURpdmlzb3IgPSBfbWluUXVvcnVtRGl2aXNvcjsNCiAgICAgICAgci5taW5Cb2FyZE1lZXRpbmdGZWVzID0gX21pbkJvYXJkTWVldGluZ0ZlZXM7DQogICAgICAgIHIubWludXRlc1NldFByb3Bvc2FsUGVyaW9kID0gX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZDsNCiAgICAgICAgci5taW5NaW51dGVzRGViYXRlUGVyaW9kID0gX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2Q7DQogICAgICAgIHIuZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgPSBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGU7DQogICAgICAgIHIudHJhbnNmZXJhYmxlID0gX3RyYW5zZmVyYWJsZTsNCiAgICAgICAgDQogICAgICAgIHIuYm9hcmRNZWV0aW5nSUQgPSBuZXdCb2FyZE1lZXRpbmcoMCwgX0Rhb1J1bGVzUHJvcG9zYWxJRCwgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCk7ICAgICANCg0KICAgICAgICBEYW9SdWxlc1Byb3Bvc2FsQWRkZWQoX0Rhb1J1bGVzUHJvcG9zYWxJRCwgX21pblF1b3J1bURpdmlzb3IsIF9taW5Cb2FyZE1lZXRpbmdGZWVzLCANCiAgICAgICAgICAgIF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QsIF9taW5NaW51dGVzRGViYXRlUGVyaW9kLCBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgLF90cmFuc2ZlcmFibGUpOw0KDQogICAgICAgIHJldHVybiBfRGFvUnVsZXNQcm9wb3NhbElEOw0KICAgICAgICANCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gdm90ZSgNCiAgICAgICAgdWludCBfYm9hcmRNZWV0aW5nSUQsIA0KICAgICAgICBib29sIF9zdXBwb3J0c1Byb3Bvc2FsDQogICAgKSB7DQogICAgICAgIA0KICAgICAgICBCb2FyZE1lZXRpbmcgYiA9IEJvYXJkTWVldGluZ3NbX2JvYXJkTWVldGluZ0lEXTsNCg0KICAgICAgICBpZiAoYi5oYXNWb3RlZFttc2cuc2VuZGVyXSANCiAgICAgICAgICAgIHx8IG5vdyA8IGIuc2V0RGVhZGxpbmUNCiAgICAgICAgICAgIHx8IG5vdyA+IGIudm90aW5nRGVhZGxpbmUpIHRocm93Ow0KDQogICAgICAgIHVpbnQgX2JhbGFuY2UgPSB1aW50KGRhb01hbmFnZXIuYmFsYW5jZU9mKG1zZy5zZW5kZXIpKTsNCiAgICAgICAgaWYgKF9iYWxhbmNlID09IDApIHRocm93Ow0KICAgICAgICANCiAgICAgICAgYi5oYXNWb3RlZFttc2cuc2VuZGVyXSA9IHRydWU7DQoNCiAgICAgICAgaWYgKF9zdXBwb3J0c1Byb3Bvc2FsKSBiLnllYSArPSBfYmFsYW5jZTsNCiAgICAgICAgZWxzZSBiLm5heSArPSBfYmFsYW5jZTsgDQoNCiAgICAgICAgaWYgKGIuZmVlcyA+IDAgJiYgYi5wcm9wb3NhbElEICE9IDAgJiYgUHJvcG9zYWxzW2IucHJvcG9zYWxJRF0uY29udHJhY3RvclByb3Bvc2FsSUQgIT0gMCkgew0KDQogICAgICAgICAgICB1aW50IF9hID0gMTAwKmIuZmVlczsNCiAgICAgICAgICAgIGlmICgoX2EvMTAwICE9IGIuZmVlcykgfHwgKChfYSpfYmFsYW5jZSkvX2EgIT0gX2JhbGFuY2UpKSB0aHJvdzsNCiAgICAgICAgICAgIHVpbnQgX211bHRpcGxpZXIgPSAoX2EqX2JhbGFuY2UpL3VpbnQoZGFvTWFuYWdlci5Ub3RhbFN1cHBseSgpKTsNCg0KICAgICAgICAgICAgdWludCBfZGl2aXNvciA9IDEwMCArIDEwMCpEYW9SdWxlcy5mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSoobm93IC0gYi5zZXREZWFkbGluZSkvKDEwMCozNjUgZGF5cyk7DQoNCiAgICAgICAgICAgIHVpbnQgX3Jld2FyZGVkYW1vdW50ID0gX211bHRpcGxpZXIvX2Rpdmlzb3I7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChiLnRvdGFsUmV3YXJkZWRBbW91bnQgKyBfcmV3YXJkZWRhbW91bnQgPiBiLmZlZXMpIF9yZXdhcmRlZGFtb3VudCA9IGIuZmVlcyAtIGIudG90YWxSZXdhcmRlZEFtb3VudDsNCiAgICAgICAgICAgIGIudG90YWxSZXdhcmRlZEFtb3VudCArPSBfcmV3YXJkZWRhbW91bnQ7DQogICAgICAgICAgICBwZW5kaW5nRmVlc1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdICs9IF9yZXdhcmRlZGFtb3VudDsNCiAgICAgICAgfQ0KDQogICAgICAgIGRhb01hbmFnZXIuYmxvY2tUcmFuc2Zlcihtc2cuc2VuZGVyLCBiLnZvdGluZ0RlYWRsaW5lKTsNCg0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGV4ZWN1dGVEZWNpc2lvbih1aW50IF9ib2FyZE1lZXRpbmdJRCkgcmV0dXJucyAoYm9vbCkgew0KDQogICAgICAgIEJvYXJkTWVldGluZyBiID0gQm9hcmRNZWV0aW5nc1tfYm9hcmRNZWV0aW5nSURdOw0KICAgICAgICBQcm9wb3NhbCBwID0gUHJvcG9zYWxzW2IucHJvcG9zYWxJRF07DQogICAgICAgIA0KICAgICAgICBpZiAobm93IDwgYi52b3RpbmdEZWFkbGluZSB8fCAhYi5vcGVuKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIGIub3BlbiA9IGZhbHNlOw0KICAgICAgICBpZiAocC5jb250cmFjdG9yUHJvcG9zYWxJRCA9PSAwKSBwLm9wZW4gPSBmYWxzZTsNCg0KICAgICAgICB1aW50IF9mZWVzOw0KICAgICAgICB1aW50IF9taW5RdW9ydW0gPSBtaW5RdW9ydW0oKTsNCg0KICAgICAgICBpZiAoYi5mZWVzID4gMA0KICAgICAgICAgICAgJiYgKGIucHJvcG9zYWxJRCA9PSAwIHx8IHAuY29udHJhY3RvclByb3Bvc2FsSUQgPT0gMCkNCiAgICAgICAgICAgICYmIGIueWVhICsgYi5uYXkgPj0gX21pblF1b3J1bSkgew0KICAgICAgICAgICAgICAgICAgICBfZmVlcyA9IGIuZmVlczsNCiAgICAgICAgICAgICAgICAgICAgYi5mZWVzID0gMDsNCiAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0ZlZXNXaXRoZHJhd2Fsc1tiLmNyZWF0b3JdICs9IF9mZWVzOw0KICAgICAgICB9ICAgICAgICANCg0KICAgICAgICBpZiAoYi5mZWVzIC0gYi50b3RhbFJld2FyZGVkQW1vdW50ID4gMCkgew0KICAgICAgICAgICAgaWYgKCFkYW9NYW5hZ2VyLnNlbmQoYi5mZWVzIC0gYi50b3RhbFJld2FyZGVkQW1vdW50KSkgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmIChiLnllYSArIGIubmF5IDwgX21pblF1b3J1bSB8fCBiLnllYSA8PSBiLm5heSkgew0KICAgICAgICAgICAgcC5vcGVuID0gZmFsc2U7DQogICAgICAgICAgICBCb2FyZE1lZXRpbmdDbG9zZWQoX2JvYXJkTWVldGluZ0lELCBfZmVlcywgZmFsc2UpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgYi5kYXRlT2ZFeGVjdXRpb24gPSBub3c7DQoNCiAgICAgICAgaWYgKGIucHJvcG9zYWxJRCAhPSAwKSB7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChwLmluaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllciAhPSAwKSB7DQoNCiAgICAgICAgICAgICAgICBkYW9NYW5hZ2VyLnNldEZ1bmRpbmdSdWxlcyhwLm1haW5QYXJ0bmVyLCBwLnB1YmxpY1NoYXJlQ3JlYXRpb24sIHAuaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyLCANCiAgICAgICAgICAgICAgICAgICAgcC5hbW91bnQsIHAubWludXRlc0Z1bmRpbmdQZXJpb2QsIHAuaW5mbGF0aW9uUmF0ZSwgYi5wcm9wb3NhbElEKTsNCg0KICAgICAgICAgICAgICAgIGlmIChwLmNvbnRyYWN0b3JQcm9wb3NhbElEICE9IDAgJiYgcC50b2tlbkNyZWF0aW9uKSB7DQogICAgICAgICAgICAgICAgICAgIHAuY29udHJhY3Rvck1hbmFnZXIuc2V0RnVuZGluZ1J1bGVzKHAubWFpblBhcnRuZXIsIHAucHVibGljU2hhcmVDcmVhdGlvbiwgMCwgDQogICAgICAgICAgICAgICAgICAgICAgICBwLmFtb3VudCwgcC5taW51dGVzRnVuZGluZ1BlcmlvZCwgbWF4SW5mbGF0aW9uUmF0ZSwgYi5wcm9wb3NhbElEKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgICAgICBSdWxlcyByID0gRGFvUnVsZXNQcm9wb3NhbHNbYi5kYW9SdWxlc1Byb3Bvc2FsSURdOw0KICAgICAgICAgICAgRGFvUnVsZXMuYm9hcmRNZWV0aW5nSUQgPSByLmJvYXJkTWVldGluZ0lEOw0KDQogICAgICAgICAgICBEYW9SdWxlcy5taW5RdW9ydW1EaXZpc29yID0gci5taW5RdW9ydW1EaXZpc29yOw0KICAgICAgICAgICAgRGFvUnVsZXMubWluTWludXRlc0RlYmF0ZVBlcmlvZCA9IHIubWluTWludXRlc0RlYmF0ZVBlcmlvZDsgDQogICAgICAgICAgICBEYW9SdWxlcy5taW5Cb2FyZE1lZXRpbmdGZWVzID0gci5taW5Cb2FyZE1lZXRpbmdGZWVzOw0KICAgICAgICAgICAgRGFvUnVsZXMubWludXRlc1NldFByb3Bvc2FsUGVyaW9kID0gci5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2Q7DQogICAgICAgICAgICBEYW9SdWxlcy5mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSA9IHIuZmVlc1Jld2FyZEluZmxhdGlvblJhdGU7DQoNCiAgICAgICAgICAgIERhb1J1bGVzLnRyYW5zZmVyYWJsZSA9IHIudHJhbnNmZXJhYmxlOw0KICAgICAgICAgICAgaWYgKHIudHJhbnNmZXJhYmxlKSBkYW9NYW5hZ2VyLmFibGVUcmFuc2ZlcigpOw0KICAgICAgICAgICAgZWxzZSBkYW9NYW5hZ2VyLmRpc2FibGVUcmFuc2ZlcigpOw0KICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgQm9hcmRNZWV0aW5nQ2xvc2VkKF9ib2FyZE1lZXRpbmdJRCwgX2ZlZXMsIHRydWUpOw0KDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICANCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gb3JkZXJDb250cmFjdG9yUHJvcG9zYWwodWludCBfcHJvcG9zYWxJRCkgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICANCiAgICAgICAgUHJvcG9zYWwgcCA9IFByb3Bvc2Fsc1tfcHJvcG9zYWxJRF07DQogICAgICAgIEJvYXJkTWVldGluZyBiID0gQm9hcmRNZWV0aW5nc1twLmJvYXJkTWVldGluZ0lEXTsNCg0KICAgICAgICBpZiAoYi5vcGVuIHx8ICFwLm9wZW4pIHRocm93Ow0KICAgICAgICANCiAgICAgICAgdWludCBfYW1vdW50ID0gcC5hbW91bnQ7DQoNCiAgICAgICAgaWYgKHAuaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyICE9IDApIHsNCiAgICAgICAgICAgIF9hbW91bnQgPSBkYW9NYW5hZ2VyLkZ1bmRlZEFtb3VudChfcHJvcG9zYWxJRCk7DQogICAgICAgICAgICBpZiAoX2Ftb3VudCA9PSAwICYmIG5vdyA8IGIuZGF0ZU9mRXhlY3V0aW9uICsgKHAubWludXRlc0Z1bmRpbmdQZXJpb2QgKiAxIG1pbnV0ZXMpKSByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHAub3BlbiA9IGZhbHNlOyAgIA0KDQogICAgICAgIGlmIChfYW1vdW50ID09IDAgfHwgIXAuY29udHJhY3Rvck1hbmFnZXIub3JkZXIocC5jb250cmFjdG9yUHJvcG9zYWxJRCwgX2Ftb3VudCkpIHJldHVybjsNCiAgICAgICAgDQogICAgICAgIGlmICghZGFvTWFuYWdlci5zZW5kVG8ocC5jb250cmFjdG9yTWFuYWdlciwgX2Ftb3VudCkpIHRocm93Ow0KICAgICAgICBTZW50VG9Db250cmFjdG9yKHAuY29udHJhY3RvclByb3Bvc2FsSUQsIGFkZHJlc3MocC5jb250cmFjdG9yTWFuYWdlciksIF9hbW91bnQpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRydWU7DQoNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gd2l0aGRyYXdCb2FyZE1lZXRpbmdGZWVzKCkgcmV0dXJucyAoYm9vbCkgew0KDQogICAgICAgIHVpbnQgX2Ftb3VudCA9IHBlbmRpbmdGZWVzV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl07DQoNCiAgICAgICAgcGVuZGluZ0ZlZXNXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXSA9IDA7DQoNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChfYW1vdW50KSkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBwZW5kaW5nRmVlc1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdID0gX2Ftb3VudDsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgfQ0KDQogICAgZnVuY3Rpb24gbWluUXVvcnVtKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gKHVpbnQoZGFvTWFuYWdlci5Ub3RhbFN1cHBseSgpKSAvIERhb1J1bGVzLm1pblF1b3J1bURpdmlzb3IpOw0KICAgIH0NCiAgICANCn0='