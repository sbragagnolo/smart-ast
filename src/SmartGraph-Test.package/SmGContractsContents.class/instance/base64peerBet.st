base 64 content
base64peerBet
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC45Ow0KDQpjb250cmFjdCBQZWVyQmV0IHsNCiAgICBlbnVtIEdhbWVTdGF0dXMgeyBPcGVuLCBMb2NrZWQsIFNjb3JlZCwgVmVyaWZpZWQgfQ0KICAgIC8vIEJvb2tUeXBlLk5vbmUgZXhpc3RzIGJlY2F1c2UgcGFyc2luZyBhIGxvZyBpbmRleCBmb3IgYSB2YWx1ZSBvZiAwIA0KICAgIC8vIHJldHVybnMgYWxsIHZhbHVlcy4gSXQgc2hvdWxkIG5vdCBiZSB1c2VkLg0KICAgIGVudW0gQm9va1R5cGUgeyBOb25lLCBTcHJlYWQsIE1vbmV5TGluZSwgT3ZlclVuZGVyIH0NCiAgICBlbnVtIEJldFN0YXR1cyB7IE9wZW4sIFBhaWQgfQ0KDQogICAgLy8gaW5kZXhpbmcgb24gYSBzdHJpbmcgY2F1c2VzIGlzc3VlcyB3aXRoIHdlYjMsIHNvIGNhdGVnb3J5IGhhcyB0byBiZSBhbiBpbnQNCiAgICBldmVudCBHYW1lQ3JlYXRlZChieXRlczMyIGluZGV4ZWQgaWQsIGFkZHJlc3MgaW5kZXhlZCBjcmVhdG9yLCBzdHJpbmcgaG9tZSwgDQogICAgICAgIHN0cmluZyBhd2F5LCB1aW50MTYgaW5kZXhlZCBjYXRlZ29yeSwgdWludDY0IGxvY2t0aW1lKTsNCiAgICBldmVudCBCaWRQbGFjZWQoYnl0ZXMzMiBpbmRleGVkIGdhbWVfaWQsIEJvb2tUeXBlIGJvb2ssIA0KICAgICAgICBhZGRyZXNzIGJpZGRlciwgdWludCBhbW91bnQsIGJvb2wgaG9tZSwgaW50MzIgbGluZSk7DQogICAgZXZlbnQgQmV0UGxhY2VkKGJ5dGVzMzIgaW5kZXhlZCBnYW1lX2lkLCBCb29rVHlwZSBpbmRleGVkIGJvb2ssIA0KICAgICAgICBhZGRyZXNzIGluZGV4ZWQgdXNlciwgYm9vbCBob21lLCB1aW50IGFtb3VudCwgaW50MzIgbGluZSk7DQogICAgZXZlbnQgR2FtZVNjb3JlZChieXRlczMyIGluZGV4ZWQgZ2FtZV9pZCwgaW50IGhvbWVTY29yZSwgaW50IGF3YXlTY29yZSwgdWludCB0aW1lc3RhbXApOw0KICAgIGV2ZW50IEdhbWVWZXJpZmllZChieXRlczMyIGluZGV4ZWQgZ2FtZV9pZCk7DQogICAgZXZlbnQgV2l0aGRyYXdhbChhZGRyZXNzIGluZGV4ZWQgdXNlciwgdWludCBhbW91bnQsIHVpbnQgdGltZXN0YW1wKTsNCg0KICAgIHN0cnVjdCBCaWQgew0KICAgICAgICBhZGRyZXNzIGJpZGRlcjsNCiAgICAgICAgdWludCBhbW91bnQ7IC8qIGluIHdlaSAqLw0KICAgICAgICBib29sIGhvbWU7IC8qIHRydWU9aG9tZSwgZmFsc2U9YXdheSAqLw0KICAgICAgICBpbnQzMiBsaW5lOw0KICAgIH0NCg0KICAgIHN0cnVjdCBCZXQgew0KICAgICAgICBhZGRyZXNzIGhvbWU7DQogICAgICAgIGFkZHJlc3MgYXdheTsNCiAgICAgICAgdWludCBhbW91bnQ7IC8qIGluIHdlaSAqLw0KICAgICAgICBpbnQzMiBsaW5lOw0KICAgICAgICBCZXRTdGF0dXMgc3RhdHVzOw0KICAgIH0NCg0KICAgIHN0cnVjdCBCb29rIHsNCiAgICAgICAgQmlkW10gaG9tZUJpZHM7DQogICAgICAgIEJpZFtdIGF3YXlCaWRzOw0KICAgICAgICBCZXRbXSBiZXRzOw0KICAgIH0NCg0KICAgIHN0cnVjdCBHYW1lUmVzdWx0IHsNCiAgICAgICAgaW50IGhvbWU7DQogICAgICAgIGludCBhd2F5Ow0KICAgICAgICB1aW50IHRpbWVzdGFtcDsgLy8gd2hlbiB0aGUgZ2FtZSB3YXMgc2NvcmVkDQogICAgfQ0KDQogICAgc3RydWN0IEdhbWUgew0KICAgICAgICBieXRlczMyIGlkOw0KICAgICAgICBhZGRyZXNzIGNyZWF0b3I7DQogICAgICAgIHN0cmluZyBob21lOw0KICAgICAgICBzdHJpbmcgYXdheTsNCiAgICAgICAgdWludDE2IGNhdGVnb3J5Ow0KICAgICAgICB1aW50NjQgbG9ja3RpbWU7DQogICAgICAgIEdhbWVTdGF0dXMgc3RhdHVzOw0KICAgICAgICBtYXBwaW5nKHVpbnQgPT4gQm9vaykgYm9va3M7DQogICAgICAgIEdhbWVSZXN1bHQgcmVzdWx0Ow0KICAgIH0NCg0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KICAgIEdhbWVbXSBnYW1lczsNCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJhbGFuY2VzOw0KDQogICAgZnVuY3Rpb24gUGVlckJldCgpIHsNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgIH0NCg0KCWZ1bmN0aW9uIGNyZWF0ZUdhbWUgKHN0cmluZyBob21lLCBzdHJpbmcgYXdheSwgdWludDE2IGNhdGVnb3J5LCB1aW50NjQgbG9ja3RpbWUpIHJldHVybnMgKGludCkgew0KICAgICAgICBieXRlczMyIGlkID0gZ2V0R2FtZUlkKG1zZy5zZW5kZXIsIGhvbWUsIGF3YXksIGNhdGVnb3J5LCBsb2NrdGltZSk7DQogICAgICAgIEdhbWUgbWVtb3J5IGdhbWUgPSBHYW1lKGlkLCBtc2cuc2VuZGVyLCBob21lLCBhd2F5LCBjYXRlZ29yeSwgbG9ja3RpbWUsIEdhbWVTdGF0dXMuT3BlbiwgR2FtZVJlc3VsdCgwLDAsMCkpOw0KICAgICAgICBnYW1lcy5wdXNoKGdhbWUpOw0KICAgICAgICBHYW1lQ3JlYXRlZChpZCwgZ2FtZS5jcmVhdG9yLCBob21lLCBhd2F5LCBjYXRlZ29yeSwgbG9ja3RpbWUpOw0KICAgICAgICByZXR1cm4gLTE7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGNhbmNlbE9wZW5CaWRzKEJvb2sgc3RvcmFnZSBib29rKSBwcml2YXRlIHJldHVybnMgKGludCkgew0KICAgICAgICBmb3IgKHVpbnQgaT0wOyBpIDwgYm9vay5ob21lQmlkcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgQmlkIGJpZCA9IGJvb2suaG9tZUJpZHNbaV07DQogICAgICAgICAgICBpZiAoYmlkLmFtb3VudCA9PSAwKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgYmFsYW5jZXNbYmlkLmJpZGRlcl0gKz0gYmlkLmFtb3VudDsNCiAgICAgICAgfQ0KICAgICAgICBkZWxldGUgYm9vay5ob21lQmlkczsNCiAgICAgICAgZm9yIChpPTA7IGkgPCBib29rLmF3YXlCaWRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBiaWQgPSBib29rLmF3YXlCaWRzW2ldOw0KICAgICAgICAgICAgaWYgKGJpZC5hbW91bnQgPT0gMCkNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIGJhbGFuY2VzW2JpZC5iaWRkZXJdICs9IGJpZC5hbW91bnQ7DQogICAgICAgIH0NCiAgICAgICAgZGVsZXRlIGJvb2suYXdheUJpZHM7DQoNCiAgICAgICAgcmV0dXJuIC0xOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNhbmNlbEJldHMoQm9vayBzdG9yYWdlIGJvb2ssIEJvb2tUeXBlIGJvb2tfdHlwZSkgcHJpdmF0ZSByZXR1cm5zIChpbnQpIHsNCiAgICAgICAgZm9yICh1aW50IGk9MDsgaSA8IGJvb2suYmV0cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgQmV0IGJldCA9IGJvb2suYmV0c1tpXTsNCiAgICAgICAgICAgIGlmIChiZXQuc3RhdHVzID09IEJldFN0YXR1cy5QYWlkKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgdWludCBhd2F5QmV0QW1vdW50Ow0KICAgICAgICAgICAgaWYgKGJvb2tfdHlwZSA9PSBCb29rVHlwZS5Nb25leUxpbmUpIHsNCiAgICAgICAgICAgICAgICBpZiAoYmV0LmxpbmUgPCAwKQ0KICAgICAgICAgICAgICAgICAgICBhd2F5QmV0QW1vdW50ID0gYmV0LmFtb3VudCAqIDEwMCAvIHVpbnQoYmV0LmxpbmUpOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgYXdheUJldEFtb3VudCA9IGJldC5hbW91bnQgKiB1aW50KGJldC5saW5lKSAvIDEwMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBhd2F5QmV0QW1vdW50ID0gYmV0LmFtb3VudDsNCiAgICAgICAgICAgIGJhbGFuY2VzW2JldC5ob21lXSArPSBiZXQuYW1vdW50Ow0KICAgICAgICAgICAgYmFsYW5jZXNbYmV0LmF3YXldICs9IGF3YXlCZXRBbW91bnQ7DQogICAgICAgIH0NCiAgICAgICAgZGVsZXRlIGJvb2suYmV0czsNCg0KICAgICAgICByZXR1cm4gLTE7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGVsZXRlR2FtZShieXRlczMyIGdhbWVfaWQpIHJldHVybnMgKGludCkgew0KICAgICAgICBHYW1lIGdhbWUgPSBnZXRHYW1lQnlJZChnYW1lX2lkKTsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gZ2FtZS5jcmVhdG9yICYmIChnYW1lLmxvY2t0aW1lICsgODY0MDAqNCkgPiBub3cpIHJldHVybiAxOw0KDQogICAgICAgIGZvciAodWludCBpPTE7IGkgPCA0OyBpKyspIHsNCiAgICAgICAgICAgIEJvb2sgYm9vayA9IGdhbWUuYm9va3NbaV07DQogICAgICAgICAgICBjYW5jZWxPcGVuQmlkcyhib29rKTsNCiAgICAgICAgICAgIGNhbmNlbEJldHMoYm9vaywgQm9va1R5cGUoaSkpOw0KICAgICAgICB9DQogICAgICAgIGZvciAoaT0wOyBpIDwgZ2FtZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmIChnYW1lc1tpXS5pZCA9PSBnYW1lX2lkKSB7DQogICAgICAgICAgICAgICAgZ2FtZXNbaV0gPSBnYW1lc1tnYW1lcy5sZW5ndGggLSAxXTsNCiAgICAgICAgICAgICAgICBnYW1lcy5sZW5ndGggLT0gMTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gLTE7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcGF5QmV0cyhieXRlczMyIGdhbWVfaWQpIHByaXZhdGUgcmV0dXJucyAoaW50KSB7DQogICAgICAgIEdhbWUgZ2FtZSA9IGdldEdhbWVCeUlkKGdhbWVfaWQpOw0KDQogICAgICAgIEJldFtdIHNwcmVhZEJldHMgPSBnYW1lLmJvb2tzW3VpbnQoQm9va1R5cGUuU3ByZWFkKV0uYmV0czsNCiAgICAgICAgQmV0W10gbW9uZXlMaW5lQmV0cyA9IGdhbWUuYm9va3NbdWludChCb29rVHlwZS5Nb25leUxpbmUpXS5iZXRzOw0KICAgICAgICBCZXRbXSBvdmVyVW5kZXJCZXRzID0gZ2FtZS5ib29rc1t1aW50KEJvb2tUeXBlLk92ZXJVbmRlcildLmJldHM7DQoNCiAgICAgICAgLy8gU3ByZWFkDQogICAgICAgIGludCByZXN1bHRTcHJlYWQgPSBnYW1lLnJlc3VsdC5hd2F5IC0gZ2FtZS5yZXN1bHQuaG9tZTsNCiAgICAgICAgcmVzdWx0U3ByZWFkICo9IDEwOyAvLyBiZWNhdXNlIGJldC5saW5lIGlzIDEweCB0aGUgYWN0dWFsIGxpbmUNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc3ByZWFkQmV0cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgQmV0IGJldCA9IHNwcmVhZEJldHNbaV07DQogICAgICAgICAgICBpZiAoYmV0LnN0YXR1cyA9PSBCZXRTdGF0dXMuUGFpZCkNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIGlmIChyZXN1bHRTcHJlYWQgPiBiZXQubGluZSkgDQogICAgICAgICAgICAgICAgYmFsYW5jZXNbYmV0LmF3YXldICs9IGJldC5hbW91bnQgKiAyOw0KICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0U3ByZWFkIDwgYmV0LmxpbmUpDQogICAgICAgICAgICAgICAgYmFsYW5jZXNbYmV0LmhvbWVdICs9IGJldC5hbW91bnQgKiAyOw0KICAgICAgICAgICAgZWxzZSB7IC8vIGRyYXcNCiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuYXdheV0gKz0gYmV0LmFtb3VudDsNCiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuaG9tZV0gKz0gYmV0LmFtb3VudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJldC5zdGF0dXMgPSBCZXRTdGF0dXMuUGFpZDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIE1vbmV5TGluZQ0KICAgICAgICBib29sIHRpZSA9IGdhbWUucmVzdWx0LmhvbWUgPT0gZ2FtZS5yZXN1bHQuYXdheTsNCiAgICAgICAgYm9vbCBob21lV2luID0gZ2FtZS5yZXN1bHQuaG9tZSA+IGdhbWUucmVzdWx0LmF3YXk7DQogICAgICAgIGZvciAoaT0wOyBpIDwgbW9uZXlMaW5lQmV0cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgYmV0ID0gbW9uZXlMaW5lQmV0c1tpXTsNCiAgICAgICAgICAgIGlmIChiZXQuc3RhdHVzID09IEJldFN0YXR1cy5QYWlkKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgdWludCBhd2F5QW1vdW50Ow0KICAgICAgICAgICAgaWYgKGJldC5saW5lIDwgMCkNCiAgICAgICAgICAgICAgICBhd2F5QW1vdW50ID0gYmV0LmFtb3VudCAqIDEwMCAvIHVpbnQoLWJldC5saW5lKTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBhd2F5QW1vdW50ID0gYmV0LmFtb3VudCAqIHVpbnQoYmV0LmxpbmUpIC8gMTAwOw0KICAgICAgICAgICAgaWYgKHRpZSkgew0KICAgICAgICAgICAgICAgIGJhbGFuY2VzW2JldC5ob21lXSArPSBiZXQuYW1vdW50Ow0KICAgICAgICAgICAgICAgIGJhbGFuY2VzW2JldC5hd2F5XSArPSBhd2F5QW1vdW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoaG9tZVdpbikNCiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuaG9tZV0gKz0gKGJldC5hbW91bnQgKyBhd2F5QW1vdW50KTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuYXdheV0gKz0gKGJldC5hbW91bnQgKyBhd2F5QW1vdW50KTsNCiAgICAgICAgICAgIGJldC5zdGF0dXMgPSBCZXRTdGF0dXMuUGFpZDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIE92ZXJVbmRlciAtIGJldC5saW5lIGlzIDEweCB0aGUgYWN0dWFsIGxpbmUgdG8gYWxsb3cgaGFsZi1wb2ludCBzcHJlYWRzDQogICAgICAgIGludCB0b3RhbFBvaW50cyA9IChnYW1lLnJlc3VsdC5ob21lICsgZ2FtZS5yZXN1bHQuYXdheSkgKiAxMDsNCiAgICAgICAgZm9yIChpPTA7IGkgPCBvdmVyVW5kZXJCZXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBiZXQgPSBvdmVyVW5kZXJCZXRzW2ldOw0KICAgICAgICAgICAgaWYgKGJldC5zdGF0dXMgPT0gQmV0U3RhdHVzLlBhaWQpDQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICBpZiAodG90YWxQb2ludHMgPiBiZXQubGluZSkNCiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuaG9tZV0gKz0gYmV0LmFtb3VudCAqIDI7DQogICAgICAgICAgICBlbHNlIGlmICh0b3RhbFBvaW50cyA8IGJldC5saW5lKQ0KICAgICAgICAgICAgICAgIGJhbGFuY2VzW2JldC5hd2F5XSArPSBiZXQuYW1vdW50ICogMjsNCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGJhbGFuY2VzW2JldC5hd2F5XSArPSBiZXQuYW1vdW50Ow0KICAgICAgICAgICAgICAgIGJhbGFuY2VzW2JldC5ob21lXSArPSBiZXQuYW1vdW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYmV0LnN0YXR1cyA9IEJldFN0YXR1cy5QYWlkOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIC0xOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHZlcmlmeUdhbWVSZXN1bHQoYnl0ZXMzMiBnYW1lX2lkKSByZXR1cm5zIChpbnQpIHsNCiAgICAgICAgR2FtZSBnYW1lID0gZ2V0R2FtZUJ5SWQoZ2FtZV9pZCk7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGdhbWUuY3JlYXRvcikgcmV0dXJuIDE7DQogICAgICAgIGlmIChnYW1lLnN0YXR1cyAhPSBHYW1lU3RhdHVzLlNjb3JlZCkgcmV0dXJuIDI7DQogICAgICAgIGlmIChub3cgPCBnYW1lLnJlc3VsdC50aW1lc3RhbXAgKyAxMiozNjAwKSByZXR1cm4gMzsgLy8gbXVzdCB3YWl0IDEyIGhvdXJzIHRvIHZlcmlmeSANCg0KICAgICAgICBwYXlCZXRzKGdhbWVfaWQpOw0KICAgICAgICBnYW1lLnN0YXR1cyA9IEdhbWVTdGF0dXMuVmVyaWZpZWQ7DQogICAgICAgIEdhbWVWZXJpZmllZChnYW1lX2lkKTsNCg0KICAgICAgICByZXR1cm4gLTE7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0R2FtZVJlc3VsdChieXRlczMyIGdhbWVfaWQsIGludCBob21lU2NvcmUsIGludCBhd2F5U2NvcmUpIHJldHVybnMgKGludCkgew0KICAgICAgICBHYW1lIGdhbWUgPSBnZXRHYW1lQnlJZChnYW1lX2lkKTsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gZ2FtZS5jcmVhdG9yKSByZXR1cm4gMTsNCiAgICAgICAgaWYgKGdhbWUubG9ja3RpbWUgPiBub3cpIHJldHVybiAyOw0KICAgICAgICBpZiAoZ2FtZS5zdGF0dXMgPT0gR2FtZVN0YXR1cy5WZXJpZmllZCkgcmV0dXJuIDM7DQoNCiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgNDsgaSsrKQ0KICAgICAgICAgICAgY2FuY2VsT3BlbkJpZHMoZ2FtZS5ib29rc1tpXSk7DQoNCiAgICAgICAgZ2FtZS5yZXN1bHQuaG9tZSA9IGhvbWVTY29yZTsNCiAgICAgICAgZ2FtZS5yZXN1bHQuYXdheSA9IGF3YXlTY29yZTsNCiAgICAgICAgZ2FtZS5yZXN1bHQudGltZXN0YW1wID0gbm93Ow0KICAgICAgICBnYW1lLnN0YXR1cyA9IEdhbWVTdGF0dXMuU2NvcmVkOw0KICAgICAgICBHYW1lU2NvcmVkKGdhbWVfaWQsIGhvbWVTY29yZSwgYXdheVNjb3JlLCBub3cpOw0KDQogICAgICAgIHJldHVybiAtMTsNCiAgICB9DQoNCiAgICAvLyBsaW5lIGlzIGFjdHVhbGx5IDEweCB0aGUgbGluZSB0byBhbGxvdyBmb3IgaGFsZi1wb2ludCBzcHJlYWRzDQogICAgZnVuY3Rpb24gYmlkKGJ5dGVzMzIgZ2FtZV9pZCwgQm9va1R5cGUgYm9va190eXBlLCBib29sIGhvbWUsIGludDMyIGxpbmUpIHBheWFibGUgcmV0dXJucyAoaW50KSB7DQogICAgICAgIGlmIChib29rX3R5cGUgPT0gQm9va1R5cGUuTm9uZSkNCiAgICAgICAgICAgIHJldHVybiA1Ow0KDQogICAgICAgIEdhbWUgZ2FtZSA9IGdldEdhbWVCeUlkKGdhbWVfaWQpOw0KICAgICAgICBCb29rIGJvb2sgPSBnYW1lLmJvb2tzW3VpbnQoYm9va190eXBlKV07DQogICAgICAgIEJpZCBtZW1vcnkgYmlkID0gQmlkKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgaG9tZSwgbGluZSk7DQoNCiAgICAgICAgLy8gdmFsaWRhdGUgaW5wdXRzOiBnYW1lIHN0YXR1cywgZ2FtZXRpbWUsIGxpbmUgYW1vdW50DQogICAgICAgIGlmIChnYW1lLnN0YXR1cyAhPSBHYW1lU3RhdHVzLk9wZW4pDQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgaWYgKG5vdyA+IGdhbWUubG9ja3RpbWUpIHsNCiAgICAgICAgICAgIGdhbWUuc3RhdHVzID0gR2FtZVN0YXR1cy5Mb2NrZWQ7ICAgIA0KICAgICAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgNDsgaSsrKQ0KICAgICAgICAgICAgICAgIGNhbmNlbE9wZW5CaWRzKGdhbWUuYm9va3NbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIDI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChib29rX3R5cGUgPT0gQm9va1R5cGUuU3ByZWFkIHx8IGJvb2tfdHlwZSA9PSBCb29rVHlwZS5PdmVyVW5kZXIpDQogICAgICAgICAgICAmJiBsaW5lICUgNSAhPSAwKQ0KICAgICAgICAgICAgcmV0dXJuIDM7DQogICAgICAgIGVsc2UgaWYgKGJvb2tfdHlwZSA9PSBCb29rVHlwZS5Nb25leUxpbmUgJiYgbGluZSA8IDEwMCAmJiBsaW5lID49IC0xMDApDQogICAgICAgICAgICByZXR1cm4gNDsNCg0KICAgICAgICBCaWQgbWVtb3J5IHJlbWFpbmluZ0JpZCA9IG1hdGNoRXhpc3RpbmdCaWRzKGJpZCwgZ2FtZV9pZCwgYm9va190eXBlKTsNCg0KICAgICAgICAvLyBVc2UgbGVmdG92ZXIgZnVuZHMgdG8gcGxhY2Ugb3BlbiBiaWRzIChtYWtlcikNCiAgICAgICAgaWYgKGJpZC5hbW91bnQgPiAwKSB7DQogICAgICAgICAgICBCaWRbXSBiaWRTdGFjayA9IGhvbWUgPyBib29rLmhvbWVCaWRzIDogYm9vay5hd2F5QmlkczsNCiAgICAgICAgICAgIGlmIChib29rX3R5cGUgPT0gQm9va1R5cGUuT3ZlclVuZGVyICYmIGhvbWUpDQogICAgICAgICAgICAgICAgYWRkQmlkVG9TdGFjayhyZW1haW5pbmdCaWQsIGJpZFN0YWNrLCB0cnVlKTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBhZGRCaWRUb1N0YWNrKHJlbWFpbmluZ0JpZCwgYmlkU3RhY2ssIGZhbHNlKTsNCiAgICAgICAgICAgIEJpZFBsYWNlZChnYW1lX2lkLCBib29rX3R5cGUsIHJlbWFpbmluZ0JpZC5iaWRkZXIsIHJlbWFpbmluZ0JpZC5hbW91bnQsIGhvbWUsIGxpbmUpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIC0xOw0KICAgIH0NCg0KICAgIC8vIHJldHVybmluZyBhbiBhcnJheSBvZiBzdHJ1Y3RzIGlzIG5vdCBhbGxvd2VkLCBzbyBpdHMgdGltZSBmb3IgYSBoYWNram9iDQogICAgLy8gdGhhdCByZXR1cm5zIGEgcmF3IGJ5dGVzIGR1bXAgb2YgdGhlIGNvbWJpbmVkIGhvbWUgYW5kIGF3YXkgYmlkcw0KICAgIC8vIGNsaWVudHMgd2lsbCBoYXZlIHRvIHBhcnNlIHRoZSBoZXggZHVtcCB0byBnZXQgdGhlIGJpZHMgb3V0DQogICAgLy8gVGhpcyBmdW5jdGlvbiBpcyBmb3IgREVCVUdHSU5HIFBVUlBPU0VTIE9OTFkuIFVzaW5nIGl0IGluIGEgcHJvZHVjdGlvbg0KICAgIC8vIHNldHRpbmcgd2lsbCByZXR1cm4gdmVyeSBsYXJnZSBieXRlIGFycmF5cyB0aGF0IHdpbGwgY29uc3VtZSB5b3VyIGJhbmR3aWR0aA0KICAgIC8vIGlmIHlvdSBhcmUgbm90IHJ1bm5pbmcgYSBmdWxsIG5vZGUgIA0KICAgIGZ1bmN0aW9uIGdldE9wZW5CaWRzKGJ5dGVzMzIgZ2FtZV9pZCwgQm9va1R5cGUgYm9va190eXBlKSBjb25zdGFudCByZXR1cm5zIChieXRlcykgew0KICAgICAgICBHYW1lIGdhbWUgPSBnZXRHYW1lQnlJZChnYW1lX2lkKTsNCiAgICAgICAgQm9vayBib29rID0gZ2FtZS5ib29rc1t1aW50KGJvb2tfdHlwZSldOw0KICAgICAgICB1aW50IG5CaWRzID0gYm9vay5ob21lQmlkcy5sZW5ndGggKyBib29rLmF3YXlCaWRzLmxlbmd0aDsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHMgPSBuZXcgYnl0ZXMoNTcgKiBuQmlkcyk7DQogICAgICAgIHVpbnQgayA9IDA7DQogICAgICAgIGZvciAodWludCBpPTA7IGkgPCBuQmlkczsgaSsrKSB7DQogICAgICAgICAgICBpZiAoaSA8IGJvb2suaG9tZUJpZHMubGVuZ3RoKQ0KICAgICAgICAgICAgICAgIEJpZCBiaWQgPSBib29rLmhvbWVCaWRzW2ldOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIGJpZCA9IGJvb2suYXdheUJpZHNbaSAtIGJvb2suaG9tZUJpZHMubGVuZ3RoXTsNCiAgICAgICAgICAgIGJ5dGVzMjAgYmlkZGVyID0gYnl0ZXMyMChiaWQuYmlkZGVyKTsNCiAgICAgICAgICAgIGJ5dGVzMzIgYW1vdW50ID0gYnl0ZXMzMihiaWQuYW1vdW50KTsNCiAgICAgICAgICAgIGJ5dGUgaG9tZSA9IGJpZC5ob21lID8gYnl0ZSgxKSA6IGJ5dGUoMCk7DQogICAgICAgICAgICBieXRlczQgbGluZSA9IGJ5dGVzNChiaWQubGluZSk7DQoNCiAgICAgICAgICAgIGZvciAodWludCBqPTA7IGogPCAyMDsgaisrKSB7IHNba10gPSBiaWRkZXJbal07IGsrKzsgfQ0KICAgICAgICAgICAgZm9yIChqPTA7IGogPCAzMjsgaisrKSB7IHNba10gPSBhbW91bnRbal07IGsrKzsgfQ0KICAgICAgICAgICAgc1trXSA9IGhvbWU7IGsrKzsNCiAgICAgICAgICAgIGZvciAoaj0wOyBqIDwgNDsgaisrKSB7IHNba10gPSBsaW5lW2pdOyBrKys7IH0NCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHM7DQogICAgfQ0KDQogICAgLy8gZm9yIGZ1bmN0aW9ucyB0aHJvd2luZyBhIHN0YWNrIHRvbyBkZWVwIGVycm9yLCB0aGlzIGhlbHBlciB3aWxsIGZyZWUgdXAgMiBsb2NhbCB2YXJpYWJsZSBzcG90cw0KICAgIGZ1bmN0aW9uIGdldEJvb2soYnl0ZXMzMiBnYW1lX2lkLCBCb29rVHlwZSBib29rX3R5cGUpIGNvbnN0YW50IHByaXZhdGUgcmV0dXJucyAoQm9vayBzdG9yYWdlKSB7DQogICAgICAgIEdhbWUgZ2FtZSA9IGdldEdhbWVCeUlkKGdhbWVfaWQpOw0KICAgICAgICBCb29rIGJvb2sgPSBnYW1lLmJvb2tzW3VpbnQoYm9va190eXBlKV07DQogICAgICAgIHJldHVybiBib29rOw0KICAgIH0NCg0KICAgIA0KICAgIC8vIGZvciBvdmVyL3VuZGVyIGJpZHMsIHRoZSBob21lIGJvb2xlYW4gaXMgZXF1aXZhbGVudCB0byB0aGUgb3Zlcg0KICAgIGZ1bmN0aW9uIG1hdGNoRXhpc3RpbmdCaWRzKEJpZCBiaWQsIGJ5dGVzMzIgZ2FtZV9pZCwgQm9va1R5cGUgYm9va190eXBlKSBwcml2YXRlIHJldHVybnMgKEJpZCkgew0KICAgICAgICBCb29rIGJvb2sgPSBnZXRCb29rKGdhbWVfaWQsIGJvb2tfdHlwZSk7DQogICAgICAgIGJvb2wgaG9tZSA9IGJpZC5ob21lOw0KICAgICAgICBCaWRbXSBtYXRjaFN0YWNrID0gaG9tZSA/ICBib29rLmF3YXlCaWRzIDogYm9vay5ob21lQmlkczsNCiAgICAgICAgaW50IGkgPSBpbnQobWF0Y2hTdGFjay5sZW5ndGgpIC0gMTsNCiAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBiaWQuYW1vdW50ID4gMCkgew0KICAgICAgICAgICAgdWludCBqID0gdWludChpKTsNCiAgICAgICAgICAgIGlmIChtYXRjaFN0YWNrW2pdLmFtb3VudCA9PSAwKSB7IC8vIGRlbGV0ZWQgYmlkcw0KICAgICAgICAgICAgICAgIGktLTsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChib29rX3R5cGUgPT0gQm9va1R5cGUuT3ZlclVuZGVyKSB7DQogICAgICAgICAgICAgICAgaWYgKGhvbWUgJiYgYmlkLmxpbmUgPCBtYXRjaFN0YWNrW2pdLmxpbmUgDQogICAgICAgICAgICAgICAgfHwgIWhvbWUgJiYgYmlkLmxpbmUgPiBtYXRjaFN0YWNrW2pdLmxpbmUpDQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICgtYmlkLmxpbmUgPCBtYXRjaFN0YWNrW2pdLmxpbmUpDQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIC8vIGRldGVybWluZWQgcmVxdWlyZWQgYmV0IGFtb3VudCB0byBtYXRjaCBzdGFjayBiaWQNCiAgICAgICAgICAgIHVpbnQgcmVxdWlyZWRCZXQ7DQogICAgICAgICAgICBpZiAoYm9va190eXBlID09IEJvb2tUeXBlLlNwcmVhZCB8fCBib29rX3R5cGUgPT0gQm9va1R5cGUuT3ZlclVuZGVyKQ0KICAgICAgICAgICAgICAgIHJlcXVpcmVkQmV0ID0gbWF0Y2hTdGFja1tqXS5hbW91bnQ7DQogICAgICAgICAgICBlbHNlIGlmIChtYXRjaFN0YWNrW2pdLmxpbmUgPiAwKSB7IC8vIGltcGxpZWQgTW9uZXlMaW5lDQogICAgICAgICAgICAgICAgcmVxdWlyZWRCZXQgPSBtYXRjaFN0YWNrW2pdLmFtb3VudCAqIHVpbnQobWF0Y2hTdGFja1tqXS5saW5lKSAvIDEwMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgeyAvLyBpbXBsaWVkIE1vbmV5TGluZSBhbmQgbmVnYXRpdmUgbGluZQ0KICAgICAgICAgICAgICAgIHJlcXVpcmVkQmV0ID0gbWF0Y2hTdGFja1tqXS5hbW91bnQgKiAxMDAgLyB1aW50KC1tYXRjaFN0YWNrW2pdLmxpbmUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBkZXRlcm1pbmUgYmV0IGFtb3VudHMgb24gYm90aCBzaWRlcw0KICAgICAgICAgICAgdWludCBiZXRBbW91bnQ7DQogICAgICAgICAgICB1aW50IG9wcG9zaW5nQmV0QW1vdW50Ow0KICAgICAgICAgICAgaWYgKGJpZC5hbW91bnQgPCByZXF1aXJlZEJldCkgew0KICAgICAgICAgICAgICAgIGJldEFtb3VudCA9IGJpZC5hbW91bnQ7DQogICAgICAgICAgICAgICAgaWYgKGJvb2tfdHlwZSA9PSBCb29rVHlwZS5TcHJlYWQgfHwgYm9va190eXBlID09IEJvb2tUeXBlLk92ZXJVbmRlcikNCiAgICAgICAgICAgICAgICAgICAgb3Bwb3NpbmdCZXRBbW91bnQgPSBiaWQuYW1vdW50Ow0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1hdGNoU3RhY2tbal0ubGluZSA+IDApDQogICAgICAgICAgICAgICAgICAgIG9wcG9zaW5nQmV0QW1vdW50ID0gYmV0QW1vdW50ICogMTAwIC8gdWludChtYXRjaFN0YWNrW2pdLmxpbmUpOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgb3Bwb3NpbmdCZXRBbW91bnQgPSBiaWQuYW1vdW50ICogdWludCgtbWF0Y2hTdGFja1tqXS5saW5lKSAvIDEwMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGJldEFtb3VudCA9IHJlcXVpcmVkQmV0Ow0KICAgICAgICAgICAgICAgIG9wcG9zaW5nQmV0QW1vdW50ID0gbWF0Y2hTdGFja1tqXS5hbW91bnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBiaWQuYW1vdW50IC09IGJldEFtb3VudDsNCiAgICAgICAgICAgIG1hdGNoU3RhY2tbal0uYW1vdW50IC09IG9wcG9zaW5nQmV0QW1vdW50Ow0KDQogICAgICAgICAgICBpbnQzMiBteUxpbmU7DQogICAgICAgICAgICBpZiAoYm9va190eXBlID09IEJvb2tUeXBlLk92ZXJVbmRlcikNCiAgICAgICAgICAgICAgICBteUxpbmUgPSBtYXRjaFN0YWNrW2pdLmxpbmU7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgbXlMaW5lID0gLW1hdGNoU3RhY2tbal0ubGluZTsNCiAgICAgICAgICAgIEJldCBtZW1vcnkgYmV0ID0gQmV0KA0KICAgICAgICAgICAgICAgIGhvbWUgPyBiaWQuYmlkZGVyIDogbWF0Y2hTdGFja1tqXS5iaWRkZXIsDQogICAgICAgICAgICAgICAgaG9tZSA/IG1hdGNoU3RhY2tbal0uYmlkZGVyIDogYmlkLmJpZGRlciwNCiAgICAgICAgICAgICAgICBob21lID8gYmV0QW1vdW50IDogb3Bwb3NpbmdCZXRBbW91bnQsDQogICAgICAgICAgICAgICAgaG9tZSA/IG15TGluZSA6IG1hdGNoU3RhY2tbal0ubGluZSwNCiAgICAgICAgICAgICAgICBCZXRTdGF0dXMuT3Blbg0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIGJvb2suYmV0cy5wdXNoKGJldCk7DQogICAgICAgICAgICBCZXRQbGFjZWQoZ2FtZV9pZCwgYm9va190eXBlLCBiaWQuYmlkZGVyLCBob21lLCBiZXRBbW91bnQsIG15TGluZSk7DQogICAgICAgICAgICBCZXRQbGFjZWQoZ2FtZV9pZCwgYm9va190eXBlLCBtYXRjaFN0YWNrW2pdLmJpZGRlciwgDQogICAgICAgICAgICAgICAgIWhvbWUsIG9wcG9zaW5nQmV0QW1vdW50LCBtYXRjaFN0YWNrW2pdLmxpbmUpOw0KICAgICAgICAgICAgaS0tOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBiaWQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2FuY2VsQmlkKGJ5dGVzMzIgZ2FtZV9pZCwgQm9va1R5cGUgYm9va190eXBlLCBpbnQzMiBsaW5lLCBib29sIGhvbWUpIHJldHVybnMgKGludCkgew0KICAgICAgICBCb29rIGJvb2sgPSBnZXRCb29rKGdhbWVfaWQsIGJvb2tfdHlwZSk7DQogICAgICAgIEJpZFtdIHN0YWNrID0gaG9tZSA/IGJvb2suaG9tZUJpZHMgOiBib29rLmF3YXlCaWRzOw0KICAgICAgICBhZGRyZXNzIGJpZGRlciA9IG1zZy5zZW5kZXI7DQoNCiAgICAgICAgLy8gRGVsZXRlIGJpZCBpbiBzdGFjaywgcmVmdW5kIGFtb3VudCB0byB1c2VyDQogICAgICAgIGZvciAodWludCBpPTA7IGkgPCBzdGFjay5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKHN0YWNrW2ldLmFtb3VudCA+IDAgJiYgc3RhY2tbaV0uYmlkZGVyID09IGJpZGRlciAmJiBzdGFja1tpXS5saW5lID09IGxpbmUpIHsNCiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiaWRkZXJdICs9IHN0YWNrW2ldLmFtb3VudDsNCiAgICAgICAgICAgICAgICBkZWxldGUgc3RhY2tbaV07DQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAxOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGtpbGwgKCkgew0KICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBvd25lcikgc2VsZmRlc3RydWN0KG93bmVyKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRHYW1lSWQgKGFkZHJlc3MgY3JlYXRvciwgc3RyaW5nIGhvbWUsIHN0cmluZyBhd2F5LCB1aW50MTYgY2F0ZWdvcnksIHVpbnQ2NCBsb2NrdGltZSkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgew0KICAgICAgICB1aW50IGkgPSAwOw0KICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKGhvbWUpOw0KICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKGF3YXkpOw0KICAgICAgICBieXRlczIgYyA9IGJ5dGVzMihjYXRlZ29yeSk7DQogICAgICAgIGJ5dGVzOCBkID0gYnl0ZXM4KGxvY2t0aW1lKTsNCiAgICAgICAgYnl0ZXMyMCBlID0gYnl0ZXMyMChjcmVhdG9yKTsNCg0KICAgICAgICB1aW50IGxlbmd0aCA9IGEubGVuZ3RoICsgYi5sZW5ndGggKyBjLmxlbmd0aCArIGQubGVuZ3RoICsgZS5sZW5ndGg7DQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b0hhc2ggPSBuZXcgYnl0ZXMobGVuZ3RoKTsNCiAgICAgICAgdWludCBrID0gMDsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIHsgdG9IYXNoW2tdID0gYVtpXTsgaysrOyB9DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBiLmxlbmd0aDsgaSsrKSB7IHRvSGFzaFtrXSA9IGJbaV07IGsrKzsgfQ0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYy5sZW5ndGg7IGkrKykgeyB0b0hhc2hba10gPSBjW2ldOyBrKys7IH0NCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGQubGVuZ3RoOyBpKyspIHsgdG9IYXNoW2tdID0gZFtpXTsgaysrOyB9DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBlLmxlbmd0aDsgaSsrKSB7IHRvSGFzaFtrXSA9IGVbaV07IGsrKzsgfQ0KICAgICAgICByZXR1cm4gc2hhMyh0b0hhc2gpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBnZXRBY3RpdmVHYW1lcyAoKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyW10pIHsNCiAgICAgICAgYnl0ZXMzMltdIG1lbW9yeSBnYW1lX2lkcyA9IG5ldyBieXRlczMyW10oZ2FtZXMubGVuZ3RoKTsNCiAgICAgICAgZm9yICh1aW50IGk9MDsgaSA8IGdhbWVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBnYW1lX2lkc1tpXSA9IChnYW1lc1tpXS5pZCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGdhbWVfaWRzOw0KICAgIH0NCiAgICAgICAgDQogICAgZnVuY3Rpb24gYWRkQmlkVG9TdGFjayhCaWQgYmlkLCBCaWRbXSBzdG9yYWdlIHN0YWNrLCBib29sIHJldmVyc2UpIHByaXZhdGUgcmV0dXJucyAoaW50KSB7DQogICAgICAgIGlmIChzdGFjay5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgc3RhY2sucHVzaChiaWQpOw0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBkZXRlcm1pbmUgcG9zaXRpb24gb2YgbmV3IGJpZCBpbiBzdGFjaw0KICAgICAgICB1aW50IGluc2VydEluZGV4ID0gc3RhY2subGVuZ3RoOw0KICAgICAgICBpZiAocmV2ZXJzZSkgew0KICAgICAgICAgICAgd2hpbGUgKGluc2VydEluZGV4ID4gMCAmJiBiaWQubGluZSA8PSBzdGFja1tpbnNlcnRJbmRleC0xXS5saW5lKQ0KICAgICAgICAgICAgICAgIGluc2VydEluZGV4LS07DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB3aGlsZSAoaW5zZXJ0SW5kZXggPiAwICYmIGJpZC5saW5lID49IHN0YWNrW2luc2VydEluZGV4LTFdLmxpbmUpDQogICAgICAgICAgICAgICAgaW5zZXJ0SW5kZXgtLTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gdHJ5IHRvIGZpbmQgZGVsZXRlZCBzbG90IHRvIGZpbGwNCiAgICAgICAgaWYgKGluc2VydEluZGV4ID4gMCAmJiBzdGFja1tpbnNlcnRJbmRleCAtIDFdLmFtb3VudCA9PSAwKSB7DQogICAgICAgICAgICBzdGFja1tpbnNlcnRJbmRleCAtIDFdID0gYmlkOw0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIHVpbnQgc2hpZnRFbmRJbmRleCA9IGluc2VydEluZGV4Ow0KICAgICAgICB3aGlsZSAoc2hpZnRFbmRJbmRleCA8IHN0YWNrLmxlbmd0aCAmJiBzdGFja1tzaGlmdEVuZEluZGV4XS5hbW91bnQgPiAwKSB7DQogICAgICAgICAgICBzaGlmdEVuZEluZGV4Kys7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIHNoaWZ0IGJpZHMgZG93biAodXAgdG8gZGVsZXRlZCBpbmRleCBpZiBvbmUgZXhpc3RzKQ0KICAgICAgICBpZiAoc2hpZnRFbmRJbmRleCA9PSBzdGFjay5sZW5ndGgpDQogICAgICAgICAgICBzdGFjay5sZW5ndGggKz0gMTsNCiAgICAgICAgZm9yICh1aW50IGkgPSBzaGlmdEVuZEluZGV4OyBpID4gaW5zZXJ0SW5kZXg7IGktLSkgew0KICAgICAgICAgICAgc3RhY2tbaV0gPSBzdGFja1tpLTFdOw0KICAgICAgICB9IA0KDQogICAgICAgIHN0YWNrW2luc2VydEluZGV4XSA9IGJpZDsNCiAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIC0xOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldEdhbWVCeUlkKGJ5dGVzMzIgZ2FtZV9pZCkgY29uc3RhbnQgcHJpdmF0ZSByZXR1cm5zIChHYW1lIHN0b3JhZ2UpIHsNCiAgICAgICAgYm9vbCBnYW1lX2V4aXN0cyA9IGZhbHNlOw0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBnYW1lcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGdhbWVzW2ldLmlkID09IGdhbWVfaWQpIHsNCiAgICAgICAgICAgICAgICBHYW1lIGdhbWUgPSBnYW1lc1tpXTsNCiAgICAgICAgICAgICAgICBnYW1lX2V4aXN0cyA9IHRydWU7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFnYW1lX2V4aXN0cykNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICByZXR1cm4gZ2FtZTsNCiAgICB9DQoNCg0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCkgcmV0dXJucyAoaW50KSB7DQogICAgICAgIHZhciBiYWxhbmNlID0gYmFsYW5jZXNbbXNnLnNlbmRlcl07DQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gMDsNCiAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQoYmFsYW5jZSkpIHsNCiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZTsNCiAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICB9DQogICAgICAgIFdpdGhkcmF3YWwobXNnLnNlbmRlciwgYmFsYW5jZSwgbm93KTsNCiAgICAgICAgcmV0dXJuIC0xOw0KICAgIH0NCg0KfQ=='