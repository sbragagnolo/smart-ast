base 64 content
base64pray4Prey
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQovLyA8T1JBQ0xJWkVfQVBJPg0KLyoNCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTA0KQ29weXJpZ2h0IChjKSAyMDE2IE9yYWNsaXplIExURA0KDQoNCg0KUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQ0Kb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwNCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMNCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwNCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcw0KZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoNCg0KDQoNClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCg0KDQoNClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQpPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQpUSEUgU09GVFdBUkUuDQoqLw0KDQoNCmNvbnRyYWN0IE9yYWNsaXplSSB7DQogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7DQogICAgZnVuY3Rpb24gcXVlcnlfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZywgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7DQogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsNCiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOw0KICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7DQogICAgZnVuY3Rpb24gc2V0UHJvb2ZUeXBlKGJ5dGUgX3Byb29mVHlwZSk7DQogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7DQogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOw0KfQ0KY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsNCiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7DQp9DQpjb250cmFjdCB1c2luZ09yYWNsaXplIHsNCiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0Ow0KICAgIHVpbnQgY29uc3RhbnQgd2VlayA9IDYwKjYwKjI0Kjc7DQogICAgdWludCBjb25zdGFudCBtb250aCA9IDYwKjYwKjI0KjMwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX1RMU05vdGFyeSA9IDB4MTA7DQogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsNCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsNCg0KICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7DQogICAgDQogICAgT3JhY2xpemVJIG9yYWNsaXplOw0KICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsNCiAgICAgICAgaWYoYWRkcmVzcyhPQVIpPT0wKSBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsNCiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7DQogICAgICAgIF87DQogICAgfQ0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7DQogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOw0KICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yayh1aW50OCBuZXR3b3JrSUQpIGludGVybmFsIHJldHVybnMoYm9vbCl7DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM2IyNjM4YTdjYzlmMmNiM2QyOThhM2RhN2E5MGI2N2U1NTA2ZWQpPjApeyAvL21haW5uZXQNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM2IyNjM4YTdjYzlmMmNiM2QyOThhM2RhN2E5MGI2N2U1NTA2ZWQpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4YzAzYTI2MTVkNWVmYWY1ZjQ5ZjYwYjdiYjY1ODNlYWVjMjEyZmRmMSk+MCl7IC8vcm9wc3RlbiB0ZXN0bmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNhMjYxNWQ1ZWZhZjVmNDlmNjBiN2JiNjU4M2VhZWMyMTJmZGYxKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyYTFmODU5YjNmZWFlNWZiMmEwYTMyYzE4ZjVhNjU1NTViYmYpPjApeyAvL2V0aGVyLmNhbXAgaWRlDQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgyMGUxMmExZjg1OWIzZmVhZTVmYjJhMGEzMmMxOGY1YTY1NTU1YmJmKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDkzYmJiZTVjZTc3MDM0ZTMwOTVmMDQ3OTkxOTk2MmE5MDNmODk4YWQpPjApeyAvL25vcnNib3JnIHRlc3RuZXQNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDkzYmJiZTVjZTc3MDM0ZTMwOTVmMDQ3OTkxOTk2MmE5MDNmODk4YWQpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NTFlZmFmNGM4YjNjOWFmYmQ1YWI5ZjRiYmM4Mjc4NGFiNmVmOGZhYSk+MCl7IC8vYnJvd3Nlci1zb2xpZGl0eQ0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NTFlZmFmNGM4YjNjOWFmYmQ1YWI5ZjRiYmM4Mjc4NGFiNmVmOGZhYSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7DQogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRQcm9vZihieXRlIHByb29mUCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsNCiAgICB9ICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q29uZmlnKGNvbmZpZyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0Q29kZVNpemUoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50IF9zaXplKSB7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIF9zaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQ0KICAgICAgICB9DQogICAgfQ0KDQoNCiAgICBmdW5jdGlvbiBwYXJzZUFkZHIoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRtcCA9IGJ5dGVzKF9hKTsNCiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7DQogICAgICAgIHVpbnQxNjAgYjE7DQogICAgICAgIHVpbnQxNjAgYjI7DQogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsNCiAgICAgICAgICAgIGlhZGRyICo9IDI1NjsNCiAgICAgICAgICAgIGIxID0gdWludDE2MCh0bXBbaV0pOw0KICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsNCiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpJiYoYjEgPD0gMTAyKSkgYjEgLT0gODc7DQogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpJiYoYjEgPD0gNTcpKSBiMSAtPSA0ODsNCiAgICAgICAgICAgIGlmICgoYjIgPj0gOTcpJiYoYjIgPD0gMTAyKSkgYjIgLT0gODc7DQogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNDgpJiYoYjIgPD0gNTcpKSBiMiAtPSA0ODsNCiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGFkZHJlc3MoaWFkZHIpOw0KICAgIH0NCg0KDQogICAgZnVuY3Rpb24gc3RyQ29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOw0KICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsNCiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsNCiAgICAgICAgaWYgKGIubGVuZ3RoIDwgbWluTGVuZ3RoKSBtaW5MZW5ndGggPSBiLmxlbmd0aDsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQ0KICAgICAgICAgICAgaWYgKGFbaV0gPCBiW2ldKQ0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQ0KICAgICAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICBpZiAoYS5sZW5ndGggPCBiLmxlbmd0aCkNCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgZWxzZSBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkNCiAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gMDsNCiAgIH0gDQoNCiAgICBmdW5jdGlvbiBpbmRleE9mKHN0cmluZyBfaGF5c3RhY2ssIHN0cmluZyBfbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpDQogICAgew0KICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBuID0gYnl0ZXMoX25lZWRsZSk7DQogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKSANCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQ0KICAgICAgICAgICAgcmV0dXJuIC0xOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgZWxzZQ0KICAgICAgICB7DQogICAgICAgICAgICB1aW50IHN1YmluZGV4ID0gMDsNCiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChoW2ldID09IG5bMF0pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlKHN1YmluZGV4IDwgbi5sZW5ndGggJiYgKGkgKyBzdWJpbmRleCkgPCBoLmxlbmd0aCAmJiBoW2kgKyBzdWJpbmRleF0gPT0gbltzdWJpbmRleF0pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7DQogICAgICAgICAgICAgICAgICAgIH0gICANCiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgfSAgIA0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QsIHN0cmluZyBfZSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYSA9IGJ5dGVzKF9hKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZCA9IGJ5dGVzKF9kKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsNCiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOw0KICAgICAgICBieXRlcyBtZW1vcnkgYmFiY2RlID0gYnl0ZXMoYWJjZGUpOw0KICAgICAgICB1aW50IGsgPSAwOw0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JiLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYltpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JlLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZVtpXTsNCiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsNCiAgICB9DQoNCiAgICAvLyBwYXJzZUludA0KICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOw0KICAgIH0NCg0KICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpDQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOw0KICAgICAgICB1aW50IG1pbnQgPSAwOw0KICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7DQogICAgICAgIGZvciAodWludCBpPTA7IGk8YnJlc3VsdC5sZW5ndGg7IGkrKyl7DQogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1Nykpew0KICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7DQogICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7DQogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsNCiAgICAgICAgcmV0dXJuIG1pbnQ7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHVpbnQyc3RyKHVpbnQgaSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsNCiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsNCiAgICAgICAgdWludCBqID0gaTsNCiAgICAgICAgdWludCBsZW47DQogICAgICAgIHdoaWxlIChqICE9IDApew0KICAgICAgICAgICAgbGVuKys7DQogICAgICAgICAgICBqIC89IDEwOw0KICAgICAgICB9DQogICAgICAgIGJ5dGVzIG1lbW9yeSBic3RyID0gbmV3IGJ5dGVzKGxlbik7DQogICAgICAgIHVpbnQgayA9IGxlbiAtIDE7DQogICAgICAgIHdoaWxlIChpICE9IDApew0KICAgICAgICAgICAgYnN0cltrLS1dID0gYnl0ZSg0OCArIGkgJSAxMCk7DQogICAgICAgICAgICBpIC89IDEwOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzdHJpbmcoYnN0cik7DQogICAgfQ0KICAgIA0KICAgIA0KDQp9DQovLyA8L09SQUNMSVpFX0FQST4NCg0KDQoNCmNvbnRyYWN0IG1vcnRhbCB7DQoJYWRkcmVzcyBvd25lcjsNCg0KCWZ1bmN0aW9uIG1vcnRhbCgpIHsNCgkJb3duZXIgPSBtc2cuc2VuZGVyOw0KCX0NCg0KCWZ1bmN0aW9uIGtpbGwoKSBpbnRlcm5hbCB7DQoJCXN1aWNpZGUob3duZXIpOw0KCX0NCn0NCg0KDQoNCg0KbGlicmFyeSBzdHJpbmdzIHsNCiAgICBzdHJ1Y3Qgc2xpY2Ugew0KICAgICAgICB1aW50IF9sZW47DQogICAgICAgIHVpbnQgX3B0cjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBtZW1jcHkodWludCBkZXN0LCB1aW50IHNyYywgdWludCBsZW4pIHByaXZhdGUgew0KICAgICAgICAvLyBDb3B5IHdvcmQtbGVuZ3RoIGNodW5rcyB3aGlsZSBwb3NzaWJsZQ0KICAgICAgICBmb3IoOyBsZW4gPj0gMzI7IGxlbiAtPSAzMikgew0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIG1zdG9yZShkZXN0LCBtbG9hZChzcmMpKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGVzdCArPSAzMjsNCiAgICAgICAgICAgIHNyYyArPSAzMjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENvcHkgcmVtYWluaW5nIGJ5dGVzDQogICAgICAgIHVpbnQgbWFzayA9IDI1NiAqKiAoMzIgLSBsZW4pIC0gMTsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgbGV0IHNyY3BhcnQgOj0gYW5kKG1sb2FkKHNyYyksIG5vdChtYXNrKSkNCiAgICAgICAgICAgIGxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoZGVzdCksIG1hc2spDQogICAgICAgICAgICBtc3RvcmUoZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc3RyaW5nIHRvIG1ha2UgYSBzbGljZSBmcm9tLg0KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0b1NsaWNlKHN0cmluZyBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0cjsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmLCAweDIwKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzbGljZShieXRlcyhzZWxmKS5sZW5ndGgsIHB0cik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgYSBudWxsLXRlcm1pbmF0ZWQgYnl0ZXMzMiBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHZhbHVlIHRvIGZpbmQgdGhlIGxlbmd0aCBvZi4NCiAgICAgKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHN0cmluZywgZnJvbSAwIHRvIDMyLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxlbihieXRlczMyIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdWludCByZXQ7DQogICAgICAgIGlmIChzZWxmID09IDApDQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmID09IDApIHsNCiAgICAgICAgICAgIHJldCArPSAxNjsNCiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDg7DQogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDAwMDAwMDAwMCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmID09IDApIHsNCiAgICAgICAgICAgIHJldCArPSA0Ow0KICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZiA9PSAwKSB7DQogICAgICAgICAgICByZXQgKz0gMjsNCiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDE7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIDMyIC0gcmV0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBieXRlczMyLCBpbnRlcnByZXRlZCBhcyBhDQogICAgICogICAgICBudWxsLXRlcm1pbnRhZWQgdXRmLTggc3RyaW5nLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBieXRlczMyIHZhbHVlIHRvIGNvbnZlcnQgdG8gYSBzbGljZS4NCiAgICAgKiBAcmV0dXJuIEEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHZhbHVlIG9mIHRoZSBpbnB1dCBhcmd1bWVudCB1cCB0byB0aGUNCiAgICAgKiAgICAgICAgIGZpcnN0IG51bGwuDQogICAgICovDQogICAgZnVuY3Rpb24gdG9TbGljZUIzMihieXRlczMyIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHJldCkgew0KICAgICAgICAvLyBBbGxvY2F0ZSBzcGFjZSBmb3IgYHNlbGZgIGluIG1lbW9yeSwgY29weSBpdCB0aGVyZSwgYW5kIHBvaW50IHJldCBhdCBpdA0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBsZXQgcHRyIDo9IG1sb2FkKDB4NDApDQogICAgICAgICAgICBtc3RvcmUoMHg0MCwgYWRkKHB0ciwgMHgyMCkpDQogICAgICAgICAgICBtc3RvcmUocHRyLCBzZWxmKQ0KICAgICAgICAgICAgbXN0b3JlKGFkZChyZXQsIDB4MjApLCBwdHIpDQogICAgICAgIH0NCiAgICAgICAgcmV0Ll9sZW4gPSBsZW4oc2VsZik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIGEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyB0aGUgY3VycmVudCBzbGljZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4NCiAgICAgKiBAcmV0dXJuIEEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gY29weShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICByZXR1cm4gc2xpY2Uoc2VsZi5fbGVuLCBzZWxmLl9wdHIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgQ29waWVzIGEgc2xpY2UgdG8gYSBuZXcgc3RyaW5nLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5Lg0KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNsaWNlJ3MgdGV4dC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0b1N0cmluZyhzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuKTsNCiAgICAgICAgdWludCByZXRwdHI7DQogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9DQoNCiAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIGluIHJ1bmVzIG9mIHRoZSBzbGljZS4gTm90ZSB0aGF0IHRoaXMgb3BlcmF0aW9uDQogICAgICogICAgICB0YWtlcyB0aW1lIHByb3BvcnRpb25hbCB0byB0aGUgbGVuZ3RoIG9mIHRoZSBzbGljZTsgYXZvaWQgdXNpbmcgaXQNCiAgICAgKiAgICAgIGluIGxvb3BzLCBhbmQgY2FsbCBgc2xpY2UuZW1wdHkoKWAgaWYgeW91IG9ubHkgbmVlZCB0byBrbm93IHdoZXRoZXINCiAgICAgKiAgICAgIHRoZSBzbGljZSBpcyBlbXB0eSBvciBub3QuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzbGljZSBpbiBydW5lcy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBsZW4oc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICAvLyBTdGFydGluZyBhdCBwdHItMzEgbWVhbnMgdGhlIExTQiB3aWxsIGJlIHRoZSBieXRlIHdlIGNhcmUgYWJvdXQNCiAgICAgICAgdmFyIHB0ciA9IHNlbGYuX3B0ciAtIDMxOw0KICAgICAgICB2YXIgZW5kID0gcHRyICsgc2VsZi5fbGVuOw0KICAgICAgICBmb3IgKHVpbnQgbGVuID0gMDsgcHRyIDwgZW5kOyBsZW4rKykgew0KICAgICAgICAgICAgdWludDggYjsNCiAgICAgICAgICAgIGFzc2VtYmx5IHsgYiA6PSBhbmQobWxvYWQocHRyKSwgMHhGRikgfQ0KICAgICAgICAgICAgaWYgKGIgPCAweDgwKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDE7DQogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gMjsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSAzOw0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEY4KSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDQ7DQogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RkMpIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gNTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDY7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGxlbjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgaXMgZW1wdHkgKGhhcyBhIGxlbmd0aCBvZiAwKS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5LCBGYWxzZSBvdGhlcndpc2UuDQogICAgICovDQogICAgZnVuY3Rpb24gZW1wdHkoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gc2VsZi5fbGVuID09IDA7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIGEgcG9zaXRpdmUgbnVtYmVyIGlmIGBvdGhlcmAgY29tZXMgbGV4aWNvZ3JhcGhpY2FsbHkgYWZ0ZXINCiAgICAgKiAgICAgIGBzZWxmYCwgYSBuZWdhdGl2ZSBudW1iZXIgaWYgaXQgY29tZXMgYmVmb3JlLCBvciB6ZXJvIGlmIHRoZQ0KICAgICAqICAgICAgY29udGVudHMgb2YgdGhlIHR3byBzbGljZXMgYXJlIGVxdWFsLiBDb21wYXJpc29uIGlzIGRvbmUgcGVyLXJ1bmUsDQogICAgICogICAgICBvbiB1bmljb2RlIGNvZGVwb2ludHMuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuDQogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29tcGFyZS4NCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHQgb2YgdGhlIGNvbXBhcmlzb24uDQogICAgICovDQogICAgZnVuY3Rpb24gY29tcGFyZShzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQogICAgICAgIHVpbnQgc2hvcnRlc3QgPSBzZWxmLl9sZW47DQogICAgICAgIGlmIChvdGhlci5fbGVuIDwgc2VsZi5fbGVuKQ0KICAgICAgICAgICAgc2hvcnRlc3QgPSBvdGhlci5fbGVuOw0KDQogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyOw0KICAgICAgICB2YXIgb3RoZXJwdHIgPSBvdGhlci5fcHRyOw0KICAgICAgICBmb3IgKHVpbnQgaWR4ID0gMDsgaWR4IDwgc2hvcnRlc3Q7IGlkeCArPSAzMikgew0KICAgICAgICAgICAgdWludCBhOw0KICAgICAgICAgICAgdWludCBiOw0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIGEgOj0gbWxvYWQoc2VsZnB0cikNCiAgICAgICAgICAgICAgICBiIDo9IG1sb2FkKG90aGVycHRyKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGEgIT0gYikgew0KICAgICAgICAgICAgICAgIC8vIE1hc2sgb3V0IGlycmVsZXZhbnQgYnl0ZXMgYW5kIGNoZWNrIGFnYWluDQogICAgICAgICAgICAgICAgdWludCBtYXNrID0gfigyICoqICg4ICogKDMyIC0gc2hvcnRlc3QgKyBpZHgpKSAtIDEpOw0KICAgICAgICAgICAgICAgIHZhciBkaWZmID0gKGEgJiBtYXNrKSAtIChiICYgbWFzayk7DQogICAgICAgICAgICAgICAgaWYgKGRpZmYgIT0gMCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChkaWZmKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNlbGZwdHIgKz0gMzI7DQogICAgICAgICAgICBvdGhlcnB0ciArPSAzMjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaW50KHNlbGYuX2xlbikgLSBpbnQob3RoZXIuX2xlbik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHR3byBzbGljZXMgY29udGFpbiB0aGUgc2FtZSB0ZXh0Lg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29tcGFyZS4NCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlcyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBlcXVhbHMoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIGNvbXBhcmUoc2VsZiwgb3RoZXIpID09IDA7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBFeHRyYWN0cyB0aGUgZmlyc3QgcnVuZSBpbiB0aGUgc2xpY2UgaW50byBgcnVuZWAsIGFkdmFuY2luZyB0aGUNCiAgICAgKiAgICAgIHNsaWNlIHRvIHBvaW50IHRvIHRoZSBuZXh0IHJ1bmUgYW5kIHJldHVybmluZyBgc2VsZmAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIHJ1bmUgVGhlIHNsaWNlIHRoYXQgd2lsbCBjb250YWluIHRoZSBmaXJzdCBydW5lLg0KICAgICAqIEByZXR1cm4gYHJ1bmVgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG5leHRSdW5lKHNsaWNlIHNlbGYsIHNsaWNlIHJ1bmUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHJ1bmUuX3B0ciA9IHNlbGYuX3B0cjsNCg0KICAgICAgICBpZiAoc2VsZi5fbGVuID09IDApIHsNCiAgICAgICAgICAgIHJ1bmUuX2xlbiA9IDA7DQogICAgICAgICAgICByZXR1cm4gcnVuZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHVpbnQgbGVuOw0KICAgICAgICB1aW50IGI7DQogICAgICAgIC8vIExvYWQgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIHJ1bmUgaW50byB0aGUgTFNCcyBvZiBiDQogICAgICAgIGFzc2VtYmx5IHsgYiA6PSBhbmQobWxvYWQoc3ViKG1sb2FkKGFkZChzZWxmLCAzMikpLCAzMSkpLCAweEZGKSB9DQogICAgICAgIGlmIChiIDwgMHg4MCkgew0KICAgICAgICAgICAgbGVuID0gMTsNCiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7DQogICAgICAgICAgICBsZW4gPSAyOw0KICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsNCiAgICAgICAgICAgIGxlbiA9IDM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBsZW4gPSA0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzDQogICAgICAgIGlmIChsZW4gPiBzZWxmLl9sZW4pIHsNCiAgICAgICAgICAgIHJ1bmUuX2xlbiA9IHNlbGYuX2xlbjsNCiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBzZWxmLl9sZW47DQogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOw0KICAgICAgICAgICAgcmV0dXJuIHJ1bmU7DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLl9wdHIgKz0gbGVuOw0KICAgICAgICBzZWxmLl9sZW4gLT0gbGVuOw0KICAgICAgICBydW5lLl9sZW4gPSBsZW47DQogICAgICAgIHJldHVybiBydW5lOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUgZmlyc3QgcnVuZSBpbiB0aGUgc2xpY2UsIGFkdmFuY2luZyB0aGUgc2xpY2UgdG8gcG9pbnQNCiAgICAgKiAgICAgIHRvIHRoZSBuZXh0IHJ1bmUuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHJldHVybiBBIHNsaWNlIGNvbnRhaW5pbmcgb25seSB0aGUgZmlyc3QgcnVuZSBmcm9tIGBzZWxmYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsNCiAgICAgICAgbmV4dFJ1bmUoc2VsZiwgcmV0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdGhlIGZpcnN0IGNvZGVwb2ludCBpbiB0aGUgc2xpY2UuDQogICAgICovDQogICAgZnVuY3Rpb24gb3JkKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQgcmV0KSB7DQogICAgICAgIGlmIChzZWxmLl9sZW4gPT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCg0KICAgICAgICB1aW50IHdvcmQ7DQogICAgICAgIHVpbnQgbGVuOw0KICAgICAgICB1aW50IGRpdiA9IDIgKiogMjQ4Ow0KDQogICAgICAgIC8vIExvYWQgdGhlIHJ1bmUgaW50byB0aGUgTVNCcyBvZiBiDQogICAgICAgIGFzc2VtYmx5IHsgd29yZDo9IG1sb2FkKG1sb2FkKGFkZChzZWxmLCAzMikpKSB9DQogICAgICAgIHZhciBiID0gd29yZCAvIGRpdjsNCiAgICAgICAgaWYgKGIgPCAweDgwKSB7DQogICAgICAgICAgICByZXQgPSBiOw0KICAgICAgICAgICAgbGVuID0gMTsNCiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7DQogICAgICAgICAgICByZXQgPSBiICYgMHgxRjsNCiAgICAgICAgICAgIGxlbiA9IDI7DQogICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgew0KICAgICAgICAgICAgcmV0ID0gYiAmIDB4MEY7DQogICAgICAgICAgICBsZW4gPSAzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0ID0gYiAmIDB4MDc7DQogICAgICAgICAgICBsZW4gPSA0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzDQogICAgICAgIGlmIChsZW4gPiBzZWxmLl9sZW4pIHsNCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgICAgIGRpdiA9IGRpdiAvIDI1NjsNCiAgICAgICAgICAgIGIgPSAod29yZCAvIGRpdikgJiAweEZGOw0KICAgICAgICAgICAgaWYgKGIgJiAweEMwICE9IDB4ODApIHsNCiAgICAgICAgICAgICAgICAvLyBJbnZhbGlkIFVURi04IHNlcXVlbmNlDQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXQgPSAocmV0ICogNjQpIHwgKGIgJiAweDNGKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBrZWNjYWstMjU2IGhhc2ggb2YgdGhlIHNsaWNlLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBoYXNoLg0KICAgICAqIEByZXR1cm4gVGhlIGhhc2ggb2YgdGhlIHNsaWNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGtlY2NhayhzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIHJldCkgew0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICByZXQgOj0gc2hhMyhtbG9hZChhZGQoc2VsZiwgMzIpKSwgbWxvYWQoc2VsZikpDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuDQogICAgICovDQogICAgZnVuY3Rpb24gc3RhcnRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5fcHRyID09IG5lZWRsZS5fcHRyKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGJvb2wgZXF1YWw7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQ0KICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCiAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGVxdWFsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgSWYgYHNlbGZgIHN0YXJ0cyB3aXRoIGBuZWVkbGVgLCBgbmVlZGxlYCBpcyByZW1vdmVkIGZyb20gdGhlDQogICAgICogICAgICBiZWdpbm5pbmcgb2YgYHNlbGZgLiBPdGhlcndpc2UsIGBzZWxmYCBpcyB1bm1vZGlmaWVkLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuDQogICAgICogQHJldHVybiBgc2VsZmANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBiZXlvbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICB9DQoNCiAgICAgICAgYm9vbCBlcXVhbCA9IHRydWU7DQogICAgICAgIGlmIChzZWxmLl9wdHIgIT0gbmVlZGxlLl9wdHIpIHsNCiAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkNCiAgICAgICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpDQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCiAgICAgICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGVxdWFsKSB7DQogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47DQogICAgICAgICAgICBzZWxmLl9wdHIgKz0gbmVlZGxlLl9sZW47DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgZW5kcyB3aXRoIGBuZWVkbGVgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuDQogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVuZHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47DQoNCiAgICAgICAgaWYgKHNlbGZwdHIgPT0gbmVlZGxlLl9wdHIpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgYm9vbCBlcXVhbDsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpDQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQ0KICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBlcXVhbDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IElmIGBzZWxmYCBlbmRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUNCiAgICAgKiAgICAgIGVuZCBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIGBzZWxmYA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHVudGlsKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47DQogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOw0KICAgICAgICBpZiAoc2VsZnB0ciAhPSBuZWVkbGUuX3B0cikgew0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KICAgICAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpDQogICAgICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChlcXVhbCkgew0KICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KDQogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YNCiAgICAvLyBgbmVlZGxlYCBpbiBgc2VsZmAsIG9yIHRoZSBmaXJzdCBieXRlIGFmdGVyIGBzZWxmYCBpZiBub3QgZm91bmQuDQogICAgZnVuY3Rpb24gZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdWludCBwdHI7DQogICAgICAgIHVpbnQgaWR4Ow0KDQogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgew0KICAgICAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSAzMikgew0KICAgICAgICAgICAgICAgIC8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjggZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MNCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgICAgIGxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpDQogICAgICAgICAgICAgICAgICAgIGxldCBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKQ0KICAgICAgICAgICAgICAgICAgICBsZXQgZW5kIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHNlbGZwdHINCiAgICAgICAgICAgICAgICAgICAgbG9vcDoNCiAgICAgICAgICAgICAgICAgICAganVtcGkoZXhpdCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChwdHIsIDEpDQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGx0KHN1YihwdHIsIDEpLCBlbmQpKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHNlbGZsZW4pDQogICAgICAgICAgICAgICAgICAgIGV4aXQ6DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nDQogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgaGFzaCA6PSBzaGEzKG5lZWRsZXB0ciwgbmVlZGxlbGVuKSB9DQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0cjsNCiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8PSBzZWxmbGVuIC0gbmVlZGxlbGVuOyBpZHgrKykgew0KICAgICAgICAgICAgICAgICAgICBieXRlczMyIHRlc3RIYXNoOw0KICAgICAgICAgICAgICAgICAgICBhc3NlbWJseSB7IHRlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHRyOw0KICAgICAgICAgICAgICAgICAgICBwdHIgKz0gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHNlbGZwdHIgKyBzZWxmbGVuOw0KICAgIH0NCg0KICAgIC8vIFJldHVybnMgdGhlIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBmaXJzdCBieXRlIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YNCiAgICAvLyBgbmVlZGxlYCBpbiBgc2VsZmAsIG9yIHRoZSBhZGRyZXNzIG9mIGBzZWxmYCBpZiBub3QgZm91bmQuDQogICAgZnVuY3Rpb24gcmZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHVpbnQgcHRyOw0KDQogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgew0KICAgICAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSAzMikgew0KICAgICAgICAgICAgICAgIC8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjkgZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MNCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgICAgIGxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpDQogICAgICAgICAgICAgICAgICAgIGxldCBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQ0KICAgICAgICAgICAgICAgICAgICBsb29wOg0KICAgICAgICAgICAgICAgICAgICBqdW1waShyZXQsIGVxKGFuZChtbG9hZChwdHIpLCBtYXNrKSwgbmVlZGxlZGF0YSkpDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzdWIocHRyLCAxKQ0KICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBndChhZGQocHRyLCAxKSwgc2VsZnB0cikpDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzZWxmcHRyDQogICAgICAgICAgICAgICAgICAgIGp1bXAoZXhpdCkNCiAgICAgICAgICAgICAgICAgICAgcmV0Og0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgbmVlZGxlbGVuKQ0KICAgICAgICAgICAgICAgICAgICBleGl0Og0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gcHRyOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZw0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgaGFzaDsNCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQ0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHIgKyAoc2VsZmxlbiAtIG5lZWRsZWxlbik7DQogICAgICAgICAgICAgICAgd2hpbGUgKHB0ciA+PSBzZWxmcHRyKSB7DQogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7DQogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgdGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbikgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaCA9PSB0ZXN0SGFzaCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHIgKyBuZWVkbGVsZW47DQogICAgICAgICAgICAgICAgICAgIHB0ciAtPSAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2VsZnB0cjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIGV2ZXJ5dGhpbmcgZnJvbSB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZg0KICAgICAqICAgICAgYG5lZWRsZWAgdG8gdGhlIGVuZCBvZiB0aGUgc2xpY2UuIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlDQogICAgICogICAgICBpZiBgbmVlZGxlYCBpcyBub3QgZm91bmQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIGBzZWxmYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBmaW5kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOw0KICAgICAgICBzZWxmLl9sZW4gLT0gcHRyIC0gc2VsZi5fcHRyOw0KICAgICAgICBzZWxmLl9wdHIgPSBwdHI7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gdGhlIHBhcnQgb2YgdGhlIHN0cmluZyBmcm9tIHRoZSBzdGFydCBvZg0KICAgICAqICAgICAgYHNlbGZgIHRvIHRoZSBlbmQgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAuIElmIGBuZWVkbGVgDQogICAgICogICAgICBpcyBub3QgZm91bmQsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2ggYW5kIG1vZGlmeS4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuDQogICAgICogQHJldHVybiBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gcmZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOw0KICAgICAgICBzZWxmLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QNCiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZg0KICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwNCiAgICAgKiAgICAgIGFuZCBgdG9rZW5gIGlzIHNldCB0byB0aGUgZW50aXJldHkgb2YgYHNlbGZgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEBwYXJhbSB0b2tlbiBBbiBvdXRwdXQgcGFyYW1ldGVyIHRvIHdoaWNoIHRoZSBmaXJzdCB0b2tlbiBpcyB3cml0dGVuLg0KICAgICAqIEByZXR1cm4gYHRva2VuYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQogICAgICAgIHRva2VuLl9wdHIgPSBzZWxmLl9wdHI7DQogICAgICAgIHRva2VuLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7DQogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7DQogICAgICAgICAgICAvLyBOb3QgZm91bmQNCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOw0KICAgICAgICAgICAgc2VsZi5fcHRyID0gcHRyICsgbmVlZGxlLl9sZW47DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRva2VuOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QNCiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmDQogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLA0KICAgICAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgdXAgdG8gdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHRva2VuKSB7DQogICAgICAgIHNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QNCiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuIElmDQogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLA0KICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uDQogICAgICogQHJldHVybiBgdG9rZW5gLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOw0KICAgICAgICB0b2tlbi5fcHRyID0gcHRyOw0KICAgICAgICB0b2tlbi5fbGVuID0gc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0cik7DQogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyKSB7DQogICAgICAgICAgICAvLyBOb3QgZm91bmQNCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0b2tlbjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIHRoZSBsYXN0DQogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuIElmDQogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLA0KICAgICAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZiBgZGVsaW1gLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHRva2VuKSB7DQogICAgICAgIHJzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IENvdW50cyB0aGUgbnVtYmVyIG9mIG5vbm92ZXJsYXBwaW5nIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGluIGBzZWxmYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoLg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGZvdW5kIGluIGBzZWxmYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb3VudChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHVpbnQgY291bnQpIHsNCiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47DQogICAgICAgIHdoaWxlIChwdHIgPD0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7DQogICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgcHRyID0gZmluZFB0cihzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKSwgcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgVHJ1ZSBpZiBgc2VsZmAgY29udGFpbnMgYG5lZWRsZWAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBgbmVlZGxlYCBpcyBmb3VuZCBpbiBgc2VsZmAsIGZhbHNlIG90aGVyd2lzZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb250YWlucyhzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICE9IHNlbGYuX3B0cjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGNvbmNhdGVuYXRpb24gb2YNCiAgICAgKiAgICAgIGBzZWxmYCBhbmQgYG90aGVyYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29uY2F0ZW5hdGUuDQogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29uY2F0ZW5hdGUuDQogICAgICogQHJldHVybiBUaGUgY29uY2F0ZW5hdGlvbiBvZiB0aGUgdHdvIHN0cmluZ3MuDQogICAgICovDQogICAgZnVuY3Rpb24gY29uY2F0KHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuICsgb3RoZXIuX2xlbik7DQogICAgICAgIHVpbnQgcmV0cHRyOw0KICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQ0KICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7DQogICAgICAgIG1lbWNweShyZXRwdHIgKyBzZWxmLl9sZW4sIG90aGVyLl9wdHIsIG90aGVyLl9sZW4pOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgSm9pbnMgYW4gYXJyYXkgb2Ygc2xpY2VzLCB1c2luZyBgc2VsZmAgYXMgYSBkZWxpbWl0ZXIsIHJldHVybmluZyBhDQogICAgICogICAgICBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBkZWxpbWl0ZXIgdG8gdXNlLg0KICAgICAqIEBwYXJhbSBwYXJ0cyBBIGxpc3Qgb2Ygc2xpY2VzIHRvIGpvaW4uDQogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyBhbGwgdGhlIHNsaWNlcyBpbiBgcGFydHNgLA0KICAgICAqICAgICAgICAgam9pbmVkIHdpdGggYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGpvaW4oc2xpY2Ugc2VsZiwgc2xpY2VbXSBwYXJ0cykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT0gMCkNCiAgICAgICAgICAgIHJldHVybiAiIjsNCg0KICAgICAgICB1aW50IGxlbiA9IHNlbGYuX2xlbiAqIChwYXJ0cy5sZW5ndGggLSAxKTsNCiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAgIGxlbiArPSBwYXJ0c1tpXS5fbGVuOw0KDQogICAgICAgIHZhciByZXQgPSBuZXcgc3RyaW5nKGxlbik7DQogICAgICAgIHVpbnQgcmV0cHRyOw0KICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQ0KDQogICAgICAgIGZvcihpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBwYXJ0c1tpXS5fcHRyLCBwYXJ0c1tpXS5fbGVuKTsNCiAgICAgICAgICAgIHJldHB0ciArPSBwYXJ0c1tpXS5fbGVuOw0KICAgICAgICAgICAgaWYgKGkgPCBwYXJ0cy5sZW5ndGggLSAxKSB7DQogICAgICAgICAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOw0KICAgICAgICAgICAgICAgIHJldHB0ciArPSBzZWxmLl9sZW47DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCn0NCg0KICAgICAgDQogICAgICANCg0KY29udHJhY3QgdHJhbnNmZXJhYmxlIHsNCglmdW5jdGlvbiByZWNlaXZlKGFkZHJlc3MgcGxheWVyLCB1aW50OCBhbmltYWxUeXBlLCB1aW50MzJbXSBhbmltYWxJZHMpIHBheWFibGUge30NCn0NCg0KY29udHJhY3QgUHJheTRQcmV5IGlzIG1vcnRhbCwgdXNpbmdPcmFjbGl6ZSwgdHJhbnNmZXJhYmxlIHsNCgl1c2luZyBzdHJpbmdzDQoJZm9yICogOw0KDQoJc3RydWN0IEFuaW1hbCB7DQoJCXVpbnQ4IGFuaW1hbFR5cGU7DQoJCXVpbnQxMjggdmFsdWU7DQoJCWFkZHJlc3Mgb3duZXI7DQoJfQ0KDQoJLyoqIGFycmF5IGhvbGRpbmcgaWRzIG9mIHRoZSBjdXJyZXQgYW5pbWFscyovDQoJdWludDMyW10gcHVibGljIGlkczsNCgkvKiogdGhlIGlkIHRvIGJlIGdpdmVuIHRvIHRoZSBuZXQgYW5pbWFsICoqLw0KCXVpbnQzMiBwdWJsaWMgbmV4dElkOw0KCS8qKiB0aGUgaWQgb2YgdGhlIG9sZGVzdCBhbmltYWwgKi8NCgl1aW50MzIgcHVibGljIG9sZGVzdDsNCgkvKiogdGhlIGFuaW1hbCBiZWxvbmdpbmcgdG8gYSBnaXZlbiBpZCAqLw0KCW1hcHBpbmcodWludDMyID0+IEFuaW1hbCkgYW5pbWFsczsNCgkvKiogdGhlIGNvc3Qgb2YgZWFjaCBhbmltYWwgdHlwZSAqLw0KCXVpbnQxMjhbXSBwdWJsaWMgY29zdHM7DQoJLyoqIHRoZSB2YWx1ZSBvZiBlYWNoIGFuaW1hbCB0eXBlIChjb3N0IC0gZmVlKSwgc28gaXQncyBub3QgbmVjZXNzYXJ5IHRvIGNvbXB1dGUgaXQgZWFjaCB0aW1lKi8NCgl1aW50MTI4W10gcHVibGljIHZhbHVlczsNCgkvKiogdGhlIGZlZSB0byBiZSBwYWlkIGVhY2ggdGltZSBhbiBhbmltYWwgaXMgYm91Z2h0IGluIHBlcmNlbnQqLw0KCXVpbnQ4IGZlZTsNCg0KCS8qKiB0b3RhbCBudW1iZXIgb2YgYW5pbWFscyBpbiB0aGUgZ2FtZSAodWludDMyIGJlY2F1c2Ugb2YgbXVsdGlwbGljYXRpb24gaXNzdWVzKSAqLw0KCXVpbnQzMiBwdWJsaWMgbnVtQW5pbWFsczsNCgkvKiogVGhlIG1heGltdW0gb2YgYW5pbWFscyBhbGxvd2VkIGluIHRoZSBnYW1lICovDQoJdWludDE2IHB1YmxpYyBtYXhBbmltYWxzOw0KCS8qKiBudW1iZXIgb2YgYW5pbWFscyBwZXIgdHlwZSAqLw0KCW1hcHBpbmcodWludDggPT4gdWludDE2KSBwdWJsaWMgbnVtQW5pbWFsc1hUeXBlOw0KDQoNCgkvKiogdGhlIHF1ZXJ5IHN0cmluZyBnZXR0aW5nIHRoZSByYW5kb20gbnVtYmVycyBmcm9tIG9yYWNsaXplKiovDQoJc3RyaW5nIHJhbmRvbVF1ZXJ5Ow0KCS8qKiB0aGUgdHlwZSBvZiB0aGUgb3JhY2xpemUgcXVlcnkqKi8NCglzdHJpbmcgcXVlcnlUeXBlOw0KCS8qKiB0aGUgdGltZXN0YW1wIG9mIHRoZSBuZXh0IGF0dGFjayAqKi8NCgl1aW50IHB1YmxpYyBuZXh0QXR0YWNrVGltZXN0YW1wOw0KCS8qKiBnYXMgcHJvdmlkZWQgZm9yIG9yYWNsaXplIGNhbGxiYWNrIChhdHRhY2spKiovDQoJdWludDMyIHB1YmxpYyBvcmFjbGl6ZUdhczsNCgkvKiogdGhlIGlkIG9mIHRoZSBuZXh0IG9yYWNsaXplIGNhbGxiYWNrKi8NCglieXRlczMyIG5leHRBdHRhY2tJZDsNCg0KDQoJLyoqIGlzIGZpcmVkIHdoZW4gbmV3IGFuaW1hbHMgYXJlIHB1cmNoYXNlZCAod2hvIGJvdWdodCBob3cgbWFueSBhbmltYWxzIG9mIHdoaWNoIHR5cGU/KSAqLw0KCWV2ZW50IG5ld1B1cmNoYXNlKGFkZHJlc3MgcGxheWVyLCB1aW50OCBhbmltYWxUeXBlLCB1aW50OCBhbW91bnQsIHVpbnQzMiBzdGFydElkKTsNCgkvKiogaXMgZmlyZWQgd2hlbiBhIHBsYXllciBsZWF2ZXMgdGhlIGdhbWUgKi8NCglldmVudCBuZXdFeGl0KGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IHRvdGFsQmFsYW5jZSwgdWludDMyW10gcmVtb3ZlZEFuaW1hbHMpOw0KCS8qKiBpcyBmaXJlZCB3aGVuIGFuIGF0dGFjayBvY2N1cmVzICovDQoJZXZlbnQgbmV3QXR0YWNrKHVpbnQzMltdIGtpbGxlZEFuaW1hbHMpOw0KCS8qKiBpcyBmaXJlZCB3aGVuIGEgc2luZ2xlIGFuaW1hbCBpcyBzb2xkICoqLw0KCWV2ZW50IG5ld1NlbGwodWludDMyIGFuaW1hbElkLCBhZGRyZXNzIHBsYXllciwgdWludDI1NiB2YWx1ZSk7DQoNCg0KCS8qKiBpbml0aWFsaXplcyB0aGUgY29udHJhY3QgcGFyYW1ldGVycwkgKHdvdWxkIGJlIGNvbnN0cnVjdG9yIGlmIGl0IHdhc24ndCBmb3IgdGhlIGdhcyBsaW1pdCkqLw0KCWZ1bmN0aW9uIGluaXQoKSB7DQoJCWlmKG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93Ow0KCQljb3N0cyA9IFsxMDAwMDAwMDAwMDAwMDAwMCwgMjAwMDAwMDAwMDAwMDAwMDAsIDUwMDAwMDAwMDAwMDAwMDAwLCAxMDAwMDAwMDAwMDAwMDAwMDAsIDUwMDAwMDAwMDAwMDAwMDAwMF07DQoJCWZlZSA9IDU7DQoJCWZvciAodWludDggaSA9IDA7IGkgPCBjb3N0cy5sZW5ndGg7IGkrKykgew0KCQkJdmFsdWVzLnB1c2goY29zdHNbaV0gLSBjb3N0c1tpXSAvIDEwMCAqIGZlZSk7DQoJCX0NCgkJbWF4QW5pbWFscyA9IDMwMDsNCgkJcmFuZG9tUXVlcnkgPSAiMTAgcmFuZG9tIG51bWJlcnMgYmV0d2VlbiAxIGFuZCAxMDAwIjsNCgkJcXVlcnlUeXBlID0gIldvbGZyYW1BbHBoYSI7DQoJCW9yYWNsaXplR2FzID0gMzAwMDAwOw0KCQluZXh0SWQgPSAxOw0KCQlvbGRlc3QgPSAxOw0KCX0NCg0KCS8qKiBUaGUgZmFsbGJhY2sgZnVuY3Rpb24gcnVucyB3aGVuZXZlciBzb21lb25lIHNlbmRzIGV0aGVyDQoJICAgRGVwZW5kaW5nIG9mIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gdGhlIHNlbmRlciBpcyBlaXRoZXIgZ3JhbnRlZCBhIHByZXkgb3IgDQoJICAgdGhlIHRyYW5zYWN0aW9uIGlzIGRpc2NhcmRlZCBhbmQgbm8gZXRoZXIgYWNjZXB0ZWQNCgkgICBJbiB0aGUgZmlyc3QgY2FzZSBmZWVzIGhhdmUgdG8gYmUgcGFpZCovDQoJZnVuY3Rpb24oKSBwYXlhYmxlIHsNCgkJZm9yICh1aW50OCBpID0gMDsgaSA8IGNvc3RzLmxlbmd0aDsgaSsrKQ0KCQkJaWYgKG1zZy52YWx1ZSA9PSBjb3N0c1tpXSkNCgkJCQlhZGRBbmltYWxzKGkpOw0KDQoJCWlmIChtc2cudmFsdWUgPT0gMTAwMDAwMDAwMDAwMDAwMCkNCgkJCWV4aXQoKTsNCgkJZWxzZQ0KCQkJdGhyb3c7DQoNCgl9DQoNCgkvKiogYnV5IGFuaW1hbHMgb2YgYSBnaXZlbiB0eXBlIA0KCSAqICBhcyBtYW55IGFuaW1hbHMgYXMgcG9zc2libGUgYXJlIGJvdWdodCB3aXRoIG1zZy52YWx1ZQ0KCSAqLw0KCWZ1bmN0aW9uIGFkZEFuaW1hbHModWludDggYW5pbWFsVHlwZSkgcGF5YWJsZSB7DQoJCWdpdmVBbmltYWxzKGFuaW1hbFR5cGUsIG1zZy5zZW5kZXIpOw0KCX0NCg0KCS8qKiBidXkgYW5pbWFscyBvZiBhIGdpdmVuIHR5cGUgZm9yc29tZW9uZSBlbHNlDQoJICogIGFzIG1hbnkgYW5pbWFscyBhcyBwb3NzaWJsZSBhcmUgYm91Z2h0IHdpdGggbXNnLnZhbHVlDQoJICovDQoJZnVuY3Rpb24gZ2l2ZUFuaW1hbHModWludDggYW5pbWFsVHlwZSwgYWRkcmVzcyByZWNlaXZlcikgcGF5YWJsZSB7DQoJCXVpbnQ4IGFtb3VudCA9IHVpbnQ4KG1zZy52YWx1ZSAvIGNvc3RzW2FuaW1hbFR5cGVdKTsNCgkJaWYgKGFuaW1hbFR5cGUgPj0gY29zdHMubGVuZ3RoIHx8IG1zZy52YWx1ZSA8IGNvc3RzW2FuaW1hbFR5cGVdIHx8IG51bUFuaW1hbHMgKyBhbW91bnQgPj0gbWF4QW5pbWFscykgdGhyb3c7DQoJCS8vaWYgdHlwZSBleGlzdHMsIGVub3VnaCBldGhlciB3YXMgdHJhbnNmZXJyZWQgYW5kIHRoZXJlIGFyZSBsZXNzIHRoYW4gbWF4QW5pbWFscyBhbmltYWxzIGluIHRoZSBnYW1lDQoJCWZvciAodWludDggaiA9IDA7IGogPCBhbW91bnQ7IGorKykgew0KCQkJYWRkQW5pbWFsKGFuaW1hbFR5cGUsIHJlY2VpdmVyLCBuZXh0SWQpOw0KCQkJbmV4dElkKys7DQoJCX0NCgkJbnVtQW5pbWFsc1hUeXBlW2FuaW1hbFR5cGVdICs9IGFtb3VudDsNCgkJbmV3UHVyY2hhc2UocmVjZWl2ZXIsIGFuaW1hbFR5cGUsIGFtb3VudCwgbmV4dElkIC0gYW1vdW50KTsNCgl9DQoNCgkvKioNCgkgKiAgYWRkcyBhIHNpbmdsZSBhbmltYWwgb2YgdGhlIGdpdmVuIHR5cGUNCgkgKi8NCglmdW5jdGlvbiBhZGRBbmltYWwodWludDggYW5pbWFsVHlwZSwgYWRkcmVzcyByZWNlaXZlciwgdWludDMyIG5JZCkgaW50ZXJuYWwgew0KCQlpZiAobnVtQW5pbWFscyA8IGlkcy5sZW5ndGgpDQoJCQlpZHNbbnVtQW5pbWFsc10gPSBuSWQ7DQoJCWVsc2UNCgkJCWlkcy5wdXNoKG5JZCk7DQoJCWFuaW1hbHNbbklkXSA9IEFuaW1hbChhbmltYWxUeXBlLCB2YWx1ZXNbYW5pbWFsVHlwZV0sIHJlY2VpdmVyKTsNCgkJbnVtQW5pbWFscysrOw0KCX0NCg0KDQoNCgkvKiogbGVhdmUgdGhlIGdhbWUNCgkgKiBwYXlzIG91dCB0aGUgc2VuZGVyJ3Mgd2luQmFsYW5jZSBhbmQgcmVtb3ZlcyBoaW0gYW5kIGhpcyBhbmltYWxzIGZyb20gdGhlIGdhbWUNCgkgKiAqLw0KCWZ1bmN0aW9uIGV4aXQoKSB7DQoJCXVpbnQzMltdIG1lbW9yeSByZW1vdmVkID0gbmV3IHVpbnQzMltdKDUwKTsNCgkJdWludDggY291bnQ7DQoJCXVpbnQzMiBsYXN0SWQ7DQoJCXVpbnQgcGxheWVyQmFsYW5jZTsNCgkJZm9yICh1aW50MTYgaSA9IDA7IGkgPCBudW1BbmltYWxzOyBpKyspIHsNCgkJCWlmIChhbmltYWxzW2lkc1tpXV0ub3duZXIgPT0gbXNnLnNlbmRlcikgew0KCQkJCS8vZmlyc3QgZGVsZXRlIGFsbCBhbmltYWxzIGF0IHRoZSBlbmQgb2YgdGhlIGFycmF5DQoJCQkJd2hpbGUgKG51bUFuaW1hbHMgPiAwICYmIGFuaW1hbHNbaWRzW251bUFuaW1hbHMgLSAxXV0ub3duZXIgPT0gbXNnLnNlbmRlcikgew0KCQkJCQludW1BbmltYWxzLS07DQoJCQkJCWxhc3RJZCA9IGlkc1tudW1BbmltYWxzXTsNCgkJCQkJbnVtQW5pbWFsc1hUeXBlW2FuaW1hbHNbbGFzdElkXS5hbmltYWxUeXBlXS0tOw0KCQkJCQlwbGF5ZXJCYWxhbmNlICs9IGFuaW1hbHNbbGFzdElkXS52YWx1ZTsNCgkJCQkJcmVtb3ZlZFtjb3VudF0gPSBsYXN0SWQ7DQoJCQkJCWNvdW50Kys7DQoJCQkJCWlmIChsYXN0SWQgPT0gb2xkZXN0KSBvbGRlc3QgPSAwOw0KCQkJCQlkZWxldGUgYW5pbWFsc1tsYXN0SWRdOw0KCQkJCX0NCgkJCQkvL2lmIHRoZSBsYXN0IGFuaW1hbCBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHBsYXllciwgcmVwbGFjZSB0aGUgcGxheWVycyBhbmltYWwgYnkgdGhpcyBsYXN0IG9uZQ0KCQkJCWlmIChudW1BbmltYWxzID4gaSArIDEpIHsNCgkJCQkJcGxheWVyQmFsYW5jZSArPSBhbmltYWxzW2lkc1tpXV0udmFsdWU7DQoJCQkJCXJlbW92ZWRbY291bnRdID0gaWRzW2ldOw0KCQkJCQljb3VudCsrOw0KCQkJCQlyZXBsYWNlQW5pbWFsKGkpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQluZXdFeGl0KG1zZy5zZW5kZXIsIHBsYXllckJhbGFuY2UsIHJlbW92ZWQpOyAvL2ZpcmUgdGhlIGV2ZW50IHRvIG5vdGlmeSB0aGUgY2xpZW50DQoJCWlmICghbXNnLnNlbmRlci5zZW5kKHBsYXllckJhbGFuY2UpKSB0aHJvdzsNCgl9DQoNCg0KCS8qKg0KCSAqIFJlcGxhY2VzIHRoZSBhbmltYWwgd2l0aCB0aGUgZ2l2ZW4gaWQgd2l0aCB0aGUgbGFzdCBhbmltYWwgaW4gdGhlIGFycmF5DQoJICogKi8NCglmdW5jdGlvbiByZXBsYWNlQW5pbWFsKHVpbnQxNiBpbmRleCkgaW50ZXJuYWwgew0KCQl1aW50MzIgYW5pbWFsSWQgPSBpZHNbaW5kZXhdOw0KCQludW1BbmltYWxzWFR5cGVbYW5pbWFsc1thbmltYWxJZF0uYW5pbWFsVHlwZV0tLTsNCgkJbnVtQW5pbWFscy0tOw0KCQlpZiAoYW5pbWFsSWQgPT0gb2xkZXN0KSBvbGRlc3QgPSAwOw0KCQlkZWxldGUgYW5pbWFsc1thbmltYWxJZF07DQoJCWlkc1tpbmRleF0gPSBpZHNbbnVtQW5pbWFsc107DQoJCWRlbGV0ZSBpZHNbbnVtQW5pbWFsc107DQoJfQ0KDQoNCgkvKioNCgkgKiBtYW51YWxseSB0cmlnZ2VycyB0aGUgYXR0YWNrLiBjYW5ub3QgYmUgY2FsbGVkIGFmdGVyd2FyZHMsIGV4Y2VwdA0KCSAqIGJ5IHRoZSBvd25lciBpZiBhbmQgb25seSBpZiB0aGUgYXR0YWNrIHdhc24ndCBsYXVuY2hlZCBhcyBzdXBwb3NlZCwgc2lnbmlmeWluZw0KCSAqIGFuIGVycm9yIG9jdXJyZWQgZHVyaW5nIHRoZSBsYXN0IGludm9jYXRpb24gb2Ygb3JhY2xpemUsIG9yIHRoZXJlIHdhc24ndCBlbm91Z2ggZXRoZXIgdG8gcGF5IHRoZSBnYXMNCgkgKiAqLw0KCWZ1bmN0aW9uIHRyaWdnZXJBdHRhY2tNYW51YWxseSh1aW50MzIgaW5zZWNvbmRzKSB7DQoJCWlmICghKG1zZy5zZW5kZXIgPT0gb3duZXIgJiYgbmV4dEF0dGFja1RpbWVzdGFtcCA8IG5vdyArIDMwMCkpIHRocm93Ow0KCQl0cmlnZ2VyQXR0YWNrKGluc2Vjb25kcywgKG9yYWNsaXplR2FzICsgMTAwMDAgKiBudW1BbmltYWxzKSk7DQoJfQ0KDQoJLyoqDQoJICogc2VuZHMgYSBxdWVyeSB0byBvcmFjbGl6ZSBpbiBvcmRlciB0byBnZXQgcmFuZG9tIG51bWJlcnMgaW4gJ2luc2Vjb25kcycgc2Vjb25kcw0KCSAqLw0KCWZ1bmN0aW9uIHRyaWdnZXJBdHRhY2sodWludDMyIGluc2Vjb25kcywgdWludDEyOCBnYXNBbW91bnQpIGludGVybmFsIHsNCgkJbmV4dEF0dGFja1RpbWVzdGFtcCA9IG5vdyArIGluc2Vjb25kczsNCgkJbmV4dEF0dGFja0lkID0gb3JhY2xpemVfcXVlcnkobmV4dEF0dGFja1RpbWVzdGFtcCwgcXVlcnlUeXBlLCByYW5kb21RdWVyeSwgZ2FzQW1vdW50KTsNCgl9DQoNCgkvKioNCgkgKiBUaGUgYWN0dWFsIHByZWRhdG9yIGF0dGFjay4NCgkgKiBUaGUgcHJlZGF0b3Iga2lsbHMgdXAgdG8gMTAgYW5pbWFscywgYnV0IGluIGNhc2UgdGhlcmUgYXJlIGxlc3MgdGhhbiAxMDAgYW5pbWFscyBpbiB0aGUgZ2FtZSB1cCB0byAxMCUgZ2V0IGVhdGVuLg0KCSAqICovDQoJZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQpIHsNCgkJaWYgKG1zZy5zZW5kZXIgIT0gb3JhY2xpemVfY2JBZGRyZXNzKCkgfHwgbXlpZCAhPSBuZXh0QXR0YWNrSWQpIHRocm93OyAvLyBqdXN0IHRvIGJlIHN1cmUgdGhlIGNhbGxpbmcgYWRkcmVzcyBpcyB0aGUgT3JhY2xpemUgYXV0aG9yaXplZCBvbmUgYW5kIHRoZSBjYWxsYmFjayBpcyB0aGUgZXhwZWN0ZWQgb25lICAgDQoJCXVpbnQxMjggcG90Ow0KCQl1aW50MTYgcmFuZG9tOw0KCQl1aW50MzIgaG93bWFueSA9IG51bUFuaW1hbHMgPCAxMDAgPyAobnVtQW5pbWFscyA8IDEwID8gMSA6IG51bUFuaW1hbHMgLyAxMCkgOiAxMDsgLy9kbyBub3Qga2lsbCBtb3JlIHRoYW4gMTAlLCBidXQgYXQgbGVhc3Qgb25lDQoJCXVpbnQxNltdIG1lbW9yeSByYW5kb21OdW1iZXJzID0gZ2V0TnVtYmVyc0Zyb21TdHJpbmcocmVzdWx0LCAiLCIsIGhvd21hbnkpOw0KCQl1aW50MzJbXSBtZW1vcnkga2lsbGVkQW5pbWFscyA9IG5ldyB1aW50MzJbXShob3dtYW55KTsNCgkJZm9yICh1aW50OCBpID0gMDsgaSA8IGhvd21hbnk7IGkrKykgew0KCQkJcmFuZG9tID0gbWFwVG9OZXdSYW5nZShyYW5kb21OdW1iZXJzW2ldLCBudW1BbmltYWxzKTsNCgkJCWtpbGxlZEFuaW1hbHNbaV0gPSBpZHNbcmFuZG9tXTsNCgkJCXBvdCArPSBraWxsQW5pbWFsKHJhbmRvbSk7DQoJCX0NCgkJdWludDEyOCBuZWVkZWRHYXMgPSBvcmFjbGl6ZUdhcyArIDEwMDAwICogbnVtQW5pbWFsczsNCgkJdWludDEyOCBnYXNDb3N0ID0gdWludDEyOChuZWVkZWRHYXMgKiB0eC5nYXNwcmljZSk7DQoJCWlmIChwb3QgPiBnYXNDb3N0KQ0KCQkJZGlzdHJpYnV0ZSh1aW50MTI4KHBvdCAtIGdhc0Nvc3QpKTsgLy9kaXN0cmlidXRlIHRoZSBwb3QgbWludXMgdGhlIG9yYWNsaXplIGdhcyBjb3N0cw0KCQl0cmlnZ2VyQXR0YWNrKHRpbWVUaWxsTmV4dEF0dGFjaygpLCBuZWVkZWRHYXMpOw0KCQluZXdBdHRhY2soa2lsbGVkQW5pbWFscyk7DQoJfQ0KDQoJLyoqDQoJICogdGhlIGZyZXF1ZW5jeSBvZiB0aGUgc2hhcmsgYXR0YWNrcyBkZXBlbmRzIG9uIHRoZSBudW1iZXIgb2YgYW5pbWFscyBpbiB0aGUgZ2FtZS4gDQoJICogbWFueSBhbmltYWxzIC0+IG1hbnkgc2hhcmsgYXR0YWNrcw0KCSAqIGF0IGxlYXN0IG9uZSBhdHRhY2sgaW4gMjQgaG91cnMNCgkgKiAqLw0KCWZ1bmN0aW9uIHRpbWVUaWxsTmV4dEF0dGFjaygpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludDMyKSB7DQoJCXJldHVybiAoODY0MDAgLyAoMSArIG51bUFuaW1hbHMgLyAxMDApKTsNCgl9DQoNCg0KCS8qKg0KCSAqIGtpbGxzIHRoZSBhbmltYWwgb2YgdGhlIGdpdmVuIHR5cGUgYXQgdGhlIGdpdmVuIGluZGV4LiANCgkgKiAqLw0KCWZ1bmN0aW9uIGtpbGxBbmltYWwodWludDE2IGluZGV4KSBpbnRlcm5hbCByZXR1cm5zKHVpbnQxMjggYW5pbWFsVmFsdWUpIHsNCgkJYW5pbWFsVmFsdWUgPSBhbmltYWxzW2lkc1tpbmRleF1dLnZhbHVlOw0KCQlyZXBsYWNlQW5pbWFsKGluZGV4KTsNCgl9DQoNCgkvKioNCgkgKiBmaW5kcyB0aGUgb2xkZXN0IGFuaW1hbA0KCSAqICovDQoJZnVuY3Rpb24gZmluZE9sZGVzdCgpIHsNCgkJb2xkZXN0ID0gaWRzWzBdOw0KCQlmb3IgKHVpbnQxNiBpID0gMTsgaSA8IG51bUFuaW1hbHM7IGkrKykgew0KCQkJaWYgKGlkc1tpXSA8IG9sZGVzdCkgLy90aGUgb2xkZXN0IGFuaW1hbCBoYXMgdGhlIGxvd2VzdCBpZA0KCQkJCW9sZGVzdCA9IGlkc1tpXTsNCgkJfQ0KCX0NCg0KDQoJLyoqIGRpc3RyaWJ1dGVzIHRoZSBnaXZlbiBhbW91bnQgYW1vbmcgdGhlIHN1cnZpdmluZyBmaXNoZXMqLw0KCWZ1bmN0aW9uIGRpc3RyaWJ1dGUodWludDEyOCB0b3RhbEFtb3VudCkgaW50ZXJuYWwgew0KCQkvL3BheSAxMCUgdG8gdGhlIG9sZGVzdCBmaXNoDQoJCWlmIChvbGRlc3QgPT0gMCkNCgkJCWZpbmRPbGRlc3QoKTsNCgkJYW5pbWFsc1tvbGRlc3RdLnZhbHVlICs9IHRvdGFsQW1vdW50IC8gMTA7DQoJCXVpbnQxMjggYW1vdW50ID0gdG90YWxBbW91bnQgLyAxMCAqIDk7DQoJCS8vZGlzdHJpYnV0ZSB0aGUgcmVzdCBhY2NvcmRpbmcgdG8gdGhlaXIgdHlwZQ0KCQl1aW50MTI4IHZhbHVlU3VtOw0KCQl1aW50MTI4W10gbWVtb3J5IHNoYXJlcyA9IG5ldyB1aW50MTI4W10odmFsdWVzLmxlbmd0aCk7DQoJCWZvciAodWludDggdiA9IDA7IHYgPCB2YWx1ZXMubGVuZ3RoOyB2KyspIHsNCgkJCWlmIChudW1BbmltYWxzWFR5cGVbdl0gPiAwKSB2YWx1ZVN1bSArPSB2YWx1ZXNbdl07DQoJCX0NCgkJZm9yICh1aW50OCBtID0gMDsgbSA8IHZhbHVlcy5sZW5ndGg7IG0rKykgew0KCQkJaWYgKG51bUFuaW1hbHNYVHlwZVttXSA+IDApDQoJCQkJc2hhcmVzW21dID0gYW1vdW50ICogdmFsdWVzW21dIC8gdmFsdWVTdW0gLyBudW1BbmltYWxzWFR5cGVbbV07DQoJCX0NCgkJZm9yICh1aW50MTYgaSA9IDA7IGkgPCBudW1BbmltYWxzOyBpKyspIHsNCgkJCWFuaW1hbHNbaWRzW2ldXS52YWx1ZSArPSBzaGFyZXNbYW5pbWFsc1tpZHNbaV1dLmFuaW1hbFR5cGVdOw0KCQl9DQoNCgl9DQoNCgkvKioNCgkgKiBhbGxvd3MgdGhlIG93bmVyIHRvIGNvbGxlY3QgdGhlIGFjY3VtdWxhdGVkIGZlZXMNCgkgKiBzZW5kcyB0aGUgZ2l2ZW4gYW1vdW50IHRvIHRoZSBvd25lcidzIGFkZHJlc3MgaWYgdGhlIGFtb3VudCBkb2VzIG5vdCBleGNlZWQgdGhlDQoJICogZmVlcyAoY2Fubm90IHRvdWNoIHRoZSBwbGF5ZXJzJyBiYWxhbmNlcykgbWludXMgMTAwIGZpbm5leSAoZW5zdXJlIHRoYXQgb3JhY2xpemUgZmVlcyBjYW4gYmUgcGFpZCkNCgkgKiAqLw0KCWZ1bmN0aW9uIGNvbGxlY3RGZWVzKHVpbnQxMjggYW1vdW50KSB7DQoJCWlmICghKG1zZy5zZW5kZXIgPT0gb3duZXIpKSB0aHJvdzsNCgkJdWludCBjb2xsZWN0ZWRGZWVzID0gZ2V0RmVlcygpOw0KCQlpZiAoYW1vdW50ICsgMTAwIGZpbm5leSA8IGNvbGxlY3RlZEZlZXMpIHsNCgkJCWlmICghb3duZXIuc2VuZChhbW91bnQpKSB0aHJvdzsNCgkJfQ0KCX0NCg0KCS8qKg0KCSAqIHBheXMgb3V0IHRoZSBwbGF5ZXJzIGFuZCBraWxscyB0aGUgZ2FtZS4NCgkgKiAqLw0KCWZ1bmN0aW9uIHN0b3AoKSB7DQoJCWlmICghKG1zZy5zZW5kZXIgPT0gb3duZXIpKSB0aHJvdzsNCgkJZm9yICh1aW50MTYgaSA9IDA7IGkgPCBudW1BbmltYWxzOyBpKyspIHsNCgkJCWlmKCFhbmltYWxzW2lkc1tpXV0ub3duZXIuc2VuZChhbmltYWxzW2lkc1tpXV0udmFsdWUpKSB0aHJvdzsNCgkJfQ0KCQlraWxsKCk7DQoJfQ0KDQoNCgkvKioNCgkgKiBzZWxsIHRoZSBhbmltYWwgb2YgdGhlIGdpdmVuIGlkDQoJICogKi8NCglmdW5jdGlvbiBzZWxsQW5pbWFsKHVpbnQzMiBhbmltYWxJZCkgew0KCQlpZiAobXNnLnNlbmRlciAhPSBhbmltYWxzW2FuaW1hbElkXS5vd25lcikgdGhyb3c7DQoJCXVpbnQxMjggdmFsID0gYW5pbWFsc1thbmltYWxJZF0udmFsdWU7DQoJCXVpbnQxNiBhbmltYWxJbmRleDsNCgkJZm9yICh1aW50MTYgaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyBpKyspIHsNCgkJCWlmIChpZHNbaV0gPT0gYW5pbWFsSWQpIHsNCgkJCQlhbmltYWxJbmRleCA9IGk7DQoJCQkJYnJlYWs7DQoJCQl9DQoJCX0NCgkJcmVwbGFjZUFuaW1hbChhbmltYWxJbmRleCk7DQoJCWlmICghbXNnLnNlbmRlci5zZW5kKHZhbCkpIHRocm93Ow0KCQluZXdTZWxsKGFuaW1hbElkLCBtc2cuc2VuZGVyLCB2YWwpOw0KCX0NCg0KCQ0KCQ0KCS8qKioqKioqKioqKioqKioqKiogR0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQoNCglmdW5jdGlvbiBnZXRBbmltYWwodWludDMyIGFuaW1hbElkKSBjb25zdGFudCByZXR1cm5zKHVpbnQ4LCB1aW50MTI4LCBhZGRyZXNzKSB7DQoJCXJldHVybiAoYW5pbWFsc1thbmltYWxJZF0uYW5pbWFsVHlwZSwgYW5pbWFsc1thbmltYWxJZF0udmFsdWUsIGFuaW1hbHNbYW5pbWFsSWRdLm93bmVyKTsNCgl9DQoNCglmdW5jdGlvbiBnZXQxMEFuaW1hbHModWludDE2IHN0YXJ0SW5kZXgpIGNvbnN0YW50IHJldHVybnModWludDMyWzEwXSBhbmltYWxJZHMsIHVpbnQ4WzEwXSB0eXBlcywgdWludDEyOFsxMF0gdmFsdWVzLCBhZGRyZXNzWzEwXSBvd25lcnMpIHsNCgkJdWludDMyIGVuZEluZGV4ID0gc3RhcnRJbmRleCArIDEwID4gbnVtQW5pbWFscyA/IG51bUFuaW1hbHMgOiBzdGFydEluZGV4ICsgMTA7DQoJCXVpbnQ4IGogPSAwOw0KCQl1aW50MzIgaWQ7DQoJCWZvciAodWludDE2IGkgPSBzdGFydEluZGV4OyBpIDwgZW5kSW5kZXg7IGkrKykgew0KCQkJaWQgPSBpZHNbaV07DQoJCQlhbmltYWxJZHNbal0gPSBpZDsNCgkJCXR5cGVzW2pdID0gYW5pbWFsc1tpZF0uYW5pbWFsVHlwZTsNCgkJCXZhbHVlc1tqXSA9IGFuaW1hbHNbaWRdLnZhbHVlOw0KCQkJb3duZXJzW2pdID0gYW5pbWFsc1tpZF0ub3duZXI7DQoJCQlqKys7DQoJCX0NCg0KCX0NCg0KDQoJZnVuY3Rpb24gZ2V0RmVlcygpIGNvbnN0YW50IHJldHVybnModWludCkgew0KCQl1aW50IHJlc2VydmVkID0gMDsNCgkJZm9yICh1aW50MTYgaiA9IDA7IGogPCBudW1BbmltYWxzOyBqKyspDQoJCQlyZXNlcnZlZCArPSBhbmltYWxzW2lkc1tqXV0udmFsdWU7DQoJCXJldHVybiBhZGRyZXNzKHRoaXMpLmJhbGFuY2UgLSByZXNlcnZlZDsNCgl9DQoNCg0KCS8qKioqKioqKioqKioqKioqKiogU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQoJZnVuY3Rpb24gc2V0T3JhY2xpemVHYXModWludDMyIG5ld0dhcykgew0KCQlpZiAoIShtc2cuc2VuZGVyID09IG93bmVyKSkgdGhyb3c7DQoJCW9yYWNsaXplR2FzID0gbmV3R2FzOw0KCX0NCg0KCWZ1bmN0aW9uIHNldE1heEFuaW1hbHModWludDE2IG51bWJlcikgew0KCQlpZiAoIShtc2cuc2VuZGVyID09IG93bmVyKSkgdGhyb3c7DQoJCW1heEFuaW1hbHMgPSBudW1iZXI7DQoJfQ0KCQ0KDQoJLyoqKioqKioqKioqKiogSEVMUEVSUyAqKioqKioqKioqKioqKioqLw0KDQoJLyoqDQoJICogbWFwcyBhIGdpdmVuIG51bWJlciB0byB0aGUgbmV3IHJhbmdlIChvbGQgcmFuZ2UgMTAwMCkNCgkgKiAqLw0KCWZ1bmN0aW9uIG1hcFRvTmV3UmFuZ2UodWludCBudW1iZXIsIHVpbnQgcmFuZ2UpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludDE2IHJhbmRvbU51bWJlcikgew0KCQlyZXR1cm4gdWludDE2KG51bWJlciAqIHJhbmdlIC8gMTAwMCk7DQoJfQ0KDQoJLyoqDQoJICogY29udmVydHMgYSBzdHJpbmcgb2YgbnVtYmVycyBiZWluZyBzZXBhcmF0ZWQgYnkgYSBnaXZlbiBkZWxpbWl0ZXIgaW50byBhbiBhcnJheSBvZiBudW1iZXJzICgjaG93bWFueSkgDQoJICovDQoJZnVuY3Rpb24gZ2V0TnVtYmVyc0Zyb21TdHJpbmcoc3RyaW5nIHMsIHN0cmluZyBkZWxpbWl0ZXIsIHVpbnQzMiBob3dtYW55KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQxNltdIG51bWJlcnMpIHsNCgkJc3RyaW5ncy5zbGljZSBtZW1vcnkgbXlyZXN1bHQgPSBzLnRvU2xpY2UoKTsNCgkJc3RyaW5ncy5zbGljZSBtZW1vcnkgZGVsaW0gPSBkZWxpbWl0ZXIudG9TbGljZSgpOw0KCQludW1iZXJzID0gbmV3IHVpbnQxNltdKGhvd21hbnkpOw0KCQlmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgaG93bWFueTsgaSsrKSB7DQoJCQludW1iZXJzW2ldID0gdWludDE2KHBhcnNlSW50KG15cmVzdWx0LnNwbGl0KGRlbGltKS50b1N0cmluZygpKSk7DQoJCX0NCgkJcmV0dXJuIG51bWJlcnM7DQoJfQ0KDQp9'