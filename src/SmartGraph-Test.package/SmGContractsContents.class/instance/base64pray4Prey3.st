base 64 content
base64pray4Prey3
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4wOy8vcGxlYXNlIGltcG9ydCBvcmFjbGl6ZUFQSV9wcmUwLjQuc29sIHdoZW4gc29saWRpdHkgPCAwLjQuMA0KDQpjb250cmFjdCBPcmFjbGl6ZUkgew0KICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsNCiAgICBmdW5jdGlvbiBxdWVyeSh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcmV0dXJucyAodWludCBfZHNwcmljZSk7DQogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsNCiAgICBmdW5jdGlvbiB1c2VDb3Vwb24oc3RyaW5nIF9jb3Vwb24pOw0KICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpOw0KICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOw0KICAgIGZ1bmN0aW9uIHNldEN1c3RvbUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKTsNCn0NCmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7DQogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOw0KfQ0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7DQogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCo2MCoyNDsNCiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCo2MCoyNCo3Ow0KICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsNCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OT05FID0gMHgwMDsNCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZTdG9yYWdlX0lQRlMgPSAweDAxOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsNCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX3Rlc3RuZXQgPSAyOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7DQoNCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOw0KICAgIA0KICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsNCiAgICBtb2RpZmllciBvcmFjbGl6ZUFQSSB7DQogICAgICAgIGlmKGFkZHJlc3MoT0FSKT09MCkgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7DQogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOw0KICAgICAgICBfOw0KICAgIH0NCiAgICBtb2RpZmllciBjb3Vwb24oc3RyaW5nIGNvZGUpew0KICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsNCiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsodWludDggbmV0d29ya0lEKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpew0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNiMjYzOGE3Y2M5ZjJjYjNkMjk4YTNkYTdhOTBiNjdlNTUwNmVkKT4wKXsgLy9tYWlubmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNiMjYzOGE3Y2M5ZjJjYjNkMjk4YTNkYTdhOTBiNjdlNTUwNmVkKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM2EyNjE1ZDVlZmFmNWY0OWY2MGI3YmI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldA0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzYTI2MTVkNWVmYWY1ZjQ5ZjYwYjdiYjY1ODNlYWVjMjEyZmRmMSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgyMGUxMmExZjg1OWIzZmVhZTVmYjJhMGEzMmMxOGY1YTY1NTU1YmJmKT4wKXsgLy9ldGhlci5jYW1wIGlkZQ0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJhMWY4NTliM2ZlYWU1ZmIyYTBhMzJjMThmNWE2NTU1NWJiZik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg5M2JiYmU1Y2U3NzAzNGUzMDk1ZjA0Nzk5MTk5NjJhOTAzZjg5OGFkKT4wKXsgLy9ub3JzYm9yZyB0ZXN0bmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg5M2JiYmU1Y2U3NzAzNGUzMDk1ZjA0Nzk5MTk5NjJhOTAzZjg5OGFkKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhZjRjOGIzYzlhZmJkNWFiOWY0YmJjODI3ODRhYjZlZjhmYWEpPjApeyAvL2Jyb3dzZXItc29saWRpdHkNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhZjRjOGIzYzlhZmJkNWFiOWY0YmJjODI3ODRhYjZlZjhmYWEpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgew0KICAgICAgICBfX2NhbGxiYWNrKG15aWQsIHJlc3VsdCwgbmV3IGJ5dGVzKDApKTsNCiAgICB9DQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5jYkFkZHJlc3MoKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldFByb29mVHlwZShwcm9vZlApOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7DQogICAgfSAgICANCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDb25maWcoYnl0ZXMzMiBjb25maWcpIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldENvbmZpZyhjb25maWcpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgew0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikNCiAgICAgICAgfQ0KICAgIH0NCg0KDQogICAgZnVuY3Rpb24gcGFyc2VBZGRyKHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7DQogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7DQogICAgICAgIHVpbnQxNjAgaWFkZHIgPSAwOw0KICAgICAgICB1aW50MTYwIGIxOw0KICAgICAgICB1aW50MTYwIGIyOw0KICAgICAgICBmb3IgKHVpbnQgaT0yOyBpPDIrMioyMDsgaSs9Mil7DQogICAgICAgICAgICBpYWRkciAqPSAyNTY7DQogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsNCiAgICAgICAgICAgIGIyID0gdWludDE2MCh0bXBbaSsxXSk7DQogICAgICAgICAgICBpZiAoKGIxID49IDk3KSYmKGIxIDw9IDEwMikpIGIxIC09IDg3Ow0KICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDQ4KSYmKGIxIDw9IDU3KSkgYjEgLT0gNDg7DQogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3Ow0KICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7DQogICAgICAgICAgICBpYWRkciArPSAoYjEqMTYrYjIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsNCiAgICB9DQoNCg0KICAgIGZ1bmN0aW9uIHN0ckNvbXBhcmUoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7DQogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gYS5sZW5ndGg7DQogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykNCiAgICAgICAgICAgIGlmIChhW2ldIDwgYltpXSkNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkNCiAgICAgICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpDQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpDQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICB9IA0KDQogICAgZnVuY3Rpb24gaW5kZXhPZihzdHJpbmcgX2hheXN0YWNrLCBzdHJpbmcgX25lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoaW50KQ0KICAgIHsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGggPSBieXRlcyhfaGF5c3RhY2spOw0KICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOw0KICAgICAgICBpZihoLmxlbmd0aCA8IDEgfHwgbi5sZW5ndGggPCAxIHx8IChuLmxlbmd0aCA+IGgubGVuZ3RoKSkgDQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkNCiAgICAgICAgICAgIHJldHVybiAtMTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIGVsc2UNCiAgICAgICAgew0KICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7DQogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoLmxlbmd0aDsgaSArKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXggPSAxOw0KICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCsrOw0KICAgICAgICAgICAgICAgICAgICB9ICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHN1YmluZGV4ID09IG4ubGVuZ3RoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIH0gICANCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmMgPSBieXRlcyhfYyk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7DQogICAgICAgIHN0cmluZyBtZW1vcnkgYWJjZGUgPSBuZXcgc3RyaW5nKF9iYS5sZW5ndGggKyBfYmIubGVuZ3RoICsgX2JjLmxlbmd0aCArIF9iZC5sZW5ndGggKyBfYmUubGVuZ3RoKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsNCiAgICAgICAgdWludCBrID0gMDsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2JhLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYVtpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JkLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZFtpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07DQogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgIiIsICIiLCAiIik7DQogICAgfQ0KDQogICAgLy8gcGFyc2VJbnQNCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsNCiAgICB9DQoNCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQ0KICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsNCiAgICAgICAgdWludCBtaW50ID0gMDsNCiAgICAgICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOw0KICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspew0KICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsNCiAgICAgICAgICAgICAgICBpZiAoZGVjaW1hbHMpew0KICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSBfYi0tOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOw0KICAgICAgICAgICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4Ow0KICAgICAgICAgICAgfSBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCoqX2I7DQogICAgICAgIHJldHVybiBtaW50Ow0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7DQogICAgICAgIGlmIChpID09IDApIHJldHVybiAiMCI7DQogICAgICAgIHVpbnQgaiA9IGk7DQogICAgICAgIHVpbnQgbGVuOw0KICAgICAgICB3aGlsZSAoaiAhPSAwKXsNCiAgICAgICAgICAgIGxlbisrOw0KICAgICAgICAgICAgaiAvPSAxMDsNCiAgICAgICAgfQ0KICAgICAgICBieXRlcyBtZW1vcnkgYnN0ciA9IG5ldyBieXRlcyhsZW4pOw0KICAgICAgICB1aW50IGsgPSBsZW4gLSAxOw0KICAgICAgICB3aGlsZSAoaSAhPSAwKXsNCiAgICAgICAgICAgIGJzdHJbay0tXSA9IGJ5dGUoNDggKyBpICUgMTApOw0KICAgICAgICAgICAgaSAvPSAxMDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc3RyaW5nKGJzdHIpOw0KICAgIH0NCiAgICANCiAgICANCg0KfQ0KLy8gPC9PUkFDTElaRV9BUEk+DQoNCg0KDQpsaWJyYXJ5IHN0cmluZ3Mgew0KICAgIHN0cnVjdCBzbGljZSB7DQogICAgICAgIHVpbnQgX2xlbjsNCiAgICAgICAgdWludCBfcHRyOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSB7DQogICAgICAgIC8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlDQogICAgICAgIGZvcig7IGxlbiA+PSAzMjsgbGVuIC09IDMyKSB7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG1sb2FkKHNyYykpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBkZXN0ICs9IDMyOw0KICAgICAgICAgICAgc3JjICs9IDMyOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ29weSByZW1haW5pbmcgYnl0ZXMNCiAgICAgICAgdWludCBtYXNrID0gMjU2ICoqICgzMiAtIGxlbikgLSAxOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoc3JjKSwgbm90KG1hc2spKQ0KICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChkZXN0KSwgbWFzaykNCiAgICAgICAgICAgIG1zdG9yZShkZXN0LCBvcihkZXN0cGFydCwgc3JjcGFydCkpDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzdHJpbmcgdG8gbWFrZSBhIHNsaWNlIGZyb20uDQogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRvU2xpY2Uoc3RyaW5nIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGYsIDB4MjApDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHNsaWNlKGJ5dGVzKHNlbGYpLmxlbmd0aCwgcHRyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBvZiBhIG51bGwtdGVybWluYXRlZCBieXRlczMyIHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgdmFsdWUgdG8gZmluZCB0aGUgbGVuZ3RoIG9mLg0KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc3RyaW5nLCBmcm9tIDAgdG8gMzIuDQogICAgICovDQogICAgZnVuY3Rpb24gbGVuKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICB1aW50IHJldDsNCiAgICAgICAgaWYgKHNlbGYgPT0gMCkNCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDE2Ow0KICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7DQogICAgICAgICAgICByZXQgKz0gODsNCiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDQ7DQogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDApOw0KICAgICAgICB9DQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmID09IDApIHsNCiAgICAgICAgICAgIHJldCArPSAyOw0KICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDApOw0KICAgICAgICB9DQogICAgICAgIGlmIChzZWxmICYgMHhmZiA9PSAwKSB7DQogICAgICAgICAgICByZXQgKz0gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMzIgLSByZXQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIGJ5dGVzMzIsIGludGVycHJldGVkIGFzIGENCiAgICAgKiAgICAgIG51bGwtdGVybWludGFlZCB1dGYtOCBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGJ5dGVzMzIgdmFsdWUgdG8gY29udmVydCB0byBhIHNsaWNlLg0KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgdmFsdWUgb2YgdGhlIGlucHV0IGFyZ3VtZW50IHVwIHRvIHRoZQ0KICAgICAqICAgICAgICAgZmlyc3QgbnVsbC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0b1NsaWNlQjMyKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7DQogICAgICAgIC8vIEFsbG9jYXRlIHNwYWNlIGZvciBgc2VsZmAgaW4gbWVtb3J5LCBjb3B5IGl0IHRoZXJlLCBhbmQgcG9pbnQgcmV0IGF0IGl0DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIGxldCBwdHIgOj0gbWxvYWQoMHg0MCkNCiAgICAgICAgICAgIG1zdG9yZSgweDQwLCBhZGQocHRyLCAweDIwKSkNCiAgICAgICAgICAgIG1zdG9yZShwdHIsIHNlbGYpDQogICAgICAgICAgICBtc3RvcmUoYWRkKHJldCwgMHgyMCksIHB0cikNCiAgICAgICAgfQ0KICAgICAgICByZXQuX2xlbiA9IGxlbihzZWxmKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIHRoZSBjdXJyZW50IHNsaWNlLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5Lg0KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIGBzZWxmYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb3B5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHJldHVybiBzbGljZShzZWxmLl9sZW4sIHNlbGYuX3B0cik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuDQogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgc2xpY2UncyB0ZXh0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4pOw0KICAgICAgICB1aW50IHJldHB0cjsNCiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0NCg0KICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggaW4gcnVuZXMgb2YgdGhlIHNsaWNlLiBOb3RlIHRoYXQgdGhpcyBvcGVyYXRpb24NCiAgICAgKiAgICAgIHRha2VzIHRpbWUgcHJvcG9ydGlvbmFsIHRvIHRoZSBsZW5ndGggb2YgdGhlIHNsaWNlOyBhdm9pZCB1c2luZyBpdA0KICAgICAqICAgICAgaW4gbG9vcHMsIGFuZCBjYWxsIGBzbGljZS5lbXB0eSgpYCBpZiB5b3Ugb25seSBuZWVkIHRvIGtub3cgd2hldGhlcg0KICAgICAqICAgICAgdGhlIHNsaWNlIGlzIGVtcHR5IG9yIG5vdC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHNsaWNlIGluIHJ1bmVzLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxlbihzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIC8vIFN0YXJ0aW5nIGF0IHB0ci0zMSBtZWFucyB0aGUgTFNCIHdpbGwgYmUgdGhlIGJ5dGUgd2UgY2FyZSBhYm91dA0KICAgICAgICB2YXIgcHRyID0gc2VsZi5fcHRyIC0gMzE7DQogICAgICAgIHZhciBlbmQgPSBwdHIgKyBzZWxmLl9sZW47DQogICAgICAgIGZvciAodWludCBsZW4gPSAwOyBwdHIgPCBlbmQ7IGxlbisrKSB7DQogICAgICAgICAgICB1aW50OCBiOw0KICAgICAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChwdHIpLCAweEZGKSB9DQogICAgICAgICAgICBpZiAoYiA8IDB4ODApIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gMTsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSAyOw0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDM7DQogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjgpIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gNDsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGQykgew0KICAgICAgICAgICAgICAgIHB0ciArPSA1Ow0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gNjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbGVuOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSAoaGFzIGEgbGVuZ3RoIG9mIDApLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2UgaXMgZW1wdHksIEZhbHNlIG90aGVyd2lzZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBlbXB0eShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiBzZWxmLl9sZW4gPT0gMDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgYSBwb3NpdGl2ZSBudW1iZXIgaWYgYG90aGVyYCBjb21lcyBsZXhpY29ncmFwaGljYWxseSBhZnRlcg0KICAgICAqICAgICAgYHNlbGZgLCBhIG5lZ2F0aXZlIG51bWJlciBpZiBpdCBjb21lcyBiZWZvcmUsIG9yIHplcm8gaWYgdGhlDQogICAgICogICAgICBjb250ZW50cyBvZiB0aGUgdHdvIHNsaWNlcyBhcmUgZXF1YWwuIENvbXBhcmlzb24gaXMgZG9uZSBwZXItcnVuZSwNCiAgICAgKiAgICAgIG9uIHVuaWNvZGUgY29kZXBvaW50cy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29tcGFyZS4NCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLg0KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBvZiB0aGUgY29tcGFyaXNvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb21wYXJlKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsNCiAgICAgICAgdWludCBzaG9ydGVzdCA9IHNlbGYuX2xlbjsNCiAgICAgICAgaWYgKG90aGVyLl9sZW4gPCBzZWxmLl9sZW4pDQogICAgICAgICAgICBzaG9ydGVzdCA9IG90aGVyLl9sZW47DQoNCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHI7DQogICAgICAgIHZhciBvdGhlcnB0ciA9IG90aGVyLl9wdHI7DQogICAgICAgIGZvciAodWludCBpZHggPSAwOyBpZHggPCBzaG9ydGVzdDsgaWR4ICs9IDMyKSB7DQogICAgICAgICAgICB1aW50IGE7DQogICAgICAgICAgICB1aW50IGI7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgYSA6PSBtbG9hZChzZWxmcHRyKQ0KICAgICAgICAgICAgICAgIGIgOj0gbWxvYWQob3RoZXJwdHIpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYSAhPSBiKSB7DQogICAgICAgICAgICAgICAgLy8gTWFzayBvdXQgaXJyZWxldmFudCBieXRlcyBhbmQgY2hlY2sgYWdhaW4NCiAgICAgICAgICAgICAgICB1aW50IG1hc2sgPSB+KDIgKiogKDggKiAoMzIgLSBzaG9ydGVzdCArIGlkeCkpIC0gMSk7DQogICAgICAgICAgICAgICAgdmFyIGRpZmYgPSAoYSAmIG1hc2spIC0gKGIgJiBtYXNrKTsNCiAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPSAwKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGRpZmYpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2VsZnB0ciArPSAzMjsNCiAgICAgICAgICAgIG90aGVycHRyICs9IDMyOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBpbnQoc2VsZi5fbGVuKSAtIGludChvdGhlci5fbGVuKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgdHdvIHNsaWNlcyBjb250YWluIHRoZSBzYW1lIHRleHQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2VzIGFyZSBlcXVhbCwgZmFsc2Ugb3RoZXJ3aXNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVxdWFscyhzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gY29tcGFyZShzZWxmLCBvdGhlcikgPT0gMDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IEV4dHJhY3RzIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSBpbnRvIGBydW5lYCwgYWR2YW5jaW5nIHRoZQ0KICAgICAqICAgICAgc2xpY2UgdG8gcG9pbnQgdG8gdGhlIG5leHQgcnVuZSBhbmQgcmV0dXJuaW5nIGBzZWxmYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gcnVuZSBUaGUgc2xpY2UgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIGZpcnN0IHJ1bmUuDQogICAgICogQHJldHVybiBgcnVuZWAuDQogICAgICovDQogICAgZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZiwgc2xpY2UgcnVuZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgcnVuZS5fcHRyID0gc2VsZi5fcHRyOw0KDQogICAgICAgIGlmIChzZWxmLl9sZW4gPT0gMCkgew0KICAgICAgICAgICAgcnVuZS5fbGVuID0gMDsNCiAgICAgICAgICAgIHJldHVybiBydW5lOw0KICAgICAgICB9DQoNCiAgICAgICAgdWludCBsZW47DQogICAgICAgIHVpbnQgYjsNCiAgICAgICAgLy8gTG9hZCB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgcnVuZSBpbnRvIHRoZSBMU0JzIG9mIGINCiAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChzdWIobWxvYWQoYWRkKHNlbGYsIDMyKSksIDMxKSksIDB4RkYpIH0NCiAgICAgICAgaWYgKGIgPCAweDgwKSB7DQogICAgICAgICAgICBsZW4gPSAxOw0KICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsNCiAgICAgICAgICAgIGxlbiA9IDI7DQogICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgew0KICAgICAgICAgICAgbGVuID0gMzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxlbiA9IDQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMNCiAgICAgICAgaWYgKGxlbiA+IHNlbGYuX2xlbikgew0KICAgICAgICAgICAgcnVuZS5fbGVuID0gc2VsZi5fbGVuOw0KICAgICAgICAgICAgc2VsZi5fcHRyICs9IHNlbGYuX2xlbjsNCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7DQogICAgICAgICAgICByZXR1cm4gcnVuZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYuX3B0ciArPSBsZW47DQogICAgICAgIHNlbGYuX2xlbiAtPSBsZW47DQogICAgICAgIHJ1bmUuX2xlbiA9IGxlbjsNCiAgICAgICAgcmV0dXJuIHJ1bmU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSwgYWR2YW5jaW5nIHRoZSBzbGljZSB0byBwb2ludA0KICAgICAqICAgICAgdG8gdGhlIG5leHQgcnVuZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcmV0dXJuIEEgc2xpY2UgY29udGFpbmluZyBvbmx5IHRoZSBmaXJzdCBydW5lIGZyb20gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG5leHRSdW5lKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHJldCkgew0KICAgICAgICBuZXh0UnVuZShzZWxmLCByZXQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEByZXR1cm4gVGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBvcmQoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCByZXQpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIHVpbnQgd29yZDsNCiAgICAgICAgdWludCBsZW47DQogICAgICAgIHVpbnQgZGl2ID0gMiAqKiAyNDg7DQoNCiAgICAgICAgLy8gTG9hZCB0aGUgcnVuZSBpbnRvIHRoZSBNU0JzIG9mIGINCiAgICAgICAgYXNzZW1ibHkgeyB3b3JkOj0gbWxvYWQobWxvYWQoYWRkKHNlbGYsIDMyKSkpIH0NCiAgICAgICAgdmFyIGIgPSB3b3JkIC8gZGl2Ow0KICAgICAgICBpZiAoYiA8IDB4ODApIHsNCiAgICAgICAgICAgIHJldCA9IGI7DQogICAgICAgICAgICBsZW4gPSAxOw0KICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsNCiAgICAgICAgICAgIHJldCA9IGIgJiAweDFGOw0KICAgICAgICAgICAgbGVuID0gMjsNCiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7DQogICAgICAgICAgICByZXQgPSBiICYgMHgwRjsNCiAgICAgICAgICAgIGxlbiA9IDM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXQgPSBiICYgMHgwNzsNCiAgICAgICAgICAgIGxlbiA9IDQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMNCiAgICAgICAgaWYgKGxlbiA+IHNlbGYuX2xlbikgew0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPCBsZW47IGkrKykgew0KICAgICAgICAgICAgZGl2ID0gZGl2IC8gMjU2Ow0KICAgICAgICAgICAgYiA9ICh3b3JkIC8gZGl2KSAmIDB4RkY7DQogICAgICAgICAgICBpZiAoYiAmIDB4QzAgIT0gMHg4MCkgew0KICAgICAgICAgICAgICAgIC8vIEludmFsaWQgVVRGLTggc2VxdWVuY2UNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldCA9IChyZXQgKiA2NCkgfCAoYiAmIDB4M0YpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGtlY2Nhay0yNTYgaGFzaCBvZiB0aGUgc2xpY2UuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGhhc2guDQogICAgICogQHJldHVybiBUaGUgaGFzaCBvZiB0aGUgc2xpY2UuDQogICAgICovDQogICAgZnVuY3Rpb24ga2VjY2FrKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgcmV0KSB7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIHJldCA6PSBzaGEzKG1sb2FkKGFkZChzZWxmLCAzMikpLCBtbG9hZChzZWxmKSkNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdGFydHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLl9wdHIgPT0gbmVlZGxlLl9wdHIpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgYm9vbCBlcXVhbDsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpDQogICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpDQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQ0KICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZXF1YWw7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBJZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUNCiAgICAgKiAgICAgIGJlZ2lubmluZyBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIGBzZWxmYA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJleW9uZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIH0NCg0KICAgICAgICBib29sIGVxdWFsID0gdHJ1ZTsNCiAgICAgICAgaWYgKHNlbGYuX3B0ciAhPSBuZWVkbGUuX3B0cikgew0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KICAgICAgICAgICAgICAgIGxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkNCiAgICAgICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQ0KICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZXF1YWwpIHsNCiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSBuZWVkbGUuX2xlbjsNCiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBlbmRzIHdpdGggYG5lZWRsZWAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuDQogICAgICovDQogICAgZnVuY3Rpb24gZW5kc1dpdGgoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsNCg0KICAgICAgICBpZiAoc2VsZnB0ciA9PSBuZWVkbGUuX3B0cikgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICBib29sIGVxdWFsOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkNCiAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpDQogICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGVxdWFsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgSWYgYHNlbGZgIGVuZHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQ0KICAgICAqICAgICAgZW5kIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gYHNlbGZgDQogICAgICovDQogICAgZnVuY3Rpb24gdW50aWwoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsNCiAgICAgICAgYm9vbCBlcXVhbCA9IHRydWU7DQogICAgICAgIGlmIChzZWxmcHRyICE9IG5lZWRsZS5fcHRyKSB7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpDQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCiAgICAgICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGVxdWFsKSB7DQogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICB9DQoNCiAgICAvLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZg0KICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgYHNlbGZgIGlmIG5vdCBmb3VuZC4NCiAgICBmdW5jdGlvbiBmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgew0KICAgICAgICB1aW50IHB0cjsNCiAgICAgICAgdWludCBpZHg7DQoNCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7DQogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7DQogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OCBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spDQogICAgICAgICAgICAgICAgICAgIGxldCBlbmQgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cg0KICAgICAgICAgICAgICAgICAgICBsb29wOg0KICAgICAgICAgICAgICAgICAgICBqdW1waShleGl0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgMSkNCiAgICAgICAgICAgICAgICAgICAganVtcGkobG9vcCwgbHQoc3ViKHB0ciwgMSksIGVuZCkpDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc2VsZmxlbikNCiAgICAgICAgICAgICAgICAgICAgZXhpdDoNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gRm9yIGxvbmcgbmVlZGxlcywgdXNlIGhhc2hpbmcNCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7DQogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0NCiAgICAgICAgICAgICAgICBwdHIgPSBzZWxmcHRyOw0KICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDw9IHNlbGZsZW4gLSBuZWVkbGVsZW47IGlkeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7DQogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgdGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbikgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaCA9PSB0ZXN0SGFzaCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHI7DQogICAgICAgICAgICAgICAgICAgIHB0ciArPSAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2VsZnB0ciArIHNlbGZsZW47DQogICAgfQ0KDQogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZg0KICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGFkZHJlc3Mgb2YgYHNlbGZgIGlmIG5vdCBmb3VuZC4NCiAgICBmdW5jdGlvbiByZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdWludCBwdHI7DQoNCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7DQogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7DQogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OSBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc3ViKHNlbGZsZW4sIG5lZWRsZWxlbikpDQogICAgICAgICAgICAgICAgICAgIGxvb3A6DQogICAgICAgICAgICAgICAgICAgIGp1bXBpKHJldCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHN1YihwdHIsIDEpDQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGd0KGFkZChwdHIsIDEpLCBzZWxmcHRyKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHNlbGZwdHINCiAgICAgICAgICAgICAgICAgICAganVtcChleGl0KQ0KICAgICAgICAgICAgICAgICAgICByZXQ6DQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCBuZWVkbGVsZW4pDQogICAgICAgICAgICAgICAgICAgIGV4aXQ6DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nDQogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgaGFzaCA6PSBzaGEzKG5lZWRsZXB0ciwgbmVlZGxlbGVuKSB9DQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0ciArIChzZWxmbGVuIC0gbmVlZGxlbGVuKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAocHRyID49IHNlbGZwdHIpIHsNCiAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiB0ZXN0SGFzaDsNCiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9DQogICAgICAgICAgICAgICAgICAgIGlmIChoYXNoID09IHRlc3RIYXNoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB0ciArIG5lZWRsZWxlbjsNCiAgICAgICAgICAgICAgICAgICAgcHRyIC09IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzZWxmcHRyOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gZXZlcnl0aGluZyBmcm9tIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mDQogICAgICogICAgICBgbmVlZGxlYCB0byB0aGUgZW5kIG9mIHRoZSBzbGljZS4gYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UNCiAgICAgKiAgICAgIGlmIGBuZWVkbGVgIGlzIG5vdCBmb3VuZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQogICAgICAgIHNlbGYuX2xlbiAtPSBwdHIgLSBzZWxmLl9wdHI7DQogICAgICAgIHNlbGYuX3B0ciA9IHB0cjsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBNb2RpZmllcyBgc2VsZmAgdG8gY29udGFpbiB0aGUgcGFydCBvZiB0aGUgc3RyaW5nIGZyb20gdGhlIHN0YXJ0IG9mDQogICAgICogICAgICBgc2VsZmAgdG8gdGhlIGVuZCBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYC4gSWYgYG5lZWRsZWANCiAgICAgKiAgICAgIGlzIG5vdCBmb3VuZCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIGBzZWxmYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiByZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyID0gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQogICAgICAgIHNlbGYuX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdA0KICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmDQogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLA0KICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uDQogICAgICogQHJldHVybiBgdG9rZW5gLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCiAgICAgICAgdG9rZW4uX3B0ciA9IHNlbGYuX3B0cjsNCiAgICAgICAgdG9rZW4uX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsNCiAgICAgICAgaWYgKHB0ciA9PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsNCiAgICAgICAgICAgIC8vIE5vdCBmb3VuZA0KICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47DQogICAgICAgICAgICBzZWxmLl9wdHIgPSBwdHIgKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdG9rZW47DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdA0KICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYNCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsDQogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCB1cCB0byB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgZGVsaW1gLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsNCiAgICAgICAgc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGJlZm9yZSB0aGUgbGFzdA0KICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBhZnRlciBpdC4gSWYNCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsDQogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4NCiAgICAgKiBAcmV0dXJuIGB0b2tlbmAuDQogICAgICovDQogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyID0gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQogICAgICAgIHRva2VuLl9wdHIgPSBwdHI7DQogICAgICAgIHRva2VuLl9sZW4gPSBzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKTsNCiAgICAgICAgaWYgKHB0ciA9PSBzZWxmLl9wdHIpIHsNCiAgICAgICAgICAgIC8vIE5vdCBmb3VuZA0KICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRva2VuOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QNCiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBhZnRlciBpdC4gSWYNCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsDQogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuDQogICAgICovDQogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsNCiAgICAgICAgcnNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgQ291bnRzIHRoZSBudW1iZXIgb2Ygbm9ub3ZlcmxhcHBpbmcgb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgaW4gYHNlbGZgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgZm91bmQgaW4gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNvdW50KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAodWludCBjb3VudCkgew0KICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgd2hpbGUgKHB0ciA8PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsNCiAgICAgICAgICAgIGNvdW50Kys7DQogICAgICAgICAgICBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpLCBwdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyBUcnVlIGlmIGBzZWxmYCBjb250YWlucyBgbmVlZGxlYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoLg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHJldHVybiBUcnVlIGlmIGBuZWVkbGVgIGlzIGZvdW5kIGluIGBzZWxmYCwgZmFsc2Ugb3RoZXJ3aXNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNvbnRhaW5zKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgIT0gc2VsZi5fcHRyOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyBhIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgY29uY2F0ZW5hdGlvbiBvZg0KICAgICAqICAgICAgYHNlbGZgIGFuZCBgb3RoZXJgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb25jYXRlbmF0ZS4NCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb25jYXRlbmF0ZS4NCiAgICAgKiBAcmV0dXJuIFRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZSB0d28gc3RyaW5ncy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb25jYXQoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4gKyBvdGhlci5fbGVuKTsNCiAgICAgICAgdWludCByZXRwdHI7DQogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9DQogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsNCiAgICAgICAgbWVtY3B5KHJldHB0ciArIHNlbGYuX2xlbiwgb3RoZXIuX3B0ciwgb3RoZXIuX2xlbik7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBKb2lucyBhbiBhcnJheSBvZiBzbGljZXMsIHVzaW5nIGBzZWxmYCBhcyBhIGRlbGltaXRlciwgcmV0dXJuaW5nIGENCiAgICAgKiAgICAgIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGRlbGltaXRlciB0byB1c2UuDQogICAgICogQHBhcmFtIHBhcnRzIEEgbGlzdCBvZiBzbGljZXMgdG8gam9pbi4NCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIGFsbCB0aGUgc2xpY2VzIGluIGBwYXJ0c2AsDQogICAgICogICAgICAgICBqb2luZWQgd2l0aCBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gam9pbihzbGljZSBzZWxmLCBzbGljZVtdIHBhcnRzKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgcmV0dXJuICIiOw0KDQogICAgICAgIHVpbnQgbGVuID0gc2VsZi5fbGVuICogKHBhcnRzLmxlbmd0aCAtIDEpOw0KICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgbGVuICs9IHBhcnRzW2ldLl9sZW47DQoNCiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcobGVuKTsNCiAgICAgICAgdWludCByZXRwdHI7DQogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9DQoNCiAgICAgICAgZm9yKGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHBhcnRzW2ldLl9wdHIsIHBhcnRzW2ldLl9sZW4pOw0KICAgICAgICAgICAgcmV0cHRyICs9IHBhcnRzW2ldLl9sZW47DQogICAgICAgICAgICBpZiAoaSA8IHBhcnRzLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7DQogICAgICAgICAgICAgICAgcmV0cHRyICs9IHNlbGYuX2xlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KfQ0KDQoNCmNvbnRyYWN0IG1vcnRhbCB7DQoJYWRkcmVzcyBvd25lcjsNCg0KCWZ1bmN0aW9uIG1vcnRhbCgpIHsNCgkJb3duZXIgPSBtc2cuc2VuZGVyOw0KCX0NCg0KCWZ1bmN0aW9uIGtpbGwoKSBpbnRlcm5hbCB7DQoJCXN1aWNpZGUob3duZXIpOw0KCX0NCn0NCg0KY29udHJhY3QgUHJheTRQcmV5IGlzIG1vcnRhbCwgdXNpbmdPcmFjbGl6ZSB7DQoJdXNpbmcgc3RyaW5ncw0KCWZvciAqIDsNCg0KCXN0cnVjdCBBbmltYWwgew0KCQl1aW50OCBhbmltYWxUeXBlOw0KCQl1aW50MTI4IHZhbHVlOw0KCQlhZGRyZXNzIG93bmVyOw0KCX0NCg0KCS8qKiBhcnJheSBob2xkaW5nIGlkcyBvZiB0aGUgY3VycmV0IGFuaW1hbHMqLw0KCXVpbnQzMltdIHB1YmxpYyBpZHM7DQoJLyoqIHRoZSBpZCB0byBiZSBnaXZlbiB0byB0aGUgbmV0IGFuaW1hbCAqKi8NCgl1aW50MzIgcHVibGljIG5leHRJZDsNCgkvKiogdGhlIGlkIG9mIHRoZSBvbGRlc3QgYW5pbWFsICovDQoJdWludDMyIHB1YmxpYyBvbGRlc3Q7DQoJLyoqIHRoZSBhbmltYWwgYmVsb25naW5nIHRvIGEgZ2l2ZW4gaWQgKi8NCgltYXBwaW5nKHVpbnQzMiA9PiBBbmltYWwpIGFuaW1hbHM7DQoJLyoqIHRoZSBjb3N0IG9mIGVhY2ggYW5pbWFsIHR5cGUgKi8NCgl1aW50MTI4W10gcHVibGljIGNvc3RzOw0KCS8qKiB0aGUgdmFsdWUgb2YgZWFjaCBhbmltYWwgdHlwZSAoY29zdCAtIGZlZSksIHNvIGl0J3Mgbm90IG5lY2Vzc2FyeSB0byBjb21wdXRlIGl0IGVhY2ggdGltZSovDQoJdWludDEyOFtdIHB1YmxpYyB2YWx1ZXM7DQoJLyoqIHRoZSBmZWUgdG8gYmUgcGFpZCBlYWNoIHRpbWUgYW4gYW5pbWFsIGlzIGJvdWdodCBpbiBwZXJjZW50Ki8NCgl1aW50OCAgZmVlOw0KDQoJLyoqIHRvdGFsIG51bWJlciBvZiBhbmltYWxzIGluIHRoZSBnYW1lIA0KCSghPXN1bSBvZiB0aGUgbGVuZ3RocyBvZiB0aGUgcHJleSBhbmltYWxzIGFycmF5cywgc2luY2UgdGhvc2UgYXJyYXlzIGNvbnRhaW4gaG9sZXMpICovDQoJdWludDE2IHB1YmxpYyBudW1BbmltYWxzOw0KCS8qKiBUaGUgbWF4aW11bSBvZiBhbmltYWxzIGFsbG93ZWQgaW4gdGhlIGdhbWUgKi8NCgl1aW50MTYgcHVibGljIG1heEFuaW1hbHM7DQoJLyoqIG51bWJlciBvZiBhbmltYWxzIHBlciB0eXBlICovDQoJbWFwcGluZyh1aW50OCA9PiB1aW50MTYpIHB1YmxpYyBudW1BbmltYWxzWFR5cGU7DQoNCg0KCS8qKiB0aGUgcXVlcnkgc3RyaW5nIGdldHRpbmcgdGhlIHJhbmRvbSBudW1iZXJzIGZyb20gb3JhY2xpemUqKi8NCglzdHJpbmcgIHJhbmRvbVF1ZXJ5Ow0KCS8qKiB0aGUgdHlwZSBvZiB0aGUgb3JhY2xpemUgcXVlcnkqKi8NCglzdHJpbmcgIHF1ZXJ5VHlwZTsNCgkvKiogdGhlIHRpbWVzdGFtcCBvZiB0aGUgbmV4dCBhdHRhY2sgKiovDQoJdWludCBwdWJsaWMgbmV4dEF0dGFja1RpbWVzdGFtcDsNCgkvKiogZ2FzIHByb3ZpZGVkIGZvciBvcmFjbGl6ZSBjYWxsYmFjayAoYXR0YWNrKSoqLw0KCXVpbnQzMiBwdWJsaWMgb3JhY2xpemVHYXM7DQoJLyoqIHRoZSBpZCBvZiB0aGUgbmV4dCBvcmFjbGl6ZSBjYWxsYmFjayovDQoJYnl0ZXMzMiBuZXh0QXR0YWNrSWQ7DQoNCg0KCS8qKiBpcyBmaXJlZCB3aGVuIG5ldyBhbmltYWxzIGFyZSBwdXJjaGFzZWQgKHdobyBib3VnaHQgaG93IG1hbnkgYW5pbWFscyBvZiB3aGljaCB0eXBlPykgKi8NCglldmVudCBuZXdQdXJjaGFzZShhZGRyZXNzIHBsYXllciwgdWludDggYW5pbWFsVHlwZSwgdWludDggYW1vdW50LCB1aW50MzIgc3RhcnRJZCk7DQoJLyoqIGlzIGZpcmVkIHdoZW4gYSBwbGF5ZXIgbGVhdmVzIHRoZSBnYW1lICovDQoJZXZlbnQgbmV3RXhpdChhZGRyZXNzIHBsYXllciwgdWludDI1NiB0b3RhbEJhbGFuY2UpOw0KCS8qKiBpcyBmaXJlZCB3aGVuIGFuIGF0dGFjayBvY2N1cmVzICovDQoJZXZlbnQgbmV3QXR0YWNrKHVpbnQzMltdIGtpbGxlZEFuaW1hbHMpOw0KDQoNCgkvKiogZXhwZWN0ZWQgcGFyYW1ldGVyczogdGhlIGNvc3RzIHBlciBhbmltYWwgdHlwZSBhbmQgdGhlIGdhbWUgZmVlIGluIHBlcmNlbnQgDQoJICogICBhc3N1bWVzIHRoYXQgdGhlIGNoZWFwZXN0IGFuaW1hbCBpcyBzdG9yZWQgaW4gWzBdDQoJICovDQoJZnVuY3Rpb24gUHJheTRQcmV5KCkgew0KCQljb3N0cyA9IFsxMDAwMDAwMDAwMDAwMDAwMDAsMjAwMDAwMDAwMDAwMDAwMDAwLDUwMDAwMDAwMDAwMDAwMDAwMCwxMDAwMDAwMDAwMDAwMDAwMDAwLDUwMDAwMDAwMDAwMDAwMDAwMDBdOw0KCQlmZWUgPSA1Ow0KCQlmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgY29zdHMubGVuZ3RoOyBpKyspIHsNCgkJCXZhbHVlcy5wdXNoKGNvc3RzW2ldIC0gY29zdHNbaV0gLyAxMDAgKiBmZWUpOw0KCQl9DQoJCW1heEFuaW1hbHMgPSAzMDA7DQoJCXJhbmRvbVF1ZXJ5ID0gIjEwIHJhbmRvbSBudW1iZXJzIGJldHdlZW4gMSBhbmQgMTAwMCI7DQoJCXF1ZXJ5VHlwZSA9ICJXb2xmcmFtQWxwaGEiOw0KCQlvcmFjbGl6ZUdhcyA9IDQwMDAwMDsNCgkJbmV4dElkID0gMTsNCgkJb2xkZXN0ID0gMTsNCgl9DQoNCgkvKiogVGhlIGZhbGxiYWNrIGZ1bmN0aW9uIHJ1bnMgd2hlbmV2ZXIgc29tZW9uZSBzZW5kcyBldGhlcg0KCSAgIERlcGVuZGluZyBvZiB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHRoZSBzZW5kZXIgaXMgZWl0aGVyIGdyYW50ZWQgYSBwcmV5IG9yIA0KCSAgIHRoZSB0cmFuc2FjdGlvbiBpcyBkaXNjYXJkZWQgYW5kIG5vIGV0aGVyIGFjY2VwdGVkDQoJICAgSW4gdGhlIGZpcnN0IGNhc2UgZmVlcyBoYXZlIHRvIGJlIHBhaWQqLw0KCWZ1bmN0aW9uKCkgcGF5YWJsZSB7DQoJCWZvciAodWludDggaSA9IDA7IGkgPCBjb3N0cy5sZW5ndGg7IGkrKykNCgkJCWlmIChtc2cudmFsdWUgPT0gY29zdHNbaV0pDQoJCQkJYWRkQW5pbWFscyhpKTsNCg0KCQlpZiAobXNnLnZhbHVlID09IDEwMDAwMDAwMDAwMDAwMDApDQoJCQlleGl0KCk7DQoJCWVsc2UNCgkJCXRocm93Ow0KDQoJfQ0KDQoJLyoqIGJ1eSBhbmltYWxzIG9mIGEgZ2l2ZW4gdHlwZSANCgkgKiAgYXMgbWFueSBhbmltYWxzIGFzIHBvc3NpYmxlIGFyZSBib3VnaHQgd2l0aCBtc2cudmFsdWUNCgkgKi8NCglmdW5jdGlvbiBhZGRBbmltYWxzKHVpbnQ4IGFuaW1hbFR5cGUpIHBheWFibGUgew0KCQlnaXZlQW5pbWFscyhhbmltYWxUeXBlLCBtc2cuc2VuZGVyKTsNCgl9DQoJDQoJLyoqIGJ1eSBhbmltYWxzIG9mIGEgZ2l2ZW4gdHlwZSBmb3Jzb21lb25lIGVsc2UNCgkgKiAgYXMgbWFueSBhbmltYWxzIGFzIHBvc3NpYmxlIGFyZSBib3VnaHQgd2l0aCBtc2cudmFsdWUNCgkgKi8NCglmdW5jdGlvbiBnaXZlQW5pbWFscyh1aW50OCBhbmltYWxUeXBlLCBhZGRyZXNzIHJlY2VpdmVyKSBwYXlhYmxlIHsNCgkJdWludDggYW1vdW50ID0gdWludDgobXNnLnZhbHVlIC8gY29zdHNbYW5pbWFsVHlwZV0pOw0KCQlpZiAoYW5pbWFsVHlwZSA+PSBjb3N0cy5sZW5ndGggfHwgbXNnLnZhbHVlIDwgY29zdHNbYW5pbWFsVHlwZV0gfHwgIG51bUFuaW1hbHMgKyBhbW91bnQgPj0gbWF4QW5pbWFscykgdGhyb3c7DQoJCS8vaWYgdHlwZSBleGlzdHMsIGVub3VnaCBldGhlciB3YXMgdHJhbnNmZXJyZWQgYW5kIHRoZXJlIGFyZSBsZXNzIHRoYW4gbWF4QW5pbWFscyBhbmltYWxzIGluIHRoZSBnYW1lDQoJCWZvciAodWludDggaiA9IDA7IGogPCBhbW91bnQ7IGorKykgew0KCQkJYWRkQW5pbWFsKGFuaW1hbFR5cGUsIHJlY2VpdmVyKTsNCgkJfQ0KCQludW1BbmltYWxzWFR5cGVbYW5pbWFsVHlwZV0gKz0gYW1vdW50Ow0KCQluZXdQdXJjaGFzZShyZWNlaXZlciwgYW5pbWFsVHlwZSwgYW1vdW50LCBuZXh0SWQtYW1vdW50KTsNCgl9DQoNCgkvKioNCgkgKiAgYWRkcyBhIHNpbmdsZSBhbmltYWwgb2YgdGhlIGdpdmVuIHR5cGUNCgkgKi8NCglmdW5jdGlvbiBhZGRBbmltYWwodWludDggYW5pbWFsVHlwZSwgYWRkcmVzcyByZWNlaXZlcikgaW50ZXJuYWwgew0KCQlpZiAobnVtQW5pbWFscyA8IGlkcy5sZW5ndGgpDQoJCQlpZHNbbnVtQW5pbWFsc10gPSBuZXh0SWQ7DQoJCWVsc2UNCgkJCWlkcy5wdXNoKG5leHRJZCk7DQoJCWFuaW1hbHNbbmV4dElkXSA9IEFuaW1hbChhbmltYWxUeXBlLCB2YWx1ZXNbYW5pbWFsVHlwZV0sIHJlY2VpdmVyKTsNCgkJbmV4dElkKys7DQoJCW51bUFuaW1hbHMrKzsNCgl9DQoJDQoNCg0KCS8qKiBsZWF2ZSB0aGUgZ2FtZQ0KCSAqIHBheXMgb3V0IHRoZSBzZW5kZXIncyB3aW5CYWxhbmNlIGFuZCByZW1vdmVzIGhpbSBhbmQgaGlzIGFuaW1hbHMgZnJvbSB0aGUgZ2FtZQ0KCSAqICovDQoJZnVuY3Rpb24gZXhpdCgpIHsNCgkJdWludCBiYWxhbmNlID0gY2xlYW5VcChtc2cuc2VuZGVyKTsgLy9kZWxldGUgdGhlIGFuaW1hbHMNCgkJbmV3RXhpdChtc2cuc2VuZGVyLCBiYWxhbmNlKTsgLy9maXJlIHRoZSBldmVudCB0byBub3RpZnkgdGhlIGNsaWVudA0KCQlpZiAoIW1zZy5zZW5kZXIuc2VuZChiYWxhbmNlKSkgdGhyb3c7DQoJfQ0KDQoJLyoqDQoJICogRGVsZXRlcyB0aGUgYW5pbWFscyBvZiBhIGdpdmVuIHBsYXllcg0KCSAqICovDQoJZnVuY3Rpb24gY2xlYW5VcChhZGRyZXNzIHBsYXllckFkZHJlc3MpIGludGVybmFsIHJldHVybnModWludCBwbGF5ZXJCYWxhbmNlKXsNCgkJdWludDMyIGxhc3RJZDsNCgkJZm9yICh1aW50MTYgaSA9IDA7IGkgPCBudW1BbmltYWxzOyBpKyspIHsNCgkJCWlmIChhbmltYWxzW2lkc1tpXV0ub3duZXIgPT0gcGxheWVyQWRkcmVzcykgew0KCQkJCS8vZmlyc3QgZGVsZXRlIGFsbCBhbmltYWxzIGF0IHRoZSBlbmQgb2YgdGhlIGFycmF5DQoJCQkJd2hpbGUgKG51bUFuaW1hbHMgPiAwICYmIGFuaW1hbHNbaWRzW251bUFuaW1hbHMgLSAxXV0ub3duZXIgPT0gcGxheWVyQWRkcmVzcykgew0KCQkJCQludW1BbmltYWxzLS07DQoJCQkJCWxhc3RJZCA9IGlkc1tudW1BbmltYWxzXTsNCgkJCQkJbnVtQW5pbWFsc1hUeXBlW2FuaW1hbHNbbGFzdElkXS5hbmltYWxUeXBlXS0tOw0KCQkJCQlwbGF5ZXJCYWxhbmNlKz1hbmltYWxzW2xhc3RJZF0udmFsdWU7DQoJCQkJCWRlbGV0ZSBhbmltYWxzW2xhc3RJZF07DQoJCQkJfQ0KCQkJCS8vaWYgdGhlIGxhc3QgYW5pbWFsIGRvZXMgbm90IGJlbG9uZyB0byB0aGUgcGxheWVyLCByZXBsYWNlIHRoZSBwbGF5ZXJzIGFuaW1hbCBieSB0aGlzIGxhc3Qgb25lDQoJCQkJaWYgKG51bUFuaW1hbHMgPiBpICsgMSkgew0KCQkJCSAgICBwbGF5ZXJCYWxhbmNlKz1hbmltYWxzW2lkc1tpXV0udmFsdWU7DQoJCQkJCXJlcGxhY2VBbmltYWwoaSk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfQ0KDQoNCgkvKioNCgkgKiBSZXBsYWNlcyB0aGUgYW5pbWFsIHdpdGggdGhlIGdpdmVuIGlkIHdpdGggdGhlIGxhc3QgYW5pbWFsIGluIHRoZSBhcnJheQ0KCSAqICovDQoJZnVuY3Rpb24gcmVwbGFjZUFuaW1hbCh1aW50MTYgaW5kZXgpIGludGVybmFsIHsNCgkJbnVtQW5pbWFsc1hUeXBlW2FuaW1hbHNbaWRzW2luZGV4XV0uYW5pbWFsVHlwZV0tLTsNCgkJbnVtQW5pbWFscy0tOw0KCQl1aW50MzIgbGFzdElkID0gaWRzW251bUFuaW1hbHNdOw0KCQlhbmltYWxzW2lkc1tpbmRleF1dID0gYW5pbWFsc1tsYXN0SWRdOw0KCQlpZHNbaW5kZXhdID0gbGFzdElkOw0KCQlkZWxldGUgaWRzW251bUFuaW1hbHNdOw0KCX0NCg0KDQoJLyoqDQoJICogbWFudWFsbHkgdHJpZ2dlcnMgdGhlIGF0dGFjay4gY2Fubm90IGJlIGNhbGxlZCBhZnRlcndhcmRzLCBleGNlcHQNCgkgKiBieSB0aGUgb3duZXIgaWYgYW5kIG9ubHkgaWYgdGhlIGF0dGFjayB3YXNuJ3QgbGF1bmNoZWQgYXMgc3VwcG9zZWQsIHNpZ25pZnlpbmcNCgkgKiBhbiBlcnJvciBvY3VycmVkIGR1cmluZyB0aGUgbGFzdCBpbnZvY2F0aW9uIG9mIG9yYWNsaXplLCBvciB0aGVyZSB3YXNuJ3QgZW5vdWdoIGV0aGVyIHRvIHBheSB0aGUgZ2FzDQoJICogKi8NCglmdW5jdGlvbiB0cmlnZ2VyQXR0YWNrTWFudWFsbHkodWludDMyIGluc2Vjb25kcykgew0KCQlpZiAoIShtc2cuc2VuZGVyID09IG93bmVyICYmIG5leHRBdHRhY2tUaW1lc3RhbXAgPCBub3cgKyAzMDApKSB0aHJvdzsNCgkJdHJpZ2dlckF0dGFjayhpbnNlY29uZHMsIChvcmFjbGl6ZUdhcyArIDEwMDAwICogbnVtQW5pbWFscykpOw0KCX0NCg0KCS8qKg0KCSAqIHNlbmRzIGEgcXVlcnkgdG8gb3JhY2xpemUgaW4gb3JkZXIgdG8gZ2V0IHJhbmRvbSBudW1iZXJzIGluICdpbnNlY29uZHMnIHNlY29uZHMNCgkgKi8NCglmdW5jdGlvbiB0cmlnZ2VyQXR0YWNrKHVpbnQzMiBpbnNlY29uZHMsIHVpbnQxMjggZ2FzQW1vdW50KSBpbnRlcm5hbCB7DQoJCW5leHRBdHRhY2tUaW1lc3RhbXAgPSBub3cgKyBpbnNlY29uZHM7DQoJCW5leHRBdHRhY2tJZCA9IG9yYWNsaXplX3F1ZXJ5KG5leHRBdHRhY2tUaW1lc3RhbXAsIHF1ZXJ5VHlwZSwgcmFuZG9tUXVlcnksIGdhc0Ftb3VudCApOw0KCX0NCg0KCS8qKg0KCSAqIFRoZSBhY3R1YWwgcHJlZGF0b3IgYXR0YWNrLg0KCSAqIFRoZSBwcmVkYXRvciBraWxscyB1cCB0byAxMCBhbmltYWxzLCBidXQgaW4gY2FzZSB0aGVyZSBhcmUgbGVzcyB0aGFuIDEwMCBhbmltYWxzIGluIHRoZSBnYW1lIHVwIHRvIDEwJSBnZXQgZWF0ZW4uDQoJICogKi8NCglmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgew0KCQlpZiAobXNnLnNlbmRlciAhPSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSB8fCBteWlkICE9IG5leHRBdHRhY2tJZCkgdGhyb3c7IC8vIGp1c3QgdG8gYmUgc3VyZSB0aGUgY2FsbGluZyBhZGRyZXNzIGlzIHRoZSBPcmFjbGl6ZSBhdXRob3JpemVkIG9uZSBhbmQgdGhlIGNhbGxiYWNrIGlzIHRoZSBleHBlY3RlZCBvbmUgICANCgkJdWludDEyOCBwb3Q7DQoJCXVpbnQxNiByYW5kb207DQoJCXVpbnQxNiBob3dtYW55ID0gbnVtQW5pbWFscyA8IDEwMCA/IChudW1BbmltYWxzIDwgMTAgPyAxIDogbnVtQW5pbWFscyAvIDEwKSA6IDEwOyAvL2RvIG5vdCBraWxsIG1vcmUgdGhhbiAxMCUsIGJ1dCBhdCBsZWFzdCBvbmUNCgkJdWludDE2W10gbWVtb3J5IHJhbmRvbU51bWJlcnMgPSBnZXROdW1iZXJzRnJvbVN0cmluZyhyZXN1bHQsICIsIiwgaG93bWFueSk7DQoJCXVpbnQzMltdIG1lbW9yeSBraWxsZWRBbmltYWxzID0gbmV3IHVpbnQzMltdKGhvd21hbnkpOw0KCQlmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgaG93bWFueTsgaSsrKSB7DQoJCQlyYW5kb20gPSBtYXBUb05ld1JhbmdlKHJhbmRvbU51bWJlcnNbaV0sIG51bUFuaW1hbHMpOw0KCQkJa2lsbGVkQW5pbWFsc1tpXSA9IGlkc1tyYW5kb21dOw0KCQkJcG90ICs9IGtpbGxBbmltYWwocmFuZG9tKTsNCgkJfQ0KCQl1aW50MTI4IG5lZWRlZEdhcyA9IG9yYWNsaXplR2FzICsgMTAwMDAqbnVtQW5pbWFsczsNCgkJdWludDEyOCBnYXNDb3N0ID0gdWludDEyOChuZWVkZWRHYXMgKiB0eC5nYXNwcmljZSk7DQoJCWlmIChwb3QgPiBnYXNDb3N0KQ0KCQkJZGlzdHJpYnV0ZSh1aW50MTI4KHBvdCAtIGdhc0Nvc3QpKTsgLy9kaXN0cmlidXRlIHRoZSBwb3QgbWludXMgdGhlIG9yYWNsaXplIGdhcyBjb3N0cw0KCQl0cmlnZ2VyQXR0YWNrKHRpbWVUaWxsTmV4dEF0dGFjaygpLCBuZWVkZWRHYXMpOw0KCQluZXdBdHRhY2soa2lsbGVkQW5pbWFscyk7DQoJfQ0KDQoJLyoqDQoJICogdGhlIGZyZXF1ZW5jeSBvZiB0aGUgc2hhcmsgYXR0YWNrcyBkZXBlbmRzIG9uIHRoZSBudW1iZXIgb2YgYW5pbWFscyBpbiB0aGUgZ2FtZS4gDQoJICogbWFueSBhbmltYWxzIC0+IG1hbnkgc2hhcmsgYXR0YWNrcw0KCSAqIGF0IGxlYXN0IG9uZSBhdHRhY2sgaW4gMjQgaG91cnMNCgkgKiAqLw0KCWZ1bmN0aW9uIHRpbWVUaWxsTmV4dEF0dGFjaygpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludDMyKSB7DQoJCXJldHVybiAoODY0MDAgLyAoMSArIG51bUFuaW1hbHMgLyAxMDApKTsNCgl9DQoNCg0KCS8qKg0KCSAqIGtpbGxzIHRoZSBhbmltYWwgb2YgdGhlIGdpdmVuIHR5cGUgYXQgdGhlIGdpdmVuIGluZGV4LiANCgkgKiAqLw0KCWZ1bmN0aW9uIGtpbGxBbmltYWwodWludDE2IGluZGV4KSBpbnRlcm5hbCByZXR1cm5zKHVpbnQxMjggYW5pbWFsVmFsdWUpIHsNCgkJYW5pbWFsVmFsdWUgPSBhbmltYWxzW2lkc1tpbmRleF1dLnZhbHVlOw0KCQlyZXBsYWNlQW5pbWFsKGluZGV4KTsNCgkJaWYgKGlkc1tpbmRleF0gPT0gb2xkZXN0KQ0KCQkJb2xkZXN0ID0gMDsNCgl9DQoNCgkvKioNCgkgKiBmaW5kcyB0aGUgb2xkZXN0IGFuaW1hbA0KCSAqICovDQoJZnVuY3Rpb24gZmluZE9sZGVzdCgpIGludGVybmFsIHJldHVybnModWludDEyOCBhbmltYWxWYWx1ZSkgew0KCQlvbGRlc3QgPSBpZHNbMF07DQoJCWZvciAodWludDE2IGkgPSAxOyBpIDwgbnVtQW5pbWFsczsgaSsrKXsNCgkJCWlmKGlkc1tpXSA8IG9sZGVzdCkvL3RoZSBvbGRlc3QgYW5pbWFsIGhhcyB0aGUgbG93ZXN0IGlkDQoJCQkJb2xkZXN0ID0gaWRzW2ldOw0KCQl9DQoJfQ0KDQoNCgkvKiogZGlzdHJpYnV0ZXMgdGhlIGdpdmVuIGFtb3VudCBhbW9uZyB0aGUgc3Vydml2aW5nIGZpc2hlcyovDQoJZnVuY3Rpb24gZGlzdHJpYnV0ZSh1aW50MTI4IHRvdGFsQW1vdW50KSBpbnRlcm5hbCB7DQoJCS8vcGF5IDEwJSB0byB0aGUgb2xkZXN0IGZpc2gNCgkJaWYgKG9sZGVzdCA9PSAwKQ0KCQkJZmluZE9sZGVzdCgpOw0KCQlhbmltYWxzW29sZGVzdF0udmFsdWUgKz0gdG90YWxBbW91bnQgLyAxMDsNCgkJdWludDEyOCBhbW91bnQgPSB0b3RhbEFtb3VudCAvIDEwICogOTsNCgkJLy9kaXN0cmlidXRlIHRoZSByZXN0IGFjY29yZGluZyB0byB0aGVpciB0eXBlDQoJCXVpbnQxMjggdmFsdWVTdW07DQoJCXVpbnQxMjhbXSBtZW1vcnkgc2hhcmVzID0gbmV3IHVpbnQxMjhbXSh2YWx1ZXMubGVuZ3RoKTsNCgkJZm9yICh1aW50OCB2ID0gMDsgdiA8IHZhbHVlcy5sZW5ndGg7IHYrKykgew0KCQkJaWYgKG51bUFuaW1hbHNYVHlwZVt2XSA+IDApIHZhbHVlU3VtICs9IHZhbHVlc1t2XTsNCgkJfQ0KCQlmb3IgKHVpbnQ4IG0gPSAwOyBtIDwgdmFsdWVzLmxlbmd0aDsgbSsrKSB7DQoJCSAgICBpZihudW1BbmltYWxzWFR5cGVbbV0gPiAwKQ0KCQkJICAgIHNoYXJlc1ttXSA9ICBhbW91bnQgKiB2YWx1ZXNbbV0gLyB2YWx1ZVN1bSAvIG51bUFuaW1hbHNYVHlwZVttXTsNCgkJfQ0KCQlmb3IgKHVpbnQxNiBpID0gMDsgaSA8IG51bUFuaW1hbHM7IGkrKykgew0KCQkJYW5pbWFsc1tpZHNbaV1dLnZhbHVlICs9IHNoYXJlc1thbmltYWxzW2lkc1tpXV0uYW5pbWFsVHlwZV07DQoJCX0NCg0KCX0NCg0KCS8qKg0KCSAqIGFsbG93cyB0aGUgb3duZXIgdG8gY29sbGVjdCB0aGUgYWNjdW11bGF0ZWQgZmVlcw0KCSAqIHNlbmRzIHRoZSBnaXZlbiBhbW91bnQgdG8gdGhlIG93bmVyJ3MgYWRkcmVzcyBpZiB0aGUgYW1vdW50IGRvZXMgbm90IGV4Y2VlZCB0aGUNCgkgKiBmZWVzIChjYW5ub3QgdG91Y2ggdGhlIHBsYXllcnMnIGJhbGFuY2VzKSBtaW51cyAxMDAgZmlubmV5IChlbnN1cmUgdGhhdCBvcmFjbGl6ZSBmZWVzIGNhbiBiZSBwYWlkKQ0KCSAqICovDQoJZnVuY3Rpb24gY29sbGVjdEZlZXModWludDEyOCBhbW91bnQpIHsNCgkJaWYgKCEobXNnLnNlbmRlciA9PSBvd25lcikpIHRocm93Ow0KCQl1aW50IGNvbGxlY3RlZEZlZXMgPSBnZXRGZWVzKCk7DQoJCWlmIChhbW91bnQgKyAxMDAgZmlubmV5IDwgY29sbGVjdGVkRmVlcykgew0KCQkJaWYgKCFvd25lci5zZW5kKGFtb3VudCkpIHRocm93Ow0KCQl9DQoJfQ0KDQoJLyoqDQoJICogcGF5cyBvdXQgdGhlIHBsYXllcnMgYW5kIGtpbGxzIHRoZSBnYW1lLg0KCSAqICovDQoJZnVuY3Rpb24gc3RvcCgpIHsNCgkJaWYgKCEobXNnLnNlbmRlciA9PSBvd25lcikpIHRocm93Ow0KCQlmb3IgKHVpbnQxNiBpID0gMDsgaSA8IG51bUFuaW1hbHM7IGkrKykgew0KCQkJYW5pbWFsc1tpZHNbaV1dLm93bmVyLnNlbmQoYW5pbWFsc1tpZHNbaV1dLnZhbHVlKTsNCgkJfQ0KCQlraWxsKCk7DQoJfQ0KDQoJLyoqDQoJICogYWRkcyBhIG5ldyBhbmltYWwgdHlwZSB0byB0aGUgZ2FtZQ0KCSAqIG1heC4gbnVtYmVyIG9mIGFuaW1hbCB0eXBlczogMTAwDQoJICogdGhlIGNvc3QgbWF5IG5vdCBiZSBsb3dlciB0aGFuIGNvc3RzWzBdDQoJICogKi8NCglmdW5jdGlvbiBhZGRBbmltYWxUeXBlKHVpbnQxMjggY29zdCkgew0KCQlpZiAoIShtc2cuc2VuZGVyID09IG93bmVyKSkgdGhyb3c7DQoJCWNvc3RzLnB1c2goY29zdCk7DQoJCXZhbHVlcy5wdXNoKGNvc3QgLyAxMDAgKiBmZWUpOw0KCX0NCg0KCWZ1bmN0aW9uIHNlbGxBbmltYWwodWludDMyIGFuaW1hbElkKXsNCiAgICAgICAgaWYobXNnLnNlbmRlciE9YW5pbWFsc1thbmltYWxJZF0ub3duZXIpIHRocm93Ow0KICAgICAgICB1aW50MTI4IHZhbCA9IGFuaW1hbHNbYW5pbWFsSWRdLnZhbHVlOw0KICAgICAgICB1aW50MTYgYW5pbWFsSW5kZXg7DQogICAgICAgIGZvcih1aW50MTYgaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyBpKyspew0KICAgICAgICAgICAgaWYoaWRzW2ldPT1hbmltYWxJZCl7DQogICAgICAgICAgICAgICAgYW5pbWFsSW5kZXggPSBpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJlcGxhY2VBbmltYWwoYW5pbWFsSW5kZXgpOw0KICAgICAgICBpZighbXNnLnNlbmRlci5zZW5kKHZhbCkpIHRocm93Ow0KICAgIH0NCg0KCS8qKioqKioqKioqKioqKioqKiogR0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQoNCglmdW5jdGlvbiBnZXRQbGF5ZXJCYWxhbmNlKGFkZHJlc3MgcGxheWVyQWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyh1aW50MTI4IHBsYXllckJhbGFuY2UpIHsNCgkJZm9yICh1aW50MTYgaSA9IDA7IGkgPCBudW1BbmltYWxzOyBpKyspIHsNCgkJCWlmIChhbmltYWxzW2lkc1tpXV0ub3duZXIgPT0gcGxheWVyQWRkcmVzcykgcGxheWVyQmFsYW5jZSArPSBhbmltYWxzW2lkc1tpXV0udmFsdWU7DQoJCX0NCgl9DQoJDQoJZnVuY3Rpb24gZ2V0QW5pbWFsKHVpbnQzMiBhbmltYWxJZCkgY29uc3RhbnQgcmV0dXJucyh1aW50OCwgdWludDEyOCwgYWRkcmVzcyl7DQoJCXJldHVybiAoYW5pbWFsc1thbmltYWxJZF0uYW5pbWFsVHlwZSxhbmltYWxzW2FuaW1hbElkXS52YWx1ZSxhbmltYWxzW2FuaW1hbElkXS5vd25lcik7DQoJfQ0KCQ0KCWZ1bmN0aW9uIGdldDEwQW5pbWFscyh1aW50MTYgc3RhcnRJbmRleCkgY29uc3RhbnQgcmV0dXJucyh1aW50MzJbMTBdIGFuaW1hbElkcywgdWludDhbMTBdIHR5cGVzLCB1aW50MTI4WzEwXSB2YWx1ZXMsIGFkZHJlc3NbMTBdIG93bmVycykgew0KCQl1aW50MTYgZW5kSW5kZXg9IHN0YXJ0SW5kZXgrMTAgPiBudW1BbmltYWxzPyBudW1BbmltYWxzOiBzdGFydEluZGV4KzEwOw0KCQl1aW50OCBqID0gMDsNCgkJdWludDMyIGlkOw0KCQlmb3IgKHVpbnQxNiBpID0gc3RhcnRJbmRleDsgaSA8IGVuZEluZGV4OyBpKyspew0KCQkJaWQ9aWRzW2ldOw0KCQkJYW5pbWFsSWRzW2pdID0gaWQ7DQoJCQl0eXBlc1tqXSA9IGFuaW1hbHNbaWRdLmFuaW1hbFR5cGU7DQoJCQl2YWx1ZXNbal0gPSBhbmltYWxzW2lkXS52YWx1ZTsNCgkJCW93bmVyc1tqXSA9IGFuaW1hbHNbaWRdLm93bmVyOw0KCQkJaisrOw0KCQl9DQoJCQ0KCX0NCgkNCg0KCWZ1bmN0aW9uIGdldEZlZXMoKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsNCgkJdWludCByZXNlcnZlZCA9IDA7DQoJCWZvciAodWludDE2IGogPSAwOyBqIDwgbnVtQW5pbWFsczsgaisrKQ0KCQkJcmVzZXJ2ZWQgKz0gYW5pbWFsc1tpZHNbal1dLnZhbHVlOw0KCQlyZXR1cm4gYWRkcmVzcyh0aGlzKS5iYWxhbmNlIC0gcmVzZXJ2ZWQ7DQoJfQ0KDQoNCgkvKioqKioqKioqKioqKioqKioqIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KCWZ1bmN0aW9uIHNldE9yYWNsaXplR2FzKHVpbnQzMiBuZXdHYXMpIHsNCgkJaWYgKCEobXNnLnNlbmRlciA9PSBvd25lcikpIHRocm93Ow0KCQlvcmFjbGl6ZUdhcyA9IG5ld0dhczsNCgl9DQoNCglmdW5jdGlvbiBzZXRNYXhBbmltYWxzKHVpbnQxNiBudW1iZXIpIHsNCgkJaWYgKCEobXNnLnNlbmRlciA9PSBvd25lcikpIHRocm93Ow0KCQltYXhBbmltYWxzID0gbnVtYmVyOw0KCX0NCg0KDQoJLyoqKioqKioqKioqKiogSEVMUEVSUyAqKioqKioqKioqKioqKioqLw0KDQoJLyoqDQoJICogbWFwcyBhIGdpdmVuIG51bWJlciB0byB0aGUgbmV3IHJhbmdlIChvbGQgcmFuZ2UgMTAwMCkNCgkgKiAqLw0KCWZ1bmN0aW9uIG1hcFRvTmV3UmFuZ2UodWludCBudW1iZXIsIHVpbnQgcmFuZ2UpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludDE2IHJhbmRvbU51bWJlcikgew0KCQlyZXR1cm4gdWludDE2KG51bWJlciAqIHJhbmdlIC8gMTAwMCk7DQoJfQ0KDQoJLyoqDQoJICogY29udmVydHMgYSBzdHJpbmcgb2YgbnVtYmVycyBiZWluZyBzZXBhcmF0ZWQgYnkgYSBnaXZlbiBkZWxpbWl0ZXIgaW50byBhbiBhcnJheSBvZiBudW1iZXJzICgjaG93bWFueSkgDQoJICovDQoJZnVuY3Rpb24gZ2V0TnVtYmVyc0Zyb21TdHJpbmcoc3RyaW5nIHMsIHN0cmluZyBkZWxpbWl0ZXIsIHVpbnQxNiBob3dtYW55KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQxNltdIG51bWJlcnMpIHsNCgkJc3RyaW5ncy5zbGljZSBtZW1vcnkgbXlyZXN1bHQgPSBzLnRvU2xpY2UoKTsNCgkJc3RyaW5ncy5zbGljZSBtZW1vcnkgZGVsaW0gPSBkZWxpbWl0ZXIudG9TbGljZSgpOw0KCQludW1iZXJzID0gbmV3IHVpbnQxNltdKGhvd21hbnkpOw0KCQlmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgaG93bWFueTsgaSsrKSB7DQoJCQludW1iZXJzW2ldID0gdWludDE2KHBhcnNlSW50KG15cmVzdWx0LnNwbGl0KGRlbGltKS50b1N0cmluZygpKSk7DQoJCX0NCgkJcmV0dXJuIG51bWJlcnM7DQoJfQ0KDQp9'