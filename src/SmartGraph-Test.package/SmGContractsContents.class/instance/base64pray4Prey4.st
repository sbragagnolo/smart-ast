base 64 content
base64pray4Prey4
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQovLyA8T1JBQ0xJWkVfQVBJPg0KLyoNCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTA0KQ29weXJpZ2h0IChjKSAyMDE2IE9yYWNsaXplIExURA0KDQoNCg0KUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQ0Kb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwNCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMNCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwNCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcw0KZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoNCg0KDQoNClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCg0KDQoNClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQpPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQpUSEUgU09GVFdBUkUuDQoqLw0KDQpwcmFnbWEgc29saWRpdHkgXjAuNC4wOy8vcGxlYXNlIGltcG9ydCBvcmFjbGl6ZUFQSV9wcmUwLjQuc29sIHdoZW4gc29saWRpdHkgPCAwLjQuMA0KDQpjb250cmFjdCBPcmFjbGl6ZUkgew0KICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsNCiAgICBmdW5jdGlvbiBxdWVyeSh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCiAgICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcmV0dXJucyAodWludCBfZHNwcmljZSk7DQogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsNCiAgICBmdW5jdGlvbiB1c2VDb3Vwb24oc3RyaW5nIF9jb3Vwb24pOw0KICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpOw0KICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOw0KICAgIGZ1bmN0aW9uIHNldEN1c3RvbUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKTsNCn0NCmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7DQogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOw0KfQ0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7DQogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCo2MCoyNDsNCiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCo2MCoyNCo3Ow0KICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsNCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OT05FID0gMHgwMDsNCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZTdG9yYWdlX0lQRlMgPSAweDAxOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsNCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX3Rlc3RuZXQgPSAyOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7DQoNCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOw0KICAgIA0KICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsNCiAgICBtb2RpZmllciBvcmFjbGl6ZUFQSSB7DQogICAgICAgIGlmKGFkZHJlc3MoT0FSKT09MCkgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7DQogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOw0KICAgICAgICBfOw0KICAgIH0NCiAgICBtb2RpZmllciBjb3Vwb24oc3RyaW5nIGNvZGUpew0KICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsNCiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsodWludDggbmV0d29ya0lEKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpew0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNiMjYzOGE3Y2M5ZjJjYjNkMjk4YTNkYTdhOTBiNjdlNTUwNmVkKT4wKXsgLy9tYWlubmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNiMjYzOGE3Y2M5ZjJjYjNkMjk4YTNkYTdhOTBiNjdlNTUwNmVkKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM2EyNjE1ZDVlZmFmNWY0OWY2MGI3YmI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldA0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzYTI2MTVkNWVmYWY1ZjQ5ZjYwYjdiYjY1ODNlYWVjMjEyZmRmMSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgyMGUxMmExZjg1OWIzZmVhZTVmYjJhMGEzMmMxOGY1YTY1NTU1YmJmKT4wKXsgLy9ldGhlci5jYW1wIGlkZQ0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJhMWY4NTliM2ZlYWU1ZmIyYTBhMzJjMThmNWE2NTU1NWJiZik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg5M2JiYmU1Y2U3NzAzNGUzMDk1ZjA0Nzk5MTk5NjJhOTAzZjg5OGFkKT4wKXsgLy9ub3JzYm9yZyB0ZXN0bmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg5M2JiYmU1Y2U3NzAzNGUzMDk1ZjA0Nzk5MTk5NjJhOTAzZjg5OGFkKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhZjRjOGIzYzlhZmJkNWFiOWY0YmJjODI3ODRhYjZlZjhmYWEpPjApeyAvL2Jyb3dzZXItc29saWRpdHkNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhZjRjOGIzYzlhZmJkNWFiOWY0YmJjODI3ODRhYjZlZjhmYWEpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgew0KICAgICAgICBfX2NhbGxiYWNrKG15aWQsIHJlc3VsdCwgbmV3IGJ5dGVzKDApKTsNCiAgICB9DQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5jYkFkZHJlc3MoKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldFByb29mVHlwZShwcm9vZlApOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7DQogICAgfSAgICANCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDb25maWcoYnl0ZXMzMiBjb25maWcpIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldENvbmZpZyhjb25maWcpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgew0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikNCiAgICAgICAgfQ0KICAgIH0NCg0KDQogICAgZnVuY3Rpb24gcGFyc2VBZGRyKHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7DQogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7DQogICAgICAgIHVpbnQxNjAgaWFkZHIgPSAwOw0KICAgICAgICB1aW50MTYwIGIxOw0KICAgICAgICB1aW50MTYwIGIyOw0KICAgICAgICBmb3IgKHVpbnQgaT0yOyBpPDIrMioyMDsgaSs9Mil7DQogICAgICAgICAgICBpYWRkciAqPSAyNTY7DQogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsNCiAgICAgICAgICAgIGIyID0gdWludDE2MCh0bXBbaSsxXSk7DQogICAgICAgICAgICBpZiAoKGIxID49IDk3KSYmKGIxIDw9IDEwMikpIGIxIC09IDg3Ow0KICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDQ4KSYmKGIxIDw9IDU3KSkgYjEgLT0gNDg7DQogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3Ow0KICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7DQogICAgICAgICAgICBpYWRkciArPSAoYjEqMTYrYjIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsNCiAgICB9DQoNCg0KICAgIGZ1bmN0aW9uIHN0ckNvbXBhcmUoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7DQogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gYS5sZW5ndGg7DQogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykNCiAgICAgICAgICAgIGlmIChhW2ldIDwgYltpXSkNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkNCiAgICAgICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpDQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpDQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICB9IA0KDQogICAgZnVuY3Rpb24gaW5kZXhPZihzdHJpbmcgX2hheXN0YWNrLCBzdHJpbmcgX25lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoaW50KQ0KICAgIHsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGggPSBieXRlcyhfaGF5c3RhY2spOw0KICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOw0KICAgICAgICBpZihoLmxlbmd0aCA8IDEgfHwgbi5sZW5ndGggPCAxIHx8IChuLmxlbmd0aCA+IGgubGVuZ3RoKSkgDQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkNCiAgICAgICAgICAgIHJldHVybiAtMTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIGVsc2UNCiAgICAgICAgew0KICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7DQogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoLmxlbmd0aDsgaSArKykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXggPSAxOw0KICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCsrOw0KICAgICAgICAgICAgICAgICAgICB9ICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHN1YmluZGV4ID09IG4ubGVuZ3RoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIH0gICANCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmMgPSBieXRlcyhfYyk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7DQogICAgICAgIHN0cmluZyBtZW1vcnkgYWJjZGUgPSBuZXcgc3RyaW5nKF9iYS5sZW5ndGggKyBfYmIubGVuZ3RoICsgX2JjLmxlbmd0aCArIF9iZC5sZW5ndGggKyBfYmUubGVuZ3RoKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsNCiAgICAgICAgdWludCBrID0gMDsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2JhLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYVtpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JkLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZFtpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07DQogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgIiIsICIiLCAiIik7DQogICAgfQ0KDQogICAgLy8gcGFyc2VJbnQNCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsNCiAgICB9DQoNCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQ0KICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsNCiAgICAgICAgdWludCBtaW50ID0gMDsNCiAgICAgICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOw0KICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspew0KICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsNCiAgICAgICAgICAgICAgICBpZiAoZGVjaW1hbHMpew0KICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSBfYi0tOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOw0KICAgICAgICAgICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4Ow0KICAgICAgICAgICAgfSBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCoqX2I7DQogICAgICAgIHJldHVybiBtaW50Ow0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7DQogICAgICAgIGlmIChpID09IDApIHJldHVybiAiMCI7DQogICAgICAgIHVpbnQgaiA9IGk7DQogICAgICAgIHVpbnQgbGVuOw0KICAgICAgICB3aGlsZSAoaiAhPSAwKXsNCiAgICAgICAgICAgIGxlbisrOw0KICAgICAgICAgICAgaiAvPSAxMDsNCiAgICAgICAgfQ0KICAgICAgICBieXRlcyBtZW1vcnkgYnN0ciA9IG5ldyBieXRlcyhsZW4pOw0KICAgICAgICB1aW50IGsgPSBsZW4gLSAxOw0KICAgICAgICB3aGlsZSAoaSAhPSAwKXsNCiAgICAgICAgICAgIGJzdHJbay0tXSA9IGJ5dGUoNDggKyBpICUgMTApOw0KICAgICAgICAgICAgaSAvPSAxMDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc3RyaW5nKGJzdHIpOw0KICAgIH0NCiAgICANCiAgICANCg0KfQ0KLy8gPC9PUkFDTElaRV9BUEk+DQoNCmxpYnJhcnkgc3RyaW5ncyB7DQogICAgc3RydWN0IHNsaWNlIHsNCiAgICAgICAgdWludCBfbGVuOw0KICAgICAgICB1aW50IF9wdHI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbWVtY3B5KHVpbnQgZGVzdCwgdWludCBzcmMsIHVpbnQgbGVuKSBwcml2YXRlIHsNCiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUNCiAgICAgICAgZm9yKDsgbGVuID49IDMyOyBsZW4gLT0gMzIpIHsNCiAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICBtc3RvcmUoZGVzdCwgbWxvYWQoc3JjKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRlc3QgKz0gMzI7DQogICAgICAgICAgICBzcmMgKz0gMzI7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcw0KICAgICAgICB1aW50IG1hc2sgPSAyNTYgKiogKDMyIC0gbGVuKSAtIDE7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIGxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChzcmMpLCBub3QobWFzaykpDQogICAgICAgICAgICBsZXQgZGVzdHBhcnQgOj0gYW5kKG1sb2FkKGRlc3QpLCBtYXNrKQ0KICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG9yKGRlc3RwYXJ0LCBzcmNwYXJ0KSkNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHN0cmluZyB0byBtYWtlIGEgc2xpY2UgZnJvbS4NCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuDQogICAgICovDQogICAgZnVuY3Rpb24gdG9TbGljZShzdHJpbmcgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgdWludCBwdHI7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZiwgMHgyMCkNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2xpY2UoYnl0ZXMoc2VsZikubGVuZ3RoLCBwdHIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIG9mIGEgbnVsbC10ZXJtaW5hdGVkIGJ5dGVzMzIgc3RyaW5nLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSB2YWx1ZSB0byBmaW5kIHRoZSBsZW5ndGggb2YuDQogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcsIGZyb20gMCB0byAzMi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBsZW4oYnl0ZXMzMiBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHVpbnQgcmV0Ow0KICAgICAgICBpZiAoc2VsZiA9PSAwKQ0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7DQogICAgICAgICAgICByZXQgKz0gMTY7DQogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApOw0KICAgICAgICB9DQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZmZmZmZmZmZmID09IDApIHsNCiAgICAgICAgICAgIHJldCArPSA4Ow0KICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDApOw0KICAgICAgICB9DQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZiA9PSAwKSB7DQogICAgICAgICAgICByZXQgKz0gNDsNCiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDI7DQogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHNlbGYgJiAweGZmID09IDApIHsNCiAgICAgICAgICAgIHJldCArPSAxOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAzMiAtIHJldDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgYnl0ZXMzMiwgaW50ZXJwcmV0ZWQgYXMgYQ0KICAgICAqICAgICAgbnVsbC10ZXJtaW50YWVkIHV0Zi04IHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgYnl0ZXMzMiB2YWx1ZSB0byBjb252ZXJ0IHRvIGEgc2xpY2UuDQogICAgICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgYXJndW1lbnQgdXAgdG8gdGhlDQogICAgICogICAgICAgICBmaXJzdCBudWxsLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRvU2xpY2VCMzIoYnl0ZXMzMiBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsNCiAgICAgICAgLy8gQWxsb2NhdGUgc3BhY2UgZm9yIGBzZWxmYCBpbiBtZW1vcnksIGNvcHkgaXQgdGhlcmUsIGFuZCBwb2ludCByZXQgYXQgaXQNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgbGV0IHB0ciA6PSBtbG9hZCgweDQwKQ0KICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFkZChwdHIsIDB4MjApKQ0KICAgICAgICAgICAgbXN0b3JlKHB0ciwgc2VsZikNCiAgICAgICAgICAgIG1zdG9yZShhZGQocmV0LCAweDIwKSwgcHRyKQ0KICAgICAgICB9DQogICAgICAgIHJldC5fbGVuID0gbGVuKHNlbGYpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyBhIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgdGhlIGN1cnJlbnQgc2xpY2UuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuDQogICAgICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNvcHkoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgcmV0dXJuIHNsaWNlKHNlbGYuX2xlbiwgc2VsZi5fcHRyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IENvcGllcyBhIHNsaWNlIHRvIGEgbmV3IHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4NCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIHRoZSBzbGljZSdzIHRleHQuDQogICAgICovDQogICAgZnVuY3Rpb24gdG9TdHJpbmcoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHZhciByZXQgPSBuZXcgc3RyaW5nKHNlbGYuX2xlbik7DQogICAgICAgIHVpbnQgcmV0cHRyOw0KICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQ0KDQogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBpbiBydW5lcyBvZiB0aGUgc2xpY2UuIE5vdGUgdGhhdCB0aGlzIG9wZXJhdGlvbg0KICAgICAqICAgICAgdGFrZXMgdGltZSBwcm9wb3J0aW9uYWwgdG8gdGhlIGxlbmd0aCBvZiB0aGUgc2xpY2U7IGF2b2lkIHVzaW5nIGl0DQogICAgICogICAgICBpbiBsb29wcywgYW5kIGNhbGwgYHNsaWNlLmVtcHR5KClgIGlmIHlvdSBvbmx5IG5lZWQgdG8ga25vdyB3aGV0aGVyDQogICAgICogICAgICB0aGUgc2xpY2UgaXMgZW1wdHkgb3Igbm90Lg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc2xpY2UgaW4gcnVuZXMuDQogICAgICovDQogICAgZnVuY3Rpb24gbGVuKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgLy8gU3RhcnRpbmcgYXQgcHRyLTMxIG1lYW5zIHRoZSBMU0Igd2lsbCBiZSB0aGUgYnl0ZSB3ZSBjYXJlIGFib3V0DQogICAgICAgIHZhciBwdHIgPSBzZWxmLl9wdHIgLSAzMTsNCiAgICAgICAgdmFyIGVuZCA9IHB0ciArIHNlbGYuX2xlbjsNCiAgICAgICAgZm9yICh1aW50IGxlbiA9IDA7IHB0ciA8IGVuZDsgbGVuKyspIHsNCiAgICAgICAgICAgIHVpbnQ4IGI7DQogICAgICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHB0ciksIDB4RkYpIH0NCiAgICAgICAgICAgIGlmIChiIDwgMHg4MCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSAxOw0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDI7DQogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gMzsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGOCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSA0Ow0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEZDKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHB0ciArPSA2Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBsZW47DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5IChoYXMgYSBsZW5ndGggb2YgMCkuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSwgRmFsc2Ugb3RoZXJ3aXNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVtcHR5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIHNlbGYuX2xlbiA9PSAwOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyBhIHBvc2l0aXZlIG51bWJlciBpZiBgb3RoZXJgIGNvbWVzIGxleGljb2dyYXBoaWNhbGx5IGFmdGVyDQogICAgICogICAgICBgc2VsZmAsIGEgbmVnYXRpdmUgbnVtYmVyIGlmIGl0IGNvbWVzIGJlZm9yZSwgb3IgemVybyBpZiB0aGUNCiAgICAgKiAgICAgIGNvbnRlbnRzIG9mIHRoZSB0d28gc2xpY2VzIGFyZSBlcXVhbC4gQ29tcGFyaXNvbiBpcyBkb25lIHBlci1ydW5lLA0KICAgICAqICAgICAgb24gdW5pY29kZSBjb2RlcG9pbnRzLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLg0KICAgICAqIEBwYXJhbSBvdGhlciBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbXBhcmUuDQogICAgICogQHJldHVybiBUaGUgcmVzdWx0IG9mIHRoZSBjb21wYXJpc29uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNvbXBhcmUoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICB1aW50IHNob3J0ZXN0ID0gc2VsZi5fbGVuOw0KICAgICAgICBpZiAob3RoZXIuX2xlbiA8IHNlbGYuX2xlbikNCiAgICAgICAgICAgIHNob3J0ZXN0ID0gb3RoZXIuX2xlbjsNCg0KICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0cjsNCiAgICAgICAgdmFyIG90aGVycHRyID0gb3RoZXIuX3B0cjsNCiAgICAgICAgZm9yICh1aW50IGlkeCA9IDA7IGlkeCA8IHNob3J0ZXN0OyBpZHggKz0gMzIpIHsNCiAgICAgICAgICAgIHVpbnQgYTsNCiAgICAgICAgICAgIHVpbnQgYjsNCiAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICBhIDo9IG1sb2FkKHNlbGZwdHIpDQogICAgICAgICAgICAgICAgYiA6PSBtbG9hZChvdGhlcnB0cikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhICE9IGIpIHsNCiAgICAgICAgICAgICAgICAvLyBNYXNrIG91dCBpcnJlbGV2YW50IGJ5dGVzIGFuZCBjaGVjayBhZ2Fpbg0KICAgICAgICAgICAgICAgIHVpbnQgbWFzayA9IH4oMiAqKiAoOCAqICgzMiAtIHNob3J0ZXN0ICsgaWR4KSkgLSAxKTsNCiAgICAgICAgICAgICAgICB2YXIgZGlmZiA9IChhICYgbWFzaykgLSAoYiAmIG1hc2spOw0KICAgICAgICAgICAgICAgIGlmIChkaWZmICE9IDApDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoZGlmZik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZWxmcHRyICs9IDMyOw0KICAgICAgICAgICAgb3RoZXJwdHIgKz0gMzI7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGludChzZWxmLl9sZW4pIC0gaW50KG90aGVyLl9sZW4pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSB0d28gc2xpY2VzIGNvbnRhaW4gdGhlIHNhbWUgdGV4dC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29tcGFyZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbXBhcmUuDQogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuDQogICAgICovDQogICAgZnVuY3Rpb24gZXF1YWxzKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiBjb21wYXJlKHNlbGYsIG90aGVyKSA9PSAwOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgRXh0cmFjdHMgdGhlIGZpcnN0IHJ1bmUgaW4gdGhlIHNsaWNlIGludG8gYHJ1bmVgLCBhZHZhbmNpbmcgdGhlDQogICAgICogICAgICBzbGljZSB0byBwb2ludCB0byB0aGUgbmV4dCBydW5lIGFuZCByZXR1cm5pbmcgYHNlbGZgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEBwYXJhbSBydW5lIFRoZSBzbGljZSB0aGF0IHdpbGwgY29udGFpbiB0aGUgZmlyc3QgcnVuZS4NCiAgICAgKiBAcmV0dXJuIGBydW5lYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmLCBzbGljZSBydW5lKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICBydW5lLl9wdHIgPSBzZWxmLl9wdHI7DQoNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7DQogICAgICAgICAgICBydW5lLl9sZW4gPSAwOw0KICAgICAgICAgICAgcmV0dXJuIHJ1bmU7DQogICAgICAgIH0NCg0KICAgICAgICB1aW50IGxlbjsNCiAgICAgICAgdWludCBiOw0KICAgICAgICAvLyBMb2FkIHRoZSBmaXJzdCBieXRlIG9mIHRoZSBydW5lIGludG8gdGhlIExTQnMgb2YgYg0KICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHN1YihtbG9hZChhZGQoc2VsZiwgMzIpKSwgMzEpKSwgMHhGRikgfQ0KICAgICAgICBpZiAoYiA8IDB4ODApIHsNCiAgICAgICAgICAgIGxlbiA9IDE7DQogICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgew0KICAgICAgICAgICAgbGVuID0gMjsNCiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7DQogICAgICAgICAgICBsZW4gPSAzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbGVuID0gNDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cw0KICAgICAgICBpZiAobGVuID4gc2VsZi5fbGVuKSB7DQogICAgICAgICAgICBydW5lLl9sZW4gPSBzZWxmLl9sZW47DQogICAgICAgICAgICBzZWxmLl9wdHIgKz0gc2VsZi5fbGVuOw0KICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsNCiAgICAgICAgICAgIHJldHVybiBydW5lOw0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5fcHRyICs9IGxlbjsNCiAgICAgICAgc2VsZi5fbGVuIC09IGxlbjsNCiAgICAgICAgcnVuZS5fbGVuID0gbGVuOw0KICAgICAgICByZXR1cm4gcnVuZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGZpcnN0IHJ1bmUgaW4gdGhlIHNsaWNlLCBhZHZhbmNpbmcgdGhlIHNsaWNlIHRvIHBvaW50DQogICAgICogICAgICB0byB0aGUgbmV4dCBydW5lLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEByZXR1cm4gQSBzbGljZSBjb250YWluaW5nIG9ubHkgdGhlIGZpcnN0IHJ1bmUgZnJvbSBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7DQogICAgICAgIG5leHRSdW5lKHNlbGYsIHJldCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdGhlIGZpcnN0IGNvZGVwb2ludCBpbiB0aGUgc2xpY2UuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG9yZChzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IHJldCkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuID09IDApIHsNCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICB9DQoNCiAgICAgICAgdWludCB3b3JkOw0KICAgICAgICB1aW50IGxlbjsNCiAgICAgICAgdWludCBkaXYgPSAyICoqIDI0ODsNCg0KICAgICAgICAvLyBMb2FkIHRoZSBydW5lIGludG8gdGhlIE1TQnMgb2YgYg0KICAgICAgICBhc3NlbWJseSB7IHdvcmQ6PSBtbG9hZChtbG9hZChhZGQoc2VsZiwgMzIpKSkgfQ0KICAgICAgICB2YXIgYiA9IHdvcmQgLyBkaXY7DQogICAgICAgIGlmIChiIDwgMHg4MCkgew0KICAgICAgICAgICAgcmV0ID0gYjsNCiAgICAgICAgICAgIGxlbiA9IDE7DQogICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgew0KICAgICAgICAgICAgcmV0ID0gYiAmIDB4MUY7DQogICAgICAgICAgICBsZW4gPSAyOw0KICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsNCiAgICAgICAgICAgIHJldCA9IGIgJiAweDBGOw0KICAgICAgICAgICAgbGVuID0gMzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldCA9IGIgJiAweDA3Ow0KICAgICAgICAgICAgbGVuID0gNDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cw0KICAgICAgICBpZiAobGVuID4gc2VsZi5fbGVuKSB7DQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7DQogICAgICAgICAgICBkaXYgPSBkaXYgLyAyNTY7DQogICAgICAgICAgICBiID0gKHdvcmQgLyBkaXYpICYgMHhGRjsNCiAgICAgICAgICAgIGlmIChiICYgMHhDMCAhPSAweDgwKSB7DQogICAgICAgICAgICAgICAgLy8gSW52YWxpZCBVVEYtOCBzZXF1ZW5jZQ0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0ID0gKHJldCAqIDY0KSB8IChiICYgMHgzRik7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUga2VjY2FrLTI1NiBoYXNoIG9mIHRoZSBzbGljZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gaGFzaC4NCiAgICAgKiBAcmV0dXJuIFRoZSBoYXNoIG9mIHRoZSBzbGljZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBrZWNjYWsoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiByZXQpIHsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgcmV0IDo9IHNoYTMobWxvYWQoYWRkKHNlbGYsIDMyKSksIG1sb2FkKHNlbGYpKQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgYHNlbGZgIHN0YXJ0cyB3aXRoIGBuZWVkbGVgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuDQogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuX3B0ciA9PSBuZWVkbGUuX3B0cikgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICBib29sIGVxdWFsOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkNCiAgICAgICAgICAgIGxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkNCiAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpDQogICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBlcXVhbDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IElmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQ0KICAgICAqICAgICAgYmVnaW5uaW5nIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gYHNlbGZgDQogICAgICovDQogICAgZnVuY3Rpb24gYmV5b25kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgfQ0KDQogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOw0KICAgICAgICBpZiAoc2VsZi5fcHRyICE9IG5lZWRsZS5fcHRyKSB7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpDQogICAgICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQ0KICAgICAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpDQogICAgICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChlcXVhbCkgew0KICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOw0KICAgICAgICAgICAgc2VsZi5fcHRyICs9IG5lZWRsZS5fbGVuOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHNsaWNlIGVuZHMgd2l0aCBgbmVlZGxlYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBlbmRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOw0KDQogICAgICAgIGlmIChzZWxmcHRyID09IG5lZWRsZS5fcHRyKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGJvb2wgZXF1YWw7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCiAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gZXF1YWw7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBJZiBgc2VsZmAgZW5kcyB3aXRoIGBuZWVkbGVgLCBgbmVlZGxlYCBpcyByZW1vdmVkIGZyb20gdGhlDQogICAgICogICAgICBlbmQgb2YgYHNlbGZgLiBPdGhlcndpc2UsIGBzZWxmYCBpcyB1bm1vZGlmaWVkLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuDQogICAgICogQHJldHVybiBgc2VsZmANCiAgICAgKi8NCiAgICBmdW5jdGlvbiB1bnRpbChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOw0KICAgICAgICBib29sIGVxdWFsID0gdHJ1ZTsNCiAgICAgICAgaWYgKHNlbGZwdHIgIT0gbmVlZGxlLl9wdHIpIHsNCiAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkNCiAgICAgICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQ0KICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZXF1YWwpIHsNCiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIH0NCg0KICAgIC8vIFJldHVybnMgdGhlIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBmaXJzdCBieXRlIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mDQogICAgLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgZmlyc3QgYnl0ZSBhZnRlciBgc2VsZmAgaWYgbm90IGZvdW5kLg0KICAgIGZ1bmN0aW9uIGZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHVpbnQgcHRyOw0KICAgICAgICB1aW50IGlkeDsNCg0KICAgICAgICBpZiAobmVlZGxlbGVuIDw9IHNlbGZsZW4pIHsNCiAgICAgICAgICAgIGlmIChuZWVkbGVsZW4gPD0gMzIpIHsNCiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY4IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzDQogICAgICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgICAgICBsZXQgbWFzayA6PSBub3Qoc3ViKGV4cCgyLCBtdWwoOCwgc3ViKDMyLCBuZWVkbGVsZW4pKSksIDEpKQ0KICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykNCiAgICAgICAgICAgICAgICAgICAgbGV0IGVuZCA6PSBhZGQoc2VsZnB0ciwgc3ViKHNlbGZsZW4sIG5lZWRsZWxlbikpDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzZWxmcHRyDQogICAgICAgICAgICAgICAgICAgIGxvb3A6DQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGV4aXQsIGVxKGFuZChtbG9hZChwdHIpLCBtYXNrKSwgbmVlZGxlZGF0YSkpDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCAxKQ0KICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBsdChzdWIocHRyLCAxKSwgZW5kKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmcHRyLCBzZWxmbGVuKQ0KICAgICAgICAgICAgICAgICAgICBleGl0Og0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gcHRyOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZw0KICAgICAgICAgICAgICAgIGJ5dGVzMzIgaGFzaDsNCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQ0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHI7DQogICAgICAgICAgICAgICAgZm9yIChpZHggPSAwOyBpZHggPD0gc2VsZmxlbiAtIG5lZWRsZWxlbjsgaWR4KyspIHsNCiAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiB0ZXN0SGFzaDsNCiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9DQogICAgICAgICAgICAgICAgICAgIGlmIChoYXNoID09IHRlc3RIYXNoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsNCiAgICAgICAgICAgICAgICAgICAgcHRyICs9IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzZWxmcHRyICsgc2VsZmxlbjsNCiAgICB9DQoNCiAgICAvLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mDQogICAgLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgYWRkcmVzcyBvZiBgc2VsZmAgaWYgbm90IGZvdW5kLg0KICAgIGZ1bmN0aW9uIHJmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgew0KICAgICAgICB1aW50IHB0cjsNCg0KICAgICAgICBpZiAobmVlZGxlbGVuIDw9IHNlbGZsZW4pIHsNCiAgICAgICAgICAgIGlmIChuZWVkbGVsZW4gPD0gMzIpIHsNCiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY5IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzDQogICAgICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgICAgICBsZXQgbWFzayA6PSBub3Qoc3ViKGV4cCgyLCBtdWwoOCwgc3ViKDMyLCBuZWVkbGVsZW4pKSksIDEpKQ0KICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkNCiAgICAgICAgICAgICAgICAgICAgbG9vcDoNCiAgICAgICAgICAgICAgICAgICAganVtcGkocmV0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc3ViKHB0ciwgMSkNCiAgICAgICAgICAgICAgICAgICAganVtcGkobG9vcCwgZ3QoYWRkKHB0ciwgMSksIHNlbGZwdHIpKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cg0KICAgICAgICAgICAgICAgICAgICBqdW1wKGV4aXQpDQogICAgICAgICAgICAgICAgICAgIHJldDoNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChwdHIsIG5lZWRsZWxlbikNCiAgICAgICAgICAgICAgICAgICAgZXhpdDoNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gRm9yIGxvbmcgbmVlZGxlcywgdXNlIGhhc2hpbmcNCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7DQogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0NCiAgICAgICAgICAgICAgICBwdHIgPSBzZWxmcHRyICsgKHNlbGZsZW4gLSBuZWVkbGVsZW4pOw0KICAgICAgICAgICAgICAgIHdoaWxlIChwdHIgPj0gc2VsZnB0cikgew0KICAgICAgICAgICAgICAgICAgICBieXRlczMyIHRlc3RIYXNoOw0KICAgICAgICAgICAgICAgICAgICBhc3NlbWJseSB7IHRlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHRyICsgbmVlZGxlbGVuOw0KICAgICAgICAgICAgICAgICAgICBwdHIgLT0gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHNlbGZwdHI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBNb2RpZmllcyBgc2VsZmAgdG8gY29udGFpbiBldmVyeXRoaW5nIGZyb20gdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YNCiAgICAgKiAgICAgIGBuZWVkbGVgIHRvIHRoZSBlbmQgb2YgdGhlIHNsaWNlLiBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZQ0KICAgICAqICAgICAgaWYgYG5lZWRsZWAgaXMgbm90IGZvdW5kLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2ggYW5kIG1vZGlmeS4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuDQogICAgICogQHJldHVybiBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCiAgICAgICAgc2VsZi5fbGVuIC09IHB0ciAtIHNlbGYuX3B0cjsNCiAgICAgICAgc2VsZi5fcHRyID0gcHRyOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIHRoZSBwYXJ0IG9mIHRoZSBzdHJpbmcgZnJvbSB0aGUgc3RhcnQgb2YNCiAgICAgKiAgICAgIGBzZWxmYCB0byB0aGUgZW5kIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLiBJZiBgbmVlZGxlYA0KICAgICAqICAgICAgaXMgbm90IGZvdW5kLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJmaW5kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCiAgICAgICAgc2VsZi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0DQogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYNCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsDQogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4NCiAgICAgKiBAcmV0dXJuIGB0b2tlbmAuDQogICAgICovDQogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOw0KICAgICAgICB0b2tlbi5fcHRyID0gc2VsZi5fcHRyOw0KICAgICAgICB0b2tlbi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOw0KICAgICAgICBpZiAocHRyID09IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgew0KICAgICAgICAgICAgLy8gTm90IGZvdW5kDQogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgICAgIHNlbGYuX3B0ciA9IHB0ciArIG5lZWRsZS5fbGVuOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0b2tlbjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0DQogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZg0KICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwNCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIHVwIHRvIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuDQogICAgICovDQogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgew0KICAgICAgICBzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIHRoZSBsYXN0DQogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZg0KICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwNCiAgICAgKiAgICAgIGFuZCBgdG9rZW5gIGlzIHNldCB0byB0aGUgZW50aXJldHkgb2YgYHNlbGZgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEBwYXJhbSB0b2tlbiBBbiBvdXRwdXQgcGFyYW1ldGVyIHRvIHdoaWNoIHRoZSBmaXJzdCB0b2tlbiBpcyB3cml0dGVuLg0KICAgICAqIEByZXR1cm4gYHRva2VuYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiByc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCiAgICAgICAgdG9rZW4uX3B0ciA9IHB0cjsNCiAgICAgICAgdG9rZW4uX2xlbiA9IHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpOw0KICAgICAgICBpZiAocHRyID09IHNlbGYuX3B0cikgew0KICAgICAgICAgICAgLy8gTm90IGZvdW5kDQogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdG9rZW47DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGJlZm9yZSB0aGUgbGFzdA0KICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZg0KICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwNCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiByc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgew0KICAgICAgICByc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBDb3VudHMgdGhlIG51bWJlciBvZiBub25vdmVybGFwcGluZyBvY2N1cnJlbmNlcyBvZiBgbmVlZGxlYCBpbiBgc2VsZmAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICAgICAqIEByZXR1cm4gVGhlIG51bWJlciBvZiBvY2N1cnJlbmNlcyBvZiBgbmVlZGxlYCBmb3VuZCBpbiBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gY291bnQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGNvdW50KSB7DQogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOw0KICAgICAgICB3aGlsZSAocHRyIDw9IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgew0KICAgICAgICAgICAgY291bnQrKzsNCiAgICAgICAgICAgIHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0ciksIHB0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIFRydWUgaWYgYHNlbGZgIGNvbnRhaW5zIGBuZWVkbGVgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYG5lZWRsZWAgaXMgZm91bmQgaW4gYHNlbGZgLCBmYWxzZSBvdGhlcndpc2UuDQogICAgICovDQogICAgZnVuY3Rpb24gY29udGFpbnMoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSAhPSBzZWxmLl9wdHI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIGEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIHRoZSBjb25jYXRlbmF0aW9uIG9mDQogICAgICogICAgICBgc2VsZmAgYW5kIGBvdGhlcmAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbmNhdGVuYXRlLg0KICAgICAqIEBwYXJhbSBvdGhlciBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbmNhdGVuYXRlLg0KICAgICAqIEByZXR1cm4gVGhlIGNvbmNhdGVuYXRpb24gb2YgdGhlIHR3byBzdHJpbmdzLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNvbmNhdChzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHZhciByZXQgPSBuZXcgc3RyaW5nKHNlbGYuX2xlbiArIG90aGVyLl9sZW4pOw0KICAgICAgICB1aW50IHJldHB0cjsNCiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0NCiAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOw0KICAgICAgICBtZW1jcHkocmV0cHRyICsgc2VsZi5fbGVuLCBvdGhlci5fcHRyLCBvdGhlci5fbGVuKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IEpvaW5zIGFuIGFycmF5IG9mIHNsaWNlcywgdXNpbmcgYHNlbGZgIGFzIGEgZGVsaW1pdGVyLCByZXR1cm5pbmcgYQ0KICAgICAqICAgICAgbmV3bHkgYWxsb2NhdGVkIHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZGVsaW1pdGVyIHRvIHVzZS4NCiAgICAgKiBAcGFyYW0gcGFydHMgQSBsaXN0IG9mIHNsaWNlcyB0byBqb2luLg0KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgYWxsIHRoZSBzbGljZXMgaW4gYHBhcnRzYCwNCiAgICAgKiAgICAgICAgIGpvaW5lZCB3aXRoIGBzZWxmYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBqb2luKHNsaWNlIHNlbGYsIHNsaWNlW10gcGFydHMpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICBpZiAocGFydHMubGVuZ3RoID09IDApDQogICAgICAgICAgICByZXR1cm4gIiI7DQoNCiAgICAgICAgdWludCBsZW4gPSBzZWxmLl9sZW4gKiAocGFydHMubGVuZ3RoIC0gMSk7DQogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspDQogICAgICAgICAgICBsZW4gKz0gcGFydHNbaV0uX2xlbjsNCg0KICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhsZW4pOw0KICAgICAgICB1aW50IHJldHB0cjsNCiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0NCg0KICAgICAgICBmb3IoaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgbWVtY3B5KHJldHB0ciwgcGFydHNbaV0uX3B0ciwgcGFydHNbaV0uX2xlbik7DQogICAgICAgICAgICByZXRwdHIgKz0gcGFydHNbaV0uX2xlbjsNCiAgICAgICAgICAgIGlmIChpIDwgcGFydHMubGVuZ3RoIC0gMSkgew0KICAgICAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsNCiAgICAgICAgICAgICAgICByZXRwdHIgKz0gc2VsZi5fbGVuOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQp9DQoNCg0KY29udHJhY3QgbW9ydGFsIHsNCglhZGRyZXNzIG93bmVyOw0KDQoJZnVuY3Rpb24gbW9ydGFsKCkgew0KCQlvd25lciA9IG1zZy5zZW5kZXI7DQoJfQ0KDQoJZnVuY3Rpb24ga2lsbCgpIGludGVybmFsIHsNCgkJc3VpY2lkZShvd25lcik7DQoJfQ0KfQ0KDQpjb250cmFjdCBQcmF5NFByZXkgaXMgbW9ydGFsLCB1c2luZ09yYWNsaXplIHsNCgl1c2luZyBzdHJpbmdzDQoJZm9yICogOw0KDQoJc3RydWN0IEFuaW1hbCB7DQoJCXVpbnQ4IGFuaW1hbFR5cGU7DQoJCXVpbnQxMjggdmFsdWU7DQoJCWFkZHJlc3Mgb3duZXI7DQoJfQ0KDQoJLyoqIGFycmF5IGhvbGRpbmcgaWRzIG9mIHRoZSBjdXJyZXQgYW5pbWFscyovDQoJdWludDMyW10gcHVibGljIGlkczsNCgkvKiogdGhlIGlkIHRvIGJlIGdpdmVuIHRvIHRoZSBuZXQgYW5pbWFsICoqLw0KCXVpbnQzMiBwdWJsaWMgbmV4dElkOw0KCS8qKiB0aGUgaWQgb2YgdGhlIG9sZGVzdCBhbmltYWwgKi8NCgl1aW50MzIgcHVibGljIG9sZGVzdDsNCgkvKiogdGhlIGFuaW1hbCBiZWxvbmdpbmcgdG8gYSBnaXZlbiBpZCAqLw0KCW1hcHBpbmcodWludDMyID0+IEFuaW1hbCkgYW5pbWFsczsNCgkvKiogdGhlIGNvc3Qgb2YgZWFjaCBhbmltYWwgdHlwZSAqLw0KCXVpbnQxMjhbXSBwdWJsaWMgY29zdHM7DQoJLyoqIHRoZSB2YWx1ZSBvZiBlYWNoIGFuaW1hbCB0eXBlIChjb3N0IC0gZmVlKSwgc28gaXQncyBub3QgbmVjZXNzYXJ5IHRvIGNvbXB1dGUgaXQgZWFjaCB0aW1lKi8NCgl1aW50MTI4W10gcHVibGljIHZhbHVlczsNCgkvKiogdGhlIGZlZSB0byBiZSBwYWlkIGVhY2ggdGltZSBhbiBhbmltYWwgaXMgYm91Z2h0IGluIHBlcmNlbnQqLw0KCXVpbnQ4ICBmZWU7DQoNCgkvKiogdG90YWwgbnVtYmVyIG9mIGFuaW1hbHMgaW4gdGhlIGdhbWUgDQoJKCE9c3VtIG9mIHRoZSBsZW5ndGhzIG9mIHRoZSBwcmV5IGFuaW1hbHMgYXJyYXlzLCBzaW5jZSB0aG9zZSBhcnJheXMgY29udGFpbiBob2xlcykgKi8NCgl1aW50MTYgcHVibGljIG51bUFuaW1hbHM7DQoJLyoqIFRoZSBtYXhpbXVtIG9mIGFuaW1hbHMgYWxsb3dlZCBpbiB0aGUgZ2FtZSAqLw0KCXVpbnQxNiBwdWJsaWMgbWF4QW5pbWFsczsNCgkvKiogbnVtYmVyIG9mIGFuaW1hbHMgcGVyIHR5cGUgKi8NCgltYXBwaW5nKHVpbnQ4ID0+IHVpbnQxNikgcHVibGljIG51bUFuaW1hbHNYVHlwZTsNCg0KDQoJLyoqIHRoZSBxdWVyeSBzdHJpbmcgZ2V0dGluZyB0aGUgcmFuZG9tIG51bWJlcnMgZnJvbSBvcmFjbGl6ZSoqLw0KCXN0cmluZyAgcmFuZG9tUXVlcnk7DQoJLyoqIHRoZSB0eXBlIG9mIHRoZSBvcmFjbGl6ZSBxdWVyeSoqLw0KCXN0cmluZyAgcXVlcnlUeXBlOw0KCS8qKiB0aGUgdGltZXN0YW1wIG9mIHRoZSBuZXh0IGF0dGFjayAqKi8NCgl1aW50IHB1YmxpYyBuZXh0QXR0YWNrVGltZXN0YW1wOw0KCS8qKiBnYXMgcHJvdmlkZWQgZm9yIG9yYWNsaXplIGNhbGxiYWNrIChhdHRhY2spKiovDQoJdWludDMyIHB1YmxpYyBvcmFjbGl6ZUdhczsNCgkvKiogdGhlIGlkIG9mIHRoZSBuZXh0IG9yYWNsaXplIGNhbGxiYWNrKi8NCglieXRlczMyIG5leHRBdHRhY2tJZDsNCg0KDQoJLyoqIGlzIGZpcmVkIHdoZW4gbmV3IGFuaW1hbHMgYXJlIHB1cmNoYXNlZCAod2hvIGJvdWdodCBob3cgbWFueSBhbmltYWxzIG9mIHdoaWNoIHR5cGU/KSAqLw0KCWV2ZW50IG5ld1B1cmNoYXNlKGFkZHJlc3MgcGxheWVyLCB1aW50OCBhbmltYWxUeXBlLCB1aW50OCBhbW91bnQsIHVpbnQzMiBzdGFydElkKTsNCgkvKiogaXMgZmlyZWQgd2hlbiBhIHBsYXllciBsZWF2ZXMgdGhlIGdhbWUgKi8NCglldmVudCBuZXdFeGl0KGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IHRvdGFsQmFsYW5jZSk7DQoJLyoqIGlzIGZpcmVkIHdoZW4gYW4gYXR0YWNrIG9jY3VyZXMqLw0KCWV2ZW50IG5ld0F0dGFjayh1aW50MzJbXSBraWxsZWRBbmltYWxzKTsNCg0KDQoJLyoqIGV4cGVjdGVkIHBhcmFtZXRlcnM6IHRoZSBjb3N0cyBwZXIgYW5pbWFsIHR5cGUgYW5kIHRoZSBnYW1lIGZlZSBpbiBwZXJjZW50IA0KCSAqICAgYXNzdW1lcyB0aGF0IHRoZSBjaGVhcGVzdCBhbmltYWwgaXMgc3RvcmVkIGluIFswXQ0KCSAqLw0KCWZ1bmN0aW9uIFByYXk0UHJleSgpIHsNCgkJY29zdHMgPSBbMTAwMDAwMDAwMDAwMDAwMDAwLDIwMDAwMDAwMDAwMDAwMDAwMCw1MDAwMDAwMDAwMDAwMDAwMDAsMTAwMDAwMDAwMDAwMDAwMDAwMCw1MDAwMDAwMDAwMDAwMDAwMDAwXTsNCgkJZmVlID0gNTsNCgkJZm9yICh1aW50OCBpID0gMDsgaSA8IGNvc3RzLmxlbmd0aDsgaSsrKSB7DQoJCQl2YWx1ZXMucHVzaChjb3N0c1tpXSAtIGNvc3RzW2ldIC8gMTAwICogZmVlKTsNCgkJfQ0KCQltYXhBbmltYWxzID0gMzAwOw0KCQkvKnJhbmRvbVF1ZXJ5ID0gImh0dHBzOi8vd3d3LnJhbmRvbS5vcmcvaW50ZWdlcnMvP251bT0xMCZtaW49MCZtYXg9MTAwMDAmY29sPTEmYmFzZT0xMCZmb3JtYXQ9cGxhaW4mcm5kPW5ldyI7DQoJCXF1ZXJ5VHlwZSA9ICJVUkwiOyovDQoJCXJhbmRvbVF1ZXJ5ID0gIjEwIHJhbmRvbSBudW1iZXJzIGJldHdlZW4gMSBhbmQgMTAwMCI7DQoJCXF1ZXJ5VHlwZSA9ICJXb2xmcmFtQWxwaGEiOw0KCQlvcmFjbGl6ZUdhcyA9IDQwMDAwMDsNCgkJbmV4dElkID0gMTsNCgkJb2xkZXN0ID0gMTsNCgl9DQoNCgkvKiogVGhlIGZhbGxiYWNrIGZ1bmN0aW9uIHJ1bnMgd2hlbmV2ZXIgc29tZW9uZSBzZW5kcyBldGhlcg0KCSAgIERlcGVuZGluZyBvZiB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHRoZSBzZW5kZXIgaXMgZWl0aGVyIGdyYW50ZWQgYSBwcmV5IG9yIA0KCSAgIHRoZSB0cmFuc2FjdGlvbiBpcyBkaXNjYXJkZWQgYW5kIG5vIGV0aGVyIGFjY2VwdGVkDQoJICAgSW4gdGhlIGZpcnN0IGNhc2UgZmVlcyBoYXZlIHRvIGJlIHBhaWQqLw0KCWZ1bmN0aW9uKCkgcGF5YWJsZSB7DQoJCWZvciAodWludDggaSA9IDA7IGkgPCBjb3N0cy5sZW5ndGg7IGkrKykNCgkJCWlmIChtc2cudmFsdWUgPT0gY29zdHNbaV0pDQoJCQkJYWRkQW5pbWFscyhpKTsNCg0KCQlpZiAobXNnLnZhbHVlID09IDEwMDAwMDAwMDAwMDAwMDApDQoJCQlleGl0KCk7DQoJCWVsc2UNCgkJCXRocm93Ow0KDQoJfQ0KDQoJLyoqIGJ1eSBhbmltYWxzIG9mIGEgZ2l2ZW4gdHlwZSANCgkgKiAgYXMgbWFueSBhbmltYWxzIGFzIHBvc3NpYmxlIGFyZSBib3VnaHQgd2l0aCBtc2cudmFsdWUNCgkgKi8NCglmdW5jdGlvbiBhZGRBbmltYWxzKHVpbnQ4IGFuaW1hbFR5cGUpIHBheWFibGUgew0KCQl1aW50OCBhbW91bnQgPSB1aW50OChtc2cudmFsdWUgLyBjb3N0c1thbmltYWxUeXBlXSk7DQoJCWlmIChhbmltYWxUeXBlID49IGNvc3RzLmxlbmd0aCB8fCBtc2cudmFsdWUgPCBjb3N0c1thbmltYWxUeXBlXSB8fCAgbnVtQW5pbWFscyArIGFtb3VudCA+PSBtYXhBbmltYWxzKSB0aHJvdzsNCgkJLy9pZiB0eXBlIGV4aXN0cywgZW5vdWdoIGV0aGVyIHdhcyB0cmFuc2ZlcnJlZCBhbmQgdGhlcmUgYXJlIGxlc3MgdGhhbiBtYXhBbmltYWxzIGFuaW1hbHMgaW4gdGhlIGdhbWUNCgkJZm9yICh1aW50OCBqID0gMDsgaiA8IGFtb3VudDsgaisrKSB7DQoJCQlhZGRBbmltYWwoYW5pbWFsVHlwZSk7DQoJCX0NCgkJbnVtQW5pbWFsc1hUeXBlW2FuaW1hbFR5cGVdICs9IGFtb3VudDsNCgkJbmV3UHVyY2hhc2UobXNnLnNlbmRlciwgYW5pbWFsVHlwZSwgYW1vdW50LCBuZXh0SWQtYW1vdW50KTsNCgl9DQoNCgkvKioNCgkgKiAgYWRkcyBhIHNpbmdsZSBhbmltYWwgb2YgdGhlIGdpdmVuIHR5cGUNCgkgKi8NCglmdW5jdGlvbiBhZGRBbmltYWwodWludDggYW5pbWFsVHlwZSkgaW50ZXJuYWwgew0KCQlpZiAobnVtQW5pbWFscyA8IGlkcy5sZW5ndGgpDQoJCQlpZHNbbnVtQW5pbWFsc10gPSBuZXh0SWQ7DQoJCWVsc2UNCgkJCWlkcy5wdXNoKG5leHRJZCk7DQoJCWFuaW1hbHNbbmV4dElkXSA9IEFuaW1hbChhbmltYWxUeXBlLCB2YWx1ZXNbYW5pbWFsVHlwZV0sIG1zZy5zZW5kZXIpOw0KCQluZXh0SWQrKzsNCgkJbnVtQW5pbWFscysrOw0KCX0NCg0KDQoJLyoqIGxlYXZlIHRoZSBnYW1lDQoJICogcGF5cyBvdXQgdGhlIHNlbmRlcidzIHdpbkJhbGFuY2UgYW5kIHJlbW92ZXMgaGltIGFuZCBoaXMgYW5pbWFscyBmcm9tIHRoZSBnYW1lDQoJICogKi8NCglmdW5jdGlvbiBleGl0KCkgew0KCQl1aW50IGJhbGFuY2UgPSBjbGVhblVwKG1zZy5zZW5kZXIpOyAvL2RlbGV0ZSB0aGUgYW5pbWFscw0KCQluZXdFeGl0KG1zZy5zZW5kZXIsIGJhbGFuY2UpOyAvL2ZpcmUgdGhlIGV2ZW50IHRvIG5vdGlmeSB0aGUgY2xpZW50DQoJCWlmICghbXNnLnNlbmRlci5zZW5kKGJhbGFuY2UpKSB0aHJvdzsNCgl9DQoNCgkvKioNCgkgKiBEZWxldGVzIHRoZSBhbmltYWxzIG9mIGEgZ2l2ZW4gcGxheWVyDQoJICogKi8NCglmdW5jdGlvbiBjbGVhblVwKGFkZHJlc3MgcGxheWVyQWRkcmVzcykgaW50ZXJuYWwgcmV0dXJucyh1aW50IHBsYXllckJhbGFuY2Upew0KCQl1aW50MzIgbGFzdElkOw0KCQlmb3IgKHVpbnQxNiBpID0gMDsgaSA8IG51bUFuaW1hbHM7IGkrKykgew0KCQkJaWYgKGFuaW1hbHNbaWRzW2ldXS5vd25lciA9PSBwbGF5ZXJBZGRyZXNzKSB7DQoJCQkJLy9maXJzdCBkZWxldGUgYWxsIGFuaW1hbHMgYXQgdGhlIGVuZCBvZiB0aGUgYXJyYXkNCgkJCQl3aGlsZSAobnVtQW5pbWFscyA+IDAgJiYgYW5pbWFsc1tpZHNbbnVtQW5pbWFscyAtIDFdXS5vd25lciA9PSBwbGF5ZXJBZGRyZXNzKSB7DQoJCQkJCW51bUFuaW1hbHMtLTsNCgkJCQkJbGFzdElkID0gaWRzW251bUFuaW1hbHNdOw0KCQkJCQludW1BbmltYWxzWFR5cGVbYW5pbWFsc1tsYXN0SWRdLmFuaW1hbFR5cGVdLS07DQoJCQkJCXBsYXllckJhbGFuY2UrPWFuaW1hbHNbbGFzdElkXS52YWx1ZTsNCgkJCQkJZGVsZXRlIGFuaW1hbHNbbGFzdElkXTsNCgkJCQl9DQoJCQkJLy9pZiB0aGUgbGFzdCBhbmltYWwgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBwbGF5ZXIsIHJlcGxhY2UgdGhlIHBsYXllcnMgYW5pbWFsIGJ5IHRoaXMgbGFzdCBvbmUNCgkJCQlpZiAobnVtQW5pbWFscyA+IGkgKyAxKSB7DQoJCQkJICAgIHBsYXllckJhbGFuY2UrPWFuaW1hbHNbaWRzW2ldXS52YWx1ZTsNCgkJCQkJcmVwbGFjZUFuaW1hbChpKTsNCgkJCQl9DQoJCQl9DQoJCX0NCgl9DQoNCg0KCS8qKg0KCSAqIFJlcGxhY2VzIHRoZSBhbmltYWwgd2l0aCB0aGUgZ2l2ZW4gaWQgd2l0aCB0aGUgbGFzdCBhbmltYWwgaW4gdGhlIGFycmF5DQoJICogKi8NCglmdW5jdGlvbiByZXBsYWNlQW5pbWFsKHVpbnQxNiBpbmRleCkgaW50ZXJuYWwgew0KCQludW1BbmltYWxzWFR5cGVbYW5pbWFsc1tpZHNbaW5kZXhdXS5hbmltYWxUeXBlXS0tOw0KCQludW1BbmltYWxzLS07DQoJCXVpbnQzMiBsYXN0SWQgPSBpZHNbbnVtQW5pbWFsc107DQoJCWFuaW1hbHNbaWRzW2luZGV4XV0gPSBhbmltYWxzW2xhc3RJZF07DQoJCWlkc1tpbmRleF0gPSBsYXN0SWQ7DQoJCWRlbGV0ZSBpZHNbbnVtQW5pbWFsc107DQoJfQ0KDQoNCgkvKioNCgkgKiBtYW51YWxseSB0cmlnZ2VycyB0aGUgYXR0YWNrLiBjYW5ub3QgYmUgY2FsbGVkIGFmdGVyd2FyZHMsIGV4Y2VwdA0KCSAqIGJ5IHRoZSBvd25lciBpZiBhbmQgb25seSBpZiB0aGUgYXR0YWNrIHdhc24ndCBsYXVuY2hlZCBhcyBzdXBwb3NlZCwgc2lnbmlmeWluZw0KCSAqIGFuIGVycm9yIG9jdXJyZWQgZHVyaW5nIHRoZSBsYXN0IGludm9jYXRpb24gb2Ygb3JhY2xpemUsIG9yIHRoZXJlIHdhc24ndCBlbm91Z2ggZXRoZXIgdG8gcGF5IHRoZSBnYXMNCgkgKiAqLw0KCWZ1bmN0aW9uIHRyaWdnZXJBdHRhY2tNYW51YWxseSh1aW50MzIgaW5zZWNvbmRzKSB7DQoJCWlmICghKG1zZy5zZW5kZXIgPT0gb3duZXIgJiYgbmV4dEF0dGFja1RpbWVzdGFtcCA8IG5vdyArIDMwMCkpIHRocm93Ow0KCQl0cmlnZ2VyQXR0YWNrKGluc2Vjb25kcywgKG9yYWNsaXplR2FzICsgMTAwMDAgKiBudW1BbmltYWxzKSk7DQoJfQ0KDQoJLyoqDQoJICogc2VuZHMgYSBxdWVyeSB0byBvcmFjbGl6ZSBpbiBvcmRlciB0byBnZXQgcmFuZG9tIG51bWJlcnMgaW4gJ2luc2Vjb25kcycgc2Vjb25kcw0KCSAqLw0KCWZ1bmN0aW9uIHRyaWdnZXJBdHRhY2sodWludDMyIGluc2Vjb25kcywgdWludDEyOCBnYXNBbW91bnQpIGludGVybmFsIHsNCgkJbmV4dEF0dGFja1RpbWVzdGFtcCA9IG5vdyArIGluc2Vjb25kczsNCgkJbmV4dEF0dGFja0lkID0gb3JhY2xpemVfcXVlcnkobmV4dEF0dGFja1RpbWVzdGFtcCwgcXVlcnlUeXBlLCByYW5kb21RdWVyeSwgZ2FzQW1vdW50ICk7DQoJfQ0KDQoJLyoqDQoJICogVGhlIGFjdHVhbCBwcmVkYXRvciBhdHRhY2suDQoJICogVGhlIHByZWRhdG9yIGtpbGxzIHVwIHRvIDEwIGFuaW1hbHMsIGJ1dCBpbiBjYXNlIHRoZXJlIGFyZSBsZXNzIHRoYW4gMTAwIGFuaW1hbHMgaW4gdGhlIGdhbWUgdXAgdG8gMTAlIGdldCBlYXRlbi4NCgkgKiAqLw0KCWZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7DQoJCWlmIChtc2cuc2VuZGVyICE9IG9yYWNsaXplX2NiQWRkcmVzcygpIHx8IG15aWQgIT0gbmV4dEF0dGFja0lkKSB0aHJvdzsgLy8ganVzdCB0byBiZSBzdXJlIHRoZSBjYWxsaW5nIGFkZHJlc3MgaXMgdGhlIE9yYWNsaXplIGF1dGhvcml6ZWQgb25lIGFuZCB0aGUgY2FsbGJhY2sgaXMgdGhlIGV4cGVjdGVkIG9uZSAgIA0KCQl1aW50MTI4IHBvdDsNCgkJdWludDE2IHJhbmRvbTsNCgkJdWludDE2IGhvd21hbnkgPSBudW1BbmltYWxzIDwgMTAwID8gKG51bUFuaW1hbHMgPCAxMCA/IDEgOiBudW1BbmltYWxzIC8gMTApIDogMTA7IC8vZG8gbm90IGtpbGwgbW9yZSB0aGFuIDEwJSwgYnV0IGF0IGxlYXN0IG9uZQ0KCQl1aW50MTZbXSBtZW1vcnkgcmFuZG9tTnVtYmVycyA9IGdldE51bWJlcnNGcm9tU3RyaW5nKHJlc3VsdCwgIiwiLCBob3dtYW55KTsNCgkJdWludDMyW10gbWVtb3J5IGtpbGxlZEFuaW1hbHMgPSBuZXcgdWludDMyW10oaG93bWFueSk7DQoJCWZvciAodWludDggaSA9IDA7IGkgPCBob3dtYW55OyBpKyspIHsNCgkJCXJhbmRvbSA9IG1hcFRvTmV3UmFuZ2UocmFuZG9tTnVtYmVyc1tpXSwgbnVtQW5pbWFscyk7DQoJCQlraWxsZWRBbmltYWxzW2ldID0gaWRzW3JhbmRvbV07DQoJCQlwb3QgKz0ga2lsbEFuaW1hbChyYW5kb20pOw0KCQl9DQoJCXVpbnQxMjggbmVlZGVkR2FzID0gb3JhY2xpemVHYXMgKyAxMDAwMCpudW1BbmltYWxzOw0KCQl1aW50MTI4IGdhc0Nvc3QgPSB1aW50MTI4KG5lZWRlZEdhcyAqIHR4Lmdhc3ByaWNlKTsNCgkJaWYgKHBvdCA+IGdhc0Nvc3QpDQoJCQlkaXN0cmlidXRlKHVpbnQxMjgocG90IC0gZ2FzQ29zdCkpOyAvL2Rpc3RyaWJ1dGUgdGhlIHBvdCBtaW51cyB0aGUgb3JhY2xpemUgZ2FzIGNvc3RzDQoJCXRyaWdnZXJBdHRhY2sodGltZVRpbGxOZXh0QXR0YWNrKCksIG5lZWRlZEdhcyk7DQoJCW5ld0F0dGFjayhraWxsZWRBbmltYWxzKTsNCgl9DQoNCgkvKioNCgkgKiB0aGUgZnJlcXVlbmN5IG9mIHRoZSBzaGFyayBhdHRhY2tzIGRlcGVuZHMgb24gdGhlIG51bWJlciBvZiBhbmltYWxzIGluIHRoZSBnYW1lLiANCgkgKiBtYW55IGFuaW1hbHMgLT4gbWFueSBzaGFyayBhdHRhY2tzDQoJICogYXQgbGVhc3Qgb25lIGF0dGFjayBpbiAyNCBob3Vycw0KCSAqICovDQoJZnVuY3Rpb24gdGltZVRpbGxOZXh0QXR0YWNrKCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50MzIpIHsNCgkJcmV0dXJuICg4NjQwMCAvICgxICsgbnVtQW5pbWFscyAvIDEwMCkpOw0KCX0NCg0KDQoJLyoqDQoJICoga2lsbHMgdGhlIGFuaW1hbCBvZiB0aGUgZ2l2ZW4gdHlwZSBhdCB0aGUgZ2l2ZW4gaW5kZXguIA0KCSAqICovDQoJZnVuY3Rpb24ga2lsbEFuaW1hbCh1aW50MTYgaW5kZXgpIGludGVybmFsIHJldHVybnModWludDEyOCBhbmltYWxWYWx1ZSkgew0KCQlhbmltYWxWYWx1ZSA9IGFuaW1hbHNbaWRzW2luZGV4XV0udmFsdWU7DQoJCXJlcGxhY2VBbmltYWwoaW5kZXgpOw0KCQlpZiAoaWRzW2luZGV4XSA9PSBvbGRlc3QpDQoJCQlvbGRlc3QgPSAwOw0KCX0NCg0KCS8qKg0KCSAqIGZpbmRzIHRoZSBvbGRlc3QgYW5pbWFsDQoJICogKi8NCglmdW5jdGlvbiBmaW5kT2xkZXN0KCkgaW50ZXJuYWwgcmV0dXJucyh1aW50MTI4IGFuaW1hbFZhbHVlKSB7DQoJCW9sZGVzdCA9IGlkc1swXTsNCgkJZm9yICh1aW50MTYgaSA9IDE7IGkgPCBudW1BbmltYWxzOyBpKyspew0KCQkJaWYoaWRzW2ldIDwgb2xkZXN0KS8vdGhlIG9sZGVzdCBhbmltYWwgaGFzIHRoZSBsb3dlc3QgaWQNCgkJCQlvbGRlc3QgPSBpZHNbaV07DQoJCX0NCgl9DQoNCg0KCS8qKiBkaXN0cmlidXRlcyB0aGUgZ2l2ZW4gYW1vdW50IGFtb25nIHRoZSBzdXJ2aXZpbmcgZmlzaGVzKi8NCglmdW5jdGlvbiBkaXN0cmlidXRlKHVpbnQxMjggYW1vdW50KSBpbnRlcm5hbCB7DQoJCS8vcGF5IDEwJSB0byB0aGUgb2xkZXN0IGZpc2gNCgkJaWYgKG9sZGVzdCA9PSAwKQ0KCQkJZmluZE9sZGVzdCgpOw0KCQlhbmltYWxzW29sZGVzdF0udmFsdWUgKz0gYW1vdW50IC8gMTA7DQoJCWFtb3VudCA9IGFtb3VudCAvIDEwICogOTsNCgkJLy9kaXN0cmlidXRlIHRoZSByZXN0IGFjY29yZGluZyB0byB0aGVpciB0eXBlDQoJCXVpbnQxMjggdmFsdWVTdW07DQoJCXVpbnQxMjhbXSBtZW1vcnkgc2hhcmVzID0gbmV3IHVpbnQxMjhbXSh2YWx1ZXMubGVuZ3RoKTsNCgkJZm9yICh1aW50OCB2ID0gMDsgdiA8IHZhbHVlcy5sZW5ndGg7IHYrKykgew0KCQkJaWYgKG51bUFuaW1hbHNYVHlwZVt2XSA+IDApIHZhbHVlU3VtICs9IHZhbHVlc1t2XTsNCgkJfQ0KCQlmb3IgKHVpbnQ4IG0gPSAwOyBtIDwgdmFsdWVzLmxlbmd0aDsgbSsrKSB7DQoJCSAgICBpZihudW1BbmltYWxzWFR5cGVbbV0gPiAwKQ0KCQkJICAgIHNoYXJlc1ttXSA9IGFtb3VudCAvIHZhbHVlU3VtICogdmFsdWVzW21dIC8gbnVtQW5pbWFsc1hUeXBlW21dOw0KCQl9DQoJCQ0KDQoJCWZvciAodWludDE2IGkgPSAwOyBpIDwgbnVtQW5pbWFsczsgaSsrKSB7DQoJCQlhbmltYWxzW2lkc1tpXV0udmFsdWUgKz0gc2hhcmVzW2FuaW1hbHNbaWRzW2ldXS5hbmltYWxUeXBlXTsNCgkJfQ0KDQoJfQ0KDQoJLyoqDQoJICogYWxsb3dzIHRoZSBvd25lciB0byBjb2xsZWN0IHRoZSBhY2N1bXVsYXRlZCBmZWVzDQoJICogc2VuZHMgdGhlIGdpdmVuIGFtb3VudCB0byB0aGUgb3duZXIncyBhZGRyZXNzIGlmIHRoZSBhbW91bnQgZG9lcyBub3QgZXhjZWVkIHRoZQ0KCSAqIGZlZXMgKGNhbm5vdCB0b3VjaCB0aGUgcGxheWVycycgYmFsYW5jZXMpIG1pbnVzIDEwMCBmaW5uZXkgKGVuc3VyZSB0aGF0IG9yYWNsaXplIGZlZXMgY2FuIGJlIHBhaWQpDQoJICogKi8NCglmdW5jdGlvbiBjb2xsZWN0RmVlcyh1aW50MTI4IGFtb3VudCkgew0KCQlpZiAoIShtc2cuc2VuZGVyID09IG93bmVyKSkgdGhyb3c7DQoJCXVpbnQgY29sbGVjdGVkRmVlcyA9IGdldEZlZXMoKTsNCgkJaWYgKGFtb3VudCArIDEwMCBmaW5uZXkgPCBjb2xsZWN0ZWRGZWVzKSB7DQoJCQlpZiAoIW93bmVyLnNlbmQoYW1vdW50KSkgdGhyb3c7DQoJCX0NCgl9DQoNCgkvKioNCgkgKiBwYXlzIG91dCB0aGUgcGxheWVycyBhbmQga2lsbHMgdGhlIGdhbWUuDQoJICogKi8NCglmdW5jdGlvbiBzdG9wKCkgew0KCQlpZiAoIShtc2cuc2VuZGVyID09IG93bmVyKSkgdGhyb3c7DQoJCWZvciAodWludDE2IGkgPSAwOyBpIDwgbnVtQW5pbWFsczsgaSsrKSB7DQoJCQlhbmltYWxzW2lkc1tpXV0ub3duZXIuc2VuZChhbmltYWxzW2lkc1tpXV0udmFsdWUpOw0KCQl9DQoJCWtpbGwoKTsNCgl9DQoNCgkvKioNCgkgKiBhZGRzIGEgbmV3IGFuaW1hbCB0eXBlIHRvIHRoZSBnYW1lDQoJICogbWF4LiBudW1iZXIgb2YgYW5pbWFsIHR5cGVzOiAxMDANCgkgKiB0aGUgY29zdCBtYXkgbm90IGJlIGxvd2VyIHRoYW4gY29zdHNbMF0NCgkgKiAqLw0KCWZ1bmN0aW9uIGFkZEFuaW1hbFR5cGUodWludDEyOCBjb3N0KSB7DQoJCWlmICghKG1zZy5zZW5kZXIgPT0gb3duZXIpKSB0aHJvdzsNCgkJY29zdHMucHVzaChjb3N0KTsNCgkJdmFsdWVzLnB1c2goY29zdCAvIDEwMCAqIGZlZSk7DQoJfQ0KDQoJZnVuY3Rpb24gc2VsbEFuaW1hbCh1aW50MzIgYW5pbWFsSWQpew0KICAgICAgICBpZihtc2cuc2VuZGVyIT1hbmltYWxzW2FuaW1hbElkXS5vd25lcikgdGhyb3c7DQogICAgICAgIHVpbnQxMjggdmFsID0gYW5pbWFsc1thbmltYWxJZF0udmFsdWU7DQogICAgICAgIHVpbnQxNiBhbmltYWxJbmRleDsNCiAgICAgICAgZm9yKHVpbnQxNiBpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKyl7DQogICAgICAgICAgICBpZihpZHNbaV09PWFuaW1hbElkKXsNCiAgICAgICAgICAgICAgICBhbmltYWxJbmRleCA9IGk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmVwbGFjZUFuaW1hbChhbmltYWxJbmRleCk7DQogICAgICAgIGlmKCFtc2cuc2VuZGVyLnNlbmQodmFsKSkgdGhyb3c7DQogICAgfQ0KDQoJLyoqKioqKioqKioqKioqKioqKiBHRVRURVJTICoqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCg0KCWZ1bmN0aW9uIGdldFBsYXllckJhbGFuY2UoYWRkcmVzcyBwbGF5ZXJBZGRyZXNzKSBjb25zdGFudCByZXR1cm5zKHVpbnQxMjggcGxheWVyQmFsYW5jZSkgew0KCQlmb3IgKHVpbnQxNiBpID0gMDsgaSA8IG51bUFuaW1hbHM7IGkrKykgew0KCQkJaWYgKGFuaW1hbHNbaWRzW2ldXS5vd25lciA9PSBwbGF5ZXJBZGRyZXNzKSBwbGF5ZXJCYWxhbmNlICs9IGFuaW1hbHNbaWRzW2ldXS52YWx1ZTsNCgkJfQ0KCX0NCgkNCglmdW5jdGlvbiBnZXRBbmltYWwodWludDMyIGFuaW1hbElkKSBjb25zdGFudCByZXR1cm5zKHVpbnQ4LCB1aW50MTI4LCBhZGRyZXNzKXsNCgkJcmV0dXJuIChhbmltYWxzW2FuaW1hbElkXS5hbmltYWxUeXBlLGFuaW1hbHNbYW5pbWFsSWRdLnZhbHVlLGFuaW1hbHNbYW5pbWFsSWRdLm93bmVyKTsNCgl9DQoJDQoJZnVuY3Rpb24gZ2V0MTBBbmltYWxzKHVpbnQxNiBzdGFydEluZGV4KSBjb25zdGFudCByZXR1cm5zKHVpbnQzMlsxMF0gYW5pbWFsSWRzLCB1aW50OFsxMF0gdHlwZXMsIHVpbnQxMjhbMTBdIHZhbHVlcywgYWRkcmVzc1sxMF0gb3duZXJzKSB7DQoJCXVpbnQxNiBlbmRJbmRleD0gc3RhcnRJbmRleCsxMCA+IG51bUFuaW1hbHM/IG51bUFuaW1hbHM6IHN0YXJ0SW5kZXgrMTA7DQoJCXVpbnQ4IGogPSAwOw0KCQl1aW50MzIgaWQ7DQoJCWZvciAodWludDE2IGkgPSBzdGFydEluZGV4OyBpIDwgZW5kSW5kZXg7IGkrKyl7DQoJCQlpZD1pZHNbaV07DQoJCQlhbmltYWxJZHNbal0gPSBpZDsNCgkJCXR5cGVzW2pdID0gYW5pbWFsc1tpZF0uYW5pbWFsVHlwZTsNCgkJCXZhbHVlc1tqXSA9IGFuaW1hbHNbaWRdLnZhbHVlOw0KCQkJb3duZXJzW2pdID0gYW5pbWFsc1tpZF0ub3duZXI7DQoJCQlqKys7DQoJCX0NCgkJDQoJfQ0KCQ0KDQoJZnVuY3Rpb24gZ2V0RmVlcygpIGNvbnN0YW50IHJldHVybnModWludCkgew0KCQl1aW50IHJlc2VydmVkID0gMDsNCgkJZm9yICh1aW50MTYgaiA9IDA7IGogPCBudW1BbmltYWxzOyBqKyspDQoJCQlyZXNlcnZlZCArPSBhbmltYWxzW2lkc1tqXV0udmFsdWU7DQoJCXJldHVybiBhZGRyZXNzKHRoaXMpLmJhbGFuY2UgLSByZXNlcnZlZDsNCgl9DQoNCg0KCS8qKioqKioqKioqKioqKioqKiogU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQoJZnVuY3Rpb24gc2V0T3JhY2xpemVHYXModWludDMyIG5ld0dhcykgew0KCQlpZiAoIShtc2cuc2VuZGVyID09IG93bmVyKSkgdGhyb3c7DQoJCW9yYWNsaXplR2FzID0gbmV3R2FzOw0KCX0NCg0KCWZ1bmN0aW9uIHNldE1heEFuaW1hbHModWludDE2IG51bWJlcikgew0KCQlpZiAoIShtc2cuc2VuZGVyID09IG93bmVyKSkgdGhyb3c7DQoJCW1heEFuaW1hbHMgPSBudW1iZXI7DQoJfQ0KDQoNCgkvKioqKioqKioqKioqKiBIRUxQRVJTICoqKioqKioqKioqKioqKiovDQoNCgkvKioNCgkgKiBtYXBzIGEgZ2l2ZW4gbnVtYmVyIHRvIHRoZSBuZXcgcmFuZ2UgKG9sZCByYW5nZSAxMDAwKQ0KCSAqICovDQoJZnVuY3Rpb24gbWFwVG9OZXdSYW5nZSh1aW50IG51bWJlciwgdWludCByYW5nZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50MTYgcmFuZG9tTnVtYmVyKSB7DQoJCXJldHVybiB1aW50MTYobnVtYmVyICogcmFuZ2UgLyAxMDAwKTsNCgl9DQoNCgkvKioNCgkgKiBjb252ZXJ0cyBhIHN0cmluZyBvZiBudW1iZXJzIGJlaW5nIHNlcGFyYXRlZCBieSBhIGdpdmVuIGRlbGltaXRlciBpbnRvIGFuIGFycmF5IG9mIG51bWJlcnMgKCNob3dtYW55KSANCgkgKi8NCglmdW5jdGlvbiBnZXROdW1iZXJzRnJvbVN0cmluZyhzdHJpbmcgcywgc3RyaW5nIGRlbGltaXRlciwgdWludDE2IGhvd21hbnkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludDE2W10gbnVtYmVycykgew0KCQlzdHJpbmdzLnNsaWNlIG1lbW9yeSBteXJlc3VsdCA9IHMudG9TbGljZSgpOw0KCQlzdHJpbmdzLnNsaWNlIG1lbW9yeSBkZWxpbSA9IGRlbGltaXRlci50b1NsaWNlKCk7DQoJCW51bWJlcnMgPSBuZXcgdWludDE2W10oaG93bWFueSk7DQoJCWZvciAodWludDggaSA9IDA7IGkgPCBob3dtYW55OyBpKyspIHsNCgkJCW51bWJlcnNbaV0gPSB1aW50MTYocGFyc2VJbnQobXlyZXN1bHQuc3BsaXQoZGVsaW0pLnRvU3RyaW5nKCkpKTsNCgkJfQ0KCQlyZXR1cm4gbnVtYmVyczsNCgl9DQoNCn0='