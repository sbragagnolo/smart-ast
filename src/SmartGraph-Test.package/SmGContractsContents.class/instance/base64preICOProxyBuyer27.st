base 64 content
base64preICOProxyBuyer27
	^'LyoqDQogKiBTYWZlIHVuc2lnbmVkIHNhZmUgbWF0aC4NCiAqDQogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQ0KICoNCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQXJhZ29uT25lL3plcHBlbGluLXNvbGlkaXR5L21hc3Rlci9jb250cmFjdHMvU2FmZU1hdGhMaWIuc29sDQogKg0KICogTWFpbnRhaW5lZCBoZXJlIHVudGlsIG1lcmdlZCB0byBtYWlubGluZSB6ZXBwZWxpbi1zb2xpZGl0eS4NCiAqDQogKi8NCmxpYnJhcnkgU2FmZU1hdGhMaWIgew0KDQogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gcGx1cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjPj1hICYmIGM+PWIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBwcml2YXRlIHsNCiAgICBpZiAoIWFzc2VydGlvbikgdGhyb3c7DQogIH0NCn0NCg0KDQoNCg0KLyoNCiAqIE93bmFibGUNCiAqDQogKiBCYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIuDQogKiBQcm92aWRlcyBvbmx5T3duZXIgbW9kaWZpZXIsIHdoaWNoIHByZXZlbnRzIGZ1bmN0aW9uIGZyb20gcnVubmluZyBpZiBpdCBpcyBjYWxsZWQgYnkgYW55b25lIG90aGVyIHRoYW4gdGhlIG93bmVyLg0KICovDQpjb250cmFjdCBPd25hYmxlIHsNCiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsNCiAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogIH0NCg0KICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICBfOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsNCiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgew0KICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICB9DQogIH0NCg0KfQ0KDQoNCi8qDQogKiBIYWx0YWJsZQ0KICoNCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbg0KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLg0KICoNCiAqDQogKiBPcmlnaW5hbGx5IGVudmlzaW9uZWQgaW4gRmlyc3RCbG9vZCBJQ08gY29udHJhY3QuDQogKi8NCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgew0KICBib29sIHB1YmxpYyBoYWx0ZWQ7DQoNCiAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsNCiAgICBpZiAoaGFsdGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsNCiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlDQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgew0KICAgIGhhbHRlZCA9IHRydWU7DQogIH0NCg0KICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlDQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgew0KICAgIGhhbHRlZCA9IGZhbHNlOw0KICB9DQoNCn0NCg0KDQovKioNCiAqIEludGVyZmFjZSBmb3IgZGVmaW5pbmcgY3Jvd2RzYWxlIHByaWNpbmcuDQogKi8NCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7DQoNCiAgLyoqIEludGVyZmFjZSBkZWNsYXJhdGlvbi4gKi8NCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFNlbGYgY2hlY2sgaWYgYWxsIHJlZmVyZW5jZXMgYXJlIGNvcnJlY3RseSBzZXQuDQogICAqDQogICAqIENoZWNrcyB0aGF0IHByaWNpbmcgc3RyYXRlZ3kgbWF0Y2hlcyBjcm93ZHNhbGUgcGFyYW1ldGVycy4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIGNyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0Lg0KICAgKg0KICAgKg0KICAgKiBAcGFyYW0gdmFsdWUgLSBXaGF0IGlzIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VuZCBpbiBhcyB3ZWkNCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXINCiAgICogQHBhcmFtIHdlaVJhaXNlZCAtIGhvdyBtdWNoIG1vbmV5IGhhcyBiZWVuIHJhaXNlZCB0aGlzIGZhcg0KICAgKiBAcGFyYW0gbXNnU2VuZGVyIC0gd2hvIGlzIHRoZSBpbnZlc3RvciBvZiB0aGlzIHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcw0KICAgKiBAcmV0dXJuIEFtb3VudCBvZiB0b2tlbnMgdGhlIGludmVzdG9yIHJlY2VpdmVzDQogICAqLw0KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHRva2Vuc1NvbGQsIHVpbnQgd2VpUmFpc2VkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOw0KfQ0KDQoNCi8qKg0KICogRmluYWxpemUgYWdlbnQgZGVmaW5lcyB3aGF0IGhhcHBlbnMgYXQgdGhlIGVuZCBvZiBzdWNjZXNlZnVsIGNyb3dkc2FsZS4NCiAqDQogKiAtIEFsbG9jYXRlIHRva2VucyBmb3IgZm91bmRlcnMsIGJvdW50aWVzIGFuZCBjb21tdW5pdHkNCiAqIC0gTWFrZSB0b2tlbnMgdHJhbnNmZXJhYmxlDQogKiAtIGV0Yy4NCiAqLw0KY29udHJhY3QgRmluYWxpemVBZ2VudCB7DQoNCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFJldHVybiB0cnVlIGlmIHdlIGNhbiBydW4gZmluYWxpemVDcm93ZHNhbGUoKSBwcm9wZXJseS4NCiAgICoNCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luDQogICAqIHVubGVzcyB0aGUgZmluYWxpemVyIGhhcyBiZWVuIHNldCB1cCBwcm9wZXJseS4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsNCg0KICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovDQogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7DQoNCn0NCg0KDQoNCg0KLyoNCiAqIEVSQzIwIGludGVyZmFjZQ0KICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMCB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCg0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQoNCi8qKg0KICogQSB0b2tlbiB0aGF0IGRlZmluZXMgZnJhY3Rpb25hbCB1bml0cyBhcyBkZWNpbWFscy4NCiAqLw0KY29udHJhY3QgRnJhY3Rpb25hbEVSQzIwIGlzIEVSQzIwIHsNCg0KICB1aW50IHB1YmxpYyBkZWNpbWFsczsNCg0KfQ0KDQoNCg0KLyoqDQogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcy4NCiAqDQogKiBIYW5kbGUNCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcw0KICogLSBhY2NlcHRpbmcgaW52ZXN0bWVudHMNCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZA0KICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQNCiAqIC0gZGlmZmVyZW50IHByaWNpbmcgc3RyYXRlZ2llcw0KICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpDQogKg0KICovDQpjb250cmFjdCBDcm93ZHNhbGUgaXMgSGFsdGFibGUgew0KDQogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50Ow0KDQogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLw0KICBGcmFjdGlvbmFsRVJDMjAgcHVibGljIHRva2VuOw0KDQogIC8qIEhvdyB3ZSBhcmUgZ29pbmcgdG8gcHJpY2Ugb3VyIG9mZmVyaW5nICovDQogIFByaWNpbmdTdHJhdGVneSBwdWJsaWMgcHJpY2luZ1N0cmF0ZWd5Ow0KDQogIC8qIFBvc3Qtc3VjY2VzcyBjYWxsYmFjayAqLw0KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50Ow0KDQogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8NCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7DQoNCiAgLyogaWYgdGhlIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZCwgaW52ZXN0b3JzIG1heSB3aXRoZHJhdyB0aGVpciBmdW5kcyAqLw0KICB1aW50IHB1YmxpYyBtaW5pbXVtRnVuZGluZ0dvYWw7DQoNCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLw0KICB1aW50IHB1YmxpYyBzdGFydHNBdDsNCg0KICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLw0KICB1aW50IHB1YmxpYyBlbmRzQXQ7DQoNCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovDQogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOw0KDQogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovDQogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7DQoNCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8NCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7DQoNCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLw0KICB1aW50IHB1YmxpYyBsb2FkZWRSZWZ1bmQgPSAwOw0KDQogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIGdpdmVuIGJhY2sgdG8gaW52ZXN0b3JzLiovDQogIHVpbnQgcHVibGljIHdlaVJlZnVuZGVkID0gMDsNCg0KICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8NCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOw0KDQogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8NCiAgYm9vbCBwdWJsaWMgcmVxdWlyZUN1c3RvbWVySWQ7DQoNCiAgLyoqDQogICAgKiBEbyB3ZSB2ZXJpZnkgdGhhdCBjb250cmlidXRvciBoYXMgYmVlbiBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSAoYWNjcmVkaXRlZCBpbnZlc3RvcnMgb25seSkuDQogICAgKiBUaGlzIG1ldGhvZCB3YXMgZmlyc3QgdXNlZCBpbiBGaXJzdEJsb29kIGNyb3dkc2FsZSB0byBlbnN1cmUgYWxsIGNvbnRyaWJ1dG9ycyBoYXZlIGFjY2VwdGVkIHRlcm1zIG9uIHNhbGUgKG9uIHRoZSB3ZWIpLg0KICAgICovDQogIGJvb2wgcHVibGljIHJlcXVpcmVkU2lnbmVkQWRkcmVzczsNCg0KICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8NCiAgYWRkcmVzcyBwdWJsaWMgc2lnbmVyQWRkcmVzczsNCg0KICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaW52ZXN0ZWRBbW91bnRPZjsNCg0KICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2VuQW1vdW50T2Y7DQoNCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNhbCBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdDsNCg0KICAvKiogVGhpcyBpcyBmb3IgbWFudWwgdGVzdGluZyBmb3IgdGhlIGludGVyYWN0aW9uIGZyb20gb3duZXIgd2FsbGV0LiBZb3UgY2FuIHNldCBpdCB0byBhbnkgdmFsdWUgYW5kIGluc3BlY3QgdGhpcyBpbiBibG9ja2NoYWluIGV4cGxvcmVyIHRvIHNlZSB0aGF0IGNyb3dkc2FsZSBpbnRlcmFjdGlvbiB3b3Jrcy4gKi8NCiAgdWludCBwdWJsaWMgb3duZXJUZXN0VmFsdWU7DQoNCiAgLyoqIFN0YXRlIG1hY2hpbmUNCiAgICoNCiAgICogLSBQcmVwYXJpbmc6IEFsbCBjb250cmFjdCBpbml0aWFsaXphdGlvbiBjYWxscyBhbmQgdmFyaWFibGVzIGhhdmUgbm90IGJlZW4gc2V0IHlldA0KICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHBhc3NlZCBzdGFydCB0aW1lIHlldA0KICAgKiAtIEZ1bmRpbmc6IEFjdGl2ZSBjcm93ZHNhbGUNCiAgICogLSBTdWNjZXNzOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCByZWFjaGVkDQogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lDQogICAqIC0gRmluYWxpemVkOiBUaGUgZmluYWxpemVkIGhhcyBiZWVuIGNhbGxlZCBhbmQgc3VjY2VzZnVsbHkgZXhlY3V0ZWQNCiAgICogLSBSZWZ1bmRpbmc6IFJlZnVuZHMgYXJlIGxvYWRlZCBvbiB0aGUgY29udHJhY3QgZm9yIHJlY2xhaW0uDQogICAqLw0KICBlbnVtIFN0YXRle1Vua25vd24sIFByZXBhcmluZywgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmFpbHVyZSwgRmluYWxpemVkLCBSZWZ1bmRpbmd9DQoNCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQ0KICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludDEyOCBjdXN0b21lcklkKTsNCg0KICAvLyBSZWZ1bmQgd2FzIHByb2Nlc3NlZCBmb3IgYSBjb250cmlidXRvcg0KICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOw0KDQogIC8vIFRoZSBydWxlcyB3ZXJlIGNoYW5nZWQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdA0KICBldmVudCBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChib29sIHJlcXVpcmVDdXN0b21lcklkLCBib29sIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgYWRkcmVzcyBzaWduZXJBZGRyZXNzKTsNCg0KICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkDQogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpOw0KDQogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkDQogIGV2ZW50IEVuZHNBdENoYW5nZWQodWludCBlbmRzQXQpOw0KDQogIGZ1bmN0aW9uIENyb3dkc2FsZShhZGRyZXNzIF90b2tlbiwgUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3ksIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCB1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF9taW5pbXVtRnVuZGluZ0dvYWwpIHsNCg0KICAgIGlmKF9taW5pbXVtRnVuZGluZ0dvYWwgIT0gMCkgew0KICAgICAgLy8gTXlzdGVyaXVtIHNwZWNpZmljIGZpeCB0byBhbGxvdyBmdW5kaW5nIGdvYWwgb25seSBiZSBzZXQgaW4gQ0hGDQogICAgfQ0KDQogICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KDQogICAgdG9rZW4gPSBGcmFjdGlvbmFsRVJDMjAoX3Rva2VuKTsNCg0KICAgIHNldFByaWNpbmdTdHJhdGVneShfcHJpY2luZ1N0cmF0ZWd5KTsNCg0KICAgIG11bHRpc2lnV2FsbGV0ID0gX211bHRpc2lnV2FsbGV0Ow0KICAgIGlmKG11bHRpc2lnV2FsbGV0ID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYoX3N0YXJ0ID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgc3RhcnRzQXQgPSBfc3RhcnQ7DQoNCiAgICBpZihfZW5kID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgZW5kc0F0ID0gX2VuZDsNCg0KICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzDQogICAgaWYoc3RhcnRzQXQgPj0gZW5kc0F0KSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICB9DQoNCiAgLyoqDQogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbigpIHBheWFibGUgew0KICAgIHRocm93Ow0KICB9DQoNCiAgLyoqDQogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4NCiAgICoNCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4NCiAgICogV2UgbXVzdCBoYXZlIG5vdCBwcmVzc2VkIHRoZSBlbWVyZ2VuY3kgYnJha2UuDQogICAqDQogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2Vucw0KICAgKiBAcGFyYW0gY3VzdG9tZXJJZCAob3B0aW9uYWwpIFVVSUQgdjQgdG8gdHJhY2sgdGhlIHN1Y2Nlc3NmdWwgcGF5bWVudHMgb24gdGhlIHNlcnZlciBzaWRlDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3RJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQpIHN0b3BJbkVtZXJnZW5jeSBwcml2YXRlIHsNCg0KICAgIC8vIERldGVybWluZSBpZiBpdCdzIGEgZ29vZCB0aW1lIHRvIGFjY2VwdCBpbnZlc3RtZW50IGZyb20gdGhpcyBwYXJ0aWNpcGFudA0KICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgew0KICAgICAgLy8gQXJlIHdlIHdoaXRlbGlzdGVkIGZvciBlYXJseSBkZXBvc2l0DQogICAgICBpZighZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0pIHsNCiAgICAgICAgdGhyb3c7DQogICAgICB9DQogICAgfSBlbHNlIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuRnVuZGluZykgew0KICAgICAgLy8gUmV0YWlsIHBhcnRpY2lwYW50cyBjYW4gb25seSBjb21lIGluIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyBydW5uaW5nDQogICAgICAvLyBwYXNzDQogICAgfSBlbHNlIHsNCiAgICAgIC8vIFVud2FudGVkIHN0YXRlDQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICB1aW50IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsNCiAgICB1aW50IHRva2VuQW1vdW50ID0gcHJpY2luZ1N0cmF0ZWd5LmNhbGN1bGF0ZVByaWNlKHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsNCg0KICAgIGlmKHRva2VuQW1vdW50ID09IDApIHsNCiAgICAgIC8vIER1c3QgdHJhbnNhY3Rpb24NCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGlmKGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID09IDApIHsNCiAgICAgICAvLyBBIG5ldyBpbnZlc3Rvcg0KICAgICAgIGludmVzdG9yQ291bnQrKzsNCiAgICB9DQoNCiAgICAvLyBVcGRhdGUgaW52ZXN0b3INCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXMod2VpQW1vdW50KTsNCiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOw0KDQogICAgLy8gVXBkYXRlIHRvdGFscw0KICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5wbHVzKHdlaUFtb3VudCk7DQogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBDaGVjayB0aGF0IHdlIGRpZCBub3QgYnVzdCB0aGUgY2FwDQogICAgaWYoaXNCcmVha2luZ0NhcCh0b2tlbkFtb3VudCwgd2VpQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQpKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsNCg0KICAgIC8vIFBvY2tldCB0aGUgbW9uZXkNCiAgICBpZighbXVsdGlzaWdXYWxsZXQuc2VuZCh3ZWlBbW91bnQpKSB0aHJvdzsNCg0KICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzDQogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGN1c3RvbWVySWQpOw0KDQogICAgLy8gQ2FsbCB0aGUgaW52ZXN0IGhvb2tzDQogICAgb25JbnZlc3QoKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBUcmFjayB3aG8gaXMgdGhlIGN1c3RvbWVyIG1ha2luZyB0aGUgcGF5bWVudCBzbyB3ZSBjYW4gc2VuZCB0aGFuayB5b3UgZW1haWwuDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3RXaXRoQ3VzdG9tZXJJZChhZGRyZXNzIGFkZHIsIHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgew0KICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzDQogICAgaWYoY3VzdG9tZXJJZCA9PSAwKSB0aHJvdzsgIC8vIFVVSUR2NCBzYW5pdHkgY2hlY2sNCiAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCBjdXN0b21lcklkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4NCiAgICovDQogIGZ1bmN0aW9uIGludmVzdChhZGRyZXNzIGFkZHIpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpZihyZXF1aXJlQ3VzdG9tZXJJZCkgdGhyb3c7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aXBhbnRzIGZvciB0aGFuayB5b3UgZW1haWwNCiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cw0KICAgIGludmVzdEludGVybmFsKGFkZHIsIDApOw0KICB9DQoNCiAgLyoqDQogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIuDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsNCiAgICBpbnZlc3RXaXRoQ3VzdG9tZXJJZChtc2cuc2VuZGVyLCBjdXN0b21lcklkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLg0KICAgKg0KICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuDQogICAqLw0KICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaW52ZXN0KG1zZy5zZW5kZXIpOw0KICB9DQoNCiAgLyoqDQogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuDQogICAqDQogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7DQoNCiAgICAvLyBBbHJlYWR5IGZpbmFsaXplZA0KICAgIGlmKGZpbmFsaXplZCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gRmluYWxpemluZyBpcyBvcHRpb25hbC4gV2Ugb25seSBjYWxsIGl0IGlmIHdlIGFyZSBnaXZlbiBhIGZpbmFsaXppbmcgYWdlbnQuDQogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSAwKSB7DQogICAgICBmaW5hbGl6ZUFnZW50LmZpbmFsaXplQ3Jvd2RzYWxlKCk7DQogICAgfQ0KDQogICAgZmluYWxpemVkID0gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byAocmUpc2V0IGZpbmFsaXplIGFnZW50Lg0KICAgKg0KICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gc2V0dGluZyB0aGlzLCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4NCiAgICovDQogIGZ1bmN0aW9uIHNldEZpbmFsaXplQWdlbnQoRmluYWxpemVBZ2VudCBhZGRyKSBvbmx5T3duZXIgew0KICAgIGZpbmFsaXplQWdlbnQgPSBhZGRyOw0KDQogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQNCiAgICBpZighZmluYWxpemVBZ2VudC5pc0ZpbmFsaXplQWdlbnQoKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIFNldCBwb2xpY3kgZG8gd2UgbmVlZCB0byBoYXZlIHNlcnZlci1zaWRlIGN1c3RvbWVyIGlkcyBmb3IgdGhlIGludmVzdG1lbnRzLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0UmVxdWlyZUN1c3RvbWVySWQoYm9vbCB2YWx1ZSkgb25seU93bmVyIHsNCiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOw0KICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLg0KICAgKg0KICAgKiBUT0RPOiBGaXggc3BlbGxpbmcgZXJyb3IgaW4gdGhlIG5hbWUNCiAgICovDQogICAgZnVuY3Rpb24gc2V0RWFybHlQYXJpY2lwYW50V2hpdGVsaXN0KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpIG9ubHlPd25lciB7DQogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IHN0YXR1czsNCiAgICBXaGl0ZWxpc3RlZChhZGRyLCBzdGF0dXMpOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IHRvIChyZSlzZXQgcHJpY2luZyBzdHJhdGVneS4NCiAgICoNCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHRoZSBzZXQsIHNvIHRoYXQgd2UgY2FuIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0UHJpY2luZ1N0cmF0ZWd5KFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5KSBvbmx5T3duZXIgew0KICAgIHByaWNpbmdTdHJhdGVneSA9IF9wcmljaW5nU3RyYXRlZ3k7DQoNCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudA0KICAgIGlmKCFwcmljaW5nU3RyYXRlZ3kuaXNQcmljaW5nU3RyYXRlZ3koKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGxvYWQgcmVmdW5kcyBiYWNrIG9uIHRoZSBjb250cmFjdCBmb3IgdGhlIHJlZnVuZGluZy4NCiAgICoNCiAgICogVGhlIHRlYW0gY2FuIHRyYW5zZmVyIHRoZSBmdW5kcyBiYWNrIG9uIHRoZSBzbWFydCBjb250cmFjdCBpbiB0aGUgY2FzZSB0aGUgbWluaW11bSBnb2FsIHdhcyBub3QgcmVhY2hlZC4uDQogICAqLw0KICBmdW5jdGlvbiBsb2FkUmVmdW5kKCkgcHVibGljIHBheWFibGUgaW5TdGF0ZShTdGF0ZS5GYWlsdXJlKSB7DQogICAgaWYobXNnLnZhbHVlID09IDApIHRocm93Ow0KICAgIGxvYWRlZFJlZnVuZCA9IGxvYWRlZFJlZnVuZC5wbHVzKG1zZy52YWx1ZSk7DQogIH0NCg0KICAvKioNCiAgICogSW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmQuDQogICAqLw0KICBmdW5jdGlvbiByZWZ1bmQoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5SZWZ1bmRpbmcpIHsNCiAgICB1aW50MjU2IHdlaVZhbHVlID0gaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXTsNCiAgICBpZiAod2VpVmFsdWUgPT0gMCkgdGhyb3c7DQogICAgaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXSA9IDA7DQogICAgd2VpUmVmdW5kZWQgPSB3ZWlSZWZ1bmRlZC5wbHVzKHdlaVZhbHVlKTsNCiAgICBSZWZ1bmQobXNnLnNlbmRlciwgd2VpVmFsdWUpOw0KICAgIGlmICghbXNnLnNlbmRlci5zZW5kKHdlaVZhbHVlKSkgdGhyb3c7DQogIH0NCg0KICAvKioNCiAgICogQHJldHVybiB0cnVlIGlmIHRoZSBjcm93ZHNhbGUgaGFzIHJhaXNlZCBlbm91Z2ggbW9uZXkgdG8gYmUgYSBzdWNjZXMNCiAgICovDQogIGZ1bmN0aW9uIGlzTWluaW11bUdvYWxSZWFjaGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmVhY2hlZCkgew0KICAgIHJldHVybiB3ZWlSYWlzZWQgPj0gbWluaW11bUZ1bmRpbmdHb2FsOw0KICB9DQoNCiAgLyoqDQogICAqIENoZWNrIGlmIHRoZSBjb250cmFjdCByZWxhdGlvbnNoaXAgbG9va3MgZ29vZC4NCiAgICovDQogIGZ1bmN0aW9uIGlzRmluYWxpemVyU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsNCiAgICByZXR1cm4gZmluYWxpemVBZ2VudC5pc1NhbmUoKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuDQogICAqLw0KICBmdW5jdGlvbiBpc1ByaWNpbmdTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgc2FuZSkgew0KICAgIHJldHVybiBwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpOw0KICB9DQoNCiAgLyoqDQogICAqIENyb3dkZnVuZCBzdGF0ZSBtYWNoaW5lIG1hbmFnZW1lbnQuDQogICAqDQogICAqIFdlIG1ha2UgaXQgYSBmdW5jdGlvbiBhbmQgZG8gbm90IGFzc2lnbiB0aGUgcmVzdWx0IHRvIGEgdmFyaWFibGUsIHNvIHRoZXJlIGlzIG5vIGNoYW5jZSBvZiB0aGUgdmFyaWFibGUgYmVpbmcgc3RhbGUuDQogICAqLw0KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgew0KICAgIGlmKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsNCiAgICBlbHNlIGlmIChhZGRyZXNzKGZpbmFsaXplQWdlbnQpID09IDApIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7DQogICAgZWxzZSBpZiAoIWZpbmFsaXplQWdlbnQuaXNTYW5lKCkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7DQogICAgZWxzZSBpZiAoIXByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7DQogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDwgc3RhcnRzQXQpIHJldHVybiBTdGF0ZS5QcmVGdW5kaW5nOw0KICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsNCiAgICBlbHNlIGlmIChpc01pbmltdW1Hb2FsUmVhY2hlZCgpKSByZXR1cm4gU3RhdGUuU3VjY2VzczsNCiAgICBlbHNlIGlmICghaXNNaW5pbXVtR29hbFJlYWNoZWQoKSAmJiB3ZWlSYWlzZWQgPiAwICYmIGxvYWRlZFJlZnVuZCA+PSB3ZWlSYWlzZWQpIHJldHVybiBTdGF0ZS5SZWZ1bmRpbmc7DQogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsNCiAgfQ0KDQogIC8qKiBUaGlzIGlzIGZvciBtYW51YWwgdGVzdGluZyBvZiBtdWx0aXNpZyB3YWxsZXQgaW50ZXJhY3Rpb24gKi8NCiAgZnVuY3Rpb24gc2V0T3duZXJUZXN0VmFsdWUodWludCB2YWwpIG9ubHlPd25lciB7DQogICAgb3duZXJUZXN0VmFsdWUgPSB2YWw7DQogIH0NCg0KICAvKiogSW50ZXJmYWNlIG1hcmtlci4gKi8NCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCg0KICAvKioNCiAgICogQWxsb3cgc3ViY29udHJhY3RzIHRvIHRha2UgZXh0cmEgYWN0aW9ucyBvbiBhIHN1Y2Nlc3NmdWwgaW52ZXQuDQogICAqLw0KICBmdW5jdGlvbiBvbkludmVzdCgpIGludGVybmFsIHsNCg0KICB9DQoNCiAgLy8NCiAgLy8gTW9kaWZpZXJzDQogIC8vDQoNCiAgLyoqIE1vZGlmaWVkIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcuICAqLw0KICBtb2RpZmllciBpblN0YXRlKFN0YXRlIHN0YXRlKSB7DQogICAgaWYoZ2V0U3RhdGUoKSAhPSBzdGF0ZSkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyBjcm93ZHNhbGUgb3duZXIgdG8gY2xvc2UgZWFybHkgb3IgZXh0ZW5kIHRoZSBjcm93ZHNhbGUuDQogICAqDQogICAqIFRoaXMgaXMgdXNlZnVsIGUuZy4gZm9yIGEgbWFudWFsIHNvZnQgY2FwIGltcGxlbWVudGF0aW9uOg0KICAgKiAtIGFmdGVyIFggYW1vdW50IGlzIHJlYWNoZWQgZGV0ZXJtaW5lIG1hbnVhbCBjbG9zaW5nDQogICAqDQogICAqIFRoaXMgbWF5IHB1dCB0aGUgY3Jvd2RzYWxlIHRvIGFuIGludmFsaWQgc3RhdGUsDQogICAqIGJ1dCB3ZSB0cnVzdCBvd25lcnMga25vdyB3aGF0IHRoZXkgYXJlIGRvaW5nLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0RW5kc0F0KHVpbnQgdGltZSkgb25seU93bmVyIHsNCg0KICAgIGlmKG5vdyA+IHRpbWUpIHsNCiAgICAgIHRocm93OyAvLyBEb24ndCBjaGFuZ2UgcGFzdA0KICAgIH0NCg0KICAgIGVuZHNBdCA9IHRpbWU7DQogICAgRW5kc0F0Q2hhbmdlZChlbmRzQXQpOw0KICB9DQoNCiAgLy8NCiAgLy8gQWJzdHJhY3QgZnVuY3Rpb25zDQogIC8vDQoNCiAgLyoqDQogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGludmVzdGVkIGJyZWFrcyBvdXIgY2FwIHJ1bGVzLg0KICAgKg0KICAgKg0KICAgKiBUaGUgY2hpbGQgY29udHJhY3QgbXVzdCBkZWZpbmUgdGhlaXIgb3duIGNhcCBzZXR0aW5nIHJ1bGVzLg0KICAgKiBXZSBhbGxvdyBhIGxvdCBvZiBmbGV4aWJpbGl0eSB0aHJvdWdoIGRpZmZlcmVudCBjYXBwaW5nIHN0cmF0ZWdpZXMgKEVUSCwgdG9rZW4gY291bnQpDQogICAqIENhbGxlZCBmcm9tIGludmVzdCgpLg0KICAgKg0KICAgKiBAcGFyYW0gd2VpQW1vdW50IFRoZSBhbW91bnQgb2Ygd2VpIHRoZSBpbnZlc3RvciB0cmllcyB0byBpbnZlc3QgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHRva2VuQW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHdlIHRyeSB0byBnaXZlIHRvIHRoZSBpbnZlc3RvciBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gd2VpUmFpc2VkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgcmFpc2VkIGJhbGFuY2UgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gdG9rZW5zU29sZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHNvbGQgdG9rZW5zIGNvdW50IGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24NCiAgICoNCiAgICogQHJldHVybiB0cnVlIGlmIHRha2luZyB0aGlzIGludmVzdG1lbnQgd291bGQgYnJlYWsgb3VyIGNhcCBydWxlcw0KICAgKi8NCiAgZnVuY3Rpb24gaXNCcmVha2luZ0NhcCh1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludCB3ZWlSYWlzZWRUb3RhbCwgdWludCB0b2tlbnNTb2xkVG90YWwpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgbGltaXRCcm9rZW4pOw0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBjcm93ZHNhbGUgaXMgZnVsbCBhbmQgd2UgY2FuIG5vIGxvbmdlciBzZWxsIGFueSB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7DQoNCiAgLyoqDQogICAqIENyZWF0ZSBuZXcgdG9rZW5zIG9yIHRyYW5zZmVyIGlzc3VlZCB0b2tlbnMgdG8gdGhlIGludmVzdG9yIGRlcGVuZGluZyBvbiB0aGUgY2FwIG1vZGVsLg0KICAgKi8NCiAgZnVuY3Rpb24gYXNzaWduVG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIHByaXZhdGU7DQp9DQoNCg0KDQoNCg0KDQoNCi8qKg0KICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcw0KICovDQpjb250cmFjdCBTYWZlTWF0aCB7DQogIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICogYjsNCiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gc2FmZURpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiID4gMCk7DQogICAgdWludCBjID0gYSAvIGI7DQogICAgYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjPj1hICYmIGM+PWIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsNCiAgICBpZiAoIWFzc2VydGlvbikgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQp9DQoNCg0KDQovKioNCiAqIFN0YW5kYXJkIEVSQzIwIHRva2VuIHdpdGggU2hvcnQgSGFuZCBBdHRhY2sgYW5kIGFwcHJvdmUoKSByYWNlIGNvbmRpdGlvbiBtaXRpZ2F0aW9uLg0KICoNCiAqIEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDoNCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbA0KICovDQpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBTYWZlTWF0aCB7DQoNCiAgLyogVG9rZW4gc3VwcGx5IGdvdCBpbmNyZWFzZWQgYW5kIGEgbmV3IG93bmVyIHJlY2VpdmVkIHRoZXNlIHRva2VucyAqLw0KICBldmVudCBNaW50ZWQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOw0KDQogIC8qIEFjdHVhbCBiYWxhbmNlcyBvZiB0b2tlbiBob2xkZXJzICovDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsNCg0KICAvKiBhcHByb3ZlKCkgYWxsb3dhbmNlcyAqLw0KICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7DQoNCiAgLyoqDQogICAqDQogICAqIEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrDQogICAqDQogICAqIGh0dHA6Ly92ZXNzZW5lcy5jb20vdGhlLWVyYzIwLXNob3J0LWFkZHJlc3MtYXR0YWNrLWV4cGxhaW5lZC8NCiAgICovDQogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsNCiAgICAgaWYobXNnLmRhdGEubGVuZ3RoICE9IHNpemUgKyA0KSB7DQogICAgICAgdGhyb3c7DQogICAgIH0NCiAgICAgXzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOw0KICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7DQogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgdWludCBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07DQoNCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc2FmZVN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0DQogICAgLy8gaWYgKF92YWx1ZSA+IF9hbGxvd2FuY2UpIHRocm93Ow0KDQogICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsNCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsNCiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKTsNCiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsNCiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KDQogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2ANCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdA0KICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOg0KICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQ0KICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgdGhyb3c7DQoNCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsNCiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBdG9taWMgaW5jcmVtZW50IG9mIGFwcHJvdmVkIHNwZW5kaW5nDQogICAqDQogICAqIFdvcmtzIGFyb3VuZCBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQ0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gYWRkQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkNCiAgb25seVBheWxvYWRTaXplKDIgKiAzMikNCiAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07DQogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IHNhZmVBZGQob2xkVmFsdWUsIF9hZGRlZFZhbHVlKTsNCiAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBdG9taWMgZGVjcmVtZW50IG9mIGFwcHJvdmVkIHNwZW5kaW5nLg0KICAgKg0KICAgKiBXb3JrcyBhcm91bmQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkNCiAgICovDQogIGZ1bmN0aW9uIHN1YkFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkNCiAgb25seVBheWxvYWRTaXplKDIgKiAzMikNCiAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQoNCiAgICAgIHVpbnQgb2xkVmFsID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07DQoNCiAgICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsKSB7DQogICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IHNhZmVTdWIob2xkVmFsLCBfc3VidHJhY3RlZFZhbHVlKTsNCiAgICAgIH0NCiAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQp9DQoNCg0KLyoqDQogKiBDb2xsZWN0IGZ1bmRzIGZyb20gcHJlc2FsZSBpbnZlc3RvcnMsIGJ1eSB0b2tlbnMgZm9yIHRoZW0gaW4gYSBzaW5nbGUgdHJhbnNhY3Rpb24gYW5kIGRpc3RyaWJ1dGUgb3V0IHRva2Vucy4NCiAqDQogKiAtIENvbGxlY3QgZnVuZHMgZnJvbSBwcmUtc2FsZSBpbnZlc3RvcnMNCiAqIC0gU2VuZCBmdW5kcyB0byB0aGUgY3Jvd2RzYWxlIHdoZW4gaXQgb3BlbnMNCiAqIC0gQWxsb3cgb3duZXIgdG8gc2V0IHRoZSBjcm93ZHNhbGUNCiAqIC0gSGF2ZSByZWZ1bmQgYWZ0ZXIgWCBkYXlzIGFzIGEgc2FmZXR5IGhhdGNoIGlmIHRoZSBjcm93ZHNhbGUgZG9lc24ndCBtYXRlcmlsaXplDQogKiAtIEFsbG93IHVubGltaXRlZCBpbnZlc3RvcnMNCiAqIC0gVG9rZW5zIGFyZSBkaXN0cmlidXRlZCBvbiBQcmVJQ09Qcm94eUJ1eWVyIHNtYXJ0IGNvbnRyYWN0IGZpcnN0DQogKiAtIFRoZSBvcmlnaW5hbCBpbnZlc3RvcnMgY2FuIGNsYWltIHRoZWlyIHRva2VucyBmcm9tIHRoZSBzbWFydCBjb250cmFjdCBhZnRlciB0aGUgdG9rZW4gdHJhbnNmZXIgaGFzIGJlZW4gcmVsZWFzZWQNCiAqDQogKi8NCmNvbnRyYWN0IFByZUlDT1Byb3h5QnV5ZXIgaXMgT3duYWJsZSB7DQoNCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7DQoNCiAgLyoqIEhvdyBtYW55IGludmVzdG9ycyB3ZSBoYXZlIG5vdyAqLw0KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50Ow0KDQogIC8qKiBIb3cgbWFueSB3ZWkgd2UgaGF2ZSByYWlzZWQgdG90bGEuICovDQogIHVpbnQgcHVibGljIHdlaVJhaXNlZFRvdGFsOw0KDQogIC8qKiBXaG8gYXJlIG91ciBpbnZlc3RvcnMgKGl0ZXJhYmxlKSAqLw0KICBhZGRyZXNzW10gcHVibGljIGludmVzdG9yczsNCg0KICAvKiogSG93IG11Y2ggdGhleSBoYXZlIGludmVzdGVkICovDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgYmFsYW5jZXM7DQoNCiAgLyoqIEhvdyBtYW55IHRva2VucyBpbnZlc3RvcnMgaGF2ZSBjbGFpbWVkICovDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgY2xhaW1lZDsNCg0KICAvKiogV2hlbiBvdXIgcmVmdW5kIGZyZWV6ZSBpcyBvdmVyIChVTklUIHRpbWVzdGFtcCkgKi8NCiAgdWludCBwdWJsaWMgZnJlZXplRW5kc0F0Ow0KDQogIC8qKiBXaGF0IGlzIHRoZSBtaW5pbXVtIGJ1eSBpbiAqLw0KICB1aW50IHB1YmxpYyB3ZWlNaW5pbXVtTGltaXQ7DQoNCiAgLyoqIEhvdyBtYW55IHRva2VucyB3ZXJlIGJvdWdodCAqLw0KICB1aW50IHB1YmxpYyB0b2tlbnNCb3VnaHQ7DQoNCiAgIC8qKiBIb3cgbWFueSBpbnZlc3RvcnMgaGF2ZSBjbGFpbWVkIHRoZWlyIHRva2VucyAqLw0KICB1aW50IHB1YmxpYyBjbGFpbUNvdW50Ow0KDQogIHVpbnQgcHVibGljIHRvdGFsQ2xhaW1lZDsNCg0KICAvKiogT3VyIElDTyBjb250cmFjdCB3aGVyZSB3ZSB3aWxsIG1vdmUgdGhlIGZ1bmRzICovDQogIENyb3dkc2FsZSBwdWJsaWMgY3Jvd2RzYWxlOw0KDQogIC8qKiBXaGF0IGlzIG91ciBjdXJyZW50IHN0YXRlLiAqLw0KICBlbnVtIFN0YXRle1Vua25vd24sIEZ1bmRpbmcsIERpc3RyaWJ1dGluZywgUmVmdW5kaW5nfQ0KDQogIC8qKiBTb21lYm9keSBsb2FkZWQgdGhlaXIgaW52ZXN0bWVudCBtb25leSAqLw0KICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHZhbHVlKTsNCg0KICAvKiogUmVmdW5kIGNsYWltZWQgKi8NCiAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB2YWx1ZSk7DQoNCiAgLyoqIFdlIGV4ZWN1dGVkIG91ciBidXkgKi8NCiAgZXZlbnQgVG9rZW5zQm91Z2h0cyh1aW50IGNvdW50KTsNCg0KICAvKiogV2UgZGlzdHJpYnV0ZWQgdG9rZW5zIHRvIGFuIGludmVzdG9yICovDQogIGV2ZW50IERpc3RyaWJ1dGVkKGFkZHJlc3MgaW52ZXN0b3JzLCB1aW50IGNvdW50KTsNCg0KICAvKioNCiAgICogQ3JlYXRlIHByZXNhbGUgY29udHJhY3Qgd2hlcmUgbG9jayB1cCBwZXJpb2QgaXMgZ2l2ZW4gZGF5cw0KICAgKi8NCiAgZnVuY3Rpb24gUHJlSUNPUHJveHlCdXllcihhZGRyZXNzIF9vd25lciwgdWludCBfZnJlZXplRW5kc0F0LCB1aW50IF93ZWlNaW5pbXVtTGltaXQpIHsNCg0KICAgIG93bmVyID0gX293bmVyOw0KDQogICAgLy8gR2l2ZSBhcmd1bWVudA0KICAgIGlmKF9mcmVlemVFbmRzQXQgPT0gMCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gR2l2ZSBhcmd1bWVudA0KICAgIGlmKF93ZWlNaW5pbXVtTGltaXQgPT0gMCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgd2VpTWluaW11bUxpbWl0ID0gX3dlaU1pbmltdW1MaW1pdDsNCiAgICBmcmVlemVFbmRzQXQgPSBfZnJlZXplRW5kc0F0Ow0KICB9DQoNCiAgLyoqDQogICAqIEdldCB0aGUgdG9rZW4gd2UgYXJlIGRpc3RyaWJ1dGluZy4NCiAgICovDQogIGZ1bmN0aW9uIGdldFRva2VuKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoRnJhY3Rpb25hbEVSQzIwKSB7DQogICAgaWYoYWRkcmVzcyhjcm93ZHNhbGUpID09IDApICB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICByZXR1cm4gY3Jvd2RzYWxlLnRva2VuKCk7DQogIH0NCg0KICAvKioNCiAgICogUGFydGljaXBhdGUgdG8gYSBwcmVzYWxlLg0KICAgKi8NCiAgZnVuY3Rpb24gaW52ZXN0KCkgcHVibGljIHBheWFibGUgew0KDQogICAgLy8gQ2Fubm90IGludmVzdCBhbnltb3JlIHRocm91Z2ggY3Jvd2RzYWxlIHdoZW4gbW92aW5nIGhhcyBiZWd1bg0KICAgIGlmKGdldFN0YXRlKCkgIT0gU3RhdGUuRnVuZGluZykgdGhyb3c7DQoNCiAgICBpZihtc2cudmFsdWUgPT0gMCkgdGhyb3c7IC8vIE5vIGVtcHR5IGJ1eXMNCg0KICAgIGFkZHJlc3MgaW52ZXN0b3IgPSBtc2cuc2VuZGVyOw0KDQogICAgYm9vbCBleGlzdGluZyA9IGJhbGFuY2VzW2ludmVzdG9yXSA+IDA7DQoNCiAgICBiYWxhbmNlc1tpbnZlc3Rvcl0gPSBiYWxhbmNlc1tpbnZlc3Rvcl0ucGx1cyhtc2cudmFsdWUpOw0KDQogICAgLy8gTmVlZCB0byBmdWxmaWxsIG1pbmltdW0gbGltaXQNCiAgICBpZihiYWxhbmNlc1tpbnZlc3Rvcl0gPCB3ZWlNaW5pbXVtTGltaXQpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8vIFRoaXMgaXMgYSBuZXcgaW52ZXN0b3INCiAgICBpZighZXhpc3RpbmcpIHsNCiAgICAgIGludmVzdG9ycy5wdXNoKGludmVzdG9yKTsNCiAgICAgIGludmVzdG9yQ291bnQrKzsNCiAgICB9DQoNCiAgICB3ZWlSYWlzZWRUb3RhbCA9IHdlaVJhaXNlZFRvdGFsLnBsdXMobXNnLnZhbHVlKTsNCg0KICAgIEludmVzdGVkKGludmVzdG9yLCBtc2cudmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIExvYWQgZnVuZHMgdG8gdGhlIGNyb3dkc2FsZSBmb3IgYWxsIGludmVzdG9ycy4NCiAgICoNCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIGJ1eUZvckV2ZXJ5Ym9keSgpIHB1YmxpYyB7DQoNCiAgICBpZihnZXRTdGF0ZSgpICE9IFN0YXRlLkZ1bmRpbmcpIHsNCiAgICAgIC8vIE9ubHkgYWxsb3cgYnV5IG9uY2UNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8vIENyb3dkc2FsZSBub3QgeWV0IHNldA0KICAgIGlmKGFkZHJlc3MoY3Jvd2RzYWxlKSA9PSAwKSB0aHJvdzsNCg0KICAgIC8vIEJ1eSB0b2tlbnMgb24gdGhlIGNvbnRyYWN0DQogICAgY3Jvd2RzYWxlLmludmVzdC52YWx1ZSh3ZWlSYWlzZWRUb3RhbCkoYWRkcmVzcyh0aGlzKSk7DQoNCiAgICAvLyBSZWNvcmQgaG93IG1hbnkgdG9rZW5zIHdlIGdvdA0KICAgIHRva2Vuc0JvdWdodCA9IGdldFRva2VuKCkuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOw0KDQogICAgaWYodG9rZW5zQm91Z2h0ID09IDApIHsNCiAgICAgIC8vIERpZCBub3QgZ2V0IGFueSB0b2tlbnMNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIFRva2Vuc0JvdWdodHModG9rZW5zQm91Z2h0KTsNCiAgfQ0KDQogIC8qKg0KICAgKiBIb3cgbWF5IHRva2VucyBlYWNoIGludmVzdG9yIGdldHMuDQogICAqLw0KICBmdW5jdGlvbiBnZXRDbGFpbUFtb3VudChhZGRyZXNzIGludmVzdG9yKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KDQogICAgLy8gQ2xhaW1zIGNhbiBiZSBvbmx5IG1hZGUgaWYgd2UgbWFuYWdlIHRvIGJ1eSB0b2tlbnMNCiAgICBpZihnZXRTdGF0ZSgpICE9IFN0YXRlLkRpc3RyaWJ1dGluZykgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICAgIHJldHVybiBiYWxhbmNlc1tpbnZlc3Rvcl0udGltZXModG9rZW5zQm91Z2h0KSAvIHdlaVJhaXNlZFRvdGFsOw0KICB9DQoNCiAgLyoqDQogICAqIEhvdyBtYW55IHRva2VucyByZW1haW4gdW5jbGFpbWVkIGZvciBhbiBpbnZlc3Rvci4NCiAgICovDQogIGZ1bmN0aW9uIGdldENsYWltTGVmdChhZGRyZXNzIGludmVzdG9yKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgIHJldHVybiBnZXRDbGFpbUFtb3VudChpbnZlc3RvcikubWludXMoY2xhaW1lZFtpbnZlc3Rvcl0pOw0KICB9DQoNCiAgLyoqDQogICAqIENsYWltIGFsbCByZW1haW5pbmcgdG9rZW5zIGZvciB0aGlzIGludmVzdG9yLg0KICAgKi8NCiAgZnVuY3Rpb24gY2xhaW1BbGwoKSB7DQogICAgY2xhaW0oZ2V0Q2xhaW1MZWZ0KG1zZy5zZW5kZXIpKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBDbGFpbSBOIGJvdWdodCB0b2tlbnMgdG8gdGhlIGludmVzdG9yIGFzIHRoZSBtc2cgc2VuZGVyLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gY2xhaW0odWludCBhbW91bnQpIHsNCiAgICBhZGRyZXNzIGludmVzdG9yID0gbXNnLnNlbmRlcjsNCg0KICAgIGlmKGFtb3VudCA9PSAwKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZihnZXRDbGFpbUxlZnQoaW52ZXN0b3IpIDwgYW1vdW50KSB7DQogICAgICAvLyBXb29wcyB3ZSBjYW5ub3QgZ2V0IG1vcmUgdGhhbiB3ZSBoYXZlIGxlZnQNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8vIFdlIHRyYWNrIHdobyBtYW55IGludmVzdG9yIGhhdmUgKHBhcnRpYWxseSkgY2xhaW1lZCB0aGVpciB0b2tlbnMNCiAgICBpZihjbGFpbWVkW2ludmVzdG9yXSA9PSAwKSB7DQogICAgICBjbGFpbUNvdW50Kys7DQogICAgfQ0KDQogICAgY2xhaW1lZFtpbnZlc3Rvcl0gPSBjbGFpbWVkW2ludmVzdG9yXS5wbHVzKGFtb3VudCk7DQogICAgdG90YWxDbGFpbWVkID0gdG90YWxDbGFpbWVkLnBsdXMoYW1vdW50KTsNCiAgICBnZXRUb2tlbigpLnRyYW5zZmVyKGludmVzdG9yLCBhbW91bnQpOw0KDQogICAgRGlzdHJpYnV0ZWQoaW52ZXN0b3IsIGFtb3VudCk7DQogIH0NCg0KICAvKioNCiAgICogSUNPIG5ldmVyIGhhcHBlbmVkLiBBbGxvdyByZWZ1bmQuDQogICAqLw0KICBmdW5jdGlvbiByZWZ1bmQoKSB7DQoNCiAgICAvLyBUcnlpbmcgdG8gYXNrIHJlZnVuZCB0b28gc29vbg0KICAgIGlmKGdldFN0YXRlKCkgIT0gU3RhdGUuUmVmdW5kaW5nKSB0aHJvdzsNCg0KICAgIGFkZHJlc3MgaW52ZXN0b3IgPSBtc2cuc2VuZGVyOw0KICAgIGlmKGJhbGFuY2VzW2ludmVzdG9yXSA9PSAwKSB0aHJvdzsNCiAgICB1aW50IGFtb3VudCA9IGJhbGFuY2VzW2ludmVzdG9yXTsNCiAgICBkZWxldGUgYmFsYW5jZXNbaW52ZXN0b3JdOw0KICAgIGlmKCFpbnZlc3Rvci5zZW5kKGFtb3VudCkpIHRocm93Ow0KICAgIFJlZnVuZGVkKGludmVzdG9yLCBhbW91bnQpOw0KICB9DQoNCiAgLyoqDQogICAqIFNldCB0aGUgdGFyZ2V0IGNyb3dkc2FsZSB3aGVyZSB3ZSB3aWxsIG1vdmUgcHJlc2FsZSBmdW5kcyB3aGVuIHRoZSBjcm93ZHNhbGUgb3BlbnMuDQogICAqLw0KICBmdW5jdGlvbiBzZXRDcm93ZHNhbGUoQ3Jvd2RzYWxlIF9jcm93ZHNhbGUpIHB1YmxpYyBvbmx5T3duZXIgew0KICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7DQoNCiAgICAvLyBDaGNrIGludGVyZmFjZQ0KICAgIGlmKCFjcm93ZHNhbGUuaXNDcm93ZHNhbGUoKSkgdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBSZXNvbHZlIHRoZSBjb250cmFjdCB1bWFtYmlnaW91cyBzdGF0ZS4NCiAgICovDQogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIHJldHVybnMoU3RhdGUpIHsNCiAgICBpZih0b2tlbnNCb3VnaHQgPT0gMCkgew0KICAgICAgaWYobm93ID49IGZyZWV6ZUVuZHNBdCkgew0KICAgICAgICAgcmV0dXJuIFN0YXRlLlJlZnVuZGluZzsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBTdGF0ZS5GdW5kaW5nOw0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICByZXR1cm4gU3RhdGUuRGlzdHJpYnV0aW5nOw0KICAgIH0NCiAgfQ0KDQogIC8qKiBFeHBsaWNpdGx5IGNhbGwgZnVuY3Rpb24gZnJvbSB5b3VyIHdhbGxldC4gKi8NCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsNCiAgICB0aHJvdzsNCiAgfQ0KfQ=='