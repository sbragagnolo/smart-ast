base 64 content
base64presaleFundCollector7
	^'LyoqDQogKiBTYWZlIHVuc2lnbmVkIHNhZmUgbWF0aC4NCiAqDQogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQ0KICoNCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQXJhZ29uT25lL3plcHBlbGluLXNvbGlkaXR5L21hc3Rlci9jb250cmFjdHMvU2FmZU1hdGhMaWIuc29sDQogKg0KICogTWFpbnRhaW5lZCBoZXJlIHVudGlsIG1lcmdlZCB0byBtYWlubGluZSB6ZXBwZWxpbi1zb2xpZGl0eS4NCiAqDQogKi8NCmxpYnJhcnkgU2FmZU1hdGhMaWIgew0KDQogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gcGx1cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjPj1hICYmIGM+PWIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBwcml2YXRlIHsNCiAgICBpZiAoIWFzc2VydGlvbikgdGhyb3c7DQogIH0NCn0NCg0KDQoNCg0KLyoNCiAqIE93bmFibGUNCiAqDQogKiBCYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIuDQogKiBQcm92aWRlcyBvbmx5T3duZXIgbW9kaWZpZXIsIHdoaWNoIHByZXZlbnRzIGZ1bmN0aW9uIGZyb20gcnVubmluZyBpZiBpdCBpcyBjYWxsZWQgYnkgYW55b25lIG90aGVyIHRoYW4gdGhlIG93bmVyLg0KICovDQpjb250cmFjdCBPd25hYmxlIHsNCiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsNCiAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogIH0NCg0KICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICBfOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsNCiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgew0KICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICB9DQogIH0NCg0KfQ0KDQoNCi8qDQogKiBIYWx0YWJsZQ0KICoNCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbg0KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLg0KICoNCiAqDQogKiBPcmlnaW5hbGx5IGVudmlzaW9uZWQgaW4gRmlyc3RCbG9vZCBJQ08gY29udHJhY3QuDQogKi8NCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgew0KICBib29sIHB1YmxpYyBoYWx0ZWQ7DQoNCiAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsNCiAgICBpZiAoaGFsdGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsNCiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlDQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgew0KICAgIGhhbHRlZCA9IHRydWU7DQogIH0NCg0KICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlDQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgew0KICAgIGhhbHRlZCA9IGZhbHNlOw0KICB9DQoNCn0NCg0KDQovKioNCiAqIEludGVyZmFjZSBmb3IgZGVmaW5pbmcgY3Jvd2RzYWxlIHByaWNpbmcuDQogKi8NCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7DQoNCiAgLyoqIEludGVyZmFjZSBkZWNsYXJhdGlvbi4gKi8NCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFNlbGYgY2hlY2sgaWYgYWxsIHJlZmVyZW5jZXMgYXJlIGNvcnJlY3RseSBzZXQuDQogICAqDQogICAqIENoZWNrcyB0aGF0IHByaWNpbmcgc3RyYXRlZ3kgbWF0Y2hlcyBjcm93ZHNhbGUgcGFyYW1ldGVycy4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIGNyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0Lg0KICAgKg0KICAgKg0KICAgKiBAcGFyYW0gdmFsdWUgLSBXaGF0IGlzIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VuZCBpbiBhcyB3ZWkNCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXINCiAgICogQHBhcmFtIHdlaVJhaXNlZCAtIGhvdyBtdWNoIG1vbmV5IGhhcyBiZWVuIHJhaXNlZCB0aGlzIGZhcg0KICAgKiBAcGFyYW0gbXNnU2VuZGVyIC0gd2hvIGlzIHRoZSBpbnZlc3RvciBvZiB0aGlzIHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcw0KICAgKiBAcmV0dXJuIEFtb3VudCBvZiB0b2tlbnMgdGhlIGludmVzdG9yIHJlY2VpdmVzDQogICAqLw0KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHRva2Vuc1NvbGQsIHVpbnQgd2VpUmFpc2VkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOw0KfQ0KDQoNCi8qKg0KICogRmluYWxpemUgYWdlbnQgZGVmaW5lcyB3aGF0IGhhcHBlbnMgYXQgdGhlIGVuZCBvZiBzdWNjZXNlZnVsIGNyb3dkc2FsZS4NCiAqDQogKiAtIEFsbG9jYXRlIHRva2VucyBmb3IgZm91bmRlcnMsIGJvdW50aWVzIGFuZCBjb21tdW5pdHkNCiAqIC0gTWFrZSB0b2tlbnMgdHJhbnNmZXJhYmxlDQogKiAtIGV0Yy4NCiAqLw0KY29udHJhY3QgRmluYWxpemVBZ2VudCB7DQoNCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFJldHVybiB0cnVlIGlmIHdlIGNhbiBydW4gZmluYWxpemVDcm93ZHNhbGUoKSBwcm9wZXJseS4NCiAgICoNCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luDQogICAqIHVubGVzcyB0aGUgZmluYWxpemVyIGhhcyBiZWVuIHNldCB1cCBwcm9wZXJseS4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsNCg0KICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovDQogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7DQoNCn0NCg0KDQoNCg0KLyoNCiAqIEVSQzIwIGludGVyZmFjZQ0KICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMCB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCg0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQoNCi8qKg0KICogQSB0b2tlbiB0aGF0IGRlZmluZXMgZnJhY3Rpb25hbCB1bml0cyBhcyBkZWNpbWFscy4NCiAqLw0KY29udHJhY3QgRnJhY3Rpb25hbEVSQzIwIGlzIEVSQzIwIHsNCg0KICB1aW50IHB1YmxpYyBkZWNpbWFsczsNCg0KfQ0KDQoNCg0KLyoqDQogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcy4NCiAqDQogKiBIYW5kbGUNCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcw0KICogLSBhY2NlcHRpbmcgaW52ZXN0bWVudHMNCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZA0KICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQNCiAqIC0gZGlmZmVyZW50IHByaWNpbmcgc3RyYXRlZ2llcw0KICoNCiAqLw0KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIEhhbHRhYmxlIHsNCg0KICB1c2luZyBTYWZlTWF0aExpYiBmb3IgdWludDsNCg0KICAvKiBUaGUgdG9rZW4gd2UgYXJlIHNlbGxpbmcgKi8NCiAgRnJhY3Rpb25hbEVSQzIwIHB1YmxpYyB0b2tlbjsNCg0KICAvKiBIb3cgd2UgYXJlIGdvaW5nIHRvIHByaWNlIG91ciBvZmZlcmluZyAqLw0KICBQcmljaW5nU3RyYXRlZ3kgcHVibGljIHByaWNpbmdTdHJhdGVneTsNCg0KICAvKiBQb3N0LXN1Y2Nlc3MgY2FsbGJhY2sgKi8NCiAgRmluYWxpemVBZ2VudCBwdWJsaWMgZmluYWxpemVBZ2VudDsNCg0KICAvKiB0b2tlbnMgd2lsbCBiZSB0cmFuc2ZlcmVkIGZyb20gdGhpcyBhZGRyZXNzICovDQogIGFkZHJlc3MgcHVibGljIG11bHRpc2lnV2FsbGV0Ow0KDQogIC8qIGlmIHRoZSBmdW5kaW5nIGdvYWwgaXMgbm90IHJlYWNoZWQsIGludmVzdG9ycyBtYXkgd2l0aGRyYXcgdGhlaXIgZnVuZHMgKi8NCiAgdWludCBwdWJsaWMgbWluaW11bUZ1bmRpbmdHb2FsOw0KDQogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBzdGFydCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8NCiAgdWludCBwdWJsaWMgc3RhcnRzQXQ7DQoNCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIGVuZCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8NCiAgdWludCBwdWJsaWMgZW5kc0F0Ow0KDQogIC8qIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFscmVhZHkgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QqLw0KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsNCg0KICAvKiBIb3cgbWFueSB3ZWkgb2YgZnVuZGluZyB3ZSBoYXZlIHJhaXNlZCAqLw0KICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQgPSAwOw0KDQogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovDQogIHVpbnQgcHVibGljIGludmVzdG9yQ291bnQgPSAwOw0KDQogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIHJldHVybmVkIGJhY2sgdG8gdGhlIGNvbnRyYWN0IGFmdGVyIGEgZmFpbGVkIGNyb3dkZnVuZC4gKi8NCiAgdWludCBwdWJsaWMgbG9hZGVkUmVmdW5kID0gMDsNCg0KICAvKiBIb3cgbXVjaCB3ZWkgd2UgaGF2ZSBnaXZlbiBiYWNrIHRvIGludmVzdG9ycy4qLw0KICB1aW50IHB1YmxpYyB3ZWlSZWZ1bmRlZCA9IDA7DQoNCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovDQogIGJvb2wgcHVibGljIGZpbmFsaXplZDsNCg0KICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaW52ZXN0ZWRBbW91bnRPZjsNCg0KICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2VuQW1vdW50T2Y7DQoNCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVsIHRlc3RpbmcgZm9yIHRoZSBpbnRlcmFjdGlvbiBmcm9tIG93bmVyIHdhbGxldC4gWW91IGNhbiBzZXQgaXQgdG8gYW55IHZhbHVlIGFuZCBpbnNwZWN0IHRoaXMgaW4gYmxvY2tjaGFpbiBleHBsb3JlciB0byBzZWUgdGhhdCBjcm93ZHNhbGUgaW50ZXJhY3Rpb24gd29ya3MuICovDQogIHVpbnQgcHVibGljIG93bmVyVGVzdFZhbHVlOw0KDQogIC8qKiBTdGF0ZSBtYWNoaW5lDQogICAqDQogICAqIC0gUHJlcGFyaW5nOiBBbGwgY29udHJhY3QgaW5pdGlhbGl6YXRpb24gY2FsbHMgYW5kIHZhcmlhYmxlcyBoYXZlIG5vdCBiZWVuIHNldCB5ZXQNCiAgICogLSBQcmVmdW5kaW5nOiBXZSBoYXZlIG5vdCBwYXNzZWQgc3RhcnQgdGltZSB5ZXQNCiAgICogLSBGdW5kaW5nOiBBY3RpdmUgY3Jvd2RzYWxlDQogICAqIC0gU3VjY2VzczogTWluaW11bSBmdW5kaW5nIGdvYWwgcmVhY2hlZA0KICAgKiAtIEZhaWx1cmU6IE1pbmltdW0gZnVuZGluZyBnb2FsIG5vdCByZWFjaGVkIGJlZm9yZSBlbmRpbmcgdGltZQ0KICAgKiAtIEZpbmFsaXplZDogVGhlIGZpbmFsaXplZCBoYXMgYmVlbiBjYWxsZWQgYW5kIHN1Y2Nlc2Z1bGx5IGV4ZWN1dGVkDQogICAqIC0gUmVmdW5kaW5nOiBSZWZ1bmRzIGFyZSBsb2FkZWQgb24gdGhlIGNvbnRyYWN0IGZvciByZWNsYWltLg0KICAgKi8NCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQcmVwYXJpbmcsIFByZUZ1bmRpbmcsIEZ1bmRpbmcsIFN1Y2Nlc3MsIEZhaWx1cmUsIEZpbmFsaXplZCwgUmVmdW5kaW5nfQ0KDQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50KTsNCiAgZXZlbnQgUmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50KTsNCg0KICBmdW5jdGlvbiBDcm93ZHNhbGUoYWRkcmVzcyBfdG9rZW4sIFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5LCBhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwgdWludCBfc3RhcnQsIHVpbnQgX2VuZCwgdWludCBfbWluaW11bUZ1bmRpbmdHb2FsKSB7DQoNCiAgICBvd25lciA9IG1zZy5zZW5kZXI7DQoNCiAgICB0b2tlbiA9IEZyYWN0aW9uYWxFUkMyMChfdG9rZW4pOw0KDQogICAgc2V0UHJpY2luZ1N0cmF0ZWd5KF9wcmljaW5nU3RyYXRlZ3kpOw0KDQogICAgbXVsdGlzaWdXYWxsZXQgPSBfbXVsdGlzaWdXYWxsZXQ7DQogICAgaWYobXVsdGlzaWdXYWxsZXQgPT0gMCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZihfc3RhcnQgPT0gMCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBzdGFydHNBdCA9IF9zdGFydDsNCg0KICAgIGlmKF9lbmQgPT0gMCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBlbmRzQXQgPSBfZW5kOw0KDQogICAgLy8gRG9uJ3QgbWVzcyB0aGUgZGF0ZXMNCiAgICBpZihzdGFydHNBdCA+PSBlbmRzQXQpIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gTWluaW11bSBmdW5kaW5nIGdvYWwgY2FuIGJlIHplcm8NCiAgICBtaW5pbXVtRnVuZGluZ0dvYWwgPSBfbWluaW11bUZ1bmRpbmdHb2FsOw0KICB9DQoNCiAgLyoqDQogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbigpIHBheWFibGUgew0KICAgIHRocm93Ow0KICB9DQoNCiAgLyoqDQogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4NCiAgICoNCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4NCiAgICogV2UgbXVzdCBoYXZlIG5vdCBwcmVzc2VkIHRoZSBlbWVyZ2VuY3kgYnJha2UuDQogICAqDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyByZWNlaXZlcikgaW5TdGF0ZShTdGF0ZS5GdW5kaW5nKSBzdG9wSW5FbWVyZ2VuY3kgcGF5YWJsZSBwdWJsaWMgew0KDQogICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7DQogICAgdWludCB0b2tlbkFtb3VudCA9IHByaWNpbmdTdHJhdGVneS5jYWxjdWxhdGVQcmljZSh3ZWlBbW91bnQsIHdlaVJhaXNlZCwgdG9rZW5zU29sZCwgbXNnLnNlbmRlciwgdG9rZW4uZGVjaW1hbHMoKSk7DQoNCiAgICBpZih0b2tlbkFtb3VudCA9PSAwKSB7DQogICAgICAvLyBEdXN0IHRyYW5zYWN0aW9uDQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZihpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9PSAwKSB7DQogICAgICAgLy8gQSBuZXcgaW52ZXN0b3INCiAgICAgICBpbnZlc3RvckNvdW50Kys7DQogICAgfQ0KDQogICAgLy8gVXBkYXRlIGludmVzdG9yDQogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHdlaUFtb3VudCk7DQogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsNCg0KICAgIC8vIFVwZGF0ZSB0b3RhbHMNCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOw0KICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLnBsdXModG9rZW5BbW91bnQpOw0KDQogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcA0KICAgIGlmKGlzQnJlYWtpbmdDYXAodG9rZW5BbW91bnQsIHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5DQogICAgaWYoIW11bHRpc2lnV2FsbGV0LnNlbmQod2VpQW1vdW50KSkgdGhyb3c7DQoNCiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2Vzcw0KICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50KTsNCiAgfQ0KDQogIC8qKg0KICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLg0KICAgKg0KICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuDQogICAqLw0KICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaW52ZXN0KG1zZy5zZW5kZXIpOw0KICB9DQoNCiAgLyoqDQogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuDQogICAqDQogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7DQoNCiAgICAvLyBBbHJlYWR5IGZpbmFsaXplZA0KICAgIGlmKGZpbmFsaXplZCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gRmluYWxpemluZyBpcyBvcHRpb25hbC4gV2Ugb25seSBjYWxsIGl0IGlmIHdlIGFyZSBnaXZlbiBhIGZpbmFsaXppbmcgYWdlbnQuDQogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSAwKSB7DQogICAgICBmaW5hbGl6ZUFnZW50LmZpbmFsaXplQ3Jvd2RzYWxlKCk7DQogICAgfQ0KDQogICAgZmluYWxpemVkID0gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byAocmUpc2V0IGZpbmFsaXplIGFnZW50Lg0KICAgKg0KICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gc2V0dGluZyB0aGlzLCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4NCiAgICovDQogIGZ1bmN0aW9uIHNldEZpbmFsaXplQWdlbnQoRmluYWxpemVBZ2VudCBhZGRyKSBvbmx5T3duZXIgew0KICAgIGZpbmFsaXplQWdlbnQgPSBhZGRyOw0KDQogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQNCiAgICBpZighZmluYWxpemVBZ2VudC5pc0ZpbmFsaXplQWdlbnQoKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IHRvIChyZSlzZXQgcHJpY2luZyBzdHJhdGVneS4NCiAgICoNCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHRoZSBzZXQsIHNvIHRoYXQgd2UgY2FuIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0UHJpY2luZ1N0cmF0ZWd5KFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5KSBvbmx5T3duZXIgew0KICAgIHByaWNpbmdTdHJhdGVneSA9IF9wcmljaW5nU3RyYXRlZ3k7DQoNCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudA0KICAgIGlmKCFwcmljaW5nU3RyYXRlZ3kuaXNQcmljaW5nU3RyYXRlZ3koKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGxvYWQgcmVmdW5kcyBiYWNrIG9uIHRoZSBjb250cmFjdCBmb3IgdGhlIHJlZnVuZGluZy4NCiAgICoNCiAgICogVGhlIHRlYW0gY2FuIHRyYW5zZmVyIHRoZSBmdW5kcyBiYWNrIG9uIHRoZSBzbWFydCBjb250cmFjdCBpbiB0aGUgY2FzZSB0aGUgbWluaW11bSBnb2FsIHdhcyBub3QgcmVhY2hlZC4uDQogICAqLw0KICBmdW5jdGlvbiBsb2FkUmVmdW5kKCkgcHVibGljIHBheWFibGUgaW5TdGF0ZShTdGF0ZS5GYWlsdXJlKSB7DQogICAgaWYobXNnLnZhbHVlID09IDApIHRocm93Ow0KICAgIGxvYWRlZFJlZnVuZCA9IGxvYWRlZFJlZnVuZC5wbHVzKG1zZy52YWx1ZSk7DQogIH0NCg0KICAvKioNCiAgICogSW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmQuDQogICAqLw0KICBmdW5jdGlvbiByZWZ1bmQoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5SZWZ1bmRpbmcpIHsNCiAgICB1aW50MjU2IHdlaVZhbHVlID0gaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXTsNCiAgICBpZiAod2VpVmFsdWUgPT0gMCkgdGhyb3c7DQogICAgaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXSA9IDA7DQogICAgd2VpUmVmdW5kZWQgPSB3ZWlSZWZ1bmRlZC5wbHVzKHdlaVZhbHVlKTsNCiAgICBSZWZ1bmQobXNnLnNlbmRlciwgd2VpVmFsdWUpOw0KICAgIGlmICghbXNnLnNlbmRlci5zZW5kKHdlaVZhbHVlKSkgdGhyb3c7DQogIH0NCg0KICAvKioNCiAgICogQHJldHVybiB0cnVlIGlmIHRoZSBjcm93ZHNhbGUgaGFzIHJhaXNlZCBlbm91Z2ggbW9uZXkgdG8gYmUgYSBzdWNjZXMNCiAgICovDQogIGZ1bmN0aW9uIGlzTWluaW11bUdvYWxSZWFjaGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmVhY2hlZCkgew0KICAgIHJldHVybiB3ZWlSYWlzZWQgPj0gbWluaW11bUZ1bmRpbmdHb2FsOw0KICB9DQoNCiAgLyoqDQogICAqIENyb3dkZnVuZCBzdGF0ZSBtYWNoaW5lIG1hbmFnZW1lbnQuDQogICAqDQogICAqIFdlIG1ha2UgaXQgYSBmdW5jdGlvbiBhbmQgZG8gbm90IGFzc2lnbiB0aGUgcmVzdWx0IHRvIGEgdmFyaWFibGUsIHNvIHRoZXJlIGlzIG5vIGNoYW5jZSBvZiB0aGUgdmFyaWFibGUgYmVpbmcgc3RhbGUuDQogICAqLw0KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgew0KICAgIGlmKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsNCiAgICBlbHNlIGlmIChhZGRyZXNzKGZpbmFsaXplQWdlbnQpID09IDApIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7DQogICAgZWxzZSBpZiAoIWZpbmFsaXplQWdlbnQuaXNTYW5lKCkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7DQogICAgZWxzZSBpZiAoIXByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7DQogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDwgc3RhcnRzQXQpIHJldHVybiBTdGF0ZS5QcmVGdW5kaW5nOw0KICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsNCiAgICBlbHNlIGlmIChpc01pbmltdW1Hb2FsUmVhY2hlZCgpKSByZXR1cm4gU3RhdGUuU3VjY2VzczsNCiAgICBlbHNlIGlmICghaXNNaW5pbXVtR29hbFJlYWNoZWQoKSAmJiB3ZWlSYWlzZWQgPiAwICYmIGxvYWRlZFJlZnVuZCA+PSB3ZWlSYWlzZWQpIHJldHVybiBTdGF0ZS5SZWZ1bmRpbmc7DQogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsNCiAgfQ0KDQogIC8qKiBUaGlzIGlzIGZvciBtYW51YWwgdGVzdGluZyBvZiBtdWx0aXNpZyB3YWxsZXQgaW50ZXJhY3Rpb24gKi8NCiAgZnVuY3Rpb24gc2V0T3duZXJUZXN0VmFsdWUodWludCB2YWwpIG9ubHlPd25lciB7DQogICAgb3duZXJUZXN0VmFsdWUgPSB2YWw7DQogIH0NCg0KICAvLw0KICAvLyBNb2RpZmllcnMNCiAgLy8NCg0KICAvKiogTW9kaWZpZWQgYWxsb3dpbmcgZXhlY3V0aW9uIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgcnVubmluZy4gICovDQogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsNCiAgICBpZihnZXRTdGF0ZSgpICE9IHN0YXRlKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCg0KICAvLw0KICAvLyBBYnN0cmFjdCBmdW5jdGlvbnMNCiAgLy8NCg0KICAvKioNCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgaW52ZXN0ZWQgYnJlYWtzIG91ciBjYXAgcnVsZXMuDQogICAqDQogICAqDQogICAqIFRoZSBjaGlsZCBjb250cmFjdCBtdXN0IGRlZmluZSB0aGVpciBvd24gY2FwIHNldHRpbmcgcnVsZXMuDQogICAqIFdlIGFsbG93IGEgbG90IG9mIGZsZXhpYmlsaXR5IHRocm91Z2ggZGlmZmVyZW50IGNhcHBpbmcgc3RyYXRlZ2llcyAoRVRILCB0b2tlbiBjb3VudCkNCiAgICogQ2FsbGVkIGZyb20gaW52ZXN0KCkuDQogICAqDQogICAqIEBwYXJhbSB3ZWlBbW91bnQgVGhlIGFtb3VudCBvZiB3ZWkgdGhlIGludmVzdG9yIHRyaWVzIHRvIGludmVzdCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gdG9rZW5BbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgd2UgdHJ5IHRvIGdpdmUgdG8gdGhlIGludmVzdG9yIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSB3ZWlSYWlzZWRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCByYWlzZWQgYmFsYW5jZSBhZnRlciB0aGlzIHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSB0b2tlbnNTb2xkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgc29sZCB0b2tlbnMgY291bnQgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbg0KICAgKg0KICAgKiBAcmV0dXJuIHRydWUgaWYgdGFraW5nIHRoaXMgaW52ZXN0bWVudCB3b3VsZCBicmVhayBvdXIgY2FwIHJ1bGVzDQogICAqLw0KICBmdW5jdGlvbiBpc0JyZWFraW5nQ2FwKHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50IHdlaVJhaXNlZFRvdGFsLCB1aW50IHRva2Vuc1NvbGRUb3RhbCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBsaW1pdEJyb2tlbik7DQoNCiAgLyoqDQogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGNyb3dkc2FsZSBpcyBmdWxsIGFuZCB3ZSBjYW4gbm8gbG9uZ2VyIHNlbGwgYW55IHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsNCg0KICAvKioNCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgb3IgdHJhbnNmZXIgaXNzdWVkIHRva2VucyB0byB0aGUgaW52ZXN0b3IgZGVwZW5kaW5nIG9uIHRoZSBjYXAgbW9kZWwuDQogICAqLw0KICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgcHJpdmF0ZTsNCn0NCg0KDQoNCi8qKg0KICogQ29sbGVjdCBmdW5kcyBmcm9tIHByZXNhbGUgaW52ZXN0b3JzIHRvIGJlIHNlbmQgdG8gdGhlIGNyb3dkc2FsZSBzbWFydCBjb250cmFjdCBsYXRlci4NCiAqDQogKiAtIENvbGxlY3QgZnVuZHMgZnJvbSBwcmUtc2FsZSBpbnZlc3RvcnMNCiAqIC0gU2VuZCBmdW5kcyB0byB0aGUgY3Jvd2RzYWxlIHdoZW4gaXQgb3BlbnMNCiAqIC0gQWxsb3cgb3duZXIgdG8gc2V0IHRoZSBjcm93ZHNhbGUNCiAqIC0gSGF2ZSByZWZ1bmQgYWZ0ZXIgWCBkYXlzIGFzIGEgc2FmZXR5IGhhdGNoIGlmIHRoZSBjcm93ZHNhbGUgZG9lc24ndCBtYXRlcmlsaXplDQogKg0KICovDQpjb250cmFjdCBQcmVzYWxlRnVuZENvbGxlY3RvciBpcyBPd25hYmxlIHsNCg0KICB1c2luZyBTYWZlTWF0aExpYiBmb3IgdWludDsNCg0KICAvKiogSG93IG1hbnkgaW52ZXN0b3JzIHdoZW4gY2FuIGNhcnJ5IHBlciBhIHNpbmdsZSBjb250cmFjdCAqLw0KICB1aW50IHB1YmxpYyBNQVhfSU5WRVNUT1JTID0gMzI7DQoNCiAgLyoqIEhvdyBtYW55IGludmVzdG9ycyB3ZSBoYXZlIG5vdyAqLw0KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50Ow0KDQogIC8qKiBXaG8gYXJlIG91ciBpbnZlc3RvcnMgKGl0ZXJhYmxlKSAqLw0KICBhZGRyZXNzW10gcHVibGljIGludmVzdG9yczsNCg0KICAvKiogSG93IG11Y2ggdGhleSBoYXZlIGludmVzdGVkICovDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgYmFsYW5jZXM7DQoNCiAgLyoqIFdoZW4gb3VyIHJlZnVuZCBmcmVlemUgaXMgb3ZlciAoVU5JVCB0aW1lc3RhbXApICovDQogIHVpbnQgcHVibGljIGZyZWV6ZUVuZHNBdDsNCg0KICAvKiogV2hhdCBpcyB0aGUgbWluaW11bSBidXkgaW4gKi8NCiAgdWludCBwdWJsaWMgd2VpTWluaW11bUxpbWl0Ow0KDQogIC8qKiBIYXZlIHdlIGJlZ3VuIHRvIG1vdmUgZnVuZHMgKi8NCiAgYm9vbCBwdWJsaWMgbW92aW5nOw0KDQogIC8qKiBPdXIgSUNPIGNvbnRyYWN0IHdoZXJlIHdlIHdpbGwgbW92ZSB0aGUgZnVuZHMgKi8NCiAgQ3Jvd2RzYWxlIHB1YmxpYyBjcm93ZHNhbGU7DQoNCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB2YWx1ZSk7DQogIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgdmFsdWUpOw0KDQogIC8qKg0KICAgKiBDcmVhdGUgcHJlc2FsZSBjb250cmFjdCB3aGVyZSBsb2NrIHVwIHBlcmlvZCBpcyBnaXZlbiBkYXlzDQogICAqLw0KICBmdW5jdGlvbiBQcmVzYWxlRnVuZENvbGxlY3RvcihhZGRyZXNzIF9vd25lciwgdWludCBfZnJlZXplRW5kc0F0LCB1aW50IF93ZWlNaW5pbXVtTGltaXQpIHsNCg0KICAgIG93bmVyID0gX293bmVyOw0KDQogICAgLy8gR2l2ZSBhcmd1bWVudA0KICAgIGlmKF9mcmVlemVFbmRzQXQgPT0gMCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gR2l2ZSBhcmd1bWVudA0KICAgIGlmKF93ZWlNaW5pbXVtTGltaXQgPT0gMCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgd2VpTWluaW11bUxpbWl0ID0gX3dlaU1pbmltdW1MaW1pdDsNCiAgICBmcmVlemVFbmRzQXQgPSBfZnJlZXplRW5kc0F0Ow0KICB9DQoNCiAgLyoqDQogICAqIFBhcnRpY2lwYXRlIHRvIGEgcHJlc2FsZS4NCiAgICovDQogIGZ1bmN0aW9uIGludmVzdCgpIHB1YmxpYyBwYXlhYmxlIHsNCg0KICAgIC8vIENhbm5vdCBpbnZlc3QgYW55bW9yZSB0aHJvdWdoIGNyb3dkc2FsZSB3aGVuIG1vdmluZyBoYXMgYmVndW4NCiAgICBpZihtb3ZpbmcpIHRocm93Ow0KDQogICAgYWRkcmVzcyBpbnZlc3RvciA9IG1zZy5zZW5kZXI7DQoNCiAgICBib29sIGV4aXN0aW5nID0gYmFsYW5jZXNbaW52ZXN0b3JdID4gMDsNCg0KICAgIGJhbGFuY2VzW2ludmVzdG9yXSA9IGJhbGFuY2VzW2ludmVzdG9yXS5wbHVzKG1zZy52YWx1ZSk7DQoNCiAgICAvLyBOZWVkIHRvIGZ1bGZpbGwgbWluaW11bSBsaW1pdA0KICAgIGlmKGJhbGFuY2VzW2ludmVzdG9yXSA8IHdlaU1pbmltdW1MaW1pdCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gVGhpcyBpcyBhIG5ldyBpbnZlc3Rvcg0KICAgIGlmKCFleGlzdGluZykgew0KDQogICAgICAvLyBMaW1pdCBudW1iZXIgb2YgaW52ZXN0b3JzIHRvIHByZXZlbnQgdG9vIGxvbmcgbG9vcHMNCiAgICAgIGlmKGludmVzdG9yQ291bnQgPj0gTUFYX0lOVkVTVE9SUykgdGhyb3c7DQoNCiAgICAgIGludmVzdG9ycy5wdXNoKGludmVzdG9yKTsNCiAgICAgIGludmVzdG9yQ291bnQrKzsNCiAgICB9DQoNCiAgICBJbnZlc3RlZChpbnZlc3RvciwgbXNnLnZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBMb2FkIGZ1bmRzIHRvIHRoZSBjcm93ZHNhbGUgZm9yIGEgc2luZ2xlIGludmVzdG9yLg0KICAgKi8NCiAgZnVuY3Rpb24gcGFyY2lwYXRlQ3Jvd2RzYWxlSW52ZXN0b3IoYWRkcmVzcyBpbnZlc3RvcikgcHVibGljIHsNCg0KICAgIC8vIENyb3dkc2FsZSBub3QgeWV0IHNldA0KICAgIGlmKGFkZHJlc3MoY3Jvd2RzYWxlKSA9PSAwKSB0aHJvdzsNCg0KICAgIG1vdmluZyA9IHRydWU7DQoNCiAgICBpZihiYWxhbmNlc1tpbnZlc3Rvcl0gPiAwKSB7DQogICAgICB1aW50IGFtb3VudCA9IGJhbGFuY2VzW2ludmVzdG9yXTsNCiAgICAgIGRlbGV0ZSBiYWxhbmNlc1tpbnZlc3Rvcl07DQogICAgICBjcm93ZHNhbGUuaW52ZXN0LnZhbHVlKGFtb3VudCkoaW52ZXN0b3IpOw0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBMb2FkIGZ1bmRzIHRvIHRoZSBjcm93ZHNhbGUgZm9yIGFsbCBpbnZlc3Rvci4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIHBhcmNpcGF0ZUNyb3dkc2FsZUFsbCgpIHB1YmxpYyB7DQoNCiAgICAvLyBXZSBtaWdodCBoaXQgYSBtYXggZ2FzIGxpbWl0IGluIHRoaXMgbG9vcCwNCiAgICAvLyBhbmQgaW4gdGhpcyBjYXNlIHlvdSBjYW4gc2ltcGx5IGNhbGwgcGFyY2lwYXRlQ3Jvd2RzYWxlSW52ZXN0b3IoKSBmb3IgYWxsIGludmVzdG9ycw0KICAgIGZvcih1aW50IGk9MDsgaTxpbnZlc3RvcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICBwYXJjaXBhdGVDcm93ZHNhbGVJbnZlc3RvcihpbnZlc3RvcnNbaV0pOw0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBJQ08gbmV2ZXIgaGFwcGVuZWQuIEFsbG93IHJlZnVuZC4NCiAgICovDQogIGZ1bmN0aW9uIHJlZnVuZCgpIHsNCg0KICAgIC8vIFRyeWluZyB0byBhc2sgcmVmdW5kIHRvbyBzb29uDQogICAgaWYobm93IDwgZnJlZXplRW5kc0F0KSB0aHJvdzsNCg0KICAgIC8vIFdlIGhhdmUgc3RhcnRlZCB0byBtb3ZlIGZ1bmRzDQogICAgbW92aW5nID0gdHJ1ZTsNCg0KICAgIGFkZHJlc3MgaW52ZXN0b3IgPSBtc2cuc2VuZGVyOw0KICAgIGlmKGJhbGFuY2VzW2ludmVzdG9yXSA9PSAwKSB0aHJvdzsNCiAgICB1aW50IGFtb3VudCA9IGJhbGFuY2VzW2ludmVzdG9yXTsNCiAgICBkZWxldGUgYmFsYW5jZXNbaW52ZXN0b3JdOw0KICAgIGlmKCFpbnZlc3Rvci5zZW5kKGFtb3VudCkpIHRocm93Ow0KICAgIFJlZnVuZGVkKGludmVzdG9yLCBhbW91bnQpOw0KICB9DQoNCiAgLyoqDQogICAqIFNldCB0aGUgdGFyZ2V0IGNyb3dkc2FsZSB3aGVyZSB3ZSB3aWxsIG1vdmUgcHJlc2FsZSBmdW5kcyB3aGVuIHRoZSBjcm93ZHNhbGUgb3BlbnMuDQogICAqLw0KICBmdW5jdGlvbiBzZXRDcm93ZHNhbGUoQ3Jvd2RzYWxlIF9jcm93ZHNhbGUpIHB1YmxpYyBvbmx5T3duZXIgew0KICAgICBjcm93ZHNhbGUgPSBfY3Jvd2RzYWxlOw0KICB9DQoNCiAgLyoqIEV4cGxpY2l0bHkgY2FsbCBmdW5jdGlvbiBmcm9tIHlvdXIgd2FsbGV0LiAqLw0KICBmdW5jdGlvbigpIHBheWFibGUgew0KICAgIHRocm93Ow0KICB9DQp9'