base 64 content
base64presaleFundCollector8
	^'LyoqDQogKiBTYWZlIHVuc2lnbmVkIHNhZmUgbWF0aC4NCiAqDQogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQ0KICoNCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQXJhZ29uT25lL3plcHBlbGluLXNvbGlkaXR5L21hc3Rlci9jb250cmFjdHMvU2FmZU1hdGhMaWIuc29sDQogKg0KICogTWFpbnRhaW5lZCBoZXJlIHVudGlsIG1lcmdlZCB0byBtYWlubGluZSB6ZXBwZWxpbi1zb2xpZGl0eS4NCiAqDQogKi8NCmxpYnJhcnkgU2FmZU1hdGhMaWIgew0KDQogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gcGx1cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjPj1hICYmIGM+PWIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBwcml2YXRlIHsNCiAgICBpZiAoIWFzc2VydGlvbikgdGhyb3c7DQogIH0NCn0NCg0KDQoNCg0KLyoNCiAqIE93bmFibGUNCiAqDQogKiBCYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIuDQogKiBQcm92aWRlcyBvbmx5T3duZXIgbW9kaWZpZXIsIHdoaWNoIHByZXZlbnRzIGZ1bmN0aW9uIGZyb20gcnVubmluZyBpZiBpdCBpcyBjYWxsZWQgYnkgYW55b25lIG90aGVyIHRoYW4gdGhlIG93bmVyLg0KICovDQpjb250cmFjdCBPd25hYmxlIHsNCiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQoNCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsNCiAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogIH0NCg0KICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgICBfOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsNCiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgew0KICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICB9DQogIH0NCg0KfQ0KDQoNCi8qDQogKiBIYWx0YWJsZQ0KICoNCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbg0KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLg0KICoNCiAqDQogKiBPcmlnaW5hbGx5IGVudmlzaW9uZWQgaW4gRmlyc3RCbG9vZCBJQ08gY29udHJhY3QuDQogKi8NCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgew0KICBib29sIHB1YmxpYyBoYWx0ZWQ7DQoNCiAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsNCiAgICBpZiAoaGFsdGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsNCiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlDQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgew0KICAgIGhhbHRlZCA9IHRydWU7DQogIH0NCg0KICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlDQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgew0KICAgIGhhbHRlZCA9IGZhbHNlOw0KICB9DQoNCn0NCg0KDQovKioNCiAqIEludGVyZmFjZSBmb3IgZGVmaW5pbmcgY3Jvd2RzYWxlIHByaWNpbmcuDQogKi8NCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7DQoNCiAgLyoqIEludGVyZmFjZSBkZWNsYXJhdGlvbi4gKi8NCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFNlbGYgY2hlY2sgaWYgYWxsIHJlZmVyZW5jZXMgYXJlIGNvcnJlY3RseSBzZXQuDQogICAqDQogICAqIENoZWNrcyB0aGF0IHByaWNpbmcgc3RyYXRlZ3kgbWF0Y2hlcyBjcm93ZHNhbGUgcGFyYW1ldGVycy4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIGNyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0Lg0KICAgKg0KICAgKg0KICAgKiBAcGFyYW0gdmFsdWUgLSBXaGF0IGlzIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VuZCBpbiBhcyB3ZWkNCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXINCiAgICogQHBhcmFtIHdlaVJhaXNlZCAtIGhvdyBtdWNoIG1vbmV5IGhhcyBiZWVuIHJhaXNlZCB0aGlzIGZhcg0KICAgKiBAcGFyYW0gbXNnU2VuZGVyIC0gd2hvIGlzIHRoZSBpbnZlc3RvciBvZiB0aGlzIHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcw0KICAgKiBAcmV0dXJuIEFtb3VudCBvZiB0b2tlbnMgdGhlIGludmVzdG9yIHJlY2VpdmVzDQogICAqLw0KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHRva2Vuc1NvbGQsIHVpbnQgd2VpUmFpc2VkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOw0KfQ0KDQoNCi8qKg0KICogRmluYWxpemUgYWdlbnQgZGVmaW5lcyB3aGF0IGhhcHBlbnMgYXQgdGhlIGVuZCBvZiBzdWNjZXNlZnVsIGNyb3dkc2FsZS4NCiAqDQogKiAtIEFsbG9jYXRlIHRva2VucyBmb3IgZm91bmRlcnMsIGJvdW50aWVzIGFuZCBjb21tdW5pdHkNCiAqIC0gTWFrZSB0b2tlbnMgdHJhbnNmZXJhYmxlDQogKiAtIGV0Yy4NCiAqLw0KY29udHJhY3QgRmluYWxpemVBZ2VudCB7DQoNCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFJldHVybiB0cnVlIGlmIHdlIGNhbiBydW4gZmluYWxpemVDcm93ZHNhbGUoKSBwcm9wZXJseS4NCiAgICoNCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luDQogICAqIHVubGVzcyB0aGUgZmluYWxpemVyIGhhcyBiZWVuIHNldCB1cCBwcm9wZXJseS4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsNCg0KICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovDQogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7DQoNCn0NCg0KDQoNCg0KLyoNCiAqIEVSQzIwIGludGVyZmFjZQ0KICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMCB7DQogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOw0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCg0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7DQogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQoNCi8qKg0KICogQSB0b2tlbiB0aGF0IGRlZmluZXMgZnJhY3Rpb25hbCB1bml0cyBhcyBkZWNpbWFscy4NCiAqLw0KY29udHJhY3QgRnJhY3Rpb25hbEVSQzIwIGlzIEVSQzIwIHsNCg0KICB1aW50IHB1YmxpYyBkZWNpbWFsczsNCg0KfQ0KDQoNCg0KLyoqDQogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcy4NCiAqDQogKiBIYW5kbGUNCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcw0KICogLSBhY2NlcHRpbmcgaW52ZXN0bWVudHMNCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZA0KICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQNCiAqIC0gZGlmZmVyZW50IHByaWNpbmcgc3RyYXRlZ2llcw0KICoNCiAqLw0KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIEhhbHRhYmxlIHsNCg0KICB1c2luZyBTYWZlTWF0aExpYiBmb3IgdWludDsNCg0KICAvKiBUaGUgdG9rZW4gd2UgYXJlIHNlbGxpbmcgKi8NCiAgRnJhY3Rpb25hbEVSQzIwIHB1YmxpYyB0b2tlbjsNCg0KICAvKiBIb3cgd2UgYXJlIGdvaW5nIHRvIHByaWNlIG91ciBvZmZlcmluZyAqLw0KICBQcmljaW5nU3RyYXRlZ3kgcHVibGljIHByaWNpbmdTdHJhdGVneTsNCg0KICAvKiBQb3N0LXN1Y2Nlc3MgY2FsbGJhY2sgKi8NCiAgRmluYWxpemVBZ2VudCBwdWJsaWMgZmluYWxpemVBZ2VudDsNCg0KICAvKiB0b2tlbnMgd2lsbCBiZSB0cmFuc2ZlcmVkIGZyb20gdGhpcyBhZGRyZXNzICovDQogIGFkZHJlc3MgcHVibGljIG11bHRpc2lnV2FsbGV0Ow0KDQogIC8qIGlmIHRoZSBmdW5kaW5nIGdvYWwgaXMgbm90IHJlYWNoZWQsIGludmVzdG9ycyBtYXkgd2l0aGRyYXcgdGhlaXIgZnVuZHMgKi8NCiAgdWludCBwdWJsaWMgbWluaW11bUZ1bmRpbmdHb2FsOw0KDQogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBzdGFydCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8NCiAgdWludCBwdWJsaWMgc3RhcnRzQXQ7DQoNCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIGVuZCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8NCiAgdWludCBwdWJsaWMgZW5kc0F0Ow0KDQogIC8qIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFscmVhZHkgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QqLw0KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsNCg0KICAvKiBIb3cgbWFueSB3ZWkgb2YgZnVuZGluZyB3ZSBoYXZlIHJhaXNlZCAqLw0KICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQgPSAwOw0KDQogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovDQogIHVpbnQgcHVibGljIGludmVzdG9yQ291bnQgPSAwOw0KDQogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIHJldHVybmVkIGJhY2sgdG8gdGhlIGNvbnRyYWN0IGFmdGVyIGEgZmFpbGVkIGNyb3dkZnVuZC4gKi8NCiAgdWludCBwdWJsaWMgbG9hZGVkUmVmdW5kID0gMDsNCg0KICAvKiBIb3cgbXVjaCB3ZWkgd2UgaGF2ZSBnaXZlbiBiYWNrIHRvIGludmVzdG9ycy4qLw0KICB1aW50IHB1YmxpYyB3ZWlSZWZ1bmRlZCA9IDA7DQoNCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovDQogIGJvb2wgcHVibGljIGZpbmFsaXplZDsNCg0KICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaW52ZXN0ZWRBbW91bnRPZjsNCg0KICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovDQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2VuQW1vdW50T2Y7DQoNCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVsIHRlc3RpbmcgZm9yIHRoZSBpbnRlcmFjdGlvbiBmcm9tIG93bmVyIHdhbGxldC4gWW91IGNhbiBzZXQgaXQgdG8gYW55IHZhbHVlIGFuZCBpbnNwZWN0IHRoaXMgaW4gYmxvY2tjaGFpbiBleHBsb3JlciB0byBzZWUgdGhhdCBjcm93ZHNhbGUgaW50ZXJhY3Rpb24gd29ya3MuICovDQogIHVpbnQgcHVibGljIG93bmVyVGVzdFZhbHVlOw0KDQogIC8qKiBTdGF0ZSBtYWNoaW5lDQogICAqDQogICAqIC0gUHJlcGFyaW5nOiBBbGwgY29udHJhY3QgaW5pdGlhbGl6YXRpb24gY2FsbHMgYW5kIHZhcmlhYmxlcyBoYXZlIG5vdCBiZWVuIHNldCB5ZXQNCiAgICogLSBQcmVmdW5kaW5nOiBXZSBoYXZlIG5vdCBwYXNzZWQgc3RhcnQgdGltZSB5ZXQNCiAgICogLSBGdW5kaW5nOiBBY3RpdmUgY3Jvd2RzYWxlDQogICAqIC0gU3VjY2VzczogTWluaW11bSBmdW5kaW5nIGdvYWwgcmVhY2hlZA0KICAgKiAtIEZhaWx1cmU6IE1pbmltdW0gZnVuZGluZyBnb2FsIG5vdCByZWFjaGVkIGJlZm9yZSBlbmRpbmcgdGltZQ0KICAgKiAtIEZpbmFsaXplZDogVGhlIGZpbmFsaXplZCBoYXMgYmVlbiBjYWxsZWQgYW5kIHN1Y2Nlc2Z1bGx5IGV4ZWN1dGVkDQogICAqIC0gUmVmdW5kaW5nOiBSZWZ1bmRzIGFyZSBsb2FkZWQgb24gdGhlIGNvbnRyYWN0IGZvciByZWNsYWltLg0KICAgKi8NCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQcmVwYXJpbmcsIFByZUZ1bmRpbmcsIEZ1bmRpbmcsIFN1Y2Nlc3MsIEZhaWx1cmUsIEZpbmFsaXplZCwgUmVmdW5kaW5nfQ0KDQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50KTsNCiAgZXZlbnQgUmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50KTsNCg0KICBmdW5jdGlvbiBDcm93ZHNhbGUoYWRkcmVzcyBfdG9rZW4sIFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5LCBhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwgdWludCBfc3RhcnQsIHVpbnQgX2VuZCwgdWludCBfbWluaW11bUZ1bmRpbmdHb2FsKSB7DQoNCiAgICBvd25lciA9IG1zZy5zZW5kZXI7DQoNCiAgICB0b2tlbiA9IEZyYWN0aW9uYWxFUkMyMChfdG9rZW4pOw0KDQogICAgc2V0UHJpY2luZ1N0cmF0ZWd5KF9wcmljaW5nU3RyYXRlZ3kpOw0KDQogICAgbXVsdGlzaWdXYWxsZXQgPSBfbXVsdGlzaWdXYWxsZXQ7DQogICAgaWYobXVsdGlzaWdXYWxsZXQgPT0gMCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZihfc3RhcnQgPT0gMCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBzdGFydHNBdCA9IF9zdGFydDsNCg0KICAgIGlmKF9lbmQgPT0gMCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBlbmRzQXQgPSBfZW5kOw0KDQogICAgLy8gRG9uJ3QgbWVzcyB0aGUgZGF0ZXMNCiAgICBpZihzdGFydHNBdCA+PSBlbmRzQXQpIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gTWluaW11bSBmdW5kaW5nIGdvYWwgY2FuIGJlIHplcm8NCiAgICBtaW5pbXVtRnVuZGluZ0dvYWwgPSBfbWluaW11bUZ1bmRpbmdHb2FsOw0KICB9DQoNCiAgLyoqDQogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbigpIHBheWFibGUgew0KICAgIHRocm93Ow0KICB9DQoNCiAgLyoqDQogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4NCiAgICoNCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4NCiAgICogV2UgbXVzdCBoYXZlIG5vdCBwcmVzc2VkIHRoZSBlbWVyZ2VuY3kgYnJha2UuDQogICAqDQogICAqDQogICAqLw0KICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyByZWNlaXZlcikgaW5TdGF0ZShTdGF0ZS5GdW5kaW5nKSBzdG9wSW5FbWVyZ2VuY3kgcGF5YWJsZSBwdWJsaWMgew0KDQogICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7DQogICAgdWludCB0b2tlbkFtb3VudCA9IHByaWNpbmdTdHJhdGVneS5jYWxjdWxhdGVQcmljZSh3ZWlBbW91bnQsIHdlaVJhaXNlZCwgdG9rZW5zU29sZCwgbXNnLnNlbmRlciwgdG9rZW4uZGVjaW1hbHMoKSk7DQoNCiAgICBpZih0b2tlbkFtb3VudCA9PSAwKSB7DQogICAgICAvLyBEdXN0IHRyYW5zYWN0aW9uDQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBpZihpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9PSAwKSB7DQogICAgICAgLy8gQSBuZXcgaW52ZXN0b3INCiAgICAgICBpbnZlc3RvckNvdW50Kys7DQogICAgfQ0KDQogICAgLy8gVXBkYXRlIGludmVzdG9yDQogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHdlaUFtb3VudCk7DQogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsNCg0KICAgIC8vIFVwZGF0ZSB0b3RhbHMNCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOw0KICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLnBsdXModG9rZW5BbW91bnQpOw0KDQogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcA0KICAgIGlmKGlzQnJlYWtpbmdDYXAodG9rZW5BbW91bnQsIHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5DQogICAgaWYoIW11bHRpc2lnV2FsbGV0LnNlbmQod2VpQW1vdW50KSkgdGhyb3c7DQoNCiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2Vzcw0KICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50KTsNCiAgfQ0KDQogIC8qKg0KICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLg0KICAgKg0KICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuDQogICAqLw0KICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7DQogICAgaW52ZXN0KG1zZy5zZW5kZXIpOw0KICB9DQoNCiAgLyoqDQogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuDQogICAqDQogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7DQoNCiAgICAvLyBBbHJlYWR5IGZpbmFsaXplZA0KICAgIGlmKGZpbmFsaXplZCkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLy8gRmluYWxpemluZyBpcyBvcHRpb25hbC4gV2Ugb25seSBjYWxsIGl0IGlmIHdlIGFyZSBnaXZlbiBhIGZpbmFsaXppbmcgYWdlbnQuDQogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSAwKSB7DQogICAgICBmaW5hbGl6ZUFnZW50LmZpbmFsaXplQ3Jvd2RzYWxlKCk7DQogICAgfQ0KDQogICAgZmluYWxpemVkID0gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byAocmUpc2V0IGZpbmFsaXplIGFnZW50Lg0KICAgKg0KICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gdGhlIHNldCwgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuDQogICAqLw0KICBmdW5jdGlvbiBzZXRGaW5hbGl6ZUFnZW50KEZpbmFsaXplQWdlbnQgYWRkcikgb25seU93bmVyIHsNCiAgICBmaW5hbGl6ZUFnZW50ID0gYWRkcjsNCg0KICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50DQogICAgaWYoIWZpbmFsaXplQWdlbnQuaXNGaW5hbGl6ZUFnZW50KCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuDQogICAqDQogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiB0aGUgc2V0LCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4NCiAgICovDQogIGZ1bmN0aW9uIHNldFByaWNpbmdTdHJhdGVneShQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSkgb25seU93bmVyIHsNCiAgICBwcmljaW5nU3RyYXRlZ3kgPSBfcHJpY2luZ1N0cmF0ZWd5Ow0KDQogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQNCiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQoNCg0KICAvKioNCiAgICogQWxsb3cgbG9hZCByZWZ1bmRzIGJhY2sgb24gdGhlIGNvbnRyYWN0IGZvciB0aGUgcmVmdW5kaW5nLg0KICAgKg0KICAgKiBUaGUgdGVhbSBjYW4gdHJhbnNmZXIgdGhlIGZ1bmRzIGJhY2sgb24gdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBjYXNlIHRoZSBtaW5pbXVtIGdvYWwgd2FzIG5vdCByZWFjaGVkLi4NCiAgICovDQogIGZ1bmN0aW9uIGxvYWRSZWZ1bmQoKSBwdWJsaWMgcGF5YWJsZSBpblN0YXRlKFN0YXRlLkZhaWx1cmUpIHsNCiAgICBpZihtc2cudmFsdWUgPT0gMCkgdGhyb3c7DQogICAgbG9hZGVkUmVmdW5kID0gbG9hZGVkUmVmdW5kLnBsdXMobXNnLnZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBJbnZlc3RvcnMgY2FuIGNsYWltIHJlZnVuZC4NCiAgICovDQogIGZ1bmN0aW9uIHJlZnVuZCgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlJlZnVuZGluZykgew0KICAgIHVpbnQyNTYgd2VpVmFsdWUgPSBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdOw0KICAgIGlmICh3ZWlWYWx1ZSA9PSAwKSB0aHJvdzsNCiAgICBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdID0gMDsNCiAgICB3ZWlSZWZ1bmRlZCA9IHdlaVJlZnVuZGVkLnBsdXMod2VpVmFsdWUpOw0KICAgIFJlZnVuZChtc2cuc2VuZGVyLCB3ZWlWYWx1ZSk7DQogICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQod2VpVmFsdWUpKSB0aHJvdzsNCiAgfQ0KDQogIC8qKg0KICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNyb3dkc2FsZSBoYXMgcmFpc2VkIGVub3VnaCBtb25leSB0byBiZSBhIHN1Y2Nlcw0KICAgKi8NCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZWFjaGVkKSB7DQogICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBtaW5pbXVtRnVuZGluZ0dvYWw7DQogIH0NCg0KICAvKioNCiAgICogQ3Jvd2RmdW5kIHN0YXRlIG1hY2hpbmUgbWFuYWdlbWVudC4NCiAgICoNCiAgICogV2UgbWFrZSBpdCBhIGZ1bmN0aW9uIGFuZCBkbyBub3QgYXNzaWduIHRoZSByZXN1bHQgdG8gYSB2YXJpYWJsZSwgc28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZS4NCiAgICovDQogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFN0YXRlKSB7DQogICAgaWYoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOw0KICAgIGVsc2UgaWYgKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgPT0gMCkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsNCiAgICBlbHNlIGlmICghZmluYWxpemVBZ2VudC5pc1NhbmUoKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsNCiAgICBlbHNlIGlmICghcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsNCiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPCBzdGFydHNBdCkgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7DQogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDw9IGVuZHNBdCAmJiAhaXNDcm93ZHNhbGVGdWxsKCkpIHJldHVybiBTdGF0ZS5GdW5kaW5nOw0KICAgIGVsc2UgaWYgKGlzTWluaW11bUdvYWxSZWFjaGVkKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOw0KICAgIGVsc2UgaWYgKCFpc01pbmltdW1Hb2FsUmVhY2hlZCgpICYmIHdlaVJhaXNlZCA+IDAgJiYgbG9hZGVkUmVmdW5kID49IHdlaVJhaXNlZCkgcmV0dXJuIFN0YXRlLlJlZnVuZGluZzsNCiAgICBlbHNlIHJldHVybiBTdGF0ZS5GYWlsdXJlOw0KICB9DQoNCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVhbCB0ZXN0aW5nIG9mIG11bHRpc2lnIHdhbGxldCBpbnRlcmFjdGlvbiAqLw0KICBmdW5jdGlvbiBzZXRPd25lclRlc3RWYWx1ZSh1aW50IHZhbCkgb25seU93bmVyIHsNCiAgICBvd25lclRlc3RWYWx1ZSA9IHZhbDsNCiAgfQ0KDQogIC8vDQogIC8vIE1vZGlmaWVycw0KICAvLw0KDQogIC8qKiBNb2RpZmllZCBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8NCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgew0KICAgIGlmKGdldFN0YXRlKCkgIT0gc3RhdGUpIHRocm93Ow0KICAgIF87DQogIH0NCg0KDQogIC8vDQogIC8vIEFic3RyYWN0IGZ1bmN0aW9ucw0KICAvLw0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBpbnZlc3RlZCBicmVha3Mgb3VyIGNhcCBydWxlcy4NCiAgICoNCiAgICoNCiAgICogVGhlIGNoaWxkIGNvbnRyYWN0IG11c3QgZGVmaW5lIHRoZWlyIG93biBjYXAgc2V0dGluZyBydWxlcy4NCiAgICogV2UgYWxsb3cgYSBsb3Qgb2YgZmxleGliaWxpdHkgdGhyb3VnaCBkaWZmZXJlbnQgY2FwcGluZyBzdHJhdGVnaWVzIChFVEgsIHRva2VuIGNvdW50KQ0KICAgKiBDYWxsZWQgZnJvbSBpbnZlc3QoKS4NCiAgICoNCiAgICogQHBhcmFtIHdlaUFtb3VudCBUaGUgYW1vdW50IG9mIHdlaSB0aGUgaW52ZXN0b3IgdHJpZXMgdG8gaW52ZXN0IGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB3ZSB0cnkgdG8gZ2l2ZSB0byB0aGUgaW52ZXN0b3IgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHdlaVJhaXNlZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHJhaXNlZCBiYWxhbmNlIGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHRva2Vuc1NvbGRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCBzb2xkIHRva2VucyBjb3VudCBhZnRlciB0aGlzIHRyYW5zYWN0aW9uDQogICAqDQogICAqIEByZXR1cm4gdHJ1ZSBpZiB0YWtpbmcgdGhpcyBpbnZlc3RtZW50IHdvdWxkIGJyZWFrIG91ciBjYXAgcnVsZXMNCiAgICovDQogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpUmFpc2VkVG90YWwsIHVpbnQgdG9rZW5zU29sZFRvdGFsKSBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKTsNCg0KICAvKioNCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIGZ1bGwgYW5kIHdlIGNhbiBubyBsb25nZXIgc2VsbCBhbnkgdG9rZW5zLg0KICAgKi8NCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGVGdWxsKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOw0KDQogIC8qKg0KICAgKiBDcmVhdGUgbmV3IHRva2VucyBvciB0cmFuc2ZlciBpc3N1ZWQgdG9rZW5zIHRvIHRoZSBpbnZlc3RvciBkZXBlbmRpbmcgb24gdGhlIGNhcCBtb2RlbC4NCiAgICovDQogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBwcml2YXRlOw0KfQ0KDQoNCg0KLyoqDQogKiBDb2xsZWN0IGZ1bmRzIGZyb20gcHJlc2FsZSBpbnZlc3RvcnMgdG8gYmUgc2VuZCB0byB0aGUgY3Jvd2RzYWxlIHNtYXJ0IGNvbnRyYWN0IGxhdGVyLg0KICoNCiAqIC0gQ29sbGVjdCBmdW5kcyBmcm9tIHByZS1zYWxlIGludmVzdG9ycw0KICogLSBTZW5kIGZ1bmRzIHRvIHRoZSBjcm93ZHNhbGUgd2hlbiBpdCBvcGVucw0KICogLSBBbGxvdyBvd25lciB0byBzZXQgdGhlIGNyb3dkc2FsZQ0KICogLSBIYXZlIHJlZnVuZCBhZnRlciBYIGRheXMgYXMgYSBzYWZldHkgaGF0Y2ggaWYgdGhlIGNyb3dkc2FsZSBkb2Vzbid0IG1hdGVyaWxpemUNCiAqDQogKi8NCmNvbnRyYWN0IFByZXNhbGVGdW5kQ29sbGVjdG9yIGlzIE93bmFibGUgew0KDQogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50Ow0KDQogIC8qKiBIb3cgbWFueSBpbnZlc3RvcnMgd2hlbiBjYW4gY2FycnkgcGVyIGEgc2luZ2xlIGNvbnRyYWN0ICovDQogIHVpbnQgcHVibGljIE1BWF9JTlZFU1RPUlMgPSAzMjsNCg0KICAvKiogSG93IG1hbnkgaW52ZXN0b3JzIHdlIGhhdmUgbm93ICovDQogIHVpbnQgcHVibGljIGludmVzdG9yQ291bnQ7DQoNCiAgLyoqIFdobyBhcmUgb3VyIGludmVzdG9ycyAoaXRlcmFibGUpICovDQogIGFkZHJlc3NbXSBwdWJsaWMgaW52ZXN0b3JzOw0KDQogIC8qKiBIb3cgbXVjaCB0aGV5IGhhdmUgaW52ZXN0ZWQgKi8NCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBiYWxhbmNlczsNCg0KICAvKiogV2hlbiBvdXIgcmVmdW5kIGZyZWV6ZSBpcyBvdmVyIChVTklUIHRpbWVzdGFtcCkgKi8NCiAgdWludCBwdWJsaWMgZnJlZXplRW5kc0F0Ow0KDQogIC8qKiBXaGF0IGlzIHRoZSBtaW5pbXVtIGJ1eSBpbiAqLw0KICB1aW50IHB1YmxpYyB3ZWlNaW5pbXVtTGltaXQ7DQoNCiAgLyoqIEhhdmUgd2UgYmVndW4gdG8gbW92ZSBmdW5kcyAqLw0KICBib29sIHB1YmxpYyBtb3Zpbmc7DQoNCiAgLyoqIE91ciBJQ08gY29udHJhY3Qgd2hlcmUgd2Ugd2lsbCBtb3ZlIHRoZSBmdW5kcyAqLw0KICBDcm93ZHNhbGUgcHVibGljIGNyb3dkc2FsZTsNCg0KICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHZhbHVlKTsNCiAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB2YWx1ZSk7DQoNCiAgLyoqDQogICAqIENyZWF0ZSBwcmVzYWxlIGNvbnRyYWN0IHdoZXJlIGxvY2sgdXAgcGVyaW9kIGlzIGdpdmVuIGRheXMNCiAgICovDQogIGZ1bmN0aW9uIFByZXNhbGVGdW5kQ29sbGVjdG9yKGFkZHJlc3MgX293bmVyLCB1aW50IF9mcmVlemVFbmRzQXQsIHVpbnQgX3dlaU1pbmltdW1MaW1pdCkgew0KDQogICAgb3duZXIgPSBfb3duZXI7DQoNCiAgICAvLyBHaXZlIGFyZ3VtZW50DQogICAgaWYoX2ZyZWV6ZUVuZHNBdCA9PSAwKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyBHaXZlIGFyZ3VtZW50DQogICAgaWYoX3dlaU1pbmltdW1MaW1pdCA9PSAwKSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICB3ZWlNaW5pbXVtTGltaXQgPSBfd2VpTWluaW11bUxpbWl0Ow0KICAgIGZyZWV6ZUVuZHNBdCA9IF9mcmVlemVFbmRzQXQ7DQogIH0NCg0KICAvKioNCiAgICogUGFydGljaXBhdGUgdG8gYSBwcmVzYWxlLg0KICAgKi8NCiAgZnVuY3Rpb24gaW52ZXN0KCkgcHVibGljIHBheWFibGUgew0KDQogICAgLy8gQ2Fubm90IGludmVzdCBhbnltb3JlIHRocm91Z2ggY3Jvd2RzYWxlIHdoZW4gbW92aW5nIGhhcyBiZWd1bg0KICAgIGlmKG1vdmluZykgdGhyb3c7DQoNCiAgICBhZGRyZXNzIGludmVzdG9yID0gbXNnLnNlbmRlcjsNCg0KICAgIGJvb2wgZXhpc3RpbmcgPSBiYWxhbmNlc1tpbnZlc3Rvcl0gPiAwOw0KDQogICAgYmFsYW5jZXNbaW52ZXN0b3JdID0gYmFsYW5jZXNbaW52ZXN0b3JdLnBsdXMobXNnLnZhbHVlKTsNCg0KICAgIC8vIE5lZWQgdG8gZnVsZmlsbCBtaW5pbXVtIGxpbWl0DQogICAgaWYoYmFsYW5jZXNbaW52ZXN0b3JdIDwgd2VpTWluaW11bUxpbWl0KSB7DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyBUaGlzIGlzIGEgbmV3IGludmVzdG9yDQogICAgaWYoIWV4aXN0aW5nKSB7DQoNCiAgICAgIC8vIExpbWl0IG51bWJlciBvZiBpbnZlc3RvcnMgdG8gcHJldmVudCB0b28gbG9uZyBsb29wcw0KICAgICAgaWYoaW52ZXN0b3JDb3VudCA+PSBNQVhfSU5WRVNUT1JTKSB0aHJvdzsNCg0KICAgICAgaW52ZXN0b3JzLnB1c2goaW52ZXN0b3IpOw0KICAgICAgaW52ZXN0b3JDb3VudCsrOw0KICAgIH0NCg0KICAgIEludmVzdGVkKGludmVzdG9yLCBtc2cudmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIExvYWQgZnVuZHMgdG8gdGhlIGNyb3dkc2FsZSBmb3IgYSBzaW5nbGUgaW52ZXN0b3IuDQogICAqLw0KICBmdW5jdGlvbiBwYXJjaXBhdGVDcm93ZHNhbGVJbnZlc3RvcihhZGRyZXNzIGludmVzdG9yKSBwdWJsaWMgew0KDQogICAgLy8gQ3Jvd2RzYWxlIG5vdCB5ZXQgc2V0DQogICAgaWYoYWRkcmVzcyhjcm93ZHNhbGUpID09IDApIHRocm93Ow0KDQogICAgbW92aW5nID0gdHJ1ZTsNCg0KICAgIGlmKGJhbGFuY2VzW2ludmVzdG9yXSA+IDApIHsNCiAgICAgIHVpbnQgYW1vdW50ID0gYmFsYW5jZXNbaW52ZXN0b3JdOw0KICAgICAgZGVsZXRlIGJhbGFuY2VzW2ludmVzdG9yXTsNCiAgICAgIGNyb3dkc2FsZS5pbnZlc3QudmFsdWUoYW1vdW50KShpbnZlc3Rvcik7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIExvYWQgZnVuZHMgdG8gdGhlIGNyb3dkc2FsZSBmb3IgYWxsIGludmVzdG9yLg0KICAgKg0KICAgKi8NCiAgZnVuY3Rpb24gcGFyY2lwYXRlQ3Jvd2RzYWxlQWxsKCkgcHVibGljIHsNCg0KICAgIC8vIFdlIG1pZ2h0IGhpdCBhIG1heCBnYXMgbGltaXQgaW4gdGhpcyBsb29wLA0KICAgIC8vIGFuZCBpbiB0aGlzIGNhc2UgeW91IGNhbiBzaW1wbHkgY2FsbCBwYXJjaXBhdGVDcm93ZHNhbGVJbnZlc3RvcigpIGZvciBhbGwgaW52ZXN0b3JzDQogICAgZm9yKHVpbnQgaT0wOyBpPGludmVzdG9ycy5sZW5ndGg7IGkrKykgew0KICAgICAgIHBhcmNpcGF0ZUNyb3dkc2FsZUludmVzdG9yKGludmVzdG9yc1tpXSk7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIElDTyBuZXZlciBoYXBwZW5lZC4gQWxsb3cgcmVmdW5kLg0KICAgKi8NCiAgZnVuY3Rpb24gcmVmdW5kKCkgew0KDQogICAgLy8gVHJ5aW5nIHRvIGFzayByZWZ1bmQgdG9vIHNvb24NCiAgICBpZihub3cgPCBmcmVlemVFbmRzQXQpIHRocm93Ow0KDQogICAgLy8gV2UgaGF2ZSBzdGFydGVkIHRvIG1vdmUgZnVuZHMNCiAgICBtb3ZpbmcgPSB0cnVlOw0KDQogICAgYWRkcmVzcyBpbnZlc3RvciA9IG1zZy5zZW5kZXI7DQogICAgaWYoYmFsYW5jZXNbaW52ZXN0b3JdID09IDApIHRocm93Ow0KICAgIHVpbnQgYW1vdW50ID0gYmFsYW5jZXNbaW52ZXN0b3JdOw0KICAgIGRlbGV0ZSBiYWxhbmNlc1tpbnZlc3Rvcl07DQogICAgaWYoIWludmVzdG9yLnNlbmQoYW1vdW50KSkgdGhyb3c7DQogICAgUmVmdW5kZWQoaW52ZXN0b3IsIGFtb3VudCk7DQogIH0NCg0KICAvKioNCiAgICogU2V0IHRoZSB0YXJnZXQgY3Jvd2RzYWxlIHdoZXJlIHdlIHdpbGwgbW92ZSBwcmVzYWxlIGZ1bmRzIHdoZW4gdGhlIGNyb3dkc2FsZSBvcGVucy4NCiAgICovDQogIGZ1bmN0aW9uIHNldENyb3dkc2FsZShDcm93ZHNhbGUgX2Nyb3dkc2FsZSkgcHVibGljIG9ubHlPd25lciB7DQogICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7DQogIH0NCg0KICAvKiogRXhwbGljaXRseSBjYWxsIGZ1bmN0aW9uIGZyb20geW91ciB3YWxsZXQuICovDQogIGZ1bmN0aW9uKCkgcGF5YWJsZSB7DQogICAgdGhyb3c7DQogIH0NCn0='