base 64 content
base64promissoryToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQovL1RoaXMgY29udHJhY3QgaXMgYmFja2VkIGJ5IHRoZSBjb25zdGl0dXRpb24gb2Ygc3VwZXJEQU8gZGVwbG95ZWQgYXQgOiAuDQovL1RoZSBjb25zdGl0dXRpb24gb2YgdGhlIHN1cGVyREFPIGlzIHRoZSBzb2NpYWwgY29udHJhY3QsIHRlcm1zLCBmb3VuZGluZyBwcmluY2lwbGVzIGFuZCBkZWZpbml0aW9ucyBvZiB0aGUgdmlzaW9uLA0KLy9taXNzaW9uLCBhbnRpLW1pc3Npb25zLCBydWxlcyBhbmQgb3BlcmF0aW9uIGd1aWRlbGluZXMgb2Ygc3VwZXJEQU8uDQovL1RoZSB0b3RhbCBudW1iZXIgb2YgMywwMDAsMDAwIHJlcHJlc2VudHMgMyUgb2YgMTAwLDAwMCwwMDAgaW1tdXRhYmxlIG51bWJlciBvZiBzdXBlckRBTyB0b2tlbnMsDQovL3doaWNoIGlzIHRoZSBhbGxvdGVkIGJ1ZGdldCBvZiBvcGVyYXRpb24gZm9yIHRoZSBlYXJsaWVzdCBmdW5kaW5nIGFjdGl2aXRpZXMuDQovL0V2ZXJ5IHByb21taXNzb3J5IHRva2VuIGlzIGV4Y2hhbmdlYWJsZSBmb3IgdGhlIHJlYWwgc3VwZXJEQU8gdG9rZW5zIG9uIGEgb25lIG9uIG9uZSBiYXNpcy4NCi8vUHJvbWlzc2lvcnkgY29udHJhY3Qgd2lsbCBiZSBkZXBsb3llZCB3aXRoIHRoZSBhY3R1YWwgc3VwZXJEQU8gdG9rZW4gY29udHJhY3QuDQovL0Vhcmx5IGJhY2tlcnMgY2FuIGNhbGwgdGhlICJyZWRlZW0iIGZ1bmN0aW9uIG9uIHRoZSBhY3R1YWwgdG9rZW4gY29udHJhY3QgdG8gZXhjaGFuZ2UgcHJvbWlzc29yeSB0b2tlbnMgZm9yIHRoZSBmaW5hbCB0b2tlbnMuDQoNCi8qKg0KICogQHRpdGxlIFByb21pc29yeSBUb2tlbiBDb250cmFjdA0KICogQGF1dGhvciBvbGENCiAqIC0tLSBDb2xsYWJvcmF0b3JzIC0tLQ0KICogQGF1dGhvciB6bGF0aW5vdg0KICogQGF1dGhvciBwYW5vcw0KICogQGF1dGhvciB5ZW1pDQogKiBAYXV0aG9yIGFyY2hpbA0KICogQGF1dGhvciBhbnRob255DQogKi8NCmNvbnRyYWN0IFByb21pc3NvcnlUb2tlbiB7DQoNCiAgICBldmVudCBGb3VuZGVyU3dpdGNoUmVxdWVzdEV2ZW50KGFkZHJlc3MgX25ld0ZvdW5kZXJBZGRyKTsNCiAgICBldmVudCBGb3VuZGVyU3dpdGNoZWRFdmVudChhZGRyZXNzIF9uZXdGb3VuZGVyQWRkcik7DQogICAgZXZlbnQgQ29mb3VuZGVyU3dpdGNoZWRFdmVudChhZGRyZXNzIF9uZXdDb2ZvdW5kZXJBZGRyKTsNCg0KICAgIGV2ZW50IEFkZGVkUHJlcGFpZFRva2Vuc0V2ZW50KGFkZHJlc3MgYmFja2VyLCB1aW50IGluZGV4LCB1aW50IHByaWNlLCB1aW50IGFtb3VudCk7DQogICAgZXZlbnQgUHJlcGFpZFRva2Vuc0NsYWltZWRFdmVudChhZGRyZXNzIGJhY2tlciwgdWludCBpbmRleCwgdWludCBwcmljZSwgdWludCBhbW91bnQpOw0KICAgIGV2ZW50IFRva2Vuc0NsYWltZWRFdmVudChhZGRyZXNzIGJhY2tlciwgdWludCBpbmRleCwgdWludCBwcmljZSwgdWludCBhbW91bnQpOw0KDQogICAgZXZlbnQgUmVkZWVtRXZlbnQoYWRkcmVzcyBiYWNrZXIsIHVpbnQgYW1vdW50KTsNCg0KICAgIGV2ZW50IFdpdGhkcmF3YWxDcmVhdGVkRXZlbnQodWludCB3aXRoZHJhd2FsSWQsIHVpbnQgYW1vdW50LCBieXRlcyByZWFzb24pOw0KICAgIGV2ZW50IFdpdGhkcmF3YWxWb3RlZEV2ZW50KHVpbnQgd2l0aGRyYXdhbElkLCBhZGRyZXNzIGJhY2tlciwgdWludCBiYWNrZXJTdGFrZVdlaWd0aCwgdWludCB0b3RhbFN0YWtlV2VpZ2h0KTsNCiAgICBldmVudCBXaXRoZHJhd2FsQXBwcm92ZWQodWludCB3aXRoZHJhd2FsSWQsIHVpbnQgc3Rha2VXZWlnaHQsIGJvb2wgaXNNdWx0aVBheW1lbnQsIHVpbnQgYW1vdW50LCBieXRlcyByZWFzb24pOw0KDQogICAgYWRkcmVzcyBmb3VuZGVyOyAvL2RlcGxveWVyIG9mIGNvbnN0aXR1dGlvbiBhbmQgUHJvbWlzc29yeVRva2VuDQogICAgYnl0ZXMzMiBmb3VuZGVySGFzaDsgLy8gaGFzaCBtdXN0IGJlIGNvbmZpcm1lZCBpbiBvcmRlciB0byByZXBsYWNlIGZvdW5kZXIgYWRkcmVzcw0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBieXRlczMyKSB0ZW1wSGFzaGVzOyAvLyBzdHJ1Y3R1cmUgdG8gY29udGFpbiBuZXcgYWRkcmVzcyB0byBoYXNoIHN0b3JhZ2UsDQogICAgYWRkcmVzcyBjb2ZvdW5kZXI7Ly9oZWxwZXIgdG8gYWlkIGZvdW5kZXIga2V5IGV4Y2hhbmdlIGluIGNhc2Ugb2Yga2V5IGxvc3MNCiAgICBhZGRyZXNzIFtdIHB1YmxpYyBwcmV2aW91c0ZvdW5kZXJzOyAvL2xpc3Qgb2YgYWRkcmVzc2VzIHJlcGxhY2VkIHVzaW5nIHRoZSBzd2l0Y2hpbmcgcHJvY2Vzcy4NCiAgICB1aW50IGNvbnN0YW50IGRpc2NvdW50QW1vdW50ID0gNjA7IC8vZGlzY291bnQgYW1vdW50DQogICAgdWludCBjb25zdGFudCBkaXZpc29yID0gMTAwOyAvL2Rpdmlzb3IgdG8gZ2V0IGRpc2NvdW50IHZhbHVlDQoNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBtaW5pbXVtUHJlcGFpZENsYWltZWRQZXJjZW50ID0gNjU7DQogICAgdWludCBwdWJsaWMgcHJvbWlzc29yeVVuaXRzID0gMzAwMDAwMDsgLy9hbW91bnQgb2YgdG9rZW5zIGNvbnRhbnRzIHNldA0KICAgIHVpbnQgcHVibGljIHByZXBhaWRVbml0cyA9IDA7IC8vcHJlcGFpZCBhbmQgc2V0IGJ5IGZvdW5kZXIgb3V0IG9mIDMgbWlsbGlvbiB0b2tlbnMNCiAgICB1aW50IHB1YmxpYyBjbGFpbWVkVW5pdHMgPSAwOyAvL2NsYWltZWQgdG9rZW5zIG91dCBvZiAzIG1pbGxpb24gdG9rZW5zDQogICAgdWludCBwdWJsaWMgY2xhaW1lZFByZXBhaWRVbml0cyA9IDA7IC8vY2xhaW1lZCB0b2tlbnMgb3V0IG9mIHRoZSBlYXJseSBiYWNrZXIncyB0b2tlbnMvcHJlcGFpZFVuaXRzDQogICAgdWludCBwdWJsaWMgcmVkZWVtZWRUb2tlbnMgPSAwOyAvL251bWJlciBvZiB0b2tlbnMgb3V0IG9mIGNsYWltZWQgdG9rZW5zLCByZWRlZW1lZCBieSBzdXBlckRBTyB0b2tlbiBjYWxsDQogICAgdWludCBwdWJsaWMgbGFzdFByaWNlID0gMDsgLy9sYXRlc3QgcHJpY2Ugb2YgdG9rZW4gYWNxdWlyZWQgYnkgYmFja2VyIGluIFdlaQ0KICAgIHVpbnQgcHVibGljIG51bU9mQmFja2VyczsgLy9udW1iZXIgb2YgZWFybHkgYmFja2Vycw0KDQogICAgc3RydWN0IGJhY2tlckRhdGEgew0KICAgICAgIHVpbnQgdG9rZW5QcmljZTsNCiAgICAgICB1aW50IHRva2VuQW1vdW50Ow0KICAgICAgIGJ5dGVzMzIgcHJpdmF0ZUhhc2g7DQogICAgICAgYm9vbCBwcmVwYWlkOw0KICAgICAgIGJvb2wgY2xhaW1lZDsNCiAgICAgICB1aW50IGJhY2tlclJhbms7DQogICAgfQ0KDQogICAgYWRkcmVzc1tdIHB1YmxpYyBlYXJseUJhY2tlckxpc3Q7IC8vYWRkcmVzc2VzIG9mIGVhcmxpZXN0IGJhY2tlcnMNCiAgICBhZGRyZXNzW10gcHVibGljIGJhY2tlcnNBZGRyZXNzZXM7IC8vYWRkcmVzc2VzIG9mIGFsbCBiYWNrZXJzDQogICAgbWFwcGluZyhhZGRyZXNzID0+IGJhY2tlckRhdGFbXSkgcHVibGljIGJhY2tlcnM7Ly8gYmFja2VyIGFkZHJlc3MgdG8gYmFja2VyIGluZm8gbWFwcGluZw0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgYmFja2Vyc1JlZGVlbWVkOw0KDQogICAgc3RydWN0IHdpdGhkcmF3YWxEYXRhIHsNCiAgICAgICB1aW50IEFtb3VudDsNCiAgICAgICBib29sIGFwcHJvdmVkOw0KICAgICAgIGJvb2wgc3BlbnQ7DQogICAgICAgYnl0ZXMgcmVhc29uOw0KICAgICAgIGFkZHJlc3NbXSBiYWNrZXJBcHByb3ZhbHM7DQogICAgICAgdWludCB0b3RhbFN0YWtlOw0KICAgICAgIGFkZHJlc3NbXSBkZXN0aW5hdGlvbjsNCiAgICB9DQoNCiAgICB3aXRoZHJhd2FsRGF0YVtdIHB1YmxpYyB3aXRoZHJhd2FsczsgLy8gRGF0YSBzdHJ1Y3R1cmUgc3BlY2lmeWluZyB3aXRoZHJhd2FsDQogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcodWludCA9PiBib29sKSkgcHVibGljIHdpdGhkcmF3YWxzVm90ZXM7DQoNCiAgICAvKioNCiAgICAqIEBub3RpY2UgRGVwbG95IFByb21pc3NvcnlUb2tlbiBjb250cmFjdCB3aXRoIGBtc2cuc2VuZGVyLmFkZHJlc3MoKWAgYXMgZm91bmRlciB3aXRoIGBfcHJlcGFpZEJhY2tlcnMubnVtYmVyKClgIHByZXBhaWQgYmFja2Vycw0KICAgICogQGRldiBUaGlzIGlzIHRoZSBjb25zdHJ1Y3RvciBvZiB0aGUgcHJvbWlzb3J5IHRva2VuIGNvbnRyYWN0DQogICAgKiBAcGFyYW0gX2ZvdW5kZXJIYXNoIEZvdW5kZXJzIHBhc3N3b3JkIGhhc2gsIHByZWZlcmFibGUgYSBtZXNzYWdlIGRpZ2VzdCB0byBmdXJ0aGVyIG9iZnVzY2F0ZSBkdXBsaWNhaW9uDQogICAgKiBAcGFyYW0gX2NvZm91bmRlckFkZHJlc3MgVGhlIGhlbHBlciBjb2ZvdW5kZXIgdG8gYWlkIGZvdW5kZXIga2V5IGV4Y2hhbmdlIGluIGNhc2Ugb2Yga2V5IGxvc3MvDQogICAgKiBAcGFyYW0gX251bU9mQmFja2VycyBUaGUgbnVtYmVyIG9mIEVhcmx5IGJhY2tlcnMuIFdpbGwgYmUgdXNlZCB0byBjb250cm9sIHNldHRpbmcgZWFybHkgYmFja2Vycw0KICAgICovDQogICAgZnVuY3Rpb24gUHJvbWlzc29yeVRva2VuKCBieXRlczMyIF9mb3VuZGVySGFzaCwgYWRkcmVzcyBfY29mb3VuZGVyQWRkcmVzcywgdWludCBfbnVtT2ZCYWNrZXJzKXsNCiAgICAgICAgZm91bmRlciA9IG1zZy5zZW5kZXI7DQogICAgICAgIGZvdW5kZXJIYXNoID0gc2hhMyhfZm91bmRlckhhc2gpOw0KICAgICAgICBjb2ZvdW5kZXIgPSBfY29mb3VuZGVyQWRkcmVzczsNCiAgICAgICAgbnVtT2ZCYWNrZXJzID0gX251bU9mQmFja2VyczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIEBub3RpY2UgYG1zZy5zZW5kZXIuYWRkcmVzcygpYCB1cGRhdGluZyBjb2ZvdW5kZXIgYWRkcmVzcyB0byBgX25ld0ZvdW5kZXJBZGRyLmFkZHJlc3MoKWANCiAgICAqIEBkZXYgYWxsb3dzIGNvZm91bmRlciB0byBzd2l0Y2ggb3V0IGFkZHJlcyBmb3IgYSBuZXcgb25lLkNhbiBiZSByZXBlYXRlZCBhcyBtYW55IHRpbWVzIGFzIG5lZWRlZA0KICAgICogQHBhcmFtIF9uZXdDb2ZvdW5kZXJBZGRyIE5ldyBBZGRyZXNzIG9mIENvZm91bmRlcg0KICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBjb0ZvdW5kZXIgYWRkcmVzcyBzdWNjZXNzZnVsbHkgdXBkYXRlZA0KICAgICovDQogICAgZnVuY3Rpb24gY29mb3VuZGVyU3dpdGNoQWRkcmVzcyhhZGRyZXNzIF9uZXdDb2ZvdW5kZXJBZGRyKSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3Mpew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb2ZvdW5kZXIpIHRocm93Ow0KDQogICAgICAgIGNvZm91bmRlciA9IF9uZXdDb2ZvdW5kZXJBZGRyOw0KICAgICAgICBDb2ZvdW5kZXJTd2l0Y2hlZEV2ZW50KF9uZXdDb2ZvdW5kZXJBZGRyKTsNCg0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIEBub3RpY2UgRm91bmRlciBhZGRyZXNzIHVwZGF0ZSB0byBgX25ld0ZvdW5kZXJBZGRyLmFkZHJlc3MoKWAgaXMgYmVpbmcgcmVxdWVzdGVkDQogICAgKiBAZGV2IGZvdW5kZXJTd2l0Y2hBZGRyZXNzIGZvdW5kZXIgaW5kaWNhdGVzIGludGVudCB0byBzd2l0Y2ggYWRkcmVzc2VzIHdpdGggbmV3IGFkZHJlc3MsDQogICAgKiBoYXNoIG9mIHBhc3MgcGhyYXNlIGFuZCBhICJvbmV0aW1lIHNoYXJlZCBwaHJhc2Ugc2hhcmVkIHdpdGggY291Zm91bmRlciINCiAgICAqIEBwYXJhbSBfZm91bmRlckhhc2ggU2VjcmV0IEtleSB0byBiZSB1c2VkIHRvIGNvbmZpcm0gQWRkcmVzcyB1cGRhdGUNCiAgICAqIEBwYXJhbSBfb25lVGltZXNoYXJlZFBocmFzZSBTaGFyZWQgcHJlLWhhc2hlZCBTZWNyZXQga2V5IGZvciBvZmZsaW5lIHRydXN0IHRvIGJlIHNoYXJlZCB3aXRoIGNvRm91bmRlciB0byBhcHByb3ZlIEFkZHJlc3MgdXBkYXRlDQogICAgKiBAcmV0dXJuIFRydWUgaWYgQWRkcmVzcyBzd2l0Y2ggcmVxdWVzdCBzdWNjZXNzZnVsbHkgY3JlYXRlZCBhbmQgVGVtcG9yYXJ5IGhhc2ggVmFsdWVzIHNldA0KICAgICovDQogICAgZnVuY3Rpb24gZm91bmRlclN3aXRjaFJlcXVlc3QoYnl0ZXMzMiBfZm91bmRlckhhc2gsIGJ5dGVzMzIgX29uZVRpbWVzaGFyZWRQaHJhc2UpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyl7DQogICAgICAgIGlmKHNoYTMoX2ZvdW5kZXJIYXNoKSAhPSBmb3VuZGVySGFzaCkgdGhyb3c7DQoNCiAgICAgICAgdGVtcEhhc2hlc1ttc2cuc2VuZGVyXSA9IHNoYTMobXNnLnNlbmRlciwgZm91bmRlckhhc2gsIF9vbmVUaW1lc2hhcmVkUGhyYXNlKTsNCiAgICAgICAgRm91bmRlclN3aXRjaFJlcXVlc3RFdmVudChtc2cuc2VuZGVyKTsNCg0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgIC8qKg0KICAgICogQG5vdGljZSBgbXNnLnNlbmRlci5hZGRyZXNzKClgIGFwcHJvdmluZyBgX25ld0ZvdW5kZXJBZGRyLmFkZHJlc3MoKWAgYXMgbmV3IGZvdW5kZXIgYWRkcmVzcw0KICAgICogQGRldiBDb2ZvdW5kZXJTd2l0Y2hBZGRyZXNzIHdoaWNoIGFsbG93cyBwcmV2aW91c2x5IHNldCBjb2ZvdW5kZXIgdG8gYXBwcm92ZSBhZGRyZXNzDQogICAgKiBzd2l0Y2ggYnkgZm91bmRlci4gTXVzdCBoYXZlIGEgb25lIHRpbWUgc2hhcmVkIHBocmFzZSB0aGF0cyBpcyBzaGFyZWQgd2l0aCBmb3VuZGVyIHRoYXQgY29ycmVzcG9uZGluZyB3aXRoIGENCiAgICAqIGhhc2hlZCB2YWx1ZS4NCiAgICAqIEBwYXJhbSBfbmV3Rm91bmRlckFkZHIgVGhlIGFkZHJlc3Mgb2YgRm91bmRlciB0byBiZSBuZXdseSBzZXQNCiAgICAqIEBwYXJhbSBfb25lVGltZXNoYXJlZFBocmFzZSBTaGFyZWQgcHJlLWhhc2hlZCBTZWNyZXQga2V5IGZvciBvZmZsaW5lIHRydXN0LCB0byBwcm92aWRlIGFjY2VzcyB0byB0aGUgYXBwcm92YWwgZnVuY3Rpb24NCiAgICAqIEByZXR1cm4gVHJ1ZSBpZiBuZXcgRm91bmRlciBhZGRyZXNzIHN1Y2Nlc3NmdWxseSBhcHByb3ZlZA0KICAgICovDQogICAgZnVuY3Rpb24gY29mb3VuZGVyQXBwcm92ZVN3aXRjaFJlcXVlc3QoYWRkcmVzcyBfbmV3Rm91bmRlckFkZHIsIGJ5dGVzMzIgX29uZVRpbWVzaGFyZWRQaHJhc2UpIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2Vzcyl7DQogICAgICAgIGlmKG1zZy5zZW5kZXIgIT0gY29mb3VuZGVyIHx8IHNoYTMoX25ld0ZvdW5kZXJBZGRyLCBmb3VuZGVySGFzaCwgX29uZVRpbWVzaGFyZWRQaHJhc2UpICE9IHRlbXBIYXNoZXNbX25ld0ZvdW5kZXJBZGRyXSkgdGhyb3c7DQoNCiAgICAgICAgcHJldmlvdXNGb3VuZGVycy5wdXNoKGZvdW5kZXIpOw0KICAgICAgICBmb3VuZGVyID0gX25ld0ZvdW5kZXJBZGRyOw0KICAgICAgICBGb3VuZGVyU3dpdGNoZWRFdmVudChfbmV3Rm91bmRlckFkZHIpOw0KDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICogQG5vdGljZSBBZGRpbmcgYF9iYWNrZXIuYWRkcmVzcygpYCBhcyBhbiBlYXJseSBiYWNrZXINCiAgICAqIEBkZXYgQWRkIEVhcmx5IGJhY2tlcnMgdG8gQ29udHJhY3Qgc2V0dGluZyB0aGUgdHJhbnNhY3RvbiBkZXRhaWxzDQogICAgKiBAcGFyYW0gX2JhY2tlciBUaGUgYWRkcmVzcyBvZiB0aGUgc3VwZXJEQU8gYmFja2VyDQogICAgKiBAcGFyYW0gX3Rva2VuUHJpY2UgVGhlIHByaWNlL3JhdGUgYXQgd2hpY2ggdGhlIHN1cGVyREFPIHRva2VucyB3ZXJlIGJvdWdodA0KICAgICogQHBhcmFtIF90b2tlbkFtb3VudCBUaGUgdG90YWwgbnVtYmVyIG9mIHN1cGVyREFPIHRva2VuIHB1cmNnYXNlZCBhdCB0aGUgaW5kaWNhdGVkIHJhdGUNCiAgICAqIEBwYXJhbSBfcHJpdmF0ZVBocmFzZSBTaGFyZWQgcHJlLWhhc2hlZCBTZWNyZXQga2V5IGZvciBvZmZsaW5lIHByaWNlIG5lZ290aWF0aW9uIHRvIG9ubGluZSBhdHRlc3RhdGlvbiBvZiBTdXBlckRBTyB0b2tlbnMgb3duZXJzaGlwDQogICAgKiBAcGFyYW0gX2JhY2tlclJhbmsgUmFuayBvZiB0aGUgYmFja2VyIGluIHRoZSBiYWNrZXJzIGxpc3QNCiAgICAqIEByZXR1cm4gVGhyZSBpbmRleCBvZiBfYmFja2VyICBpbiB0aGUgYmFja2VycyBsaXN0DQogICAgKi8NCiAgICBmdW5jdGlvbiBzZXRQcmVwYWlkKGFkZHJlc3MgX2JhY2tlciwgdWludCBfdG9rZW5QcmljZSwgdWludCBfdG9rZW5BbW91bnQsIHN0cmluZyBfcHJpdmF0ZVBocmFzZSwgdWludCBfYmFja2VyUmFuaykNCiAgICAgICAgZXh0ZXJuYWwNCiAgICAgICAgZm91bmRlckNhbGwNCiAgICAgICAgcmV0dXJucyAodWludCkNCiAgICB7DQogICAgICAgIGlmIChfdG9rZW5QcmljZSA9PSAwIHx8IF90b2tlbkFtb3VudCA9PSAwIHx8IGNsYWltZWRQcmVwYWlkVW5pdHM+MCB8fA0KICAgICAgICAgICAgX3Rva2VuQW1vdW50ICsgcHJlcGFpZFVuaXRzICsgY2xhaW1lZFVuaXRzID4gcHJvbWlzc29yeVVuaXRzKSB0aHJvdzsNCiAgICAgICAgaWYgKGVhcmx5QmFja2VyTGlzdC5sZW5ndGggPT0gbnVtT2ZCYWNrZXJzICYmIGJhY2tlcnNbX2JhY2tlcl0ubGVuZ3RoID09IDApIHRocm93IDsNCiAgICAgICAgaWYgKGJhY2tlcnNbX2JhY2tlcl0ubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgIGVhcmx5QmFja2VyTGlzdC5wdXNoKF9iYWNrZXIpOw0KICAgICAgICAgICAgYmFja2Vyc0FkZHJlc3Nlcy5wdXNoKF9iYWNrZXIpOw0KICAgICAgICB9DQogICAgICAgIGJhY2tlcnNbX2JhY2tlcl0ucHVzaChiYWNrZXJEYXRhKF90b2tlblByaWNlLCBfdG9rZW5BbW91bnQsIHNoYTMoX3ByaXZhdGVQaHJhc2UsIF9iYWNrZXIpLCB0cnVlLCBmYWxzZSwgX2JhY2tlclJhbmspKTsNCg0KICAgICAgICBwcmVwYWlkVW5pdHMgKz1fdG9rZW5BbW91bnQ7DQogICAgICAgIGxhc3RQcmljZSA9IF90b2tlblByaWNlOw0KDQogICAgICAgIEFkZGVkUHJlcGFpZFRva2Vuc0V2ZW50KF9iYWNrZXIsIGJhY2tlcnNbX2JhY2tlcl0ubGVuZ3RoIC0gMSwgX3Rva2VuUHJpY2UsIF90b2tlbkFtb3VudCk7DQoNCiAgICAgICAgcmV0dXJuIGJhY2tlcnNbX2JhY2tlcl0ubGVuZ3RoIC0gMTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIEBub3RpY2UgQ2xhaW1pbmcgYF90b2tlbkFtb3VudC5udW1iZXIoKWAgc3VwZXJEQU8gdG9rZW5zIGJ5IGBtc2cuc2VuZGVyLmFkZHJlc3MoKWANCiAgICAqIEBkZXYgQ2xhaW0gc3VwZXJEQU8gRWFybHkgYmFja2VyIHRva2Vucw0KICAgICogQHBhcmFtIF9pbmRleCBpbmRleCBvZiB0b2tlbnMgdG8gY2xhaW0NCiAgICAqIEBwYXJhbSBfYm91Z2h0VG9rZW5zUHJpY2UgUHJpY2UgYXQgd2hpY2ggdGhlIHN1cGVyREFPIHRva2VucyB3ZXJlIGJvdWdodA0KICAgICogQHBhcmFtIF90b2tlbkFtb3VudCBOdW1iZXIgb2Ygc3VwZXJEQU8gdG9rZW5zIHRvIGJlIGNsYWltZWQNCiAgICAqIEBwYXJhbSBfcHJpdmF0ZVBocmFzZSBTaGFyZWQgcHJlLWhhc2hlZCBTZWNyZXQga2V5IGZvciBvZmZsaW5lIHByaWNlIG5lZ290aWF0aW9uIHRvIG9ubGluZSBhdHRlc3RhdGlvbiBvZiBTdXBlckRBTyB0b2tlbnMgb3duZXJzaGlwDQogICAgKiBAcGFyYW0gX2JhY2tlclJhbmsgQmFja2VyIHJhbmsgb2YgdGhlIGJhY2tlciBpbiB0aGUgc3VwZXJEQU8NCiAgICAqLw0KICAgIGZ1bmN0aW9uIGNsYWltUHJlcGFpZCh1aW50IF9pbmRleCwgdWludCBfYm91Z2h0VG9rZW5zUHJpY2UsIHVpbnQgX3Rva2VuQW1vdW50LCBzdHJpbmcgX3ByaXZhdGVQaHJhc2UsIHVpbnQgX2JhY2tlclJhbmspDQogICAgICAgIGV4dGVybmFsDQogICAgICAgIEVhcmxpZXN0QmFja2Vyc1NldA0KICAgIHsNCiAgICAgICAgaWYoYmFja2Vyc1ttc2cuc2VuZGVyXVtfaW5kZXhdLnByZXBhaWQgPT0gdHJ1ZSAmJg0KICAgICAgICAgICBiYWNrZXJzW21zZy5zZW5kZXJdW19pbmRleF0uY2xhaW1lZCA9PSBmYWxzZSAmJg0KICAgICAgICAgICBiYWNrZXJzW21zZy5zZW5kZXJdW19pbmRleF0udG9rZW5BbW91bnQgPT0gX3Rva2VuQW1vdW50ICYmDQogICAgICAgICAgIGJhY2tlcnNbbXNnLnNlbmRlcl1bX2luZGV4XS50b2tlblByaWNlID09IF9ib3VnaHRUb2tlbnNQcmljZSAmJg0KICAgICAgICAgICBiYWNrZXJzW21zZy5zZW5kZXJdW19pbmRleF0ucHJpdmF0ZUhhc2ggPT0gc2hhMyggX3ByaXZhdGVQaHJhc2UsIG1zZy5zZW5kZXIpICYmDQogICAgICAgICAgIGJhY2tlcnNbbXNnLnNlbmRlcl1bX2luZGV4XS5iYWNrZXJSYW5rID09IF9iYWNrZXJSYW5rKQ0KICAgICAgICB7DQogICAgICAgICAgICBiYWNrZXJzW21zZy5zZW5kZXJdW19pbmRleF0uY2xhaW1lZCA9IHRydWU7DQogICAgICAgICAgICBjbGFpbWVkUHJlcGFpZFVuaXRzICs9IF90b2tlbkFtb3VudDsNCg0KICAgICAgICAgICAgUHJlcGFpZFRva2Vuc0NsYWltZWRFdmVudChtc2cuc2VuZGVyLCBfaW5kZXgsIF9ib3VnaHRUb2tlbnNQcmljZSwgX3Rva2VuQW1vdW50KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgKiBAbm90aWNlIGBtc2cuc2VuZGVyLmFkZHJlc3MoKWAgaXMgUHVyY2hhc2luZyBgKG1zZy52YWx1ZSAvIGxhc3RQcmljZSkudG9GaXhlZCgwKWAgc3VwZXJEQU8gVG9rZW5zIGF0IGBsYXN0UHJpY2VgDQogICAgKiBAZGV2IFB1cmNoYXNlIG5ldyBzdXBlckRBTyBUb2tlbnMgaWYgdGhlIGFtb3VudCBvZiB0b2tlbnMgYXJlIHN0aWxsIGF2YWlsYWJsZSBmb3IgcHVyY2hhc2UNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGNsYWltKCkNCiAgICAgICAgcGF5YWJsZQ0KICAgICAgICBleHRlcm5hbA0KICAgICAgICBNaW5pbXVtQmFja2Vyc0NsYWltZWQNCiAgIHsNCiAgICAgICAgaWYgKGxhc3RQcmljZSA9PSAwKSB0aHJvdzsNCg0KICAgICAgICAvL2RvbmB0IGFjY2VwdCB0cmFuc2FjdGlvbnMgd2l0aCB6ZXJvIHZhbHVlDQogICAgICAgIGlmIChtc2cudmFsdWUgPT0gMCkgdGhyb3c7DQoNCg0KICAgICAgICAvL0VmZmVjdGl2ZSBkaXNjb3VudCBmb3IgUHJlLWNyb3dkZnVuZGluZyBiYWNrZXJzIG9mIDQwJSBMZWF2aW5nIGVmZmVjdGl2ZSByYXRlIG9mIDYwJQ0KICAgICAgICB1aW50IGRpc2NvdW50UHJpY2UgPSBsYXN0UHJpY2UgKiBkaXNjb3VudEFtb3VudCAvIGRpdmlzb3I7DQoNCiAgICAgICAgdWludCB0b2tlbkFtb3VudCA9IChtc2cudmFsdWUgLyBkaXNjb3VudFByaWNlKTsvL0VmZmVjdCB0aGUgZGlzY291bnQgcmF0ZSAwZiA0MCUNCg0KICAgICAgICBpZiAodG9rZW5BbW91bnQgKyBjbGFpbWVkVW5pdHMgKyBwcmVwYWlkVW5pdHMgPiBwcm9taXNzb3J5VW5pdHMpIHRocm93Ow0KDQogICAgICAgIGlmIChiYWNrZXJzW21zZy5zZW5kZXJdLmxlbmd0aCA9PSAwKSB7DQogICAgICAgICAgICBiYWNrZXJzQWRkcmVzc2VzLnB1c2gobXNnLnNlbmRlcik7DQogICAgICAgIH0NCiAgICAgICAgYmFja2Vyc1ttc2cuc2VuZGVyXS5wdXNoKGJhY2tlckRhdGEoZGlzY291bnRQcmljZSwgdG9rZW5BbW91bnQsIHNoYTMobXNnLnNlbmRlciksIGZhbHNlLCB0cnVlLCAwKSk7DQoNCiAgICAgICAgY2xhaW1lZFVuaXRzICs9IHRva2VuQW1vdW50Ow0KDQogICAgICAgIFRva2Vuc0NsYWltZWRFdmVudChtc2cuc2VuZGVyLCBiYWNrZXJzW21zZy5zZW5kZXJdLmxlbmd0aCAtIDEsIGRpc2NvdW50UHJpY2UsIHRva2VuQW1vdW50KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAbm90aWNlIGNoZWNraW5nIGBfYmFja2VyQWRkcmVzcy5hZGRyZXNzKClgIHN1cGVyREFPIFRva2VuIGJhbGFuY2U6IGBpbmRleGANCiAgICAgKiBAZGV2IENoZWNrIFRva2VuIGJhbGFuY2UgYnkgaW5kZXggb2YgYmFja2VyLCByZXR1cm4gdmFsdWVzIGNhbiBiZSB1c2VkIHRvIGluc3RhbnRpYXRlIGEgYmFja2VyRGF0YSBzdHJ1Y3QNCiAgICAgKiBAcGFyYW0gX2JhY2tlckFkZHJlc3MgVGhlIEJhY2tlcidzIGFkZHJlc3MNCiAgICAgKiBAcGFyYW0gaW5kZXggVGhlIGJhbGFuY2UgdG8gY2hlY2sNCiAgICAgKiBAcmV0dXJuIHRva2VuUHJpY2UgVGhlIFByaWNlIGF0IHdoaWNoIHRoZSB0b2tlbnMgd2VyZSBib3VnaHQNCiAgICAgKiBAcmV0dXJuIHRva2VuQW1vdW50IFRoZSBudW1iZXIgb2YgdG9rZW5zIHRoYXQgd2VyZSBib3VnaHQNCiAgICAgKiBAcmV0dXJuIFNoYXJlZCBwcmUtaGFzaGVkIFNlY3JldCBrZXkgZm9yIG9mZmxpbmUgcHJpY2UgbmVnb3RpYXRpb24gDQogICAgICogQHJldHVybiBwcmVwYWlkIFRydWUgaWYgYmFja2VyIGlzIGFuIGVhcmx5IGJhY2tlcg0KICAgICAqIEByZXR1cm4gY2xhaW1lZCBUcnVlIGlmIHRoZSBUb2tlbiBoYXMgYWxyZWFkeSBiZWVuIGNsYWltZWQgYnkgdGhlIGJhY2tlcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNoZWNrQmFsYW5jZShhZGRyZXNzIF9iYWNrZXJBZGRyZXNzLCB1aW50IGluZGV4KSBjb25zdGFudCByZXR1cm5zICh1aW50LCB1aW50LCBieXRlczMyLCBib29sLCBib29sKXsNCiAgICAgICAgcmV0dXJuICgNCiAgICAgICAgICAgIGJhY2tlcnNbX2JhY2tlckFkZHJlc3NdW2luZGV4XS50b2tlblByaWNlLA0KICAgICAgICAgICAgYmFja2Vyc1tfYmFja2VyQWRkcmVzc11baW5kZXhdLnRva2VuQW1vdW50LA0KICAgICAgICAgICAgYmFja2Vyc1tfYmFja2VyQWRkcmVzc11baW5kZXhdLnByaXZhdGVIYXNoLA0KICAgICAgICAgICAgYmFja2Vyc1tfYmFja2VyQWRkcmVzc11baW5kZXhdLnByZXBhaWQsDQogICAgICAgICAgICBiYWNrZXJzW19iYWNrZXJBZGRyZXNzXVtpbmRleF0uY2xhaW1lZA0KICAgICAgICAgICAgKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIEBub3RpY2UgQXBwcm92aW5nIHdpdGhkcmF3YWwgYF93aXRoZHJhd2FsSURgDQogICAgKiBAZGV2IEFwcHJvdmUgYSB3aXRoZHJhd2FsIGZyb20gdGhlIHN1cGVyREFPIGFuZCBtYXJrIHRoZSB3aXRoZHJhd2FsIGFzIHNwZW50DQogICAgKiBAcGFyYW0gX3dpdGhkcmF3YWxJRCBUaGUgSUQgb2YgdGhlIHdpdGhkcmF3YWwNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGFwcHJvdmVXaXRoZHJhdyh1aW50IF93aXRoZHJhd2FsSUQpDQogICAgICAgIGV4dGVybmFsDQogICAgICAgIGJhY2tlckNoZWNrKF93aXRoZHJhd2FsSUQpDQogICAgew0KICAgICAgICB3aXRoZHJhd2Fsc1ZvdGVzW21zZy5zZW5kZXJdW193aXRoZHJhd2FsSURdID0gdHJ1ZTsNCg0KICAgICAgICB1aW50IGJhY2tlclN0YWtlID0gMDsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYmFja2Vyc1ttc2cuc2VuZGVyXS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgYmFja2VyU3Rha2UgKz0gYmFja2Vyc1ttc2cuc2VuZGVyXVtpXS50b2tlbkFtb3VudDsNCiAgICAgICAgfQ0KICAgICAgICB3aXRoZHJhd2Fsc1tfd2l0aGRyYXdhbElEXS5iYWNrZXJBcHByb3ZhbHMucHVzaChtc2cuc2VuZGVyKTsNCiAgICAgICAgd2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0udG90YWxTdGFrZSArPSBiYWNrZXJTdGFrZTsNCg0KICAgICAgICBXaXRoZHJhd2FsVm90ZWRFdmVudChfd2l0aGRyYXdhbElELCBtc2cuc2VuZGVyLCBiYWNrZXJTdGFrZSwgd2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0udG90YWxTdGFrZSk7DQoNCiAgICAgICAgaWYod2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0udG90YWxTdGFrZSA+PSAoY2xhaW1lZFByZXBhaWRVbml0cyArIGNsYWltZWRVbml0cykgLyAzKSB7DQogICAgICAgICAgICB1aW50IGFtb3VudFBlckFkZHI7DQogICAgICAgICAgICBib29sIGlzTXVsdGlQYXltZW50ID0gd2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0uZGVzdGluYXRpb24ubGVuZ3RoID4gMTsNCg0KICAgICAgICAgICAgaWYoaXNNdWx0aVBheW1lbnQgPT0gZmFsc2Upew0KICAgICAgICAgICAgICAgIGFtb3VudFBlckFkZHIgPSB3aXRoZHJhd2Fsc1tfd2l0aGRyYXdhbElEXS5BbW91bnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBhbW91bnRQZXJBZGRyID0gd2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0uQW1vdW50IC8gd2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0uZGVzdGluYXRpb24ubGVuZ3RoOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aXRoZHJhd2Fsc1tfd2l0aGRyYXdhbElEXS5hcHByb3ZlZCA9IHRydWU7DQogICAgICAgICAgICB3aXRoZHJhd2Fsc1tfd2l0aGRyYXdhbElEXS5zcGVudCA9IHRydWU7DQoNCiAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IHdpdGhkcmF3YWxzW193aXRoZHJhd2FsSURdLmRlc3RpbmF0aW9uLmxlbmd0aDsgaSsrKXsNCiAgICAgICAgICAgICAgICBpZighd2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0uZGVzdGluYXRpb25baV0uc2VuZChhbW91bnRQZXJBZGRyKSkgdGhyb3c7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFdpdGhkcmF3YWxBcHByb3ZlZChfd2l0aGRyYXdhbElELA0KICAgICAgICAgICAgICAgIHdpdGhkcmF3YWxzW193aXRoZHJhd2FsSURdLnRvdGFsU3Rha2UsDQogICAgICAgICAgICAgICAgaXNNdWx0aVBheW1lbnQsDQogICAgICAgICAgICAgICAgd2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0uQW1vdW50LA0KICAgICAgICAgICAgICAgIHdpdGhkcmF3YWxzW193aXRoZHJhd2FsSURdLnJlYXNvbik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAqIEBub3RpY2UgUmVxdWVzdG5nIHdpdGhkcmF3YWwgb2YgYF90b3RhbEFtb3VudGAgdG8gYF9kZXN0aW5hdGlvbi5hZGRyZXNzKClgDQogICAgKiBAZGV2IENyZWF0ZSBhIG5ldyB3aXRoZHJhd2FsIHJlcXVlc3QNCiAgICAqIEBwYXJhbSBfdG90YWxBbW91bnQgVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgd2l0aGRyYXdhbiwgc2hvdWxkIGJlIGVxdWFsIHRvIHRoZSB0b3RhbCBudW1iZXIgb2Ygb3duZWQgdG9rZW5zDQogICAgKiBAcGFyYW0gX3JlYXNvbiBSZWFzb24vRGVzY3JpcHRpb24gZm9yIHRoZSB3aXRoZHJhd2FsDQogICAgKiBAcGFyYW0gX2Rlc3RpbmF0aW9uIFRoZSByZWNlaXZpbmcgYWRkcmVzcw0KICAgICovDQogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludCBfdG90YWxBbW91bnQsIGJ5dGVzIF9yZWFzb24sIGFkZHJlc3NbXSBfZGVzdGluYXRpb24pDQogICAgICAgIGV4dGVybmFsDQogICAgICAgIGZvdW5kZXJDYWxsDQogICAgew0KICAgICAgICBpZiAodGhpcy5iYWxhbmNlIDwgX3RvdGFsQW1vdW50KSB0aHJvdzsNCg0KICAgICAgICB1aW50IHdpdGhkcmF3YWxJRCA9IHdpdGhkcmF3YWxzLmxlbmd0aCsrOw0KDQogICAgICAgIHdpdGhkcmF3YWxzW3dpdGhkcmF3YWxJRF0uQW1vdW50ID0gX3RvdGFsQW1vdW50Ow0KICAgICAgICB3aXRoZHJhd2Fsc1t3aXRoZHJhd2FsSURdLnJlYXNvbiA9IF9yZWFzb247DQogICAgICAgIHdpdGhkcmF3YWxzW3dpdGhkcmF3YWxJRF0uZGVzdGluYXRpb24gPSBfZGVzdGluYXRpb247DQogICAgICAgIHdpdGhkcmF3YWxzW3dpdGhkcmF3YWxJRF0uYXBwcm92ZWQgPSBmYWxzZTsNCiAgICAgICAgd2l0aGRyYXdhbHNbd2l0aGRyYXdhbElEXS5zcGVudCA9IGZhbHNlOw0KDQogICAgICAgIFdpdGhkcmF3YWxDcmVhdGVkRXZlbnQod2l0aGRyYXdhbElELCBfdG90YWxBbW91bnQsIF9yZWFzb24pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICogQG5vdGljZSBCYWNrZXIgYF9iYWNoZXJBZGRyLmFkZHJlc3MoKWAgaXMgcmVkZWVtaW5nIGBfYW1vdW50YCBzdXBlckRBTyBUb2tlbnMNCiAgICAqIEBkZXYgQ2hlY2sgaWYgYmFja2VyIHRva2VucyBoYXZlIGJlZW4gY2xhaW1lZCBidXQgbm90IHJlZGVlbWVkLCB0aGVuIHJlZGVlbSB0aGVtDQogICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgdG90YWwgbnVtYmVyIG9mIHJlZGVlbWFibGUgdG9rZW5zDQogICAgKiBAcGFyYW0gX2JhY2tlckFkZHIgVGhlIGFkZHJlc3Mgb2YgdGhlIGJhY2tlcg0KICAgICogQHJldHVybiBUcnVlIGlmIHRva2VucyB3ZXJlIHN1Y2Nlc3NmdWxseSByZWRlZW1lZCBlbHNlIGZhbHNlDQogICAgKi8NCiAgICBmdW5jdGlvbiByZWRlZW0odWludCBfYW1vdW50LCBhZGRyZXNzIF9iYWNrZXJBZGRyKSByZXR1cm5zKGJvb2wpew0KICAgICAgICBpZiAoYmFja2Vyc1JlZGVlbWVkW19iYWNrZXJBZGRyXSA9PSB0cnVlKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICB1aW50IHRvdGFsVG9rZW5zID0gMDsNCg0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBiYWNrZXJzW19iYWNrZXJBZGRyXS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGJhY2tlcnNbX2JhY2tlckFkZHJdW2ldLmNsYWltZWQgPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0b3RhbFRva2VucyArPSBiYWNrZXJzW19iYWNrZXJBZGRyXVtpXS50b2tlbkFtb3VudDsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh0b3RhbFRva2VucyA9PSBfYW1vdW50KXsNCiAgICAgICAgICAgIGJhY2tlcnNSZWRlZW1lZFtfYmFja2VyQWRkcl0gPSB0cnVlOw0KDQogICAgICAgICAgICBSZWRlZW1FdmVudChfYmFja2VyQWRkciwgdG90YWxUb2tlbnMpOw0KDQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICogQG5vdGljZSBjaGVjayB3aXRoZHJhd2FsIHN0YXR1cyBvZiBgX3dpdGhkcmF3YWxJRGANCiAgICAqIEBkZXYgR2V0IHRoZSB3aXRoZHJhd2FsIG9mIGEgd2l0aGRyYXdhbC4gUmV0dXJuIHZhbHVlcyBjYW4gYmUgdXNlZCB0byBpbnN0YW50aWF0ZSBhIHdpdGhkcmF3YWxEYXRhIHN0cnVjdA0KICAgICogQHBhcmFtIF93aXRoZHJhd2FsSUQgVGhlIElEIG9mIHRoZSB3aXRoZHJhd2FsDQogICAgKiBAcmV0dXJuIEFtb3VudCBUaGUgQW1vdW50IHJlcXVlc3RlZCBpbiB0aGUgd2l0aGRyYXdhbA0KICAgICogQHJldHVybiBhcHByb3ZlZCBUcnVlIGlmIHRoZSB3aXRoZHJhd2FsIGhhcyBiZWVuIGFwcHJvdmVkDQogICAgKiBAcmV0dXJuIHJlYXNvbiBSZWFzb24vRGVzY3JpcHRpb24gb2YgdGhlIFdpdGhkcmF3YWwNCiAgICAqIEByZXR1cm4gYmFja2VyQXBwcm92YWxzIEFkZHJlc3NlcyBvZiBiYWNrZXJzIHdobyBhcHByb3ZlZCB0aGUgd2l0aGRyYXdhbA0KICAgICogQHJldHVybiB0b3RhbFN0YWtlIFRvdGFsIG51bWJlciBvZiB0b2tlbnMgd2hpY2ggYmFja2VkIHRoZSB3aXRoZHJhd2FsKFRvdGFsIG51bWJlciBvZiB0b2tlbnMgb3duZWQgYnkgYmFja2VycyB3aG8gYXBwcm92ZWQgdGhlIHdpdGhkcmF3YWwpDQogICAgKiBAcmV0dXJuIGRlc3RpbmF0aW9uIFJlY2VpdmluZyBhZGRyZXNzIG9mIHRoZSB3aXRoZHJhd2FsDQogICAgKi8NCiAgICBmdW5jdGlvbiBnZXRXaXRoZHJhd2FsRGF0YSh1aW50IF93aXRoZHJhd2FsSUQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50LCBib29sLCBieXRlcywgYWRkcmVzc1tdLCB1aW50LCBhZGRyZXNzW10pew0KICAgICAgICByZXR1cm4gKA0KICAgICAgICAgICAgd2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0uQW1vdW50LA0KICAgICAgICAgICAgd2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0uYXBwcm92ZWQsDQogICAgICAgICAgICB3aXRoZHJhd2Fsc1tfd2l0aGRyYXdhbElEXS5yZWFzb24sDQogICAgICAgICAgICB3aXRoZHJhd2Fsc1tfd2l0aGRyYXdhbElEXS5iYWNrZXJBcHByb3ZhbHMsDQogICAgICAgICAgICB3aXRoZHJhd2Fsc1tfd2l0aGRyYXdhbElEXS50b3RhbFN0YWtlLA0KICAgICAgICAgICAgd2l0aGRyYXdhbHNbX3dpdGhkcmF3YWxJRF0uZGVzdGluYXRpb24pOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIGZvdW5kZXJDYWxsew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBmb3VuZGVyKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBiYWNrZXJDaGVjayh1aW50IF93aXRoZHJhd2FsSUQpew0KICAgICAgICBpZihiYWNrZXJzW21zZy5zZW5kZXJdLmxlbmd0aCA9PSAwIHx8IHdpdGhkcmF3YWxzW193aXRoZHJhd2FsSURdLnNwZW50ID09IHRydWUgfHwgd2l0aGRyYXdhbHNWb3Rlc1ttc2cuc2VuZGVyXVtfd2l0aGRyYXdhbElEXSA9PSB0cnVlKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBFYXJsaWVzdEJhY2tlcnNTZXR7DQogICAgICAgaWYoZWFybHlCYWNrZXJMaXN0Lmxlbmd0aCA8IG51bU9mQmFja2VycykgdGhyb3c7DQogICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBNaW5pbXVtQmFja2Vyc0NsYWltZWQoKXsNCiAgICAgIGlmKHByZXBhaWRVbml0cyA9PSAwIHx8DQogICAgICAgIGNsYWltZWRQcmVwYWlkVW5pdHMgPT0gMCB8fA0KICAgICAgICAoY2xhaW1lZFByZXBhaWRVbml0cyAqIGRpdmlzb3IgLyBwcmVwYWlkVW5pdHMpIDwgbWluaW11bVByZXBhaWRDbGFpbWVkUGVyY2VudCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgIF87DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiBTYWZlZ3VhcmQgZnVuY3Rpb24uDQogICAgICogVGhpcyBmdW5jdGlvbiBnZXRzIGV4ZWN1dGVkIGlmIGEgdHJhbnNhY3Rpb24gd2l0aCBpbnZhbGlkIGRhdGEgaXMgc2VudCB0bw0KICAgICAqIHRoZSBjb250cmFjdCBvciBqdXN0IGV0aGVyIHdpdGhvdXQgZGF0YS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KfQ=='