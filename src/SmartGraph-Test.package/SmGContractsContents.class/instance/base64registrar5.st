base 64 content
base64registrar5
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4wOw0KDQoNCi8qDQoNClRlbXBvcmFyeSBIYXNoIFJlZ2lzdHJhcg0KPT09PT09PT09PT09PT09PT09PT09PT09DQoNClRoaXMgaXMgYSBzaW1wbGlmaWVkIHZlcnNpb24gb2YgYSBoYXNoIHJlZ2lzdHJhci4gSXQgaXMgcHVycG9yc2VmdWxseSBsaW1pdGVkOg0KbmFtZXMgY2Fubm90IGJlIHNpeCBsZXR0ZXJzIG9yIHNob3J0ZXIsIG5ldyBhdWN0aW9ucyB3aWxsIHN0b3AgYWZ0ZXIgNCB5ZWFycy4NCg0KVGhlIHBsYW4gaXMgdG8gdGVzdCB0aGUgYmFzaWMgZmVhdHVyZXMgYW5kIHRoZW4gbW92ZSB0byBhIG5ldyBjb250cmFjdCBpbiBhdCBtb3N0DQoyIHllYXJzLCB3aGVuIHNvbWUgc29ydCBvZiByZW5ld2FsIG1lY2hhbmlzbSB3aWxsIGJlIGVuYWJsZWQuDQoqLw0KDQpjb250cmFjdCBBYnN0cmFjdEVOUyB7DQogICAgZnVuY3Rpb24gb3duZXIoYnl0ZXMzMiBub2RlKSBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpOw0KICAgIGZ1bmN0aW9uIHJlc29sdmVyKGJ5dGVzMzIgbm9kZSkgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKTsNCiAgICBmdW5jdGlvbiB0dGwoYnl0ZXMzMiBub2RlKSBjb25zdGFudCByZXR1cm5zKHVpbnQ2NCk7DQogICAgZnVuY3Rpb24gc2V0T3duZXIoYnl0ZXMzMiBub2RlLCBhZGRyZXNzIG93bmVyKTsNCiAgICBmdW5jdGlvbiBzZXRTdWJub2RlT3duZXIoYnl0ZXMzMiBub2RlLCBieXRlczMyIGxhYmVsLCBhZGRyZXNzIG93bmVyKTsNCiAgICBmdW5jdGlvbiBzZXRSZXNvbHZlcihieXRlczMyIG5vZGUsIGFkZHJlc3MgcmVzb2x2ZXIpOw0KICAgIGZ1bmN0aW9uIHNldFRUTChieXRlczMyIG5vZGUsIHVpbnQ2NCB0dGwpOw0KDQogICAgLy8gTG9nZ2VkIHdoZW4gdGhlIG93bmVyIG9mIGEgbm9kZSBhc3NpZ25zIGEgbmV3IG93bmVyIHRvIGEgc3Vibm9kZS4NCiAgICBldmVudCBOZXdPd25lcihieXRlczMyIGluZGV4ZWQgbm9kZSwgYnl0ZXMzMiBpbmRleGVkIGxhYmVsLCBhZGRyZXNzIG93bmVyKTsNCg0KICAgIC8vIExvZ2dlZCB3aGVuIHRoZSBvd25lciBvZiBhIG5vZGUgdHJhbnNmZXJzIG93bmVyc2hpcCB0byBhIG5ldyBhY2NvdW50Lg0KICAgIGV2ZW50IFRyYW5zZmVyKGJ5dGVzMzIgaW5kZXhlZCBub2RlLCBhZGRyZXNzIG93bmVyKTsNCg0KICAgIC8vIExvZ2dlZCB3aGVuIHRoZSByZXNvbHZlciBmb3IgYSBub2RlIGNoYW5nZXMuDQogICAgZXZlbnQgTmV3UmVzb2x2ZXIoYnl0ZXMzMiBpbmRleGVkIG5vZGUsIGFkZHJlc3MgcmVzb2x2ZXIpOw0KDQogICAgLy8gTG9nZ2VkIHdoZW4gdGhlIFRUTCBvZiBhIG5vZGUgY2hhbmdlcw0KICAgIGV2ZW50IE5ld1RUTChieXRlczMyIGluZGV4ZWQgbm9kZSwgdWludDY0IHR0bCk7DQp9DQoNCi8qKg0KICogQHRpdGxlIERlZWQgdG8gaG9sZCBldGhlciBpbiBleGNoYW5nZSBmb3Igb3duZXJzaGlwIG9mIGEgbm9kZQ0KICogQGRldiBUaGUgZGVlZCBjYW4gYmUgY29udHJvbGxlZCBvbmx5IGJ5IHRoZSByZWdpc3RyYXIgYW5kIGNhbiBvbmx5IHNlbmQgZXRoZXIgYmFjayB0byB0aGUgb3duZXIuDQogKi8NCmNvbnRyYWN0IERlZWQgew0KICAgIGFkZHJlc3MgcHVibGljIHJlZ2lzdHJhcjsNCiAgICBhZGRyZXNzIGNvbnN0YW50IGJ1cm4gPSAweGRlYWQ7DQogICAgdWludCBwdWJsaWMgY3JlYXRpb25EYXRlOw0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KICAgIGFkZHJlc3MgcHVibGljIHByZXZpb3VzT3duZXI7DQogICAgdWludCBwdWJsaWMgdmFsdWU7DQogICAgZXZlbnQgT3duZXJDaGFuZ2VkKGFkZHJlc3MgbmV3T3duZXIpOw0KICAgIGV2ZW50IERlZWRDbG9zZWQoKTsNCiAgICBib29sIGFjdGl2ZTsNCg0KDQogICAgbW9kaWZpZXIgb25seVJlZ2lzdHJhciB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHJlZ2lzdHJhcikgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgb25seUFjdGl2ZSB7DQogICAgICAgIGlmICghYWN0aXZlKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBEZWVkKGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHsNCiAgICAgICAgb3duZXIgPSBfb3duZXI7DQogICAgICAgIHJlZ2lzdHJhciA9IG1zZy5zZW5kZXI7DQogICAgICAgIGNyZWF0aW9uRGF0ZSA9IG5vdzsNCiAgICAgICAgYWN0aXZlID0gdHJ1ZTsNCiAgICAgICAgdmFsdWUgPSBtc2cudmFsdWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBuZXdPd25lcikgb25seVJlZ2lzdHJhciB7DQogICAgICAgIGlmIChuZXdPd25lciA9PSAwKSB0aHJvdzsNCiAgICAgICAgcHJldmlvdXNPd25lciA9IG93bmVyOyAgLy8gVGhpcyBhbGxvd3MgY29udHJhY3RzIHRvIGNoZWNrIHdobyBzZW50IHRoZW0gdGhlIG93bmVyc2hpcA0KICAgICAgICBvd25lciA9IG5ld093bmVyOw0KICAgICAgICBPd25lckNoYW5nZWQobmV3T3duZXIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldFJlZ2lzdHJhcihhZGRyZXNzIG5ld1JlZ2lzdHJhcikgb25seVJlZ2lzdHJhciB7DQogICAgICAgIHJlZ2lzdHJhciA9IG5ld1JlZ2lzdHJhcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZXRCYWxhbmNlKHVpbnQgbmV3VmFsdWUsIGJvb2wgdGhyb3dPbkZhaWx1cmUpIG9ubHlSZWdpc3RyYXIgb25seUFjdGl2ZSB7DQogICAgICAgIC8vIENoZWNrIGlmIGl0IGhhcyBlbm91Z2ggYmFsYW5jZSB0byBzZXQgdGhlIHZhbHVlDQogICAgICAgIGlmICh2YWx1ZSA8IG5ld1ZhbHVlKSB0aHJvdzsNCiAgICAgICAgdmFsdWUgPSBuZXdWYWx1ZTsNCiAgICAgICAgLy8gU2VuZCB0aGUgZGlmZmVyZW5jZSB0byB0aGUgb3duZXINCiAgICAgICAgaWYgKCFvd25lci5zZW5kKHRoaXMuYmFsYW5jZSAtIG5ld1ZhbHVlKSAmJiB0aHJvd09uRmFpbHVyZSkgdGhyb3c7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBDbG9zZSBhIGRlZWQgYW5kIHJlZnVuZCBhIHNwZWNpZmllZCBmcmFjdGlvbiBvZiB0aGUgYmlkIHZhbHVlDQogICAgICogQHBhcmFtIHJlZnVuZFJhdGlvIFRoZSBhbW91bnQqMS8xMDAwIHRvIHJlZnVuZA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNsb3NlRGVlZCh1aW50IHJlZnVuZFJhdGlvKSBvbmx5UmVnaXN0cmFyIG9ubHlBY3RpdmUgew0KICAgICAgICBhY3RpdmUgPSBmYWxzZTsNCiAgICAgICAgaWYgKCEgYnVybi5zZW5kKCgoMTAwMCAtIHJlZnVuZFJhdGlvKSAqIHRoaXMuYmFsYW5jZSkvMTAwMCkpIHRocm93Ow0KICAgICAgICBEZWVkQ2xvc2VkKCk7DQogICAgICAgIGRlc3Ryb3lEZWVkKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBDbG9zZSBhIGRlZWQgYW5kIHJlZnVuZCBhIHNwZWNpZmllZCBmcmFjdGlvbiBvZiB0aGUgYmlkIHZhbHVlDQogICAgICovDQogICAgZnVuY3Rpb24gZGVzdHJveURlZWQoKSB7DQogICAgICAgIGlmIChhY3RpdmUpIHRocm93Ow0KICAgICAgICANCiAgICAgICAgLy8gSW5zdGVhZCBvZiBzZWxmZGVzdHJ1Y3Qob3duZXIpLCBpbnZva2Ugb3duZXIgZmFsbGJhY2sgZnVuY3Rpb24gdG8gYWxsb3cNCiAgICAgICAgLy8gb3duZXIgdG8gbG9nIGFuIGV2ZW50IGlmIGRlc2lyZWQ7IGJ1dCBvd25lciBzaG91bGQgYWxzbyBiZSBhd2FyZSB0aGF0DQogICAgICAgIC8vIGl0cyBmYWxsYmFjayBmdW5jdGlvbiBjYW4gYWxzbyBiZSBpbnZva2VkIGJ5IHNldEJhbGFuY2UNCiAgICAgICAgaWYob3duZXIuc2VuZCh0aGlzLmJhbGFuY2UpKSB7DQogICAgICAgICAgICBzZWxmZGVzdHJ1Y3QoYnVybik7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8qKg0KICogQHRpdGxlIFJlZ2lzdHJhcg0KICogQGRldiBUaGUgcmVnaXN0cmFyIGhhbmRsZXMgdGhlIGF1Y3Rpb24gcHJvY2VzcyBmb3IgZWFjaCBzdWJub2RlIG9mIHRoZSBub2RlIGl0IG93bnMuDQogKi8NCmNvbnRyYWN0IFJlZ2lzdHJhciB7DQogICAgQWJzdHJhY3RFTlMgcHVibGljIGVuczsNCiAgICBieXRlczMyIHB1YmxpYyByb290Tm9kZTsNCg0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gZW50cnkpIF9lbnRyaWVzOw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyhieXRlczMyID0+IERlZWQpKSBwdWJsaWMgc2VhbGVkQmlkczsNCiAgICANCiAgICBlbnVtIE1vZGUgeyBPcGVuLCBBdWN0aW9uLCBPd25lZCwgRm9yYmlkZGVuLCBSZXZlYWwsIE5vdFlldEF2YWlsYWJsZSB9DQoNCiAgICB1aW50MzIgY29uc3RhbnQgdG90YWxBdWN0aW9uTGVuZ3RoID0gNSBkYXlzOw0KICAgIHVpbnQzMiBjb25zdGFudCByZXZlYWxQZXJpb2QgPSA0OCBob3VyczsNCiAgICB1aW50MzIgcHVibGljIGNvbnN0YW50IGxhdW5jaExlbmd0aCA9IDggd2Vla3M7DQoNCiAgICB1aW50IGNvbnN0YW50IG1pblByaWNlID0gMC4wMSBldGhlcjsNCiAgICB1aW50IHB1YmxpYyByZWdpc3RyeVN0YXJ0ZWQ7DQoNCiAgICBldmVudCBBdWN0aW9uU3RhcnRlZChieXRlczMyIGluZGV4ZWQgaGFzaCwgdWludCByZWdpc3RyYXRpb25EYXRlKTsNCiAgICBldmVudCBOZXdCaWQoYnl0ZXMzMiBpbmRleGVkIGhhc2gsIGFkZHJlc3MgaW5kZXhlZCBiaWRkZXIsIHVpbnQgZGVwb3NpdCk7DQogICAgZXZlbnQgQmlkUmV2ZWFsZWQoYnl0ZXMzMiBpbmRleGVkIGhhc2gsIGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludCB2YWx1ZSwgdWludDggc3RhdHVzKTsNCiAgICBldmVudCBIYXNoUmVnaXN0ZXJlZChieXRlczMyIGluZGV4ZWQgaGFzaCwgYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50IHZhbHVlLCB1aW50IHJlZ2lzdHJhdGlvbkRhdGUpOw0KICAgIGV2ZW50IEhhc2hSZWxlYXNlZChieXRlczMyIGluZGV4ZWQgaGFzaCwgdWludCB2YWx1ZSk7DQogICAgZXZlbnQgSGFzaEludmFsaWRhdGVkKGJ5dGVzMzIgaW5kZXhlZCBoYXNoLCBzdHJpbmcgaW5kZXhlZCBuYW1lLCB1aW50IHZhbHVlLCB1aW50IHJlZ2lzdHJhdGlvbkRhdGUpOw0KDQogICAgc3RydWN0IGVudHJ5IHsNCiAgICAgICAgRGVlZCBkZWVkOw0KICAgICAgICB1aW50IHJlZ2lzdHJhdGlvbkRhdGU7DQogICAgICAgIHVpbnQgdmFsdWU7DQogICAgICAgIHVpbnQgaGlnaGVzdEJpZDsNCiAgICB9DQoNCiAgICAvLyBTdGF0ZSB0cmFuc2l0aW9ucyBmb3IgbmFtZXM6DQogICAgLy8gICBPcGVuIC0+IEF1Y3Rpb24gKHN0YXJ0QXVjdGlvbikNCiAgICAvLyAgIEF1Y3Rpb24gLT4gUmV2ZWFsDQogICAgLy8gICBSZXZlYWwgLT4gT3duZWQNCiAgICAvLyAgIFJldmVhbCAtPiBPcGVuIChpZiBub2JvZHkgYmlkKQ0KICAgIC8vICAgT3duZWQgLT4gT3BlbiAocmVsZWFzZURlZWQgb3IgaW52YWxpZGF0ZU5hbWUpDQogICAgZnVuY3Rpb24gc3RhdGUoYnl0ZXMzMiBfaGFzaCkgY29uc3RhbnQgcmV0dXJucyAoTW9kZSkgew0KICAgICAgICB2YXIgZW50cnkgPSBfZW50cmllc1tfaGFzaF07DQogICAgICAgIA0KICAgICAgICBpZighaXNBbGxvd2VkKF9oYXNoLCBub3cpKSB7DQogICAgICAgICAgICByZXR1cm4gTW9kZS5Ob3RZZXRBdmFpbGFibGU7DQogICAgICAgIH0gZWxzZSBpZihub3cgPCBlbnRyeS5yZWdpc3RyYXRpb25EYXRlKSB7DQogICAgICAgICAgICBpZiAobm93IDwgZW50cnkucmVnaXN0cmF0aW9uRGF0ZSAtIHJldmVhbFBlcmlvZCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBNb2RlLkF1Y3Rpb247DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBNb2RlLlJldmVhbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmKGVudHJ5LmhpZ2hlc3RCaWQgPT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBNb2RlLk9wZW47DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBNb2RlLk93bmVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgbW9kaWZpZXIgaW5TdGF0ZShieXRlczMyIF9oYXNoLCBNb2RlIF9zdGF0ZSkgew0KICAgICAgICBpZihzdGF0ZShfaGFzaCkgIT0gX3N0YXRlKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5T3duZXIoYnl0ZXMzMiBfaGFzaCkgew0KICAgICAgICBpZiAoc3RhdGUoX2hhc2gpICE9IE1vZGUuT3duZWQgfHwgbXNnLnNlbmRlciAhPSBfZW50cmllc1tfaGFzaF0uZGVlZC5vd25lcigpKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciByZWdpc3RyeU9wZW4oKSB7DQogICAgICAgIGlmKG5vdyA8IHJlZ2lzdHJ5U3RhcnRlZCAgfHwgbm93ID4gcmVnaXN0cnlTdGFydGVkICsgNCB5ZWFycyB8fCBlbnMub3duZXIocm9vdE5vZGUpICE9IGFkZHJlc3ModGhpcykpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGVudHJpZXMoYnl0ZXMzMiBfaGFzaCkgY29uc3RhbnQgcmV0dXJucyAoTW9kZSwgYWRkcmVzcywgdWludCwgdWludCwgdWludCkgew0KICAgICAgICBlbnRyeSBoID0gX2VudHJpZXNbX2hhc2hdOw0KICAgICAgICByZXR1cm4gKHN0YXRlKF9oYXNoKSwgaC5kZWVkLCBoLnJlZ2lzdHJhdGlvbkRhdGUsIGgudmFsdWUsIGguaGlnaGVzdEJpZCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBDb25zdHJ1Y3RzIGEgbmV3IFJlZ2lzdHJhciwgd2l0aCB0aGUgcHJvdmlkZWQgYWRkcmVzcyBhcyB0aGUgb3duZXIgb2YgdGhlIHJvb3Qgbm9kZS4NCiAgICAgKiBAcGFyYW0gX2VucyBUaGUgYWRkcmVzcyBvZiB0aGUgRU5TDQogICAgICogQHBhcmFtIF9yb290Tm9kZSBUaGUgaGFzaCBvZiB0aGUgcm9vdG5vZGUuDQogICAgICovDQogICAgZnVuY3Rpb24gUmVnaXN0cmFyKEFic3RyYWN0RU5TIF9lbnMsIGJ5dGVzMzIgX3Jvb3ROb2RlLCB1aW50IF9zdGFydERhdGUpIHsNCiAgICAgICAgZW5zID0gX2VuczsNCiAgICAgICAgcm9vdE5vZGUgPSBfcm9vdE5vZGU7DQogICAgICAgIHJlZ2lzdHJ5U3RhcnRlZCA9IF9zdGFydERhdGUgPiAwID8gX3N0YXJ0RGF0ZSA6IG5vdzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG1heGltdW0gb2YgdHdvIHVuc2lnbmVkIGludGVnZXJzDQogICAgICogQHBhcmFtIGEgQSBudW1iZXIgdG8gY29tcGFyZQ0KICAgICAqIEBwYXJhbSBiIEEgbnVtYmVyIHRvIGNvbXBhcmUNCiAgICAgKiBAcmV0dXJuIFRoZSBtYXhpbXVtIG9mIHR3byB1bnNpZ25lZCBpbnRlZ2Vycw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG1heCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCBtYXgpIHsNCiAgICAgICAgaWYgKGEgPiBiKQ0KICAgICAgICAgICAgcmV0dXJuIGE7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBiOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbWluaW11bSBvZiB0d28gdW5zaWduZWQgaW50ZWdlcnMNCiAgICAgKiBAcGFyYW0gYSBBIG51bWJlciB0byBjb21wYXJlDQogICAgICogQHBhcmFtIGIgQSBudW1iZXIgdG8gY29tcGFyZQ0KICAgICAqIEByZXR1cm4gVGhlIG1pbmltdW0gb2YgdHdvIHVuc2lnbmVkIGludGVnZXJzDQogICAgICovDQogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50IG1pbikgew0KICAgICAgICBpZiAoYSA8IGIpDQogICAgICAgICAgICByZXR1cm4gYTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgYSBnaXZlbiBzdHJpbmcNCiAgICAgKiBAcGFyYW0gcyBUaGUgc3RyaW5nIHRvIG1lYXN1cmUgdGhlIGxlbmd0aCBvZg0KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgaW5wdXQgc3RyaW5nDQogICAgICovDQogICAgZnVuY3Rpb24gc3RybGVuKHN0cmluZyBzKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIC8vIFN0YXJ0aW5nIGhlcmUgbWVhbnMgdGhlIExTQiB3aWxsIGJlIHRoZSBieXRlIHdlIGNhcmUgYWJvdXQNCiAgICAgICAgdWludCBwdHI7DQogICAgICAgIHVpbnQgZW5kOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBwdHIgOj0gYWRkKHMsIDEpDQogICAgICAgICAgICBlbmQgOj0gYWRkKG1sb2FkKHMpLCBwdHIpDQogICAgICAgIH0NCiAgICAgICAgZm9yICh1aW50IGxlbiA9IDA7IHB0ciA8IGVuZDsgbGVuKyspIHsNCiAgICAgICAgICAgIHVpbnQ4IGI7DQogICAgICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHB0ciksIDB4RkYpIH0NCiAgICAgICAgICAgIGlmIChiIDwgMHg4MCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSAxOw0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDI7DQogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gMzsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGOCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSA0Ow0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEZDKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHB0ciArPSA2Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBsZW47DQogICAgfQ0KICAgIA0KICAgIC8qKiANCiAgICAgKiBAZGV2IERldGVybWluZXMgaWYgYSBuYW1lIGlzIGF2YWlsYWJsZSBmb3IgcmVnaXN0cmF0aW9uIHlldA0KICAgICAqIA0KICAgICAqIEVhY2ggbmFtZSB3aWxsIGJlIGFzc2lnbmVkIGEgcmFuZG9tIGRhdGUgaW4gd2hpY2ggaXRzIGF1Y3Rpb24gDQogICAgICogY2FuIGJlIHN0YXJ0ZWQsIGZyb20gMCB0byAxMyB3ZWVrcw0KICAgICAqIA0KICAgICAqIEBwYXJhbSBfaGFzaCBUaGUgaGFzaCB0byBzdGFydCBhbiBhdWN0aW9uIG9uDQogICAgICogQHBhcmFtIF90aW1lc3RhbXAgVGhlIHRpbWVzdGFtcCB0byBxdWVyeSBhYm91dA0KICAgICAqLw0KICAgICANCiAgICBmdW5jdGlvbiBpc0FsbG93ZWQoYnl0ZXMzMiBfaGFzaCwgdWludCBfdGltZXN0YW1wKSBjb25zdGFudCByZXR1cm5zIChib29sIGFsbG93ZWQpew0KICAgICAgICByZXR1cm4gX3RpbWVzdGFtcCA+IGdldEFsbG93ZWRUaW1lKF9oYXNoKTsNCiAgICB9DQoNCiAgICAvKiogDQogICAgICogQGRldiBSZXR1cm5zIGF2YWlsYWJsZSBkYXRlIGZvciBoYXNoDQogICAgICogDQogICAgICogQHBhcmFtIF9oYXNoIFRoZSBoYXNoIHRvIHN0YXJ0IGFuIGF1Y3Rpb24gb24NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXRBbGxvd2VkVGltZShieXRlczMyIF9oYXNoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHRpbWVzdGFtcCkgew0KICAgICAgICByZXR1cm4gcmVnaXN0cnlTdGFydGVkICsgKGxhdW5jaExlbmd0aCoodWludChfaGFzaCk+PjEyOCk+PjEyOCk7DQogICAgICAgIC8vIHJpZ2h0IHNoaWZ0IG9wZXJhdG9yOiBhID4+IGIgPT0gYSAvIDIqKmINCiAgICB9DQogICAgLyoqDQogICAgICogQGRldiBBc3NpZ24gdGhlIG93bmVyIGluIEVOUywgaWYgd2UncmUgc3RpbGwgdGhlIHJlZ2lzdHJhcg0KICAgICAqIEBwYXJhbSBfaGFzaCBoYXNoIHRvIGNoYW5nZSBvd25lcg0KICAgICAqIEBwYXJhbSBfbmV3T3duZXIgbmV3IG93bmVyIHRvIHRyYW5zZmVyIHRvDQogICAgICovDQogICAgZnVuY3Rpb24gdHJ5U2V0U3Vibm9kZU93bmVyKGJ5dGVzMzIgX2hhc2gsIGFkZHJlc3MgX25ld093bmVyKSBpbnRlcm5hbCB7DQogICAgICAgIGlmKGVucy5vd25lcihyb290Tm9kZSkgPT0gYWRkcmVzcyh0aGlzKSkNCiAgICAgICAgICAgIGVucy5zZXRTdWJub2RlT3duZXIocm9vdE5vZGUsIF9oYXNoLCBfbmV3T3duZXIpOyAgICAgICAgDQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBTdGFydCBhbiBhdWN0aW9uIGZvciBhbiBhdmFpbGFibGUgaGFzaA0KICAgICAqDQogICAgICogQW55b25lIGNhbiBzdGFydCBhbiBhdWN0aW9uIGJ5IHNlbmRpbmcgYW4gYXJyYXkgb2YgaGFzaGVzIHRoYXQgdGhleSB3YW50IHRvIGJpZCBmb3IuDQogICAgICogQXJyYXlzIGFyZSBzZW50IHNvIHRoYXQgc29tZW9uZSBjYW4gb3BlbiB1cCBhbiBhdWN0aW9uIGZvciBYIGR1bW15IGhhc2hlcyB3aGVuIHRoZXkNCiAgICAgKiBhcmUgb25seSByZWFsbHkgaW50ZXJlc3RlZCBpbiBiaWRkaW5nIGZvciBvbmUuIFRoaXMgd2lsbCBpbmNyZWFzZSB0aGUgY29zdCBmb3IgYW4NCiAgICAgKiBhdHRhY2tlciB0byBzaW1wbHkgYmlkIGJsaW5kbHkgb24gYWxsIG5ldyBhdWN0aW9ucy4gRHVtbXkgYXVjdGlvbnMgdGhhdCBhcmUNCiAgICAgKiBvcGVuIGJ1dCBub3QgYmlkIG9uIGFyZSBjbG9zZWQgYWZ0ZXIgYSB3ZWVrLg0KICAgICAqDQogICAgICogQHBhcmFtIF9oYXNoIFRoZSBoYXNoIHRvIHN0YXJ0IGFuIGF1Y3Rpb24gb24NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdGFydEF1Y3Rpb24oYnl0ZXMzMiBfaGFzaCkgcmVnaXN0cnlPcGVuKCkgew0KICAgICAgICB2YXIgbW9kZSA9IHN0YXRlKF9oYXNoKTsNCiAgICAgICAgaWYobW9kZSA9PSBNb2RlLkF1Y3Rpb24pIHJldHVybjsNCiAgICAgICAgaWYobW9kZSAhPSBNb2RlLk9wZW4pIHRocm93Ow0KDQogICAgICAgIGVudHJ5IG5ld0F1Y3Rpb24gPSBfZW50cmllc1tfaGFzaF07DQogICAgICAgIG5ld0F1Y3Rpb24ucmVnaXN0cmF0aW9uRGF0ZSA9IG5vdyArIHRvdGFsQXVjdGlvbkxlbmd0aDsNCiAgICAgICAgbmV3QXVjdGlvbi52YWx1ZSA9IDA7DQogICAgICAgIG5ld0F1Y3Rpb24uaGlnaGVzdEJpZCA9IDA7DQogICAgICAgIEF1Y3Rpb25TdGFydGVkKF9oYXNoLCBuZXdBdWN0aW9uLnJlZ2lzdHJhdGlvbkRhdGUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgU3RhcnQgbXVsdGlwbGUgYXVjdGlvbnMgZm9yIGJldHRlciBhbm9ueW1pdHkNCiAgICAgKiBAcGFyYW0gX2hhc2hlcyBBbiBhcnJheSBvZiBoYXNoZXMsIGF0IGxlYXN0IG9uZSBvZiB3aGljaCB5b3UgcHJlc3VtYWJseSB3YW50IHRvIGJpZCBvbg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHN0YXJ0QXVjdGlvbnMoYnl0ZXMzMltdIF9oYXNoZXMpICB7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9oYXNoZXMubGVuZ3RoOyBpICsrICkgew0KICAgICAgICAgICAgc3RhcnRBdWN0aW9uKF9oYXNoZXNbaV0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBIYXNoIHRoZSB2YWx1ZXMgcmVxdWlyZWQgZm9yIGEgc2VjcmV0IGJpZA0KICAgICAqIEBwYXJhbSBoYXNoIFRoZSBub2RlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGRlc2lyZWQgbmFtZWhhc2gNCiAgICAgKiBAcGFyYW0gdmFsdWUgVGhlIGJpZCBhbW91bnQNCiAgICAgKiBAcGFyYW0gc2FsdCBBIHJhbmRvbSB2YWx1ZSB0byBlbnN1cmUgc2VjcmVjeSBvZiB0aGUgYmlkDQogICAgICogQHJldHVybiBUaGUgaGFzaCBvZiB0aGUgYmlkIHZhbHVlcw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNoYUJpZChieXRlczMyIGhhc2gsIGFkZHJlc3Mgb3duZXIsIHVpbnQgdmFsdWUsIGJ5dGVzMzIgc2FsdCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMiBzZWFsZWRCaWQpIHsNCiAgICAgICAgcmV0dXJuIHNoYTMoaGFzaCwgb3duZXIsIHZhbHVlLCBzYWx0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFN1Ym1pdCBhIG5ldyBzZWFsZWQgYmlkIG9uIGEgZGVzaXJlZCBoYXNoIGluIGEgYmxpbmQgYXVjdGlvbg0KICAgICAqDQogICAgICogQmlkcyBhcmUgc2VudCBieSBzZW5kaW5nIGEgbWVzc2FnZSB0byB0aGUgbWFpbiBjb250cmFjdCB3aXRoIGEgaGFzaCBhbmQgYW4gYW1vdW50LiBUaGUgaGFzaA0KICAgICAqIGNvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IHRoZSBiaWQsIGluY2x1ZGluZyB0aGUgYmlkZGVkIGhhc2gsIHRoZSBiaWQgYW1vdW50LCBhbmQgYSByYW5kb20NCiAgICAgKiBzYWx0LiBCaWRzIGFyZSBub3QgdGllZCB0byBhbnkgb25lIGF1Y3Rpb24gdW50aWwgdGhleSBhcmUgcmV2ZWFsZWQuIFRoZSB2YWx1ZSBvZiB0aGUgYmlkDQogICAgICogaXRzZWxmIGNhbiBiZSBtYXNxdWVyYWRlZCBieSBzZW5kaW5nIG1vcmUgdGhhbiB0aGUgdmFsdWUgb2YgeW91ciBhY3R1YWwgYmlkLiBUaGlzIGlzDQogICAgICogZm9sbG93ZWQgYnkgYSA0OGggcmV2ZWFsIHBlcmlvZC4gQmlkcyByZXZlYWxlZCBhZnRlciB0aGlzIHBlcmlvZCB3aWxsIGJlIGJ1cm5lZCBhbmQgdGhlIGV0aGVyIHVucmVjb3ZlcmFibGUuDQogICAgICogU2luY2UgdGhpcyBpcyBhbiBhdWN0aW9uLCBpdCBpcyBleHBlY3RlZCB0aGF0IG1vc3QgcHVibGljIGhhc2hlcywgbGlrZSBrbm93biBkb21haW5zIGFuZCBjb21tb24gZGljdGlvbmFyeQ0KICAgICAqIHdvcmRzLCB3aWxsIGhhdmUgbXVsdGlwbGUgYmlkZGVycyBwdXNoaW5nIHRoZSBwcmljZSB1cC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBzZWFsZWRCaWQgQSBzZWFsZWRCaWQsIGNyZWF0ZWQgYnkgdGhlIHNoYUJpZCBmdW5jdGlvbg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG5ld0JpZChieXRlczMyIHNlYWxlZEJpZCkgcGF5YWJsZSB7DQogICAgICAgIGlmIChhZGRyZXNzKHNlYWxlZEJpZHNbbXNnLnNlbmRlcl1bc2VhbGVkQmlkXSkgPiAwICkgdGhyb3c7DQogICAgICAgIGlmIChtc2cudmFsdWUgPCBtaW5QcmljZSkgdGhyb3c7DQogICAgICAgIC8vIGNyZWF0ZXMgYSBuZXcgaGFzaCBjb250cmFjdCB3aXRoIHRoZSBvd25lcg0KICAgICAgICBEZWVkIG5ld0JpZCA9IChuZXcgRGVlZCkudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKTsNCiAgICAgICAgc2VhbGVkQmlkc1ttc2cuc2VuZGVyXVtzZWFsZWRCaWRdID0gbmV3QmlkOw0KICAgICAgICBOZXdCaWQoc2VhbGVkQmlkLCBtc2cuc2VuZGVyLCBtc2cudmFsdWUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgU3RhcnQgYSBzZXQgb2YgYXVjdGlvbnMgYW5kIGJpZCBvbiBvbmUgb2YgdGhlbQ0KICAgICAqDQogICAgICogVGhpcyBtZXRob2QgZnVuY3Rpb25zIGlkZW50aWNhbGx5IHRvIGNhbGxpbmcgYHN0YXJ0QXVjdGlvbnNgIGZvbGxvd2VkIGJ5IGBuZXdCaWRgLA0KICAgICAqIGJ1dCBhbGwgaW4gb25lIHRyYW5zYWN0aW9uLg0KICAgICAqIEBwYXJhbSBoYXNoZXMgQSBsaXN0IG9mIGhhc2hlcyB0byBzdGFydCBhdWN0aW9ucyBvbi4NCiAgICAgKiBAcGFyYW0gc2VhbGVkQmlkIEEgc2VhbGVkIGJpZCBmb3Igb25lIG9mIHRoZSBhdWN0aW9ucy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdGFydEF1Y3Rpb25zQW5kQmlkKGJ5dGVzMzJbXSBoYXNoZXMsIGJ5dGVzMzIgc2VhbGVkQmlkKSBwYXlhYmxlIHsNCiAgICAgICAgc3RhcnRBdWN0aW9ucyhoYXNoZXMpOw0KICAgICAgICBuZXdCaWQoc2VhbGVkQmlkKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFN1Ym1pdCB0aGUgcHJvcGVydGllcyBvZiBhIGJpZCB0byByZXZlYWwgdGhlbQ0KICAgICAqIEBwYXJhbSBfaGFzaCBUaGUgbm9kZSBpbiB0aGUgc2VhbGVkQmlkDQogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYmlkIGFtb3VudCBpbiB0aGUgc2VhbGVkQmlkDQogICAgICogQHBhcmFtIF9zYWx0IFRoZSBzYWxlIGluIHRoZSBzZWFsZWRCaWQNCiAgICAgKi8NCiAgICBmdW5jdGlvbiB1bnNlYWxCaWQoYnl0ZXMzMiBfaGFzaCwgdWludCBfdmFsdWUsIGJ5dGVzMzIgX3NhbHQpIHsNCiAgICAgICAgYnl0ZXMzMiBzZWFsID0gc2hhQmlkKF9oYXNoLCBtc2cuc2VuZGVyLCBfdmFsdWUsIF9zYWx0KTsNCiAgICAgICAgRGVlZCBiaWQgPSBzZWFsZWRCaWRzW21zZy5zZW5kZXJdW3NlYWxdOw0KICAgICAgICBpZiAoYWRkcmVzcyhiaWQpID09IDAgKSB0aHJvdzsNCiAgICAgICAgc2VhbGVkQmlkc1ttc2cuc2VuZGVyXVtzZWFsXSA9IERlZWQoMCk7DQogICAgICAgIGVudHJ5IGggPSBfZW50cmllc1tfaGFzaF07DQogICAgICAgIHVpbnQgdmFsdWUgPSBtaW4oX3ZhbHVlLCBiaWQudmFsdWUoKSk7DQogICAgICAgIGJpZC5zZXRCYWxhbmNlKHZhbHVlLCB0cnVlKTsNCg0KICAgICAgICB2YXIgYXVjdGlvblN0YXRlID0gc3RhdGUoX2hhc2gpOw0KICAgICAgICBpZihhdWN0aW9uU3RhdGUgPT0gTW9kZS5Pd25lZCkgew0KICAgICAgICAgICAgLy8gVG9vIGxhdGUhIEJpZGRlciBsb3NlcyB0aGVpciBiaWQuIEdldCdzIDAuNSUgYmFjay4NCiAgICAgICAgICAgIGJpZC5jbG9zZURlZWQoNSk7DQogICAgICAgICAgICBCaWRSZXZlYWxlZChfaGFzaCwgbXNnLnNlbmRlciwgdmFsdWUsIDEpOw0KICAgICAgICB9IGVsc2UgaWYoYXVjdGlvblN0YXRlICE9IE1vZGUuUmV2ZWFsKSB7DQogICAgICAgICAgICAvLyBJbnZhbGlkIHBoYXNlDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA8IG1pblByaWNlIHx8IGJpZC5jcmVhdGlvbkRhdGUoKSA+IGgucmVnaXN0cmF0aW9uRGF0ZSAtIHJldmVhbFBlcmlvZCkgew0KICAgICAgICAgICAgLy8gQmlkIHRvbyBsb3cgb3IgdG9vIGxhdGUsIHJlZnVuZCA5OS41JQ0KICAgICAgICAgICAgYmlkLmNsb3NlRGVlZCg5OTUpOw0KICAgICAgICAgICAgQmlkUmV2ZWFsZWQoX2hhc2gsIG1zZy5zZW5kZXIsIHZhbHVlLCAwKTsNCiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+IGguaGlnaGVzdEJpZCkgew0KICAgICAgICAgICAgLy8gbmV3IHdpbm5lcg0KICAgICAgICAgICAgLy8gY2FuY2VsIHRoZSBvdGhlciBiaWQsIHJlZnVuZCA5OS41JQ0KICAgICAgICAgICAgaWYoYWRkcmVzcyhoLmRlZWQpICE9IDApIHsNCiAgICAgICAgICAgICAgICBEZWVkIHByZXZpb3VzV2lubmVyID0gaC5kZWVkOw0KICAgICAgICAgICAgICAgIHByZXZpb3VzV2lubmVyLmNsb3NlRGVlZCg5OTUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBzZXQgbmV3IHdpbm5lcg0KICAgICAgICAgICAgLy8gcGVyIHRoZSBydWxlcyBvZiBhIHZpY2tlcnkgYXVjdGlvbiwgdGhlIHZhbHVlIGJlY29tZXMgdGhlIHByZXZpb3VzIGhpZ2hlc3RCaWQNCiAgICAgICAgICAgIGgudmFsdWUgPSBoLmhpZ2hlc3RCaWQ7ICAvLyB3aWxsIGJlIHplcm8gaWYgdGhlcmUncyBvbmx5IDEgYmlkZGVyDQogICAgICAgICAgICBoLmhpZ2hlc3RCaWQgPSB2YWx1ZTsNCiAgICAgICAgICAgIGguZGVlZCA9IGJpZDsNCiAgICAgICAgICAgIEJpZFJldmVhbGVkKF9oYXNoLCBtc2cuc2VuZGVyLCB2YWx1ZSwgMik7DQogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPiBoLnZhbHVlKSB7DQogICAgICAgICAgICAvLyBub3Qgd2lubmVyLCBidXQgYWZmZWN0cyBzZWNvbmQgcGxhY2UNCiAgICAgICAgICAgIGgudmFsdWUgPSB2YWx1ZTsNCiAgICAgICAgICAgIGJpZC5jbG9zZURlZWQoOTk1KTsNCiAgICAgICAgICAgIEJpZFJldmVhbGVkKF9oYXNoLCBtc2cuc2VuZGVyLCB2YWx1ZSwgMyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBiaWQgZG9lc24ndCBhZmZlY3QgYXVjdGlvbg0KICAgICAgICAgICAgYmlkLmNsb3NlRGVlZCg5OTUpOw0KICAgICAgICAgICAgQmlkUmV2ZWFsZWQoX2hhc2gsIG1zZy5zZW5kZXIsIHZhbHVlLCA0KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgQ2FuY2VsIGEgYmlkDQogICAgICogQHBhcmFtIHNlYWwgVGhlIHZhbHVlIHJldHVybmVkIGJ5IHRoZSBzaGFCaWQgZnVuY3Rpb24NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjYW5jZWxCaWQoYWRkcmVzcyBiaWRkZXIsIGJ5dGVzMzIgc2VhbCkgew0KICAgICAgICBEZWVkIGJpZCA9IHNlYWxlZEJpZHNbYmlkZGVyXVtzZWFsXTsNCiAgICAgICAgDQogICAgICAgIC8vIElmIGEgc29sZSBiaWRkZXIgZG9lcyBub3QgYHVuc2VhbEJpZGAgaW4gdGltZSwgdGhleSBoYXZlIGEgZmV3IG1vcmUgZGF5cw0KICAgICAgICAvLyB3aGVyZSB0aGV5IGNhbiBjYWxsIGBzdGFydEF1Y3Rpb25gIChhZ2FpbikgYW5kIHRoZW4gYHVuc2VhbEJpZGAgZHVyaW5nDQogICAgICAgIC8vIHRoZSByZXZlYWxQZXJpb2QgdG8gZ2V0IGJhY2sgdGhlaXIgYmlkIHZhbHVlLg0KICAgICAgICAvLyBGb3Igc2ltcGxpY2l0eSwgdGhleSBzaG91bGQgY2FsbCBgc3RhcnRBdWN0aW9uYCB3aXRoaW4NCiAgICAgICAgLy8gOSBkYXlzICgyIHdlZWtzIC0gdG90YWxBdWN0aW9uTGVuZ3RoKSwgb3RoZXJ3aXNlIHRoZWlyIGJpZCB3aWxsIGJlDQogICAgICAgIC8vIGNhbmNlbGxhYmxlIGJ5IGFueW9uZS4NCiAgICAgICAgaWYgKGFkZHJlc3MoYmlkKSA9PSAwDQogICAgICAgICAgICB8fCBub3cgPCBiaWQuY3JlYXRpb25EYXRlKCkgKyB0b3RhbEF1Y3Rpb25MZW5ndGggKyAyIHdlZWtzKSB0aHJvdzsNCg0KICAgICAgICAvLyBTZW5kIHRoZSBjYW5jZWxsZXIgMC41JSBvZiB0aGUgYmlkLCBhbmQgYnVybiB0aGUgcmVzdC4NCiAgICAgICAgYmlkLnNldE93bmVyKG1zZy5zZW5kZXIpOw0KICAgICAgICBiaWQuY2xvc2VEZWVkKDUpOw0KICAgICAgICBzZWFsZWRCaWRzW2JpZGRlcl1bc2VhbF0gPSBEZWVkKDApOw0KICAgICAgICBCaWRSZXZlYWxlZChzZWFsLCBiaWRkZXIsIDAsIDUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgRmluYWxpemUgYW4gYXVjdGlvbiBhZnRlciB0aGUgcmVnaXN0cmF0aW9uIGRhdGUgaGFzIHBhc3NlZA0KICAgICAqIEBwYXJhbSBfaGFzaCBUaGUgaGFzaCBvZiB0aGUgbmFtZSB0aGUgYXVjdGlvbiBpcyBmb3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBmaW5hbGl6ZUF1Y3Rpb24oYnl0ZXMzMiBfaGFzaCkgb25seU93bmVyKF9oYXNoKSB7DQogICAgICAgIGVudHJ5IGggPSBfZW50cmllc1tfaGFzaF07DQogICAgICAgIA0KICAgICAgICAvLyBoYW5kbGVzIHRoZSBjYXNlIHdoZW4gdGhlcmUncyBvbmx5IGEgc2luZ2xlIGJpZGRlciAoaC52YWx1ZSBpcyB6ZXJvKQ0KICAgICAgICBoLnZhbHVlID0gIG1heChoLnZhbHVlLCBtaW5QcmljZSk7DQogICAgICAgIGguZGVlZC5zZXRCYWxhbmNlKGgudmFsdWUsIHRydWUpOw0KDQogICAgICAgIHRyeVNldFN1Ym5vZGVPd25lcihfaGFzaCwgaC5kZWVkLm93bmVyKCkpOw0KICAgICAgICBIYXNoUmVnaXN0ZXJlZChfaGFzaCwgaC5kZWVkLm93bmVyKCksIGgudmFsdWUsIGgucmVnaXN0cmF0aW9uRGF0ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBUaGUgb3duZXIgb2YgYSBkb21haW4gbWF5IHRyYW5zZmVyIGl0IHRvIHNvbWVvbmUgZWxzZSBhdCBhbnkgdGltZS4NCiAgICAgKiBAcGFyYW0gX2hhc2ggVGhlIG5vZGUgdG8gdHJhbnNmZXINCiAgICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvDQogICAgICovDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYnl0ZXMzMiBfaGFzaCwgYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyKF9oYXNoKSB7DQogICAgICAgIGlmIChuZXdPd25lciA9PSAwKSB0aHJvdzsNCg0KICAgICAgICBlbnRyeSBoID0gX2VudHJpZXNbX2hhc2hdOw0KICAgICAgICBoLmRlZWQuc2V0T3duZXIobmV3T3duZXIpOw0KICAgICAgICB0cnlTZXRTdWJub2RlT3duZXIoX2hhc2gsIG5ld093bmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IEFmdGVyIHNvbWUgdGltZSwgb3IgaWYgd2UncmUgbm8gbG9uZ2VyIHRoZSByZWdpc3RyYXIsIHRoZSBvd25lciBjYW4gcmVsZWFzZQ0KICAgICAqICAgICAgdGhlIG5hbWUgYW5kIGdldCB0aGVpciBldGhlciBiYWNrLg0KICAgICAqIEBwYXJhbSBfaGFzaCBUaGUgbm9kZSB0byByZWxlYXNlDQogICAgICovDQogICAgZnVuY3Rpb24gcmVsZWFzZURlZWQoYnl0ZXMzMiBfaGFzaCkgb25seU93bmVyKF9oYXNoKSB7DQogICAgICAgIGVudHJ5IGggPSBfZW50cmllc1tfaGFzaF07DQogICAgICAgIERlZWQgZGVlZENvbnRyYWN0ID0gaC5kZWVkOw0KICAgICAgICBpZihub3cgPCBoLnJlZ2lzdHJhdGlvbkRhdGUgKyAxIHllYXJzICYmIGVucy5vd25lcihyb290Tm9kZSkgPT0gYWRkcmVzcyh0aGlzKSkgdGhyb3c7DQoNCiAgICAgICAgaC52YWx1ZSA9IDA7DQogICAgICAgIGguaGlnaGVzdEJpZCA9IDA7DQogICAgICAgIGguZGVlZCA9IERlZWQoMCk7DQoNCiAgICAgICAgX3RyeUVyYXNlU2luZ2xlTm9kZShfaGFzaCk7DQogICAgICAgIGRlZWRDb250cmFjdC5jbG9zZURlZWQoMTAwMCk7DQogICAgICAgIEhhc2hSZWxlYXNlZChfaGFzaCwgaC52YWx1ZSk7ICAgICAgICANCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFN1Ym1pdCBhIG5hbWUgNiBjaGFyYWN0ZXJzIGxvbmcgb3IgbGVzcy4gSWYgaXQgaGFzIGJlZW4gcmVnaXN0ZXJlZCwNCiAgICAgKiB0aGUgc3VibWl0dGVyIHdpbGwgZWFybiA1MCUgb2YgdGhlIGRlZWQgdmFsdWUuIFdlIGFyZSBwdXJwb3NlZnVsbHkNCiAgICAgKiBoYW5kaWNhcHBpbmcgdGhlIHNpbXBsaWZpZWQgcmVnaXN0cmFyIGFzIGEgd2F5IHRvIGZvcmNlIGl0IGludG8gYmVpbmcgcmVzdHJ1Y3R1cmVkDQogICAgICogaW4gYSBmZXcgeWVhcnMuDQogICAgICogQHBhcmFtIHVuaGFzaGVkTmFtZSBBbiBpbnZhbGlkIG5hbWUgdG8gc2VhcmNoIGZvciBpbiB0aGUgcmVnaXN0cnkuDQogICAgICoNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpbnZhbGlkYXRlTmFtZShzdHJpbmcgdW5oYXNoZWROYW1lKSBpblN0YXRlKHNoYTModW5oYXNoZWROYW1lKSwgTW9kZS5Pd25lZCkgew0KICAgICAgICBpZiAoc3RybGVuKHVuaGFzaGVkTmFtZSkgPiA2ICkgdGhyb3c7DQogICAgICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTModW5oYXNoZWROYW1lKTsNCg0KICAgICAgICBlbnRyeSBoID0gX2VudHJpZXNbaGFzaF07DQoNCiAgICAgICAgX3RyeUVyYXNlU2luZ2xlTm9kZShoYXNoKTsNCg0KICAgICAgICBpZihhZGRyZXNzKGguZGVlZCkgIT0gMCkgew0KICAgICAgICAgICAgLy8gUmV3YXJkIHRoZSBkaXNjb3ZlcmVyIHdpdGggNTAlIG9mIHRoZSBkZWVkDQogICAgICAgICAgICAvLyBUaGUgcHJldmlvdXMgb3duZXIgZ2V0cyA1MCUNCiAgICAgICAgICAgIGgudmFsdWUgPSBtYXgoaC52YWx1ZSwgbWluUHJpY2UpOw0KICAgICAgICAgICAgaC5kZWVkLnNldEJhbGFuY2UoaC52YWx1ZS8yLCBmYWxzZSk7DQogICAgICAgICAgICBoLmRlZWQuc2V0T3duZXIobXNnLnNlbmRlcik7DQogICAgICAgICAgICBoLmRlZWQuY2xvc2VEZWVkKDEwMDApOw0KICAgICAgICB9DQoNCiAgICAgICAgSGFzaEludmFsaWRhdGVkKGhhc2gsIHVuaGFzaGVkTmFtZSwgaC52YWx1ZSwgaC5yZWdpc3RyYXRpb25EYXRlKTsNCg0KICAgICAgICBoLnZhbHVlID0gMDsNCiAgICAgICAgaC5oaWdoZXN0QmlkID0gMDsNCiAgICAgICAgaC5kZWVkID0gRGVlZCgwKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IEFsbG93cyBhbnlvbmUgdG8gZGVsZXRlIHRoZSBvd25lciBhbmQgcmVzb2x2ZXIgcmVjb3JkcyBmb3IgYSAoc3ViZG9tYWluIG9mKSBhDQogICAgICogICAgICBuYW1lIHRoYXQgaXMgbm90IGN1cnJlbnRseSBvd25lZCBpbiB0aGUgcmVnaXN0cmFyLiBJZiBwYXNzaW5nLCBlZywgJ2Zvby5iYXIuZXRoJywNCiAgICAgKiAgICAgIHRoZSBvd25lciBhbmQgcmVzb2x2ZXIgZmllbGRzIG9uICdmb28uYmFyLmV0aCcgYW5kICdiYXIuZXRoJyB3aWxsIGFsbCBiZSBjbGVhcmVkLg0KICAgICAqIEBwYXJhbSBsYWJlbHMgQSBzZXJpZXMgb2YgbGFiZWwgaGFzaGVzIGlkZW50aWZ5aW5nIHRoZSBuYW1lIHRvIHplcm8gb3V0LCByb290ZWQgYXQgdGhlDQogICAgICogICAgICAgIHJlZ2lzdHJhcidzIHJvb3QuIE11c3QgY29udGFpbiBhdCBsZWFzdCBvbmUgZWxlbWVudC4gRm9yIGluc3RhbmNlLCB0byB6ZXJvIA0KICAgICAqICAgICAgICAnZm9vLmJhci5ldGgnIG9uIGEgcmVnaXN0cmFyIHRoYXQgb3ducyAnLmV0aCcsIHBhc3MgYW4gYXJyYXkgY29udGFpbmluZw0KICAgICAqICAgICAgICBbc2hhMygnZm9vJyksIHNoYTMoJ2JhcicpXS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBlcmFzZU5vZGUoYnl0ZXMzMltdIGxhYmVscykgew0KICAgICAgICBpZihsYWJlbHMubGVuZ3RoID09IDApIHRocm93Ow0KICAgICAgICBpZihzdGF0ZShsYWJlbHNbbGFiZWxzLmxlbmd0aCAtIDFdKSA9PSBNb2RlLk93bmVkKSB0aHJvdzsNCg0KICAgICAgICBfZXJhc2VOb2RlSGllcmFyY2h5KGxhYmVscy5sZW5ndGggLSAxLCBsYWJlbHMsIHJvb3ROb2RlKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfdHJ5RXJhc2VTaW5nbGVOb2RlKGJ5dGVzMzIgbGFiZWwpIGludGVybmFsIHsNCiAgICAgICAgaWYoZW5zLm93bmVyKHJvb3ROb2RlKSA9PSBhZGRyZXNzKHRoaXMpKSB7DQogICAgICAgICAgICBlbnMuc2V0U3Vibm9kZU93bmVyKHJvb3ROb2RlLCBsYWJlbCwgYWRkcmVzcyh0aGlzKSk7DQogICAgICAgICAgICB2YXIgbm9kZSA9IHNoYTMocm9vdE5vZGUsIGxhYmVsKTsNCiAgICAgICAgICAgIGVucy5zZXRSZXNvbHZlcihub2RlLCAwKTsNCiAgICAgICAgICAgIGVucy5zZXRPd25lcihub2RlLCAwKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9lcmFzZU5vZGVIaWVyYXJjaHkodWludCBpZHgsIGJ5dGVzMzJbXSBsYWJlbHMsIGJ5dGVzMzIgbm9kZSkgaW50ZXJuYWwgew0KICAgICAgICAvLyBUYWtlIG93bmVyc2hpcCBvZiB0aGUgbm9kZQ0KICAgICAgICBlbnMuc2V0U3Vibm9kZU93bmVyKG5vZGUsIGxhYmVsc1tpZHhdLCBhZGRyZXNzKHRoaXMpKTsNCiAgICAgICAgbm9kZSA9IHNoYTMobm9kZSwgbGFiZWxzW2lkeF0pOw0KICAgICAgICANCiAgICAgICAgLy8gUmVjdXJzZSBpZiB0aGVyZSdzIG1vcmUgbGFiZWxzDQogICAgICAgIGlmKGlkeCA+IDApDQogICAgICAgICAgICBfZXJhc2VOb2RlSGllcmFyY2h5KGlkeCAtIDEsIGxhYmVscywgbm9kZSk7DQoNCiAgICAgICAgLy8gRXJhc2UgdGhlIHJlc29sdmVyIGFuZCBvd25lciByZWNvcmRzDQogICAgICAgIGVucy5zZXRSZXNvbHZlcihub2RlLCAwKTsNCiAgICAgICAgZW5zLnNldE93bmVyKG5vZGUsIDApOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgVHJhbnNmZXJzIHRoZSBkZWVkIHRvIHRoZSBjdXJyZW50IHJlZ2lzdHJhciwgaWYgZGlmZmVyZW50IGZyb20gdGhpcyBvbmUuDQogICAgICogVXNlZCBkdXJpbmcgdGhlIHVwZ3JhZGUgcHJvY2VzcyB0byBhIHBlcm1hbmVudCByZWdpc3RyYXIuDQogICAgICogQHBhcmFtIF9oYXNoIFRoZSBuYW1lIGhhc2ggdG8gdHJhbnNmZXIuDQogICAgICovDQogICAgZnVuY3Rpb24gdHJhbnNmZXJSZWdpc3RyYXJzKGJ5dGVzMzIgX2hhc2gpIG9ubHlPd25lcihfaGFzaCkgew0KICAgICAgICB2YXIgcmVnaXN0cmFyID0gZW5zLm93bmVyKHJvb3ROb2RlKTsNCiAgICAgICAgaWYocmVnaXN0cmFyID09IGFkZHJlc3ModGhpcykpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvLyBNaWdyYXRlIHRoZSBkZWVkDQogICAgICAgIGVudHJ5IGggPSBfZW50cmllc1tfaGFzaF07DQogICAgICAgIGguZGVlZC5zZXRSZWdpc3RyYXIocmVnaXN0cmFyKTsNCg0KICAgICAgICAvLyBDYWxsIHRoZSBuZXcgcmVnaXN0cmFyIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXINCiAgICAgICAgUmVnaXN0cmFyKHJlZ2lzdHJhcikuYWNjZXB0UmVnaXN0cmFyVHJhbnNmZXIoX2hhc2gsIGguZGVlZCwgaC5yZWdpc3RyYXRpb25EYXRlKTsNCg0KICAgICAgICAvLyBaZXJvIG91dCB0aGUgZW50cnkNCiAgICAgICAgaC5kZWVkID0gRGVlZCgwKTsNCiAgICAgICAgaC5yZWdpc3RyYXRpb25EYXRlID0gMDsNCiAgICAgICAgaC52YWx1ZSA9IDA7DQogICAgICAgIGguaGlnaGVzdEJpZCA9IDA7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBBY2NlcHRzIGEgdHJhbnNmZXIgZnJvbSBhIHByZXZpb3VzIHJlZ2lzdHJhcjsgc3R1YmJlZCBvdXQgaGVyZSBzaW5jZSB0aGVyZQ0KICAgICAqICAgICAgaXMgbm8gcHJldmlvdXMgcmVnaXN0cmFyIGltcGxlbWVudGluZyB0aGlzIGludGVyZmFjZS4NCiAgICAgKiBAcGFyYW0gaGFzaCBUaGUgc2hhMyBoYXNoIG9mIHRoZSBsYWJlbCB0byB0cmFuc2Zlci4NCiAgICAgKiBAcGFyYW0gZGVlZCBUaGUgRGVlZCBvYmplY3QgZm9yIHRoZSBuYW1lIGJlaW5nIHRyYW5zZmVycmVkIGluLg0KICAgICAqIEBwYXJhbSByZWdpc3RyYXRpb25EYXRlIFRoZSBkYXRlIGF0IHdoaWNoIHRoZSBuYW1lIHdhcyBvcmlnaW5hbGx5IHJlZ2lzdGVyZWQuDQogICAgICovDQogICAgZnVuY3Rpb24gYWNjZXB0UmVnaXN0cmFyVHJhbnNmZXIoYnl0ZXMzMiBoYXNoLCBEZWVkIGRlZWQsIHVpbnQgcmVnaXN0cmF0aW9uRGF0ZSkge30NCg0KfQ=='