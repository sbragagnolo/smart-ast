base 64 content
base64registrar6
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4wOw0KDQoNCi8qDQoNClRlbXBvcmFyeSBIYXNoIFJlZ2lzdHJhciANCj09PT09PT09PT09PT09PT09PT09PT09PQ0KDQpUaGlzIGlzIGEgc2ltcGxpZmllZCB2ZXJzaW9uIG9mIGEgaGFzaCByZWdpc3RyYXIuIEl0IGlzIHB1cnBvcnNlZnVsbHkgbGltaXRlZDoNCm5hbWVzIGNhbm5vdCBiZSBzaXggbGV0dGVycyBvciBzaG9ydGVyLCBuZXcgYXVjdGlvbnMgd2lsbCBzdG9wIGFmdGVyIDQgeWVhcnMNCmFuZCBhbGwgZXRoZXIgc3RpbGwgbG9ja2VkIGFmdGVyIDggeWVhcnMgd2lsbCBiZWNvbWUgdW5yZWFjaGFibGUuDQoNClRoZSBwbGFuIGlzIHRvIHRlc3QgdGhlIGJhc2ljIGZlYXR1cmVzIGFuZCB0aGVuIG1vdmUgdG8gYSBuZXcgY29udHJhY3QgaW4gYXQgbW9zdA0KMiB5ZWFycywgd2hlbiBzb21lIHNvcnQgb2YgcmVuZXdhbCBtZWNoYW5pc20gd2lsbCBiZSBlbmFibGVkLg0KKi8NCg0KY29udHJhY3QgQWJzdHJhY3RFTlMgew0KICAgIGZ1bmN0aW9uIG93bmVyKGJ5dGVzMzIgbm9kZSkgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKTsNCiAgICBmdW5jdGlvbiByZXNvbHZlcihieXRlczMyIG5vZGUpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcyk7DQogICAgZnVuY3Rpb24gdHRsKGJ5dGVzMzIgbm9kZSkgY29uc3RhbnQgcmV0dXJucyh1aW50NjQpOw0KICAgIGZ1bmN0aW9uIHNldE93bmVyKGJ5dGVzMzIgbm9kZSwgYWRkcmVzcyBvd25lcik7DQogICAgZnVuY3Rpb24gc2V0U3Vibm9kZU93bmVyKGJ5dGVzMzIgbm9kZSwgYnl0ZXMzMiBsYWJlbCwgYWRkcmVzcyBvd25lcik7DQogICAgZnVuY3Rpb24gc2V0UmVzb2x2ZXIoYnl0ZXMzMiBub2RlLCBhZGRyZXNzIHJlc29sdmVyKTsNCiAgICBmdW5jdGlvbiBzZXRUVEwoYnl0ZXMzMiBub2RlLCB1aW50NjQgdHRsKTsNCg0KICAgIGV2ZW50IFRyYW5zZmVyKGJ5dGVzMzIgaW5kZXhlZCBub2RlLCBhZGRyZXNzIG93bmVyKTsNCiAgICBldmVudCBOZXdPd25lcihieXRlczMyIGluZGV4ZWQgbm9kZSwgYnl0ZXMzMiBpbmRleGVkIGxhYmVsLCBhZGRyZXNzIG93bmVyKTsNCiAgICBldmVudCBOZXdSZXNvbHZlcihieXRlczMyIGluZGV4ZWQgbm9kZSwgYWRkcmVzcyByZXNvbHZlcik7DQogICAgZXZlbnQgTmV3VFRMKGJ5dGVzMzIgaW5kZXhlZCBub2RlLCB1aW50NjQgdHRsKTsNCn0NCg0KLyoqDQogKiBAdGl0bGUgRGVlZCB0byBob2xkIGV0aGVyIGluIGV4Y2hhbmdlIGZvciBvd25lcnNoaXAgb2YgYSBub2RlDQogKiBAZGV2IFRoZSBkZWVkIGNhbiBiZSBjb250cm9sbGVkIG9ubHkgYnkgdGhlIHJlZ2lzdHJhciBhbmQgY2FuIG9ubHkgc2VuZCBldGhlciBiYWNrIHRvIHRoZSBvd25lci4NCiAqLw0KY29udHJhY3QgRGVlZCB7DQogICAgYWRkcmVzcyBwdWJsaWMgcmVnaXN0cmFyOw0KICAgIGFkZHJlc3MgY29uc3RhbnQgYnVybiA9IDB4ZGVhZDsNCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkRhdGU7DQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQogICAgYWRkcmVzcyBwdWJsaWMgcHJldmlvdXNPd25lcjsNCiAgICB1aW50IHB1YmxpYyB2YWx1ZTsNCiAgICBldmVudCBPd25lckNoYW5nZWQoYWRkcmVzcyBuZXdPd25lcik7DQogICAgZXZlbnQgRGVlZENsb3NlZCgpOw0KICAgIGJvb2wgYWN0aXZlOw0KDQoNCiAgICBtb2RpZmllciBvbmx5UmVnaXN0cmFyIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gcmVnaXN0cmFyKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5QWN0aXZlIHsNCiAgICAgICAgaWYgKCFhY3RpdmUpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIERlZWQodWludCBfdmFsdWUpIHsNCiAgICAgICAgcmVnaXN0cmFyID0gbXNnLnNlbmRlcjsNCiAgICAgICAgY3JlYXRpb25EYXRlID0gbm93Ow0KICAgICAgICBhY3RpdmUgPSB0cnVlOw0KICAgICAgICB2YWx1ZSA9IF92YWx1ZTsNCiAgICB9DQogICAgICAgIA0KICAgIGZ1bmN0aW9uIHNldE93bmVyKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlSZWdpc3RyYXIgew0KICAgICAgICAvLyBzbyBjb250cmFjdHMgY2FuIGNoZWNrIHdobyBzZW50IHRoZW0gdGhlIG93bmVyc2hpcA0KICAgICAgICBwcmV2aW91c093bmVyID0gb3duZXI7DQogICAgICAgIG93bmVyID0gbmV3T3duZXI7DQogICAgICAgIE93bmVyQ2hhbmdlZChuZXdPd25lcik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0UmVnaXN0cmFyKGFkZHJlc3MgbmV3UmVnaXN0cmFyKSBvbmx5UmVnaXN0cmFyIHsNCiAgICAgICAgcmVnaXN0cmFyID0gbmV3UmVnaXN0cmFyOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBzZXRCYWxhbmNlKHVpbnQgbmV3VmFsdWUpIG9ubHlSZWdpc3RyYXIgb25seUFjdGl2ZSBwYXlhYmxlIHsNCiAgICAgICAgLy8gQ2hlY2sgaWYgaXQgaGFzIGVub3VnaCBiYWxhbmNlIHRvIHNldCB0aGUgdmFsdWUNCiAgICAgICAgaWYgKHZhbHVlIDwgbmV3VmFsdWUpIHRocm93Ow0KICAgICAgICB2YWx1ZSA9IG5ld1ZhbHVlOw0KICAgICAgICAvLyBTZW5kIHRoZSBkaWZmZXJlbmNlIHRvIHRoZSBvd25lcg0KICAgICAgICBpZiAoIW93bmVyLnNlbmQodGhpcy5iYWxhbmNlIC0gbmV3VmFsdWUpKSB0aHJvdzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IENsb3NlIGEgZGVlZCBhbmQgcmVmdW5kIGEgc3BlY2lmaWVkIGZyYWN0aW9uIG9mIHRoZSBiaWQgdmFsdWUNCiAgICAgKiBAcGFyYW0gcmVmdW5kUmF0aW8gVGhlIGFtb3VudCoxLzEwMDAgdG8gcmVmdW5kDQogICAgICovDQogICAgZnVuY3Rpb24gY2xvc2VEZWVkKHVpbnQgcmVmdW5kUmF0aW8pIG9ubHlSZWdpc3RyYXIgb25seUFjdGl2ZSB7DQogICAgICAgIGFjdGl2ZSA9IGZhbHNlOyAgICAgICAgICAgIA0KICAgICAgICBpZiAoISBidXJuLnNlbmQoKCgxMDAwIC0gcmVmdW5kUmF0aW8pICogdGhpcy5iYWxhbmNlKS8xMDAwKSkgdGhyb3c7DQogICAgICAgIERlZWRDbG9zZWQoKTsNCiAgICAgICAgZGVzdHJveURlZWQoKTsNCiAgICB9ICAgIA0KDQogICAgLyoqDQogICAgICogQGRldiBDbG9zZSBhIGRlZWQgYW5kIHJlZnVuZCBhIHNwZWNpZmllZCBmcmFjdGlvbiBvZiB0aGUgYmlkIHZhbHVlDQogICAgICovDQogICAgZnVuY3Rpb24gZGVzdHJveURlZWQoKSB7DQogICAgICAgIGlmIChhY3RpdmUpIHRocm93Ow0KICAgICAgICBpZihvd25lci5zZW5kKHRoaXMuYmFsYW5jZSkpDQogICAgICAgICAgICBzZWxmZGVzdHJ1Y3QoYnVybik7DQogICAgfQ0KDQogICAgLy8gVGhlIGRlZmF1bHQgZnVuY3Rpb24ganVzdCByZWNlaXZlcyBhbiBhbW91bnQNCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHt9DQp9DQoNCi8qKg0KICogQHRpdGxlIFJlZ2lzdHJhcg0KICogQGRldiBUaGUgcmVnaXN0cmFyIGhhbmRsZXMgdGhlIGF1Y3Rpb24gcHJvY2VzcyBmb3IgZWFjaCBzdWJub2RlIG9mIHRoZSBub2RlIGl0IG93bnMuDQogKi8NCmNvbnRyYWN0IFJlZ2lzdHJhciB7DQogICAgQWJzdHJhY3RFTlMgcHVibGljIGVuczsNCiAgICBieXRlczMyIHB1YmxpYyByb290Tm9kZTsNCg0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gZW50cnkpIF9lbnRyaWVzOw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyhieXRlczMyID0+IERlZWQpKSBwdWJsaWMgc2VhbGVkQmlkczsNCiAgICANCiAgICBlbnVtIE1vZGUgeyBPcGVuLCBBdWN0aW9uLCBPd25lZCwgRm9yYmlkZGVuLCBSZXZlYWwgfQ0KICAgIHVpbnQzMiBjb25zdGFudCBhdWN0aW9uTGVuZ3RoID0gNSBkYXlzOw0KICAgIHVpbnQzMiBjb25zdGFudCByZXZlYWxQZXJpb2QgPSA0OCBob3VyczsNCiAgICB1aW50MzIgY29uc3RhbnQgaW5pdGlhbEF1Y3Rpb25QZXJpb2QgPSA0IHdlZWtzOw0KICAgIHVpbnQgY29uc3RhbnQgbWluUHJpY2UgPSAwLjAxIGV0aGVyOw0KICAgIHVpbnQgcHVibGljIHJlZ2lzdHJ5U3RhcnRlZDsNCg0KICAgIGV2ZW50IEF1Y3Rpb25TdGFydGVkKGJ5dGVzMzIgaW5kZXhlZCBoYXNoLCB1aW50IHJlZ2lzdHJhdGlvbkRhdGUpOw0KICAgIGV2ZW50IE5ld0JpZChieXRlczMyIGluZGV4ZWQgaGFzaCwgYWRkcmVzcyBpbmRleGVkIGJpZGRlciwgdWludCBkZXBvc2l0KTsNCiAgICBldmVudCBCaWRSZXZlYWxlZChieXRlczMyIGluZGV4ZWQgaGFzaCwgYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50IHZhbHVlLCB1aW50OCBzdGF0dXMpOw0KICAgIGV2ZW50IEhhc2hSZWdpc3RlcmVkKGJ5dGVzMzIgaW5kZXhlZCBoYXNoLCBhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgdmFsdWUsIHVpbnQgcmVnaXN0cmF0aW9uRGF0ZSk7DQogICAgZXZlbnQgSGFzaFJlbGVhc2VkKGJ5dGVzMzIgaW5kZXhlZCBoYXNoLCB1aW50IHZhbHVlKTsNCiAgICBldmVudCBIYXNoSW52YWxpZGF0ZWQoYnl0ZXMzMiBpbmRleGVkIGhhc2gsIHN0cmluZyBpbmRleGVkIG5hbWUsIHVpbnQgdmFsdWUsIHVpbnQgcmVnaXN0cmF0aW9uRGF0ZSk7DQoNCiAgICBzdHJ1Y3QgZW50cnkgew0KICAgICAgICBEZWVkIGRlZWQ7DQogICAgICAgIHVpbnQgcmVnaXN0cmF0aW9uRGF0ZTsNCiAgICAgICAgdWludCB2YWx1ZTsNCiAgICAgICAgdWludCBoaWdoZXN0QmlkOw0KICAgIH0NCg0KICAgIC8vIFN0YXRlIHRyYW5zaXRpb25zIGZvciBuYW1lczoNCiAgICAvLyAgIE9wZW4gLT4gQXVjdGlvbiAoc3RhcnRBdWN0aW9uKQ0KICAgIC8vICAgQXVjdGlvbiAtPiBSZXZlYWwNCiAgICAvLyAgIFJldmVhbCAtPiBPd25lZA0KICAgIC8vICAgUmV2ZWFsIC0+IE9wZW4gKGlmIG5vYm9keSBiaWQpDQogICAgLy8gICBPd25lZCAtPiBGb3JiaWRkZW4gKGludmFsaWRhdGVOYW1lKQ0KICAgIC8vICAgT3duZWQgLT4gT3BlbiAocmVsZWFzZURlZWQpDQogICAgZnVuY3Rpb24gc3RhdGUoYnl0ZXMzMiBfaGFzaCkgY29uc3RhbnQgcmV0dXJucyAoTW9kZSkgew0KICAgICAgICB2YXIgZW50cnkgPSBfZW50cmllc1tfaGFzaF07DQogICAgICAgIGlmKG5vdyA8IGVudHJ5LnJlZ2lzdHJhdGlvbkRhdGUpIHsNCiAgICAgICAgICAgIGlmKG5vdyA8IGVudHJ5LnJlZ2lzdHJhdGlvbkRhdGUgLSByZXZlYWxQZXJpb2QpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gTW9kZS5BdWN0aW9uOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gTW9kZS5SZXZlYWw7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZihlbnRyeS5oaWdoZXN0QmlkID09IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gTW9kZS5PcGVuOw0KICAgICAgICAgICAgfSBlbHNlIGlmKGVudHJ5LmRlZWQgPT0gRGVlZCgwKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBNb2RlLkZvcmJpZGRlbjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIE1vZGUuT3duZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgbW9kaWZpZXIgaW5TdGF0ZShieXRlczMyIF9oYXNoLCBNb2RlIF9zdGF0ZSkgew0KICAgICAgICBpZihzdGF0ZShfaGFzaCkgIT0gX3N0YXRlKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5T3duZXIoYnl0ZXMzMiBfaGFzaCkgew0KICAgICAgICBpZiAoc3RhdGUoX2hhc2gpICE9IE1vZGUuT3duZWQgfHwgbXNnLnNlbmRlciAhPSBfZW50cmllc1tfaGFzaF0uZGVlZC5vd25lcigpKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQogICAgDQogICAgbW9kaWZpZXIgcmVnaXN0cnlPcGVuKCkgew0KICAgICAgICBpZihub3cgPCByZWdpc3RyeVN0YXJ0ZWQgIHx8IG5vdyA+IHJlZ2lzdHJ5U3RhcnRlZCArIDQgeWVhcnMgfHwgZW5zLm93bmVyKHJvb3ROb2RlKSAhPSBhZGRyZXNzKHRoaXMpKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gZW50cmllcyhieXRlczMyIF9oYXNoKSBjb25zdGFudCByZXR1cm5zIChNb2RlLCBhZGRyZXNzLCB1aW50LCB1aW50LCB1aW50KSB7DQogICAgICAgIGVudHJ5IGggPSBfZW50cmllc1tfaGFzaF07DQogICAgICAgIHJldHVybiAoc3RhdGUoX2hhc2gpLCBoLmRlZWQsIGgucmVnaXN0cmF0aW9uRGF0ZSwgaC52YWx1ZSwgaC5oaWdoZXN0QmlkKTsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQGRldiBDb25zdHJ1Y3RzIGEgbmV3IFJlZ2lzdHJhciwgd2l0aCB0aGUgcHJvdmlkZWQgYWRkcmVzcyBhcyB0aGUgb3duZXIgb2YgdGhlIHJvb3Qgbm9kZS4NCiAgICAgKiBAcGFyYW0gX2VucyBUaGUgYWRkcmVzcyBvZiB0aGUgRU5TDQogICAgICogQHBhcmFtIF9yb290Tm9kZSBUaGUgaGFzaCBvZiB0aGUgcm9vdG5vZGUuDQogICAgICovDQogICAgZnVuY3Rpb24gUmVnaXN0cmFyKGFkZHJlc3MgX2VucywgYnl0ZXMzMiBfcm9vdE5vZGUsIHVpbnQgX3N0YXJ0RGF0ZSkgew0KICAgICAgICBlbnMgPSBBYnN0cmFjdEVOUyhfZW5zKTsNCiAgICAgICAgcm9vdE5vZGUgPSBfcm9vdE5vZGU7DQogICAgICAgIHJlZ2lzdHJ5U3RhcnRlZCA9IF9zdGFydERhdGUgPiAwID8gX3N0YXJ0RGF0ZSA6IG5vdzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG1heGltdW0gb2YgdHdvIHVuc2lnbmVkIGludGVnZXJzDQogICAgICogQHBhcmFtIGEgQSBudW1iZXIgdG8gY29tcGFyZQ0KICAgICAqIEBwYXJhbSBiIEEgbnVtYmVyIHRvIGNvbXBhcmUNCiAgICAgKiBAcmV0dXJuIFRoZSBtYXhpbXVtIG9mIHR3byB1bnNpZ25lZCBpbnRlZ2Vycw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG1heCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCBtYXgpIHsNCiAgICAgICAgaWYgKGEgPiBiKQ0KICAgICAgICAgICAgcmV0dXJuIGE7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBiOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbWluaW11bSBvZiB0d28gdW5zaWduZWQgaW50ZWdlcnMNCiAgICAgKiBAcGFyYW0gYSBBIG51bWJlciB0byBjb21wYXJlDQogICAgICogQHBhcmFtIGIgQSBudW1iZXIgdG8gY29tcGFyZQ0KICAgICAqIEByZXR1cm4gVGhlIG1pbmltdW0gb2YgdHdvIHVuc2lnbmVkIGludGVnZXJzDQogICAgICovDQogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50IG1pbikgew0KICAgICAgICBpZiAoYSA8IGIpDQogICAgICAgICAgICByZXR1cm4gYTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgYSBnaXZlbiBzdHJpbmcNCiAgICAgKiBAcGFyYW0gcyBUaGUgc3RyaW5nIHRvIG1lYXN1cmUgdGhlIGxlbmd0aCBvZg0KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgaW5wdXQgc3RyaW5nDQogICAgICovDQogICAgZnVuY3Rpb24gc3RybGVuKHN0cmluZyBzKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIC8vIFN0YXJ0aW5nIGhlcmUgbWVhbnMgdGhlIExTQiB3aWxsIGJlIHRoZSBieXRlIHdlIGNhcmUgYWJvdXQNCiAgICAgICAgdWludCBwdHI7DQogICAgICAgIHVpbnQgZW5kOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBwdHIgOj0gYWRkKHMsIDEpDQogICAgICAgICAgICBlbmQgOj0gYWRkKG1sb2FkKHMpLCBwdHIpDQogICAgICAgIH0NCiAgICAgICAgZm9yICh1aW50IGxlbiA9IDA7IHB0ciA8IGVuZDsgbGVuKyspIHsNCiAgICAgICAgICAgIHVpbnQ4IGI7DQogICAgICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHB0ciksIDB4RkYpIH0NCiAgICAgICAgICAgIGlmIChiIDwgMHg4MCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSAxOw0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDI7DQogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gMzsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGOCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSA0Ow0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEZDKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHB0ciArPSA2Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBsZW47DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBTdGFydCBhbiBhdWN0aW9uIGZvciBhbiBhdmFpbGFibGUgaGFzaA0KICAgICAqIA0KICAgICAqIEFueW9uZSBjYW4gc3RhcnQgYW4gYXVjdGlvbiBieSBzZW5kaW5nIGFuIGFycmF5IG9mIGhhc2hlcyB0aGF0IHRoZXkgd2FudCB0byBiaWQgZm9yLiANCiAgICAgKiBBcnJheXMgYXJlIHNlbnQgc28gdGhhdCBzb21lb25lIGNhbiBvcGVuIHVwIGFuIGF1Y3Rpb24gZm9yIFggZHVtbXkgaGFzaGVzIHdoZW4gdGhleSANCiAgICAgKiBhcmUgb25seSByZWFsbHkgaW50ZXJlc3RlZCBpbiBiaWRkaW5nIGZvciBvbmUuIFRoaXMgd2lsbCBpbmNyZWFzZSB0aGUgY29zdCBmb3IgYW4gDQogICAgICogYXR0YWNrZXIgdG8gc2ltcGx5IGJpZCBibGluZGx5IG9uIGFsbCBuZXcgYXVjdGlvbnMuIER1bW15IGF1Y3Rpb25zIHRoYXQgYXJlIA0KICAgICAqIG9wZW4gYnV0IG5vdCBiaWQgb24gYXJlIGNsb3NlZCBhZnRlciBhIHdlZWsuIA0KICAgICAqDQogICAgICogQHBhcmFtIF9oYXNoIFRoZSBoYXNoIHRvIHN0YXJ0IGFuIGF1Y3Rpb24gb24NCiAgICAgKi8gICAgDQogICAgZnVuY3Rpb24gc3RhcnRBdWN0aW9uKGJ5dGVzMzIgX2hhc2gpIGluU3RhdGUoX2hhc2gsIE1vZGUuT3BlbikgcmVnaXN0cnlPcGVuKCkgew0KICAgICAgICBlbnRyeSBuZXdBdWN0aW9uID0gX2VudHJpZXNbX2hhc2hdOw0KDQogICAgICAgIC8vIGZvciB0aGUgZmlyc3QgbW9udGggb2YgdGhlIHJlZ2lzdHJ5LCBtYWtlIGxvbmdlciBhdWN0aW9ucw0KICAgICAgICBuZXdBdWN0aW9uLnJlZ2lzdHJhdGlvbkRhdGUgPSBtYXgobm93ICsgYXVjdGlvbkxlbmd0aCwgcmVnaXN0cnlTdGFydGVkICsgaW5pdGlhbEF1Y3Rpb25QZXJpb2QpOw0KICAgICAgICBuZXdBdWN0aW9uLnZhbHVlID0gMDsNCiAgICAgICAgbmV3QXVjdGlvbi5oaWdoZXN0QmlkID0gMDsNCiAgICAgICAgQXVjdGlvblN0YXJ0ZWQoX2hhc2gsIG5ld0F1Y3Rpb24ucmVnaXN0cmF0aW9uRGF0ZSk7ICAgICAgDQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBTdGFydCBtdWx0aXBsZSBhdWN0aW9ucyBmb3IgYmV0dGVyIGFub255bWl0eQ0KICAgICAqIEBwYXJhbSBfaGFzaGVzIEFuIGFycmF5IG9mIGhhc2hlcywgYXQgbGVhc3Qgb25lIG9mIHdoaWNoIHlvdSBwcmVzdW1hYmx5IHdhbnQgdG8gYmlkIG9uDQogICAgICovDQogICAgZnVuY3Rpb24gc3RhcnRBdWN0aW9ucyhieXRlczMyW10gX2hhc2hlcykgIHsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2hhc2hlcy5sZW5ndGg7IGkgKysgKSB7DQogICAgICAgICAgICBzdGFydEF1Y3Rpb24oX2hhc2hlc1tpXSk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQGRldiBIYXNoIHRoZSB2YWx1ZXMgcmVxdWlyZWQgZm9yIGEgc2VjcmV0IGJpZA0KICAgICAqIEBwYXJhbSBoYXNoIFRoZSBub2RlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGRlc2lyZWQgbmFtZWhhc2gNCiAgICAgKiBAcGFyYW0gb3duZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBvd24gdGhlIA0KICAgICAqIEBwYXJhbSB2YWx1ZSBUaGUgYmlkIGFtb3VudA0KICAgICAqIEBwYXJhbSBzYWx0IEEgcmFuZG9tIHZhbHVlIHRvIGVuc3VyZSBzZWNyZWN5IG9mIHRoZSBiaWQNCiAgICAgKiBAcmV0dXJuIFRoZSBoYXNoIG9mIHRoZSBiaWQgdmFsdWVzDQogICAgICovDQogICAgZnVuY3Rpb24gc2hhQmlkKGJ5dGVzMzIgaGFzaCwgYWRkcmVzcyBvd25lciwgdWludCB2YWx1ZSwgYnl0ZXMzMiBzYWx0KSBjb25zdGFudCByZXR1cm5zIChieXRlczMyIHNlYWxlZEJpZCkgew0KICAgICAgICByZXR1cm4gc2hhMyhoYXNoLCBvd25lciwgdmFsdWUsIHNhbHQpOw0KICAgIH0NCiAgICANCiAgICAvKioNCiAgICAgKiBAZGV2IFN1Ym1pdCBhIG5ldyBzZWFsZWQgYmlkIG9uIGEgZGVzaXJlZCBoYXNoIGluIGEgYmxpbmQgYXVjdGlvbg0KICAgICAqIA0KICAgICAqIEJpZHMgYXJlIHNlbnQgYnkgc2VuZGluZyBhIG1lc3NhZ2UgdG8gdGhlIG1haW4gY29udHJhY3Qgd2l0aCBhIGhhc2ggYW5kIGFuIGFtb3VudC4gVGhlIGhhc2ggDQogICAgICogY29udGFpbnMgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGJpZCwgaW5jbHVkaW5nIHRoZSBiaWRkZWQgaGFzaCwgdGhlIGJpZCBhbW91bnQsIGFuZCBhIHJhbmRvbSANCiAgICAgKiBzYWx0LiBCaWRzIGFyZSBub3QgdGllZCB0byBhbnkgb25lIGF1Y3Rpb24gdW50aWwgdGhleSBhcmUgcmV2ZWFsZWQuIFRoZSB2YWx1ZSBvZiB0aGUgYmlkIA0KICAgICAqIGl0c2VsZiBjYW4gYmUgbWFzcXVlcmFkZWQgYnkgc2VuZGluZyBtb3JlIHRoYW4gdGhlIHZhbHVlIG9mIHlvdXIgYWN0dWFsIGJpZC4gVGhpcyBpcyANCiAgICAgKiBmb2xsb3dlZCBieSBhIDI0aCByZXZlYWwgcGVyaW9kLiBCaWRzIHJldmVhbGVkIGFmdGVyIHRoaXMgcGVyaW9kIHdpbGwgYmUgYnVybmVkIGFuZCB0aGUgZXRoZXIgdW5yZWNvdmVyYWJsZS4gDQogICAgICogU2luY2UgdGhpcyBpcyBhbiBhdWN0aW9uLCBpdCBpcyBleHBlY3RlZCB0aGF0IG1vc3QgcHVibGljIGhhc2hlcywgbGlrZSBrbm93biBkb21haW5zIGFuZCBjb21tb24gZGljdGlvbmFyeSANCiAgICAgKiB3b3Jkcywgd2lsbCBoYXZlIG11bHRpcGxlIGJpZGRlcnMgcHVzaGluZyB0aGUgcHJpY2UgdXAuIA0KICAgICAqDQogICAgICogQHBhcmFtIHNlYWxlZEJpZCBBIHNlYWxlZEJpZCwgY3JlYXRlZCBieSB0aGUgc2hhQmlkIGZ1bmN0aW9uDQogICAgICovDQogICAgZnVuY3Rpb24gbmV3QmlkKGJ5dGVzMzIgc2VhbGVkQmlkKSBwYXlhYmxlIHsNCiAgICAgICAgaWYgKGFkZHJlc3Moc2VhbGVkQmlkc1ttc2cuc2VuZGVyXVtzZWFsZWRCaWRdKSA+IDAgKSB0aHJvdzsNCiAgICAgICAgaWYgKG1zZy52YWx1ZSA8IG1pblByaWNlKSB0aHJvdzsNCiAgICAgICAgLy8gY3JlYXRlcyBhIG5ldyBoYXNoIGNvbnRyYWN0IHdpdGggdGhlIG93bmVyDQogICAgICAgIERlZWQgbmV3QmlkID0gbmV3IERlZWQobXNnLnZhbHVlKTsNCiAgICAgICAgc2VhbGVkQmlkc1ttc2cuc2VuZGVyXVtzZWFsZWRCaWRdID0gbmV3QmlkOw0KICAgICAgICBOZXdCaWQoc2VhbGVkQmlkLCBtc2cuc2VuZGVyLCBtc2cudmFsdWUpOw0KDQogICAgICAgIGlmICghbmV3QmlkLnNlbmQobXNnLnZhbHVlKSkgdGhyb3c7DQogICAgfSANCg0KICAgIC8qKg0KICAgICAqIEBkZXYgU3VibWl0IHRoZSBwcm9wZXJ0aWVzIG9mIGEgYmlkIHRvIHJldmVhbCB0aGVtDQogICAgICogQHBhcmFtIF9oYXNoIFRoZSBub2RlIGluIHRoZSBzZWFsZWRCaWQNCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGluIHRoZSBzZWFsZWRCaWQNCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBiaWQgYW1vdW50IGluIHRoZSBzZWFsZWRCaWQNCiAgICAgKiBAcGFyYW0gX3NhbHQgVGhlIHNhbGUgaW4gdGhlIHNlYWxlZEJpZA0KICAgICAqLyANCiAgICBmdW5jdGlvbiB1bnNlYWxCaWQoYnl0ZXMzMiBfaGFzaCwgYWRkcmVzcyBfb3duZXIsIHVpbnQgX3ZhbHVlLCBieXRlczMyIF9zYWx0KSB7DQogICAgICAgIGJ5dGVzMzIgc2VhbCA9IHNoYUJpZChfaGFzaCwgX293bmVyLCBfdmFsdWUsIF9zYWx0KTsNCiAgICAgICAgRGVlZCBiaWQgPSBzZWFsZWRCaWRzW21zZy5zZW5kZXJdW3NlYWxdOw0KICAgICAgICBpZiAoYWRkcmVzcyhiaWQpID09IDAgKSB0aHJvdzsNCiAgICAgICAgc2VhbGVkQmlkc1ttc2cuc2VuZGVyXVtzZWFsXSA9IERlZWQoMCk7DQogICAgICAgIGJpZC5zZXRPd25lcihfb3duZXIpOw0KICAgICAgICBlbnRyeSBoID0gX2VudHJpZXNbX2hhc2hdOw0KICAgICAgICB1aW50IGFjdHVhbFZhbHVlID0gbWluKF92YWx1ZSwgYmlkLnZhbHVlKCkpOw0KICAgICAgICBiaWQuc2V0QmFsYW5jZShhY3R1YWxWYWx1ZSk7DQoNCiAgICAgICAgdmFyIGF1Y3Rpb25TdGF0ZSA9IHN0YXRlKF9oYXNoKTsNCiAgICAgICAgaWYoYXVjdGlvblN0YXRlID09IE1vZGUuT3duZWQpIHsNCiAgICAgICAgICAgIC8vIFRvbyBsYXRlISBCaWRkZXIgbG9zZXMgdGhlaXIgYmlkLiBHZXQncyAwLjUlIGJhY2suDQogICAgICAgICAgICBiaWQuY2xvc2VEZWVkKDUpOw0KICAgICAgICAgICAgQmlkUmV2ZWFsZWQoX2hhc2gsIF9vd25lciwgYWN0dWFsVmFsdWUsIDEpOw0KICAgICAgICB9IGVsc2UgaWYoYXVjdGlvblN0YXRlICE9IE1vZGUuUmV2ZWFsKSB7DQogICAgICAgICAgICAvLyBJbnZhbGlkIHBoYXNlDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfSBlbHNlIGlmIChfdmFsdWUgPCBtaW5QcmljZSB8fCBiaWQuY3JlYXRpb25EYXRlKCkgPiBoLnJlZ2lzdHJhdGlvbkRhdGUgLSByZXZlYWxQZXJpb2QpIHsNCiAgICAgICAgICAgIC8vIEJpZCB0b28gbG93IG9yIHRvbyBsYXRlLCByZWZ1bmQgOTkuNSUNCiAgICAgICAgICAgIGJpZC5jbG9zZURlZWQoOTk1KTsNCiAgICAgICAgICAgIEJpZFJldmVhbGVkKF9oYXNoLCBfb3duZXIsIGFjdHVhbFZhbHVlLCAwKTsNCiAgICAgICAgfSBlbHNlIGlmIChfdmFsdWUgPiBoLmhpZ2hlc3RCaWQpIHsNCiAgICAgICAgICAgIC8vIG5ldyB3aW5uZXINCiAgICAgICAgICAgIC8vIGNhbmNlbCB0aGUgb3RoZXIgYmlkLCByZWZ1bmQgOTkuNSUNCiAgICAgICAgICAgIGlmKGFkZHJlc3MoaC5kZWVkKSAhPSAwKSB7DQogICAgICAgICAgICAgICAgRGVlZCBwcmV2aW91c1dpbm5lciA9IGguZGVlZDsNCiAgICAgICAgICAgICAgICBwcmV2aW91c1dpbm5lci5jbG9zZURlZWQoOTk1KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gc2V0IG5ldyB3aW5uZXINCiAgICAgICAgICAgIC8vIHBlciB0aGUgcnVsZXMgb2YgYSB2aWNrZXJ5IGF1Y3Rpb24sIHRoZSB2YWx1ZSBiZWNvbWVzIHRoZSBwcmV2aW91cyBoaWdoZXN0QmlkDQogICAgICAgICAgICBoLnZhbHVlID0gaC5oaWdoZXN0QmlkOw0KICAgICAgICAgICAgaC5oaWdoZXN0QmlkID0gYWN0dWFsVmFsdWU7DQogICAgICAgICAgICBoLmRlZWQgPSBiaWQ7DQogICAgICAgICAgICBCaWRSZXZlYWxlZChfaGFzaCwgX293bmVyLCBhY3R1YWxWYWx1ZSwgMik7DQogICAgICAgIH0gZWxzZSBpZiAoX3ZhbHVlID4gaC52YWx1ZSkgew0KICAgICAgICAgICAgLy8gbm90IHdpbm5lciwgYnV0IGFmZmVjdHMgc2Vjb25kIHBsYWNlDQogICAgICAgICAgICBoLnZhbHVlID0gYWN0dWFsVmFsdWU7DQogICAgICAgICAgICBiaWQuY2xvc2VEZWVkKDk5NSk7DQogICAgICAgICAgICBCaWRSZXZlYWxlZChfaGFzaCwgX293bmVyLCBhY3R1YWxWYWx1ZSwgMyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBiaWQgZG9lc24ndCBhZmZlY3QgYXVjdGlvbg0KICAgICAgICAgICAgYmlkLmNsb3NlRGVlZCg5OTUpOw0KICAgICAgICAgICAgQmlkUmV2ZWFsZWQoX2hhc2gsIF9vd25lciwgYWN0dWFsVmFsdWUsIDQpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIEBkZXYgQ2FuY2VsIGEgYmlkDQogICAgICogQHBhcmFtIHNlYWwgVGhlIHZhbHVlIHJldHVybmVkIGJ5IHRoZSBzaGFCaWQgZnVuY3Rpb24NCiAgICAgKi8gDQogICAgZnVuY3Rpb24gY2FuY2VsQmlkKGFkZHJlc3MgYmlkZGVyLCBieXRlczMyIHNlYWwpIHsNCiAgICAgICAgRGVlZCBiaWQgPSBzZWFsZWRCaWRzW2JpZGRlcl1bc2VhbF07DQogICAgICAgIC8vIElmIHRoZSBiaWQgaGFzbid0IGJlZW4gcmV2ZWFsZWQgYWZ0ZXIgYW55IHBvc3NpYmxlIGF1Y3Rpb24gZGF0ZSwgdGhlbiBjbG9zZSBpdA0KICAgICAgICBpZiAoYWRkcmVzcyhiaWQpID09IDAgDQogICAgICAgICAgICB8fCBub3cgPCBiaWQuY3JlYXRpb25EYXRlKCkgKyBpbml0aWFsQXVjdGlvblBlcmlvZCANCiAgICAgICAgICAgIHx8IGJpZC5vd25lcigpID4gMCkgdGhyb3c7DQoNCiAgICAgICAgLy8gU2VuZCB0aGUgY2FuY2VsbGVyIDAuNSUgb2YgdGhlIGJpZCwgYW5kIGJ1cm4gdGhlIHJlc3QuDQogICAgICAgIGJpZC5zZXRPd25lcihtc2cuc2VuZGVyKTsNCiAgICAgICAgYmlkLmNsb3NlRGVlZCg1KTsNCiAgICAgICAgc2VhbGVkQmlkc1tiaWRkZXJdW3NlYWxdID0gRGVlZCgwKTsNCiAgICAgICAgQmlkUmV2ZWFsZWQoc2VhbCwgYmlkZGVyLCAwLCA1KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IEZpbmFsaXplIGFuIGF1Y3Rpb24gYWZ0ZXIgdGhlIHJlZ2lzdHJhdGlvbiBkYXRlIGhhcyBwYXNzZWQNCiAgICAgKiBAcGFyYW0gX2hhc2ggVGhlIGhhc2ggb2YgdGhlIG5hbWUgdGhlIGF1Y3Rpb24gaXMgZm9yDQogICAgICovIA0KICAgIGZ1bmN0aW9uIGZpbmFsaXplQXVjdGlvbihieXRlczMyIF9oYXNoKSBvbmx5T3duZXIoX2hhc2gpIHsNCiAgICAgICAgZW50cnkgaCA9IF9lbnRyaWVzW19oYXNoXTsNCg0KICAgICAgICBoLnZhbHVlID0gIG1heChoLnZhbHVlLCBtaW5QcmljZSk7DQoNCiAgICAgICAgLy8gQXNzaWduIHRoZSBvd25lciBpbiBFTlMNCiAgICAgICAgZW5zLnNldFN1Ym5vZGVPd25lcihyb290Tm9kZSwgX2hhc2gsIGguZGVlZC5vd25lcigpKTsNCg0KICAgICAgICBEZWVkIGRlZWRDb250cmFjdCA9IGguZGVlZDsNCiAgICAgICAgZGVlZENvbnRyYWN0LnNldEJhbGFuY2UoaC52YWx1ZSk7DQogICAgICAgIEhhc2hSZWdpc3RlcmVkKF9oYXNoLCBkZWVkQ29udHJhY3Qub3duZXIoKSwgaC52YWx1ZSwgaC5yZWdpc3RyYXRpb25EYXRlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFRoZSBvd25lciBvZiBhIGRvbWFpbiBtYXkgdHJhbnNmZXIgaXQgdG8gc29tZW9uZSBlbHNlIGF0IGFueSB0aW1lLg0KICAgICAqIEBwYXJhbSBfaGFzaCBUaGUgbm9kZSB0byB0cmFuc2Zlcg0KICAgICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihieXRlczMyIF9oYXNoLCBhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIoX2hhc2gpIHsNCiAgICAgICAgZW50cnkgaCA9IF9lbnRyaWVzW19oYXNoXTsNCiAgICAgICAgaC5kZWVkLnNldE93bmVyKG5ld093bmVyKTsNCiAgICAgICAgZW5zLnNldFN1Ym5vZGVPd25lcihyb290Tm9kZSwgX2hhc2gsIG5ld093bmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IEFmdGVyIHNvbWUgdGltZSwgdGhlIG93bmVyIGNhbiByZWxlYXNlIHRoZSBwcm9wZXJ0eSBhbmQgZ2V0IHRoZWlyIGV0aGVyIGJhY2sNCiAgICAgKiBAcGFyYW0gX2hhc2ggVGhlIG5vZGUgdG8gcmVsZWFzZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlbGVhc2VEZWVkKGJ5dGVzMzIgX2hhc2gpIG9ubHlPd25lcihfaGFzaCkgew0KICAgICAgICBlbnRyeSBoID0gX2VudHJpZXNbX2hhc2hdOw0KICAgICAgICBEZWVkIGRlZWRDb250cmFjdCA9IGguZGVlZDsNCiAgICAgICAgaWYgKG5vdyA8IGgucmVnaXN0cmF0aW9uRGF0ZSArIDEgeWVhcnMgDQogICAgICAgICAgICB8fCBub3cgPiByZWdpc3RyeVN0YXJ0ZWQgKyA4IHllYXJzKSB0aHJvdzsNCg0KICAgICAgICBIYXNoUmVsZWFzZWQoX2hhc2gsIGgudmFsdWUpOw0KICAgICAgICANCiAgICAgICAgaC52YWx1ZSA9IDA7DQogICAgICAgIGguaGlnaGVzdEJpZCA9IDA7DQogICAgICAgIGguZGVlZCA9IERlZWQoMCk7DQoNCiAgICAgICAgZW5zLnNldFN1Ym5vZGVPd25lcihyb290Tm9kZSwgX2hhc2gsIDApOw0KICAgICAgICBkZWVkQ29udHJhY3QuY2xvc2VEZWVkKDEwMDApOw0KICAgIH0gIA0KDQogICAgLyoqDQogICAgICogQGRldiBTdWJtaXQgYSBuYW1lIDYgY2hhcmFjdGVycyBsb25nIG9yIGxlc3MuIElmIGl0IGhhcyBiZWVuIHJlZ2lzdGVyZWQsIA0KICAgICAqIHRoZSBzdWJtaXR0ZXIgd2lsbCBlYXJuIDUwJSBvZiB0aGUgZGVlZCB2YWx1ZS4gV2UgYXJlIHB1cnBvc2VmdWxseQ0KICAgICAqIGhhbmRpY2FwcGluZyB0aGUgc2ltcGxpZmllZCByZWdpc3RyYXIgYXMgYSB3YXkgdG8gZm9yY2UgaXQgaW50byBiZWluZyByZXN0cnVjdHVyZWQNCiAgICAgKiBpbiBhIGZldyB5ZWFycy4NCiAgICAgKiBAcGFyYW0gdW5oYXNoZWROYW1lIEFuIGludmFsaWQgbmFtZSB0byBzZWFyY2ggZm9yIGluIHRoZSByZWdpc3RyeS4NCiAgICAgKiANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpbnZhbGlkYXRlTmFtZShzdHJpbmcgdW5oYXNoZWROYW1lKSBpblN0YXRlKHNoYTModW5oYXNoZWROYW1lKSwgTW9kZS5Pd25lZCkgew0KICAgICAgICBpZiAoc3RybGVuKHVuaGFzaGVkTmFtZSkgPiA2ICkgdGhyb3c7DQogICAgICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTModW5oYXNoZWROYW1lKTsNCiAgICAgICAgDQogICAgICAgIGVudHJ5IGggPSBfZW50cmllc1toYXNoXTsNCiAgICAgICAgZW5zLnNldFN1Ym5vZGVPd25lcihyb290Tm9kZSwgaGFzaCwgMCk7DQogICAgICAgIGlmKGFkZHJlc3MoaC5kZWVkKSAhPSAwKSB7DQogICAgICAgICAgICAvLyBSZXdhcmQgdGhlIGRpc2NvdmVyZXIgd2l0aCA1MCUgb2YgdGhlIGRlZWQNCiAgICAgICAgICAgIC8vIFRoZSBwcmV2aW91cyBvd25lciBnZXRzIDUwJQ0KICAgICAgICAgICAgaC5kZWVkLnNldEJhbGFuY2UoaC5kZWVkLnZhbHVlKCkvMik7DQogICAgICAgICAgICBoLmRlZWQuc2V0T3duZXIobXNnLnNlbmRlcik7DQogICAgICAgICAgICBoLmRlZWQuY2xvc2VEZWVkKDEwMDApOw0KICAgICAgICB9DQogICAgICAgIEhhc2hJbnZhbGlkYXRlZChoYXNoLCB1bmhhc2hlZE5hbWUsIGgudmFsdWUsIGgucmVnaXN0cmF0aW9uRGF0ZSk7DQogICAgICAgIGguZGVlZCA9IERlZWQoMCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBUcmFuc2ZlcnMgdGhlIGRlZWQgdG8gdGhlIGN1cnJlbnQgcmVnaXN0cmFyLCBpZiBkaWZmZXJlbnQgZnJvbSB0aGlzIG9uZS4NCiAgICAgKiBVc2VkIGR1cmluZyB0aGUgdXBncmFkZSBwcm9jZXNzIHRvIGEgcGVybWFuZW50IHJlZ2lzdHJhci4NCiAgICAgKiBAcGFyYW0gX2hhc2ggVGhlIG5hbWUgaGFzaCB0byB0cmFuc2Zlci4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlclJlZ2lzdHJhcnMoYnl0ZXMzMiBfaGFzaCkgb25seU93bmVyKF9oYXNoKSB7DQogICAgICAgIHZhciByZWdpc3RyYXIgPSBlbnMub3duZXIocm9vdE5vZGUpOw0KICAgICAgICBpZihyZWdpc3RyYXIgPT0gYWRkcmVzcyh0aGlzKSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIGVudHJ5IGggPSBfZW50cmllc1tfaGFzaF07DQogICAgICAgIGguZGVlZC5zZXRSZWdpc3RyYXIocmVnaXN0cmFyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgYSBkZWVkIGNyZWF0ZWQgYnkgYSBwcmV2aW91cyBpbnN0YW5jZSBvZiB0aGUgcmVnaXN0cmFyLg0KICAgICAqIEBwYXJhbSBkZWVkIFRoZSBhZGRyZXNzIG9mIHRoZSBkZWVkLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJldHVybkRlZWQoRGVlZCBkZWVkKSB7DQogICAgICAgIC8vIE9ubHkgcmV0dXJuIGlmIHdlIG93biB0aGUgZGVlZCwgYW5kIGl0IHdhcyBjcmVhdGVkIGJlZm9yZSBvdXIgc3RhcnQgZGF0ZS4NCiAgICAgICAgaWYoZGVlZC5yZWdpc3RyYXIoKSAhPSBhZGRyZXNzKHRoaXMpIHx8IGRlZWQuY3JlYXRpb25EYXRlKCkgPiByZWdpc3RyeVN0YXJ0ZWQpDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgZGVlZC5jbG9zZURlZWQoMTAwMCk7DQogICAgfQ0KfQ=='