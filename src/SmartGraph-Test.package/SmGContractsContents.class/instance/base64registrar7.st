base 64 content
base64registrar7
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4wOw0KDQoNCi8qDQoNClRlbXBvcmFyeSBIYXNoIFJlZ2lzdHJhciANCj09PT09PT09PT09PT09PT09PT09PT09PQ0KDQpUaGlzIGlzIGEgc2ltcGxpZmllZCB2ZXJzaW9uIG9mIGEgaGFzaCByZWdpc3RyYXIuIEl0IGlzIHB1cnBvcnNlZnVsbHkgbGltaXRlZDoNCm5hbWVzIGNhbm5vdCBiZSBzaXggbGV0dGVycyBvciBzaG9ydGVyLCBuZXcgYXVjdGlvbnMgd2lsbCBzdG9wIGFmdGVyIDQgeWVhcnMNCmFuZCBhbGwgZXRoZXIgc3RpbGwgbG9ja2VkIGFmdGVyIDggeWVhcnMgd2lsbCBiZWNvbWUgdW5yZWFjaGFibGUuDQoNClRoZSBwbGFuIGlzIHRvIHRlc3QgdGhlIGJhc2ljIGZlYXR1cmVzIGFuZCB0aGVuIG1vdmUgdG8gYSBuZXcgY29udHJhY3QgaW4gYXQgbW9zdA0KMiB5ZWFycywgd2hlbiBzb21lIHNvcnQgb2YgcmVuZXdhbCBtZWNoYW5pc20gd2lsbCBiZSBlbmFibGVkLg0KKi8NCg0KDQpjb250cmFjdCBBYnN0cmFjdEVOUyB7DQogICAgZnVuY3Rpb24gb3duZXIoYnl0ZXMzMiBub2RlKSBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpOw0KICAgIGZ1bmN0aW9uIHJlc29sdmVyKGJ5dGVzMzIgbm9kZSkgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKTsNCiAgICBmdW5jdGlvbiB0dGwoYnl0ZXMzMiBub2RlKSBjb25zdGFudCByZXR1cm5zKHVpbnQ2NCk7DQogICAgZnVuY3Rpb24gc2V0T3duZXIoYnl0ZXMzMiBub2RlLCBhZGRyZXNzIG93bmVyKTsNCiAgICBmdW5jdGlvbiBzZXRTdWJub2RlT3duZXIoYnl0ZXMzMiBub2RlLCBieXRlczMyIGxhYmVsLCBhZGRyZXNzIG93bmVyKTsNCiAgICBmdW5jdGlvbiBzZXRSZXNvbHZlcihieXRlczMyIG5vZGUsIGFkZHJlc3MgcmVzb2x2ZXIpOw0KICAgIGZ1bmN0aW9uIHNldFRUTChieXRlczMyIG5vZGUsIHVpbnQ2NCB0dGwpOw0KDQogICAgZXZlbnQgVHJhbnNmZXIoYnl0ZXMzMiBpbmRleGVkIG5vZGUsIGFkZHJlc3Mgb3duZXIpOw0KICAgIGV2ZW50IE5ld093bmVyKGJ5dGVzMzIgaW5kZXhlZCBub2RlLCBieXRlczMyIGluZGV4ZWQgbGFiZWwsIGFkZHJlc3Mgb3duZXIpOw0KICAgIGV2ZW50IE5ld1Jlc29sdmVyKGJ5dGVzMzIgaW5kZXhlZCBub2RlLCBhZGRyZXNzIHJlc29sdmVyKTsNCiAgICBldmVudCBOZXdUVEwoYnl0ZXMzMiBpbmRleGVkIG5vZGUsIHVpbnQ2NCB0dGwpOw0KfQ0KDQovKioNCiAqIEB0aXRsZSBEZWVkIHRvIGhvbGQgZXRoZXIgaW4gZXhjaGFuZ2UgZm9yIG93bmVyc2hpcCBvZiBhIG5vZGUNCiAqIEBkZXYgVGhlIGRlZWQgY2FuIGJlIGNvbnRyb2xsZWQgb25seSBieSB0aGUgcmVnaXN0cmFyIGFuZCBjYW4gb25seSBzZW5kIGV0aGVyIGJhY2sgdG8gdGhlIG93bmVyLg0KICovDQpjb250cmFjdCBEZWVkIHsNCiAgICBhZGRyZXNzIHB1YmxpYyByZWdpc3RyYXI7DQogICAgYWRkcmVzcyBjb25zdGFudCBidXJuID0gMHhkZWFkOw0KICAgIHVpbnQgcHVibGljIGNyZWF0aW9uRGF0ZTsNCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCiAgICBhZGRyZXNzIHB1YmxpYyBwcmV2aW91c093bmVyOw0KICAgIHVpbnQgcHVibGljIHZhbHVlOw0KICAgIGV2ZW50IE93bmVyQ2hhbmdlZChhZGRyZXNzIG5ld093bmVyKTsNCiAgICBldmVudCBEZWVkQ2xvc2VkKCk7DQogICAgYm9vbCBhY3RpdmU7DQoNCg0KICAgIG1vZGlmaWVyIG9ubHlSZWdpc3RyYXIgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSByZWdpc3RyYXIpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG9ubHlBY3RpdmUgew0KICAgICAgICBpZiAoIWFjdGl2ZSkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gRGVlZCh1aW50IF92YWx1ZSkgew0KICAgICAgICByZWdpc3RyYXIgPSBtc2cuc2VuZGVyOw0KICAgICAgICBjcmVhdGlvbkRhdGUgPSBub3c7DQogICAgICAgIGFjdGl2ZSA9IHRydWU7DQogICAgICAgIHZhbHVlID0gX3ZhbHVlOw0KICAgIH0NCiAgICAgICAgDQogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBuZXdPd25lcikgb25seVJlZ2lzdHJhciB7DQogICAgICAgIC8vIHNvIGNvbnRyYWN0cyBjYW4gY2hlY2sgd2hvIHNlbnQgdGhlbSB0aGUgb3duZXJzaGlwDQogICAgICAgIHByZXZpb3VzT3duZXIgPSBvd25lcjsNCiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICAgICAgT3duZXJDaGFuZ2VkKG5ld093bmVyKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZXRSZWdpc3RyYXIoYWRkcmVzcyBuZXdSZWdpc3RyYXIpIG9ubHlSZWdpc3RyYXIgew0KICAgICAgICByZWdpc3RyYXIgPSBuZXdSZWdpc3RyYXI7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHNldEJhbGFuY2UodWludCBuZXdWYWx1ZSkgb25seVJlZ2lzdHJhciBvbmx5QWN0aXZlIHBheWFibGUgew0KICAgICAgICAvLyBDaGVjayBpZiBpdCBoYXMgZW5vdWdoIGJhbGFuY2UgdG8gc2V0IHRoZSB2YWx1ZQ0KICAgICAgICBpZiAodmFsdWUgPCBuZXdWYWx1ZSkgdGhyb3c7DQogICAgICAgIHZhbHVlID0gbmV3VmFsdWU7DQogICAgICAgIC8vIFNlbmQgdGhlIGRpZmZlcmVuY2UgdG8gdGhlIG93bmVyDQogICAgICAgIGlmICghb3duZXIuc2VuZCh0aGlzLmJhbGFuY2UgLSBuZXdWYWx1ZSkpIHRocm93Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgQ2xvc2UgYSBkZWVkIGFuZCByZWZ1bmQgYSBzcGVjaWZpZWQgZnJhY3Rpb24gb2YgdGhlIGJpZCB2YWx1ZQ0KICAgICAqIEBwYXJhbSByZWZ1bmRSYXRpbyBUaGUgYW1vdW50KjEvMTAwMCB0byByZWZ1bmQNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjbG9zZURlZWQodWludCByZWZ1bmRSYXRpbykgb25seVJlZ2lzdHJhciBvbmx5QWN0aXZlIHsNCiAgICAgICAgYWN0aXZlID0gZmFsc2U7ICAgICAgICAgICAgDQogICAgICAgIGlmICghIGJ1cm4uc2VuZCgoKDEwMDAgLSByZWZ1bmRSYXRpbykgKiB0aGlzLmJhbGFuY2UpLzEwMDApKSB0aHJvdzsNCiAgICAgICAgRGVlZENsb3NlZCgpOw0KICAgICAgICBkZXN0cm95RGVlZCgpOw0KICAgIH0gICAgDQoNCiAgICAvKioNCiAgICAgKiBAZGV2IENsb3NlIGEgZGVlZCBhbmQgcmVmdW5kIGEgc3BlY2lmaWVkIGZyYWN0aW9uIG9mIHRoZSBiaWQgdmFsdWUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBkZXN0cm95RGVlZCgpIHsNCiAgICAgICAgaWYgKGFjdGl2ZSkgdGhyb3c7DQogICAgICAgIGlmKG93bmVyLnNlbmQodGhpcy5iYWxhbmNlKSkNCiAgICAgICAgICAgIHNlbGZkZXN0cnVjdChidXJuKTsNCiAgICB9DQoNCiAgICAvLyBUaGUgZGVmYXVsdCBmdW5jdGlvbiBqdXN0IHJlY2VpdmVzIGFuIGFtb3VudA0KICAgIGZ1bmN0aW9uICgpIHBheWFibGUge30NCn0NCg0KLyoqDQogKiBAdGl0bGUgUmVnaXN0cmFyDQogKiBAZGV2IFRoZSByZWdpc3RyYXIgaGFuZGxlcyB0aGUgYXVjdGlvbiBwcm9jZXNzIGZvciBlYWNoIHN1Ym5vZGUgb2YgdGhlIG5vZGUgaXQgb3ducy4NCiAqLw0KY29udHJhY3QgUmVnaXN0cmFyIHsNCiAgICBBYnN0cmFjdEVOUyBwdWJsaWMgZW5zOw0KICAgIGJ5dGVzMzIgcHVibGljIHJvb3ROb2RlOw0KDQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBlbnRyeSkgX2VudHJpZXM7DQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nKGJ5dGVzMzIgPT4gRGVlZCkpIHB1YmxpYyBzZWFsZWRCaWRzOw0KICAgIA0KICAgIGVudW0gTW9kZSB7IE9wZW4sIEF1Y3Rpb24sIE93bmVkLCBGb3JiaWRkZW4sIFJldmVhbCB9DQogICAgdWludDMyIGNvbnN0YW50IGF1Y3Rpb25MZW5ndGggPSA1IGRheXM7DQogICAgdWludDMyIGNvbnN0YW50IHJldmVhbFBlcmlvZCA9IDQ4IGhvdXJzOw0KICAgIHVpbnQzMiBjb25zdGFudCBpbml0aWFsQXVjdGlvblBlcmlvZCA9IDQgd2Vla3M7DQogICAgdWludCBjb25zdGFudCBtaW5QcmljZSA9IDAuMDEgZXRoZXI7DQogICAgdWludCBwdWJsaWMgcmVnaXN0cnlTdGFydGVkOw0KDQogICAgZXZlbnQgQXVjdGlvblN0YXJ0ZWQoYnl0ZXMzMiBpbmRleGVkIGhhc2gsIHVpbnQgcmVnaXN0cmF0aW9uRGF0ZSk7DQogICAgZXZlbnQgTmV3QmlkKGJ5dGVzMzIgaW5kZXhlZCBoYXNoLCBhZGRyZXNzIGluZGV4ZWQgYmlkZGVyLCB1aW50IGRlcG9zaXQpOw0KICAgIGV2ZW50IEJpZFJldmVhbGVkKGJ5dGVzMzIgaW5kZXhlZCBoYXNoLCBhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgdmFsdWUsIHVpbnQ4IHN0YXR1cyk7DQogICAgZXZlbnQgSGFzaFJlZ2lzdGVyZWQoYnl0ZXMzMiBpbmRleGVkIGhhc2gsIGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludCB2YWx1ZSwgdWludCByZWdpc3RyYXRpb25EYXRlKTsNCiAgICBldmVudCBIYXNoUmVsZWFzZWQoYnl0ZXMzMiBpbmRleGVkIGhhc2gsIHVpbnQgdmFsdWUpOw0KICAgIGV2ZW50IEhhc2hJbnZhbGlkYXRlZChieXRlczMyIGluZGV4ZWQgaGFzaCwgc3RyaW5nIGluZGV4ZWQgbmFtZSwgdWludCB2YWx1ZSwgdWludCByZWdpc3RyYXRpb25EYXRlKTsNCg0KICAgIHN0cnVjdCBlbnRyeSB7DQogICAgICAgIERlZWQgZGVlZDsNCiAgICAgICAgdWludCByZWdpc3RyYXRpb25EYXRlOw0KICAgICAgICB1aW50IHZhbHVlOw0KICAgICAgICB1aW50IGhpZ2hlc3RCaWQ7DQogICAgfQ0KDQogICAgLy8gU3RhdGUgdHJhbnNpdGlvbnMgZm9yIG5hbWVzOg0KICAgIC8vICAgT3BlbiAtPiBBdWN0aW9uIChzdGFydEF1Y3Rpb24pDQogICAgLy8gICBBdWN0aW9uIC0+IFJldmVhbA0KICAgIC8vICAgUmV2ZWFsIC0+IE93bmVkDQogICAgLy8gICBSZXZlYWwgLT4gT3BlbiAoaWYgbm9ib2R5IGJpZCkNCiAgICAvLyAgIE93bmVkIC0+IEZvcmJpZGRlbiAoaW52YWxpZGF0ZU5hbWUpDQogICAgLy8gICBPd25lZCAtPiBPcGVuIChyZWxlYXNlRGVlZCkNCiAgICBmdW5jdGlvbiBzdGF0ZShieXRlczMyIF9oYXNoKSBjb25zdGFudCByZXR1cm5zIChNb2RlKSB7DQogICAgICAgIHZhciBlbnRyeSA9IF9lbnRyaWVzW19oYXNoXTsNCiAgICAgICAgaWYobm93IDwgZW50cnkucmVnaXN0cmF0aW9uRGF0ZSkgew0KICAgICAgICAgICAgaWYobm93IDwgZW50cnkucmVnaXN0cmF0aW9uRGF0ZSAtIHJldmVhbFBlcmlvZCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBNb2RlLkF1Y3Rpb247DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBNb2RlLlJldmVhbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmKGVudHJ5LmhpZ2hlc3RCaWQgPT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBNb2RlLk9wZW47DQogICAgICAgICAgICB9IGVsc2UgaWYoZW50cnkuZGVlZCA9PSBEZWVkKDApKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIE1vZGUuRm9yYmlkZGVuOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gTW9kZS5Pd25lZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICBtb2RpZmllciBpblN0YXRlKGJ5dGVzMzIgX2hhc2gsIE1vZGUgX3N0YXRlKSB7DQogICAgICAgIGlmKHN0YXRlKF9oYXNoKSAhPSBfc3RhdGUpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG9ubHlPd25lcihieXRlczMyIF9oYXNoKSB7DQogICAgICAgIGlmIChzdGF0ZShfaGFzaCkgIT0gTW9kZS5Pd25lZCB8fCBtc2cuc2VuZGVyICE9IF9lbnRyaWVzW19oYXNoXS5kZWVkLm93bmVyKCkpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCiAgICANCiAgICBtb2RpZmllciByZWdpc3RyeU9wZW4oKSB7DQogICAgICAgIGlmKG5vdyA8IHJlZ2lzdHJ5U3RhcnRlZCAgfHwgbm93ID4gcmVnaXN0cnlTdGFydGVkICsgNCB5ZWFycykgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGVudHJpZXMoYnl0ZXMzMiBfaGFzaCkgY29uc3RhbnQgcmV0dXJucyAoTW9kZSwgYWRkcmVzcywgdWludCwgdWludCwgdWludCkgew0KICAgICAgICBlbnRyeSBoID0gX2VudHJpZXNbX2hhc2hdOw0KICAgICAgICByZXR1cm4gKHN0YXRlKF9oYXNoKSwgaC5kZWVkLCBoLnJlZ2lzdHJhdGlvbkRhdGUsIGgudmFsdWUsIGguaGlnaGVzdEJpZCk7DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIEBkZXYgQ29uc3RydWN0cyBhIG5ldyBSZWdpc3RyYXIsIHdpdGggdGhlIHByb3ZpZGVkIGFkZHJlc3MgYXMgdGhlIG93bmVyIG9mIHRoZSByb290IG5vZGUuDQogICAgICogQHBhcmFtIF9lbnMgVGhlIGFkZHJlc3Mgb2YgdGhlIEVOUw0KICAgICAqIEBwYXJhbSBfcm9vdE5vZGUgVGhlIGhhc2ggb2YgdGhlIHJvb3Rub2RlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFJlZ2lzdHJhcihhZGRyZXNzIF9lbnMsIGJ5dGVzMzIgX3Jvb3ROb2RlLCB1aW50IF9zdGFydERhdGUpIHsNCiAgICAgICAgZW5zID0gQWJzdHJhY3RFTlMoX2Vucyk7DQogICAgICAgIHJvb3ROb2RlID0gX3Jvb3ROb2RlOw0KICAgICAgICByZWdpc3RyeVN0YXJ0ZWQgPSBfc3RhcnREYXRlID4gMCA/IF9zdGFydERhdGUgOiBub3c7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBtYXhpbXVtIG9mIHR3byB1bnNpZ25lZCBpbnRlZ2Vycw0KICAgICAqIEBwYXJhbSBhIEEgbnVtYmVyIHRvIGNvbXBhcmUNCiAgICAgKiBAcGFyYW0gYiBBIG51bWJlciB0byBjb21wYXJlDQogICAgICogQHJldHVybiBUaGUgbWF4aW11bSBvZiB0d28gdW5zaWduZWQgaW50ZWdlcnMNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBtYXgodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQgbWF4KSB7DQogICAgICAgIGlmIChhID4gYikNCiAgICAgICAgICAgIHJldHVybiBhOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gYjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG1pbmltdW0gb2YgdHdvIHVuc2lnbmVkIGludGVnZXJzDQogICAgICogQHBhcmFtIGEgQSBudW1iZXIgdG8gY29tcGFyZQ0KICAgICAqIEBwYXJhbSBiIEEgbnVtYmVyIHRvIGNvbXBhcmUNCiAgICAgKiBAcmV0dXJuIFRoZSBtaW5pbXVtIG9mIHR3byB1bnNpZ25lZCBpbnRlZ2Vycw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCBtaW4pIHsNCiAgICAgICAgaWYgKGEgPCBiKQ0KICAgICAgICAgICAgcmV0dXJuIGE7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBiOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIG9mIGEgZ2l2ZW4gc3RyaW5nDQogICAgICogQHBhcmFtIHMgVGhlIHN0cmluZyB0byBtZWFzdXJlIHRoZSBsZW5ndGggb2YNCiAgICAgKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIGlucHV0IHN0cmluZw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHN0cmxlbihzdHJpbmcgcykgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICAvLyBTdGFydGluZyBoZXJlIG1lYW5zIHRoZSBMU0Igd2lsbCBiZSB0aGUgYnl0ZSB3ZSBjYXJlIGFib3V0DQogICAgICAgIHVpbnQgcHRyOw0KICAgICAgICB1aW50IGVuZDsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgcHRyIDo9IGFkZChzLCAxKQ0KICAgICAgICAgICAgZW5kIDo9IGFkZChtbG9hZChzKSwgcHRyKQ0KICAgICAgICB9DQogICAgICAgIGZvciAodWludCBsZW4gPSAwOyBwdHIgPCBlbmQ7IGxlbisrKSB7DQogICAgICAgICAgICB1aW50OCBiOw0KICAgICAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChwdHIpLCAweEZGKSB9DQogICAgICAgICAgICBpZiAoYiA8IDB4ODApIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gMTsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSAyOw0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDM7DQogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjgpIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gNDsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGQykgew0KICAgICAgICAgICAgICAgIHB0ciArPSA1Ow0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gNjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbGVuOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgU3RhcnQgYW4gYXVjdGlvbiBmb3IgYW4gYXZhaWxhYmxlIGhhc2gNCiAgICAgKiANCiAgICAgKiBBbnlvbmUgY2FuIHN0YXJ0IGFuIGF1Y3Rpb24gYnkgc2VuZGluZyBhbiBhcnJheSBvZiBoYXNoZXMgdGhhdCB0aGV5IHdhbnQgdG8gYmlkIGZvci4gDQogICAgICogQXJyYXlzIGFyZSBzZW50IHNvIHRoYXQgc29tZW9uZSBjYW4gb3BlbiB1cCBhbiBhdWN0aW9uIGZvciBYIGR1bW15IGhhc2hlcyB3aGVuIHRoZXkgDQogICAgICogYXJlIG9ubHkgcmVhbGx5IGludGVyZXN0ZWQgaW4gYmlkZGluZyBmb3Igb25lLiBUaGlzIHdpbGwgaW5jcmVhc2UgdGhlIGNvc3QgZm9yIGFuIA0KICAgICAqIGF0dGFja2VyIHRvIHNpbXBseSBiaWQgYmxpbmRseSBvbiBhbGwgbmV3IGF1Y3Rpb25zLiBEdW1teSBhdWN0aW9ucyB0aGF0IGFyZSANCiAgICAgKiBvcGVuIGJ1dCBub3QgYmlkIG9uIGFyZSBjbG9zZWQgYWZ0ZXIgYSB3ZWVrLiANCiAgICAgKg0KICAgICAqIEBwYXJhbSBfaGFzaCBUaGUgaGFzaCB0byBzdGFydCBhbiBhdWN0aW9uIG9uDQogICAgICovICAgIA0KICAgIGZ1bmN0aW9uIHN0YXJ0QXVjdGlvbihieXRlczMyIF9oYXNoKSBpblN0YXRlKF9oYXNoLCBNb2RlLk9wZW4pIHJlZ2lzdHJ5T3BlbigpIHsNCiAgICAgICAgZW50cnkgbmV3QXVjdGlvbiA9IF9lbnRyaWVzW19oYXNoXTsNCg0KICAgICAgICAvLyBmb3IgdGhlIGZpcnN0IG1vbnRoIG9mIHRoZSByZWdpc3RyeSwgbWFrZSBsb25nZXIgYXVjdGlvbnMNCiAgICAgICAgbmV3QXVjdGlvbi5yZWdpc3RyYXRpb25EYXRlID0gbWF4KG5vdyArIGF1Y3Rpb25MZW5ndGgsIHJlZ2lzdHJ5U3RhcnRlZCArIGluaXRpYWxBdWN0aW9uUGVyaW9kKTsNCiAgICAgICAgbmV3QXVjdGlvbi52YWx1ZSA9IDA7DQogICAgICAgIG5ld0F1Y3Rpb24uaGlnaGVzdEJpZCA9IDA7DQogICAgICAgIEF1Y3Rpb25TdGFydGVkKF9oYXNoLCBuZXdBdWN0aW9uLnJlZ2lzdHJhdGlvbkRhdGUpOyAgICAgIA0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgU3RhcnQgbXVsdGlwbGUgYXVjdGlvbnMgZm9yIGJldHRlciBhbm9ueW1pdHkNCiAgICAgKiBAcGFyYW0gX2hhc2hlcyBBbiBhcnJheSBvZiBoYXNoZXMsIGF0IGxlYXN0IG9uZSBvZiB3aGljaCB5b3UgcHJlc3VtYWJseSB3YW50IHRvIGJpZCBvbg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHN0YXJ0QXVjdGlvbnMoYnl0ZXMzMltdIF9oYXNoZXMpICB7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9oYXNoZXMubGVuZ3RoOyBpICsrICkgew0KICAgICAgICAgICAgc3RhcnRBdWN0aW9uKF9oYXNoZXNbaV0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIEBkZXYgSGFzaCB0aGUgdmFsdWVzIHJlcXVpcmVkIGZvciBhIHNlY3JldCBiaWQNCiAgICAgKiBAcGFyYW0gaGFzaCBUaGUgbm9kZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBkZXNpcmVkIG5hbWVoYXNoDQogICAgICogQHBhcmFtIG93bmVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgb3duIHRoZSANCiAgICAgKiBAcGFyYW0gdmFsdWUgVGhlIGJpZCBhbW91bnQNCiAgICAgKiBAcGFyYW0gc2FsdCBBIHJhbmRvbSB2YWx1ZSB0byBlbnN1cmUgc2VjcmVjeSBvZiB0aGUgYmlkDQogICAgICogQHJldHVybiBUaGUgaGFzaCBvZiB0aGUgYmlkIHZhbHVlcw0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNoYUJpZChieXRlczMyIGhhc2gsIGFkZHJlc3Mgb3duZXIsIHVpbnQgdmFsdWUsIGJ5dGVzMzIgc2FsdCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMiBzZWFsZWRCaWQpIHsNCiAgICAgICAgcmV0dXJuIHNoYTMoaGFzaCwgb3duZXIsIHZhbHVlLCBzYWx0KTsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogQGRldiBTdWJtaXQgYSBuZXcgc2VhbGVkIGJpZCBvbiBhIGRlc2lyZWQgaGFzaCBpbiBhIGJsaW5kIGF1Y3Rpb24NCiAgICAgKiANCiAgICAgKiBCaWRzIGFyZSBzZW50IGJ5IHNlbmRpbmcgYSBtZXNzYWdlIHRvIHRoZSBtYWluIGNvbnRyYWN0IHdpdGggYSBoYXNoIGFuZCBhbiBhbW91bnQuIFRoZSBoYXNoIA0KICAgICAqIGNvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IHRoZSBiaWQsIGluY2x1ZGluZyB0aGUgYmlkZGVkIGhhc2gsIHRoZSBiaWQgYW1vdW50LCBhbmQgYSByYW5kb20gDQogICAgICogc2FsdC4gQmlkcyBhcmUgbm90IHRpZWQgdG8gYW55IG9uZSBhdWN0aW9uIHVudGlsIHRoZXkgYXJlIHJldmVhbGVkLiBUaGUgdmFsdWUgb2YgdGhlIGJpZCANCiAgICAgKiBpdHNlbGYgY2FuIGJlIG1hc3F1ZXJhZGVkIGJ5IHNlbmRpbmcgbW9yZSB0aGFuIHRoZSB2YWx1ZSBvZiB5b3VyIGFjdHVhbCBiaWQuIFRoaXMgaXMgDQogICAgICogZm9sbG93ZWQgYnkgYSAyNGggcmV2ZWFsIHBlcmlvZC4gQmlkcyByZXZlYWxlZCBhZnRlciB0aGlzIHBlcmlvZCB3aWxsIGJlIGJ1cm5lZCBhbmQgdGhlIGV0aGVyIHVucmVjb3ZlcmFibGUuIA0KICAgICAqIFNpbmNlIHRoaXMgaXMgYW4gYXVjdGlvbiwgaXQgaXMgZXhwZWN0ZWQgdGhhdCBtb3N0IHB1YmxpYyBoYXNoZXMsIGxpa2Uga25vd24gZG9tYWlucyBhbmQgY29tbW9uIGRpY3Rpb25hcnkgDQogICAgICogd29yZHMsIHdpbGwgaGF2ZSBtdWx0aXBsZSBiaWRkZXJzIHB1c2hpbmcgdGhlIHByaWNlIHVwLiANCiAgICAgKg0KICAgICAqIEBwYXJhbSBzZWFsZWRCaWQgQSBzZWFsZWRCaWQsIGNyZWF0ZWQgYnkgdGhlIHNoYUJpZCBmdW5jdGlvbg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG5ld0JpZChieXRlczMyIHNlYWxlZEJpZCkgcGF5YWJsZSB7DQogICAgICAgIGlmIChhZGRyZXNzKHNlYWxlZEJpZHNbbXNnLnNlbmRlcl1bc2VhbGVkQmlkXSkgPiAwICkgdGhyb3c7DQogICAgICAgIGlmIChtc2cudmFsdWUgPCBtaW5QcmljZSkgdGhyb3c7DQogICAgICAgIC8vIGNyZWF0ZXMgYSBuZXcgaGFzaCBjb250cmFjdCB3aXRoIHRoZSBvd25lcg0KICAgICAgICBEZWVkIG5ld0JpZCA9IG5ldyBEZWVkKG1zZy52YWx1ZSk7DQogICAgICAgIHNlYWxlZEJpZHNbbXNnLnNlbmRlcl1bc2VhbGVkQmlkXSA9IG5ld0JpZDsNCiAgICAgICAgTmV3QmlkKHNlYWxlZEJpZCwgbXNnLnNlbmRlciwgbXNnLnZhbHVlKTsNCg0KICAgICAgICBpZiAoIW5ld0JpZC5zZW5kKG1zZy52YWx1ZSkpIHRocm93Ow0KICAgIH0gDQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFN1Ym1pdCB0aGUgcHJvcGVydGllcyBvZiBhIGJpZCB0byByZXZlYWwgdGhlbQ0KICAgICAqIEBwYXJhbSBfaGFzaCBUaGUgbm9kZSBpbiB0aGUgc2VhbGVkQmlkDQogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBpbiB0aGUgc2VhbGVkQmlkDQogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYmlkIGFtb3VudCBpbiB0aGUgc2VhbGVkQmlkDQogICAgICogQHBhcmFtIF9zYWx0IFRoZSBzYWxlIGluIHRoZSBzZWFsZWRCaWQNCiAgICAgKi8gDQogICAgZnVuY3Rpb24gdW5zZWFsQmlkKGJ5dGVzMzIgX2hhc2gsIGFkZHJlc3MgX293bmVyLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc2FsdCkgew0KICAgICAgICBieXRlczMyIHNlYWwgPSBzaGFCaWQoX2hhc2gsIF9vd25lciwgX3ZhbHVlLCBfc2FsdCk7DQogICAgICAgIERlZWQgYmlkID0gc2VhbGVkQmlkc1ttc2cuc2VuZGVyXVtzZWFsXTsNCiAgICAgICAgaWYgKGFkZHJlc3MoYmlkKSA9PSAwICkgdGhyb3c7DQogICAgICAgIHNlYWxlZEJpZHNbbXNnLnNlbmRlcl1bc2VhbF0gPSBEZWVkKDApOw0KICAgICAgICBiaWQuc2V0T3duZXIoX293bmVyKTsNCiAgICAgICAgZW50cnkgaCA9IF9lbnRyaWVzW19oYXNoXTsNCiAgICAgICAgdWludCBhY3R1YWxWYWx1ZSA9IG1pbihfdmFsdWUsIGJpZC52YWx1ZSgpKTsNCiAgICAgICAgYmlkLnNldEJhbGFuY2UoYWN0dWFsVmFsdWUpOw0KDQogICAgICAgIHZhciBhdWN0aW9uU3RhdGUgPSBzdGF0ZShfaGFzaCk7DQogICAgICAgIGlmKGF1Y3Rpb25TdGF0ZSA9PSBNb2RlLk93bmVkKSB7DQogICAgICAgICAgICAvLyBUb28gbGF0ZSEgQmlkZGVyIGxvc2VzIHRoZWlyIGJpZC4gR2V0J3MgMC41JSBiYWNrLg0KICAgICAgICAgICAgYmlkLmNsb3NlRGVlZCg1KTsNCiAgICAgICAgICAgIEJpZFJldmVhbGVkKF9oYXNoLCBfb3duZXIsIGFjdHVhbFZhbHVlLCAxKTsNCiAgICAgICAgfSBlbHNlIGlmKGF1Y3Rpb25TdGF0ZSAhPSBNb2RlLlJldmVhbCkgew0KICAgICAgICAgICAgLy8gSW52YWxpZCBwaGFzZQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0gZWxzZSBpZiAoX3ZhbHVlIDwgbWluUHJpY2UpIHsNCiAgICAgICAgICAgIC8vIEJpZCB0b28gbG93LCByZWZ1bmQgOTkuNSUNCiAgICAgICAgICAgIGJpZC5jbG9zZURlZWQoOTk1KTsNCiAgICAgICAgICAgIEJpZFJldmVhbGVkKF9oYXNoLCBfb3duZXIsIGFjdHVhbFZhbHVlLCAwKTsNCiAgICAgICAgfSBlbHNlIGlmIChfdmFsdWUgPiBoLmhpZ2hlc3RCaWQpIHsNCiAgICAgICAgICAgIC8vIG5ldyB3aW5uZXINCiAgICAgICAgICAgIC8vIGNhbmNlbCB0aGUgb3RoZXIgYmlkLCByZWZ1bmQgOTkuNSUNCiAgICAgICAgICAgIGlmKGFkZHJlc3MoaC5kZWVkKSAhPSAwKSB7DQogICAgICAgICAgICAgICAgRGVlZCBwcmV2aW91c1dpbm5lciA9IGguZGVlZDsNCiAgICAgICAgICAgICAgICBwcmV2aW91c1dpbm5lci5jbG9zZURlZWQoOTk1KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gc2V0IG5ldyB3aW5uZXINCiAgICAgICAgICAgIC8vIHBlciB0aGUgcnVsZXMgb2YgYSB2aWNrZXJ5IGF1Y3Rpb24sIHRoZSB2YWx1ZSBiZWNvbWVzIHRoZSBwcmV2aW91cyBoaWdoZXN0QmlkDQogICAgICAgICAgICBoLnZhbHVlID0gaC5oaWdoZXN0QmlkOw0KICAgICAgICAgICAgaC5oaWdoZXN0QmlkID0gYWN0dWFsVmFsdWU7DQogICAgICAgICAgICBoLmRlZWQgPSBiaWQ7DQogICAgICAgICAgICBCaWRSZXZlYWxlZChfaGFzaCwgX293bmVyLCBhY3R1YWxWYWx1ZSwgMik7DQogICAgICAgIH0gZWxzZSBpZiAoX3ZhbHVlID4gaC52YWx1ZSkgew0KICAgICAgICAgICAgLy8gbm90IHdpbm5lciwgYnV0IGFmZmVjdHMgc2Vjb25kIHBsYWNlDQogICAgICAgICAgICBoLnZhbHVlID0gYWN0dWFsVmFsdWU7DQogICAgICAgICAgICBiaWQuY2xvc2VEZWVkKDk5NSk7DQogICAgICAgICAgICBCaWRSZXZlYWxlZChfaGFzaCwgX293bmVyLCBhY3R1YWxWYWx1ZSwgMyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBiaWQgZG9lc24ndCBhZmZlY3QgYXVjdGlvbg0KICAgICAgICAgICAgYmlkLmNsb3NlRGVlZCg5OTUpOw0KICAgICAgICAgICAgQmlkUmV2ZWFsZWQoX2hhc2gsIF9vd25lciwgYWN0dWFsVmFsdWUsIDQpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIEBkZXYgQ2FuY2VsIGEgYmlkDQogICAgICogQHBhcmFtIHNlYWwgVGhlIHZhbHVlIHJldHVybmVkIGJ5IHRoZSBzaGFCaWQgZnVuY3Rpb24NCiAgICAgKi8gDQogICAgZnVuY3Rpb24gY2FuY2VsQmlkKGFkZHJlc3MgYmlkZGVyLCBieXRlczMyIHNlYWwpIHsNCiAgICAgICAgRGVlZCBiaWQgPSBzZWFsZWRCaWRzW2JpZGRlcl1bc2VhbF07DQogICAgICAgIC8vIElmIHRoZSBiaWQgaGFzbid0IGJlZW4gcmV2ZWFsZWQgYWZ0ZXIgYW55IHBvc3NpYmxlIGF1Y3Rpb24gZGF0ZSwgdGhlbiBjbG9zZSBpdA0KICAgICAgICBpZiAoYWRkcmVzcyhiaWQpID09IDAgDQogICAgICAgICAgICB8fCBub3cgPCBiaWQuY3JlYXRpb25EYXRlKCkgKyBpbml0aWFsQXVjdGlvblBlcmlvZCANCiAgICAgICAgICAgIHx8IGJpZC5vd25lcigpID4gMCkgdGhyb3c7DQoNCiAgICAgICAgLy8gU2VuZCB0aGUgY2FuY2VsbGVyIDAuNSUgb2YgdGhlIGJpZCwgYW5kIGJ1cm4gdGhlIHJlc3QuDQogICAgICAgIGJpZC5zZXRPd25lcihtc2cuc2VuZGVyKTsNCiAgICAgICAgYmlkLmNsb3NlRGVlZCg1KTsNCiAgICAgICAgc2VhbGVkQmlkc1tiaWRkZXJdW3NlYWxdID0gRGVlZCgwKTsNCiAgICAgICAgQmlkUmV2ZWFsZWQoc2VhbCwgYmlkZGVyLCAwLCA1KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IEZpbmFsaXplIGFuIGF1Y3Rpb24gYWZ0ZXIgdGhlIHJlZ2lzdHJhdGlvbiBkYXRlIGhhcyBwYXNzZWQNCiAgICAgKiBAcGFyYW0gX2hhc2ggVGhlIGhhc2ggb2YgdGhlIG5hbWUgdGhlIGF1Y3Rpb24gaXMgZm9yDQogICAgICovIA0KICAgIGZ1bmN0aW9uIGZpbmFsaXplQXVjdGlvbihieXRlczMyIF9oYXNoKSBvbmx5T3duZXIoX2hhc2gpIHsNCiAgICAgICAgZW50cnkgaCA9IF9lbnRyaWVzW19oYXNoXTsNCg0KICAgICAgICBoLnZhbHVlID0gIG1heChoLnZhbHVlLCBtaW5QcmljZSk7DQoNCiAgICAgICAgLy8gQXNzaWduIHRoZSBvd25lciBpbiBFTlMNCiAgICAgICAgZW5zLnNldFN1Ym5vZGVPd25lcihyb290Tm9kZSwgX2hhc2gsIGguZGVlZC5vd25lcigpKTsNCg0KICAgICAgICBEZWVkIGRlZWRDb250cmFjdCA9IGguZGVlZDsNCiAgICAgICAgZGVlZENvbnRyYWN0LnNldEJhbGFuY2UoaC52YWx1ZSk7DQogICAgICAgIEhhc2hSZWdpc3RlcmVkKF9oYXNoLCBkZWVkQ29udHJhY3Qub3duZXIoKSwgaC52YWx1ZSwgaC5yZWdpc3RyYXRpb25EYXRlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFRoZSBvd25lciBvZiBhIGRvbWFpbiBtYXkgdHJhbnNmZXIgaXQgdG8gc29tZW9uZSBlbHNlIGF0IGFueSB0aW1lLg0KICAgICAqIEBwYXJhbSBfaGFzaCBUaGUgbm9kZSB0byB0cmFuc2Zlcg0KICAgICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihieXRlczMyIF9oYXNoLCBhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIoX2hhc2gpIHsNCiAgICAgICAgZW50cnkgaCA9IF9lbnRyaWVzW19oYXNoXTsNCiAgICAgICAgaC5kZWVkLnNldE93bmVyKG5ld093bmVyKTsNCiAgICAgICAgZW5zLnNldFN1Ym5vZGVPd25lcihyb290Tm9kZSwgX2hhc2gsIG5ld093bmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IEFmdGVyIHNvbWUgdGltZSwgdGhlIG93bmVyIGNhbiByZWxlYXNlIHRoZSBwcm9wZXJ0eSBhbmQgZ2V0IHRoZWlyIGV0aGVyIGJhY2sNCiAgICAgKiBAcGFyYW0gX2hhc2ggVGhlIG5vZGUgdG8gcmVsZWFzZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJlbGVhc2VEZWVkKGJ5dGVzMzIgX2hhc2gpIG9ubHlPd25lcihfaGFzaCkgew0KICAgICAgICBlbnRyeSBoID0gX2VudHJpZXNbX2hhc2hdOw0KICAgICAgICBEZWVkIGRlZWRDb250cmFjdCA9IGguZGVlZDsNCiAgICAgICAgaWYgKG5vdyA8IGgucmVnaXN0cmF0aW9uRGF0ZSArIDEgeWVhcnMgDQogICAgICAgICAgICB8fCBub3cgPiByZWdpc3RyeVN0YXJ0ZWQgKyA4IHllYXJzKSB0aHJvdzsNCg0KICAgICAgICBIYXNoUmVsZWFzZWQoX2hhc2gsIGgudmFsdWUpOw0KICAgICAgICANCiAgICAgICAgaC52YWx1ZSA9IDA7DQogICAgICAgIGguaGlnaGVzdEJpZCA9IDA7DQogICAgICAgIGguZGVlZCA9IERlZWQoMCk7DQoNCiAgICAgICAgZW5zLnNldFN1Ym5vZGVPd25lcihyb290Tm9kZSwgX2hhc2gsIDApOw0KICAgICAgICBkZWVkQ29udHJhY3QuY2xvc2VEZWVkKDEwMDApOw0KICAgIH0gIA0KDQogICAgLyoqDQogICAgICogQGRldiBTdWJtaXQgYSBuYW1lIDYgY2hhcmFjdGVycyBsb25nIG9yIGxlc3MuIElmIGl0IGhhcyBiZWVuIHJlZ2lzdGVyZWQsIA0KICAgICAqIHRoZSBzdWJtaXR0ZXIgd2lsbCBlYXJuIDUwJSBvZiB0aGUgZGVlZCB2YWx1ZS4gV2UgYXJlIHB1cnBvc2VmdWxseQ0KICAgICAqIGhhbmRpY2FwcGluZyB0aGUgc2ltcGxpZmllZCByZWdpc3RyYXIgYXMgYSB3YXkgdG8gZm9yY2UgaXQgaW50byBiZWluZyByZXN0cnVjdHVyZWQNCiAgICAgKiBpbiBhIGZldyB5ZWFycy4NCiAgICAgKiBAcGFyYW0gdW5oYXNoZWROYW1lIEFuIGludmFsaWQgbmFtZSB0byBzZWFyY2ggZm9yIGluIHRoZSByZWdpc3RyeS4NCiAgICAgKiANCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpbnZhbGlkYXRlTmFtZShzdHJpbmcgdW5oYXNoZWROYW1lKSBpblN0YXRlKHNoYTModW5oYXNoZWROYW1lKSwgTW9kZS5Pd25lZCkgew0KICAgICAgICBpZiAoc3RybGVuKHVuaGFzaGVkTmFtZSkgPiA2ICkgdGhyb3c7DQogICAgICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTModW5oYXNoZWROYW1lKTsNCiAgICAgICAgDQogICAgICAgIGVudHJ5IGggPSBfZW50cmllc1toYXNoXTsNCiAgICAgICAgZW5zLnNldFN1Ym5vZGVPd25lcihyb290Tm9kZSwgaGFzaCwgMCk7DQogICAgICAgIGlmKGFkZHJlc3MoaC5kZWVkKSAhPSAwKSB7DQogICAgICAgICAgICAvLyBSZXdhcmQgdGhlIGRpc2NvdmVyZXIgd2l0aCA1MCUgb2YgdGhlIGRlZWQNCiAgICAgICAgICAgIC8vIFRoZSBwcmV2aW91cyBvd25lciBnZXRzIG5vdGhpbmcNCiAgICAgICAgICAgIGguZGVlZC5zZXRCYWxhbmNlKGguZGVlZC52YWx1ZSgpLzIpOw0KICAgICAgICAgICAgaC5kZWVkLnNldE93bmVyKG1zZy5zZW5kZXIpOw0KICAgICAgICAgICAgaC5kZWVkLmNsb3NlRGVlZCgxMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBIYXNoSW52YWxpZGF0ZWQoaGFzaCwgdW5oYXNoZWROYW1lLCBoLnZhbHVlLCBoLnJlZ2lzdHJhdGlvbkRhdGUpOw0KICAgICAgICBoLmRlZWQgPSBEZWVkKDApOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgVHJhbnNmZXJzIHRoZSBkZWVkIHRvIHRoZSBjdXJyZW50IHJlZ2lzdHJhciwgaWYgZGlmZmVyZW50IGZyb20gdGhpcyBvbmUuDQogICAgICogVXNlZCBkdXJpbmcgdGhlIHVwZ3JhZGUgcHJvY2VzcyB0byBhIHBlcm1hbmVudCByZWdpc3RyYXIuDQogICAgICogQHBhcmFtIF9oYXNoIFRoZSBuYW1lIGhhc2ggdG8gdHJhbnNmZXIuDQogICAgICovDQogICAgZnVuY3Rpb24gdHJhbnNmZXJSZWdpc3RyYXJzKGJ5dGVzMzIgX2hhc2gpIG9ubHlPd25lcihfaGFzaCkgew0KICAgICAgICB2YXIgcmVnaXN0cmFyID0gZW5zLm93bmVyKHJvb3ROb2RlKTsNCiAgICAgICAgaWYocmVnaXN0cmFyID09IGFkZHJlc3ModGhpcykpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICBlbnRyeSBoID0gX2VudHJpZXNbX2hhc2hdOw0KICAgICAgICBoLmRlZWQuc2V0UmVnaXN0cmFyKHJlZ2lzdHJhcik7DQogICAgfQ0KfQ=='