base 64 content
base64sNTPlaceHolder
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KDQovLy8gQGRldiBgT3duZWRgIGlzIGEgYmFzZSBsZXZlbCBjb250cmFjdCB0aGF0IGFzc2lnbnMgYW4gYG93bmVyYCB0aGF0IGNhbiBiZQ0KLy8vICBsYXRlciBjaGFuZ2VkDQpjb250cmFjdCBPd25lZCB7DQoNCiAgICAvLy8gQGRldiBgb3duZXJgIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbCBhIGZ1bmN0aW9uIHdpdGggdGhpcw0KICAgIC8vLyBtb2RpZmllcg0KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsNCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCg0KICAgIC8vLyBAbm90aWNlIFRoZSBDb25zdHJ1Y3RvciBhc3NpZ25zIHRoZSBtZXNzYWdlIHNlbmRlciB0byBiZSBgb3duZXJgDQogICAgZnVuY3Rpb24gT3duZWQoKSB7DQogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgICB9DQoNCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsNCg0KICAgIC8vLyBAbm90aWNlIGBvd25lcmAgY2FuIHN0ZXAgZG93biBhbmQgYXNzaWduIHNvbWUgb3RoZXIgYWRkcmVzcyB0byB0aGlzIHJvbGUNCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG93bmVyLiAweDAgY2FuIGJlIHVzZWQgdG8gY3JlYXRlDQogICAgLy8vICBhbiB1bm93bmVkIG5ldXRyYWwgdmF1bHQsIGhvd2V2ZXIgdGhhdCBjYW5ub3QgYmUgdW5kb25lDQogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfbmV3T3duZXIpIG9ubHlPd25lciB7DQogICAgICAgIG5ld093bmVyID0gX25ld093bmVyOw0KICAgIH0NCg0KDQogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgew0KICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBuZXdPd25lcikgew0KICAgICAgICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gQWJzdHJhY3QgY29udHJhY3QgZm9yIHRoZSBmdWxsIEVSQyAyMCBUb2tlbiBzdGFuZGFyZA0KLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwDQoNCmNvbnRyYWN0IEVSQzIwVG9rZW4gew0KICAgIC8qIFRoaXMgaXMgYSBzbGlnaHQgY2hhbmdlIHRvIHRoZSBFUkMyMCBiYXNlIHN0YW5kYXJkLg0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOw0KICAgIGlzIHJlcGxhY2VkIHdpdGg6DQogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7DQogICAgVGhpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZXMgYSBnZXR0ZXIgZnVuY3Rpb24gZm9yIHRoZSB0b3RhbFN1cHBseS4NCiAgICBUaGlzIGlzIG1vdmVkIHRvIHRoZSBiYXNlIGNvbnRyYWN0IHNpbmNlIHB1YmxpYyBnZXR0ZXIgZnVuY3Rpb25zIGFyZSBub3QNCiAgICBjdXJyZW50bHkgcmVjb2duaXNlZCBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbWF0Y2hpbmcgYWJzdHJhY3QNCiAgICBmdW5jdGlvbiBieSB0aGUgY29tcGlsZXIuDQogICAgKi8NCiAgICAvLy8gdG90YWwgYW1vdW50IG9mIHRva2Vucw0KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5Ow0KDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZA0KICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOw0KDQogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYA0KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQNCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90DQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KDQogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gDQogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyDQogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudA0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KDQogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF92YWx1ZWAgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXINCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zDQogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudA0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOw0KDQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7DQogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7DQp9DQoNCg0KDQovKioNCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MNCiAqLw0KbGlicmFyeSBTYWZlTWF0aCB7DQogIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIHVpbnQgYyA9IGEgKiBiOw0KICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDANCiAgICB1aW50IGMgPSBhIC8gYjsNCiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZA0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSArIGI7DQogICAgYXNzZXJ0KGMgPj0gYSk7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7DQogIH0NCg0KICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KfQ0KDQoNCi8qDQogICAgQ29weXJpZ2h0IDIwMTcsIEpvcmRpIEJheWxpbmENCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5DQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkNCiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcg0KICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwNCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZg0KICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUNCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLg0KDQogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UNCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4NCiAqLw0KDQovLy8gQHRpdGxlIER5bmFtaWNDZWlsaW5nIENvbnRyYWN0DQovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hDQovLy8gQGRldiBUaGlzIGNvbnRyYWN0IGNhbGN1bGF0ZXMgdGhlIGNlaWxpbmcgZnJvbSBhIHNlcmllcyBvZiBjdXJ2ZXMuDQovLy8gIFRoZXNlIGN1cnZlcyBhcmUgY29tbWl0dGVkIGZpcnN0IGFuZCByZXZlYWxlZCBsYXRlci4NCi8vLyAgQWxsIHRoZSBjdXJ2ZXMgbXVzdCBiZSBpbiBpbmNyZWFzaW5nIG9yZGVyIGFuZCB0aGUgbGFzdCBjdXJ2ZSBpcyBtYXJrZWQNCi8vLyAgYXMgdGhlIGxhc3Qgb25lLg0KLy8vICBUaGlzIGNvbnRyYWN0IGFsbG93cyB0byBoaWRlIGFuZCByZXZlYWwgdGhlIGNlaWxpbmcgYXQgd2lsbCBvZiB0aGUgb3duZXIuDQoNCg0KDQpjb250cmFjdCBEeW5hbWljQ2VpbGluZyBpcyBPd25lZCB7DQogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7DQoNCiAgICBzdHJ1Y3QgQ3VydmUgew0KICAgICAgICBieXRlczMyIGhhc2g7DQogICAgICAgIC8vIEFic29sdXRlIGxpbWl0IGZvciB0aGlzIGN1cnZlDQogICAgICAgIHVpbnQyNTYgbGltaXQ7DQogICAgICAgIC8vIFRoZSBmdW5kcyByZW1haW5pbmcgdG8gYmUgY29sbGVjdGVkIGFyZSBkaXZpZGVkIGJ5IGBzbG9wZUZhY3RvcmAgc21vb3RoIGNlaWxpbmcNCiAgICAgICAgLy8gd2l0aCBhIGxvbmcgdGFpbCB3aGVyZSBiaWcgYW5kIHNtYWxsIGJ1eWVycyBjYW4gdGFrZSBwYXJ0Lg0KICAgICAgICB1aW50MjU2IHNsb3BlRmFjdG9yOw0KICAgICAgICAvLyBUaGlzIGtlZXBzIHRoZSBjdXJ2ZSBmbGF0IGF0IHRoaXMgbnVtYmVyLCB1bnRpbCBmdW5kcyB0byBiZSBjb2xsZWN0ZWQgaXMgbGVzcyB0aGFuIHRoaXMNCiAgICAgICAgdWludDI1NiBjb2xsZWN0TWluaW11bTsNCiAgICB9DQoNCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cmlidXRpb247DQoNCiAgICBDdXJ2ZVtdIHB1YmxpYyBjdXJ2ZXM7DQogICAgdWludDI1NiBwdWJsaWMgY3VycmVudEluZGV4Ow0KICAgIHVpbnQyNTYgcHVibGljIHJldmVhbGVkQ3VydmVzOw0KICAgIGJvb2wgcHVibGljIGFsbFJldmVhbGVkOw0KDQogICAgLy8vIEBkZXYgYGNvbnRyaWJ1dGlvbmAgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzDQogICAgLy8vIG1vZGlmaWVyDQogICAgbW9kaWZpZXIgb25seUNvbnRyaWJ1dGlvbiB7DQogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjb250cmlidXRpb24pOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIER5bmFtaWNDZWlsaW5nKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9jb250cmlidXRpb24pIHsNCiAgICAgICAgb3duZXIgPSBfb3duZXI7DQogICAgICAgIGNvbnRyaWJ1dGlvbiA9IF9jb250cmlidXRpb247DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJ5IHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCB0byBjb21taXQNCiAgICAvLy8gIGFsbCB0aGUgY3VydmVzLg0KICAgIC8vLyBAcGFyYW0gX2N1cnZlSGFzaGVzIEFycmF5IG9mIGhhc2hlcyBvZiBlYWNoIGN1cnZlLiBFYWNoIGhhc2ggaXMgY2FsY3VsYXRlZA0KICAgIC8vLyAgYnkgdGhlIGBjYWxjdWxhdGVIYXNoYCBtZXRob2QuIE1vcmUgaGFzaGVzIHRoYW4gYWN0dWFsIGN1cnZlcyBjYW4gYmUNCiAgICAvLy8gIGNvbW1pdHRlZCBpbiBvcmRlciB0byBoaWRlIGFsc28gdGhlIG51bWJlciBvZiBjdXJ2ZXMuDQogICAgLy8vICBUaGUgcmVtYWluaW5nIGhhc2hlcyBjYW4gYmUganVzdCByYW5kb20gbnVtYmVycy4NCiAgICBmdW5jdGlvbiBzZXRIaWRkZW5DdXJ2ZXMoYnl0ZXMzMltdIF9jdXJ2ZUhhc2hlcykgcHVibGljIG9ubHlPd25lciB7DQogICAgICAgIHJlcXVpcmUoY3VydmVzLmxlbmd0aCA9PSAwKTsNCg0KICAgICAgICBjdXJ2ZXMubGVuZ3RoID0gX2N1cnZlSGFzaGVzLmxlbmd0aDsNCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2N1cnZlSGFzaGVzLmxlbmd0aDsgaSA9IGkuYWRkKDEpKSB7DQogICAgICAgICAgICBjdXJ2ZXNbaV0uaGFzaCA9IF9jdXJ2ZUhhc2hlc1tpXTsNCiAgICAgICAgfQ0KICAgIH0NCg0KDQogICAgLy8vIEBub3RpY2UgQW55Ym9keSBjYW4gcmV2ZWFsIHRoZSBuZXh0IGN1cnZlIGlmIGhlIGtub3dzIGl0Lg0KICAgIC8vLyBAcGFyYW0gX2xpbWl0IENlaWxpbmcgY2FwLg0KICAgIC8vLyAgKG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgcHJldmlvdXMgb25lKS4NCiAgICAvLy8gQHBhcmFtIF9sYXN0IGB0cnVlYCBpZiBpdCdzIHRoZSBsYXN0IGN1cnZlLg0KICAgIC8vLyBAcGFyYW0gX3NhbHQgUmFuZG9tIG51bWJlciB1c2VkIHRvIGNvbW1pdCB0aGUgY3VydmUNCiAgICBmdW5jdGlvbiByZXZlYWxDdXJ2ZSh1aW50MjU2IF9saW1pdCwgdWludDI1NiBfc2xvcGVGYWN0b3IsIHVpbnQyNTYgX2NvbGxlY3RNaW5pbXVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgX2xhc3QsIGJ5dGVzMzIgX3NhbHQpIHB1YmxpYyB7DQogICAgICAgIHJlcXVpcmUoIWFsbFJldmVhbGVkKTsNCg0KICAgICAgICByZXF1aXJlKGN1cnZlc1tyZXZlYWxlZEN1cnZlc10uaGFzaCA9PSBjYWxjdWxhdGVIYXNoKF9saW1pdCwgX3Nsb3BlRmFjdG9yLCBfY29sbGVjdE1pbmltdW0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xhc3QsIF9zYWx0KSk7DQoNCiAgICAgICAgcmVxdWlyZShfbGltaXQgIT0gMCAmJiBfc2xvcGVGYWN0b3IgIT0gMCAmJiBfY29sbGVjdE1pbmltdW0gIT0gMCk7DQogICAgICAgIGlmIChyZXZlYWxlZEN1cnZlcyA+IDApIHsNCiAgICAgICAgICAgIHJlcXVpcmUoX2xpbWl0ID49IGN1cnZlc1tyZXZlYWxlZEN1cnZlcy5zdWIoMSldLmxpbWl0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGN1cnZlc1tyZXZlYWxlZEN1cnZlc10ubGltaXQgPSBfbGltaXQ7DQogICAgICAgIGN1cnZlc1tyZXZlYWxlZEN1cnZlc10uc2xvcGVGYWN0b3IgPSBfc2xvcGVGYWN0b3I7DQogICAgICAgIGN1cnZlc1tyZXZlYWxlZEN1cnZlc10uY29sbGVjdE1pbmltdW0gPSBfY29sbGVjdE1pbmltdW07DQogICAgICAgIHJldmVhbGVkQ3VydmVzID0gcmV2ZWFsZWRDdXJ2ZXMuYWRkKDEpOw0KDQogICAgICAgIGlmIChfbGFzdCkgYWxsUmV2ZWFsZWQgPSB0cnVlOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFJldmVhbCBtdWx0aXBsZSBjdXJ2ZXMgYXQgb25jZQ0KICAgIGZ1bmN0aW9uIHJldmVhbE11bHRpKHVpbnQyNTZbXSBfbGltaXRzLCB1aW50MjU2W10gX3Nsb3BlRmFjdG9ycywgdWludDI1NltdIF9jb2xsZWN0TWluaW11bXMsDQogICAgICAgICAgICAgICAgICAgICAgICAgYm9vbFtdIF9sYXN0cywgYnl0ZXMzMltdIF9zYWx0cykgcHVibGljIHsNCiAgICAgICAgLy8gRG8gbm90IGFsbG93IG5vbmUgYW5kIG5lZWRzIHRvIGJlIHNhbWUgbGVuZ3RoIGZvciBhbGwgcGFyYW1ldGVycw0KICAgICAgICByZXF1aXJlKF9saW1pdHMubGVuZ3RoICE9IDAgJiYNCiAgICAgICAgICAgICAgICBfbGltaXRzLmxlbmd0aCA9PSBfc2xvcGVGYWN0b3JzLmxlbmd0aCAmJg0KICAgICAgICAgICAgICAgIF9saW1pdHMubGVuZ3RoID09IF9jb2xsZWN0TWluaW11bXMubGVuZ3RoICYmDQogICAgICAgICAgICAgICAgX2xpbWl0cy5sZW5ndGggPT0gX2xhc3RzLmxlbmd0aCAmJg0KICAgICAgICAgICAgICAgIF9saW1pdHMubGVuZ3RoID09IF9zYWx0cy5sZW5ndGgpOw0KDQogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9saW1pdHMubGVuZ3RoOyBpID0gaS5hZGQoMSkpIHsNCiAgICAgICAgICAgIHJldmVhbEN1cnZlKF9saW1pdHNbaV0sIF9zbG9wZUZhY3RvcnNbaV0sIF9jb2xsZWN0TWluaW11bXNbaV0sDQogICAgICAgICAgICAgICAgICAgICAgICBfbGFzdHNbaV0sIF9zYWx0c1tpXSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBNb3ZlIHRvIGN1cnZlLCB1c2VkIGFzIGEgZmFpbHNhZmUNCiAgICBmdW5jdGlvbiBtb3ZlVG8odWludDI1NiBfaW5kZXgpIHB1YmxpYyBvbmx5T3duZXIgew0KICAgICAgICByZXF1aXJlKF9pbmRleCA8IHJldmVhbGVkQ3VydmVzICYmICAgICAgIC8vIE5vIG1vcmUgY3VydmVzDQogICAgICAgICAgICAgICAgX2luZGV4ID09IGN1cnJlbnRJbmRleC5hZGQoMSkpOyAgLy8gT25seSBtb3ZlIG9uZSBpbmRleCBhdCBhIHRpbWUNCiAgICAgICAgY3VycmVudEluZGV4ID0gX2luZGV4Ow0KICAgIH0NCg0KICAgIC8vLyBAcmV0dXJuIFJldHVybiB0aGUgZnVuZHMgdG8gY29sbGVjdCBmb3IgdGhlIGN1cnJlbnQgcG9pbnQgb24gdGhlIGN1cnZlDQogICAgLy8vICAob3IgMCBpZiBubyBjdXJ2ZXMgcmV2ZWFsZWQgeWV0KQ0KICAgIGZ1bmN0aW9uIHRvQ29sbGVjdCh1aW50MjU2IGNvbGxlY3RlZCkgcHVibGljIG9ubHlDb250cmlidXRpb24gcmV0dXJucyAodWludDI1Nikgew0KICAgICAgICBpZiAocmV2ZWFsZWRDdXJ2ZXMgPT0gMCkgcmV0dXJuIDA7DQoNCiAgICAgICAgLy8gTW92ZSB0byB0aGUgbmV4dCBjdXJ2ZQ0KICAgICAgICBpZiAoY29sbGVjdGVkID49IGN1cnZlc1tjdXJyZW50SW5kZXhdLmxpbWl0KSB7ICAvLyBDYXRjaGVzIGBsaW1pdCA9PSAwYA0KICAgICAgICAgICAgdWludDI1NiBuZXh0SW5kZXggPSBjdXJyZW50SW5kZXguYWRkKDEpOw0KICAgICAgICAgICAgaWYgKG5leHRJbmRleCA+PSByZXZlYWxlZEN1cnZlcykgcmV0dXJuIDA7ICAvLyBObyBtb3JlIGN1cnZlcw0KICAgICAgICAgICAgY3VycmVudEluZGV4ID0gbmV4dEluZGV4Ow0KICAgICAgICAgICAgaWYgKGNvbGxlY3RlZCA+PSBjdXJ2ZXNbY3VycmVudEluZGV4XS5saW1pdCkgcmV0dXJuIDA7ICAvLyBDYXRjaGVzIGBsaW1pdCA9PSAwYA0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRXZlcnl0aGluZyBsZWZ0IHRvIGNvbGxlY3QgZnJvbSB0aGlzIGxpbWl0DQogICAgICAgIHVpbnQyNTYgZGlmZmVyZW5jZSA9IGN1cnZlc1tjdXJyZW50SW5kZXhdLmxpbWl0LnN1Yihjb2xsZWN0ZWQpOw0KDQogICAgICAgIC8vIEN1cnJlbnQgcG9pbnQgb24gdGhlIGN1cnZlDQogICAgICAgIHVpbnQyNTYgY29sbGVjdCA9IGRpZmZlcmVuY2UuZGl2KGN1cnZlc1tjdXJyZW50SW5kZXhdLnNsb3BlRmFjdG9yKTsNCg0KICAgICAgICAvLyBQcmV2ZW50cyBwYXlpbmcgdG9vIG11Y2ggZmVlcyB2cyB0byBiZSBjb2xsZWN0ZWQ7IGJyZWFrcyBsb25nIHRhaWwNCiAgICAgICAgaWYgKGNvbGxlY3QgPD0gY3VydmVzW2N1cnJlbnRJbmRleF0uY29sbGVjdE1pbmltdW0pIHsNCiAgICAgICAgICAgIGlmIChkaWZmZXJlbmNlID4gY3VydmVzW2N1cnJlbnRJbmRleF0uY29sbGVjdE1pbmltdW0pIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gY3VydmVzW2N1cnJlbnRJbmRleF0uY29sbGVjdE1pbmltdW07DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBkaWZmZXJlbmNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGNvbGxlY3Q7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIHRoZSBoYXNoIG9mIGEgY3VydmUuDQogICAgLy8vIEBwYXJhbSBfbGltaXQgQ2VpbGluZyBjYXAuDQogICAgLy8vIEBwYXJhbSBfbGFzdCBgdHJ1ZWAgaWYgaXQncyB0aGUgbGFzdCBjdXJ2ZS4NCiAgICAvLy8gQHBhcmFtIF9zYWx0IFJhbmRvbSBudW1iZXIgdGhhdCB3aWxsIGJlIG5lZWRlZCB0byByZXZlYWwgdGhpcyBjdXJ2ZS4NCiAgICAvLy8gQHJldHVybiBUaGUgY2FsY3VsYXRlZCBoYXNoIG9mIHRoaXMgY3VydmUgdG8gYmUgdXNlZCBpbiB0aGUgYHNldEhpZGRlbkN1cnZlc2AgbWV0aG9kDQogICAgZnVuY3Rpb24gY2FsY3VsYXRlSGFzaCh1aW50MjU2IF9saW1pdCwgdWludDI1NiBfc2xvcGVGYWN0b3IsIHVpbnQyNTYgX2NvbGxlY3RNaW5pbXVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBfbGFzdCwgYnl0ZXMzMiBfc2FsdCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsNCiAgICAgICAgcmV0dXJuIGtlY2NhazI1NihfbGltaXQsIF9zbG9wZUZhY3RvciwgX2NvbGxlY3RNaW5pbXVtLCBfbGFzdCwgX3NhbHQpOw0KICAgIH0NCg0KICAgIC8vLyBAcmV0dXJuIFJldHVybiB0aGUgdG90YWwgbnVtYmVyIG9mIGN1cnZlcyBjb21taXR0ZWQNCiAgICAvLy8gIChjYW4gYmUgbGFyZ2VyIHRoYW4gdGhlIG51bWJlciBvZiBhY3R1YWwgY3VydmVzIG9uIHRoZSBjdXJ2ZSB0byBoaWRlDQogICAgLy8vICB0aGUgcmVhbCBudW1iZXIgb2YgY3VydmVzKQ0KICAgIGZ1bmN0aW9uIG5DdXJ2ZXMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgICAgICByZXR1cm4gY3VydmVzLmxlbmd0aDsNCiAgICB9DQoNCn0NCg0KDQovKg0KICAgIENvcHlyaWdodCAyMDE2LCBKb3JkaSBCYXlsaW5hDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQ0KICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5DQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCg0KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQogKi8NCg0KLy8vIEB0aXRsZSBNaW5pTWVUb2tlbiBDb250cmFjdA0KLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQ0KLy8vIEBkZXYgVGhpcyB0b2tlbiBjb250cmFjdCdzIGdvYWwgaXMgdG8gbWFrZSBpdCBlYXN5IGZvciBhbnlvbmUgdG8gY2xvbmUgdGhpcw0KLy8vICB0b2tlbiB1c2luZyB0aGUgdG9rZW4gZGlzdHJpYnV0aW9uIGF0IGEgZ2l2ZW4gYmxvY2ssIHRoaXMgd2lsbCBhbGxvdyBEQU8ncw0KLy8vICBhbmQgREFwcHMgdG8gdXBncmFkZSB0aGVpciBmZWF0dXJlcyBpbiBhIGRlY2VudHJhbGl6ZWQgbWFubmVyIHdpdGhvdXQNCi8vLyAgYWZmZWN0aW5nIHRoZSBvcmlnaW5hbCB0b2tlbg0KLy8vIEBkZXYgSXQgaXMgRVJDMjAgY29tcGxpYW50LCBidXQgc3RpbGwgbmVlZHMgdG8gdW5kZXIgZ28gZnVydGhlciB0ZXN0aW5nLg0KDQoNCi8vLyBAZGV2IFRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0IG11c3QgaW1wbGVtZW50IHRoZXNlIGZ1bmN0aW9ucw0KY29udHJhY3QgVG9rZW5Db250cm9sbGVyIHsNCiAgICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0DQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZXRoZXIgaXMgYWNjZXB0ZWQsIGZhbHNlIGlmIGl0IHRocm93cw0KICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcGF5YWJsZSByZXR1cm5zKGJvb2wpOw0KDQogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0b2tlbiB0cmFuc2ZlciBhbGxvd2luZyB0aGUNCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZA0KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXINCiAgICAvLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyDQogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2Zlcg0KICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcmV0dXJucyhib29sKTsNCg0KICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQ0KICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYA0KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbA0KICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwNCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkNCiAgICAgICAgcmV0dXJucyhib29sKTsNCn0NCg0KY29udHJhY3QgQ29udHJvbGxlZCB7DQogICAgLy8vIEBub3RpY2UgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyb2xsZXIgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsDQogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcg0KICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgdGhyb3c7IF87IH0NCg0KICAgIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7DQoNCiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgeyBjb250cm9sbGVyID0gbXNnLnNlbmRlcjt9DQoNCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgVGhlIG5ldyBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdA0KICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgb25seUNvbnRyb2xsZXIgew0KICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7DQogICAgfQ0KfQ0KDQpjb250cmFjdCBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrIHsNCiAgICBmdW5jdGlvbiByZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBmcm9tLCB1aW50MjU2IF9hbW91bnQsIGFkZHJlc3MgX3Rva2VuLCBieXRlcyBfZGF0YSk7DQp9DQoNCi8vLyBAZGV2IFRoZSBhY3R1YWwgdG9rZW4gY29udHJhY3QsIHRoZSBkZWZhdWx0IGNvbnRyb2xsZXIgaXMgdGhlIG1zZy5zZW5kZXINCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQ0KLy8vICB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0LCB3aGljaCBHaXZldGggd2lsbCBjYWxsIGEgIkNhbXBhaWduIg0KY29udHJhY3QgTWluaU1lVG9rZW4gaXMgQ29udHJvbGxlZCB7DQoNCiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgIC8vVGhlIFRva2VuJ3MgbmFtZTogZS5nLiBEaWdpeERBTyBUb2tlbnMNCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgIC8vTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0DQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGUuZy4gUkVQDQogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJ01NVF8wLjEnOyAvL0FuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZQ0KDQoNCiAgICAvLy8gQGRldiBgQ2hlY2twb2ludGAgaXMgdGhlIHN0cnVjdHVyZSB0aGF0IGF0dGFjaGVzIGEgYmxvY2sgbnVtYmVyIHRvIGENCiAgICAvLy8gIGdpdmVuIHZhbHVlLCB0aGUgYmxvY2sgbnVtYmVyIGF0dGFjaGVkIGlzIHRoZSBvbmUgdGhhdCBsYXN0IGNoYW5nZWQgdGhlDQogICAgLy8vICB2YWx1ZQ0KICAgIHN0cnVjdCAgQ2hlY2twb2ludCB7DQoNCiAgICAgICAgLy8gYGZyb21CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSB2YWx1ZSB3YXMgZ2VuZXJhdGVkIGZyb20NCiAgICAgICAgdWludDEyOCBmcm9tQmxvY2s7DQoNCiAgICAgICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcg0KICAgICAgICB1aW50MTI4IHZhbHVlOw0KICAgIH0NCg0KICAgIC8vIGBwYXJlbnRUb2tlbmAgaXMgdGhlIFRva2VuIGFkZHJlc3MgdGhhdCB3YXMgY2xvbmVkIHRvIHByb2R1Y2UgdGhpcyB0b2tlbjsNCiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZA0KICAgIE1pbmlNZVRva2VuIHB1YmxpYyBwYXJlbnRUb2tlbjsNCg0KICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcw0KICAgIC8vICB1c2VkIHRvIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIENsb25lIFRva2VuDQogICAgdWludCBwdWJsaWMgcGFyZW50U25hcFNob3RCbG9jazsNCg0KICAgIC8vIGBjcmVhdGlvbkJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIENsb25lIFRva2VuIHdhcyBjcmVhdGVkDQogICAgdWludCBwdWJsaWMgY3JlYXRpb25CbG9jazsNCg0KICAgIC8vIGBiYWxhbmNlc2AgaXMgdGhlIG1hcCB0aGF0IHRyYWNrcyB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGluIHRoaXMNCiAgICAvLyAgY29udHJhY3Qgd2hlbiB0aGUgYmFsYW5jZSBjaGFuZ2VzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgY2hhbmdlDQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcA0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsNCg0KICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOw0KDQogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbg0KICAgIENoZWNrcG9pbnRbXSB0b3RhbFN1cHBseUhpc3Rvcnk7DQoNCiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4NCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOw0KDQogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2Vucw0KICAgIE1pbmlNZVRva2VuRmFjdG9yeSBwdWJsaWMgdG9rZW5GYWN0b3J5Ow0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBDb25zdHJ1Y3Rvcg0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgTWluaU1lVG9rZW4NCiAgICAvLy8gQHBhcmFtIF90b2tlbkZhY3RvcnkgVGhlIGFkZHJlc3Mgb2YgdGhlIE1pbmlNZVRva2VuRmFjdG9yeSBjb250cmFjdCB0aGF0DQogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQ0KICAgIC8vLyAgZGVwbG95ZWQgZmlyc3QNCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSBwYXJlbnQgdG9rZW4sIHNldCB0byAweDAgaWYgaXQgaXMgYQ0KICAgIC8vLyAgbmV3IHRva2VuDQogICAgLy8vIEBwYXJhbSBfcGFyZW50U25hcFNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbA0KICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4sIHNldCB0byAwIGlmIGl0DQogICAgLy8vICBpcyBhIG5ldyB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICBmdW5jdGlvbiBNaW5pTWVUb2tlbigNCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LA0KICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwNCiAgICAgICAgdWludCBfcGFyZW50U25hcFNob3RCbG9jaywNCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsDQogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsDQogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsDQogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQNCiAgICApIHsNCiAgICAgICAgdG9rZW5GYWN0b3J5ID0gTWluaU1lVG9rZW5GYWN0b3J5KF90b2tlbkZhY3RvcnkpOw0KICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUNCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscw0KICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbA0KICAgICAgICBwYXJlbnRUb2tlbiA9IE1pbmlNZVRva2VuKF9wYXJlbnRUb2tlbik7DQogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsNCiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOw0KICAgICAgICBjcmVhdGlvbkJsb2NrID0gZ2V0QmxvY2tOdW1iZXIoKTsNCiAgICB9DQoNCg0KLy8vLy8vLy8vLy8vLy8vLy8vLw0KLy8gRVJDMjAgTWV0aG9kcw0KLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgDQogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudA0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdA0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoIXRyYW5zZmVyc0VuYWJsZWQpIHRocm93Ow0KICAgICAgICByZXR1cm4gZG9UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdA0KICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYA0KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkDQogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudA0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZA0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQNCiAgICApIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KDQogICAgICAgIC8vIFRoZSBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QgY2FuIG1vdmUgdG9rZW5zIGFyb3VuZCBhdCB3aWxsLA0KICAgICAgICAvLyAgdGhpcyBpcyBpbXBvcnRhbnQgdG8gcmVjb2duaXplISBDb25maXJtIHRoYXQgeW91IHRydXN0IHRoZQ0KICAgICAgICAvLyAgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0LCB3aGljaCBpbiBtb3N0IHNpdHVhdGlvbnMgc2hvdWxkIGJlDQogICAgICAgIC8vICBhbm90aGVyIG9wZW4gc291cmNlIHNtYXJ0IGNvbnRyYWN0IG9yIDB4MA0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB7DQogICAgICAgICAgICBpZiAoIXRyYW5zZmVyc0VuYWJsZWQpIHRocm93Ow0KDQogICAgICAgICAgICAvLyBUaGUgc3RhbmRhcmQgRVJDIDIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbmFsaXR5DQogICAgICAgICAgICBpZiAoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPCBfYW1vdW50KSByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfYW1vdW50Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbg0KICAgIC8vLyAgb25seSBiZSBjYWxsZWQgYnkgb3RoZXIgZnVuY3Rpb25zIGluIHRoaXMgY29udHJhY3QuDQogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50DQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwNCiAgICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQNCiAgICApIGludGVybmFsIHJldHVybnMoYm9vbCkgew0KDQogICAgICAgICAgIGlmIChfYW1vdW50ID09IDApIHsNCiAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICB9DQoNCiAgICAgICAgICAgaWYgKHBhcmVudFNuYXBTaG90QmxvY2sgPj0gZ2V0QmxvY2tOdW1iZXIoKSkgdGhyb3c7DQoNCiAgICAgICAgICAgLy8gRG8gbm90IGFsbG93IHRyYW5zZmVyIHRvIDB4MCBvciB0aGUgdG9rZW4gY29udHJhY3QgaXRzZWxmDQogICAgICAgICAgIGlmICgoX3RvID09IDApIHx8IChfdG8gPT0gYWRkcmVzcyh0aGlzKSkpIHRocm93Ow0KDQogICAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgYmVpbmcgdHJhbnNmZXJlZCBpcyBtb3JlIHRoYW4gdGhlIGJhbGFuY2Ugb2YgdGhlDQogICAgICAgICAgIC8vICBhY2NvdW50IHRoZSB0cmFuc2ZlciByZXR1cm5zIGZhbHNlDQogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mQXQoX2Zyb20sIGdldEJsb2NrTnVtYmVyKCkpOw0KICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHsNCiAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgfQ0KDQogICAgICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgdHJhbnNmZXINCiAgICAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsNCiAgICAgICAgICAgICAgIGlmICghVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCkpDQogICAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgICAgfQ0KDQogICAgICAgICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzDQogICAgICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMNCiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfZnJvbV0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsNCg0KICAgICAgICAgICAvLyBUaGVuIHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzDQogICAgICAgICAgIC8vICByZWNlaXZpbmcgdGhlIHRva2Vucw0KICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGdldEJsb2NrTnVtYmVyKCkpOw0KICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50IDwgcHJldmlvdXNCYWxhbmNlVG8pIHRocm93OyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cNCiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfdG9dLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOw0KDQogICAgICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbg0KICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsNCg0KICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQNCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCB0aGUgY3VycmVudCBibG9jaw0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7DQogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdChfb3duZXIsIGdldEJsb2NrTnVtYmVyKCkpOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24NCiAgICAvLy8gIGl0cyBiZWhhbGYuIFRoaXMgaXMgYSBtb2RpZmllZCB2ZXJzaW9uIG9mIHRoZSBFUkMyMCBhcHByb3ZlIGZ1bmN0aW9uDQogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXINCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2Vucw0KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXINCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsNCg0KICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYA0KICAgICAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwwKWAgaWYgaXQgaXMgbm90DQogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOg0KICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkNCiAgICAgICAgaWYgKChfYW1vdW50IT0wKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0wKSkgdGhyb3c7DQoNCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwNCiAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsNCiAgICAgICAgICAgIGlmICghVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uQXBwcm92ZShtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCkpDQogICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7DQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcA0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2Vucw0KICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQNCiAgICAvLy8gIHRvIHNwZW5kDQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyDQogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgew0KICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24NCiAgICAvLy8gIGl0cyBiZWhhbGYsIGFuZCB0aGVuIGEgZnVuY3Rpb24gaXMgdHJpZ2dlcmVkIGluIHRoZSBjb250cmFjdCB0aGF0IGlzDQogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bw0KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28NCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bA0KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMgX2V4dHJhRGF0YQ0KICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmICghYXBwcm92ZShfc3BlbmRlciwgX2Ftb3VudCkpIHRocm93Ow0KDQogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgNCiAgICAgICAgICAgIG1zZy5zZW5kZXIsDQogICAgICAgICAgICBfYW1vdW50LA0KICAgICAgICAgICAgdGhpcywNCiAgICAgICAgICAgIF9leHRyYURhdGENCiAgICAgICAgKTsNCg0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zDQogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMNCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QXQoZ2V0QmxvY2tOdW1iZXIoKSk7DQogICAgfQ0KDQoNCi8vLy8vLy8vLy8vLy8vLy8NCi8vIFF1ZXJ5IGJhbGFuY2UgYW5kIHRvdGFsU3VwcGx5IGluIEhpc3RvcnkNCi8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIC8vLyBAZGV2IFF1ZXJpZXMgdGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYA0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQNCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZA0KICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIGF0IGBfYmxvY2tOdW1iZXJgDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mQXQoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudA0KICAgICAgICByZXR1cm5zICh1aW50KSB7DQoNCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgYmFsYW5jZSBvZiB0aGUgdG9rZW4gaXMNCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdA0KICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQ0KICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhhdCB0b2tlbiBhcyB0aGlzIGNvbnRhaW5zIGluaXRpYWwgYmFsYW5jZSBvZg0KICAgICAgICAvLyAgdGhpcyB0b2tlbg0KICAgICAgICBpZiAoKGJhbGFuY2VzW19vd25lcl0ubGVuZ3RoID09IDApDQogICAgICAgICAgICB8fCAoYmFsYW5jZXNbX293bmVyXVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7DQogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gSGFzIG5vIHBhcmVudA0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdChiYWxhbmNlc1tfb3duZXJdLCBfYmxvY2tOdW1iZXIpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLg0KICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgdG90YWxTdXBwbHkgaXMgcXVlcmllZA0KICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGBfYmxvY2tOdW1iZXJgDQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7DQoNCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgdG90YWxTdXBwbHkgb2YgdGhlIHRva2VuIGlzDQogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQNCiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0YCBiZSBxdWVyaWVkIGF0IHRoZQ0KICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhpcyB0b2tlbiBhcyB0aGF0IGNvbnRhaW5zIHRvdGFsU3VwcGx5IG9mIHRoaXMNCiAgICAgICAgLy8gIHRva2VuIGF0IHRoaXMgYmxvY2sgbnVtYmVyLg0KICAgICAgICBpZiAoKHRvdGFsU3VwcGx5SGlzdG9yeS5sZW5ndGggPT0gMCkNCiAgICAgICAgICAgIHx8ICh0b3RhbFN1cHBseUhpc3RvcnlbMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgew0KICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdChtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIHRvdGFsU3VwcGx5IGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBfYmxvY2tOdW1iZXIpOw0KICAgICAgICB9DQogICAgfQ0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBDbG9uZSBUb2tlbiBNZXRob2QNCi8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgYSBuZXcgY2xvbmUgdG9rZW4gd2l0aCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gYmVpbmcNCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYA0KICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5OYW1lIE5hbWUgb2YgdGhlIGNsb25lIHRva2VuDQogICAgLy8vIEBwYXJhbSBfY2xvbmVEZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0DQogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuDQogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayB3aGVuIHRoZSBkaXN0cmlidXRpb24gb2YgdGhlIHBhcmVudCB0b2tlbiBpcw0KICAgIC8vLyAgY29waWVkIHRvIHNldCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIG5ldyBjbG9uZSB0b2tlbjsNCiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyB6ZXJvIHRoYW4gdGhlIGFjdHVhbCBibG9jaywgdGhlIGN1cnJlbnQgYmxvY2sgaXMgdXNlZA0KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lDQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBNaW5pTWVUb2tlbiBDb250cmFjdA0KICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oDQogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlbk5hbWUsDQogICAgICAgIHVpbnQ4IF9jbG9uZURlY2ltYWxVbml0cywNCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuU3ltYm9sLA0KICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLA0KICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkDQogICAgICAgICkgcmV0dXJucyhhZGRyZXNzKSB7DQogICAgICAgIGlmIChfc25hcHNob3RCbG9jayA9PSAwKSBfc25hcHNob3RCbG9jayA9IGdldEJsb2NrTnVtYmVyKCk7DQogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigNCiAgICAgICAgICAgIHRoaXMsDQogICAgICAgICAgICBfc25hcHNob3RCbG9jaywNCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwNCiAgICAgICAgICAgIF9jbG9uZURlY2ltYWxVbml0cywNCiAgICAgICAgICAgIF9jbG9uZVRva2VuU3ltYm9sLA0KICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQNCiAgICAgICAgICAgICk7DQoNCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOw0KDQogICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRva2VuIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbg0KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsNCiAgICAgICAgcmV0dXJuIGFkZHJlc3MoY2xvbmVUb2tlbik7DQogICAgfQ0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBHZW5lcmF0ZSBhbmQgZGVzdHJveSB0b2tlbnMNCi8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIEdlbmVyYXRlcyBgX2Ftb3VudGAgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIGBfb3duZXJgDQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zDQogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgZ2VuZXJhdGVkDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBnZW5lcmF0ZWQgY29ycmVjdGx5DQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudA0KICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGdldEJsb2NrTnVtYmVyKCkpOw0KICAgICAgICBpZiAoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50IDwgY3VyVG90YWxTdXBwbHkpIHRocm93OyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cNCiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCk7DQogICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOw0KICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50IDwgcHJldmlvdXNCYWxhbmNlVG8pIHRocm93OyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cNCiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOw0KICAgICAgICBUcmFuc2ZlcigwLCBfb3duZXIsIF9hbW91bnQpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCg0KICAgIC8vLyBAbm90aWNlIEJ1cm5zIGBfYW1vdW50YCB0b2tlbnMgZnJvbSBgX293bmVyYA0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBsb3NlIHRoZSB0b2tlbnMNCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXJuDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBidXJuZWQgY29ycmVjdGx5DQogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50DQogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7DQogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgZ2V0QmxvY2tOdW1iZXIoKSk7DQogICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSA8IF9hbW91bnQpIHRocm93Ow0KICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgLSBfYW1vdW50KTsNCiAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsNCiAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB0aHJvdzsNCiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7DQogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMNCi8vLy8vLy8vLy8vLy8vLy8NCg0KDQogICAgLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQ0KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lDQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIG9ubHlDb250cm9sbGVyIHsNCiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOw0KICAgIH0NCg0KLy8vLy8vLy8vLy8vLy8vLw0KLy8gSW50ZXJuYWwgaGVscGVyIGZ1bmN0aW9ucyB0byBxdWVyeSBhbmQgc2V0IGEgdmFsdWUgaW4gYSBzbmFwc2hvdCBhcnJheQ0KLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLy8vIEBkZXYgYGdldFZhbHVlQXRgIHJldHJpZXZlcyB0aGUgbnVtYmVyIG9mIHRva2VucyBhdCBhIGdpdmVuIGJsb2NrIG51bWJlcg0KICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQNCiAgICAvLy8gQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgbnVtYmVyIHRvIHJldHJpZXZlIHRoZSB2YWx1ZSBhdA0KICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdG9rZW5zIGJlaW5nIHF1ZXJpZWQNCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jaw0KICAgICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICBpZiAoY2hlY2twb2ludHMubGVuZ3RoID09IDApIHJldHVybiAwOw0KDQogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlDQogICAgICAgIGlmIChfYmxvY2sgPj0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLmZyb21CbG9jaykNCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7DQogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOw0KDQogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQ0KICAgICAgICB1aW50IG1pbiA9IDA7DQogICAgICAgIHVpbnQgbWF4ID0gY2hlY2twb2ludHMubGVuZ3RoLTE7DQogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsNCiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOw0KICAgICAgICAgICAgaWYgKGNoZWNrcG9pbnRzW21pZF0uZnJvbUJsb2NrPD1fYmxvY2spIHsNCiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG1heCA9IG1pZC0xOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjaGVja3BvaW50c1ttaW5dLnZhbHVlOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IGB1cGRhdGVWYWx1ZUF0Tm93YCB1c2VkIHRvIHVwZGF0ZSB0aGUgYGJhbGFuY2VzYCBtYXAgYW5kIHRoZQ0KICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWANCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIGRhdGEgYmVpbmcgdXBkYXRlZA0KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBuZXcgbnVtYmVyIG9mIHRva2Vucw0KICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlDQogICAgKSBpbnRlcm5hbCAgew0KICAgICAgICBpZiAoKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKQ0KICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBnZXRCbG9ja051bWJlcigpKSkgew0KICAgICAgICAgICAgICAgQ2hlY2twb2ludCBuZXdDaGVja1BvaW50ID0gY2hlY2twb2ludHNbIGNoZWNrcG9pbnRzLmxlbmd0aCsrIF07DQogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LmZyb21CbG9jayA9ICB1aW50MTI4KGdldEJsb2NrTnVtYmVyKCkpOw0KICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsNCiAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsNCiAgICAgICAgICAgICAgIG9sZENoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7DQogICAgICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBkZXRlcm1pbmUgaWYgYW4gYWRkcmVzcyBpcyBhIGNvbnRyYWN0DQogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkDQogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QNCiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMoYm9vbCkgew0KICAgICAgICB1aW50IHNpemU7DQogICAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHNpemU+MDsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBIZWxwZXIgZnVuY3Rpb24gdG8gcmV0dXJuIGEgbWluIGJldHdlbiB0aGUgdHdvIHVpbnRzDQogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFRoZSBmYWxsYmFjayBmdW5jdGlvbjogSWYgdGhlIGNvbnRyYWN0J3MgY29udHJvbGxlciBoYXMgbm90IGJlZW4NCiAgICAvLy8gIHNldCB0byAwLCB0aGVuIHRoZSBgcHJveHlQYXltZW50YCBtZXRob2QgaXMgY2FsbGVkIHdoaWNoIHJlbGF5cyB0aGUNCiAgICAvLy8gIGV0aGVyIGFuZCBjcmVhdGVzIHRva2VucyBhcyBkZXNjcmliZWQgaW4gdGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QNCiAgICBmdW5jdGlvbiAoKSAgcGF5YWJsZSB7DQogICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7DQogICAgICAgICAgICBpZiAoISBUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpDQogICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgIH0NCg0KDQovLy8vLy8vLy8vDQovLyBUZXN0aW5nIHNwZWNpZmljIG1ldGhvZHMNCi8vLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIFRoaXMgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbiBieSB0aGUgdGVzdCBNb2Nrcy4NCiAgICBmdW5jdGlvbiBnZXRCbG9ja051bWJlcigpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgcmV0dXJuIGJsb2NrLm51bWJlcjsNCiAgICB9DQoNCi8vLy8vLy8vLy8NCi8vIFNhZmV0eSBNZXRob2RzDQovLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkNCiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuDQogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3Zlcg0KICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLg0KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBvbmx5Q29udHJvbGxlciB7DQogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7DQogICAgICAgICAgICBjb250cm9sbGVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBFUkMyMFRva2VuIHRva2VuID0gRVJDMjBUb2tlbihfdG9rZW4pOw0KICAgICAgICB1aW50IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7DQogICAgICAgIHRva2VuLnRyYW5zZmVyKGNvbnRyb2xsZXIsIGJhbGFuY2UpOw0KICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7DQogICAgfQ0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBFdmVudHMNCi8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50IF9hbW91bnQpOw0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsNCiAgICBldmVudCBOZXdDbG9uZVRva2VuKGFkZHJlc3MgaW5kZXhlZCBfY2xvbmVUb2tlbiwgdWludCBfc25hcHNob3RCbG9jayk7DQogICAgZXZlbnQgQXBwcm92YWwoDQogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsDQogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwNCiAgICAgICAgdWludDI1NiBfYW1vdW50DQogICAgICAgICk7DQoNCn0NCg0KDQovLy8vLy8vLy8vLy8vLy8vDQovLyBNaW5pTWVUb2tlbkZhY3RvcnkNCi8vLy8vLy8vLy8vLy8vLy8NCg0KLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuDQovLy8gIEluIHNvbGlkaXR5IHRoaXMgaXMgdGhlIHdheSB0byBjcmVhdGUgYSBjb250cmFjdCBmcm9tIGEgY29udHJhY3Qgb2YgdGhlDQovLy8gIHNhbWUgY2xhc3MNCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7DQoNCiAgICAvLy8gQG5vdGljZSBVcGRhdGUgdGhlIERBcHAgYnkgY3JlYXRpbmcgYSBuZXcgdG9rZW4gd2l0aCBuZXcgZnVuY3Rpb25hbGl0aWVzDQogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSB0b2tlbiBiZWluZyBjbG9uZWQNCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsDQogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbg0KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4NCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQNCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IHRva2VuIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigNCiAgICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sDQogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssDQogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLA0KICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLA0KICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLA0KICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkDQogICAgKSByZXR1cm5zIChNaW5pTWVUb2tlbikgew0KICAgICAgICBNaW5pTWVUb2tlbiBuZXdUb2tlbiA9IG5ldyBNaW5pTWVUb2tlbigNCiAgICAgICAgICAgIHRoaXMsDQogICAgICAgICAgICBfcGFyZW50VG9rZW4sDQogICAgICAgICAgICBfc25hcHNob3RCbG9jaywNCiAgICAgICAgICAgIF90b2tlbk5hbWUsDQogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLA0KICAgICAgICAgICAgX3Rva2VuU3ltYm9sLA0KICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQNCiAgICAgICAgICAgICk7DQoNCiAgICAgICAgbmV3VG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsNCiAgICAgICAgcmV0dXJuIG5ld1Rva2VuOw0KICAgIH0NCn0NCg0KDQovKg0KICAgIENvcHlyaWdodCAyMDE3LCBKYXJyYWQgSG9wZSAoU3RhdHVzIFJlc2VhcmNoICYgRGV2ZWxvcG1lbnQgR21iSCkNCiovDQoNCg0KY29udHJhY3QgU05UIGlzIE1pbmlNZVRva2VuIHsNCiAgICAvLyBAZGV2IFNOVCBjb25zdHJ1Y3RvciBqdXN0IHBhcmFtZXRyaXplcyB0aGUgTWluaU1lSXJyZXZvY2FibGVWZXN0ZWRUb2tlbiBjb25zdHJ1Y3Rvcg0KICAgIGZ1bmN0aW9uIFNOVChhZGRyZXNzIF90b2tlbkZhY3RvcnkpDQogICAgICAgICAgICBNaW5pTWVUb2tlbigNCiAgICAgICAgICAgICAgICBfdG9rZW5GYWN0b3J5LA0KICAgICAgICAgICAgICAgIDB4MCwgICAgICAgICAgICAgICAgICAgICAvLyBubyBwYXJlbnQgdG9rZW4NCiAgICAgICAgICAgICAgICAwLCAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gc25hcHNob3QgYmxvY2sgbnVtYmVyIGZyb20gcGFyZW50DQogICAgICAgICAgICAgICAgIlN0YXR1cyBOZXR3b3JrIFRva2VuIiwgIC8vIFRva2VuIG5hbWUNCiAgICAgICAgICAgICAgICAxOCwgICAgICAgICAgICAgICAgICAgICAgLy8gRGVjaW1hbHMNCiAgICAgICAgICAgICAgICAiU05UIiwgICAgICAgICAgICAgICAgICAgLy8gU3ltYm9sDQogICAgICAgICAgICAgICAgdHJ1ZSAgICAgICAgICAgICAgICAgICAgIC8vIEVuYWJsZSB0cmFuc2ZlcnMNCiAgICAgICAgICAgICkge30NCn0NCg0KDQovKg0KICAgIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQ0KICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5DQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCg0KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQogKi8NCg0KLy8vIEB0aXRsZSBTdGF0dXNDb250cmlidXRpb24gQ29udHJhY3QNCi8vLyBAYXV0aG9yIEpvcmRpIEJheWxpbmENCi8vLyBAZGV2IFRoaXMgY29udHJhY3Qgd2lsbCBiZSB0aGUgU05UIGNvbnRyb2xsZXIgZHVyaW5nIHRoZSBjb250cmlidXRpb24gcGVyaW9kLg0KLy8vICBUaGlzIGNvbnRyYWN0IHdpbGwgZGV0ZXJtaW5lIHRoZSBydWxlcyBkdXJpbmcgdGhpcyBwZXJpb2QuDQovLy8gIEZpbmFsIHVzZXJzIHdpbGwgZ2VuZXJhbGx5IG5vdCBpbnRlcmFjdCBkaXJlY3RseSB3aXRoIHRoaXMgY29udHJhY3QuIEVUSCB3aWxsDQovLy8gIGJlIHNlbnQgdG8gdGhlIFNOVCB0b2tlbiBjb250cmFjdC4gVGhlIEVUSCBpcyBzZW50IHRvIHRoaXMgY29udHJhY3QgYW5kIGZyb20gaGVyZSwNCi8vLyAgRVRIIGlzIHNlbnQgdG8gdGhlIGNvbnRyaWJ1dGlvbiB3YWxsZWQgYW5kIFNOVHMgYXJlIG1pbmVkIGFjY29yZGluZyB0byB0aGUgZGVmaW5lZA0KLy8vICBydWxlcy4NCg0KDQpjb250cmFjdCBTdGF0dXNDb250cmlidXRpb24gaXMgT3duZWQsIFRva2VuQ29udHJvbGxlciB7DQogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7DQoNCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBmYWlsU2FmZUxpbWl0ID0gMzAwMDAwIGV0aGVyOw0KICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIG1heEd1YXJhbnRlZWRMaW1pdCA9IDMwMDAwIGV0aGVyOw0KICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIGV4Y2hhbmdlUmF0ZSA9IDEwMDAwOw0KICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIG1heEdhc1ByaWNlID0gNTAwMDAwMDAwMDA7DQogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgbWF4Q2FsbEZyZXF1ZW5jeSA9IDEwMDsNCg0KICAgIE1pbmlNZVRva2VuIHB1YmxpYyBTR1Q7DQogICAgTWluaU1lVG9rZW4gcHVibGljIFNOVDsNCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydEJsb2NrOw0KICAgIHVpbnQyNTYgcHVibGljIGVuZEJsb2NrOw0KDQogICAgYWRkcmVzcyBwdWJsaWMgZGVzdEV0aERldnM7DQoNCiAgICBhZGRyZXNzIHB1YmxpYyBkZXN0VG9rZW5zRGV2czsNCiAgICBhZGRyZXNzIHB1YmxpYyBkZXN0VG9rZW5zUmVzZXJ2ZTsNCiAgICB1aW50MjU2IHB1YmxpYyBtYXhTR1RTdXBwbHk7DQogICAgYWRkcmVzcyBwdWJsaWMgZGVzdFRva2Vuc1NndDsNCiAgICBEeW5hbWljQ2VpbGluZyBwdWJsaWMgZHluYW1pY0NlaWxpbmc7DQoNCiAgICBhZGRyZXNzIHB1YmxpYyBzbnRDb250cm9sbGVyOw0KDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZ3VhcmFudGVlZEJ1eWVyc0xpbWl0Ow0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGd1YXJhbnRlZWRCdXllcnNCb3VnaHQ7DQoNCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbEd1YXJhbnRlZWRDb2xsZWN0ZWQ7DQogICAgdWludDI1NiBwdWJsaWMgdG90YWxOb3JtYWxDb2xsZWN0ZWQ7DQoNCiAgICB1aW50MjU2IHB1YmxpYyBmaW5hbGl6ZWRCbG9jazsNCiAgICB1aW50MjU2IHB1YmxpYyBmaW5hbGl6ZWRUaW1lOw0KDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgbGFzdENhbGxCbG9jazsNCg0KICAgIGJvb2wgcHVibGljIHBhdXNlZDsNCg0KICAgIG1vZGlmaWVyIGluaXRpYWxpemVkKCkgew0KICAgICAgICByZXF1aXJlKGFkZHJlc3MoU05UKSAhPSAweDApOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIGNvbnRyaWJ1dGlvbk9wZW4oKSB7DQogICAgICAgIHJlcXVpcmUoZ2V0QmxvY2tOdW1iZXIoKSA+PSBzdGFydEJsb2NrICYmDQogICAgICAgICAgICAgICAgZ2V0QmxvY2tOdW1iZXIoKSA8PSBlbmRCbG9jayAmJg0KICAgICAgICAgICAgICAgIGZpbmFsaXplZEJsb2NrID09IDAgJiYNCiAgICAgICAgICAgICAgICBhZGRyZXNzKFNOVCkgIT0gMHgwKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBub3RQYXVzZWQoKSB7DQogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gU3RhdHVzQ29udHJpYnV0aW9uKCkgew0KICAgICAgICBwYXVzZWQgPSBmYWxzZTsNCiAgICB9DQoNCg0KICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIGJlZm9yZSB0aGUgY29udHJpYnV0aW9uDQogICAgLy8vICBwZXJpb2Qgc3RhcnRzIFRoaXMgaW5pdGlhbGl6ZXMgbW9zdCBvZiB0aGUgcGFyYW1ldGVycw0KICAgIC8vLyBAcGFyYW0gX3NudCBBZGRyZXNzIG9mIHRoZSBTTlQgdG9rZW4gY29udHJhY3QNCiAgICAvLy8gQHBhcmFtIF9zbnRDb250cm9sbGVyIFRva2VuIGNvbnRyb2xsZXIgZm9yIHRoZSBTTlQgdGhhdCB3aWxsIGJlIHRyYW5zZmVycmVkIGFmdGVyDQogICAgLy8vICB0aGUgY29udHJpYnV0aW9uIGZpbmFsaXplcy4NCiAgICAvLy8gQHBhcmFtIF9zdGFydEJsb2NrIEJsb2NrIHdoZW4gdGhlIGNvbnRyaWJ1dGlvbiBwZXJpb2Qgc3RhcnRzDQogICAgLy8vIEBwYXJhbSBfZW5kQmxvY2sgVGhlIGxhc3QgYmxvY2sgdGhhdCB0aGUgY29udHJpYnV0aW9uIHBlcmlvZCBpcyBhY3RpdmUNCiAgICAvLy8gQHBhcmFtIF9keW5hbWljQ2VpbGluZyBBZGRyZXNzIG9mIHRoZSBjb250cmFjdCB0aGF0IGNvbnRyb2xzIHRoZSBjZWlsaW5nDQogICAgLy8vIEBwYXJhbSBfZGVzdEV0aERldnMgRGVzdGluYXRpb24gYWRkcmVzcyB3aGVyZSB0aGUgY29udHJpYnV0aW9uIGV0aGVyIGlzIHNlbnQNCiAgICAvLy8gQHBhcmFtIF9kZXN0VG9rZW5zUmVzZXJ2ZSBBZGRyZXNzIHdoZXJlIHRoZSB0b2tlbnMgZm9yIHRoZSByZXNlcnZlIGFyZSBzZW50DQogICAgLy8vIEBwYXJhbSBfZGVzdFRva2Vuc1NndCBBZGRyZXNzIG9mIHRoZSBleGNoYW5nZXIgU0dULVNOVCB3aGVyZSB0aGUgU05UIGFyZSBzZW50DQogICAgLy8vICB0byBiZSBkaXN0cmlidXRlZCB0byB0aGUgU0dUIGhvbGRlcnMuDQogICAgLy8vIEBwYXJhbSBfZGVzdFRva2Vuc0RldnMgQWRkcmVzcyB3aGVyZSB0aGUgdG9rZW5zIGZvciB0aGUgZGV2IGFyZSBzZW50DQogICAgLy8vIEBwYXJhbSBfc2d0IEFkZHJlc3Mgb2YgdGhlIFNHVCB0b2tlbiBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX21heFNHVFN1cHBseSBRdWFudGl0eSBvZiBTR1QgdG9rZW5zIHRoYXQgd291bGQgcmVwcmVzZW50IDEwJSBvZiBzdGF0dXMuDQogICAgZnVuY3Rpb24gaW5pdGlhbGl6ZSgNCiAgICAgICAgYWRkcmVzcyBfc250LA0KICAgICAgICBhZGRyZXNzIF9zbnRDb250cm9sbGVyLA0KDQogICAgICAgIHVpbnQyNTYgX3N0YXJ0QmxvY2ssDQogICAgICAgIHVpbnQyNTYgX2VuZEJsb2NrLA0KDQogICAgICAgIGFkZHJlc3MgX2R5bmFtaWNDZWlsaW5nLA0KDQogICAgICAgIGFkZHJlc3MgX2Rlc3RFdGhEZXZzLA0KDQogICAgICAgIGFkZHJlc3MgX2Rlc3RUb2tlbnNSZXNlcnZlLA0KICAgICAgICBhZGRyZXNzIF9kZXN0VG9rZW5zU2d0LA0KICAgICAgICBhZGRyZXNzIF9kZXN0VG9rZW5zRGV2cywNCg0KICAgICAgICBhZGRyZXNzIF9zZ3QsDQogICAgICAgIHVpbnQyNTYgX21heFNHVFN1cHBseQ0KICAgICkgcHVibGljIG9ubHlPd25lciB7DQogICAgICAgIC8vIEluaXRpYWxpemUgb25seSBvbmNlDQogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhTTlQpID09IDB4MCk7DQoNCiAgICAgICAgU05UID0gTWluaU1lVG9rZW4oX3NudCk7DQogICAgICAgIHJlcXVpcmUoU05ULnRvdGFsU3VwcGx5KCkgPT0gMCk7DQogICAgICAgIHJlcXVpcmUoU05ULmNvbnRyb2xsZXIoKSA9PSBhZGRyZXNzKHRoaXMpKTsNCiAgICAgICAgcmVxdWlyZShTTlQuZGVjaW1hbHMoKSA9PSAxOCk7ICAvLyBTYW1lIGFtb3VudCBvZiBkZWNpbWFscyBhcyBFVEgNCg0KICAgICAgICByZXF1aXJlKF9zbnRDb250cm9sbGVyICE9IDB4MCk7DQogICAgICAgIHNudENvbnRyb2xsZXIgPSBfc250Q29udHJvbGxlcjsNCg0KICAgICAgICByZXF1aXJlKF9zdGFydEJsb2NrID49IGdldEJsb2NrTnVtYmVyKCkpOw0KICAgICAgICByZXF1aXJlKF9zdGFydEJsb2NrIDwgX2VuZEJsb2NrKTsNCiAgICAgICAgc3RhcnRCbG9jayA9IF9zdGFydEJsb2NrOw0KICAgICAgICBlbmRCbG9jayA9IF9lbmRCbG9jazsNCg0KICAgICAgICByZXF1aXJlKF9keW5hbWljQ2VpbGluZyAhPSAweDApOw0KICAgICAgICBkeW5hbWljQ2VpbGluZyA9IER5bmFtaWNDZWlsaW5nKF9keW5hbWljQ2VpbGluZyk7DQoNCiAgICAgICAgcmVxdWlyZShfZGVzdEV0aERldnMgIT0gMHgwKTsNCiAgICAgICAgZGVzdEV0aERldnMgPSBfZGVzdEV0aERldnM7DQoNCiAgICAgICAgcmVxdWlyZShfZGVzdFRva2Vuc1Jlc2VydmUgIT0gMHgwKTsNCiAgICAgICAgZGVzdFRva2Vuc1Jlc2VydmUgPSBfZGVzdFRva2Vuc1Jlc2VydmU7DQoNCiAgICAgICAgcmVxdWlyZShfZGVzdFRva2Vuc1NndCAhPSAweDApOw0KICAgICAgICBkZXN0VG9rZW5zU2d0ID0gX2Rlc3RUb2tlbnNTZ3Q7DQoNCiAgICAgICAgcmVxdWlyZShfZGVzdFRva2Vuc0RldnMgIT0gMHgwKTsNCiAgICAgICAgZGVzdFRva2Vuc0RldnMgPSBfZGVzdFRva2Vuc0RldnM7DQoNCiAgICAgICAgcmVxdWlyZShfc2d0ICE9IDB4MCk7DQogICAgICAgIFNHVCA9IE1pbmlNZVRva2VuKF9zZ3QpOw0KDQogICAgICAgIHJlcXVpcmUoX21heFNHVFN1cHBseSA+PSBNaW5pTWVUb2tlbihTR1QpLnRvdGFsU3VwcGx5KCkpOw0KICAgICAgICBtYXhTR1RTdXBwbHkgPSBfbWF4U0dUU3VwcGx5Ow0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFNldHMgdGhlIGxpbWl0IGZvciBhIGd1YXJhbnRlZWQgYWRkcmVzcy4gQWxsIHRoZSBndWFyYW50ZWVkIGFkZHJlc3Nlcw0KICAgIC8vLyAgd2lsbCBiZSBhYmxlIHRvIGdldCBTTlRzIGR1cmluZyB0aGUgY29udHJpYnV0aW9uIHBlcmlvZCB3aXRoIGhpcyBvd24NCiAgICAvLy8gIHNwZWNpZmljIGxpbWl0Lg0KICAgIC8vLyAgVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCBieSB0aGUgb3duZXIgYWZ0ZXIgdGhlIGluaXRpYWxpemF0aW9uDQogICAgLy8vICBhbmQgYmVmb3JlIHRoZSBjb250cmlidXRpb24gc3RhcnRzLg0KICAgIC8vLyBAcGFyYW0gX3RoIEd1YXJhbnRlZWQgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gX2xpbWl0IExpbWl0IGZvciB0aGUgZ3VhcmFudGVlZCBhZGRyZXNzLg0KICAgIGZ1bmN0aW9uIHNldEd1YXJhbnRlZWRBZGRyZXNzKGFkZHJlc3MgX3RoLCB1aW50MjU2IF9saW1pdCkgcHVibGljIGluaXRpYWxpemVkIG9ubHlPd25lciB7DQogICAgICAgIHJlcXVpcmUoZ2V0QmxvY2tOdW1iZXIoKSA8IHN0YXJ0QmxvY2spOw0KICAgICAgICByZXF1aXJlKF9saW1pdCA+IDAgJiYgX2xpbWl0IDw9IG1heEd1YXJhbnRlZWRMaW1pdCk7DQogICAgICAgIGd1YXJhbnRlZWRCdXllcnNMaW1pdFtfdGhdID0gX2xpbWl0Ow0KICAgICAgICBHdWFyYW50ZWVkQWRkcmVzcyhfdGgsIF9saW1pdCk7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgSWYgYW55Ym9keSBzZW5kcyBFdGhlciBkaXJlY3RseSB0byB0aGlzIGNvbnRyYWN0LCBjb25zaWRlciBoZSBpcw0KICAgIC8vLyAgZ2V0dGluZyBTTlRzLg0KICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIG5vdFBhdXNlZCB7DQogICAgICAgIHByb3h5UGF5bWVudChtc2cuc2VuZGVyKTsNCiAgICB9DQoNCg0KICAgIC8vLy8vLy8vLy8NCiAgICAvLyBNaW5pTWUgQ29udHJvbGxlciBmdW5jdGlvbnMNCiAgICAvLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCB3aWxsIGdlbmVyYWxseSBiZSBjYWxsZWQgYnkgdGhlIFNOVCB0b2tlbiBjb250cmFjdCB0bw0KICAgIC8vLyAgYWNxdWlyZSBTTlRzLiBPciBkaXJlY3RseSBmcm9tIHRoaXJkIHBhcnRpZXMgdGhhdCB3YW50IHRvIGFjcXVpcmUgU05UcyBpbg0KICAgIC8vLyAgYmVoYWxmIG9mIGEgdG9rZW4gaG9sZGVyLg0KICAgIC8vLyBAcGFyYW0gX3RoIFNOVCBob2xkZXIgd2hlcmUgdGhlIFNOVHMgd2lsbCBiZSBtaW50ZWQuDQogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX3RoKSBwdWJsaWMgcGF5YWJsZSBub3RQYXVzZWQgaW5pdGlhbGl6ZWQgY29udHJpYnV0aW9uT3BlbiByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJlcXVpcmUoX3RoICE9IDB4MCk7DQogICAgICAgIGlmIChndWFyYW50ZWVkQnV5ZXJzTGltaXRbX3RoXSA+IDApIHsNCiAgICAgICAgICAgIGJ1eUd1YXJhbnRlZWQoX3RoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGJ1eU5vcm1hbChfdGgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcywgYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzLCBhZGRyZXNzLCB1aW50MjU2KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYnV5Tm9ybWFsKGFkZHJlc3MgX3RoKSBpbnRlcm5hbCB7DQogICAgICAgIHJlcXVpcmUodHguZ2FzcHJpY2UgPD0gbWF4R2FzUHJpY2UpOw0KDQogICAgICAgIC8vIEFudGlzcGFtIG1lY2hhbmlzbQ0KICAgICAgICBhZGRyZXNzIGNhbGxlcjsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhTTlQpKSB7DQogICAgICAgICAgICBjYWxsZXIgPSBfdGg7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjYWxsZXIgPSBtc2cuc2VuZGVyOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRG8gbm90IGFsbG93IGNvbnRyYWN0cyB0byBnYW1lIHRoZSBzeXN0ZW0NCiAgICAgICAgcmVxdWlyZSghaXNDb250cmFjdChjYWxsZXIpKTsNCg0KICAgICAgICByZXF1aXJlKGdldEJsb2NrTnVtYmVyKCkuc3ViKGxhc3RDYWxsQmxvY2tbY2FsbGVyXSkgPj0gbWF4Q2FsbEZyZXF1ZW5jeSk7DQogICAgICAgIGxhc3RDYWxsQmxvY2tbY2FsbGVyXSA9IGdldEJsb2NrTnVtYmVyKCk7DQoNCiAgICAgICAgdWludDI1NiB0b0NvbGxlY3QgPSBkeW5hbWljQ2VpbGluZy50b0NvbGxlY3QodG90YWxOb3JtYWxDb2xsZWN0ZWQpOw0KDQogICAgICAgIHVpbnQyNTYgdG9GdW5kOw0KICAgICAgICBpZiAobXNnLnZhbHVlIDw9IHRvQ29sbGVjdCkgew0KICAgICAgICAgICAgdG9GdW5kID0gbXNnLnZhbHVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdG9GdW5kID0gdG9Db2xsZWN0Ow0KICAgICAgICB9DQoNCiAgICAgICAgdG90YWxOb3JtYWxDb2xsZWN0ZWQgPSB0b3RhbE5vcm1hbENvbGxlY3RlZC5hZGQodG9GdW5kKTsNCiAgICAgICAgZG9CdXkoX3RoLCB0b0Z1bmQsIGZhbHNlKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBidXlHdWFyYW50ZWVkKGFkZHJlc3MgX3RoKSBpbnRlcm5hbCB7DQogICAgICAgIHVpbnQyNTYgdG9Db2xsZWN0ID0gZ3VhcmFudGVlZEJ1eWVyc0xpbWl0W190aF07DQoNCiAgICAgICAgdWludDI1NiB0b0Z1bmQ7DQogICAgICAgIGlmIChndWFyYW50ZWVkQnV5ZXJzQm91Z2h0W190aF0uYWRkKG1zZy52YWx1ZSkgPiB0b0NvbGxlY3QpIHsNCiAgICAgICAgICAgIHRvRnVuZCA9IHRvQ29sbGVjdC5zdWIoZ3VhcmFudGVlZEJ1eWVyc0JvdWdodFtfdGhdKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRvRnVuZCA9IG1zZy52YWx1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGd1YXJhbnRlZWRCdXllcnNCb3VnaHRbX3RoXSA9IGd1YXJhbnRlZWRCdXllcnNCb3VnaHRbX3RoXS5hZGQodG9GdW5kKTsNCiAgICAgICAgdG90YWxHdWFyYW50ZWVkQ29sbGVjdGVkID0gdG90YWxHdWFyYW50ZWVkQ29sbGVjdGVkLmFkZCh0b0Z1bmQpOw0KICAgICAgICBkb0J1eShfdGgsIHRvRnVuZCwgdHJ1ZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZG9CdXkoYWRkcmVzcyBfdGgsIHVpbnQyNTYgX3RvRnVuZCwgYm9vbCBfZ3VhcmFudGVlZCkgaW50ZXJuYWwgew0KICAgICAgICBhc3NlcnQobXNnLnZhbHVlID49IF90b0Z1bmQpOyAgLy8gTm90IG5lZWRlZCwgYnV0IGRvdWJsZSBjaGVjay4NCiAgICAgICAgYXNzZXJ0KHRvdGFsQ29sbGVjdGVkKCkgPD0gZmFpbFNhZmVMaW1pdCk7DQoNCiAgICAgICAgaWYgKF90b0Z1bmQgPiAwKSB7DQogICAgICAgICAgICB1aW50MjU2IHRva2Vuc0dlbmVyYXRlZCA9IF90b0Z1bmQubXVsKGV4Y2hhbmdlUmF0ZSk7DQogICAgICAgICAgICBhc3NlcnQoU05ULmdlbmVyYXRlVG9rZW5zKF90aCwgdG9rZW5zR2VuZXJhdGVkKSk7DQogICAgICAgICAgICBkZXN0RXRoRGV2cy50cmFuc2ZlcihfdG9GdW5kKTsNCiAgICAgICAgICAgIE5ld1NhbGUoX3RoLCBfdG9GdW5kLCB0b2tlbnNHZW5lcmF0ZWQsIF9ndWFyYW50ZWVkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHVpbnQyNTYgdG9SZXR1cm4gPSBtc2cudmFsdWUuc3ViKF90b0Z1bmQpOw0KICAgICAgICBpZiAodG9SZXR1cm4gPiAwKSB7DQogICAgICAgICAgICAvLyBJZiB0aGUgY2FsbCBjb21lcyBmcm9tIHRoZSBUb2tlbiBjb250cm9sbGVyLA0KICAgICAgICAgICAgLy8gdGhlbiB3ZSByZXR1cm4gaXQgdG8gdGhlIHRva2VuIEhvbGRlci4NCiAgICAgICAgICAgIC8vIE90aGVyd2lzZSB3ZSByZXR1cm4gdG8gdGhlIHNlbmRlci4NCiAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyID09IGFkZHJlc3MoU05UKSkgew0KICAgICAgICAgICAgICAgIF90aC50cmFuc2Zlcih0b1JldHVybik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodG9SZXR1cm4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gTk9URSBvbiBQZXJjZW50YWdlIGZvcm1hdA0KICAgIC8vIFJpZ2h0IG5vdywgU29saWRpdHkgZG9lcyBub3Qgc3VwcG9ydCBkZWNpbWFsIG51bWJlcnMuIChUaGlzIHdpbGwgY2hhbmdlIHZlcnkgc29vbikNCiAgICAvLyAgU28gaW4gdGhpcyBjb250cmFjdCB3ZSB1c2UgYSByZXByZXNlbnRhdGlvbiBvZiBhIHBlcmNlbnRhZ2UgdGhhdCBjb25zaXN0IGluDQogICAgLy8gIGV4cHJlc3NpbmcgdGhlIHBlcmNlbnRhZ2UgaW4gInggcGVyIDEwKioxOCINCiAgICAvLyBUaGlzIGZvcm1hdCBoYXMgYSBwcmVjaXNpb24gb2YgMTYgZGlnaXRzIGZvciBhIHBlcmNlbnQuDQogICAgLy8gRXhhbXBsZXM6DQogICAgLy8gIDMlICAgPSAgIDMqKDEwKioxNikNCiAgICAvLyAgMTAwJSA9IDEwMCooMTAqKjE2KSA9IDEwKioxOA0KICAgIC8vDQogICAgLy8gVG8gZ2V0IGEgcGVyY2VudGFnZSBvZiBhIHZhbHVlIHdlIGRvIGl0IGJ5IGZpcnN0IG11bHRpcGx5aW5nIGl0IGJ5IHRoZSBwZXJjZW50YWdlIGluICAoeCBwZXIgMTBeMTgpDQogICAgLy8gIGFuZCB0aGVuIGRpdmlkZSBpdCBieSAxMCoqMTgNCiAgICAvLw0KICAgIC8vICAgICAgICAgICAgICBZICogWChpbiB4IHBlciAxMCoqMTgpDQogICAgLy8gIFglIG9mIFkgPSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgLy8gICAgICAgICAgICAgICAxMDAoaW4geCBwZXIgMTAqKjE4KQ0KICAgIC8vDQoNCg0KICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIHdpbGwgY2FuIGJlIGNhbGxlZCBieSB0aGUgb3duZXIgYmVmb3JlIHRoZSBjb250cmlidXRpb24gcGVyaW9kDQogICAgLy8vICBlbmQgb3IgYnkgYW55Ym9keSBhZnRlciB0aGUgYGVuZEJsb2NrYC4gVGhpcyBtZXRob2QgZmluYWxpemVzIHRoZSBjb250cmlidXRpb24gcGVyaW9kDQogICAgLy8vICBieSBjcmVhdGluZyB0aGUgcmVtYWluaW5nIHRva2VucyBhbmQgdHJhbnNmZXJyaW5nIHRoZSBjb250cm9sbGVyIHRvIHRoZSBjb25maWd1cmVkDQogICAgLy8vICBjb250cm9sbGVyLg0KICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluaXRpYWxpemVkIHsNCiAgICAgICAgcmVxdWlyZShnZXRCbG9ja051bWJlcigpID49IHN0YXJ0QmxvY2spOw0KICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgZ2V0QmxvY2tOdW1iZXIoKSA+IGVuZEJsb2NrKTsNCiAgICAgICAgcmVxdWlyZShmaW5hbGl6ZWRCbG9jayA9PSAwKTsNCg0KICAgICAgICAvLyBEbyBub3QgYWxsb3cgdGVybWluYXRpb24gdW50aWwgYWxsIGN1cnZlcyByZXZlYWxlZC4NCiAgICAgICAgcmVxdWlyZShkeW5hbWljQ2VpbGluZy5hbGxSZXZlYWxlZCgpKTsNCg0KICAgICAgICAvLyBBbGxvdyBwcmVtYXR1cmUgZmluYWxpemF0aW9uIGlmIGZpbmFsIGxpbWl0IGlzIHJlYWNoZWQNCiAgICAgICAgaWYgKGdldEJsb2NrTnVtYmVyKCkgPD0gZW5kQmxvY2spIHsNCiAgICAgICAgICAgIHZhciAoLGxhc3RMaW1pdCwsKSA9IGR5bmFtaWNDZWlsaW5nLmN1cnZlcyhkeW5hbWljQ2VpbGluZy5yZXZlYWxlZEN1cnZlcygpLnN1YigxKSk7DQogICAgICAgICAgICByZXF1aXJlKHRvdGFsTm9ybWFsQ29sbGVjdGVkID49IGxhc3RMaW1pdCk7DQogICAgICAgIH0NCg0KICAgICAgICBmaW5hbGl6ZWRCbG9jayA9IGdldEJsb2NrTnVtYmVyKCk7DQogICAgICAgIGZpbmFsaXplZFRpbWUgPSBub3c7DQoNCiAgICAgICAgdWludDI1NiBwZXJjZW50YWdlVG9TZ3Q7DQogICAgICAgIGlmIChTR1QudG90YWxTdXBwbHkoKSA+PSBtYXhTR1RTdXBwbHkpIHsNCiAgICAgICAgICAgIHBlcmNlbnRhZ2VUb1NndCA9IHBlcmNlbnQoMTApOyAgLy8gMTAlDQogICAgICAgIH0gZWxzZSB7DQoNCiAgICAgICAgICAgIC8vDQogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgIFNHVC50b3RhbFN1cHBseSgpDQogICAgICAgICAgICAvLyAgcGVyY2VudGFnZVRvU2d0ID0gMTAlICogLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFNHVFN1cHBseQ0KICAgICAgICAgICAgLy8NCiAgICAgICAgICAgIHBlcmNlbnRhZ2VUb1NndCA9IHBlcmNlbnQoMTApLm11bChTR1QudG90YWxTdXBwbHkoKSkuZGl2KG1heFNHVFN1cHBseSk7DQogICAgICAgIH0NCg0KICAgICAgICB1aW50MjU2IHBlcmNlbnRhZ2VUb0RldnMgPSBwZXJjZW50KDIwKTsgIC8vIDIwJQ0KDQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gICUgVG8gQ29udHJpYnV0b3JzID0gNDElICsgKDEwJSAtICUgdG8gU0dUIGhvbGRlcnMpDQogICAgICAgIC8vDQogICAgICAgIHVpbnQyNTYgcGVyY2VudGFnZVRvQ29udHJpYnV0b3JzID0gcGVyY2VudCg0MSkuYWRkKHBlcmNlbnQoMTApLnN1YihwZXJjZW50YWdlVG9TZ3QpKTsNCg0KICAgICAgICB1aW50MjU2IHBlcmNlbnRhZ2VUb1Jlc2VydmUgPSBwZXJjZW50KDI5KTsNCg0KDQogICAgICAgIC8vIFNOVC50b3RhbFN1cHBseSgpIC0+IFRva2VucyBtaW50ZWQgZHVyaW5nIHRoZSBjb250cmlidXRpb24NCiAgICAgICAgLy8gIHRvdGFsVG9rZW5zICAtPiBUb3RhbCB0b2tlbnMgdGhhdCBzaG91bGQgYmUgYWZ0ZXIgdGhlIGFsbG9jYXRpb24NCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgb2YgZGV2VG9rZW5zLCBzZ3RUb2tlbnMgYW5kIHJlc2VydmUNCiAgICAgICAgLy8gIHBlcmNlbnRhZ2VUb0NvbnRyaWJ1dG9ycyAtPiBXaGljaCBwZXJjZW50YWdlIHNob3VsZCBnbyB0byB0aGUNCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJpYnV0aW9uIHBhcnRpY2lwYW50cw0KICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoeCBwZXIgMTAqKjE4IGZvcm1hdCkNCiAgICAgICAgLy8gIHBlcmNlbnQoMTAwKSAtPiAxMDAlIGluICh4IHBlciAxMCoqMTggZm9ybWF0KQ0KICAgICAgICAvLw0KICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZVRvQ29udHJpYnV0b3JzDQogICAgICAgIC8vICBTTlQudG90YWxTdXBwbHkoKSA9IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICogdG90YWxUb2tlbnMgID0+DQogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50KDEwMCkNCiAgICAgICAgLy8NCiAgICAgICAgLy8NCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyY2VudCgxMDApDQogICAgICAgIC8vICA9PiAgdG90YWxUb2tlbnMgPSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICogU05ULnRvdGFsU3VwcGx5KCkNCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZVRvQ29udHJpYnV0b3JzDQogICAgICAgIC8vDQogICAgICAgIHVpbnQyNTYgdG90YWxUb2tlbnMgPSBTTlQudG90YWxTdXBwbHkoKS5tdWwocGVyY2VudCgxMDApKS5kaXYocGVyY2VudGFnZVRvQ29udHJpYnV0b3JzKTsNCg0KDQogICAgICAgIC8vIEdlbmVyYXRlIHRva2VucyBmb3IgU0dUIEhvbGRlcnMuDQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2VUb1Jlc2VydmUNCiAgICAgICAgLy8gIHJlc2VydmVUb2tlbnMgPSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqIHRvdGFsVG9rZW5zDQogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2UoMTAwKQ0KICAgICAgICAvLw0KICAgICAgICBhc3NlcnQoU05ULmdlbmVyYXRlVG9rZW5zKA0KICAgICAgICAgICAgZGVzdFRva2Vuc1Jlc2VydmUsDQogICAgICAgICAgICB0b3RhbFRva2Vucy5tdWwocGVyY2VudGFnZVRvUmVzZXJ2ZSkuZGl2KHBlcmNlbnQoMTAwKSkpKTsNCg0KICAgICAgICAvLw0KICAgICAgICAvLyAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2VUb1NndA0KICAgICAgICAvLyAgc2d0VG9rZW5zID0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKiB0b3RhbFRva2Vucw0KICAgICAgICAvLyAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlKDEwMCkNCiAgICAgICAgLy8NCiAgICAgICAgYXNzZXJ0KFNOVC5nZW5lcmF0ZVRva2VucygNCiAgICAgICAgICAgIGRlc3RUb2tlbnNTZ3QsDQogICAgICAgICAgICB0b3RhbFRva2Vucy5tdWwocGVyY2VudGFnZVRvU2d0KS5kaXYocGVyY2VudCgxMDApKSkpOw0KDQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZVRvRGV2cw0KICAgICAgICAvLyAgZGV2VG9rZW5zID0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKiB0b3RhbFRva2Vucw0KICAgICAgICAvLyAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlKDEwMCkNCiAgICAgICAgLy8NCiAgICAgICAgYXNzZXJ0KFNOVC5nZW5lcmF0ZVRva2VucygNCiAgICAgICAgICAgIGRlc3RUb2tlbnNEZXZzLA0KICAgICAgICAgICAgdG90YWxUb2tlbnMubXVsKHBlcmNlbnRhZ2VUb0RldnMpLmRpdihwZXJjZW50KDEwMCkpKSk7DQoNCiAgICAgICAgU05ULmNoYW5nZUNvbnRyb2xsZXIoc250Q29udHJvbGxlcik7DQoNCiAgICAgICAgRmluYWxpemVkKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcGVyY2VudCh1aW50MjU2IHApIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgcmV0dXJuIHAubXVsKDEwKioxNik7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdA0KICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZA0KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7DQogICAgICAgIHVpbnQyNTYgc2l6ZTsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKHNpemUgPiAwKTsNCiAgICB9DQoNCg0KICAgIC8vLy8vLy8vLy8NCiAgICAvLyBDb25zdGFudCBmdW5jdGlvbnMNCiAgICAvLy8vLy8vLy8vDQoNCiAgICAvLy8gQHJldHVybiBUb3RhbCB0b2tlbnMgaXNzdWVkIGluIHdlaXMuDQogICAgZnVuY3Rpb24gdG9rZW5zSXNzdWVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgcmV0dXJuIFNOVC50b3RhbFN1cHBseSgpOw0KICAgIH0NCg0KICAgIC8vLyBAcmV0dXJuIFRvdGFsIEV0aGVyIGNvbGxlY3RlZC4NCiAgICBmdW5jdGlvbiB0b3RhbENvbGxlY3RlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIHJldHVybiB0b3RhbE5vcm1hbENvbGxlY3RlZC5hZGQodG90YWxHdWFyYW50ZWVkQ29sbGVjdGVkKTsNCiAgICB9DQoNCg0KICAgIC8vLy8vLy8vLy8NCiAgICAvLyBUZXN0aW5nIHNwZWNpZmljIG1ldGhvZHMNCiAgICAvLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4gYnkgdGhlIHRlc3QgTW9ja3MuDQogICAgZnVuY3Rpb24gZ2V0QmxvY2tOdW1iZXIoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIHJldHVybiBibG9jay5udW1iZXI7DQogICAgfQ0KDQoNCiAgICAvLy8vLy8vLy8vDQogICAgLy8gU2FmZXR5IE1ldGhvZHMNCiAgICAvLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkNCiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuDQogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3Zlcg0KICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLg0KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsNCiAgICAgICAgaWYgKFNOVC5jb250cm9sbGVyKCkgPT0gYWRkcmVzcyh0aGlzKSkgew0KICAgICAgICAgICAgU05ULmNsYWltVG9rZW5zKF90b2tlbik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsNCiAgICAgICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBFUkMyMFRva2VuIHRva2VuID0gRVJDMjBUb2tlbihfdG9rZW4pOw0KICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7DQogICAgICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsNCiAgICAgICAgQ2xhaW1lZFRva2VucyhfdG9rZW4sIG93bmVyLCBiYWxhbmNlKTsNCiAgICB9DQoNCg0KICAgIC8vLyBAbm90aWNlIFBhdXNlcyB0aGUgY29udHJpYnV0aW9uIGlmIHRoZXJlIGlzIGFueSBpc3N1ZQ0KICAgIGZ1bmN0aW9uIHBhdXNlQ29udHJpYnV0aW9uKCkgb25seU93bmVyIHsNCiAgICAgICAgcGF1c2VkID0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLy8gQG5vdGljZSBSZXN1bWVzIHRoZSBjb250cmlidXRpb24NCiAgICBmdW5jdGlvbiByZXN1bWVDb250cmlidXRpb24oKSBvbmx5T3duZXIgew0KICAgICAgICBwYXVzZWQgPSBmYWxzZTsNCiAgICB9DQoNCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludDI1NiBfYW1vdW50KTsNCiAgICBldmVudCBOZXdTYWxlKGFkZHJlc3MgaW5kZXhlZCBfdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfdG9rZW5zLCBib29sIF9ndWFyYW50ZWVkKTsNCiAgICBldmVudCBHdWFyYW50ZWVkQWRkcmVzcyhhZGRyZXNzIGluZGV4ZWQgX3RoLCB1aW50MjU2IF9saW1pdCk7DQogICAgZXZlbnQgRmluYWxpemVkKCk7DQp9DQoNCg0KLyoNCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZGkgQmF5bGluYQ0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yDQogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lg0KICovDQoNCi8vLyBAdGl0bGUgQ29udHJpYnV0aW9uV2FsbGV0IENvbnRyYWN0DQovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hDQovLy8gQGRldiBUaGlzIGNvbnRyYWN0IHdpbGwgYmUgaG9sZCB0aGUgRXRoZXIgZHVyaW5nIHRoZSBjb250cmlidXRpb24gcGVyaW9kLg0KLy8vICBUaGUgaWRlYSBvZiB0aGlzIGNvbnRyYWN0IGlzIHRvIGF2b2lkIHJlY3ljbGluZyBFdGhlciBkdXJpbmcgdGhlIGNvbnRyaWJ1dGlvbg0KLy8vICBwZXJpb2QuIFNvIGFsbCB0aGUgRVRIIGNvbGxlY3RlZCB3aWxsIGJlIGxvY2tlZCBoZXJlIHVudGlsIHRoZSBjb250cmlidXRpb24NCi8vLyAgcGVyaW9kIGVuZHMNCg0KLy8gQGRldiBDb250cmFjdCB0byBob2xkIHNhbGUgcmFpc2VkIGZ1bmRzIGR1cmluZyB0aGUgc2FsZSBwZXJpb2QuDQovLyBQcmV2ZW50cyBhdHRhY2sgaW4gd2hpY2ggdGhlIEFyYWdvbiBNdWx0aXNpZyBzZW5kcyByYWlzZWQgZXRoZXINCi8vIHRvIHRoZSBzYWxlIGNvbnRyYWN0IHRvIG1pbnQgdG9rZW5zIHRvIGl0c2VsZiwgYW5kIGdldHRpbmcgdGhlDQovLyBmdW5kcyBiYWNrIGltbWVkaWF0ZWx5Lg0KDQoNCg0KY29udHJhY3QgQ29udHJpYnV0aW9uV2FsbGV0IHsNCg0KICAgIC8vIFB1YmxpYyB2YXJpYWJsZXMNCiAgICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZzsNCiAgICB1aW50MjU2IHB1YmxpYyBlbmRCbG9jazsNCiAgICBTdGF0dXNDb250cmlidXRpb24gcHVibGljIGNvbnRyaWJ1dGlvbjsNCg0KICAgIC8vIEBkZXYgQ29uc3RydWN0b3IgaW5pdGlhbGl6ZXMgcHVibGljIHZhcmlhYmxlcw0KICAgIC8vIEBwYXJhbSBfbXVsdGlzaWcgVGhlIGFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBmdW5kcw0KICAgIC8vIEBwYXJhbSBfZW5kQmxvY2sgQmxvY2sgYWZ0ZXIgd2hpY2ggdGhlIG11bHRpc2lnIGNhbiByZXF1ZXN0IHRoZSBmdW5kcw0KICAgIC8vIEBwYXJhbSBfY29udHJpYnV0aW9uIEFkZHJlc3Mgb2YgdGhlIFN0YXR1c0NvbnRyaWJ1dGlvbiBjb250cmFjdA0KICAgIGZ1bmN0aW9uIENvbnRyaWJ1dGlvbldhbGxldChhZGRyZXNzIF9tdWx0aXNpZywgdWludDI1NiBfZW5kQmxvY2ssIGFkZHJlc3MgX2NvbnRyaWJ1dGlvbikgew0KICAgICAgICByZXF1aXJlKF9tdWx0aXNpZyAhPSAweDApOw0KICAgICAgICByZXF1aXJlKF9jb250cmlidXRpb24gIT0gMHgwKTsNCiAgICAgICAgcmVxdWlyZShfZW5kQmxvY2sgIT0gMCAmJiBfZW5kQmxvY2sgPD0gNDAwMDAwMCk7DQogICAgICAgIG11bHRpc2lnID0gX211bHRpc2lnOw0KICAgICAgICBlbmRCbG9jayA9IF9lbmRCbG9jazsNCiAgICAgICAgY29udHJpYnV0aW9uID0gU3RhdHVzQ29udHJpYnV0aW9uKF9jb250cmlidXRpb24pOw0KICAgIH0NCg0KICAgIC8vIEBkZXYgUmVjZWl2ZSBhbGwgc2VudCBmdW5kcyB3aXRob3V0IGFueSBmdXJ0aGVyIGxvZ2ljDQogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUge30NCg0KICAgIC8vIEBkZXYgV2l0aGRyYXcgZnVuY3Rpb24gc2VuZHMgYWxsIHRoZSBmdW5kcyB0byB0aGUgd2FsbGV0IGlmIGNvbmRpdGlvbnMgYXJlIGNvcnJlY3QNCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyB7DQogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtdWx0aXNpZyk7ICAgICAgICAgICAgICAvLyBPbmx5IHRoZSBtdWx0aXNpZyBjYW4gcmVxdWVzdCBpdA0KICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+IGVuZEJsb2NrIHx8ICAgICAgICAgICAgLy8gQWxsb3cgYWZ0ZXIgZW5kIGJsb2NrDQogICAgICAgICAgICAgICAgY29udHJpYnV0aW9uLmZpbmFsaXplZEJsb2NrKCkgIT0gMCk7ICAvLyBBbGxvdyB3aGVuIHNhbGUgaXMgZmluYWxpemVkDQogICAgICAgIG11bHRpc2lnLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7DQogICAgfQ0KDQp9DQoNCg0KLyoNCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZGkgQmF5bGluYQ0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yDQogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lg0KICovDQoNCi8vLyBAdGl0bGUgRGV2VG9rZW5zSG9sZGVyIENvbnRyYWN0DQovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hDQovLy8gQGRldiBUaGlzIGNvbnRyYWN0IHdpbGwgaG9sZCB0aGUgdG9rZW5zIG9mIHRoZSBkZXZlbG9wZXJzLg0KLy8vICBUb2tlbnMgd2lsbCBub3QgYmUgYWJsZSB0byBiZSBjb2xsZWN0ZWQgdW50aWwgNiBtb250aHMgYWZ0ZXIgdGhlIGNvbnRyaWJ1dGlvbg0KLy8vICBwZXJpb2QgZW5kcy4gQW5kIGl0IHdpbGwgYmUgaW5jcmVhc2luZyBsaW5lYXJseSB1bnRpbCAyIHllYXJzLg0KDQoNCi8vICBjb2xsZWN0YWJsZSB0b2tlbnMNCi8vICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgdmVzdGVkVG9rZW5zIHJlY3QNCi8vICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8NCi8vICAgfCAgICAgICAgICAgICAgICAgICAgIF8vDQovLyAgIHwgICAgICAgICAgICAgICAgICAgXy8NCi8vICAgfCAgICAgICAgICAgICAgICAgXy8NCi8vICAgfCAgICAgICAgICAgICAgIF8vDQovLyAgIHwgICAgICAgICAgICAgXy8NCi8vICAgfCAgICAgICAgICAgXy8NCi8vICAgfCAgICAgICAgICB8DQovLyAgIHwgICAgICAgIC4gfA0KLy8gICB8ICAgICAgLiAgIHwNCi8vICAgfCAgICAuICAgICB8DQovLyAgICs9PT0rPT09PT09Ky0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUNCi8vICAgICBDb250cmliICAgNiBNb250aHMgICAgICAgMjQgTW9udGhzDQovLyAgICAgICBFbmQNCg0KDQoNCmNvbnRyYWN0IERldlRva2Vuc0hvbGRlciBpcyBPd25lZCB7DQogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7DQoNCiAgICB1aW50MjU2IGNvbGxlY3RlZFRva2VuczsNCiAgICBTdGF0dXNDb250cmlidXRpb24gY29udHJpYnV0aW9uOw0KICAgIE1pbmlNZVRva2VuIHNudDsNCg0KICAgIGZ1bmN0aW9uIERldlRva2Vuc0hvbGRlcihhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfY29udHJpYnV0aW9uLCBhZGRyZXNzIF9zbnQpIHsNCiAgICAgICAgb3duZXIgPSBfb3duZXI7DQogICAgICAgIGNvbnRyaWJ1dGlvbiA9IFN0YXR1c0NvbnRyaWJ1dGlvbihfY29udHJpYnV0aW9uKTsNCiAgICAgICAgc250ID0gTWluaU1lVG9rZW4oX3NudCk7DQogICAgfQ0KDQoNCiAgICAvLy8gQG5vdGljZSBUaGUgRGV2IChPd25lcikgd2lsbCBjYWxsIHRoaXMgbWV0aG9kIHRvIGV4dHJhY3QgdGhlIHRva2Vucw0KICAgIGZ1bmN0aW9uIGNvbGxlY3RUb2tlbnMoKSBwdWJsaWMgb25seU93bmVyIHsNCiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gc250LmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsNCiAgICAgICAgdWludDI1NiB0b3RhbCA9IGNvbGxlY3RlZFRva2Vucy5hZGQoYmFsYW5jZSk7DQoNCiAgICAgICAgdWludDI1NiBmaW5hbGl6ZWRUaW1lID0gY29udHJpYnV0aW9uLmZpbmFsaXplZFRpbWUoKTsNCg0KICAgICAgICByZXF1aXJlKGZpbmFsaXplZFRpbWUgPiAwICYmIGdldFRpbWUoKSA+IGZpbmFsaXplZFRpbWUuYWRkKG1vbnRocyg2KSkpOw0KDQogICAgICAgIHVpbnQyNTYgY2FuRXh0cmFjdCA9IHRvdGFsLm11bChnZXRUaW1lKCkuc3ViKGZpbmFsaXplZFRpbWUpKS5kaXYobW9udGhzKDI0KSk7DQoNCiAgICAgICAgY2FuRXh0cmFjdCA9IGNhbkV4dHJhY3Quc3ViKGNvbGxlY3RlZFRva2Vucyk7DQoNCiAgICAgICAgaWYgKGNhbkV4dHJhY3QgPiBiYWxhbmNlKSB7DQogICAgICAgICAgICBjYW5FeHRyYWN0ID0gYmFsYW5jZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbGxlY3RlZFRva2VucyA9IGNvbGxlY3RlZFRva2Vucy5hZGQoY2FuRXh0cmFjdCk7DQogICAgICAgIGFzc2VydChzbnQudHJhbnNmZXIob3duZXIsIGNhbkV4dHJhY3QpKTsNCg0KICAgICAgICBUb2tlbnNXaXRoZHJhd24ob3duZXIsIGNhbkV4dHJhY3QpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1vbnRocyh1aW50MjU2IG0pIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgcmV0dXJuIG0ubXVsKDMwIGRheXMpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIHJldHVybiBub3c7DQogICAgfQ0KDQoNCiAgICAvLy8vLy8vLy8vDQogICAgLy8gU2FmZXR5IE1ldGhvZHMNCiAgICAvLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkNCiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuDQogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3Zlcg0KICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLg0KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsNCiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcyhzbnQpKTsNCiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsNCiAgICAgICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBFUkMyMFRva2VuIHRva2VuID0gRVJDMjBUb2tlbihfdG9rZW4pOw0KICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7DQogICAgICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsNCiAgICAgICAgQ2xhaW1lZFRva2VucyhfdG9rZW4sIG93bmVyLCBiYWxhbmNlKTsNCiAgICB9DQoNCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludDI1NiBfYW1vdW50KTsNCiAgICBldmVudCBUb2tlbnNXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIF9ob2xkZXIsIHVpbnQyNTYgX2Ftb3VudCk7DQp9DQoNCg0KLyoNCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZGkgQmF5bGluYQ0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yDQogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lg0KICovDQoNCi8vLyBAdGl0bGUgU0dURXhjaGFuZ2VyIENvbnRyYWN0DQovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hDQovLy8gQGRldiBUaGlzIGNvbnRyYWN0IHdpbGwgYmUgdXNlZCB0byBkaXN0cmlidXRlIFNOVCBiZXR3ZWVuIFNHVCBob2xkZXJzLg0KLy8vICBTR1QgdG9rZW4gaXMgbm90IHRyYW5zZmVyYWJsZSwgYW5kIHdlIGp1c3Qga2VlcCBhbiBhY2NvdW50aW5nIGJldHdlZW4gYWxsIHRva2Vucw0KLy8vICBkZXBvc2l0ZWQgYW5kIHRoZSB0b2tlbnMgY29sbGVjdGVkLg0KLy8vICBUaGUgY29udHJvbGxlclNoaXAgb2YgU0dUIHNob3VsZCBiZSB0cmFuc2ZlcnJlZCB0byB0aGlzIGNvbnRyYWN0IGJlZm9yZSB0aGUNCi8vLyAgY29udHJpYnV0aW9uIHBlcmlvZCBzdGFydHMuDQoNCg0KY29udHJhY3QgU0dURXhjaGFuZ2VyIGlzIFRva2VuQ29udHJvbGxlciwgT3duZWQgew0KICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2Ow0KDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgY29sbGVjdGVkOw0KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsQ29sbGVjdGVkOw0KICAgIE1pbmlNZVRva2VuIHB1YmxpYyBzZ3Q7DQogICAgTWluaU1lVG9rZW4gcHVibGljIHNudDsNCiAgICBTdGF0dXNDb250cmlidXRpb24gcHVibGljIHN0YXR1c0NvbnRyaWJ1dGlvbjsNCg0KICAgIGZ1bmN0aW9uIFNHVEV4Y2hhbmdlcihhZGRyZXNzIF9zZ3QsIGFkZHJlc3MgX3NudCwgYWRkcmVzcyBfc3RhdHVzQ29udHJpYnV0aW9uKSB7DQogICAgICAgIHNndCA9IE1pbmlNZVRva2VuKF9zZ3QpOw0KICAgICAgICBzbnQgPSBNaW5pTWVUb2tlbihfc250KTsNCiAgICAgICAgc3RhdHVzQ29udHJpYnV0aW9uID0gU3RhdHVzQ29udHJpYnV0aW9uKF9zdGF0dXNDb250cmlidXRpb24pOw0KICAgIH0NCg0KICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgYnkgdGhlIFNHVCBob2xkZXJzIHRvIGNvbGxlY3QgdGhlaXINCiAgICAvLy8gIGNvcnJlc3BvbmRpbmcgU05Ucw0KICAgIGZ1bmN0aW9uIGNvbGxlY3QoKSBwdWJsaWMgew0KICAgICAgICB1aW50MjU2IGZpbmFsaXplZEJsb2NrID0gc3RhdHVzQ29udHJpYnV0aW9uLmZpbmFsaXplZEJsb2NrKCk7DQoNCiAgICAgICAgcmVxdWlyZShmaW5hbGl6ZWRCbG9jayAhPSAwKTsNCiAgICAgICAgcmVxdWlyZShnZXRCbG9ja051bWJlcigpID4gZmluYWxpemVkQmxvY2spOw0KDQogICAgICAgIHVpbnQyNTYgdG90YWwgPSB0b3RhbENvbGxlY3RlZC5hZGQoc250LmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSk7DQoNCiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gc2d0LmJhbGFuY2VPZkF0KG1zZy5zZW5kZXIsIGZpbmFsaXplZEJsb2NrKTsNCg0KICAgICAgICAvLyBGaXJzdCBjYWxjdWxhdGUgaG93IG11Y2ggY29ycmVzcG9uZCB0byBoaW0NCiAgICAgICAgdWludDI1NiBhbW91bnQgPSB0b3RhbC5tdWwoYmFsYW5jZSkuZGl2KHNndC50b3RhbFN1cHBseUF0KGZpbmFsaXplZEJsb2NrKSk7DQoNCiAgICAgICAgLy8gQW5kIHRoZW4gc3VidHJhY3QgdGhlIGFtb3VudCBhbHJlYWR5IGNvbGxlY3RlZA0KICAgICAgICBhbW91bnQgPSBhbW91bnQuc3ViKGNvbGxlY3RlZFttc2cuc2VuZGVyXSk7DQoNCiAgICAgICAgcmVxdWlyZShhbW91bnQgPiAwKTsgIC8vIE5vdGlmeSB0aGUgdXNlciB0aGF0IHRoZXJlIGFyZSBubyB0b2tlbnMgdG8gZXhjaGFuZ2UNCg0KICAgICAgICB0b3RhbENvbGxlY3RlZCA9IHRvdGFsQ29sbGVjdGVkLmFkZChhbW91bnQpOw0KICAgICAgICBjb2xsZWN0ZWRbbXNnLnNlbmRlcl0gPSBjb2xsZWN0ZWRbbXNnLnNlbmRlcl0uYWRkKGFtb3VudCk7DQoNCiAgICAgICAgYXNzZXJ0KHNudC50cmFuc2Zlcihtc2cuc2VuZGVyLCBhbW91bnQpKTsNCg0KICAgICAgICBUb2tlbnNDb2xsZWN0ZWQobXNnLnNlbmRlciwgYW1vdW50KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcykgcHVibGljIHBheWFibGUgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MsIGFkZHJlc3MsIHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcywgYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8vLy8vLy8vLy8NCiAgICAvLyBUZXN0aW5nIHNwZWNpZmljIG1ldGhvZHMNCiAgICAvLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4gYnkgdGhlIHRlc3QgTW9ja3MuDQogICAgZnVuY3Rpb24gZ2V0QmxvY2tOdW1iZXIoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIHJldHVybiBibG9jay5udW1iZXI7DQogICAgfQ0KDQogICAgLy8vLy8vLy8vLw0KICAgIC8vIFNhZmV0eSBNZXRob2QNCiAgICAvLy8vLy8vLy8vDQoNCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkNCiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuDQogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3Zlcg0KICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLg0KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsNCiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcyhzbnQpKTsNCiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsNCiAgICAgICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBFUkMyMFRva2VuIHRva2VuID0gRVJDMjBUb2tlbihfdG9rZW4pOw0KICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7DQogICAgICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsNCiAgICAgICAgQ2xhaW1lZFRva2VucyhfdG9rZW4sIG93bmVyLCBiYWxhbmNlKTsNCiAgICB9DQoNCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludDI1NiBfYW1vdW50KTsNCiAgICBldmVudCBUb2tlbnNDb2xsZWN0ZWQoYWRkcmVzcyBpbmRleGVkIF9ob2xkZXIsIHVpbnQyNTYgX2Ftb3VudCk7DQoNCn0NCg0KLyoNCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZGkgQmF5bGluYQ0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yDQogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lg0KICovDQoNCi8vLyBAdGl0bGUgU05UUGxhY2Vob2xkZXIgQ29udHJhY3QNCi8vLyBAYXV0aG9yIEpvcmRpIEJheWxpbmENCi8vLyBAZGV2IFRoZSBTTlRQbGFjZWhvbGRlciBjb250cmFjdCB3aWxsIHRha2UgY29udHJvbCBvdmVyIHRoZSBTTlQgYWZ0ZXIgdGhlIGNvbnRyaWJ1dGlvbg0KLy8vICBpcyBmaW5hbGl6ZWQgYW5kIGJlZm9yZSB0aGUgU3RhdHVzIE5ldHdvcmsgaXMgZGVwbG95ZWQuDQovLy8gIFRoZSBjb250cmFjdCBhbGxvd3MgZm9yIFNOVCB0cmFuc2ZlcnMgYW5kIHRyYW5zZmVyRnJvbSBhbmQgaW1wbGVtZW50cyB0aGUNCi8vLyAgbG9naWMgZm9yIHRyYW5zZmVycmluZyBjb250cm9sIG9mIHRoZSB0b2tlbiB0byB0aGUgbmV0d29yayB3aGVuIHRoZSBvZmZlcmluZw0KLy8vICBhc2tzIGl0IHRvIGRvIHNvLg0KDQoNCmNvbnRyYWN0IFNOVFBsYWNlSG9sZGVyIGlzIFRva2VuQ29udHJvbGxlciwgT3duZWQgew0KICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2Ow0KDQogICAgTWluaU1lVG9rZW4gcHVibGljIHNudDsNCiAgICBTdGF0dXNDb250cmlidXRpb24gcHVibGljIGNvbnRyaWJ1dGlvbjsNCiAgICB1aW50MjU2IHB1YmxpYyBhY3RpdmF0aW9uVGltZTsNCiAgICBhZGRyZXNzIHB1YmxpYyBzZ3RFeGNoYW5nZXI7DQoNCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3Rvcg0KICAgIC8vLyBAcGFyYW0gX293bmVyIFRydXN0ZWQgb3duZXIgZm9yIHRoaXMgY29udHJhY3QuDQogICAgLy8vIEBwYXJhbSBfc250IFNOVCB0b2tlbiBjb250cmFjdCBhZGRyZXNzDQogICAgLy8vIEBwYXJhbSBfY29udHJpYnV0aW9uIFN0YXR1c0NvbnRyaWJ1dGlvbiBjb250cmFjdCBhZGRyZXNzDQogICAgLy8vIEBwYXJhbSBfc2d0RXhjaGFuZ2VyIFNHVC1TTlQgRXhjaGFuZ2UgYWRkcmVzcy4gKER1cmluZyB0aGUgZmlyc3Qgd2Vlaw0KICAgIC8vLyAgb25seSB0aGlzIGV4Y2hhbmdlciB3aWxsIGJlIGFibGUgdG8gbW92ZSB0b2tlbnMpDQogICAgZnVuY3Rpb24gU05UUGxhY2VIb2xkZXIoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NudCwgYWRkcmVzcyBfY29udHJpYnV0aW9uLCBhZGRyZXNzIF9zZ3RFeGNoYW5nZXIpIHsNCiAgICAgICAgb3duZXIgPSBfb3duZXI7DQogICAgICAgIHNudCA9IE1pbmlNZVRva2VuKF9zbnQpOw0KICAgICAgICBjb250cmlidXRpb24gPSBTdGF0dXNDb250cmlidXRpb24oX2NvbnRyaWJ1dGlvbik7DQogICAgICAgIHNndEV4Y2hhbmdlciA9IF9zZ3RFeGNoYW5nZXI7DQogICAgfQ0KDQogICAgLy8vIEBub3RpY2UgVGhlIG93bmVyIG9mIHRoaXMgY29udHJhY3QgY2FuIGNoYW5nZSB0aGUgY29udHJvbGxlciBvZiB0aGUgU05UIHRva2VuDQogICAgLy8vICBQbGVhc2UsIGJlIHN1cmUgdGhhdCB0aGUgb3duZXIgaXMgYSB0cnVzdGVkIGFnZW50IG9yIDB4MCBhZGRyZXNzLg0KICAgIC8vLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBjb250cm9sbGVyDQoNCiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIHB1YmxpYyBvbmx5T3duZXIgew0KICAgICAgICBzbnQuY2hhbmdlQ29udHJvbGxlcihfbmV3Q29udHJvbGxlcik7DQogICAgICAgIENvbnRyb2xsZXJDaGFuZ2VkKF9uZXdDb250cm9sbGVyKTsNCiAgICB9DQoNCg0KICAgIC8vLy8vLy8vLy8NCiAgICAvLyBNaW5pTWUgQ29udHJvbGxlciBJbnRlcmZhY2UgZnVuY3Rpb25zDQogICAgLy8vLy8vLy8vLw0KDQogICAgLy8gSW4gYmV0d2VlbiB0aGUgb2ZmZXJpbmcgYW5kIHRoZSBuZXR3b3JrLiBEZWZhdWx0IHNldHRpbmdzIGZvciBhbGxvd2luZyB0b2tlbiB0cmFuc2ZlcnMuDQogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIHRyYW5zZmVyYWJsZShfZnJvbSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MsIHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiB0cmFuc2ZlcmFibGUoX2Zyb20pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZShhZGRyZXNzIF9mcm9tKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIC8vIEFsbG93IHRoZSBleGNoYW5nZXIgdG8gd29yayBmcm9tIHRoZSBiZWdpbm5pbmcNCiAgICAgICAgaWYgKGFjdGl2YXRpb25UaW1lID09IDApIHsNCiAgICAgICAgICAgIHVpbnQyNTYgZiA9IGNvbnRyaWJ1dGlvbi5maW5hbGl6ZWRUaW1lKCk7DQogICAgICAgICAgICBpZiAoZiA+IDApIHsNCiAgICAgICAgICAgICAgICBhY3RpdmF0aW9uVGltZSA9IGYuYWRkKDEgd2Vla3MpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIChnZXRUaW1lKCkgPiBhY3RpdmF0aW9uVGltZSkgfHwgKF9mcm9tID09IHNndEV4Y2hhbmdlcik7DQogICAgfQ0KDQoNCiAgICAvLy8vLy8vLy8vDQogICAgLy8gVGVzdGluZyBzcGVjaWZpYyBtZXRob2RzDQogICAgLy8vLy8vLy8vLw0KDQogICAgLy8vIEBub3RpY2UgVGhpcyBmdW5jdGlvbiBpcyBvdmVycmlkZWQgYnkgdGhlIHRlc3QgTW9ja3MuDQogICAgZnVuY3Rpb24gZ2V0VGltZSgpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgcmV0dXJuIG5vdzsNCiAgICB9DQoNCg0KICAgIC8vLy8vLy8vLy8NCiAgICAvLyBTYWZldHkgTWV0aG9kcw0KICAgIC8vLy8vLy8vLy8NCg0KICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGJ5IHRoZSBjb250cm9sbGVyIHRvIGV4dHJhY3QgbWlzdGFrZW5seQ0KICAgIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4NCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyDQogICAgLy8vICBzZXQgdG8gMCBpbiBjYXNlIHlvdSB3YW50IHRvIGV4dHJhY3QgZXRoZXIuDQogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyBvbmx5T3duZXIgew0KICAgICAgICBpZiAoc250LmNvbnRyb2xsZXIoKSA9PSBhZGRyZXNzKHRoaXMpKSB7DQogICAgICAgICAgICBzbnQuY2xhaW1Ub2tlbnMoX3Rva2VuKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX3Rva2VuID09IDB4MCkgew0KICAgICAgICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIEVSQzIwVG9rZW4gdG9rZW4gPSBFUkMyMFRva2VuKF90b2tlbik7DQogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsNCiAgICAgICAgdG9rZW4udHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOw0KICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgb3duZXIsIGJhbGFuY2UpOw0KICAgIH0NCg0KICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50MjU2IF9hbW91bnQpOw0KICAgIGV2ZW50IENvbnRyb2xsZXJDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCBfbmV3Q29udHJvbGxlcik7DQp9'