base 64 content
base64smartInvestmentFundToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLyoqDQogKiBAdGl0bGUgU2FmZU1hdGgNCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yDQogKi8NCmxpYnJhcnkgU2FmZU1hdGggew0KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICB1aW50MjU2IGMgPSBhICogYjsNCiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwDQogICAgdWludDI1NiBjID0gYSAvIGI7DQogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIGFzc2VydChiIDw9IGEpOw0KICAgIHJldHVybiBhIC0gYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHVpbnQyNTYgYyA9IGEgKyBiOw0KICAgIGFzc2VydChjID49IGEpOw0KICAgIHJldHVybiBjOw0KICB9DQp9DQovKiBUaGUgYXV0aGVudGljYXRpb24gbWFuYWdlciBkZXRhaWxzIHVzZXIgYWNjb3VudHMgdGhhdCBoYXZlIGFjY2VzcyB0byBjZXJ0YWluIHByaXZpbGVkZ2VzIGFuZCBrZWVwcyBhIHBlcm1hbmVudCBsZWRnZXIgb2Ygd2hvIGhhcyBhbmQgaGFzIGhhZCB0aGVzZSByaWdodHMuICovDQpjb250cmFjdCBBdXRoZW50aWNhdGlvbk1hbmFnZXIgew0KICAgIC8qIE1hcCBhZGRyZXNzZXMgdG8gYWRtaW5zICovDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBhZG1pbkFkZHJlc3NlczsNCg0KICAgIC8qIE1hcCBhZGRyZXNzZXMgdG8gYWNjb3VudCByZWFkZXJzICovDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBhY2NvdW50UmVhZGVyQWRkcmVzc2VzOw0KDQogICAgLyogRGV0YWlscyBvZiBhbGwgYWRtaW5zIHRoYXQgaGF2ZSBldmVyIGV4aXN0ZWQgKi8NCiAgICBhZGRyZXNzW10gYWRtaW5BdWRpdDsNCg0KICAgIC8qIERldGFpbHMgb2YgYWxsIGFjY291bnQgcmVhZGVycyB0aGF0IGhhdmUgZXZlciBleGlzdGVkICovDQogICAgYWRkcmVzc1tdIGFjY291bnRSZWFkZXJBdWRpdDsNCg0KICAgIC8qIEZpcmVkIHdoZW5ldmVyIGFuIGFkbWluIGlzIGFkZGVkIHRvIHRoZSBjb250cmFjdC4gKi8NCiAgICBldmVudCBBZG1pbkFkZGVkKGFkZHJlc3MgYWRkZWRCeSwgYWRkcmVzcyBhZG1pbik7DQoNCiAgICAvKiBGaXJlZCB3aGVuZXZlciBhbiBhZG1pbiBpcyByZW1vdmVkIGZyb20gdGhlIGNvbnRyYWN0LiAqLw0KICAgIGV2ZW50IEFkbWluUmVtb3ZlZChhZGRyZXNzIHJlbW92ZWRCeSwgYWRkcmVzcyBhZG1pbik7DQoNCiAgICAvKiBGaXJlZCB3aGVuZXZlciBhbiBhY2NvdW50LXJlYWRlciBjb250cmFjdCBpcyBhZGRlZC4gKi8NCiAgICBldmVudCBBY2NvdW50UmVhZGVyQWRkZWQoYWRkcmVzcyBhZGRlZEJ5LCBhZGRyZXNzIGFjY291bnQpOw0KDQogICAgLyogRmlyZWQgd2hlbmV2ZXIgYW4gYWNjb3VudC1yZWFkZXIgY29udHJhY3QgaXMgcmVtb3ZlZC4gKi8NCiAgICBldmVudCBBY2NvdW50UmVhZGVyUmVtb3ZlZChhZGRyZXNzIHJlbW92ZWRCeSwgYWRkcmVzcyBhY2NvdW50KTsNCg0KICAgIC8qIFdoZW4gdGhpcyBjb250cmFjdCBpcyBmaXJzdCBzZXR1cCB3ZSB1c2UgdGhlIGNyZWF0b3IgYXMgdGhlIGZpcnN0IGFkbWluICovICAgIA0KICAgIGZ1bmN0aW9uIEF1dGhlbnRpY2F0aW9uTWFuYWdlcigpIHsNCiAgICAgICAgLyogU2V0IHRoZSBmaXJzdCBhZG1pbiB0byBiZSB0aGUgcGVyc29uIGNyZWF0aW5nIHRoZSBjb250cmFjdCAqLw0KICAgICAgICBhZG1pbkFkZHJlc3Nlc1ttc2cuc2VuZGVyXSA9IHRydWU7DQogICAgICAgIEFkbWluQWRkZWQoMCwgbXNnLnNlbmRlcik7DQogICAgICAgIGFkbWluQXVkaXQubGVuZ3RoKys7DQogICAgICAgIGFkbWluQXVkaXRbYWRtaW5BdWRpdC5sZW5ndGggLSAxXSA9IG1zZy5zZW5kZXI7DQogICAgfQ0KDQogICAgLyogR2V0cyB0aGUgY29udHJhY3QgdmVyc2lvbiBmb3IgdmFsaWRhdGlvbiAqLw0KICAgIGZ1bmN0aW9uIGNvbnRyYWN0VmVyc2lvbigpIGNvbnN0YW50IHJldHVybnModWludDI1Nikgew0KICAgICAgICAvLyBBZG1pbiBjb250cmFjdCBpZGVudGlmaWVzIGFzIDEwMFlZWVlNTURESEhNTQ0KICAgICAgICByZXR1cm4gMTAwMjAxNzA3MTcxNTAzOw0KICAgIH0NCg0KICAgIC8qIEdldHMgd2hldGhlciBvciBub3QgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGlzIGN1cnJlbnRseSBhbiBhZG1pbiAqLw0KICAgIGZ1bmN0aW9uIGlzQ3VycmVudEFkbWluKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIGFkbWluQWRkcmVzc2VzW19hZGRyZXNzXTsNCiAgICB9DQoNCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBoYXMgZXZlciBiZWVuIGFuIGFkbWluICovDQogICAgZnVuY3Rpb24gaXNDdXJyZW50T3JQYXN0QWRtaW4oYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBhZG1pbkF1ZGl0Lmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgaWYgKGFkbWluQXVkaXRbaV0gPT0gX2FkZHJlc3MpDQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBpcyBjdXJyZW50bHkgYW4gYWNjb3VudCByZWFkZXIgKi8NCiAgICBmdW5jdGlvbiBpc0N1cnJlbnRBY2NvdW50UmVhZGVyKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIGFjY291bnRSZWFkZXJBZGRyZXNzZXNbX2FkZHJlc3NdOw0KICAgIH0NCg0KICAgIC8qIEdldHMgd2hldGhlciBvciBub3QgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGhhcyBldmVyIGJlZW4gYW4gYWRtaW4gKi8NCiAgICBmdW5jdGlvbiBpc0N1cnJlbnRPclBhc3RBY2NvdW50UmVhZGVyKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgYWNjb3VudFJlYWRlckF1ZGl0Lmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgaWYgKGFjY291bnRSZWFkZXJBdWRpdFtpXSA9PSBfYWRkcmVzcykNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8qIEFkZHMgYSB1c2VyIHRvIG91ciBsaXN0IG9mIGFkbWlucyAqLw0KICAgIGZ1bmN0aW9uIGFkZEFkbWluKGFkZHJlc3MgX2FkZHJlc3MpIHsNCiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovDQogICAgICAgIGlmICghaXNDdXJyZW50QWRtaW4obXNnLnNlbmRlcikpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvLyBGYWlsIGlmIHRoaXMgYWNjb3VudCBpcyBhbHJlYWR5IGFkbWluDQogICAgICAgIGlmIChhZG1pbkFkZHJlc3Nlc1tfYWRkcmVzc10pDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIC8vIEFkZCB0aGUgdXNlcg0KICAgICAgICBhZG1pbkFkZHJlc3Nlc1tfYWRkcmVzc10gPSB0cnVlOw0KICAgICAgICBBZG1pbkFkZGVkKG1zZy5zZW5kZXIsIF9hZGRyZXNzKTsNCiAgICAgICAgYWRtaW5BdWRpdC5sZW5ndGgrKzsNCiAgICAgICAgYWRtaW5BdWRpdFthZG1pbkF1ZGl0Lmxlbmd0aCAtIDFdID0gX2FkZHJlc3M7DQogICAgfQ0KDQogICAgLyogUmVtb3ZlcyBhIHVzZXIgZnJvbSBvdXIgbGlzdCBvZiBhZG1pbnMgYnV0IGtlZXBzIHRoZW0gaW4gdGhlIGhpc3RvcnkgYXVkaXQgKi8NCiAgICBmdW5jdGlvbiByZW1vdmVBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSB7DQogICAgICAgIC8qIEVuc3VyZSB3ZSdyZSBhbiBhZG1pbiAqLw0KICAgICAgICBpZiAoIWlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLyogRG9uJ3QgYWxsb3cgcmVtb3ZhbCBvZiBzZWxmICovDQogICAgICAgIGlmIChfYWRkcmVzcyA9PSBtc2cuc2VuZGVyKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLy8gRmFpbCBpZiB0aGlzIGFjY291bnQgaXMgYWxyZWFkeSBub24tYWRtaW4NCiAgICAgICAgaWYgKCFhZG1pbkFkZHJlc3Nlc1tfYWRkcmVzc10pDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvKiBSZW1vdmUgdGhpcyBhZG1pbiB1c2VyICovDQogICAgICAgIGFkbWluQWRkcmVzc2VzW19hZGRyZXNzXSA9IGZhbHNlOw0KICAgICAgICBBZG1pblJlbW92ZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOw0KICAgIH0NCg0KICAgIC8qIEFkZHMgYSB1c2VyL2NvbnRyYWN0IHRvIG91ciBsaXN0IG9mIGFjY291bnQgcmVhZGVycyAqLw0KICAgIGZ1bmN0aW9uIGFkZEFjY291bnRSZWFkZXIoYWRkcmVzcyBfYWRkcmVzcykgew0KICAgICAgICAvKiBFbnN1cmUgd2UncmUgYW4gYWRtaW4gKi8NCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIC8vIEZhaWwgaWYgdGhpcyBhY2NvdW50IGlzIGFscmVhZHkgaW4gdGhlIGxpc3QNCiAgICAgICAgaWYgKGFjY291bnRSZWFkZXJBZGRyZXNzZXNbX2FkZHJlc3NdKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIA0KICAgICAgICAvLyBBZGQgdGhlIHVzZXINCiAgICAgICAgYWNjb3VudFJlYWRlckFkZHJlc3Nlc1tfYWRkcmVzc10gPSB0cnVlOw0KICAgICAgICBBY2NvdW50UmVhZGVyQWRkZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOw0KICAgICAgICBhY2NvdW50UmVhZGVyQXVkaXQubGVuZ3RoKys7DQogICAgICAgIGFjY291bnRSZWFkZXJBdWRpdFthZG1pbkF1ZGl0Lmxlbmd0aCAtIDFdID0gX2FkZHJlc3M7DQogICAgfQ0KDQogICAgLyogUmVtb3ZlcyBhIHVzZXIvY29udHJhY3RzIGZyb20gb3VyIGxpc3Qgb2YgYWNjb3VudCByZWFkZXJzIGJ1dCBrZWVwcyB0aGVtIGluIHRoZSBoaXN0b3J5IGF1ZGl0ICovDQogICAgZnVuY3Rpb24gcmVtb3ZlQWNjb3VudFJlYWRlcihhZGRyZXNzIF9hZGRyZXNzKSB7DQogICAgICAgIC8qIEVuc3VyZSB3ZSdyZSBhbiBhZG1pbiAqLw0KICAgICAgICBpZiAoIWlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLy8gRmFpbCBpZiB0aGlzIGFjY291bnQgaXMgYWxyZWFkeSBub3QgaW4gdGhlIGxpc3QNCiAgICAgICAgaWYgKCFhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIC8qIFJlbW92ZSB0aGlzIGFkbWluIHVzZXIgKi8NCiAgICAgICAgYWNjb3VudFJlYWRlckFkZHJlc3Nlc1tfYWRkcmVzc10gPSBmYWxzZTsNCiAgICAgICAgQWNjb3VudFJlYWRlclJlbW92ZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOw0KICAgIH0NCn0NCg0KY29udHJhY3QgSWNvUGhhc2VNYW5hZ2VtZW50IHsNCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsNCiAgICANCiAgICAvKiBEZWZpbmVzIHdoZXRoZXIgb3Igbm90IHdlIGFyZSBpbiB0aGUgSUNPIHBoYXNlICovDQogICAgYm9vbCBwdWJsaWMgaWNvUGhhc2UgPSB0cnVlOw0KDQogICAgLyogRGVmaW5lcyB3aGV0aGVyIG9yIG5vdCB0aGUgSUNPIGhhcyBiZWVuIGFiYW5kb25lZCAqLw0KICAgIGJvb2wgcHVibGljIGljb0FiYW5kb25lZCA9IGZhbHNlOw0KDQogICAgLyogRGVmaW5lcyB3aGV0aGVyIG9yIG5vdCB0aGUgU0lGVCBjb250cmFjdCBhZGRyZXNzIGhhcyB5ZXQgYmVlbiBzZXQuICAqLw0KICAgIGJvb2wgc2lmdENvbnRyYWN0RGVmaW5lZCA9IGZhbHNlOw0KICAgIA0KICAgIC8qIERlZmluZXMgdGhlIHNhbGUgcHJpY2UgZHVyaW5nIElDTyAqLw0KICAgIHVpbnQyNTYgY29uc3RhbnQgaWNvVW5pdFByaWNlID0gMTAgZmlubmV5Ow0KDQogICAgLyogSWYgYW4gSUNPIGlzIGFiYW5kb25lZCBhbmQgc29tZSB3aXRoZHJhd2FscyBmYWlsIHRoZW4gdGhpcyBtYXAgYWxsb3dzIHBlb3BsZSB0byByZXF1ZXN0IHdpdGhkcmF3YWwgb2YgbG9ja2VkLWluIGV0aGVyLiAqLw0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYWJhbmRvbmVkSWNvQmFsYW5jZXM7DQoNCiAgICAvKiBEZWZpbmVzIG91ciBpbnRlcmZhY2UgdG8gdGhlIFNJRlQgY29udHJhY3QuICovDQogICAgU21hcnRJbnZlc3RtZW50RnVuZFRva2VuIHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbjsNCg0KICAgIC8qIERlZmluZXMgdGhlIGFkbWluIGNvbnRyYWN0IHdlIGludGVyZmFjZSB3aXRoIGZvciBjcmVkZW50YWlscy4gKi8NCiAgICBBdXRoZW50aWNhdGlvbk1hbmFnZXIgYXV0aGVudGljYXRpb25NYW5hZ2VyOw0KDQogICAgLyogRGVmaW5lcyB0aGUgdGltZSB0aGF0IHRoZSBJQ08gc3RhcnRzLiAqLw0KICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIGljb1N0YXJ0VGltZSA9IDE1MDE1NDU2MDA7IC8vIEF1Z3VzdCAxc3QgMjAxNyBhdCAwMDowMDowMCBVVEMNCg0KICAgIC8qIERlZmluZXMgdGhlIHRpbWUgdGhhdCB0aGUgSUNPIGVuZHMuICovDQogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgaWNvRW5kVGltZSA9IDE1MDU0MzM2MDA7IC8vIFNlcHRlbWJlciAxNXRoIDIwMTcgYXQgMDA6MDA6MDAgVVRDDQoNCiAgICAvKiBEZWZpbmVzIG91ciBldmVudCBmaXJlZCB3aGVuIHRoZSBJQ08gaXMgY2xvc2VkICovDQogICAgZXZlbnQgSWNvQ2xvc2VkKCk7DQoNCiAgICAvKiBEZWZpbmVzIG91ciBldmVudCBmaXJlZCBpZiB0aGUgSUNPIGlzIGFiYW5kb25lZCAqLw0KICAgIGV2ZW50IEljb0FiYW5kb25lZChzdHJpbmcgZGV0YWlscyk7DQogICAgDQogICAgLyogRW5zdXJlcyB0aGF0IG9uY2UgdGhlIElDTyBpcyBvdmVyIHRoaXMgY29udHJhY3QgY2Fubm90IGJlIHVzZWQgdW50aWwgdGhlIHBvaW50IGl0IGlzIGRlc3RydWN0ZWQuICovDQogICAgbW9kaWZpZXIgb25seUR1cmluZ0ljbyB7DQogICAgICAgIGJvb2wgY29udHJhY3RWYWxpZCA9IHNpZnRDb250cmFjdERlZmluZWQgJiYgIXNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi5pc0Nsb3NlZCgpOw0KICAgICAgICBpZiAoIWNvbnRyYWN0VmFsaWQgfHwgKCFpY29QaGFzZSAmJiAhaWNvQWJhbmRvbmVkKSkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyogVGhpcyBtb2RpZmllciBhbGxvd3MgYSBtZXRob2QgdG8gb25seSBiZSBjYWxsZWQgYnkgY3VycmVudCBhZG1pbnMgKi8NCiAgICBtb2RpZmllciBhZG1pbk9ubHkgew0KICAgICAgICBpZiAoIWF1dGhlbnRpY2F0aW9uTWFuYWdlci5pc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyogQ3JlYXRlIHRoZSBJQ08gcGhhc2UgbWFuYWdlcm1lbnQgYW5kIGRlZmluZSB0aGUgYWRkcmVzcyBvZiB0aGUgbWFpbiBTSUZUIGNvbnRyYWN0LiAqLw0KICAgIGZ1bmN0aW9uIEljb1BoYXNlTWFuYWdlbWVudChhZGRyZXNzIF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKSB7DQogICAgICAgIC8qIEEgYmFzaWMgc2FuaXR5IGNoZWNrICovDQogICAgICAgIGlmIChpY29TdGFydFRpbWUgPj0gaWNvRW5kVGltZSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIC8qIFNldHVwIGFjY2VzcyB0byBvdXIgb3RoZXIgY29udHJhY3RzIGFuZCB2YWxpZGF0ZSB0aGVpciB2ZXJzaW9ucyAqLw0KICAgICAgICBhdXRoZW50aWNhdGlvbk1hbmFnZXIgPSBBdXRoZW50aWNhdGlvbk1hbmFnZXIoX2F1dGhlbnRpY2F0aW9uTWFuYWdlckFkZHJlc3MpOw0KICAgICAgICBpZiAoYXV0aGVudGljYXRpb25NYW5hZ2VyLmNvbnRyYWN0VmVyc2lvbigpICE9IDEwMDIwMTcwNzE3MTUwMykNCiAgICAgICAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8qIFNldCB0aGUgU0lGVCBjb250cmFjdCBhZGRyZXNzIGFzIGEgb25lLXRpbWUgb3BlcmF0aW9uLiAgVGhpcyBoYXBwZW5zIGFmdGVyIGFsbCB0aGUgY29udHJhY3RzIGFyZSBjcmVhdGVkIGFuZCBubw0KICAgICAgIG90aGVyIGZ1bmN0aW9uYWxpdHkgY2FuIGJlIHVzZWQgdW50aWwgdGhpcyBpcyBzZXQuICovDQogICAgZnVuY3Rpb24gc2V0U2lmdENvbnRyYWN0QWRkcmVzcyhhZGRyZXNzIF9zaWZ0Q29udHJhY3RBZGRyZXNzKSBhZG1pbk9ubHkgew0KICAgICAgICAvKiBUaGlzIGNhbiBvbmx5IGhhcHBlbiBvbmNlIGluIHRoZSBsaWZldGltZSBvZiB0aGlzIGNvbnRyYWN0ICovDQogICAgICAgIGlmIChzaWZ0Q29udHJhY3REZWZpbmVkKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLyogU2V0dXAgYWNjZXNzIHRvIG91ciBvdGhlciBjb250cmFjdHMgYW5kIHZhbGlkYXRlIHRoZWlyIHZlcnNpb25zICovDQogICAgICAgIHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbiA9IFNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbihfc2lmdENvbnRyYWN0QWRkcmVzcyk7DQogICAgICAgIGlmIChzbWFydEludmVzdG1lbnRGdW5kVG9rZW4uY29udHJhY3RWZXJzaW9uKCkgIT0gNTAwMjAxNzA3MTcxNDQwKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIHNpZnRDb250cmFjdERlZmluZWQgPSB0cnVlOw0KICAgIH0NCg0KICAgIC8qIEdldHMgdGhlIGNvbnRyYWN0IHZlcnNpb24gZm9yIHZhbGlkYXRpb24gKi8NCiAgICBmdW5jdGlvbiBjb250cmFjdFZlcnNpb24oKSBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsNCiAgICAgICAgLyogSUNPIGNvbnRyYWN0IGlkZW50aWZpZXMgYXMgMzAwWVlZWU1NRERISE1NICovDQogICAgICAgIHJldHVybiAzMDAyMDE3MDcxNzE0NDA7DQogICAgfQ0KDQogICAgLyogQ2xvc2UgdGhlIElDTyBwaGFzZSBhbmQgdHJhbnNpdGlvbiB0byBleGVjdXRpb24gcGhhc2UgKi8NCiAgICBmdW5jdGlvbiBjbG9zZSgpIGFkbWluT25seSBvbmx5RHVyaW5nSWNvIHsNCiAgICAgICAgLy8gRm9yYmlkIGNsb3NpbmcgY29udHJhY3QgYmVmb3JlIHRoZSBlbmQgb2YgSUNPDQogICAgICAgIGlmIChub3cgPD0gaWNvRW5kVGltZSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIC8vIENsb3NlIHRoZSBJQ08NCiAgICAgICAgaWNvUGhhc2UgPSBmYWxzZTsNCiAgICAgICAgSWNvQ2xvc2VkKCk7DQoNCiAgICAgICAgLy8gV2l0aGRyYXcgZnVuZHMgdG8gdGhlIGNhbGxlcg0KICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh0aGlzLmJhbGFuY2UpKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgfQ0KICAgIA0KICAgIC8qIEhhbmRsZSByZWNlaXZpbmcgZXRoZXIgaW4gSUNPIHBoYXNlIC0gd2Ugd29yayBvdXQgaG93IG11Y2ggdGhlIHVzZXIgaGFzIGJvdWdodCwgYWxsb2NhdGUgYSBzdWl0YWJsZSBiYWxhbmNlIGFuZCBzZW5kIHRoZWlyIGNoYW5nZSAqLw0KICAgIGZ1bmN0aW9uICgpIG9ubHlEdXJpbmdJY28gcGF5YWJsZSB7DQogICAgICAgIC8vIEZvcmJpZCBmdW5kaW5nIG91dHNpZGUgb2YgSUNPDQogICAgICAgIGlmIChub3cgPCBpY29TdGFydFRpbWUgfHwgbm93ID4gaWNvRW5kVGltZSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIC8qIERldGVybWluZSBob3cgbXVjaCB0aGV5J3ZlIGFjdHVhbGx5IHB1cmhjYXNlZCBhbmQgYW55IGV0aGVyIGNoYW5nZSAqLw0KICAgICAgICB1aW50MjU2IHRva2Vuc1B1cmNoYXNlZCA9IG1zZy52YWx1ZSAvIGljb1VuaXRQcmljZTsNCiAgICAgICAgdWludDI1NiBwdXJjaGFzZVRvdGFsUHJpY2UgPSB0b2tlbnNQdXJjaGFzZWQgKiBpY29Vbml0UHJpY2U7DQogICAgICAgIHVpbnQyNTYgY2hhbmdlID0gbXNnLnZhbHVlLnN1YihwdXJjaGFzZVRvdGFsUHJpY2UpOw0KDQogICAgICAgIC8qIEluY3JlYXNlIHRoZWlyIG5ldyBiYWxhbmNlIGlmIHRoZXkgYWN0dWFsbHkgcHVyY2hhc2VkIGFueSAqLw0KICAgICAgICBpZiAodG9rZW5zUHVyY2hhc2VkID4gMCkNCiAgICAgICAgICAgIHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi5taW50VG9rZW5zKG1zZy5zZW5kZXIsIHRva2Vuc1B1cmNoYXNlZCk7DQoNCiAgICAgICAgLyogU2VuZCBjaGFuZ2UgYmFjayB0byByZWNpcGllbnQgKi8NCiAgICAgICAgaWYgKGNoYW5nZSA+IDAgJiYgIW1zZy5zZW5kZXIuc2VuZChjaGFuZ2UpKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLyogQWJhbmRvbnMgdGhlIElDTyBhbmQgcmV0dXJucyBmdW5kcyB0byBzaGFyZWhvbGRlcnMuICBBbnkgZmFpbGVkIGZ1bmRzIGNhbiBiZSBzZXBhcmF0ZWx5IHdpdGhkcmF3biBvbmNlIHRoZSBJQ08gaXMgYWJhbmRvbmVkLiAqLw0KICAgIGZ1bmN0aW9uIGFiYW5kb24oc3RyaW5nIGRldGFpbHMpIGFkbWluT25seSBvbmx5RHVyaW5nSWNvIHsNCiAgICAgICAgLy8gRm9yYmlkIGNsb3NpbmcgY29udHJhY3QgYmVmb3JlIHRoZSBlbmQgb2YgSUNPDQogICAgICAgIGlmIChub3cgPD0gaWNvRW5kVGltZSkNCiAgICAgICAgICAgIHRocm93Ow0KDQogICAgICAgIC8qIElmIGFscmVhZHkgYWJhbmRvbmVkIHRocm93IGFuIGVycm9yICovDQogICAgICAgIGlmIChpY29BYmFuZG9uZWQpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvKiBXb3JrIG91dCBhIHJlZnVuZCBwZXIgc2hhcmUgcGVyIHNoYXJlICovDQogICAgICAgIHVpbnQyNTYgcGF5bWVudFBlclNoYXJlID0gdGhpcy5iYWxhbmNlIC8gc21hcnRJbnZlc3RtZW50RnVuZFRva2VuLnRvdGFsU3VwcGx5KCk7DQoNCiAgICAgICAgLyogRW51bSBhbGwgYWNjb3VudHMgYW5kIHNlbmQgdGhlbSByZWZ1bmQgKi8NCiAgICAgICAgdWludCBudW1iZXJUb2tlbkhvbGRlcnMgPSBzbWFydEludmVzdG1lbnRGdW5kVG9rZW4udG9rZW5Ib2xkZXJDb3VudCgpOw0KICAgICAgICB1aW50MjU2IHRvdGFsQWJhbmRvbmVkID0gMDsNCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgbnVtYmVyVG9rZW5Ib2xkZXJzOyBpKyspIHsNCiAgICAgICAgICAgIC8qIENhbGN1bGF0ZSBob3cgbXVjaCBnb2VzIHRvIHRoaXMgc2hhcmVob2xkZXIgKi8NCiAgICAgICAgICAgIGFkZHJlc3MgYWRkciA9IHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi50b2tlbkhvbGRlcihpKTsNCiAgICAgICAgICAgIHVpbnQyNTYgZXRoZXJUb1NlbmQgPSBwYXltZW50UGVyU2hhcmUgKiBzbWFydEludmVzdG1lbnRGdW5kVG9rZW4uYmFsYW5jZU9mKGFkZHIpOw0KICAgICAgICAgICAgaWYgKGV0aGVyVG9TZW5kIDwgMSkNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCg0KICAgICAgICAgICAgLyogQWxsb2NhdGUgYXBwcm9wcmlhdGUgYW1vdW50IG9mIGZ1bmQgdG8gdGhlbSAqLw0KICAgICAgICAgICAgYWJhbmRvbmVkSWNvQmFsYW5jZXNbYWRkcl0gPSBhYmFuZG9uZWRJY29CYWxhbmNlc1thZGRyXS5hZGQoZXRoZXJUb1NlbmQpOw0KICAgICAgICAgICAgdG90YWxBYmFuZG9uZWQgPSB0b3RhbEFiYW5kb25lZC5hZGQoZXRoZXJUb1NlbmQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyogQXVkaXQgdGhlIGFiYW5kb25tZW50ICovDQogICAgICAgIGljb0FiYW5kb25lZCA9IHRydWU7DQogICAgICAgIEljb0FiYW5kb25lZChkZXRhaWxzKTsNCg0KICAgICAgICAvLyBUaGVyZSBzaG91bGQgYmUgbm8gbW9uZXkgbGVmdCwgYnV0IHdpdGhkcmF3IGp1c3QgaW5jYXNlIGZvciBtYW51YWwgcmVzb2x1dGlvbg0KICAgICAgICB1aW50MjU2IHJlbWFpbmRlciA9IHRoaXMuYmFsYW5jZS5zdWIodG90YWxBYmFuZG9uZWQpOw0KICAgICAgICBpZiAocmVtYWluZGVyID4gMCkNCiAgICAgICAgICAgIGlmICghbXNnLnNlbmRlci5zZW5kKHJlbWFpbmRlcikpDQogICAgICAgICAgICAgICAgLy8gQWRkIHRoaXMgdG8gdGhlIGNhbGxlcnMgYmFsYW5jZSBmb3IgZW1lcmdlbmN5IHJlZnVuZHMNCiAgICAgICAgICAgICAgICBhYmFuZG9uZWRJY29CYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChyZW1haW5kZXIpOw0KICAgIH0NCg0KICAgIC8qIEFsbG93cyBwZW9wbGUgdG8gd2l0aGRyYXcgZnVuZHMgdGhhdCBmYWlsZWQgdG8gc2VuZCBkdXJpbmcgdGhlIGFiYW5kb25tZW50IG9mIHRoZSBJQ08gZm9yIGFueSByZWFzb24uICovDQogICAgZnVuY3Rpb24gYWJhbmRvbmVkRnVuZFdpdGhkcmF3YWwoKSB7DQogICAgICAgIC8vIFRoaXMgZnVuY3Rpb25hbGl0eSBvbmx5IGV4aXN0cyBpZiBhbiBJQ08gd2FzIGFiYW5kb25lZA0KICAgICAgICBpZiAoIWljb0FiYW5kb25lZCB8fCBhYmFuZG9uZWRJY29CYWxhbmNlc1ttc2cuc2VuZGVyXSA9PSAwKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIA0KICAgICAgICAvLyBBdHRlbXB0IHRvIHNlbmQgdGhlbSB0byBmdW5kcw0KICAgICAgICB1aW50MjU2IGZ1bmRzID0gYWJhbmRvbmVkSWNvQmFsYW5jZXNbbXNnLnNlbmRlcl07DQogICAgICAgIGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdID0gMDsNCiAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQoZnVuZHMpKQ0KICAgICAgICAgICAgdGhyb3c7DQogICAgfQ0KfQ0KDQovKiBUaGUgU0lGVCBpdHNlbGYgaXMgYSBzaW1wbGUgZXh0ZW5zaW9uIG9mIHRoZSBFUkMyMCB0aGF0IGFsbG93cyBmb3IgZ3JhbnRpbmcgb3RoZXIgU0lGVCBjb250cmFjdHMgc3BlY2lhbCByaWdodHMgdG8gYWN0IG9uIGJlaGFsZiBvZiBhbGwgdHJhbnNmZXJzLiAqLw0KY29udHJhY3QgU21hcnRJbnZlc3RtZW50RnVuZFRva2VuIHsNCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsNCg0KICAgIC8qIE1hcCBhbGwgb3VyIG91ciBiYWxhbmNlcyBmb3IgaXNzdWVkIHRva2VucyAqLw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7DQoNCiAgICAvKiBNYXAgYmV0d2VlbiB1c2VycyBhbmQgdGhlaXIgYXBwcm92YWwgYWRkcmVzc2VzIGFuZCBhbW91bnRzICovDQogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7DQoNCiAgICAvKiBMaXN0IG9mIGFsbCB0b2tlbiBob2xkZXJzICovDQogICAgYWRkcmVzc1tdIGFsbFRva2VuSG9sZGVyczsNCg0KICAgIC8qIFRoZSBuYW1lIG9mIHRoZSBjb250cmFjdCAqLw0KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsNCg0KICAgIC8qIFRoZSBzeW1ib2wgZm9yIHRoZSBjb250cmFjdCAqLw0KICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOw0KDQogICAgLyogSG93IG1hbnkgRFBzIGFyZSBpbiB1c2UgaW4gdGhpcyBjb250cmFjdCAqLw0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsNCg0KICAgIC8qIERlZmluZXMgdGhlIGN1cnJlbnQgc3VwcGx5IG9mIHRoZSB0b2tlbiBpbiBpdHMgb3duIHVuaXRzICovDQogICAgdWludDI1NiB0b3RhbFN1cHBseUFtb3VudCA9IDA7DQoNCiAgICAvKiBEZWZpbmVzIHRoZSBhZGRyZXNzIG9mIHRoZSBJQ08gY29udHJhY3Qgd2hpY2ggaXMgdGhlIG9ubHkgY29udHJhY3QgcGVybWl0dGVkIHRvIG1pbnQgdG9rZW5zLiAqLw0KICAgIGFkZHJlc3MgcHVibGljIGljb0NvbnRyYWN0QWRkcmVzczsNCg0KICAgIC8qIERlZmluZXMgd2hldGhlciBvciBub3QgdGhlIGZ1bmQgaXMgY2xvc2VkLiAqLw0KICAgIGJvb2wgcHVibGljIGlzQ2xvc2VkOw0KDQogICAgLyogRGVmaW5lcyB0aGUgY29udHJhY3QgaGFuZGxpbmcgdGhlIElDTyBwaGFzZS4gKi8NCiAgICBJY29QaGFzZU1hbmFnZW1lbnQgaWNvUGhhc2VNYW5hZ2VtZW50Ow0KDQogICAgLyogRGVmaW5lcyB0aGUgYWRtaW4gY29udHJhY3Qgd2UgaW50ZXJmYWNlIHdpdGggZm9yIGNyZWRlbnRhaWxzLiAqLw0KICAgIEF1dGhlbnRpY2F0aW9uTWFuYWdlciBhdXRoZW50aWNhdGlvbk1hbmFnZXI7DQoNCiAgICAvKiBGaXJlZCB3aGVuIHRoZSBmdW5kIGlzIGV2ZW50dWFsbHkgY2xvc2VkLiAqLw0KICAgIGV2ZW50IEZ1bmRDbG9zZWQoKTsNCiAgICANCiAgICAvKiBPdXIgdHJhbnNmZXIgZXZlbnQgdG8gZmlyZSB3aGVuZXZlciB3ZSBzaGlmdCBTTVJUIGFyb3VuZCAqLw0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOw0KICAgIA0KICAgIC8qIE91ciBhcHByb3ZhbCBldmVudCB3aGVuIG9uZSB1c2VyIGFwcHJvdmVzIGFub3RoZXIgdG8gY29udHJvbCAqLw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOw0KDQogICAgLyogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoaXMgZnVuZCB3aXRoIGxpbmtzIHRvIG90aGVyIGNvbnRyYWN0cyB0aGF0IGFyZSByZXF1aXJlZC4gKi8NCiAgICBmdW5jdGlvbiBTbWFydEludmVzdG1lbnRGdW5kVG9rZW4oYWRkcmVzcyBfaWNvQ29udHJhY3RBZGRyZXNzLCBhZGRyZXNzIF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKSB7DQogICAgICAgIC8vIFNldHVwIGRlZmF1bHRzDQogICAgICAgIG5hbWUgPSAiU21hcnQgSW52ZXN0bWVudCBGdW5kIFRva2VuIjsNCiAgICAgICAgc3ltYm9sID0gIlNJRlQiOw0KICAgICAgICBkZWNpbWFscyA9IDA7DQoNCiAgICAgICAgLyogU2V0dXAgYWNjZXNzIHRvIG91ciBvdGhlciBjb250cmFjdHMgYW5kIHZhbGlkYXRlIHRoZWlyIHZlcnNpb25zICovDQogICAgICAgIGljb1BoYXNlTWFuYWdlbWVudCA9IEljb1BoYXNlTWFuYWdlbWVudChfaWNvQ29udHJhY3RBZGRyZXNzKTsNCiAgICAgICAgaWYgKGljb1BoYXNlTWFuYWdlbWVudC5jb250cmFjdFZlcnNpb24oKSAhPSAzMDAyMDE3MDcxNzE0NDApDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgYXV0aGVudGljYXRpb25NYW5hZ2VyID0gQXV0aGVudGljYXRpb25NYW5hZ2VyKF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKTsNCiAgICAgICAgaWYgKGF1dGhlbnRpY2F0aW9uTWFuYWdlci5jb250cmFjdFZlcnNpb24oKSAhPSAxMDAyMDE3MDcxNzE1MDMpDQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIC8qIFN0b3JlIG91ciBzcGVjaWFsIGFkZHJlc3NlcyAqLw0KICAgICAgICBpY29Db250cmFjdEFkZHJlc3MgPSBfaWNvQ29udHJhY3RBZGRyZXNzOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IG51bXdvcmRzKSB7DQogICAgICAgIGFzc2VydChtc2cuZGF0YS5sZW5ndGggPT0gbnVtd29yZHMgKiAzMiArIDQpOw0KICAgICAgICBfOw0KICAgIH0gDQoNCiAgICAvKiBUaGlzIG1vZGlmaWVyIGFsbG93cyBhIG1ldGhvZCB0byBvbmx5IGJlIGNhbGxlZCBieSBhY2NvdW50IHJlYWRlcnMgKi8NCiAgICBtb2RpZmllciBhY2NvdW50UmVhZGVyT25seSB7DQogICAgICAgIGlmICghYXV0aGVudGljYXRpb25NYW5hZ2VyLmlzQ3VycmVudEFjY291bnRSZWFkZXIobXNnLnNlbmRlcikpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIGZ1bmRTZW5kYWJsZVBoYXNlIHsNCiAgICAgICAgLy8gSWYgaXQncyBpbiBJQ08gcGhhc2UsIGZvcmJpZCBpdA0KICAgICAgICBpZiAoaWNvUGhhc2VNYW5hZ2VtZW50Lmljb1BoYXNlKCkpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvLyBJZiBpdCdzIGFiYW5kb25lZCwgZm9yYmlkIGl0DQogICAgICAgIGlmIChpY29QaGFzZU1hbmFnZW1lbnQuaWNvQWJhbmRvbmVkKCkpDQogICAgICAgICAgICB0aHJvdzsNCg0KICAgICAgICAvLyBXZSdyZSBnb29kLCBmdW5kcyBjYW4gbm93IGJlIHRyYW5zZmVycmVkDQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyogR2V0cyB0aGUgY29udHJhY3QgdmVyc2lvbiBmb3IgdmFsaWRhdGlvbiAqLw0KICAgIGZ1bmN0aW9uIGNvbnRyYWN0VmVyc2lvbigpIGNvbnN0YW50IHJldHVybnModWludDI1Nikgew0KICAgICAgICAvKiBTSUZUIGNvbnRyYWN0IGlkZW50aWZpZXMgYXMgNTAwWVlZWU1NRERISE1NICovDQogICAgICAgIHJldHVybiA1MDAyMDE3MDcxNzE0NDA7DQogICAgfQ0KICAgIA0KICAgIC8qIFRyYW5zZmVyIGZ1bmRzIGJldHdlZW4gdHdvIGFkZHJlc3NlcyB0aGF0IGFyZSBub3QgdGhlIGN1cnJlbnQgbXNnLnNlbmRlciAtIHRoaXMgcmVxdWlyZXMgYXBwcm92YWwgdG8gaGF2ZSBiZWVuIHNldCBzZXBhcmF0ZWx5IGFuZCBmb2xsb3dzIHN0YW5kYXJkIEVSQzIwIGd1aWRlbGluZXMgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgZnVuZFNlbmRhYmxlUGhhc2Ugb25seVBheWxvYWRTaXplKDMpIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfYW1vdW50ICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF9hbW91bnQgJiYgX2Ftb3VudCA+IDAgJiYgYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCkgPiBiYWxhbmNlc1tfdG9dKSB7DQogICAgICAgICAgICBib29sIGlzTmV3ID0gYmFsYW5jZXNbX3RvXSA9PSAwOw0KICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfYW1vdW50KTsNCiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF9hbW91bnQpOw0KICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOw0KICAgICAgICAgICAgaWYgKGlzTmV3KQ0KICAgICAgICAgICAgICAgIHRva2VuT3duZXJBZGQoX3RvKTsNCiAgICAgICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPT0gMCkNCiAgICAgICAgICAgICAgICB0b2tlbk93bmVyUmVtb3ZlKF9mcm9tKTsNCiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8qIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBob2xkZXJzIG9mIHRoaXMgY3VycmVuY3kuICovDQogICAgZnVuY3Rpb24gdG9rZW5Ib2xkZXJDb3VudCgpIGFjY291bnRSZWFkZXJPbmx5IGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgcmV0dXJuIGFsbFRva2VuSG9sZGVycy5sZW5ndGg7DQogICAgfQ0KDQogICAgLyogR2V0cyB0aGUgdG9rZW4gaG9sZGVyIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXguICovDQogICAgZnVuY3Rpb24gdG9rZW5Ib2xkZXIodWludDI1NiBfaW5kZXgpIGFjY291bnRSZWFkZXJPbmx5IGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsNCiAgICAgICAgcmV0dXJuIGFsbFRva2VuSG9sZGVyc1tfaW5kZXhdOw0KICAgIH0NCiANCiAgICAvKiBBZGRzIGFuIGFwcHJvdmFsIGZvciB0aGUgc3BlY2lmaWVkIGFjY291bnQgdG8gc3BlbmQgbW9uZXkgb2YgdGhlIG1lc3NhZ2Ugc2VuZGVyIHVwIHRvIHRoZSBkZWZpbmVkIGxpbWl0ICovDQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIGZ1bmRTZW5kYWJsZVBoYXNlIG9ubHlQYXlsb2FkU2l6ZSgyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfYW1vdW50Ow0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8qIEdldHMgdGhlIGN1cnJlbnQgYWxsb3dhbmNlIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgZm9yIHRoZSBzcGVjaWZpZWQgc3BlbmRlciBvZiB0aGUgb3duZXIgYWRkcmVzcyAqLw0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsNCiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogICAgfQ0KDQogICAgLyogR2V0cyB0aGUgdG90YWwgc3VwcGx5IGF2YWlsYWJsZSBvZiB0aGlzIHRva2VuICovDQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIHJldHVybiB0b3RhbFN1cHBseUFtb3VudDsNCiAgICB9DQoNCiAgICAvKiBHZXRzIHRoZSBiYWxhbmNlIG9mIGEgc3BlY2lmaWVkIGFjY291bnQgKi8NCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgew0KICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgICB9DQoNCiAgICAvKiBUcmFuc2ZlciB0aGUgYmFsYW5jZSBmcm9tIG93bmVyJ3MgYWNjb3VudCB0byBhbm90aGVyIGFjY291bnQgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBmdW5kU2VuZGFibGVQaGFzZSBvbmx5UGF5bG9hZFNpemUoMikgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICAvKiBDaGVjayBpZiBzZW5kZXIgaGFzIGJhbGFuY2UgYW5kIGZvciBvdmVyZmxvd3MgKi8NCiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgX2Ftb3VudCB8fCBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KSA8IGJhbGFuY2VzW190b10pDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAgLyogRG8gYSBjaGVjayB0byBzZWUgaWYgdGhleSBhcmUgbmV3LCBpZiBzbyB3ZSdsbCB3YW50IHRvIGFkZCBpdCB0byBvdXIgYXJyYXkgKi8NCiAgICAgICAgYm9vbCBpc1JlY2lwaWVudE5ldyA9IGJhbGFuY2VzW190b10gPCAxOw0KDQogICAgICAgIC8qIEFkZCBhbmQgc3VidHJhY3QgbmV3IGJhbGFuY2VzICovDQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF9hbW91bnQpOw0KICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7DQoNCiAgICAgICAgLyogQ29uc29saWRhdGUgYXJyYXlzIGlmIHRoZXkgYXJlIG5ldyBvciBpZiBzZW5kZXIgbm93IGhhcyBlbXB0eSBiYWxhbmNlICovDQogICAgICAgIGlmIChpc1JlY2lwaWVudE5ldykNCiAgICAgICAgICAgIHRva2VuT3duZXJBZGQoX3RvKTsNCiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgMSkNCiAgICAgICAgICAgIHRva2VuT3duZXJSZW1vdmUobXNnLnNlbmRlcik7DQoNCiAgICAgICAgLyogRmlyZSBub3RpZmljYXRpb24gZXZlbnQgKi8NCiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLyogSWYgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGlzIG5vdCBpbiBvdXIgb3duZXIgbGlzdCwgYWRkIHRoZW0gLSB0aGlzIGNhbiBiZSBjYWxsZWQgYnkgZGVzY2VuZGVudHMgdG8gZW5zdXJlIHRoZSBkYXRhYmFzZSBpcyBrZXB0IHVwIHRvIGRhdGUuICovDQogICAgZnVuY3Rpb24gdG9rZW5Pd25lckFkZChhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCB7DQogICAgICAgIC8qIEZpcnN0IGNoZWNrIGlmIHRoZXkgYWxyZWFkeSBleGlzdCAqLw0KICAgICAgICB1aW50MjU2IHRva2VuSG9sZGVyQ291bnQgPSBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoOw0KICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCB0b2tlbkhvbGRlckNvdW50OyBpKyspDQogICAgICAgICAgICBpZiAoYWxsVG9rZW5Ib2xkZXJzW2ldID09IF9hZGRyKQ0KICAgICAgICAgICAgICAgIC8qIEFscmVhZHkgZm91bmQgc28gd2UgY2FuIGFib3J0IG5vdyAqLw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgDQogICAgICAgIC8qIFRoZXkgZG9uJ3Qgc2VlbSB0byBleGlzdCwgc28gbGV0J3MgYWRkIHRoZW0gKi8NCiAgICAgICAgYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aCsrOw0KICAgICAgICBhbGxUb2tlbkhvbGRlcnNbYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aCAtIDFdID0gX2FkZHI7DQogICAgfQ0KDQogICAgLyogSWYgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGlzIGluIG91ciBvd25lciBsaXN0LCByZW1vdmUgdGhlbSAtIHRoaXMgY2FuIGJlIGNhbGxlZCBieSBkZXNjZW5kZW50cyB0byBlbnN1cmUgdGhlIGRhdGFiYXNlIGlzIGtlcHQgdXAgdG8gZGF0ZS4gKi8NCiAgICBmdW5jdGlvbiB0b2tlbk93bmVyUmVtb3ZlKGFkZHJlc3MgX2FkZHIpIGludGVybmFsIHsNCiAgICAgICAgLyogRmluZCBvdXQgd2hlcmUgaW4gb3VyIGFycmF5IHRoZXkgYXJlICovDQogICAgICAgIHVpbnQyNTYgdG9rZW5Ib2xkZXJDb3VudCA9IGFsbFRva2VuSG9sZGVycy5sZW5ndGg7DQogICAgICAgIHVpbnQyNTYgZm91bmRJbmRleCA9IDA7DQogICAgICAgIGJvb2wgZm91bmQgPSBmYWxzZTsNCiAgICAgICAgdWludDI1NiBpOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW5Ib2xkZXJDb3VudDsgaSsrKQ0KICAgICAgICAgICAgaWYgKGFsbFRva2VuSG9sZGVyc1tpXSA9PSBfYWRkcikgew0KICAgICAgICAgICAgICAgIGZvdW5kSW5kZXggPSBpOw0KICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qIElmIHdlIGRpZG4ndCBmaW5kIHRoZW0ganVzdCByZXR1cm4gKi8NCiAgICAgICAgaWYgKCFmb3VuZCkNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgDQogICAgICAgIC8qIFdlIG5vdyBuZWVkIHRvIHNodWZmbGUgZG93biB0aGUgYXJyYXkgKi8NCiAgICAgICAgZm9yIChpID0gZm91bmRJbmRleDsgaSA8IHRva2VuSG9sZGVyQ291bnQgLSAxOyBpKyspDQogICAgICAgICAgICBhbGxUb2tlbkhvbGRlcnNbaV0gPSBhbGxUb2tlbkhvbGRlcnNbaSArIDFdOw0KICAgICAgICBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoLS07DQogICAgfQ0KDQogICAgLyogTWludCBuZXcgdG9rZW5zIC0gdGhpcyBjYW4gb25seSBiZSBkb25lIGJ5IHNwZWNpYWwgY2FsbGVycyAoaS5lLiB0aGUgSUNPIG1hbmFnZW1lbnQpIGR1cmluZyB0aGUgSUNPIHBoYXNlLiAqLw0KICAgIGZ1bmN0aW9uIG1pbnRUb2tlbnMoYWRkcmVzcyBfYWRkcmVzcywgdWludDI1NiBfYW1vdW50KSBvbmx5UGF5bG9hZFNpemUoMikgew0KICAgICAgICAvKiBFbnN1cmUgd2UgYXJlIHRoZSBJQ08gY29udHJhY3QgY2FsbGluZyAqLw0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBpY29Db250cmFjdEFkZHJlc3MgfHwgIWljb1BoYXNlTWFuYWdlbWVudC5pY29QaGFzZSgpKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgLyogTWludCB0aGUgdG9rZW5zIGZvciB0aGUgbmV3IGFkZHJlc3MqLw0KICAgICAgICBib29sIGlzTmV3ID0gYmFsYW5jZXNbX2FkZHJlc3NdID09IDA7DQogICAgICAgIHRvdGFsU3VwcGx5QW1vdW50ID0gdG90YWxTdXBwbHlBbW91bnQuYWRkKF9hbW91bnQpOw0KICAgICAgICBiYWxhbmNlc1tfYWRkcmVzc10gPSBiYWxhbmNlc1tfYWRkcmVzc10uYWRkKF9hbW91bnQpOw0KICAgICAgICBpZiAoaXNOZXcpDQogICAgICAgICAgICB0b2tlbk93bmVyQWRkKF9hZGRyZXNzKTsNCiAgICAgICAgVHJhbnNmZXIoMCwgX2FkZHJlc3MsIF9hbW91bnQpOw0KICAgIH0NCn0='