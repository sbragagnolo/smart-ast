base 64 content
base64smartPool
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQovL3NvbGMgLS1iaW4gLS1hYmkgLS1vcHRpbWl6ZSAgLS1vcHRpbWl6ZS1ydW5zIDIwMDAwIC1vIC4gVGVzdHBvb2wuc29sIA0KDQpjb250cmFjdCBTSEEzXzUxMiB7DQogICAgZnVuY3Rpb24gU0hBM181MTIoKSB7fQ0KICAgIA0KICAgIGZ1bmN0aW9uIGtlY2Nha19mKHVpbnRbMjVdIEEpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludFsyNV0pIHsNCiAgICAgICAgdWludFs1XSBtZW1vcnkgQzsNCiAgICAgICAgdWludFs1XSBtZW1vcnkgRDsNCiAgICAgICAgdWludCB4Ow0KICAgICAgICB1aW50IHk7DQogICAgICAgIC8vdWludCBEXzA7IHVpbnQgRF8xOyB1aW50IERfMjsgdWludCBEXzM7IHVpbnQgRF80Ow0KICAgICAgICB1aW50WzI1XSBtZW1vcnkgQjsNCiAgICAgICAgDQogICAgICAgIHVpbnRbMjRdIG1lbW9yeSBSQz0gWw0KICAgICAgICAgICAgICAgICAgIHVpbnQoMHgwMDAwMDAwMDAwMDAwMDAxKSwNCiAgICAgICAgICAgICAgICAgICAweDAwMDAwMDAwMDAwMDgwODIsDQogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDA4MDhBLA0KICAgICAgICAgICAgICAgICAgIDB4ODAwMDAwMDA4MDAwODAwMCwNCiAgICAgICAgICAgICAgICAgICAweDAwMDAwMDAwMDAwMDgwOEIsDQogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDgwMDAwMDAxLA0KICAgICAgICAgICAgICAgICAgIDB4ODAwMDAwMDA4MDAwODA4MSwNCiAgICAgICAgICAgICAgICAgICAweDgwMDAwMDAwMDAwMDgwMDksDQogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDAwMDAwMDhBLA0KICAgICAgICAgICAgICAgICAgIDB4MDAwMDAwMDAwMDAwMDA4OCwNCiAgICAgICAgICAgICAgICAgICAweDAwMDAwMDAwODAwMDgwMDksDQogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDgwMDAwMDBBLA0KICAgICAgICAgICAgICAgICAgIDB4MDAwMDAwMDA4MDAwODA4QiwNCiAgICAgICAgICAgICAgICAgICAweDgwMDAwMDAwMDAwMDAwOEIsDQogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDA4MDg5LA0KICAgICAgICAgICAgICAgICAgIDB4ODAwMDAwMDAwMDAwODAwMywNCiAgICAgICAgICAgICAgICAgICAweDgwMDAwMDAwMDAwMDgwMDIsDQogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDAwMDgwLA0KICAgICAgICAgICAgICAgICAgIDB4MDAwMDAwMDAwMDAwODAwQSwNCiAgICAgICAgICAgICAgICAgICAweDgwMDAwMDAwODAwMDAwMEEsDQogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDgwMDA4MDgxLA0KICAgICAgICAgICAgICAgICAgIDB4ODAwMDAwMDAwMDAwODA4MCwNCiAgICAgICAgICAgICAgICAgICAweDAwMDAwMDAwODAwMDAwMDEsDQogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDgwMDA4MDA4IF07DQogICAgICAgIA0KICAgICAgICBmb3IoIHVpbnQgaSA9IDAgOyBpIDwgMjQgOyBpKysgKSB7DQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgZm9yKCB4ID0gMCA7IHggPCA1IDsgeCsrICkgew0KICAgICAgICAgICAgICAgIENbeF0gPSBBWzUqeF1eQVs1KngrMV1eQVs1KngrMl1eQVs1KngrM11eQVs1KngrNF07ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgfSovDQogICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgQ1swXT1BWzBdXkFbMV1eQVsyXV5BWzNdXkFbNF07DQogICAgICAgICAgICBDWzFdPUFbNV1eQVs2XV5BWzddXkFbOF1eQVs5XTsNCiAgICAgICAgICAgIENbMl09QVsxMF1eQVsxMV1eQVsxMl1eQVsxM11eQVsxNF07DQogICAgICAgICAgICBDWzNdPUFbMTVdXkFbMTZdXkFbMTddXkFbMThdXkFbMTldOw0KICAgICAgICAgICAgQ1s0XT1BWzIwXV5BWzIxXV5BWzIyXV5BWzIzXV5BWzI0XTsNCg0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgIGZvciggeCA9IDAgOyB4IDwgNSA7IHgrKyApIHsNCiAgICAgICAgICAgICAgICBEW3hdID0gQ1soeCs0KSU1XV4oKENbKHgrMSklNV0gKiAyKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQ1soeCsxKSU1XS8oMioqNjMpKSk7DQogICAgICAgICAgICB9Ki8NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgDQogICAgICAgICAgICBEWzBdPUNbNF0gXiAoKENbMV0gKiAyKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQ1sxXSAvICgyICoqIDYzKSkpOw0KICAgICAgICAgICAgRFsxXT1DWzBdIF4gKChDWzJdICogMikmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKENbMl0gLyAoMiAqKiA2MykpKTsNCiAgICAgICAgICAgIERbMl09Q1sxXSBeICgoQ1szXSAqIDIpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChDWzNdIC8gKDIgKiogNjMpKSk7DQogICAgICAgICAgICBEWzNdPUNbMl0gXiAoKENbNF0gKiAyKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQ1s0XSAvICgyICoqIDYzKSkpOw0KICAgICAgICAgICAgRFs0XT1DWzNdIF4gKChDWzBdICogMikmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKENbMF0gLyAoMiAqKiA2MykpKTsNCg0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgIGZvciggeCA9IDAgOyB4IDwgNSA7IHgrKyApIHsNCiAgICAgICAgICAgICAgICBmb3IoIHkgPSAwIDsgeSA8IDUgOyB5KysgKSB7DQogICAgICAgICAgICAgICAgICAgIEFbNSp4K3ldID0gQVs1KngreV0gXiBEW3hdOw0KICAgICAgICAgICAgICAgIH0gICAgICAgICAgICANCiAgICAgICAgICAgIH0qLw0KICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgQVswXT1BWzBdIF4gRFswXTsNCiAgICAgICAgICAgIEFbMV09QVsxXSBeIERbMF07DQogICAgICAgICAgICBBWzJdPUFbMl0gXiBEWzBdOw0KICAgICAgICAgICAgQVszXT1BWzNdIF4gRFswXTsNCiAgICAgICAgICAgIEFbNF09QVs0XSBeIERbMF07DQogICAgICAgICAgICBBWzVdPUFbNV0gXiBEWzFdOw0KICAgICAgICAgICAgQVs2XT1BWzZdIF4gRFsxXTsNCiAgICAgICAgICAgIEFbN109QVs3XSBeIERbMV07DQogICAgICAgICAgICBBWzhdPUFbOF0gXiBEWzFdOw0KICAgICAgICAgICAgQVs5XT1BWzldIF4gRFsxXTsNCiAgICAgICAgICAgIEFbMTBdPUFbMTBdIF4gRFsyXTsNCiAgICAgICAgICAgIEFbMTFdPUFbMTFdIF4gRFsyXTsNCiAgICAgICAgICAgIEFbMTJdPUFbMTJdIF4gRFsyXTsNCiAgICAgICAgICAgIEFbMTNdPUFbMTNdIF4gRFsyXTsNCiAgICAgICAgICAgIEFbMTRdPUFbMTRdIF4gRFsyXTsNCiAgICAgICAgICAgIEFbMTVdPUFbMTVdIF4gRFszXTsNCiAgICAgICAgICAgIEFbMTZdPUFbMTZdIF4gRFszXTsNCiAgICAgICAgICAgIEFbMTddPUFbMTddIF4gRFszXTsNCiAgICAgICAgICAgIEFbMThdPUFbMThdIF4gRFszXTsNCiAgICAgICAgICAgIEFbMTldPUFbMTldIF4gRFszXTsNCiAgICAgICAgICAgIEFbMjBdPUFbMjBdIF4gRFs0XTsNCiAgICAgICAgICAgIEFbMjFdPUFbMjFdIF4gRFs0XTsNCiAgICAgICAgICAgIEFbMjJdPUFbMjJdIF4gRFs0XTsNCiAgICAgICAgICAgIEFbMjNdPUFbMjNdIF4gRFs0XTsNCiAgICAgICAgICAgIEFbMjRdPUFbMjRdIF4gRFs0XTsNCg0KICAgICAgICAgICAgLypSaG8gYW5kIHBpIHN0ZXBzKi8gICAgICAgICAgICANCiAgICAgICAgICAgIEJbMF09QVswXTsNCiAgICAgICAgICAgIEJbOF09KChBWzFdICogKDIgKiogMzYpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxXSAvICgyICoqIDI4KSkpOw0KICAgICAgICAgICAgQlsxMV09KChBWzJdICogKDIgKiogMykpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzJdIC8gKDIgKiogNjEpKSk7DQogICAgICAgICAgICBCWzE5XT0oKEFbM10gKiAoMiAqKiA0MSkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzNdIC8gKDIgKiogMjMpKSk7DQogICAgICAgICAgICBCWzIyXT0oKEFbNF0gKiAoMiAqKiAxOCkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzRdIC8gKDIgKiogNDYpKSk7DQogICAgICAgICAgICBCWzJdPSgoQVs1XSAqICgyICoqIDEpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVs1XSAvICgyICoqIDYzKSkpOw0KICAgICAgICAgICAgQls1XT0oKEFbNl0gKiAoMiAqKiA0NCkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzZdIC8gKDIgKiogMjApKSk7DQogICAgICAgICAgICBCWzEzXT0oKEFbN10gKiAoMiAqKiAxMCkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzddIC8gKDIgKiogNTQpKSk7DQogICAgICAgICAgICBCWzE2XT0oKEFbOF0gKiAoMiAqKiA0NSkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzhdIC8gKDIgKiogMTkpKSk7DQogICAgICAgICAgICBCWzI0XT0oKEFbOV0gKiAoMiAqKiAyKSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbOV0gLyAoMiAqKiA2MikpKTsNCiAgICAgICAgICAgIEJbNF09KChBWzEwXSAqICgyICoqIDYyKSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMTBdIC8gKDIgKiogMikpKTsNCiAgICAgICAgICAgIEJbN109KChBWzExXSAqICgyICoqIDYpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxMV0gLyAoMiAqKiA1OCkpKTsNCiAgICAgICAgICAgIEJbMTBdPSgoQVsxMl0gKiAoMiAqKiA0MykpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzEyXSAvICgyICoqIDIxKSkpOw0KICAgICAgICAgICAgQlsxOF09KChBWzEzXSAqICgyICoqIDE1KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMTNdIC8gKDIgKiogNDkpKSk7DQogICAgICAgICAgICBCWzIxXT0oKEFbMTRdICogKDIgKiogNjEpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxNF0gLyAoMiAqKiAzKSkpOw0KICAgICAgICAgICAgQlsxXT0oKEFbMTVdICogKDIgKiogMjgpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxNV0gLyAoMiAqKiAzNikpKTsNCiAgICAgICAgICAgIEJbOV09KChBWzE2XSAqICgyICoqIDU1KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMTZdIC8gKDIgKiogOSkpKTsNCiAgICAgICAgICAgIEJbMTJdPSgoQVsxN10gKiAoMiAqKiAyNSkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzE3XSAvICgyICoqIDM5KSkpOw0KICAgICAgICAgICAgQlsxNV09KChBWzE4XSAqICgyICoqIDIxKSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMThdIC8gKDIgKiogNDMpKSk7DQogICAgICAgICAgICBCWzIzXT0oKEFbMTldICogKDIgKiogNTYpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxOV0gLyAoMiAqKiA4KSkpOw0KICAgICAgICAgICAgQlszXT0oKEFbMjBdICogKDIgKiogMjcpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsyMF0gLyAoMiAqKiAzNykpKTsNCiAgICAgICAgICAgIEJbNl09KChBWzIxXSAqICgyICoqIDIwKSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMjFdIC8gKDIgKiogNDQpKSk7DQogICAgICAgICAgICBCWzE0XT0oKEFbMjJdICogKDIgKiogMzkpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsyMl0gLyAoMiAqKiAyNSkpKTsNCiAgICAgICAgICAgIEJbMTddPSgoQVsyM10gKiAoMiAqKiA4KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMjNdIC8gKDIgKiogNTYpKSk7DQogICAgICAgICAgICBCWzIwXT0oKEFbMjRdICogKDIgKiogMTQpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsyNF0gLyAoMiAqKiA1MCkpKTsNCg0KICAgICAgICAgICAgLypYaSBzdGF0ZSovDQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgZm9yKCB4ID0gMCA7IHggPCA1IDsgeCsrICkgew0KICAgICAgICAgICAgICAgIGZvciggeSA9IDAgOyB5IDwgNSA7IHkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgQVs1KngreV0gPSBCWzUqeCt5XV4oKH5CWzUqKCh4KzEpJTUpK3ldKSAmIEJbNSooKHgrMiklNSkreV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0qLw0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIEFbMF09QlswXV4oKH5CWzVdKSAmIEJbMTBdKTsNCiAgICAgICAgICAgIEFbMV09QlsxXV4oKH5CWzZdKSAmIEJbMTFdKTsNCiAgICAgICAgICAgIEFbMl09QlsyXV4oKH5CWzddKSAmIEJbMTJdKTsNCiAgICAgICAgICAgIEFbM109QlszXV4oKH5CWzhdKSAmIEJbMTNdKTsNCiAgICAgICAgICAgIEFbNF09Qls0XV4oKH5CWzldKSAmIEJbMTRdKTsNCiAgICAgICAgICAgIEFbNV09Qls1XV4oKH5CWzEwXSkgJiBCWzE1XSk7DQogICAgICAgICAgICBBWzZdPUJbNl1eKCh+QlsxMV0pICYgQlsxNl0pOw0KICAgICAgICAgICAgQVs3XT1CWzddXigofkJbMTJdKSAmIEJbMTddKTsNCiAgICAgICAgICAgIEFbOF09Qls4XV4oKH5CWzEzXSkgJiBCWzE4XSk7DQogICAgICAgICAgICBBWzldPUJbOV1eKCh+QlsxNF0pICYgQlsxOV0pOw0KICAgICAgICAgICAgQVsxMF09QlsxMF1eKCh+QlsxNV0pICYgQlsyMF0pOw0KICAgICAgICAgICAgQVsxMV09QlsxMV1eKCh+QlsxNl0pICYgQlsyMV0pOw0KICAgICAgICAgICAgQVsxMl09QlsxMl1eKCh+QlsxN10pICYgQlsyMl0pOw0KICAgICAgICAgICAgQVsxM109QlsxM11eKCh+QlsxOF0pICYgQlsyM10pOw0KICAgICAgICAgICAgQVsxNF09QlsxNF1eKCh+QlsxOV0pICYgQlsyNF0pOw0KICAgICAgICAgICAgQVsxNV09QlsxNV1eKCh+QlsyMF0pICYgQlswXSk7DQogICAgICAgICAgICBBWzE2XT1CWzE2XV4oKH5CWzIxXSkgJiBCWzFdKTsNCiAgICAgICAgICAgIEFbMTddPUJbMTddXigofkJbMjJdKSAmIEJbMl0pOw0KICAgICAgICAgICAgQVsxOF09QlsxOF1eKCh+QlsyM10pICYgQlszXSk7DQogICAgICAgICAgICBBWzE5XT1CWzE5XV4oKH5CWzI0XSkgJiBCWzRdKTsNCiAgICAgICAgICAgIEFbMjBdPUJbMjBdXigofkJbMF0pICYgQls1XSk7DQogICAgICAgICAgICBBWzIxXT1CWzIxXV4oKH5CWzFdKSAmIEJbNl0pOw0KICAgICAgICAgICAgQVsyMl09QlsyMl1eKCh+QlsyXSkgJiBCWzddKTsNCiAgICAgICAgICAgIEFbMjNdPUJbMjNdXigofkJbM10pICYgQls4XSk7DQogICAgICAgICAgICBBWzI0XT1CWzI0XV4oKH5CWzRdKSAmIEJbOV0pOw0KDQogICAgICAgICAgICAvKkxhc3Qgc3RlcCovDQogICAgICAgICAgICBBWzBdPUFbMF1eUkNbaV07ICAgICAgICAgICAgDQogICAgICAgIH0NCg0KICAgICAgICANCiAgICAgICAgcmV0dXJuIEE7DQogICAgfQ0KIA0KICAgIA0KICAgIGZ1bmN0aW9uIHNwb25nZSh1aW50WzldIE0pIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludFsxNl0pIHsNCiAgICAgICAgaWYoIChNLmxlbmd0aCAqIDgpICE9IDcyICkgdGhyb3c7DQogICAgICAgIE1bNV0gPSAweDAxOw0KICAgICAgICBNWzhdID0gMHg4MDAwMDAwMDAwMDAwMDAwOw0KICAgICAgICANCiAgICAgICAgdWludCByID0gNzI7DQogICAgICAgIHVpbnQgdyA9IDg7DQogICAgICAgIHVpbnQgc2l6ZSA9IE0ubGVuZ3RoICogODsNCiAgICAgICAgDQogICAgICAgIHVpbnRbMjVdIG1lbW9yeSBTOw0KICAgICAgICB1aW50IGk7IHVpbnQgeTsgdWludCB4Ow0KICAgICAgICAvKkFic29yYmluZyBQaGFzZSovDQogICAgICAgIGZvciggaSA9IDAgOyBpIDwgc2l6ZS9yIDsgaSsrICkgew0KICAgICAgICAgICAgZm9yKCB5ID0gMCA7IHkgPCA1IDsgeSsrICkgew0KICAgICAgICAgICAgICAgIGZvciggeCA9IDAgOyB4IDwgNSA7IHgrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYoICh4KzUqeSkgPCAoci93KSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFNbNSp4K3ldID0gU1s1KngreV0gXiBNW2kqOSArIHggKyA1KnldOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgUyA9IGtlY2Nha19mKFMpOw0KICAgICAgICB9DQoNCiAgICAgICAgLypTcXVlZXppbmcgcGhhc2UqLw0KICAgICAgICB1aW50WzE2XSBtZW1vcnkgcmVzdWx0Ow0KICAgICAgICB1aW50IGIgPSAwOw0KICAgICAgICB3aGlsZSggYiA8IDE2ICkgew0KICAgICAgICAgICAgZm9yKCB5ID0gMCA7IHkgPCA1IDsgeSsrICkgew0KICAgICAgICAgICAgICAgIGZvciggeCA9IDAgOyB4IDwgNSA7IHgrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYoICh4KzUqeSk8KHIvdykgJiYgKGI8MTYpICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2JdID0gU1s1KngreV0gJiAweEZGRkZGRkZGOyANCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtiKzFdID0gU1s1KngreV0gLyAweDEwMDAwMDAwMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGIrPTI7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgIA0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgfQ0KDQp9DQoNCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoNCmNvbnRyYWN0IEV0aGFzaCBpcyBTSEEzXzUxMiB7DQogICAgDQogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBwdWJsaWMgb3duZXJzOw0KICAgIA0KICAgIGZ1bmN0aW9uIEV0aGFzaChhZGRyZXNzWzNdIF9vd25lcnMpIHsNCiAgICAgICAgb3duZXJzW19vd25lcnNbMF1dID0gdHJ1ZTsNCiAgICAgICAgb3duZXJzW19vd25lcnNbMV1dID0gdHJ1ZTsNCiAgICAgICAgb3duZXJzW19vd25lcnNbMl1dID0gdHJ1ZTsgICAgICAgICAgICAgICAgDQogICAgfQ0KICAgICANCiAgICBmdW5jdGlvbiBmbnYoIHVpbnQgdjEsIHVpbnQgdjIgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuICgodjEqMHgwMTAwMDE5MykgXiB2MikgJiAweEZGRkZGRkZGOw0KICAgIH0NCg0KDQoNCiAgICBmdW5jdGlvbiBjb21wdXRlQ2FjaGVSb290KCB1aW50IGluZGV4LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgaW5kZXhJbkVsZW1lbnRzQXJyYXksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIGVsZW1lbnRzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSB3aXRuZXNzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgYnJhbmNoU2l6ZSApIGNvbnN0YW50IHByaXZhdGUgcmV0dXJucyh1aW50KSB7DQogDQogICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICB1aW50IGxlYWYgPSBjb21wdXRlTGVhZihlbGVtZW50cywgaW5kZXhJbkVsZW1lbnRzQXJyYXkpICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCg0KICAgICAgICB1aW50IGxlZnQ7DQogICAgICAgIHVpbnQgcmlnaHQ7DQogICAgICAgIHVpbnQgbm9kZTsNCiAgICAgICAgYm9vbCBvZGRCcmFuY2hTaXplID0gKGJyYW5jaFNpemUgJSAyKSA+IDA7DQogICAgICAgICANCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgYnJhbmNoU2l6ZSA6PSBkaXYoYnJhbmNoU2l6ZSwyKQ0KICAgICAgICAgICAgLy9icmFuY2hTaXplIC89IDI7DQogICAgICAgIH0NCiAgICAgICAgdWludCB3aXRuZXNzSW5kZXggPSBpbmRleEluRWxlbWVudHNBcnJheSAqIGJyYW5jaFNpemU7DQogICAgICAgIGlmKCBvZGRCcmFuY2hTaXplICkgd2l0bmVzc0luZGV4ICs9IGluZGV4SW5FbGVtZW50c0FycmF5OyAgDQoNCiAgICAgICAgZm9yKCB1aW50IGRlcHRoID0gMCA7IGRlcHRoIDwgYnJhbmNoU2l6ZSA7IGRlcHRoKysgKSB7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbm9kZSA6PSBtbG9hZChhZGQoYWRkKHdpdG5lc3MsMHgyMCksbXVsKGFkZChkZXB0aCx3aXRuZXNzSW5kZXgpLDB4MjApKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vbm9kZSAgPSB3aXRuZXNzW3dpdG5lc3NJbmRleCArIGRlcHRoXSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7DQogICAgICAgICAgICBpZiggaW5kZXggJiAweDEgPT0gMCApIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gbGVhZjsNCiAgICAgICAgICAgICAgICBhc3NlbWJseXsNCiAgICAgICAgICAgICAgICAgICAgLy9yaWdodCA9IG5vZGUgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOyAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmlnaHQgOj0gYW5kKG5vZGUsMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRikNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBhc3NlbWJseXsNCiAgICAgICAgICAgICAgICAgICAgLy9sZWZ0ID0gbm9kZSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7DQogICAgICAgICAgICAgICAgICAgIGxlZnQgOj0gYW5kKG5vZGUsMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRikNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmlnaHQgPSBsZWFmOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZWFmID0gdWludChzaGEzKGxlZnQscmlnaHQpKSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgaW5kZXggOj0gZGl2KGluZGV4LDIpIA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy9pbmRleCA9IGluZGV4IC8gMjsNCg0KICAgICAgICAgICAgLy9ub2RlICA9IHdpdG5lc3Nbd2l0bmVzc0luZGV4ICsgZGVwdGhdIC8gKDIqKjEyOCk7DQogICAgICAgICAgICBpZiggaW5kZXggJiAweDEgPT0gMCApIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gbGVhZjsNCiAgICAgICAgICAgICAgICBhc3NlbWJseXsNCiAgICAgICAgICAgICAgICAgICAgcmlnaHQgOj0gZGl2KG5vZGUsMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApDQogICAgICAgICAgICAgICAgICAgIC8vcmlnaHQgPSBub2RlIC8gMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgICAgICAvL2xlZnQgPSBub2RlIC8gMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7DQogICAgICAgICAgICAgICAgICAgIGxlZnQgOj0gZGl2KG5vZGUsMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJpZ2h0ID0gbGVhZjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGVhZiA9IHVpbnQoc2hhMyhsZWZ0LHJpZ2h0KSkgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIGluZGV4IDo9IGRpdihpbmRleCwyKSANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vaW5kZXggPSBpbmRleCAvIDI7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKCBvZGRCcmFuY2hTaXplICkgew0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIG5vZGUgOj0gbWxvYWQoYWRkKGFkZCh3aXRuZXNzLDB4MjApLG11bChhZGQoZGVwdGgsd2l0bmVzc0luZGV4KSwweDIwKSkpDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy9ub2RlICA9IHdpdG5lc3Nbd2l0bmVzc0luZGV4ICsgZGVwdGhdICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgICAgIGlmKCBpbmRleCAmIDB4MSA9PSAwICkgew0KICAgICAgICAgICAgICAgIGxlZnQgPSBsZWFmOw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5ew0KICAgICAgICAgICAgICAgICAgICAvL3JpZ2h0ID0gbm9kZSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByaWdodCA6PSBhbmQobm9kZSwweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGKQ0KICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBhc3NlbWJseXsNCiAgICAgICAgICAgICAgICAgICAgLy9sZWZ0ID0gbm9kZSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBsZWZ0IDo9IGFuZChub2RlLDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcmlnaHQgPSBsZWFmOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZWFmID0gdWludChzaGEzKGxlZnQscmlnaHQpKSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7ICAgICAgICANCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIHJldHVybiBsZWFmOw0KICAgIH0NCg0KICAgIA0KICAgIGZ1bmN0aW9uIHRvQkUoIHVpbnQgeCApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCkgew0KICAgICAgICB1aW50IHkgPSAwOw0KICAgICAgICBmb3IoIHVpbnQgaSA9IDAgOyBpIDwgMzIgOyBpKysgKSB7DQogICAgICAgICAgICB5ID0geSAqIDI1NjsNCiAgICAgICAgICAgIHkgKz0gKHggJiAweEZGKTsNCiAgICAgICAgICAgIHggPSB4IC8gMjU2OyAgICAgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICByZXR1cm4geTsNCiAgICAgICAgDQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGNvbXB1dGVTaGEzKCB1aW50WzE2XSBzLCB1aW50WzhdIGNtaXggKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsNCiAgICAgICAgdWludCBzMCA9IHNbMF0gKyBzWzFdICogKDIqKjMyKSArIHNbMl0gKiAoMioqNjQpICsgc1szXSAqICgyKio5NikgKw0KICAgICAgICAgICAgICAgICAgKHNbNF0gKyBzWzVdICogKDIqKjMyKSArIHNbNl0gKiAoMioqNjQpICsgc1s3XSAqICgyKio5NikpKigyKioxMjgpOw0KDQogICAgICAgIHVpbnQgczEgPSBzWzhdICsgc1s5XSAqICgyKiozMikgKyBzWzEwXSAqICgyKio2NCkgKyBzWzExXSAqICgyKio5NikgKw0KICAgICAgICAgICAgICAgICAgKHNbMTJdICsgc1sxM10gKiAoMioqMzIpICsgc1sxNF0gKiAoMioqNjQpICsgc1sxNV0gKiAoMioqOTYpKSooMioqMTI4KTsNCiAgICAgICAgICAgICAgICAgIA0KICAgICAgICB1aW50IGMgPSBjbWl4WzBdICsgY21peFsxXSAqICgyKiozMikgKyBjbWl4WzJdICogKDIqKjY0KSArIGNtaXhbM10gKiAoMioqOTYpICsNCiAgICAgICAgICAgICAgICAgIChjbWl4WzRdICsgY21peFs1XSAqICgyKiozMikgKyBjbWl4WzZdICogKDIqKjY0KSArIGNtaXhbN10gKiAoMioqOTYpKSooMioqMTI4KTsNCg0KICAgICAgICANCiAgICAgICAgLyogZ29kIGtub3dzIHdoeSBuZWVkIHRvIGNvbnZlcnQgdG8gYmlnIGVuZGlhbiAqLw0KICAgICAgICByZXR1cm4gdWludCggc2hhMyh0b0JFKHMwKSx0b0JFKHMxKSx0b0JFKGMpKSApOw0KICAgIH0NCiANCiANCiAgICBmdW5jdGlvbiBjb21wdXRlTGVhZiggdWludFtdIGRhdGFTZXRMb29rdXAsIHVpbnQgaW5kZXggKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHVpbnQoIHNoYTMoZGF0YVNldExvb2t1cFs0KmluZGV4XSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNldExvb2t1cFs0KmluZGV4ICsgMV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTZXRMb29rdXBbNCppbmRleCArIDJdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhU2V0TG9va3VwWzQqaW5kZXggKyAzXSkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgIH0NCiANCiAgICBmdW5jdGlvbiBjb21wdXRlUyggdWludCBoZWFkZXIsIHVpbnQgbm9uY2VMZSApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludFsxNl0pIHsNCiAgICAgICAgdWludFs5XSAgbWVtb3J5IE07DQogICAgICAgIA0KICAgICAgICBoZWFkZXIgPSByZXZlcnNlQnl0ZXMoaGVhZGVyKTsNCiAgICAgICAgDQogICAgICAgIE1bMF0gPSB1aW50KGhlYWRlcikgJiAweEZGRkZGRkZGRkZGRkZGRkY7DQogICAgICAgIGhlYWRlciA9IGhlYWRlciAvIDIqKjY0Ow0KICAgICAgICBNWzFdID0gdWludChoZWFkZXIpICYgMHhGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICBoZWFkZXIgPSBoZWFkZXIgLyAyKio2NDsNCiAgICAgICAgTVsyXSA9IHVpbnQoaGVhZGVyKSAmIDB4RkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgaGVhZGVyID0gaGVhZGVyIC8gMioqNjQ7DQogICAgICAgIE1bM10gPSB1aW50KGhlYWRlcikgJiAweEZGRkZGRkZGRkZGRkZGRkY7DQoNCiAgICAgICAgLy8gbWFrZSBsaXR0bGUgZW5kaWFuIG5vbmNlDQogICAgICAgIE1bNF0gPSBub25jZUxlOw0KICAgICAgICByZXR1cm4gc3BvbmdlKE0pOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiByZXZlcnNlQnl0ZXMoIHVpbnQgaW5wdXQgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsNCiAgICAgICAgdWludCByZXN1bHQgPSAwOw0KICAgICAgICBmb3IodWludCBpID0gMCA7IGkgPCAzMiA7IGkrKyApIHsNCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCAqIDI1NjsNCiAgICAgICAgICAgIHJlc3VsdCArPSBpbnB1dCAmIDB4ZmY7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlucHV0IC89IDI1NjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgDQogICAgc3RydWN0IEV0aGFzaENhY2hlT3B0RGF0YSB7DQogICAgICAgIHVpbnRbNTEyXSAgICBtZXJrbGVOb2RlczsNCiAgICAgICAgdWludCAgICAgICAgIGZ1bGxTaXplSW4xMjhSZXN1bHRpb247DQogICAgICAgIHVpbnQgICAgICAgICBicmFuY2hEZXB0aDsNCiAgICB9DQogICAgDQogICAgbWFwcGluZyh1aW50PT5FdGhhc2hDYWNoZU9wdERhdGEpIGVwb2NoRGF0YTsNCiAgICANCiAgICBmdW5jdGlvbiBnZXRFcG9jaERhdGEoIHVpbnQgZXBvY2hJbmRleCwgdWludCBub2RlSW5kZXggKSBjb25zdGFudCByZXR1cm5zKHVpbnRbM10pIHsNCiAgICAgICAgcmV0dXJuIFtlcG9jaERhdGFbZXBvY2hJbmRleF0ubWVya2xlTm9kZXNbbm9kZUluZGV4XSwNCiAgICAgICAgICAgICAgICBlcG9jaERhdGFbZXBvY2hJbmRleF0uZnVsbFNpemVJbjEyOFJlc3VsdGlvbiwNCiAgICAgICAgICAgICAgICBlcG9jaERhdGFbZXBvY2hJbmRleF0uYnJhbmNoRGVwdGhdOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBpc0Vwb2NoRGF0YVNldCggdWludCBlcG9jaEluZGV4ICkgY29uc3RhbnQgcmV0dXJucyhib29sKSB7DQogICAgICAgIHJldHVybiBlcG9jaERhdGFbZXBvY2hJbmRleF0uZnVsbFNpemVJbjEyOFJlc3VsdGlvbiAhPSAwOw0KICAgIA0KICAgIH0NCiAgICAgICAgDQogICAgZXZlbnQgU2V0RXBvY2hEYXRhKCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbyApOyAgICANCiAgICBmdW5jdGlvbiBzZXRFcG9jaERhdGEoIHVpbnQgZXBvY2gsDQogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IGZ1bGxTaXplSW4xMjhSZXN1bHRpb24sDQogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IGJyYW5jaERlcHRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIG1lcmtsZU5vZGVzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBzdGFydCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbnVtRWxlbXMgKSB7DQoNCiAgICAgICAgaWYoICEgb3duZXJzW21zZy5zZW5kZXJdICkgew0KICAgICAgICAgICAgLy9FcnJvckxvZyggInNldEVwb2NoRGF0YTogb25seSBvd25lciBjYW4gc2V0IGRhdGEiLCB1aW50KG1zZy5zZW5kZXIpICk7DQogICAgICAgICAgICBTZXRFcG9jaERhdGEoIG1zZy5zZW5kZXIsIDB4ODIwMDAwMDAsIHVpbnQobXNnLnNlbmRlcikgKTsNCiAgICAgICAgICAgIHJldHVybjsgICAgICAgIA0KICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgZm9yKCB1aW50IGkgPSAwIDsgaSA8IG51bUVsZW1zIDsgaSsrICkgew0KICAgICAgICAgICAgaWYoIGVwb2NoRGF0YVtlcG9jaF0ubWVya2xlTm9kZXNbc3RhcnQraV0gPiAwICkgew0KICAgICAgICAgICAgICAgIC8vRXJyb3JMb2coImVwb2NoIGFscmVhZHkgc2V0IiwgZXBvY2hbaV0pOw0KICAgICAgICAgICAgICAgIFNldEVwb2NoRGF0YSggbXNnLnNlbmRlciwgMHg4MjAwMDAwMSwgZXBvY2ggKiAoMioqMTI4KSArIHN0YXJ0ICsgaSApOw0KICAgICAgICAgICAgICAgIHJldHVybjsgICAgICAgICAgICANCg0KICAgICAgICAgICAgfSANCiAgICAgICAgICAgIGVwb2NoRGF0YVtlcG9jaF0ubWVya2xlTm9kZXNbc3RhcnQraV0gPSBtZXJrbGVOb2Rlc1tpXTsNCiAgICAgICAgfQ0KICAgICAgICBlcG9jaERhdGFbZXBvY2hdLmZ1bGxTaXplSW4xMjhSZXN1bHRpb24gPSBmdWxsU2l6ZUluMTI4UmVzdWx0aW9uOw0KICAgICAgICBlcG9jaERhdGFbZXBvY2hdLmJyYW5jaERlcHRoID0gYnJhbmNoRGVwdGg7DQogICAgICAgIA0KICAgICAgICBTZXRFcG9jaERhdGEoIG1zZy5zZW5kZXIsIDAgLCAwICk7ICAgICAgICANCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRNZXJrbGVMZWF2ZSggdWludCBlcG9jaEluZGV4LCB1aW50IHAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsgICAgICAgIA0KICAgICAgICB1aW50IHJvb3RJbmRleCA9IHAgPj4gZXBvY2hEYXRhW2Vwb2NoSW5kZXhdLmJyYW5jaERlcHRoOw0KICAgICAgICB1aW50IGV4cGVjdGVkUm9vdCA9IGVwb2NoRGF0YVtlcG9jaEluZGV4XS5tZXJrbGVOb2Rlc1socm9vdEluZGV4LzIpXTsNCiAgICAgICAgaWYoIChyb290SW5kZXggJSAyKSA9PSAwICkgZXhwZWN0ZWRSb290ID0gZXhwZWN0ZWRSb290ICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgZWxzZSBleHBlY3RlZFJvb3QgPSBleHBlY3RlZFJvb3QgLyAoMioqMTI4KTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBleHBlY3RlZFJvb3Q7DQogICAgfQ0KDQoNCiAgICBmdW5jdGlvbiBoYXNoaW1vdG8oIGJ5dGVzMzIgICAgICBoZWFkZXIsDQogICAgICAgICAgICAgICAgICAgICAgICBieXRlczggICAgICAgbm9uY2VMZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSAgICAgICBkYXRhU2V0TG9va3VwLA0KICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdICAgICAgIHdpdG5lc3NGb3JMb29rdXAsDQogICAgICAgICAgICAgICAgICAgICAgICB1aW50ICAgICAgICAgZXBvY2hJbmRleCApIGNvbnN0YW50IHJldHVybnModWludCkgew0KICAgICAgICAgDQogICAgICAgIHVpbnRbMTZdIG1lbW9yeSBzOw0KICAgICAgICB1aW50WzMyXSBtZW1vcnkgbWl4Ow0KICAgICAgICB1aW50WzhdICBtZW1vcnkgY21peDsNCiAgICAgICAgDQogICAgICAgIHVpbnRbMl0gIG1lbW9yeSBkZXB0aEFuZEZ1bGxTaXplID0gW2Vwb2NoRGF0YVtlcG9jaEluZGV4XS5icmFuY2hEZXB0aCwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVwb2NoRGF0YVtlcG9jaEluZGV4XS5mdWxsU2l6ZUluMTI4UmVzdWx0aW9uXTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgdWludCBpOw0KICAgICAgICB1aW50IGo7DQogICAgICAgIA0KICAgICAgICBpZiggISBpc0Vwb2NoRGF0YVNldCggZXBvY2hJbmRleCApICkgcmV0dXJuIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRTsNCiAgICAgICAgDQogICAgICAgIGlmKCBkZXB0aEFuZEZ1bGxTaXplWzFdID09IDAgKSB7DQogICAgICAgICAgICByZXR1cm4gMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICB9DQoNCiAgICAgICAgDQogICAgICAgIHMgPSBjb21wdXRlUyh1aW50KGhlYWRlciksIHVpbnQobm9uY2VMZSkpOw0KICAgICAgICBmb3IoIGkgPSAwIDsgaSA8IDE2IDsgaSsrICkgeyAgICAgICAgICAgIA0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgOj0gbXVsKGksMHgyMCkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvL21peFtpXSA9IHNbaV07DQogICAgICAgICAgICAgICAgbXN0b3JlKGFkZChtaXgsb2Zmc2V0KSxtbG9hZChhZGQocyxvZmZzZXQpKSkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBtaXhbaSsxNl0gPSBzW2ldOw0KICAgICAgICAgICAgICAgIG1zdG9yZShhZGQobWl4LGFkZCgweDIwMCxvZmZzZXQpKSxtbG9hZChhZGQocyxvZmZzZXQpKSkgICAgDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmb3IoIGkgPSAwIDsgaSA8IDY0IDsgaSsrICkgew0KICAgICAgICAgICAgdWludCBwID0gZm52KCBpIF4gc1swXSwgbWl4W2kgJSAzMl0pICUgZGVwdGhBbmRGdWxsU2l6ZVsxXTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiggY29tcHV0ZUNhY2hlUm9vdCggcCwgaSwgZGF0YVNldExvb2t1cCwgIHdpdG5lc3NGb3JMb29rdXAsIGRlcHRoQW5kRnVsbFNpemVbMF0gKSAgIT0gZ2V0TWVya2xlTGVhdmUoIGVwb2NoSW5kZXgsIHAgKSApIHsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFBvVyBmYWlsZWQNCiAgICAgICAgICAgICAgICByZXR1cm4gMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICAgICAgfSAgICAgICANCg0KICAgICAgICAgICAgZm9yKCBqID0gMCA7IGogPCA4IDsgaisrICkgew0KDQogICAgICAgICAgICAgICAgYXNzZW1ibHl7DQogICAgICAgICAgICAgICAgICAgIC8vbWl4W2pdID0gZm52KG1peFtqXSwgZGF0YVNldExvb2t1cFs0KmldICYgdmFyRkZGRkZGRkYgKTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGFPZmZzZXQgOj0gYWRkKG11bCgweDgwLGkpLGFkZChkYXRhU2V0TG9va3VwLDB4MjApKQ0KICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YVZhbHVlICAgOj0gYW5kKG1sb2FkKGRhdGFPZmZzZXQpLDB4RkZGRkZGRkYpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBsZXQgbWl4T2Zmc2V0IDo9IGFkZChtaXgsbXVsKDB4MjAsaikpDQogICAgICAgICAgICAgICAgICAgIGxldCBtaXhWYWx1ZSAgOj0gbWxvYWQobWl4T2Zmc2V0KQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gZm52ID0gcmV0dXJuICgodjEqMHgwMTAwMDE5MykgXiB2MikgJiAweEZGRkZGRkZGOw0KICAgICAgICAgICAgICAgICAgICBsZXQgZm52VmFsdWUgOj0gYW5kKHhvcihtdWwobWl4VmFsdWUsMHgwMTAwMDE5MyksZGF0YVZhbHVlKSwweEZGRkZGRkZGKSAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG1zdG9yZShtaXhPZmZzZXQsZm52VmFsdWUpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvL21peFtqKzhdID0gZm52KG1peFtqKzhdLCBkYXRhU2V0TG9va3VwWzQqaSArIDFdICYgMHhGRkZGRkZGRiApOw0KICAgICAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0IDo9IGFkZChkYXRhT2Zmc2V0LDB4MjApDQogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZSAgIDo9IGFuZChtbG9hZChkYXRhT2Zmc2V0KSwweEZGRkZGRkZGKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbWl4T2Zmc2V0IDo9IGFkZChtaXhPZmZzZXQsMHgxMDApDQogICAgICAgICAgICAgICAgICAgIG1peFZhbHVlICA6PSBtbG9hZChtaXhPZmZzZXQpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBmbnYgPSByZXR1cm4gKCh2MSoweDAxMDAwMTkzKSBeIHYyKSAmIDB4RkZGRkZGRkY7DQogICAgICAgICAgICAgICAgICAgIGZudlZhbHVlIDo9IGFuZCh4b3IobXVsKG1peFZhbHVlLDB4MDEwMDAxOTMpLGRhdGFWYWx1ZSksMHhGRkZGRkZGRikgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBtc3RvcmUobWl4T2Zmc2V0LGZudlZhbHVlKQ0KDQogICAgICAgICAgICAgICAgICAgIC8vbWl4W2orMTZdID0gZm52KG1peFtqKzE2XSwgZGF0YVNldExvb2t1cFs0KmkgKyAyXSAmIDB4RkZGRkZGRkYgKTsNCiAgICAgICAgICAgICAgICAgICAgZGF0YU9mZnNldCA6PSBhZGQoZGF0YU9mZnNldCwweDIwKQ0KICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWUgICA6PSBhbmQobWxvYWQoZGF0YU9mZnNldCksMHhGRkZGRkZGRikNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG1peE9mZnNldCA6PSBhZGQobWl4T2Zmc2V0LDB4MTAwKQ0KICAgICAgICAgICAgICAgICAgICBtaXhWYWx1ZSAgOj0gbWxvYWQobWl4T2Zmc2V0KQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gZm52ID0gcmV0dXJuICgodjEqMHgwMTAwMDE5MykgXiB2MikgJiAweEZGRkZGRkZGOw0KICAgICAgICAgICAgICAgICAgICBmbnZWYWx1ZSA6PSBhbmQoeG9yKG11bChtaXhWYWx1ZSwweDAxMDAwMTkzKSxkYXRhVmFsdWUpLDB4RkZGRkZGRkYpICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbXN0b3JlKG1peE9mZnNldCxmbnZWYWx1ZSkNCg0KICAgICAgICAgICAgICAgICAgICAvL21peFtqKzI0XSA9IGZudihtaXhbaisyNF0sIGRhdGFTZXRMb29rdXBbNCppICsgM10gJiAweEZGRkZGRkZGICk7DQogICAgICAgICAgICAgICAgICAgIGRhdGFPZmZzZXQgOj0gYWRkKGRhdGFPZmZzZXQsMHgyMCkNCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlICAgOj0gYW5kKG1sb2FkKGRhdGFPZmZzZXQpLDB4RkZGRkZGRkYpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBtaXhPZmZzZXQgOj0gYWRkKG1peE9mZnNldCwweDEwMCkNCiAgICAgICAgICAgICAgICAgICAgbWl4VmFsdWUgIDo9IG1sb2FkKG1peE9mZnNldCkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGZudiA9IHJldHVybiAoKHYxKjB4MDEwMDAxOTMpIF4gdjIpICYgMHhGRkZGRkZGRjsNCiAgICAgICAgICAgICAgICAgICAgZm52VmFsdWUgOj0gYW5kKHhvcihtdWwobWl4VmFsdWUsMHgwMTAwMDE5MyksZGF0YVZhbHVlKSwweEZGRkZGRkZGKSAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG1zdG9yZShtaXhPZmZzZXQsZm52VmFsdWUpICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvL21peFtqXSA9IGZudihtaXhbal0sIGRhdGFTZXRMb29rdXBbNCppXSAmIDB4RkZGRkZGRkYgKTsNCiAgICAgICAgICAgICAgICAvL21peFtqKzhdID0gZm52KG1peFtqKzhdLCBkYXRhU2V0TG9va3VwWzQqaSArIDFdICYgMHhGRkZGRkZGRiApOw0KICAgICAgICAgICAgICAgIC8vbWl4W2orMTZdID0gZm52KG1peFtqKzE2XSwgZGF0YVNldExvb2t1cFs0KmkgKyAyXSAmIDB4RkZGRkZGRkYgKTsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy9taXhbaisyNF0gPSBmbnYobWl4W2orMjRdLCBkYXRhU2V0TG9va3VwWzQqaSArIDNdICYgMHhGRkZGRkZGRiApOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vZGF0YVNldExvb2t1cFs0KmkgICAgXSA9IGRhdGFTZXRMb29rdXBbNCppICAgIF0vKDIqKjMyKTsNCiAgICAgICAgICAgICAgICAvL2RhdGFTZXRMb29rdXBbNCppICsgMV0gPSBkYXRhU2V0TG9va3VwWzQqaSArIDFdLygyKiozMik7DQogICAgICAgICAgICAgICAgLy9kYXRhU2V0TG9va3VwWzQqaSArIDJdID0gZGF0YVNldExvb2t1cFs0KmkgKyAyXS8oMioqMzIpOw0KICAgICAgICAgICAgICAgIC8vZGF0YVNldExvb2t1cFs0KmkgKyAzXSA9IGRhdGFTZXRMb29rdXBbNCppICsgM10vKDIqKjMyKTsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgYXNzZW1ibHl7DQogICAgICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgOj0gYWRkKGFkZChkYXRhU2V0TG9va3VwLDB4MjApLG11bChpLDB4ODApKQ0KICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWUgIDo9IGRpdihtbG9hZChvZmZzZXQpLDB4MTAwMDAwMDAwKQ0KICAgICAgICAgICAgICAgICAgICBtc3RvcmUob2Zmc2V0LHZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG9mZnNldCA6PSBhZGQob2Zmc2V0LDB4MjApDQogICAgICAgICAgICAgICAgICAgIHZhbHVlICA6PSBkaXYobWxvYWQob2Zmc2V0KSwweDEwMDAwMDAwMCkNCiAgICAgICAgICAgICAgICAgICAgbXN0b3JlKG9mZnNldCx2YWx1ZSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG9mZnNldCA6PSBhZGQob2Zmc2V0LDB4MjApDQogICAgICAgICAgICAgICAgICAgIHZhbHVlICA6PSBkaXYobWxvYWQob2Zmc2V0KSwweDEwMDAwMDAwMCkNCiAgICAgICAgICAgICAgICAgICAgbXN0b3JlKG9mZnNldCx2YWx1ZSkgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0IDo9IGFkZChvZmZzZXQsMHgyMCkNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgIDo9IGRpdihtbG9hZChvZmZzZXQpLDB4MTAwMDAwMDAwKQ0KICAgICAgICAgICAgICAgICAgICBtc3RvcmUob2Zmc2V0LHZhbHVlKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGZvciggaSA9IDAgOyBpIDwgMzIgOyBpICs9IDQpIHsNCiAgICAgICAgICAgIGNtaXhbaS80XSA9IChmbnYoZm52KGZudihtaXhbaV0sIG1peFtpKzFdKSwgbWl4W2krMl0pLCBtaXhbaSszXSkpOw0KICAgICAgICB9DQogICAgICAgIA0KDQogICAgICAgIHVpbnQgcmVzdWx0ID0gY29tcHV0ZVNoYTMocyxjbWl4KTsgDQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgDQogICAgfQ0KfQ0KDQovKioNCiogQHRpdGxlIFJMUFJlYWRlcg0KKg0KKiBSTFBSZWFkZXIgaXMgdXNlZCB0byByZWFkIGFuZCBwYXJzZSBSTFAgZW5jb2RlZCBkYXRhIGluIG1lbW9yeS4NCioNCiogQGF1dGhvciBBbmRyZWFzIE9sb2Zzc29uIChhbmRyb2xvMTk4MEBnbWFpbC5jb20pDQoqLw0KbGlicmFyeSBSTFAgew0KDQogdWludCBjb25zdGFudCBEQVRBX1NIT1JUX1NUQVJUID0gMHg4MDsNCiB1aW50IGNvbnN0YW50IERBVEFfTE9OR19TVEFSVCA9IDB4Qjg7DQogdWludCBjb25zdGFudCBMSVNUX1NIT1JUX1NUQVJUID0gMHhDMDsNCiB1aW50IGNvbnN0YW50IExJU1RfTE9OR19TVEFSVCA9IDB4Rjg7DQoNCiB1aW50IGNvbnN0YW50IERBVEFfTE9OR19PRkZTRVQgPSAweEI3Ow0KIHVpbnQgY29uc3RhbnQgTElTVF9MT05HX09GRlNFVCA9IDB4Rjc7DQoNCg0KIHN0cnVjdCBSTFBJdGVtIHsNCiAgICAgdWludCBfdW5zYWZlX21lbVB0cjsgICAgLy8gUG9pbnRlciB0byB0aGUgUkxQLWVuY29kZWQgYnl0ZXMuDQogICAgIHVpbnQgX3Vuc2FmZV9sZW5ndGg7ICAgIC8vIE51bWJlciBvZiBieXRlcy4gVGhpcyBpcyB0aGUgZnVsbCBsZW5ndGggb2YgdGhlIHN0cmluZy4NCiB9DQoNCiBzdHJ1Y3QgSXRlcmF0b3Igew0KICAgICBSTFBJdGVtIF91bnNhZmVfaXRlbTsgICAvLyBJdGVtIHRoYXQncyBiZWluZyBpdGVyYXRlZCBvdmVyLg0KICAgICB1aW50IF91bnNhZmVfbmV4dFB0cjsgICAvLyBQb3NpdGlvbiBvZiB0aGUgbmV4dCBpdGVtIGluIHRoZSBsaXN0Lg0KIH0NCg0KIC8qIEl0ZXJhdG9yICovDQoNCiBmdW5jdGlvbiBuZXh0KEl0ZXJhdG9yIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSBzdWJJdGVtKSB7DQogICAgIGlmKGhhc05leHQoc2VsZikpIHsNCiAgICAgICAgIHZhciBwdHIgPSBzZWxmLl91bnNhZmVfbmV4dFB0cjsNCiAgICAgICAgIHZhciBpdGVtTGVuZ3RoID0gX2l0ZW1MZW5ndGgocHRyKTsNCiAgICAgICAgIHN1Ykl0ZW0uX3Vuc2FmZV9tZW1QdHIgPSBwdHI7DQogICAgICAgICBzdWJJdGVtLl91bnNhZmVfbGVuZ3RoID0gaXRlbUxlbmd0aDsNCiAgICAgICAgIHNlbGYuX3Vuc2FmZV9uZXh0UHRyID0gcHRyICsgaXRlbUxlbmd0aDsNCiAgICAgfQ0KICAgICBlbHNlDQogICAgICAgICB0aHJvdzsNCiB9DQoNCiBmdW5jdGlvbiBuZXh0KEl0ZXJhdG9yIG1lbW9yeSBzZWxmLCBib29sIHN0cmljdCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoUkxQSXRlbSBtZW1vcnkgc3ViSXRlbSkgew0KICAgICBzdWJJdGVtID0gbmV4dChzZWxmKTsNCiAgICAgaWYoc3RyaWN0ICYmICFfdmFsaWRhdGUoc3ViSXRlbSkpDQogICAgICAgICB0aHJvdzsNCiAgICAgcmV0dXJuOw0KIH0NCg0KIGZ1bmN0aW9uIGhhc05leHQoSXRlcmF0b3IgbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICAgdmFyIGl0ZW0gPSBzZWxmLl91bnNhZmVfaXRlbTsNCiAgICAgcmV0dXJuIHNlbGYuX3Vuc2FmZV9uZXh0UHRyIDwgaXRlbS5fdW5zYWZlX21lbVB0ciArIGl0ZW0uX3Vuc2FmZV9sZW5ndGg7DQogfQ0KDQogLyogUkxQSXRlbSAqLw0KDQogLy8vIEBkZXYgQ3JlYXRlcyBhbiBSTFBJdGVtIGZyb20gYW4gYXJyYXkgb2YgUkxQIGVuY29kZWQgYnl0ZXMuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgZW5jb2RlZCBieXRlcy4NCiAvLy8gQHJldHVybiBBbiBSTFBJdGVtDQogZnVuY3Rpb24gdG9STFBJdGVtKGJ5dGVzIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSkgew0KICAgICB1aW50IGxlbiA9IHNlbGYubGVuZ3RoOw0KICAgICBpZiAobGVuID09IDApIHsNCiAgICAgICAgIHJldHVybiBSTFBJdGVtKDAsIDApOw0KICAgICB9DQogICAgIHVpbnQgbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICBtZW1QdHIgOj0gYWRkKHNlbGYsIDB4MjApDQogICAgIH0NCiAgICAgcmV0dXJuIFJMUEl0ZW0obWVtUHRyLCBsZW4pOw0KIH0NCg0KIC8vLyBAZGV2IENyZWF0ZXMgYW4gUkxQSXRlbSBmcm9tIGFuIGFycmF5IG9mIFJMUCBlbmNvZGVkIGJ5dGVzLg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGVuY29kZWQgYnl0ZXMuDQogLy8vIEBwYXJhbSBzdHJpY3QgV2lsbCB0aHJvdyBpZiB0aGUgZGF0YSBpcyBub3QgUkxQIGVuY29kZWQuDQogLy8vIEByZXR1cm4gQW4gUkxQSXRlbQ0KIGZ1bmN0aW9uIHRvUkxQSXRlbShieXRlcyBtZW1vcnkgc2VsZiwgYm9vbCBzdHJpY3QpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5KSB7DQogICAgIHZhciBpdGVtID0gdG9STFBJdGVtKHNlbGYpOw0KICAgICBpZihzdHJpY3QpIHsNCiAgICAgICAgIHVpbnQgbGVuID0gc2VsZi5sZW5ndGg7DQogICAgICAgICBpZihfcGF5bG9hZE9mZnNldChpdGVtKSA+IGxlbikNCiAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgIGlmKF9pdGVtTGVuZ3RoKGl0ZW0uX3Vuc2FmZV9tZW1QdHIpICE9IGxlbikNCiAgICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgIGlmKCFfdmFsaWRhdGUoaXRlbSkpDQogICAgICAgICAgICAgdGhyb3c7DQogICAgIH0NCiAgICAgcmV0dXJuIGl0ZW07DQogfQ0KDQogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIG51bGwuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgbnVsbC4NCiBmdW5jdGlvbiBpc051bGwoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsNCiAgICAgcmV0dXJuIHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMDsNCiB9DQoNCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gJ3RydWUnIGlmIHRoZSBpdGVtIGlzIGEgbGlzdC4NCiBmdW5jdGlvbiBpc0xpc3QoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsNCiAgICAgaWYgKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkNCiAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICByZXQgOj0gaXN6ZXJvKGx0KGJ5dGUoMCwgbWxvYWQobWVtUHRyKSksIDB4QzApKQ0KICAgICB9DQogfQ0KDQogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIGRhdGEuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgZGF0YS4NCiBmdW5jdGlvbiBpc0RhdGEoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsNCiAgICAgaWYgKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkNCiAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICByZXQgOj0gbHQoYnl0ZSgwLCBtbG9hZChtZW1QdHIpKSwgMHhDMCkNCiAgICAgfQ0KIH0NCg0KIC8vLyBAZGV2IENoZWNrIGlmIHRoZSBSTFAgaXRlbSBpcyBlbXB0eSAoc3RyaW5nIG9yIGxpc3QpLg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gJ3RydWUnIGlmIHRoZSBpdGVtIGlzIG51bGwuDQogZnVuY3Rpb24gaXNFbXB0eShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgew0KICAgICBpZihpc051bGwoc2VsZikpDQogICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgIHVpbnQgYjA7DQogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICB9DQogICAgIHJldHVybiAoYjAgPT0gREFUQV9TSE9SVF9TVEFSVCB8fCBiMCA9PSBMSVNUX1NIT1JUX1NUQVJUKTsNCiB9DQoNCiAvLy8gQGRldiBHZXQgdGhlIG51bWJlciBvZiBpdGVtcyBpbiBhbiBSTFAgZW5jb2RlZCBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBpdGVtcy4NCiBmdW5jdGlvbiBpdGVtcyhSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgIGlmICghaXNMaXN0KHNlbGYpKQ0KICAgICAgICAgcmV0dXJuIDA7DQogICAgIHVpbnQgYjA7DQogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICB9DQogICAgIHVpbnQgcG9zID0gbWVtUHRyICsgX3BheWxvYWRPZmZzZXQoc2VsZik7DQogICAgIHVpbnQgbGFzdCA9IG1lbVB0ciArIHNlbGYuX3Vuc2FmZV9sZW5ndGggLSAxOw0KICAgICB1aW50IGl0bXM7DQogICAgIHdoaWxlKHBvcyA8PSBsYXN0KSB7DQogICAgICAgICBwb3MgKz0gX2l0ZW1MZW5ndGgocG9zKTsNCiAgICAgICAgIGl0bXMrKzsNCiAgICAgfQ0KICAgICByZXR1cm4gaXRtczsNCiB9DQoNCiAvLy8gQGRldiBDcmVhdGUgYW4gaXRlcmF0b3IuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiBBbiAnSXRlcmF0b3InIG92ZXIgdGhlIGl0ZW0uDQogZnVuY3Rpb24gaXRlcmF0b3IoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoSXRlcmF0b3IgbWVtb3J5IGl0KSB7DQogICAgIGlmICghaXNMaXN0KHNlbGYpKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHVpbnQgcHRyID0gc2VsZi5fdW5zYWZlX21lbVB0ciArIF9wYXlsb2FkT2Zmc2V0KHNlbGYpOw0KICAgICBpdC5fdW5zYWZlX2l0ZW0gPSBzZWxmOw0KICAgICBpdC5fdW5zYWZlX25leHRQdHIgPSBwdHI7DQogfQ0KDQogLy8vIEBkZXYgUmV0dXJuIHRoZSBSTFAgZW5jb2RlZCBieXRlcy4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGJ5dGVzLg0KIGZ1bmN0aW9uIHRvQnl0ZXMoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMgbWVtb3J5IGJ0cykgew0KICAgICB2YXIgbGVuID0gc2VsZi5fdW5zYWZlX2xlbmd0aDsNCiAgICAgaWYgKGxlbiA9PSAwKQ0KICAgICAgICAgcmV0dXJuOw0KICAgICBidHMgPSBuZXcgYnl0ZXMobGVuKTsNCiAgICAgX2NvcHlUb0J5dGVzKHNlbGYuX3Vuc2FmZV9tZW1QdHIsIGJ0cywgbGVuKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGJ5dGVzLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlDQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuDQogZnVuY3Rpb24gdG9EYXRhKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzIG1lbW9yeSBidHMpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGJ0cyA9IG5ldyBieXRlcyhsZW4pOw0KICAgICBfY29weVRvQnl0ZXMoclN0YXJ0UG9zLCBidHMsIGxlbik7DQogfQ0KDQogLy8vIEBkZXYgR2V0IHRoZSBsaXN0IG9mIHN1Yi1pdGVtcyBmcm9tIGFuIFJMUCBlbmNvZGVkIGxpc3QuDQogLy8vIFdhcm5pbmc6IFRoaXMgaXMgaW5lZmZpY2llbnQsIGFzIGl0IHJlcXVpcmVzIHRoYXQgdGhlIGxpc3QgaXMgcmVhZCB0d2ljZS4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLg0KIC8vLyBAcmV0dXJuIEFycmF5IG9mIFJMUEl0ZW1zLg0KIGZ1bmN0aW9uIHRvTGlzdChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtW10gbWVtb3J5IGxpc3QpIHsNCiAgICAgaWYoIWlzTGlzdChzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgbnVtSXRlbXMgPSBpdGVtcyhzZWxmKTsNCiAgICAgbGlzdCA9IG5ldyBSTFBJdGVtW10obnVtSXRlbXMpOw0KICAgICB2YXIgaXQgPSBpdGVyYXRvcihzZWxmKTsNCiAgICAgdWludCBpZHg7DQogICAgIHdoaWxlKGhhc05leHQoaXQpKSB7DQogICAgICAgICBsaXN0W2lkeF0gPSBuZXh0KGl0KTsNCiAgICAgICAgIGlkeCsrOw0KICAgICB9DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhbiBhc2NpaSBzdHJpbmcuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0FzY2lpKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBtZW1vcnkgc3RyKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBieXRlcyBtZW1vcnkgYnRzID0gbmV3IGJ5dGVzKGxlbik7DQogICAgIF9jb3B5VG9CeXRlcyhyU3RhcnRQb3MsIGJ0cywgbGVuKTsNCiAgICAgc3RyID0gc3RyaW5nKGJ0cyk7DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIHVpbnQuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b1VpbnQoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuID4gMzIgfHwgbGVuID09IDApDQogICAgICAgICB0aHJvdzsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgZGF0YSA6PSBkaXYobWxvYWQoclN0YXJ0UG9zKSwgZXhwKDI1Niwgc3ViKDMyLCBsZW4pKSkNCiAgICAgfQ0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYSBib29sZWFuLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlDQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuDQogZnVuY3Rpb24gdG9Cb29sKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZGF0YSkgew0KICAgICBpZighaXNEYXRhKHNlbGYpKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsNCiAgICAgaWYgKGxlbiAhPSAxKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHVpbnQgdGVtcDsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgdGVtcCA6PSBieXRlKDAsIG1sb2FkKHJTdGFydFBvcykpDQogICAgIH0NCiAgICAgaWYgKHRlbXAgPiAxKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHJldHVybiB0ZW1wID09IDEgPyB0cnVlIDogZmFsc2U7DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIGJ5dGUuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0J5dGUoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZSBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuICE9IDEpDQogICAgICAgICB0aHJvdzsNCiAgICAgdWludCB0ZW1wOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICB0ZW1wIDo9IGJ5dGUoMCwgbWxvYWQoclN0YXJ0UG9zKSkNCiAgICAgfQ0KICAgICByZXR1cm4gYnl0ZSh0ZW1wKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGludC4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvSW50KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGludCBkYXRhKSB7DQogICAgIHJldHVybiBpbnQodG9VaW50KHNlbGYpKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGEgYnl0ZXMzMi4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvQnl0ZXMzMihSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlczMyIGRhdGEpIHsNCiAgICAgcmV0dXJuIGJ5dGVzMzIodG9VaW50KHNlbGYpKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGFkZHJlc3MuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0FkZHJlc3MoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuICE9IDIwKQ0KICAgICAgICAgdGhyb3c7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGRhdGEgOj0gZGl2KG1sb2FkKHJTdGFydFBvcyksIGV4cCgyNTYsIDEyKSkNCiAgICAgfQ0KIH0NCg0KIC8vIEdldCB0aGUgcGF5bG9hZCBvZmZzZXQuDQogZnVuY3Rpb24gX3BheWxvYWRPZmZzZXQoUkxQSXRlbSBtZW1vcnkgc2VsZikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgIGlmKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkNCiAgICAgICAgIHJldHVybiAwOw0KICAgICB1aW50IGIwOw0KICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkNCiAgICAgfQ0KICAgICBpZihiMCA8IERBVEFfU0hPUlRfU1RBUlQpDQogICAgICAgICByZXR1cm4gMDsNCiAgICAgaWYoYjAgPCBEQVRBX0xPTkdfU1RBUlQgfHwgKGIwID49IExJU1RfU0hPUlRfU1RBUlQgJiYgYjAgPCBMSVNUX0xPTkdfU1RBUlQpKQ0KICAgICAgICAgcmV0dXJuIDE7DQogICAgIGlmKGIwIDwgTElTVF9TSE9SVF9TVEFSVCkNCiAgICAgICAgIHJldHVybiBiMCAtIERBVEFfTE9OR19PRkZTRVQgKyAxOw0KICAgICByZXR1cm4gYjAgLSBMSVNUX0xPTkdfT0ZGU0VUICsgMTsNCiB9DQoNCiAvLyBHZXQgdGhlIGZ1bGwgbGVuZ3RoIG9mIGFuIFJMUCBpdGVtLg0KIGZ1bmN0aW9uIF9pdGVtTGVuZ3RoKHVpbnQgbWVtUHRyKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQgbGVuKSB7DQogICAgIHVpbnQgYjA7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkNCiAgICAgfQ0KICAgICBpZiAoYjAgPCBEQVRBX1NIT1JUX1NUQVJUKQ0KICAgICAgICAgbGVuID0gMTsNCiAgICAgZWxzZSBpZiAoYjAgPCBEQVRBX0xPTkdfU1RBUlQpDQogICAgICAgICBsZW4gPSBiMCAtIERBVEFfU0hPUlRfU1RBUlQgKyAxOw0KICAgICBlbHNlIGlmIChiMCA8IExJU1RfU0hPUlRfU1RBUlQpIHsNCiAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICBsZXQgYkxlbiA6PSBzdWIoYjAsIDB4QjcpIC8vIGJ5dGVzIGxlbmd0aCAoREFUQV9MT05HX09GRlNFVCkNCiAgICAgICAgICAgICBsZXQgZExlbiA6PSBkaXYobWxvYWQoYWRkKG1lbVB0ciwgMSkpLCBleHAoMjU2LCBzdWIoMzIsIGJMZW4pKSkgLy8gZGF0YSBsZW5ndGgNCiAgICAgICAgICAgICBsZW4gOj0gYWRkKDEsIGFkZChiTGVuLCBkTGVuKSkgLy8gdG90YWwgbGVuZ3RoDQogICAgICAgICB9DQogICAgIH0NCiAgICAgZWxzZSBpZiAoYjAgPCBMSVNUX0xPTkdfU1RBUlQpDQogICAgICAgICBsZW4gPSBiMCAtIExJU1RfU0hPUlRfU1RBUlQgKyAxOw0KICAgICBlbHNlIHsNCiAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICBsZXQgYkxlbiA6PSBzdWIoYjAsIDB4RjcpIC8vIGJ5dGVzIGxlbmd0aCAoTElTVF9MT05HX09GRlNFVCkNCiAgICAgICAgICAgICBsZXQgZExlbiA6PSBkaXYobWxvYWQoYWRkKG1lbVB0ciwgMSkpLCBleHAoMjU2LCBzdWIoMzIsIGJMZW4pKSkgLy8gZGF0YSBsZW5ndGgNCiAgICAgICAgICAgICBsZW4gOj0gYWRkKDEsIGFkZChiTGVuLCBkTGVuKSkgLy8gdG90YWwgbGVuZ3RoDQogICAgICAgICB9DQogICAgIH0NCiB9DQoNCiAvLyBHZXQgc3RhcnQgcG9zaXRpb24gYW5kIGxlbmd0aCBvZiB0aGUgZGF0YS4NCiBmdW5jdGlvbiBfZGVjb2RlKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCBtZW1QdHIsIHVpbnQgbGVuKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdWludCBiMDsNCiAgICAgdWludCBzdGFydCA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQoc3RhcnQpKQ0KICAgICB9DQogICAgIGlmIChiMCA8IERBVEFfU0hPUlRfU1RBUlQpIHsNCiAgICAgICAgIG1lbVB0ciA9IHN0YXJ0Ow0KICAgICAgICAgbGVuID0gMTsNCiAgICAgICAgIHJldHVybjsNCiAgICAgfQ0KICAgICBpZiAoYjAgPCBEQVRBX0xPTkdfU1RBUlQpIHsNCiAgICAgICAgIGxlbiA9IHNlbGYuX3Vuc2FmZV9sZW5ndGggLSAxOw0KICAgICAgICAgbWVtUHRyID0gc3RhcnQgKyAxOw0KICAgICB9IGVsc2Ugew0KICAgICAgICAgdWludCBiTGVuOw0KICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgIGJMZW4gOj0gc3ViKGIwLCAweEI3KSAvLyBEQVRBX0xPTkdfT0ZGU0VUDQogICAgICAgICB9DQogICAgICAgICBsZW4gPSBzZWxmLl91bnNhZmVfbGVuZ3RoIC0gMSAtIGJMZW47DQogICAgICAgICBtZW1QdHIgPSBzdGFydCArIGJMZW4gKyAxOw0KICAgICB9DQogICAgIHJldHVybjsNCiB9DQoNCiAvLyBBc3N1bWVzIHRoYXQgZW5vdWdoIG1lbW9yeSBoYXMgYmVlbiBhbGxvY2F0ZWQgdG8gc3RvcmUgaW4gdGFyZ2V0Lg0KIGZ1bmN0aW9uIF9jb3B5VG9CeXRlcyh1aW50IGJ0c1B0ciwgYnl0ZXMgbWVtb3J5IHRndCwgdWludCBidHNMZW4pIHByaXZhdGUgY29uc3RhbnQgew0KICAgICAvLyBFeHBsb2l0aW5nIHRoZSBmYWN0IHRoYXQgJ3RndCcgd2FzIHRoZSBsYXN0IHRoaW5nIHRvIGJlIGFsbG9jYXRlZCwNCiAgICAgLy8gd2UgY2FuIHdyaXRlIGVudGlyZSB3b3JkcywgYW5kIGp1c3Qgb3ZlcndyaXRlIGFueSBleGNlc3MuDQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgbGV0IGkgOj0gMCAvLyBTdGFydCBhdCBhcnIgKyAweDIwDQogICAgICAgICAgICAgICAgIGxldCB3b3JkcyA6PSBkaXYoYWRkKGJ0c0xlbiwgMzEpLCAzMikNCiAgICAgICAgICAgICAgICAgbGV0IHJPZmZzZXQgOj0gYnRzUHRyDQogICAgICAgICAgICAgICAgIGxldCB3T2Zmc2V0IDo9IGFkZCh0Z3QsIDB4MjApDQogICAgICAgICAgICAgdGFnX2xvb3A6DQogICAgICAgICAgICAgICAgIGp1bXBpKGVuZCwgZXEoaSwgd29yZHMpKQ0KICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0IDo9IG11bChpLCAweDIwKQ0KICAgICAgICAgICAgICAgICAgICAgbXN0b3JlKGFkZCh3T2Zmc2V0LCBvZmZzZXQpLCBtbG9hZChhZGQock9mZnNldCwgb2Zmc2V0KSkpDQogICAgICAgICAgICAgICAgICAgICBpIDo9IGFkZChpLCAxKQ0KICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgIGp1bXAodGFnX2xvb3ApDQogICAgICAgICAgICAgZW5kOg0KICAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRndCwgYWRkKDB4MjAsIG1sb2FkKHRndCkpKSwgMCkNCiAgICAgICAgIH0NCiAgICAgfQ0KIH0NCg0KICAgICAvLyBDaGVjayB0aGF0IGFuIFJMUCBpdGVtIGlzIHZhbGlkLg0KICAgICBmdW5jdGlvbiBfdmFsaWRhdGUoUkxQSXRlbSBtZW1vcnkgc2VsZikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgew0KICAgICAgICAgLy8gQ2hlY2sgdGhhdCBSTFAgaXMgd2VsbC1mb3JtZWQuDQogICAgICAgICB1aW50IGIwOw0KICAgICAgICAgdWludCBiMTsNCiAgICAgICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpDQogICAgICAgICAgICAgYjEgOj0gYnl0ZSgxLCBtbG9hZChtZW1QdHIpKQ0KICAgICAgICAgfQ0KICAgICAgICAgaWYoYjAgPT0gREFUQV9TSE9SVF9TVEFSVCArIDEgJiYgYjEgPCBEQVRBX1NIT1JUX1NUQVJUKQ0KICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICB9DQp9DQoNCg0KDQoNCmNvbnRyYWN0IEFndCB7DQogICAgdXNpbmcgUkxQIGZvciBSTFAuUkxQSXRlbTsNCiAgICB1c2luZyBSTFAgZm9yIFJMUC5JdGVyYXRvcjsNCiAgICB1c2luZyBSTFAgZm9yIGJ5dGVzOw0KIA0KICAgIHN0cnVjdCBCbG9ja0hlYWRlciB7DQogICAgICAgIHVpbnQgICAgICAgcHJldkJsb2NrSGFzaDsgLy8gMA0KICAgICAgICB1aW50ICAgICAgIGNvaW5iYXNlOyAgICAgIC8vIDENCiAgICAgICAgdWludCAgICAgICBibG9ja051bWJlcjsgICAvLyA4DQogICAgICAgIC8vdWludCAgICAgICBnYXNVc2VkOyAgICAgICAvLyAxMA0KICAgICAgICB1aW50ICAgICAgIHRpbWVzdGFtcDsgICAgIC8vIDExDQogICAgICAgIGJ5dGVzMzIgICAgZXh0cmFEYXRhOyAgICAgLy8gMTINCiAgICB9DQogDQogICAgZnVuY3Rpb24gQWd0KCkge30NCiAgICAgDQogICAgZnVuY3Rpb24gcGFyc2VCbG9ja0hlYWRlciggYnl0ZXMgcmxwSGVhZGVyICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhCbG9ja0hlYWRlcikgew0KICAgICAgICBCbG9ja0hlYWRlciBtZW1vcnkgaGVhZGVyOw0KICAgICAgICANCiAgICAgICAgdmFyIGl0ID0gcmxwSGVhZGVyLnRvUkxQSXRlbSgpLml0ZXJhdG9yKCk7ICAgICAgICANCiAgICAgICAgdWludCBpZHg7DQogICAgICAgIHdoaWxlKGl0Lmhhc05leHQoKSkgew0KICAgICAgICAgICAgaWYoIGlkeCA9PSAwICkgaGVhZGVyLnByZXZCbG9ja0hhc2ggPSBpdC5uZXh0KCkudG9VaW50KCk7DQogICAgICAgICAgICBlbHNlIGlmICggaWR4ID09IDIgKSBoZWFkZXIuY29pbmJhc2UgPSBpdC5uZXh0KCkudG9VaW50KCk7DQogICAgICAgICAgICBlbHNlIGlmICggaWR4ID09IDggKSBoZWFkZXIuYmxvY2tOdW1iZXIgPSBpdC5uZXh0KCkudG9VaW50KCk7DQogICAgICAgICAgICBlbHNlIGlmICggaWR4ID09IDExICkgaGVhZGVyLnRpbWVzdGFtcCA9IGl0Lm5leHQoKS50b1VpbnQoKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKCBpZHggPT0gMTIgKSBoZWFkZXIuZXh0cmFEYXRhID0gYnl0ZXMzMihpdC5uZXh0KCkudG9VaW50KCkpOw0KICAgICAgICAgICAgZWxzZSBpdC5uZXh0KCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlkeCsrOw0KICAgICAgICB9DQogDQogICAgICAgIHJldHVybiBoZWFkZXI7ICAgICAgICANCiAgICB9DQogICAgICAgICAgICANCiAgICAvL2V2ZW50IFZlcmlmeUFndCggc3RyaW5nIG1zZywgdWludCBpbmRleCApOw0KICAgIGV2ZW50IFZlcmlmeUFndCggdWludCBlcnJvciwgdWludCBpbmRleCApOyAgICANCiAgICANCiAgICBzdHJ1Y3QgVmVyaWZ5QWd0RGF0YSB7DQogICAgICAgIHVpbnQgcm9vdEhhc2g7DQogICAgICAgIHVpbnQgcm9vdE1pbjsNCiAgICAgICAgdWludCByb290TWF4Ow0KICAgICAgICANCiAgICAgICAgdWludCBsZWFmSGFzaDsNCiAgICAgICAgdWludCBsZWFmQ291bnRlcjsgICAgICAgIA0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHZlcmlmeUFndCggVmVyaWZ5QWd0RGF0YSBkYXRhLA0KICAgICAgICAgICAgICAgICAgICAgICAgdWludCAgIGJyYW5jaEluZGV4LA0KICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIGNvdW50ZXJzQnJhbmNoLA0KICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIGhhc2hlc0JyYW5jaCApIGNvbnN0YW50IGludGVybmFsIHJldHVybnMoYm9vbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIHVpbnQgY3VycmVudEhhc2ggPSBkYXRhLmxlYWZIYXNoICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgDQogICAgICAgIHVpbnQgbGVmdENvdW50ZXJNaW47DQogICAgICAgIHVpbnQgbGVmdENvdW50ZXJNYXg7ICAgICAgICANCiAgICAgICAgdWludCBsZWZ0SGFzaDsNCiAgICAgICAgDQogICAgICAgIHVpbnQgcmlnaHRDb3VudGVyTWluOw0KICAgICAgICB1aW50IHJpZ2h0Q291bnRlck1heDsgICAgICAgIA0KICAgICAgICB1aW50IHJpZ2h0SGFzaDsNCiAgICAgICAgDQogICAgICAgIHVpbnQgbWluID0gZGF0YS5sZWFmQ291bnRlcjsNCiAgICAgICAgdWludCBtYXggPSBkYXRhLmxlYWZDb3VudGVyOw0KICAgICAgICANCiAgICAgICAgZm9yKCB1aW50IGkgPSAwIDsgaSA8IGNvdW50ZXJzQnJhbmNoLmxlbmd0aCA7IGkrKyApIHsNCiAgICAgICAgICAgIGlmKCBicmFuY2hJbmRleCAmIDB4MSA+IDAgKSB7DQogICAgICAgICAgICAgICAgbGVmdENvdW50ZXJNaW4gPSBjb3VudGVyc0JyYW5jaFtpXSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7DQogICAgICAgICAgICAgICAgbGVmdENvdW50ZXJNYXggPSBjb3VudGVyc0JyYW5jaFtpXSA+PiAxMjg7ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGxlZnRIYXNoICAgID0gaGFzaGVzQnJhbmNoW2ldOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHJpZ2h0Q291bnRlck1pbiA9IG1pbjsNCiAgICAgICAgICAgICAgICByaWdodENvdW50ZXJNYXggPSBtYXg7DQogICAgICAgICAgICAgICAgcmlnaHRIYXNoICAgID0gY3VycmVudEhhc2g7ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGxlZnRDb3VudGVyTWluID0gbWluOw0KICAgICAgICAgICAgICAgIGxlZnRDb3VudGVyTWF4ID0gbWF4Ow0KICAgICAgICAgICAgICAgIGxlZnRIYXNoICAgID0gY3VycmVudEhhc2g7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcmlnaHRDb3VudGVyTWluID0gY291bnRlcnNCcmFuY2hbaV0gJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICAgICAgICAgIHJpZ2h0Q291bnRlck1heCA9IGNvdW50ZXJzQnJhbmNoW2ldID4+IDEyODsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcmlnaHRIYXNoICAgID0gaGFzaGVzQnJhbmNoW2ldOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGN1cnJlbnRIYXNoID0gdWludChzaGEzKGxlZnRDb3VudGVyTWluICsgKGxlZnRDb3VudGVyTWF4IDw8IDEyOCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0SGFzaCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0Q291bnRlck1pbiArIChyaWdodENvdW50ZXJNYXggPDwgMTI4KSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0SGFzaCkpICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIChsZWZ0Q291bnRlck1pbiA+PSBsZWZ0Q291bnRlck1heCkgfHwgKHJpZ2h0Q291bnRlck1pbiA+PSByaWdodENvdW50ZXJNYXgpICkgew0KICAgICAgICAgICAgICAgIGlmKCBpID4gMCApIHsNCiAgICAgICAgICAgICAgICAgICAgLy9WZXJpZnlBZ3QoICJjb3VudGVycyBtaXNtYXRjaCIsaSk7DQogICAgICAgICAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwMCwgaSApOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmKCBsZWZ0Q291bnRlck1pbiA+IGxlZnRDb3VudGVyTWF4ICkgew0KICAgICAgICAgICAgICAgICAgICAvL1ZlcmlmeUFndCggImNvdW50ZXJzIG1pc21hdGNoIixpKTsNCiAgICAgICAgICAgICAgICAgICAgVmVyaWZ5QWd0KCAweDgwMDAwMDAxLCBpICk7ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmKCByaWdodENvdW50ZXJNaW4gPiByaWdodENvdW50ZXJNYXggKSB7DQogICAgICAgICAgICAgICAgICAgIC8vVmVyaWZ5QWd0KCAiY291bnRlcnMgbWlzbWF0Y2giLGkpOw0KICAgICAgICAgICAgICAgICAgICBWZXJpZnlBZ3QoIDB4ODAwMDAwMDIsIGkgKTsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiggbGVmdENvdW50ZXJNYXggPj0gcmlnaHRDb3VudGVyTWluICkgew0KICAgICAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwOSwgaSApOyAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbWluID0gbGVmdENvdW50ZXJNaW47DQogICAgICAgICAgICBtYXggPSByaWdodENvdW50ZXJNYXg7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGJyYW5jaEluZGV4ID0gYnJhbmNoSW5kZXggLyAyOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYoIG1pbiAhPSBkYXRhLnJvb3RNaW4gKSB7DQogICAgICAgICAgICAvL1ZlcmlmeUFndCggIm1pbiBkb2VzIG5vdCBtYXRjaCByb290IG1pbiIsbWluKTsNCiAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwMywgbWluICk7ICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYoIG1heCAhPSBkYXRhLnJvb3RNYXggKSB7DQogICAgICAgICAgICAvL1ZlcmlmeUFndCggIm1heCBkb2VzIG5vdCBtYXRjaCByb290IG1heCIsbWF4KTsNCiAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwNCwgbWF4ICk7ICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYoIGN1cnJlbnRIYXNoICE9IGRhdGEucm9vdEhhc2ggKSB7DQogICAgICAgICAgICAvL1ZlcmlmeUFndCggImhhc2ggZG9lcyBub3QgbWF0Y2ggcm9vdCBoYXNoIixjdXJyZW50SGFzaCk7ICAgICAgICANCiAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwNSwgY3VycmVudEhhc2ggKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHZlcmlmeUFndERlYnVnRm9yVGVzdGluZyggdWludCByb290SGFzaCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgcm9vdE1pbiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgcm9vdE1heCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGVhZkhhc2gsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxlYWZDb3VudGVyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBicmFuY2hJbmRleCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBjb3VudGVyc0JyYW5jaCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBoYXNoZXNCcmFuY2ggKSByZXR1cm5zKGJvb2wpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICBWZXJpZnlBZ3REYXRhIG1lbW9yeSBkYXRhOw0KICAgICAgICBkYXRhLnJvb3RIYXNoID0gcm9vdEhhc2g7DQogICAgICAgIGRhdGEucm9vdE1pbiA9IHJvb3RNaW47DQogICAgICAgIGRhdGEucm9vdE1heCA9IHJvb3RNYXg7DQogICAgICAgIGRhdGEubGVhZkhhc2ggPSBsZWFmSGFzaDsNCiAgICAgICAgZGF0YS5sZWFmQ291bnRlciA9IGxlYWZDb3VudGVyOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHZlcmlmeUFndCggZGF0YSwgYnJhbmNoSW5kZXgsIGNvdW50ZXJzQnJhbmNoLCBoYXNoZXNCcmFuY2ggKTsNCiAgICB9ICAgICAgICAgDQp9DQoNCmNvbnRyYWN0IFdlaWdodGVkU3VibWlzc2lvbiB7DQogICAgZnVuY3Rpb24gV2VpZ2h0ZWRTdWJtaXNzaW9uKCl7fQ0KICAgIA0KICAgIHN0cnVjdCBTaW5nbGVTdWJtaXNzaW9uRGF0YSB7DQogICAgICAgIHVpbnQxMjggbnVtU2hhcmVzOw0KICAgICAgICB1aW50MTI4IHN1Ym1pc3Npb25WYWx1ZTsNCiAgICAgICAgdWludDEyOCB0b3RhbFByZXZpb3VzU3VibWlzc2lvblZhbHVlOw0KICAgICAgICB1aW50MTI4IG1pbjsNCiAgICAgICAgdWludDEyOCBtYXg7DQogICAgICAgIHVpbnQxMjggYXVnUm9vdDsNCiAgICB9DQogICAgDQogICAgc3RydWN0IFN1Ym1pc3Npb25NZXRhRGF0YSB7DQogICAgICAgIHVpbnQ2NCAgbnVtUGVuZGluZ1N1Ym1pc3Npb25zOw0KICAgICAgICB1aW50MzIgIHJlYWR5Rm9yVmVyaWZpY2F0aW9uOyAvLyBzdXBwb3NlIHRvIGJlIGJvb2wNCiAgICAgICAgdWludDMyICBsYXN0U3VibWlzc2lvbkJsb2NrTnVtYmVyOw0KICAgICAgICB1aW50MTI4IHRvdGFsU3VibWlzc2lvblZhbHVlOw0KICAgICAgICB1aW50MTI4IGRpZmZpY3VsdHk7DQogICAgICAgIHVpbnQxMjggbGFzdENvdW50ZXI7DQogICAgICAgIA0KICAgICAgICB1aW50ICAgIHN1Ym1pc3Npb25TZWVkOw0KICAgICAgICANCiAgICB9DQogICAgDQogICAgbWFwcGluZyhhZGRyZXNzPT5TdWJtaXNzaW9uTWV0YURhdGEpIHN1Ym1pc3Npb25zTWV0YURhdGE7DQogICAgDQogICAgLy8gKHVzZXIsIHN1Ym1pc3Npb24gbnVtYmVyKT0+ZGF0YQ0KICAgIG1hcHBpbmcoYWRkcmVzcz0+bWFwcGluZyh1aW50PT5TaW5nbGVTdWJtaXNzaW9uRGF0YSkpIHN1Ym1pc3Npb25zRGF0YTsNCiAgICANCiAgICBldmVudCBTdWJtaXRDbGFpbSggYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBlcnJvciwgdWludCBlcnJvckluZm8gKTsNCiAgICBmdW5jdGlvbiBzdWJtaXRDbGFpbSggdWludCBudW1TaGFyZXMsIHVpbnQgZGlmZmljdWx0eSwgdWludCBtaW4sIHVpbnQgbWF4LCB1aW50IGF1Z1Jvb3QsIGJvb2wgbGFzdENsYWltQmVmb3JlVmVyaWZpY2F0aW9uICkgew0KICAgICAgICBTdWJtaXNzaW9uTWV0YURhdGEgbWVtb3J5IG1ldGFEYXRhID0gc3VibWlzc2lvbnNNZXRhRGF0YVttc2cuc2VuZGVyXTsNCiAgICAgICAgDQogICAgICAgIGlmKCBtZXRhRGF0YS5sYXN0Q291bnRlciA+PSBtaW4gKSB7DQogICAgICAgICAgICAvLyBtaW5lciBjaGVhdGVkLiBtaW4gY291bnRlciBpcyB0b28gbG93DQogICAgICAgICAgICBTdWJtaXRDbGFpbSggbXNnLnNlbmRlciwgMHg4MTAwMDAwMSwgbWV0YURhdGEubGFzdENvdW50ZXIgKTsgDQogICAgICAgICAgICByZXR1cm47ICAgICAgICANCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYoIG1ldGFEYXRhLnJlYWR5Rm9yVmVyaWZpY2F0aW9uID4gMCApIHsNCiAgICAgICAgICAgIC8vIG1pbmVyIGNoZWF0ZWQgLSBzaG91bGQgZ28gdmVyaWZpY2F0aW9uIGZpcnN0DQogICAgICAgICAgICBTdWJtaXRDbGFpbSggbXNnLnNlbmRlciwgMHg4MTAwMDAwMiwgMCApOyANCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYoIG1ldGFEYXRhLm51bVBlbmRpbmdTdWJtaXNzaW9ucyA+IDAgKSB7DQogICAgICAgICAgICBpZiggbWV0YURhdGEuZGlmZmljdWx0eSAhPSBkaWZmaWN1bHR5ICkgew0KICAgICAgICAgICAgICAgIC8vIGNvdWxkIG5vdCBjaGFuZ2UgZGlmZmljdWx0eSBiZWZvcmUgdmVyaWZpY2F0aW9uDQogICAgICAgICAgICAgICAgU3VibWl0Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODEwMDAwMDMsIG1ldGFEYXRhLmRpZmZpY3VsdHkgKTsgDQogICAgICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBTaW5nbGVTdWJtaXNzaW9uRGF0YSBtZW1vcnkgc3VibWlzc2lvbkRhdGE7DQogICAgICAgIA0KICAgICAgICBzdWJtaXNzaW9uRGF0YS5udW1TaGFyZXMgPSB1aW50NjQobnVtU2hhcmVzKTsNCiAgICAgICAgdWludCBibG9ja0RpZmZpY3VsdHk7DQogICAgICAgIGlmKCBibG9jay5kaWZmaWN1bHR5ID09IDAgKSB7DQogICAgICAgICAgICAvLyB0ZXN0cnBjIC0gZmFrZSBpbmNyZWFzaW5nIGRpZmZpY3VsdHkNCiAgICAgICAgICAgIGJsb2NrRGlmZmljdWx0eSA9ICg5MDAwMDAwMDAgKiAobWV0YURhdGEubnVtUGVuZGluZ1N1Ym1pc3Npb25zKzEpKTsgDQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBibG9ja0RpZmZpY3VsdHkgPSBibG9jay5kaWZmaWN1bHR5Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBzdWJtaXNzaW9uRGF0YS5zdWJtaXNzaW9uVmFsdWUgPSB1aW50MTI4KCh1aW50KG51bVNoYXJlcyAqIGRpZmZpY3VsdHkpICogKDUgZXRoZXIpKSAvIGJsb2NrRGlmZmljdWx0eSk7DQogICAgICAgIA0KICAgICAgICBzdWJtaXNzaW9uRGF0YS50b3RhbFByZXZpb3VzU3VibWlzc2lvblZhbHVlID0gbWV0YURhdGEudG90YWxTdWJtaXNzaW9uVmFsdWU7DQogICAgICAgIHN1Ym1pc3Npb25EYXRhLm1pbiA9IHVpbnQxMjgobWluKTsNCiAgICAgICAgc3VibWlzc2lvbkRhdGEubWF4ID0gdWludDEyOChtYXgpOw0KICAgICAgICBzdWJtaXNzaW9uRGF0YS5hdWdSb290ID0gdWludDEyOChhdWdSb290KTsNCiAgICAgICAgDQogICAgICAgIChzdWJtaXNzaW9uc0RhdGFbbXNnLnNlbmRlcl0pW21ldGFEYXRhLm51bVBlbmRpbmdTdWJtaXNzaW9uc10gPSBzdWJtaXNzaW9uRGF0YTsNCiAgICAgICAgDQogICAgICAgIC8vIHVwZGF0ZSBtZXRhIGRhdGENCiAgICAgICAgbWV0YURhdGEubnVtUGVuZGluZ1N1Ym1pc3Npb25zKys7DQogICAgICAgIG1ldGFEYXRhLmxhc3RTdWJtaXNzaW9uQmxvY2tOdW1iZXIgPSB1aW50MzIoYmxvY2subnVtYmVyKTsNCiAgICAgICAgbWV0YURhdGEuZGlmZmljdWx0eSA9IHVpbnQxMjgoZGlmZmljdWx0eSk7DQogICAgICAgIG1ldGFEYXRhLmxhc3RDb3VudGVyID0gdWludDEyOChtYXgpOw0KICAgICAgICBtZXRhRGF0YS5yZWFkeUZvclZlcmlmaWNhdGlvbiA9IGxhc3RDbGFpbUJlZm9yZVZlcmlmaWNhdGlvbiA/IHVpbnQzMigxKSA6IHVpbnQzMigwKTsNCg0KICAgICAgICB1aW50MTI4IHRlbXAxMjg7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgdGVtcDEyOCA9IG1ldGFEYXRhLnRvdGFsU3VibWlzc2lvblZhbHVlOyANCg0KICAgICAgICBtZXRhRGF0YS50b3RhbFN1Ym1pc3Npb25WYWx1ZSArPSBzdWJtaXNzaW9uRGF0YS5zdWJtaXNzaW9uVmFsdWU7DQogICAgICAgIA0KICAgICAgICBpZiggdGVtcDEyOCA+IG1ldGFEYXRhLnRvdGFsU3VibWlzc2lvblZhbHVlICkgew0KICAgICAgICAgICAgLy8gb3ZlcmZsb3cgaW4gY2FsY3VsYXRpb24NCiAgICAgICAgICAgIC8vIG5vdGUgdGhhdCB0aGlzIGNvZGUgaXMgcmVhY2hhYmxlIGlmIHVzZXIgaXMgZGlzaG9uZXN0IGFuZCBnaXZlIGZhbHNlDQogICAgICAgICAgICAvLyByZXBvcnQgb24gaGlzIHN1Ym1pc3Npb24uIGJ1dCBldmVuIHdpdGhvdXQNCiAgICAgICAgICAgIC8vIHRoaXMgdmFsaWRhdGlvbiwgdXNlciBjYW5ub3QgYmVuaWZpdCBmcm9tIHRoZSBvdmVyZmxvdw0KICAgICAgICAgICAgU3VibWl0Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODEwMDAwMDUsIDAgKTsgDQogICAgICAgICAgICByZXR1cm47ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICANCiAgICAgICAgc3VibWlzc2lvbnNNZXRhRGF0YVttc2cuc2VuZGVyXSA9IG1ldGFEYXRhOw0KICAgICAgICANCiAgICAgICAgLy8gZXZlcnl0aGluZyBpcyBvaw0KICAgICAgICBTdWJtaXRDbGFpbSggbXNnLnNlbmRlciwgMCwgbnVtU2hhcmVzICogZGlmZmljdWx0eSApOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldENsYWltU2VlZChhZGRyZXNzIHNlbmRlcikgY29uc3RhbnQgcmV0dXJucyh1aW50KXsNCiAgICAgICAgU3VibWlzc2lvbk1ldGFEYXRhIG1lbW9yeSBtZXRhRGF0YSA9IHN1Ym1pc3Npb25zTWV0YURhdGFbc2VuZGVyXTsNCiAgICAgICAgaWYoIG1ldGFEYXRhLnJlYWR5Rm9yVmVyaWZpY2F0aW9uID09IDAgKSByZXR1cm4gMDsNCiAgICAgICAgDQogICAgICAgIGlmKCBtZXRhRGF0YS5zdWJtaXNzaW9uU2VlZCAhPSAwICkgcmV0dXJuIG1ldGFEYXRhLnN1Ym1pc3Npb25TZWVkOyANCiAgICAgICAgDQogICAgICAgIHVpbnQgbGFzdEJsb2NrTnVtYmVyID0gdWludChtZXRhRGF0YS5sYXN0U3VibWlzc2lvbkJsb2NrTnVtYmVyKTsNCiAgICAgICAgDQogICAgICAgIGlmKCBibG9jay5udW1iZXIgPiBsYXN0QmxvY2tOdW1iZXIgKyAyMDAgKSByZXR1cm4gMDsNCiAgICAgICAgaWYoIGJsb2NrLm51bWJlciA8PSBsYXN0QmxvY2tOdW1iZXIgKyAxNSApIHJldHVybiAwOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICByZXR1cm4gdWludChibG9jay5ibG9ja2hhc2gobGFzdEJsb2NrTnVtYmVyICsgMTApKTsNCiAgICB9DQogICAgDQogICAgZXZlbnQgU3RvcmVDbGFpbVNlZWQoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7DQogICAgZnVuY3Rpb24gc3RvcmVDbGFpbVNlZWQoIGFkZHJlc3MgbWluZXIgKSB7DQogICAgICAgIC8vIGFueW9uZSB3aG8gaXMgd2lsbGluZyB0byBwYXkgZ2FzIGZlZXMgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbg0KICAgICAgICB1aW50IHNlZWQgPSBnZXRDbGFpbVNlZWQoIG1pbmVyICk7DQogICAgICAgIGlmKCBzZWVkICE9IDAgKSB7DQogICAgICAgICAgICBzdWJtaXNzaW9uc01ldGFEYXRhW21pbmVyXS5zdWJtaXNzaW9uU2VlZCA9IHNlZWQ7DQogICAgICAgICAgICBTdG9yZUNsYWltU2VlZCggbXNnLnNlbmRlciwgMCwgdWludChtaW5lcikgKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gZWxzZQ0KICAgICAgICBTdWJtaXNzaW9uTWV0YURhdGEgbWVtb3J5IG1ldGFEYXRhID0gc3VibWlzc2lvbnNNZXRhRGF0YVttaW5lcl07DQogICAgICAgIHVpbnQgbGFzdEJsb2NrTnVtYmVyID0gdWludChtZXRhRGF0YS5sYXN0U3VibWlzc2lvbkJsb2NrTnVtYmVyKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgaWYoIG1ldGFEYXRhLnJlYWR5Rm9yVmVyaWZpY2F0aW9uID09IDAgKSB7DQogICAgICAgICAgICAvLyBzdWJtaXNzaW9uIGlzIG5vdCByZWFkeSBmb3IgdmVyaWZpY2F0aW9uDQogICAgICAgICAgICBTdG9yZUNsYWltU2VlZCggbXNnLnNlbmRlciwgMHg4MDAwMDAwLCB1aW50KG1pbmVyKSApOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYoIGJsb2NrLm51bWJlciA+IGxhc3RCbG9ja051bWJlciArIDIwMCApIHsNCiAgICAgICAgICAgIC8vIHN1Ym1pc3Npb24gaXMgbm90IHJlYWR5IGZvciB2ZXJpZmljYXRpb24NCiAgICAgICAgICAgIFN0b3JlQ2xhaW1TZWVkKCBtc2cuc2VuZGVyLCAweDgwMDAwMDEsIHVpbnQobWluZXIpICk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiggYmxvY2subnVtYmVyIDw9IGxhc3RCbG9ja051bWJlciArIDE1ICkgew0KICAgICAgICAgICAgLy8gaXQgaXMgdG9vIGxhdGUgdG8gY2FsbCBzdG9yZSBmdW5jdGlvbg0KICAgICAgICAgICAgU3RvcmVDbGFpbVNlZWQoIG1zZy5zZW5kZXIsIDB4ODAwMDAwMiwgdWludChtaW5lcikgKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIHVua25vd24gZXJyb3INCiAgICAgICAgICAgIFN0b3JlQ2xhaW1TZWVkKCBtc2cuc2VuZGVyLCAweDgwMDAwMDMsIHVpbnQobWluZXIpICk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiB2ZXJpZnlTdWJtaXNzaW9uSW5kZXgoIGFkZHJlc3Mgc2VuZGVyLCB1aW50IHNlZWQsIHVpbnQgc3VibWlzc2lvbk51bWJlciwgdWludCBzaGFyZUluZGV4ICkgY29uc3RhbnQgcmV0dXJucyhib29sKSB7DQogICAgICAgIGlmKCBzZWVkID09IDAgKSByZXR1cm4gZmFsc2U7DQogICAgDQogICAgICAgIHVpbnQgdG90YWxWYWx1ZSA9IHVpbnQoc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdLnRvdGFsU3VibWlzc2lvblZhbHVlKTsNCiAgICAgICAgdWludCBudW1QZW5kaW5nU3VibWlzc2lvbnMgPSB1aW50KHN1Ym1pc3Npb25zTWV0YURhdGFbc2VuZGVyXS5udW1QZW5kaW5nU3VibWlzc2lvbnMpOw0KDQogICAgICAgIFNpbmdsZVN1Ym1pc3Npb25EYXRhIG1lbW9yeSBzdWJtaXNzaW9uRGF0YSA9IChzdWJtaXNzaW9uc0RhdGFbc2VuZGVyXSlbc3VibWlzc2lvbk51bWJlcl07ICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmKCBzdWJtaXNzaW9uTnVtYmVyID49IG51bVBlbmRpbmdTdWJtaXNzaW9ucyApIHJldHVybiBmYWxzZTsNCiAgICAgICAgDQogICAgICAgIHVpbnQgc2VlZDEgPSBzZWVkICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgdWludCBzZWVkMiA9IHNlZWQgLyAoMioqMTI4KTsNCiAgICAgICAgDQogICAgICAgIHVpbnQgc2VsZWN0ZWRWYWx1ZSA9IHNlZWQxICUgdG90YWxWYWx1ZTsNCiAgICAgICAgaWYoIHVpbnQoc3VibWlzc2lvbkRhdGEudG90YWxQcmV2aW91c1N1Ym1pc3Npb25WYWx1ZSkgPj0gc2VsZWN0ZWRWYWx1ZSApIHJldHVybiBmYWxzZTsNCiAgICAgICAgaWYoIHVpbnQoc3VibWlzc2lvbkRhdGEudG90YWxQcmV2aW91c1N1Ym1pc3Npb25WYWx1ZSArIHN1Ym1pc3Npb25EYXRhLnN1Ym1pc3Npb25WYWx1ZSkgPCBzZWxlY3RlZFZhbHVlICkgcmV0dXJuIGZhbHNlOyAgDQoNCiAgICAgICAgdWludCBleHBlY3RlZFNoYXJlc2hhcmVJbmRleCA9IChzZWVkMiAlIHVpbnQoc3VibWlzc2lvbkRhdGEubnVtU2hhcmVzKSk7DQogICAgICAgIGlmKCBleHBlY3RlZFNoYXJlc2hhcmVJbmRleCAhPSBzaGFyZUluZGV4ICkgcmV0dXJuIGZhbHNlOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVN1Ym1pc3Npb25JbmRleCggYWRkcmVzcyBzZW5kZXIsIHVpbnQgc2VlZCApIGNvbnN0YW50IHJldHVybnModWludFsyXSkgew0KICAgICAgICAvLyB0aGlzIGZ1bmN0aW9uIHNob3VsZCBiZSBleGVjdXRlZCBvZmYgY2hhaW4gLSBoZW5lLCBpdCBpcyBub3Qgb3B0aW1pemVkDQogICAgICAgIHVpbnQgc2VlZDEgPSBzZWVkICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgdWludCBzZWVkMiA9IHNlZWQgLyAoMioqMTI4KTsNCg0KICAgICAgICB1aW50IHRvdGFsVmFsdWUgPSB1aW50KHN1Ym1pc3Npb25zTWV0YURhdGFbc2VuZGVyXS50b3RhbFN1Ym1pc3Npb25WYWx1ZSk7DQogICAgICAgIHVpbnQgbnVtUGVuZGluZ1N1Ym1pc3Npb25zID0gdWludChzdWJtaXNzaW9uc01ldGFEYXRhW3NlbmRlcl0ubnVtUGVuZGluZ1N1Ym1pc3Npb25zKTsNCg0KICAgICAgICB1aW50IHNlbGVjdGVkVmFsdWUgPSBzZWVkMSAlIHRvdGFsVmFsdWU7DQogICAgICAgIA0KICAgICAgICBTaW5nbGVTdWJtaXNzaW9uRGF0YSBtZW1vcnkgc3VibWlzc2lvbkRhdGE7ICAgICAgICANCiAgICAgICAgDQogICAgICAgIGZvciggdWludCBzdWJtaXNzaW9uSW5kID0gMCA7IHN1Ym1pc3Npb25JbmQgPCBudW1QZW5kaW5nU3VibWlzc2lvbnMgOyBzdWJtaXNzaW9uSW5kKysgKSB7DQogICAgICAgICAgICBzdWJtaXNzaW9uRGF0YSA9IChzdWJtaXNzaW9uc0RhdGFbc2VuZGVyXSlbc3VibWlzc2lvbkluZF07ICAgICAgICANCiAgICAgICAgICAgIGlmKCB1aW50KHN1Ym1pc3Npb25EYXRhLnRvdGFsUHJldmlvdXNTdWJtaXNzaW9uVmFsdWUgKyBzdWJtaXNzaW9uRGF0YS5zdWJtaXNzaW9uVmFsdWUpID49IHNlbGVjdGVkVmFsdWUgKSBicmVhazsgIA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyB1bmV4cGVjdGVkIGVycm9yDQogICAgICAgIGlmKCBzdWJtaXNzaW9uSW5kID09IG51bVBlbmRpbmdTdWJtaXNzaW9ucyApIHJldHVybiBbdWludCgweEZGRkZGRkZGRkZGRkZGRkYpLDB4RkZGRkZGRkZGRkZGRkZGRl07DQoNCiAgICAgICAgdWludCBzaGFyZUluZGV4ID0gc2VlZDIgJSB1aW50KHN1Ym1pc3Npb25EYXRhLm51bVNoYXJlcyk7IA0KICAgICAgICANCiAgICAgICAgcmV0dXJuIFtzdWJtaXNzaW9uSW5kLCBzaGFyZUluZGV4XTsNCiAgICB9DQogICAgDQogICAgLy8gc2hvdWxkIGJlIGNhbGxlZCBvbmx5IGZyb20gdmVyaWZ5IGNsYWltDQogICAgZnVuY3Rpb24gY2xvc2VTdWJtaXNzaW9uKCBhZGRyZXNzIHNlbmRlciApIGludGVybmFsIHsNCiAgICAgICAgU3VibWlzc2lvbk1ldGFEYXRhIG1lbW9yeSBtZXRhRGF0YSA9IHN1Ym1pc3Npb25zTWV0YURhdGFbc2VuZGVyXTsNCiAgICAgICAgbWV0YURhdGEubnVtUGVuZGluZ1N1Ym1pc3Npb25zID0gMDsNCiAgICAgICAgbWV0YURhdGEudG90YWxTdWJtaXNzaW9uVmFsdWUgPSAwOw0KICAgICAgICBtZXRhRGF0YS5yZWFkeUZvclZlcmlmaWNhdGlvbiA9IDA7DQogICAgICAgIG1ldGFEYXRhLnN1Ym1pc3Npb25TZWVkID0gMDsNCiAgICAgICAgDQogICAgICAgIC8vIGxhc3QgY291bnRlciBtdXN0IG5vdCBiZSByZXNldA0KICAgICAgICAvLyBsYXN0IHN1Ym1pc3Npb24gYmxvY2sgbnVtYmVyIGFuZCBkaWZmaWN1bHR5IGFyZSBhbHNvIGtlcHQsIGJ1dCBpdCBpcyBub3QgYSBtdXN0DQogICAgICAgIC8vIG9ubHkgdG8gc2F2ZSBzb21lIGdhcyAgICAgICAgDQogICAgICAgIA0KICAgICAgICBzdWJtaXNzaW9uc01ldGFEYXRhW3NlbmRlcl0gPSBtZXRhRGF0YTsNCiAgICB9DQogICAgDQogICAgc3RydWN0IFN1Ym1pc3Npb25EYXRhRm9yQ2xhaW1WZXJpZmljYXRpb24gew0KICAgICAgICB1aW50IGxhc3RDb3VudGVyOw0KICAgICAgICB1aW50IHNoYXJlRGlmZmljdWx0eTsNCiAgICAgICAgdWludCB0b3RhbFN1Ym1pc3Npb25WYWx1ZTsNCiAgICAgICAgdWludCBtaW47DQogICAgICAgIHVpbnQgbWF4Ow0KICAgICAgICB1aW50IGF1Z01lcmtsZTsNCiAgICAgICAgDQogICAgICAgIGJvb2wgaW5kaWNlc0FyZVZhbGlkOw0KICAgICAgICBib29sIHJlYWR5Rm9yVmVyaWZpY2F0aW9uOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBnZXRDbGFpbURhdGEoIGFkZHJlc3Mgc2VuZGVyLCB1aW50IHN1Ym1pc3Npb25JbmRleCwgdWludCBzaGFyZUluZGV4LCB1aW50IHNlZWQgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhTdWJtaXNzaW9uRGF0YUZvckNsYWltVmVyaWZpY2F0aW9uKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICBTdWJtaXNzaW9uRGF0YUZvckNsYWltVmVyaWZpY2F0aW9uIG1lbW9yeSBvdXRwdXQ7DQoNCiAgICAgICAgU3VibWlzc2lvbk1ldGFEYXRhIG1lbW9yeSBtZXRhRGF0YSA9IHN1Ym1pc3Npb25zTWV0YURhdGFbc2VuZGVyXTsNCiAgICAgICAgDQogICAgICAgIG91dHB1dC5sYXN0Q291bnRlciA9IHVpbnQobWV0YURhdGEubGFzdENvdW50ZXIpOw0KICAgICAgICBvdXRwdXQuc2hhcmVEaWZmaWN1bHR5ID0gdWludChtZXRhRGF0YS5kaWZmaWN1bHR5KTsNCiAgICAgICAgb3V0cHV0LnRvdGFsU3VibWlzc2lvblZhbHVlID0gbWV0YURhdGEudG90YWxTdWJtaXNzaW9uVmFsdWU7DQogICAgICAgIA0KDQogICAgICAgIFNpbmdsZVN1Ym1pc3Npb25EYXRhIG1lbW9yeSBzdWJtaXNzaW9uRGF0YSA9IChzdWJtaXNzaW9uc0RhdGFbc2VuZGVyXSlbc3VibWlzc2lvbkluZGV4XTsNCiAgICAgICAgDQogICAgICAgIG91dHB1dC5taW4gPSB1aW50KHN1Ym1pc3Npb25EYXRhLm1pbik7DQogICAgICAgIG91dHB1dC5tYXggPSB1aW50KHN1Ym1pc3Npb25EYXRhLm1heCk7DQogICAgICAgIG91dHB1dC5hdWdNZXJrbGUgPSB1aW50KHN1Ym1pc3Npb25EYXRhLmF1Z1Jvb3QpOw0KICAgICAgICANCiAgICAgICAgb3V0cHV0LmluZGljZXNBcmVWYWxpZCA9IHZlcmlmeVN1Ym1pc3Npb25JbmRleCggc2VuZGVyLCBzZWVkLCBzdWJtaXNzaW9uSW5kZXgsIHNoYXJlSW5kZXggKTsNCiAgICAgICAgb3V0cHV0LnJlYWR5Rm9yVmVyaWZpY2F0aW9uID0gKG1ldGFEYXRhLnJlYWR5Rm9yVmVyaWZpY2F0aW9uID4gMCk7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gb3V0cHV0OyANCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gZGVidWdHZXROdW1QZW5kaW5nU3VibWlzc2lvbnMoIGFkZHJlc3Mgc2VuZGVyICkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7DQogICAgICAgIHJldHVybiB1aW50KHN1Ym1pc3Npb25zTWV0YURhdGFbc2VuZGVyXS5udW1QZW5kaW5nU3VibWlzc2lvbnMpOw0KICAgIH0NCiAgICANCiAgICBldmVudCBEZWJ1Z1Jlc2V0U3VibWlzc2lvbnMoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7DQogICAgZnVuY3Rpb24gZGVidWdSZXNldFN1Ym1pc3Npb25zKCApIHsNCiAgICAgICAgLy8gc2hvdWxkIGJlIGNhbGxlZCBvbmx5IGluIGVtZXJnZW5jeQ0KICAgICAgICAvLyBtc2cuc2VuZGVyIHdpbGwgbG9vc2UgYWxsIGl0cyBwZW5kaW5nIHNoYXJlcw0KICAgICAgICBjbG9zZVN1Ym1pc3Npb24obXNnLnNlbmRlcik7DQogICAgICAgIERlYnVnUmVzZXRTdWJtaXNzaW9ucyggbXNnLnNlbmRlciwgMCwgMCApOw0KICAgIH0gICAgDQp9DQoNCg0KY29udHJhY3QgU21hcnRQb29sIGlzIEFndCwgV2VpZ2h0ZWRTdWJtaXNzaW9uIHsgICAgDQogICAgc3RyaW5nICBwdWJsaWMgdmVyc2lvbiA9ICIwLjEuMSI7DQogICAgDQogICAgRXRoYXNoICBwdWJsaWMgZXRoYXNoQ29udHJhY3Q7IA0KICAgIGFkZHJlc3MgcHVibGljIHdpdGhkcmF3YWxBZGRyZXNzOw0KICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgcHVibGljIG93bmVyczsgDQogICAgDQogICAgYm9vbCBwdWJsaWMgbmV3VmVyc2lvblJlbGVhc2VkID0gZmFsc2U7DQogICAgICAgIA0KICAgIHN0cnVjdCBNaW5lckRhdGEgew0KICAgICAgICBieXRlczMyICAgICAgICBtaW5lcklkOw0KICAgICAgICBhZGRyZXNzICAgICAgICBwYXltZW50QWRkcmVzczsNCiAgICB9DQoNCiAgICBtYXBwaW5nKGFkZHJlc3M9Pk1pbmVyRGF0YSkgbWluZXJzRGF0YTsNCiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJvb2wpICAgICAgcHVibGljIGV4aXN0aW5nSWRzOyAgICAgICAgDQogICAgDQogICAgYm9vbCBwdWJsaWMgd2hpdGVMaXN0RW5hYmxlZDsNCiAgICBib29sIHB1YmxpYyBibGFja0xpc3RFbmFibGVkOw0KICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgd2hpdGVMaXN0Ow0KICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgYmxhY2tMaXN0OyAgICANCiAgICANCiAgICBmdW5jdGlvbiBTbWFydFBvb2woIGFkZHJlc3NbXSBfb3duZXJzLA0KICAgICAgICAgICAgICAgICAgICAgICAgRXRoYXNoIF9ldGhhc2hDb250cmFjdCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX3dpdGhkcmF3YWxBZGRyZXNzLA0KICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBfd2hpdGVMaXN0RW5hYmVsZWQsDQogICAgICAgICAgICAgICAgICAgICAgICBib29sIF9ibGFja0xpc3RFbmFibGVkICkgcGF5YWJsZSB7DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgZm9yKCB1aW50IGkgPSAwIDsgaSA8IF9vd25lcnMubGVuZ3RoIDsgaSsrICkgew0KICAgICAgICAgICAgb3duZXJzW19vd25lcnNbMF1dID0gdHJ1ZTsgDQogICAgICAgICAgICBvd25lcnNbX293bmVyc1sxXV0gPSB0cnVlOw0KICAgICAgICAgICAgb3duZXJzW19vd25lcnNbMl1dID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZXRoYXNoQ29udHJhY3QgPSBfZXRoYXNoQ29udHJhY3Q7DQogICAgICAgIHdpdGhkcmF3YWxBZGRyZXNzID0gX3dpdGhkcmF3YWxBZGRyZXNzOw0KICAgICAgICANCiAgICAgICAgd2hpdGVMaXN0RW5hYmxlZCA9IF93aGl0ZUxpc3RFbmFiZWxlZDsNCiAgICAgICAgYmxhY2tMaXN0RW5hYmxlZCA9IF9ibGFja0xpc3RFbmFibGVkOyAgICAgICAgICAgICAgIA0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBkZWNsYXJlTmV3ZXJWZXJzaW9uKCkgew0KICAgICAgICBpZiggISBvd25lcnNbbXNnLnNlbmRlcl0gKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIG5ld1ZlcnNpb25SZWxlYXNlZCA9IHRydWU7DQogICAgICAgIA0KICAgICAgICAvL2lmKCAhIG1zZy5zZW5kZXIuc2VuZCh0aGlzLmJhbGFuY2UpICkgdGhyb3c7DQogICAgfQ0KICAgIA0KICAgIGV2ZW50IFdpdGhkcmF3KCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbyApOw0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCB1aW50IGFtb3VudCApIHsNCiAgICAgICAgaWYoICEgb3duZXJzW21zZy5zZW5kZXJdICkgew0KICAgICAgICAgICAgLy8gb25seSBvd25kZXIgY2FuIHdpdGhkcmF3DQogICAgICAgICAgICBXaXRoZHJhdyggbXNnLnNlbmRlciwgMHg4MDAwMDAwMCwgYW1vdW50ICk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKCAhIHdpdGhkcmF3YWxBZGRyZXNzLnNlbmQoIGFtb3VudCApICkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICBXaXRoZHJhdyggbXNnLnNlbmRlciwgMCwgYW1vdW50ICk7ICAgICAgICAgICAgDQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHRvNjJFbmNvZGluZyggdWludCBpZCwgdWludCBudW1DaGFycyApIGNvbnN0YW50IHJldHVybnMoYnl0ZXMzMikgew0KICAgICAgICBpZiggaWQgPj0gKDI2KzI2KzEwKSoqbnVtQ2hhcnMgKSB0aHJvdzsNCiAgICAgICAgdWludCByZXN1bHQgPSAwOw0KICAgICAgICBmb3IoIHVpbnQgaSA9IDAgOyBpIDwgbnVtQ2hhcnMgOyBpKysgKSB7DQogICAgICAgICAgICB1aW50IGIgPSBpZCAlICgyNisyNisxMCk7DQogICAgICAgICAgICB1aW50OCBjaGFyOw0KICAgICAgICAgICAgaWYoIGIgPCAxMCApIHsNCiAgICAgICAgICAgICAgICBjaGFyID0gdWludDgoYiArIDB4MzApOyAvLyAweDMwID0gJzAnIA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiggYiA8IDI2ICsgMTAgKSB7DQogICAgICAgICAgICAgICAgY2hhciA9IHVpbnQ4KGIgKyAweDYxIC0gMTApOyAvLzB4NjEgPSAnYScNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNoYXIgPSB1aW50OChiICsgMHg0MSAtIDI2IC0gMTApOyAvLyAweDQxID0gJ0EnICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgKiAyNTYpICsgY2hhcjsNCiAgICAgICAgICAgIGlkIC89ICgyNisyNisxMCk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gYnl0ZXMzMihyZXN1bHQpOw0KICAgIH0NCiAgICAgICAgDQogICAgZXZlbnQgUmVnaXN0ZXIoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7ICAgIA0KICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKCBhZGRyZXNzIHBheW1lbnRBZGRyZXNzICkgew0KICAgICAgICBhZGRyZXNzIG1pbmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7DQogICAgICAgIA0KICAgICAgICAvLyBidWlsZCBpZA0KICAgICAgICB1aW50IGlkID0gdWludChtaW5lckFkZHJlc3MpICUgKDI2KzI2KzEwKSoqMTE7ICAgICAgICANCiAgICAgICAgYnl0ZXMzMiBtaW5lcklkID0gdG82MkVuY29kaW5nKGlkLDExKTsNCiAgICAgICAgDQogICAgICAgIGlmKCBleGlzdGluZ0lkc1ttaW5lcnNEYXRhW21pbmVyQWRkcmVzc10ubWluZXJJZF0gKSB7DQogICAgICAgICAgICAvLyBtaW5lciBpZCBpcyBhbHJlYWR5IGluIHVzZQ0KICAgICAgICAgICAgUmVnaXN0ZXIoIG1zZy5zZW5kZXIsIDB4ODAwMDAwMDAsIHVpbnQobWluZXJJZCkgKTsgDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKCBwYXltZW50QWRkcmVzcyA9PSBhZGRyZXNzKDApICkgew0KICAgICAgICAgICAgLy8gcGF5bWVudCBhZGRyZXNzIGlzIDANCiAgICAgICAgICAgIFJlZ2lzdGVyKCBtc2cuc2VuZGVyLCAweDgwMDAwMDAxLCB1aW50KHBheW1lbnRBZGRyZXNzKSApOyANCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYoIHdoaXRlTGlzdEVuYWJsZWQgKSB7DQogICAgICAgICAgICBpZiggISB3aGl0ZUxpc3RbIG1zZy5zZW5kZXIgXSApIHsNCiAgICAgICAgICAgICAgICAvLyBtaW5lciBub3QgaW4gd2hpdGUgbGlzdA0KICAgICAgICAgICAgICAgIFJlZ2lzdGVyKCBtc2cuc2VuZGVyLCAweDgwMDAwMDAyLCB1aW50KG1pbmVySWQpICk7DQogICAgICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKCBibGFja0xpc3RFbmFibGVkICkgew0KICAgICAgICAgICAgaWYoIGJsYWNrTGlzdFsgbXNnLnNlbmRlciBdICkgew0KICAgICAgICAgICAgICAgIC8vIG1pbmVyIG9uIGJsYWNrIGxpc3QNCiAgICAgICAgICAgICAgICBSZWdpc3RlciggbXNnLnNlbmRlciwgMHg4MDAwMDAwMywgdWludChtaW5lcklkKSApOw0KICAgICAgICAgICAgICAgIHJldHVybjsgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgfSAgICAgICAgDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gbGFzdCBjb3VudGVyIGlzIHNldCB0byAwLiANCiAgICAgICAgLy8gSXQgbWlnaHQgYmUgc2FmZXIgdG8gY2hhbmdlIGl0IHRvIG5vdy4NCiAgICAgICAgLy9taW5lcnNEYXRhW21pbmVyQWRkcmVzc10ubGFzdENvdW50ZXIgPSBub3cgKiAoMioqNjQpOw0KICAgICAgICBtaW5lcnNEYXRhW21pbmVyQWRkcmVzc10ucGF5bWVudEFkZHJlc3MgPSBwYXltZW50QWRkcmVzczsgICAgICAgIA0KICAgICAgICBtaW5lcnNEYXRhW21pbmVyQWRkcmVzc10ubWluZXJJZCA9IG1pbmVySWQ7DQogICAgICAgIGV4aXN0aW5nSWRzW21pbmVyc0RhdGFbbWluZXJBZGRyZXNzXS5taW5lcklkXSA9IHRydWU7DQogICAgICAgIA0KICAgICAgICAvLyBzdWNjZXNmdWwgcmVnaXN0cmF0aW9uDQogICAgICAgIFJlZ2lzdGVyKCBtc2cuc2VuZGVyLCAwLCAwICk7IA0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNhblJlZ2lzdGVyKGFkZHJlc3Mgc2VuZGVyKSBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsNCiAgICAgICAgdWludCBpZCA9IHVpbnQoc2VuZGVyKSAlICgyNisyNisxMCkqKjExOw0KICAgICAgICBieXRlczMyIGV4cGVjdGVkSWQgPSB0bzYyRW5jb2RpbmcoaWQsMTEpOw0KICAgICAgICANCiAgICAgICAgaWYoIHdoaXRlTGlzdEVuYWJsZWQgKSB7DQogICAgICAgICAgICBpZiggISB3aGl0ZUxpc3RbIHNlbmRlciBdICkgcmV0dXJuIGZhbHNlOyANCiAgICAgICAgfQ0KICAgICAgICBpZiggYmxhY2tMaXN0RW5hYmxlZCApIHsNCiAgICAgICAgICAgIGlmKCBibGFja0xpc3RbIHNlbmRlciBdICkgcmV0dXJuIGZhbHNlOyAgICAgICAgDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHJldHVybiAhIGV4aXN0aW5nSWRzW2V4cGVjdGVkSWRdOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBpc1JlZ2lzdGVyZWQoYWRkcmVzcyBzZW5kZXIpIGNvbnN0YW50IHJldHVybnMoYm9vbCkgew0KICAgICAgICByZXR1cm4gbWluZXJzRGF0YVtzZW5kZXJdLnBheW1lbnRBZGRyZXNzICE9IGFkZHJlc3MoMCk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGdldE1pbmVySWQoYWRkcmVzcyBzZW5kZXIpIGNvbnN0YW50IHJldHVybnMoYnl0ZXMzMikgew0KICAgICAgICByZXR1cm4gbWluZXJzRGF0YVtzZW5kZXJdLm1pbmVySWQ7DQogICAgfQ0KDQogICAgZXZlbnQgVXBkYXRlV2hpdGVMaXN0KCBhZGRyZXNzIGluZGV4ZWQgbWluZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvLCBib29sIGFkZCApOw0KICAgIGV2ZW50IFVwZGF0ZUJsYWNrTGlzdCggYWRkcmVzcyBpbmRleGVkIG1pbmVyLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbywgYm9vbCBhZGQgKTsgICAgDQoNCiAgICBmdW5jdGlvbiB1blJlZ2lzdGVyKCBhZGRyZXNzIG1pbmVyICkgaW50ZXJuYWwgew0KICAgICAgICBtaW5lcnNEYXRhW21pbmVyXS5wYXltZW50QWRkcmVzcyA9IGFkZHJlc3MoMCk7DQogICAgICAgIGV4aXN0aW5nSWRzW21pbmVyc0RhdGFbbWluZXJdLm1pbmVySWRdID0gZmFsc2U7ICAgICAgICAgICAgDQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHVwZGF0ZVdoaXRlTGlzdCggYWRkcmVzcyBtaW5lciwgYm9vbCBhZGQgKSB7DQogICAgICAgIGlmKCAhIG93bmVyc1sgbXNnLnNlbmRlciBdICkgew0KICAgICAgICAgICAgLy8gb25seSBvd25lciBjYW4gdXBkYXRlIGxpc3QNCiAgICAgICAgICAgIFVwZGF0ZVdoaXRlTGlzdCggbXNnLnNlbmRlciwgMHg4MDAwMDAwMCwgMCwgYWRkICk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYoICEgd2hpdGVMaXN0RW5hYmxlZCApIHsNCiAgICAgICAgICAgIC8vIHdoaXRlIGxpc3QgaXMgbm90IGVuYWJlbGVkDQogICAgICAgICAgICBVcGRhdGVXaGl0ZUxpc3QoIG1zZy5zZW5kZXIsIDB4ODAwMDAwMDEsIDAsIGFkZCApOyAgICAgICAgDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHdoaXRlTGlzdFsgbWluZXIgXSA9IGFkZDsNCiAgICAgICAgaWYoICEgYWRkICYmIGlzUmVnaXN0ZXJlZCggbWluZXIgKSApIHsNCiAgICAgICAgICAgIC8vIHVucmVnaXN0ZXINCiAgICAgICAgICAgIHVuUmVnaXN0ZXIoIG1pbmVyICk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIFVwZGF0ZVdoaXRlTGlzdCggbXNnLnNlbmRlciwgMCwgdWludChtaW5lciksIGFkZCApOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHVwZGF0ZUJsYWNrTGlzdCggYWRkcmVzcyBtaW5lciwgYm9vbCBhZGQgKSB7DQogICAgICAgIGlmKCAhIG93bmVyc1sgbXNnLnNlbmRlciBdICkgew0KICAgICAgICAgICAgLy8gb25seSBvd25lciBjYW4gdXBkYXRlIGxpc3QNCiAgICAgICAgICAgIFVwZGF0ZUJsYWNrTGlzdCggbXNnLnNlbmRlciwgMHg4MDAwMDAwMCwgMCwgYWRkICk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYoICEgYmxhY2tMaXN0RW5hYmxlZCApIHsNCiAgICAgICAgICAgIC8vIHdoaXRlIGxpc3QgaXMgbm90IGVuYWJlbGVkDQogICAgICAgICAgICBVcGRhdGVCbGFja0xpc3QoIG1zZy5zZW5kZXIsIDB4ODAwMDAwMDEsIDAsIGFkZCApOyAgICAgICAgDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGJsYWNrTGlzdFsgbWluZXIgXSA9IGFkZDsNCiAgICAgICAgaWYoIGFkZCAmJiBpc1JlZ2lzdGVyZWQoIG1pbmVyICkgKSB7DQogICAgICAgICAgICAvLyB1bnJlZ2lzdGVyDQogICAgICAgICAgICB1blJlZ2lzdGVyKCBtaW5lciApOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBVcGRhdGVCbGFja0xpc3QoIG1zZy5zZW5kZXIsIDAsIHVpbnQobWluZXIpLCBhZGQgKTsNCiAgICB9DQogICAgDQogICAgZXZlbnQgRGlzYWJsZUJsYWNrTGlzdEZvcmV2ZXIoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7ICAgIA0KICAgIGZ1bmN0aW9uIGRpc2FibGVCbGFja0xpc3RGb3JldmVyKCkgew0KICAgICAgICBpZiggISBvd25lcnNbIG1zZy5zZW5kZXIgXSApIHsNCiAgICAgICAgICAgIC8vIG9ubHkgb3duZXIgY2FuIHVwZGF0ZSBsaXN0DQogICAgICAgICAgICBEaXNhYmxlQmxhY2tMaXN0Rm9yZXZlciggbXNnLnNlbmRlciwgMHg4MDAwMDAwMCwgMCApOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBibGFja0xpc3RFbmFibGVkID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICBEaXNhYmxlQmxhY2tMaXN0Rm9yZXZlciggbXNnLnNlbmRlciwgMCwgMCApOyAgICAgICAgDQogICAgfQ0KDQogICAgZXZlbnQgRGlzYWJsZVdoaXRlTGlzdEZvcmV2ZXIoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7DQogICAgZnVuY3Rpb24gZGlzYWJsZVdoaXRlTGlzdEZvcmV2ZXIoKSB7DQogICAgICAgIGlmKCAhIG93bmVyc1sgbXNnLnNlbmRlciBdICkgew0KICAgICAgICAgICAgLy8gb25seSBvd25lciBjYW4gdXBkYXRlIGxpc3QNCiAgICAgICAgICAgIERpc2FibGVXaGl0ZUxpc3RGb3JldmVyKCBtc2cuc2VuZGVyLCAweDgwMDAwMDAwLCAwICk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHdoaXRlTGlzdEVuYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgIERpc2FibGVXaGl0ZUxpc3RGb3JldmVyKCBtc2cuc2VuZGVyLCAwLCAwICk7ICAgICAgICAgICAgDQogICAgfQ0KICAgIA0KICAgIGV2ZW50IFZlcmlmeUV4dHJhRGF0YSggYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBlcnJvciwgdWludCBlcnJvckluZm8gKTsgICAgDQogICAgZnVuY3Rpb24gdmVyaWZ5RXh0cmFEYXRhKCBieXRlczMyIGV4dHJhRGF0YSwgYnl0ZXMzMiBtaW5lcklkLCB1aW50IGRpZmZpY3VsdHkgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsNCiAgICAgICAgdWludCBpOw0KICAgICAgICAvLyBjb21wYXJlIGlkDQogICAgICAgIGZvciggaSA9IDAgOyBpIDwgMTEgOyBpKysgKSB7DQogICAgICAgICAgICBpZiggZXh0cmFEYXRhWzEwK2ldICE9IG1pbmVySWRbMjEraV0gKSB7DQogICAgICAgICAgICAgICAgLy9FcnJvckxvZyggInZlcmlmeUV4dHJhRGF0YTogbWluZXIgaWQgbm90IGFzIGV4cGVjdGVkIiwgMCApOw0KICAgICAgICAgICAgICAgIFZlcmlmeUV4dHJhRGF0YSggbXNnLnNlbmRlciwgMHg4MzAwMDAwMCwgdWludChtaW5lcklkKSApOyAgICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gY29tcGFyZSBkaWZmaWN1bHR5DQogICAgICAgIGJ5dGVzMzIgZW5jb2RlZERpZmYgPSB0bzYyRW5jb2RpbmcoZGlmZmljdWx0eSwxMSk7DQogICAgICAgIGZvciggaSA9IDAgOyBpIDwgMTEgOyBpKysgKSB7DQogICAgICAgICAgICBpZihleHRyYURhdGFbaSsyMV0gIT0gZW5jb2RlZERpZmZbMjEraV0pIHsNCiAgICAgICAgICAgICAgICAvL0Vycm9yTG9nKCAidmVyaWZ5RXh0cmFEYXRhOiBkaWZmaWN1bHR5IGlzIG5vdCBhcyBleHBlY3RlZCIsIHVpbnQoZW5jb2RlZERpZmYpICk7DQogICAgICAgICAgICAgICAgVmVyaWZ5RXh0cmFEYXRhKCBtc2cuc2VuZGVyLCAweDgzMDAwMDAxLCB1aW50KGVuY29kZWREaWZmKSApOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgICAgICAgICAgICANCiAgICAgICAgICAgIH0gIA0KICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgIHJldHVybiB0cnVlOyAgICAgICAgICAgIA0KICAgIH0gICAgDQogICAgDQogICAgZXZlbnQgVmVyaWZ5Q2xhaW0oIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7DQogICAgDQogICAgICAgIA0KICAgIGZ1bmN0aW9uIHZlcmlmeUNsYWltKCBieXRlcyBybHBIZWFkZXIsDQogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgIG5vbmNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50ICBzdWJtaXNzaW9uSW5kZXgsDQogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgIHNoYXJlSW5kZXgsDQogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBkYXRhU2V0TG9va3VwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gd2l0bmVzc0Zvckxvb2t1cCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIGF1Z0NvdW50ZXJzQnJhbmNoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gYXVnSGFzaGVzQnJhbmNoICkgew0KDQogICAgICAgIGlmKCAhIGlzUmVnaXN0ZXJlZChtc2cuc2VuZGVyKSApIHsNCiAgICAgICAgICAgIC8vIG1pbmVyIGlzIG5vdCByZWdpc3RlcmVkDQogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwYywgMCApOw0KICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgIA0KICAgICAgICB9DQoNCiAgICAgICAgU3VibWlzc2lvbkRhdGFGb3JDbGFpbVZlcmlmaWNhdGlvbiBtZW1vcnkgc3VibWlzc2lvbkRhdGEgPSBnZXRDbGFpbURhdGEoIG1zZy5zZW5kZXIsDQogICAgICAgICAgICBzdWJtaXNzaW9uSW5kZXgsIHNoYXJlSW5kZXgsIGdldENsYWltU2VlZCggbXNnLnNlbmRlciApICk7IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIGlmKCAhIHN1Ym1pc3Npb25EYXRhLnJlYWR5Rm9yVmVyaWZpY2F0aW9uICkgew0KICAgICAgICAgICAgLy9FcnJvckxvZyggInRoZXJlIGFyZSBubyBwZW5kaW5nIGNsYWltcyIsIDAgKTsNCiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDAzLCAwICk7ICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIEJsb2NrSGVhZGVyIG1lbW9yeSBoZWFkZXIgPSBwYXJzZUJsb2NrSGVhZGVyKHJscEhlYWRlcik7DQoNCiAgICAgICAgLy8gY2hlY2sgZXh0cmEgZGF0YQ0KICAgICAgICBpZiggISB2ZXJpZnlFeHRyYURhdGEoIGhlYWRlci5leHRyYURhdGEsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluZXJzRGF0YVsgbXNnLnNlbmRlciBdLm1pbmVySWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VibWlzc2lvbkRhdGEuc2hhcmVEaWZmaWN1bHR5ICkgKSB7DQogICAgICAgICAgICAvL0Vycm9yTG9nKCAiZXh0cmEgZGF0YSBub3QgYXMgZXhwZWN0ZWQiLCB1aW50KGhlYWRlci5leHRyYURhdGEpICk7DQogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwNCwgdWludChoZWFkZXIuZXh0cmFEYXRhKSApOyAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gY2hlY2sgY29pbmJhc2UgZGF0YQ0KICAgICAgICBpZiggaGVhZGVyLmNvaW5iYXNlICE9IHVpbnQodGhpcykgKSB7DQogICAgICAgICAgICAvL0Vycm9yTG9nKCAiY29pbmJhc2Ugbm90IGFzIGV4cGVjdGVkIiwgdWludChoZWFkZXIuY29pbmJhc2UpICk7DQogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwNSwgdWludChoZWFkZXIuY29pbmJhc2UpICk7ICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gY2hlY2sgY291bnRlcg0KICAgICAgICB1aW50IGNvdW50ZXIgPSBoZWFkZXIudGltZXN0YW1wICogKDIgKiogNjQpICsgbm9uY2U7DQogICAgICAgIGlmKCBjb3VudGVyIDwgc3VibWlzc2lvbkRhdGEubWluICkgew0KICAgICAgICAgICAgLy9FcnJvckxvZyggImNvdW50ZXIgaXMgc21hbGxlciB0aGFuIG1pbiIsY291bnRlcik7DQogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwNywgY291bnRlciApOyAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgfQ0KICAgICAgICBpZiggY291bnRlciA+IHN1Ym1pc3Npb25EYXRhLm1heCApIHsNCiAgICAgICAgICAgIC8vRXJyb3JMb2coICJjb3VudGVyIGlzIHNtYWxsZXIgdGhhbiBtYXgiLGNvdW50ZXIpOw0KICAgICAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODQwMDAwMDgsIGNvdW50ZXIgKTsgICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybjsgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIHZlcmlmeSBhZ3QNCiAgICAgICAgdWludCBsZWFmSGFzaCA9IHVpbnQoc2hhMyhybHBIZWFkZXIpKTsNCiAgICAgICAgVmVyaWZ5QWd0RGF0YSBtZW1vcnkgYWd0RGF0YTsNCiAgICAgICAgYWd0RGF0YS5yb290SGFzaCA9IHN1Ym1pc3Npb25EYXRhLmF1Z01lcmtsZTsNCiAgICAgICAgYWd0RGF0YS5yb290TWluID0gc3VibWlzc2lvbkRhdGEubWluOw0KICAgICAgICBhZ3REYXRhLnJvb3RNYXggPSBzdWJtaXNzaW9uRGF0YS5tYXg7DQogICAgICAgIGFndERhdGEubGVhZkhhc2ggPSBsZWFmSGFzaDsNCiAgICAgICAgYWd0RGF0YS5sZWFmQ291bnRlciA9IGNvdW50ZXI7DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgaWYoICEgdmVyaWZ5QWd0KCBhZ3REYXRhLA0KICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlSW5kZXgsDQogICAgICAgICAgICAgICAgICAgICAgICAgYXVnQ291bnRlcnNCcmFuY2gsDQogICAgICAgICAgICAgICAgICAgICAgICAgYXVnSGFzaGVzQnJhbmNoICkgKSB7DQogICAgICAgICAgICAvL0Vycm9yTG9nKCAidmVyaWZ5QWd0IGZhaWxlZCIsMCk7DQogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwOSwgMCApOyAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICANCiAgICAgICAgLyoNCiAgICAgICAgLy8gY2hlY2sgZXBvY2ggZGF0YSAtIGRvbmUgaW5zaWRlIGhhc2hpbW90bw0KICAgICAgICBpZiggISBldGhhc2hDb250cmFjdC5pc0Vwb2NoRGF0YVNldCggaGVhZGVyLmJsb2NrTnVtYmVyIC8gMzAwMDAgKSApIHsNCiAgICAgICAgICAgIC8vRXJyb3JMb2coICJlcG9jaCBkYXRhIHdhcyBub3Qgc2V0IixoZWFkZXIuYmxvY2tOdW1iZXIgLyAzMDAwMCk7DQogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwYSwgaGVhZGVyLmJsb2NrTnVtYmVyIC8gMzAwMDAgKTsgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybjsgICAgICAgIA0KICAgICAgICB9Ki8NCg0KDQogICAgICAgIC8vIHZlcmlmeSBldGhhc2gNCiAgICAgICAgdWludCBldGhhc2ggPSBldGhhc2hDb250cmFjdC5oYXNoaW1vdG8oIGJ5dGVzMzIobGVhZkhhc2gpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZXM4KG5vbmNlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTZXRMb29rdXAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRuZXNzRm9yTG9va3VwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyLmJsb2NrTnVtYmVyIC8gMzAwMDAgKTsNCiAgICAgICAgaWYoIGV0aGFzaCA+ICgoMioqMjU2LTEpL3N1Ym1pc3Npb25EYXRhLnNoYXJlRGlmZmljdWx0eSApKSB7DQogICAgICAgICAgICBpZiggZXRoYXNoID09IDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRSApIHsNCiAgICAgICAgICAgICAgICAvL0Vycm9yTG9nKCAiZXBvY2ggZGF0YSB3YXMgbm90IHNldCIsaGVhZGVyLmJsb2NrTnVtYmVyIC8gMzAwMDApOw0KICAgICAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDBhLCBoZWFkZXIuYmxvY2tOdW1iZXIgLyAzMDAwMCApOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vRXJyb3JMb2coICJldGhhc2ggZGlmZmljdWx0eSB0b28gbG93IixldGhhc2gpOw0KICAgICAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDBiLCBldGhhc2ggKTsNCiAgICAgICAgICAgIH0gICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybjsgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiggZ2V0Q2xhaW1TZWVkKG1zZy5zZW5kZXIpID09IDAgKSB7DQogICAgICAgICAgICAvL0Vycm9yTG9nKCAiY2xhaW0gc2VlZCBpcyAwIiwgMCApOw0KICAgICAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODQwMDAwMDEsIDAgKTsNCiAgICAgICAgICAgIHJldHVybjsgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiggISBzdWJtaXNzaW9uRGF0YS5pbmRpY2VzQXJlVmFsaWQgKSB7DQogICAgICAgICAgICAvL0Vycm9yTG9nKCAic2hhcmUgaW5kZXggb3Igc3VibWlzc2lvbiBhcmUgbm90IGFzIGV4cGVjdGVkLiBzaG91bGQgYmU6IiwgZ2V0U2hhcmVJbmRleCgpICk7DQogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwMiwgMCApOw0KICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgICAgICANCiAgICAgICAgfSANCiAgICAgICAgDQogICAgICAgIC8vIHJlY3J1c2l2ZSBhdHRhY2sgaXMgbm90IHBvc3NpYmxlIGFzIGRvUGF5bWVudCBpcyB1c2luZyBzZW5kIGFuZCBub3QgY2FsbC4NCiAgICAgICAgaWYoICEgZG9QYXltZW50KHN1Ym1pc3Npb25EYXRhLnRvdGFsU3VibWlzc2lvblZhbHVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgbWluZXJzRGF0YVsgbXNnLnNlbmRlciBdLnBheW1lbnRBZGRyZXNzKSApIHsNCiAgICAgICAgICAgIC8vIGVycm9yIG1zZyBpcyBnaXZlbiBpbiBkb1BheW1lbnQgZnVuY3Rpb24NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgY2xvc2VTdWJtaXNzaW9uKCBtc2cuc2VuZGVyICk7DQogICAgICAgIC8vbWluZXJzRGF0YVsgbXNnLnNlbmRlciBdLnBlbmRpbmdDbGFpbSA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAwLCAwICk7ICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgcmV0dXJuOw0KICAgIH0gICAgDQogICAgDQoNCiAgICAvLyAxMDAwMCA9IDEwMCUNCiAgICB1aW50IHB1YmxpYyB1bmNsZVJhdGUgPSA1MDA7IC8vIDUlDQogICAgLy8gMTAwMDAgPSAxMDAlDQogICAgdWludCBwdWJsaWMgcG9vbEZlZXMgPSAwOw0KDQoNCiAgICBldmVudCBJbmNvbWluZ0Z1bmRzKCBhZGRyZXNzIHNlbmRlciwgdWludCBhbW91bnRJbldlaSApOw0KICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7DQogICAgICAgIEluY29taW5nRnVuZHMoIG1zZy5zZW5kZXIsIG1zZy52YWx1ZSApOw0KICAgIH0NCg0KICAgIGV2ZW50IFNldFVubGNlUmF0ZUFuZEZlZXMoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7DQogICAgZnVuY3Rpb24gc2V0VW5sY2VSYXRlQW5kRmVlcyggdWludCBfdW5jbGVSYXRlLCB1aW50IF9wb29sRmVlcyApIHsNCiAgICAgICAgaWYoICEgb3duZXJzW21zZy5zZW5kZXJdICkgew0KICAgICAgICAgICAgLy8gb25seSBvd25lciBzaG91bGQgY2hhbmdlIHJhdGVzDQogICAgICAgICAgICBTZXRVbmxjZVJhdGVBbmRGZWVzKCBtc2cuc2VuZGVyLCAweDgwMDAwMDAwLCAwICk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHVuY2xlUmF0ZSA9IF91bmNsZVJhdGU7DQogICAgICAgIHBvb2xGZWVzID0gX3Bvb2xGZWVzOw0KICAgICAgICANCiAgICAgICAgU2V0VW5sY2VSYXRlQW5kRmVlcyggbXNnLnNlbmRlciwgMCwgMCApOw0KICAgIH0NCiAgICAgICAgDQogICAgZXZlbnQgRG9QYXltZW50KCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCBhZGRyZXNzIHBheW1lbnRBZGRyZXNzLCB1aW50IHZhbHVlSW5XZWkgKTsNCiAgICBmdW5jdGlvbiBkb1BheW1lbnQoIHVpbnQgc3VibWlzc2lvblZhbHVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBwYXltZW50QWRkcmVzcyApIGludGVybmFsIHJldHVybnMoYm9vbCkgew0KDQogICAgICAgIHVpbnQgcGF5bWVudCA9IHN1Ym1pc3Npb25WYWx1ZTsNCiAgICAgICAgLy8gdGFrZSB1bmNsZSByYXRlIGludG8gYWNjb3VudA0KICAgICAgICANCiAgICAgICAgLy8gcGF5bWVudCA9IHBheW1lbnQgKiAoMS0wLjI1KnVuY2xlUmF0ZSkNCiAgICAgICAgLy8gdW5jbGVSYXRlIGluIFswLDEwMDAwXQ0KICAgICAgICBwYXltZW50ID0gKHBheW1lbnQgKiAoNCoxMDAwMCAtIHVuY2xlUmF0ZSkpIC8gKDQqMTAwMDApOw0KICAgICAgICANCiAgICAgICAgLy8gZmVlcw0KICAgICAgICBwYXltZW50ID0gKHBheW1lbnQgKiAoMTAwMDAgLSBwb29sRmVlcykpIC8gMTAwMDA7DQoNCiAgICAgICAgaWYoIHBheW1lbnQgPiB0aGlzLmJhbGFuY2UgKXsNCiAgICAgICAgICAgIC8vRXJyb3JMb2coICJjYW5ub3QgYWZmb3JkIHRvIHBheSIsIGNhbGNQYXltZW50KCBzdWJtaXNzaW9uRGF0YS5udW1TaGFyZXMsIHN1Ym1pc3Npb25EYXRhLmRpZmZpY3VsdHkgKSApOw0KICAgICAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODQwMDAwMDAsIHBheW1lbnQgKTsgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgIGlmKCAhIHBheW1lbnRBZGRyZXNzLnNlbmQoIHBheW1lbnQgKSApIHRocm93Ow0KICAgICAgICANCiAgICAgICAgRG9QYXltZW50KCBtc2cuc2VuZGVyLCBwYXltZW50QWRkcmVzcywgcGF5bWVudCApOyANCiAgICAgICAgDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBnZXRQb29sRVRIQmFsYW5jZSggKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsNCiAgICAgICAgLy8gZGVidWcgZnVuY3Rpb24gZm9yIHRlc3RycGMNCiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZTsNCiAgICB9DQoNCiAgICBldmVudCBHZXRTaGFyZUluZGV4RGVidWdGb3JUZXN0UlBDU3VibWlzc2lvbkluZGV4KCB1aW50IGluZGV4ICk7ICAgIA0KICAgIGV2ZW50IEdldFNoYXJlSW5kZXhEZWJ1Z0ZvclRlc3RSUENTaGFyZUluZGV4KCB1aW50IGluZGV4ICk7DQogICAgIA0KICAgIGZ1bmN0aW9uIGdldFNoYXJlSW5kZXhEZWJ1Z0ZvclRlc3RSUEMoIGFkZHJlc3Mgc2VuZGVyICkgew0KICAgICAgICB1aW50IHNlZWQgPSBnZXRDbGFpbVNlZWQoIHNlbmRlciApOw0KICAgICAgICB1aW50WzJdIG1lbW9yeSByZXN1bHQgPSBjYWxjdWxhdGVTdWJtaXNzaW9uSW5kZXgoIHNlbmRlciwgc2VlZCApOw0KICAgICAgICANCiAgICAgICAgR2V0U2hhcmVJbmRleERlYnVnRm9yVGVzdFJQQ1N1Ym1pc3Npb25JbmRleCggcmVzdWx0WzBdICk7DQogICAgICAgIEdldFNoYXJlSW5kZXhEZWJ1Z0ZvclRlc3RSUENTaGFyZUluZGV4KCByZXN1bHRbMV0gKTsgICAgICAgIA0KICAgICAgICAgICAgDQogICAgfSAgICAgICAgDQp9'