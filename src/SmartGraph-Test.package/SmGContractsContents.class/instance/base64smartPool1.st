base 64 content
base64smartPool1
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQovL3NvbGMgLS1iaW4gLS1hYmkgLS1vcHRpbWl6ZSAgLS1vcHRpbWl6ZS1ydW5zIDIwMDAwIC1vIC4gVGVzdHBvb2wuc29sIA0KDQoNCi8vaW1wb3J0ICIuL1NIQTNfNTEyLnNvbCI7DQoNCmNvbnRyYWN0IFNIQTNfNTEyIHsNCiAgICBmdW5jdGlvbiBTSEEzXzUxMigpIHt9DQogICAgDQogICAgZnVuY3Rpb24ga2VjY2FrX2YodWludFsyNV0gQSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50WzI1XSkgew0KICAgICAgICB1aW50WzVdIG1lbW9yeSBDOw0KICAgICAgICB1aW50WzVdIG1lbW9yeSBEOw0KICAgICAgICB1aW50IHg7DQogICAgICAgIHVpbnQgeTsNCiAgICAgICAgLy91aW50IERfMDsgdWludCBEXzE7IHVpbnQgRF8yOyB1aW50IERfMzsgdWludCBEXzQ7DQogICAgICAgIHVpbnRbMjVdIG1lbW9yeSBCOw0KICAgICAgICANCiAgICAgICAgdWludFsyNF0gbWVtb3J5IFJDPSBbDQogICAgICAgICAgICAgICAgICAgdWludCgweDAwMDAwMDAwMDAwMDAwMDEpLA0KICAgICAgICAgICAgICAgICAgIDB4MDAwMDAwMDAwMDAwODA4MiwNCiAgICAgICAgICAgICAgICAgICAweDgwMDAwMDAwMDAwMDgwOEEsDQogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDgwMDA4MDAwLA0KICAgICAgICAgICAgICAgICAgIDB4MDAwMDAwMDAwMDAwODA4QiwNCiAgICAgICAgICAgICAgICAgICAweDAwMDAwMDAwODAwMDAwMDEsDQogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDgwMDA4MDgxLA0KICAgICAgICAgICAgICAgICAgIDB4ODAwMDAwMDAwMDAwODAwOSwNCiAgICAgICAgICAgICAgICAgICAweDAwMDAwMDAwMDAwMDAwOEEsDQogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDAwMDAwMDg4LA0KICAgICAgICAgICAgICAgICAgIDB4MDAwMDAwMDA4MDAwODAwOSwNCiAgICAgICAgICAgICAgICAgICAweDAwMDAwMDAwODAwMDAwMEEsDQogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDgwMDA4MDhCLA0KICAgICAgICAgICAgICAgICAgIDB4ODAwMDAwMDAwMDAwMDA4QiwNCiAgICAgICAgICAgICAgICAgICAweDgwMDAwMDAwMDAwMDgwODksDQogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDA4MDAzLA0KICAgICAgICAgICAgICAgICAgIDB4ODAwMDAwMDAwMDAwODAwMiwNCiAgICAgICAgICAgICAgICAgICAweDgwMDAwMDAwMDAwMDAwODAsDQogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDAwMDA4MDBBLA0KICAgICAgICAgICAgICAgICAgIDB4ODAwMDAwMDA4MDAwMDAwQSwNCiAgICAgICAgICAgICAgICAgICAweDgwMDAwMDAwODAwMDgwODEsDQogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDA4MDgwLA0KICAgICAgICAgICAgICAgICAgIDB4MDAwMDAwMDA4MDAwMDAwMSwNCiAgICAgICAgICAgICAgICAgICAweDgwMDAwMDAwODAwMDgwMDggXTsNCiAgICAgICAgDQogICAgICAgIGZvciggdWludCBpID0gMCA7IGkgPCAyNCA7IGkrKyApIHsNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICBmb3IoIHggPSAwIDsgeCA8IDUgOyB4KysgKSB7DQogICAgICAgICAgICAgICAgQ1t4XSA9IEFbNSp4XV5BWzUqeCsxXV5BWzUqeCsyXV5BWzUqeCszXV5BWzUqeCs0XTsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9Ki8NCiAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICBDWzBdPUFbMF1eQVsxXV5BWzJdXkFbM11eQVs0XTsNCiAgICAgICAgICAgIENbMV09QVs1XV5BWzZdXkFbN11eQVs4XV5BWzldOw0KICAgICAgICAgICAgQ1syXT1BWzEwXV5BWzExXV5BWzEyXV5BWzEzXV5BWzE0XTsNCiAgICAgICAgICAgIENbM109QVsxNV1eQVsxNl1eQVsxN11eQVsxOF1eQVsxOV07DQogICAgICAgICAgICBDWzRdPUFbMjBdXkFbMjFdXkFbMjJdXkFbMjNdXkFbMjRdOw0KDQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgZm9yKCB4ID0gMCA7IHggPCA1IDsgeCsrICkgew0KICAgICAgICAgICAgICAgIERbeF0gPSBDWyh4KzQpJTVdXigoQ1soeCsxKSU1XSAqIDIpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChDWyh4KzEpJTVdLygyKio2MykpKTsNCiAgICAgICAgICAgIH0qLw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIERbMF09Q1s0XSBeICgoQ1sxXSAqIDIpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChDWzFdIC8gKDIgKiogNjMpKSk7DQogICAgICAgICAgICBEWzFdPUNbMF0gXiAoKENbMl0gKiAyKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQ1syXSAvICgyICoqIDYzKSkpOw0KICAgICAgICAgICAgRFsyXT1DWzFdIF4gKChDWzNdICogMikmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKENbM10gLyAoMiAqKiA2MykpKTsNCiAgICAgICAgICAgIERbM109Q1syXSBeICgoQ1s0XSAqIDIpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChDWzRdIC8gKDIgKiogNjMpKSk7DQogICAgICAgICAgICBEWzRdPUNbM10gXiAoKENbMF0gKiAyKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQ1swXSAvICgyICoqIDYzKSkpOw0KDQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgZm9yKCB4ID0gMCA7IHggPCA1IDsgeCsrICkgew0KICAgICAgICAgICAgICAgIGZvciggeSA9IDAgOyB5IDwgNSA7IHkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgQVs1KngreV0gPSBBWzUqeCt5XSBeIERbeF07DQogICAgICAgICAgICAgICAgfSAgICAgICAgICAgIA0KICAgICAgICAgICAgfSovDQogICAgICAgICAgICANCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBBWzBdPUFbMF0gXiBEWzBdOw0KICAgICAgICAgICAgQVsxXT1BWzFdIF4gRFswXTsNCiAgICAgICAgICAgIEFbMl09QVsyXSBeIERbMF07DQogICAgICAgICAgICBBWzNdPUFbM10gXiBEWzBdOw0KICAgICAgICAgICAgQVs0XT1BWzRdIF4gRFswXTsNCiAgICAgICAgICAgIEFbNV09QVs1XSBeIERbMV07DQogICAgICAgICAgICBBWzZdPUFbNl0gXiBEWzFdOw0KICAgICAgICAgICAgQVs3XT1BWzddIF4gRFsxXTsNCiAgICAgICAgICAgIEFbOF09QVs4XSBeIERbMV07DQogICAgICAgICAgICBBWzldPUFbOV0gXiBEWzFdOw0KICAgICAgICAgICAgQVsxMF09QVsxMF0gXiBEWzJdOw0KICAgICAgICAgICAgQVsxMV09QVsxMV0gXiBEWzJdOw0KICAgICAgICAgICAgQVsxMl09QVsxMl0gXiBEWzJdOw0KICAgICAgICAgICAgQVsxM109QVsxM10gXiBEWzJdOw0KICAgICAgICAgICAgQVsxNF09QVsxNF0gXiBEWzJdOw0KICAgICAgICAgICAgQVsxNV09QVsxNV0gXiBEWzNdOw0KICAgICAgICAgICAgQVsxNl09QVsxNl0gXiBEWzNdOw0KICAgICAgICAgICAgQVsxN109QVsxN10gXiBEWzNdOw0KICAgICAgICAgICAgQVsxOF09QVsxOF0gXiBEWzNdOw0KICAgICAgICAgICAgQVsxOV09QVsxOV0gXiBEWzNdOw0KICAgICAgICAgICAgQVsyMF09QVsyMF0gXiBEWzRdOw0KICAgICAgICAgICAgQVsyMV09QVsyMV0gXiBEWzRdOw0KICAgICAgICAgICAgQVsyMl09QVsyMl0gXiBEWzRdOw0KICAgICAgICAgICAgQVsyM109QVsyM10gXiBEWzRdOw0KICAgICAgICAgICAgQVsyNF09QVsyNF0gXiBEWzRdOw0KDQogICAgICAgICAgICAvKlJobyBhbmQgcGkgc3RlcHMqLyAgICAgICAgICAgIA0KICAgICAgICAgICAgQlswXT1BWzBdOw0KICAgICAgICAgICAgQls4XT0oKEFbMV0gKiAoMiAqKiAzNikpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzFdIC8gKDIgKiogMjgpKSk7DQogICAgICAgICAgICBCWzExXT0oKEFbMl0gKiAoMiAqKiAzKSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMl0gLyAoMiAqKiA2MSkpKTsNCiAgICAgICAgICAgIEJbMTldPSgoQVszXSAqICgyICoqIDQxKSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbM10gLyAoMiAqKiAyMykpKTsNCiAgICAgICAgICAgIEJbMjJdPSgoQVs0XSAqICgyICoqIDE4KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbNF0gLyAoMiAqKiA0NikpKTsNCiAgICAgICAgICAgIEJbMl09KChBWzVdICogKDIgKiogMSkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzVdIC8gKDIgKiogNjMpKSk7DQogICAgICAgICAgICBCWzVdPSgoQVs2XSAqICgyICoqIDQ0KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbNl0gLyAoMiAqKiAyMCkpKTsNCiAgICAgICAgICAgIEJbMTNdPSgoQVs3XSAqICgyICoqIDEwKSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbN10gLyAoMiAqKiA1NCkpKTsNCiAgICAgICAgICAgIEJbMTZdPSgoQVs4XSAqICgyICoqIDQ1KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbOF0gLyAoMiAqKiAxOSkpKTsNCiAgICAgICAgICAgIEJbMjRdPSgoQVs5XSAqICgyICoqIDIpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVs5XSAvICgyICoqIDYyKSkpOw0KICAgICAgICAgICAgQls0XT0oKEFbMTBdICogKDIgKiogNjIpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxMF0gLyAoMiAqKiAyKSkpOw0KICAgICAgICAgICAgQls3XT0oKEFbMTFdICogKDIgKiogNikpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzExXSAvICgyICoqIDU4KSkpOw0KICAgICAgICAgICAgQlsxMF09KChBWzEyXSAqICgyICoqIDQzKSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMTJdIC8gKDIgKiogMjEpKSk7DQogICAgICAgICAgICBCWzE4XT0oKEFbMTNdICogKDIgKiogMTUpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxM10gLyAoMiAqKiA0OSkpKTsNCiAgICAgICAgICAgIEJbMjFdPSgoQVsxNF0gKiAoMiAqKiA2MSkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzE0XSAvICgyICoqIDMpKSk7DQogICAgICAgICAgICBCWzFdPSgoQVsxNV0gKiAoMiAqKiAyOCkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzE1XSAvICgyICoqIDM2KSkpOw0KICAgICAgICAgICAgQls5XT0oKEFbMTZdICogKDIgKiogNTUpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxNl0gLyAoMiAqKiA5KSkpOw0KICAgICAgICAgICAgQlsxMl09KChBWzE3XSAqICgyICoqIDI1KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMTddIC8gKDIgKiogMzkpKSk7DQogICAgICAgICAgICBCWzE1XT0oKEFbMThdICogKDIgKiogMjEpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxOF0gLyAoMiAqKiA0MykpKTsNCiAgICAgICAgICAgIEJbMjNdPSgoQVsxOV0gKiAoMiAqKiA1NikpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzE5XSAvICgyICoqIDgpKSk7DQogICAgICAgICAgICBCWzNdPSgoQVsyMF0gKiAoMiAqKiAyNykpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzIwXSAvICgyICoqIDM3KSkpOw0KICAgICAgICAgICAgQls2XT0oKEFbMjFdICogKDIgKiogMjApKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsyMV0gLyAoMiAqKiA0NCkpKTsNCiAgICAgICAgICAgIEJbMTRdPSgoQVsyMl0gKiAoMiAqKiAzOSkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzIyXSAvICgyICoqIDI1KSkpOw0KICAgICAgICAgICAgQlsxN109KChBWzIzXSAqICgyICoqIDgpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsyM10gLyAoMiAqKiA1NikpKTsNCiAgICAgICAgICAgIEJbMjBdPSgoQVsyNF0gKiAoMiAqKiAxNCkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzI0XSAvICgyICoqIDUwKSkpOw0KDQogICAgICAgICAgICAvKlhpIHN0YXRlKi8NCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICBmb3IoIHggPSAwIDsgeCA8IDUgOyB4KysgKSB7DQogICAgICAgICAgICAgICAgZm9yKCB5ID0gMCA7IHkgPCA1IDsgeSsrICkgew0KICAgICAgICAgICAgICAgICAgICBBWzUqeCt5XSA9IEJbNSp4K3ldXigofkJbNSooKHgrMSklNSkreV0pICYgQls1KigoeCsyKSU1KSt5XSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSovDQogICAgICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgQVswXT1CWzBdXigofkJbNV0pICYgQlsxMF0pOw0KICAgICAgICAgICAgQVsxXT1CWzFdXigofkJbNl0pICYgQlsxMV0pOw0KICAgICAgICAgICAgQVsyXT1CWzJdXigofkJbN10pICYgQlsxMl0pOw0KICAgICAgICAgICAgQVszXT1CWzNdXigofkJbOF0pICYgQlsxM10pOw0KICAgICAgICAgICAgQVs0XT1CWzRdXigofkJbOV0pICYgQlsxNF0pOw0KICAgICAgICAgICAgQVs1XT1CWzVdXigofkJbMTBdKSAmIEJbMTVdKTsNCiAgICAgICAgICAgIEFbNl09Qls2XV4oKH5CWzExXSkgJiBCWzE2XSk7DQogICAgICAgICAgICBBWzddPUJbN11eKCh+QlsxMl0pICYgQlsxN10pOw0KICAgICAgICAgICAgQVs4XT1CWzhdXigofkJbMTNdKSAmIEJbMThdKTsNCiAgICAgICAgICAgIEFbOV09Qls5XV4oKH5CWzE0XSkgJiBCWzE5XSk7DQogICAgICAgICAgICBBWzEwXT1CWzEwXV4oKH5CWzE1XSkgJiBCWzIwXSk7DQogICAgICAgICAgICBBWzExXT1CWzExXV4oKH5CWzE2XSkgJiBCWzIxXSk7DQogICAgICAgICAgICBBWzEyXT1CWzEyXV4oKH5CWzE3XSkgJiBCWzIyXSk7DQogICAgICAgICAgICBBWzEzXT1CWzEzXV4oKH5CWzE4XSkgJiBCWzIzXSk7DQogICAgICAgICAgICBBWzE0XT1CWzE0XV4oKH5CWzE5XSkgJiBCWzI0XSk7DQogICAgICAgICAgICBBWzE1XT1CWzE1XV4oKH5CWzIwXSkgJiBCWzBdKTsNCiAgICAgICAgICAgIEFbMTZdPUJbMTZdXigofkJbMjFdKSAmIEJbMV0pOw0KICAgICAgICAgICAgQVsxN109QlsxN11eKCh+QlsyMl0pICYgQlsyXSk7DQogICAgICAgICAgICBBWzE4XT1CWzE4XV4oKH5CWzIzXSkgJiBCWzNdKTsNCiAgICAgICAgICAgIEFbMTldPUJbMTldXigofkJbMjRdKSAmIEJbNF0pOw0KICAgICAgICAgICAgQVsyMF09QlsyMF1eKCh+QlswXSkgJiBCWzVdKTsNCiAgICAgICAgICAgIEFbMjFdPUJbMjFdXigofkJbMV0pICYgQls2XSk7DQogICAgICAgICAgICBBWzIyXT1CWzIyXV4oKH5CWzJdKSAmIEJbN10pOw0KICAgICAgICAgICAgQVsyM109QlsyM11eKCh+QlszXSkgJiBCWzhdKTsNCiAgICAgICAgICAgIEFbMjRdPUJbMjRdXigofkJbNF0pICYgQls5XSk7DQoNCiAgICAgICAgICAgIC8qTGFzdCBzdGVwKi8NCiAgICAgICAgICAgIEFbMF09QVswXV5SQ1tpXTsgICAgICAgICAgICANCiAgICAgICAgfQ0KDQogICAgICAgIA0KICAgICAgICByZXR1cm4gQTsNCiAgICB9DQogDQogICAgDQogICAgZnVuY3Rpb24gc3BvbmdlKHVpbnRbOV0gTSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50WzE2XSkgew0KICAgICAgICBpZiggKE0ubGVuZ3RoICogOCkgIT0gNzIgKSB0aHJvdzsNCiAgICAgICAgTVs1XSA9IDB4MDE7DQogICAgICAgIE1bOF0gPSAweDgwMDAwMDAwMDAwMDAwMDA7DQogICAgICAgIA0KICAgICAgICB1aW50IHIgPSA3MjsNCiAgICAgICAgdWludCB3ID0gODsNCiAgICAgICAgdWludCBzaXplID0gTS5sZW5ndGggKiA4Ow0KICAgICAgICANCiAgICAgICAgdWludFsyNV0gbWVtb3J5IFM7DQogICAgICAgIHVpbnQgaTsgdWludCB5OyB1aW50IHg7DQogICAgICAgIC8qQWJzb3JiaW5nIFBoYXNlKi8NCiAgICAgICAgZm9yKCBpID0gMCA7IGkgPCBzaXplL3IgOyBpKysgKSB7DQogICAgICAgICAgICBmb3IoIHkgPSAwIDsgeSA8IDUgOyB5KysgKSB7DQogICAgICAgICAgICAgICAgZm9yKCB4ID0gMCA7IHggPCA1IDsgeCsrICkgew0KICAgICAgICAgICAgICAgICAgICBpZiggKHgrNSp5KSA8IChyL3cpICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgU1s1KngreV0gPSBTWzUqeCt5XSBeIE1baSo5ICsgeCArIDUqeV07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBTID0ga2VjY2FrX2YoUyk7DQogICAgICAgIH0NCg0KICAgICAgICAvKlNxdWVlemluZyBwaGFzZSovDQogICAgICAgIHVpbnRbMTZdIG1lbW9yeSByZXN1bHQ7DQogICAgICAgIHVpbnQgYiA9IDA7DQogICAgICAgIHdoaWxlKCBiIDwgMTYgKSB7DQogICAgICAgICAgICBmb3IoIHkgPSAwIDsgeSA8IDUgOyB5KysgKSB7DQogICAgICAgICAgICAgICAgZm9yKCB4ID0gMCA7IHggPCA1IDsgeCsrICkgew0KICAgICAgICAgICAgICAgICAgICBpZiggKHgrNSp5KTwoci93KSAmJiAoYjwxNikgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbYl0gPSBTWzUqeCt5XSAmIDB4RkZGRkZGRkY7IA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2IrMV0gPSBTWzUqeCt5XSAvIDB4MTAwMDAwMDAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgYis9MjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAgDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICB9DQoNCn0NCg0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KY29udHJhY3QgRXRoYXNoIGlzIFNIQTNfNTEyIHsNCiAgICANCiAgICBtYXBwaW5nKGFkZHJlc3M9PmJvb2wpIHB1YmxpYyBvd25lcnM7DQogICAgDQogICAgZnVuY3Rpb24gRXRoYXNoKGFkZHJlc3NbM10gX293bmVycykgew0KICAgICAgICBvd25lcnNbX293bmVyc1swXV0gPSB0cnVlOw0KICAgICAgICBvd25lcnNbX293bmVyc1sxXV0gPSB0cnVlOw0KICAgICAgICBvd25lcnNbX293bmVyc1syXV0gPSB0cnVlOyAgICAgICAgICAgICAgICANCiAgICB9DQogICAgIA0KICAgIGZ1bmN0aW9uIGZudiggdWludCB2MSwgdWludCB2MiApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCkgew0KICAgICAgICByZXR1cm4gKCh2MSoweDAxMDAwMTkzKSBeIHYyKSAmIDB4RkZGRkZGRkY7DQogICAgfQ0KDQoNCg0KICAgIGZ1bmN0aW9uIGNvbXB1dGVDYWNoZVJvb3QoIHVpbnQgaW5kZXgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBpbmRleEluRWxlbWVudHNBcnJheSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gZWxlbWVudHMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIHdpdG5lc3MsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBicmFuY2hTaXplICkgY29uc3RhbnQgcHJpdmF0ZSByZXR1cm5zKHVpbnQpIHsNCiANCiAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIHVpbnQgbGVhZiA9IGNvbXB1dGVMZWFmKGVsZW1lbnRzLCBpbmRleEluRWxlbWVudHNBcnJheSkgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KDQogICAgICAgIHVpbnQgbGVmdDsNCiAgICAgICAgdWludCByaWdodDsNCiAgICAgICAgdWludCBub2RlOw0KICAgICAgICBib29sIG9kZEJyYW5jaFNpemUgPSAoYnJhbmNoU2l6ZSAlIDIpID4gMDsNCiAgICAgICAgIA0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBicmFuY2hTaXplIDo9IGRpdihicmFuY2hTaXplLDIpDQogICAgICAgICAgICAvL2JyYW5jaFNpemUgLz0gMjsNCiAgICAgICAgfQ0KICAgICAgICB1aW50IHdpdG5lc3NJbmRleCA9IGluZGV4SW5FbGVtZW50c0FycmF5ICogYnJhbmNoU2l6ZTsNCiAgICAgICAgaWYoIG9kZEJyYW5jaFNpemUgKSB3aXRuZXNzSW5kZXggKz0gaW5kZXhJbkVsZW1lbnRzQXJyYXk7ICANCg0KICAgICAgICBmb3IoIHVpbnQgZGVwdGggPSAwIDsgZGVwdGggPCBicmFuY2hTaXplIDsgZGVwdGgrKyApIHsNCiAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICBub2RlIDo9IG1sb2FkKGFkZChhZGQod2l0bmVzcywweDIwKSxtdWwoYWRkKGRlcHRoLHdpdG5lc3NJbmRleCksMHgyMCkpKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy9ub2RlICA9IHdpdG5lc3Nbd2l0bmVzc0luZGV4ICsgZGVwdGhdICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgICAgIGlmKCBpbmRleCAmIDB4MSA9PSAwICkgew0KICAgICAgICAgICAgICAgIGxlZnQgPSBsZWFmOw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5ew0KICAgICAgICAgICAgICAgICAgICAvL3JpZ2h0ID0gbm9kZSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByaWdodCA6PSBhbmQobm9kZSwweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGFzc2VtYmx5ew0KICAgICAgICAgICAgICAgICAgICAvL2xlZnQgPSBub2RlICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgICAgICAgICAgICAgbGVmdCA6PSBhbmQobm9kZSwweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByaWdodCA9IGxlYWY7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxlYWYgPSB1aW50KHNoYTMobGVmdCxyaWdodCkpICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICBpbmRleCA6PSBkaXYoaW5kZXgsMikgDQogICAgICAgICAgICB9DQogICAgICAgICAgICAvL2luZGV4ID0gaW5kZXggLyAyOw0KDQogICAgICAgICAgICAvL25vZGUgID0gd2l0bmVzc1t3aXRuZXNzSW5kZXggKyBkZXB0aF0gLyAoMioqMTI4KTsNCiAgICAgICAgICAgIGlmKCBpbmRleCAmIDB4MSA9PSAwICkgew0KICAgICAgICAgICAgICAgIGxlZnQgPSBsZWFmOw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5ew0KICAgICAgICAgICAgICAgICAgICByaWdodCA6PSBkaXYobm9kZSwweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCkNCiAgICAgICAgICAgICAgICAgICAgLy9yaWdodCA9IG5vZGUgLyAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgICAgIC8vbGVmdCA9IG5vZGUgLyAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDsNCiAgICAgICAgICAgICAgICAgICAgbGVmdCA6PSBkaXYobm9kZSwweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmlnaHQgPSBsZWFmOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZWFmID0gdWludChzaGEzKGxlZnQscmlnaHQpKSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgaW5kZXggOj0gZGl2KGluZGV4LDIpIA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy9pbmRleCA9IGluZGV4IC8gMjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYoIG9kZEJyYW5jaFNpemUgKSB7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbm9kZSA6PSBtbG9hZChhZGQoYWRkKHdpdG5lc3MsMHgyMCksbXVsKGFkZChkZXB0aCx3aXRuZXNzSW5kZXgpLDB4MjApKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAvL25vZGUgID0gd2l0bmVzc1t3aXRuZXNzSW5kZXggKyBkZXB0aF0gJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICAgICAgaWYoIGluZGV4ICYgMHgxID09IDAgKSB7DQogICAgICAgICAgICAgICAgbGVmdCA9IGxlYWY7DQogICAgICAgICAgICAgICAgYXNzZW1ibHl7DQogICAgICAgICAgICAgICAgICAgIC8vcmlnaHQgPSBub2RlICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJpZ2h0IDo9IGFuZChub2RlLDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYpDQogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGFzc2VtYmx5ew0KICAgICAgICAgICAgICAgICAgICAvL2xlZnQgPSBub2RlICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxlZnQgOj0gYW5kKG5vZGUsMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRikNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICByaWdodCA9IGxlYWY7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxlYWYgPSB1aW50KHNoYTMobGVmdCxyaWdodCkpICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGxlYWY7DQogICAgfQ0KDQogICAgDQogICAgZnVuY3Rpb24gdG9CRSggdWludCB4ICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7DQogICAgICAgIHVpbnQgeSA9IDA7DQogICAgICAgIGZvciggdWludCBpID0gMCA7IGkgPCAzMiA7IGkrKyApIHsNCiAgICAgICAgICAgIHkgPSB5ICogMjU2Ow0KICAgICAgICAgICAgeSArPSAoeCAmIDB4RkYpOw0KICAgICAgICAgICAgeCA9IHggLyAyNTY7ICAgICAgICAgICAgDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHJldHVybiB5Ow0KICAgICAgICANCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gY29tcHV0ZVNoYTMoIHVpbnRbMTZdIHMsIHVpbnRbOF0gY21peCApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCkgew0KICAgICAgICB1aW50IHMwID0gc1swXSArIHNbMV0gKiAoMioqMzIpICsgc1syXSAqICgyKio2NCkgKyBzWzNdICogKDIqKjk2KSArDQogICAgICAgICAgICAgICAgICAoc1s0XSArIHNbNV0gKiAoMioqMzIpICsgc1s2XSAqICgyKio2NCkgKyBzWzddICogKDIqKjk2KSkqKDIqKjEyOCk7DQoNCiAgICAgICAgdWludCBzMSA9IHNbOF0gKyBzWzldICogKDIqKjMyKSArIHNbMTBdICogKDIqKjY0KSArIHNbMTFdICogKDIqKjk2KSArDQogICAgICAgICAgICAgICAgICAoc1sxMl0gKyBzWzEzXSAqICgyKiozMikgKyBzWzE0XSAqICgyKio2NCkgKyBzWzE1XSAqICgyKio5NikpKigyKioxMjgpOw0KICAgICAgICAgICAgICAgICAgDQogICAgICAgIHVpbnQgYyA9IGNtaXhbMF0gKyBjbWl4WzFdICogKDIqKjMyKSArIGNtaXhbMl0gKiAoMioqNjQpICsgY21peFszXSAqICgyKio5NikgKw0KICAgICAgICAgICAgICAgICAgKGNtaXhbNF0gKyBjbWl4WzVdICogKDIqKjMyKSArIGNtaXhbNl0gKiAoMioqNjQpICsgY21peFs3XSAqICgyKio5NikpKigyKioxMjgpOw0KDQogICAgICAgIA0KICAgICAgICAvKiBnb2Qga25vd3Mgd2h5IG5lZWQgdG8gY29udmVydCB0byBiaWcgZW5kaWFuICovDQogICAgICAgIHJldHVybiB1aW50KCBzaGEzKHRvQkUoczApLHRvQkUoczEpLHRvQkUoYykpICk7DQogICAgfQ0KIA0KIA0KICAgIGZ1bmN0aW9uIGNvbXB1dGVMZWFmKCB1aW50W10gZGF0YVNldExvb2t1cCwgdWludCBpbmRleCApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCkgew0KICAgICAgICByZXR1cm4gdWludCggc2hhMyhkYXRhU2V0TG9va3VwWzQqaW5kZXhdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhU2V0TG9va3VwWzQqaW5kZXggKyAxXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNldExvb2t1cFs0KmluZGV4ICsgMl0sDQogICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTZXRMb29rdXBbNCppbmRleCArIDNdKSApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgfQ0KIA0KICAgIGZ1bmN0aW9uIGNvbXB1dGVTKCB1aW50IGhlYWRlciwgdWludCBub25jZUxlICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50WzE2XSkgew0KICAgICAgICB1aW50WzldICBtZW1vcnkgTTsNCiAgICAgICAgDQogICAgICAgIGhlYWRlciA9IHJldmVyc2VCeXRlcyhoZWFkZXIpOw0KICAgICAgICANCiAgICAgICAgTVswXSA9IHVpbnQoaGVhZGVyKSAmIDB4RkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgaGVhZGVyID0gaGVhZGVyIC8gMioqNjQ7DQogICAgICAgIE1bMV0gPSB1aW50KGhlYWRlcikgJiAweEZGRkZGRkZGRkZGRkZGRkY7DQogICAgICAgIGhlYWRlciA9IGhlYWRlciAvIDIqKjY0Ow0KICAgICAgICBNWzJdID0gdWludChoZWFkZXIpICYgMHhGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICBoZWFkZXIgPSBoZWFkZXIgLyAyKio2NDsNCiAgICAgICAgTVszXSA9IHVpbnQoaGVhZGVyKSAmIDB4RkZGRkZGRkZGRkZGRkZGRjsNCg0KICAgICAgICAvLyBtYWtlIGxpdHRsZSBlbmRpYW4gbm9uY2UNCiAgICAgICAgTVs0XSA9IG5vbmNlTGU7DQogICAgICAgIHJldHVybiBzcG9uZ2UoTSk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHJldmVyc2VCeXRlcyggdWludCBpbnB1dCApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCkgew0KICAgICAgICB1aW50IHJlc3VsdCA9IDA7DQogICAgICAgIGZvcih1aW50IGkgPSAwIDsgaSA8IDMyIDsgaSsrICkgew0KICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ICogMjU2Ow0KICAgICAgICAgICAgcmVzdWx0ICs9IGlucHV0ICYgMHhmZjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaW5wdXQgLz0gMjU2Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICANCiAgICBzdHJ1Y3QgRXRoYXNoQ2FjaGVPcHREYXRhIHsNCiAgICAgICAgdWludFs1MTJdICAgIG1lcmtsZU5vZGVzOw0KICAgICAgICB1aW50ICAgICAgICAgZnVsbFNpemVJbjEyOFJlc3VsdGlvbjsNCiAgICAgICAgdWludCAgICAgICAgIGJyYW5jaERlcHRoOw0KICAgIH0NCiAgICANCiAgICBtYXBwaW5nKHVpbnQ9PkV0aGFzaENhY2hlT3B0RGF0YSkgZXBvY2hEYXRhOw0KICAgIA0KICAgIGZ1bmN0aW9uIGdldEVwb2NoRGF0YSggdWludCBlcG9jaEluZGV4LCB1aW50IG5vZGVJbmRleCApIGNvbnN0YW50IHJldHVybnModWludFszXSkgew0KICAgICAgICByZXR1cm4gW2Vwb2NoRGF0YVtlcG9jaEluZGV4XS5tZXJrbGVOb2Rlc1tub2RlSW5kZXhdLA0KICAgICAgICAgICAgICAgIGVwb2NoRGF0YVtlcG9jaEluZGV4XS5mdWxsU2l6ZUluMTI4UmVzdWx0aW9uLA0KICAgICAgICAgICAgICAgIGVwb2NoRGF0YVtlcG9jaEluZGV4XS5icmFuY2hEZXB0aF07DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGlzRXBvY2hEYXRhU2V0KCB1aW50IGVwb2NoSW5kZXggKSBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIGVwb2NoRGF0YVtlcG9jaEluZGV4XS5mdWxsU2l6ZUluMTI4UmVzdWx0aW9uICE9IDA7DQogICAgDQogICAgfQ0KICAgICAgICANCiAgICBldmVudCBTZXRFcG9jaERhdGEoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7ICAgIA0KICAgIGZ1bmN0aW9uIHNldEVwb2NoRGF0YSggdWludCBlcG9jaCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZnVsbFNpemVJbjEyOFJlc3VsdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgYnJhbmNoRGVwdGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gbWVya2xlTm9kZXMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IHN0YXJ0LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBudW1FbGVtcyApIHsNCg0KICAgICAgICBpZiggISBvd25lcnNbbXNnLnNlbmRlcl0gKSB7DQogICAgICAgICAgICAvL0Vycm9yTG9nKCAic2V0RXBvY2hEYXRhOiBvbmx5IG93bmVyIGNhbiBzZXQgZGF0YSIsIHVpbnQobXNnLnNlbmRlcikgKTsNCiAgICAgICAgICAgIFNldEVwb2NoRGF0YSggbXNnLnNlbmRlciwgMHg4MjAwMDAwMCwgdWludChtc2cuc2VuZGVyKSApOw0KICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgDQogICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICBmb3IoIHVpbnQgaSA9IDAgOyBpIDwgbnVtRWxlbXMgOyBpKysgKSB7DQogICAgICAgICAgICBpZiggZXBvY2hEYXRhW2Vwb2NoXS5tZXJrbGVOb2Rlc1tzdGFydCtpXSA+IDAgKSB7DQogICAgICAgICAgICAgICAgLy9FcnJvckxvZygiZXBvY2ggYWxyZWFkeSBzZXQiLCBlcG9jaFtpXSk7DQogICAgICAgICAgICAgICAgU2V0RXBvY2hEYXRhKCBtc2cuc2VuZGVyLCAweDgyMDAwMDAxLCBlcG9jaCAqICgyKioxMjgpICsgc3RhcnQgKyBpICk7DQogICAgICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9IA0KICAgICAgICAgICAgZXBvY2hEYXRhW2Vwb2NoXS5tZXJrbGVOb2Rlc1tzdGFydCtpXSA9IG1lcmtsZU5vZGVzW2ldOw0KICAgICAgICB9DQogICAgICAgIGVwb2NoRGF0YVtlcG9jaF0uZnVsbFNpemVJbjEyOFJlc3VsdGlvbiA9IGZ1bGxTaXplSW4xMjhSZXN1bHRpb247DQogICAgICAgIGVwb2NoRGF0YVtlcG9jaF0uYnJhbmNoRGVwdGggPSBicmFuY2hEZXB0aDsNCiAgICAgICAgDQogICAgICAgIFNldEVwb2NoRGF0YSggbXNnLnNlbmRlciwgMCAsIDAgKTsgICAgICAgIA0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldE1lcmtsZUxlYXZlKCB1aW50IGVwb2NoSW5kZXgsIHVpbnQgcCApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCkgeyAgICAgICAgDQogICAgICAgIHVpbnQgcm9vdEluZGV4ID0gcCA+PiBlcG9jaERhdGFbZXBvY2hJbmRleF0uYnJhbmNoRGVwdGg7DQogICAgICAgIHVpbnQgZXhwZWN0ZWRSb290ID0gZXBvY2hEYXRhW2Vwb2NoSW5kZXhdLm1lcmtsZU5vZGVzWyhyb290SW5kZXgvMildOw0KICAgICAgICBpZiggKHJvb3RJbmRleCAlIDIpID09IDAgKSBleHBlY3RlZFJvb3QgPSBleHBlY3RlZFJvb3QgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICBlbHNlIGV4cGVjdGVkUm9vdCA9IGV4cGVjdGVkUm9vdCAvICgyKioxMjgpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGV4cGVjdGVkUm9vdDsNCiAgICB9DQoNCg0KICAgIGZ1bmN0aW9uIGhhc2hpbW90byggYnl0ZXMzMiAgICAgIGhlYWRlciwNCiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzOCAgICAgICBub25jZUxlLA0KICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdICAgICAgIGRhdGFTZXRMb29rdXAsDQogICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gICAgICAgd2l0bmVzc0Zvckxvb2t1cCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgICAgICAgICBlcG9jaEluZGV4ICkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7DQogICAgICAgICANCiAgICAgICAgdWludFsxNl0gbWVtb3J5IHM7DQogICAgICAgIHVpbnRbMzJdIG1lbW9yeSBtaXg7DQogICAgICAgIHVpbnRbOF0gIG1lbW9yeSBjbWl4Ow0KICAgICAgICANCiAgICAgICAgdWludFsyXSAgbWVtb3J5IGRlcHRoQW5kRnVsbFNpemUgPSBbZXBvY2hEYXRhW2Vwb2NoSW5kZXhdLmJyYW5jaERlcHRoLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXBvY2hEYXRhW2Vwb2NoSW5kZXhdLmZ1bGxTaXplSW4xMjhSZXN1bHRpb25dOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICB1aW50IGk7DQogICAgICAgIHVpbnQgajsNCiAgICAgICAgDQogICAgICAgIGlmKCAhIGlzRXBvY2hEYXRhU2V0KCBlcG9jaEluZGV4ICkgKSByZXR1cm4gMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZFOw0KICAgICAgICANCiAgICAgICAgaWYoIGRlcHRoQW5kRnVsbFNpemVbMV0gPT0gMCApIHsNCiAgICAgICAgICAgIHJldHVybiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7DQogICAgICAgIH0NCg0KICAgICAgICANCiAgICAgICAgcyA9IGNvbXB1dGVTKHVpbnQoaGVhZGVyKSwgdWludChub25jZUxlKSk7DQogICAgICAgIGZvciggaSA9IDAgOyBpIDwgMTYgOyBpKysgKSB7ICAgICAgICAgICAgDQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbGV0IG9mZnNldCA6PSBtdWwoaSwweDIwKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vbWl4W2ldID0gc1tpXTsNCiAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKG1peCxvZmZzZXQpLG1sb2FkKGFkZChzLG9mZnNldCkpKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIG1peFtpKzE2XSA9IHNbaV07DQogICAgICAgICAgICAgICAgbXN0b3JlKGFkZChtaXgsYWRkKDB4MjAwLG9mZnNldCkpLG1sb2FkKGFkZChzLG9mZnNldCkpKSAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZvciggaSA9IDAgOyBpIDwgNjQgOyBpKysgKSB7DQogICAgICAgICAgICB1aW50IHAgPSBmbnYoIGkgXiBzWzBdLCBtaXhbaSAlIDMyXSkgJSBkZXB0aEFuZEZ1bGxTaXplWzFdOw0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCBjb21wdXRlQ2FjaGVSb290KCBwLCBpLCBkYXRhU2V0TG9va3VwLCAgd2l0bmVzc0Zvckxvb2t1cCwgZGVwdGhBbmRGdWxsU2l6ZVswXSApICAhPSBnZXRNZXJrbGVMZWF2ZSggZXBvY2hJbmRleCwgcCApICkgew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gUG9XIGZhaWxlZA0KICAgICAgICAgICAgICAgIHJldHVybiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7DQogICAgICAgICAgICB9ICAgICAgIA0KDQogICAgICAgICAgICBmb3IoIGogPSAwIDsgaiA8IDggOyBqKysgKSB7DQoNCiAgICAgICAgICAgICAgICBhc3NlbWJseXsNCiAgICAgICAgICAgICAgICAgICAgLy9taXhbal0gPSBmbnYobWl4W2pdLCBkYXRhU2V0TG9va3VwWzQqaV0gJiB2YXJGRkZGRkZGRiApOw0KICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YU9mZnNldCA6PSBhZGQobXVsKDB4ODAsaSksYWRkKGRhdGFTZXRMb29rdXAsMHgyMCkpDQogICAgICAgICAgICAgICAgICAgIGxldCBkYXRhVmFsdWUgICA6PSBhbmQobWxvYWQoZGF0YU9mZnNldCksMHhGRkZGRkZGRikNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBtaXhPZmZzZXQgOj0gYWRkKG1peCxtdWwoMHgyMCxqKSkNCiAgICAgICAgICAgICAgICAgICAgbGV0IG1peFZhbHVlICA6PSBtbG9hZChtaXhPZmZzZXQpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBmbnYgPSByZXR1cm4gKCh2MSoweDAxMDAwMTkzKSBeIHYyKSAmIDB4RkZGRkZGRkY7DQogICAgICAgICAgICAgICAgICAgIGxldCBmbnZWYWx1ZSA6PSBhbmQoeG9yKG11bChtaXhWYWx1ZSwweDAxMDAwMTkzKSxkYXRhVmFsdWUpLDB4RkZGRkZGRkYpICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbXN0b3JlKG1peE9mZnNldCxmbnZWYWx1ZSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vbWl4W2orOF0gPSBmbnYobWl4W2orOF0sIGRhdGFTZXRMb29rdXBbNCppICsgMV0gJiAweEZGRkZGRkZGICk7DQogICAgICAgICAgICAgICAgICAgIGRhdGFPZmZzZXQgOj0gYWRkKGRhdGFPZmZzZXQsMHgyMCkNCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlICAgOj0gYW5kKG1sb2FkKGRhdGFPZmZzZXQpLDB4RkZGRkZGRkYpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBtaXhPZmZzZXQgOj0gYWRkKG1peE9mZnNldCwweDEwMCkNCiAgICAgICAgICAgICAgICAgICAgbWl4VmFsdWUgIDo9IG1sb2FkKG1peE9mZnNldCkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGZudiA9IHJldHVybiAoKHYxKjB4MDEwMDAxOTMpIF4gdjIpICYgMHhGRkZGRkZGRjsNCiAgICAgICAgICAgICAgICAgICAgZm52VmFsdWUgOj0gYW5kKHhvcihtdWwobWl4VmFsdWUsMHgwMTAwMDE5MyksZGF0YVZhbHVlKSwweEZGRkZGRkZGKSAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG1zdG9yZShtaXhPZmZzZXQsZm52VmFsdWUpDQoNCiAgICAgICAgICAgICAgICAgICAgLy9taXhbaisxNl0gPSBmbnYobWl4W2orMTZdLCBkYXRhU2V0TG9va3VwWzQqaSArIDJdICYgMHhGRkZGRkZGRiApOw0KICAgICAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0IDo9IGFkZChkYXRhT2Zmc2V0LDB4MjApDQogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZSAgIDo9IGFuZChtbG9hZChkYXRhT2Zmc2V0KSwweEZGRkZGRkZGKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbWl4T2Zmc2V0IDo9IGFkZChtaXhPZmZzZXQsMHgxMDApDQogICAgICAgICAgICAgICAgICAgIG1peFZhbHVlICA6PSBtbG9hZChtaXhPZmZzZXQpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBmbnYgPSByZXR1cm4gKCh2MSoweDAxMDAwMTkzKSBeIHYyKSAmIDB4RkZGRkZGRkY7DQogICAgICAgICAgICAgICAgICAgIGZudlZhbHVlIDo9IGFuZCh4b3IobXVsKG1peFZhbHVlLDB4MDEwMDAxOTMpLGRhdGFWYWx1ZSksMHhGRkZGRkZGRikgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBtc3RvcmUobWl4T2Zmc2V0LGZudlZhbHVlKQ0KDQogICAgICAgICAgICAgICAgICAgIC8vbWl4W2orMjRdID0gZm52KG1peFtqKzI0XSwgZGF0YVNldExvb2t1cFs0KmkgKyAzXSAmIDB4RkZGRkZGRkYgKTsNCiAgICAgICAgICAgICAgICAgICAgZGF0YU9mZnNldCA6PSBhZGQoZGF0YU9mZnNldCwweDIwKQ0KICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWUgICA6PSBhbmQobWxvYWQoZGF0YU9mZnNldCksMHhGRkZGRkZGRikNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG1peE9mZnNldCA6PSBhZGQobWl4T2Zmc2V0LDB4MTAwKQ0KICAgICAgICAgICAgICAgICAgICBtaXhWYWx1ZSAgOj0gbWxvYWQobWl4T2Zmc2V0KQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gZm52ID0gcmV0dXJuICgodjEqMHgwMTAwMDE5MykgXiB2MikgJiAweEZGRkZGRkZGOw0KICAgICAgICAgICAgICAgICAgICBmbnZWYWx1ZSA6PSBhbmQoeG9yKG11bChtaXhWYWx1ZSwweDAxMDAwMTkzKSxkYXRhVmFsdWUpLDB4RkZGRkZGRkYpICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbXN0b3JlKG1peE9mZnNldCxmbnZWYWx1ZSkgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vbWl4W2pdID0gZm52KG1peFtqXSwgZGF0YVNldExvb2t1cFs0KmldICYgMHhGRkZGRkZGRiApOw0KICAgICAgICAgICAgICAgIC8vbWl4W2orOF0gPSBmbnYobWl4W2orOF0sIGRhdGFTZXRMb29rdXBbNCppICsgMV0gJiAweEZGRkZGRkZGICk7DQogICAgICAgICAgICAgICAgLy9taXhbaisxNl0gPSBmbnYobWl4W2orMTZdLCBkYXRhU2V0TG9va3VwWzQqaSArIDJdICYgMHhGRkZGRkZGRiApOyAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvL21peFtqKzI0XSA9IGZudihtaXhbaisyNF0sIGRhdGFTZXRMb29rdXBbNCppICsgM10gJiAweEZGRkZGRkZGICk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy9kYXRhU2V0TG9va3VwWzQqaSAgICBdID0gZGF0YVNldExvb2t1cFs0KmkgICAgXS8oMioqMzIpOw0KICAgICAgICAgICAgICAgIC8vZGF0YVNldExvb2t1cFs0KmkgKyAxXSA9IGRhdGFTZXRMb29rdXBbNCppICsgMV0vKDIqKjMyKTsNCiAgICAgICAgICAgICAgICAvL2RhdGFTZXRMb29rdXBbNCppICsgMl0gPSBkYXRhU2V0TG9va3VwWzQqaSArIDJdLygyKiozMik7DQogICAgICAgICAgICAgICAgLy9kYXRhU2V0TG9va3VwWzQqaSArIDNdID0gZGF0YVNldExvb2t1cFs0KmkgKyAzXS8oMioqMzIpOyAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBhc3NlbWJseXsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG9mZnNldCA6PSBhZGQoYWRkKGRhdGFTZXRMb29rdXAsMHgyMCksbXVsKGksMHg4MCkpDQogICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSAgOj0gZGl2KG1sb2FkKG9mZnNldCksMHgxMDAwMDAwMDApDQogICAgICAgICAgICAgICAgICAgIG1zdG9yZShvZmZzZXQsdmFsdWUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0IDo9IGFkZChvZmZzZXQsMHgyMCkNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgIDo9IGRpdihtbG9hZChvZmZzZXQpLDB4MTAwMDAwMDAwKQ0KICAgICAgICAgICAgICAgICAgICBtc3RvcmUob2Zmc2V0LHZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0IDo9IGFkZChvZmZzZXQsMHgyMCkNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgIDo9IGRpdihtbG9hZChvZmZzZXQpLDB4MTAwMDAwMDAwKQ0KICAgICAgICAgICAgICAgICAgICBtc3RvcmUob2Zmc2V0LHZhbHVlKSAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBvZmZzZXQgOj0gYWRkKG9mZnNldCwweDIwKQ0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSAgOj0gZGl2KG1sb2FkKG9mZnNldCksMHgxMDAwMDAwMDApDQogICAgICAgICAgICAgICAgICAgIG1zdG9yZShvZmZzZXQsdmFsdWUpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgZm9yKCBpID0gMCA7IGkgPCAzMiA7IGkgKz0gNCkgew0KICAgICAgICAgICAgY21peFtpLzRdID0gKGZudihmbnYoZm52KG1peFtpXSwgbWl4W2krMV0pLCBtaXhbaSsyXSksIG1peFtpKzNdKSk7DQogICAgICAgIH0NCiAgICAgICAgDQoNCiAgICAgICAgdWludCByZXN1bHQgPSBjb21wdXRlU2hhMyhzLGNtaXgpOyANCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICANCiAgICB9DQp9DQoNCi8qKg0KKiBAdGl0bGUgUkxQUmVhZGVyDQoqDQoqIFJMUFJlYWRlciBpcyB1c2VkIHRvIHJlYWQgYW5kIHBhcnNlIFJMUCBlbmNvZGVkIGRhdGEgaW4gbWVtb3J5Lg0KKg0KKiBAYXV0aG9yIEFuZHJlYXMgT2xvZnNzb24gKGFuZHJvbG8xOTgwQGdtYWlsLmNvbSkNCiovDQpsaWJyYXJ5IFJMUCB7DQoNCiB1aW50IGNvbnN0YW50IERBVEFfU0hPUlRfU1RBUlQgPSAweDgwOw0KIHVpbnQgY29uc3RhbnQgREFUQV9MT05HX1NUQVJUID0gMHhCODsNCiB1aW50IGNvbnN0YW50IExJU1RfU0hPUlRfU1RBUlQgPSAweEMwOw0KIHVpbnQgY29uc3RhbnQgTElTVF9MT05HX1NUQVJUID0gMHhGODsNCg0KIHVpbnQgY29uc3RhbnQgREFUQV9MT05HX09GRlNFVCA9IDB4Qjc7DQogdWludCBjb25zdGFudCBMSVNUX0xPTkdfT0ZGU0VUID0gMHhGNzsNCg0KDQogc3RydWN0IFJMUEl0ZW0gew0KICAgICB1aW50IF91bnNhZmVfbWVtUHRyOyAgICAvLyBQb2ludGVyIHRvIHRoZSBSTFAtZW5jb2RlZCBieXRlcy4NCiAgICAgdWludCBfdW5zYWZlX2xlbmd0aDsgICAgLy8gTnVtYmVyIG9mIGJ5dGVzLiBUaGlzIGlzIHRoZSBmdWxsIGxlbmd0aCBvZiB0aGUgc3RyaW5nLg0KIH0NCg0KIHN0cnVjdCBJdGVyYXRvciB7DQogICAgIFJMUEl0ZW0gX3Vuc2FmZV9pdGVtOyAgIC8vIEl0ZW0gdGhhdCdzIGJlaW5nIGl0ZXJhdGVkIG92ZXIuDQogICAgIHVpbnQgX3Vuc2FmZV9uZXh0UHRyOyAgIC8vIFBvc2l0aW9uIG9mIHRoZSBuZXh0IGl0ZW0gaW4gdGhlIGxpc3QuDQogfQ0KDQogLyogSXRlcmF0b3IgKi8NCg0KIGZ1bmN0aW9uIG5leHQoSXRlcmF0b3IgbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5IHN1Ykl0ZW0pIHsNCiAgICAgaWYoaGFzTmV4dChzZWxmKSkgew0KICAgICAgICAgdmFyIHB0ciA9IHNlbGYuX3Vuc2FmZV9uZXh0UHRyOw0KICAgICAgICAgdmFyIGl0ZW1MZW5ndGggPSBfaXRlbUxlbmd0aChwdHIpOw0KICAgICAgICAgc3ViSXRlbS5fdW5zYWZlX21lbVB0ciA9IHB0cjsNCiAgICAgICAgIHN1Ykl0ZW0uX3Vuc2FmZV9sZW5ndGggPSBpdGVtTGVuZ3RoOw0KICAgICAgICAgc2VsZi5fdW5zYWZlX25leHRQdHIgPSBwdHIgKyBpdGVtTGVuZ3RoOw0KICAgICB9DQogICAgIGVsc2UNCiAgICAgICAgIHRocm93Ow0KIH0NCg0KIGZ1bmN0aW9uIG5leHQoSXRlcmF0b3IgbWVtb3J5IHNlbGYsIGJvb2wgc3RyaWN0KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSBzdWJJdGVtKSB7DQogICAgIHN1Ykl0ZW0gPSBuZXh0KHNlbGYpOw0KICAgICBpZihzdHJpY3QgJiYgIV92YWxpZGF0ZShzdWJJdGVtKSkNCiAgICAgICAgIHRocm93Ow0KICAgICByZXR1cm47DQogfQ0KDQogZnVuY3Rpb24gaGFzTmV4dChJdGVyYXRvciBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICB2YXIgaXRlbSA9IHNlbGYuX3Vuc2FmZV9pdGVtOw0KICAgICByZXR1cm4gc2VsZi5fdW5zYWZlX25leHRQdHIgPCBpdGVtLl91bnNhZmVfbWVtUHRyICsgaXRlbS5fdW5zYWZlX2xlbmd0aDsNCiB9DQoNCiAvKiBSTFBJdGVtICovDQoNCiAvLy8gQGRldiBDcmVhdGVzIGFuIFJMUEl0ZW0gZnJvbSBhbiBhcnJheSBvZiBSTFAgZW5jb2RlZCBieXRlcy4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBlbmNvZGVkIGJ5dGVzLg0KIC8vLyBAcmV0dXJuIEFuIFJMUEl0ZW0NCiBmdW5jdGlvbiB0b1JMUEl0ZW0oYnl0ZXMgbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5KSB7DQogICAgIHVpbnQgbGVuID0gc2VsZi5sZW5ndGg7DQogICAgIGlmIChsZW4gPT0gMCkgew0KICAgICAgICAgcmV0dXJuIFJMUEl0ZW0oMCwgMCk7DQogICAgIH0NCiAgICAgdWludCBtZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIG1lbVB0ciA6PSBhZGQoc2VsZiwgMHgyMCkNCiAgICAgfQ0KICAgICByZXR1cm4gUkxQSXRlbShtZW1QdHIsIGxlbik7DQogfQ0KDQogLy8vIEBkZXYgQ3JlYXRlcyBhbiBSTFBJdGVtIGZyb20gYW4gYXJyYXkgb2YgUkxQIGVuY29kZWQgYnl0ZXMuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgZW5jb2RlZCBieXRlcy4NCiAvLy8gQHBhcmFtIHN0cmljdCBXaWxsIHRocm93IGlmIHRoZSBkYXRhIGlzIG5vdCBSTFAgZW5jb2RlZC4NCiAvLy8gQHJldHVybiBBbiBSTFBJdGVtDQogZnVuY3Rpb24gdG9STFBJdGVtKGJ5dGVzIG1lbW9yeSBzZWxmLCBib29sIHN0cmljdCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoUkxQSXRlbSBtZW1vcnkpIHsNCiAgICAgdmFyIGl0ZW0gPSB0b1JMUEl0ZW0oc2VsZik7DQogICAgIGlmKHN0cmljdCkgew0KICAgICAgICAgdWludCBsZW4gPSBzZWxmLmxlbmd0aDsNCiAgICAgICAgIGlmKF9wYXlsb2FkT2Zmc2V0KGl0ZW0pID4gbGVuKQ0KICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgaWYoX2l0ZW1MZW5ndGgoaXRlbS5fdW5zYWZlX21lbVB0cikgIT0gbGVuKQ0KICAgICAgICAgICAgIHRocm93Ow0KICAgICAgICAgaWYoIV92YWxpZGF0ZShpdGVtKSkNCiAgICAgICAgICAgICB0aHJvdzsNCiAgICAgfQ0KICAgICByZXR1cm4gaXRlbTsNCiB9DQoNCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgbnVsbC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLg0KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBudWxsLg0KIGZ1bmN0aW9uIGlzTnVsbChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgew0KICAgICByZXR1cm4gc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwOw0KIH0NCg0KIC8vLyBAZGV2IENoZWNrIGlmIHRoZSBSTFAgaXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgYSBsaXN0Lg0KIGZ1bmN0aW9uIGlzTGlzdChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgew0KICAgICBpZiAoc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwKQ0KICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIHJldCA6PSBpc3plcm8obHQoYnl0ZSgwLCBtbG9hZChtZW1QdHIpKSwgMHhDMCkpDQogICAgIH0NCiB9DQoNCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgZGF0YS4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLg0KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBkYXRhLg0KIGZ1bmN0aW9uIGlzRGF0YShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgew0KICAgICBpZiAoc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwKQ0KICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIHJldCA6PSBsdChieXRlKDAsIG1sb2FkKG1lbVB0cikpLCAweEMwKQ0KICAgICB9DQogfQ0KDQogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIGVtcHR5IChzdHJpbmcgb3IgbGlzdCkuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgbnVsbC4NCiBmdW5jdGlvbiBpc0VtcHR5KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmV0KSB7DQogICAgIGlmKGlzTnVsbChzZWxmKSkNCiAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgdWludCBiMDsNCiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpDQogICAgIH0NCiAgICAgcmV0dXJuIChiMCA9PSBEQVRBX1NIT1JUX1NUQVJUIHx8IGIwID09IExJU1RfU0hPUlRfU1RBUlQpOw0KIH0NCg0KIC8vLyBAZGV2IEdldCB0aGUgbnVtYmVyIG9mIGl0ZW1zIGluIGFuIFJMUCBlbmNvZGVkIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4NCiAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIGl0ZW1zLg0KIGZ1bmN0aW9uIGl0ZW1zKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgaWYgKCFpc0xpc3Qoc2VsZikpDQogICAgICAgICByZXR1cm4gMDsNCiAgICAgdWludCBiMDsNCiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpDQogICAgIH0NCiAgICAgdWludCBwb3MgPSBtZW1QdHIgKyBfcGF5bG9hZE9mZnNldChzZWxmKTsNCiAgICAgdWludCBsYXN0ID0gbWVtUHRyICsgc2VsZi5fdW5zYWZlX2xlbmd0aCAtIDE7DQogICAgIHVpbnQgaXRtczsNCiAgICAgd2hpbGUocG9zIDw9IGxhc3QpIHsNCiAgICAgICAgIHBvcyArPSBfaXRlbUxlbmd0aChwb3MpOw0KICAgICAgICAgaXRtcysrOw0KICAgICB9DQogICAgIHJldHVybiBpdG1zOw0KIH0NCg0KIC8vLyBAZGV2IENyZWF0ZSBhbiBpdGVyYXRvci4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLg0KIC8vLyBAcmV0dXJuIEFuICdJdGVyYXRvcicgb3ZlciB0aGUgaXRlbS4NCiBmdW5jdGlvbiBpdGVyYXRvcihSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChJdGVyYXRvciBtZW1vcnkgaXQpIHsNCiAgICAgaWYgKCFpc0xpc3Qoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdWludCBwdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyICsgX3BheWxvYWRPZmZzZXQoc2VsZik7DQogICAgIGl0Ll91bnNhZmVfaXRlbSA9IHNlbGY7DQogICAgIGl0Ll91bnNhZmVfbmV4dFB0ciA9IHB0cjsNCiB9DQoNCiAvLy8gQGRldiBSZXR1cm4gdGhlIFJMUCBlbmNvZGVkIGJ5dGVzLg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgYnl0ZXMuDQogZnVuY3Rpb24gdG9CeXRlcyhSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlcyBtZW1vcnkgYnRzKSB7DQogICAgIHZhciBsZW4gPSBzZWxmLl91bnNhZmVfbGVuZ3RoOw0KICAgICBpZiAobGVuID09IDApDQogICAgICAgICByZXR1cm47DQogICAgIGJ0cyA9IG5ldyBieXRlcyhsZW4pOw0KICAgICBfY29weVRvQnl0ZXMoc2VsZi5fdW5zYWZlX21lbVB0ciwgYnRzLCBsZW4pOw0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYnl0ZXMuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0RhdGEoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMgbWVtb3J5IGJ0cykgew0KICAgICBpZighaXNEYXRhKHNlbGYpKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsNCiAgICAgYnRzID0gbmV3IGJ5dGVzKGxlbik7DQogICAgIF9jb3B5VG9CeXRlcyhyU3RhcnRQb3MsIGJ0cywgbGVuKTsNCiB9DQoNCiAvLy8gQGRldiBHZXQgdGhlIGxpc3Qgb2Ygc3ViLWl0ZW1zIGZyb20gYW4gUkxQIGVuY29kZWQgbGlzdC4NCiAvLy8gV2FybmluZzogVGhpcyBpcyBpbmVmZmljaWVudCwgYXMgaXQgcmVxdWlyZXMgdGhhdCB0aGUgbGlzdCBpcyByZWFkIHR3aWNlLg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uDQogLy8vIEByZXR1cm4gQXJyYXkgb2YgUkxQSXRlbXMuDQogZnVuY3Rpb24gdG9MaXN0KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW1bXSBtZW1vcnkgbGlzdCkgew0KICAgICBpZighaXNMaXN0KHNlbGYpKQ0KICAgICAgICAgdGhyb3c7DQogICAgIHZhciBudW1JdGVtcyA9IGl0ZW1zKHNlbGYpOw0KICAgICBsaXN0ID0gbmV3IFJMUEl0ZW1bXShudW1JdGVtcyk7DQogICAgIHZhciBpdCA9IGl0ZXJhdG9yKHNlbGYpOw0KICAgICB1aW50IGlkeDsNCiAgICAgd2hpbGUoaGFzTmV4dChpdCkpIHsNCiAgICAgICAgIGxpc3RbaWR4XSA9IG5leHQoaXQpOw0KICAgICAgICAgaWR4Kys7DQogICAgIH0NCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGFzY2lpIHN0cmluZy4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvQXNjaWkoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIG1lbW9yeSBzdHIpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGJ5dGVzIG1lbW9yeSBidHMgPSBuZXcgYnl0ZXMobGVuKTsNCiAgICAgX2NvcHlUb0J5dGVzKHJTdGFydFBvcywgYnRzLCBsZW4pOw0KICAgICBzdHIgPSBzdHJpbmcoYnRzKTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGEgdWludC4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvVWludChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50IGRhdGEpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGlmIChsZW4gPiAzMiB8fCBsZW4gPT0gMCkNCiAgICAgICAgIHRocm93Ow0KICAgICBhc3NlbWJseSB7DQogICAgICAgICBkYXRhIDo9IGRpdihtbG9hZChyU3RhcnRQb3MpLCBleHAoMjU2LCBzdWIoMzIsIGxlbikpKQ0KICAgICB9DQogfQ0KDQogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIGJvb2xlYW4uIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUNCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuDQogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLg0KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4NCiBmdW5jdGlvbiB0b0Jvb2woUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBkYXRhKSB7DQogICAgIGlmKCFpc0RhdGEoc2VsZikpDQogICAgICAgICB0aHJvdzsNCiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOw0KICAgICBpZiAobGVuICE9IDEpDQogICAgICAgICB0aHJvdzsNCiAgICAgdWludCB0ZW1wOw0KICAgICBhc3NlbWJseSB7DQogICAgICAgICB0ZW1wIDo9IGJ5dGUoMCwgbWxvYWQoclN0YXJ0UG9zKSkNCiAgICAgfQ0KICAgICBpZiAodGVtcCA+IDEpDQogICAgICAgICB0aHJvdzsNCiAgICAgcmV0dXJuIHRlbXAgPT0gMSA/IHRydWUgOiBmYWxzZTsNCiB9DQoNCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGEgYnl0ZS4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvQnl0ZShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlIGRhdGEpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGlmIChsZW4gIT0gMSkNCiAgICAgICAgIHRocm93Ow0KICAgICB1aW50IHRlbXA7DQogICAgIGFzc2VtYmx5IHsNCiAgICAgICAgIHRlbXAgOj0gYnl0ZSgwLCBtbG9hZChyU3RhcnRQb3MpKQ0KICAgICB9DQogICAgIHJldHVybiBieXRlKHRlbXApOw0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYW4gaW50LiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlDQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuDQogZnVuY3Rpb24gdG9JbnQoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoaW50IGRhdGEpIHsNCiAgICAgcmV0dXJuIGludCh0b1VpbnQoc2VsZikpOw0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYSBieXRlczMyLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlDQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0Lg0KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4NCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuDQogZnVuY3Rpb24gdG9CeXRlczMyKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIgZGF0YSkgew0KICAgICByZXR1cm4gYnl0ZXMzMih0b1VpbnQoc2VsZikpOw0KIH0NCg0KIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYW4gYWRkcmVzcy4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQ0KIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4NCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uDQogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLg0KIGZ1bmN0aW9uIHRvQWRkcmVzcyhSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIGRhdGEpIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7DQogICAgIGlmIChsZW4gIT0gMjApDQogICAgICAgICB0aHJvdzsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgZGF0YSA6PSBkaXYobWxvYWQoclN0YXJ0UG9zKSwgZXhwKDI1NiwgMTIpKQ0KICAgICB9DQogfQ0KDQogLy8gR2V0IHRoZSBwYXlsb2FkIG9mZnNldC4NCiBmdW5jdGlvbiBfcGF5bG9hZE9mZnNldChSTFBJdGVtIG1lbW9yeSBzZWxmKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgaWYoc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwKQ0KICAgICAgICAgcmV0dXJuIDA7DQogICAgIHVpbnQgYjA7DQogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICB9DQogICAgIGlmKGIwIDwgREFUQV9TSE9SVF9TVEFSVCkNCiAgICAgICAgIHJldHVybiAwOw0KICAgICBpZihiMCA8IERBVEFfTE9OR19TVEFSVCB8fCAoYjAgPj0gTElTVF9TSE9SVF9TVEFSVCAmJiBiMCA8IExJU1RfTE9OR19TVEFSVCkpDQogICAgICAgICByZXR1cm4gMTsNCiAgICAgaWYoYjAgPCBMSVNUX1NIT1JUX1NUQVJUKQ0KICAgICAgICAgcmV0dXJuIGIwIC0gREFUQV9MT05HX09GRlNFVCArIDE7DQogICAgIHJldHVybiBiMCAtIExJU1RfTE9OR19PRkZTRVQgKyAxOw0KIH0NCg0KIC8vIEdldCB0aGUgZnVsbCBsZW5ndGggb2YgYW4gUkxQIGl0ZW0uDQogZnVuY3Rpb24gX2l0ZW1MZW5ndGgodWludCBtZW1QdHIpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCBsZW4pIHsNCiAgICAgdWludCBiMDsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQ0KICAgICB9DQogICAgIGlmIChiMCA8IERBVEFfU0hPUlRfU1RBUlQpDQogICAgICAgICBsZW4gPSAxOw0KICAgICBlbHNlIGlmIChiMCA8IERBVEFfTE9OR19TVEFSVCkNCiAgICAgICAgIGxlbiA9IGIwIC0gREFUQV9TSE9SVF9TVEFSVCArIDE7DQogICAgIGVsc2UgaWYgKGIwIDwgTElTVF9TSE9SVF9TVEFSVCkgew0KICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgIGxldCBiTGVuIDo9IHN1YihiMCwgMHhCNykgLy8gYnl0ZXMgbGVuZ3RoIChEQVRBX0xPTkdfT0ZGU0VUKQ0KICAgICAgICAgICAgIGxldCBkTGVuIDo9IGRpdihtbG9hZChhZGQobWVtUHRyLCAxKSksIGV4cCgyNTYsIHN1YigzMiwgYkxlbikpKSAvLyBkYXRhIGxlbmd0aA0KICAgICAgICAgICAgIGxlbiA6PSBhZGQoMSwgYWRkKGJMZW4sIGRMZW4pKSAvLyB0b3RhbCBsZW5ndGgNCiAgICAgICAgIH0NCiAgICAgfQ0KICAgICBlbHNlIGlmIChiMCA8IExJU1RfTE9OR19TVEFSVCkNCiAgICAgICAgIGxlbiA9IGIwIC0gTElTVF9TSE9SVF9TVEFSVCArIDE7DQogICAgIGVsc2Ugew0KICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgIGxldCBiTGVuIDo9IHN1YihiMCwgMHhGNykgLy8gYnl0ZXMgbGVuZ3RoIChMSVNUX0xPTkdfT0ZGU0VUKQ0KICAgICAgICAgICAgIGxldCBkTGVuIDo9IGRpdihtbG9hZChhZGQobWVtUHRyLCAxKSksIGV4cCgyNTYsIHN1YigzMiwgYkxlbikpKSAvLyBkYXRhIGxlbmd0aA0KICAgICAgICAgICAgIGxlbiA6PSBhZGQoMSwgYWRkKGJMZW4sIGRMZW4pKSAvLyB0b3RhbCBsZW5ndGgNCiAgICAgICAgIH0NCiAgICAgfQ0KIH0NCg0KIC8vIEdldCBzdGFydCBwb3NpdGlvbiBhbmQgbGVuZ3RoIG9mIHRoZSBkYXRhLg0KIGZ1bmN0aW9uIF9kZWNvZGUoUkxQSXRlbSBtZW1vcnkgc2VsZikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50IG1lbVB0ciwgdWludCBsZW4pIHsNCiAgICAgaWYoIWlzRGF0YShzZWxmKSkNCiAgICAgICAgIHRocm93Ow0KICAgICB1aW50IGIwOw0KICAgICB1aW50IHN0YXJ0ID0gc2VsZi5fdW5zYWZlX21lbVB0cjsNCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChzdGFydCkpDQogICAgIH0NCiAgICAgaWYgKGIwIDwgREFUQV9TSE9SVF9TVEFSVCkgew0KICAgICAgICAgbWVtUHRyID0gc3RhcnQ7DQogICAgICAgICBsZW4gPSAxOw0KICAgICAgICAgcmV0dXJuOw0KICAgICB9DQogICAgIGlmIChiMCA8IERBVEFfTE9OR19TVEFSVCkgew0KICAgICAgICAgbGVuID0gc2VsZi5fdW5zYWZlX2xlbmd0aCAtIDE7DQogICAgICAgICBtZW1QdHIgPSBzdGFydCArIDE7DQogICAgIH0gZWxzZSB7DQogICAgICAgICB1aW50IGJMZW47DQogICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgYkxlbiA6PSBzdWIoYjAsIDB4QjcpIC8vIERBVEFfTE9OR19PRkZTRVQNCiAgICAgICAgIH0NCiAgICAgICAgIGxlbiA9IHNlbGYuX3Vuc2FmZV9sZW5ndGggLSAxIC0gYkxlbjsNCiAgICAgICAgIG1lbVB0ciA9IHN0YXJ0ICsgYkxlbiArIDE7DQogICAgIH0NCiAgICAgcmV0dXJuOw0KIH0NCg0KIC8vIEFzc3VtZXMgdGhhdCBlbm91Z2ggbWVtb3J5IGhhcyBiZWVuIGFsbG9jYXRlZCB0byBzdG9yZSBpbiB0YXJnZXQuDQogZnVuY3Rpb24gX2NvcHlUb0J5dGVzKHVpbnQgYnRzUHRyLCBieXRlcyBtZW1vcnkgdGd0LCB1aW50IGJ0c0xlbikgcHJpdmF0ZSBjb25zdGFudCB7DQogICAgIC8vIEV4cGxvaXRpbmcgdGhlIGZhY3QgdGhhdCAndGd0JyB3YXMgdGhlIGxhc3QgdGhpbmcgdG8gYmUgYWxsb2NhdGVkLA0KICAgICAvLyB3ZSBjYW4gd3JpdGUgZW50aXJlIHdvcmRzLCBhbmQganVzdCBvdmVyd3JpdGUgYW55IGV4Y2Vzcy4NCiAgICAgYXNzZW1ibHkgew0KICAgICAgICAgew0KICAgICAgICAgICAgICAgICBsZXQgaSA6PSAwIC8vIFN0YXJ0IGF0IGFyciArIDB4MjANCiAgICAgICAgICAgICAgICAgbGV0IHdvcmRzIDo9IGRpdihhZGQoYnRzTGVuLCAzMSksIDMyKQ0KICAgICAgICAgICAgICAgICBsZXQgck9mZnNldCA6PSBidHNQdHINCiAgICAgICAgICAgICAgICAgbGV0IHdPZmZzZXQgOj0gYWRkKHRndCwgMHgyMCkNCiAgICAgICAgICAgICB0YWdfbG9vcDoNCiAgICAgICAgICAgICAgICAganVtcGkoZW5kLCBlcShpLCB3b3JkcykpDQogICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgOj0gbXVsKGksIDB4MjApDQogICAgICAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHdPZmZzZXQsIG9mZnNldCksIG1sb2FkKGFkZChyT2Zmc2V0LCBvZmZzZXQpKSkNCiAgICAgICAgICAgICAgICAgICAgIGkgOj0gYWRkKGksIDEpDQogICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAganVtcCh0YWdfbG9vcCkNCiAgICAgICAgICAgICBlbmQ6DQogICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodGd0LCBhZGQoMHgyMCwgbWxvYWQodGd0KSkpLCAwKQ0KICAgICAgICAgfQ0KICAgICB9DQogfQ0KDQogICAgIC8vIENoZWNrIHRoYXQgYW4gUkxQIGl0ZW0gaXMgdmFsaWQuDQogICAgIGZ1bmN0aW9uIF92YWxpZGF0ZShSTFBJdGVtIG1lbW9yeSBzZWxmKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmV0KSB7DQogICAgICAgICAvLyBDaGVjayB0aGF0IFJMUCBpcyB3ZWxsLWZvcm1lZC4NCiAgICAgICAgIHVpbnQgYjA7DQogICAgICAgICB1aW50IGIxOw0KICAgICAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOw0KICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkNCiAgICAgICAgICAgICBiMSA6PSBieXRlKDEsIG1sb2FkKG1lbVB0cikpDQogICAgICAgICB9DQogICAgICAgICBpZihiMCA9PSBEQVRBX1NIT1JUX1NUQVJUICsgMSAmJiBiMSA8IERBVEFfU0hPUlRfU1RBUlQpDQogICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgIH0NCn0NCg0KDQoNCg0KY29udHJhY3QgQWd0IHsNCiAgICB1c2luZyBSTFAgZm9yIFJMUC5STFBJdGVtOw0KICAgIHVzaW5nIFJMUCBmb3IgUkxQLkl0ZXJhdG9yOw0KICAgIHVzaW5nIFJMUCBmb3IgYnl0ZXM7DQogDQogICAgc3RydWN0IEJsb2NrSGVhZGVyIHsNCiAgICAgICAgdWludCAgICAgICBwcmV2QmxvY2tIYXNoOyAvLyAwDQogICAgICAgIHVpbnQgICAgICAgY29pbmJhc2U7ICAgICAgLy8gMQ0KICAgICAgICB1aW50ICAgICAgIGJsb2NrTnVtYmVyOyAgIC8vIDgNCiAgICAgICAgLy91aW50ICAgICAgIGdhc1VzZWQ7ICAgICAgIC8vIDEwDQogICAgICAgIHVpbnQgICAgICAgdGltZXN0YW1wOyAgICAgLy8gMTENCiAgICAgICAgYnl0ZXMzMiAgICBleHRyYURhdGE7ICAgICAvLyAxMg0KICAgIH0NCiANCiAgICBmdW5jdGlvbiBBZ3QoKSB7fQ0KICAgICANCiAgICBmdW5jdGlvbiBwYXJzZUJsb2NrSGVhZGVyKCBieXRlcyBybHBIZWFkZXIgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKEJsb2NrSGVhZGVyKSB7DQogICAgICAgIEJsb2NrSGVhZGVyIG1lbW9yeSBoZWFkZXI7DQogICAgICAgIA0KICAgICAgICB2YXIgaXQgPSBybHBIZWFkZXIudG9STFBJdGVtKCkuaXRlcmF0b3IoKTsgICAgICAgIA0KICAgICAgICB1aW50IGlkeDsNCiAgICAgICAgd2hpbGUoaXQuaGFzTmV4dCgpKSB7DQogICAgICAgICAgICBpZiggaWR4ID09IDAgKSBoZWFkZXIucHJldkJsb2NrSGFzaCA9IGl0Lm5leHQoKS50b1VpbnQoKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKCBpZHggPT0gMiApIGhlYWRlci5jb2luYmFzZSA9IGl0Lm5leHQoKS50b1VpbnQoKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKCBpZHggPT0gOCApIGhlYWRlci5ibG9ja051bWJlciA9IGl0Lm5leHQoKS50b1VpbnQoKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKCBpZHggPT0gMTEgKSBoZWFkZXIudGltZXN0YW1wID0gaXQubmV4dCgpLnRvVWludCgpOw0KICAgICAgICAgICAgZWxzZSBpZiAoIGlkeCA9PSAxMiApIGhlYWRlci5leHRyYURhdGEgPSBieXRlczMyKGl0Lm5leHQoKS50b1VpbnQoKSk7DQogICAgICAgICAgICBlbHNlIGl0Lm5leHQoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWR4Kys7DQogICAgICAgIH0NCiANCiAgICAgICAgcmV0dXJuIGhlYWRlcjsgICAgICAgIA0KICAgIH0NCiAgICAgICAgICAgIA0KICAgIC8vZXZlbnQgVmVyaWZ5QWd0KCBzdHJpbmcgbXNnLCB1aW50IGluZGV4ICk7DQogICAgZXZlbnQgVmVyaWZ5QWd0KCB1aW50IGVycm9yLCB1aW50IGluZGV4ICk7ICAgIA0KICAgIA0KICAgIHN0cnVjdCBWZXJpZnlBZ3REYXRhIHsNCiAgICAgICAgdWludCByb290SGFzaDsNCiAgICAgICAgdWludCByb290TWluOw0KICAgICAgICB1aW50IHJvb3RNYXg7DQogICAgICAgIA0KICAgICAgICB1aW50IGxlYWZIYXNoOw0KICAgICAgICB1aW50IGxlYWZDb3VudGVyOyAgICAgICAgDQogICAgfQ0KDQogICAgZnVuY3Rpb24gdmVyaWZ5QWd0KCBWZXJpZnlBZ3REYXRhIGRhdGEsDQogICAgICAgICAgICAgICAgICAgICAgICB1aW50ICAgYnJhbmNoSW5kZXgsDQogICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gY291bnRlcnNCcmFuY2gsDQogICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gaGFzaGVzQnJhbmNoICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgdWludCBjdXJyZW50SGFzaCA9IGRhdGEubGVhZkhhc2ggJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICANCiAgICAgICAgdWludCBsZWZ0Q291bnRlck1pbjsNCiAgICAgICAgdWludCBsZWZ0Q291bnRlck1heDsgICAgICAgIA0KICAgICAgICB1aW50IGxlZnRIYXNoOw0KICAgICAgICANCiAgICAgICAgdWludCByaWdodENvdW50ZXJNaW47DQogICAgICAgIHVpbnQgcmlnaHRDb3VudGVyTWF4OyAgICAgICAgDQogICAgICAgIHVpbnQgcmlnaHRIYXNoOw0KICAgICAgICANCiAgICAgICAgdWludCBtaW4gPSBkYXRhLmxlYWZDb3VudGVyOw0KICAgICAgICB1aW50IG1heCA9IGRhdGEubGVhZkNvdW50ZXI7DQogICAgICAgIA0KICAgICAgICBmb3IoIHVpbnQgaSA9IDAgOyBpIDwgY291bnRlcnNCcmFuY2gubGVuZ3RoIDsgaSsrICkgew0KICAgICAgICAgICAgaWYoIGJyYW5jaEluZGV4ICYgMHgxID4gMCApIHsNCiAgICAgICAgICAgICAgICBsZWZ0Q291bnRlck1pbiA9IGNvdW50ZXJzQnJhbmNoW2ldICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsNCiAgICAgICAgICAgICAgICBsZWZ0Q291bnRlck1heCA9IGNvdW50ZXJzQnJhbmNoW2ldID4+IDEyODsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGVmdEhhc2ggICAgPSBoYXNoZXNCcmFuY2hbaV07DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcmlnaHRDb3VudGVyTWluID0gbWluOw0KICAgICAgICAgICAgICAgIHJpZ2h0Q291bnRlck1heCA9IG1heDsNCiAgICAgICAgICAgICAgICByaWdodEhhc2ggICAgPSBjdXJyZW50SGFzaDsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGVmdENvdW50ZXJNaW4gPSBtaW47DQogICAgICAgICAgICAgICAgbGVmdENvdW50ZXJNYXggPSBtYXg7DQogICAgICAgICAgICAgICAgbGVmdEhhc2ggICAgPSBjdXJyZW50SGFzaDsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICByaWdodENvdW50ZXJNaW4gPSBjb3VudGVyc0JyYW5jaFtpXSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7DQogICAgICAgICAgICAgICAgcmlnaHRDb3VudGVyTWF4ID0gY291bnRlcnNCcmFuY2hbaV0gPj4gMTI4OyAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICByaWdodEhhc2ggICAgPSBoYXNoZXNCcmFuY2hbaV07ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY3VycmVudEhhc2ggPSB1aW50KHNoYTMobGVmdENvdW50ZXJNaW4gKyAobGVmdENvdW50ZXJNYXggPDwgMTI4KSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRIYXNoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHRDb3VudGVyTWluICsgKHJpZ2h0Q291bnRlck1heCA8PCAxMjgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHRIYXNoKSkgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiggKGxlZnRDb3VudGVyTWluID49IGxlZnRDb3VudGVyTWF4KSB8fCAocmlnaHRDb3VudGVyTWluID49IHJpZ2h0Q291bnRlck1heCkgKSB7DQogICAgICAgICAgICAgICAgaWYoIGkgPiAwICkgew0KICAgICAgICAgICAgICAgICAgICAvL1ZlcmlmeUFndCggImNvdW50ZXJzIG1pc21hdGNoIixpKTsNCiAgICAgICAgICAgICAgICAgICAgVmVyaWZ5QWd0KCAweDgwMDAwMDAwLCBpICk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoIGxlZnRDb3VudGVyTWluID4gbGVmdENvdW50ZXJNYXggKSB7DQogICAgICAgICAgICAgICAgICAgIC8vVmVyaWZ5QWd0KCAiY291bnRlcnMgbWlzbWF0Y2giLGkpOw0KICAgICAgICAgICAgICAgICAgICBWZXJpZnlBZ3QoIDB4ODAwMDAwMDEsIGkgKTsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoIHJpZ2h0Q291bnRlck1pbiA+IHJpZ2h0Q291bnRlck1heCApIHsNCiAgICAgICAgICAgICAgICAgICAgLy9WZXJpZnlBZ3QoICJjb3VudGVycyBtaXNtYXRjaCIsaSk7DQogICAgICAgICAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwMiwgaSApOyAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCBsZWZ0Q291bnRlck1heCA+PSByaWdodENvdW50ZXJNaW4gKSB7DQogICAgICAgICAgICAgICAgVmVyaWZ5QWd0KCAweDgwMDAwMDA5LCBpICk7ICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBtaW4gPSBsZWZ0Q291bnRlck1pbjsNCiAgICAgICAgICAgIG1heCA9IHJpZ2h0Q291bnRlck1heDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYnJhbmNoSW5kZXggPSBicmFuY2hJbmRleCAvIDI7DQogICAgICAgIH0NCg0KICAgICAgICBpZiggbWluICE9IGRhdGEucm9vdE1pbiApIHsNCiAgICAgICAgICAgIC8vVmVyaWZ5QWd0KCAibWluIGRvZXMgbm90IG1hdGNoIHJvb3QgbWluIixtaW4pOw0KICAgICAgICAgICAgVmVyaWZ5QWd0KCAweDgwMDAwMDAzLCBtaW4gKTsgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiggbWF4ICE9IGRhdGEucm9vdE1heCApIHsNCiAgICAgICAgICAgIC8vVmVyaWZ5QWd0KCAibWF4IGRvZXMgbm90IG1hdGNoIHJvb3QgbWF4IixtYXgpOw0KICAgICAgICAgICAgVmVyaWZ5QWd0KCAweDgwMDAwMDA0LCBtYXggKTsgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiggY3VycmVudEhhc2ggIT0gZGF0YS5yb290SGFzaCApIHsNCiAgICAgICAgICAgIC8vVmVyaWZ5QWd0KCAiaGFzaCBkb2VzIG5vdCBtYXRjaCByb290IGhhc2giLGN1cnJlbnRIYXNoKTsgICAgICAgIA0KICAgICAgICAgICAgVmVyaWZ5QWd0KCAweDgwMDAwMDA1LCBjdXJyZW50SGFzaCApOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gdmVyaWZ5QWd0RGVidWdGb3JUZXN0aW5nKCB1aW50IHJvb3RIYXNoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCByb290TWluLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCByb290TWF4LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsZWFmSGFzaCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGVhZkNvdW50ZXIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IGJyYW5jaEluZGV4LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIGNvdW50ZXJzQnJhbmNoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIGhhc2hlc0JyYW5jaCApIHJldHVybnMoYm9vbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIFZlcmlmeUFndERhdGEgbWVtb3J5IGRhdGE7DQogICAgICAgIGRhdGEucm9vdEhhc2ggPSByb290SGFzaDsNCiAgICAgICAgZGF0YS5yb290TWluID0gcm9vdE1pbjsNCiAgICAgICAgZGF0YS5yb290TWF4ID0gcm9vdE1heDsNCiAgICAgICAgZGF0YS5sZWFmSGFzaCA9IGxlYWZIYXNoOw0KICAgICAgICBkYXRhLmxlYWZDb3VudGVyID0gbGVhZkNvdW50ZXI7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gdmVyaWZ5QWd0KCBkYXRhLCBicmFuY2hJbmRleCwgY291bnRlcnNCcmFuY2gsIGhhc2hlc0JyYW5jaCApOw0KICAgIH0gICAgICAgICANCn0NCg0KY29udHJhY3QgV2VpZ2h0ZWRTdWJtaXNzaW9uIHsNCiAgICBmdW5jdGlvbiBXZWlnaHRlZFN1Ym1pc3Npb24oKXt9DQogICAgDQogICAgc3RydWN0IFNpbmdsZVN1Ym1pc3Npb25EYXRhIHsNCiAgICAgICAgdWludDEyOCBudW1TaGFyZXM7DQogICAgICAgIHVpbnQxMjggc3VibWlzc2lvblZhbHVlOw0KICAgICAgICB1aW50MTI4IHRvdGFsUHJldmlvdXNTdWJtaXNzaW9uVmFsdWU7DQogICAgICAgIHVpbnQxMjggbWluOw0KICAgICAgICB1aW50MTI4IG1heDsNCiAgICAgICAgdWludDEyOCBhdWdSb290Ow0KICAgIH0NCiAgICANCiAgICBzdHJ1Y3QgU3VibWlzc2lvbk1ldGFEYXRhIHsNCiAgICAgICAgdWludDY0ICBudW1QZW5kaW5nU3VibWlzc2lvbnM7DQogICAgICAgIHVpbnQzMiAgcmVhZHlGb3JWZXJpZmljYXRpb247IC8vIHN1cHBvc2UgdG8gYmUgYm9vbA0KICAgICAgICB1aW50MzIgIGxhc3RTdWJtaXNzaW9uQmxvY2tOdW1iZXI7DQogICAgICAgIHVpbnQxMjggdG90YWxTdWJtaXNzaW9uVmFsdWU7DQogICAgICAgIHVpbnQxMjggZGlmZmljdWx0eTsNCiAgICAgICAgdWludDEyOCBsYXN0Q291bnRlcjsNCiAgICAgICAgDQogICAgICAgIHVpbnQgICAgc3VibWlzc2lvblNlZWQ7DQogICAgICAgIA0KICAgIH0NCiAgICANCiAgICBtYXBwaW5nKGFkZHJlc3M9PlN1Ym1pc3Npb25NZXRhRGF0YSkgc3VibWlzc2lvbnNNZXRhRGF0YTsNCiAgICANCiAgICAvLyAodXNlciwgc3VibWlzc2lvbiBudW1iZXIpPT5kYXRhDQogICAgbWFwcGluZyhhZGRyZXNzPT5tYXBwaW5nKHVpbnQ9PlNpbmdsZVN1Ym1pc3Npb25EYXRhKSkgc3VibWlzc2lvbnNEYXRhOw0KICAgIA0KICAgIGV2ZW50IFN1Ym1pdENsYWltKCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbyApOw0KICAgIGZ1bmN0aW9uIHN1Ym1pdENsYWltKCB1aW50IG51bVNoYXJlcywgdWludCBkaWZmaWN1bHR5LCB1aW50IG1pbiwgdWludCBtYXgsIHVpbnQgYXVnUm9vdCwgYm9vbCBsYXN0Q2xhaW1CZWZvcmVWZXJpZmljYXRpb24gKSB7DQogICAgICAgIFN1Ym1pc3Npb25NZXRhRGF0YSBtZW1vcnkgbWV0YURhdGEgPSBzdWJtaXNzaW9uc01ldGFEYXRhW21zZy5zZW5kZXJdOw0KICAgICAgICANCiAgICAgICAgaWYoIG1ldGFEYXRhLmxhc3RDb3VudGVyID49IG1pbiApIHsNCiAgICAgICAgICAgIC8vIG1pbmVyIGNoZWF0ZWQuIG1pbiBjb3VudGVyIGlzIHRvbyBsb3cNCiAgICAgICAgICAgIFN1Ym1pdENsYWltKCBtc2cuc2VuZGVyLCAweDgxMDAwMDAxLCBtZXRhRGF0YS5sYXN0Q291bnRlciApOyANCiAgICAgICAgICAgIHJldHVybjsgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiggbWV0YURhdGEucmVhZHlGb3JWZXJpZmljYXRpb24gPiAwICkgew0KICAgICAgICAgICAgLy8gbWluZXIgY2hlYXRlZCAtIHNob3VsZCBnbyB2ZXJpZmljYXRpb24gZmlyc3QNCiAgICAgICAgICAgIFN1Ym1pdENsYWltKCBtc2cuc2VuZGVyLCAweDgxMDAwMDAyLCAwICk7IA0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiggbWV0YURhdGEubnVtUGVuZGluZ1N1Ym1pc3Npb25zID4gMCApIHsNCiAgICAgICAgICAgIGlmKCBtZXRhRGF0YS5kaWZmaWN1bHR5ICE9IGRpZmZpY3VsdHkgKSB7DQogICAgICAgICAgICAgICAgLy8gY291bGQgbm90IGNoYW5nZSBkaWZmaWN1bHR5IGJlZm9yZSB2ZXJpZmljYXRpb24NCiAgICAgICAgICAgICAgICBTdWJtaXRDbGFpbSggbXNnLnNlbmRlciwgMHg4MTAwMDAwMywgbWV0YURhdGEuZGlmZmljdWx0eSApOyANCiAgICAgICAgICAgICAgICByZXR1cm47ICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIFNpbmdsZVN1Ym1pc3Npb25EYXRhIG1lbW9yeSBzdWJtaXNzaW9uRGF0YTsNCiAgICAgICAgDQogICAgICAgIHN1Ym1pc3Npb25EYXRhLm51bVNoYXJlcyA9IHVpbnQ2NChudW1TaGFyZXMpOw0KICAgICAgICB1aW50IGJsb2NrRGlmZmljdWx0eTsNCiAgICAgICAgaWYoIGJsb2NrLmRpZmZpY3VsdHkgPT0gMCApIHsNCiAgICAgICAgICAgIC8vIHRlc3RycGMgLSBmYWtlIGluY3JlYXNpbmcgZGlmZmljdWx0eQ0KICAgICAgICAgICAgYmxvY2tEaWZmaWN1bHR5ID0gKDkwMDAwMDAwMCAqIChtZXRhRGF0YS5udW1QZW5kaW5nU3VibWlzc2lvbnMrMSkpOyANCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGJsb2NrRGlmZmljdWx0eSA9IGJsb2NrLmRpZmZpY3VsdHk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHN1Ym1pc3Npb25EYXRhLnN1Ym1pc3Npb25WYWx1ZSA9IHVpbnQxMjgoKHVpbnQobnVtU2hhcmVzICogZGlmZmljdWx0eSkgKiAoNSBldGhlcikpIC8gYmxvY2tEaWZmaWN1bHR5KTsNCiAgICAgICAgDQogICAgICAgIHN1Ym1pc3Npb25EYXRhLnRvdGFsUHJldmlvdXNTdWJtaXNzaW9uVmFsdWUgPSBtZXRhRGF0YS50b3RhbFN1Ym1pc3Npb25WYWx1ZTsNCiAgICAgICAgc3VibWlzc2lvbkRhdGEubWluID0gdWludDEyOChtaW4pOw0KICAgICAgICBzdWJtaXNzaW9uRGF0YS5tYXggPSB1aW50MTI4KG1heCk7DQogICAgICAgIHN1Ym1pc3Npb25EYXRhLmF1Z1Jvb3QgPSB1aW50MTI4KGF1Z1Jvb3QpOw0KICAgICAgICANCiAgICAgICAgKHN1Ym1pc3Npb25zRGF0YVttc2cuc2VuZGVyXSlbbWV0YURhdGEubnVtUGVuZGluZ1N1Ym1pc3Npb25zXSA9IHN1Ym1pc3Npb25EYXRhOw0KICAgICAgICANCiAgICAgICAgLy8gdXBkYXRlIG1ldGEgZGF0YQ0KICAgICAgICBtZXRhRGF0YS5udW1QZW5kaW5nU3VibWlzc2lvbnMrKzsNCiAgICAgICAgbWV0YURhdGEubGFzdFN1Ym1pc3Npb25CbG9ja051bWJlciA9IHVpbnQzMihibG9jay5udW1iZXIpOw0KICAgICAgICBtZXRhRGF0YS5kaWZmaWN1bHR5ID0gdWludDEyOChkaWZmaWN1bHR5KTsNCiAgICAgICAgbWV0YURhdGEubGFzdENvdW50ZXIgPSB1aW50MTI4KG1heCk7DQogICAgICAgIG1ldGFEYXRhLnJlYWR5Rm9yVmVyaWZpY2F0aW9uID0gbGFzdENsYWltQmVmb3JlVmVyaWZpY2F0aW9uID8gdWludDMyKDEpIDogdWludDMyKDApOw0KDQogICAgICAgIHVpbnQxMjggdGVtcDEyODsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICB0ZW1wMTI4ID0gbWV0YURhdGEudG90YWxTdWJtaXNzaW9uVmFsdWU7IA0KDQogICAgICAgIG1ldGFEYXRhLnRvdGFsU3VibWlzc2lvblZhbHVlICs9IHN1Ym1pc3Npb25EYXRhLnN1Ym1pc3Npb25WYWx1ZTsNCiAgICAgICAgDQogICAgICAgIGlmKCB0ZW1wMTI4ID4gbWV0YURhdGEudG90YWxTdWJtaXNzaW9uVmFsdWUgKSB7DQogICAgICAgICAgICAvLyBvdmVyZmxvdyBpbiBjYWxjdWxhdGlvbg0KICAgICAgICAgICAgLy8gbm90ZSB0aGF0IHRoaXMgY29kZSBpcyByZWFjaGFibGUgaWYgdXNlciBpcyBkaXNob25lc3QgYW5kIGdpdmUgZmFsc2UNCiAgICAgICAgICAgIC8vIHJlcG9ydCBvbiBoaXMgc3VibWlzc2lvbi4gYnV0IGV2ZW4gd2l0aG91dA0KICAgICAgICAgICAgLy8gdGhpcyB2YWxpZGF0aW9uLCB1c2VyIGNhbm5vdCBiZW5pZml0IGZyb20gdGhlIG92ZXJmbG93DQogICAgICAgICAgICBTdWJtaXRDbGFpbSggbXNnLnNlbmRlciwgMHg4MTAwMDAwNSwgMCApOyANCiAgICAgICAgICAgIHJldHVybjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgIA0KICAgICAgICBzdWJtaXNzaW9uc01ldGFEYXRhW21zZy5zZW5kZXJdID0gbWV0YURhdGE7DQogICAgICAgIA0KICAgICAgICAvLyBldmVyeXRoaW5nIGlzIG9rDQogICAgICAgIFN1Ym1pdENsYWltKCBtc2cuc2VuZGVyLCAwLCBudW1TaGFyZXMgKiBkaWZmaWN1bHR5ICk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0Q2xhaW1TZWVkKGFkZHJlc3Mgc2VuZGVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpew0KICAgICAgICBTdWJtaXNzaW9uTWV0YURhdGEgbWVtb3J5IG1ldGFEYXRhID0gc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdOw0KICAgICAgICBpZiggbWV0YURhdGEucmVhZHlGb3JWZXJpZmljYXRpb24gPT0gMCApIHJldHVybiAwOw0KICAgICAgICANCiAgICAgICAgaWYoIG1ldGFEYXRhLnN1Ym1pc3Npb25TZWVkICE9IDAgKSByZXR1cm4gbWV0YURhdGEuc3VibWlzc2lvblNlZWQ7IA0KICAgICAgICANCiAgICAgICAgdWludCBsYXN0QmxvY2tOdW1iZXIgPSB1aW50KG1ldGFEYXRhLmxhc3RTdWJtaXNzaW9uQmxvY2tOdW1iZXIpOw0KICAgICAgICANCiAgICAgICAgaWYoIGJsb2NrLm51bWJlciA+IGxhc3RCbG9ja051bWJlciArIDIwMCApIHJldHVybiAwOw0KICAgICAgICBpZiggYmxvY2subnVtYmVyIDw9IGxhc3RCbG9ja051bWJlciArIDE1ICkgcmV0dXJuIDA7DQogICAgICAgICAgICAgICAgDQogICAgICAgIHJldHVybiB1aW50KGJsb2NrLmJsb2NraGFzaChsYXN0QmxvY2tOdW1iZXIgKyAxMCkpOw0KICAgIH0NCiAgICANCiAgICBldmVudCBTdG9yZUNsYWltU2VlZCggYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBlcnJvciwgdWludCBlcnJvckluZm8gKTsNCiAgICBmdW5jdGlvbiBzdG9yZUNsYWltU2VlZCggYWRkcmVzcyBtaW5lciApIHsNCiAgICAgICAgLy8gYW55b25lIHdobyBpcyB3aWxsaW5nIHRvIHBheSBnYXMgZmVlcyBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uDQogICAgICAgIHVpbnQgc2VlZCA9IGdldENsYWltU2VlZCggbWluZXIgKTsNCiAgICAgICAgaWYoIHNlZWQgIT0gMCApIHsNCiAgICAgICAgICAgIHN1Ym1pc3Npb25zTWV0YURhdGFbbWluZXJdLnN1Ym1pc3Npb25TZWVkID0gc2VlZDsNCiAgICAgICAgICAgIFN0b3JlQ2xhaW1TZWVkKCBtc2cuc2VuZGVyLCAwLCB1aW50KG1pbmVyKSApOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBlbHNlDQogICAgICAgIFN1Ym1pc3Npb25NZXRhRGF0YSBtZW1vcnkgbWV0YURhdGEgPSBzdWJtaXNzaW9uc01ldGFEYXRhW21pbmVyXTsNCiAgICAgICAgdWludCBsYXN0QmxvY2tOdW1iZXIgPSB1aW50KG1ldGFEYXRhLmxhc3RTdWJtaXNzaW9uQmxvY2tOdW1iZXIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICBpZiggbWV0YURhdGEucmVhZHlGb3JWZXJpZmljYXRpb24gPT0gMCApIHsNCiAgICAgICAgICAgIC8vIHN1Ym1pc3Npb24gaXMgbm90IHJlYWR5IGZvciB2ZXJpZmljYXRpb24NCiAgICAgICAgICAgIFN0b3JlQ2xhaW1TZWVkKCBtc2cuc2VuZGVyLCAweDgwMDAwMDAsIHVpbnQobWluZXIpICk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiggYmxvY2subnVtYmVyID4gbGFzdEJsb2NrTnVtYmVyICsgMjAwICkgew0KICAgICAgICAgICAgLy8gc3VibWlzc2lvbiBpcyBub3QgcmVhZHkgZm9yIHZlcmlmaWNhdGlvbg0KICAgICAgICAgICAgU3RvcmVDbGFpbVNlZWQoIG1zZy5zZW5kZXIsIDB4ODAwMDAwMSwgdWludChtaW5lcikgKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmKCBibG9jay5udW1iZXIgPD0gbGFzdEJsb2NrTnVtYmVyICsgMTUgKSB7DQogICAgICAgICAgICAvLyBpdCBpcyB0b28gbGF0ZSB0byBjYWxsIHN0b3JlIGZ1bmN0aW9uDQogICAgICAgICAgICBTdG9yZUNsYWltU2VlZCggbXNnLnNlbmRlciwgMHg4MDAwMDAyLCB1aW50KG1pbmVyKSApOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gdW5rbm93biBlcnJvcg0KICAgICAgICAgICAgU3RvcmVDbGFpbVNlZWQoIG1zZy5zZW5kZXIsIDB4ODAwMDAwMywgdWludChtaW5lcikgKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHZlcmlmeVN1Ym1pc3Npb25JbmRleCggYWRkcmVzcyBzZW5kZXIsIHVpbnQgc2VlZCwgdWludCBzdWJtaXNzaW9uTnVtYmVyLCB1aW50IHNoYXJlSW5kZXggKSBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsNCiAgICAgICAgaWYoIHNlZWQgPT0gMCApIHJldHVybiBmYWxzZTsNCiAgICANCiAgICAgICAgdWludCB0b3RhbFZhbHVlID0gdWludChzdWJtaXNzaW9uc01ldGFEYXRhW3NlbmRlcl0udG90YWxTdWJtaXNzaW9uVmFsdWUpOw0KICAgICAgICB1aW50IG51bVBlbmRpbmdTdWJtaXNzaW9ucyA9IHVpbnQoc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdLm51bVBlbmRpbmdTdWJtaXNzaW9ucyk7DQoNCiAgICAgICAgU2luZ2xlU3VibWlzc2lvbkRhdGEgbWVtb3J5IHN1Ym1pc3Npb25EYXRhID0gKHN1Ym1pc3Npb25zRGF0YVtzZW5kZXJdKVtzdWJtaXNzaW9uTnVtYmVyXTsgICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYoIHN1Ym1pc3Npb25OdW1iZXIgPj0gbnVtUGVuZGluZ1N1Ym1pc3Npb25zICkgcmV0dXJuIGZhbHNlOw0KICAgICAgICANCiAgICAgICAgdWludCBzZWVkMSA9IHNlZWQgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICB1aW50IHNlZWQyID0gc2VlZCAvICgyKioxMjgpOw0KICAgICAgICANCiAgICAgICAgdWludCBzZWxlY3RlZFZhbHVlID0gc2VlZDEgJSB0b3RhbFZhbHVlOw0KICAgICAgICBpZiggdWludChzdWJtaXNzaW9uRGF0YS50b3RhbFByZXZpb3VzU3VibWlzc2lvblZhbHVlKSA+PSBzZWxlY3RlZFZhbHVlICkgcmV0dXJuIGZhbHNlOw0KICAgICAgICBpZiggdWludChzdWJtaXNzaW9uRGF0YS50b3RhbFByZXZpb3VzU3VibWlzc2lvblZhbHVlICsgc3VibWlzc2lvbkRhdGEuc3VibWlzc2lvblZhbHVlKSA8IHNlbGVjdGVkVmFsdWUgKSByZXR1cm4gZmFsc2U7ICANCg0KICAgICAgICB1aW50IGV4cGVjdGVkU2hhcmVzaGFyZUluZGV4ID0gKHNlZWQyICUgdWludChzdWJtaXNzaW9uRGF0YS5udW1TaGFyZXMpKTsNCiAgICAgICAgaWYoIGV4cGVjdGVkU2hhcmVzaGFyZUluZGV4ICE9IHNoYXJlSW5kZXggKSByZXR1cm4gZmFsc2U7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gY2FsY3VsYXRlU3VibWlzc2lvbkluZGV4KCBhZGRyZXNzIHNlbmRlciwgdWludCBzZWVkICkgY29uc3RhbnQgcmV0dXJucyh1aW50WzJdKSB7DQogICAgICAgIC8vIHRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGV4ZWN1dGVkIG9mZiBjaGFpbiAtIGhlbmUsIGl0IGlzIG5vdCBvcHRpbWl6ZWQNCiAgICAgICAgdWludCBzZWVkMSA9IHNlZWQgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOw0KICAgICAgICB1aW50IHNlZWQyID0gc2VlZCAvICgyKioxMjgpOw0KDQogICAgICAgIHVpbnQgdG90YWxWYWx1ZSA9IHVpbnQoc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdLnRvdGFsU3VibWlzc2lvblZhbHVlKTsNCiAgICAgICAgdWludCBudW1QZW5kaW5nU3VibWlzc2lvbnMgPSB1aW50KHN1Ym1pc3Npb25zTWV0YURhdGFbc2VuZGVyXS5udW1QZW5kaW5nU3VibWlzc2lvbnMpOw0KDQogICAgICAgIHVpbnQgc2VsZWN0ZWRWYWx1ZSA9IHNlZWQxICUgdG90YWxWYWx1ZTsNCiAgICAgICAgDQogICAgICAgIFNpbmdsZVN1Ym1pc3Npb25EYXRhIG1lbW9yeSBzdWJtaXNzaW9uRGF0YTsgICAgICAgIA0KICAgICAgICANCiAgICAgICAgZm9yKCB1aW50IHN1Ym1pc3Npb25JbmQgPSAwIDsgc3VibWlzc2lvbkluZCA8IG51bVBlbmRpbmdTdWJtaXNzaW9ucyA7IHN1Ym1pc3Npb25JbmQrKyApIHsNCiAgICAgICAgICAgIHN1Ym1pc3Npb25EYXRhID0gKHN1Ym1pc3Npb25zRGF0YVtzZW5kZXJdKVtzdWJtaXNzaW9uSW5kXTsgICAgICAgIA0KICAgICAgICAgICAgaWYoIHVpbnQoc3VibWlzc2lvbkRhdGEudG90YWxQcmV2aW91c1N1Ym1pc3Npb25WYWx1ZSArIHN1Ym1pc3Npb25EYXRhLnN1Ym1pc3Npb25WYWx1ZSkgPj0gc2VsZWN0ZWRWYWx1ZSApIGJyZWFrOyAgDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIHVuZXhwZWN0ZWQgZXJyb3INCiAgICAgICAgaWYoIHN1Ym1pc3Npb25JbmQgPT0gbnVtUGVuZGluZ1N1Ym1pc3Npb25zICkgcmV0dXJuIFt1aW50KDB4RkZGRkZGRkZGRkZGRkZGRiksMHhGRkZGRkZGRkZGRkZGRkZGXTsNCg0KICAgICAgICB1aW50IHNoYXJlSW5kZXggPSBzZWVkMiAlIHVpbnQoc3VibWlzc2lvbkRhdGEubnVtU2hhcmVzKTsgDQogICAgICAgIA0KICAgICAgICByZXR1cm4gW3N1Ym1pc3Npb25JbmQsIHNoYXJlSW5kZXhdOw0KICAgIH0NCiAgICANCiAgICAvLyBzaG91bGQgYmUgY2FsbGVkIG9ubHkgZnJvbSB2ZXJpZnkgY2xhaW0NCiAgICBmdW5jdGlvbiBjbG9zZVN1Ym1pc3Npb24oIGFkZHJlc3Mgc2VuZGVyICkgaW50ZXJuYWwgew0KICAgICAgICBTdWJtaXNzaW9uTWV0YURhdGEgbWVtb3J5IG1ldGFEYXRhID0gc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdOw0KICAgICAgICBtZXRhRGF0YS5udW1QZW5kaW5nU3VibWlzc2lvbnMgPSAwOw0KICAgICAgICBtZXRhRGF0YS50b3RhbFN1Ym1pc3Npb25WYWx1ZSA9IDA7DQogICAgICAgIG1ldGFEYXRhLnJlYWR5Rm9yVmVyaWZpY2F0aW9uID0gMDsNCiAgICAgICAgbWV0YURhdGEuc3VibWlzc2lvblNlZWQgPSAwOw0KICAgICAgICANCiAgICAgICAgLy8gbGFzdCBjb3VudGVyIG11c3Qgbm90IGJlIHJlc2V0DQogICAgICAgIC8vIGxhc3Qgc3VibWlzc2lvbiBibG9jayBudW1iZXIgYW5kIGRpZmZpY3VsdHkgYXJlIGFsc28ga2VwdCwgYnV0IGl0IGlzIG5vdCBhIG11c3QNCiAgICAgICAgLy8gb25seSB0byBzYXZlIHNvbWUgZ2FzICAgICAgICANCiAgICAgICAgDQogICAgICAgIHN1Ym1pc3Npb25zTWV0YURhdGFbc2VuZGVyXSA9IG1ldGFEYXRhOw0KICAgIH0NCiAgICANCiAgICBzdHJ1Y3QgU3VibWlzc2lvbkRhdGFGb3JDbGFpbVZlcmlmaWNhdGlvbiB7DQogICAgICAgIHVpbnQgbGFzdENvdW50ZXI7DQogICAgICAgIHVpbnQgc2hhcmVEaWZmaWN1bHR5Ow0KICAgICAgICB1aW50IHRvdGFsU3VibWlzc2lvblZhbHVlOw0KICAgICAgICB1aW50IG1pbjsNCiAgICAgICAgdWludCBtYXg7DQogICAgICAgIHVpbnQgYXVnTWVya2xlOw0KICAgICAgICANCiAgICAgICAgYm9vbCBpbmRpY2VzQXJlVmFsaWQ7DQogICAgICAgIGJvb2wgcmVhZHlGb3JWZXJpZmljYXRpb247DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGdldENsYWltRGF0YSggYWRkcmVzcyBzZW5kZXIsIHVpbnQgc3VibWlzc2lvbkluZGV4LCB1aW50IHNoYXJlSW5kZXgsIHVpbnQgc2VlZCApDQogICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKFN1Ym1pc3Npb25EYXRhRm9yQ2xhaW1WZXJpZmljYXRpb24pew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIFN1Ym1pc3Npb25EYXRhRm9yQ2xhaW1WZXJpZmljYXRpb24gbWVtb3J5IG91dHB1dDsNCg0KICAgICAgICBTdWJtaXNzaW9uTWV0YURhdGEgbWVtb3J5IG1ldGFEYXRhID0gc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdOw0KICAgICAgICANCiAgICAgICAgb3V0cHV0Lmxhc3RDb3VudGVyID0gdWludChtZXRhRGF0YS5sYXN0Q291bnRlcik7DQogICAgICAgIG91dHB1dC5zaGFyZURpZmZpY3VsdHkgPSB1aW50KG1ldGFEYXRhLmRpZmZpY3VsdHkpOw0KICAgICAgICBvdXRwdXQudG90YWxTdWJtaXNzaW9uVmFsdWUgPSBtZXRhRGF0YS50b3RhbFN1Ym1pc3Npb25WYWx1ZTsNCiAgICAgICAgDQoNCiAgICAgICAgU2luZ2xlU3VibWlzc2lvbkRhdGEgbWVtb3J5IHN1Ym1pc3Npb25EYXRhID0gKHN1Ym1pc3Npb25zRGF0YVtzZW5kZXJdKVtzdWJtaXNzaW9uSW5kZXhdOw0KICAgICAgICANCiAgICAgICAgb3V0cHV0Lm1pbiA9IHVpbnQoc3VibWlzc2lvbkRhdGEubWluKTsNCiAgICAgICAgb3V0cHV0Lm1heCA9IHVpbnQoc3VibWlzc2lvbkRhdGEubWF4KTsNCiAgICAgICAgb3V0cHV0LmF1Z01lcmtsZSA9IHVpbnQoc3VibWlzc2lvbkRhdGEuYXVnUm9vdCk7DQogICAgICAgIA0KICAgICAgICBvdXRwdXQuaW5kaWNlc0FyZVZhbGlkID0gdmVyaWZ5U3VibWlzc2lvbkluZGV4KCBzZW5kZXIsIHNlZWQsIHN1Ym1pc3Npb25JbmRleCwgc2hhcmVJbmRleCApOw0KICAgICAgICBvdXRwdXQucmVhZHlGb3JWZXJpZmljYXRpb24gPSAobWV0YURhdGEucmVhZHlGb3JWZXJpZmljYXRpb24gPiAwKTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBvdXRwdXQ7IA0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBkZWJ1Z0dldE51bVBlbmRpbmdTdWJtaXNzaW9ucyggYWRkcmVzcyBzZW5kZXIgKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHVpbnQoc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdLm51bVBlbmRpbmdTdWJtaXNzaW9ucyk7DQogICAgfQ0KICAgIA0KICAgIGV2ZW50IERlYnVnUmVzZXRTdWJtaXNzaW9ucyggYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBlcnJvciwgdWludCBlcnJvckluZm8gKTsNCiAgICBmdW5jdGlvbiBkZWJ1Z1Jlc2V0U3VibWlzc2lvbnMoICkgew0KICAgICAgICAvLyBzaG91bGQgYmUgY2FsbGVkIG9ubHkgaW4gZW1lcmdlbmN5DQogICAgICAgIC8vIG1zZy5zZW5kZXIgd2lsbCBsb29zZSBhbGwgaXRzIHBlbmRpbmcgc2hhcmVzDQogICAgICAgIGNsb3NlU3VibWlzc2lvbihtc2cuc2VuZGVyKTsNCiAgICAgICAgRGVidWdSZXNldFN1Ym1pc3Npb25zKCBtc2cuc2VuZGVyLCAwLCAwICk7DQogICAgfSAgICANCn0NCg0KDQpjb250cmFjdCBTbWFydFBvb2wgaXMgQWd0LCBXZWlnaHRlZFN1Ym1pc3Npb24geyAgICANCiAgICBzdHJpbmcgIHB1YmxpYyB2ZXJzaW9uID0gIjAuMS4xIjsNCiAgICANCiAgICBFdGhhc2ggIHB1YmxpYyBldGhhc2hDb250cmFjdDsgDQogICAgYWRkcmVzcyBwdWJsaWMgd2l0aGRyYXdhbEFkZHJlc3M7DQogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBwdWJsaWMgb3duZXJzOyANCiAgICANCiAgICBib29sIHB1YmxpYyBuZXdWZXJzaW9uUmVsZWFzZWQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgc3RydWN0IE1pbmVyRGF0YSB7DQogICAgICAgIGJ5dGVzMzIgICAgICAgIG1pbmVySWQ7DQogICAgICAgIGFkZHJlc3MgICAgICAgIHBheW1lbnRBZGRyZXNzOw0KICAgIH0NCg0KICAgIG1hcHBpbmcoYWRkcmVzcz0+TWluZXJEYXRhKSBtaW5lcnNEYXRhOw0KICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ym9vbCkgICAgICBwdWJsaWMgZXhpc3RpbmdJZHM7ICAgICAgICANCiAgICANCiAgICBib29sIHB1YmxpYyB3aGl0ZUxpc3RFbmFibGVkOw0KICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgd2hpdGVMaXN0Ow0KICAgIA0KICAgIGZ1bmN0aW9uIFNtYXJ0UG9vbCggYWRkcmVzc1szXSBfb3duZXJzLA0KICAgICAgICAgICAgICAgICAgICAgICAgRXRoYXNoIF9ldGhhc2hDb250cmFjdCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX3dpdGhkcmF3YWxBZGRyZXNzLA0KICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBfd2hpdGVMaXN0RW5hYmVsZWQgKSBwYXlhYmxlIHsNCiAgICAgICAgb3duZXJzW19vd25lcnNbMF1dID0gdHJ1ZTsgDQogICAgICAgIG93bmVyc1tfb3duZXJzWzFdXSA9IHRydWU7DQogICAgICAgIG93bmVyc1tfb3duZXJzWzJdXSA9IHRydWU7DQogICAgICAgIA0KICAgICAgICB3aGl0ZUxpc3RFbmFibGVkID0gX3doaXRlTGlzdEVuYWJlbGVkOw0KICAgICAgICBldGhhc2hDb250cmFjdCA9IF9ldGhhc2hDb250cmFjdDsNCiAgICAgICAgd2l0aGRyYXdhbEFkZHJlc3MgPSBfd2l0aGRyYXdhbEFkZHJlc3M7ICAgICAgIA0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBkZWNsYXJlTmV3ZXJWZXJzaW9uKCkgew0KICAgICAgICBpZiggISBvd25lcnNbbXNnLnNlbmRlcl0gKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIG5ld1ZlcnNpb25SZWxlYXNlZCA9IHRydWU7DQogICAgICAgIA0KICAgICAgICAvL2lmKCAhIG1zZy5zZW5kZXIuc2VuZCh0aGlzLmJhbGFuY2UpICkgdGhyb3c7DQogICAgfQ0KICAgIA0KICAgIGV2ZW50IFdpdGhkcmF3KCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbyApOw0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCB1aW50IGFtb3VudCApIHsNCiAgICAgICAgaWYoICEgb3duZXJzW21zZy5zZW5kZXJdICkgew0KICAgICAgICAgICAgLy8gb25seSBvd25kZXIgY2FuIHdpdGhkcmF3DQogICAgICAgICAgICBXaXRoZHJhdyggbXNnLnNlbmRlciwgMHg4MDAwMDAwMCwgYW1vdW50ICk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKCAhIHdpdGhkcmF3YWxBZGRyZXNzLnNlbmQoIGFtb3VudCApICkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICBXaXRoZHJhdyggbXNnLnNlbmRlciwgMCwgYW1vdW50ICk7ICAgICAgICAgICAgDQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHRvNjJFbmNvZGluZyggdWludCBpZCwgdWludCBudW1DaGFycyApIGNvbnN0YW50IHJldHVybnMoYnl0ZXMzMikgew0KICAgICAgICBpZiggaWQgPj0gKDI2KzI2KzEwKSoqbnVtQ2hhcnMgKSB0aHJvdzsNCiAgICAgICAgdWludCByZXN1bHQgPSAwOw0KICAgICAgICBmb3IoIHVpbnQgaSA9IDAgOyBpIDwgbnVtQ2hhcnMgOyBpKysgKSB7DQogICAgICAgICAgICB1aW50IGIgPSBpZCAlICgyNisyNisxMCk7DQogICAgICAgICAgICB1aW50OCBjaGFyOw0KICAgICAgICAgICAgaWYoIGIgPCAxMCApIHsNCiAgICAgICAgICAgICAgICBjaGFyID0gdWludDgoYiArIDB4MzApOyAvLyAweDMwID0gJzAnIA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiggYiA8IDI2ICsgMTAgKSB7DQogICAgICAgICAgICAgICAgY2hhciA9IHVpbnQ4KGIgKyAweDYxIC0gMTApOyAvLzB4NjEgPSAnYScNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNoYXIgPSB1aW50OChiICsgMHg0MSAtIDI2IC0gMTApOyAvLyAweDQxID0gJ0EnICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgKiAyNTYpICsgY2hhcjsNCiAgICAgICAgICAgIGlkIC89ICgyNisyNisxMCk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gYnl0ZXMzMihyZXN1bHQpOw0KICAgIH0NCiAgICAgICAgDQogICAgZXZlbnQgUmVnaXN0ZXIoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7ICAgIA0KICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKCBhZGRyZXNzIHBheW1lbnRBZGRyZXNzICkgew0KICAgICAgICBhZGRyZXNzIG1pbmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7DQogICAgICAgIA0KICAgICAgICAvLyBidWlsZCBpZA0KICAgICAgICB1aW50IGlkID0gdWludChtaW5lckFkZHJlc3MpICUgKDI2KzI2KzEwKSoqMTE7ICAgICAgICANCiAgICAgICAgYnl0ZXMzMiBtaW5lcklkID0gdG82MkVuY29kaW5nKGlkLDExKTsNCiAgICAgICAgDQogICAgICAgIGlmKCBleGlzdGluZ0lkc1ttaW5lcnNEYXRhW21pbmVyQWRkcmVzc10ubWluZXJJZF0gKSB7DQogICAgICAgICAgICAvLyBtaW5lciBpZCBpcyBhbHJlYWR5IGluIHVzZQ0KICAgICAgICAgICAgUmVnaXN0ZXIoIG1zZy5zZW5kZXIsIDB4ODAwMDAwMDAsIHVpbnQobWluZXJJZCkgKTsgDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKCBwYXltZW50QWRkcmVzcyA9PSBhZGRyZXNzKDApICkgew0KICAgICAgICAgICAgLy8gcGF5bWVudCBhZGRyZXNzIGlzIDANCiAgICAgICAgICAgIFJlZ2lzdGVyKCBtc2cuc2VuZGVyLCAweDgwMDAwMDAxLCB1aW50KHBheW1lbnRBZGRyZXNzKSApOyANCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYoIHdoaXRlTGlzdEVuYWJsZWQgKSB7DQogICAgICAgICAgICBpZiggISB3aGl0ZUxpc3RbIG1zZy5zZW5kZXIgXSApIHsNCiAgICAgICAgICAgICAgICAvLyBtaW5lciBub3QgaW4gd2hpdGUgbGlzdA0KICAgICAgICAgICAgICAgIFJlZ2lzdGVyKCBtc2cuc2VuZGVyLCAweDgwMDAwMDAyLCB1aW50KG1pbmVySWQpICk7DQogICAgICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gbGFzdCBjb3VudGVyIGlzIHNldCB0byAwLiANCiAgICAgICAgLy8gSXQgbWlnaHQgYmUgc2FmZXIgdG8gY2hhbmdlIGl0IHRvIG5vdy4NCiAgICAgICAgLy9taW5lcnNEYXRhW21pbmVyQWRkcmVzc10ubGFzdENvdW50ZXIgPSBub3cgKiAoMioqNjQpOw0KICAgICAgICBtaW5lcnNEYXRhW21pbmVyQWRkcmVzc10ucGF5bWVudEFkZHJlc3MgPSBwYXltZW50QWRkcmVzczsgICAgICAgIA0KICAgICAgICBtaW5lcnNEYXRhW21pbmVyQWRkcmVzc10ubWluZXJJZCA9IG1pbmVySWQ7DQogICAgICAgIGV4aXN0aW5nSWRzW21pbmVyc0RhdGFbbWluZXJBZGRyZXNzXS5taW5lcklkXSA9IHRydWU7DQogICAgICAgIA0KICAgICAgICAvLyBzdWNjZXNmdWwgcmVnaXN0cmF0aW9uDQogICAgICAgIFJlZ2lzdGVyKCBtc2cuc2VuZGVyLCAwLCAwICk7IA0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNhblJlZ2lzdGVyKGFkZHJlc3Mgc2VuZGVyKSBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsNCiAgICAgICAgdWludCBpZCA9IHVpbnQoc2VuZGVyKSAlICgyNisyNisxMCkqKjExOw0KICAgICAgICBieXRlczMyIGV4cGVjdGVkSWQgPSB0bzYyRW5jb2RpbmcoaWQsMTEpOw0KICAgICAgICANCiAgICAgICAgaWYoIHdoaXRlTGlzdEVuYWJsZWQgKSB7DQogICAgICAgICAgICBpZiggISB3aGl0ZUxpc3RbIHNlbmRlciBdICkgcmV0dXJuIGZhbHNlOyANCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuICEgZXhpc3RpbmdJZHNbZXhwZWN0ZWRJZF07DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGlzUmVnaXN0ZXJlZChhZGRyZXNzIHNlbmRlcikgY29uc3RhbnQgcmV0dXJucyhib29sKSB7DQogICAgICAgIHJldHVybiBtaW5lcnNEYXRhW3NlbmRlcl0ucGF5bWVudEFkZHJlc3MgIT0gYWRkcmVzcygwKTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gZ2V0TWluZXJJZChhZGRyZXNzIHNlbmRlcikgY29uc3RhbnQgcmV0dXJucyhieXRlczMyKSB7DQogICAgICAgIHJldHVybiBtaW5lcnNEYXRhW3NlbmRlcl0ubWluZXJJZDsNCiAgICB9DQoNCiAgICBldmVudCBVcGRhdGVXaGl0ZUxpc3QoIGFkZHJlc3MgaW5kZXhlZCBtaW5lciwgdWludCBlcnJvciwgdWludCBlcnJvckluZm8sIGJvb2wgYWRkICk7DQogICAgDQogICAgZnVuY3Rpb24gdXBkYXRlV2hpdGVMaXN0KCBhZGRyZXNzIG1pbmVyLCBib29sIGFkZCApIHsNCiAgICAgICAgaWYoICEgb3duZXJzWyBtc2cuc2VuZGVyIF0gKSB7DQogICAgICAgICAgICAvLyBvbmx5IG93bmVyIGNhbiB1cGRhdGUgbGlzdA0KICAgICAgICAgICAgVXBkYXRlV2hpdGVMaXN0KCBtc2cuc2VuZGVyLCAweDgwMDAwMDAwLCAwLCBhZGQgKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiggISB3aGl0ZUxpc3RFbmFibGVkICkgew0KICAgICAgICAgICAgLy8gd2hpdGUgbGlzdCBpcyBub3QgZW5hYmVsZWQNCiAgICAgICAgICAgIFVwZGF0ZVdoaXRlTGlzdCggbXNnLnNlbmRlciwgMHg4MDAwMDAwMSwgMCwgYWRkICk7ICAgICAgICANCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgd2hpdGVMaXN0WyBtaW5lciBdID0gYWRkOw0KICAgICAgICBpZiggISBhZGQgJiYgaXNSZWdpc3RlcmVkKCBtaW5lciApICkgew0KICAgICAgICAgICAgLy8gdW5yZWdpc3Rlcg0KICAgICAgICAgICAgbWluZXJzRGF0YVttaW5lcl0ucGF5bWVudEFkZHJlc3MgPSBhZGRyZXNzKDApOw0KICAgICAgICAgICAgZXhpc3RpbmdJZHNbbWluZXJzRGF0YVttaW5lcl0ubWluZXJJZF0gPSBmYWxzZTsgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBVcGRhdGVXaGl0ZUxpc3QoIG1zZy5zZW5kZXIsIDAsIHVpbnQobWluZXIpLCBhZGQgKTsNCiAgICB9DQogICAgDQogICAgZXZlbnQgVmVyaWZ5RXh0cmFEYXRhKCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbyApOyAgICANCiAgICBmdW5jdGlvbiB2ZXJpZnlFeHRyYURhdGEoIGJ5dGVzMzIgZXh0cmFEYXRhLCBieXRlczMyIG1pbmVySWQsIHVpbnQgZGlmZmljdWx0eSApIGNvbnN0YW50IGludGVybmFsIHJldHVybnMoYm9vbCkgew0KICAgICAgICB1aW50IGk7DQogICAgICAgIC8vIGNvbXBhcmUgaWQNCiAgICAgICAgZm9yKCBpID0gMCA7IGkgPCAxMSA7IGkrKyApIHsNCiAgICAgICAgICAgIGlmKCBleHRyYURhdGFbMTAraV0gIT0gbWluZXJJZFsyMStpXSApIHsNCiAgICAgICAgICAgICAgICAvL0Vycm9yTG9nKCAidmVyaWZ5RXh0cmFEYXRhOiBtaW5lciBpZCBub3QgYXMgZXhwZWN0ZWQiLCAwICk7DQogICAgICAgICAgICAgICAgVmVyaWZ5RXh0cmFEYXRhKCBtc2cuc2VuZGVyLCAweDgzMDAwMDAwLCB1aW50KG1pbmVySWQpICk7ICAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBjb21wYXJlIGRpZmZpY3VsdHkNCiAgICAgICAgYnl0ZXMzMiBlbmNvZGVkRGlmZiA9IHRvNjJFbmNvZGluZyhkaWZmaWN1bHR5LDExKTsNCiAgICAgICAgZm9yKCBpID0gMCA7IGkgPCAxMSA7IGkrKyApIHsNCiAgICAgICAgICAgIGlmKGV4dHJhRGF0YVtpKzIxXSAhPSBlbmNvZGVkRGlmZlsyMStpXSkgew0KICAgICAgICAgICAgICAgIC8vRXJyb3JMb2coICJ2ZXJpZnlFeHRyYURhdGE6IGRpZmZpY3VsdHkgaXMgbm90IGFzIGV4cGVjdGVkIiwgdWludChlbmNvZGVkRGlmZikgKTsNCiAgICAgICAgICAgICAgICBWZXJpZnlFeHRyYURhdGEoIG1zZy5zZW5kZXIsIDB4ODMwMDAwMDEsIHVpbnQoZW5jb2RlZERpZmYpICk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAgICAgICAgICAgIA0KICAgICAgICAgICAgfSAgDQogICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgcmV0dXJuIHRydWU7ICAgICAgICAgICAgDQogICAgfSAgICANCiAgICANCiAgICBldmVudCBWZXJpZnlDbGFpbSggYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBlcnJvciwgdWludCBlcnJvckluZm8gKTsNCiAgICANCiAgICAgICAgDQogICAgZnVuY3Rpb24gdmVyaWZ5Q2xhaW0oIGJ5dGVzIHJscEhlYWRlciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCAgbm9uY2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgIHN1Ym1pc3Npb25JbmRleCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCAgc2hhcmVJbmRleCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIGRhdGFTZXRMb29rdXAsDQogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSB3aXRuZXNzRm9yTG9va3VwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gYXVnQ291bnRlcnNCcmFuY2gsDQogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBhdWdIYXNoZXNCcmFuY2ggKSB7DQoNCiAgICAgICAgaWYoICEgaXNSZWdpc3RlcmVkKG1zZy5zZW5kZXIpICkgew0KICAgICAgICAgICAgLy8gbWluZXIgaXMgbm90IHJlZ2lzdGVyZWQNCiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDBjLCAwICk7DQogICAgICAgICAgICByZXR1cm47ICAgICAgICAgDQogICAgICAgIH0NCg0KICAgICAgICBTdWJtaXNzaW9uRGF0YUZvckNsYWltVmVyaWZpY2F0aW9uIG1lbW9yeSBzdWJtaXNzaW9uRGF0YSA9IGdldENsYWltRGF0YSggbXNnLnNlbmRlciwNCiAgICAgICAgICAgIHN1Ym1pc3Npb25JbmRleCwgc2hhcmVJbmRleCwgZ2V0Q2xhaW1TZWVkKCBtc2cuc2VuZGVyICkgKTsgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgaWYoICEgc3VibWlzc2lvbkRhdGEucmVhZHlGb3JWZXJpZmljYXRpb24gKSB7DQogICAgICAgICAgICAvL0Vycm9yTG9nKCAidGhlcmUgYXJlIG5vIHBlbmRpbmcgY2xhaW1zIiwgMCApOw0KICAgICAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODQwMDAwMDMsIDAgKTsgICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgQmxvY2tIZWFkZXIgbWVtb3J5IGhlYWRlciA9IHBhcnNlQmxvY2tIZWFkZXIocmxwSGVhZGVyKTsNCg0KICAgICAgICAvLyBjaGVjayBleHRyYSBkYXRhDQogICAgICAgIGlmKCAhIHZlcmlmeUV4dHJhRGF0YSggaGVhZGVyLmV4dHJhRGF0YSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5lcnNEYXRhWyBtc2cuc2VuZGVyIF0ubWluZXJJZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXNzaW9uRGF0YS5zaGFyZURpZmZpY3VsdHkgKSApIHsNCiAgICAgICAgICAgIC8vRXJyb3JMb2coICJleHRyYSBkYXRhIG5vdCBhcyBleHBlY3RlZCIsIHVpbnQoaGVhZGVyLmV4dHJhRGF0YSkgKTsNCiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDA0LCB1aW50KGhlYWRlci5leHRyYURhdGEpICk7ICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm47ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBjaGVjayBjb2luYmFzZSBkYXRhDQogICAgICAgIGlmKCBoZWFkZXIuY29pbmJhc2UgIT0gdWludCh0aGlzKSApIHsNCiAgICAgICAgICAgIC8vRXJyb3JMb2coICJjb2luYmFzZSBub3QgYXMgZXhwZWN0ZWQiLCB1aW50KGhlYWRlci5jb2luYmFzZSkgKTsNCiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDA1LCB1aW50KGhlYWRlci5jb2luYmFzZSkgKTsgICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAgDQogICAgICAgIA0KICAgICAgICAvLyBjaGVjayBjb3VudGVyDQogICAgICAgIHVpbnQgY291bnRlciA9IGhlYWRlci50aW1lc3RhbXAgKiAoMiAqKiA2NCkgKyBub25jZTsNCiAgICAgICAgaWYoIGNvdW50ZXIgPCBzdWJtaXNzaW9uRGF0YS5taW4gKSB7DQogICAgICAgICAgICAvL0Vycm9yTG9nKCAiY291bnRlciBpcyBzbWFsbGVyIHRoYW4gbWluIixjb3VudGVyKTsNCiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDA3LCBjb3VudGVyICk7ICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm47ICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIGlmKCBjb3VudGVyID4gc3VibWlzc2lvbkRhdGEubWF4ICkgew0KICAgICAgICAgICAgLy9FcnJvckxvZyggImNvdW50ZXIgaXMgc21hbGxlciB0aGFuIG1heCIsY291bnRlcik7DQogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwOCwgY291bnRlciApOyAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gdmVyaWZ5IGFndA0KICAgICAgICB1aW50IGxlYWZIYXNoID0gdWludChzaGEzKHJscEhlYWRlcikpOw0KICAgICAgICBWZXJpZnlBZ3REYXRhIG1lbW9yeSBhZ3REYXRhOw0KICAgICAgICBhZ3REYXRhLnJvb3RIYXNoID0gc3VibWlzc2lvbkRhdGEuYXVnTWVya2xlOw0KICAgICAgICBhZ3REYXRhLnJvb3RNaW4gPSBzdWJtaXNzaW9uRGF0YS5taW47DQogICAgICAgIGFndERhdGEucm9vdE1heCA9IHN1Ym1pc3Npb25EYXRhLm1heDsNCiAgICAgICAgYWd0RGF0YS5sZWFmSGFzaCA9IGxlYWZIYXNoOw0KICAgICAgICBhZ3REYXRhLmxlYWZDb3VudGVyID0gY291bnRlcjsNCiAgICAgICAgICAgICAgICANCg0KICAgICAgICBpZiggISB2ZXJpZnlBZ3QoIGFndERhdGEsDQogICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmVJbmRleCwNCiAgICAgICAgICAgICAgICAgICAgICAgICBhdWdDb3VudGVyc0JyYW5jaCwNCiAgICAgICAgICAgICAgICAgICAgICAgICBhdWdIYXNoZXNCcmFuY2ggKSApIHsNCiAgICAgICAgICAgIC8vRXJyb3JMb2coICJ2ZXJpZnlBZ3QgZmFpbGVkIiwwKTsNCiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDA5LCAwICk7ICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIA0KICAgICAgICAvKg0KICAgICAgICAvLyBjaGVjayBlcG9jaCBkYXRhIC0gZG9uZSBpbnNpZGUgaGFzaGltb3RvDQogICAgICAgIGlmKCAhIGV0aGFzaENvbnRyYWN0LmlzRXBvY2hEYXRhU2V0KCBoZWFkZXIuYmxvY2tOdW1iZXIgLyAzMDAwMCApICkgew0KICAgICAgICAgICAgLy9FcnJvckxvZyggImVwb2NoIGRhdGEgd2FzIG5vdCBzZXQiLGhlYWRlci5ibG9ja051bWJlciAvIDMwMDAwKTsNCiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDBhLCBoZWFkZXIuYmxvY2tOdW1iZXIgLyAzMDAwMCApOyAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgDQogICAgICAgIH0qLw0KDQoNCiAgICAgICAgLy8gdmVyaWZ5IGV0aGFzaA0KICAgICAgICB1aW50IGV0aGFzaCA9IGV0aGFzaENvbnRyYWN0Lmhhc2hpbW90byggYnl0ZXMzMihsZWFmSGFzaCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlczgobm9uY2UpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNldExvb2t1cCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdG5lc3NGb3JMb29rdXAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXIuYmxvY2tOdW1iZXIgLyAzMDAwMCApOw0KICAgICAgICBpZiggZXRoYXNoID4gKCgyKioyNTYtMSkvc3VibWlzc2lvbkRhdGEuc2hhcmVEaWZmaWN1bHR5ICkpIHsNCiAgICAgICAgICAgIGlmKCBldGhhc2ggPT0gMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZFICkgew0KICAgICAgICAgICAgICAgIC8vRXJyb3JMb2coICJlcG9jaCBkYXRhIHdhcyBub3Qgc2V0IixoZWFkZXIuYmxvY2tOdW1iZXIgLyAzMDAwMCk7DQogICAgICAgICAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODQwMDAwMGEsIGhlYWRlci5ibG9ja051bWJlciAvIDMwMDAwICk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy9FcnJvckxvZyggImV0aGFzaCBkaWZmaWN1bHR5IHRvbyBsb3ciLGV0aGFzaCk7DQogICAgICAgICAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODQwMDAwMGIsIGV0aGFzaCApOw0KICAgICAgICAgICAgfSAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKCBnZXRDbGFpbVNlZWQobXNnLnNlbmRlcikgPT0gMCApIHsNCiAgICAgICAgICAgIC8vRXJyb3JMb2coICJjbGFpbSBzZWVkIGlzIDAiLCAwICk7DQogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwMSwgMCApOw0KICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKCAhIHN1Ym1pc3Npb25EYXRhLmluZGljZXNBcmVWYWxpZCApIHsNCiAgICAgICAgICAgIC8vRXJyb3JMb2coICJzaGFyZSBpbmRleCBvciBzdWJtaXNzaW9uIGFyZSBub3QgYXMgZXhwZWN0ZWQuIHNob3VsZCBiZToiLCBnZXRTaGFyZUluZGV4KCkgKTsNCiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDAyLCAwICk7DQogICAgICAgICAgICByZXR1cm47ICAgICAgICAgICAgICAgIA0KICAgICAgICB9IA0KICAgICAgICANCiAgICAgICAgLy8gcmVjcnVzaXZlIGF0dGFjayBpcyBub3QgcG9zc2libGUgYXMgZG9QYXltZW50IGlzIHVzaW5nIHNlbmQgYW5kIG5vdCBjYWxsLg0KICAgICAgICBpZiggISBkb1BheW1lbnQoc3VibWlzc2lvbkRhdGEudG90YWxTdWJtaXNzaW9uVmFsdWUsDQogICAgICAgICAgICAgICAgICAgICAgICBtaW5lcnNEYXRhWyBtc2cuc2VuZGVyIF0ucGF5bWVudEFkZHJlc3MpICkgew0KICAgICAgICAgICAgLy8gZXJyb3IgbXNnIGlzIGdpdmVuIGluIGRvUGF5bWVudCBmdW5jdGlvbg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjbG9zZVN1Ym1pc3Npb24oIG1zZy5zZW5kZXIgKTsNCiAgICAgICAgLy9taW5lcnNEYXRhWyBtc2cuc2VuZGVyIF0ucGVuZGluZ0NsYWltID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDAsIDAgKTsgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICByZXR1cm47DQogICAgfSAgICANCiAgICANCg0KICAgIC8vIDEwMDAwID0gMTAwJQ0KICAgIHVpbnQgcHVibGljIHVuY2xlUmF0ZSA9IDUwMDsgLy8gNSUNCiAgICAvLyAxMDAwMCA9IDEwMCUNCiAgICB1aW50IHB1YmxpYyBwb29sRmVlcyA9IDA7DQoNCg0KICAgIGV2ZW50IEluY29taW5nRnVuZHMoIGFkZHJlc3Mgc2VuZGVyLCB1aW50IGFtb3VudEluV2VpICk7DQogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsNCiAgICAgICAgSW5jb21pbmdGdW5kcyggbXNnLnNlbmRlciwgbXNnLnZhbHVlICk7DQogICAgfQ0KDQogICAgZXZlbnQgU2V0VW5sY2VSYXRlQW5kRmVlcyggYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBlcnJvciwgdWludCBlcnJvckluZm8gKTsNCiAgICBmdW5jdGlvbiBzZXRVbmxjZVJhdGVBbmRGZWVzKCB1aW50IF91bmNsZVJhdGUsIHVpbnQgX3Bvb2xGZWVzICkgew0KICAgICAgICBpZiggISBvd25lcnNbbXNnLnNlbmRlcl0gKSB7DQogICAgICAgICAgICAvLyBvbmx5IG93bmVyIHNob3VsZCBjaGFuZ2UgcmF0ZXMNCiAgICAgICAgICAgIFNldFVubGNlUmF0ZUFuZEZlZXMoIG1zZy5zZW5kZXIsIDB4ODAwMDAwMDAsIDAgKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgdW5jbGVSYXRlID0gX3VuY2xlUmF0ZTsNCiAgICAgICAgcG9vbEZlZXMgPSBfcG9vbEZlZXM7DQogICAgICAgIA0KICAgICAgICBTZXRVbmxjZVJhdGVBbmRGZWVzKCBtc2cuc2VuZGVyLCAwLCAwICk7DQogICAgfQ0KICAgICAgICANCiAgICBldmVudCBEb1BheW1lbnQoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIGFkZHJlc3MgcGF5bWVudEFkZHJlc3MsIHVpbnQgdmFsdWVJbldlaSApOw0KICAgIGZ1bmN0aW9uIGRvUGF5bWVudCggdWludCBzdWJtaXNzaW9uVmFsdWUsDQogICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIHBheW1lbnRBZGRyZXNzICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7DQoNCiAgICAgICAgdWludCBwYXltZW50ID0gc3VibWlzc2lvblZhbHVlOw0KICAgICAgICAvLyB0YWtlIHVuY2xlIHJhdGUgaW50byBhY2NvdW50DQogICAgICAgIA0KICAgICAgICAvLyBwYXltZW50ID0gcGF5bWVudCAqICgxLTAuMjUqdW5jbGVSYXRlKQ0KICAgICAgICAvLyB1bmNsZVJhdGUgaW4gWzAsMTAwMDBdDQogICAgICAgIHBheW1lbnQgPSAocGF5bWVudCAqICg0KjEwMDAwIC0gdW5jbGVSYXRlKSkgLyAoNCoxMDAwMCk7DQogICAgICAgIA0KICAgICAgICAvLyBmZWVzDQogICAgICAgIHBheW1lbnQgPSAocGF5bWVudCAqICgxMDAwMCAtIHBvb2xGZWVzKSkgLyAxMDAwMDsNCg0KICAgICAgICBpZiggcGF5bWVudCA+IHRoaXMuYmFsYW5jZSApew0KICAgICAgICAgICAgLy9FcnJvckxvZyggImNhbm5vdCBhZmZvcmQgdG8gcGF5IiwgY2FsY1BheW1lbnQoIHN1Ym1pc3Npb25EYXRhLm51bVNoYXJlcywgc3VibWlzc2lvbkRhdGEuZGlmZmljdWx0eSApICk7DQogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwMCwgcGF5bWVudCApOyAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgaWYoICEgcGF5bWVudEFkZHJlc3Muc2VuZCggcGF5bWVudCApICkgdGhyb3c7DQogICAgICAgIA0KICAgICAgICBEb1BheW1lbnQoIG1zZy5zZW5kZXIsIHBheW1lbnRBZGRyZXNzLCBwYXltZW50ICk7IA0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGdldFBvb2xFVEhCYWxhbmNlKCApIGNvbnN0YW50IHJldHVybnModWludCkgew0KICAgICAgICAvLyBkZWJ1ZyBmdW5jdGlvbiBmb3IgdGVzdHJwYw0KICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlOw0KICAgIH0NCg0KICAgIGV2ZW50IEdldFNoYXJlSW5kZXhEZWJ1Z0ZvclRlc3RSUENTdWJtaXNzaW9uSW5kZXgoIHVpbnQgaW5kZXggKTsgICAgDQogICAgZXZlbnQgR2V0U2hhcmVJbmRleERlYnVnRm9yVGVzdFJQQ1NoYXJlSW5kZXgoIHVpbnQgaW5kZXggKTsNCiAgICAgDQogICAgZnVuY3Rpb24gZ2V0U2hhcmVJbmRleERlYnVnRm9yVGVzdFJQQyggYWRkcmVzcyBzZW5kZXIgKSB7DQogICAgICAgIHVpbnQgc2VlZCA9IGdldENsYWltU2VlZCggc2VuZGVyICk7DQogICAgICAgIHVpbnRbMl0gbWVtb3J5IHJlc3VsdCA9IGNhbGN1bGF0ZVN1Ym1pc3Npb25JbmRleCggc2VuZGVyLCBzZWVkICk7DQogICAgICAgIA0KICAgICAgICBHZXRTaGFyZUluZGV4RGVidWdGb3JUZXN0UlBDU3VibWlzc2lvbkluZGV4KCByZXN1bHRbMF0gKTsNCiAgICAgICAgR2V0U2hhcmVJbmRleERlYnVnRm9yVGVzdFJQQ1NoYXJlSW5kZXgoIHJlc3VsdFsxXSApOyAgICAgICAgDQogICAgICAgICAgICANCiAgICB9ICAgICAgICANCn0='