base 64 content
base64smartRoulette
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQpjb250cmFjdCBXaW5NYXRyaXgNCiB7DQogICBmdW5jdGlvbiBnZXRDb2VmZih1aW50MTYgbikgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7DQogICBmdW5jdGlvbiBnZXRCZXRzUHJvY2Vzc2VkKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDE2KTsNCiB9DQoNCmNvbnRyYWN0IFNtYXJ0Um91bGV0dGVUb2tlbiANCnsNCiAgIGZ1bmN0aW9uIGVtaXNzaW9uKGFkZHJlc3MgcGxheWVyLCBhZGRyZXNzIHBhcnRuZXIsIHVpbnQyNTYgdmFsdWVfYmV0LCB1aW50MjU2IGNvZWZfcGxheWVyLCB1aW50MjU2IGNvZWZfcGFydG5lcikgZXh0ZXJuYWwgcmV0dXJucyh1aW50MjU2LCB1aW50OCk7DQogICBmdW5jdGlvbiBpc09wZXJhdGlvbkJsb2NrZWQoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKTsNCn0NCg0KY29udHJhY3QgU21hcnRBZmZpbGlhdGUgDQp7ICAgDQogICBmdW5jdGlvbiBnZXRBZmZpbGlhdGVJbmZvKGFkZHJlc3MgcGxheWVyKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MgYWZmaWxpYXRlLCB1aW50MTYgY29lZl9hZmZpbGlhdGUsIHVpbnQxNiBjb2VmX3BsYXllcik7DQp9DQoNCi8qDQoqKiBVc2VyIGludGVyZmFjZSBmb3IgU21hcnRSb3VsZXR0ZSBodHRwczovL3NtYXJ0cm91bGV0dGUuaW8NCiovDQpjb250cmFjdCBTbWFydFJvdWxldHRlDQp7DQogIGFkZHJlc3MgZGV2ZWxvcGVyOw0KICBhZGRyZXNzIG9wZXJhdG9yOw0KDQogIC8vIFdhaXQgQmxvY2tEZWxheSBibG9ja3MgYmVmb3JlIGdlbmVyYXRlIHJhbmRvbSBudW1iZXINCiAgdWludDggQmxvY2tEZWxheTsNCg0KICAvLyBNYXhpbXVtIGJldCB2YWx1ZSBmb3IgZ2FtZSAob25lIGNyZWRpdCBpcyBjdXJyZW50TWF4QmV0LzI1NikNCiAgdWludDI1NiBjdXJyZW50TWF4QmV0OyAgICANCg0KICAvLyBtYXhpbXVtIGdhbWVzIGNvdW50IHBlciBibG9jaw0KICB1aW50NjQgbWF4R2FtYmxlc1BlckJsb2NrOw0KICAgICAgICANCiAgLy8gRW5hYmxlXGRpc2FibGUgdG8gcGxhY2UgbmV3IGJldHMNCiAgYm9vbCBDb250cmFjdFN0YXRlOw0KDQogIC8vIHRhYmxlIHdpdGggd2lubmVyIGNvZWZmaWNpZW50cw0KICBXaW5NYXRyaXggd2luTWF0cml4Ow0KDQogIFNtYXJ0Um91bGV0dGVUb2tlbiBzbWFydFRva2VuOw0KDQogIGFkZHJlc3MgcHVibGljIHByb2ZpdERpc3RyaWJ1dGlvbkNvbnRyYWN0Ow0KDQogIFNtYXJ0QWZmaWxpYXRlIHNtYXJ0QWZmaWxpYXRlQ29udHJhY3Q7DQoNCiAgdWludDE2IGNvbnN0YW50IG1heFR5cGVCZXRzID0gMTU3Ow0KICANCiAgLy8gRGVmYXVsdCBjb2VmIGZvciB0b2tlbiBlbWlzc2lvbiAoaWYgU21hcnRBZmZpbGlhdGUgY29udHJhY3QgaXMgbm90IHNldHVwKQ0KICB1aW50MTYgQ29lZlBsYXllckVtaXNzaW9uOyAgIA0KICAvLyANCiAgbWFwcGluZyAodWludDggPT4gdWludDgpIHByaXZhdGUgbWluQ3JlZGl0c09uQmV0Ow0KICBtYXBwaW5nICh1aW50OCA9PiB1aW50OCkgcHJpdmF0ZSBtYXhDcmVkaXRzT25CZXQ7DQoNCiAgc3RydWN0IEdhbWVJbmZvDQogIHsNCiAgICAgICBhZGRyZXNzIHBsYXllcjsNCiAgICAgICB1aW50MjU2IGJsb2NrTnVtYmVyOw0KICAgICAgIHVpbnQ4IHdoZWVsUmVzdWx0Ow0KICAgICAgIHVpbnQyNTYgYmV0czsNCiAgICAgICBieXRlczMyIHZhbHVlczsNCiAgICAgICBieXRlczMyIHZhbHVlczI7DQogIH0gDQogICAgICAgDQogIEdhbWVJbmZvW10gcHJpdmF0ZSBnYW1ibGVzOw0KDQogICBlbnVtIEdhbWVTdGF0dXMge1N1Y2Nlc3MsIFNraXBwZWQsIFN0b3B9DQoNCiAgIGVudW0gQmV0VHlwZXN7bnVtYmVyMCwgbnVtYmVyMSxudW1iZXIyLG51bWJlcjMsbnVtYmVyNCxudW1iZXI1LG51bWJlcjYsbnVtYmVyNyxudW1iZXI4LG51bWJlcjksDQogICAgIG51bWJlcjEwLG51bWJlcjExLG51bWJlcjEyLG51bWJlcjEzLG51bWJlcjE0LG51bWJlcjE1LG51bWJlcjE2LG51bWJlcjE3LG51bWJlcjE4LG51bWJlcjE5LG51bWJlcjIwLG51bWJlcjIxLA0KICAgICBudW1iZXIyMixudW1iZXIyMyxudW1iZXIyNCxudW1iZXIyNSxudW1iZXIyNixudW1iZXIyNyxudW1iZXIyOCxudW1iZXIyOSxudW1iZXIzMCxudW1iZXIzMSxudW1iZXIzMixudW1iZXIzMywNCiAgICAgbnVtYmVyMzQsbnVtYmVyMzUsbnVtYmVyMzYsIHJlZCwgYmxhY2ssIG9kZCwgZXZlbiwgZG96ZW4xLGRvemVuMixkb3plbjMsIGNvbHVtbjEsY29sdW1uMixjb2x1bW4zLCBsb3csaGlnaCwNCiAgICAgcGFpcl8wMSwgcGFpcl8wMiwgcGFpcl8wMywgcGFpcl8xMiwgcGFpcl8yMywgcGFpcl8zNiwgcGFpcl8yNSwgcGFpcl8xNCwgcGFpcl80NSwgcGFpcl81NiwgcGFpcl82OSwgcGFpcl81OCwgcGFpcl80NywNCiAgICAgcGFpcl83OCwgcGFpcl84OSwgcGFpcl85MTIsIHBhaXJfODExLCBwYWlyXzcxMCwgcGFpcl8xMDExLCBwYWlyXzExMTIsIHBhaXJfMTIxNSwgcGFpcl8xNTE4LCBwYWlyXzE2MTcsIHBhaXJfMTcxOCwgcGFpcl8xNzIwLA0KICAgICBwYWlyXzE2MTksIHBhaXJfMTkyMiwgcGFpcl8yMDIzLCBwYWlyXzIxMjQsIHBhaXJfMjIyMywgcGFpcl8yMzI0LCBwYWlyXzI1MjgsIHBhaXJfMjYyOSwgcGFpcl8yNzMwLCBwYWlyXzI4MjksIHBhaXJfMjkzMCwgcGFpcl8xMTE0LA0KICAgICBwYWlyXzEwMTMsIHBhaXJfMTMxNCwgcGFpcl8xNDE1LCBwYWlyXzEzMTYsIHBhaXJfMTQxNywgcGFpcl8xODIxLCBwYWlyXzE5MjAsIHBhaXJfMjAyMSwgcGFpcl8yMjI1LCBwYWlyXzIzMjYsIHBhaXJfMjQyNywgcGFpcl8yNTI2LA0KICAgICBwYWlyXzI2MjcsIHBhaXJfMjgzMSwgcGFpcl8yOTMyLCBwYWlyXzMwMzMsIHBhaXJfMzEzMiwgcGFpcl8zMjMzLCBwYWlyXzMxMzQsIHBhaXJfMzIzNSwgcGFpcl8zMzM2LCBwYWlyXzM0MzUsIHBhaXJfMzUzNiwgY29ybmVyXzBfMV8yXzMsDQogICAgIGNvcm5lcl8xXzJfNV80LCBjb3JuZXJfMl8zXzZfNSwgY29ybmVyXzRfNV84XzcsIGNvcm5lcl81XzZfOV84LCBjb3JuZXJfN184XzExXzEwLCBjb3JuZXJfOF85XzEyXzExLCBjb3JuZXJfMTBfMTFfMTRfMTMsIGNvcm5lcl8xMV8xMl8xNV8xNCwNCiAgICAgY29ybmVyXzEzXzE0XzE3XzE2LCBjb3JuZXJfMTRfMTVfMThfMTcsIGNvcm5lcl8xNl8xN18yMF8xOSwgY29ybmVyXzE3XzE4XzIxXzIwLCBjb3JuZXJfMTlfMjBfMjNfMjIsIGNvcm5lcl8yMF8yMV8yNF8yMywgY29ybmVyXzIyXzIzXzI2XzI1LA0KICAgICBjb3JuZXJfMjNfMjRfMjdfMjYsIGNvcm5lcl8yNV8yNl8yOV8yOCwgY29ybmVyXzI2XzI3XzMwXzI5LCBjb3JuZXJfMjhfMjlfMzJfMzEsIGNvcm5lcl8yOV8zMF8zM18zMiwgY29ybmVyXzMxXzMyXzM1XzM0LCBjb3JuZXJfMzJfMzNfMzZfMzUsDQogICAgIHRocmVlXzBfMl8zLCB0aHJlZV8wXzFfMiwgdGhyZWVfMV8yXzMsIHRocmVlXzRfNV82LCB0aHJlZV83XzhfOSwgdGhyZWVfMTBfMTFfMTIsIHRocmVlXzEzXzE0XzE1LCB0aHJlZV8xNl8xN18xOCwgdGhyZWVfMTlfMjBfMjEsIHRocmVlXzIyXzIzXzI0LA0KICAgICB0aHJlZV8yNV8yNl8yNywgdGhyZWVfMjhfMjlfMzAsIHRocmVlXzMxXzMyXzMzLCB0aHJlZV8zNF8zNV8zNiwgc2l4XzFfMl8zXzRfNV82LCBzaXhfNF81XzZfN184XzksIHNpeF83XzhfOV8xMF8xMV8xMiwgc2l4XzEwXzExXzEyXzEzXzE0XzE1LA0KICAgICBzaXhfMTNfMTRfMTVfMTZfMTdfMTgsIHNpeF8xNl8xN18xOF8xOV8yMF8yMSwgc2l4XzE5XzIwXzIxXzIyXzIzXzI0LCBzaXhfMjJfMjNfMjRfMjVfMjZfMjcsIHNpeF8yNV8yNl8yN18yOF8yOV8zMCwgc2l4XzI4XzI5XzMwXzMxXzMyXzMzLA0KICAgICBzaXhfMzFfMzJfMzNfMzRfMzVfMzZ9DQogICANCg0KICAgZnVuY3Rpb24gU21hcnRSb3VsZXR0ZSgpIGludGVybmFsDQogICB7ICAgICAgICANCiAgICAgICAgZGV2ZWxvcGVyICA9IG1zZy5zZW5kZXI7DQogICAgICAgIG9wZXJhdG9yICAgPSBtc2cuc2VuZGVyOw0KICAgICAgICANCiAgICAgICAgd2luTWF0cml4ID0gV2luTWF0cml4KDB4MDczRDY2MjFFOTE1MGJGZjlkMUQ0NTBjYUFkM2M3OTBiNkYwNzFGMik7DQogICAgICAgIGlmICh3aW5NYXRyaXguZ2V0QmV0c1Byb2Nlc3NlZCgpICE9IG1heFR5cGVCZXRzKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIHNtYXJ0VG9rZW4gPSBTbWFydFJvdWxldHRlVG9rZW4oMHhjY2VkNWI4Mjg4MDg2YmU4YzM4ZTIzNTY3ZTY4NGMzNzQwYmU0ZDQ4KTsNCg0KICAgICAgICBjdXJyZW50TWF4QmV0ID0gMjU2MCBmaW5uZXk7IC8vIDIuNTYgZXRoZXINCiAgICAgICAgQmxvY2tEZWxheSA9IDE7ICAgICAgICANCiAgICAgICAgbWF4R2FtYmxlc1BlckJsb2NrID0gNTsgICAgICAgIA0KICAgICAgICBDb250cmFjdFN0YXRlICA9IHRydWU7ICANCiAgICAgICAgYmFua3JvbExpbWl0ID0gMjc3IGV0aGVyOw0KICAgICAgICBwcm9maXRMaW1pdCAgPSA1MCBldGhlcjsNCiAgICAgICAgQ29lZlBsYXllckVtaXNzaW9uID0gMTAwOyAvLyBkZWZhdWx0IDElDQogICB9DQoNCiAgIGZ1bmN0aW9uIGNoYW5nZVNldHRpbmdzKHVpbnQyNTYgbmV3TWF4QmV0LCB1aW50OCBuZXdCbG9ja0RlbGF5KSBwdWJsaWMgb25seURldmVsb3BlciANCiAgIHsgICAgICAgICAgICAgDQogICAgICBCbG9ja0RlbGF5ID0gbmV3QmxvY2tEZWxheTsNCiAgICAgIC8vIHJvdW5kcyB0byAyIGRpZ3RzDQogICAgICBuZXdNYXhCZXQgPSBuZXdNYXhCZXQgLyAyNTYwMDAwMDAwMDAwMDAwMDAwICogMjU2MDAwMDAwMDAwMDAwMDAwMDsgIA0KICAgICAgaWYgKG5ld01heEJldCAhPSBjdXJyZW50TWF4QmV0KSANCiAgICAgIHsNCiAgICAgICAgY3VycmVudE1heEJldCA9IG5ld01heEJldDsNCiAgICAgICAgU2V0dGluZ3NDaGFuZ2VkKCk7DQogICAgICB9DQogICB9DQoNCiAgIHVpbnQyNTYgYmFua3JvbExpbWl0Ow0KICAgdWludDI1NiBwcm9maXRMaW1pdDsNCiAgIHVpbnQyNTYgbGFzdERpc3RyaWJ1dGVkUHJvZml0Ow0KICAgdWludDI1NiBsYXN0RGF0ZURpc3RyaWJ1dGVkUHJvZml0Ow0KICAgDQogICBmdW5jdGlvbiBnZXREaXN0cmlidXRlUHJvZml0c0luZm8oKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBsYXN0UHJvZml0LCB1aW50MjU2IGxhc3REYXRlKQ0KICAgew0KICAgICAgbGFzdFByb2ZpdCA9IGxhc3REaXN0cmlidXRlZFByb2ZpdDsNCiAgICAgIGxhc3REYXRlID0gbGFzdERhdGVEaXN0cmlidXRlZFByb2ZpdDsNCiAgIH0NCg0KICAgZnVuY3Rpb24gc2V0UHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QoYWRkcmVzcyBjb250cmFjdEFkZHJlc3MpIG9ubHlEZXZlbG9wZXINCiAgIHsNCiAgICAgIGlmIChwcm9maXREaXN0cmlidXRpb25Db250cmFjdCA+IDApIHRocm93Ow0KICAgICAgcHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QgPSBjb250cmFjdEFkZHJlc3M7DQogICB9DQoNCiAgIGZ1bmN0aW9uIHNldFNtYXJ0QWZmaWxpYXRlQ29udHJhY3QoYWRkcmVzcyBjb250cmFjdEFkZHJlc3MpIG9ubHlEZXZlbG9wZXINCiAgIHsNCiAgICAgIGlmIChhZGRyZXNzKHNtYXJ0QWZmaWxpYXRlQ29udHJhY3QpID4gMCkgdGhyb3c7DQogICAgICBzbWFydEFmZmlsaWF0ZUNvbnRyYWN0ID0gU21hcnRBZmZpbGlhdGUoY29udHJhY3RBZGRyZXNzKTsNCiAgIH0NCg0KICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVByb2ZpdHModWludDI1NiBnYXNWYWx1ZSkgb25seURldmVsb3Blck9yT3BlcmF0b3INCiAgIHsNCiAgICAgIGlmIChwcm9maXREaXN0cmlidXRpb25Db250cmFjdCA+IDAgJiYgdGhpcy5iYWxhbmNlID49IChiYW5rcm9sTGltaXQrcHJvZml0TGltaXQpKQ0KICAgICAgew0KICAgICAgICAgdWludDI1NiBkaWZmID0gdGhpcy5iYWxhbmNlIC0gYmFua3JvbExpbWl0Ow0KICAgICAgICAgaWYgKGFkZHJlc3MocHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QpLmNhbGwuZ2FzKGdhc1ZhbHVlKS52YWx1ZShkaWZmKSgpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgICAgIGxhc3REaXN0cmlidXRlZFByb2ZpdCA9IGRpZmY7DQogICAgICAgICBsYXN0RGF0ZURpc3RyaWJ1dGVkUHJvZml0ID0gYmxvY2sudGltZXN0YW1wOw0KICAgICAgfSAgICAgIA0KICAgfQ0KDQogICBmdW5jdGlvbiBnZXRUb2tlblNldHRpbmdzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDE2IENvZWZfcGxheWVyLCB1aW50MjU2IEJhbmtyb2xMaW1pdCwgdWludDI1NiBQcm9maXRMaW1pdCkNCiAgIHsNCiAgICAgIENvZWZfcGxheWVyID0gQ29lZlBsYXllckVtaXNzaW9uOyAgICAgIA0KICAgICAgQmFua3JvbExpbWl0ID0gYmFua3JvbExpbWl0Ow0KICAgICAgUHJvZml0TGltaXQgPSBwcm9maXRMaW1pdDsNCiAgIH0NCg0KICAgZnVuY3Rpb24gY2hhbmdlVG9rZW5TZXR0aW5ncyh1aW50MTYgbmV3Q29lZl9wbGF5ZXIsIHVpbnQyNTYgbmV3QmFua3JvbExpbWl0LCB1aW50MjU2IG5ld1Byb2ZpdExpbWl0KSBvbmx5RGV2ZWxvcGVyDQogICB7DQogICAgICBDb2VmUGxheWVyRW1pc3Npb24gID0gbmV3Q29lZl9wbGF5ZXI7ICAgICAgDQogICAgICBiYW5rcm9sTGltaXQgPSBuZXdCYW5rcm9sTGltaXQ7DQogICAgICBwcm9maXRMaW1pdCAgPSBuZXdQcm9maXRMaW1pdDsNCiAgIH0NCg0KICAgZnVuY3Rpb24gY2hhbmdlTWluQmV0KHVpbnQ4WzE1N10gdmFsdWUpIG9ubHlEZXZlbG9wZXINCiAgIHsNCiAgICAgLy8gdmFsdWVbaV0gPT0gMCBtZWFucyBza2lwIHRoaXMgdmFsdWUNCiAgICAgLy8gdmFsdWVbaV0gPT0gMjU1IG1lYW5zIHZhbHVlIHdpbGwgYmUgMA0KICAgICAvLyBSYXcgbWFwcGluZyBtaW5DcmVkaXRzT25CZXQgY2hhbmdlcyBmcm9tIDAgdG8gMjU0LCANCiAgICAgLy8gd2hlbiBjb21wYXJlIHdpdGggcmVhbCBiZXQgd2UgYWRkICsxLCBzbyBtaW4gY3JlZGl0cyBjaGFuZ2VzIGZyb20gMSB0byAyNTUNCiAgICAgZm9yKHZhciBpPTA7aTwxNTc7aSsrKSANCiAgICAgew0KICAgICAgICBpZiAodmFsdWVbaV0gPiAwKSANCiAgICAgICAgew0KICAgICAgICAgICBpZiAodmFsdWVbaV0gPT0gMjU1KQ0KICAgICAgICAgICAgIG1pbkNyZWRpdHNPbkJldFtpXSA9IDA7ICAgICANCiAgICAgICAgICAgZWxzZSAgDQogICAgICAgICAgICAgbWluQ3JlZGl0c09uQmV0W2ldID0gdmFsdWVbaV07DQogICAgICAgIH0NCiAgICAgfQ0KICAgICBTZXR0aW5nc0NoYW5nZWQoKTsNCiAgIH0NCg0KICAgZnVuY3Rpb24gY2hhbmdlTWF4QmV0KHVpbnQ4WzE1N10gdmFsdWUpIG9ubHlEZXZlbG9wZXINCiAgIHsNCiAgICAgLy8gdmFsdWVbaV0gPT0gMCBtZWFucyBza2lwIHRoaXMgdmFsdWUNCiAgICAgLy8gdmFsdWVbaV0gPT0gMjU1IG1lYW5zIHZhbHVlIHdpbGwgYmUgMA0KICAgICAvLyBSYXcgbWFwcGluZyBtYXhDcmVkaXRzT25CZXQgaG9sZCB2YWx1ZXMgdGhhdCByZWR1Y2UgbWF4IGJldCBmcm9tIDI1NSB0byAwICAgICANCiAgICAgLy8gSWYgd2Ugd2FudCB0byBjYWxjdWxhdGUgcmVhbCBtYXggYmV0IHZhbHVlIHdlIHNob3VsZCBkbzogMjU2IC0gbWF4Q3JlZGl0c09uQmV0W2ldDQogICAgIC8vIGV4YW1wbGU6IGlmIG1hcHBpbmcgaG9sZHMgMCBpdCBtZWFucywgdGhhdCBtYXggYmV0IHdpbGwgYmUgMjU2IC0gMCA9IDI1Ng0KICAgICAvLyAgICAgICAgICBpZiBtYXBwaW5nIGhvbGRzIDUwIGl0IG1lYW5zLCB0aGF0IG1heCBiZXQgd2lsbCBiZSAyNTYgLSA1MCA9IDIwNiANCiAgICAgZm9yKHZhciBpPTA7aTwxNTc7aSsrKSANCiAgICAgew0KICAgICAgIGlmICh2YWx1ZVtpXSA+IDApIA0KICAgICAgIHsNCiAgICAgICAgICBpZiAodmFsdWVbaV0gPT0gMjU1KQ0KICAgICAgICAgICAgIG1heENyZWRpdHNPbkJldFtpXSA9IDA7ICAgICANCiAgICAgICAgICAgZWxzZSAgDQogICAgICAgICAgICAgbWF4Q3JlZGl0c09uQmV0W2ldID0gMjU1IC0gdmFsdWVbaV07ICAgICAgICAgICAgICANCiAgICAgICB9DQogICAgIH0NCiAgICAgU2V0dGluZ3NDaGFuZ2VkKCk7DQogICB9DQogICANCiAgIGZ1bmN0aW9uIGRlbGV0ZUNvbnRyYWN0KCkgb25seURldmVsb3BlciAgDQogICB7DQogICAgICAgIHN1aWNpZGUobXNnLnNlbmRlcik7DQogICB9DQoNCiAgIC8vIGJpdCBmcm9tIDAgdG8gMjU1DQogICBmdW5jdGlvbiBpc0JpdFNldCh1aW50MjU2IGRhdGEsIHVpbnQ4IGJpdCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkNCiAgIHsNCiAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICByZXQgOj0gaXN6ZXJvKGlzemVybyhhbmQoZGF0YSwgZXhwKDIsYml0KSkpKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXQ7DQogICB9DQoNCiAgIC8vIHVuaXF1ZSBjb21iaW5hdGlvbiBvZiBiZXQgYW5kIHdoZWVsUmVzdWx0LCB1c2VkIGZvciBhY2Nlc3MgdG8gV2luTWF0cml4DQogICBmdW5jdGlvbiBnZXRJbmRleCh1aW50MTYgYmV0LCB1aW50MTYgd2hlZWxSZXN1bHQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDE2KQ0KICAgew0KICAgICAgcmV0dXJuIChiZXQrMSkqMjU2ICsgKHdoZWVsUmVzdWx0KzEpOw0KICAgfQ0KDQogICAvLyBuIGZvcm0gMSA8PSB0byA8PSAzMg0KICAgZnVuY3Rpb24gZ2V0QmV0VmFsdWUoYnl0ZXMzMiB2YWx1ZXMsIHVpbnQ4IG4sIHVpbnQ4IG5CaXQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikNCiAgIHsNCiAgICAgICAgLy8gYmV0IGluIGNyZWRpdHMgKDEuLjI1NikgDQogICAgICAgIHVpbnQyNTYgYmV0ID0gdWludDI1Nih2YWx1ZXNbMzIgLSBuXSkgKyAxOw0KDQogICAgICAgIGlmIChiZXQgPCB1aW50MjU2KG1pbkNyZWRpdHNPbkJldFtuQml0XSsxKSkgdGhyb3c7ICAgLy9kZWZhdWx0OiBiZXQgPCAwKzENCiAgICAgICAgaWYgKGJldCA+IHVpbnQyNTYoMjU2LW1heENyZWRpdHNPbkJldFtuQml0XSkpIHRocm93OyAvL2RlZmF1bHQ6IGJldCA+IDI1Ni0wICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGN1cnJlbnRNYXhCZXQgKiBiZXQgLyAyNTY7ICAgICAgICANCiAgIH0NCg0KICAgLy8gbiAtIG51bWJlciBwbGF5ZXIgYmV0DQogICAvLyBuQml0IC0gYmV0SW5kZXgNCiAgIGZ1bmN0aW9uIGdldEJldFZhbHVlQnlHYW1ibGUoR2FtZUluZm8gbWVtb3J5IGdhbWJsZSwgdWludDggbiwgdWludDggbkJpdCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSANCiAgIHsNCiAgICAgIGlmIChuIDw9IDMyKSByZXR1cm4gZ2V0QmV0VmFsdWUoZ2FtYmxlLnZhbHVlcyAsIG4sIG5CaXQpOw0KICAgICAgaWYgKG4gPD0gNjQpIHJldHVybiBnZXRCZXRWYWx1ZShnYW1ibGUudmFsdWVzMiwgbiAtIDMyLCBuQml0KTsNCiAgICAgIC8vIHRoZXJlIGFyZSA2NCBtYXhpbXVtIHVuaXF1ZSBiZXRzIChwb3NpdGlvbnMpIGluIG9uZSBnYW1lDQogICAgICB0aHJvdzsNCiAgIH0NCiAgDQogICBmdW5jdGlvbiB0b3RhbEdhbWVzKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikNCiAgIHsNCiAgICAgICByZXR1cm4gZ2FtYmxlcy5sZW5ndGg7DQogICB9DQogICANCiAgIGZ1bmN0aW9uIGdldFNldHRpbmdzKCkgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2IG1heEJldCwgdWludDI1NiBvbmVDcmVkaXQsIHVpbnQ4WzE1N10gX21pbkNyZWRpdHNPbkJldCwgdWludDhbMTU3XSBfbWF4Q3JlZGl0c09uQmV0LCB1aW50OCBibG9ja0RlbGF5LCBib29sIGNvbnRyYWN0U3RhdGUpDQogICAgew0KICAgICAgICBtYXhCZXQgICAgPSBjdXJyZW50TWF4QmV0Ow0KICAgICAgICBvbmVDcmVkaXQgPSBjdXJyZW50TWF4QmV0IC8gMjU2OyANCiAgICAgICAgYmxvY2tEZWxheSA9IEJsb2NrRGVsYXk7ICAgICAgDQogICAgICAgIGZvcih2YXIgaSA9IDA7aSA8IG1heFR5cGVCZXRzO2krKykgIA0KICAgICAgICB7DQogICAgICAgICAgX21pbkNyZWRpdHNPbkJldFtpXSA9IG1pbkNyZWRpdHNPbkJldFtpXSArIDE7DQogICAgICAgICAgX21heENyZWRpdHNPbkJldFtpXSA9IDI1NSAtIG1heENyZWRpdHNPbkJldFtpXTsNCiAgICAgICAgfSAgICAgDQogICAgICAgIGNvbnRyYWN0U3RhdGUgICAgICAgID0gQ29udHJhY3RTdGF0ZTsNCiAgICB9DQogICANCiAgICBtb2RpZmllciBvbmx5RGV2ZWxvcGVyKCkgDQogICAgew0KICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGRldmVsb3BlcikgdGhyb3c7DQogICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5RGV2ZWxvcGVyT3JPcGVyYXRvcigpIA0KICAgIHsNCiAgICAgICBpZiAobXNnLnNlbmRlciAhPSBkZXZlbG9wZXIgJiYgbXNnLnNlbmRlciAhPSBvcGVyYXRvcikgdGhyb3c7DQogICAgICAgXzsNCiAgICB9DQoNCiAgIGZ1bmN0aW9uIGRpc2FibGVCZXR0aW5nX29ubHlfRGV2KCkNCiAgICBvbmx5RGV2ZWxvcGVyT3JPcGVyYXRvcg0KICAgIHsNCiAgICAgICAgQ29udHJhY3RTdGF0ZT1mYWxzZTsNCiAgICB9DQoNCg0KICAgIGZ1bmN0aW9uIGNoYW5nZU9wZXJhdG9yKGFkZHJlc3MgbmV3T3BlcmF0b3IpIG9ubHlEZXZlbG9wZXINCiAgICB7DQogICAgICAgb3BlcmF0b3IgPSBuZXdPcGVyYXRvcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBlbmFibGVCZXR0aW5nX29ubHlfRGV2KCkNCiAgICBvbmx5RGV2ZWxvcGVyT3JPcGVyYXRvcg0KICAgIHsNCiAgICAgICAgQ29udHJhY3RTdGF0ZT10cnVlOw0KDQogICAgfQ0KDQogICAgZXZlbnQgUGxheWVyQmV0KHVpbnQyNTYgZ2FtYmxlSWQsIHVpbnQyNTYgcGxheWVyVG9rZW5zKTsNCiAgICBldmVudCBFbmRHYW1lKGFkZHJlc3MgcGxheWVyLCB1aW50OCByZXN1bHQsIHVpbnQyNTYgZ2FtYmxlSWQpOw0KICAgIGV2ZW50IFNldHRpbmdzQ2hhbmdlZCgpOw0KICAgIGV2ZW50IEVycm9yTG9nKGFkZHJlc3MgcGxheWVyLCBzdHJpbmcgbWVzc2FnZSk7DQogICAgZXZlbnQgR2FzTG9nKHN0cmluZyBtc2csIHVpbnQyNTYgbGV2ZWwsIHVpbnQyNTYgZ2FzKTsNCg0KICAgZnVuY3Rpb24gdG90YWxCZXRWYWx1ZShHYW1lSW5mbyBtZW1vcnkgZykgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQ0KICAgeyAgICAgICAgICAgICAgDQogICAgICAgdWludDI1NiB0b3RhbEJldHNWYWx1ZSA9IDA7IA0KICAgICAgIHVpbnQ4IG5QbGF5ZXJCZXRObyA9IDA7DQogICAgICAgdWludDggYmV0c0NvdW50ID0gdWludDgoYnl0ZXMzMihnLmJldHMpWzBdKTsNCg0KICAgICAgIGZvcih1aW50OCBpID0gMDsgaSA8IG1heFR5cGVCZXRzO2krKykgDQogICAgICAgIGlmIChpc0JpdFNldChnLmJldHMsIGkpKQ0KICAgICAgICB7DQogICAgICAgICAgdG90YWxCZXRzVmFsdWUgKz0gZ2V0QmV0VmFsdWVCeUdhbWJsZShnLCBuUGxheWVyQmV0Tm8rMSwgaSk7DQogICAgICAgICAgblBsYXllckJldE5vKys7DQoNCiAgICAgICAgICBpZiAoYmV0c0NvdW50ID09IDEpIGJyZWFrOw0KICAgICAgICAgIGJldHNDb3VudC0tOyAgICAgICAgICANCiAgICAgICAgfQ0KDQogICAgICAgcmV0dXJuIHRvdGFsQmV0c1ZhbHVlOw0KICAgfQ0KDQogICBmdW5jdGlvbiB0b3RhbEJldENvdW50KEdhbWVJbmZvIG1lbW9yeSBnKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICB7ICAgICAgICAgICAgICANCiAgICAgICB1aW50MjU2IHRvdGFsQmV0cyA9IDA7IA0KICAgICAgIGZvcih1aW50OCBpPTA7IGkgPCBtYXhUeXBlQmV0cztpKyspIA0KICAgICAgICBpZiAoaXNCaXRTZXQoZy5iZXRzLCBpKSkgdG90YWxCZXRzKys7ICAgICAgICAgIA0KICAgICAgIHJldHVybiB0b3RhbEJldHM7ICAgDQogICB9DQoNCiAgIGZ1bmN0aW9uIHBsYWNlQmV0KHVpbnQyNTYgYmV0cywgYnl0ZXMzMiB2YWx1ZXMxLGJ5dGVzMzIgdmFsdWVzMikgcHVibGljIHBheWFibGUNCiAgIHsNCiAgICAgICBpZiAoQ29udHJhY3RTdGF0ZSA9PSBmYWxzZSkNCiAgICAgICB7DQogICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiQ29udHJhY3REaXNhYmxlZCIpOw0KICAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgICAgIHJldHVybjsNCiAgICAgICB9DQoNCiAgICAgICB2YXIgZ2FtYmxlc0xlbmd0aCA9IGdhbWJsZXMubGVuZ3RoOw0KDQogICAgICAgaWYgKGdhbWJsZXNMZW5ndGggPiAwKQ0KICAgICAgIHsNCiAgICAgICAgICB1aW50OCBnYW1ibGVzQ291bnRJbkN1cnJlbnRCbG9jayA9IDA7DQogICAgICAgICAgZm9yKHZhciBpID0gZ2FtYmxlc0xlbmd0aCAtIDE7aSA+IDA7IGktLSkNCiAgICAgICAgICB7DQogICAgICAgICAgICBpZiAoZ2FtYmxlc1tpXS5ibG9ja051bWJlciA9PSBibG9jay5udW1iZXIpIA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgaWYgKGdhbWJsZXNbaV0ucGxheWVyID09IG1zZy5zZW5kZXIpDQogICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIlBsYXkgdHdpY2UgdGhlIHNhbWUgYmxvY2siKTsNCiAgICAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93Ow0KICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgZ2FtYmxlc0NvdW50SW5DdXJyZW50QmxvY2srKzsNCiAgICAgICAgICAgICAgIGlmIChnYW1ibGVzQ291bnRJbkN1cnJlbnRCbG9jayA+PSBtYXhHYW1ibGVzUGVyQmxvY2spDQogICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAibWF4R2FtYmxlc1BlckJsb2NrIik7DQogICAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93Ow0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgIH0NCiAgICAgICANCiAgICAgICB2YXIgX2N1cnJlbnRNYXhCZXQgPSBjdXJyZW50TWF4QmV0Ow0KDQogICAgICAgaWYgKG1zZy52YWx1ZSA8IF9jdXJyZW50TWF4QmV0LzI1NiB8fCBiZXRzID09IDApDQogICAgICAgew0KICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJXcm9uZyBiZXQgdmFsdWUiKTsNCiAgICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93Ow0KICAgICAgICAgIHJldHVybjsNCiAgICAgICB9DQoNCiAgICAgICBpZiAobXNnLnZhbHVlID4gX2N1cnJlbnRNYXhCZXQpDQogICAgICAgew0KICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJMaW1pdCBmb3IgdGFibGUiKTsNCiAgICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93Ow0KICAgICAgICAgIHJldHVybjsNCiAgICAgICB9DQoNCiAgICAgICBHYW1lSW5mbyBtZW1vcnkgZyA9IEdhbWVJbmZvKG1zZy5zZW5kZXIsIGJsb2NrLm51bWJlciwgMzcsIGJldHMsIHZhbHVlczEsdmFsdWVzMik7DQoNCiAgICAgICBpZiAodG90YWxCZXRWYWx1ZShnKSAhPSBtc2cudmFsdWUpDQogICAgICAgew0KICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJXcm9uZyBiZXQgdmFsdWUiKTsNCiAgICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93Ow0KICAgICAgICAgIHJldHVybjsNCiAgICAgICB9ICAgICAgIA0KDQogICAgICAgYWRkcmVzcyBhZmZpbGlhdGUgPSAwOw0KICAgICAgIHVpbnQxNiBjb2VmX2FmZmlsaWF0ZSA9IDA7DQogICAgICAgdWludDE2IGNvZWZfcGxheWVyOw0KICAgICAgIGlmIChhZGRyZXNzKHNtYXJ0QWZmaWxpYXRlQ29udHJhY3QpID4gMCkNCiAgICAgICB7ICAgICAgICANCiAgICAgICAgIChhZmZpbGlhdGUsIGNvZWZfYWZmaWxpYXRlLCBjb2VmX3BsYXllcikgPSBzbWFydEFmZmlsaWF0ZUNvbnRyYWN0LmdldEFmZmlsaWF0ZUluZm8obXNnLnNlbmRlcik7ICAgDQogICAgICAgfQ0KICAgICAgIGVsc2UNCiAgICAgICB7DQogICAgICAgICBjb2VmX3BsYXllciA9IENvZWZQbGF5ZXJFbWlzc2lvbjsNCiAgICAgICB9DQoNCiAgICAgICB1aW50MjU2IHBsYXllclRva2VuczsNCiAgICAgICB1aW50OCBlcnJvckNvZGVFbWlzc2lvbjsNCiAgICAgICANCiAgICAgICAocGxheWVyVG9rZW5zLCBlcnJvckNvZGVFbWlzc2lvbikgPSBzbWFydFRva2VuLmVtaXNzaW9uKG1zZy5zZW5kZXIsIGFmZmlsaWF0ZSwgbXNnLnZhbHVlLCBjb2VmX3BsYXllciwgY29lZl9hZmZpbGlhdGUpOw0KICAgICAgIGlmIChlcnJvckNvZGVFbWlzc2lvbiAhPSAwKQ0KICAgICAgIHsNCiAgICAgICAgICBpZiAoZXJyb3JDb2RlRW1pc3Npb24gPT0gMSkgDQogICAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAidG9rZW4gb3BlcmF0aW9ucyBzdG9wcGVkIik7DQogICAgICAgICAgZWxzZSBpZiAoZXJyb3JDb2RlRW1pc3Npb24gPT0gMikgDQogICAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiY29udHJhY3QgaXMgbm90IGluIGEgZ2FtZXMgbGlzdCIpOw0KICAgICAgICAgIGVsc2UgaWYgKGVycm9yQ29kZUVtaXNzaW9uID09IDMpIA0KICAgICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgImluY29yZWN0IHBsYXllciBhZGRyZXNzIik7DQogICAgICAgICAgZWxzZSBpZiAoZXJyb3JDb2RlRW1pc3Npb24gPT0gNCkgDQogICAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiaW5jb3JlY3QgdmFsdWUgYmV0Iik7DQogICAgICAgICAgZWxzZSBpZiAoZXJyb3JDb2RlRW1pc3Npb24gPT0gNSkgDQogICAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiaW5jb3JlY3QgQ29lZmZpY2llbnQgZW1pc3Npb25zIik7DQogICAgICAgICAgDQogICAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgfQ0KDQogICAgICAgZ2FtYmxlcy5wdXNoKGcpOw0KDQogICAgICAgUGxheWVyQmV0KGdhbWJsZXNMZW5ndGgsIHBsYXllclRva2Vucyk7IA0KICAgfQ0KDQogICAgZnVuY3Rpb24gSW52ZXN0KCkgcGF5YWJsZSBvbmx5RGV2ZWxvcGVyDQogICAgeyAgICAgIA0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEdldEdhbWVJbmRleGVzVG9Qcm9jZXNzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTZbNjRdIGdhbWVJbmRleGVzKQ0KICAgIHsgICAgICAgICAgIA0KICAgICAgdWludDggaW5kZXggPSAwOw0KICAgICAgZm9yKGludDI1NiBpID0gaW50MjU2KGdhbWJsZXMubGVuZ3RoKSAtIDE7aSA+PSAwO2ktLSkNCiAgICAgIHsgICAgICANCiAgICAgICAgIEdhbWVJbmZvIG1lbW9yeSBnID0gZ2FtYmxlc1t1aW50MjU2KGkpXTsNCiAgICAgICAgIGlmIChibG9jay5udW1iZXIgLSBnLmJsb2NrTnVtYmVyID49IDI1NikgYnJlYWs7DQoNCiAgICAgICAgIGlmIChnLndoZWVsUmVzdWx0ID09IDM3ICYmIGJsb2NrLm51bWJlciA+PSBnLmJsb2NrTnVtYmVyICsgQmxvY2tEZWxheSkNCiAgICAgICAgIHsgDQogICAgICAgICAgICBnYW1lSW5kZXhlc1tpbmRleCsrXSA9IHVpbnQyNTYoaSArIDEpOw0KICAgICAgICAgfQ0KICAgICAgfSAgICAgIA0KICAgIH0NCg0KICAgIHVpbnQyNTYgbGFzdEJsb2NrR2FtZXNQcm9jZXNzZWQ7DQoNCiAgICBmdW5jdGlvbiBQcm9jZXNzR2FtZXModWludDI1NltdIGdhbWVJbmRleGVzLCBib29sIHNpbXVsYXRlKSANCiAgICB7DQogICAgICBpZiAoIXNpbXVsYXRlKQ0KICAgICAgew0KICAgICAgICAgaWYgKGxhc3RCbG9ja0dhbWVzUHJvY2Vzc2VkID09IGJsb2NrLm51bWJlcikgIHJldHVybjsNCiAgICAgICAgIGxhc3RCbG9ja0dhbWVzUHJvY2Vzc2VkID0gYmxvY2subnVtYmVyOw0KICAgICAgfQ0KDQogICAgICB1aW50OCBkZWxheSA9IEJsb2NrRGVsYXk7DQogICAgICB1aW50MjU2IGxlbmd0aCA9IGdhbWVJbmRleGVzLmxlbmd0aDsNCiAgICAgIGJvb2wgc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgZm9yKHVpbnQyNTYgaSA9IDA7aSA8IGxlbmd0aDtpKyspDQogICAgICB7ICAgICAgDQogICAgICAgICBpZiAoUHJvY2Vzc0dhbWUoZ2FtZUluZGV4ZXNbaV0sIGRlbGF5KSA9PSBHYW1lU3RhdHVzLlN1Y2Nlc3MpIHN1Y2Nlc3MgPSB0cnVlOyAgICAgICAgIA0KICAgICAgfSAgICAgIA0KICAgICAgaWYgKHNpbXVsYXRlICYmICFzdWNjZXNzKSB0aHJvdzsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gUHJvY2Vzc0dhbWVFeHQodWludDI1NiBpbmRleCkgcHVibGljIHJldHVybnMgKEdhbWVTdGF0dXMpDQogICAgew0KICAgICAgcmV0dXJuIFByb2Nlc3NHYW1lKGluZGV4LCBCbG9ja0RlbGF5KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBQcm9jZXNzR2FtZSh1aW50MjU2IGluZGV4LCB1aW50MjU2IGRlbGF5KSBwcml2YXRlIHJldHVybnMgKEdhbWVTdGF0dXMpDQogICAgeyAgICAgICAgICAgIA0KICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW2luZGV4XTsNCiAgICAgIGlmIChibG9jay5udW1iZXIgLSBnLmJsb2NrTnVtYmVyID49IDI1NikgcmV0dXJuIEdhbWVTdGF0dXMuU3RvcDsNCg0KICAgICAgaWYgKGcud2hlZWxSZXN1bHQgPT0gMzcgJiYgYmxvY2subnVtYmVyID4gZy5ibG9ja051bWJlciArIGRlbGF5KQ0KICAgICAgeyAgICAgICAgICAgIA0KICAgICAgICAgZ2FtYmxlc1tpbmRleF0ud2hlZWxSZXN1bHQgPSBnZXRSYW5kb21OdW1iZXIoZy5wbGF5ZXIsIGcuYmxvY2tOdW1iZXIpOw0KICAgICAgICAgICAgICAgICANCiAgICAgICAgIHVpbnQyNTYgcGxheWVyV2lubmluZ3MgPSBnZXRHYW1lUmVzdWx0KGdhbWJsZXNbaW5kZXhdKTsNCiAgICAgICAgIGlmIChwbGF5ZXJXaW5uaW5ncyA+IDApIA0KICAgICAgICAgew0KICAgICAgICAgICAgaWYgKGcucGxheWVyLnNlbmQocGxheWVyV2lubmluZ3MpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgICAgIH0NCg0KICAgICAgICAgRW5kR2FtZShnLnBsYXllciwgZ2FtYmxlc1tpbmRleF0ud2hlZWxSZXN1bHQsIGluZGV4KTsNCiAgICAgICAgIHJldHVybiBHYW1lU3RhdHVzLlN1Y2Nlc3M7DQogICAgICB9DQoNCiAgICAgIHJldHVybiBHYW1lU3RhdHVzLlNraXBwZWQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0UmFuZG9tTnVtYmVyKGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IHBsYXllcmJsb2NrKSBwcml2YXRlIHJldHVybnModWludDggd2hlZWxSZXN1bHQpDQogICAgew0KICAgICAgICAvLyBibG9jay5ibG9ja2hhc2ggLSBoYXNoIG9mIHRoZSBnaXZlbiBibG9jayAtIG9ubHkgd29ya3MgZm9yIDI1NiBtb3N0IHJlY2VudCBibG9ja3MgZXhjbHVkaW5nIGN1cnJlbnQNCiAgICAgICAgYnl0ZXMzMiBibG9ja0hhc2ggPSBibG9jay5ibG9ja2hhc2gocGxheWVyYmxvY2srQmxvY2tEZWxheSk7IA0KICAgICAgICANCiAgICAgICAgaWYgKGJsb2NrSGFzaD09MCkgDQogICAgICAgIHsNCiAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiQ2Fubm90IGdlbmVyYXRlIHJhbmRvbSBudW1iZXIiKTsNCiAgICAgICAgICB3aGVlbFJlc3VsdCA9IDIwMDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlDQogICAgICAgIHsNCiAgICAgICAgICBieXRlczMyIHNoYVBsYXllciA9IHNoYTMocGxheWVyLCBibG9ja0hhc2gpOw0KICAgIA0KICAgICAgICAgIHdoZWVsUmVzdWx0ID0gdWludDgodWludDI1NihzaGFQbGF5ZXIpJTM3KTsNCiAgICAgICAgfSAgICANCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVSYW5kb21OdW1iZXJCeUJsb2NraGFzaCh1aW50MjU2IGJsb2NrSGFzaCwgYWRkcmVzcyBwbGF5ZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCB3aGVlbFJlc3VsdCkgDQogICAgeyANCiAgICAgICAgICBieXRlczMyIHNoYVBsYXllciA9IHNoYTMocGxheWVyLCBibG9ja0hhc2gpOw0KICAgIA0KICAgICAgICAgIHdoZWVsUmVzdWx0ID0gdWludDgodWludDI1NihzaGFQbGF5ZXIpJTM3KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBlbWVyZ2VuY3lGaXhHYW1lUmVzdWx0KHVpbnQ2NCBnYW1ibGVJZCwgdWludDI1NiBibG9ja0hhc2gpIG9ubHlEZXZlbG9wZXJPck9wZXJhdG9yDQogICAgew0KICAgICAgLy8gUHJvYmFibHkgdGhpcyBmdW5jdGlvbiB3aWxsIG5ldmVyIGJlIGNhbGxlZCwgYnV0DQogICAgICAvLyBpZiBnYW1lIHdhcyBub3Qgc3Bpbm5lZCBpbiAyNTYgYmxvY2tzIHRoZW4gYmxvY2suYmxvY2toYXNoIHdpbGwgcmV0dXJucyBhbHdheXMgMCBhbmQgDQogICAgICAvLyB3ZSBzaG91bGQgZml4IHRoaXMgbWFudWFsbHkgKHlvdSBjYW4gY2hlY2sgcmVzdWx0IHdpdGggcHVibGljIGZ1bmN0aW9uIGNhbGN1bGF0ZVJhbmRvbU51bWJlckJ5QmxvY2toYXNoKQ0KICAgICAgR2FtZUluZm8gbWVtb3J5IGdhbWJsZSA9IGdhbWJsZXNbZ2FtYmxlSWRdOw0KICAgICAgaWYgKGdhbWJsZS53aGVlbFJlc3VsdCAhPSAyMDApIHRocm93Ow0KDQogICAgICBnYW1ibGVzW2dhbWJsZUlkXS53aGVlbFJlc3VsdCA9IGNhbGN1bGF0ZVJhbmRvbU51bWJlckJ5QmxvY2toYXNoKGJsb2NrSGFzaCwgZ2FtYmxlLnBsYXllcik7ICAgICAgDQoNCiAgICAgIHVpbnQyNTYgcGxheWVyV2lubmluZ3MgPSBnZXRHYW1lUmVzdWx0KGdhbWJsZXNbZ2FtYmxlSWRdKTsNCiAgICAgIGlmIChwbGF5ZXJXaW5uaW5ncyA+IDApDQogICAgICB7DQogICAgICAgIGlmIChnYW1ibGUucGxheWVyLnNlbmQocGxheWVyV2lubmluZ3MpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgIH0gICAgICANCg0KICAgICAgRW5kR2FtZShnYW1ibGUucGxheWVyLCBnYW1ibGUud2hlZWxSZXN1bHQsIGdhbWJsZUlkKTsNCiAgICB9DQoNCg0KICAgIGZ1bmN0aW9uIHByZWxpbWluYXJ5R2FtZVJlc3VsdCh1aW50NjQgZ2FtYmxlSW5kZXgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCBnYW1ibGVJZCwgYWRkcmVzcyBwbGF5ZXIsIHVpbnQyNTYgYmxvY2tOdW1iZXIsIHVpbnQyNTYgdG90YWxXaW4sIHVpbnQ4IHdoZWVsUmVzdWx0LCB1aW50MjU2IGJldHMsIHVpbnQyNTYgdmFsdWVzMSwgdWludDI1NiB2YWx1ZXMyLCB1aW50MjU2IG5Ub3RhbEJldFZhbHVlLCB1aW50MjU2IG5Ub3RhbEJldENvdW50KSANCiAgICB7IA0KICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW3VpbnQyNTYoZ2FtYmxlSW5kZXgpXTsNCiAgICAgIA0KICAgICAgaWYgKGcud2hlZWxSZXN1bHQgPT0gMzcgJiYgYmxvY2subnVtYmVyID4gZy5ibG9ja051bWJlciArIEJsb2NrRGVsYXkpDQogICAgICB7DQogICAgICAgICBnYW1ibGVzW2dhbWJsZUluZGV4XS53aGVlbFJlc3VsdCA9IGdldFJhbmRvbU51bWJlcihnLnBsYXllciwgZy5ibG9ja051bWJlcik7DQogICAgICAgICByZXR1cm4gZ2V0R2FtZShnYW1ibGVJbmRleCk7DQogICAgICB9DQogICAgICB0aHJvdzsgICAgICANCiAgICB9DQoNCiAgICAvLyBQcmVsaW1pbmFyeSBnYW1lIHJlc3VsdCBiZWZvcmUgcmVhbCB0cmFuc2FjdGlvbiBpcyBtaW5lZA0KICAgIGZ1bmN0aW9uIGNhbGNSYW5kb21OdW1iZXJBbmRHZXRQcmVsaW1pbmFyeUdhbWVSZXN1bHQodWludDI1NiBibG9ja0hhc2gsIHVpbnQ2NCBnYW1ibGVJbmRleCkgY29uc3RhbnQgcmV0dXJucyAodWludDY0IGdhbWJsZUlkLCBhZGRyZXNzIHBsYXllciwgdWludDI1NiBibG9ja051bWJlciwgdWludDI1NiB0b3RhbFdpbiwgdWludDggd2hlZWxSZXN1bHQsIHVpbnQyNTYgYmV0cywgdWludDI1NiB2YWx1ZXMxLCB1aW50MjU2IHZhbHVlczIsIHVpbnQyNTYgblRvdGFsQmV0VmFsdWUsIHVpbnQyNTYgblRvdGFsQmV0Q291bnQpDQogICAgeyANCiAgICAgIEdhbWVJbmZvIG1lbW9yeSBnID0gZ2FtYmxlc1t1aW50MjU2KGdhbWJsZUluZGV4KV07ICAgICAgDQogICAgICBnLndoZWVsUmVzdWx0ID0gY2FsY3VsYXRlUmFuZG9tTnVtYmVyQnlCbG9ja2hhc2goYmxvY2tIYXNoLCBnLnBsYXllcik7ICAgICAgDQoNCiAgICAgIGdhbWJsZUlkID0gZ2FtYmxlSW5kZXg7DQogICAgICBwbGF5ZXIgPSBnLnBsYXllcjsNCiAgICAgIHdoZWVsUmVzdWx0ID0gZy53aGVlbFJlc3VsdDsgICAgICANCiAgICAgIHRvdGFsV2luID0gZ2V0R2FtZVJlc3VsdChnKTsNCiAgICAgIGJsb2NrTnVtYmVyID0gZy5ibG9ja051bWJlcjsgICAgICAgICAgICAgIA0KICAgICAgblRvdGFsQmV0VmFsdWUgPSB0b3RhbEJldFZhbHVlKGcpOw0KICAgICAgblRvdGFsQmV0Q291bnQgPSB0b3RhbEJldENvdW50KGcpOw0KICAgICAgYmV0cyA9IGcuYmV0czsNCiAgICAgIHZhbHVlczEgPSB1aW50MjU2KGcudmFsdWVzKTsNCiAgICAgIHZhbHVlczIgPSB1aW50MjU2KGcudmFsdWVzMik7ICAgICANCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRHYW1lUmVzdWx0KEdhbWVJbmZvIG1lbW9yeSBnYW1lKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWxXaW4pIA0KICAgIHsNCiAgICAgICAgdG90YWxXaW4gPSAwOw0KICAgICAgICB1aW50OCBuUGxheWVyQmV0Tm8gPSAwOw0KICAgICAgICAvLyB3ZSBzZW50IGNvdW50IGJldHMgYXQgbGFzdCBieXRlIA0KICAgICAgICB1aW50OCBiZXRzQ291bnQgPSB1aW50OChieXRlczMyKGdhbWUuYmV0cylbMF0pOyANCiAgICAgICAgZm9yKHVpbnQ4IGk9MDsgaTxtYXhUeXBlQmV0czsgaSsrKQ0KICAgICAgICB7ICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGlzQml0U2V0KGdhbWUuYmV0cywgaSkpDQogICAgICAgICAgICB7ICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgdmFyIHdpbk11bCA9IHdpbk1hdHJpeC5nZXRDb2VmZihnZXRJbmRleChpLCBnYW1lLndoZWVsUmVzdWx0KSk7IC8vIGdldCB3aW4gY29lZg0KICAgICAgICAgICAgICBpZiAod2luTXVsID4gMCkgd2luTXVsKys7IC8vICsgcmV0dXJuIHBsYXllciBiZXQNCiAgICAgICAgICAgICAgdG90YWxXaW4gKz0gd2luTXVsICogZ2V0QmV0VmFsdWVCeUdhbWJsZShnYW1lLCBuUGxheWVyQmV0Tm8rMSxpKTsNCiAgICAgICAgICAgICAgblBsYXllckJldE5vKys7IA0KDQogICAgICAgICAgICAgIGlmIChiZXRzQ291bnQgPT0gMSkgYnJlYWs7DQogICAgICAgICAgICAgIGJldHNDb3VudC0tOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ICAgICAgICANCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRHYW1lKHVpbnQ2NCBpbmRleCkgY29uc3RhbnQgcmV0dXJucyAodWludDY0IGdhbWJsZUlkLCBhZGRyZXNzIHBsYXllciwgdWludDI1NiBibG9ja051bWJlciwgdWludDI1NiB0b3RhbFdpbiwgdWludDggd2hlZWxSZXN1bHQsIHVpbnQyNTYgYmV0cywgdWludDI1NiB2YWx1ZXMxLCB1aW50MjU2IHZhbHVlczIsIHVpbnQyNTYgblRvdGFsQmV0VmFsdWUsIHVpbnQyNTYgblRvdGFsQmV0Q291bnQpIA0KICAgIHsNCiAgICAgICAgZ2FtYmxlSWQgPSBpbmRleDsNCiAgICAgICAgcGxheWVyID0gZ2FtYmxlc1tpbmRleF0ucGxheWVyOw0KICAgICAgICB0b3RhbFdpbiA9IGdldEdhbWVSZXN1bHQoZ2FtYmxlc1tpbmRleF0pOw0KICAgICAgICBibG9ja051bWJlciA9IGdhbWJsZXNbaW5kZXhdLmJsb2NrTnVtYmVyOyAgICAgICAgDQogICAgICAgIHdoZWVsUmVzdWx0ID0gZ2FtYmxlc1tpbmRleF0ud2hlZWxSZXN1bHQ7DQogICAgICAgIG5Ub3RhbEJldFZhbHVlID0gdG90YWxCZXRWYWx1ZShnYW1ibGVzW2luZGV4XSk7DQogICAgICAgIG5Ub3RhbEJldENvdW50ID0gdG90YWxCZXRDb3VudChnYW1ibGVzW2luZGV4XSk7DQogICAgICAgIGJldHMgPSBnYW1ibGVzW2luZGV4XS5iZXRzOw0KICAgICAgICB2YWx1ZXMxID0gdWludDI1NihnYW1ibGVzW2luZGV4XS52YWx1ZXMpOw0KICAgICAgICB2YWx1ZXMyID0gdWludDI1NihnYW1ibGVzW2luZGV4XS52YWx1ZXMyKTsgICAgICAgIA0KICAgIH0NCg0KICAgZnVuY3Rpb24oKSANCiAgIHsNCiAgICAgIHRocm93Ow0KICAgfQ0KICAgDQoNCn0='