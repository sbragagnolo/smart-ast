base 64 content
base64smartRoulette1
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQpjb250cmFjdCBXaW5NYXRyaXgNCiB7DQogICBmdW5jdGlvbiBnZXRDb2VmZih1aW50MTYgbikgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7DQogICBmdW5jdGlvbiBnZXRCZXRzUHJvY2Vzc2VkKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDE2KTsNCiB9DQoNCmNvbnRyYWN0IFNtYXJ0Um91bGV0dGVUb2tlbg0Kew0KICAgZnVuY3Rpb24gZW1pc3Npb24oYWRkcmVzcyBwbGF5ZXIsIGFkZHJlc3MgcGFydG5lciwgdWludDI1NiB2YWx1ZV9iZXQsIHVpbnQxNiBjb2VmX3BsYXllciwgdWludDE2IGNvZWZfcGFydG5lcikgZXh0ZXJuYWwgcmV0dXJucyh1aW50MjU2KTsNCiAgIGZ1bmN0aW9uIGlzT3BlcmF0aW9uQmxvY2tlZCgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOw0KfQ0KDQpjb250cmFjdCBTbWFydEFmZmlsaWF0ZQ0Kew0KICAgZnVuY3Rpb24gcmVnaXN0ZXIoYWRkcmVzcyBwbGF5ZXIsIGFkZHJlc3MgYWZmaWxpYXRlKSBleHRlcm5hbDsNCiAgIGZ1bmN0aW9uIGdldEFmZmlsaWF0ZUluZm8oYWRkcmVzcyBwbGF5ZXIpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcyBhZmZpbGlhdGUsIHVpbnQxNiBjb2VmX2FmZmlsaWF0ZSk7DQp9DQoNCmNvbnRyYWN0IFNtYXJ0Um91bGV0dGUNCnsNCiAgYWRkcmVzcyBkZXZlbG9wZXI7DQogIGFkZHJlc3Mgb3BlcmF0b3I7DQoNCiAgLy8gV2FpdCBCbG9ja0RlbGF5IGJsb2NrcyBiZWZvcmUgc3BpbiB0aGUgd2hlZWwNCiAgdWludDggQmxvY2tEZWxheTsNCg0KICAvLyBNYXhpbXVtIGJldCB2YWx1ZSBmb3IgZ2FtZQ0KICB1aW50MjU2IGN1cnJlbnRNYXhCZXQ7DQoNCiAgLy8gbWF4aW11bSBnYW1lcyBjb3VudCBwZXIgYmxvY2sNCiAgdWludDY0IG1heEdhbWJsZXNQZXJCbG9jazsNCg0KICAvLyBFbmFibGVcZGlzYWJsZSB0byBwbGFjZSBuZXcgYmV0cw0KICBib29sIENvbnRyYWN0U3RhdGU7DQoNCiAgLy8gdGFibGUgd2l0aCB3aW5uZXIgY29lZmZpY2llbnRzDQogIFdpbk1hdHJpeCB3aW5NYXRyaXg7DQoNCiAgU21hcnRSb3VsZXR0ZVRva2VuIHNtYXJ0VG9rZW47DQoNCiAgYWRkcmVzcyBwcm9maXREaXN0cmlidXRpb25Db250cmFjdDsNCg0KICBTbWFydEFmZmlsaWF0ZSBzbWFydEFmZmlsaWF0ZUNvbnRyYWN0Ow0KDQogIHVpbnQxNiBjb25zdGFudCBtYXhUeXBlQmV0cyA9IDE1NzsNCg0KICAgdWludDE2IGNvZWZfcGxheWVyOw0KICAgLy8NCiAgIHVpbnQ4IGRlZmF1bHRNaW5DcmVkaXRzT25CZXQ7DQogICAvLw0KICAgbWFwcGluZyAodWludDggPT4gdWludDgpIHByaXZhdGUgbWluQ3JlZGl0c09uQmV0Ow0KDQogICBzdHJ1Y3QgR2FtZUluZm8NCiAgIHsNCiAgICAgICAgYWRkcmVzcyBwbGF5ZXI7DQogICAgICAgIHVpbnQyNTYgYmxvY2tOdW1iZXI7DQogICAgICAgIHVpbnQ4IHdoZWVsUmVzdWx0Ow0KICAgICAgICB1aW50MjU2IGJldHM7DQogICAgICAgIGJ5dGVzMzIgdmFsdWVzOw0KICAgICAgICBieXRlczMyIHZhbHVlczI7DQogICB9DQoNCiAgIEdhbWVJbmZvW10gcHJpdmF0ZSBnYW1ibGVzOw0KDQogICBlbnVtIEdhbWVTdGF0dXMge1N1Y2Nlc3MsIFNraXBwZWQsIFN0b3B9DQoNCiAgIGVudW0gQmV0VHlwZXN7bnVtYmVyMCwgbnVtYmVyMSxudW1iZXIyLG51bWJlcjMsbnVtYmVyNCxudW1iZXI1LG51bWJlcjYsbnVtYmVyNyxudW1iZXI4LG51bWJlcjksDQogICAgIG51bWJlcjEwLG51bWJlcjExLG51bWJlcjEyLG51bWJlcjEzLG51bWJlcjE0LG51bWJlcjE1LG51bWJlcjE2LG51bWJlcjE3LG51bWJlcjE4LG51bWJlcjE5LG51bWJlcjIwLG51bWJlcjIxLA0KICAgICBudW1iZXIyMixudW1iZXIyMyxudW1iZXIyNCxudW1iZXIyNSxudW1iZXIyNixudW1iZXIyNyxudW1iZXIyOCxudW1iZXIyOSxudW1iZXIzMCxudW1iZXIzMSxudW1iZXIzMixudW1iZXIzMywNCiAgICAgbnVtYmVyMzQsbnVtYmVyMzUsbnVtYmVyMzYsIHJlZCwgYmxhY2ssIG9kZCwgZXZlbiwgZG96ZW4xLGRvemVuMixkb3plbjMsIGNvbHVtbjEsY29sdW1uMixjb2x1bW4zLCBsb3csaGlnaCwNCiAgICAgcGFpcl8wMSwgcGFpcl8wMiwgcGFpcl8wMywgcGFpcl8xMiwgcGFpcl8yMywgcGFpcl8zNiwgcGFpcl8yNSwgcGFpcl8xNCwgcGFpcl80NSwgcGFpcl81NiwgcGFpcl82OSwgcGFpcl81OCwgcGFpcl80NywNCiAgICAgcGFpcl83OCwgcGFpcl84OSwgcGFpcl85MTIsIHBhaXJfODExLCBwYWlyXzcxMCwgcGFpcl8xMDExLCBwYWlyXzExMTIsIHBhaXJfMTIxNSwgcGFpcl8xNTE4LCBwYWlyXzE2MTcsIHBhaXJfMTcxOCwgcGFpcl8xNzIwLA0KICAgICBwYWlyXzE2MTksIHBhaXJfMTkyMiwgcGFpcl8yMDIzLCBwYWlyXzIxMjQsIHBhaXJfMjIyMywgcGFpcl8yMzI0LCBwYWlyXzI1MjgsIHBhaXJfMjYyOSwgcGFpcl8yNzMwLCBwYWlyXzI4MjksIHBhaXJfMjkzMCwgcGFpcl8xMTE0LA0KICAgICBwYWlyXzEwMTMsIHBhaXJfMTMxNCwgcGFpcl8xNDE1LCBwYWlyXzEzMTYsIHBhaXJfMTQxNywgcGFpcl8xODIxLCBwYWlyXzE5MjAsIHBhaXJfMjAyMSwgcGFpcl8yMjI1LCBwYWlyXzIzMjYsIHBhaXJfMjQyNywgcGFpcl8yNTI2LA0KICAgICBwYWlyXzI2MjcsIHBhaXJfMjgzMSwgcGFpcl8yOTMyLCBwYWlyXzMwMzMsIHBhaXJfMzEzMiwgcGFpcl8zMjMzLCBwYWlyXzMxMzQsIHBhaXJfMzIzNSwgcGFpcl8zMzM2LCBwYWlyXzM0MzUsIHBhaXJfMzUzNiwgY29ybmVyXzBfMV8yXzMsDQogICAgIGNvcm5lcl8xXzJfNV80LCBjb3JuZXJfMl8zXzZfNSwgY29ybmVyXzRfNV84XzcsIGNvcm5lcl81XzZfOV84LCBjb3JuZXJfN184XzExXzEwLCBjb3JuZXJfOF85XzEyXzExLCBjb3JuZXJfMTBfMTFfMTRfMTMsIGNvcm5lcl8xMV8xMl8xNV8xNCwNCiAgICAgY29ybmVyXzEzXzE0XzE3XzE2LCBjb3JuZXJfMTRfMTVfMThfMTcsIGNvcm5lcl8xNl8xN18yMF8xOSwgY29ybmVyXzE3XzE4XzIxXzIwLCBjb3JuZXJfMTlfMjBfMjNfMjIsIGNvcm5lcl8yMF8yMV8yNF8yMywgY29ybmVyXzIyXzIzXzI2XzI1LA0KICAgICBjb3JuZXJfMjNfMjRfMjdfMjYsIGNvcm5lcl8yNV8yNl8yOV8yOCwgY29ybmVyXzI2XzI3XzMwXzI5LCBjb3JuZXJfMjhfMjlfMzJfMzEsIGNvcm5lcl8yOV8zMF8zM18zMiwgY29ybmVyXzMxXzMyXzM1XzM0LCBjb3JuZXJfMzJfMzNfMzZfMzUsDQogICAgIHRocmVlXzBfMl8zLCB0aHJlZV8wXzFfMiwgdGhyZWVfMV8yXzMsIHRocmVlXzRfNV82LCB0aHJlZV83XzhfOSwgdGhyZWVfMTBfMTFfMTIsIHRocmVlXzEzXzE0XzE1LCB0aHJlZV8xNl8xN18xOCwgdGhyZWVfMTlfMjBfMjEsIHRocmVlXzIyXzIzXzI0LA0KICAgICB0aHJlZV8yNV8yNl8yNywgdGhyZWVfMjhfMjlfMzAsIHRocmVlXzMxXzMyXzMzLCB0aHJlZV8zNF8zNV8zNiwgc2l4XzFfMl8zXzRfNV82LCBzaXhfNF81XzZfN184XzksIHNpeF83XzhfOV8xMF8xMV8xMiwgc2l4XzEwXzExXzEyXzEzXzE0XzE1LA0KICAgICBzaXhfMTNfMTRfMTVfMTZfMTdfMTgsIHNpeF8xNl8xN18xOF8xOV8yMF8yMSwgc2l4XzE5XzIwXzIxXzIyXzIzXzI0LCBzaXhfMjJfMjNfMjRfMjVfMjZfMjcsIHNpeF8yNV8yNl8yN18yOF8yOV8zMCwgc2l4XzI4XzI5XzMwXzMxXzMyXzMzLA0KICAgICBzaXhfMzFfMzJfMzNfMzRfMzVfMzZ9DQoNCg0KICAgZnVuY3Rpb24gU21hcnRSb3VsZXR0ZSgpIGludGVybmFsDQogICB7DQogICAgICAgIGRldmVsb3BlciAgPSBtc2cuc2VuZGVyOw0KICAgICAgICBvcGVyYXRvciAgID0gbXNnLnNlbmRlcjsNCg0KICAgICAgICB3aW5NYXRyaXggPSBXaW5NYXRyaXgoMHgwNzNENjYyMUU5MTUwYkZmOWQxRDQ1MGNhQWQzYzc5MGI2RjA3MUYyKTsNCiAgICAgICAgaWYgKHdpbk1hdHJpeC5nZXRCZXRzUHJvY2Vzc2VkKCkgIT0gbWF4VHlwZUJldHMpIHRocm93Ow0KDQogICAgICAgIHNtYXJ0VG9rZW4gPSBTbWFydFJvdWxldHRlVG9rZW4oMHgyYTY1MDM1NmJkODk0MzcwY2MxZDZhYmE3MWIzNmMwYWQ2YjNkYzE4KTsNCg0KICAgICAgICBjdXJyZW50TWF4QmV0ID0gMjU2MCBmaW5uZXk7IC8vIDIuNTYgZXRoZXINCiAgICAgICAgQmxvY2tEZWxheSA9IDE7DQogICAgICAgIG1heEdhbWJsZXNQZXJCbG9jayA9IDU7DQogICAgICAgIGRlZmF1bHRNaW5DcmVkaXRzT25CZXQgPSAxOw0KICAgICAgICBDb250cmFjdFN0YXRlICA9IHRydWU7DQogICAgICAgIGJhbmtyb2xMaW1pdCA9IDI3NyBldGhlcjsNCiAgICAgICAgcHJvZml0TGltaXQgID0gNTAgZXRoZXI7DQogICAgICAgIGNvZWZfcGxheWVyID0gMzAwOw0KICAgfQ0KDQogICBmdW5jdGlvbiBjaGFuZ2VNYXhCZXQodWludDI1NiBuZXdNYXhCZXQpIHB1YmxpYyBvbmx5RGV2ZWxvcGVyDQogICB7DQogICAgICAvLyByb3VuZHMgdG8gMiBkaWd0cw0KICAgICAgbmV3TWF4QmV0ID0gbmV3TWF4QmV0IC8gMjU2MDAwMDAwMDAwMDAwMDAwMCAqIDI1NjAwMDAwMDAwMDAwMDAwMDA7DQogICAgICBpZiAobmV3TWF4QmV0ICE9IGN1cnJlbnRNYXhCZXQpDQogICAgICB7DQogICAgICAgIGN1cnJlbnRNYXhCZXQgPSBuZXdNYXhCZXQ7DQogICAgICAgIFNldHRpbmdzQ2hhbmdlZChjdXJyZW50TWF4QmV0LCBjdXJyZW50TWF4QmV0IC8gMjU2LCAgZGVmYXVsdE1pbkNyZWRpdHNPbkJldCwgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmxvdyldLCBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuZG96ZW4xKV0sIEJsb2NrRGVsYXksIENvbnRyYWN0U3RhdGUpOw0KICAgICAgfQ0KICAgfQ0KDQogICB1aW50MjU2IGJhbmtyb2xMaW1pdDsNCiAgIHVpbnQyNTYgcHJvZml0TGltaXQ7DQogICB1aW50MjU2IGxhc3REaXN0cmlidXRlZFByb2ZpdDsNCiAgIHVpbnQyNTYgbGFzdERhdGVEaXN0cmlidXRlZFByb2ZpdDsNCg0KICAgZnVuY3Rpb24gZ2V0RGlzdHJpYnV0ZVByb2ZpdHNJbmZvKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgbGFzdFByb2ZpdCwgdWludDI1NiBsYXN0RGF0ZSkNCiAgIHsNCiAgICAgIGxhc3RQcm9maXQgPSBsYXN0RGlzdHJpYnV0ZWRQcm9maXQ7DQogICAgICBsYXN0RGF0ZSA9IGxhc3REYXRlRGlzdHJpYnV0ZWRQcm9maXQ7DQogICB9DQoNCiAgIGZ1bmN0aW9uIHNldFByb2ZpdERpc3RyaWJ1dGlvbkNvbnRyYWN0KGFkZHJlc3MgY29udHJhY3RBZGRyZXNzKSBvbmx5RGV2ZWxvcGVyDQogICB7DQogICAgICBpZiAocHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QgPiAwKSB0aHJvdzsNCiAgICAgIHByb2ZpdERpc3RyaWJ1dGlvbkNvbnRyYWN0ID0gY29udHJhY3RBZGRyZXNzOw0KICAgfQ0KDQogICBmdW5jdGlvbiBzZXRTbWFydEFmZmlsaWF0ZUNvbnRyYWN0KGFkZHJlc3MgY29udHJhY3RBZGRyZXNzKSBvbmx5RGV2ZWxvcGVyDQogICB7DQogICAgICBpZiAoYWRkcmVzcyhzbWFydEFmZmlsaWF0ZUNvbnRyYWN0KSA+IDApIHRocm93Ow0KICAgICAgc21hcnRBZmZpbGlhdGVDb250cmFjdCA9IFNtYXJ0QWZmaWxpYXRlKGNvbnRyYWN0QWRkcmVzcyk7DQogICB9DQoNCiAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVQcm9maXRzKHVpbnQyNTYgZ2FzVmFsdWUpIG9ubHlEZXZlbG9wZXJPck9wZXJhdG9yDQogICB7DQogICAgICBpZiAocHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QgPiAwICYmIHRoaXMuYmFsYW5jZSA+PSAoYmFua3JvbExpbWl0K3Byb2ZpdExpbWl0KSkNCiAgICAgIHsNCiAgICAgICAgIHVpbnQyNTYgZGlmZiA9IHRoaXMuYmFsYW5jZSAtIGJhbmtyb2xMaW1pdDsNCiAgICAgICAgIGlmIChhZGRyZXNzKHByb2ZpdERpc3RyaWJ1dGlvbkNvbnRyYWN0KS5jYWxsLmdhcyhnYXNWYWx1ZSkudmFsdWUoZGlmZikoKSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgICBsYXN0RGlzdHJpYnV0ZWRQcm9maXQgPSBkaWZmOw0KICAgICAgICAgbGFzdERhdGVEaXN0cmlidXRlZFByb2ZpdCA9IGJsb2NrLnRpbWVzdGFtcDsNCiAgICAgIH0NCiAgIH0NCg0KICAgZnVuY3Rpb24gZ2V0VG9rZW5TZXR0aW5ncygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQxNiBDb2VmX3BsYXllciwgdWludDI1NiBCYW5rcm9sTGltaXQsIHVpbnQyNTYgUHJvZml0TGltaXQpDQogICB7DQogICAgICBDb2VmX3BsYXllciA9IGNvZWZfcGxheWVyOw0KICAgICAgQmFua3JvbExpbWl0ID0gYmFua3JvbExpbWl0Ow0KICAgICAgUHJvZml0TGltaXQgPSBwcm9maXRMaW1pdDsNCiAgIH0NCg0KICAgZnVuY3Rpb24gY2hhbmdlVG9rZW5TZXR0aW5ncyh1aW50MTYgbmV3Q29lZl9wbGF5ZXIsIHVpbnQyNTYgbmV3QmFua3JvbExpbWl0LCB1aW50MjU2IG5ld1Byb2ZpdExpbWl0KSBvbmx5RGV2ZWxvcGVyDQogICB7DQogICAgICBjb2VmX3BsYXllciAgPSBuZXdDb2VmX3BsYXllcjsNCiAgICAgIGJhbmtyb2xMaW1pdCA9IG5ld0Jhbmtyb2xMaW1pdDsNCiAgICAgIHByb2ZpdExpbWl0ICA9IG5ld1Byb2ZpdExpbWl0Ow0KICAgfQ0KDQogICBmdW5jdGlvbiBjaGFuZ2VTZXR0aW5ncyh1aW50NjQgTmV3TWF4QmV0c1BlckJsb2NrLCB1aW50OCBOZXdCbG9ja0RlbGF5LCB1aW50OCBNaW5DcmVkaXRzT25CZXQ1MCwgdWludDggTWluQ3JlZGl0c09uQmV0MzMsIHVpbnQ4IE5ld0RlZmF1bHRNaW5DcmVkaXRzT25CZXQpIG9ubHlEZXZlbG9wZXINCiAgIHsNCiAgICAgIEJsb2NrRGVsYXkgPSBOZXdCbG9ja0RlbGF5Ow0KDQogICAgICBpZiAoTmV3TWF4QmV0c1BlckJsb2NrICE9IDApIG1heEdhbWJsZXNQZXJCbG9jayA9IE5ld01heEJldHNQZXJCbG9jazsNCg0KICAgICAgaWYgKE1pbkNyZWRpdHNPbkJldDUwID4gMCkNCiAgICAgIHsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmxvdyldICAgPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmhpZ2gpXSAgPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLnJlZCldICAgPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmJsYWNrKV0gPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLm9kZCldICAgPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmV2ZW4pXSAgPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgIH0NCg0KICAgICAgaWYgKE1pbkNyZWRpdHNPbkJldDMzID4gMCkNCiAgICAgIHsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmRvemVuMSldID0gTWluQ3JlZGl0c09uQmV0MzM7DQogICAgICAgIG1pbkNyZWRpdHNPbkJldFt1aW50OChCZXRUeXBlcy5kb3plbjIpXSA9IE1pbkNyZWRpdHNPbkJldDMzOw0KICAgICAgICBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuZG96ZW4zKV0gPSBNaW5DcmVkaXRzT25CZXQzMzsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmNvbHVtbjEpXSA9IE1pbkNyZWRpdHNPbkJldDMzOw0KICAgICAgICBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuY29sdW1uMildID0gTWluQ3JlZGl0c09uQmV0MzM7DQogICAgICAgIG1pbkNyZWRpdHNPbkJldFt1aW50OChCZXRUeXBlcy5jb2x1bW4zKV0gPSBNaW5DcmVkaXRzT25CZXQzMzsNCiAgICAgIH0NCg0KICAgICAgaWYgKE5ld0RlZmF1bHRNaW5DcmVkaXRzT25CZXQgPiAwKSBkZWZhdWx0TWluQ3JlZGl0c09uQmV0ID0gTmV3RGVmYXVsdE1pbkNyZWRpdHNPbkJldDsNCiAgIH0NCg0KICAgZnVuY3Rpb24gZGVsZXRlQ29udHJhY3QoKSBvbmx5RGV2ZWxvcGVyDQogICB7DQogICAgICAgIHN1aWNpZGUobXNnLnNlbmRlcik7DQogICB9DQoNCiAgIC8vIGJpdCBmcm9tIDAgdG8gMjU1DQogICBmdW5jdGlvbiBpc0JpdFNldCh1aW50MjU2IGRhdGEsIHVpbnQ4IGJpdCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkNCiAgIHsNCiAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICByZXQgOj0gaXN6ZXJvKGlzemVybyhhbmQoZGF0YSwgZXhwKDIsYml0KSkpKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXQ7DQogICB9DQoNCiAgIC8vIHVuaXF1ZSBjb21iaW5hdGlvbiBvZiBiZXQgYW5kIHdoZWVsUmVzdWx0LCB1c2VkIGZvciBhY2Nlc3MgdG8gV2luTWF0cml4DQogICBmdW5jdGlvbiBnZXRJbmRleCh1aW50MTYgYmV0LCB1aW50MTYgd2hlZWxSZXN1bHQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDE2KQ0KICAgew0KICAgICAgcmV0dXJuIChiZXQrMSkqMjU2ICsgKHdoZWVsUmVzdWx0KzEpOw0KICAgfQ0KDQogICAvLyBuIGZvcm0gMSA8PSB0byA8PSAzMg0KICAgZnVuY3Rpb24gZ2V0QmV0VmFsdWUoYnl0ZXMzMiB2YWx1ZXMsIHVpbnQ4IG4pIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikNCiAgIHsNCiAgICAgICAgLy8gYmV0IGluIGNyZWRpdHMgKDEuLjI1NikNCiAgICAgICAgdWludDI1NiBiZXQgPSB1aW50MjU2KHZhbHVlc1szMi1uXSkrMTsNCg0KICAgICAgICAgLy8gY2hlY2sgbWluIGJldA0KICAgICAgICB1aW50OCBtaW5DcmVkaXRzID0gbWluQ3JlZGl0c09uQmV0W25dOw0KICAgICAgICBpZiAobWluQ3JlZGl0cyA9PSAwKSBtaW5DcmVkaXRzID0gZGVmYXVsdE1pbkNyZWRpdHNPbkJldDsNCiAgICAgICAgaWYgKGJldCA8IG1pbkNyZWRpdHMpIHRocm93Ow0KDQogICAgICAgIC8vIGJldCBpbiB3ZWkNCiAgICAgICAgYmV0ID0gY3VycmVudE1heEJldCpiZXQvMjU2Ow0KICAgICAgICBpZiAoYmV0ID4gY3VycmVudE1heEJldCkgdGhyb3c7DQoNCiAgICAgICAgcmV0dXJuIGJldDsNCiAgIH0NCg0KICAgZnVuY3Rpb24gZ2V0QmV0VmFsdWVCeUdhbWJsZShHYW1lSW5mbyBtZW1vcnkgZ2FtYmxlLCB1aW50OCBuKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICB7DQogICAgICBpZiAobjw9MzIpIHJldHVybiBnZXRCZXRWYWx1ZShnYW1ibGUudmFsdWVzLCBuKTsNCiAgICAgIGlmIChuPD02NCkgcmV0dXJuIGdldEJldFZhbHVlKGdhbWJsZS52YWx1ZXMyLCBuLTMyKTsNCiAgICAgIC8vIHRoZXJlIGFyZSA2NCBtYXhpbXVtIHVuaXF1ZSBiZXRzIChwb3NpdGlvbnMpIGluIG9uZSBnYW1lDQogICAgICB0aHJvdzsNCiAgIH0NCg0KICAgZnVuY3Rpb24gdG90YWxHYW1lcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICB7DQogICAgICAgcmV0dXJuIGdhbWJsZXMubGVuZ3RoOw0KICAgfQ0KDQogICBmdW5jdGlvbiBnZXRTZXR0aW5ncygpIGNvbnN0YW50IHJldHVybnModWludDI1NiBtYXhCZXQsIHVpbnQyNTYgb25lQ3JlZGl0LCB1aW50OCBNaW5CZXRJbkNyZWRpdHMsIHVpbnQ4IE1pbkJldEluQ3JlZGl0c181MCx1aW50OCBNaW5CZXRJbkNyZWRpdHNfMzMsIHVpbnQ4IGJsb2NrRGVsYXlCZWZvcmVTcGluLCBib29sIGNvbnRyYWN0U3RhdGUpDQogICAgew0KICAgICAgICBtYXhCZXQgICAgPSBjdXJyZW50TWF4QmV0Ow0KICAgICAgICBvbmVDcmVkaXQgPSBjdXJyZW50TWF4QmV0IC8gMjU2Ow0KICAgICAgICBibG9ja0RlbGF5QmVmb3JlU3BpbiA9IEJsb2NrRGVsYXk7DQogICAgICAgIE1pbkJldEluQ3JlZGl0cyAgICAgID0gZGVmYXVsdE1pbkNyZWRpdHNPbkJldDsNCiAgICAgICAgTWluQmV0SW5DcmVkaXRzXzUwICAgPSBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMubG93KV07DQogICAgICAgIE1pbkJldEluQ3JlZGl0c18zMyAgID0gbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmNvbHVtbjEpXTsNCiAgICAgICAgY29udHJhY3RTdGF0ZSAgICAgICAgPSBDb250cmFjdFN0YXRlOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG9ubHlEZXZlbG9wZXIoKQ0KICAgIHsNCiAgICAgICBpZiAobXNnLnNlbmRlciAhPSBkZXZlbG9wZXIpIHRocm93Ow0KICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgb25seURldmVsb3Blck9yT3BlcmF0b3IoKQ0KICAgIHsNCiAgICAgICBpZiAobXNnLnNlbmRlciAhPSBkZXZlbG9wZXIgJiYgbXNnLnNlbmRlciAhPSBvcGVyYXRvcikgdGhyb3c7DQogICAgICAgXzsNCiAgICB9DQoNCiAgIGZ1bmN0aW9uIGRpc2FibGVCZXR0aW5nX29ubHlfRGV2KCkNCiAgICBvbmx5RGV2ZWxvcGVyT3JPcGVyYXRvcg0KICAgIHsNCiAgICAgICAgQ29udHJhY3RTdGF0ZT1mYWxzZTsNCiAgICB9DQoNCg0KICAgIGZ1bmN0aW9uIGNoYW5nZU9wZXJhdG9yKGFkZHJlc3MgbmV3T3BlcmF0b3IpIG9ubHlEZXZlbG9wZXINCiAgICB7DQogICAgICAgb3BlcmF0b3IgPSBuZXdPcGVyYXRvcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBlbmFibGVCZXR0aW5nX29ubHlfRGV2KCkNCiAgICBvbmx5RGV2ZWxvcGVyT3JPcGVyYXRvcg0KICAgIHsNCiAgICAgICAgQ29udHJhY3RTdGF0ZT10cnVlOw0KDQogICAgfQ0KDQogICAgZXZlbnQgUGxheWVyQmV0KHVpbnQyNTYgZ2FtYmxlSWQsIHVpbnQyNTYgcGxheWVyVG9rZW5zKTsNCiAgICBldmVudCBFbmRHYW1lKGFkZHJlc3MgcGxheWVyLCB1aW50OCByZXN1bHQsIHVpbnQyNTYgZ2FtYmxlSWQpOw0KICAgIGV2ZW50IFNldHRpbmdzQ2hhbmdlZCh1aW50MjU2IG1heEJldCwgdWludDI1NiBvbmVDcmVkaXQsIHVpbnQ4IERlZmF1bHRNaW5CZXRJbkNyZWRpdHMsIHVpbnQ4IE1pbkJldEluQ3JlZGl0czUwLCB1aW50OCBNaW5CZXRJbkNyZWRpdHMzMywgdWludDggYmxvY2tEZWxheUJlZm9yZVNwaW4sIGJvb2wgY29udHJhY3RTdGF0ZSk7DQogICAgZXZlbnQgRXJyb3JMb2coYWRkcmVzcyBwbGF5ZXIsIHN0cmluZyBtZXNzYWdlKTsNCiAgICBldmVudCBHYXNMb2coc3RyaW5nIG1zZywgdWludDI1NiBsZXZlbCwgdWludDI1NiBnYXMpOw0KDQogICBmdW5jdGlvbiB0b3RhbEJldFZhbHVlKEdhbWVJbmZvIG1lbW9yeSBnKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICB7DQogICAgICAgdWludDI1NiB0b3RhbEJldHNWYWx1ZSA9IDA7DQogICAgICAgdWludDggblBsYXllckJldE5vID0gMDsNCiAgICAgICB1aW50OCBiZXRzQ291bnQgPSB1aW50OChieXRlczMyKGcuYmV0cylbMF0pOw0KDQogICAgICAgZm9yKHVpbnQ4IGkgPSAwOyBpIDwgbWF4VHlwZUJldHM7aSsrKQ0KICAgICAgICBpZiAoaXNCaXRTZXQoZy5iZXRzLCBpKSkNCiAgICAgICAgew0KICAgICAgICAgIHRvdGFsQmV0c1ZhbHVlICs9IGdldEJldFZhbHVlQnlHYW1ibGUoZywgblBsYXllckJldE5vKzEpOw0KICAgICAgICAgIG5QbGF5ZXJCZXRObysrOw0KDQogICAgICAgICAgaWYgKGJldHNDb3VudCA9PSAxKSBicmVhazsNCiAgICAgICAgICBiZXRzQ291bnQtLTsNCiAgICAgICAgfQ0KDQogICAgICAgcmV0dXJuIHRvdGFsQmV0c1ZhbHVlOw0KICAgfQ0KDQogICBmdW5jdGlvbiB0b3RhbEJldENvdW50KEdhbWVJbmZvIG1lbW9yeSBnKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICB7DQogICAgICAgdWludDI1NiB0b3RhbEJldHMgPSAwOw0KICAgICAgIGZvcih1aW50OCBpPTA7IGkgPCBtYXhUeXBlQmV0cztpKyspDQogICAgICAgIGlmIChpc0JpdFNldChnLmJldHMsIGkpKSB0b3RhbEJldHMrKzsNCiAgICAgICByZXR1cm4gdG90YWxCZXRzOw0KICAgfQ0KDQogICBmdW5jdGlvbiBwbGFjZUJldCh1aW50MjU2IGJldHMsIGJ5dGVzMzIgdmFsdWVzMSxieXRlczMyIHZhbHVlczIpIHB1YmxpYyBwYXlhYmxlDQogICB7DQogICAgICAgaWYgKENvbnRyYWN0U3RhdGUgPT0gZmFsc2UpDQogICAgICAgew0KICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIkNvbnRyYWN0RGlzYWJsZWQiKTsNCiAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgICByZXR1cm47DQogICAgICAgfQ0KDQogICAgICAgaWYgKHNtYXJ0VG9rZW4uaXNPcGVyYXRpb25CbG9ja2VkKCkpDQogICAgICAgew0KICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIkVtaXNzaW9uQmxvY2tlZCIpOw0KICAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgICAgIHJldHVybjsNCiAgICAgICB9DQoNCiAgICAgICB2YXIgZ2FtYmxlc0xlbmd0aCA9IGdhbWJsZXMubGVuZ3RoOw0KDQogICAgICAgaWYgKGdhbWJsZXNMZW5ndGggPiAwKQ0KICAgICAgIHsNCiAgICAgICAgICB1aW50OCBnYW1ibGVzQ291bnRJbkN1cnJlbnRCbG9jayA9IDA7DQogICAgICAgICAgZm9yKHZhciBpID0gZ2FtYmxlc0xlbmd0aCAtIDE7aSA+IDA7IGktLSkNCiAgICAgICAgICB7DQogICAgICAgICAgICBpZiAoZ2FtYmxlc1tpXS5ibG9ja051bWJlciA9PSBibG9jay5udW1iZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICBpZiAoZ2FtYmxlc1tpXS5wbGF5ZXIgPT0gbXNnLnNlbmRlcikNCiAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiUGxheSB0d2ljZSB0aGUgc2FtZSBibG9jayIpOw0KICAgICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICBnYW1ibGVzQ291bnRJbkN1cnJlbnRCbG9jaysrOw0KICAgICAgICAgICAgICAgaWYgKGdhbWJsZXNDb3VudEluQ3VycmVudEJsb2NrID49IG1heEdhbWJsZXNQZXJCbG9jaykNCiAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJtYXhHYW1ibGVzUGVyQmxvY2siKTsNCiAgICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgfQ0KDQogICAgICAgdmFyIF9jdXJyZW50TWF4QmV0ID0gY3VycmVudE1heEJldDsNCg0KICAgICAgIGlmIChtc2cudmFsdWUgPCBfY3VycmVudE1heEJldC8yNTYgfHwgYmV0cyA9PSAwKQ0KICAgICAgIHsNCiAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiV3JvbmcgYmV0IHZhbHVlIik7DQogICAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgfQ0KDQogICAgICAgaWYgKG1zZy52YWx1ZSA+IF9jdXJyZW50TWF4QmV0KQ0KICAgICAgIHsNCiAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiTGltaXQgZm9yIHRhYmxlIik7DQogICAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgfQ0KDQogICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBHYW1lSW5mbyhtc2cuc2VuZGVyLCBibG9jay5udW1iZXIsIDM3LCBiZXRzLCB2YWx1ZXMxLHZhbHVlczIpOw0KDQogICAgICAgaWYgKHRvdGFsQmV0VmFsdWUoZykgIT0gbXNnLnZhbHVlKQ0KICAgICAgIHsNCiAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiV3JvbmcgYmV0IHZhbHVlIik7DQogICAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgfQ0KDQogICAgICAgZ2FtYmxlcy5wdXNoKGcpOw0KDQogICAgICAgYWRkcmVzcyBhZmZpbGlhdGUgPSAwOw0KICAgICAgIHVpbnQxNiBjb2VmX2FmZmlsaWF0ZSA9IDA7DQogICAgICAgaWYgKGFkZHJlc3Moc21hcnRBZmZpbGlhdGVDb250cmFjdCkgPiAwKQ0KICAgICAgIHsNCiAgICAgICAgIChhZmZpbGlhdGUsIGNvZWZfYWZmaWxpYXRlKSA9IHNtYXJ0QWZmaWxpYXRlQ29udHJhY3QuZ2V0QWZmaWxpYXRlSW5mbyhtc2cuc2VuZGVyKTsNCiAgICAgICB9DQoNCiAgICAgICB1aW50MjU2IHBsYXllclRva2VucyA9IHNtYXJ0VG9rZW4uZW1pc3Npb24obXNnLnNlbmRlciwgYWZmaWxpYXRlLCBtc2cudmFsdWUsIGNvZWZfcGxheWVyLCBjb2VmX2FmZmlsaWF0ZSk7DQoNCiAgICAgICBQbGF5ZXJCZXQoZ2FtYmxlc0xlbmd0aCwgcGxheWVyVG9rZW5zKTsNCiAgIH0NCg0KICAgIGZ1bmN0aW9uIEludmVzdCgpIHBheWFibGUgb25seURldmVsb3Blcg0KICAgIHsNCg0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEdldEdhbWVJbmRleGVzVG9Qcm9jZXNzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTZbNjRdIGdhbWVJbmRleGVzKQ0KICAgIHsNCiAgICAgIHVpbnQ4IGluZGV4ID0gMDsNCiAgICAgIGZvcihpbnQyNTYgaSA9IGludDI1NihnYW1ibGVzLmxlbmd0aCkgLSAxO2kgPj0gMDtpLS0pDQogICAgICB7DQogICAgICAgICBHYW1lSW5mbyBtZW1vcnkgZyA9IGdhbWJsZXNbdWludDI1NihpKV07DQogICAgICAgICBpZiAoYmxvY2subnVtYmVyIC0gZy5ibG9ja051bWJlciA+PSAyNTYpIGJyZWFrOw0KDQogICAgICAgICAvLyBpZiBibG9jay5udW1iZXIgPT0gKGcuYmxvY2tOdW1iZXIgKyBCbG9ja0RlbGF5KSB3ZSBjYW4ndCBnZXQgYmxvY2toYXNoIGluIHRoZSBjdXJyZW50IGJsb2NrLCANCiAgICAgICAgIC8vIGJ1dCB3ZSBjYW4gY2FsY3VsYXRlIHByZWxpbWluYXJ5IGdhbWUgcmVzdWx0IGZvciBwbGF5ZXIgYW5kIHNlbmQgdHJhbnNhY3Rpb24gKHRoYXQgd2lsbCBiZSBtaW5lZCBpbiB0aGUgbmV4dCBibG9jaykgICAgICAgICANCiAgICAgICAgIGlmIChnLndoZWVsUmVzdWx0ID09IDM3ICYmIGJsb2NrLm51bWJlciA+PSBnLmJsb2NrTnVtYmVyICsgQmxvY2tEZWxheSkNCiAgICAgICAgIHsNCiAgICAgICAgICAgIGdhbWVJbmRleGVzW2luZGV4KytdID0gdWludDI1NihpICsgMSk7DQogICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgdWludDI1NiBsYXN0QmxvY2tHYW1lc1Byb2Nlc3NlZDsNCg0KICAgIGZ1bmN0aW9uIFByb2Nlc3NHYW1lcyh1aW50MjU2W10gZ2FtZUluZGV4ZXMsIGJvb2wgc2ltdWxhdGUpDQogICAgew0KICAgICAgaWYgKCFzaW11bGF0ZSkNCiAgICAgIHsNCiAgICAgICAgIGlmIChsYXN0QmxvY2tHYW1lc1Byb2Nlc3NlZCA9PSBibG9jay5udW1iZXIpICByZXR1cm47DQogICAgICAgICBsYXN0QmxvY2tHYW1lc1Byb2Nlc3NlZCA9IGJsb2NrLm51bWJlcjsNCiAgICAgIH0NCg0KICAgICAgdWludDggZGVsYXkgPSBCbG9ja0RlbGF5Ow0KICAgICAgdWludDI1NiBsZW5ndGggPSBnYW1lSW5kZXhlcy5sZW5ndGg7DQogICAgICBib29sIHN1Y2Nlc3MgPSBmYWxzZTsNCiAgICAgIGZvcih1aW50MjU2IGkgPSAwO2kgPCBsZW5ndGg7aSsrKQ0KICAgICAgew0KICAgICAgICAgaWYgKFByb2Nlc3NHYW1lKGdhbWVJbmRleGVzW2ldLCBkZWxheSkgPT0gR2FtZVN0YXR1cy5TdWNjZXNzKSBzdWNjZXNzID0gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmIChzaW11bGF0ZSAmJiAhc3VjY2VzcykgdGhyb3c7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gUHJvY2Vzc0dhbWVFeHQodWludDI1NiBpbmRleCkgcHVibGljIHJldHVybnMgKEdhbWVTdGF0dXMpDQogICAgew0KICAgICAgcmV0dXJuIFByb2Nlc3NHYW1lKGluZGV4LCBCbG9ja0RlbGF5KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBQcm9jZXNzR2FtZSh1aW50MjU2IGluZGV4LCB1aW50MjU2IGRlbGF5KSBwcml2YXRlIHJldHVybnMgKEdhbWVTdGF0dXMpDQogICAgew0KICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW2luZGV4XTsNCiAgICAgIGlmIChibG9jay5udW1iZXIgLSBnLmJsb2NrTnVtYmVyID49IDI1NikgcmV0dXJuIEdhbWVTdGF0dXMuU3RvcDsNCg0KICAgICAgaWYgKGcud2hlZWxSZXN1bHQgPT0gMzcgJiYgYmxvY2subnVtYmVyID4gZy5ibG9ja051bWJlciArIGRlbGF5KQ0KICAgICAgew0KICAgICAgICAgZ2FtYmxlc1tpbmRleF0ud2hlZWxSZXN1bHQgPSBnZXRSYW5kb21OdW1iZXIoZy5wbGF5ZXIsIGcuYmxvY2tOdW1iZXIpOw0KDQogICAgICAgICB1aW50MjU2IHBsYXllcldpbm5pbmdzID0gZ2V0R2FtZVJlc3VsdChnYW1ibGVzW2luZGV4XSk7DQogICAgICAgICBpZiAocGxheWVyV2lubmluZ3MgPiAwKQ0KICAgICAgICAgew0KICAgICAgICAgICAgaWYgKGcucGxheWVyLnNlbmQocGxheWVyV2lubmluZ3MpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgICAgIH0NCg0KICAgICAgICAgRW5kR2FtZShnLnBsYXllciwgZ2FtYmxlc1tpbmRleF0ud2hlZWxSZXN1bHQsIGluZGV4KTsNCiAgICAgICAgIHJldHVybiBHYW1lU3RhdHVzLlN1Y2Nlc3M7DQogICAgICB9DQoNCiAgICAgIHJldHVybiBHYW1lU3RhdHVzLlNraXBwZWQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0UmFuZG9tTnVtYmVyKGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IHBsYXllcmJsb2NrKSBwcml2YXRlIHJldHVybnModWludDggd2hlZWxSZXN1bHQpDQogICAgew0KICAgICAgICAvLyBibG9jay5ibG9ja2hhc2ggLSBoYXNoIG9mIHRoZSBnaXZlbiBibG9jayAtIG9ubHkgd29ya3MgZm9yIDI1NiBtb3N0IHJlY2VudCBibG9ja3MgZXhjbHVkaW5nIGN1cnJlbnQNCiAgICAgICAgYnl0ZXMzMiBibG9ja0hhc2ggPSBibG9jay5ibG9ja2hhc2gocGxheWVyYmxvY2srQmxvY2tEZWxheSk7DQoNCiAgICAgICAgaWYgKGJsb2NrSGFzaD09MCkNCiAgICAgICAgew0KICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJDYW5ub3QgZ2VuZXJhdGUgcmFuZG9tIG51bWJlciIpOw0KICAgICAgICAgIHdoZWVsUmVzdWx0ID0gMjAwOw0KICAgICAgICB9DQogICAgICAgIGVsc2UNCiAgICAgICAgew0KICAgICAgICAgIGJ5dGVzMzIgc2hhUGxheWVyID0gc2hhMyhwbGF5ZXIsIGJsb2NrSGFzaCk7DQoNCiAgICAgICAgICB3aGVlbFJlc3VsdCA9IHVpbnQ4KHVpbnQyNTYoc2hhUGxheWVyKSUzNyk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVSYW5kb21OdW1iZXJCeUJsb2NraGFzaCh1aW50MjU2IGJsb2NrSGFzaCwgYWRkcmVzcyBwbGF5ZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCB3aGVlbFJlc3VsdCkNCiAgICB7DQogICAgICAgICAgYnl0ZXMzMiBzaGFQbGF5ZXIgPSBzaGEzKHBsYXllciwgYmxvY2tIYXNoKTsNCg0KICAgICAgICAgIHdoZWVsUmVzdWx0ID0gdWludDgodWludDI1NihzaGFQbGF5ZXIpJTM3KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBlbWVyZ2VuY3lGaXhHYW1lUmVzdWx0KHVpbnQ2NCBnYW1ibGVJZCwgdWludDI1NiBibG9ja0hhc2gpIG9ubHlEZXZlbG9wZXJPck9wZXJhdG9yDQogICAgew0KICAgICAgLy8gUHJvYmFibHkgdGhpcyBmdW5jdGlvbiB3aWxsIG5ldmVyIGJlIGNhbGxlZCwgYnV0DQogICAgICAvLyBpZiBnYW1lIHdhcyBub3Qgc3Bpbm5lZCBpbiAyNTYgYmxvY2tzIHRoZW4gYmxvY2suYmxvY2toYXNoIHdpbGwgcmV0dXJucyBhbHdheXMgMCBhbmQNCiAgICAgIC8vIHdlIHNob3VsZCBmaXggdGhpcyBtYW51YWxseSAoeW91IGNhbiBjaGVjayByZXN1bHQgd2l0aCBwdWJsaWMgZnVuY3Rpb24gY2FsY3VsYXRlUmFuZG9tTnVtYmVyQnlCbG9ja2hhc2gpDQogICAgICBHYW1lSW5mbyBtZW1vcnkgZ2FtYmxlID0gZ2FtYmxlc1tnYW1ibGVJZF07DQogICAgICBpZiAoZ2FtYmxlLndoZWVsUmVzdWx0ICE9IDIwMCkgdGhyb3c7DQoNCiAgICAgIGdhbWJsZXNbZ2FtYmxlSWRdLndoZWVsUmVzdWx0ID0gY2FsY3VsYXRlUmFuZG9tTnVtYmVyQnlCbG9ja2hhc2goYmxvY2tIYXNoLCBnYW1ibGUucGxheWVyKTsNCg0KICAgICAgdWludDI1NiBwbGF5ZXJXaW5uaW5ncyA9IGdldEdhbWVSZXN1bHQoZ2FtYmxlc1tnYW1ibGVJZF0pOw0KICAgICAgaWYgKHBsYXllcldpbm5pbmdzID4gMCkNCiAgICAgIHsNCiAgICAgICAgaWYgKGdhbWJsZS5wbGF5ZXIuc2VuZChwbGF5ZXJXaW5uaW5ncykgPT0gZmFsc2UpIHRocm93Ow0KICAgICAgfQ0KDQogICAgICBFbmRHYW1lKGdhbWJsZS5wbGF5ZXIsIGdhbWJsZS53aGVlbFJlc3VsdCwgZ2FtYmxlSWQpOw0KICAgIH0NCg0KDQogICAgZnVuY3Rpb24gcHJlbGltaW5hcnlHYW1lUmVzdWx0KHVpbnQ2NCBnYW1ibGVJbmRleCkgY29uc3RhbnQgcmV0dXJucyAodWludDY0IGdhbWJsZUlkLCBhZGRyZXNzIHBsYXllciwgdWludDI1NiBibG9ja051bWJlciwgdWludDI1NiB0b3RhbFdpbiwgdWludDggd2hlZWxSZXN1bHQsIHVpbnQyNTYgYmV0cywgdWludDI1NiB2YWx1ZXMxLCB1aW50MjU2IHZhbHVlczIsIHVpbnQyNTYgblRvdGFsQmV0VmFsdWUsIHVpbnQyNTYgblRvdGFsQmV0Q291bnQpDQogICAgew0KICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW3VpbnQyNTYoZ2FtYmxlSW5kZXgpXTsNCg0KICAgICAgaWYgKGcud2hlZWxSZXN1bHQgPT0gMzcgJiYgYmxvY2subnVtYmVyID4gZy5ibG9ja051bWJlciArIEJsb2NrRGVsYXkpDQogICAgICB7DQogICAgICAgICBnYW1ibGVzW2dhbWJsZUluZGV4XS53aGVlbFJlc3VsdCA9IGdldFJhbmRvbU51bWJlcihnLnBsYXllciwgZy5ibG9ja051bWJlcik7DQogICAgICAgICByZXR1cm4gZ2V0R2FtZShnYW1ibGVJbmRleCk7DQogICAgICB9DQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvLyBQcmVsaW1pbmFyeSBnYW1lIHJlc3VsdCBiZWZvcmUgcmVhbCB0cmFuc2FjdGlvbiBpcyBtaW5lZA0KICAgIGZ1bmN0aW9uIGNhbGNSYW5kb21OdW1iZXJBbmRHZXRQcmVsaW1pbmFyeUdhbWVSZXN1bHQodWludDI1NiBibG9ja0hhc2gsIHVpbnQ2NCBnYW1ibGVJbmRleCkgY29uc3RhbnQgcmV0dXJucyAodWludDY0IGdhbWJsZUlkLCBhZGRyZXNzIHBsYXllciwgdWludDI1NiBibG9ja051bWJlciwgdWludDI1NiB0b3RhbFdpbiwgdWludDggd2hlZWxSZXN1bHQsIHVpbnQyNTYgYmV0cywgdWludDI1NiB2YWx1ZXMxLCB1aW50MjU2IHZhbHVlczIsIHVpbnQyNTYgblRvdGFsQmV0VmFsdWUsIHVpbnQyNTYgblRvdGFsQmV0Q291bnQpDQogICAgew0KICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW3VpbnQyNTYoZ2FtYmxlSW5kZXgpXTsNCiAgICAgIGcud2hlZWxSZXN1bHQgPSBjYWxjdWxhdGVSYW5kb21OdW1iZXJCeUJsb2NraGFzaChibG9ja0hhc2gsIGcucGxheWVyKTsNCg0KICAgICAgZ2FtYmxlSWQgPSBnYW1ibGVJbmRleDsNCiAgICAgIHBsYXllciA9IGcucGxheWVyOw0KICAgICAgd2hlZWxSZXN1bHQgPSBnLndoZWVsUmVzdWx0Ow0KICAgICAgdG90YWxXaW4gPSBnZXRHYW1lUmVzdWx0KGcpOw0KICAgICAgYmxvY2tOdW1iZXIgPSBnLmJsb2NrTnVtYmVyOw0KICAgICAgblRvdGFsQmV0VmFsdWUgPSB0b3RhbEJldFZhbHVlKGcpOw0KICAgICAgblRvdGFsQmV0Q291bnQgPSB0b3RhbEJldENvdW50KGcpOw0KICAgICAgYmV0cyA9IGcuYmV0czsNCiAgICAgIHZhbHVlczEgPSB1aW50MjU2KGcudmFsdWVzKTsNCiAgICAgIHZhbHVlczIgPSB1aW50MjU2KGcudmFsdWVzMik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0R2FtZVJlc3VsdChHYW1lSW5mbyBtZW1vcnkgZ2FtZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHRvdGFsV2luKQ0KICAgIHsNCiAgICAgICAgdG90YWxXaW4gPSAwOw0KICAgICAgICB1aW50OCBuUGxheWVyQmV0Tm8gPSAwOw0KICAgICAgICAvLyB3ZSBzZW50IGNvdW50IGJldHMgYXQgbGFzdCBieXRlDQogICAgICAgIHVpbnQ4IGJldHNDb3VudCA9IHVpbnQ4KGJ5dGVzMzIoZ2FtZS5iZXRzKVswXSk7DQogICAgICAgIGZvcih1aW50OCBpPTA7IGk8bWF4VHlwZUJldHM7IGkrKykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGlzQml0U2V0KGdhbWUuYmV0cywgaSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIHZhciB3aW5NdWwgPSB3aW5NYXRyaXguZ2V0Q29lZmYoZ2V0SW5kZXgoaSwgZ2FtZS53aGVlbFJlc3VsdCkpOyAvLyBnZXQgd2luIGNvZWYNCiAgICAgICAgICAgICAgaWYgKHdpbk11bCA+IDApIHdpbk11bCsrOyAvLyArIHJldHVybiBwbGF5ZXIgYmV0DQogICAgICAgICAgICAgIHRvdGFsV2luICs9IHdpbk11bCAqIGdldEJldFZhbHVlQnlHYW1ibGUoZ2FtZSwgblBsYXllckJldE5vKzEpOw0KICAgICAgICAgICAgICBuUGxheWVyQmV0Tm8rKzsNCg0KICAgICAgICAgICAgICBpZiAoYmV0c0NvdW50ID09IDEpIGJyZWFrOw0KICAgICAgICAgICAgICBiZXRzQ291bnQtLTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldEdhbWUodWludDY0IGluZGV4KSBjb25zdGFudCByZXR1cm5zICh1aW50NjQgZ2FtYmxlSWQsIGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IGJsb2NrTnVtYmVyLCB1aW50MjU2IHRvdGFsV2luLCB1aW50OCB3aGVlbFJlc3VsdCwgdWludDI1NiBiZXRzLCB1aW50MjU2IHZhbHVlczEsIHVpbnQyNTYgdmFsdWVzMiwgdWludDI1NiBuVG90YWxCZXRWYWx1ZSwgdWludDI1NiBuVG90YWxCZXRDb3VudCkNCiAgICB7DQogICAgICAgIGdhbWJsZUlkID0gaW5kZXg7DQogICAgICAgIHBsYXllciA9IGdhbWJsZXNbaW5kZXhdLnBsYXllcjsNCiAgICAgICAgdG90YWxXaW4gPSBnZXRHYW1lUmVzdWx0KGdhbWJsZXNbaW5kZXhdKTsNCiAgICAgICAgYmxvY2tOdW1iZXIgPSBnYW1ibGVzW2luZGV4XS5ibG9ja051bWJlcjsNCiAgICAgICAgd2hlZWxSZXN1bHQgPSBnYW1ibGVzW2luZGV4XS53aGVlbFJlc3VsdDsNCiAgICAgICAgblRvdGFsQmV0VmFsdWUgPSB0b3RhbEJldFZhbHVlKGdhbWJsZXNbaW5kZXhdKTsNCiAgICAgICAgblRvdGFsQmV0Q291bnQgPSB0b3RhbEJldENvdW50KGdhbWJsZXNbaW5kZXhdKTsNCiAgICAgICAgYmV0cyA9IGdhbWJsZXNbaW5kZXhdLmJldHM7DQogICAgICAgIHZhbHVlczEgPSB1aW50MjU2KGdhbWJsZXNbaW5kZXhdLnZhbHVlcyk7DQogICAgICAgIHZhbHVlczIgPSB1aW50MjU2KGdhbWJsZXNbaW5kZXhdLnZhbHVlczIpOw0KICAgIH0NCg0KICAgZnVuY3Rpb24oKQ0KICAgew0KICAgICAgdGhyb3c7DQogICB9DQoNCg0KfQ=='