base 64 content
base64smartRoulette2
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQpjb250cmFjdCBXaW5NYXRyaXgNCiB7DQogICBmdW5jdGlvbiBnZXRDb2VmZih1aW50MTYgbikgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7DQogICBmdW5jdGlvbiBnZXRCZXRzUHJvY2Vzc2VkKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDE2KTsNCiB9DQoNCmNvbnRyYWN0IFNtYXJ0Um91bGV0dGVUb2tlbiANCnsNCiAgIGZ1bmN0aW9uIGVtaXNzaW9uKGFkZHJlc3MgcGxheWVyLCBhZGRyZXNzIHBhcnRuZXIsIHVpbnQyNTYgdmFsdWVfYmV0LCB1aW50MTYgY29lZl9wbGF5ZXIsIHVpbnQxNiBjb2VmX3BhcnRuZXIpIGV4dGVybmFsIHJldHVybnModWludDI1Nik7DQogICBmdW5jdGlvbiBpc09wZXJhdGlvbkJsb2NrZWQoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKTsNCn0NCg0KY29udHJhY3QgU21hcnRBZmZpbGlhdGUgDQp7DQogICBmdW5jdGlvbiByZWdpc3RlcihhZGRyZXNzIHBsYXllciwgYWRkcmVzcyBhZmZpbGlhdGUpIGV4dGVybmFsOw0KICAgZnVuY3Rpb24gZ2V0QWZmaWxpYXRlSW5mbyhhZGRyZXNzIHBsYXllcikgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzIGFmZmlsaWF0ZSwgdWludDE2IGNvZWZfYWZmaWxpYXRlKTsNCn0NCg0KY29udHJhY3QgU21hcnRSb3VsZXR0ZQ0Kew0KICBhZGRyZXNzIGRldmVsb3BlcjsNCiAgYWRkcmVzcyBvcGVyYXRvcjsNCg0KICAvLyBXYWl0IEJsb2NrRGVsYXkgYmxvY2tzIGJlZm9yZSBzcGluIHRoZSB3aGVlbCANCiAgdWludDggQmxvY2tEZWxheTsNCg0KICAvLyBNYXhpbXVtIGJldCB2YWx1ZSBmb3IgZ2FtZQ0KICB1aW50MjU2IGN1cnJlbnRNYXhCZXQ7ICAgIA0KDQogIC8vIG1heGltdW0gZ2FtZXMgY291bnQgcGVyIGJsb2NrDQogIHVpbnQ2NCBtYXhHYW1ibGVzUGVyQmxvY2s7DQogICAgICAgIA0KICAvLyBFbmFibGVcZGlzYWJsZSB0byBwbGFjZSBuZXcgYmV0cw0KICBib29sIENvbnRyYWN0U3RhdGU7DQoNCiAgLy8gdGFibGUgd2l0aCB3aW5uZXIgY29lZmZpY2llbnRzDQogIFdpbk1hdHJpeCB3aW5NYXRyaXg7DQoNCiAgU21hcnRSb3VsZXR0ZVRva2VuIHNtYXJ0VG9rZW47DQoNCiAgYWRkcmVzcyBwcm9maXREaXN0cmlidXRpb25Db250cmFjdDsNCg0KICBTbWFydEFmZmlsaWF0ZSBzbWFydEFmZmlsaWF0ZUNvbnRyYWN0Ow0KDQogIHVpbnQxNiBjb25zdGFudCBtYXhUeXBlQmV0cyA9IDE1NzsNCiAgIA0KICAgdWludDE2IGNvZWZfcGxheWVyOyAgIA0KICAgLy8gDQogICB1aW50OCBkZWZhdWx0TWluQ3JlZGl0c09uQmV0OyANCiAgIC8vDQogICBtYXBwaW5nICh1aW50OCA9PiB1aW50OCkgcHJpdmF0ZSBtaW5DcmVkaXRzT25CZXQ7DQoNCiAgIHN0cnVjdCBHYW1lSW5mbw0KICAgew0KICAgICAgICBhZGRyZXNzIHBsYXllcjsNCiAgICAgICAgdWludDI1NiBibG9ja051bWJlcjsNCiAgICAgICAgdWludDggd2hlZWxSZXN1bHQ7DQogICAgICAgIHVpbnQyNTYgYmV0czsNCiAgICAgICAgYnl0ZXMzMiB2YWx1ZXM7DQogICAgICAgIGJ5dGVzMzIgdmFsdWVzMjsNCiAgIH0NCiAgICAgICANCiAgIEdhbWVJbmZvW10gcHJpdmF0ZSBnYW1ibGVzOw0KDQogICBlbnVtIEdhbWVTdGF0dXMge1N1Y2Nlc3MsIFNraXBwZWQsIFN0b3B9DQoNCiAgIGVudW0gQmV0VHlwZXN7bnVtYmVyMCwgbnVtYmVyMSxudW1iZXIyLG51bWJlcjMsbnVtYmVyNCxudW1iZXI1LG51bWJlcjYsbnVtYmVyNyxudW1iZXI4LG51bWJlcjksDQogICAgIG51bWJlcjEwLG51bWJlcjExLG51bWJlcjEyLG51bWJlcjEzLG51bWJlcjE0LG51bWJlcjE1LG51bWJlcjE2LG51bWJlcjE3LG51bWJlcjE4LG51bWJlcjE5LG51bWJlcjIwLG51bWJlcjIxLA0KICAgICBudW1iZXIyMixudW1iZXIyMyxudW1iZXIyNCxudW1iZXIyNSxudW1iZXIyNixudW1iZXIyNyxudW1iZXIyOCxudW1iZXIyOSxudW1iZXIzMCxudW1iZXIzMSxudW1iZXIzMixudW1iZXIzMywNCiAgICAgbnVtYmVyMzQsbnVtYmVyMzUsbnVtYmVyMzYsIHJlZCwgYmxhY2ssIG9kZCwgZXZlbiwgZG96ZW4xLGRvemVuMixkb3plbjMsIGNvbHVtbjEsY29sdW1uMixjb2x1bW4zLCBsb3csaGlnaCwNCiAgICAgcGFpcl8wMSwgcGFpcl8wMiwgcGFpcl8wMywgcGFpcl8xMiwgcGFpcl8yMywgcGFpcl8zNiwgcGFpcl8yNSwgcGFpcl8xNCwgcGFpcl80NSwgcGFpcl81NiwgcGFpcl82OSwgcGFpcl81OCwgcGFpcl80NywNCiAgICAgcGFpcl83OCwgcGFpcl84OSwgcGFpcl85MTIsIHBhaXJfODExLCBwYWlyXzcxMCwgcGFpcl8xMDExLCBwYWlyXzExMTIsIHBhaXJfMTIxNSwgcGFpcl8xNTE4LCBwYWlyXzE2MTcsIHBhaXJfMTcxOCwgcGFpcl8xNzIwLA0KICAgICBwYWlyXzE2MTksIHBhaXJfMTkyMiwgcGFpcl8yMDIzLCBwYWlyXzIxMjQsIHBhaXJfMjIyMywgcGFpcl8yMzI0LCBwYWlyXzI1MjgsIHBhaXJfMjYyOSwgcGFpcl8yNzMwLCBwYWlyXzI4MjksIHBhaXJfMjkzMCwgcGFpcl8xMTE0LA0KICAgICBwYWlyXzEwMTMsIHBhaXJfMTMxNCwgcGFpcl8xNDE1LCBwYWlyXzEzMTYsIHBhaXJfMTQxNywgcGFpcl8xODIxLCBwYWlyXzE5MjAsIHBhaXJfMjAyMSwgcGFpcl8yMjI1LCBwYWlyXzIzMjYsIHBhaXJfMjQyNywgcGFpcl8yNTI2LA0KICAgICBwYWlyXzI2MjcsIHBhaXJfMjgzMSwgcGFpcl8yOTMyLCBwYWlyXzMwMzMsIHBhaXJfMzEzMiwgcGFpcl8zMjMzLCBwYWlyXzMxMzQsIHBhaXJfMzIzNSwgcGFpcl8zMzM2LCBwYWlyXzM0MzUsIHBhaXJfMzUzNiwgY29ybmVyXzBfMV8yXzMsDQogICAgIGNvcm5lcl8xXzJfNV80LCBjb3JuZXJfMl8zXzZfNSwgY29ybmVyXzRfNV84XzcsIGNvcm5lcl81XzZfOV84LCBjb3JuZXJfN184XzExXzEwLCBjb3JuZXJfOF85XzEyXzExLCBjb3JuZXJfMTBfMTFfMTRfMTMsIGNvcm5lcl8xMV8xMl8xNV8xNCwNCiAgICAgY29ybmVyXzEzXzE0XzE3XzE2LCBjb3JuZXJfMTRfMTVfMThfMTcsIGNvcm5lcl8xNl8xN18yMF8xOSwgY29ybmVyXzE3XzE4XzIxXzIwLCBjb3JuZXJfMTlfMjBfMjNfMjIsIGNvcm5lcl8yMF8yMV8yNF8yMywgY29ybmVyXzIyXzIzXzI2XzI1LA0KICAgICBjb3JuZXJfMjNfMjRfMjdfMjYsIGNvcm5lcl8yNV8yNl8yOV8yOCwgY29ybmVyXzI2XzI3XzMwXzI5LCBjb3JuZXJfMjhfMjlfMzJfMzEsIGNvcm5lcl8yOV8zMF8zM18zMiwgY29ybmVyXzMxXzMyXzM1XzM0LCBjb3JuZXJfMzJfMzNfMzZfMzUsDQogICAgIHRocmVlXzBfMl8zLCB0aHJlZV8wXzFfMiwgdGhyZWVfMV8yXzMsIHRocmVlXzRfNV82LCB0aHJlZV83XzhfOSwgdGhyZWVfMTBfMTFfMTIsIHRocmVlXzEzXzE0XzE1LCB0aHJlZV8xNl8xN18xOCwgdGhyZWVfMTlfMjBfMjEsIHRocmVlXzIyXzIzXzI0LA0KICAgICB0aHJlZV8yNV8yNl8yNywgdGhyZWVfMjhfMjlfMzAsIHRocmVlXzMxXzMyXzMzLCB0aHJlZV8zNF8zNV8zNiwgc2l4XzFfMl8zXzRfNV82LCBzaXhfNF81XzZfN184XzksIHNpeF83XzhfOV8xMF8xMV8xMiwgc2l4XzEwXzExXzEyXzEzXzE0XzE1LA0KICAgICBzaXhfMTNfMTRfMTVfMTZfMTdfMTgsIHNpeF8xNl8xN18xOF8xOV8yMF8yMSwgc2l4XzE5XzIwXzIxXzIyXzIzXzI0LCBzaXhfMjJfMjNfMjRfMjVfMjZfMjcsIHNpeF8yNV8yNl8yN18yOF8yOV8zMCwgc2l4XzI4XzI5XzMwXzMxXzMyXzMzLA0KICAgICBzaXhfMzFfMzJfMzNfMzRfMzVfMzZ9DQogICANCg0KICAgZnVuY3Rpb24gU21hcnRSb3VsZXR0ZSgpIGludGVybmFsDQogICB7ICAgICAgICANCiAgICAgICAgZGV2ZWxvcGVyICA9IG1zZy5zZW5kZXI7DQogICAgICAgIG9wZXJhdG9yICAgPSBtc2cuc2VuZGVyOw0KICAgICAgICANCiAgICAgICAgd2luTWF0cml4ID0gV2luTWF0cml4KDB4MDczRDY2MjFFOTE1MGJGZjlkMUQ0NTBjYUFkM2M3OTBiNkYwNzFGMik7DQogICAgICAgIGlmICh3aW5NYXRyaXguZ2V0QmV0c1Byb2Nlc3NlZCgpICE9IG1heFR5cGVCZXRzKSB0aHJvdzsNCiAgICAgICAgDQogICAgICAgIHNtYXJ0VG9rZW4gPSBTbWFydFJvdWxldHRlVG9rZW4oMHgyYTY1MDM1NmJkODk0MzcwY2MxZDZhYmE3MWIzNmMwYWQ2YjNkYzE4KTsNCg0KICAgICAgICBjdXJyZW50TWF4QmV0ID0gMjU2MCBmaW5uZXk7IC8vIDIuNTYgZXRoZXINCiAgICAgICAgQmxvY2tEZWxheSA9IDE7ICAgICAgICANCiAgICAgICAgbWF4R2FtYmxlc1BlckJsb2NrID0gNTsNCiAgICAgICAgZGVmYXVsdE1pbkNyZWRpdHNPbkJldCA9IDE7ICAgDQogICAgICAgIENvbnRyYWN0U3RhdGUgID0gdHJ1ZTsgIA0KICAgICAgICBiYW5rcm9sTGltaXQgPSAyNzcgZXRoZXI7DQogICAgICAgIHByb2ZpdExpbWl0ICA9IDUwIGV0aGVyOw0KICAgICAgICBjb2VmX3BsYXllciA9IDMwMDsNCiAgIH0NCg0KICAgZnVuY3Rpb24gY2hhbmdlTWF4QmV0KHVpbnQyNTYgbmV3TWF4QmV0KSBwdWJsaWMgb25seURldmVsb3BlciANCiAgIHsgICAgICAgICAgICAgDQogICAgICAvLyByb3VuZHMgdG8gMiBkaWd0cw0KICAgICAgbmV3TWF4QmV0ID0gbmV3TWF4QmV0IC8gMjU2MDAwMDAwMDAwMDAwMDAwMCAqIDI1NjAwMDAwMDAwMDAwMDAwMDA7ICANCiAgICAgIGlmIChuZXdNYXhCZXQgIT0gY3VycmVudE1heEJldCkgDQogICAgICB7DQogICAgICAgIGN1cnJlbnRNYXhCZXQgPSBuZXdNYXhCZXQ7DQogICAgICAgIFNldHRpbmdzQ2hhbmdlZChjdXJyZW50TWF4QmV0LCBjdXJyZW50TWF4QmV0IC8gMjU2LCAgZGVmYXVsdE1pbkNyZWRpdHNPbkJldCwgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmxvdyldLCBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuZG96ZW4xKV0sIEJsb2NrRGVsYXksIENvbnRyYWN0U3RhdGUpOw0KICAgICAgfQ0KICAgfQ0KDQogICB1aW50MjU2IGJhbmtyb2xMaW1pdDsNCiAgIHVpbnQyNTYgcHJvZml0TGltaXQ7DQogICB1aW50MjU2IGxhc3REaXN0cmlidXRlZFByb2ZpdDsNCiAgIHVpbnQyNTYgbGFzdERhdGVEaXN0cmlidXRlZFByb2ZpdDsNCiAgIA0KICAgZnVuY3Rpb24gZ2V0RGlzdHJpYnV0ZVByb2ZpdHNJbmZvKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgbGFzdFByb2ZpdCwgdWludDI1NiBsYXN0RGF0ZSkNCiAgIHsNCiAgICAgIGxhc3RQcm9maXQgPSBsYXN0RGlzdHJpYnV0ZWRQcm9maXQ7DQogICAgICBsYXN0RGF0ZSA9IGxhc3REYXRlRGlzdHJpYnV0ZWRQcm9maXQ7DQogICB9DQoNCiAgIGZ1bmN0aW9uIHNldFByb2ZpdERpc3RyaWJ1dGlvbkNvbnRyYWN0KGFkZHJlc3MgY29udHJhY3RBZGRyZXNzKSBvbmx5RGV2ZWxvcGVyDQogICB7DQogICAgICBpZiAocHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QgPiAwKSB0aHJvdzsNCiAgICAgIHByb2ZpdERpc3RyaWJ1dGlvbkNvbnRyYWN0ID0gY29udHJhY3RBZGRyZXNzOw0KICAgfQ0KDQogICBmdW5jdGlvbiBzZXRTbWFydEFmZmlsaWF0ZUNvbnRyYWN0KGFkZHJlc3MgY29udHJhY3RBZGRyZXNzKSBvbmx5RGV2ZWxvcGVyDQogICB7DQogICAgICBpZiAoYWRkcmVzcyhzbWFydEFmZmlsaWF0ZUNvbnRyYWN0KSA+IDApIHRocm93Ow0KICAgICAgc21hcnRBZmZpbGlhdGVDb250cmFjdCA9IFNtYXJ0QWZmaWxpYXRlKGNvbnRyYWN0QWRkcmVzcyk7DQogICB9DQoNCiAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVQcm9maXRzKHVpbnQyNTYgZ2FzVmFsdWUpIG9ubHlEZXZlbG9wZXJPck9wZXJhdG9yDQogICB7DQogICAgICBpZiAocHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QgPiAwICYmIHRoaXMuYmFsYW5jZSA+PSAoYmFua3JvbExpbWl0K3Byb2ZpdExpbWl0KSkNCiAgICAgIHsNCiAgICAgICAgIHVpbnQyNTYgZGlmZiA9IHRoaXMuYmFsYW5jZSAtIGJhbmtyb2xMaW1pdDsNCiAgICAgICAgIGlmIChhZGRyZXNzKHByb2ZpdERpc3RyaWJ1dGlvbkNvbnRyYWN0KS5jYWxsLmdhcyhnYXNWYWx1ZSkudmFsdWUoZGlmZikoKSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgICBsYXN0RGlzdHJpYnV0ZWRQcm9maXQgPSBkaWZmOw0KICAgICAgICAgbGFzdERhdGVEaXN0cmlidXRlZFByb2ZpdCA9IGJsb2NrLnRpbWVzdGFtcDsNCiAgICAgIH0gICAgICANCiAgIH0NCg0KICAgZnVuY3Rpb24gZ2V0VG9rZW5TZXR0aW5ncygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQxNiBDb2VmX3BsYXllciwgdWludDI1NiBCYW5rcm9sTGltaXQsIHVpbnQyNTYgUHJvZml0TGltaXQpDQogICB7DQogICAgICBDb2VmX3BsYXllciA9IGNvZWZfcGxheWVyOyAgICAgIA0KICAgICAgQmFua3JvbExpbWl0ID0gYmFua3JvbExpbWl0Ow0KICAgICAgUHJvZml0TGltaXQgPSBwcm9maXRMaW1pdDsNCiAgIH0NCg0KICAgZnVuY3Rpb24gY2hhbmdlVG9rZW5TZXR0aW5ncyh1aW50MTYgbmV3Q29lZl9wbGF5ZXIsIHVpbnQyNTYgbmV3QmFua3JvbExpbWl0LCB1aW50MjU2IG5ld1Byb2ZpdExpbWl0KSBvbmx5RGV2ZWxvcGVyDQogICB7DQogICAgICBjb2VmX3BsYXllciAgPSBuZXdDb2VmX3BsYXllcjsgICAgICANCiAgICAgIGJhbmtyb2xMaW1pdCA9IG5ld0Jhbmtyb2xMaW1pdDsNCiAgICAgIHByb2ZpdExpbWl0ICA9IG5ld1Byb2ZpdExpbWl0Ow0KICAgfQ0KDQogICBmdW5jdGlvbiBjaGFuZ2VTZXR0aW5ncyh1aW50NjQgTmV3TWF4QmV0c1BlckJsb2NrLCB1aW50OCBOZXdCbG9ja0RlbGF5LCB1aW50OCBNaW5DcmVkaXRzT25CZXQ1MCwgdWludDggTWluQ3JlZGl0c09uQmV0MzMsIHVpbnQ4IE5ld0RlZmF1bHRNaW5DcmVkaXRzT25CZXQpIG9ubHlEZXZlbG9wZXINCiAgIHsgICAgIA0KICAgICAgQmxvY2tEZWxheSA9IE5ld0Jsb2NrRGVsYXk7ICAgICANCg0KICAgICAgaWYgKE5ld01heEJldHNQZXJCbG9jayAhPSAwKSBtYXhHYW1ibGVzUGVyQmxvY2sgPSBOZXdNYXhCZXRzUGVyQmxvY2s7ICAgICANCg0KICAgICAgaWYgKE1pbkNyZWRpdHNPbkJldDUwID4gMCkNCiAgICAgIHsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmxvdyldICAgPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmhpZ2gpXSAgPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLnJlZCldICAgPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmJsYWNrKV0gPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLm9kZCldICAgPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmV2ZW4pXSAgPSBNaW5DcmVkaXRzT25CZXQ1MDsNCiAgICAgIH0gIA0KDQogICAgICBpZiAoTWluQ3JlZGl0c09uQmV0MzMgPiAwKQ0KICAgICAgew0KICAgICAgICBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuZG96ZW4xKV0gPSBNaW5DcmVkaXRzT25CZXQzMzsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmRvemVuMildID0gTWluQ3JlZGl0c09uQmV0MzM7DQogICAgICAgIG1pbkNyZWRpdHNPbkJldFt1aW50OChCZXRUeXBlcy5kb3plbjMpXSA9IE1pbkNyZWRpdHNPbkJldDMzOw0KICAgICAgICBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuY29sdW1uMSldID0gTWluQ3JlZGl0c09uQmV0MzM7DQogICAgICAgIG1pbkNyZWRpdHNPbkJldFt1aW50OChCZXRUeXBlcy5jb2x1bW4yKV0gPSBNaW5DcmVkaXRzT25CZXQzMzsNCiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmNvbHVtbjMpXSA9IE1pbkNyZWRpdHNPbkJldDMzOw0KICAgICAgfQ0KDQogICAgICBpZiAoTmV3RGVmYXVsdE1pbkNyZWRpdHNPbkJldCA+IDApIGRlZmF1bHRNaW5DcmVkaXRzT25CZXQgPSBOZXdEZWZhdWx0TWluQ3JlZGl0c09uQmV0OyAgIA0KICAgfQ0KICAgDQogICBmdW5jdGlvbiBkZWxldGVDb250cmFjdCgpIG9ubHlEZXZlbG9wZXIgIA0KICAgew0KICAgICAgICBzdWljaWRlKG1zZy5zZW5kZXIpOw0KICAgfQ0KDQogICAvLyBiaXQgZnJvbSAwIHRvIDI1NQ0KICAgZnVuY3Rpb24gaXNCaXRTZXQodWludDI1NiBkYXRhLCB1aW50OCBiaXQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpDQogICB7DQogICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgcmV0IDo9IGlzemVybyhpc3plcm8oYW5kKGRhdGEsIGV4cCgyLGJpdCkpKSkNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgfQ0KDQogICAvLyB1bmlxdWUgY29tYmluYXRpb24gb2YgYmV0IGFuZCB3aGVlbFJlc3VsdCwgdXNlZCBmb3IgYWNjZXNzIHRvIFdpbk1hdHJpeA0KICAgZnVuY3Rpb24gZ2V0SW5kZXgodWludDE2IGJldCwgdWludDE2IHdoZWVsUmVzdWx0KSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQxNikNCiAgIHsNCiAgICAgIHJldHVybiAoYmV0KzEpKjI1NiArICh3aGVlbFJlc3VsdCsxKTsNCiAgIH0NCg0KICAgLy8gbiBmb3JtIDEgPD0gdG8gPD0gMzINCiAgIGZ1bmN0aW9uIGdldEJldFZhbHVlKGJ5dGVzMzIgdmFsdWVzLCB1aW50OCBuKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICB7DQogICAgICAgIC8vIGJldCBpbiBjcmVkaXRzICgxLi4yNTYpIA0KICAgICAgICB1aW50MjU2IGJldCA9IHVpbnQyNTYodmFsdWVzWzMyLW5dKSsxOw0KDQogICAgICAgICAvLyBjaGVjayBtaW4gYmV0DQogICAgICAgIHVpbnQ4IG1pbkNyZWRpdHMgPSBtaW5DcmVkaXRzT25CZXRbbl07DQogICAgICAgIGlmIChtaW5DcmVkaXRzID09IDApIG1pbkNyZWRpdHMgPSBkZWZhdWx0TWluQ3JlZGl0c09uQmV0Ow0KICAgICAgICBpZiAoYmV0IDwgbWluQ3JlZGl0cykgdGhyb3c7DQogICAgICAgIA0KICAgICAgICAvLyBiZXQgaW4gd2VpDQogICAgICAgIGJldCA9IGN1cnJlbnRNYXhCZXQqYmV0LzI1NjsNCiAgICAgICAgaWYgKGJldCA+IGN1cnJlbnRNYXhCZXQpIHRocm93OyAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBiZXQ7ICAgICAgICANCiAgIH0NCg0KICAgZnVuY3Rpb24gZ2V0QmV0VmFsdWVCeUdhbWJsZShHYW1lSW5mbyBtZW1vcnkgZ2FtYmxlLCB1aW50OCBuKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIA0KICAgew0KICAgICAgaWYgKG48PTMyKSByZXR1cm4gZ2V0QmV0VmFsdWUoZ2FtYmxlLnZhbHVlcywgbik7DQogICAgICBpZiAobjw9NjQpIHJldHVybiBnZXRCZXRWYWx1ZShnYW1ibGUudmFsdWVzMiwgbi0zMik7DQogICAgICAvLyB0aGVyZSBhcmUgNjQgbWF4aW11bSB1bmlxdWUgYmV0cyAocG9zaXRpb25zKSBpbiBvbmUgZ2FtZQ0KICAgICAgdGhyb3c7DQogICB9DQogIA0KICAgZnVuY3Rpb24gdG90YWxHYW1lcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICB7DQogICAgICAgcmV0dXJuIGdhbWJsZXMubGVuZ3RoOw0KICAgfQ0KICAgDQogICBmdW5jdGlvbiBnZXRTZXR0aW5ncygpIGNvbnN0YW50IHJldHVybnModWludDI1NiBtYXhCZXQsIHVpbnQyNTYgb25lQ3JlZGl0LCB1aW50OCBNaW5CZXRJbkNyZWRpdHMsIHVpbnQ4IE1pbkJldEluQ3JlZGl0c181MCx1aW50OCBNaW5CZXRJbkNyZWRpdHNfMzMsIHVpbnQ4IGJsb2NrRGVsYXlCZWZvcmVTcGluLCBib29sIGNvbnRyYWN0U3RhdGUpDQogICAgew0KICAgICAgICBtYXhCZXQgICAgPSBjdXJyZW50TWF4QmV0Ow0KICAgICAgICBvbmVDcmVkaXQgPSBjdXJyZW50TWF4QmV0IC8gMjU2OyANCiAgICAgICAgYmxvY2tEZWxheUJlZm9yZVNwaW4gPSBCbG9ja0RlbGF5OyAgICAgICAgDQogICAgICAgIE1pbkJldEluQ3JlZGl0cyAgICAgID0gZGVmYXVsdE1pbkNyZWRpdHNPbkJldDsNCiAgICAgICAgTWluQmV0SW5DcmVkaXRzXzUwICAgPSBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMubG93KV07IA0KICAgICAgICBNaW5CZXRJbkNyZWRpdHNfMzMgICA9IG1pbkNyZWRpdHNPbkJldFt1aW50OChCZXRUeXBlcy5jb2x1bW4xKV07IA0KICAgICAgICBjb250cmFjdFN0YXRlICAgICAgICA9IENvbnRyYWN0U3RhdGU7DQogICAgfQ0KICAgDQogICAgbW9kaWZpZXIgb25seURldmVsb3BlcigpIA0KICAgIHsNCiAgICAgICBpZiAobXNnLnNlbmRlciAhPSBkZXZlbG9wZXIpIHRocm93Ow0KICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgb25seURldmVsb3Blck9yT3BlcmF0b3IoKSANCiAgICB7DQogICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gZGV2ZWxvcGVyICYmIG1zZy5zZW5kZXIgIT0gb3BlcmF0b3IpIHRocm93Ow0KICAgICAgIF87DQogICAgfQ0KDQogICBmdW5jdGlvbiBkaXNhYmxlQmV0dGluZ19vbmx5X0RldigpDQogICAgb25seURldmVsb3Blck9yT3BlcmF0b3INCiAgICB7DQogICAgICAgIENvbnRyYWN0U3RhdGU9ZmFsc2U7DQogICAgfQ0KDQoNCiAgICBmdW5jdGlvbiBjaGFuZ2VPcGVyYXRvcihhZGRyZXNzIG5ld09wZXJhdG9yKSBvbmx5RGV2ZWxvcGVyDQogICAgew0KICAgICAgIG9wZXJhdG9yID0gbmV3T3BlcmF0b3I7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZW5hYmxlQmV0dGluZ19vbmx5X0RldigpDQogICAgb25seURldmVsb3Blck9yT3BlcmF0b3INCiAgICB7DQogICAgICAgIENvbnRyYWN0U3RhdGU9dHJ1ZTsNCg0KICAgIH0NCg0KICAgIGV2ZW50IFBsYXllckJldCh1aW50MjU2IGdhbWJsZUlkLCB1aW50MjU2IHBsYXllclRva2Vucyk7DQogICAgZXZlbnQgRW5kR2FtZShhZGRyZXNzIHBsYXllciwgdWludDggcmVzdWx0LCB1aW50MjU2IGdhbWJsZUlkKTsNCiAgICBldmVudCBTZXR0aW5nc0NoYW5nZWQodWludDI1NiBtYXhCZXQsIHVpbnQyNTYgb25lQ3JlZGl0LCB1aW50OCBEZWZhdWx0TWluQmV0SW5DcmVkaXRzLCB1aW50OCBNaW5CZXRJbkNyZWRpdHM1MCwgdWludDggTWluQmV0SW5DcmVkaXRzMzMsIHVpbnQ4IGJsb2NrRGVsYXlCZWZvcmVTcGluLCBib29sIGNvbnRyYWN0U3RhdGUpOw0KICAgIGV2ZW50IEVycm9yTG9nKGFkZHJlc3MgcGxheWVyLCBzdHJpbmcgbWVzc2FnZSk7DQogICAgZXZlbnQgR2FzTG9nKHN0cmluZyBtc2csIHVpbnQyNTYgbGV2ZWwsIHVpbnQyNTYgZ2FzKTsNCg0KICAgZnVuY3Rpb24gdG90YWxCZXRWYWx1ZShHYW1lSW5mbyBtZW1vcnkgZykgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQ0KICAgeyAgICAgICAgICAgICAgDQogICAgICAgdWludDI1NiB0b3RhbEJldHNWYWx1ZSA9IDA7IA0KICAgICAgIHVpbnQ4IG5QbGF5ZXJCZXRObyA9IDA7DQogICAgICAgdWludDggYmV0c0NvdW50ID0gdWludDgoYnl0ZXMzMihnLmJldHMpWzBdKTsNCg0KICAgICAgIGZvcih1aW50OCBpID0gMDsgaSA8IG1heFR5cGVCZXRzO2krKykgDQogICAgICAgIGlmIChpc0JpdFNldChnLmJldHMsIGkpKQ0KICAgICAgICB7DQogICAgICAgICAgdG90YWxCZXRzVmFsdWUgKz0gZ2V0QmV0VmFsdWVCeUdhbWJsZShnLCBuUGxheWVyQmV0Tm8rMSk7DQogICAgICAgICAgblBsYXllckJldE5vKys7DQoNCiAgICAgICAgICBpZiAoYmV0c0NvdW50ID09IDEpIGJyZWFrOw0KICAgICAgICAgIGJldHNDb3VudC0tOyAgICAgICAgICANCiAgICAgICAgfQ0KDQogICAgICAgcmV0dXJuIHRvdGFsQmV0c1ZhbHVlOw0KICAgfQ0KDQogICBmdW5jdGlvbiB0b3RhbEJldENvdW50KEdhbWVJbmZvIG1lbW9yeSBnKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpDQogICB7ICAgICAgICAgICAgICANCiAgICAgICB1aW50MjU2IHRvdGFsQmV0cyA9IDA7IA0KICAgICAgIGZvcih1aW50OCBpPTA7IGkgPCBtYXhUeXBlQmV0cztpKyspIA0KICAgICAgICBpZiAoaXNCaXRTZXQoZy5iZXRzLCBpKSkgdG90YWxCZXRzKys7ICAgICAgICAgIA0KICAgICAgIHJldHVybiB0b3RhbEJldHM7ICAgDQogICB9DQoNCiAgIGZ1bmN0aW9uIHBsYWNlQmV0KHVpbnQyNTYgYmV0cywgYnl0ZXMzMiB2YWx1ZXMxLGJ5dGVzMzIgdmFsdWVzMikgcHVibGljIHBheWFibGUNCiAgIHsNCiAgICAgICBpZiAoQ29udHJhY3RTdGF0ZSA9PSBmYWxzZSkNCiAgICAgICB7DQogICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiQ29udHJhY3REaXNhYmxlZCIpOw0KICAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpID09IGZhbHNlKSB0aHJvdzsNCiAgICAgICAgIHJldHVybjsNCiAgICAgICB9DQoNCiAgICAgICBpZiAoc21hcnRUb2tlbi5pc09wZXJhdGlvbkJsb2NrZWQoKSkNCiAgICAgICB7DQogICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiRW1pc3Npb25CbG9ja2VkIik7DQogICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93Ow0KICAgICAgICAgcmV0dXJuOw0KICAgICAgIH0NCg0KICAgICAgIHZhciBnYW1ibGVzTGVuZ3RoID0gZ2FtYmxlcy5sZW5ndGg7DQoNCiAgICAgICBpZiAoZ2FtYmxlc0xlbmd0aCA+IDApDQogICAgICAgew0KICAgICAgICAgIHVpbnQ4IGdhbWJsZXNDb3VudEluQ3VycmVudEJsb2NrID0gMDsNCiAgICAgICAgICBmb3IodmFyIGkgPSBnYW1ibGVzTGVuZ3RoIC0gMTtpID4gMDsgaS0tKQ0KICAgICAgICAgIHsNCiAgICAgICAgICAgIGlmIChnYW1ibGVzW2ldLmJsb2NrTnVtYmVyID09IGJsb2NrLm51bWJlcikgDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICBpZiAoZ2FtYmxlc1tpXS5wbGF5ZXIgPT0gbXNnLnNlbmRlcikNCiAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiUGxheSB0d2ljZSB0aGUgc2FtZSBibG9jayIpOw0KICAgICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICBnYW1ibGVzQ291bnRJbkN1cnJlbnRCbG9jaysrOw0KICAgICAgICAgICAgICAgaWYgKGdhbWJsZXNDb3VudEluQ3VycmVudEJsb2NrID49IG1heEdhbWJsZXNQZXJCbG9jaykNCiAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJtYXhHYW1ibGVzUGVyQmxvY2siKTsNCiAgICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgfQ0KICAgICAgIA0KICAgICAgIHZhciBfY3VycmVudE1heEJldCA9IGN1cnJlbnRNYXhCZXQ7DQoNCiAgICAgICBpZiAobXNnLnZhbHVlIDwgX2N1cnJlbnRNYXhCZXQvMjU2IHx8IGJldHMgPT0gMCkNCiAgICAgICB7DQogICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIldyb25nIGJldCB2YWx1ZSIpOw0KICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgIH0NCg0KICAgICAgIGlmIChtc2cudmFsdWUgPiBfY3VycmVudE1heEJldCkNCiAgICAgICB7DQogICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIkxpbWl0IGZvciB0YWJsZSIpOw0KICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgIH0NCg0KICAgICAgIEdhbWVJbmZvIG1lbW9yeSBnID0gR2FtZUluZm8obXNnLnNlbmRlciwgYmxvY2subnVtYmVyLCAzNywgYmV0cywgdmFsdWVzMSx2YWx1ZXMyKTsNCg0KICAgICAgIGlmICh0b3RhbEJldFZhbHVlKGcpICE9IG1zZy52YWx1ZSkNCiAgICAgICB7DQogICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIldyb25nIGJldCB2YWx1ZSIpOw0KICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgIH0NCg0KICAgICAgIGdhbWJsZXMucHVzaChnKTsNCg0KICAgICAgIGFkZHJlc3MgYWZmaWxpYXRlID0gMDsNCiAgICAgICB1aW50MTYgY29lZl9hZmZpbGlhdGUgPSAwOw0KICAgICAgIGlmIChhZGRyZXNzKHNtYXJ0QWZmaWxpYXRlQ29udHJhY3QpID4gMCkNCiAgICAgICB7DQogICAgICAgICAoYWZmaWxpYXRlLCBjb2VmX2FmZmlsaWF0ZSkgPSBzbWFydEFmZmlsaWF0ZUNvbnRyYWN0LmdldEFmZmlsaWF0ZUluZm8obXNnLnNlbmRlcik7ICAgDQogICAgICAgfQ0KDQogICAgICAgdWludDI1NiBwbGF5ZXJUb2tlbnMgPSBzbWFydFRva2VuLmVtaXNzaW9uKG1zZy5zZW5kZXIsIGFmZmlsaWF0ZSwgbXNnLnZhbHVlLCBjb2VmX3BsYXllciwgY29lZl9hZmZpbGlhdGUpOyAgICAgICAgICAgIA0KDQogICAgICAgUGxheWVyQmV0KGdhbWJsZXNMZW5ndGgsIHBsYXllclRva2Vucyk7IA0KICAgfQ0KDQogICAgZnVuY3Rpb24gSW52ZXN0KCkgcGF5YWJsZSBvbmx5RGV2ZWxvcGVyDQogICAgew0KICAgICAgDQogICAgfQ0KDQogICAgZnVuY3Rpb24gR2V0R2FtZUluZGV4ZXNUb1Byb2Nlc3MoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nls2NF0gZ2FtZUluZGV4ZXMpDQogICAgeyAgICAgICAgICAgDQogICAgICB1aW50OCBpbmRleCA9IDA7DQogICAgICBmb3IoaW50MjU2IGkgPSBpbnQyNTYoZ2FtYmxlcy5sZW5ndGgpIC0gMTtpID49IDA7aS0tKQ0KICAgICAgeyAgICAgIA0KICAgICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW3VpbnQyNTYoaSldOw0KICAgICAgICAgaWYgKGJsb2NrLm51bWJlciAtIGcuYmxvY2tOdW1iZXIgPj0gMjU2KSBicmVhazsNCg0KICAgICAgICAgaWYgKGcud2hlZWxSZXN1bHQgPT0gMzcgJiYgYmxvY2subnVtYmVyID49IGcuYmxvY2tOdW1iZXIgKyBCbG9ja0RlbGF5KQ0KICAgICAgICAgeyANCiAgICAgICAgICAgIGdhbWVJbmRleGVzW2luZGV4KytdID0gdWludDI1NihpICsgMSk7DQogICAgICAgICB9DQogICAgICB9ICAgICAgDQogICAgfQ0KDQogICAgdWludDI1NiBsYXN0QmxvY2tHYW1lc1Byb2Nlc3NlZDsNCg0KICAgIGZ1bmN0aW9uIFByb2Nlc3NHYW1lcyh1aW50MjU2W10gZ2FtZUluZGV4ZXMsIGJvb2wgc2ltdWxhdGUpIA0KICAgIHsNCiAgICAgIGlmICghc2ltdWxhdGUpDQogICAgICB7DQogICAgICAgICBpZiAobGFzdEJsb2NrR2FtZXNQcm9jZXNzZWQgPT0gYmxvY2subnVtYmVyKSAgcmV0dXJuOw0KICAgICAgICAgbGFzdEJsb2NrR2FtZXNQcm9jZXNzZWQgPSBibG9jay5udW1iZXI7DQogICAgICB9DQoNCiAgICAgIHVpbnQ4IGRlbGF5ID0gQmxvY2tEZWxheTsNCiAgICAgIHVpbnQyNTYgbGVuZ3RoID0gZ2FtZUluZGV4ZXMubGVuZ3RoOw0KICAgICAgYm9vbCBzdWNjZXNzID0gZmFsc2U7DQogICAgICBmb3IodWludDI1NiBpID0gMDtpIDwgbGVuZ3RoO2krKykNCiAgICAgIHsgICAgICANCiAgICAgICAgIGlmIChQcm9jZXNzR2FtZShnYW1lSW5kZXhlc1tpXSwgZGVsYXkpID09IEdhbWVTdGF0dXMuU3VjY2Vzcykgc3VjY2VzcyA9IHRydWU7ICAgICAgICAgDQogICAgICB9ICAgICAgDQogICAgICBpZiAoc2ltdWxhdGUgJiYgIXN1Y2Nlc3MpIHRocm93Ow0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBQcm9jZXNzR2FtZUV4dCh1aW50MjU2IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoR2FtZVN0YXR1cykNCiAgICB7DQogICAgICByZXR1cm4gUHJvY2Vzc0dhbWUoaW5kZXgsIEJsb2NrRGVsYXkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIFByb2Nlc3NHYW1lKHVpbnQyNTYgaW5kZXgsIHVpbnQyNTYgZGVsYXkpIHByaXZhdGUgcmV0dXJucyAoR2FtZVN0YXR1cykNCiAgICB7ICAgICAgICAgICAgDQogICAgICBHYW1lSW5mbyBtZW1vcnkgZyA9IGdhbWJsZXNbaW5kZXhdOw0KICAgICAgaWYgKGJsb2NrLm51bWJlciAtIGcuYmxvY2tOdW1iZXIgPj0gMjU2KSByZXR1cm4gR2FtZVN0YXR1cy5TdG9wOw0KDQogICAgICBpZiAoZy53aGVlbFJlc3VsdCA9PSAzNyAmJiBibG9jay5udW1iZXIgPiBnLmJsb2NrTnVtYmVyICsgZGVsYXkpDQogICAgICB7ICAgICAgICAgICAgDQogICAgICAgICBnYW1ibGVzW2luZGV4XS53aGVlbFJlc3VsdCA9IGdldFJhbmRvbU51bWJlcihnLnBsYXllciwgZy5ibG9ja051bWJlcik7DQogICAgICAgICAgICAgICAgIA0KICAgICAgICAgdWludDI1NiBwbGF5ZXJXaW5uaW5ncyA9IGdldEdhbWVSZXN1bHQoZ2FtYmxlc1tpbmRleF0pOw0KICAgICAgICAgaWYgKHBsYXllcldpbm5pbmdzID4gMCkgDQogICAgICAgICB7DQogICAgICAgICAgICBpZiAoZy5wbGF5ZXIuc2VuZChwbGF5ZXJXaW5uaW5ncykgPT0gZmFsc2UpIHRocm93Ow0KICAgICAgICAgfQ0KDQogICAgICAgICBFbmRHYW1lKGcucGxheWVyLCBnYW1ibGVzW2luZGV4XS53aGVlbFJlc3VsdCwgaW5kZXgpOw0KICAgICAgICAgcmV0dXJuIEdhbWVTdGF0dXMuU3VjY2VzczsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIEdhbWVTdGF0dXMuU2tpcHBlZDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRSYW5kb21OdW1iZXIoYWRkcmVzcyBwbGF5ZXIsIHVpbnQyNTYgcGxheWVyYmxvY2spIHByaXZhdGUgcmV0dXJucyh1aW50OCB3aGVlbFJlc3VsdCkNCiAgICB7DQogICAgICAgIC8vIGJsb2NrLmJsb2NraGFzaCAtIGhhc2ggb2YgdGhlIGdpdmVuIGJsb2NrIC0gb25seSB3b3JrcyBmb3IgMjU2IG1vc3QgcmVjZW50IGJsb2NrcyBleGNsdWRpbmcgY3VycmVudA0KICAgICAgICBieXRlczMyIGJsb2NrSGFzaCA9IGJsb2NrLmJsb2NraGFzaChwbGF5ZXJibG9jaytCbG9ja0RlbGF5KTsgDQogICAgICAgIA0KICAgICAgICBpZiAoYmxvY2tIYXNoPT0wKSANCiAgICAgICAgew0KICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJDYW5ub3QgZ2VuZXJhdGUgcmFuZG9tIG51bWJlciIpOw0KICAgICAgICAgIHdoZWVsUmVzdWx0ID0gMjAwOw0KICAgICAgICB9DQogICAgICAgIGVsc2UNCiAgICAgICAgew0KICAgICAgICAgIGJ5dGVzMzIgc2hhUGxheWVyID0gc2hhMyhwbGF5ZXIsIGJsb2NrSGFzaCk7DQogICAgDQogICAgICAgICAgd2hlZWxSZXN1bHQgPSB1aW50OCh1aW50MjU2KHNoYVBsYXllciklMzcpOw0KICAgICAgICB9ICAgIA0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVJhbmRvbU51bWJlckJ5QmxvY2toYXNoKHVpbnQyNTYgYmxvY2tIYXNoLCBhZGRyZXNzIHBsYXllcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4IHdoZWVsUmVzdWx0KSANCiAgICB7IA0KICAgICAgICAgIGJ5dGVzMzIgc2hhUGxheWVyID0gc2hhMyhwbGF5ZXIsIGJsb2NrSGFzaCk7DQogICAgDQogICAgICAgICAgd2hlZWxSZXN1bHQgPSB1aW50OCh1aW50MjU2KHNoYVBsYXllciklMzcpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGVtZXJnZW5jeUZpeEdhbWVSZXN1bHQodWludDY0IGdhbWJsZUlkLCB1aW50MjU2IGJsb2NrSGFzaCkgb25seURldmVsb3Blck9yT3BlcmF0b3INCiAgICB7DQogICAgICAvLyBQcm9iYWJseSB0aGlzIGZ1bmN0aW9uIHdpbGwgbmV2ZXIgYmUgY2FsbGVkLCBidXQNCiAgICAgIC8vIGlmIGdhbWUgd2FzIG5vdCBzcGlubmVkIGluIDI1NiBibG9ja3MgdGhlbiBibG9jay5ibG9ja2hhc2ggd2lsbCByZXR1cm5zIGFsd2F5cyAwIGFuZCANCiAgICAgIC8vIHdlIHNob3VsZCBmaXggdGhpcyBtYW51YWxseSAoeW91IGNhbiBjaGVjayByZXN1bHQgd2l0aCBwdWJsaWMgZnVuY3Rpb24gY2FsY3VsYXRlUmFuZG9tTnVtYmVyQnlCbG9ja2hhc2gpDQogICAgICBHYW1lSW5mbyBtZW1vcnkgZ2FtYmxlID0gZ2FtYmxlc1tnYW1ibGVJZF07DQogICAgICBpZiAoZ2FtYmxlLndoZWVsUmVzdWx0ICE9IDIwMCkgdGhyb3c7DQoNCiAgICAgIGdhbWJsZXNbZ2FtYmxlSWRdLndoZWVsUmVzdWx0ID0gY2FsY3VsYXRlUmFuZG9tTnVtYmVyQnlCbG9ja2hhc2goYmxvY2tIYXNoLCBnYW1ibGUucGxheWVyKTsgICAgICANCg0KICAgICAgdWludDI1NiBwbGF5ZXJXaW5uaW5ncyA9IGdldEdhbWVSZXN1bHQoZ2FtYmxlc1tnYW1ibGVJZF0pOw0KICAgICAgaWYgKHBsYXllcldpbm5pbmdzID4gMCkNCiAgICAgIHsNCiAgICAgICAgaWYgKGdhbWJsZS5wbGF5ZXIuc2VuZChwbGF5ZXJXaW5uaW5ncykgPT0gZmFsc2UpIHRocm93Ow0KICAgICAgfSAgICAgIA0KDQogICAgICBFbmRHYW1lKGdhbWJsZS5wbGF5ZXIsIGdhbWJsZS53aGVlbFJlc3VsdCwgZ2FtYmxlSWQpOw0KICAgIH0NCg0KDQogICAgZnVuY3Rpb24gY2hlY2tHYW1lc1JlYWR5Rm9yU3Bpbm5pbmcoKSBjb25zdGFudCByZXR1cm5zIChpbnQyNTZbMjU2XSByZXQpIA0KICAgIHsgDQogICAgICB1aW50MTYgaW5kZXggPSAwOyAgICANCiAgICAgIGZvcihpbnQyNTYgaSA9IGludDI1NihnYW1ibGVzLmxlbmd0aCkgLSAxO2kgPj0gMDtpLS0pDQogICAgICB7ICAgICAgDQogICAgICAgICBHYW1lSW5mbyBtZW1vcnkgZyA9IGdhbWJsZXNbdWludDI1NihpKV07DQogICAgICAgICBpZiAoYmxvY2subnVtYmVyIC0gZy5ibG9ja051bWJlciA+PSAyNTYpIHJldHVybiA7DQoNCiAgICAgICAgIGlmIChnLndoZWVsUmVzdWx0ID09IDM3ICYmIGJsb2NrLm51bWJlciA+IGcuYmxvY2tOdW1iZXIgKyBCbG9ja0RlbGF5KQ0KICAgICAgICAgeyAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0W2luZGV4KytdID0gaSsxOyAgICAgICAgICAgIA0KICAgICAgICAgfSAgICAgICAgICAgICAgIA0KICAgICAgfSANCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwcmVsaW1pbmFyeUdhbWVSZXN1bHQodWludDY0IGdhbWJsZUluZGV4KSBjb25zdGFudCByZXR1cm5zICh1aW50NjQgZ2FtYmxlSWQsIGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IGJsb2NrTnVtYmVyLCB1aW50MjU2IHRvdGFsV2luLCB1aW50OCB3aGVlbFJlc3VsdCwgdWludDI1NiBiZXRzLCB1aW50MjU2IHZhbHVlczEsIHVpbnQyNTYgdmFsdWVzMiwgdWludDI1NiBuVG90YWxCZXRWYWx1ZSwgdWludDI1NiBuVG90YWxCZXRDb3VudCkgDQogICAgeyANCiAgICAgIEdhbWVJbmZvIG1lbW9yeSBnID0gZ2FtYmxlc1t1aW50MjU2KGdhbWJsZUluZGV4KV07DQogICAgICANCiAgICAgIGlmIChnLndoZWVsUmVzdWx0ID09IDM3ICYmIGJsb2NrLm51bWJlciA+IGcuYmxvY2tOdW1iZXIgKyBCbG9ja0RlbGF5KQ0KICAgICAgew0KICAgICAgICAgZ2FtYmxlc1tnYW1ibGVJbmRleF0ud2hlZWxSZXN1bHQgPSBnZXRSYW5kb21OdW1iZXIoZy5wbGF5ZXIsIGcuYmxvY2tOdW1iZXIpOw0KICAgICAgICAgcmV0dXJuIGdldEdhbWUoZ2FtYmxlSW5kZXgpOw0KICAgICAgfQ0KICAgICAgdGhyb3c7ICAgICAgDQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGdldEdhbWVSZXN1bHQoR2FtZUluZm8gbWVtb3J5IGdhbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB0b3RhbFdpbikgDQogICAgew0KICAgICAgICB0b3RhbFdpbiA9IDA7DQogICAgICAgIHVpbnQ4IG5QbGF5ZXJCZXRObyA9IDA7DQogICAgICAgIC8vIHdlIHNlbnQgY291bnQgYmV0cyBhdCBsYXN0IGJ5dGUgDQogICAgICAgIHVpbnQ4IGJldHNDb3VudCA9IHVpbnQ4KGJ5dGVzMzIoZ2FtZS5iZXRzKVswXSk7IA0KICAgICAgICBmb3IodWludDggaT0wOyBpPG1heFR5cGVCZXRzOyBpKyspDQogICAgICAgIHsgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoaXNCaXRTZXQoZ2FtZS5iZXRzLCBpKSkNCiAgICAgICAgICAgIHsgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICB2YXIgd2luTXVsID0gd2luTWF0cml4LmdldENvZWZmKGdldEluZGV4KGksIGdhbWUud2hlZWxSZXN1bHQpKTsgLy8gZ2V0IHdpbiBjb2VmDQogICAgICAgICAgICAgIGlmICh3aW5NdWwgPiAwKSB3aW5NdWwrKzsgLy8gKyByZXR1cm4gcGxheWVyIGJldA0KICAgICAgICAgICAgICB0b3RhbFdpbiArPSB3aW5NdWwgKiBnZXRCZXRWYWx1ZUJ5R2FtYmxlKGdhbWUsIG5QbGF5ZXJCZXRObysxKTsNCiAgICAgICAgICAgICAgblBsYXllckJldE5vKys7IA0KDQogICAgICAgICAgICAgIGlmIChiZXRzQ291bnQgPT0gMSkgYnJlYWs7DQogICAgICAgICAgICAgIGJldHNDb3VudC0tOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ICAgICAgICANCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRHYW1lKHVpbnQ2NCBpbmRleCkgY29uc3RhbnQgcmV0dXJucyAodWludDY0IGdhbWJsZUlkLCBhZGRyZXNzIHBsYXllciwgdWludDI1NiBibG9ja051bWJlciwgdWludDI1NiB0b3RhbFdpbiwgdWludDggd2hlZWxSZXN1bHQsIHVpbnQyNTYgYmV0cywgdWludDI1NiB2YWx1ZXMxLCB1aW50MjU2IHZhbHVlczIsIHVpbnQyNTYgblRvdGFsQmV0VmFsdWUsIHVpbnQyNTYgblRvdGFsQmV0Q291bnQpIA0KICAgIHsNCiAgICAgICAgZ2FtYmxlSWQgPSBpbmRleDsNCiAgICAgICAgcGxheWVyID0gZ2FtYmxlc1tpbmRleF0ucGxheWVyOw0KICAgICAgICB0b3RhbFdpbiA9IGdldEdhbWVSZXN1bHQoZ2FtYmxlc1tpbmRleF0pOw0KICAgICAgICBibG9ja051bWJlciA9IGdhbWJsZXNbaW5kZXhdLmJsb2NrTnVtYmVyOyAgICAgICAgDQogICAgICAgIHdoZWVsUmVzdWx0ID0gZ2FtYmxlc1tpbmRleF0ud2hlZWxSZXN1bHQ7DQogICAgICAgIG5Ub3RhbEJldFZhbHVlID0gdG90YWxCZXRWYWx1ZShnYW1ibGVzW2luZGV4XSk7DQogICAgICAgIG5Ub3RhbEJldENvdW50ID0gdG90YWxCZXRDb3VudChnYW1ibGVzW2luZGV4XSk7DQogICAgICAgIGJldHMgPSBnYW1ibGVzW2luZGV4XS5iZXRzOw0KICAgICAgICB2YWx1ZXMxID0gdWludDI1NihnYW1ibGVzW2luZGV4XS52YWx1ZXMpOw0KICAgICAgICB2YWx1ZXMyID0gdWludDI1NihnYW1ibGVzW2luZGV4XS52YWx1ZXMyKTsgICAgICAgIA0KICAgIH0NCg0KICAgZnVuY3Rpb24oKSANCiAgIHsNCiAgICAgIHRocm93Ow0KICAgfQ0KICAgDQoNCn0='