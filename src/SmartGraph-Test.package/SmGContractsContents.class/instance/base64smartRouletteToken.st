base 64 content
base64smartRouletteToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQpjb250cmFjdCBPbGRTbWFydFJvdWxldHRlVG9rZW4NCnsNCglmdW5jdGlvbiBiYWxhbmNlT2YoIGFkZHJlc3Mgd2hvICkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7DQoJZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHN1cHBseSk7DQoJZnVuY3Rpb24gdGVtcFRva2Vuc0JhbGFuY2VPZiggYWRkcmVzcyB3aG8gKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsNCglmdW5jdGlvbiB0ZW1wVG9rZW5zUGVyaW9kT2YoIGFkZHJlc3Mgd2hvICkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7DQoJZnVuY3Rpb24gZ2V0Q291bnRIb2xkZXJzKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KTsNCglmdW5jdGlvbiBnZXRDb3VudFRlbXBIb2xkZXJzKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KTsNCglmdW5jdGlvbiBnZXRJdGVtSG9sZGVycyh1aW50MjU2IGluZGV4KSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpOw0KCWZ1bmN0aW9uIGdldEl0ZW1UZW1wSG9sZGVycyh1aW50MjU2IGluZGV4KSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpOw0KCWZ1bmN0aW9uIGlzT3BlcmF0aW9uQmxvY2tlZCgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOw0KfQ0KDQpjb250cmFjdCBTbWFydFJvdWxldHRlVG9rZW4gew0KCXN0cmluZyBwdWJsaWMgc3RhbmRhcmQgPSAnRVJDMjAnOw0KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgLy8gdG9rZW4gbmFtZQ0KICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOyAvLyB0b2tlbiBzeW1ib2wNCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7IC8vIGEgbnVtYmVyIG9mIHN5bWJvbHMgYWZ0ZXIgY29tbWENCg0KCXN0cnVjdCBob2xkZXJEYXRhIHsNCgkJLyoqDQoJCSoJVG9rZW4gaG9sZGVycyBkZXRhaWxzDQoJCSovDQoJCXVpbnQyNTYgdG9rZW5zX2NvdW50Ow0KCQlib29sIGluaXQ7DQoJfQ0KDQoJc3RydWN0IHRlbXBIb2xkZXJEYXRhIHsNCgkJLyoqDQoJCSoJVGVtcG9yYXJ5IHRva2VuIGhvbGRlcnMgZGV0YWlscw0KCQkqLw0KCQl1aW50MjU2IHRva2Vuc19jb3VudDsNCgkJdWludDI1NiBzdGFydF9kYXRlOw0KCQl1aW50MjU2IGVuZF9kYXRlOw0KCQlib29sIGluaXQ7DQoJfQ0KDQoJYWRkcmVzc1tdIGxpc3RBZGRySG9sZGVyczsgLy8gcGVybWFuZW50IHRva2VuIGhvbGRlcnMgbGlzdA0KDQoJbWFwcGluZyggYWRkcmVzcyA9PiBob2xkZXJEYXRhICkgX2JhbGFuY2VzOyAvLyB0b2tlbiBvd25lcnNoaXANCgltYXBwaW5nKCBhZGRyZXNzID0+IHRlbXBIb2xkZXJEYXRhICkgX3RlbXBfYmFsYW5jZTsgLy8gdGVtcG9yYXJ5IHRva2VuIG93bmVyc2hpcA0KCW1hcHBpbmcoIGFkZHJlc3MgPT4gbWFwcGluZyggYWRkcmVzcyA9PiB1aW50MjU2ICkgKSBfYXBwcm92YWxzOyAvLyB0b2tlbiB0cmFuc2ZlciByaWdodA0KDQoJYm9vbCBzdG9wX29wZXJhdGlvbjsgLy8gdHJhbnNhY3Rpb24gc3RvcA0KCQ0KCXVpbnQyNTYgX3N1cHBseTsgLy8gdG90YWwgYW1vdW50IG9mIHRva2Vucw0KCXVpbnQyNTYgX2luaXRfY291bnRfdG9rZW5zOyAvLyBpbml0aWFsIGFtb3VudCBvZiB0b2tlbnMNCgl1aW50MjU2IHB1YmxpYyBjb3N0T2ZPbmVUb2tlbjsgLy8gdG9rZW4gcHJpY2UgZXF1aXZhbGVudCB0byB3ZWkNCgkNCglhZGRyZXNzIHdhbGxldF9JQ087DQoJYm9vbCBlbmFibGVJQ087IC8vIGljbyBzdGF0dXMgKGxhdW5jaGVkIG9yIG5vdCkNCgl1aW50MjU2IG1pbl92YWx1ZV9idXlUb2tlbjsgLy9pbiB3ZWkNCgl1aW50MjU2IG1heF92YWx1ZV9idXlUb2tlbjsgLy9pbiB3ZWkNCg0KCWFkZHJlc3MgZm9uZF93YWxsZXQ7DQoJYWRkcmVzcyBkZXZlbG9wZXJfd2FsbGV0Ow0KDQoJYWRkcmVzcyBkaXZpZGVudF9jb250cmFjdCA9IGFkZHJlc3MoMHgwKTsNCgkNCglldmVudCBUb2tlbkJ1eShhZGRyZXNzIGJ1eWVyLCB1aW50MjU2IGFtb3VudE9mVG9rZW5zKTsNCg0KCS8vIGVtaXNzaW9uIGxpbWl0cw0KCXVpbnQyNTYgbWF4X3ZhbHVlX2JldDsgLy8gbWF4aW11bSBzaXplIG9mIGJldCBmb3IgZW1pc3Npb24NCgl1aW50MjU2IG1heF9jb2VmX3BsYXllcjsgLy8gbWF4aW11bSBzaXplIG9mIGVtaXNzaW9uIGNvZWZmaWNpZW50IGZvciBhIHBsYXllcg0KCXVpbnQyNTYgbWF4X2NvZWZfcGFydG5lcjsgLy8gbWF4aW11bSBzaXplIG9mIGVtaXNzaW9uIGNvZWZmaWNpZW50IGZvciBhbiBhZmZpbGlhdGUNCg0KDQoJYWRkcmVzcyBkZXZlbG9wZXI7IC8vIGRldmVsb3BlcidzIGFkZHJlc3MNCglhZGRyZXNzIG1hbmFnZXI7IC8vIGNvbnRyYWN0IG1hbmFnaW5nIGFkZHJlc3MgKG1hbmFnZW1lbnQgY2FuIGJlIG1hZGUgZnJvbSB0aGUgc21hcnQgY29udHJhY3QpDQoNCglzdHJ1Y3QgZ2FtZXNEYXRhIHsNCgkJYm9vbCBpbml0Ow0KCX0NCg0KCW1hcHBpbmcoIGFkZHJlc3MgPT4gZ2FtZXNEYXRhKSBsaXN0R2FtZXM7IC8vIExpc3Qgb2YgYWxsb3dlZCBnYW1lcw0KCWFkZHJlc3NbXSBhZGRyR2FtZXM7DQoNCgkvL29sZCB0b2tlbiBjb250cmFjdCBmb3IgZGF0YSByZXN0b3JhZ2UNCglPbGRTbWFydFJvdWxldHRlVG9rZW4gb2xkU21hcnRUb2tlbjsNCg0KCXVpbnQyNTYgY291bnRIb2xkZXJzVHJhbnNmZXJyZWRGcm9tT2xkQ29udHJhY3Q7IC8vYW1vdW50IG9mIHBlcm1hbmVudCB0b2tlbiBob2xkZXJzIHdob3NlIGJhbGFuY2UgaGFzIGJlZW4gcmVzdG9yZWQNCgl1aW50MjU2IGNvdW50SG9sZGVyc1RlbXBUcmFuc2ZlcnJlZEZyb21PbGRDb250cmFjdDsgLy9hbW91bnQgb2YgdGVtcG9yYXJ5IHRva2VuIGhvbGRlcnMgd2hvc2UgYmFsYW5jZSBoYXMgYmVlbiByZXN0b3JlZA0KDQoJZnVuY3Rpb24gU21hcnRSb3VsZXR0ZVRva2VuKCkNCgl7DQoJCV9pbml0X2NvdW50X3Rva2VucyA9IDEwMDAwMDAwMDAwMDAwMDAwMDsNCgkJZGV2ZWxvcGVyX3dhbGxldCA9IGFkZHJlc3MoMHg4NTIxRTFmOTIyMEEyNTFkRTBhYjc4ZjZhMkU4NzU0Q2E5RTc1MjQyKTsNCgkJd2FsbGV0X0lDTyA9IGFkZHJlc3MoMHgyZGZmODdmODg5MmQ2NWY3YTk3YjEyODdlNzk1NDA1MDk4YWU3YjdmKTsNCgkJZm9uZF93YWxsZXQgPSBhZGRyZXNzKDB4MzUwMUREMkI1MTVFREMxOTIwZjkwMDc3ODJEYTVhYzAxODkyMjUwMik7DQoNCiAgICAgICAgbmFtZSA9ICdSb3VsZXR0ZSBUb2tlbic7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgc3ltYm9sID0gJ1JMVCc7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICBkZWNpbWFscyA9IDEwOw0KICAgICAgICBjb3N0T2ZPbmVUb2tlbiA9IDE1MDAwMDAwMDAwMDAwMDA7DQoNCgkJbWF4X3ZhbHVlX2JldCA9IDI1NjAwMDAwMDAwMDAwMDAwMDA7DQoJCW1heF9jb2VmX3BsYXllciA9IDMwMDsNCgkJbWF4X2NvZWZfcGFydG5lciA9IDUwOw0KDQoJCWRldmVsb3BlciA9IG1zZy5zZW5kZXI7DQoJCW1hbmFnZXIgPSBtc2cuc2VuZGVyOwkJDQoJCQ0KCQllbmFibGVJQ08gPSBmYWxzZTsNCgkJbWluX3ZhbHVlX2J1eVRva2VuID0gMTUwMDAwMDAwMDAwMDAwMDAwOw0KCQltYXhfdmFsdWVfYnV5VG9rZW4gPSA1MDAwMDAwMDAwMDAwMDAwMDAwMDA7DQoNCgkJc3RvcF9vcGVyYXRpb24gPSBmYWxzZTsNCg0KCQlvbGRTbWFydFRva2VuID0gT2xkU21hcnRSb3VsZXR0ZVRva2VuKDB4MmE2NTAzNTZiZDg5NDM3MGNjMWQ2YWJhNzFiMzZjMGFkNmIzZGMxOCk7DQoJCWNvdW50SG9sZGVyc1RyYW5zZmVycmVkRnJvbU9sZENvbnRyYWN0PSAwOw0KCQljb3VudEhvbGRlcnNUZW1wVHJhbnNmZXJyZWRGcm9tT2xkQ29udHJhY3QgPSAwOw0KCX0NCg0KCW1vZGlmaWVyIGlzRGV2ZWxvcGVyKCl7DQoJCWlmIChtc2cuc2VuZGVyIT1kZXZlbG9wZXIpIHRocm93Ow0KCQlfOw0KCX0NCg0KCW1vZGlmaWVyIGlzTWFuYWdlcigpew0KCQlpZiAobXNnLnNlbmRlciE9bWFuYWdlcikgdGhyb3c7DQoJCV87DQoJfQ0KDQoJbW9kaWZpZXIgaXNBY2Nlc3NTdG9wT3BlcmF0aW9uKCl7DQoJCWlmIChtc2cuc2VuZGVyIT1tYW5hZ2VyICYmIG1zZy5zZW5kZXIhPWRldmVsb3BlciAmJiAobXNnLnNlbmRlciE9ZGl2aWRlbnRfY29udHJhY3QgfHwgZGl2aWRlbnRfY29udHJhY3Q9PWFkZHJlc3MoMHgwKSkpIHRocm93Ow0KCQlfOw0KCX0NCg0KCWZ1bmN0aW9uIElzVHJhbnNmZXJGcm9tT2xkQ29udHJhY3REb25lKCkgY29uc3RhbnQgcmV0dXJucyhib29sKQ0KCXsNCgkJcmV0dXJuIGNvdW50SG9sZGVyc1RyYW5zZmVycmVkRnJvbU9sZENvbnRyYWN0ID09IG9sZFNtYXJ0VG9rZW4uZ2V0Q291bnRIb2xkZXJzKCk7DQoJfQ0KDQoJLyoqDQogICAgKglyZXN0b3JlQWxsUGVyc2lzdGVudFRva2VucygpIC0gZnVuY3Rpb24gb2YgcmVzdG9yaW5nIHRoZSBiYWxhbmNlIG9mIHBlcm1hbmVudCB0b2tlbiBob2xkZXJzLiBPbmNlIHRoZSBmdW5jdGlvbiBoYXMgYmVlbiBjb21wbGV0ZWQsDQogICAgKglibG9ja2NoYWluIHNhdmVzIHRoZSBpbmRleCB3aXRoIHdoaWNoIHRva2VuIGhvbGRlcnMgYWRkcmVzc2VzIHdpbGwgc3RhcnQgYmVpbmcgcmVjZWl2ZWQgZHVyaW5nIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gb3BlcmF0aW9uLg0KICAgICoNCiAgICAqCUBwYXJhbSBsaW1pdCAtIGFtb3VudCBvZiB0b2tlbiBob2xkZXJzIGFkZHJlc3NlcyByZXF1aXJpbmcgdGhlIGJhbGFuY2UgcmVzdG9yYWdlLg0KICAgICoNCiAgICAqKi8NCglmdW5jdGlvbiByZXN0b3JlQWxsUGVyc2lzdGVudFRva2Vucyh1aW50MjU2IGxpbWl0KQ0KCXsNCgkJaWYob2xkU21hcnRUb2tlbi5pc09wZXJhdGlvbkJsb2NrZWQoKSAmJiB0aGlzLmlzT3BlcmF0aW9uQmxvY2tlZCgpKQ0KCQl7DQoJCQl1aW50MjU2IGxlbiA9IG9sZFNtYXJ0VG9rZW4uZ2V0Q291bnRIb2xkZXJzKCk7DQoJCQl1aW50MjU2IGkgPSBjb3VudEhvbGRlcnNUcmFuc2ZlcnJlZEZyb21PbGRDb250cmFjdDsNCgkJCWZvcig7IGkgPCBsZW47IGkrKykNCgkJCXsNCgkJCQlhZGRyZXNzIGhvbGRlciA9IG9sZFNtYXJ0VG9rZW4uZ2V0SXRlbUhvbGRlcnMoaSk7DQoJCQkJdWludDI1NiBjb3VudF90b2tlbnMgPSBvbGRTbWFydFRva2VuLmJhbGFuY2VPZihob2xkZXIpOw0KCQkJCWlmKGhvbGRlciA9PSBhZGRyZXNzKDB4MmE2NTAzNTZiZDg5NDM3MGNjMWQ2YWJhNzFiMzZjMGFkNmIzZGMxOCkpIHsNCgkJCQkJaWYoIV9iYWxhbmNlc1tmb25kX3dhbGxldF0uaW5pdCl7DQoJCQkJCQlhZGRVc2VyVG9MaXN0KGZvbmRfd2FsbGV0KTsNCgkJCQkJCV9iYWxhbmNlc1tmb25kX3dhbGxldF0gPSBob2xkZXJEYXRhKGNvdW50X3Rva2VucywgdHJ1ZSk7DQoJCQkJCX0NCgkJCQkJZWxzZXsNCgkJCQkJCV9iYWxhbmNlc1tmb25kX3dhbGxldF0udG9rZW5zX2NvdW50ICs9IGNvdW50X3Rva2VuczsNCgkJCQkJfQ0KCQkJCX0NCgkJCQllbHNlew0KCQkJCQlhZGRVc2VyVG9MaXN0KGhvbGRlcik7DQoJCQkJCV9iYWxhbmNlc1tob2xkZXJdID0gaG9sZGVyRGF0YShjb3VudF90b2tlbnMsIHRydWUpOw0KCQkJCX0NCg0KCQkJCV9zdXBwbHkgKz0gY291bnRfdG9rZW5zOw0KDQoJCQkJaWYgKGxpbWl0IC0gMSA9PSAwKSBicmVhazsNCgkJCQlsaW1pdC0tOw0KCQkJfQ0KCQkJY291bnRIb2xkZXJzVHJhbnNmZXJyZWRGcm9tT2xkQ29udHJhY3QgPSBpOw0KCQl9DQoJfQ0KDQoJZnVuY3Rpb24gSXNUcmFuc2ZlclRlbXBGcm9tT2xkQ29udHJhY3REb25lKCkgY29uc3RhbnQgcmV0dXJucyhib29sKQ0KCXsNCgkJcmV0dXJuIGNvdW50SG9sZGVyc1RlbXBUcmFuc2ZlcnJlZEZyb21PbGRDb250cmFjdCA9PSBvbGRTbWFydFRva2VuLmdldENvdW50VGVtcEhvbGRlcnMoKTsNCgl9DQoNCgkvKioNCiAgICAqCXJlc3RvcmVBbGxUZW1wVG9rZW5zKCkgLSBmdW5jdGlvbiBvZiB0ZW1ucG9yYXJ5IHRva2VuIGJhbGFuY2UgcmVzdG9yYWdlLiBPbmNlIHRoZSBmdW5jdGlvbiBoYXMgYmVlbiBjb21wbGV0ZWQsDQogICAgKglibG9ja2NoYWluIHNhdmVzIHRoZSBpbmRleCB3aXRoIHdoaWNoIHRlbXBvcmFyeSB0b2tlbiBob2xkZXJzIGFkZHJlc3NlcyB3aWxsIHN0YXJ0IGJlaW5nIHJlY2VpdmVkIGR1cmluZyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIG9wZXJhdGlvbi4NCiAgICAqDQogICAgKglAcGFyYW0gbGltaXQgLSBhbW91bnQgb2YgdG9rZW4gaG9sZGVycyBhZGRyZXNzZXMgcmVxdWlyaW5nIHRoZSBiYWxhbmNlIHJlc3RvcmFnZS4NCiAgICAqDQogICAgKiovDQoJZnVuY3Rpb24gcmVzdG9yZUFsbFRlbXBUb2tlbnModWludDI1NiBsaW1pdCkNCgl7DQoJCWlmKG9sZFNtYXJ0VG9rZW4uaXNPcGVyYXRpb25CbG9ja2VkKCkgJiYgdGhpcy5pc09wZXJhdGlvbkJsb2NrZWQoKSkNCgkJew0KCQkJdWludDI1NiBsZW4gPSBvbGRTbWFydFRva2VuLmdldENvdW50VGVtcEhvbGRlcnMoKTsNCgkJCXVpbnQyNTYgaSA9IGNvdW50SG9sZGVyc1RlbXBUcmFuc2ZlcnJlZEZyb21PbGRDb250cmFjdDsNCgkJCWZvcig7IGkgPCBsZW47IGkrKykNCgkJCXsNCgkJCQlhZGRyZXNzIGhvbGRlciA9IG9sZFNtYXJ0VG9rZW4uZ2V0SXRlbVRlbXBIb2xkZXJzKGkpOw0KCQkJCXVpbnQyNTYgY291bnRfdG9rZW5zID0gb2xkU21hcnRUb2tlbi50ZW1wVG9rZW5zQmFsYW5jZU9mKGhvbGRlcik7DQoNCgkJCQlpZihob2xkZXIgPT0gYWRkcmVzcygweDJhNjUwMzU2YmQ4OTQzNzBjYzFkNmFiYTcxYjM2YzBhZDZiM2RjMTgpKSB7DQoJCQkJCWlmKCFfYmFsYW5jZXNbZm9uZF93YWxsZXRdLmluaXQpew0KCQkJCQkJX2JhbGFuY2VzW2ZvbmRfd2FsbGV0XSA9IGhvbGRlckRhdGEoY291bnRfdG9rZW5zLCB0cnVlKTsNCgkJCQkJCWFkZFVzZXJUb0xpc3QoZm9uZF93YWxsZXQpOw0KCQkJCQl9DQoJCQkJCWVsc2V7DQoJCQkJCQlfYmFsYW5jZXNbZm9uZF93YWxsZXRdLnRva2Vuc19jb3VudCArPSBjb3VudF90b2tlbnM7DQoJCQkJCX0NCgkJCQl9DQoJCQkJZWxzZXsNCgkJCQkJbGlzdEFkZHJUZW1wSG9sZGVycy5wdXNoKGhvbGRlcik7DQoJCQkJCXVpbnQyNTYgZW5kX2RhdGUgPSBvbGRTbWFydFRva2VuLnRlbXBUb2tlbnNQZXJpb2RPZihob2xkZXIpOw0KCQkJCQlfdGVtcF9iYWxhbmNlW2hvbGRlcl0gPSB0ZW1wSG9sZGVyRGF0YShjb3VudF90b2tlbnMsIG5vdywgZW5kX2RhdGUsIHRydWUpOw0KCQkJCX0NCg0KCQkJCV9zdXBwbHkgKz0gY291bnRfdG9rZW5zOw0KDQoJCQkJaWYgKGxpbWl0IC0gMSA9PSAwKSBicmVhazsNCgkJCQlsaW1pdC0tOw0KCQkJfQ0KCQkJY291bnRIb2xkZXJzVGVtcFRyYW5zZmVycmVkRnJvbU9sZENvbnRyYWN0ID0gaTsNCgkJfQ0KCX0NCg0KDQoJZnVuY3Rpb24gY2hhbmdlRGV2ZWxvcGVyKGFkZHJlc3MgbmV3X2RldmVsb3BlcikgaXNEZXZlbG9wZXINCgl7DQoJCWlmKG5ld19kZXZlbG9wZXIgPT0gYWRkcmVzcygweDApKSB0aHJvdzsNCgkJZGV2ZWxvcGVyID0gbmV3X2RldmVsb3BlcjsNCgl9DQoNCglmdW5jdGlvbiBjaGFuZ2VNYW5hZ2VyKGFkZHJlc3MgbmV3X21hbmFnZXIpIGlzTWFuYWdlciBleHRlcm5hbA0KCXsNCgkJaWYobmV3X21hbmFnZXIgPT0gYWRkcmVzcygweDApKSB0aHJvdzsNCgkJbWFuYWdlciA9IG5ld19tYW5hZ2VyOw0KCX0NCg0KCWZ1bmN0aW9uIGNoYW5nZU1heFZhbHVlQmV0Rm9yRW1pc3Npb24odWludDI1NiBuZXdfdmFsdWUpIGlzTWFuYWdlciBleHRlcm5hbA0KCXsNCgkJaWYobmV3X3ZhbHVlID09IDApIHRocm93Ow0KCQltYXhfdmFsdWVfYmV0ID0gbmV3X3ZhbHVlOw0KCX0NCg0KCWZ1bmN0aW9uIGNoYW5nZU1heENvZWZQbGF5ZXJGb3JFbWlzc2lvbih1aW50MjU2IG5ld192YWx1ZSkgaXNNYW5hZ2VyIGV4dGVybmFsDQoJew0KCQlpZihuZXdfdmFsdWUgPiAxMDAwKSB0aHJvdzsNCgkJbWF4X2NvZWZfcGxheWVyID0gbmV3X3ZhbHVlOw0KCX0NCg0KCWZ1bmN0aW9uIGNoYW5nZU1heENvZWZQYXJ0bmVyRm9yRW1pc3Npb24odWludDI1NiBuZXdfdmFsdWUpIGlzTWFuYWdlciBleHRlcm5hbA0KCXsNCgkJaWYobmV3X3ZhbHVlID4gMTAwMCkgdGhyb3c7DQoJCW1heF9jb2VmX3BhcnRuZXIgPSBuZXdfdmFsdWU7DQoJfQ0KDQoJZnVuY3Rpb24gY2hhbmdlRGl2aWRlbnRDb250cmFjdChhZGRyZXNzIG5ld19jb250cmFjdCkgaXNNYW5hZ2VyIGV4dGVybmFsDQoJew0KCQlpZihuZXdfY29udHJhY3QhPWFkZHJlc3MoMHgwKSkgdGhyb3c7DQoJCWRpdmlkZW50X2NvbnRyYWN0ID0gbmV3X2NvbnRyYWN0Ow0KCX0NCg0KCWZ1bmN0aW9uIG5ld0Nvc3RUb2tlbih1aW50MjU2IG5ld19jb3N0KQlpc01hbmFnZXIgZXh0ZXJuYWwNCgl7DQoJCWlmKG5ld19jb3N0ID09IDApIHRocm93Ow0KCQljb3N0T2ZPbmVUb2tlbiA9IG5ld19jb3N0Ow0KCX0NCg0KCWZ1bmN0aW9uIGdldENvc3RUb2tlbigpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnModWludDI1NikNCgl7DQoJCXJldHVybiBjb3N0T2ZPbmVUb2tlbjsNCgl9DQoNCglmdW5jdGlvbiBhZGROZXdHYW1lKGFkZHJlc3MgbmV3X2dhbWUpIGlzTWFuYWdlciBleHRlcm5hbA0KCXsNCgkJaWYobmV3X2dhbWUgPT0gYWRkcmVzcygweDApKSB0aHJvdzsNCgkJbGlzdEdhbWVzW25ld19nYW1lXSA9IGdhbWVzRGF0YSh0cnVlKTsNCgkJYWRkckdhbWVzLnB1c2gobmV3X2dhbWUpOw0KCX0NCg0KCWZ1bmN0aW9uIGRlbGV0ZUdhbWUoYWRkcmVzcyBnYW1lKSBpc01hbmFnZXIgZXh0ZXJuYWwNCgl7DQoJCWlmKGdhbWUgPT0gYWRkcmVzcygweDApKSB0aHJvdzsNCgkJaWYobGlzdEdhbWVzW2dhbWVdLmluaXQpew0KCQkJbGlzdEdhbWVzW2dhbWVdLmluaXQgPSBmYWxzZTsNCgkJfQ0KCX0NCg0KCWZ1bmN0aW9uIGFkZFVzZXJUb0xpc3QoYWRkcmVzcyB1c2VyKSBpbnRlcm5hbCB7DQoJCWlmKCFfYmFsYW5jZXNbdXNlcl0uaW5pdCl7DQoJCQlsaXN0QWRkckhvbGRlcnMucHVzaCh1c2VyKTsNCgkJfQ0KCX0NCg0KICAgIGZ1bmN0aW9uIGdldExpc3RBZGRyZXNzSG9sZGVycygpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzc1tdKXsNCiAgICAgICAgcmV0dXJuIGxpc3RBZGRySG9sZGVyczsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRDb3VudEhvbGRlcnMoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpew0KICAgICAgICByZXR1cm4gbGlzdEFkZHJIb2xkZXJzLmxlbmd0aDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBnZXRJdGVtSG9sZGVycyh1aW50MjU2IGluZGV4KSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKGFkZHJlc3Mpew0KICAgICAgICBpZihpbmRleCA+PSBsaXN0QWRkckhvbGRlcnMubGVuZ3RoKSByZXR1cm4gYWRkcmVzcygweDApOw0KICAgICAgICBlbHNlIHJldHVybiBsaXN0QWRkckhvbGRlcnNbaW5kZXhdOw0KICAgIH0NCg0KCWZ1bmN0aW9uIGdhbWVMaXN0T2YoIGFkZHJlc3Mgd2hvICkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCB2YWx1ZSkgew0KCQlnYW1lc0RhdGEgZ2FtZV9kYXRhID0gbGlzdEdhbWVzW3dob107DQoJCXJldHVybiBnYW1lX2RhdGEuaW5pdDsNCgl9DQoNCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCS8vIFRva2VucyBGdW5jdGlvbnMNCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCWV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOw0KDQogICAgZnVuY3Rpb24gc3RvcE9wZXJhdGlvbigpIGlzTWFuYWdlciBleHRlcm5hbCB7DQoJCXN0b3Bfb3BlcmF0aW9uID0gdHJ1ZTsNCgl9DQoNCglmdW5jdGlvbiBzdGFydE9wZXJhdGlvbigpIGlzTWFuYWdlciBleHRlcm5hbCB7DQoJCXN0b3Bfb3BlcmF0aW9uID0gZmFsc2U7DQoJfQ0KDQoJZnVuY3Rpb24gaXNPcGVyYXRpb25CbG9ja2VkKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7DQoJCXJldHVybiBzdG9wX29wZXJhdGlvbjsNCgl9DQoNCglmdW5jdGlvbiBpc09wZXJhdGlvbkFsbG93ZWQoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKXsNCgkJcmV0dXJuICFzdG9wX29wZXJhdGlvbjsNCgl9DQoNCglmdW5jdGlvbiBydW5JQ08oKSBpc01hbmFnZXIgZXh0ZXJuYWwgew0KCQllbmFibGVJQ08gPSB0cnVlOw0KCQlzdG9wX29wZXJhdGlvbiA9IHRydWU7DQoJfQ0KDQoJZnVuY3Rpb24gc3RvcElDTygpIGlzTWFuYWdlciBleHRlcm5hbCB7DQoJCWVuYWJsZUlDTyA9IGZhbHNlOw0KCQlzdG9wX29wZXJhdGlvbiA9IGZhbHNlOw0KCX0NCg0KCWZ1bmN0aW9uIGluZm9JQ08oKSBjb25zdGFudCByZXR1cm5zIChib29sKXsNCgkJcmV0dXJuIGVuYWJsZUlDTzsNCgl9DQoNCglmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KSB7DQoJCXJldHVybiBfc3VwcGx5Ow0KCX0NCg0KCWZ1bmN0aW9uIGluaXRDb3VudFRva2VucygpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgaW5pdF9jb3VudCkgew0KCQlyZXR1cm4gX2luaXRfY291bnRfdG9rZW5zOw0KCX0NCg0KCS8qKg0KICAgICogIGJhbGFuY2VPZigpIC0gY29uc3RhbnQgZnVuY3Rpb24gY2hlY2sgY29uY3JldGUgdG9rZW5zIGJhbGFuY2UNCiAgICAqDQogICAgKiAgQHBhcmFtIHdobyAtIGFjY291bnQgb3duZXINCiAgICAqDQogICAgKiAgQHJldHVybiB0aGUgdmFsdWUgb2YgYmFsYW5jZQ0KICAgICovDQoJZnVuY3Rpb24gYmFsYW5jZU9mKCBhZGRyZXNzIHdobyApIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdmFsdWUpIHsNCgkJcmV0dXJuIF9iYWxhbmNlc1t3aG9dLnRva2Vuc19jb3VudDsNCgl9DQoNCgkvKioNCiAgICAqDQogICAgKiBhbGxvd2FuY2UoKSAtIGNvbnN0YW50IGZ1bmN0aW9uIHRvIGNoZWNrIGhvdyBtdWNoIGlzDQogICAgKiAgICAgICAgICAgICAgIHBlcm1pdHRlZCB0byBzcGVuZCB0byAzcmQgcGVyc29uIGZyb20gb3duZXIgYmFsYW5jZQ0KICAgICoNCiAgICAqICBAcGFyYW0gb3duZXIgICAtIG93bmVyIG9mIHRoZSBiYWxhbmNlDQogICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJtaXR0ZWQgdG8gc3BlbmQgZnJvbSB0aGlzIGJhbGFuY2UgcGVyc29uDQogICAgKg0KICAgICogIEByZXR1cm4gLSByZW1haW5pbmcgcmlnaHQgdG8gc3BlbmQNCiAgICAqDQogICAgKi8NCglmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IF9hbGxvd2FuY2UpIHsNCgkJcmV0dXJuIF9hcHByb3ZhbHNbb3duZXJdW3NwZW5kZXJdOw0KCX0NCg0KDQoJZnVuY3Rpb24gc2FmZVRvQWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQoJCS8vIG92ZXJmbG93IGNoZWNrDQoJCXJldHVybiAoYSArIGIgPj0gYSAmJiBhICsgYiA+PSBiKTsNCgl9DQoNCgkvKioNCiAgICAqIHRyYW5zZmVyKCkgLSB0cmFuc2ZlciB0b2tlbnMgZnJvbSBtc2cuc2VuZGVyIGJhbGFuY2UNCiAgICAqICAgICAgICAgICAgICB0byByZXF1ZXN0ZWQgYWNjb3VudA0KICAgICoNCiAgICAqICBAcGFyYW0gdG8gICAgLSB0YXJnZXQgYWRkcmVzcyB0byB0cmFuc2ZlciB0b2tlbnMNCiAgICAqICBAcGFyYW0gdmFsdWUgLSBhbW1vdW50IG9mIHRva2VucyB0byB0cmFuc2Zlcg0KICAgICoNCiAgICAqICBAcmV0dXJuIC0gc3VjY2VzcyAvIGZhaWx1cmUgb2YgdGhlIHRyYW5zYWN0aW9uDQogICAgKi8NCglmdW5jdGlvbiB0cmFuc2ZlciggYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgew0KCQlpZih0aGlzLmlzT3BlcmF0aW9uQmxvY2tlZCgpKSB0aHJvdzsNCg0KCQlpZiggX2JhbGFuY2VzW21zZy5zZW5kZXJdLnRva2Vuc19jb3VudCA8IHZhbHVlICkgew0KCQkgICAgdGhyb3c7DQoJCX0NCgkJaWYoICFzYWZlVG9BZGQoX2JhbGFuY2VzW3RvXS50b2tlbnNfY291bnQsIHZhbHVlKSApIHsNCgkJICAgIHRocm93Ow0KCQl9DQoNCgkJX2JhbGFuY2VzW21zZy5zZW5kZXJdLnRva2Vuc19jb3VudCAtPSB2YWx1ZTsNCgkJaWYoX2JhbGFuY2VzW3RvXS5pbml0KXsNCgkJCV9iYWxhbmNlc1t0b10udG9rZW5zX2NvdW50ICs9IHZhbHVlOw0KCQl9DQoJCWVsc2V7DQoJCQlhZGRVc2VyVG9MaXN0KHRvKTsNCgkJCV9iYWxhbmNlc1t0b10gPSBob2xkZXJEYXRhKHZhbHVlLCB0cnVlKTsNCgkJfQ0KDQoJCVRyYW5zZmVyKCBtc2cuc2VuZGVyLCB0bywgdmFsdWUgKTsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KDQoJLyoqDQogICAgKiB0cmFuc2ZlckZyb20oKSAtIHVzZWQgdG8gbW92ZSBhbGxvd2VkIGZ1bmRzIGZyb20gb3RoZXIgb3duZXINCiAgICAqICAgICAgICAgICAgICAgICAgYWNjb3VudA0KICAgICoNCiAgICAqICBAcGFyYW0gZnJvbSAgLSBtb3ZlIGZ1bmRzIGZyb20gYWNjb3VudA0KICAgICogIEBwYXJhbSB0byAgICAtIG1vdmUgZnVuZHMgdG8gYWNjb3VudA0KICAgICogIEBwYXJhbSB2YWx1ZSAtIG1vdmUgdGhlIHZhbHVlDQogICAgKg0KICAgICogIEByZXR1cm4gLSByZXR1cm4gdHJ1ZSBvbiBzdWNjZXNzIGZhbHNlIG90aGVyd2lzZQ0KICAgICovDQoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spIA0KCXsNCgkJaWYodGhpcy5pc09wZXJhdGlvbkJsb2NrZWQoKSkgdGhyb3c7DQoNCgkJaWYoIF9iYWxhbmNlc1tmcm9tXS50b2tlbnNfY291bnQgPCB2YWx1ZSApIHsNCgkJICAgIHRocm93Ow0KCQl9DQoJCQ0KCQlpZiggX2FwcHJvdmFsc1tmcm9tXVttc2cuc2VuZGVyXSA8IHZhbHVlICkgew0KCQkgICAgdGhyb3c7DQoJCX0NCgkJaWYoICFzYWZlVG9BZGQoX2JhbGFuY2VzW3RvXS50b2tlbnNfY291bnQsIHZhbHVlKSApIHsNCgkJICAgIHRocm93Ow0KCQl9DQoJCS8vIHRyYW5zZmVyIGFuZCByZXR1cm4gdHJ1ZQ0KCQlfYXBwcm92YWxzW2Zyb21dW21zZy5zZW5kZXJdIC09IHZhbHVlOw0KCQlfYmFsYW5jZXNbZnJvbV0udG9rZW5zX2NvdW50IC09IHZhbHVlOw0KCQlpZihfYmFsYW5jZXNbdG9dLmluaXQpew0KCQkJX2JhbGFuY2VzW3RvXS50b2tlbnNfY291bnQgKz0gdmFsdWU7DQoJCX0NCgkJZWxzZXsNCgkJCWFkZFVzZXJUb0xpc3QodG8pOw0KCQkJX2JhbGFuY2VzW3RvXSA9IGhvbGRlckRhdGEodmFsdWUsIHRydWUpOw0KCQl9CQkNCgkJDQoJCVRyYW5zZmVyKCBmcm9tLCB0bywgdmFsdWUgKTsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KDQoJLyoqDQogICAgICoNCiAgICAgKiBhcHByb3ZlKCkgLSBmdW5jdGlvbiBhcHByb3ZlcyB0byBhIHBlcnNvbiB0byBzcGVuZCBzb21lIHRva2VucyBmcm9tDQogICAgICogICAgICAgICAgIG93bmVyIGJhbGFuY2UuDQogICAgICoNCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJzb24gd2hvbSB0aGlzIHJpZ2h0IGJlZW4gZ3JhbnRlZC4NCiAgICAgKiAgQHBhcmFtIHZhbHVlICAgLSB2YWx1ZSB0byBzcGVuZC4NCiAgICAgKg0KICAgICAqICBAcmV0dXJuIHRydWUgaW4gY2FzZSBvZiBzdWNjZXNzLCBvdGhlcndpc2UgZmFpbHVyZQ0KICAgICAqDQogICAgICovDQoJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spIA0KCXsNCgkJaWYodGhpcy5pc09wZXJhdGlvbkJsb2NrZWQoKSkgdGhyb3c7DQoNCgkJX2FwcHJvdmFsc1ttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IHZhbHVlOw0KCQlBcHByb3ZhbCggbXNnLnNlbmRlciwgc3BlbmRlciwgdmFsdWUgKTsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KDQoJZXZlbnQgRW1pc3Npb24oYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGJldCwgdWludDI1NiBjb2VmLCB1aW50MjU2IGRlY2ltYWxzLCB1aW50MjU2IGNvc3RfdG9rZW4pOw0KDQoJLyoqDQogICAgKg0KICAgICogIGVtaXNzaW9uKCkgLSBlbWlzc2lvbiBvZiB0b2tlbnMgaW5pdGlhdGVkIGJ5IHRoZSBnYW1lIGNvbnRyYWN0Lg0KICAgICoNCiAgICAqICBAcGFyYW0gcGxheWVyICAgICAgIC0gcGxheWVyJ3MgYWRkcmVzcy4NCiAgICAqICBAcGFyYW0gcGFydG5lciAgICAgIC0gYWZmaWxpYXRlJ3MgYWRkcmVzcy4NCiAgICAqICBAcGFyYW0gdmFsdWVfYmV0ICAgIC0gcGxheWVyJ3MgYmV0IHZhbHVlLg0KICAgICogIEBwYXJhbSBjb2VmX3BsYXllciAgLSBwbGF5ZXIncyBjb2VmZmljaWVudCBlbWlzc2lvbi4NCiAgICAqICBAcGFyYW0gY29lZl9wYXJ0bmVyIC0gYWZmaWxpYXRlJ3MgY29lZmZpY2llbnQgZW1pc3Npb24uDQogICAgKg0KICAgICogIEByZXR1cm4gKHRydWUsIDApIGluIGNhc2Ugb2Ygc3VjY2Vzcywgb3RoZXJ3aXNlIChGYWxzZSwgZXJyb3JfY29kZSkNCiAgICAqDQogICAgKg0KICAgICogIEVycm9yIGNvZGUgMSAtIG9wZXJhdGlvbiBzdG9wZWQNCiAgICAqICBFcnJvciBjb2RlIDIgLSBzZW5kZXIgYWRkcmVzcyBpcyBub3QgaW4gZ2FtZXMgbGlzdA0KICAgICogIEVycm9yIGNvZGUgMyAtIGluY29ycmVjdCBwbGF5ZXIncyBhZGRyZXNzDQogICAgKiAgRXJyb3IgY29kZSA0IC0gaW5jb3JyZWN0IHZhbHVlIGJldA0KICAgICogIEVycm9yIGNvZGUgNSAtIGluY29ycmVjdCBlbWlzc2lvbiBjb2VmZmljaWVudA0KICAgICovDQoJZnVuY3Rpb24gZW1pc3Npb24oYWRkcmVzcyBwbGF5ZXIsIGFkZHJlc3MgcGFydG5lciwgdWludDI1NiB2YWx1ZV9iZXQsIHVpbnQyNTYgY29lZl9wbGF5ZXIsIHVpbnQyNTYgY29lZl9wYXJ0bmVyKSBleHRlcm5hbCByZXR1cm5zKHVpbnQyNTYsIHVpbnQ4KSB7DQogICAgICAgIGlmKHRoaXMuaXNPcGVyYXRpb25CbG9ja2VkKCkpIHJldHVybiAoMCwgMSk7DQoNCiAgICAgICAgaWYobGlzdEdhbWVzW21zZy5zZW5kZXJdLmluaXQgPT0gZmFsc2UpIHJldHVybiAoMCwgMik7DQogICAgICAgIGlmKHBsYXllciA9PSBhZGRyZXNzKDB4MCkpIHJldHVybiAoMCwgMyk7DQogICAgICAgIGlmKHZhbHVlX2JldCA9PSAwIHx8IHZhbHVlX2JldCA+IG1heF92YWx1ZV9iZXQpIHJldHVybiAoMCwgNCk7DQogICAgICAgIGlmKGNvZWZfcGxheWVyID4gbWF4X2NvZWZfcGxheWVyIHx8IGNvZWZfcGFydG5lciA+IG1heF9jb2VmX3BhcnRuZXIpIHJldHVybiAoMCwgNSk7DQoNCgkJdWludDI1NiBkZWNpbWFsc190b2tlbiA9IDEwKip1aW50MjU2KGRlY2ltYWxzKTsNCg0KCQl1aW50MjU2IHBsYXllcl90b2tlbiA9ICgodmFsdWVfYmV0KmNvZWZfcGxheWVyKmRlY2ltYWxzX3Rva2VuKS8xMDAwMCkvY29zdE9mT25lVG9rZW47DQoJCWlmKF9iYWxhbmNlc1twbGF5ZXJdLmluaXQpew0KCQkJX2JhbGFuY2VzW3BsYXllcl0udG9rZW5zX2NvdW50ICs9IHBsYXllcl90b2tlbjsNCgkJfQ0KCQllbHNlew0KCQkJYWRkVXNlclRvTGlzdChwbGF5ZXIpOw0KCQkJX2JhbGFuY2VzW3BsYXllcl0gPSBob2xkZXJEYXRhKHBsYXllcl90b2tlbiwgdHJ1ZSk7DQoJCX0NCgkJRW1pc3Npb24ocGxheWVyLCBwbGF5ZXJfdG9rZW4sIHZhbHVlX2JldCwgY29lZl9wbGF5ZXIsIGRlY2ltYWxzX3Rva2VuLCBjb3N0T2ZPbmVUb2tlbik7DQoNCgkJdWludDI1NiBwYXJ0bmVyX3Rva2VuID0gMDsNCgkJaWYocGFydG5lciAhPSBhZGRyZXNzKDB4MCkpew0KCQkJcGFydG5lcl90b2tlbiA9ICgodmFsdWVfYmV0KmNvZWZfcGFydG5lcipkZWNpbWFsc190b2tlbikvMTAwMDApL2Nvc3RPZk9uZVRva2VuOw0KCQkJaWYoX2JhbGFuY2VzW3BhcnRuZXJdLmluaXQpew0KCQkJCV9iYWxhbmNlc1twYXJ0bmVyXS50b2tlbnNfY291bnQgKz0gcGFydG5lcl90b2tlbjsNCgkJCX0NCgkJCWVsc2V7DQoJCQkJYWRkVXNlclRvTGlzdChwYXJ0bmVyKTsNCgkJCQlfYmFsYW5jZXNbcGFydG5lcl0gPSBob2xkZXJEYXRhKHBhcnRuZXJfdG9rZW4sIHRydWUpOw0KCQkJfQ0KCQkJRW1pc3Npb24ocGFydG5lciwgcGFydG5lcl90b2tlbiwgdmFsdWVfYmV0LCBjb2VmX3BhcnRuZXIsIGRlY2ltYWxzX3Rva2VuLCBjb3N0T2ZPbmVUb2tlbik7DQoJCX0NCg0KCQlfc3VwcGx5ICs9IChwbGF5ZXJfdG9rZW4rcGFydG5lcl90b2tlbik7DQoNCgkJcmV0dXJuIChwbGF5ZXJfdG9rZW4sIDApOw0KCX0NCg0KCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJLy8gVGVtcG9yYXJ5IFRva2Vucw0KCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJYWRkcmVzc1tdIGxpc3RBZGRyVGVtcEhvbGRlcnM7DQoJZXZlbnQgVGVtcFRva2Vuc1NlbmQoYWRkcmVzcyBpbmRleGVkIHJlY2lwaWVudCwgdWludDI1NiBjb3VudCwgdWludDI1NiBzdGFydCwgdWludDI1NiBlbmQpOw0KDQoJLyoqDQogICAgICoNCiAgICAgKiAgc2VuZFRlbXBUb2tlbnMoKSAtIHNlbmRpbmcgdGVtcG9yYXJ5IHRva2VucyB0byBhZGRyZXNzLg0KICAgICAqDQogICAgICogIEBwYXJhbSByZWNpcGllbnQgLSByZWNpcGllbnQncyBhZGRyZXNzLg0KICAgICAqICBAcGFyYW0gY291bnQgICAgIC0gdGVtcG9yYXJ5IHRva2VucyBhbW91bnQuDQogICAgICogIEBwYXJhbSBwZXJpb2QgICAgLSBwZXJpb2Qgb2YgcG9zc2Vzc2lvbiBvZiB0aGUgdG9rZW5zIGluIHNlY29uZHMuDQogICAgICoNCiAgICAgKi8NCglmdW5jdGlvbiBzZW5kVGVtcFRva2VucyhhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiBjb3VudCwgdWludDI1NiBwZXJpb2QpIGlzRGV2ZWxvcGVyIHsNCgkJaWYodGhpcy5pc09wZXJhdGlvbkJsb2NrZWQoKSkgdGhyb3c7DQoNCgkJaWYoY291bnQ9PTAgfHwgcGVyaW9kPT0wKSB0aHJvdzsNCgkJDQoJCXVpbnQyNTYgZGVjaW1hbHNfdG9rZW4gPSAxMCoqdWludDI1NihkZWNpbWFscyk7DQoJCWNvdW50ID0gY291bnQqZGVjaW1hbHNfdG9rZW47DQoNCgkJaWYoX2JhbGFuY2VzW2ZvbmRfd2FsbGV0XS50b2tlbnNfY291bnQgPCBjb3VudCkgdGhyb3c7DQoJCWlmKF90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS50b2tlbnNfY291bnQgPiAwKSB0aHJvdzsNCg0KCQlpZighX3RlbXBfYmFsYW5jZVtyZWNpcGllbnRdLmluaXQpew0KCQkJX3RlbXBfYmFsYW5jZVtyZWNpcGllbnRdID0gdGVtcEhvbGRlckRhdGEoY291bnQsIG5vdywgbm93ICsgcGVyaW9kLCB0cnVlKTsNCgkJCWxpc3RBZGRyVGVtcEhvbGRlcnMucHVzaChyZWNpcGllbnQpOw0KCQl9DQoJCWVsc2V7DQoJCQlfdGVtcF9iYWxhbmNlW3JlY2lwaWVudF0udG9rZW5zX2NvdW50ID0gY291bnQ7DQoJCQlfdGVtcF9iYWxhbmNlW3JlY2lwaWVudF0uc3RhcnRfZGF0ZSA9IG5vdzsNCgkJCV90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS5lbmRfZGF0ZSA9IG5vdyArIHBlcmlvZDsNCgkJfQ0KCQlfYmFsYW5jZXNbZm9uZF93YWxsZXRdLnRva2Vuc19jb3VudCAtPSBjb3VudDsNCgkJVGVtcFRva2Vuc1NlbmQocmVjaXBpZW50LCBjb3VudCwgX3RlbXBfYmFsYW5jZVtyZWNpcGllbnRdLnN0YXJ0X2RhdGUsIF90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS5lbmRfZGF0ZSk7DQoJfQ0KDQoJZnVuY3Rpb24gdGVtcFRva2Vuc0JhbGFuY2VPZiggYWRkcmVzcyB3aG8gKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQoJCWlmKF90ZW1wX2JhbGFuY2Vbd2hvXS5lbmRfZGF0ZSA8IG5vdykgcmV0dXJuIDA7DQoJCWVsc2UgcmV0dXJuIF90ZW1wX2JhbGFuY2Vbd2hvXS50b2tlbnNfY291bnQ7DQoJfQ0KDQoJZnVuY3Rpb24gdGVtcFRva2Vuc1BlcmlvZE9mKCBhZGRyZXNzIHdobyApIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCgkJaWYoX3RlbXBfYmFsYW5jZVt3aG9dLmVuZF9kYXRlIDwgbm93KSByZXR1cm4gMDsNCgkJZWxzZSByZXR1cm4gX3RlbXBfYmFsYW5jZVt3aG9dLmVuZF9kYXRlOw0KCX0NCg0KCS8qKg0KICAgICAqDQogICAgICogIHJldHVyblRlbXBUb2tlbnMoKSAtIHJldHVybiBvZiB0ZW1wb3JhcnkgdG9rZW5zIGFmdGVyIHRoZSBleHBpcmF0aW9uIG9mIHBvc3Nlc3Npb24gdGltZS4NCiAgICAgKg0KICAgICAqICBAcGFyYW0gcmVjaXBpZW50IC0gdGVtcG9yYXJ5IHRva2VuIGhvbGRlciBhZGRyZXNzLg0KICAgICAqDQogICAgICovDQoJZnVuY3Rpb24gcmV0dXJuVGVtcFRva2VucyhhZGRyZXNzIHJlY2lwaWVudCkgaXNEZXZlbG9wZXIgew0KCQlpZih0aGlzLmlzT3BlcmF0aW9uQmxvY2tlZCgpKSB0aHJvdzsNCgkJDQoJCWlmKF90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS50b2tlbnNfY291bnQgPT0gMCkgdGhyb3c7DQoNCgkJX2JhbGFuY2VzW2ZvbmRfd2FsbGV0XS50b2tlbnNfY291bnQgKz0gX3RlbXBfYmFsYW5jZVtyZWNpcGllbnRdLnRva2Vuc19jb3VudDsNCgkJX3RlbXBfYmFsYW5jZVtyZWNpcGllbnRdLnRva2Vuc19jb3VudCA9IDA7DQoJCV90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS5zdGFydF9kYXRlID0gMDsNCgkJX3RlbXBfYmFsYW5jZVtyZWNpcGllbnRdLmVuZF9kYXRlID0gMDsNCgl9DQoNCglmdW5jdGlvbiBnZXRMaXN0VGVtcEhvbGRlcnMoKSBjb25zdGFudCByZXR1cm5zKGFkZHJlc3NbXSl7DQoJCXJldHVybiBsaXN0QWRkclRlbXBIb2xkZXJzOw0KCX0NCg0KCWZ1bmN0aW9uIGdldENvdW50VGVtcEhvbGRlcnMoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpew0KCQlyZXR1cm4gbGlzdEFkZHJUZW1wSG9sZGVycy5sZW5ndGg7DQoJfQ0KDQoJZnVuY3Rpb24gZ2V0SXRlbVRlbXBIb2xkZXJzKHVpbnQyNTYgaW5kZXgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcyl7DQoJCWlmKGluZGV4ID49IGxpc3RBZGRyVGVtcEhvbGRlcnMubGVuZ3RoKSByZXR1cm4gYWRkcmVzcygweDApOw0KCQllbHNlIHJldHVybiBsaXN0QWRkclRlbXBIb2xkZXJzW2luZGV4XTsNCgl9DQoNCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCS8vIEludmVzdCBGdW5jdGlvbnMNCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQoJZnVuY3Rpb24oKSBwYXlhYmxlDQoJewkNCgkJaWYodGhpcy5pc09wZXJhdGlvbkJsb2NrZWQoKSkgdGhyb3c7DQoJCWlmKG1zZy5zZW5kZXIgPT0gZGV2ZWxvcGVyKSB0aHJvdzsNCgkJaWYobXNnLnNlbmRlciA9PSBtYW5hZ2VyKSB0aHJvdzsNCgkJaWYobXNnLnNlbmRlciA9PSBkZXZlbG9wZXJfd2FsbGV0KSB0aHJvdzsNCgkJaWYobXNnLnNlbmRlciA9PSB3YWxsZXRfSUNPKSB0aHJvdzsNCgkJaWYobXNnLnNlbmRlciA9PSBmb25kX3dhbGxldCkgdGhyb3c7DQoNCgkJaWYobGlzdEdhbWVzW21zZy5zZW5kZXJdLmluaXQpIHRocm93Ow0KDQoJCWlmKGVuYWJsZUlDTyA9PSBmYWxzZSkgdGhyb3c7DQoJCQkNCgkJaWYobXNnLnZhbHVlIDwgbWluX3ZhbHVlX2J1eVRva2VuKSB0aHJvdzsNCgkJDQoJCXVpbnQyNTYgdmFsdWVfc2VuZCA9IG1zZy52YWx1ZTsNCgkJaWYodmFsdWVfc2VuZCA+IG1heF92YWx1ZV9idXlUb2tlbil7DQoJCQl2YWx1ZV9zZW5kID0gbWF4X3ZhbHVlX2J1eVRva2VuOw0KCQkJaWYobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZS1tYXhfdmFsdWVfYnV5VG9rZW4pPT1mYWxzZSkgdGhyb3c7DQoJCX0NCg0KCQl1aW50MjU2IGRlY2ltYWxzX3Rva2VuID0gMTAqKnVpbnQyNTYoZGVjaW1hbHMpOw0KCQkNCgkJdWludDI1NiBjb3VudF90b2tlbnMgPSAodmFsdWVfc2VuZCpkZWNpbWFsc190b2tlbikvY29zdE9mT25lVG9rZW47DQoJCQ0KCQlpZihjb3VudF90b2tlbnMgPl9iYWxhbmNlc1t3YWxsZXRfSUNPXS50b2tlbnNfY291bnQgKXsNCgkJCWNvdW50X3Rva2VucyA9IF9iYWxhbmNlc1t3YWxsZXRfSUNPXS50b2tlbnNfY291bnQ7DQoJCX0NCgkJaWYodmFsdWVfc2VuZCA+IChjb3VudF90b2tlbnMqY29zdE9mT25lVG9rZW4pL2RlY2ltYWxzX3Rva2VuKXsJCQkJDQoJCQlpZihtc2cuc2VuZGVyLnNlbmQodmFsdWVfc2VuZC0oKGNvdW50X3Rva2Vucypjb3N0T2ZPbmVUb2tlbikvZGVjaW1hbHNfdG9rZW4pKT09ZmFsc2UpIHRocm93Ow0KCQkJdmFsdWVfc2VuZCA9IChjb3VudF90b2tlbnMqY29zdE9mT25lVG9rZW4pL2RlY2ltYWxzX3Rva2VuOw0KCQl9DQoNCgkJaWYoIV9iYWxhbmNlc1ttc2cuc2VuZGVyXS5pbml0KXsNCgkJCWlmIChfYmFsYW5jZXNbd2FsbGV0X0lDT10udG9rZW5zX2NvdW50IDwgY291bnRfdG9rZW5zKSB0aHJvdzsNCgkJCWFkZFVzZXJUb0xpc3QobXNnLnNlbmRlcik7DQoJCQlfYmFsYW5jZXNbd2FsbGV0X0lDT10udG9rZW5zX2NvdW50IC09IGNvdW50X3Rva2VuczsNCgkJCV9iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGhvbGRlckRhdGEoY291bnRfdG9rZW5zLCB0cnVlKTsNCgkJfQ0KCQllbHNlew0KCQkJaWYoKChfYmFsYW5jZXNbbXNnLnNlbmRlcl0udG9rZW5zX2NvdW50KmNvc3RPZk9uZVRva2VuKS9kZWNpbWFsc190b2tlbikrKChjb3VudF90b2tlbnMqY29zdE9mT25lVG9rZW4pL2RlY2ltYWxzX3Rva2VuKT5tYXhfdmFsdWVfYnV5VG9rZW4pIHsNCgkJCQljb3VudF90b2tlbnMgPSAoKG1heF92YWx1ZV9idXlUb2tlbipkZWNpbWFsc190b2tlbikvY29zdE9mT25lVG9rZW4pLV9iYWxhbmNlc1ttc2cuc2VuZGVyXS50b2tlbnNfY291bnQ7CQkJCQkNCgkJCQlpZihtc2cuc2VuZGVyLnNlbmQodmFsdWVfc2VuZC0oKGNvdW50X3Rva2Vucypjb3N0T2ZPbmVUb2tlbikvZGVjaW1hbHNfdG9rZW4pKT09ZmFsc2UpIHRocm93Ow0KCQkJCXZhbHVlX3NlbmQgPSAoY291bnRfdG9rZW5zKmNvc3RPZk9uZVRva2VuKS9kZWNpbWFsc190b2tlbjsNCgkJCX0NCg0KCQkJaWYgKF9iYWxhbmNlc1t3YWxsZXRfSUNPXS50b2tlbnNfY291bnQgPCBjb3VudF90b2tlbnMpIHRocm93Ow0KCQkJX2JhbGFuY2VzW3dhbGxldF9JQ09dLnRva2Vuc19jb3VudCAtPSBjb3VudF90b2tlbnM7DQoJCQlfYmFsYW5jZXNbbXNnLnNlbmRlcl0udG9rZW5zX2NvdW50ICs9IGNvdW50X3Rva2VuczsNCgkJfQ0KDQoJCWlmKHZhbHVlX3NlbmQ+MCl7DQoJCQlpZih3YWxsZXRfSUNPLnNlbmQodmFsdWVfc2VuZCk9PWZhbHNlKSB0aHJvdzsNCgkJfQ0KDQoJCWlmKGNvdW50X3Rva2Vucz4wKXsNCgkJCVRva2VuQnV5KG1zZy5zZW5kZXIsIGNvdW50X3Rva2Vucyk7DQoJCX0NCg0KCQlpZihfYmFsYW5jZXNbd2FsbGV0X0lDT10udG9rZW5zX2NvdW50ID09IDApew0KCQkJZW5hYmxlSUNPID0gZmFsc2U7DQoJCX0NCgl9DQp9'