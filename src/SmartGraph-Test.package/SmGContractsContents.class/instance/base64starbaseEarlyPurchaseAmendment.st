base 64 content
base64starbaseEarlyPurchaseAmendment
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC43Ow0KLy8vIEB0aXRsZSBFYXJseVB1cmNoYXNlIGNvbnRyYWN0IC0gS2VlcCB0cmFjayBvZiBwdXJjaGFzZWQgYW1vdW50IGJ5IEVhcmx5IFB1cmNoYXNlcnMNCi8vLyBAYXV0aG9yIFN0YXJiYXNlIFBURS4gTFRELiAtIDxpbmZvQHN0YXJiYXNlLmNvPg0KY29udHJhY3QgQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZSB7DQogICAgZnVuY3Rpb24gc3RhcnREYXRlKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdGFydERhdGUpIHt9DQp9DQoNCmNvbnRyYWN0IFN0YXJiYXNlRWFybHlQdXJjaGFzZSB7DQogICAgLyoNCiAgICAgKiAgQ29uc3RhbnRzDQogICAgICovDQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBQVVJDSEFTRV9BTU9VTlRfVU5JVCA9ICdDTlknOyAgICAvLyBDaGluZXNlIFl1YW4NCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFX0FNT1VOVF9SQVRFX1JFRkVSRU5DRSA9ICdodHRwOi8vd3d3LnhlLmNvbS9jdXJyZW5jeXRhYmxlcy8nOw0KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFX0FNT1VOVF9DQVAgPSA5MDAwMDAwOw0KDQogICAgLyoNCiAgICAgKiAgVHlwZXMNCiAgICAgKi8NCiAgICBzdHJ1Y3QgRWFybHlQdXJjaGFzZSB7DQogICAgICAgIGFkZHJlc3MgcHVyY2hhc2VyOw0KICAgICAgICB1aW50IGFtb3VudDsgICAgICAgIC8vIENOWSBiYXNlZCBhbW91bnQNCiAgICAgICAgdWludCBwdXJjaGFzZWRBdDsgICAvLyB0aW1lc3RhbXANCiAgICB9DQoNCiAgICAvKg0KICAgICAqICBFeHRlcm5hbCBjb250cmFjdHMNCiAgICAgKi8NCiAgICBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlIHB1YmxpYyBzdGFyYmFzZUNyb3dkc2FsZTsNCg0KICAgIC8qDQogICAgICogIFN0b3JhZ2UNCiAgICAgKi8NCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCiAgICBFYXJseVB1cmNoYXNlW10gcHVibGljIGVhcmx5UHVyY2hhc2VzOw0KICAgIHVpbnQgcHVibGljIGVhcmx5UHVyY2hhc2VDbG9zZWRBdDsNCg0KICAgIC8qDQogICAgICogIE1vZGlmaWVycw0KICAgICAqLw0KICAgIG1vZGlmaWVyIG5vRXRoZXIoKSB7DQogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgb25seUJlZm9yZUNyb3dkc2FsZSgpIHsNCiAgICAgICAgaWYgKGFkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpICE9IDAgJiYNCiAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlLnN0YXJ0RGF0ZSgpID4gMCkNCiAgICAgICAgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5RWFybHlQdXJjaGFzZVRlcm0oKSB7DQogICAgICAgIGlmIChlYXJseVB1cmNoYXNlQ2xvc2VkQXQgPiAwKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8qDQogICAgICogIENvbnRyYWN0IGZ1bmN0aW9ucw0KICAgICAqLw0KICAgIC8vLyBAZGV2IFJldHVybnMgZWFybHkgcHVyY2hhc2VkIGFtb3VudCBieSBwdXJjaGFzZXIncyBhZGRyZXNzDQogICAgLy8vIEBwYXJhbSBwdXJjaGFzZXIgUHVyY2hhc2VyIGFkZHJlc3MNCiAgICBmdW5jdGlvbiBwdXJjaGFzZWRBbW91bnRCeShhZGRyZXNzIHB1cmNoYXNlcikNCiAgICAgICAgZXh0ZXJuYWwNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgbm9FdGhlcg0KICAgICAgICByZXR1cm5zICh1aW50IGFtb3VudCkNCiAgICB7DQogICAgICAgIGZvciAodWludCBpOyBpIDwgZWFybHlQdXJjaGFzZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmIChlYXJseVB1cmNoYXNlc1tpXS5wdXJjaGFzZXIgPT0gcHVyY2hhc2VyKSB7DQogICAgICAgICAgICAgICAgYW1vdW50ICs9IGVhcmx5UHVyY2hhc2VzW2ldLmFtb3VudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFJldHVybnMgdG90YWwgYW1vdW50IG9mIHJhaXNlZCBmdW5kcyBieSBFYXJseSBQdXJjaGFzZXJzDQogICAgZnVuY3Rpb24gdG90YWxBbW91bnRPZkVhcmx5UHVyY2hhc2VzKCkNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgbm9FdGhlcg0KICAgICAgICByZXR1cm5zICh1aW50IHRvdGFsQW1vdW50KQ0KICAgIHsNCiAgICAgICAgZm9yICh1aW50IGk7IGkgPCBlYXJseVB1cmNoYXNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdG90YWxBbW91bnQgKz0gZWFybHlQdXJjaGFzZXNbaV0uYW1vdW50Ow0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgZWFybHkgcHVyY2hhc2VzDQogICAgZnVuY3Rpb24gbnVtYmVyT2ZFYXJseVB1cmNoYXNlcygpDQogICAgICAgIGV4dGVybmFsDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIG5vRXRoZXINCiAgICAgICAgcmV0dXJucyAodWludCkNCiAgICB7DQogICAgICAgIHJldHVybiBlYXJseVB1cmNoYXNlcy5sZW5ndGg7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgQXBwZW5kIGFuIGVhcmx5IHB1cmNoYXNlIGxvZw0KICAgIC8vLyBAcGFyYW0gcHVyY2hhc2VyIFB1cmNoYXNlciBhZGRyZXNzDQogICAgLy8vIEBwYXJhbSBhbW91bnQgUHVyY2hhc2UgYW1vdW50DQogICAgLy8vIEBwYXJhbSBwdXJjaGFzZWRBdCBUaW1lc3RhbXAgb2YgcHVyY2hhc2VkIGRhdGUNCiAgICBmdW5jdGlvbiBhcHBlbmRFYXJseVB1cmNoYXNlKGFkZHJlc3MgcHVyY2hhc2VyLCB1aW50IGFtb3VudCwgdWludCBwdXJjaGFzZWRBdCkNCiAgICAgICAgZXh0ZXJuYWwNCiAgICAgICAgbm9FdGhlcg0KICAgICAgICBvbmx5T3duZXINCiAgICAgICAgb25seUJlZm9yZUNyb3dkc2FsZQ0KICAgICAgICBvbmx5RWFybHlQdXJjaGFzZVRlcm0NCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIGlmIChhbW91bnQgPT0gMCB8fA0KICAgICAgICAgICAgdG90YWxBbW91bnRPZkVhcmx5UHVyY2hhc2VzKCkgKyBhbW91bnQgPiBQVVJDSEFTRV9BTU9VTlRfQ0FQKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAocHVyY2hhc2VkQXQgPT0gMCB8fCBwdXJjaGFzZWRBdCA+IG5vdykgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBlYXJseVB1cmNoYXNlcy5wdXNoKEVhcmx5UHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IENsb3NlIGVhcmx5IHB1cmNoYXNlIHRlcm0NCiAgICBmdW5jdGlvbiBjbG9zZUVhcmx5UHVyY2hhc2UoKQ0KICAgICAgICBleHRlcm5hbA0KICAgICAgICBub0V0aGVyDQogICAgICAgIG9ubHlPd25lcg0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgZWFybHlQdXJjaGFzZUNsb3NlZEF0ID0gbm93Ow0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFNldHVwIGZ1bmN0aW9uIHNldHMgZXh0ZXJuYWwgY29udHJhY3QncyBhZGRyZXNzDQogICAgLy8vIEBwYXJhbSBzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MgVG9rZW4gYWRkcmVzcw0KICAgIGZ1bmN0aW9uIHNldHVwKGFkZHJlc3Mgc3RhcmJhc2VDcm93ZHNhbGVBZGRyZXNzKQ0KICAgICAgICBleHRlcm5hbA0KICAgICAgICBub0V0aGVyDQogICAgICAgIG9ubHlPd25lcg0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgaWYgKGFkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpID09IDApIHsNCiAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlID0gQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZShzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uDQogICAgZnVuY3Rpb24gU3RhcmJhc2VFYXJseVB1cmNoYXNlKCkgbm9FdGhlciB7DQogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiBhbHdheXMgZmFpbHMNCiAgICBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCn0NCg0KDQpjb250cmFjdCBTdGFyYmFzZUVhcmx5UHVyY2hhc2VBbWVuZG1lbnQgew0KICAgIC8qDQogICAgICogIEV2ZW50cw0KICAgICAqLw0KICAgIGV2ZW50IEVhcmx5UHVyY2hhc2VJbnZhbGlkYXRlZCh1aW50IGVwSWR4KTsNCiAgICBldmVudCBFYXJseVB1cmNoYXNlQW1lbmRlZCh1aW50IGVwSWR4KTsNCg0KICAgIC8qDQogICAgICogIEV4dGVybmFsIGNvbnRyYWN0cw0KICAgICAqLw0KICAgIEFic3RyYWN0U3RhcmJhc2VDcm93ZHNhbGUgcHVibGljIHN0YXJiYXNlQ3Jvd2RzYWxlOw0KICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZSBwdWJsaWMgc3RhcmJhc2VFYXJseVB1cmNoYXNlOw0KDQogICAgLyoNCiAgICAgKiAgU3RvcmFnZQ0KICAgICAqLw0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KICAgIHVpbnRbXSBwdWJsaWMgaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzOw0KICAgIHVpbnRbXSBwdWJsaWMgYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzOw0KICAgIG1hcHBpbmcgKHVpbnQgPT4gU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2UpIHB1YmxpYyBhbWVuZGVkRWFybHlQdXJjaGFzZXM7DQoNCiAgICAvKg0KICAgICAqICBNb2RpZmllcnMNCiAgICAgKi8NCiAgICBtb2RpZmllciBub0V0aGVyKCkgew0KICAgICAgICBpZiAobXNnLnZhbHVlID4gMCkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVDcm93ZHNhbGUoKSB7DQogICAgICAgIGlmIChhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSAhPSAwICYmDQogICAgICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZS5zdGFydERhdGUoKSA+IDApDQogICAgICAgIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkKCkgew0KICAgICAgICBpZiAoYWRkcmVzcyhzdGFyYmFzZUVhcmx5UHVyY2hhc2UpID09IDApIHsNCiAgICAgICAgICAgIHRocm93Ow0KICAgICAgICB9DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiAgQ29udHJhY3QgZnVuY3Rpb25zIGFyZSBjb21wYXRpYmxlIHdpdGggb3JpZ2luYWwgb25lcw0KICAgICAqLw0KICAgIC8vLyBAZGV2IFJldHVybnMgYW4gZWFybHkgcHVyY2hhc2UgcmVjb3JkDQogICAgLy8vIEBwYXJhbSBlYXJseVB1cmNoYXNlSW5kZXggSW5kZXggbnVtYmVyIG9mIGFuIGVhcmx5IHB1cmNoYXNlDQogICAgZnVuY3Rpb24gZWFybHlQdXJjaGFzZXModWludCBlYXJseVB1cmNoYXNlSW5kZXgpDQogICAgICAgIGV4dGVybmFsDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIG9ubHlFYXJseVB1cmNoYXNlc0xvYWRlZA0KICAgICAgICByZXR1cm5zIChhZGRyZXNzIHB1cmNoYXNlciwgdWludCBhbW91bnQsIHVpbnQgcHVyY2hhc2VkQXQpDQogICAgew0KICAgICAgICByZXR1cm4gc3RhcmJhc2VFYXJseVB1cmNoYXNlLmVhcmx5UHVyY2hhc2VzKGVhcmx5UHVyY2hhc2VJbmRleCk7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgUmV0dXJucyBlYXJseSBwdXJjaGFzZWQgYW1vdW50IGJ5IHB1cmNoYXNlcidzIGFkZHJlc3MNCiAgICAvLy8gQHBhcmFtIHB1cmNoYXNlciBQdXJjaGFzZXIgYWRkcmVzcw0KICAgIGZ1bmN0aW9uIHB1cmNoYXNlZEFtb3VudEJ5KGFkZHJlc3MgcHVyY2hhc2VyKQ0KICAgICAgICBleHRlcm5hbA0KICAgICAgICBjb25zdGFudA0KICAgICAgICBub0V0aGVyDQogICAgICAgIHJldHVybnMgKHVpbnQgYW1vdW50KQ0KICAgIHsNCiAgICAgICAgU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2VbXSBtZW1vcnkgbm9ybWFsaXplZEVQID0NCiAgICAgICAgICAgIG5vcm1hbGl6ZWRFYXJseVB1cmNoYXNlcygpOw0KICAgICAgICBmb3IgKHVpbnQgaTsgaSA8IG5vcm1hbGl6ZWRFUC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWRFUFtpXS5wdXJjaGFzZXIgPT0gcHVyY2hhc2VyKSB7DQogICAgICAgICAgICAgICAgYW1vdW50ICs9IG5vcm1hbGl6ZWRFUFtpXS5hbW91bnQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8gQGRldiBSZXR1cm5zIHRvdGFsIGFtb3VudCBvZiByYWlzZWQgZnVuZHMgYnkgRWFybHkgUHVyY2hhc2Vycw0KICAgIGZ1bmN0aW9uIHRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlcygpDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIG5vRXRoZXINCiAgICAgICAgcmV0dXJucyAodWludCB0b3RhbEFtb3VudCkNCiAgICB7DQogICAgICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlW10gbWVtb3J5IG5vcm1hbGl6ZWRFUCA9DQogICAgICAgICAgICBub3JtYWxpemVkRWFybHlQdXJjaGFzZXMoKTsNCiAgICAgICAgZm9yICh1aW50IGk7IGkgPCBub3JtYWxpemVkRVAubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHRvdGFsQW1vdW50ICs9IG5vcm1hbGl6ZWRFUFtpXS5hbW91bnQ7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiBlYXJseSBwdXJjaGFzZXMNCiAgICBmdW5jdGlvbiBudW1iZXJPZkVhcmx5UHVyY2hhc2VzKCkNCiAgICAgICAgZXh0ZXJuYWwNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgbm9FdGhlcg0KICAgICAgICByZXR1cm5zICh1aW50KQ0KICAgIHsNCiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRFYXJseVB1cmNoYXNlcygpLmxlbmd0aDsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBTZXR1cCBmdW5jdGlvbiBzZXRzIGV4dGVybmFsIGNvbnRyYWN0J3MgYWRkcmVzcw0KICAgIC8vLyBAcGFyYW0gc3RhcmJhc2VDcm93ZHNhbGVBZGRyZXNzIFRva2VuIGFkZHJlc3MNCiAgICBmdW5jdGlvbiBzZXR1cChhZGRyZXNzIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcmVzcykNCiAgICAgICAgZXh0ZXJuYWwNCiAgICAgICAgbm9FdGhlcg0KICAgICAgICBvbmx5T3duZXINCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIGlmIChhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSA9PSAwKSB7DQogICAgICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZSA9IEFic3RyYWN0U3RhcmJhc2VDcm93ZHNhbGUoc3RhcmJhc2VDcm93ZHNhbGVBZGRyZXNzKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICAvKg0KICAgICAqICBDb250cmFjdCBmdW5jdGlvbnMNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpbnZhbGlkYXRlRWFybHlQdXJjaGFzZSh1aW50IGVhcmx5UHVyY2hhc2VJbmRleCkNCiAgICAgICAgZXh0ZXJuYWwNCiAgICAgICAgbm9FdGhlcg0KICAgICAgICBvbmx5T3duZXINCiAgICAgICAgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkDQogICAgICAgIG9ubHlCZWZvcmVDcm93ZHNhbGUNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIGlmIChudW1iZXJPZlJhd0Vhcmx5UHVyY2hhc2VzKCkgPD0gZWFybHlQdXJjaGFzZUluZGV4KSB7DQogICAgICAgICAgICB0aHJvdzsgIC8vIEFycmF5IEluZGV4IE91dCBvZiBCb3VuZHMgRXhjZXB0aW9uDQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKHVpbnQgaTsgaSA8IGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlc1tpXSA9PSBlYXJseVB1cmNoYXNlSW5kZXgpIHsNCiAgICAgICAgICAgICAgICB0aHJvdzsgIC8vIGRpc2FsbG93IGR1cGxpY2F0ZWQgaW52YWxpZGF0aW9uDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbnZhbGlkRWFybHlQdXJjaGFzZUluZGV4ZXMucHVzaChlYXJseVB1cmNoYXNlSW5kZXgpOw0KICAgICAgICBFYXJseVB1cmNoYXNlSW52YWxpZGF0ZWQoZWFybHlQdXJjaGFzZUluZGV4KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gaXNJbnZhbGlkRWFybHlQdXJjaGFzZSh1aW50IGVhcmx5UHVyY2hhc2VJbmRleCkNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgbm9FdGhlcg0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgaWYgKG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKSA8PSBlYXJseVB1cmNoYXNlSW5kZXgpIHsNCiAgICAgICAgICAgIHRocm93OyAgLy8gQXJyYXkgSW5kZXggT3V0IG9mIEJvdW5kcyBFeGNlcHRpb24NCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAodWludCBpOyBpIDwgaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzW2ldID09IGVhcmx5UHVyY2hhc2VJbmRleCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhbWVuZEVhcmx5UHVyY2hhc2UodWludCBlYXJseVB1cmNoYXNlSW5kZXgsIGFkZHJlc3MgcHVyY2hhc2VyLCB1aW50IGFtb3VudCwgdWludCBwdXJjaGFzZWRBdCkNCiAgICAgICAgZXh0ZXJuYWwNCiAgICAgICAgbm9FdGhlcg0KICAgICAgICBvbmx5T3duZXINCiAgICAgICAgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkDQogICAgICAgIG9ubHlCZWZvcmVDcm93ZHNhbGUNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIGlmIChwdXJjaGFzZWRBdCA9PSAwIHx8IHB1cmNoYXNlZEF0ID4gbm93KSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChudW1iZXJPZlJhd0Vhcmx5UHVyY2hhc2VzKCkgPD0gZWFybHlQdXJjaGFzZUluZGV4KSB7DQogICAgICAgICAgICB0aHJvdzsgIC8vIEFycmF5IEluZGV4IE91dCBvZiBCb3VuZHMgRXhjZXB0aW9uDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoaXNJbnZhbGlkRWFybHlQdXJjaGFzZShlYXJseVB1cmNoYXNlSW5kZXgpKSB7DQogICAgICAgICAgICB0aHJvdzsgIC8vIEludmFsaWQgZWFybHkgcHVyY2hhc2UgY2Fubm90IGJlIGFtZW5kZWQNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghaXNBbWVuZGVkRWFybHlQdXJjaGFzZShlYXJseVB1cmNoYXNlSW5kZXgpKSB7DQogICAgICAgICAgICBhbWVuZGVkRWFybHlQdXJjaGFzZUluZGV4ZXMucHVzaChlYXJseVB1cmNoYXNlSW5kZXgpOw0KICAgICAgICB9DQoNCiAgICAgICAgYW1lbmRlZEVhcmx5UHVyY2hhc2VzW2Vhcmx5UHVyY2hhc2VJbmRleF0gPQ0KICAgICAgICAgICAgU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KTsNCiAgICAgICAgRWFybHlQdXJjaGFzZUFtZW5kZWQoZWFybHlQdXJjaGFzZUluZGV4KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gaXNBbWVuZGVkRWFybHlQdXJjaGFzZSh1aW50IGVhcmx5UHVyY2hhc2VJbmRleCkNCiAgICAgICAgY29uc3RhbnQNCiAgICAgICAgbm9FdGhlcg0KICAgICAgICByZXR1cm5zIChib29sKQ0KICAgIHsNCiAgICAgICAgaWYgKG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKSA8PSBlYXJseVB1cmNoYXNlSW5kZXgpIHsNCiAgICAgICAgICAgIHRocm93OyAgLy8gQXJyYXkgSW5kZXggT3V0IG9mIEJvdW5kcyBFeGNlcHRpb24NCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAodWludCBpOyBpIDwgYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzW2ldID09IGVhcmx5UHVyY2hhc2VJbmRleCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBsb2FkU3RhcmJhc2VFYXJseVB1cmNoYXNlcyhhZGRyZXNzIHN0YXJiYXNlRWFybHlQdXJjaGFzZUFkZHJlc3MpDQogICAgICAgIGV4dGVybmFsDQogICAgICAgIG5vRXRoZXINCiAgICAgICAgb25seU93bmVyDQogICAgICAgIG9ubHlCZWZvcmVDcm93ZHNhbGUNCiAgICAgICAgcmV0dXJucyAoYm9vbCkNCiAgICB7DQogICAgICAgIGlmIChzdGFyYmFzZUVhcmx5UHVyY2hhc2VBZGRyZXNzID09IDAgfHwNCiAgICAgICAgICAgIGFkZHJlc3Moc3RhcmJhc2VFYXJseVB1cmNoYXNlKSAhPSAwKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KDQogICAgICAgIHN0YXJiYXNlRWFybHlQdXJjaGFzZSA9IFN0YXJiYXNlRWFybHlQdXJjaGFzZShzdGFyYmFzZUVhcmx5UHVyY2hhc2VBZGRyZXNzKTsNCiAgICAgICAgaWYgKHN0YXJiYXNlRWFybHlQdXJjaGFzZS5lYXJseVB1cmNoYXNlQ2xvc2VkQXQoKSA9PSAwKSB7DQogICAgICAgICAgICB0aHJvdzsgICAvLyB0aGUgZWFybHkgcHVyY2hhc2UgbXVzdCBiZSBjbG9zZWQNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBmdW5jdGlvbg0KICAgIGZ1bmN0aW9uIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCgpIG5vRXRoZXIgew0KICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gYWx3YXlzIGZhaWxzDQogICAgZnVuY3Rpb24gKCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJbnRlcm5hbCBmdW5jdGlvbnMNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBub3JtYWxpemVkRWFybHlQdXJjaGFzZXMoKQ0KICAgICAgICBjb25zdGFudA0KICAgICAgICBpbnRlcm5hbA0KICAgICAgICByZXR1cm5zIChTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZVtdIG5vcm1hbGl6ZWRFUCkNCiAgICB7DQogICAgICAgIHVpbnQgcmF3RVBDb3VudCA9IG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKTsNCiAgICAgICAgbm9ybWFsaXplZEVQID0gbmV3IFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlW10oDQogICAgICAgICAgICByYXdFUENvdW50IC0gaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzLmxlbmd0aCk7DQoNCiAgICAgICAgdWludCBub3JtYWxpemVkSWR4Ow0KICAgICAgICBmb3IgKHVpbnQgaTsgaSA8IHJhd0VQQ291bnQ7IGkrKykgew0KICAgICAgICAgICAgaWYgKGlzSW52YWxpZEVhcmx5UHVyY2hhc2UoaSkpIHsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsgICAvLyBpbnZhbGlkIGVhcmx5IHB1cmNoYXNlIHNob3VsZCBiZSBpZ25vcmVkDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlIG1lbW9yeSBlcDsNCiAgICAgICAgICAgIGlmIChpc0FtZW5kZWRFYXJseVB1cmNoYXNlKGkpKSB7DQogICAgICAgICAgICAgICAgZXAgPSBhbWVuZGVkRWFybHlQdXJjaGFzZXNbaV07ICAvLyBhbWVuZGVkIGVhcmx5IHB1cmNoYXNlIHNob3VsZCB0YWtlIGEgcHJpb3JpdHkNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZXAgPSBnZXRFYXJseVB1cmNoYXNlKGkpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBub3JtYWxpemVkRVBbbm9ybWFsaXplZElkeF0gPSBlcDsNCiAgICAgICAgICAgIG5vcm1hbGl6ZWRJZHgrKzsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldEVhcmx5UHVyY2hhc2UodWludCBlYXJseVB1cmNoYXNlSW5kZXgpDQogICAgICAgIGludGVybmFsDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIG9ubHlFYXJseVB1cmNoYXNlc0xvYWRlZA0KICAgICAgICByZXR1cm5zIChTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZSkNCiAgICB7DQogICAgICAgIHZhciAocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KSA9DQogICAgICAgICAgICBzdGFyYmFzZUVhcmx5UHVyY2hhc2UuZWFybHlQdXJjaGFzZXMoZWFybHlQdXJjaGFzZUluZGV4KTsNCiAgICAgICAgcmV0dXJuIFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlKHB1cmNoYXNlciwgYW1vdW50LCBwdXJjaGFzZWRBdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbnVtYmVyT2ZSYXdFYXJseVB1cmNoYXNlcygpDQogICAgICAgIGludGVybmFsDQogICAgICAgIGNvbnN0YW50DQogICAgICAgIG9ubHlFYXJseVB1cmNoYXNlc0xvYWRlZA0KICAgICAgICByZXR1cm5zICh1aW50KQ0KICAgIHsNCiAgICAgICAgcmV0dXJuIHN0YXJiYXNlRWFybHlQdXJjaGFzZS5udW1iZXJPZkVhcmx5UHVyY2hhc2VzKCk7DQogICAgfQ0KfQ=='