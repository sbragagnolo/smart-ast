base 64 content
base64stoxSmartTokenSale
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLyoNCiAgICBPd25lZCBjb250cmFjdCBpbnRlcmZhY2UNCiovDQpjb250cmFjdCBJT3duZWQgew0KICAgIC8vIHRoaXMgZnVuY3Rpb24gaXNuJ3QgYWJzdHJhY3Qgc2luY2UgdGhlIGNvbXBpbGVyIGVtaXRzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGdldHRlciBmdW5jdGlvbnMgYXMgZXh0ZXJuYWwNCiAgICBmdW5jdGlvbiBvd25lcigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIG93bmVyKSB7IG93bmVyOyB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljOw0KICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYzsNCn0NCg0KLyoNCiAgICBFUkMyMCBTdGFuZGFyZCBUb2tlbiBpbnRlcmZhY2UNCiovDQpjb250cmFjdCBJRVJDMjBUb2tlbiB7DQogICAgLy8gdGhlc2UgZnVuY3Rpb25zIGFyZW4ndCBhYnN0cmFjdCBzaW5jZSB0aGUgY29tcGlsZXIgZW1pdHMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgZ2V0dGVyIGZ1bmN0aW9ucyBhcyBleHRlcm5hbA0KICAgIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIG5hbWUpIHsgbmFtZTsgfQ0KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChzdHJpbmcgc3ltYm9sKSB7IHN5bWJvbDsgfQ0KICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4IGRlY2ltYWxzKSB7IGRlY2ltYWxzOyB9DQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB0b3RhbFN1cHBseSkgeyB0b3RhbFN1cHBseTsgfQ0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgeyBfb3duZXI7IGJhbGFuY2U7IH0NCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgeyBfb3duZXI7IF9zcGVuZGVyOyByZW1haW5pbmc7IH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQp9DQoNCi8qDQogICAgVG9rZW4gSG9sZGVyIGludGVyZmFjZQ0KKi8NCmNvbnRyYWN0IElUb2tlbkhvbGRlciBpcyBJT3duZWQgew0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKElFUkMyMFRva2VuIF90b2tlbiwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOw0KfQ0KDQovKg0KICAgIFNtYXJ0IFRva2VuIGludGVyZmFjZQ0KKi8NCmNvbnRyYWN0IElTbWFydFRva2VuIGlzIElUb2tlbkhvbGRlciwgSUVSQzIwVG9rZW4gew0KICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcnMoYm9vbCBfZGlzYWJsZSkgcHVibGljOw0KICAgIGZ1bmN0aW9uIGlzc3VlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsNCiAgICBmdW5jdGlvbiBkZXN0cm95KGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOw0KfQ0KDQovKg0KICAgIE92ZXJmbG93IHByb3RlY3RlZCBtYXRoIGZ1bmN0aW9ucw0KKi8NCmNvbnRyYWN0IFNhZmVNYXRoIHsNCiAgICAvKioNCiAgICAgICAgY29uc3RydWN0b3INCiAgICAqLw0KICAgIGZ1bmN0aW9uIFNhZmVNYXRoKCkgew0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IHJldHVybnMgdGhlIHN1bSBvZiBfeCBhbmQgX3ksIGFzc2VydHMgaWYgdGhlIGNhbGN1bGF0aW9uIG92ZXJmbG93cw0KDQogICAgICAgIEBwYXJhbSBfeCAgIHZhbHVlIDENCiAgICAgICAgQHBhcmFtIF95ICAgdmFsdWUgMg0KDQogICAgICAgIEByZXR1cm4gc3VtDQogICAgKi8NCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgdWludDI1NiB6ID0gX3ggKyBfeTsNCiAgICAgICAgYXNzZXJ0KHogPj0gX3gpOw0KICAgICAgICByZXR1cm4gejsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBkaWZmZXJlbmNlIG9mIF94IG1pbnVzIF95LCBhc3NlcnRzIGlmIHRoZSBzdWJ0cmFjdGlvbiByZXN1bHRzIGluIGEgbmVnYXRpdmUgbnVtYmVyDQoNCiAgICAgICAgQHBhcmFtIF94ICAgbWludWVuZA0KICAgICAgICBAcGFyYW0gX3kgICBzdWJ0cmFoZW5kDQoNCiAgICAgICAgQHJldHVybiBkaWZmZXJlbmNlDQogICAgKi8NCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAgICAgYXNzZXJ0KF94ID49IF95KTsNCiAgICAgICAgcmV0dXJuIF94IC0gX3k7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgcHJvZHVjdCBvZiBtdWx0aXBseWluZyBfeCBieSBfeSwgYXNzZXJ0cyBpZiB0aGUgY2FsY3VsYXRpb24gb3ZlcmZsb3dzDQoNCiAgICAgICAgQHBhcmFtIF94ICAgZmFjdG9yIDENCiAgICAgICAgQHBhcmFtIF95ICAgZmFjdG9yIDINCg0KICAgICAgICBAcmV0dXJuIHByb2R1Y3QNCiAgICAqLw0KICAgIGZ1bmN0aW9uIHNhZmVNdWwodWludDI1NiBfeCwgdWludDI1NiBfeSkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1Nikgew0KICAgICAgICB1aW50MjU2IHogPSBfeCAqIF95Ow0KICAgICAgICBhc3NlcnQoX3ggPT0gMCB8fCB6IC8gX3ggPT0gX3kpOw0KICAgICAgICByZXR1cm4gejsNCiAgICB9DQp9DQoNCi8qKg0KICAgIEVSQzIwIFN0YW5kYXJkIFRva2VuIGltcGxlbWVudGF0aW9uDQoqLw0KY29udHJhY3QgRVJDMjBUb2tlbiBpcyBJRVJDMjBUb2tlbiwgU2FmZU1hdGggew0KICAgIHN0cmluZyBwdWJsaWMgc3RhbmRhcmQgPSAnVG9rZW4gMC4xJzsNCiAgICBzdHJpbmcgcHVibGljIG5hbWUgPSAnJzsNCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICcnOw0KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFscyA9IDA7DQogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHkgPSAwOw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VPZjsNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyBhbGxvd2FuY2U7DQoNCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsNCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGNvbnN0cnVjdG9yDQoNCiAgICAgICAgQHBhcmFtIF9uYW1lICAgICAgICB0b2tlbiBuYW1lDQogICAgICAgIEBwYXJhbSBfc3ltYm9sICAgICAgdG9rZW4gc3ltYm9sDQogICAgICAgIEBwYXJhbSBfZGVjaW1hbHMgICAgZGVjaW1hbCBwb2ludHMsIGZvciBkaXNwbGF5IHB1cnBvc2VzDQogICAgKi8NCiAgICBmdW5jdGlvbiBFUkMyMFRva2VuKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQ4IF9kZWNpbWFscykgew0KICAgICAgICByZXF1aXJlKGJ5dGVzKF9uYW1lKS5sZW5ndGggPiAwICYmIGJ5dGVzKF9zeW1ib2wpLmxlbmd0aCA+IDApOyAvLyB2YWxpZGF0ZSBpbnB1dA0KDQogICAgICAgIG5hbWUgPSBfbmFtZTsNCiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsNCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7DQogICAgfQ0KDQogICAgLy8gdmFsaWRhdGVzIGFuIGFkZHJlc3MgLSBjdXJyZW50bHkgb25seSBjaGVja3MgdGhhdCBpdCBpc24ndCBudWxsDQogICAgbW9kaWZpZXIgdmFsaWRBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHsNCiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAweDApOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IHNlbmQgY29pbnMNCiAgICAgICAgdGhyb3dzIG9uIGFueSBlcnJvciByYXRoZXIgdGhlbiByZXR1cm4gYSBmYWxzZSBmbGFnIHRvIG1pbmltaXplIHVzZXIgZXJyb3JzDQoNCiAgICAgICAgQHBhcmFtIF90byAgICAgIHRhcmdldCBhZGRyZXNzDQogICAgICAgIEBwYXJhbSBfdmFsdWUgICB0cmFuc2ZlciBhbW91bnQNCg0KICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBpZiBpdCB3YXNuJ3QNCiAgICAqLw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkNCiAgICAgICAgcHVibGljDQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG8pDQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykNCiAgICB7DQogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZU9mW21zZy5zZW5kZXJdLCBfdmFsdWUpOw0KICAgICAgICBiYWxhbmNlT2ZbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZU9mW190b10sIF92YWx1ZSk7DQogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgYW4gYWNjb3VudC9jb250cmFjdCBhdHRlbXB0cyB0byBnZXQgdGhlIGNvaW5zDQogICAgICAgIHRocm93cyBvbiBhbnkgZXJyb3IgcmF0aGVyIHRoZW4gcmV0dXJuIGEgZmFsc2UgZmxhZyB0byBtaW5pbWl6ZSB1c2VyIGVycm9ycw0KDQogICAgICAgIEBwYXJhbSBfZnJvbSAgICBzb3VyY2UgYWRkcmVzcw0KICAgICAgICBAcGFyYW0gX3RvICAgICAgdGFyZ2V0IGFkZHJlc3MNCiAgICAgICAgQHBhcmFtIF92YWx1ZSAgIHRyYW5zZmVyIGFtb3VudA0KDQogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIGlmIGl0IHdhc24ndA0KICAgICovDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkNCiAgICAgICAgcHVibGljDQogICAgICAgIHZhbGlkQWRkcmVzcyhfZnJvbSkNCiAgICAgICAgdmFsaWRBZGRyZXNzKF90bykNCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQ0KICAgIHsNCiAgICAgICAgYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSwgX3ZhbHVlKTsNCiAgICAgICAgYmFsYW5jZU9mW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZU9mW19mcm9tXSwgX3ZhbHVlKTsNCiAgICAgICAgYmFsYW5jZU9mW190b10gPSBzYWZlQWRkKGJhbGFuY2VPZltfdG9dLCBfdmFsdWUpOw0KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBhbGxvdyBhbm90aGVyIGFjY291bnQvY29udHJhY3QgdG8gc3BlbmQgc29tZSB0b2tlbnMgb24geW91ciBiZWhhbGYNCiAgICAgICAgdGhyb3dzIG9uIGFueSBlcnJvciByYXRoZXIgdGhlbiByZXR1cm4gYSBmYWxzZSBmbGFnIHRvIG1pbmltaXplIHVzZXIgZXJyb3JzDQoNCiAgICAgICAgYWxzbywgdG8gbWluaW1pemUgdGhlIHJpc2sgb2YgdGhlIGFwcHJvdmUvdHJhbnNmZXJGcm9tIGF0dGFjayB2ZWN0b3INCiAgICAgICAgKHNlZSBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFZTFB0UXhadTFVQXZPOWNaMU8yUlBYQmJUMG1vb2g0RFlLakFfanAtUkxNLyksIGFwcHJvdmUgaGFzIHRvIGJlIGNhbGxlZCB0d2ljZQ0KICAgICAgICBpbiAyIHNlcGFyYXRlIHRyYW5zYWN0aW9ucyAtIG9uY2UgdG8gY2hhbmdlIHRoZSBhbGxvd2FuY2UgdG8gMCBhbmQgc2Vjb25kbHkgdG8gY2hhbmdlIGl0IHRvIHRoZSBuZXcgYWxsb3dhbmNlIHZhbHVlDQoNCiAgICAgICAgQHBhcmFtIF9zcGVuZGVyIGFwcHJvdmVkIGFkZHJlc3MNCiAgICAgICAgQHBhcmFtIF92YWx1ZSAgIGFsbG93YW5jZSBhbW91bnQNCg0KICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBpZiBpdCB3YXNuJ3QNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpDQogICAgICAgIHB1YmxpYw0KICAgICAgICB2YWxpZEFkZHJlc3MoX3NwZW5kZXIpDQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykNCiAgICB7DQogICAgICAgIC8vIGlmIHRoZSBhbGxvd2FuY2UgaXNuJ3QgMCwgaXQgY2FuIG9ubHkgYmUgdXBkYXRlZCB0byAwIHRvIHByZXZlbnQgYW4gYWxsb3dhbmNlIGNoYW5nZSBpbW1lZGlhdGVseSBhZnRlciB3aXRoZHJhd2FsDQogICAgICAgIHJlcXVpcmUoX3ZhbHVlID09IDAgfHwgYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKTsNCg0KICAgICAgICBhbGxvd2FuY2VbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KfQ0KDQovKg0KICAgIFByb3ZpZGVzIHN1cHBvcnQgYW5kIHV0aWxpdGllcyBmb3IgY29udHJhY3Qgb3duZXJzaGlwDQoqLw0KY29udHJhY3QgT3duZWQgaXMgSU93bmVkIHsNCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsNCg0KICAgIGV2ZW50IE93bmVyVXBkYXRlKGFkZHJlc3MgX3ByZXZPd25lciwgYWRkcmVzcyBfbmV3T3duZXIpOw0KDQogICAgLyoqDQogICAgICAgIEBkZXYgY29uc3RydWN0b3INCiAgICAqLw0KICAgIGZ1bmN0aW9uIE93bmVkKCkgew0KICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogICAgfQ0KDQogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBieSB0aGUgb3duZXIgb25seQ0KICAgIG1vZGlmaWVyIG93bmVyT25seSB7DQogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IG93bmVyKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBhbGxvd3MgdHJhbnNmZXJyaW5nIHRoZSBjb250cmFjdCBvd25lcnNoaXANCiAgICAgICAgdGhlIG5ldyBvd25lciBzdGlsbCBuZWVkIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXINCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcg0KDQogICAgICAgIEBwYXJhbSBfbmV3T3duZXIgICAgbmV3IGNvbnRyYWN0IG93bmVyDQogICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG93bmVyT25seSB7DQogICAgICAgIHJlcXVpcmUoX25ld093bmVyICE9IG93bmVyKTsNCiAgICAgICAgbmV3T3duZXIgPSBfbmV3T3duZXI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgdXNlZCBieSBhIG5ldyBvd25lciB0byBhY2NlcHQgYW4gb3duZXJzaGlwIHRyYW5zZmVyDQogICAgKi8NCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBwdWJsaWMgew0KICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbmV3T3duZXIpOw0KICAgICAgICBPd25lclVwZGF0ZShvd25lciwgbmV3T3duZXIpOw0KICAgICAgICBvd25lciA9IG5ld093bmVyOw0KICAgICAgICBuZXdPd25lciA9IDB4MDsNCiAgICB9DQp9DQoNCi8qDQogICAgV2UgY29uc2lkZXIgZXZlcnkgY29udHJhY3QgdG8gYmUgYSAndG9rZW4gaG9sZGVyJyBzaW5jZSBpdCdzIGN1cnJlbnRseSBub3QgcG9zc2libGUNCiAgICBmb3IgYSBjb250cmFjdCB0byBkZW55IHJlY2VpdmluZyB0b2tlbnMuDQoNCiAgICBUaGUgVG9rZW5Ib2xkZXIncyBjb250cmFjdCBzb2xlIHB1cnBvc2UgaXMgdG8gcHJvdmlkZSBhIHNhZmV0eSBtZWNoYW5pc20gdGhhdCBhbGxvd3MNCiAgICB0aGUgb3duZXIgdG8gc2VuZCB0b2tlbnMgdGhhdCB3ZXJlIHNlbnQgdG8gdGhlIGNvbnRyYWN0IGJ5IG1pc3Rha2UgYmFjayB0byB0aGVpciBzZW5kZXIuDQoqLw0KY29udHJhY3QgVG9rZW5Ib2xkZXIgaXMgSVRva2VuSG9sZGVyLCBPd25lZCB7DQogICAgLyoqDQogICAgICAgIEBkZXYgY29uc3RydWN0b3INCiAgICAqLw0KICAgIGZ1bmN0aW9uIFRva2VuSG9sZGVyKCkgew0KICAgIH0NCg0KICAgIC8vIHZhbGlkYXRlcyBhbiBhZGRyZXNzIC0gY3VycmVudGx5IG9ubHkgY2hlY2tzIHRoYXQgaXQgaXNuJ3QgbnVsbA0KICAgIG1vZGlmaWVyIHZhbGlkQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSB7DQogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gMHgwKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvLyB2ZXJpZmllcyB0aGF0IHRoZSBhZGRyZXNzIGlzIGRpZmZlcmVudCB0aGFuIHRoaXMgY29udHJhY3QgYWRkcmVzcw0KICAgIG1vZGlmaWVyIG5vdFRoaXMoYWRkcmVzcyBfYWRkcmVzcykgew0KICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3ModGhpcykpOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IHdpdGhkcmF3cyB0b2tlbnMgaGVsZCBieSB0aGUgY29udHJhY3QgYW5kIHNlbmRzIHRoZW0gdG8gYW4gYWNjb3VudA0KICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyDQoNCiAgICAgICAgQHBhcmFtIF90b2tlbiAgIEVSQzIwIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MNCiAgICAgICAgQHBhcmFtIF90byAgICAgIGFjY291bnQgdG8gcmVjZWl2ZSB0aGUgbmV3IGFtb3VudA0KICAgICAgICBAcGFyYW0gX2Ftb3VudCAgYW1vdW50IHRvIHdpdGhkcmF3DQogICAgKi8NCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucyhJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBvd25lck9ubHkNCiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikNCiAgICAgICAgdmFsaWRBZGRyZXNzKF90bykNCiAgICAgICAgbm90VGhpcyhfdG8pDQogICAgew0KICAgICAgICBhc3NlcnQoX3Rva2VuLnRyYW5zZmVyKF90bywgX2Ftb3VudCkpOw0KICAgIH0NCn0NCg0KLyoNCiAgICBTbWFydCBUb2tlbiB2MC4yDQoNCiAgICAnT3duZWQnIGlzIHNwZWNpZmllZCBoZXJlIGZvciByZWFkYWJpbGl0eSByZWFzb25zDQoqLw0KY29udHJhY3QgU21hcnRUb2tlbiBpcyBJU21hcnRUb2tlbiwgRVJDMjBUb2tlbiwgT3duZWQsIFRva2VuSG9sZGVyIHsNCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnMC4yJzsNCg0KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQgPSB0cnVlOyAgICAvLyB0cnVlIGlmIHRyYW5zZmVyL3RyYW5zZmVyRnJvbSBhcmUgZW5hYmxlZCwgZmFsc2UgaWYgbm90DQoNCiAgICAvLyB0cmlnZ2VyZWQgd2hlbiBhIHNtYXJ0IHRva2VuIGlzIGRlcGxveWVkIC0gdGhlIF90b2tlbiBhZGRyZXNzIGlzIGRlZmluZWQgZm9yIGZvcndhcmQgY29tcGF0aWJpbGl0eSwgaW4gY2FzZSB3ZSB3YW50IHRvIHRyaWdnZXIgdGhlIGV2ZW50IGZyb20gYSBmYWN0b3J5DQogICAgZXZlbnQgTmV3U21hcnRUb2tlbihhZGRyZXNzIF90b2tlbik7DQogICAgLy8gdHJpZ2dlcmVkIHdoZW4gdGhlIHRvdGFsIHN1cHBseSBpcyBpbmNyZWFzZWQNCiAgICBldmVudCBJc3N1YW5jZSh1aW50MjU2IF9hbW91bnQpOw0KICAgIC8vIHRyaWdnZXJlZCB3aGVuIHRoZSB0b3RhbCBzdXBwbHkgaXMgZGVjcmVhc2VkDQogICAgZXZlbnQgRGVzdHJ1Y3Rpb24odWludDI1NiBfYW1vdW50KTsNCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGNvbnN0cnVjdG9yDQoNCiAgICAgICAgQHBhcmFtIF9uYW1lICAgICAgIHRva2VuIG5hbWUNCiAgICAgICAgQHBhcmFtIF9zeW1ib2wgICAgIHRva2VuIHNob3J0IHN5bWJvbCwgMS02IGNoYXJhY3RlcnMNCiAgICAgICAgQHBhcmFtIF9kZWNpbWFscyAgIGZvciBkaXNwbGF5IHB1cnBvc2VzIG9ubHkNCiAgICAqLw0KICAgIGZ1bmN0aW9uIFNtYXJ0VG9rZW4oc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludDggX2RlY2ltYWxzKQ0KICAgICAgICBFUkMyMFRva2VuKF9uYW1lLCBfc3ltYm9sLCBfZGVjaW1hbHMpDQogICAgew0KICAgICAgICByZXF1aXJlKGJ5dGVzKF9zeW1ib2wpLmxlbmd0aCA8PSA2KTsgLy8gdmFsaWRhdGUgaW5wdXQNCiAgICAgICAgTmV3U21hcnRUb2tlbihhZGRyZXNzKHRoaXMpKTsNCiAgICB9DQoNCiAgICAvLyBhbGxvd3MgZXhlY3V0aW9uIG9ubHkgd2hlbiB0cmFuc2ZlcnMgYXJlbid0IGRpc2FibGVkDQogICAgbW9kaWZpZXIgdHJhbnNmZXJzQWxsb3dlZCB7DQogICAgICAgIGFzc2VydCh0cmFuc2ZlcnNFbmFibGVkKTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgICAgQGRldiBkaXNhYmxlcy9lbmFibGVzIHRyYW5zZmVycw0KICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyDQoNCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlICAgIHRydWUgdG8gZGlzYWJsZSB0cmFuc2ZlcnMsIGZhbHNlIHRvIGVuYWJsZSB0aGVtDQogICAgKi8NCiAgICBmdW5jdGlvbiBkaXNhYmxlVHJhbnNmZXJzKGJvb2wgX2Rpc2FibGUpIHB1YmxpYyBvd25lck9ubHkgew0KICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gIV9kaXNhYmxlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGluY3JlYXNlcyB0aGUgdG9rZW4gc3VwcGx5IGFuZCBzZW5kcyB0aGUgbmV3IHRva2VucyB0byBhbiBhY2NvdW50DQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXINCg0KICAgICAgICBAcGFyYW0gX3RvICAgICAgICAgYWNjb3VudCB0byByZWNlaXZlIHRoZSBuZXcgYW1vdW50DQogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICBhbW91bnQgdG8gaW5jcmVhc2UgdGhlIHN1cHBseSBieQ0KICAgICovDQogICAgZnVuY3Rpb24gaXNzdWUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkNCiAgICAgICAgcHVibGljDQogICAgICAgIG93bmVyT25seQ0KICAgICAgICB2YWxpZEFkZHJlc3MoX3RvKQ0KICAgICAgICBub3RUaGlzKF90bykNCiAgICB7DQogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgX2Ftb3VudCk7DQogICAgICAgIGJhbGFuY2VPZltfdG9dID0gc2FmZUFkZChiYWxhbmNlT2ZbX3RvXSwgX2Ftb3VudCk7DQoNCiAgICAgICAgSXNzdWFuY2UoX2Ftb3VudCk7DQogICAgICAgIFRyYW5zZmVyKHRoaXMsIF90bywgX2Ftb3VudCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICAgIEBkZXYgcmVtb3ZlcyB0b2tlbnMgZnJvbSBhbiBhY2NvdW50IGFuZCBkZWNyZWFzZXMgdGhlIHRva2VuIHN1cHBseQ0KICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyDQoNCiAgICAgICAgQHBhcmFtIF9mcm9tICAgICAgIGFjY291bnQgdG8gcmVtb3ZlIHRoZSBhbW91bnQgZnJvbQ0KICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgYW1vdW50IHRvIGRlY3JlYXNlIHRoZSBzdXBwbHkgYnkNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGRlc3Ryb3koYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfYW1vdW50KQ0KICAgICAgICBwdWJsaWMNCiAgICAgICAgb3duZXJPbmx5DQogICAgew0KICAgICAgICBiYWxhbmNlT2ZbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlT2ZbX2Zyb21dLCBfYW1vdW50KTsNCiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCBfYW1vdW50KTsNCg0KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgdGhpcywgX2Ftb3VudCk7DQogICAgICAgIERlc3RydWN0aW9uKF9hbW91bnQpOw0KICAgIH0NCg0KICAgIC8vIEVSQzIwIHN0YW5kYXJkIG1ldGhvZCBvdmVycmlkZXMgd2l0aCBzb21lIGV4dHJhIGZ1bmN0aW9uYWxpdHkNCg0KICAgIC8qKg0KICAgICAgICBAZGV2IHNlbmQgY29pbnMNCiAgICAgICAgdGhyb3dzIG9uIGFueSBlcnJvciByYXRoZXIgdGhlbiByZXR1cm4gYSBmYWxzZSBmbGFnIHRvIG1pbmltaXplIHVzZXIgZXJyb3JzDQogICAgICAgIG5vdGUgdGhhdCB3aGVuIHRyYW5zZmVycmluZyB0byB0aGUgc21hcnQgdG9rZW4ncyBhZGRyZXNzLCB0aGUgY29pbnMgYXJlIGFjdHVhbGx5IGRlc3Ryb3llZA0KDQogICAgICAgIEBwYXJhbSBfdG8gICAgICB0YXJnZXQgYWRkcmVzcw0KICAgICAgICBAcGFyYW0gX3ZhbHVlICAgdHJhbnNmZXIgYW1vdW50DQoNCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2UgaWYgaXQgd2Fzbid0DQogICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB0cmFuc2ZlcnNBbGxvd2VkIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBhc3NlcnQoc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpKTsNCg0KICAgICAgICAvLyB0cmFuc2ZlcnJpbmcgdG8gdGhlIGNvbnRyYWN0IGFkZHJlc3MgZGVzdHJveXMgdG9rZW5zDQogICAgICAgIGlmIChfdG8gPT0gYWRkcmVzcyh0aGlzKSkgew0KICAgICAgICAgICAgYmFsYW5jZU9mW190b10gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgdG90YWxTdXBwbHkgLT0gX3ZhbHVlOw0KICAgICAgICAgICAgRGVzdHJ1Y3Rpb24oX3ZhbHVlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAgICBAZGV2IGFuIGFjY291bnQvY29udHJhY3QgYXR0ZW1wdHMgdG8gZ2V0IHRoZSBjb2lucw0KICAgICAgICB0aHJvd3Mgb24gYW55IGVycm9yIHJhdGhlciB0aGVuIHJldHVybiBhIGZhbHNlIGZsYWcgdG8gbWluaW1pemUgdXNlciBlcnJvcnMNCiAgICAgICAgbm90ZSB0aGF0IHdoZW4gdHJhbnNmZXJyaW5nIHRvIHRoZSBzbWFydCB0b2tlbidzIGFkZHJlc3MsIHRoZSBjb2lucyBhcmUgYWN0dWFsbHkgZGVzdHJveWVkDQoNCiAgICAgICAgQHBhcmFtIF9mcm9tICAgIHNvdXJjZSBhZGRyZXNzDQogICAgICAgIEBwYXJhbSBfdG8gICAgICB0YXJnZXQgYWRkcmVzcw0KICAgICAgICBAcGFyYW0gX3ZhbHVlICAgdHJhbnNmZXIgYW1vdW50DQoNCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2UgaWYgaXQgd2Fzbid0DQogICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgdHJhbnNmZXJzQWxsb3dlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgYXNzZXJ0KHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpKTsNCg0KICAgICAgICAvLyB0cmFuc2ZlcnJpbmcgdG8gdGhlIGNvbnRyYWN0IGFkZHJlc3MgZGVzdHJveXMgdG9rZW5zDQogICAgICAgIGlmIChfdG8gPT0gYWRkcmVzcyh0aGlzKSkgew0KICAgICAgICAgICAgYmFsYW5jZU9mW190b10gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgdG90YWxTdXBwbHkgLT0gX3ZhbHVlOw0KICAgICAgICAgICAgRGVzdHJ1Y3Rpb24oX3ZhbHVlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCn0NCg0KLy8vIEB0aXRsZSBPd25hYmxlDQovLy8gQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbCBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcw0KLy8vICYgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4NCmNvbnRyYWN0IE93bmFibGUgew0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyQ2FuZGlkYXRlOw0KDQogICAgZXZlbnQgT3duZXJzaGlwUmVxdWVzdGVkKGFkZHJlc3MgaW5kZXhlZCBfYnksIGFkZHJlc3MgaW5kZXhlZCBfdG8pOw0KICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90byk7DQoNCiAgICAvLy8gQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyIGFjY291bnQuDQogICAgZnVuY3Rpb24gT3duYWJsZSgpIHsNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuDQogICAgbW9kaWZpZXIgb25seU93bmVyKCkgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFByb3Bvc2VzIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXJDYW5kaWRhdGUuDQogICAgLy8vIEBwYXJhbSBfbmV3T3duZXJDYW5kaWRhdGUgYWRkcmVzcyBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uDQogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXJDYW5kaWRhdGUpIG9ubHlPd25lciB7DQogICAgICAgIHJlcXVpcmUoX25ld093bmVyQ2FuZGlkYXRlICE9IGFkZHJlc3MoMCkpOw0KDQogICAgICAgIG5ld093bmVyQ2FuZGlkYXRlID0gX25ld093bmVyQ2FuZGlkYXRlOw0KDQogICAgICAgIE93bmVyc2hpcFJlcXVlc3RlZChtc2cuc2VuZGVyLCBuZXdPd25lckNhbmRpZGF0ZSk7DQogICAgfQ0KDQogICAgLy8vIEBkZXYgQWNjZXB0IG93bmVyc2hpcCB0cmFuc2Zlci4gVGhpcyBtZXRob2QgbmVlZHMgdG8gYmUgY2FsbGVkIGJ5IHRoZSBwZXJ2aW91c2x5IHByb3Bvc2VkIG93bmVyLg0KICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gbmV3T3duZXJDYW5kaWRhdGUpIHsNCiAgICAgICAgICAgIG93bmVyID0gbmV3T3duZXJDYW5kaWRhdGU7DQogICAgICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IGFkZHJlc3MoMCk7DQoNCiAgICAgICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lckNhbmRpZGF0ZSk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vLyBAdGl0bGUgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcw0KbGlicmFyeSBTYWZlck1hdGggew0KICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1Nikgew0KICAgICAgICB1aW50MjU2IGMgPSBhICogYjsNCiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICAgICAgcmV0dXJuIGM7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMA0KICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsNCiAgICAgICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQNCiAgICAgICAgcmV0dXJuIGM7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIGFzc2VydChiIDw9IGEpOw0KICAgICAgICByZXR1cm4gYSAtIGI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOw0KICAgICAgICBhc3NlcnQoYyA+PSBhKTsNCiAgICAgICAgcmV0dXJuIGM7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICAgICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgICAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICAgIH0NCn0NCg0KDQovLy8gQHRpdGxlIFN0b3ggU21hcnQgVG9rZW4NCmNvbnRyYWN0IFN0b3hTbWFydFRva2VuIGlzIFNtYXJ0VG9rZW4gew0KICAgIGZ1bmN0aW9uIFN0b3hTbWFydFRva2VuKCkgU21hcnRUb2tlbignU3RveCcsICdTVFgnLCAxOCkgew0KICAgICAgICBkaXNhYmxlVHJhbnNmZXJzKHRydWUpOw0KICAgIH0NCn0NCg0KDQovLy8gQHRpdGxlIFZlc3RpbmcgdHJ1c3RlZQ0KY29udHJhY3QgVHJ1c3RlZSBpcyBPd25hYmxlIHsNCiAgICB1c2luZyBTYWZlck1hdGggZm9yIHVpbnQyNTY7DQoNCiAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgU1RYIEVSQzIwIHRva2VuLg0KICAgIFN0b3hTbWFydFRva2VuIHB1YmxpYyBzdG94Ow0KDQogICAgc3RydWN0IEdyYW50IHsNCiAgICAgICAgdWludDI1NiB2YWx1ZTsNCiAgICAgICAgdWludDI1NiBzdGFydDsNCiAgICAgICAgdWludDI1NiBjbGlmZjsNCiAgICAgICAgdWludDI1NiBlbmQ7DQogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJyZWQ7DQogICAgICAgIGJvb2wgcmV2b2thYmxlOw0KICAgIH0NCg0KICAgIC8vIEdyYW50cyBob2xkZXIuDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBHcmFudCkgcHVibGljIGdyYW50czsNCg0KICAgIC8vIFRvdGFsIHRva2VucyBhdmFpbGFibGUgZm9yIHZlc3RpbmcuDQogICAgdWludDI1NiBwdWJsaWMgdG90YWxWZXN0aW5nOw0KDQogICAgZXZlbnQgTmV3R3JhbnQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7DQogICAgZXZlbnQgVW5sb2NrR3JhbnQoYWRkcmVzcyBpbmRleGVkIF9ob2xkZXIsIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBSZXZva2VHcmFudChhZGRyZXNzIGluZGV4ZWQgX2hvbGRlciwgdWludDI1NiBfcmVmdW5kKTsNCg0KICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIHRoYXQgaW5pdGlhbGl6ZXMgdGhlIGFkZHJlc3Mgb2YgdGhlIFN0b3hTbWFydFRva2VuIGNvbnRyYWN0Lg0KICAgIC8vLyBAcGFyYW0gX3N0b3ggU3RveFNtYXJ0VG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHByZXZpb3VzbHkgZGVwbG95ZWQgU3RveFNtYXJ0VG9rZW4gc21hcnQgY29udHJhY3QuDQogICAgZnVuY3Rpb24gVHJ1c3RlZShTdG94U21hcnRUb2tlbiBfc3RveCkgew0KICAgICAgICByZXF1aXJlKF9zdG94ICE9IGFkZHJlc3MoMCkpOw0KDQogICAgICAgIHN0b3ggPSBfc3RveDsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBHcmFudCB0b2tlbnMgdG8gYSBzcGVjaWZpZWQgYWRkcmVzcy4NCiAgICAvLy8gQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIGdyYW50IHRva2VucyB0by4NCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuDQogICAgLy8vIEBwYXJhbSBfc3RhcnQgdWludDI1NiBUaGUgYmVnaW5uaW5nIG9mIHRoZSB2ZXN0aW5nIHBlcmlvZC4NCiAgICAvLy8gQHBhcmFtIF9jbGlmZiB1aW50MjU2IER1cmF0aW9uIG9mIHRoZSBjbGlmZiBwZXJpb2QuDQogICAgLy8vIEBwYXJhbSBfZW5kIHVpbnQyNTYgVGhlIGVuZCBvZiB0aGUgdmVzdGluZyBwZXJpb2QuDQogICAgLy8vIEBwYXJhbSBfcmV2b2thYmxlIGJvb2wgV2hldGhlciB0aGUgZ3JhbnQgaXMgcmV2b2thYmxlIG9yIG5vdC4NCiAgICBmdW5jdGlvbiBncmFudChhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX3N0YXJ0LCB1aW50MjU2IF9jbGlmZiwgdWludDI1NiBfZW5kLCBib29sIF9yZXZva2FibGUpDQogICAgICAgIHB1YmxpYyBvbmx5T3duZXIgew0KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsNCiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsNCg0KICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBhIHNpbmdsZSBhZGRyZXNzIGNhbiBiZSBncmFudGVkIHRva2VucyBvbmx5IG9uY2UuDQogICAgICAgIHJlcXVpcmUoZ3JhbnRzW190b10udmFsdWUgPT0gMCk7DQoNCiAgICAgICAgLy8gQ2hlY2sgZm9yIGRhdGUgaW5jb25zaXN0ZW5jaWVzIHRoYXQgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgYmVoYXZpb3IuDQogICAgICAgIHJlcXVpcmUoX3N0YXJ0IDw9IF9jbGlmZiAmJiBfY2xpZmYgPD0gX2VuZCk7DQoNCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGlzIGdyYW50IGRvZXNuJ3QgZXhjZWVkIHRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGN1cnJlbnRseSBhdmFpbGFibGUgZm9yIHZlc3RpbmcuDQogICAgICAgIHJlcXVpcmUodG90YWxWZXN0aW5nLmFkZChfdmFsdWUpIDw9IHN0b3guYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpKTsNCg0KICAgICAgICAvLyBBc3NpZ24gYSBuZXcgZ3JhbnQuDQogICAgICAgIGdyYW50c1tfdG9dID0gR3JhbnQoew0KICAgICAgICAgICAgdmFsdWU6IF92YWx1ZSwNCiAgICAgICAgICAgIHN0YXJ0OiBfc3RhcnQsDQogICAgICAgICAgICBjbGlmZjogX2NsaWZmLA0KICAgICAgICAgICAgZW5kOiBfZW5kLA0KICAgICAgICAgICAgdHJhbnNmZXJyZWQ6IDAsDQogICAgICAgICAgICByZXZva2FibGU6IF9yZXZva2FibGUNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gVG9rZW5zIGdyYW50ZWQsIHJlZHVjZSB0aGUgdG90YWwgYW1vdW50IGF2YWlsYWJsZSBmb3IgdmVzdGluZy4NCiAgICAgICAgdG90YWxWZXN0aW5nID0gdG90YWxWZXN0aW5nLmFkZChfdmFsdWUpOw0KDQogICAgICAgIE5ld0dyYW50KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBSZXZva2UgdGhlIGdyYW50IG9mIHRva2VucyBvZiBhIHNwZWNpZmVkIGFkZHJlc3MuDQogICAgLy8vIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuDQogICAgZnVuY3Rpb24gcmV2b2tlKGFkZHJlc3MgX2hvbGRlcikgcHVibGljIG9ubHlPd25lciB7DQogICAgICAgIEdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdOw0KDQogICAgICAgIHJlcXVpcmUoZ3JhbnQucmV2b2thYmxlKTsNCg0KICAgICAgICAvLyBTZW5kIHRoZSByZW1haW5pbmcgU1RYIGJhY2sgdG8gdGhlIG93bmVyLg0KICAgICAgICB1aW50MjU2IHJlZnVuZCA9IGdyYW50LnZhbHVlLnN1YihncmFudC50cmFuc2ZlcnJlZCk7DQoNCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBncmFudC4NCiAgICAgICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXTsNCg0KICAgICAgICB0b3RhbFZlc3RpbmcgPSB0b3RhbFZlc3Rpbmcuc3ViKHJlZnVuZCk7DQogICAgICAgIHN0b3gudHJhbnNmZXIobXNnLnNlbmRlciwgcmVmdW5kKTsNCg0KICAgICAgICBSZXZva2VHcmFudChfaG9sZGVyLCByZWZ1bmQpOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgdG90YWwgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgb2YgYSBob2xkZXIgYXQgYSBnaXZlbiB0aW1lLg0KICAgIC8vLyBAcGFyYW0gX2hvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIuDQogICAgLy8vIEBwYXJhbSBfdGltZSB1aW50MjU2IFRoZSBzcGVjaWZpYyB0aW1lLg0KICAgIC8vLyBAcmV0dXJuIGEgdWludDI1NiByZXByZXNlbnRpbmcgYSBob2xkZXIncyB0b3RhbCBhbW91bnQgb2YgdmVzdGVkIHRva2Vucy4NCiAgICBmdW5jdGlvbiB2ZXN0ZWRUb2tlbnMoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF90aW1lKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgICAgICBHcmFudCBncmFudCA9IGdyYW50c1tfaG9sZGVyXTsNCiAgICAgICAgaWYgKGdyYW50LnZhbHVlID09IDApIHsNCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGNhbGN1bGF0ZVZlc3RlZFRva2VucyhncmFudCwgX3RpbWUpOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IENhbGN1bGF0ZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmMgdGltZS4NCiAgICAvLy8gQHBhcmFtIF9ncmFudCBHcmFudCBUaGUgdmVzdGluZyBncmFudC4NCiAgICAvLy8gQHBhcmFtIF90aW1lIHVpbnQyNTYgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZA0KICAgIC8vLyBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50Lg0KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgXy8tLS0tLS0tLSAgIHZlc3RlZFRva2VucyByZWN0DQogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8NCiAgICAvLy8gICB8ICAgICAgICAgICAgICAgICAgICAgXy8NCiAgICAvLy8gICB8ICAgICAgICAgICAgICAgICAgIF8vDQogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgXy8NCiAgICAvLy8gICB8ICAgICAgICAgICAgICAgIC8NCiAgICAvLy8gICB8ICAgICAgICAgICAgICAufA0KICAgIC8vLyAgIHwgICAgICAgICAgICAuICB8DQogICAgLy8vICAgfCAgICAgICAgICAuICAgIHwNCiAgICAvLy8gICB8ICAgICAgICAuICAgICAgfA0KICAgIC8vLyAgIHwgICAgICAuICAgICAgICB8DQogICAgLy8vICAgfCAgICAuICAgICAgICAgIHwNCiAgICAvLy8gICArPT09Kz09PT09PT09PT09Ky0tLS0tLS0tLSstLS0tLS0tLS0tPiB0aW1lDQogICAgLy8vICAgICBTdGFydCAgICAgICBDbGlmZiAgICAgIEVuZA0KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucyhHcmFudCBfZ3JhbnQsIHVpbnQyNTYgX3RpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgICAgICAvLyBJZiB3ZSdyZSBiZWZvcmUgdGhlIGNsaWZmLCB0aGVuIG5vdGhpbmcgaXMgdmVzdGVkLg0KICAgICAgICBpZiAoX3RpbWUgPCBfZ3JhbnQuY2xpZmYpIHsNCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gSWYgd2UncmUgYWZ0ZXIgdGhlIGVuZCBvZiB0aGUgdmVzdGluZyBwZXJpb2QgLSBldmVyeXRoaW5nIGlzIHZlc3RlZDsNCiAgICAgICAgaWYgKF90aW1lID49IF9ncmFudC5lbmQpIHsNCiAgICAgICAgICAgIHJldHVybiBfZ3JhbnQudmFsdWU7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBJbnRlcnBvbGF0ZSBhbGwgdmVzdGVkIHRva2VuczogdmVzdGVkVG9rZW5zID0gdG9rZW5zLy8vICh0aW1lIC0gc3RhcnQpIC8gKGVuZCAtIHN0YXJ0KQ0KICAgICAgICAgcmV0dXJuIF9ncmFudC52YWx1ZS5tdWwoX3RpbWUuc3ViKF9ncmFudC5zdGFydCkpLmRpdihfZ3JhbnQuZW5kLnN1YihfZ3JhbnQuc3RhcnQpKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBVbmxvY2sgdmVzdGVkIHRva2VucyBhbmQgdHJhbnNmZXIgdGhlbSB0byB0aGVpciBob2xkZXIuDQogICAgLy8vIEByZXR1cm4gYSB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gdGhlaXIgaG9sZGVyLg0KICAgIGZ1bmN0aW9uIHVubG9ja1Zlc3RlZFRva2VucygpIHB1YmxpYyB7DQogICAgICAgIEdyYW50IGdyYW50ID0gZ3JhbnRzW21zZy5zZW5kZXJdOw0KICAgICAgICByZXF1aXJlKGdyYW50LnZhbHVlICE9IDApOw0KDQogICAgICAgIC8vIEdldCB0aGUgdG90YWwgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMsIGFjY2NvcmRpbmcgdG8gZ3JhbnQuDQogICAgICAgIHVpbnQyNTYgdmVzdGVkID0gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKGdyYW50LCBub3cpOw0KICAgICAgICBpZiAodmVzdGVkID09IDApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgaG9sZGVyIGRvZXNuJ3QgdHJhbnNmZXIgbW9yZSB0aGFuIHdoYXQgaGUgYWxyZWFkeSBoYXMuDQogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJhYmxlID0gdmVzdGVkLnN1YihncmFudC50cmFuc2ZlcnJlZCk7DQogICAgICAgIGlmICh0cmFuc2ZlcmFibGUgPT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgZ3JhbnQudHJhbnNmZXJyZWQgPSBncmFudC50cmFuc2ZlcnJlZC5hZGQodHJhbnNmZXJhYmxlKTsNCiAgICAgICAgdG90YWxWZXN0aW5nID0gdG90YWxWZXN0aW5nLnN1Yih0cmFuc2ZlcmFibGUpOw0KICAgICAgICBzdG94LnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRyYW5zZmVyYWJsZSk7DQoNCiAgICAgICAgVW5sb2NrR3JhbnQobXNnLnNlbmRlciwgdHJhbnNmZXJhYmxlKTsNCiAgICB9DQp9DQoNCg0KLy8vIEB0aXRsZSBTdG94IFNtYXJ0IFRva2VuIHNhbGUNCmNvbnRyYWN0IFN0b3hTbWFydFRva2VuU2FsZSBpcyBPd25hYmxlIHsNCiAgICB1c2luZyBTYWZlck1hdGggZm9yIHVpbnQyNTY7DQoNCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBEVVJBVElPTiA9IDE0IGRheXM7DQoNCiAgICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZCA9IGZhbHNlOw0KICAgIGJvb2wgcHVibGljIGlzRGlzdHJpYnV0ZWQgPSBmYWxzZTsNCg0KICAgIC8vIFRoZSBhZGRyZXNzIG9mIHRoZSBTVFggRVJDMjAgdG9rZW4uDQogICAgU3RveFNtYXJ0VG9rZW4gcHVibGljIHN0b3g7DQoNCiAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gYWxsb2NhdGlvbiB0cnVzdGVlOw0KICAgIFRydXN0ZWUgcHVibGljIHRydXN0ZWU7DQoNCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWUgPSAwOw0KICAgIHVpbnQyNTYgcHVibGljIGVuZFRpbWUgPSAwOw0KICAgIGFkZHJlc3MgcHVibGljIGZ1bmRpbmdSZWNpcGllbnQ7DQoNCiAgICB1aW50MjU2IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsNCg0KICAgIC8vIFRPRE86IHVwZGF0ZSB0byB0aGUgY29ycmVjdCB2YWx1ZXMuDQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgRVRIX0NBUCA9IDE0ODAwMDsNCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBFWENIQU5HRV9SQVRFID0gMjAwOyAvLyAyMDAgU1RYIGZvciBFVEgNCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9TQUxFX0NBUCA9IEVUSF9DQVAgKiBFWENIQU5HRV9SQVRFICogMTAgKiogMTg7DQoNCiAgICBldmVudCBUb2tlbnNJc3N1ZWQoYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdG9rZW5zKTsNCg0KICAgIC8vLyBAZGV2IFRocm93cyBpZiBjYWxsZWQgd2hlbiBub3QgZHVyaW5nIHNhbGUuDQogICAgbW9kaWZpZXIgb25seUR1cmluZ1NhbGUoKSB7DQogICAgICAgIGlmICh0b2tlbnNTb2xkID49IFRPS0VOX1NBTEVfQ0FQIHx8IG5vdyA8IHN0YXJ0VGltZSB8fCBub3cgPj0gZW5kVGltZSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IFRocm93cyBpZiBjYWxsZWQgYmVmb3JlIHNhbGUgZW5kcy4NCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJTYWxlKCkgew0KICAgICAgICBpZiAoISh0b2tlbnNTb2xkID49IFRPS0VOX1NBTEVfQ0FQIHx8IG5vdyA+PSBlbmRUaW1lKSkgew0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgIH0NCg0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIHRoYXQgaW5pdGlhbGl6ZXMgdGhlIHNhbGUgY29uZGl0aW9ucy4NCiAgICAvLy8gQHBhcmFtIF9mdW5kaW5nUmVjaXBpZW50IGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGZ1bmRpbmcgcmVjaXBpZW50Lg0KICAgIC8vLyBAcGFyYW0gX3N0YXJ0VGltZSB1aW50MjU2IFRoZSBzdGFydCB0aW1lIG9mIHRoZSB0b2tlbiBzYWxlLg0KICAgIGZ1bmN0aW9uIFN0b3hTbWFydFRva2VuU2FsZShhZGRyZXNzIF9zdG94LCBhZGRyZXNzIF9mdW5kaW5nUmVjaXBpZW50LCB1aW50MjU2IF9zdGFydFRpbWUpIHsNCiAgICAgICAgcmVxdWlyZShfc3RveCAhPSBhZGRyZXNzKDApKTsNCiAgICAgICAgcmVxdWlyZShfZnVuZGluZ1JlY2lwaWVudCAhPSBhZGRyZXNzKDApKTsNCiAgICAgICAgcmVxdWlyZShfc3RhcnRUaW1lID4gbm93KTsNCg0KICAgICAgICBzdG94ID0gU3RveFNtYXJ0VG9rZW4oX3N0b3gpOw0KDQogICAgICAgIGZ1bmRpbmdSZWNpcGllbnQgPSBfZnVuZGluZ1JlY2lwaWVudDsNCiAgICAgICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsNCiAgICAgICAgZW5kVGltZSA9IHN0YXJ0VGltZSArIERVUkFUSU9OOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IERpc3RyaWJ1dGVkIHRva2VucyB0byB0aGUgcGFydG5lcnMgd2hvIGhhdmUgcGFydGljaXBhdGVkIGR1cmluZyB0aGUgcHJlLXNhbGUuDQogICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVBhcnRuZXJUb2tlbnMoKSBleHRlcm5hbCBvbmx5T3duZXIgew0KICAgICAgICByZXF1aXJlKCFpc0Rpc3RyaWJ1dGVkKTsNCg0KICAgICAgICBhc3NlcnQodG9rZW5zU29sZCA9PSAwKTsNCiAgICAgICAgYXNzZXJ0KHN0b3gudG90YWxTdXBwbHkoKSA9PSAwKTsNCg0KICAgICAgICAvLyBEaXN0cmlidXRlIHN0cmF0ZWdpYyB0b2tlbnMgdG8gcGFydG5lcnMuIFBsZWFzZSBub3RlLCB0aGF0IHRoaXMgYWRkcmVzcyBkb2Vzbid0IHJlcHJlc2VudCBhIHNpbmdsZSBlbnRpdHkgb3INCiAgICAgICAgLy8gcGVyc29uIGFuZCB3aWxsIGJlIG9ubHkgdXNlZCB0byBkaXN0cmlidXRlIHRva2VucyB0byAzMH4gcGFydG5lcnMuDQogICAgICAgIC8vDQogICAgICAgIC8vIFBsZWFzZSBleHBlY3QgdG8gc2VlIHRva2VuIHRyYW5zZmVycyBmcm9tIHRoaXMgYWRkcmVzcyBpbiB0aGUgZmlyc3QgMjQgaG91cnMgYWZ0ZXIgdGhlIHRva2VuIHNhbGUgZW5kcy4NCiAgICAgICAgaXNzdWVUb2tlbnMoMHg5MDY1MjYwZWY2ODMwZjYzNzJGMUJkZTQwOERlQzU3RmUzMTUwNTMwLCAxNDgwMDAwMCAqIDEwICoqIDE4KTsNCg0KICAgICAgICBpc0Rpc3RyaWJ1dGVkID0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBGaW5hbGl6ZXMgdGhlIHRva2VuIHNhbGUgZXZlbnQuDQogICAgZnVuY3Rpb24gZmluYWxpemUoKSBleHRlcm5hbCBvbmx5QWZ0ZXJTYWxlIHsNCiAgICAgICAgaWYgKGlzRmluYWxpemVkKSB7DQogICAgICAgICAgICB0aHJvdzsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEdyYW50IHZlc3RpbmcgZ3JhbnRzLg0KICAgICAgICAvLw0KICAgICAgICAvLyBUT0RPOiB1c2UgcmVhbCBhZGRyZXNzZXMuDQogICAgICAgIHRydXN0ZWUgPSBuZXcgVHJ1c3RlZShzdG94KTsNCg0KICAgICAgICAvLyBTaW5jZSBvbmx5IDUwJSBvZiB0aGUgdG9rZW5zIHdpbGwgYmUgc29sZCwgd2Ugd2lsbCBhdXRvbWF0aWNhbGx5IGlzc3VlIHRoZSBzYW1lIGFtb3VudCBvZiBzb2xkIFNUWCB0byB0aGUNCiAgICAgICAgLy8gdHJ1c3RlZS4NCiAgICAgICAgdWludDI1NiB1bnNvbGRUb2tlbnMgPSB0b2tlbnNTb2xkOw0KDQogICAgICAgIC8vIElzc3VlIDU1JSBvZiB0aGUgcmVtYWluaW5nIHRva2VucyAoPT0gMjcuNSUpIGdvIHRvIHN0cmF0ZWdpYyBwYXJ0ZXJuc2hpcHMuDQogICAgICAgIHVpbnQyNTYgc3RyYXRlZ2ljUGFydG5lcnNoaXBUb2tlbnMgPSB1bnNvbGRUb2tlbnMubXVsKDU1KS5kaXYoMTAwKTsNCg0KICAgICAgICAvLyBOb3RlOiB3ZSB3aWxsIHN1YnN0cmFjdCB0aGUgYm9udXMgdG9rZW5zIGZyb20gdGhpcyBncmFudCwgc2luY2UgdGhleSB3ZXJlIGFscmVhZHkgaXNzdWVkIGZvciB0aGUgcHJlLXNhbGUNCiAgICAgICAgLy8gc3RyYXRlZ2ljIHBhcnRuZXJzIGFuZCBzaG91bGQndmUgYmVlbiB0YWtlbiBmcm9tIHRoaXMgYWxsb2NhdGlvbi4NCiAgICAgICAgc3RveC5pc3N1ZSgweGJDMTQxMDVjY0RkZUFhZEI5NkJhOGRDRTE4YjQwQzQ1YjZiQUNmNTgsIHN0cmF0ZWdpY1BhcnRuZXJzaGlwVG9rZW5zKTsNCg0KICAgICAgICAvLyBJc3N1ZSB0aGUgcmVtYWluaW5nIHRva2VucyBhcyB2ZXN0aW5nIGdyYW50czoNCiAgICAgICAgc3RveC5pc3N1ZSh0cnVzdGVlLCB1bnNvbGRUb2tlbnMuc3ViKHN0cmF0ZWdpY1BhcnRuZXJzaGlwVG9rZW5zKSk7DQoNCiAgICAgICAgLy8gMjUlIG9mIHRoZSByZW1haW5pbmcgdG9rZW5zICg9PSAxMi41JSkgZ28gdG8gSW52ZXN0LmNvbSwgYXQgdW5pZm9ybSAxMiBtb250aHMgdmVzdGluZyBzY2hlZHVsZS4NCiAgICAgICAgdHJ1c3RlZS5ncmFudCgweGI1NGM2YTg3MGQ0YUQ2NWUyM2Q0NzFGYjc5NDFhRDI3MUQzMjNmNUUsIHVuc29sZFRva2Vucy5tdWwoMjUpLmRpdigxMDApLCBub3csIG5vdywNCiAgICAgICAgICAgIG5vdy5hZGQoMSB5ZWFycyksIHRydWUpOw0KDQogICAgICAgIC8vIDIwJSBvZiB0aGUgcmVtYWluaW5nIHRva2VucyAoPT0gMTAlKSBnbyB0byBTdG94IHRlYW0sIGF0IHVuaWZvcm0gMjQgbW9udGhzIHZlc3Rpbmcgc2NoZWR1bGUuDQogICAgICAgIHRydXN0ZWUuZ3JhbnQoMHg0ZUI0Q2QxRDEyNWQ5ZDI4MTcwOUZmMzhkNjViOTlhNjkyN2I0NmMxLCB1bnNvbGRUb2tlbnMubXVsKDIwKS5kaXYoMTAwKSwgbm93LCBub3csDQogICAgICAgICAgICBub3cuYWRkKDIgeWVhcnMpLCB0cnVlKTsNCg0KICAgICAgICAvLyBSZS1lbmFibGUgdHJhbnNmZXJzIGFmdGVyIHRoZSB0b2tlbiBzYWxlLg0KICAgICAgICBzdG94LmRpc2FibGVUcmFuc2ZlcnMoZmFsc2UpOw0KDQogICAgICAgIGlzRmluYWxpemVkID0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBDcmVhdGUgYW5kIHNlbGwgdG9rZW5zIHRvIHRoZSBjYWxsZXIuDQogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudC4NCiAgICBmdW5jdGlvbiBjcmVhdGUoYWRkcmVzcyBfcmVjaXBpZW50KSBwdWJsaWMgcGF5YWJsZSBvbmx5RHVyaW5nU2FsZSB7DQogICAgICAgIHJlcXVpcmUoX3JlY2lwaWVudCAhPSBhZGRyZXNzKDApKTsNCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsNCg0KICAgICAgICBhc3NlcnQoaXNEaXN0cmlidXRlZCk7DQoNCiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBTYWZlck1hdGgubWluMjU2KG1zZy52YWx1ZS5tdWwoRVhDSEFOR0VfUkFURSksIFRPS0VOX1NBTEVfQ0FQLnN1Yih0b2tlbnNTb2xkKSk7DQogICAgICAgIHVpbnQyNTYgY29udHJpYnV0aW9uID0gdG9rZW5zLmRpdihFWENIQU5HRV9SQVRFKTsNCg0KICAgICAgICBpc3N1ZVRva2VucyhfcmVjaXBpZW50LCB0b2tlbnMpOw0KDQogICAgICAgIC8vIFRyYW5zZmVyIHRoZSBmdW5kcyB0byB0aGUgZnVuZGluZyByZWNpcGllbnQuDQogICAgICAgIGZ1bmRpbmdSZWNpcGllbnQudHJhbnNmZXIoY29udHJpYnV0aW9uKTsNCg0KICAgICAgICAvLyBSZWZ1bmQgdGhlIG1zZy5zZW5kZXIsIGluIHRoZSBjYXNlIHRoYXQgbm90IGFsbCBvZiBpdHMgRVRIIHdhcyB1c2VkLiBUaGlzIGNhbiBoYXBwZW4gb25seSB3aGVuIHNlbGxpbmcgdGhlDQogICAgICAgIC8vIGxhc3QgY2h1bmsgb2YgU1RYLg0KICAgICAgICB1aW50MjU2IHJlZnVuZCA9IG1zZy52YWx1ZS5zdWIoY29udHJpYnV0aW9uKTsNCiAgICAgICAgaWYgKHJlZnVuZCA+IDApIHsNCiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocmVmdW5kKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vLyBAZGV2IElzc3VlcyB0b2tlbnMgZm9yIHRoZSByZWNpcGllbnQuDQogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudC4NCiAgICAvLy8gQHBhcmFtIF90b2tlbnMgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyB0byBpc3N1ZS4NCiAgICBmdW5jdGlvbiBpc3N1ZVRva2VucyhhZGRyZXNzIF9yZWNpcGllbnQsIHVpbnQyNTYgX3Rva2VucykgcHJpdmF0ZSB7DQogICAgICAgIC8vIFVwZGF0ZSB0b3RhbCBzb2xkIHRva2Vucy4NCiAgICAgICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQuYWRkKF90b2tlbnMpOw0KDQogICAgICAgIHN0b3guaXNzdWUoX3JlY2lwaWVudCwgX3Rva2Vucyk7DQoNCiAgICAgICAgVG9rZW5zSXNzdWVkKF9yZWNpcGllbnQsIF90b2tlbnMpOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgd2lsbCBkZWxlZ2F0ZSB0aGUgcmVxdWVzdCB0byBjcmVhdGUuDQogICAgZnVuY3Rpb24gKCkgZXh0ZXJuYWwgcGF5YWJsZSBvbmx5RHVyaW5nU2FsZSB7DQogICAgICAgIGNyZWF0ZShtc2cuc2VuZGVyKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBQcm9wb3NlcyB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBTdG94U21hcnRUb2tlbiBjb250cmFjdCB0byBhIG5ldyBvd25lci4NCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lckNhbmRpZGF0ZSBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4NCiAgICAvLy8NCiAgICAvLy8gTm90ZSB0aGF0Og0KICAgIC8vLyAgIDEuIFRoZSBuZXcgb3duZXIgd2lsbCBuZWVkIHRvIGNhbGwgU3RveFNtYXJ0VG9rZW4ncyBhY2NlcHRPd25lcnNoaXAgZGlyZWN0bHkgaW4gb3JkZXIgdG8gYWNjZXB0IHRoZSBvd25lcnNoaXAuDQogICAgLy8vICAgMi4gQ2FsbGluZyB0aGlzIG1ldGhvZCBkdXJpbmcgdGhlIHRva2VuIHNhbGUgd2lsbCBwcmV2ZW50IHRoZSB0b2tlbiBzYWxlIHRvIGNvbnRpbnVlLCBzaW5jZSBvbmx5IHRoZSBvd25lciBvZg0KICAgIC8vLyAgICAgIHRoZSBTdG94U21hcnRUb2tlbiBjb250cmFjdCBjYW4gaXNzdWUgbmV3IHRva2Vucy4NCiAgICBmdW5jdGlvbiB0cmFuc2ZlclNtYXJ0VG9rZW5Pd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXJDYW5kaWRhdGUpIGV4dGVybmFsIG9ubHlPd25lciB7DQogICAgICAgIHN0b3gudHJhbnNmZXJPd25lcnNoaXAoX25ld093bmVyQ2FuZGlkYXRlKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBBY2NlcHRzIG5ldyBvd25lcnNoaXAgb24gYmVoYWxmIG9mIHRoZSBTdG94U21hcnRUb2tlbiBjb250cmFjdC4gVGhpcyBjYW4gYmUgdXNlZCwgYnkgdGhlIHRva2VuIHNhbGUNCiAgICAvLy8gY29udHJhY3QgaXRzZWxmIHRvIGNsYWltIGJhY2sgb3duZXJzaGlwIG9mIHRoZSBTdG94U21hcnRUb2tlbiBjb250cmFjdC4NCiAgICBmdW5jdGlvbiBhY2NlcHRTbWFydFRva2VuT3duZXJzaGlwKCkgZXh0ZXJuYWwgb25seU93bmVyIHsNCiAgICAgICAgc3RveC5hY2NlcHRPd25lcnNoaXAoKTsNCiAgICB9DQoNCiAgICAvLy8gQGRldiBQcm9wb3NlcyB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBUcnVzdGVlIGNvbnRyYWN0IHRvIGEgbmV3IG93bmVyLg0KICAgIC8vLyBAcGFyYW0gX25ld093bmVyQ2FuZGlkYXRlIGFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLg0KICAgIC8vLw0KICAgIC8vLyBOb3RlIHRoYXQ6DQogICAgLy8vICAgMS4gVGhlIG5ldyBvd25lciB3aWxsIG5lZWQgdG8gY2FsbCBUcnVzdGVlJ3MgYWNjZXB0T3duZXJzaGlwIGRpcmVjdGx5IGluIG9yZGVyIHRvIGFjY2VwdCB0aGUgb3duZXJzaGlwLg0KICAgIC8vLyAgIDIuIENhbGxpbmcgdGhpcyBtZXRob2QgZHVyaW5nIHRoZSB0b2tlbiBzYWxlIHdvbid0IGJlIHBvc3NpYmxlLCBhcyB0aGUgVHJ1c3RlZSBpcyBvbmx5IGNyZWF0ZWQgYWZ0ZXIgaXRzDQogICAgLy8vICAgICAgZmluYWxpemF0aW9uLg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyVHJ1c3RlZU93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lckNhbmRpZGF0ZSkgZXh0ZXJuYWwgb25seU93bmVyIHsNCiAgICAgICAgdHJ1c3RlZS50cmFuc2Zlck93bmVyc2hpcChfbmV3T3duZXJDYW5kaWRhdGUpOw0KICAgIH0NCg0KICAgIC8vLyBAZGV2IEFjY2VwdHMgbmV3IG93bmVyc2hpcCBvbiBiZWhhbGYgb2YgdGhlIFRydXN0ZWUgY29udHJhY3QuIFRoaXMgY2FuIGJlIHVzZWQsIGJ5IHRoZSB0b2tlbiBzYWxlDQogICAgLy8vIGNvbnRyYWN0IGl0c2VsZiB0byBjbGFpbSBiYWNrIG93bmVyc2hpcCBvZiB0aGUgVHJ1c3RlZSBjb250cmFjdC4NCiAgICBmdW5jdGlvbiBhY2NlcHRUcnVzdGVlT3duZXJzaGlwKCkgZXh0ZXJuYWwgb25seU93bmVyIHsNCiAgICAgICAgdHJ1c3RlZS5hY2NlcHRPd25lcnNoaXAoKTsNCiAgICB9DQp9'