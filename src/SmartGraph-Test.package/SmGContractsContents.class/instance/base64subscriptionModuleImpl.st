base 64 content
base64subscriptionModuleImpl
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLy8gPT09PSBESVNDTEFJTUVSID09PT0NCi8vDQovLyBFVEhFUkVVTSBJUyBTVElMTCBBTiBFWFBFUkVNRU5UQUwgVEVDSE5PTE9HWS4NCi8vIEFMVEhPVUdIIFRISVMgU01BUlQgQ09OVFJBQ1QgV0FTIENSRUFURUQgV0lUSCBHUkVBVCBDQVJFIEFORCBJTiBUSEUgSE9QRSBPRiBCRUlORyBVU0VGVUwsIE5PIEdVQVJBTlRFRVMgT0YgRkxBV0xFU1MgT1BFUkFUSU9OIENBTiBCRSBHSVZFTi4NCi8vIElOIFBBUlRJQ1VMQVIgLSBTVUJUSUxFIEJVR1MsIEhBQ0tFUiBBVFRBQ0tTIE9SIE1BTEZVTkNUSU9OIE9GIFVOREVSTFlJTkcgVEVDSE5PTE9HWSBDQU4gQ0FVU0UgVU5JTlRFTlRJT05BTCBCRUhBVklPVVIuDQovLyBZT1UgQVJFIFNUUk9OR0xZIEVOQ09VUkFHRUQgVE8gU1RVRFkgVEhJUyBTTUFSVCBDT05UUkFDVCBDQVJFRlVMTFkgSU4gT1JERVIgVE8gVU5ERVJTVEFORCBQT1NTSUJMRSBFREdFIENBU0VTIEFORCBSSVNLUy4NCi8vIERPTidUIFVTRSBUSElTIFNNQVJUIENPTlRSQUNUIElGIFlPVSBIQVZFIFNVQlNUQU5USUFMIERPVUJUUyBPUiBJRiBZT1UgRE9OJ1QgS05PVyBXSEFUIFlPVSBBUkUgRE9JTkcuDQovLw0KLy8gVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQ0KLy8gQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULA0KLy8gSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwNCi8vIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLA0KLy8gT1IgVE9SVCAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4NCi8vID09PT0NCi8vDQoNCi8vLyBAYXV0aG9yIGV0aGVybmlhbiBmb3IgU2FudGltZW50IExMQw0KLy8vIEB0aXRsZSAgU3Vic2NyaXB0aW9uIE1vZHVsZSBmb3IgU0FOIC0gc2FudGltZW50IHRva2VuDQovLy8gQG5vdGljZSByZXBvcnQgYnVncyB0bzogYnVnc0BldGhlcm5pYW4uY29tDQoNCmNvbnRyYWN0IEJhc2Ugew0KDQogICAgZnVuY3Rpb24gbWF4KHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7IHJldHVybiBhID49IGIgPyBhIDogYjsgfQ0KICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgeyByZXR1cm4gYSA8PSBiID8gYSA6IGI7IH0NCg0KICAgIG1vZGlmaWVyIG9ubHkoYWRkcmVzcyBhbGxvd2VkKSB7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGFsbG93ZWQpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KDQogICAgLy8vQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdA0KICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICB1aW50IHNpemU7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIChzaXplID4gMCk7DQogICAgfQ0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgICAgICAgcmVlbnRyYW5jeSBoYW5kbGluZyAgICAgICAgICAgICAgICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICAvL0BkZXYgcHJlZGVmaW5lZCBsb2NrcyAodXAgdG8gdWludCBiaXQgbGVuZ3RoLCBpLmUuIDI1NiBwb3NzaWJsZSkNCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwMCA9IDIgKiogMDsNCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwMSA9IDIgKiogMTsNCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwMiA9IDIgKiogMjsNCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwMyA9IDIgKiogMzsNCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwNCA9IDIgKiogNDsNCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwNSA9IDIgKiogNTsNCg0KICAgIC8vcHJldmVudHMgcmVlbnRyYW5jeSBhdHRhY3M6IHNwZWNpZmljIGxvY2tzDQogICAgdWludCBwcml2YXRlIGJpdGxvY2tzID0gMDsNCiAgICBtb2RpZmllciBub1JlZW50cmFuY3kodWludCBtKSB7DQogICAgICAgIHZhciBfbG9ja3MgPSBiaXRsb2NrczsNCiAgICAgICAgaWYgKF9sb2NrcyAmIG0gPiAwKSB0aHJvdzsNCiAgICAgICAgYml0bG9ja3MgfD0gbTsNCiAgICAgICAgXzsNCiAgICAgICAgYml0bG9ja3MgPSBfbG9ja3M7DQogICAgfQ0KDQogICAgbW9kaWZpZXIgbm9BbnlSZWVudHJhbmN5IHsNCiAgICAgICAgdmFyIF9sb2NrcyA9IGJpdGxvY2tzOw0KICAgICAgICBpZiAoX2xvY2tzID4gMCkgdGhyb3c7DQogICAgICAgIGJpdGxvY2tzID0gdWludCgtMSk7DQogICAgICAgIF87DQogICAgICAgIGJpdGxvY2tzID0gX2xvY2tzOw0KICAgIH0NCg0KICAgIC8vL0BkZXYgZW1wdHkgbWFya2luZyBtb2RpZmllciBzaWduYWxpbmcgdG8gdXNlciBvZiB0aGUgbWFya2VkIGZ1bmN0aW9uICwgdGhhdCBpdCBjYW4gY2F1c2UgYW4gcmVlbnRyYW50IGNhbGwuDQogICAgLy8vICAgICBkZXZlbG9wZXIgc2hvdWxkIG1ha2UgdGhlIGNhbGxlciBmdW5jdGlvbiByZWVudHJhbnQtc2FmZSBpZiBpdCB1c2UgYSByZWVudHJhbnQgZnVuY3Rpb24uDQogICAgbW9kaWZpZXIgcmVlbnRyYW50IHsgXzsgfQ0KDQp9DQoNCmNvbnRyYWN0IE93bmVkIGlzIEJhc2Ugew0KDQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7DQogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXI7DQoNCiAgICBmdW5jdGlvbiBPd25lZCgpIHsNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBvbmx5KG93bmVyKSB7DQogICAgICAgIG5ld093bmVyID0gX25ld093bmVyOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIG9ubHkobmV3T3duZXIpIHsNCiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsNCiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsNCiAgICB9DQoNCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8pOw0KDQp9DQoNCg0KY29udHJhY3QgRVJDMjAgaXMgT3duZWQgew0KDQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7DQogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7DQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGlzU3RhcnRlZE9ubHkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsNCiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IF92YWx1ZTsNCiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOw0KICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSB7IHJldHVybiBmYWxzZTsgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGlzU3RhcnRlZE9ubHkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgew0KICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7DQogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgew0KICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsNCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsNCiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogICAgfQ0KDQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7DQoNCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsNCiAgICBib29sICAgIHB1YmxpYyBpc1N0YXJ0ZWQgPSBmYWxzZTsNCg0KICAgIG1vZGlmaWVyIG9ubHlIb2xkZXIoYWRkcmVzcyBob2xkZXIpIHsNCiAgICAgICAgaWYgKGJhbGFuY2VPZihob2xkZXIpID09IDApIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIGlzU3RhcnRlZE9ubHkoKSB7DQogICAgICAgIGlmICghaXNTdGFydGVkKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCn0NCg0KLy9EZWNpc2lvbiBtYWRlLg0KLy8gMSAtIFByb3ZpZGVyIGlzIHNvbGVseSByZXNwb25zaWJsZSB0byBjb25zaWRlciBmYWlsZWQgc3ViIGNoYXJnZSBhcyBhbiBlcnJvciBhbmQgc3RvcCB0aGUgc2VydmljZSwNCi8vICAgIHRoZXJlZm9yZSB0aGVyZSBpcyBubyBzZXBhcmF0ZSBlcnJvciBzdGF0ZSBvciBjb3VudGVyIGZvciB0aGF0IGluIHRoaXMgVG9rZW4gQ29udHJhY3QuDQovLw0KLy8gMiAtIEEgY2FsbCBvcmlnaW5hdGVkIGZyb20gdGhlIHVzZXIgKGlzQ29udHJhY3QobXNnLnNlbmRlcik9PWZhbHNlKSBzaG91bGQgdGhyb3cgYW4gZXhjZXB0aW9uIG9uIGVycm9yLA0KLy8gICAgIGJ1dCBpdCBzaG91bGQgcmV0dXJuICJmYWxzZSIgb24gZXJyb3IgaWYgY2FsbGVkIGZyb20gb3RoZXIgY29udHJhY3QgKGlzQ29udHJhY3QobXNnLnNlbmRlcik9PXRydWUpLg0KLy8gICAgIFJlYXNvbjogdGhyb3duIGV4Y2VwdGlvbiBhcmUgZWFzaWVyIHRvIHNlZSBpbiB3YWxsZXRzLCByZXR1cm5lZCBib29sZWFuIHZhbHVlcyBhcmUgZWFzaWVyIHRvIGV2YWx1YXRlIGluIHRoZSBjb2RlIG9mIHRoZSBjYWxsaW5nIGNvbnRyYWN0Lg0KLy8NCi8vIDMgLSBTZXJ2aWNlIHByb3ZpZGVycyBhcmUgcmVzcG9uc2libGUgZm9yIGZpcmluZyBldmVudHMgaW4gY2FzZSBvZiBvZmZlciBjaGFuZ2VzOw0KLy8gICAgIGl0IGlzIHRoZWlycyBkZWNpc2lvbiB0byBpbmZvcm0gREFwcHMgYWJvdXQgb2ZmZXIgY2hhbmdlcyBvciBub3QuDQovLw0KDQoNCi8vL0BkZXYgYW4gYmFzZSBjbGFzcyB0byBpbXBsZW1lbnQgYnkgU2VydmljZSBQcm92aWRlciBjb250cmFjdCB0byBiZSBub3RpZmllZCBhYm91dCBzdWJzY3JpcHRpb24gY2hhbmdlcyAoaW4tVHggbm90aWZpY2F0aW9uKS4NCi8vLyAgICAgQWRkaXRpb25hbGx5IGl0IGNvbnRhaW5zIHN0YW5kYXJkIGV2ZW50cyB0byBiZSBmaXJlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIG9uIG9mZmVyIGNoYW5nZXMuDQovLy8gICAgIHNlZSBhbHNlIEVWTSBldmVudHMgbG9nZ2VkIGJ5IHN1YnNjcmlwdGlvbiBtb2R1bGUuDQovLw0KY29udHJhY3QgU2VydmljZVByb3ZpZGVyIHsNCg0KICAgIC8vL0BkZXYgZ2V0IGh1bWFuIHJlYWRhYmxlIGRlc2NyaXB0b3IgKG9yIHVybCkgZm9yIHRoaXMgU2VydmljZSBwcm92aWRlcg0KICAgIC8vDQogICAgZnVuY3Rpb24gaW5mbygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHN0cmluZyk7DQoNCiAgICAvLy9AZGV2IGNhbGxlZCB0byBwb3N0LWFwcHJvdmUvcmVqZWN0IGluY29taW5nIHNpbmdsZSBwYXltZW50Lg0KICAgIC8vL0ByZXR1cm4gYGZhbHNlYCBjYXVzZXMgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnRzIHRoZSBwYXltZW50Lg0KICAgIC8vDQogICAgZnVuY3Rpb24gb25QYXltZW50KGFkZHJlc3MgX2Zyb20sIHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEpIHB1YmxpYyByZXR1cm5zIChib29sKTsNCg0KICAgIC8vL0BkZXYgY2FsbGVkIHRvIHBvc3QtYXBwcm92ZS9yZWplY3Qgc3Vic2NyaXB0aW9uIGNoYXJnZS4NCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgb3BlcmF0aW9uLg0KICAgIC8vDQogICAgZnVuY3Rpb24gb25TdWJFeGVjdXRlZCh1aW50IHN1YklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy9AZGV2IGNhbGxlZCB0byBwb3N0LWFwcHJvdmUvcmVqZWN0IGEgY3JlYXRpb24gb2YgdGhlIHN1YnNjcmlwdGlvbi4NCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgb3BlcmF0aW9uLg0KICAgIC8vDQogICAgZnVuY3Rpb24gb25TdWJOZXcodWludCBuZXdTdWJJZCwgdWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy9AZGV2IGNhbGxlZCB0byBub3RpZnkgc2VydmljZSBwcm92aWRlciBhYm91dCBzdWJzY3JpcHRpb24gY2FuY2VsbGF0aW9uLg0KICAgIC8vLyAgICAgUHJvdmlkZXIgaXMgbm90IGFibGUgdG8gcHJldmVudCB0aGUgY2FuY2VsbGF0aW9uLg0KICAgIC8vL0ByZXR1cm4gPDxyZXNlcnZlZCBmb3IgZnV0dXJlIGltcGxlbWVudGF0aW9uPj4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIG9uU3ViQ2FuY2VsZWQodWludCBzdWJJZCwgYWRkcmVzcyBjYWxsZXIpIHB1YmxpYyByZXR1cm5zIChib29sKTsNCg0KICAgIC8vL0BkZXYgY2FsbGVkIHRvIG5vdGlmeSBzZXJ2aWNlIHByb3ZpZGVyIGFib3V0IHN1YnNjcmlwdGlvbiBnb3QgaG9sZC91bmhvbGQuDQogICAgLy8vQHJldHVybiBgZmFsc2VgIGNhdXNlcyBhbiBleGNlcHRpb24gYW5kIHJldmVydHMgdGhlIG9wZXJhdGlvbi4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIG9uU3ViVW5Ib2xkKHVpbnQgc3ViSWQsIGFkZHJlc3MgY2FsbGVyLCBib29sIGlzT25Ib2xkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCg0KICAgIC8vL0BkZXYgZm9sbG93aW5nIGV2ZW50cyBzaG91bGQgYmUgdXNlZCBieSBTZXJ2aWNlUHJvdmlkZXIgY29udHJhY3QgdG8gbm90aWZ5IERBcHBzIGFib3V0IG9mZmVyIGNoYW5nZXMuDQogICAgLy8vICAgICBTdWJzY3JpcHRpb25Nb2R1bGUgZG8gbm90IHRoaXMgbm90aWZpY2F0aW9uIGFuZCBleHBlY3RzIGl0IGZyb20gU2VydmljZSBQcm92aWRlciBpZiBkZXNpcmVkLg0KICAgIC8vLw0KICAgIC8vL0BkZXYgdG8gYmUgZmlyZWQgYnkgU2VydmljZVByb3ZpZGVyIG9uIG5ldyBPZmZlciBjcmVhdGVkIGluIGEgcGxhdGZvcm0uDQogICAgZXZlbnQgT2ZmZXJDcmVhdGVkKHVpbnQgb2ZmZXJJZCwgIGJ5dGVzIGRlc2NyaXB0b3IsIGFkZHJlc3MgcHJvdmlkZXIpOw0KDQogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gT2ZmZXIgdXBkYXRlZC4NCiAgICBldmVudCBPZmZlclVwZGF0ZWQodWludCBvZmZlcklkLCAgYnl0ZXMgZGVzY3JpcHRvciwgdWludCBvbGRFeGVjQ291bnRlciwgYWRkcmVzcyBwcm92aWRlcik7DQoNCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBPZmZlciBjYW5jZWxlZC4NCiAgICBldmVudCBPZmZlckNhbmNlbGVkKHVpbnQgb2ZmZXJJZCwgYnl0ZXMgZGVzY3JpcHRvciwgYWRkcmVzcyBwcm92aWRlcik7DQoNCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBPZmZlciBob2xkL3VuaG9sZCBzdGF0dXMgY2hhbmdlZC4NCiAgICBldmVudCBPZmZlclVuSG9sZCh1aW50IG9mZmVySWQsICAgYnl0ZXMgZGVzY3JpcHRvciwgYm9vbCBpc09uSG9sZE5vdywgYWRkcmVzcyBwcm92aWRlcik7DQp9IC8vU2VydmljZVByb3ZpZGVyDQoNCi8vL0Bub3RpY2UgWFJhdGVQcm92aWRlciBpcyBhbiBleHRlcm5hbCBzZXJ2aWNlIHByb3ZpZGluZyBhbiBleGNoYW5nZSByYXRlIGZyb20gZXh0ZXJuYWwgY3VycmVuY3kgdG8gU0FOIHRva2VuLg0KLy8vIGl0IHVzZWQgZm9yIHN1YnNjcmlwdGlvbnMgcHJpY2VkIGluIG90aGVyIGN1cnJlbmN5IHRoYW4gU0FOIChldmVuIGNhbGN1bGF0ZWQgYW5kIHBhaWQgZm9ybWFsbHkgaW4gU0FOKS4NCi8vLyBpZiBub24tZGVmYXVsdCBYUmF0ZVByb3ZpZGVyIGlzIHNldCBmb3Igc29tZSBzdWJzY3JpcHRpb24sIHRoZW4gdGhlIGFtb3VudCBpbiBTQU4gZm9yIGV2ZXJ5IHBlcmlvZGljIHBheW1lbnQNCi8vLyB3aWxsIGJlIHJlY2FsY3VsYXRlZCB1c2luZyBwcm92aWRlZCBleGNoYW5nZSByYXRlLg0KLy8vDQovLy8gUGxlYXNlIG5vdGUsIHRoYXQgdGhlIGV4Y2hhbmdlIHJhdGUgZnJhY3Rpb24gaXMgKHVpbnQzMix1aW50MzIpIG51bWJlci4gSXQgc2hvdWxkIGJlIGVub3VnaCB0byBleHByZXNzDQovLy8gYW55IHJlYWwgZXhjaGFuZ2UgcmF0ZSB2b2xhdGlsaXR5LiBOZXZlcnRoZWxlc3MgeW91IGFyZSBhZHZpc2VkIHRvIGF2b2lkIHRvbyBiaWcgbnVtYmVycyBpbiB0aGUgZnJhY3Rpb24uDQovLy8gUG9zc2lpYmx5IHlvdSBjb3VsZCBpbXBsZW1lbnQgdGhlIHJhdGlvIG9mIG11bHRpcGxlIHRva2VuIHBlciBTQU4gaW4gb3JkZXIgdG8ga2VlcCB0aGUgYXZlcmFnZSByYXRpbyBhcm91bmQgMToxLg0KLy8vDQovLy8gVGhlIGRlZmF1bHQgWFJhdGVQcm92aWRlciAod2l0aCBpZD09MCkgZGVmaW5lcyBleGNoYW5nZSByYXRlIDE6MSBhbmQgcmVwcmVzZW50cyBleGNoYW5nZSByYXRlIG9mIFNBTiB0b2tlbiB0byBpdHNlbGYuDQovLy8gdGhpcyBwcm92aWRlciBpcyBzZXQgYnkgZGVmYWx1bHQgYW5kIHRodXMgdGhlIHN1YnNjcmlwdGlvbiBiZWNvbWVzIG5vbWluYXRlZCBpbiBTQU4uDQovLw0KY29udHJhY3QgWFJhdGVQcm92aWRlciB7DQoNCiAgICAvL0BkZXYgcmV0dXJucyBjdXJyZW50IGV4Y2hhbmdlIHJhdGUgKGluIGZvcm0gb2YgYSBzaW1wbGUgZnJhY3Rpb24pIGZyb20gb3RoZXIgY3VycmVuY3kgdG8gU0FOIChmLmUuIEVUSDpTQU4pLg0KICAgIC8vQGRldiBmcmFjdGlvbiBudW1iZXJzIGFyZSByZXN0cmljdGVkIHRvIHVpbnQxNiB0byBwcmV2ZW50IG92ZXJmbG93IGluIGNhbGN1bGF0aW9uczsNCiAgICBmdW5jdGlvbiBnZXRSYXRlKCkgcHVibGljIHJldHVybnMgKHVpbnQzMiAvKm5vbWluYXRvciovLCB1aW50MzIgLypkZW5vbWluYXRvciovKTsNCg0KICAgIC8vQGRldiBwcm92aWRlcyBhIGNvZGUgZm9yIGFub3RoZXIgY3VycmVuY3ksIGYuZS4gIkVUSCIgb3IgIlVTRCINCiAgICBmdW5jdGlvbiBnZXRDb2RlKCkgcHVibGljIHJldHVybnMgKHN0cmluZyk7DQp9DQoNCg0KLy9AZGV2IGRhdGEgc3RydWN0dXJlIGZvciBTdWJzY3JpcHRpb25Nb2R1bGUNCmNvbnRyYWN0IFN1YnNjcmlwdGlvbkJhc2Ugew0KDQogICAgZW51bSBTdWJTdGF0ZSAgIHtOT1RfRVhJU1QsIEJFRk9SRV9TVEFSVCwgUEFJRCwgQ0hBUkdFQUJMRSwgT05fSE9MRCwgQ0FOQ0VMRUQsIEVYUElSRUQsIEZJTkFMSVpFRH0NCiAgICBlbnVtIE9mZmVyU3RhdGUge05PVF9FWElTVCwgQkVGT1JFX1NUQVJULCBBQ1RJVkUsIFNPTERfT1VULCBPTl9IT0xELCBFWFBJUkVEfQ0KDQogICAgc3RyaW5nW10gaW50ZXJuYWwgU1VCX1NUQVRFUyAgID0gWyJOT1RfRVhJU1QiLCAiQkVGT1JFX1NUQVJUIiwgIlBBSUQiLCAiQ0hBUkdFQUJMRSIsICJPTl9IT0xEIiwgIkNBTkNFTEVEIiwgIkVYUElSRUQiLCAiRklOQUxJWkVEIiBdOw0KICAgIHN0cmluZ1tdIGludGVybmFsIE9GRkVSX1NUQVRFUyA9IFsiTk9UX0VYSVNUIiwgIkJFRk9SRV9TVEFSVCIsICJBQ1RJVkUiLCAiU09MRF9PVVQiLCAiT05fSE9MRCIsICJFWFBJUkVEIl07DQoNCiAgICAvL0BkZXYgc3Vic2NyaXB0aW9uIGFuZCBzdWJzY3JpcHRpb24gb2ZmZXIgdXNlIHRoZSBzYW1lIHN0cnVjdHVyZS4gT2ZmZXIgaXMgdGVjaG5pY2FsbHkgYSB0ZW1wbGF0ZSBmb3Igc3Vic2NyaXB0aW9uLg0KICAgIHN0cnVjdCBTdWJzY3JpcHRpb24gew0KICAgICAgICBhZGRyZXNzIHRyYW5zZmVyRnJvbTsgICAvLyBjdXN0b21lciAodW5zZXQgaW4gc3Vic2NyaXB0aW9uIG9mZmVyKQ0KICAgICAgICBhZGRyZXNzIHRyYW5zZmVyVG87ICAgICAvLyBzZXJ2aWNlIHByb3ZpZGVyDQogICAgICAgIHVpbnQgcHJpY2VQZXJIb3VyOyAgICAgIC8vIHByaWNlIGluIFNBTiBwZXIgaG91ciAocG9zc2libHkgcmVjYWxjdWxhdGVkIHVzaW5nIGV4Y2hhbmdlIHJhdGUpDQogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfbjsgIC8vIG5vbWluYXRvcg0KICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX2Q7ICAvLyBkZW5vbWluYXRvcg0KICAgICAgICB1aW50MTYgeHJhdGVQcm92aWRlcklkOyAvLyBpZCBvZiBhIHJlZ2lzdGVyZWQgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlcg0KICAgICAgICB1aW50IHBhaWRVbnRpbDsgICAgICAgICAvLyBzdWJzY3JpcHRpb24gaXMgcGFpZCB1bnRpbCB0aW1lDQogICAgICAgIHVpbnQgY2hhcmdlUGVyaW9kOyAgICAgIC8vIHN1YnNjcmlwdGlvbiBjYW4ndCBiZSBjaGFyZ2VkIG1vcmUgb2Z0ZW4gdGhhbiB0aGlzIHBlcmlvZA0KICAgICAgICB1aW50IGRlcG9zaXRBbW91bnQ7ICAgICAvLyB1cGZyb250IGRlcG9zaXQgb24gY3JlYXRpbmcgc3Vic2NyaXB0aW9uIChwb3NzaWJseSByZWNhbGN1bGF0ZWQgdXNpbmcgZXhjaGFuZ2UgcmF0ZSkNCg0KICAgICAgICB1aW50IHN0YXJ0T247ICAgICAgICAgICAvLyBmb3Igb2ZmZXI6IGNhbid0IGJlIGFjY2VwdGVkIGJlZm9yZSAgPHN0YXJ0T24+IDsgZm9yIHN1YnNjcmlwdGlvbjogY2FuJ3QgYmUgY2hhcmdlZCBiZWZvcmUgPHN0YXJ0T24+DQogICAgICAgIHVpbnQgZXhwaXJlT247ICAgICAgICAgIC8vIGZvciBvZmZlcjogY2FuJ3QgYmUgYWNjZXB0ZWQgYWZ0ZXIgIDxleHBpcmVPbj4gOyBmb3Igc3Vic2NyaXB0aW9uOiBjYW4ndCBiZSBjaGFyZ2VkIGFmdGVyICA8ZXhwaXJlT24+DQogICAgICAgIHVpbnQgZXhlY0NvdW50ZXI7ICAgICAgIC8vIGZvciBvZmZlcjogbWF4IG51bSBvZiBzdWJzY3JpcHRpb25zIGF2YWlsYWJsZSAgOyBmb3Igc3Vic2NyaXB0aW9uOiBudW0gb2YgY2hhcmdlcyBtYWRlLg0KICAgICAgICBieXRlcyBkZXNjcmlwdG9yOyAgICAgICAvLyBzdWJzY3JpcHRpb24gcGF5bG9hZCAoc3ViamVjdCk6IGV2YWx1YXRlZCBieSBzZXJ2aWNlIHByb3ZpZGVyLg0KICAgICAgICB1aW50IG9uSG9sZFNpbmNlOyAgICAgICAvLyBzdWJzY3JpcHRpb246IG9uLWhvbGQgc2luY2UgdGltZSBvciAwIGlmIG5vdCBvbkhvbGQuIG9mZmVyOiB1bnVzZWQ6IC8vVG9EbzogdG8gYmUgaW1wbGVtZW50ZWQNCiAgICB9DQoNCiAgICBzdHJ1Y3QgRGVwb3NpdCB7DQogICAgICAgIHVpbnQgdmFsdWU7ICAgICAgICAgLy8gdmFsdWUgb24gZGVwb3NpdA0KICAgICAgICBhZGRyZXNzIG93bmVyOyAgICAgIC8vIHVzdWFsbHkgYSBjdXN0b21lcg0KICAgICAgICB1aW50IGNyZWF0ZWRPbjsgICAgIC8vIGRlcG9zaXQgY3JlYXRlZCB0aW1lc3RhbXANCiAgICAgICAgdWludCBsb2NrVGltZTsgICAgICAvLyBkZXBvc2l0IGxvY2tlZCBmb3IgdGltZSBwZXJpb2QNCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcjsgICAvLyBzZXJ2aWNlIHJlbGF0ZWQgZGVzY3JpcHRvciB0byBiZSBldmFsdWF0ZWQgYnkgc2VydmljZSBwcm92aWRlcg0KICAgIH0NCg0KICAgIGV2ZW50IE5ld1N1YnNjcmlwdGlvbihhZGRyZXNzIGN1c3RvbWVyLCBhZGRyZXNzIHNlcnZpY2UsIHVpbnQgb2ZmZXJJZCwgdWludCBzdWJJZCk7DQogICAgZXZlbnQgTmV3RGVwb3NpdCh1aW50IGRlcG9zaXRJZCwgdWludCB2YWx1ZSwgdWludCBsb2NrVGltZSwgYWRkcmVzcyBzZW5kZXIpOw0KICAgIGV2ZW50IE5ld1hSYXRlUHJvdmlkZXIoYWRkcmVzcyBhZGRyLCB1aW50MTYgeFJhdGVQcm92aWRlcklkLCBhZGRyZXNzIHNlbmRlcik7DQogICAgZXZlbnQgRGVwb3NpdFJldHVybmVkKHVpbnQgZGVwb3NpdElkLCBhZGRyZXNzIHJldHVybmVkVG8pOw0KICAgIGV2ZW50IFN1YnNjcmlwdGlvbkRlcG9zaXRSZXR1cm5lZCh1aW50IHN1YklkLCB1aW50IGFtb3VudCwgYWRkcmVzcyByZXR1cm5lZFRvLCBhZGRyZXNzIHNlbmRlcik7DQogICAgZXZlbnQgT2ZmZXJPbkhvbGQodWludCBvZmZlcklkLCBib29sIG9uSG9sZCwgYWRkcmVzcyBzZW5kZXIpOw0KICAgIGV2ZW50IE9mZmVyQ2FuY2VsZWQodWludCBvZmZlcklkLCBhZGRyZXNzIHNlbmRlcik7DQogICAgZXZlbnQgU3ViT25Ib2xkKHVpbnQgb2ZmZXJJZCwgYm9vbCBvbkhvbGQsIGFkZHJlc3Mgc2VuZGVyKTsNCiAgICBldmVudCBTdWJDYW5jZWxlZCh1aW50IHN1YklkLCBhZGRyZXNzIHNlbmRlcik7DQogICAgZXZlbnQgU3ViTW9kdWxlU3VzcGVuZGVkKHVpbnQgc3VzcGVuZFVudGlsKTsNCg0KfQ0KDQovLy9AZGV2IGFuIEludGVyZmFjZSBmb3IgU3Vic2NyaXB0aW9uTW9kdWxlLg0KLy8vICAgICBleHRyYWN0ZWQgaGVyZSBmb3IgYmV0dGVyIG92ZXJ2aWV3Lg0KLy8vICAgICBzZWUgZGV0YWlsZWQgZG9jdW1lbnRhdGlvbiBpbiBpbXBsZW1lbnRhdGlvbiBtb2R1bGUuDQpjb250cmFjdCBTdWJzY3JpcHRpb25Nb2R1bGUgaXMgU3Vic2NyaXB0aW9uQmFzZSwgQmFzZSB7DQoNCiAgICAvLy9AZGV2ICoqKioqIG1vZHVsZSBjb25maWd1cmF0aW9uICoqKioqDQogICAgZnVuY3Rpb24gYXR0YWNoVG9rZW4oYWRkcmVzcyB0b2tlbikgcHVibGljOw0KDQogICAgLy8vQGRldiAqKioqKiBzaW5nbGUgcGF5bWVudCBoYW5kbGluZyAqKioqKg0KICAgIGZ1bmN0aW9uIHBheW1lbnRUbyh1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhLCBTZXJ2aWNlUHJvdmlkZXIgX3RvKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gcGF5bWVudEZyb20odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgYWRkcmVzcyBfZnJvbSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KDQogICAgLy8vQGRldiAqKioqKiBzdWJzY3JpcHRpb24gaGFuZGxpbmcgKioqKioNCiAgICAvLy9AZGV2IHNvbWUgZnVuY3Rpb25zIGFyZSBtYXJrZWQgYXMgcmVlbnRyYW50LCBldmVuIHRoZWlycyBpbXBsZW1lbnRhdGlvbiBpcyBtYXJrZWQgd2l0aCBub1JlZW50cmFuY3koTE9DSykuDQogICAgLy8vICAgICBUaGlzIGlzIGludGVudGlvbmFsbHkgYmVjYXVzZSB0aGVzZSBub1JlZW50cmFuY3koTE9DSykgcmVzdHJpY3Rpb25zIGNhbiBiZSBsaWZ0ZWQgaW4gdGhlIGZ1dHVyZS4NCiAgICAvLyAgICAgIEZ1bmN0aW9ucyB3b3VsZCBiZWNvbWUgcmVlbnRyYW50Lg0KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbih1aW50IF9vZmZlcklkLCB1aW50IF9leHBpcmVPbiwgdWludCBfc3RhcnRPbikgcHVibGljIHJlZW50cmFudCByZXR1cm5zICh1aW50IG5ld1N1YklkKTsNCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcmVlbnRyYW50IHB1YmxpYzsNCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKSByZWVudHJhbnQgcHVibGljOw0KICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gZXhlY3V0ZVN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gcG9zdHBvbmVEdWVEYXRlKHVpbnQgc3ViSWQsIHVpbnQgbmV3RHVlRGF0ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQodWludCBzdWJJZCkgcHVibGljOw0KICAgIGZ1bmN0aW9uIGNsYWltU3Vic2NyaXB0aW9uRGVwb3NpdCh1aW50IHN1YklkKSBwdWJsaWM7DQogICAgZnVuY3Rpb24gc3RhdGUodWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHN0YXRlKTsNCiAgICBmdW5jdGlvbiBzdGF0ZUNvZGUodWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCBzdGF0ZUNvZGUpOw0KDQogICAgLy8vQGRldiAqKioqKiBzdWJzY3JpcHRpb24gb2ZmZXIgaGFuZGxpbmcgKioqKioNCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb25PZmZlcih1aW50IF9wcmljZSwgdWludDE2IF94cmF0ZVByb3ZpZGVySWQsIHVpbnQgX2NoYXJnZVBlcmlvZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX29mZmVyTGltaXQsIHVpbnQgX2RlcG9zaXRWYWx1ZSwgdWludCBfc3RhcnRPbiwgYnl0ZXMgX2Rlc2NyaXB0b3IpIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAodWludCBzdWJJZCk7DQogICAgZnVuY3Rpb24gdXBkYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkLCB1aW50IF9vZmZlckxpbWl0KSBwdWJsaWM7DQogICAgZnVuY3Rpb24gaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gdW5ob2xkU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sKTsNCg0KICAgIC8vL0BkZXYgKioqKiogc2ltcGxlIGRlcG9zaXQgaGFuZGxpbmcgKioqKioNCiAgICBmdW5jdGlvbiBjcmVhdGVEZXBvc2l0KHVpbnQgX3ZhbHVlLCB1aW50IGxvY2tUaW1lLCBieXRlcyBfZGVzY3JpcHRvcikgcHVibGljIHJldHVybnMgKHVpbnQgc3ViSWQpOw0KICAgIGZ1bmN0aW9uIGNsYWltRGVwb3NpdCh1aW50IGRlcG9zaXRJZCkgcHVibGljOw0KDQogICAgLy8vQGRldiAqKioqKiBFeGNoYW5nZVJhdGUgcHJvdmlkZXIgKioqKioNCiAgICBmdW5jdGlvbiByZWdpc3RlclhSYXRlUHJvdmlkZXIoWFJhdGVQcm92aWRlciBhZGRyKSBwdWJsaWMgcmV0dXJucyAodWludDE2IHhyYXRlUHJvdmlkZXJJZCk7DQoNCiAgICAvLy9AZGV2ICoqKioqIFNlcnZpY2UgcHJvdmlkZXIgKHBheW1lbnQgcmVjZWl2ZXIpICoqKioqDQogICAgZnVuY3Rpb24gZW5hYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljOw0KICAgIGZ1bmN0aW9uIGRpc2FibGVTZXJ2aWNlUHJvdmlkZXIoU2VydmljZVByb3ZpZGVyIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKSBwdWJsaWM7DQoNCg0KICAgIC8vL0BkZXYgKioqKiogY29udmVuaWVuY2Ugc3Vic2NyaXB0aW9uIGdldHRlciAqKioqKg0KICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvbkRldGFpbHModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoDQogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJGcm9tLA0KICAgICAgICBhZGRyZXNzIHRyYW5zZmVyVG8sDQogICAgICAgIHVpbnQgcHJpY2VQZXJIb3VyLA0KICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX24sIC8vbm9taW5hdG9yDQogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfZCwgLy9kZW5vbWluYXRvcg0KICAgICAgICB1aW50MTYgeHJhdGVQcm92aWRlcklkLA0KICAgICAgICB1aW50IGNoYXJnZVBlcmlvZCwNCiAgICAgICAgdWludCBzdGFydE9uLA0KICAgICAgICBieXRlcyBkZXNjcmlwdG9yDQogICAgKTsNCg0KICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvblN0YXR1cyh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucygNCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50LA0KICAgICAgICB1aW50IGV4cGlyZU9uLA0KICAgICAgICB1aW50IGV4ZWNDb3VudGVyLA0KICAgICAgICB1aW50IHBhaWRVbnRpbCwNCiAgICAgICAgdWludCBvbkhvbGRTaW5jZQ0KICAgICk7DQoNCiAgICBlbnVtIFBheW1lbnRTdGF0dXMge09LLCBCQUxBTkNFX0VSUk9SLCBBUFBST1ZBTF9FUlJPUn0NCiAgICBldmVudCBQYXltZW50KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgdWludCBfZmVlLCBhZGRyZXNzIHNlbmRlciwgUGF5bWVudFN0YXR1cyBzdGF0dXMsIHVpbnQgc3ViSWQpOw0KICAgIGV2ZW50IFNlcnZpY2VQcm92aWRlckVuYWJsZWQoYWRkcmVzcyBhZGRyLCBieXRlcyBtb3JlSW5mbyk7DQogICAgZXZlbnQgU2VydmljZVByb3ZpZGVyRGlzYWJsZWQoYWRkcmVzcyBhZGRyLCBieXRlcyBtb3JlSW5mbyk7DQoNCn0gLy9TdWJzY3JpcHRpb25Nb2R1bGUNCg0KY29udHJhY3QgRVJDMjBNb2R1bGVTdXBwb3J0IHsNCiAgICBmdW5jdGlvbiBfZnVsZmlsbFByZWFwcHJvdmVkUGF5bWVudChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGFkZHJlc3MgbXNnX3NlbmRlcikgcHVibGljIHJldHVybnMoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiBfZnVsZmlsbFBheW1lbnQoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCB1aW50IHN1YklkLCBhZGRyZXNzIG1zZ19zZW5kZXIpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIF9taW50RnJvbURlcG9zaXQoYWRkcmVzcyBvd25lciwgdWludCBhbW91bnQpIHB1YmxpYzsNCiAgICBmdW5jdGlvbiBfYnVybkZvckRlcG9zaXQoYWRkcmVzcyBvd25lciwgdWludCBhbW91bnQpIHB1YmxpYyByZXR1cm5zKGJvb2wgc3VjY2Vzcyk7DQp9DQoNCi8vQGRldiBpbXBsZW1lbnRhdGlvbg0KY29udHJhY3QgU3Vic2NyaXB0aW9uTW9kdWxlSW1wbCBpcyBTdWJzY3JpcHRpb25Nb2R1bGUsIE93bmVkICB7DQoNCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFZFUlNJT04gPSAiMC4yLjAiOw0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgICAgICAgICAgIGNvbnRyYWN0IHN0YXRlcyAgICAgICAgICAgICAgICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICAvLy9AZGV2IHN1c3BlbmQgYWxsIG1vZHVsZSBvcGVyYXRpb24gdW50aWwgdGhpcyB0aW1lIChpZiBpbiBmdXR1cmUpOyBpZiB0aGUgdGltZSBpcyBpbiBwYXN0IChvciB6ZXJvKSAtIG9wZXJhdGVzIG5vcm1hbGx5Lg0KICAgIHVpbnQgcHVibGljIHN1c3BlbmRlZFVudGlsID0gMDsNCiAgICBmdW5jdGlvbiBpc1N1c3BlbmRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsgcmV0dXJuIHN1c3BlbmRlZFVudGlsID4gbm93OyB9DQoNCiAgICAvLy9AZGV2IGxpc3Qgb2YgYWxsIHJlZ2lzdGVyZWQgc2VydmljZSBwcm92aWRlciBjb250cmFjdHMgaW1wbGVtZW50ZWQgYXMgYSBtYXAgZm9yIGJldHRlciBsb29rdXAuDQogICAgbWFwcGluZyAoYWRkcmVzcz0+Ym9vbCkgcHVibGljIHByb3ZpZGVyUmVnaXN0cnk7DQoNCiAgICAvLy9AZGV2IGFsbCBzdWJzY3JpcHRpb25zIGFuZCBvZmZlcnMgKGluY2wuIEZJTkFMSVpFRCkuDQogICAgbWFwcGluZyAodWludCA9PiBTdWJzY3JpcHRpb24pIHB1YmxpYyBzdWJzY3JpcHRpb25zOw0KDQogICAgLy8vQGRldiBhbGwgYWN0aXZlIHNpbXBsZSBkZXBvc2l0cyBnaXZlZCBieSBkZXBvc2l0SWQuDQogICAgbWFwcGluZyAodWludCA9PiBEZXBvc2l0KSBwdWJsaWMgZGVwb3NpdHM7DQoNCiAgICAvLy9AZGV2IGFkZHJlc3NlcyBvZiByZWdpc3RlcmVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXJzLg0KICAgIFhSYXRlUHJvdmlkZXJbXSBwdWJsaWMgeHJhdGVQcm92aWRlcnM7DQoNCiAgICAvLy9AZGV2IG9uZ29pbmcgY291bnRlciBmb3Igc3Vic2NyaXB0aW9uIGlkcyBzdGFydGluZyBmcm9tIDEuDQogICAgLy8vICAgICBDdXJyZW50IHZhbHVlIHJlcHJlc2VudHMgYW4gaWQgb2YgbGFzdCBjcmVhdGVkIHN1YnNjcmlwdGlvbi4NCiAgICB1aW50IHB1YmxpYyBzdWJzY3JpcHRpb25Db3VudGVyID0gMDsNCg0KICAgIC8vL0BkZXYgb25nb2luZyBjb3VudGVyIGZvciBzaW1wbGUgZGVwb3NpdCBpZHMgc3RhcnRpbmcgZnJvbSAxLg0KICAgIC8vLyAgICAgQ3VycmVudCB2YWx1ZSByZXByZXNlbnRzIGFuIGlkIG9mIGxhc3QgY3JlYXRlZCBkZXBvc2l0Lg0KICAgIHVpbnQgcHVibGljIGRlcG9zaXRDb3VudGVyID0gMDsNCg0KICAgIC8vL0BkZXYgVG9rZW4gY29udHJhY3Qgd2l0aCBFUkMyME1vZHVsZVN1cHBvcnQgYWRkb24uDQogICAgLy8vICAgICBTdWJzY3JpcHRpb24gTW9kdWxlIG9wZXJhdGVzIG9uIGl0cyBiYWxhbmNlcyB2aWEgRVJDMjBNb2R1bGVTdXBwb3J0IGludGVyZmFjZSBhcyB0cnVzdGVkIG1vZHVsZS4NCiAgICBFUkMyME1vZHVsZVN1cHBvcnQgcHVibGljIHNhbjsNCg0KDQoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy8gKiAgICAgcmVqZWN0IGFsbCBldGhlciBzZW50IHRvIHRoaXMgY29udHJhY3QgICAgKg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KDQoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy8gKiAgICAgICAgICAgIHNldHVwIGFuZCBjb25maWd1cmF0aW9uICAgICAgICAgICAgKg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KICAgIC8vL0BkZXYgY29uc3RydWN0b3INCiAgICBmdW5jdGlvbiBTdWJzY3JpcHRpb25Nb2R1bGVJbXBsKCkgew0KICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogICAgICAgIHhyYXRlUHJvdmlkZXJzLnB1c2goWFJhdGVQcm92aWRlcih0aGlzKSk7IC8vdGhpcyBpcyBhIGRlZmF1bHQgU0FOOlNBTiAoMToxKSBwcm92aWRlciB3aXRoIGRlZmF1bHQgaWQgPT0gMA0KICAgIH0NCg0KDQogICAgLy8vQGRldiBhdHRhY2ggU0FOIHRva2VuIHRvIHdvcmsgd2l0aDsgY2FuIGJlIGRvbmUgb25seSBvbmNlLg0KICAgIGZ1bmN0aW9uIGF0dGFjaFRva2VuKGFkZHJlc3MgdG9rZW4pIHB1YmxpYyB7DQogICAgICAgIGFzc2VydChhZGRyZXNzKHNhbikgPT0gMCk7IC8vb25seSBpbiBuZXcgZGVwbG95ZWQgc3RhdGUNCiAgICAgICAgc2FuID0gRVJDMjBNb2R1bGVTdXBwb3J0KHRva2VuKTsNCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgcmVnaXN0ZXIgYSBuZXcgc2VydmljZSBwcm92aWRlciB0byB0aGUgcGxhdGZvcm0uDQogICAgZnVuY3Rpb24gZW5hYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljIG5vdFN1c3BlbmRlZCBvbmx5KG93bmVyKSB7DQogICAgICAgIHByb3ZpZGVyUmVnaXN0cnlbYWRkcl0gPSB0cnVlOw0KICAgICAgICBTZXJ2aWNlUHJvdmlkZXJFbmFibGVkKGFkZHIsIG1vcmVJbmZvKTsNCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgZGUtcmVnaXN0ZXIgdGhlIHNlcnZpY2UgcHJvdmlkZXIgd2l0aCBnaXZlbiBgYWRkcmAuDQogICAgZnVuY3Rpb24gZGlzYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYyBub3RTdXNwZW5kZWQgb25seShvd25lcikgew0KICAgICAgICBkZWxldGUgcHJvdmlkZXJSZWdpc3RyeVthZGRyXTsNCiAgICAgICAgU2VydmljZVByb3ZpZGVyRGlzYWJsZWQoYWRkciwgbW9yZUluZm8pOw0KICAgIH0NCg0KICAgIC8vL0BkZXYgc3VzcGVuZCBhbGwgbW9kdWxlIG9wZXJhdGlvbnMgZm9yIGdpdmVuIHRpbWUuDQogICAgZnVuY3Rpb24gc3VzcGVuZCh1aW50IHN1c3BlbmRUaW1lU2VjKSBwdWJsaWMgb25seShvd25lcikgew0KICAgICAgICBzdXNwZW5kZWRVbnRpbCA9IG5vdyArIHN1c3BlbmRUaW1lU2VjOw0KICAgICAgICBTdWJNb2R1bGVTdXNwZW5kZWQoc3VzcGVuZGVkVW50aWwpOw0KICAgIH0NCg0KICAgIC8vL0BkZXYgcmVnaXN0ZXIgbmV3IGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXIuDQogICAgLy8vICAgICBYUmF0ZVByb3ZpZGVyIGNhbid0IGJlIGRlLXJlZ2lzdGVyZWQsIGJlY2F1c2UgdGhleSBjb3VsZCBiZSBzdGlsbCBpbiB1c2UgYnkgc29tZSBzdWJzY3JpcHRpb24uDQogICAgZnVuY3Rpb24gcmVnaXN0ZXJYUmF0ZVByb3ZpZGVyKFhSYXRlUHJvdmlkZXIgYWRkcikgcHVibGljIG5vdFN1c3BlbmRlZCBvbmx5KG93bmVyKSByZXR1cm5zICh1aW50MTYgeHJhdGVQcm92aWRlcklkKSB7DQogICAgICAgIHhyYXRlUHJvdmlkZXJJZCA9IHVpbnQxNih4cmF0ZVByb3ZpZGVycy5sZW5ndGgpOw0KICAgICAgICB4cmF0ZVByb3ZpZGVycy5wdXNoKGFkZHIpOw0KICAgICAgICBOZXdYUmF0ZVByb3ZpZGVyKGFkZHIsIHhyYXRlUHJvdmlkZXJJZCwgbXNnLnNlbmRlcik7DQogICAgfQ0KDQoNCiAgICAvLy9AZGV2IHhyYXRlUHJvdmlkZXJzIGxlbmd0aCBhY2Nlc3Nvci4NCiAgICBmdW5jdGlvbiBnZXRYUmF0ZVByb3ZpZGVyTGVuZ3RoKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHhyYXRlUHJvdmlkZXJzLmxlbmd0aDsNCiAgICB9DQoNCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgICBzaW5nbGUgcGF5bWVudCBtZXRob2RzICAgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy8vQG5vdGljZSBtYWtlcyBzaW5nbGUgcGF5bWVudCB0byBzZXJ2aWNlIHByb3ZpZGVyLg0KICAgIC8vL0BwYXJhbSBfdmFsdWUgLSBhbW91bnQgb2YgU0FOIHRva2VuIHRvIHNlbnQNCiAgICAvLy9AcGFyYW0gX3BheW1lbnREYXRhIC0gJ3BheW1lbnQgcHVycG9zZScgY29kZSB1c3VhbGx5IGlzc3VlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIGN1c3RvbWVyIGJlZm9yZSBwYXltZW50Lg0KICAgIC8vL0BwYXJhbSBfdG8gLSBzZXJ2aWNlIHByb3ZpZGVyIGNvbnRyYWN0DQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBwYXltZW50VG8odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIG5vdFN1c3BlbmRlZCByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmIChzYW4uX2Z1bGZpbGxQYXltZW50KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCAwLCBtc2cuc2VuZGVyKSkgew0KICAgICAgICAgICAgLy8gYSBTZXJ2aWNlUHJvdmlkZXIgKGEgU2VydmljZVByb3ZpZGVyKSBoYXMgaGVyZSBhbiBvcHBvcnR1bml0eSB2ZXJpZnkgYW5kIHJlamVjdCB0aGUgcGF5bWVudA0KICAgICAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblBheW1lbnQobXNnLnNlbmRlciwgX3ZhbHVlLCBfcGF5bWVudERhdGEpKTsgICAgICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIG1ha2VzIHNpbmdsZSBwcmVhcHByb3ZlZCBwYXltZW50IHRvIHNlcnZpY2UgcHJvdmlkZXIuIEFuIGFtb3VudCBtdXN0IGJlIGFscmVhZHkgcHJlYXBwcm92ZWQgYnkgcGF5bWVudCBzZW5kZXIgdG8gcmVjZXBpZW50Lg0KICAgIC8vL0BwYXJhbSBfdmFsdWUgLSBhbW91bnQgb2YgU0FOIHRva2VuIHRvIHNlbnQNCiAgICAvLy9AcGFyYW0gX3BheW1lbnREYXRhIC0gJ3BheW1lbnQgcHVycG9zZScgY29kZSB1c3VhbGx5IGlzc3VlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIGN1c3RvbWVyIGJlZm9yZSBwYXltZW50Lg0KICAgIC8vL0BwYXJhbSBfZnJvbSAtIHNlbmRlciBvZiB0aGUgcGF5bWVudCAob3RoZXIgdGhhbiBtc2cuc2VuZGVyKQ0KICAgIC8vL0BwYXJhbSBfdG8gLSBzZXJ2aWNlIHByb3ZpZGVyIGNvbnRyYWN0DQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBwYXltZW50RnJvbSh1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhLCBhZGRyZXNzIF9mcm9tLCBTZXJ2aWNlUHJvdmlkZXIgX3RvKSBwdWJsaWMgbm90U3VzcGVuZGVkIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKHNhbi5fZnVsZmlsbFByZWFwcHJvdmVkUGF5bWVudChfZnJvbSwgX3RvLCBfdmFsdWUsIG1zZy5zZW5kZXIpKSB7DQogICAgICAgICAgICAvLyBhIFNlcnZpY2VQcm92aWRlciAoYSBTZXJ2aWNlUHJvdmlkZXIpIGhhcyBoZXJlIGFuIG9wcG9ydHVuaXR5IHZlcmlmeSBhbmQgcmVqZWN0IHRoZSBwYXltZW50DQogICAgICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihfdG8pLm9uUGF5bWVudChfZnJvbSwgX3ZhbHVlLCBfcGF5bWVudERhdGEpKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0NCiAgICB9DQoNCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgICAgc3Vic2NyaXB0aW9uIGhhbmRsaW5nICAgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy8vQGRldiBjb252ZW5pZW5jZSBnZXR0ZXIgZm9yIHNvbWUgc3Vic2NyaXB0aW9uIGZpZWxkcw0KICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvbkRldGFpbHModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKA0KICAgICAgICBhZGRyZXNzIHRyYW5zZmVyRnJvbSwNCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlclRvLA0KICAgICAgICB1aW50IHByaWNlUGVySG91ciwNCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9uLCAvL25vbWluYXRvcg0KICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX2QsIC8vZGVub21pbmF0b3INCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZCwNCiAgICAgICAgdWludCBjaGFyZ2VQZXJpb2QsDQogICAgICAgIHVpbnQgc3RhcnRPbiwNCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcg0KICAgICkgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIHJldHVybiAoc3ViLnRyYW5zZmVyRnJvbSwgc3ViLnRyYW5zZmVyVG8sIHN1Yi5wcmljZVBlckhvdXIsIHN1Yi5pbml0aWFsWHJhdGVfbiwgc3ViLmluaXRpYWxYcmF0ZV9kLCBzdWIueHJhdGVQcm92aWRlcklkLCBzdWIuY2hhcmdlUGVyaW9kLCBzdWIuc3RhcnRPbiwgc3ViLmRlc2NyaXB0b3IpOw0KICAgIH0NCg0KDQogICAgLy8vQGRldiBjb252ZW5pZW5jZSBnZXR0ZXIgZm9yIHNvbWUgc3Vic2NyaXB0aW9uIGZpZWxkcw0KICAgIC8vLyAgICAgYSBjYWxsZXIgbXVzdCBrbm93LCB0aGF0IHRoZSBzdWJzY3JpcHRpb24gd2l0aCBnaXZlbiBpZCBleGlzdHMsIGJlY2F1c2UgYWxsIHRoZXNlIGZpZWxkcyBjYW4gYmUgMCBldmVuIHRoZSBzdWJzY3JpcHRpb24gd2l0aCBnaXZlbiBpZCBleGlzdHMuDQogICAgZnVuY3Rpb24gc3Vic2NyaXB0aW9uU3RhdHVzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKA0KICAgICAgICB1aW50IGRlcG9zaXRBbW91bnQsDQogICAgICAgIHVpbnQgZXhwaXJlT24sDQogICAgICAgIHVpbnQgZXhlY0NvdW50ZXIsDQogICAgICAgIHVpbnQgcGFpZFVudGlsLA0KICAgICAgICB1aW50IG9uSG9sZFNpbmNlDQogICAgKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsNCiAgICAgICAgcmV0dXJuIChzdWIuZGVwb3NpdEFtb3VudCwgc3ViLmV4cGlyZU9uLCBzdWIuZXhlY0NvdW50ZXIsIHN1Yi5wYWlkVW50aWwsIHN1Yi5vbkhvbGRTaW5jZSk7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGV4ZWN1dGUgcGVyaW9kaWMgc3Vic2NyaXB0aW9uIHBheW1lbnQuDQogICAgLy8vICAgICAgICBBbnkgb2YgY3VzdG9tZXIsIHNlcnZpY2UgcHJvdmlkZXIgYW5kIHBsYXRmb3JtIG93bmVyIGNhbiBleGVjdXRlIHRoaXMgZnVuY3Rpb24uDQogICAgLy8vICAgICAgICBUaGlzIGVuc3VyZXMsIHRoYXQgdGhlIHN1YnNjcmlwdGlvbiBjaGFyZ2UgZG9lc24ndCBiZWNvbWUgZGVsYXllZC4NCiAgICAvLy8gICAgICAgIEF0IGxlYXN0IHRoZSBwbGF0Zm9ybSBvd25lciBoYXMgYW4gaW5jZW50aXZlIHRvIGdldCBmZWUgYW5kIHRodXMgY2FuIHRyaWdnZXIgdGhlIGZ1bmN0aW9uLg0KICAgIC8vLyAgICAgICAgQW4gZXhlY3V0aW9uIGZhaWxzIGlmIHN1YnNjcmlwdGlvbiBpcyBub3QgaW4gc3RhdHVzIGBDSEFSR0VBQkxFYC4NCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gdG8gYmUgY2hhcmdlZC4NCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGV4ZWN1dGVTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vdFN1c3BlbmRlZCBub1JlZW50cmFuY3koTDAwKSByZXR1cm5zIChib29sKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICBhc3NlcnQgKG1zZy5zZW5kZXIgPT0gc3ViLnRyYW5zZmVyRnJvbSB8fCBtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlclRvIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOw0KICAgICAgICBpZiAoX3N1YnNjcmlwdGlvblN0YXRlKHN1Yik9PVN1YlN0YXRlLkNIQVJHRUFCTEUpIHsNCiAgICAgICAgICAgIHZhciBfZnJvbSA9IHN1Yi50cmFuc2ZlckZyb207DQogICAgICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87DQogICAgICAgICAgICB2YXIgX3ZhbHVlID0gX2Ftb3VudFRvQ2hhcmdlKHN1Yik7DQogICAgICAgICAgICBpZiAoc2FuLl9mdWxmaWxsUGF5bWVudChfZnJvbSwgX3RvLCBfdmFsdWUsIHN1YklkLCBtc2cuc2VuZGVyKSkgew0KICAgICAgICAgICAgICAgIHN1Yi5wYWlkVW50aWwgID0gbWF4KHN1Yi5wYWlkVW50aWwsIHN1Yi5zdGFydE9uKSArIHN1Yi5jaGFyZ2VQZXJpb2Q7DQogICAgICAgICAgICAgICAgKytzdWIuZXhlY0NvdW50ZXI7DQogICAgICAgICAgICAgICAgLy8gYSBTZXJ2aWNlUHJvdmlkZXIgKGEgU2VydmljZVByb3ZpZGVyKSBoYXMgaGVyZSBhbiBvcHBvcnR1bml0eSB0byB2ZXJpZnkgYW5kIHJlamVjdCB0aGUgcGF5bWVudA0KICAgICAgICAgICAgICAgIGFzc2VydCAoU2VydmljZVByb3ZpZGVyKF90bykub25TdWJFeGVjdXRlZChzdWJJZCkpOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0NCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgbW92ZSBgcGFpZFVudGlsYCBmb3J3YXJkIHRvIGdpdmVuIGBuZXdEdWVEYXRlYC4gSXQgd2FpdmVzIHBheW1lbnRzIGZvciBnaXZlbiB0aW1lLg0KICAgIC8vLyAgICAgICAgVGhpcyBmdW5jdGlvbiBjYW4gYmUgdXNlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIGBnaXZlIGF3YXlgIHNvbWUgc2VydmljZSB0aW1lIGZvciBmcmVlLg0KICAgIC8vL0BwYXJhbSBzdWJJZCAtIGlkIG9mIHN1YnNjcmlwdGlvbiB0byBiZSBwb3N0cG9uZWQuDQogICAgLy8vQHBhcmFtIG5ld0R1ZURhdGUgLSBuZXcgYHBhaWRVbnRpbGAgZGF0ZXRpbWU7IHJlcXVpcmUgYG5ld0R1ZURhdGUgPiBwYWlkVW50aWxgLg0KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQ0KICAgIC8vDQogICAgZnVuY3Rpb24gcG9zdHBvbmVEdWVEYXRlKHVpbnQgc3ViSWQsIHVpbnQgbmV3RHVlRGF0ZSkgcHVibGljIG5vdFN1c3BlbmRlZCByZXR1cm5zIChib29sIHN1Y2Nlc3Mpew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsNCiAgICAgICAgYXNzZXJ0IChfaXNTdWJzY3JpcHRpb24oc3ViKSk7DQogICAgICAgIGFzc2VydCAoc3ViLnRyYW5zZmVyVG8gPT0gbXNnLnNlbmRlcik7IC8vb25seSBTZXJ2aWNlIFByb3ZpZGVyIGlzIGFsbG93ZWQgdG8gcG9zdHBvbmUgdGhlIER1ZURhdGUNCiAgICAgICAgaWYgKHN1Yi5wYWlkVW50aWwgPCBuZXdEdWVEYXRlKSB7DQogICAgICAgICAgICBzdWIucGFpZFVudGlsID0gbmV3RHVlRGF0ZTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLy9AZGV2IHJldHVybiBjdXJyZW50IHN0YXR1cyBhcyBhIG5hbWUgb2YgYSBzdWJzY3JpcHRpb24gKG9yIGFuIG9mZmVyKSB3aXRoIGdpdmVuIGlkOw0KICAgIGZ1bmN0aW9uIHN0YXRlKHVpbnQgc3ViT3JPZmZlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcgc3RhdGUpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN1Yk9yT2ZmZXIgPSBzdWJzY3JpcHRpb25zW3N1Yk9yT2ZmZXJJZF07DQogICAgICAgIHJldHVybiBfaXNPZmZlcihzdWJPck9mZmVyKQ0KICAgICAgICAgICAgICA/IE9GRkVSX1NUQVRFU1t1aW50KF9vZmZlclN0YXRlKHN1Yk9yT2ZmZXIpKV0NCiAgICAgICAgICAgICAgOiBTVUJfU1RBVEVTW3VpbnQoX3N1YnNjcmlwdGlvblN0YXRlKHN1Yk9yT2ZmZXIpKV07DQogICAgfQ0KDQoNCiAgICAvLy9AZGV2IHJldHVybiBjdXJyZW50IHN0YXR1cyBhcyBhIGNvZGUgb2YgYSBzdWJzY3JpcHRpb24gKG9yIGFuIG9mZmVyKSB3aXRoIGdpdmVuIGlkOw0KICAgIGZ1bmN0aW9uIHN0YXRlQ29kZSh1aW50IHN1Yk9yT2ZmZXJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCBzdGF0ZUNvZGUpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN1Yk9yT2ZmZXIgPSBzdWJzY3JpcHRpb25zW3N1Yk9yT2ZmZXJJZF07DQogICAgICAgIHJldHVybiBfaXNPZmZlcihzdWJPck9mZmVyKQ0KICAgICAgICAgICAgICA/IHVpbnQoX29mZmVyU3RhdGUoc3ViT3JPZmZlcikpDQogICAgICAgICAgICAgIDogdWludChfc3Vic2NyaXB0aW9uU3RhdGUoc3ViT3JPZmZlcikpOw0KICAgIH0NCg0KDQogICAgZnVuY3Rpb24gX29mZmVyU3RhdGUoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKE9mZmVyU3RhdGUgc3RhdHVzKSB7DQogICAgICAgIGlmICghX2lzT2ZmZXIoc3ViKSkgew0KICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuTk9UX0VYSVNUOw0KICAgICAgICB9IGVsc2UgaWYgKHN1Yi5zdGFydE9uID4gbm93KSB7DQogICAgICAgICAgICByZXR1cm4gT2ZmZXJTdGF0ZS5CRUZPUkVfU1RBUlQ7DQogICAgICAgIH0gZWxzZSBpZiAoc3ViLm9uSG9sZFNpbmNlID4gMCkgew0KICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuT05fSE9MRDsNCiAgICAgICAgfSBlbHNlIGlmIChub3cgPD0gc3ViLmV4cGlyZU9uKSB7DQogICAgICAgICAgICByZXR1cm4gc3ViLmV4ZWNDb3VudGVyID4gMA0KICAgICAgICAgICAgICAgID8gT2ZmZXJTdGF0ZS5BQ1RJVkUNCiAgICAgICAgICAgICAgICA6IE9mZmVyU3RhdGUuU09MRF9PVVQ7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gT2ZmZXJTdGF0ZS5FWFBJUkVEOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gX3N1YnNjcmlwdGlvblN0YXRlKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhTdWJTdGF0ZSBzdGF0dXMpIHsNCiAgICAgICAgaWYgKCFfaXNTdWJzY3JpcHRpb24oc3ViKSkgew0KICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLk5PVF9FWElTVDsNCiAgICAgICAgfSBlbHNlIGlmIChzdWIuc3RhcnRPbiA+IG5vdykgew0KICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLkJFRk9SRV9TVEFSVDsNCiAgICAgICAgfSBlbHNlIGlmIChzdWIub25Ib2xkU2luY2UgPiAwKSB7DQogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuT05fSE9MRDsNCiAgICAgICAgfSBlbHNlIGlmIChzdWIucGFpZFVudGlsID49IHN1Yi5leHBpcmVPbikgew0KICAgICAgICAgICAgcmV0dXJuIG5vdyA8IHN1Yi5leHBpcmVPbg0KICAgICAgICAgICAgICAgID8gU3ViU3RhdGUuQ0FOQ0VMRUQNCiAgICAgICAgICAgICAgICA6IHN1Yi5kZXBvc2l0QW1vdW50ID4gMA0KICAgICAgICAgICAgICAgICAgICA/IFN1YlN0YXRlLkVYUElSRUQNCiAgICAgICAgICAgICAgICAgICAgOiBTdWJTdGF0ZS5GSU5BTElaRUQ7DQogICAgICAgIH0gZWxzZSBpZiAoc3ViLnBhaWRVbnRpbCA8PSBub3cpIHsNCiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5DSEFSR0VBQkxFOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLlBBSUQ7DQogICAgICAgIH0NCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgY3JlYXRlIGEgbmV3IHN1YnNjcmlwdGlvbiBvZmZlci4NCiAgICAvLy9AZGV2IG9ubHkgcmVnaXN0ZXJlZCBzZXJ2aWNlIHByb3ZpZGVyIGlzIGFsbG93ZWQgdG8gY3JlYXRlIG9mZmVycy4NCiAgICAvLy9AZGV2IHN1YnNjcmlwdGlvbiB1c2VzIFNBTiB0b2tlbiBmb3IgcGF5bWVudCwgYnV0IGFuIGV4YWN0IGFtb3VudCB0byBiZSBwYWlkIG9yIGRlcG9zaXQgaXMgY2FsY3VsYXRlZCB1c2luZyBleGNoYW5nZSByYXRlIGZyb20gZXh0ZXJuYWwgeHJhdGVQcm92aWRlciAocHJldmlvc2x5IHJlZ2lzdGVyZWQgb24gcGxhdGZvcm0pLg0KICAgIC8vLyAgICBUaGlzIGFsbG93cyB0byBjcmVhdGUgYSBzdWJzY3JpcHRpb24gYm91bmQgdG8gYW5vdGhlciB0b2tlbiBvciBldmVuIGZpYXQgY3VycmVuY3kuDQogICAgLy8vQHBhcmFtIF9wcmljZVBlckhvdXIgLSBzdWJzY3JpcHRpb24gcHJpY2UgcGVyIGhvdXIgaW4gU0FODQogICAgLy8vQHBhcmFtIF94cmF0ZVByb3ZpZGVySWQgLSBpZCBvZiBleHRlcm5hbCBleGNoYW5nZSByYXRlIHByb3ZpZGVyIGZyb20gc3Vic2NyaXB0aW9uIGN1cnJlbmN5IHRvIFNBTjsgIjAiIG1lYW5zIHN1YnNjcmlwdGlvbiBpcyBwcmljZWQgaW4gU0FOIG5hdGl2ZWx5Lg0KICAgIC8vL0BwYXJhbSBfY2hhcmdlUGVyaW9kIC0gdGltZSBwZXJpb2QgdG8gY2hhcmdlOyBzdWJzY3JpcHRpb24gY2FuJ3QgYmUgY2hhcmdlZCBtb3JlIG9mdGVuIHRoYW4gdGhpcyBwZXJpb2QuIFRpbWUgdW5pdHMgYXJlIG5hdGl2ZSBldGhlcmV1bSB0aW1lLCByZXR1cm5pbmcgYnkgYG5vd2AsIGkuZS4gc2Vjb25kcy4NCiAgICAvLy9AcGFyYW0gX2V4cGlyZU9uIC0gb2ZmZXIgY2FuJ3QgYmUgYWNjZXB0ZWQgYWZ0ZXIgdGhpcyB0aW1lLg0KICAgIC8vL0BwYXJhbSBfb2ZmZXJMaW1pdCAtIGhvdyBtYW55IHN1YnNjcmlwdGlvbiBhcmUgYXZhaWxhYmxlIHRvIGNyZWF0ZWQgZnJvbSB0aGlzIG9mZmVyOyB0aGVyZSBpcyBubyBtYWdpYyBudW1iZXIgZm9yIHVubGltaXRlZCBvZmZlciAtLSB1c2UgYmlnIG51bWJlciBpbnN0ZWFkLg0KICAgIC8vL0BwYXJhbSBfZGVwb3NpdEFtb3VudCAtIHVwZnJvbnQgZGVwb3NpdCByZXF1aXJlZCBmb3IgY3JlYXRpbmcgYSBzdWJzY3JpcHRpb247IHRoaXMgZGVwb3NpdCBiZWNvbWVzIGZ1bGx5IHJldHVybmVkIG9uIHN1YnNjcmlwdGlvbiBpcyBvdmVyLg0KICAgIC8vLyAgICAgICBjdXJyZW50bHkgdGhpcyBkZXBvc2l0IGlzIG5vdCBzdWJqZWN0IG9mIHBsYXRmb3JtIGZlZXMgYW5kIHdpbGwgYmUgcmVmdW5kZWQgaW4gZnVsbC4gTmV4dCB2ZXJzaW9ucyBvZiB0aGlzIG1vZHVsZSBjYW4gdXNlIGRlcG9zaXQgaW4gY2FzZSBvZiBvdXRzdGFuZGluZyBwYXltZW50cy4NCiAgICAvLy9AcGFyYW0gX3N0YXJ0T24gLSBhIHN1YnNjcmlwdGlvbiBmcm9tIHRoaXMgb2ZmZXIgY2FuJ3QgYmUgY3JlYXRlZCBiZWZvcmUgdGhpcyB0aW1lLiBUaW1lIHVuaXRzIGFyZSBuYXRpdmUgZXRoZXJldW0gdGltZSwgcmV0dXJuaW5nIGJ5IGBub3dgLCBpLmUuIHNlY29uZHMuDQogICAgLy8vQHBhcmFtIF9kZXNjcmlwdG9yIC0gYXJiaXRyYXJ5IGJ5dGVzIGFzIGFuIG9mZmVyIGRlc2NyaXB0b3IuIFRoaXMgZGVzY3JpcHRvciBpcyBjb3BpZWQgaW50byBzdWJzY3JpcHRpb24gYW5kIHRoZW4gc2VydmljZSBwcm92aWRlciBiZWNvbWVzIGl0IHBhc3NlZCBpbiBub3RpZmljYXRpb25zLg0KICAgIC8vDQogICAgZnVuY3Rpb24gY3JlYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBfcHJpY2VQZXJIb3VyLCB1aW50MTYgX3hyYXRlUHJvdmlkZXJJZCwgdWludCBfY2hhcmdlUGVyaW9kLCB1aW50IF9leHBpcmVPbiwgdWludCBfb2ZmZXJMaW1pdCwgdWludCBfZGVwb3NpdEFtb3VudCwgdWludCBfc3RhcnRPbiwgYnl0ZXMgX2Rlc2NyaXB0b3IpDQogICAgcHVibGljDQogICAgbm9SZWVudHJhbmN5KEwwMSkNCiAgICBvbmx5UmVnaXN0ZXJlZFByb3ZpZGVyDQogICAgbm90U3VzcGVuZGVkDQogICAgcmV0dXJucyAodWludCBzdWJJZCkgew0KICAgICAgICBhc3NlcnQgKF9zdGFydE9uIDwgX2V4cGlyZU9uKTsNCiAgICAgICAgYXNzZXJ0IChfY2hhcmdlUGVyaW9kIDw9IDEwIHllYXJzKTsgLy9zYW5pdHkgY2hlY2sNCiAgICAgICAgdmFyIChfeHJhdGVfbiwgX3hyYXRlX2QpID0gX3hyYXRlUHJvdmlkZXJJZCA9PSAwDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICgxLDEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFhSYXRlUHJvdmlkZXIoeHJhdGVQcm92aWRlcnNbX3hyYXRlUHJvdmlkZXJJZF0pLmdldFJhdGUoKTsgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgIGFzc2VydCAoX3hyYXRlX24gPiAwICYmIF94cmF0ZV9kID4gMCk7DQogICAgICAgIHN1YnNjcmlwdGlvbnNbKytzdWJzY3JpcHRpb25Db3VudGVyXSA9IFN1YnNjcmlwdGlvbiAoew0KICAgICAgICAgICAgdHJhbnNmZXJGcm9tICAgIDogMCwgICAgICAgICAgICAgICAgICAvLyBlbXB0eSB0cmFuc2ZlckZyb20gZmllbGQgbWVhbnMgd2UgaGF2ZSBhbiBvZmZlciwgbm90IGEgc3Vic2NyaXB0aW9uDQogICAgICAgICAgICB0cmFuc2ZlclRvICAgICAgOiBtc2cuc2VuZGVyLCAgICAgICAgIC8vIHNlcnZpY2UgcHJvdmlkZXIgaXMgYSBiZW5lZmljaWFyeSBvZiBzdWJzY3JpcHRvbiBwYXltZW50cw0KICAgICAgICAgICAgcHJpY2VQZXJIb3VyICAgIDogX3ByaWNlUGVySG91ciwgICAgICAvLyBwcmljZSBwZXIgaG91ciBpbiBTQU4gKHJlY2FsY3VsYXRlZCBmcm9tIGJhc2UgY3VycmVuY3kgaWYgbmVlZGVkKQ0KICAgICAgICAgICAgeHJhdGVQcm92aWRlcklkIDogX3hyYXRlUHJvdmlkZXJJZCwgICAvLyBpZCBvZiByZWdpc3RlcmVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXIgb3IgemVybyBpZiBhbiBvZmZlciBpcyBub21pbmF0ZWQgaW4gU0FOLg0KICAgICAgICAgICAgaW5pdGlhbFhyYXRlX24gIDogX3hyYXRlX24sICAgICAgICAgICAvLyBmcmFjdGlvbiBub21pbmF0b3Igb2YgdGhlIGluaXRpYWwgZXhjaGFuZ2UgcmF0ZQ0KICAgICAgICAgICAgaW5pdGlhbFhyYXRlX2QgIDogX3hyYXRlX2QsICAgICAgICAgICAvLyBmcmFjdGlvbiBkZW5vbWluYXRvciBvZiB0aGUgaW5pdGlhbCBleGNoYW5nZSByYXRlDQogICAgICAgICAgICBwYWlkVW50aWwgICAgICAgOiAwLCAgICAgICAgICAgICAgICAgIC8vIHNlcnZpY2UgaXMgY29uc2lkZXJlZCB0byBiZSBwYWlkIHVudGlsIHRoaXMgdGltZTsgbm8gY2hhcmdlIGlzIHBvc3NpYmxlIHdoaWxlIHN1YnNjcmlwdGlvbiBpcyBwYWlkIGZvciBub3cuDQogICAgICAgICAgICBjaGFyZ2VQZXJpb2QgICAgOiBfY2hhcmdlUGVyaW9kLCAgICAgIC8vIHBlcmlvZCBpbiBzZWNvbmRzIChldGhlcmV1bSBibG9jayB0aW1lIHVuaXQpIHRvIGNoYXJnZS4NCiAgICAgICAgICAgIGRlcG9zaXRBbW91bnQgICA6IF9kZXBvc2l0QW1vdW50LCAgICAgLy8gZGVwb3NpdCByZXF1aXJlZCBmb3Igc3Vic2NyaXB0aW9uIGFjY2VwdC4NCiAgICAgICAgICAgIHN0YXJ0T24gICAgICAgICA6IF9zdGFydE9uLA0KICAgICAgICAgICAgZXhwaXJlT24gICAgICAgIDogX2V4cGlyZU9uLA0KICAgICAgICAgICAgZXhlY0NvdW50ZXIgICAgIDogX29mZmVyTGltaXQsDQogICAgICAgICAgICBkZXNjcmlwdG9yICAgICAgOiBfZGVzY3JpcHRvciwNCiAgICAgICAgICAgIG9uSG9sZFNpbmNlICAgICA6IDAgICAgICAgICAgICAgICAgICAgLy8gb2ZmZXIgaXMgbm90IG9uIGhvbGQgYnkgZGVmYXVsdC4NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBzdWJzY3JpcHRpb25Db3VudGVyOyAgICAgICAgICAgICAgIC8vIHJldHVybnMgYW4gaWQgb2YgdGhlIG5ldyBvZmZlci4NCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgdXBkYXRlcyBjdXJyZW50bHkgYXZhaWxhYmxlIG51bWJlciBvZiBzdWJzY3JpcHRpb24gZm9yIHRoaXMgb2ZmZXIuDQogICAgLy8vICAgICAgICBPdGhlciBvZmZlcidzIHBhcmFtZXRlciBjYW4ndCBiZSB1cGRhdGVkIGJlY2F1c2UgdGhleSBhcmUgY29uc2lkZXJlZCB0byBiZSBhIHB1YmxpYyBvZmZlciByZXZpZXdlZCBieSBjdXN0b21lcnMuDQogICAgLy8vICAgICAgICBUaGUgc2VydmljZSBwcm92aWRlciBzaG91bGQgcmVjcmVhdGUgdGhlIG9mZmVyIGFzIGEgbmV3IG9uZSBpbiBjYXNlIG9mIG90aGVyIGNoYW5nZXMuDQogICAgLy8NCiAgICBmdW5jdGlvbiB1cGRhdGVTdWJzY3JpcHRpb25PZmZlcih1aW50IF9vZmZlcklkLCB1aW50IF9vZmZlckxpbWl0KSBwdWJsaWMgbm90U3VzcGVuZGVkIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW19vZmZlcklkXTsNCiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOw0KICAgICAgICBhc3NlcnQgKG9mZmVyLnRyYW5zZmVyVG8gPT0gbXNnLnNlbmRlcik7IC8vb25seSBQcm92aWRlciBpcyBhbGxvd2VkIHRvIHVwZGF0ZSB0aGUgb2ZmZXIuDQogICAgICAgIG9mZmVyLmV4ZWNDb3VudGVyID0gX29mZmVyTGltaXQ7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGFjY2VwdCBnaXZlbiBvZmZlciBhbmQgY3JlYXRlIGEgbmV3IHN1YnNjcmlwdGlvbiBvbiB0aGUgYmFzZSBvZiBpdC4NCiAgICAvLy8NCiAgICAvLy9AZGV2IHRoZSBzZXJ2aWNlIHByb3ZpZGVyIChvZmZlci5gdHJhbnNmZXJUb2ApIGJlY29tZXMgbm90aWZpZWQgYWJvdXQgbmV3IHN1YnNjcmlwdGlvbiBieSBjYWxsIGBvblN1Yk5ldyhuZXdTdWJJZCwgX29mZmVySWQpYC4NCiAgICAvLy8gICAgIEl0IGlzIHByb3ZpZGVyJ3MgcmVzcG9uc2liaWxpdHkgdG8gcmV0cmlldmUgYW5kIHN0b3JlIGFueSBuZWNlc3NhcnkgaW5mb3JtYXRpb24gYWJvdXQgb2ZmZXIgYW5kIHRoaXMgbmV3IHN1YnNjcmlwdGlvbi4gU29tZSBvZiBpbmZvIGlzIG9ubHkgYXZhaWxhYmxlIGF0IHRoaXMgcG9pbnQuDQogICAgLy8vICAgICBUaGUgU2VydmljZSBQcm92aWRlciBjYW4gYWxzbyByZWplY3QgdGhlIG5ldyBzdWJzY3JpcHRpb24gYnkgdGhyb3dpbmcgYW4gZXhjZXB0aW9uIG9yIHJldHVybmluZyBgZmFsc2VgIGZyb20gYG9uU3ViTmV3KG5ld1N1YklkLCBfb2ZmZXJJZClgIGV2ZW50IGhhbmRsZXIuDQogICAgLy8vQHBhcmFtIF9vZmZlcklkICAgLSBpZCBvZiB0aGUgb2ZmZXIgdG8gYmUgYWNjZXB0ZWQNCiAgICAvLy9AcGFyYW0gX2V4cGlyZU9uICAtIHN1YnNjcmlwdGlvbiBleHBpcmF0aW9uIHRpbWU7IG5vIGNoYXJnZXMgYXJlIHBvc3NpYmxlIGJlaGluZCB0aGlzIHRpbWUuDQogICAgLy8vQHBhcmFtIF9zdGFydE9uICAgLSBzdWJzY3JpcHRpb24gc3RhcnQgdGltZTsgbm8gY2hhcmdlcyBhcmUgcG9zc2libGUgYmVmb3JlIHRoaXMgdGltZS4NCiAgICAvLy8gICAgICAgICAgICAgICAgICAgIElmIHRoZSBgX3N0YXJ0T25gIGlzIGluIHRoZSBwYXN0IG9yIGlzIHplcm8sIGl0IG1lYW5zIHN0YXJ0IHRoZSBzdWJzY3JpcHRpb24gQVNBUC4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbih1aW50IF9vZmZlcklkLCB1aW50IF9leHBpcmVPbiwgdWludCBfc3RhcnRPbikgcHVibGljIG5vdFN1c3BlbmRlZCBub1JlZW50cmFuY3koTDAyKSByZXR1cm5zICh1aW50IG5ld1N1YklkKSB7DQogICAgICAgIGFzc2VydCAoX3N0YXJ0T24gPCBfZXhwaXJlT24pOw0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbX29mZmVySWRdOw0KICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7DQogICAgICAgIGFzc2VydCAob2ZmZXIuc3RhcnRPbiA9PSAwICAgICB8fCBvZmZlci5zdGFydE9uICA8PSBub3cpOw0KICAgICAgICBhc3NlcnQgKG9mZmVyLmV4cGlyZU9uID09IDAgICAgfHwgb2ZmZXIuZXhwaXJlT24gPj0gbm93KTsNCiAgICAgICAgYXNzZXJ0IChvZmZlci5vbkhvbGRTaW5jZSA9PSAwKTsNCiAgICAgICAgYXNzZXJ0IChvZmZlci5leGVjQ291bnRlciA+IDApOw0KICAgICAgICAtLW9mZmVyLmV4ZWNDb3VudGVyOw0KICAgICAgICBuZXdTdWJJZCA9ICsrc3Vic2NyaXB0aW9uQ291bnRlcjsNCiAgICAgICAgLy9jcmVhdGUgYSBjbG9uZSBvZiB0aGUgb2ZmZXIuLi4NCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2UgbmV3U3ViID0gc3Vic2NyaXB0aW9uc1tuZXdTdWJJZF0gPSBvZmZlcjsNCiAgICAgICAgLy8uLi4gYW5kIGFkanVzdCBzb21lIGZpZWxkcyBzcGVjaWZpYyB0byBzdWJzY3JpcHRpb24NCiAgICAgICAgbmV3U3ViLnRyYW5zZmVyRnJvbSA9IG1zZy5zZW5kZXI7DQogICAgICAgIG5ld1N1Yi5leGVjQ291bnRlciA9IDA7DQogICAgICAgIG5ld1N1Yi5wYWlkVW50aWwgPSBuZXdTdWIuc3RhcnRPbiA9IG1heChfc3RhcnRPbiwgbm93KTsgICAgIC8vbm8gZGVidHMgYmVmb3JlIGFjdHVhbCBjcmVhdGlvbiB0aW1lIQ0KICAgICAgICBuZXdTdWIuZXhwaXJlT24gPSBfZXhwaXJlT247DQogICAgICAgIG5ld1N1Yi5kZXBvc2l0QW1vdW50ID0gX2FwcGx5WGNoYW5nZVJhdGUobmV3U3ViLmRlcG9zaXRBbW91bnQsIG5ld1N1Yik7ICAgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kNCiAgICAgICAgLy9kZXBvc2l0QW1vdW50IGlzIG5vdyBzdG9yZWQgaW4gdGhlIHN1Yiwgc28gYnVybiB0aGUgc2FtZSBhbW91bnQgZnJvbSBjdXN0b21lcidzIGFjY291bnQuDQogICAgICAgIGFzc2VydCAoc2FuLl9idXJuRm9yRGVwb3NpdChtc2cuc2VuZGVyLCBuZXdTdWIuZGVwb3NpdEFtb3VudCkpOw0KICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihuZXdTdWIudHJhbnNmZXJUbykub25TdWJOZXcobmV3U3ViSWQsIF9vZmZlcklkKSk7ICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5OyBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBzdGlsbCByZWplY3QgdGhlIG5ldyBzdWJzY3JpcHRpb24gaGVyZQ0KDQogICAgICAgIE5ld1N1YnNjcmlwdGlvbihuZXdTdWIudHJhbnNmZXJGcm9tLCBuZXdTdWIudHJhbnNmZXJUbywgX29mZmVySWQsIG5ld1N1YklkKTsNCiAgICAgICAgcmV0dXJuIG5ld1N1YklkOw0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjYW5jZWwgYW4gb2ZmZXIgZ2l2ZW4gYnkgYG9mZmVySWRgLg0KICAgIC8vL0BkZXYgc2V0cyBvZmZlci5gZXhwaXJlT25gIHRvIGBleHBpcmVPbmAuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbb2ZmZXJJZF07DQogICAgICAgIGFzc2VydCAoX2lzT2ZmZXIob2ZmZXIpKTsNCiAgICAgICAgYXNzZXJ0IChvZmZlci50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzZXJ2aWNlIHByb3ZpZGVyIG9yIHBsYXRmb3JtIG93bmVyIGlzIGFsbG93ZWQgdG8gY2FuY2VsIHRoZSBvZmZlcg0KICAgICAgICBpZiAob2ZmZXIuZXhwaXJlT24+bm93KXsNCiAgICAgICAgICAgIG9mZmVyLmV4cGlyZU9uID0gbm93Ow0KICAgICAgICAgICAgT2ZmZXJDYW5jZWxlZChvZmZlcklkLCBtc2cuc2VuZGVyKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0NCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgY2FuY2VsIGFuIHN1YnNjcmlwdGlvbiBnaXZlbiBieSBgc3ViSWRgIChhIGdyYWNlZnVsIHZlcnNpb24pLg0KICAgIC8vL0Bub3RpY2UgSU1QT1JUQU5UOiBhIG1hbGljaW91cyBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBjb25zdW1lIGFsbCBnYXMgYW5kIHByZXZlbnRpbmcgc3Vic2NyaXB0aW9uIGZyb20gY2FuY2VsbGF0aW9uLg0KICAgIC8vLyAgICAgICAgSWYgc28sIHVzZSBgY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSlgIGFzIHRoZSBmb3JjZWQgdmVyc2lvbi4NCiAgICAvLy8gICAgICAgICBzZWUgYGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkLCB1aW50IGdhc1Jlc2VydmUpYCBmb3IgbW9yZSBkb2N1bWVudGF0aW9uLg0KICAgIC8vDQogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgew0KICAgICAgICByZXR1cm4gY2FuY2VsU3Vic2NyaXB0aW9uKHN1YklkLCAwKTsNCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgY2FuY2VsIGFuIHN1YnNjcmlwdGlvbiBnaXZlbiBieSBgc3ViSWRgIChhIGZvcmNlZCB2ZXJzaW9uKS4NCiAgICAvLy8gICAgICAgIENhbmNlbGxhdGlvbiBtZWFucyBubyBmdXJ0aGVyIGNoYXJnZXMgdG8gdGhpcyBzdWJzY3JpcHRpb24gYXJlIHBvc3NpYmxlLiBUaGUgcHJvdmlkZWQgc3Vic2NyaXB0aW9uIGRlcG9zaXQgY2FuIGJlIHdpdGhkcmF3biBvbmx5IGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyLg0KICAgIC8vLyAgICAgICAgRGVwZW5kaW5nIG9uIG5hdHVyZSBvZiB0aGUgc2VydmljZSBwcm92aWRlZCwgdGhlIHNlcnZpY2UgcHJvdmlkZXIgY2FuIGFsbG93IGFuIGltbWVkaWF0ZSBkZXBvc2l0IHdpdGhkcmF3YWwgYnkgYHJldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQpYCBjYWxsLCBidXQgaXRzIG9uIGhpcyBvd24uDQogICAgLy8vICAgICAgICBJbiBzb21lIGJ1c2luZXNzIGNhc2VzIGEgZGVwb3NpdCBtdXN0IHJlbWFpbiBsb2NrZWQgdW50aWwgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIgZXZlbiwgdGhlIHN1YnNjcmlwdGlvbiBpcyBhbHJlYWR5IGNhbmNlbGVkLg0KICAgIC8vL0Bub3RpY2UgZ2FzUmVzZXJ2ZSBpcyBhIGdhcyBhbW91bnQgcmVzZXJ2ZWQgZm9yIGNvbnRyYWN0IGV4ZWN1dGlvbiBBRlRFUiBzZXJ2aWNlIHByb3ZpZGVyIGJlY29tZXMgYG9uU3ViQ2FuY2VsZWQodWludDI1NixhZGRyZXNzKWAgbm90aWZpY2F0aW9uLg0KICAgIC8vLyAgICAgICAgSXQgZ3VhcmFudGVlcywgdGhhdCBjYW5jZWxsYXRpb24gYmVjb21lcyBleGVjdXRlZCBldmVuIGEgKG1hbGljaW91cykgc2VydmljZSBwcm92aWRlciBjb25zdW1lcyBhbGwgZ2FzIHByb3ZpZGVkLg0KICAgIC8vLyAgICAgICAgSWYgc28sIHVzZSBgY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSlgIGFzIHRoZSBmb3JjZWQgdmVyc2lvbi4NCiAgICAvLy8gICAgICAgIFRoaXMgZGlmZmVyZW5jZSBpcyBiZWNhdXNlIHRoZSBjdXN0b21lciBtdXN0IGFsd2F5cyBoYXZlIGEgcG9zc2liaWxpdHkgdG8gY2FuY2VsIGhpcyBjb250cmFjdCBldmVuIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGRpc2FncmVlIG9uIGNhbmNlbGxhdGlvbi4NCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gdG8gYmUgY2FuY2VsbGVkDQogICAgLy8vQHBhcmFtIGdhc1Jlc2VydmUgLSBnYXMgcmVzZXJ2ZWQgZm9yIGNhbGwgZmluYWxpemF0aW9uIChtaW5pbXVtIHJlc2VydmF0aW9uIGlzIDEwMDAwIGdhcykNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkLCB1aW50IGdhc1Jlc2VydmUpIHB1YmxpYyBub3RTdXNwZW5kZWQgbm9SZWVudHJhbmN5KEwwMykgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsNCiAgICAgICAgYXNzZXJ0IChzdWIudHJhbnNmZXJGcm9tID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzdWJzY3JpcHRpb24gb3duZXIgb3IgcGxhdGZvcm0gb3duZXIgaXMgYWxsb3dlZCB0byBjYW5jZWwgaXQNCiAgICAgICAgYXNzZXJ0IChfaXNTdWJzY3JpcHRpb24oc3ViKSk7DQogICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsNCiAgICAgICAgc3ViLmV4cGlyZU9uID0gbWF4KG5vdywgc3ViLnBhaWRVbnRpbCk7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IF90bykgew0KICAgICAgICAgICAgLy9zdXByZXNzIHJlLXRocm93aW5nIG9mIGV4Y2VwdGlvbnM7IHJlc2VydmUgZW5vdWdoIGdhcyB0byBmaW5pc2ggdGhpcyBmdW5jdGlvbg0KICAgICAgICAgICAgZ2FzUmVzZXJ2ZSA9IG1heChnYXNSZXNlcnZlLDEwMDAwKTsgIC8vcmVzZXJ2ZSBtaW5pbXVtIDEwMDAwIGdhcw0KICAgICAgICAgICAgYXNzZXJ0IChtc2cuZ2FzID4gZ2FzUmVzZXJ2ZSk7ICAgICAgIC8vc2FuaXR5IGNoZWNrDQogICAgICAgICAgICBpZiAoX3RvLmNhbGwuZ2FzKG1zZy5nYXMtZ2FzUmVzZXJ2ZSkoYnl0ZXM0KHNoYTMoIm9uU3ViQ2FuY2VsZWQodWludDI1NixhZGRyZXNzKSIpKSwgc3ViSWQsIG1zZy5zZW5kZXIpKSB7ICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kNCiAgICAgICAgICAgICAgICAvL2RvIG5vdGhpbmcuIGl0IGlzIG5vdGlmaWNhdGlvbiBvbmx5Lg0KICAgICAgICAgICAgICAgIC8vTGF0ZXI6IGlzIGl0IHBvc3NpYmxlIHRvIGV2YWx1YXRlIHJldHVybiB2YWx1ZSBoZXJlPyBJZiBpcyBiZXR0ZXIgdG8gcmV0dXJuIHRoZSBzdWJzY3JpcHRpb24gZGVwb3NpdCBoZXJlLg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIFN1YkNhbmNlbGVkKHN1YklkLCBtc2cuc2VuZGVyKTsNCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgcGxhY2UgYW4gYWN0aXZlIG9mZmVyIG9uIGhvbGQ7IGl0IG1lYW5zIG5vIHN1YnNjcmlwdGlvbnMgY2FuIGJlIGNyZWF0ZWQgZnJvbSB0aGlzIG9mZmVyLg0KICAgIC8vLyAgICAgICAgT25seSBzZXJ2aWNlIHByb3ZpZGVyIChvciBwbGF0Zm9ybSBvd25lcikgaXMgYWxsb3dlZCB0byBob2xkL3VuaG9sZCBhIHN1YnNjcmlwdGlvbiBvZmZlci4NCiAgICAvLy9AcGFyYW0gb2ZmZXJJZCAtIGlkIG9mIHRoZSBvZmZlciB0byBiZSBwbGFjZWQgb24gaG9sZC4NCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tvZmZlcklkXTsNCiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOw0KICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IG9mZmVyLnRyYW5zZmVyVG8gfHwgbXNnLnNlbmRlciA9PSBvd25lcik7IC8vb25seSBvd25lciBvciBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBwbGFjZSB0aGUgb2ZmZXIgb24gaG9sZC4NCiAgICAgICAgaWYgKG9mZmVyLm9uSG9sZFNpbmNlID09IDApIHsNCiAgICAgICAgICAgIG9mZmVyLm9uSG9sZFNpbmNlID0gbm93Ow0KICAgICAgICAgICAgT2ZmZXJPbkhvbGQob2ZmZXJJZCwgdHJ1ZSwgbXNnLnNlbmRlcik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIHJlc3VtZSBvbi1ob2xkIG9mZmVyOyBzdWJzY3JpcHRpb25zIGNhbiBiZSBjcmVhdGVkIGZyb20gdGhpcyBvZmZlciBhZ2FpbiAoaWYgb3RoZXIgY29uZGl0aW9ucyBhcmUgbWV0KS4NCiAgICAvLy8gICAgICAgIE9ubHkgc2VydmljZSBwcm92aWRlciAob3IgcGxhdGZvcm0gb3duZXIpIGlzIGFsbG93ZWQgdG8gaG9sZC91bmhvbGQgYSBzdWJzY3JpcHRpb24gb2ZmZXIuDQogICAgLy8vQHBhcmFtIG9mZmVySWQgLSBpZCBvZiB0aGUgb2ZmZXIgdG8gYmUgcmVzdW1lZC4NCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIG5vdFN1c3BlbmRlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW29mZmVySWRdOw0KICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7DQogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb2ZmZXIudHJhbnNmZXJUbyB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsgLy9vbmx5IG93bmVyIG9yIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlYWN0aXZhdGUgdGhlIG9mZmVyLg0KICAgICAgICBpZiAob2ZmZXIub25Ib2xkU2luY2UgPiAwKSB7DQogICAgICAgICAgICBvZmZlci5vbkhvbGRTaW5jZSA9IDA7DQogICAgICAgICAgICBPZmZlck9uSG9sZChvZmZlcklkLCBmYWxzZSwgbXNnLnNlbmRlcik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNhbGxlZCBieSBjdXN0b21lciBvciBzZXJ2aWNlIHByb3ZpZGVyIHRvIHBsYWNlIGEgc3Vic2NyaXB0aW9uIG9uIGhvbGQuDQogICAgLy8vICAgICAgICBJZiBjYWxsIGlzIG9yaWdpbmF0ZWQgYnkgY3VzdG9tZXIgdGhlIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlamVjdCB0aGUgcmVxdWVzdC4NCiAgICAvLy8gICAgICAgIEEgc3Vic2NyaXB0aW9uIG9uIGhvbGQgd2lsbCBub3QgYmUgY2hhcmdlZC4gVGhlIHNlcnZpY2UgaXMgdXN1YWxseSBub3QgcHJvdmlkZWQgYXMgd2VsbC4NCiAgICAvLy8gICAgICAgIER1cmluZyBob2xkIHRpbWUgYSBzdWJzY3JpcHRpb24gcHJlc2VydmUgcmVtYWluaW5nIHBhaWQgdGltZSBwZXJpb2QsIHdoaWNoIGJlY29tZXMgYXZhaWxhYmxlIGFmdGVyIHVuaG9sZC4NCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vdFN1c3BlbmRlZCBub1JlZW50cmFuY3koTDA0KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOw0KICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87DQogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gX3RvIHx8IG1zZy5zZW5kZXIgPT0gc3ViLnRyYW5zZmVyRnJvbSk7IC8vb25seSBjdXN0b21lciBvciBwcm92aWRlciBjYW4gcGxhY2UgdGhlIHN1YnNjcmlwdGlvbiBvbiBob2xkLg0KICAgICAgICBpZiAoc3ViLm9uSG9sZFNpbmNlID09IDApIHsNCiAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyID09IF90byB8fCBTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblN1YlVuSG9sZChzdWJJZCwgbXNnLnNlbmRlciwgdHJ1ZSkpIHsgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgICAgICAgICAgc3ViLm9uSG9sZFNpbmNlID0gbm93Ow0KICAgICAgICAgICAgICAgIFN1Yk9uSG9sZChzdWJJZCwgdHJ1ZSwgbXNnLnNlbmRlcik7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb3Igc2VydmljZSBwcm92aWRlciB0byB1bmhvbGQgc3Vic2NyaXB0aW9uLg0KICAgIC8vLyAgICAgICAgSWYgY2FsbCBpcyBvcmlnaW5hdGVkIGJ5IGN1c3RvbWVyIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGNhbiByZWplY3QgdGhlIHJlcXVlc3QuDQogICAgLy8vICAgICAgICBBIHN1YnNjcmlwdGlvbiBvbiBob2xkIHdpbGwgbm90IGJlIGNoYXJnZWQuIFRoZSBzZXJ2aWNlIGlzIHVzdWFsbHkgbm90IHByb3ZpZGVkIGFzIHdlbGwuDQogICAgLy8vICAgICAgICBEdXJpbmcgaG9sZCB0aW1lIGEgc3Vic2NyaXB0aW9uIHByZXNlcnZlIHJlbWFpbmluZyBwYWlkIHRpbWUgcGVyaW9kLCB3aGljaCBiZWNvbWVzIGF2YWlsYWJsZSBhZnRlciB1bmhvbGQuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vdFN1c3BlbmRlZCBub1JlZW50cmFuY3koTDA1KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOw0KICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87DQogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gX3RvIHx8IG1zZy5zZW5kZXIgPT0gc3ViLnRyYW5zZmVyRnJvbSk7IC8vb25seSBjdXN0b21lciBvciBwcm92aWRlciBjYW4gcGxhY2UgdGhlIHN1YnNjcmlwdGlvbiBvbiBob2xkLg0KICAgICAgICBpZiAoc3ViLm9uSG9sZFNpbmNlID4gMCkgew0KICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gX3RvIHx8IFNlcnZpY2VQcm92aWRlcihfdG8pLm9uU3ViVW5Ib2xkKHN1YklkLCBtc2cuc2VuZGVyLCBmYWxzZSkpIHsgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kNCiAgICAgICAgICAgICAgICBzdWIucGFpZFVudGlsICs9IG5vdyAtIHN1Yi5vbkhvbGRTaW5jZTsNCiAgICAgICAgICAgICAgICBzdWIub25Ib2xkU2luY2UgPSAwOw0KICAgICAgICAgICAgICAgIFN1Yk9uSG9sZChzdWJJZCwgZmFsc2UsIG1zZy5zZW5kZXIpOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0NCiAgICB9DQoNCg0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgICAgICAgICAgIGRlcG9zaXQgaGFuZGxpbmcgICAgICAgICAgICAgICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICAvLy9Abm90aWNlIGNhbiBiZSBjYWxsZWQgYnkgcHJvdmlkZXIgb24gQ0FOQ0VMRUQgc3Vic2NyaXB0aW9uIHRvIHJldHVybiBhIHN1YnNjcmlwdGlvbiBkZXBvc2l0IHRvIGN1c3RvbWVyIGltbWVkaWF0ZWx5Lg0KICAgIC8vLyAgICAgICAgQ3VzdG9tZXIgY2FuIGFueXdheSBjb2xsZWN0IGhpcyBkZXBvc2l0IGFmdGVyIGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyLg0KICAgIC8vL0BwYXJhbSBzdWJJZCAtIHN1YnNjcmlwdGlvbiBob2xkaW5nIHRoZSBkZXBvc2l0DQogICAgLy8NCiAgICBmdW5jdGlvbiByZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIGFzc2VydCAoX3N1YnNjcmlwdGlvblN0YXRlKHN1YikgPT0gU3ViU3RhdGUuQ0FOQ0VMRUQpOw0KICAgICAgICBhc3NlcnQgKHN1Yi5kZXBvc2l0QW1vdW50ID4gMCk7IC8vc2FuaXR5IGNoZWNrDQogICAgICAgIGFzc2VydCAoc3ViLnRyYW5zZmVyVG8gPT0gbXNnLnNlbmRlciB8fCBvd25lciA9PSBtc2cuc2VuZGVyKTsgLy9vbmx5IHN1YnNjcmlwdGlvbiBvd25lciBvciBwbGF0Zm9ybSBvd25lciBpcyBhbGxvd2VkIHRvIHJlbGVhc2UgZGVwb3NpdC4NCiAgICAgICAgc3ViLmV4cGlyZU9uID0gbm93Ow0KICAgICAgICBfcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQoc3ViSWQsIHN1Yik7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNhbGxlZCBieSBjdXN0b21lciBvbiBFWFBJUkVEIHN1YnNjcmlwdGlvbiAoYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIpIHRvIGNvbGxlY3QgYSBzdWJzY3JpcHRpb24gZGVwb3NpdC4NCiAgICAvLy8gICAgICAgIEN1c3RvbWVyIGNhbiBhbnl3YXkgY29sbGVjdCBoaXMgZGVwb3NpdCBhZnRlciBgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3Zlci4NCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gaG9sZGluZyB0aGUgZGVwb3NpdA0KICAgIC8vDQogICAgZnVuY3Rpb24gY2xhaW1TdWJzY3JpcHRpb25EZXBvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsNCiAgICAgICAgYXNzZXJ0IChfc3Vic2NyaXB0aW9uU3RhdGUoc3ViKSA9PSBTdWJTdGF0ZS5FWFBJUkVEKTsNCiAgICAgICAgYXNzZXJ0IChzdWIudHJhbnNmZXJGcm9tID09IG1zZy5zZW5kZXIpOw0KICAgICAgICBhc3NlcnQgKHN1Yi5kZXBvc2l0QW1vdW50ID4gMCk7DQogICAgICAgIF9yZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdChzdWJJZCwgc3ViKTsNCiAgICB9DQoNCg0KICAgIC8vQGRldiByZXR1cm5zIHN1YnNjcmlwdGlvbiBkZXBvc2l0IHRvIGN1c3RvbWVyDQogICAgZnVuY3Rpb24gX3JldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQsIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgew0KICAgICAgICB1aW50IGRlcG9zaXRBbW91bnQgPSBzdWIuZGVwb3NpdEFtb3VudDsNCiAgICAgICAgc3ViLmRlcG9zaXRBbW91bnQgPSAwOw0KICAgICAgICBzYW4uX21pbnRGcm9tRGVwb3NpdChzdWIudHJhbnNmZXJGcm9tLCBkZXBvc2l0QW1vdW50KTsNCiAgICAgICAgU3Vic2NyaXB0aW9uRGVwb3NpdFJldHVybmVkKHN1YklkLCBkZXBvc2l0QW1vdW50LCBzdWIudHJhbnNmZXJGcm9tLCBtc2cuc2VuZGVyKTsNCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgY3JlYXRlIHNpbXBsZSB1bmxvY2tlZCBkZXBvc2l0LCByZXF1aXJlZCBieSBzb21lIHNlcnZpY2VzLiBJdCBjYW4gYmUgY29uc2lkZXJlZCBhcyBwcm92ZSBvZiBjdXN0b21lcidzIHN0YWtlLg0KICAgIC8vLyAgICAgICAgVGhpcyBkZXNwb3NpdCBjYW4gYmUgY2xhaW1lZCBiYWNrIGJ5IHRoZSBjdXN0b21lciBhdCBhbnl0aW1lLg0KICAgIC8vLyAgICAgICAgVGhlIHNlcnZpY2UgcHJvdmlkZXIgaXMgcmVzcG9uc2libGUgdG8gY2hlY2sgdGhlIGRlcG9zaXQgYmVmb3JlIHByb3ZpZGluZyB0aGUgc2VydmljZS4NCiAgICAvLy9AcGFyYW0gX3ZhbHVlIC0gbm9uIHplcm8gZGVwb3NpdCBhbW91bnQuDQogICAgLy8vQHBhcmFtIF9kZXNjcmlwdG9yIC0gaXMgYSB1bmlxIGtleSwgdXN1YWxseSBnaXZlbiBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIHRoZSBjdXN0b21lciBpbiBvcmRlciB0byBtYWtlIHRoaXMgZGVwb3NpdCB1bmlxdWUuDQogICAgLy8vICAgICAgICBTZXJ2aWNlIFByb3ZpZGVyIHNob3VsZCByZWplY3QgZGVwb3NpdCB3aXRoIHVua25vd24gZGVzY3JpcHRvciwgYmVjYXVzZSBtb3N0IHByb2JhYmx5IGl0IGlzIGluIHVzZSBmb3Igc29tZSBhbm90aGVyIHNlcnZpY2UuDQogICAgLy8vQHJldHVybiBkZXBvc2l0SWQgLSBhIGhhbmRsZSB0byBjbGFpbSBiYWNrIHRoZSBkZXBvc2l0IGxhdGVyLg0KICAgIC8vDQogICAgZnVuY3Rpb24gY3JlYXRlRGVwb3NpdCh1aW50IF92YWx1ZSwgdWludCBfbG9ja1RpbWUsIGJ5dGVzIF9kZXNjcmlwdG9yKSBwdWJsaWMgbm90U3VzcGVuZGVkIHJldHVybnMgKHVpbnQgZGVwb3NpdElkKSB7DQogICAgICAgIHJlcXVpcmUgKF92YWx1ZSA+IDApOw0KICAgICAgICBhc3NlcnQgKHNhbi5fYnVybkZvckRlcG9zaXQobXNnLnNlbmRlcixfdmFsdWUpKTsNCiAgICAgICAgZGVwb3NpdHNbKytkZXBvc2l0Q291bnRlcl0gPSBEZXBvc2l0ICh7DQogICAgICAgICAgICBvd25lciA6IG1zZy5zZW5kZXIsDQogICAgICAgICAgICB2YWx1ZSA6IF92YWx1ZSwNCiAgICAgICAgICAgIGNyZWF0ZWRPbiA6IG5vdywNCiAgICAgICAgICAgIGxvY2tUaW1lIDogX2xvY2tUaW1lLA0KICAgICAgICAgICAgZGVzY3JpcHRvciA6IF9kZXNjcmlwdG9yDQogICAgICAgIH0pOw0KICAgICAgICBOZXdEZXBvc2l0KGRlcG9zaXRDb3VudGVyLCBfdmFsdWUsIF9sb2NrVGltZSwgbXNnLnNlbmRlcik7DQogICAgICAgIHJldHVybiBkZXBvc2l0Q291bnRlcjsNCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgcmV0dXJuIHByZXZpb3VzbHkgY3JlYXRlZCBkZXBvc2l0IHRvIHRoZSB1c2VyLiBVc2VyIGNhbiBjb2xsZWN0IG9ubHkgb3duIGRlcG9zaXQuDQogICAgLy8vICAgICAgICBUaGUgc2VydmljZSBwcm92aWRlciBpcyByZXNwb25zaWJsZSB0byBjaGVjayB0aGUgZGVwb3NpdCBiZWZvcmUgcHJvdmlkaW5nIHRoZSBzZXJ2aWNlLg0KICAgIC8vL0BwYXJhbSBfZGVwb3NpdElkIC0gYW4gaWQgb2YgdGhlIGRlcG9zaXQgdG8gYmUgY29sbGVjdGVkLg0KICAgIC8vDQogICAgZnVuY3Rpb24gY2xhaW1EZXBvc2l0KHVpbnQgX2RlcG9zaXRJZCkgcHVibGljIG5vdFN1c3BlbmRlZCB7DQogICAgICAgIHZhciBkZXBvc2l0ID0gZGVwb3NpdHNbX2RlcG9zaXRJZF07DQogICAgICAgIHJlcXVpcmUgKGRlcG9zaXQub3duZXIgPT0gbXNnLnNlbmRlcik7DQogICAgICAgIGFzc2VydCAoZGVwb3NpdC5sb2NrVGltZSA9PSAwIHx8IGRlcG9zaXQuY3JlYXRlZE9uICsgIGRlcG9zaXQubG9ja1RpbWUgPCBub3cpOw0KICAgICAgICB2YXIgdmFsdWUgPSBkZXBvc2l0c1tfZGVwb3NpdElkXS52YWx1ZTsNCiAgICAgICAgZGVsZXRlIGRlcG9zaXRzW19kZXBvc2l0SWRdOw0KICAgICAgICBzYW4uX21pbnRGcm9tRGVwb3NpdChtc2cuc2VuZGVyLCB2YWx1ZSk7DQogICAgICAgIERlcG9zaXRSZXR1cm5lZChfZGVwb3NpdElkLCBtc2cuc2VuZGVyKTsNCiAgICB9DQoNCg0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgICAgICAgICBzb21lIGludGVybmFsIGZ1bmN0aW9ucyAgICAgICAgICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICBmdW5jdGlvbiBfYW1vdW50VG9DaGFyZ2UoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCByZWVudHJhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gX2FwcGx5WGNoYW5nZVJhdGUoc3ViLnByaWNlUGVySG91ciAqIHN1Yi5jaGFyZ2VQZXJpb2QsIHN1YikgLyAxIGhvdXJzOyAgICAgICAvLyA8PT09PSByZWVudHJhbnQgZnVuY3Rpb24gdXNhZ2UNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfYXBwbHlYY2hhbmdlUmF0ZSh1aW50IGFtb3VudCwgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCByZWVudHJhbnQgcmV0dXJucyAodWludCkgeyAgLy8gPD09IGFjdHVhbGx5IGNhbGxlZCBmcm9tIHJlZW50cmFuY3kgZ3VhcmRlZCBjb250ZXh0IG9ubHkgKGkuZS4gZXh0ZXJuYWxseSBzZWN1cmVkKQ0KICAgICAgICBpZiAoc3ViLnhyYXRlUHJvdmlkZXJJZCA+IDApIHsNCiAgICAgICAgICAgIC8vIHhyYXRlX246IG5vbWluYXRvcg0KICAgICAgICAgICAgLy8geHJhdGVfZDogZGVub21pbmF0b3Igb2YgdGhlIGV4Y2hhbmdlIHJhdGUgZnJhY3Rpb24uDQogICAgICAgICAgICB2YXIgKHhyYXRlX24sIHhyYXRlX2QpID0gWFJhdGVQcm92aWRlcih4cmF0ZVByb3ZpZGVyc1tzdWIueHJhdGVQcm92aWRlcklkXSkuZ2V0UmF0ZSgpOyAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgICAgICBhbW91bnQgPSBhbW91bnQgKiBzdWIuaW5pdGlhbFhyYXRlX24gKiB4cmF0ZV9kIC8gc3ViLmluaXRpYWxYcmF0ZV9kIC8geHJhdGVfbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYW1vdW50Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9pc09mZmVyKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7DQogICAgICAgIHJldHVybiBzdWIudHJhbnNmZXJGcm9tID09IDAgJiYgc3ViLnRyYW5zZmVyVG8gIT0gMDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfaXNTdWJzY3JpcHRpb24oU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKXsNCiAgICAgICAgcmV0dXJuIHN1Yi50cmFuc2ZlckZyb20gIT0gMCAmJiBzdWIudHJhbnNmZXJUbyAhPSAwOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9leGlzdHMoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKXsNCiAgICAgICAgcmV0dXJuIHN1Yi50cmFuc2ZlclRvICE9IDA7ICAgLy9leGlzdGluZyBzdWJzY3JpcHRpb24gb3Igb2ZmZXIgaGFzIGFsd2F5cyB0cmFuc2ZlclRvIHNldC4NCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5UmVnaXN0ZXJlZFByb3ZpZGVyKCl7DQogICAgICAgIGlmICghcHJvdmlkZXJSZWdpc3RyeVttc2cuc2VuZGVyXSkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgbm90U3VzcGVuZGVkIHsNCiAgICAgICAgaWYgKHN1c3BlbmRlZFVudGlsID4gbm93KSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCn0gLy9TdWJzY3JpcHRpb25Nb2R1bGVJbXBs'