base 64 content
base64subscriptionModuleImpl1
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLy8gPT09PSBESVNDTEFJTUVSID09PT0NCi8vDQovLyBFVEhFUkVVTSBJUyBTVElMTCBBTiBFWFBFUkVNRU5UQUwgVEVDSE5PTE9HWS4NCi8vIEFMVEhPVUdIIFRISVMgU01BUlQgQ09OVFJBQ1QgV0FTIENSRUFURUQgV0lUSCBHUkVBVCBDQVJFIEFORCBJTiBUSEUgSE9QRSBPRiBCRUlORyBVU0VGVUwsIE5PIEdVQVJBTlRFRVMgT0YgRkxBV0xFU1MgT1BFUkFUSU9OIENBTiBCRSBHSVZFTi4NCi8vIElOIFBBUlRJQ1VMQVIgLSBTVUJUSUxFIEJVR1MsIEhBQ0tFUiBBVFRBQ0tTIE9SIE1BTEZVTkNUSU9OIE9GIFVOREVSTFlJTkcgVEVDSE5PTE9HWSBDQU4gQ0FVU0UgVU5JTlRFTlRJT05BTCBCRUhBVklPVVIuDQovLyBZT1UgQVJFIFNUUk9OR0xZIEVOQ09VUkFHRUQgVE8gU1RVRFkgVEhJUyBTTUFSVCBDT05UUkFDVCBDQVJFRlVMTFkgSU4gT1JERVIgVE8gVU5ERVJTVEFORCBQT1NTSUJMRSBFREdFIENBU0VTIEFORCBSSVNLUy4NCi8vIERPTidUIFVTRSBUSElTIFNNQVJUIENPTlRSQUNUIElGIFlPVSBIQVZFIFNVQlNUQU5USUFMIERPVUJUUyBPUiBJRiBZT1UgRE9OJ1QgS05PVyBXSEFUIFlPVSBBUkUgRE9JTkcuDQovLw0KLy8gVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQ0KLy8gQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULA0KLy8gSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwNCi8vIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLA0KLy8gT1IgVE9SVCAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4NCi8vID09PT0NCi8vDQoNCi8vLyBAYXV0aG9yIFNhbnRpbWVudCBMTEMNCi8vLyBAdGl0bGUgIFN1YnNjcmlwdGlvbiBNb2R1bGUgZm9yIFNBTiAtIHNhbnRpbWVudCB0b2tlbg0KDQpjb250cmFjdCBCYXNlIHsNCg0KICAgIGZ1bmN0aW9uIG1heCh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgeyByZXR1cm4gYSA+PSBiID8gYSA6IGI7IH0NCiAgICBmdW5jdGlvbiBtaW4odWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIGEgPD0gYiA/IGEgOiBiOyB9DQoNCiAgICBtb2RpZmllciBvbmx5KGFkZHJlc3MgYWxsb3dlZCkgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhbGxvd2VkKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCg0KICAgIC8vL0ByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QNCiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsNCiAgICAgICAgdWludCBzaXplOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAoc2l6ZSA+IDApOw0KICAgIH0NCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgIHJlZW50cmFuY3kgaGFuZGxpbmcgICAgICAgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy9AZGV2IHByZWRlZmluZWQgbG9ja3MgKHVwIHRvIHVpbnQgYml0IGxlbmd0aCwgaS5lLiAyNTYgcG9zc2libGUpDQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDAgPSAyICoqIDA7DQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDEgPSAyICoqIDE7DQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDIgPSAyICoqIDI7DQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDMgPSAyICoqIDM7DQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDQgPSAyICoqIDQ7DQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDUgPSAyICoqIDU7DQoNCiAgICAvL3ByZXZlbnRzIHJlZW50cmFuY3kgYXR0YWNzOiBzcGVjaWZpYyBsb2Nrcw0KICAgIHVpbnQgcHJpdmF0ZSBiaXRsb2NrcyA9IDA7DQogICAgbW9kaWZpZXIgbm9SZWVudHJhbmN5KHVpbnQgbSkgew0KICAgICAgICB2YXIgX2xvY2tzID0gYml0bG9ja3M7DQogICAgICAgIGlmIChfbG9ja3MgJiBtID4gMCkgdGhyb3c7DQogICAgICAgIGJpdGxvY2tzIHw9IG07DQogICAgICAgIF87DQogICAgICAgIGJpdGxvY2tzID0gX2xvY2tzOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG5vQW55UmVlbnRyYW5jeSB7DQogICAgICAgIHZhciBfbG9ja3MgPSBiaXRsb2NrczsNCiAgICAgICAgaWYgKF9sb2NrcyA+IDApIHRocm93Ow0KICAgICAgICBiaXRsb2NrcyA9IHVpbnQoLTEpOw0KICAgICAgICBfOw0KICAgICAgICBiaXRsb2NrcyA9IF9sb2NrczsNCiAgICB9DQoNCiAgICAvLy9AZGV2IGVtcHR5IG1hcmtpbmcgbW9kaWZpZXIgc2lnbmFsaW5nIHRvIHVzZXIgb2YgdGhlIG1hcmtlZCBmdW5jdGlvbiAsIHRoYXQgaXQgY2FuIGNhdXNlIGFuIHJlZW50cmFudCBjYWxsLg0KICAgIC8vLyAgICAgZGV2ZWxvcGVyIHNob3VsZCBtYWtlIHRoZSBjYWxsZXIgZnVuY3Rpb24gcmVlbnRyYW50LXNhZmUgaWYgaXQgdXNlIGEgcmVlbnRyYW50IGZ1bmN0aW9uLg0KICAgIG1vZGlmaWVyIHJlZW50cmFudCB7IF87IH0NCg0KfQ0KDQpjb250cmFjdCBPd25lZCBpcyBCYXNlIHsNCg0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyOw0KDQogICAgZnVuY3Rpb24gT3duZWQoKSB7DQogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgb25seShvd25lcikgew0KICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBvbmx5KG5ld093bmVyKSB7DQogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7DQogICAgICAgIG93bmVyID0gbmV3T3duZXI7DQogICAgfQ0KDQogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvKTsNCg0KfQ0KDQoNCmNvbnRyYWN0IEVSQzIwIGlzIE93bmVkIHsNCg0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOw0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7DQogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7DQogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsNCiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsNCiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOw0KICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsNCiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsNCiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgaXNTdGFydGVkT25seSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7DQogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICAgIH0NCg0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7DQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOw0KDQogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7DQogICAgYm9vbCAgICBwdWJsaWMgaXNTdGFydGVkID0gZmFsc2U7DQoNCiAgICBtb2RpZmllciBvbmx5SG9sZGVyKGFkZHJlc3MgaG9sZGVyKSB7DQogICAgICAgIGlmIChiYWxhbmNlT2YoaG9sZGVyKSA9PSAwKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBpc1N0YXJ0ZWRPbmx5KCkgew0KICAgICAgICBpZiAoIWlzU3RhcnRlZCkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQp9DQoNCi8vRGVjaXNpb24gbWFkZS4NCi8vIDEgLSBQcm92aWRlciBpcyBzb2xlbHkgcmVzcG9uc2libGUgdG8gY29uc2lkZXIgZmFpbGVkIHN1YiBjaGFyZ2UgYXMgYW4gZXJyb3IgYW5kIHN0b3AgdGhlIHNlcnZpY2UsDQovLyAgICB0aGVyZWZvcmUgdGhlcmUgaXMgbm8gc2VwYXJhdGUgZXJyb3Igc3RhdGUgb3IgY291bnRlciBmb3IgdGhhdCBpbiB0aGlzIFRva2VuIENvbnRyYWN0Lg0KLy8NCi8vIDIgLSBBIGNhbGwgb3JpZ2luYXRlZCBmcm9tIHRoZSB1c2VyIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpPT1mYWxzZSkgc2hvdWxkIHRocm93IGFuIGV4Y2VwdGlvbiBvbiBlcnJvciwNCi8vICAgICBidXQgaXQgc2hvdWxkIHJldHVybiAiZmFsc2UiIG9uIGVycm9yIGlmIGNhbGxlZCBmcm9tIG90aGVyIGNvbnRyYWN0IChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpPT10cnVlKS4NCi8vICAgICBSZWFzb246IHRocm93biBleGNlcHRpb24gYXJlIGVhc2llciB0byBzZWUgaW4gd2FsbGV0cywgcmV0dXJuZWQgYm9vbGVhbiB2YWx1ZXMgYXJlIGVhc2llciB0byBldmFsdWF0ZSBpbiB0aGUgY29kZSBvZiB0aGUgY2FsbGluZyBjb250cmFjdC4NCi8vDQovLyAzIC0gU2VydmljZSBwcm92aWRlcnMgYXJlIHJlc3BvbnNpYmxlIGZvciBmaXJpbmcgZXZlbnRzIGluIGNhc2Ugb2Ygb2ZmZXIgY2hhbmdlczsNCi8vICAgICBpdCBpcyB0aGVpcnMgZGVjaXNpb24gdG8gaW5mb3JtIERBcHBzIGFib3V0IG9mZmVyIGNoYW5nZXMgb3Igbm90Lg0KLy8NCg0KDQovLy9AZGV2IGFuIGJhc2UgY2xhc3MgdG8gaW1wbGVtZW50IGJ5IFNlcnZpY2UgUHJvdmlkZXIgY29udHJhY3QgdG8gYmUgbm90aWZpZWQgYWJvdXQgc3Vic2NyaXB0aW9uIGNoYW5nZXMgKGluLVR4IG5vdGlmaWNhdGlvbikuDQovLy8gICAgIEFkZGl0aW9uYWxseSBpdCBjb250YWlucyBzdGFuZGFyZCBldmVudHMgdG8gYmUgZmlyZWQgYnkgc2VydmljZSBwcm92aWRlciBvbiBvZmZlciBjaGFuZ2VzLg0KLy8vICAgICBzZWUgYWxzZSBFVk0gZXZlbnRzIGxvZ2dlZCBieSBzdWJzY3JpcHRpb24gbW9kdWxlLg0KLy8NCmNvbnRyYWN0IFNlcnZpY2VQcm92aWRlciB7DQoNCiAgICAvLy9AZGV2IGdldCBodW1hbiByZWFkYWJsZSBkZXNjcmlwdG9yIChvciB1cmwpIGZvciB0aGlzIFNlcnZpY2UgcHJvdmlkZXINCiAgICAvLw0KICAgIGZ1bmN0aW9uIGluZm8oKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhzdHJpbmcpOw0KDQogICAgLy8vQGRldiBjYWxsZWQgdG8gcG9zdC1hcHByb3ZlL3JlamVjdCBpbmNvbWluZyBzaW5nbGUgcGF5bWVudC4NCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgcGF5bWVudC4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIG9uUGF5bWVudChhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy9AZGV2IGNhbGxlZCB0byBwb3N0LWFwcHJvdmUvcmVqZWN0IHN1YnNjcmlwdGlvbiBjaGFyZ2UuDQogICAgLy8vQHJldHVybiBgZmFsc2VgIGNhdXNlcyBhbiBleGNlcHRpb24gYW5kIHJldmVydHMgdGhlIG9wZXJhdGlvbi4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIG9uU3ViRXhlY3V0ZWQodWludCBzdWJJZCkgcHVibGljIHJldHVybnMgKGJvb2wpOw0KDQogICAgLy8vQGRldiBjYWxsZWQgdG8gcG9zdC1hcHByb3ZlL3JlamVjdCBhIGNyZWF0aW9uIG9mIHRoZSBzdWJzY3JpcHRpb24uDQogICAgLy8vQHJldHVybiBgZmFsc2VgIGNhdXNlcyBhbiBleGNlcHRpb24gYW5kIHJldmVydHMgdGhlIG9wZXJhdGlvbi4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIG9uU3ViTmV3KHVpbnQgbmV3U3ViSWQsIHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wpOw0KDQogICAgLy8vQGRldiBjYWxsZWQgdG8gbm90aWZ5IHNlcnZpY2UgcHJvdmlkZXIgYWJvdXQgc3Vic2NyaXB0aW9uIGNhbmNlbGxhdGlvbi4NCiAgICAvLy8gICAgIFByb3ZpZGVyIGlzIG5vdCBhYmxlIHRvIHByZXZlbnQgdGhlIGNhbmNlbGxhdGlvbi4NCiAgICAvLy9AcmV0dXJuIDw8cmVzZXJ2ZWQgZm9yIGZ1dHVyZSBpbXBsZW1lbnRhdGlvbj4+DQogICAgLy8NCiAgICBmdW5jdGlvbiBvblN1YkNhbmNlbGVkKHVpbnQgc3ViSWQsIGFkZHJlc3MgY2FsbGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy9AZGV2IGNhbGxlZCB0byBub3RpZnkgc2VydmljZSBwcm92aWRlciBhYm91dCBzdWJzY3JpcHRpb24gZ290IGhvbGQvdW5ob2xkLg0KICAgIC8vL0ByZXR1cm4gYGZhbHNlYCBjYXVzZXMgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnRzIHRoZSBvcGVyYXRpb24uDQogICAgLy8NCiAgICBmdW5jdGlvbiBvblN1YlVuSG9sZCh1aW50IHN1YklkLCBhZGRyZXNzIGNhbGxlciwgYm9vbCBpc09uSG9sZCkgcHVibGljIHJldHVybnMgKGJvb2wpOw0KDQoNCiAgICAvLy9AZGV2IGZvbGxvd2luZyBldmVudHMgc2hvdWxkIGJlIHVzZWQgYnkgU2VydmljZVByb3ZpZGVyIGNvbnRyYWN0IHRvIG5vdGlmeSBEQXBwcyBhYm91dCBvZmZlciBjaGFuZ2VzLg0KICAgIC8vLyAgICAgU3Vic2NyaXB0aW9uTW9kdWxlIGRvIG5vdCB0aGlzIG5vdGlmaWNhdGlvbiBhbmQgZXhwZWN0cyBpdCBmcm9tIFNlcnZpY2UgUHJvdmlkZXIgaWYgZGVzaXJlZC4NCiAgICAvLy8NCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBuZXcgT2ZmZXIgY3JlYXRlZCBpbiBhIHBsYXRmb3JtLg0KICAgIGV2ZW50IE9mZmVyQ3JlYXRlZCh1aW50IG9mZmVySWQsICBieXRlcyBkZXNjcmlwdG9yLCBhZGRyZXNzIHByb3ZpZGVyKTsNCg0KICAgIC8vL0BkZXYgdG8gYmUgZmlyZWQgYnkgU2VydmljZVByb3ZpZGVyIG9uIE9mZmVyIHVwZGF0ZWQuDQogICAgZXZlbnQgT2ZmZXJVcGRhdGVkKHVpbnQgb2ZmZXJJZCwgIGJ5dGVzIGRlc2NyaXB0b3IsIHVpbnQgb2xkRXhlY0NvdW50ZXIsIGFkZHJlc3MgcHJvdmlkZXIpOw0KDQogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gT2ZmZXIgY2FuY2VsZWQuDQogICAgZXZlbnQgT2ZmZXJDYW5jZWxlZCh1aW50IG9mZmVySWQsIGJ5dGVzIGRlc2NyaXB0b3IsIGFkZHJlc3MgcHJvdmlkZXIpOw0KDQogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gT2ZmZXIgaG9sZC91bmhvbGQgc3RhdHVzIGNoYW5nZWQuDQogICAgZXZlbnQgT2ZmZXJVbkhvbGQodWludCBvZmZlcklkLCAgIGJ5dGVzIGRlc2NyaXB0b3IsIGJvb2wgaXNPbkhvbGROb3csIGFkZHJlc3MgcHJvdmlkZXIpOw0KfSAvL1NlcnZpY2VQcm92aWRlcg0KDQovLy9Abm90aWNlIFhSYXRlUHJvdmlkZXIgaXMgYW4gZXh0ZXJuYWwgc2VydmljZSBwcm92aWRpbmcgYW4gZXhjaGFuZ2UgcmF0ZSBmcm9tIGV4dGVybmFsIGN1cnJlbmN5IHRvIFNBTiB0b2tlbi4NCi8vLyBpdCB1c2VkIGZvciBzdWJzY3JpcHRpb25zIHByaWNlZCBpbiBvdGhlciBjdXJyZW5jeSB0aGFuIFNBTiAoZXZlbiBjYWxjdWxhdGVkIGFuZCBwYWlkIGZvcm1hbGx5IGluIFNBTikuDQovLy8gaWYgbm9uLWRlZmF1bHQgWFJhdGVQcm92aWRlciBpcyBzZXQgZm9yIHNvbWUgc3Vic2NyaXB0aW9uLCB0aGVuIHRoZSBhbW91bnQgaW4gU0FOIGZvciBldmVyeSBwZXJpb2RpYyBwYXltZW50DQovLy8gd2lsbCBiZSByZWNhbGN1bGF0ZWQgdXNpbmcgcHJvdmlkZWQgZXhjaGFuZ2UgcmF0ZS4NCi8vLw0KLy8vIFBsZWFzZSBub3RlLCB0aGF0IHRoZSBleGNoYW5nZSByYXRlIGZyYWN0aW9uIGlzICh1aW50MzIsdWludDMyKSBudW1iZXIuIEl0IHNob3VsZCBiZSBlbm91Z2ggdG8gZXhwcmVzcw0KLy8vIGFueSByZWFsIGV4Y2hhbmdlIHJhdGUgdm9sYXRpbGl0eS4gTmV2ZXJ0aGVsZXNzIHlvdSBhcmUgYWR2aXNlZCB0byBhdm9pZCB0b28gYmlnIG51bWJlcnMgaW4gdGhlIGZyYWN0aW9uLg0KLy8vIFBvc3NpaWJseSB5b3UgY291bGQgaW1wbGVtZW50IHRoZSByYXRpbyBvZiBtdWx0aXBsZSB0b2tlbiBwZXIgU0FOIGluIG9yZGVyIHRvIGtlZXAgdGhlIGF2ZXJhZ2UgcmF0aW8gYXJvdW5kIDE6MS4NCi8vLw0KLy8vIFRoZSBkZWZhdWx0IFhSYXRlUHJvdmlkZXIgKHdpdGggaWQ9PTApIGRlZmluZXMgZXhjaGFuZ2UgcmF0ZSAxOjEgYW5kIHJlcHJlc2VudHMgZXhjaGFuZ2UgcmF0ZSBvZiBTQU4gdG9rZW4gdG8gaXRzZWxmLg0KLy8vIHRoaXMgcHJvdmlkZXIgaXMgc2V0IGJ5IGRlZmFsdWx0IGFuZCB0aHVzIHRoZSBzdWJzY3JpcHRpb24gYmVjb21lcyBub21pbmF0ZWQgaW4gU0FOLg0KLy8NCmNvbnRyYWN0IFhSYXRlUHJvdmlkZXIgew0KDQogICAgLy9AZGV2IHJldHVybnMgY3VycmVudCBleGNoYW5nZSByYXRlIChpbiBmb3JtIG9mIGEgc2ltcGxlIGZyYWN0aW9uKSBmcm9tIG90aGVyIGN1cnJlbmN5IHRvIFNBTiAoZi5lLiBFVEg6U0FOKS4NCiAgICAvL0BkZXYgZnJhY3Rpb24gbnVtYmVycyBhcmUgcmVzdHJpY3RlZCB0byB1aW50MTYgdG8gcHJldmVudCBvdmVyZmxvdyBpbiBjYWxjdWxhdGlvbnM7DQogICAgZnVuY3Rpb24gZ2V0UmF0ZSgpIHB1YmxpYyByZXR1cm5zICh1aW50MzIgLypub21pbmF0b3IqLywgdWludDMyIC8qZGVub21pbmF0b3IqLyk7DQoNCiAgICAvL0BkZXYgcHJvdmlkZXMgYSBjb2RlIGZvciBhbm90aGVyIGN1cnJlbmN5LCBmLmUuICJFVEgiIG9yICJVU0QiDQogICAgZnVuY3Rpb24gZ2V0Q29kZSgpIHB1YmxpYyByZXR1cm5zIChzdHJpbmcpOw0KfQ0KDQoNCi8vQGRldiBkYXRhIHN0cnVjdHVyZSBmb3IgU3Vic2NyaXB0aW9uTW9kdWxlDQpjb250cmFjdCBTdWJzY3JpcHRpb25CYXNlIHsNCg0KICAgIGVudW0gU3ViU3RhdGUgICB7Tk9UX0VYSVNULCBCRUZPUkVfU1RBUlQsIFBBSUQsIENIQVJHRUFCTEUsIE9OX0hPTEQsIENBTkNFTEVELCBFWFBJUkVELCBGSU5BTElaRUR9DQogICAgZW51bSBPZmZlclN0YXRlIHtOT1RfRVhJU1QsIEJFRk9SRV9TVEFSVCwgQUNUSVZFLCBTT0xEX09VVCwgT05fSE9MRCwgRVhQSVJFRH0NCg0KICAgIHN0cmluZ1tdIGludGVybmFsIFNVQl9TVEFURVMgICA9IFsiTk9UX0VYSVNUIiwgIkJFRk9SRV9TVEFSVCIsICJQQUlEIiwgIkNIQVJHRUFCTEUiLCAiT05fSE9MRCIsICJDQU5DRUxFRCIsICJFWFBJUkVEIiwgIkZJTkFMSVpFRCIgXTsNCiAgICBzdHJpbmdbXSBpbnRlcm5hbCBPRkZFUl9TVEFURVMgPSBbIk5PVF9FWElTVCIsICJCRUZPUkVfU1RBUlQiLCAiQUNUSVZFIiwgIlNPTERfT1VUIiwgIk9OX0hPTEQiLCAiRVhQSVJFRCJdOw0KDQogICAgLy9AZGV2IHN1YnNjcmlwdGlvbiBhbmQgc3Vic2NyaXB0aW9uIG9mZmVyIHVzZSB0aGUgc2FtZSBzdHJ1Y3R1cmUuIE9mZmVyIGlzIHRlY2huaWNhbGx5IGEgdGVtcGxhdGUgZm9yIHN1YnNjcmlwdGlvbi4NCiAgICBzdHJ1Y3QgU3Vic2NyaXB0aW9uIHsNCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlckZyb207ICAgLy8gY3VzdG9tZXIgKHVuc2V0IGluIHN1YnNjcmlwdGlvbiBvZmZlcikNCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlclRvOyAgICAgLy8gc2VydmljZSBwcm92aWRlcg0KICAgICAgICB1aW50IHByaWNlUGVySG91cjsgICAgICAvLyBwcmljZSBpbiBTQU4gcGVyIGhvdXIgKHBvc3NpYmx5IHJlY2FsY3VsYXRlZCB1c2luZyBleGNoYW5nZSByYXRlKQ0KICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX247ICAvLyBub21pbmF0b3INCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9kOyAgLy8gZGVub21pbmF0b3INCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZDsgLy8gaWQgb2YgYSByZWdpc3RlcmVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXINCiAgICAgICAgdWludCBwYWlkVW50aWw7ICAgICAgICAgLy8gc3Vic2NyaXB0aW9uIGlzIHBhaWQgdW50aWwgdGltZQ0KICAgICAgICB1aW50IGNoYXJnZVBlcmlvZDsgICAgICAvLyBzdWJzY3JpcHRpb24gY2FuJ3QgYmUgY2hhcmdlZCBtb3JlIG9mdGVuIHRoYW4gdGhpcyBwZXJpb2QNCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50OyAgICAgLy8gdXBmcm9udCBkZXBvc2l0IG9uIGNyZWF0aW5nIHN1YnNjcmlwdGlvbiAocG9zc2libHkgcmVjYWxjdWxhdGVkIHVzaW5nIGV4Y2hhbmdlIHJhdGUpDQoNCiAgICAgICAgdWludCBzdGFydE9uOyAgICAgICAgICAgLy8gZm9yIG9mZmVyOiBjYW4ndCBiZSBhY2NlcHRlZCBiZWZvcmUgIDxzdGFydE9uPiA7IGZvciBzdWJzY3JpcHRpb246IGNhbid0IGJlIGNoYXJnZWQgYmVmb3JlIDxzdGFydE9uPg0KICAgICAgICB1aW50IGV4cGlyZU9uOyAgICAgICAgICAvLyBmb3Igb2ZmZXI6IGNhbid0IGJlIGFjY2VwdGVkIGFmdGVyICA8ZXhwaXJlT24+IDsgZm9yIHN1YnNjcmlwdGlvbjogY2FuJ3QgYmUgY2hhcmdlZCBhZnRlciAgPGV4cGlyZU9uPg0KICAgICAgICB1aW50IGV4ZWNDb3VudGVyOyAgICAgICAvLyBmb3Igb2ZmZXI6IG1heCBudW0gb2Ygc3Vic2NyaXB0aW9ucyBhdmFpbGFibGUgIDsgZm9yIHN1YnNjcmlwdGlvbjogbnVtIG9mIGNoYXJnZXMgbWFkZS4NCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcjsgICAgICAgLy8gc3Vic2NyaXB0aW9uIHBheWxvYWQgKHN1YmplY3QpOiBldmFsdWF0ZWQgYnkgc2VydmljZSBwcm92aWRlci4NCiAgICAgICAgdWludCBvbkhvbGRTaW5jZTsgICAgICAgLy8gc3Vic2NyaXB0aW9uOiBvbi1ob2xkIHNpbmNlIHRpbWUgb3IgMCBpZiBub3Qgb25Ib2xkLiBvZmZlcjogdW51c2VkOiAvL1RvRG86IHRvIGJlIGltcGxlbWVudGVkDQogICAgfQ0KDQogICAgc3RydWN0IERlcG9zaXQgew0KICAgICAgICB1aW50IHZhbHVlOyAgICAgICAgIC8vIHZhbHVlIG9uIGRlcG9zaXQNCiAgICAgICAgYWRkcmVzcyBvd25lcjsgICAgICAvLyB1c3VhbGx5IGEgY3VzdG9tZXINCiAgICAgICAgdWludCBjcmVhdGVkT247ICAgICAvLyBkZXBvc2l0IGNyZWF0ZWQgdGltZXN0YW1wDQogICAgICAgIHVpbnQgbG9ja1RpbWU7ICAgICAgLy8gZGVwb3NpdCBsb2NrZWQgZm9yIHRpbWUgcGVyaW9kDQogICAgICAgIGJ5dGVzIGRlc2NyaXB0b3I7ICAgLy8gc2VydmljZSByZWxhdGVkIGRlc2NyaXB0b3IgdG8gYmUgZXZhbHVhdGVkIGJ5IHNlcnZpY2UgcHJvdmlkZXINCiAgICB9DQoNCiAgICBldmVudCBOZXdTdWJzY3JpcHRpb24oYWRkcmVzcyBjdXN0b21lciwgYWRkcmVzcyBzZXJ2aWNlLCB1aW50IG9mZmVySWQsIHVpbnQgc3ViSWQpOw0KICAgIGV2ZW50IE5ld0RlcG9zaXQodWludCBkZXBvc2l0SWQsIHVpbnQgdmFsdWUsIHVpbnQgbG9ja1RpbWUsIGFkZHJlc3Mgc2VuZGVyKTsNCiAgICBldmVudCBOZXdYUmF0ZVByb3ZpZGVyKGFkZHJlc3MgYWRkciwgdWludDE2IHhSYXRlUHJvdmlkZXJJZCwgYWRkcmVzcyBzZW5kZXIpOw0KICAgIGV2ZW50IERlcG9zaXRSZXR1cm5lZCh1aW50IGRlcG9zaXRJZCwgYWRkcmVzcyByZXR1cm5lZFRvKTsNCiAgICBldmVudCBTdWJzY3JpcHRpb25EZXBvc2l0UmV0dXJuZWQodWludCBzdWJJZCwgdWludCBhbW91bnQsIGFkZHJlc3MgcmV0dXJuZWRUbywgYWRkcmVzcyBzZW5kZXIpOw0KICAgIGV2ZW50IE9mZmVyT25Ib2xkKHVpbnQgb2ZmZXJJZCwgYm9vbCBvbkhvbGQsIGFkZHJlc3Mgc2VuZGVyKTsNCiAgICBldmVudCBPZmZlckNhbmNlbGVkKHVpbnQgb2ZmZXJJZCwgYWRkcmVzcyBzZW5kZXIpOw0KICAgIGV2ZW50IFN1Yk9uSG9sZCh1aW50IG9mZmVySWQsIGJvb2wgb25Ib2xkLCBhZGRyZXNzIHNlbmRlcik7DQogICAgZXZlbnQgU3ViQ2FuY2VsZWQodWludCBzdWJJZCwgYWRkcmVzcyBzZW5kZXIpOw0KICAgIGV2ZW50IFN1Yk1vZHVsZVN1c3BlbmRlZCh1aW50IHN1c3BlbmRVbnRpbCk7DQoNCn0NCg0KLy8vQGRldiBhbiBJbnRlcmZhY2UgZm9yIFN1YnNjcmlwdGlvbk1vZHVsZS4NCi8vLyAgICAgZXh0cmFjdGVkIGhlcmUgZm9yIGJldHRlciBvdmVydmlldy4NCi8vLyAgICAgc2VlIGRldGFpbGVkIGRvY3VtZW50YXRpb24gaW4gaW1wbGVtZW50YXRpb24gbW9kdWxlLg0KY29udHJhY3QgU3Vic2NyaXB0aW9uTW9kdWxlIGlzIFN1YnNjcmlwdGlvbkJhc2UsIEJhc2Ugew0KDQogICAgLy8vQGRldiAqKioqKiBtb2R1bGUgY29uZmlndXJhdGlvbiAqKioqKg0KICAgIGZ1bmN0aW9uIGF0dGFjaFRva2VuKGFkZHJlc3MgdG9rZW4pIHB1YmxpYzsNCg0KICAgIC8vL0BkZXYgKioqKiogc2luZ2xlIHBheW1lbnQgaGFuZGxpbmcgKioqKioNCiAgICBmdW5jdGlvbiBwYXltZW50VG8odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHBheW1lbnRGcm9tKHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEsIGFkZHJlc3MgX2Zyb20sIFNlcnZpY2VQcm92aWRlciBfdG8pIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIC8vL0BkZXYgKioqKiogc3Vic2NyaXB0aW9uIGhhbmRsaW5nICoqKioqDQogICAgLy8vQGRldiBzb21lIGZ1bmN0aW9ucyBhcmUgbWFya2VkIGFzIHJlZW50cmFudCwgZXZlbiB0aGVpcnMgaW1wbGVtZW50YXRpb24gaXMgbWFya2VkIHdpdGggbm9SZWVudHJhbmN5KExPQ0spLg0KICAgIC8vLyAgICAgVGhpcyBpcyBpbnRlbnRpb25hbGx5IGJlY2F1c2UgdGhlc2Ugbm9SZWVudHJhbmN5KExPQ0spIHJlc3RyaWN0aW9ucyBjYW4gYmUgbGlmdGVkIGluIHRoZSBmdXR1cmUuDQogICAgLy8gICAgICBGdW5jdGlvbnMgd291bGQgYmVjb21lIHJlZW50cmFudC4NCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb24odWludCBfb2ZmZXJJZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX3N0YXJ0T24pIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAodWludCBuZXdTdWJJZCk7DQogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHJlZW50cmFudCBwdWJsaWM7DQogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSkgcmVlbnRyYW50IHB1YmxpYzsNCiAgICBmdW5jdGlvbiBob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIGV4ZWN1dGVTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHBvc3Rwb25lRHVlRGF0ZSh1aW50IHN1YklkLCB1aW50IG5ld0R1ZURhdGUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHJldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYzsNCiAgICBmdW5jdGlvbiBjbGFpbVN1YnNjcmlwdGlvbkRlcG9zaXQodWludCBzdWJJZCkgcHVibGljOw0KICAgIGZ1bmN0aW9uIHN0YXRlKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHN0cmluZyBzdGF0ZSk7DQogICAgZnVuY3Rpb24gc3RhdGVDb2RlKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQgc3RhdGVDb2RlKTsNCg0KICAgIC8vL0BkZXYgKioqKiogc3Vic2NyaXB0aW9uIG9mZmVyIGhhbmRsaW5nICoqKioqDQogICAgZnVuY3Rpb24gY3JlYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBfcHJpY2UsIHVpbnQxNiBfeHJhdGVQcm92aWRlcklkLCB1aW50IF9jaGFyZ2VQZXJpb2QsIHVpbnQgX2V4cGlyZU9uLCB1aW50IF9vZmZlckxpbWl0LCB1aW50IF9kZXBvc2l0VmFsdWUsIHVpbnQgX3N0YXJ0T24sIGJ5dGVzIF9kZXNjcmlwdG9yKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKHVpbnQgc3ViSWQpOw0KICAgIGZ1bmN0aW9uIHVwZGF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCwgdWludCBfb2ZmZXJMaW1pdCkgcHVibGljOw0KICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy9AZGV2ICoqKioqIHNpbXBsZSBkZXBvc2l0IGhhbmRsaW5nICoqKioqDQogICAgZnVuY3Rpb24gY3JlYXRlRGVwb3NpdCh1aW50IF92YWx1ZSwgdWludCBsb2NrVGltZSwgYnl0ZXMgX2Rlc2NyaXB0b3IpIHB1YmxpYyByZXR1cm5zICh1aW50IHN1YklkKTsNCiAgICBmdW5jdGlvbiBjbGFpbURlcG9zaXQodWludCBkZXBvc2l0SWQpIHB1YmxpYzsNCg0KICAgIC8vL0BkZXYgKioqKiogRXhjaGFuZ2VSYXRlIHByb3ZpZGVyICoqKioqDQogICAgZnVuY3Rpb24gcmVnaXN0ZXJYUmF0ZVByb3ZpZGVyKFhSYXRlUHJvdmlkZXIgYWRkcikgcHVibGljIHJldHVybnMgKHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQpOw0KDQogICAgLy8vQGRldiAqKioqKiBTZXJ2aWNlIHByb3ZpZGVyIChwYXltZW50IHJlY2VpdmVyKSAqKioqKg0KICAgIGZ1bmN0aW9uIGVuYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYzsNCiAgICBmdW5jdGlvbiBkaXNhYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljOw0KDQoNCiAgICAvLy9AZGV2ICoqKioqIGNvbnZlbmllbmNlIHN1YnNjcmlwdGlvbiBnZXR0ZXIgKioqKioNCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25EZXRhaWxzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKA0KICAgICAgICBhZGRyZXNzIHRyYW5zZmVyRnJvbSwNCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlclRvLA0KICAgICAgICB1aW50IHByaWNlUGVySG91ciwNCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9uLCAvL25vbWluYXRvcg0KICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX2QsIC8vZGVub21pbmF0b3INCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZCwNCiAgICAgICAgdWludCBjaGFyZ2VQZXJpb2QsDQogICAgICAgIHVpbnQgc3RhcnRPbiwNCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcg0KICAgICk7DQoNCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25TdGF0dXModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoDQogICAgICAgIHVpbnQgZGVwb3NpdEFtb3VudCwNCiAgICAgICAgdWludCBleHBpcmVPbiwNCiAgICAgICAgdWludCBleGVjQ291bnRlciwNCiAgICAgICAgdWludCBwYWlkVW50aWwsDQogICAgICAgIHVpbnQgb25Ib2xkU2luY2UNCiAgICApOw0KDQogICAgZW51bSBQYXltZW50U3RhdHVzIHtPSywgQkFMQU5DRV9FUlJPUiwgQVBQUk9WQUxfRVJST1J9DQogICAgZXZlbnQgUGF5bWVudChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIHVpbnQgX2ZlZSwgYWRkcmVzcyBzZW5kZXIsIFBheW1lbnRTdGF0dXMgc3RhdHVzLCB1aW50IHN1YklkKTsNCiAgICBldmVudCBTZXJ2aWNlUHJvdmlkZXJFbmFibGVkKGFkZHJlc3MgYWRkciwgYnl0ZXMgbW9yZUluZm8pOw0KICAgIGV2ZW50IFNlcnZpY2VQcm92aWRlckRpc2FibGVkKGFkZHJlc3MgYWRkciwgYnl0ZXMgbW9yZUluZm8pOw0KDQp9IC8vU3Vic2NyaXB0aW9uTW9kdWxlDQoNCmNvbnRyYWN0IEVSQzIwTW9kdWxlU3VwcG9ydCB7DQogICAgZnVuY3Rpb24gX2Z1bGZpbGxQcmVhcHByb3ZlZFBheW1lbnQoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBhZGRyZXNzIG1zZ19zZW5kZXIpIHB1YmxpYyByZXR1cm5zKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gX2Z1bGZpbGxQYXltZW50KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgdWludCBzdWJJZCwgYWRkcmVzcyBtc2dfc2VuZGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiBfbWludEZyb21EZXBvc2l0KGFkZHJlc3Mgb3duZXIsIHVpbnQgYW1vdW50KSBwdWJsaWM7DQogICAgZnVuY3Rpb24gX2J1cm5Gb3JEZXBvc2l0KGFkZHJlc3Mgb3duZXIsIHVpbnQgYW1vdW50KSBwdWJsaWMgcmV0dXJucyhib29sIHN1Y2Nlc3MpOw0KfQ0KDQovL0BkZXYgaW1wbGVtZW50YXRpb24NCmNvbnRyYWN0IFN1YnNjcmlwdGlvbk1vZHVsZUltcGwgaXMgU3Vic2NyaXB0aW9uTW9kdWxlLCBPd25lZCAgew0KDQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBWRVJTSU9OID0gIjAuMi4wIjsNCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgICAgICBjb250cmFjdCBzdGF0ZXMgICAgICAgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy8vQGRldiBzdXNwZW5kIGFsbCBtb2R1bGUgb3BlcmF0aW9uIHVudGlsIHRoaXMgdGltZSAoaWYgaW4gZnV0dXJlKTsgaWYgdGhlIHRpbWUgaXMgaW4gcGFzdCAob3IgemVybykgLSBvcGVyYXRlcyBub3JtYWxseS4NCiAgICB1aW50IHB1YmxpYyBzdXNwZW5kZWRVbnRpbCA9IDA7DQogICAgZnVuY3Rpb24gaXNTdXNwZW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7IHJldHVybiBzdXNwZW5kZWRVbnRpbCA+IG5vdzsgfQ0KDQogICAgLy8vQGRldiBsaXN0IG9mIGFsbCByZWdpc3RlcmVkIHNlcnZpY2UgcHJvdmlkZXIgY29udHJhY3RzIGltcGxlbWVudGVkIGFzIGEgbWFwIGZvciBiZXR0ZXIgbG9va3VwLg0KICAgIG1hcHBpbmcgKGFkZHJlc3M9PmJvb2wpIHB1YmxpYyBwcm92aWRlclJlZ2lzdHJ5Ow0KDQogICAgLy8vQGRldiBhbGwgc3Vic2NyaXB0aW9ucyBhbmQgb2ZmZXJzIChpbmNsLiBGSU5BTElaRUQpLg0KICAgIG1hcHBpbmcgKHVpbnQgPT4gU3Vic2NyaXB0aW9uKSBwdWJsaWMgc3Vic2NyaXB0aW9uczsNCg0KICAgIC8vL0BkZXYgYWxsIGFjdGl2ZSBzaW1wbGUgZGVwb3NpdHMgZ2l2ZWQgYnkgZGVwb3NpdElkLg0KICAgIG1hcHBpbmcgKHVpbnQgPT4gRGVwb3NpdCkgcHVibGljIGRlcG9zaXRzOw0KDQogICAgLy8vQGRldiBhZGRyZXNzZXMgb2YgcmVnaXN0ZXJlZCBleGNoYW5nZSByYXRlIHByb3ZpZGVycy4NCiAgICBYUmF0ZVByb3ZpZGVyW10gcHVibGljIHhyYXRlUHJvdmlkZXJzOw0KDQogICAgLy8vQGRldiBvbmdvaW5nIGNvdW50ZXIgZm9yIHN1YnNjcmlwdGlvbiBpZHMgc3RhcnRpbmcgZnJvbSAxLg0KICAgIC8vLyAgICAgQ3VycmVudCB2YWx1ZSByZXByZXNlbnRzIGFuIGlkIG9mIGxhc3QgY3JlYXRlZCBzdWJzY3JpcHRpb24uDQogICAgdWludCBwdWJsaWMgc3Vic2NyaXB0aW9uQ291bnRlciA9IDA7DQoNCiAgICAvLy9AZGV2IG9uZ29pbmcgY291bnRlciBmb3Igc2ltcGxlIGRlcG9zaXQgaWRzIHN0YXJ0aW5nIGZyb20gMS4NCiAgICAvLy8gICAgIEN1cnJlbnQgdmFsdWUgcmVwcmVzZW50cyBhbiBpZCBvZiBsYXN0IGNyZWF0ZWQgZGVwb3NpdC4NCiAgICB1aW50IHB1YmxpYyBkZXBvc2l0Q291bnRlciA9IDA7DQoNCiAgICAvLy9AZGV2IFRva2VuIGNvbnRyYWN0IHdpdGggRVJDMjBNb2R1bGVTdXBwb3J0IGFkZG9uLg0KICAgIC8vLyAgICAgU3Vic2NyaXB0aW9uIE1vZHVsZSBvcGVyYXRlcyBvbiBpdHMgYmFsYW5jZXMgdmlhIEVSQzIwTW9kdWxlU3VwcG9ydCBpbnRlcmZhY2UgYXMgdHJ1c3RlZCBtb2R1bGUuDQogICAgRVJDMjBNb2R1bGVTdXBwb3J0IHB1YmxpYyBzYW47DQoNCg0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgIHJlamVjdCBhbGwgZXRoZXIgc2VudCB0byB0aGlzIGNvbnRyYWN0ICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgZnVuY3Rpb24gKCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCg0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgICAgICAgICBzZXR1cCBhbmQgY29uZmlndXJhdGlvbiAgICAgICAgICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICAvLy9AZGV2IGNvbnN0cnVjdG9yDQogICAgZnVuY3Rpb24gU3Vic2NyaXB0aW9uTW9kdWxlSW1wbCgpIHsNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgICAgICB4cmF0ZVByb3ZpZGVycy5wdXNoKFhSYXRlUHJvdmlkZXIodGhpcykpOyAvL3RoaXMgaXMgYSBkZWZhdWx0IFNBTjpTQU4gKDE6MSkgcHJvdmlkZXIgd2l0aCBkZWZhdWx0IGlkID09IDANCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgYXR0YWNoIFNBTiB0b2tlbiB0byB3b3JrIHdpdGg7IGNhbiBiZSBkb25lIG9ubHkgb25jZS4NCiAgICBmdW5jdGlvbiBhdHRhY2hUb2tlbihhZGRyZXNzIHRva2VuKSBwdWJsaWMgew0KICAgICAgICBhc3NlcnQoYWRkcmVzcyhzYW4pID09IDApOyAvL29ubHkgaW4gbmV3IGRlcGxveWVkIHN0YXRlDQogICAgICAgIHNhbiA9IEVSQzIwTW9kdWxlU3VwcG9ydCh0b2tlbik7DQogICAgfQ0KDQoNCiAgICAvLy9AZGV2IHJlZ2lzdGVyIGEgbmV3IHNlcnZpY2UgcHJvdmlkZXIgdG8gdGhlIHBsYXRmb3JtLg0KICAgIGZ1bmN0aW9uIGVuYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYyBub3RTdXNwZW5kZWQgb25seShvd25lcikgew0KICAgICAgICBwcm92aWRlclJlZ2lzdHJ5W2FkZHJdID0gdHJ1ZTsNCiAgICAgICAgU2VydmljZVByb3ZpZGVyRW5hYmxlZChhZGRyLCBtb3JlSW5mbyk7DQogICAgfQ0KDQoNCiAgICAvLy9AZGV2IGRlLXJlZ2lzdGVyIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIHdpdGggZ2l2ZW4gYGFkZHJgLg0KICAgIGZ1bmN0aW9uIGRpc2FibGVTZXJ2aWNlUHJvdmlkZXIoU2VydmljZVByb3ZpZGVyIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKSBwdWJsaWMgbm90U3VzcGVuZGVkIG9ubHkob3duZXIpIHsNCiAgICAgICAgZGVsZXRlIHByb3ZpZGVyUmVnaXN0cnlbYWRkcl07DQogICAgICAgIFNlcnZpY2VQcm92aWRlckRpc2FibGVkKGFkZHIsIG1vcmVJbmZvKTsNCiAgICB9DQoNCiAgICAvLy9AZGV2IHN1c3BlbmQgYWxsIG1vZHVsZSBvcGVyYXRpb25zIGZvciBnaXZlbiB0aW1lLg0KICAgIGZ1bmN0aW9uIHN1c3BlbmQodWludCBzdXNwZW5kVGltZVNlYykgcHVibGljIG9ubHkob3duZXIpIHsNCiAgICAgICAgc3VzcGVuZGVkVW50aWwgPSBub3cgKyBzdXNwZW5kVGltZVNlYzsNCiAgICAgICAgU3ViTW9kdWxlU3VzcGVuZGVkKHN1c3BlbmRlZFVudGlsKTsNCiAgICB9DQoNCiAgICAvLy9AZGV2IHJlZ2lzdGVyIG5ldyBleGNoYW5nZSByYXRlIHByb3ZpZGVyLg0KICAgIC8vLyAgICAgWFJhdGVQcm92aWRlciBjYW4ndCBiZSBkZS1yZWdpc3RlcmVkLCBiZWNhdXNlIHRoZXkgY291bGQgYmUgc3RpbGwgaW4gdXNlIGJ5IHNvbWUgc3Vic2NyaXB0aW9uLg0KICAgIGZ1bmN0aW9uIHJlZ2lzdGVyWFJhdGVQcm92aWRlcihYUmF0ZVByb3ZpZGVyIGFkZHIpIHB1YmxpYyBub3RTdXNwZW5kZWQgb25seShvd25lcikgcmV0dXJucyAodWludDE2IHhyYXRlUHJvdmlkZXJJZCkgew0KICAgICAgICB4cmF0ZVByb3ZpZGVySWQgPSB1aW50MTYoeHJhdGVQcm92aWRlcnMubGVuZ3RoKTsNCiAgICAgICAgeHJhdGVQcm92aWRlcnMucHVzaChhZGRyKTsNCiAgICAgICAgTmV3WFJhdGVQcm92aWRlcihhZGRyLCB4cmF0ZVByb3ZpZGVySWQsIG1zZy5zZW5kZXIpOw0KICAgIH0NCg0KDQogICAgLy8vQGRldiB4cmF0ZVByb3ZpZGVycyBsZW5ndGggYWNjZXNzb3IuDQogICAgZnVuY3Rpb24gZ2V0WFJhdGVQcm92aWRlckxlbmd0aCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiB4cmF0ZVByb3ZpZGVycy5sZW5ndGg7DQogICAgfQ0KDQoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy8gKiAgICAgICAgICAgc2luZ2xlIHBheW1lbnQgbWV0aG9kcyAgICAgICAgICAgICAgKg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KICAgIC8vL0Bub3RpY2UgbWFrZXMgc2luZ2xlIHBheW1lbnQgdG8gc2VydmljZSBwcm92aWRlci4NCiAgICAvLy9AcGFyYW0gX3ZhbHVlIC0gYW1vdW50IG9mIFNBTiB0b2tlbiB0byBzZW50DQogICAgLy8vQHBhcmFtIF9wYXltZW50RGF0YSAtICdwYXltZW50IHB1cnBvc2UnIGNvZGUgdXN1YWxseSBpc3N1ZWQgYnkgc2VydmljZSBwcm92aWRlciB0byBjdXN0b21lciBiZWZvcmUgcGF5bWVudC4NCiAgICAvLy9AcGFyYW0gX3RvIC0gc2VydmljZSBwcm92aWRlciBjb250cmFjdA0KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQ0KICAgIC8vDQogICAgZnVuY3Rpb24gcGF5bWVudFRvKHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEsIFNlcnZpY2VQcm92aWRlciBfdG8pIHB1YmxpYyBub3RTdXNwZW5kZWQgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoc2FuLl9mdWxmaWxsUGF5bWVudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgMCwgbXNnLnNlbmRlcikpIHsNCiAgICAgICAgICAgIC8vIGEgU2VydmljZVByb3ZpZGVyIChhIFNlcnZpY2VQcm92aWRlcikgaGFzIGhlcmUgYW4gb3Bwb3J0dW5pdHkgdmVyaWZ5IGFuZCByZWplY3QgdGhlIHBheW1lbnQNCiAgICAgICAgICAgIGFzc2VydCAoU2VydmljZVByb3ZpZGVyKF90bykub25QYXltZW50KG1zZy5zZW5kZXIsIF92YWx1ZSwgX3BheW1lbnREYXRhKSk7ICAgICAgICAgICAgICAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQ0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBtYWtlcyBzaW5nbGUgcHJlYXBwcm92ZWQgcGF5bWVudCB0byBzZXJ2aWNlIHByb3ZpZGVyLiBBbiBhbW91bnQgbXVzdCBiZSBhbHJlYWR5IHByZWFwcHJvdmVkIGJ5IHBheW1lbnQgc2VuZGVyIHRvIHJlY2VwaWVudC4NCiAgICAvLy9AcGFyYW0gX3ZhbHVlIC0gYW1vdW50IG9mIFNBTiB0b2tlbiB0byBzZW50DQogICAgLy8vQHBhcmFtIF9wYXltZW50RGF0YSAtICdwYXltZW50IHB1cnBvc2UnIGNvZGUgdXN1YWxseSBpc3N1ZWQgYnkgc2VydmljZSBwcm92aWRlciB0byBjdXN0b21lciBiZWZvcmUgcGF5bWVudC4NCiAgICAvLy9AcGFyYW0gX2Zyb20gLSBzZW5kZXIgb2YgdGhlIHBheW1lbnQgKG90aGVyIHRoYW4gbXNnLnNlbmRlcikNCiAgICAvLy9AcGFyYW0gX3RvIC0gc2VydmljZSBwcm92aWRlciBjb250cmFjdA0KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQ0KICAgIC8vDQogICAgZnVuY3Rpb24gcGF5bWVudEZyb20odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgYWRkcmVzcyBfZnJvbSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIG5vdFN1c3BlbmRlZCByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmIChzYW4uX2Z1bGZpbGxQcmVhcHByb3ZlZFBheW1lbnQoX2Zyb20sIF90bywgX3ZhbHVlLCBtc2cuc2VuZGVyKSkgew0KICAgICAgICAgICAgLy8gYSBTZXJ2aWNlUHJvdmlkZXIgKGEgU2VydmljZVByb3ZpZGVyKSBoYXMgaGVyZSBhbiBvcHBvcnR1bml0eSB2ZXJpZnkgYW5kIHJlamVjdCB0aGUgcGF5bWVudA0KICAgICAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblBheW1lbnQoX2Zyb20sIF92YWx1ZSwgX3BheW1lbnREYXRhKSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy8gKiAgICAgICAgICAgIHN1YnNjcmlwdGlvbiBoYW5kbGluZyAgICAgICAgICAgICAgKg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KICAgIC8vL0BkZXYgY29udmVuaWVuY2UgZ2V0dGVyIGZvciBzb21lIHN1YnNjcmlwdGlvbiBmaWVsZHMNCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25EZXRhaWxzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICgNCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlckZyb20sDQogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJUbywNCiAgICAgICAgdWludCBwcmljZVBlckhvdXIsDQogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfbiwgLy9ub21pbmF0b3INCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9kLCAvL2Rlbm9taW5hdG9yDQogICAgICAgIHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQsDQogICAgICAgIHVpbnQgY2hhcmdlUGVyaW9kLA0KICAgICAgICB1aW50IHN0YXJ0T24sDQogICAgICAgIGJ5dGVzIGRlc2NyaXB0b3INCiAgICApIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICByZXR1cm4gKHN1Yi50cmFuc2ZlckZyb20sIHN1Yi50cmFuc2ZlclRvLCBzdWIucHJpY2VQZXJIb3VyLCBzdWIuaW5pdGlhbFhyYXRlX24sIHN1Yi5pbml0aWFsWHJhdGVfZCwgc3ViLnhyYXRlUHJvdmlkZXJJZCwgc3ViLmNoYXJnZVBlcmlvZCwgc3ViLnN0YXJ0T24sIHN1Yi5kZXNjcmlwdG9yKTsNCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgY29udmVuaWVuY2UgZ2V0dGVyIGZvciBzb21lIHN1YnNjcmlwdGlvbiBmaWVsZHMNCiAgICAvLy8gICAgIGEgY2FsbGVyIG11c3Qga25vdywgdGhhdCB0aGUgc3Vic2NyaXB0aW9uIHdpdGggZ2l2ZW4gaWQgZXhpc3RzLCBiZWNhdXNlIGFsbCB0aGVzZSBmaWVsZHMgY2FuIGJlIDAgZXZlbiB0aGUgc3Vic2NyaXB0aW9uIHdpdGggZ2l2ZW4gaWQgZXhpc3RzLg0KICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvblN0YXR1cyh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucygNCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50LA0KICAgICAgICB1aW50IGV4cGlyZU9uLA0KICAgICAgICB1aW50IGV4ZWNDb3VudGVyLA0KICAgICAgICB1aW50IHBhaWRVbnRpbCwNCiAgICAgICAgdWludCBvbkhvbGRTaW5jZQ0KICAgICkgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIHJldHVybiAoc3ViLmRlcG9zaXRBbW91bnQsIHN1Yi5leHBpcmVPbiwgc3ViLmV4ZWNDb3VudGVyLCBzdWIucGFpZFVudGlsLCBzdWIub25Ib2xkU2luY2UpOw0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBleGVjdXRlIHBlcmlvZGljIHN1YnNjcmlwdGlvbiBwYXltZW50Lg0KICAgIC8vLyAgICAgICAgQW55IG9mIGN1c3RvbWVyLCBzZXJ2aWNlIHByb3ZpZGVyIGFuZCBwbGF0Zm9ybSBvd25lciBjYW4gZXhlY3V0ZSB0aGlzIGZ1bmN0aW9uLg0KICAgIC8vLyAgICAgICAgVGhpcyBlbnN1cmVzLCB0aGF0IHRoZSBzdWJzY3JpcHRpb24gY2hhcmdlIGRvZXNuJ3QgYmVjb21lIGRlbGF5ZWQuDQogICAgLy8vICAgICAgICBBdCBsZWFzdCB0aGUgcGxhdGZvcm0gb3duZXIgaGFzIGFuIGluY2VudGl2ZSB0byBnZXQgZmVlIGFuZCB0aHVzIGNhbiB0cmlnZ2VyIHRoZSBmdW5jdGlvbi4NCiAgICAvLy8gICAgICAgIEFuIGV4ZWN1dGlvbiBmYWlscyBpZiBzdWJzY3JpcHRpb24gaXMgbm90IGluIHN0YXR1cyBgQ0hBUkdFQUJMRWAuDQogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIHRvIGJlIGNoYXJnZWQuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBleGVjdXRlU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgbm9SZWVudHJhbmN5KEwwMCkgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsNCiAgICAgICAgYXNzZXJ0IChtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlckZyb20gfHwgbXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJUbyB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsNCiAgICAgICAgaWYgKF9zdWJzY3JpcHRpb25TdGF0ZShzdWIpPT1TdWJTdGF0ZS5DSEFSR0VBQkxFKSB7DQogICAgICAgICAgICB2YXIgX2Zyb20gPSBzdWIudHJhbnNmZXJGcm9tOw0KICAgICAgICAgICAgdmFyIF90byA9IHN1Yi50cmFuc2ZlclRvOw0KICAgICAgICAgICAgdmFyIF92YWx1ZSA9IF9hbW91bnRUb0NoYXJnZShzdWIpOw0KICAgICAgICAgICAgaWYgKHNhbi5fZnVsZmlsbFBheW1lbnQoX2Zyb20sIF90bywgX3ZhbHVlLCBzdWJJZCwgbXNnLnNlbmRlcikpIHsNCiAgICAgICAgICAgICAgICBzdWIucGFpZFVudGlsICA9IG1heChzdWIucGFpZFVudGlsLCBzdWIuc3RhcnRPbikgKyBzdWIuY2hhcmdlUGVyaW9kOw0KICAgICAgICAgICAgICAgICsrc3ViLmV4ZWNDb3VudGVyOw0KICAgICAgICAgICAgICAgIC8vIGEgU2VydmljZVByb3ZpZGVyIChhIFNlcnZpY2VQcm92aWRlcikgaGFzIGhlcmUgYW4gb3Bwb3J0dW5pdHkgdG8gdmVyaWZ5IGFuZCByZWplY3QgdGhlIHBheW1lbnQNCiAgICAgICAgICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihfdG8pLm9uU3ViRXhlY3V0ZWQoc3ViSWQpKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIG1vdmUgYHBhaWRVbnRpbGAgZm9yd2FyZCB0byBnaXZlbiBgbmV3RHVlRGF0ZWAuIEl0IHdhaXZlcyBwYXltZW50cyBmb3IgZ2l2ZW4gdGltZS4NCiAgICAvLy8gICAgICAgIFRoaXMgZnVuY3Rpb24gY2FuIGJlIHVzZWQgYnkgc2VydmljZSBwcm92aWRlciB0byBgZ2l2ZSBhd2F5YCBzb21lIHNlcnZpY2UgdGltZSBmb3IgZnJlZS4NCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBpZCBvZiBzdWJzY3JpcHRpb24gdG8gYmUgcG9zdHBvbmVkLg0KICAgIC8vL0BwYXJhbSBuZXdEdWVEYXRlIC0gbmV3IGBwYWlkVW50aWxgIGRhdGV0aW1lOyByZXF1aXJlIGBuZXdEdWVEYXRlID4gcGFpZFVudGlsYC4NCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIHBvc3Rwb25lRHVlRGF0ZSh1aW50IHN1YklkLCB1aW50IG5ld0R1ZURhdGUpIHB1YmxpYyBub3RTdXNwZW5kZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKXsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOw0KICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIpOyAvL29ubHkgU2VydmljZSBQcm92aWRlciBpcyBhbGxvd2VkIHRvIHBvc3Rwb25lIHRoZSBEdWVEYXRlDQogICAgICAgIGlmIChzdWIucGFpZFVudGlsIDwgbmV3RHVlRGF0ZSkgew0KICAgICAgICAgICAgc3ViLnBhaWRVbnRpbCA9IG5ld0R1ZURhdGU7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQGRldiByZXR1cm4gY3VycmVudCBzdGF0dXMgYXMgYSBuYW1lIG9mIGEgc3Vic2NyaXB0aW9uIChvciBhbiBvZmZlcikgd2l0aCBnaXZlbiBpZDsNCiAgICBmdW5jdGlvbiBzdGF0ZSh1aW50IHN1Yk9yT2ZmZXJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHN0YXRlKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdWJPck9mZmVyID0gc3Vic2NyaXB0aW9uc1tzdWJPck9mZmVySWRdOw0KICAgICAgICByZXR1cm4gX2lzT2ZmZXIoc3ViT3JPZmZlcikNCiAgICAgICAgICAgICAgPyBPRkZFUl9TVEFURVNbdWludChfb2ZmZXJTdGF0ZShzdWJPck9mZmVyKSldDQogICAgICAgICAgICAgIDogU1VCX1NUQVRFU1t1aW50KF9zdWJzY3JpcHRpb25TdGF0ZShzdWJPck9mZmVyKSldOw0KICAgIH0NCg0KDQogICAgLy8vQGRldiByZXR1cm4gY3VycmVudCBzdGF0dXMgYXMgYSBjb2RlIG9mIGEgc3Vic2NyaXB0aW9uIChvciBhbiBvZmZlcikgd2l0aCBnaXZlbiBpZDsNCiAgICBmdW5jdGlvbiBzdGF0ZUNvZGUodWludCBzdWJPck9mZmVySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQgc3RhdGVDb2RlKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdWJPck9mZmVyID0gc3Vic2NyaXB0aW9uc1tzdWJPck9mZmVySWRdOw0KICAgICAgICByZXR1cm4gX2lzT2ZmZXIoc3ViT3JPZmZlcikNCiAgICAgICAgICAgICAgPyB1aW50KF9vZmZlclN0YXRlKHN1Yk9yT2ZmZXIpKQ0KICAgICAgICAgICAgICA6IHVpbnQoX3N1YnNjcmlwdGlvblN0YXRlKHN1Yk9yT2ZmZXIpKTsNCiAgICB9DQoNCg0KICAgIGZ1bmN0aW9uIF9vZmZlclN0YXRlKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhPZmZlclN0YXRlIHN0YXR1cykgew0KICAgICAgICBpZiAoIV9pc09mZmVyKHN1YikpIHsNCiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLk5PVF9FWElTVDsNCiAgICAgICAgfSBlbHNlIGlmIChzdWIuc3RhcnRPbiA+IG5vdykgew0KICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuQkVGT1JFX1NUQVJUOw0KICAgICAgICB9IGVsc2UgaWYgKHN1Yi5vbkhvbGRTaW5jZSA+IDApIHsNCiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLk9OX0hPTEQ7DQogICAgICAgIH0gZWxzZSBpZiAobm93IDw9IHN1Yi5leHBpcmVPbikgew0KICAgICAgICAgICAgcmV0dXJuIHN1Yi5leGVjQ291bnRlciA+IDANCiAgICAgICAgICAgICAgICA/IE9mZmVyU3RhdGUuQUNUSVZFDQogICAgICAgICAgICAgICAgOiBPZmZlclN0YXRlLlNPTERfT1VUOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuRVhQSVJFRDsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9zdWJzY3JpcHRpb25TdGF0ZShTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMoU3ViU3RhdGUgc3RhdHVzKSB7DQogICAgICAgIGlmICghX2lzU3Vic2NyaXB0aW9uKHN1YikpIHsNCiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5OT1RfRVhJU1Q7DQogICAgICAgIH0gZWxzZSBpZiAoc3ViLnN0YXJ0T24gPiBub3cpIHsNCiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5CRUZPUkVfU1RBUlQ7DQogICAgICAgIH0gZWxzZSBpZiAoc3ViLm9uSG9sZFNpbmNlID4gMCkgew0KICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLk9OX0hPTEQ7DQogICAgICAgIH0gZWxzZSBpZiAoc3ViLnBhaWRVbnRpbCA+PSBzdWIuZXhwaXJlT24pIHsNCiAgICAgICAgICAgIHJldHVybiBub3cgPCBzdWIuZXhwaXJlT24NCiAgICAgICAgICAgICAgICA/IFN1YlN0YXRlLkNBTkNFTEVEDQogICAgICAgICAgICAgICAgOiBzdWIuZGVwb3NpdEFtb3VudCA+IDANCiAgICAgICAgICAgICAgICAgICAgPyBTdWJTdGF0ZS5FWFBJUkVEDQogICAgICAgICAgICAgICAgICAgIDogU3ViU3RhdGUuRklOQUxJWkVEOw0KICAgICAgICB9IGVsc2UgaWYgKHN1Yi5wYWlkVW50aWwgPD0gbm93KSB7DQogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuQ0hBUkdFQUJMRTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5QQUlEOw0KICAgICAgICB9DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNyZWF0ZSBhIG5ldyBzdWJzY3JpcHRpb24gb2ZmZXIuDQogICAgLy8vQGRldiBvbmx5IHJlZ2lzdGVyZWQgc2VydmljZSBwcm92aWRlciBpcyBhbGxvd2VkIHRvIGNyZWF0ZSBvZmZlcnMuDQogICAgLy8vQGRldiBzdWJzY3JpcHRpb24gdXNlcyBTQU4gdG9rZW4gZm9yIHBheW1lbnQsIGJ1dCBhbiBleGFjdCBhbW91bnQgdG8gYmUgcGFpZCBvciBkZXBvc2l0IGlzIGNhbGN1bGF0ZWQgdXNpbmcgZXhjaGFuZ2UgcmF0ZSBmcm9tIGV4dGVybmFsIHhyYXRlUHJvdmlkZXIgKHByZXZpb3NseSByZWdpc3RlcmVkIG9uIHBsYXRmb3JtKS4NCiAgICAvLy8gICAgVGhpcyBhbGxvd3MgdG8gY3JlYXRlIGEgc3Vic2NyaXB0aW9uIGJvdW5kIHRvIGFub3RoZXIgdG9rZW4gb3IgZXZlbiBmaWF0IGN1cnJlbmN5Lg0KICAgIC8vL0BwYXJhbSBfcHJpY2VQZXJIb3VyIC0gc3Vic2NyaXB0aW9uIHByaWNlIHBlciBob3VyIGluIFNBTg0KICAgIC8vL0BwYXJhbSBfeHJhdGVQcm92aWRlcklkIC0gaWQgb2YgZXh0ZXJuYWwgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlciBmcm9tIHN1YnNjcmlwdGlvbiBjdXJyZW5jeSB0byBTQU47ICIwIiBtZWFucyBzdWJzY3JpcHRpb24gaXMgcHJpY2VkIGluIFNBTiBuYXRpdmVseS4NCiAgICAvLy9AcGFyYW0gX2NoYXJnZVBlcmlvZCAtIHRpbWUgcGVyaW9kIHRvIGNoYXJnZTsgc3Vic2NyaXB0aW9uIGNhbid0IGJlIGNoYXJnZWQgbW9yZSBvZnRlbiB0aGFuIHRoaXMgcGVyaW9kLiBUaW1lIHVuaXRzIGFyZSBuYXRpdmUgZXRoZXJldW0gdGltZSwgcmV0dXJuaW5nIGJ5IGBub3dgLCBpLmUuIHNlY29uZHMuDQogICAgLy8vQHBhcmFtIF9leHBpcmVPbiAtIG9mZmVyIGNhbid0IGJlIGFjY2VwdGVkIGFmdGVyIHRoaXMgdGltZS4NCiAgICAvLy9AcGFyYW0gX29mZmVyTGltaXQgLSBob3cgbWFueSBzdWJzY3JpcHRpb24gYXJlIGF2YWlsYWJsZSB0byBjcmVhdGVkIGZyb20gdGhpcyBvZmZlcjsgdGhlcmUgaXMgbm8gbWFnaWMgbnVtYmVyIGZvciB1bmxpbWl0ZWQgb2ZmZXIgLS0gdXNlIGJpZyBudW1iZXIgaW5zdGVhZC4NCiAgICAvLy9AcGFyYW0gX2RlcG9zaXRBbW91bnQgLSB1cGZyb250IGRlcG9zaXQgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIGEgc3Vic2NyaXB0aW9uOyB0aGlzIGRlcG9zaXQgYmVjb21lcyBmdWxseSByZXR1cm5lZCBvbiBzdWJzY3JpcHRpb24gaXMgb3Zlci4NCiAgICAvLy8gICAgICAgY3VycmVudGx5IHRoaXMgZGVwb3NpdCBpcyBub3Qgc3ViamVjdCBvZiBwbGF0Zm9ybSBmZWVzIGFuZCB3aWxsIGJlIHJlZnVuZGVkIGluIGZ1bGwuIE5leHQgdmVyc2lvbnMgb2YgdGhpcyBtb2R1bGUgY2FuIHVzZSBkZXBvc2l0IGluIGNhc2Ugb2Ygb3V0c3RhbmRpbmcgcGF5bWVudHMuDQogICAgLy8vQHBhcmFtIF9zdGFydE9uIC0gYSBzdWJzY3JpcHRpb24gZnJvbSB0aGlzIG9mZmVyIGNhbid0IGJlIGNyZWF0ZWQgYmVmb3JlIHRoaXMgdGltZS4gVGltZSB1bml0cyBhcmUgbmF0aXZlIGV0aGVyZXVtIHRpbWUsIHJldHVybmluZyBieSBgbm93YCwgaS5lLiBzZWNvbmRzLg0KICAgIC8vL0BwYXJhbSBfZGVzY3JpcHRvciAtIGFyYml0cmFyeSBieXRlcyBhcyBhbiBvZmZlciBkZXNjcmlwdG9yLiBUaGlzIGRlc2NyaXB0b3IgaXMgY29waWVkIGludG8gc3Vic2NyaXB0aW9uIGFuZCB0aGVuIHNlcnZpY2UgcHJvdmlkZXIgYmVjb21lcyBpdCBwYXNzZWQgaW4gbm90aWZpY2F0aW9ucy4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgX3ByaWNlUGVySG91ciwgdWludDE2IF94cmF0ZVByb3ZpZGVySWQsIHVpbnQgX2NoYXJnZVBlcmlvZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX29mZmVyTGltaXQsIHVpbnQgX2RlcG9zaXRBbW91bnQsIHVpbnQgX3N0YXJ0T24sIGJ5dGVzIF9kZXNjcmlwdG9yKQ0KICAgIHB1YmxpYw0KICAgIG5vUmVlbnRyYW5jeShMMDEpDQogICAgb25seVJlZ2lzdGVyZWRQcm92aWRlcg0KICAgIG5vdFN1c3BlbmRlZA0KICAgIHJldHVybnMgKHVpbnQgc3ViSWQpIHsNCiAgICAgICAgYXNzZXJ0IChfc3RhcnRPbiA8IF9leHBpcmVPbik7DQogICAgICAgIGFzc2VydCAoX2NoYXJnZVBlcmlvZCA8PSAxMCB5ZWFycyk7IC8vc2FuaXR5IGNoZWNrDQogICAgICAgIHZhciAoX3hyYXRlX24sIF94cmF0ZV9kKSA9IF94cmF0ZVByb3ZpZGVySWQgPT0gMA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAoMSwxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBYUmF0ZVByb3ZpZGVyKHhyYXRlUHJvdmlkZXJzW194cmF0ZVByb3ZpZGVySWRdKS5nZXRSYXRlKCk7IC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQ0KICAgICAgICBhc3NlcnQgKF94cmF0ZV9uID4gMCAmJiBfeHJhdGVfZCA+IDApOw0KICAgICAgICBzdWJzY3JpcHRpb25zWysrc3Vic2NyaXB0aW9uQ291bnRlcl0gPSBTdWJzY3JpcHRpb24gKHsNCiAgICAgICAgICAgIHRyYW5zZmVyRnJvbSAgICA6IDAsICAgICAgICAgICAgICAgICAgLy8gZW1wdHkgdHJhbnNmZXJGcm9tIGZpZWxkIG1lYW5zIHdlIGhhdmUgYW4gb2ZmZXIsIG5vdCBhIHN1YnNjcmlwdGlvbg0KICAgICAgICAgICAgdHJhbnNmZXJUbyAgICAgIDogbXNnLnNlbmRlciwgICAgICAgICAvLyBzZXJ2aWNlIHByb3ZpZGVyIGlzIGEgYmVuZWZpY2lhcnkgb2Ygc3Vic2NyaXB0b24gcGF5bWVudHMNCiAgICAgICAgICAgIHByaWNlUGVySG91ciAgICA6IF9wcmljZVBlckhvdXIsICAgICAgLy8gcHJpY2UgcGVyIGhvdXIgaW4gU0FOIChyZWNhbGN1bGF0ZWQgZnJvbSBiYXNlIGN1cnJlbmN5IGlmIG5lZWRlZCkNCiAgICAgICAgICAgIHhyYXRlUHJvdmlkZXJJZCA6IF94cmF0ZVByb3ZpZGVySWQsICAgLy8gaWQgb2YgcmVnaXN0ZXJlZCBleGNoYW5nZSByYXRlIHByb3ZpZGVyIG9yIHplcm8gaWYgYW4gb2ZmZXIgaXMgbm9taW5hdGVkIGluIFNBTi4NCiAgICAgICAgICAgIGluaXRpYWxYcmF0ZV9uICA6IF94cmF0ZV9uLCAgICAgICAgICAgLy8gZnJhY3Rpb24gbm9taW5hdG9yIG9mIHRoZSBpbml0aWFsIGV4Y2hhbmdlIHJhdGUNCiAgICAgICAgICAgIGluaXRpYWxYcmF0ZV9kICA6IF94cmF0ZV9kLCAgICAgICAgICAgLy8gZnJhY3Rpb24gZGVub21pbmF0b3Igb2YgdGhlIGluaXRpYWwgZXhjaGFuZ2UgcmF0ZQ0KICAgICAgICAgICAgcGFpZFVudGlsICAgICAgIDogMCwgICAgICAgICAgICAgICAgICAvLyBzZXJ2aWNlIGlzIGNvbnNpZGVyZWQgdG8gYmUgcGFpZCB1bnRpbCB0aGlzIHRpbWU7IG5vIGNoYXJnZSBpcyBwb3NzaWJsZSB3aGlsZSBzdWJzY3JpcHRpb24gaXMgcGFpZCBmb3Igbm93Lg0KICAgICAgICAgICAgY2hhcmdlUGVyaW9kICAgIDogX2NoYXJnZVBlcmlvZCwgICAgICAvLyBwZXJpb2QgaW4gc2Vjb25kcyAoZXRoZXJldW0gYmxvY2sgdGltZSB1bml0KSB0byBjaGFyZ2UuDQogICAgICAgICAgICBkZXBvc2l0QW1vdW50ICAgOiBfZGVwb3NpdEFtb3VudCwgICAgIC8vIGRlcG9zaXQgcmVxdWlyZWQgZm9yIHN1YnNjcmlwdGlvbiBhY2NlcHQuDQogICAgICAgICAgICBzdGFydE9uICAgICAgICAgOiBfc3RhcnRPbiwNCiAgICAgICAgICAgIGV4cGlyZU9uICAgICAgICA6IF9leHBpcmVPbiwNCiAgICAgICAgICAgIGV4ZWNDb3VudGVyICAgICA6IF9vZmZlckxpbWl0LA0KICAgICAgICAgICAgZGVzY3JpcHRvciAgICAgIDogX2Rlc2NyaXB0b3IsDQogICAgICAgICAgICBvbkhvbGRTaW5jZSAgICAgOiAwICAgICAgICAgICAgICAgICAgIC8vIG9mZmVyIGlzIG5vdCBvbiBob2xkIGJ5IGRlZmF1bHQuDQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gc3Vic2NyaXB0aW9uQ291bnRlcjsgICAgICAgICAgICAgICAvLyByZXR1cm5zIGFuIGlkIG9mIHRoZSBuZXcgb2ZmZXIuDQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIHVwZGF0ZXMgY3VycmVudGx5IGF2YWlsYWJsZSBudW1iZXIgb2Ygc3Vic2NyaXB0aW9uIGZvciB0aGlzIG9mZmVyLg0KICAgIC8vLyAgICAgICAgT3RoZXIgb2ZmZXIncyBwYXJhbWV0ZXIgY2FuJ3QgYmUgdXBkYXRlZCBiZWNhdXNlIHRoZXkgYXJlIGNvbnNpZGVyZWQgdG8gYmUgYSBwdWJsaWMgb2ZmZXIgcmV2aWV3ZWQgYnkgY3VzdG9tZXJzLg0KICAgIC8vLyAgICAgICAgVGhlIHNlcnZpY2UgcHJvdmlkZXIgc2hvdWxkIHJlY3JlYXRlIHRoZSBvZmZlciBhcyBhIG5ldyBvbmUgaW4gY2FzZSBvZiBvdGhlciBjaGFuZ2VzLg0KICAgIC8vDQogICAgZnVuY3Rpb24gdXBkYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBfb2ZmZXJJZCwgdWludCBfb2ZmZXJMaW1pdCkgcHVibGljIG5vdFN1c3BlbmRlZCB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tfb2ZmZXJJZF07DQogICAgICAgIGFzc2VydCAoX2lzT2ZmZXIob2ZmZXIpKTsNCiAgICAgICAgYXNzZXJ0IChvZmZlci50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIpOyAvL29ubHkgUHJvdmlkZXIgaXMgYWxsb3dlZCB0byB1cGRhdGUgdGhlIG9mZmVyLg0KICAgICAgICBvZmZlci5leGVjQ291bnRlciA9IF9vZmZlckxpbWl0Ow0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBhY2NlcHQgZ2l2ZW4gb2ZmZXIgYW5kIGNyZWF0ZSBhIG5ldyBzdWJzY3JpcHRpb24gb24gdGhlIGJhc2Ugb2YgaXQuDQogICAgLy8vDQogICAgLy8vQGRldiB0aGUgc2VydmljZSBwcm92aWRlciAob2ZmZXIuYHRyYW5zZmVyVG9gKSBiZWNvbWVzIG5vdGlmaWVkIGFib3V0IG5ldyBzdWJzY3JpcHRpb24gYnkgY2FsbCBgb25TdWJOZXcobmV3U3ViSWQsIF9vZmZlcklkKWAuDQogICAgLy8vICAgICBJdCBpcyBwcm92aWRlcidzIHJlc3BvbnNpYmlsaXR5IHRvIHJldHJpZXZlIGFuZCBzdG9yZSBhbnkgbmVjZXNzYXJ5IGluZm9ybWF0aW9uIGFib3V0IG9mZmVyIGFuZCB0aGlzIG5ldyBzdWJzY3JpcHRpb24uIFNvbWUgb2YgaW5mbyBpcyBvbmx5IGF2YWlsYWJsZSBhdCB0aGlzIHBvaW50Lg0KICAgIC8vLyAgICAgVGhlIFNlcnZpY2UgUHJvdmlkZXIgY2FuIGFsc28gcmVqZWN0IHRoZSBuZXcgc3Vic2NyaXB0aW9uIGJ5IHRocm93aW5nIGFuIGV4Y2VwdGlvbiBvciByZXR1cm5pbmcgYGZhbHNlYCBmcm9tIGBvblN1Yk5ldyhuZXdTdWJJZCwgX29mZmVySWQpYCBldmVudCBoYW5kbGVyLg0KICAgIC8vL0BwYXJhbSBfb2ZmZXJJZCAgIC0gaWQgb2YgdGhlIG9mZmVyIHRvIGJlIGFjY2VwdGVkDQogICAgLy8vQHBhcmFtIF9leHBpcmVPbiAgLSBzdWJzY3JpcHRpb24gZXhwaXJhdGlvbiB0aW1lOyBubyBjaGFyZ2VzIGFyZSBwb3NzaWJsZSBiZWhpbmQgdGhpcyB0aW1lLg0KICAgIC8vL0BwYXJhbSBfc3RhcnRPbiAgIC0gc3Vic2NyaXB0aW9uIHN0YXJ0IHRpbWU7IG5vIGNoYXJnZXMgYXJlIHBvc3NpYmxlIGJlZm9yZSB0aGlzIHRpbWUuDQogICAgLy8vICAgICAgICAgICAgICAgICAgICBJZiB0aGUgYF9zdGFydE9uYCBpcyBpbiB0aGUgcGFzdCBvciBpcyB6ZXJvLCBpdCBtZWFucyBzdGFydCB0aGUgc3Vic2NyaXB0aW9uIEFTQVAuDQogICAgLy8NCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb24odWludCBfb2ZmZXJJZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX3N0YXJ0T24pIHB1YmxpYyBub3RTdXNwZW5kZWQgbm9SZWVudHJhbmN5KEwwMikgcmV0dXJucyAodWludCBuZXdTdWJJZCkgew0KICAgICAgICBhc3NlcnQgKF9zdGFydE9uIDwgX2V4cGlyZU9uKTsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW19vZmZlcklkXTsNCiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOw0KICAgICAgICBhc3NlcnQgKG9mZmVyLnN0YXJ0T24gPT0gMCAgICAgfHwgb2ZmZXIuc3RhcnRPbiAgPD0gbm93KTsNCiAgICAgICAgYXNzZXJ0IChvZmZlci5leHBpcmVPbiA9PSAwICAgIHx8IG9mZmVyLmV4cGlyZU9uID49IG5vdyk7DQogICAgICAgIGFzc2VydCAob2ZmZXIub25Ib2xkU2luY2UgPT0gMCk7DQogICAgICAgIGFzc2VydCAob2ZmZXIuZXhlY0NvdW50ZXIgPiAwKTsNCiAgICAgICAgLS1vZmZlci5leGVjQ291bnRlcjsNCiAgICAgICAgbmV3U3ViSWQgPSArK3N1YnNjcmlwdGlvbkNvdW50ZXI7DQogICAgICAgIC8vY3JlYXRlIGEgY2xvbmUgb2YgdGhlIG9mZmVyLi4uDQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG5ld1N1YiA9IHN1YnNjcmlwdGlvbnNbbmV3U3ViSWRdID0gb2ZmZXI7DQogICAgICAgIC8vLi4uIGFuZCBhZGp1c3Qgc29tZSBmaWVsZHMgc3BlY2lmaWMgdG8gc3Vic2NyaXB0aW9uDQogICAgICAgIG5ld1N1Yi50cmFuc2ZlckZyb20gPSBtc2cuc2VuZGVyOw0KICAgICAgICBuZXdTdWIuZXhlY0NvdW50ZXIgPSAwOw0KICAgICAgICBuZXdTdWIucGFpZFVudGlsID0gbmV3U3ViLnN0YXJ0T24gPSBtYXgoX3N0YXJ0T24sIG5vdyk7ICAgICAvL25vIGRlYnRzIGJlZm9yZSBhY3R1YWwgY3JlYXRpb24gdGltZSENCiAgICAgICAgbmV3U3ViLmV4cGlyZU9uID0gX2V4cGlyZU9uOw0KICAgICAgICBuZXdTdWIuZGVwb3NpdEFtb3VudCA9IF9hcHBseVhjaGFuZ2VSYXRlKG5ld1N1Yi5kZXBvc2l0QW1vdW50LCBuZXdTdWIpOyAgICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgIC8vZGVwb3NpdEFtb3VudCBpcyBub3cgc3RvcmVkIGluIHRoZSBzdWIsIHNvIGJ1cm4gdGhlIHNhbWUgYW1vdW50IGZyb20gY3VzdG9tZXIncyBhY2NvdW50Lg0KICAgICAgICBhc3NlcnQgKHNhbi5fYnVybkZvckRlcG9zaXQobXNnLnNlbmRlciwgbmV3U3ViLmRlcG9zaXRBbW91bnQpKTsNCiAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIobmV3U3ViLnRyYW5zZmVyVG8pLm9uU3ViTmV3KG5ld1N1YklkLCBfb2ZmZXJJZCkpOyAgICAgICAgICAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeTsgc2VydmljZSBwcm92aWRlciBjYW4gc3RpbGwgcmVqZWN0IHRoZSBuZXcgc3Vic2NyaXB0aW9uIGhlcmUNCg0KICAgICAgICBOZXdTdWJzY3JpcHRpb24obmV3U3ViLnRyYW5zZmVyRnJvbSwgbmV3U3ViLnRyYW5zZmVyVG8sIF9vZmZlcklkLCBuZXdTdWJJZCk7DQogICAgICAgIHJldHVybiBuZXdTdWJJZDsNCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgY2FuY2VsIGFuIG9mZmVyIGdpdmVuIGJ5IGBvZmZlcklkYC4NCiAgICAvLy9AZGV2IHNldHMgb2ZmZXIuYGV4cGlyZU9uYCB0byBgZXhwaXJlT25gLg0KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQ0KICAgIC8vDQogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW29mZmVySWRdOw0KICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7DQogICAgICAgIGFzc2VydCAob2ZmZXIudHJhbnNmZXJUbyA9PSBtc2cuc2VuZGVyIHx8IG93bmVyID09IG1zZy5zZW5kZXIpOyAvL29ubHkgc2VydmljZSBwcm92aWRlciBvciBwbGF0Zm9ybSBvd25lciBpcyBhbGxvd2VkIHRvIGNhbmNlbCB0aGUgb2ZmZXINCiAgICAgICAgaWYgKG9mZmVyLmV4cGlyZU9uPm5vdyl7DQogICAgICAgICAgICBvZmZlci5leHBpcmVPbiA9IG5vdzsNCiAgICAgICAgICAgIE9mZmVyQ2FuY2VsZWQob2ZmZXJJZCwgbXNnLnNlbmRlcik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNhbmNlbCBhbiBzdWJzY3JpcHRpb24gZ2l2ZW4gYnkgYHN1YklkYCAoYSBncmFjZWZ1bCB2ZXJzaW9uKS4NCiAgICAvLy9Abm90aWNlIElNUE9SVEFOVDogYSBtYWxpY2lvdXMgc2VydmljZSBwcm92aWRlciBjYW4gY29uc3VtZSBhbGwgZ2FzIGFuZCBwcmV2ZW50aW5nIHN1YnNjcmlwdGlvbiBmcm9tIGNhbmNlbGxhdGlvbi4NCiAgICAvLy8gICAgICAgIElmIHNvLCB1c2UgYGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkLCB1aW50IGdhc1Jlc2VydmUpYCBhcyB0aGUgZm9yY2VkIHZlcnNpb24uDQogICAgLy8vICAgICAgICAgc2VlIGBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKWAgZm9yIG1vcmUgZG9jdW1lbnRhdGlvbi4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIHsNCiAgICAgICAgcmV0dXJuIGNhbmNlbFN1YnNjcmlwdGlvbihzdWJJZCwgMCk7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNhbmNlbCBhbiBzdWJzY3JpcHRpb24gZ2l2ZW4gYnkgYHN1YklkYCAoYSBmb3JjZWQgdmVyc2lvbikuDQogICAgLy8vICAgICAgICBDYW5jZWxsYXRpb24gbWVhbnMgbm8gZnVydGhlciBjaGFyZ2VzIHRvIHRoaXMgc3Vic2NyaXB0aW9uIGFyZSBwb3NzaWJsZS4gVGhlIHByb3ZpZGVkIHN1YnNjcmlwdGlvbiBkZXBvc2l0IGNhbiBiZSB3aXRoZHJhd24gb25seSBgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3Zlci4NCiAgICAvLy8gICAgICAgIERlcGVuZGluZyBvbiBuYXR1cmUgb2YgdGhlIHNlcnZpY2UgcHJvdmlkZWQsIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBhbGxvdyBhbiBpbW1lZGlhdGUgZGVwb3NpdCB3aXRoZHJhd2FsIGJ5IGByZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkKWAgY2FsbCwgYnV0IGl0cyBvbiBoaXMgb3duLg0KICAgIC8vLyAgICAgICAgSW4gc29tZSBidXNpbmVzcyBjYXNlcyBhIGRlcG9zaXQgbXVzdCByZW1haW4gbG9ja2VkIHVudGlsIGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyIGV2ZW4sIHRoZSBzdWJzY3JpcHRpb24gaXMgYWxyZWFkeSBjYW5jZWxlZC4NCiAgICAvLy9Abm90aWNlIGdhc1Jlc2VydmUgaXMgYSBnYXMgYW1vdW50IHJlc2VydmVkIGZvciBjb250cmFjdCBleGVjdXRpb24gQUZURVIgc2VydmljZSBwcm92aWRlciBiZWNvbWVzIGBvblN1YkNhbmNlbGVkKHVpbnQyNTYsYWRkcmVzcylgIG5vdGlmaWNhdGlvbi4NCiAgICAvLy8gICAgICAgIEl0IGd1YXJhbnRlZXMsIHRoYXQgY2FuY2VsbGF0aW9uIGJlY29tZXMgZXhlY3V0ZWQgZXZlbiBhIChtYWxpY2lvdXMpIHNlcnZpY2UgcHJvdmlkZXIgY29uc3VtZXMgYWxsIGdhcyBwcm92aWRlZC4NCiAgICAvLy8gICAgICAgIElmIHNvLCB1c2UgYGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkLCB1aW50IGdhc1Jlc2VydmUpYCBhcyB0aGUgZm9yY2VkIHZlcnNpb24uDQogICAgLy8vICAgICAgICBUaGlzIGRpZmZlcmVuY2UgaXMgYmVjYXVzZSB0aGUgY3VzdG9tZXIgbXVzdCBhbHdheXMgaGF2ZSBhIHBvc3NpYmlsaXR5IHRvIGNhbmNlbCBoaXMgY29udHJhY3QgZXZlbiB0aGUgc2VydmljZSBwcm92aWRlciBkaXNhZ3JlZSBvbiBjYW5jZWxsYXRpb24uDQogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIHRvIGJlIGNhbmNlbGxlZA0KICAgIC8vL0BwYXJhbSBnYXNSZXNlcnZlIC0gZ2FzIHJlc2VydmVkIGZvciBjYWxsIGZpbmFsaXphdGlvbiAobWluaW11bSByZXNlcnZhdGlvbiBpcyAxMDAwMCBnYXMpDQogICAgLy8NCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKSBwdWJsaWMgbm90U3VzcGVuZGVkIG5vUmVlbnRyYW5jeShMMDMpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIGFzc2VydCAoc3ViLnRyYW5zZmVyRnJvbSA9PSBtc2cuc2VuZGVyIHx8IG93bmVyID09IG1zZy5zZW5kZXIpOyAvL29ubHkgc3Vic2NyaXB0aW9uIG93bmVyIG9yIHBsYXRmb3JtIG93bmVyIGlzIGFsbG93ZWQgdG8gY2FuY2VsIGl0DQogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOw0KICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87DQogICAgICAgIHN1Yi5leHBpcmVPbiA9IG1heChub3csIHN1Yi5wYWlkVW50aWwpOw0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBfdG8pIHsNCiAgICAgICAgICAgIC8vc3VwcmVzcyByZS10aHJvd2luZyBvZiBleGNlcHRpb25zOyByZXNlcnZlIGVub3VnaCBnYXMgdG8gZmluaXNoIHRoaXMgZnVuY3Rpb24NCiAgICAgICAgICAgIGdhc1Jlc2VydmUgPSBtYXgoZ2FzUmVzZXJ2ZSwxMDAwMCk7ICAvL3Jlc2VydmUgbWluaW11bSAxMDAwMCBnYXMNCiAgICAgICAgICAgIGFzc2VydCAobXNnLmdhcyA+IGdhc1Jlc2VydmUpOyAgICAgICAvL3Nhbml0eSBjaGVjaw0KICAgICAgICAgICAgaWYgKF90by5jYWxsLmdhcyhtc2cuZ2FzLWdhc1Jlc2VydmUpKGJ5dGVzNChzaGEzKCJvblN1YkNhbmNlbGVkKHVpbnQyNTYsYWRkcmVzcykiKSksIHN1YklkLCBtc2cuc2VuZGVyKSkgeyAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgICAgICAgICAgLy9kbyBub3RoaW5nLiBpdCBpcyBub3RpZmljYXRpb24gb25seS4NCiAgICAgICAgICAgICAgICAvL0xhdGVyOiBpcyBpdCBwb3NzaWJsZSB0byBldmFsdWF0ZSByZXR1cm4gdmFsdWUgaGVyZT8gSWYgaXMgYmV0dGVyIHRvIHJldHVybiB0aGUgc3Vic2NyaXB0aW9uIGRlcG9zaXQgaGVyZS4NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBTdWJDYW5jZWxlZChzdWJJZCwgbXNnLnNlbmRlcik7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIHBsYWNlIGFuIGFjdGl2ZSBvZmZlciBvbiBob2xkOyBpdCBtZWFucyBubyBzdWJzY3JpcHRpb25zIGNhbiBiZSBjcmVhdGVkIGZyb20gdGhpcyBvZmZlci4NCiAgICAvLy8gICAgICAgIE9ubHkgc2VydmljZSBwcm92aWRlciAob3IgcGxhdGZvcm0gb3duZXIpIGlzIGFsbG93ZWQgdG8gaG9sZC91bmhvbGQgYSBzdWJzY3JpcHRpb24gb2ZmZXIuDQogICAgLy8vQHBhcmFtIG9mZmVySWQgLSBpZCBvZiB0aGUgb2ZmZXIgdG8gYmUgcGxhY2VkIG9uIGhvbGQuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBob2xkU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbb2ZmZXJJZF07DQogICAgICAgIGFzc2VydCAoX2lzT2ZmZXIob2ZmZXIpKTsNCiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvZmZlci50cmFuc2ZlclRvIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOyAvL29ubHkgb3duZXIgb3Igc2VydmljZSBwcm92aWRlciBjYW4gcGxhY2UgdGhlIG9mZmVyIG9uIGhvbGQuDQogICAgICAgIGlmIChvZmZlci5vbkhvbGRTaW5jZSA9PSAwKSB7DQogICAgICAgICAgICBvZmZlci5vbkhvbGRTaW5jZSA9IG5vdzsNCiAgICAgICAgICAgIE9mZmVyT25Ib2xkKG9mZmVySWQsIHRydWUsIG1zZy5zZW5kZXIpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSByZXN1bWUgb24taG9sZCBvZmZlcjsgc3Vic2NyaXB0aW9ucyBjYW4gYmUgY3JlYXRlZCBmcm9tIHRoaXMgb2ZmZXIgYWdhaW4gKGlmIG90aGVyIGNvbmRpdGlvbnMgYXJlIG1ldCkuDQogICAgLy8vICAgICAgICBPbmx5IHNlcnZpY2UgcHJvdmlkZXIgKG9yIHBsYXRmb3JtIG93bmVyKSBpcyBhbGxvd2VkIHRvIGhvbGQvdW5ob2xkIGEgc3Vic2NyaXB0aW9uIG9mZmVyLg0KICAgIC8vL0BwYXJhbSBvZmZlcklkIC0gaWQgb2YgdGhlIG9mZmVyIHRvIGJlIHJlc3VtZWQuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tvZmZlcklkXTsNCiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOw0KICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IG9mZmVyLnRyYW5zZmVyVG8gfHwgbXNnLnNlbmRlciA9PSBvd25lcik7IC8vb25seSBvd25lciBvciBzZXJ2aWNlIHByb3ZpZGVyIGNhbiByZWFjdGl2YXRlIHRoZSBvZmZlci4NCiAgICAgICAgaWYgKG9mZmVyLm9uSG9sZFNpbmNlID4gMCkgew0KICAgICAgICAgICAgb2ZmZXIub25Ib2xkU2luY2UgPSAwOw0KICAgICAgICAgICAgT2ZmZXJPbkhvbGQob2ZmZXJJZCwgZmFsc2UsIG1zZy5zZW5kZXIpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb3Igc2VydmljZSBwcm92aWRlciB0byBwbGFjZSBhIHN1YnNjcmlwdGlvbiBvbiBob2xkLg0KICAgIC8vLyAgICAgICAgSWYgY2FsbCBpcyBvcmlnaW5hdGVkIGJ5IGN1c3RvbWVyIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGNhbiByZWplY3QgdGhlIHJlcXVlc3QuDQogICAgLy8vICAgICAgICBBIHN1YnNjcmlwdGlvbiBvbiBob2xkIHdpbGwgbm90IGJlIGNoYXJnZWQuIFRoZSBzZXJ2aWNlIGlzIHVzdWFsbHkgbm90IHByb3ZpZGVkIGFzIHdlbGwuDQogICAgLy8vICAgICAgICBEdXJpbmcgaG9sZCB0aW1lIGEgc3Vic2NyaXB0aW9uIHByZXNlcnZlIHJlbWFpbmluZyBwYWlkIHRpbWUgcGVyaW9kLCB3aGljaCBiZWNvbWVzIGF2YWlsYWJsZSBhZnRlciB1bmhvbGQuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgbm9SZWVudHJhbmN5KEwwNCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsNCiAgICAgICAgdmFyIF90byA9IHN1Yi50cmFuc2ZlclRvOw0KICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IF90byB8fCBtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlckZyb20pOyAvL29ubHkgY3VzdG9tZXIgb3IgcHJvdmlkZXIgY2FuIHBsYWNlIHRoZSBzdWJzY3JpcHRpb24gb24gaG9sZC4NCiAgICAgICAgaWYgKHN1Yi5vbkhvbGRTaW5jZSA9PSAwKSB7DQogICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBfdG8gfHwgU2VydmljZVByb3ZpZGVyKF90bykub25TdWJVbkhvbGQoc3ViSWQsIG1zZy5zZW5kZXIsIHRydWUpKSB7ICAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQ0KICAgICAgICAgICAgICAgIHN1Yi5vbkhvbGRTaW5jZSA9IG5vdzsNCiAgICAgICAgICAgICAgICBTdWJPbkhvbGQoc3ViSWQsIHRydWUsIG1zZy5zZW5kZXIpOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0NCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgY2FsbGVkIGJ5IGN1c3RvbWVyIG9yIHNlcnZpY2UgcHJvdmlkZXIgdG8gdW5ob2xkIHN1YnNjcmlwdGlvbi4NCiAgICAvLy8gICAgICAgIElmIGNhbGwgaXMgb3JpZ2luYXRlZCBieSBjdXN0b21lciB0aGUgc2VydmljZSBwcm92aWRlciBjYW4gcmVqZWN0IHRoZSByZXF1ZXN0Lg0KICAgIC8vLyAgICAgICAgQSBzdWJzY3JpcHRpb24gb24gaG9sZCB3aWxsIG5vdCBiZSBjaGFyZ2VkLiBUaGUgc2VydmljZSBpcyB1c3VhbGx5IG5vdCBwcm92aWRlZCBhcyB3ZWxsLg0KICAgIC8vLyAgICAgICAgRHVyaW5nIGhvbGQgdGltZSBhIHN1YnNjcmlwdGlvbiBwcmVzZXJ2ZSByZW1haW5pbmcgcGFpZCB0aW1lIHBlcmlvZCwgd2hpY2ggYmVjb21lcyBhdmFpbGFibGUgYWZ0ZXIgdW5ob2xkLg0KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQ0KICAgIC8vDQogICAgZnVuY3Rpb24gdW5ob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgbm9SZWVudHJhbmN5KEwwNSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsNCiAgICAgICAgdmFyIF90byA9IHN1Yi50cmFuc2ZlclRvOw0KICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IF90byB8fCBtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlckZyb20pOyAvL29ubHkgY3VzdG9tZXIgb3IgcHJvdmlkZXIgY2FuIHBsYWNlIHRoZSBzdWJzY3JpcHRpb24gb24gaG9sZC4NCiAgICAgICAgaWYgKHN1Yi5vbkhvbGRTaW5jZSA+IDApIHsNCiAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyID09IF90byB8fCBTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblN1YlVuSG9sZChzdWJJZCwgbXNnLnNlbmRlciwgZmFsc2UpKSB7ICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgICAgICAgICAgc3ViLnBhaWRVbnRpbCArPSBub3cgLSBzdWIub25Ib2xkU2luY2U7DQogICAgICAgICAgICAgICAgc3ViLm9uSG9sZFNpbmNlID0gMDsNCiAgICAgICAgICAgICAgICBTdWJPbkhvbGQoc3ViSWQsIGZhbHNlLCBtc2cuc2VuZGVyKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgICAgICBkZXBvc2l0IGhhbmRsaW5nICAgICAgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy8vQG5vdGljZSBjYW4gYmUgY2FsbGVkIGJ5IHByb3ZpZGVyIG9uIENBTkNFTEVEIHN1YnNjcmlwdGlvbiB0byByZXR1cm4gYSBzdWJzY3JpcHRpb24gZGVwb3NpdCB0byBjdXN0b21lciBpbW1lZGlhdGVseS4NCiAgICAvLy8gICAgICAgIEN1c3RvbWVyIGNhbiBhbnl3YXkgY29sbGVjdCBoaXMgZGVwb3NpdCBhZnRlciBgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3Zlci4NCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gaG9sZGluZyB0aGUgZGVwb3NpdA0KICAgIC8vDQogICAgZnVuY3Rpb24gcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQodWludCBzdWJJZCkgcHVibGljIG5vdFN1c3BlbmRlZCB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICBhc3NlcnQgKF9zdWJzY3JpcHRpb25TdGF0ZShzdWIpID09IFN1YlN0YXRlLkNBTkNFTEVEKTsNCiAgICAgICAgYXNzZXJ0IChzdWIuZGVwb3NpdEFtb3VudCA+IDApOyAvL3Nhbml0eSBjaGVjaw0KICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzdWJzY3JpcHRpb24gb3duZXIgb3IgcGxhdGZvcm0gb3duZXIgaXMgYWxsb3dlZCB0byByZWxlYXNlIGRlcG9zaXQuDQogICAgICAgIHN1Yi5leHBpcmVPbiA9IG5vdzsNCiAgICAgICAgX3JldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHN1YklkLCBzdWIpOw0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb24gRVhQSVJFRCBzdWJzY3JpcHRpb24gKGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyKSB0byBjb2xsZWN0IGEgc3Vic2NyaXB0aW9uIGRlcG9zaXQuDQogICAgLy8vICAgICAgICBDdXN0b21lciBjYW4gYW55d2F5IGNvbGxlY3QgaGlzIGRlcG9zaXQgYWZ0ZXIgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIuDQogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIGhvbGRpbmcgdGhlIGRlcG9zaXQNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNsYWltU3Vic2NyaXB0aW9uRGVwb3NpdCh1aW50IHN1YklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIGFzc2VydCAoX3N1YnNjcmlwdGlvblN0YXRlKHN1YikgPT0gU3ViU3RhdGUuRVhQSVJFRCk7DQogICAgICAgIGFzc2VydCAoc3ViLnRyYW5zZmVyRnJvbSA9PSBtc2cuc2VuZGVyKTsNCiAgICAgICAgYXNzZXJ0IChzdWIuZGVwb3NpdEFtb3VudCA+IDApOw0KICAgICAgICBfcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQoc3ViSWQsIHN1Yik7DQogICAgfQ0KDQoNCiAgICAvL0BkZXYgcmV0dXJucyBzdWJzY3JpcHRpb24gZGVwb3NpdCB0byBjdXN0b21lcg0KICAgIGZ1bmN0aW9uIF9yZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkLCBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIHsNCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50ID0gc3ViLmRlcG9zaXRBbW91bnQ7DQogICAgICAgIHN1Yi5kZXBvc2l0QW1vdW50ID0gMDsNCiAgICAgICAgc2FuLl9taW50RnJvbURlcG9zaXQoc3ViLnRyYW5zZmVyRnJvbSwgZGVwb3NpdEFtb3VudCk7DQogICAgICAgIFN1YnNjcmlwdGlvbkRlcG9zaXRSZXR1cm5lZChzdWJJZCwgZGVwb3NpdEFtb3VudCwgc3ViLnRyYW5zZmVyRnJvbSwgbXNnLnNlbmRlcik7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNyZWF0ZSBzaW1wbGUgdW5sb2NrZWQgZGVwb3NpdCwgcmVxdWlyZWQgYnkgc29tZSBzZXJ2aWNlcy4gSXQgY2FuIGJlIGNvbnNpZGVyZWQgYXMgcHJvdmUgb2YgY3VzdG9tZXIncyBzdGFrZS4NCiAgICAvLy8gICAgICAgIFRoaXMgZGVzcG9zaXQgY2FuIGJlIGNsYWltZWQgYmFjayBieSB0aGUgY3VzdG9tZXIgYXQgYW55dGltZS4NCiAgICAvLy8gICAgICAgIFRoZSBzZXJ2aWNlIHByb3ZpZGVyIGlzIHJlc3BvbnNpYmxlIHRvIGNoZWNrIHRoZSBkZXBvc2l0IGJlZm9yZSBwcm92aWRpbmcgdGhlIHNlcnZpY2UuDQogICAgLy8vQHBhcmFtIF92YWx1ZSAtIG5vbiB6ZXJvIGRlcG9zaXQgYW1vdW50Lg0KICAgIC8vL0BwYXJhbSBfZGVzY3JpcHRvciAtIGlzIGEgdW5pcSBrZXksIHVzdWFsbHkgZ2l2ZW4gYnkgc2VydmljZSBwcm92aWRlciB0byB0aGUgY3VzdG9tZXIgaW4gb3JkZXIgdG8gbWFrZSB0aGlzIGRlcG9zaXQgdW5pcXVlLg0KICAgIC8vLyAgICAgICAgU2VydmljZSBQcm92aWRlciBzaG91bGQgcmVqZWN0IGRlcG9zaXQgd2l0aCB1bmtub3duIGRlc2NyaXB0b3IsIGJlY2F1c2UgbW9zdCBwcm9iYWJseSBpdCBpcyBpbiB1c2UgZm9yIHNvbWUgYW5vdGhlciBzZXJ2aWNlLg0KICAgIC8vL0ByZXR1cm4gZGVwb3NpdElkIC0gYSBoYW5kbGUgdG8gY2xhaW0gYmFjayB0aGUgZGVwb3NpdCBsYXRlci4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZURlcG9zaXQodWludCBfdmFsdWUsIHVpbnQgX2xvY2tUaW1lLCBieXRlcyBfZGVzY3JpcHRvcikgcHVibGljIG5vdFN1c3BlbmRlZCByZXR1cm5zICh1aW50IGRlcG9zaXRJZCkgew0KICAgICAgICByZXF1aXJlIChfdmFsdWUgPiAwKTsNCiAgICAgICAgYXNzZXJ0IChzYW4uX2J1cm5Gb3JEZXBvc2l0KG1zZy5zZW5kZXIsX3ZhbHVlKSk7DQogICAgICAgIGRlcG9zaXRzWysrZGVwb3NpdENvdW50ZXJdID0gRGVwb3NpdCAoew0KICAgICAgICAgICAgb3duZXIgOiBtc2cuc2VuZGVyLA0KICAgICAgICAgICAgdmFsdWUgOiBfdmFsdWUsDQogICAgICAgICAgICBjcmVhdGVkT24gOiBub3csDQogICAgICAgICAgICBsb2NrVGltZSA6IF9sb2NrVGltZSwNCiAgICAgICAgICAgIGRlc2NyaXB0b3IgOiBfZGVzY3JpcHRvcg0KICAgICAgICB9KTsNCiAgICAgICAgTmV3RGVwb3NpdChkZXBvc2l0Q291bnRlciwgX3ZhbHVlLCBfbG9ja1RpbWUsIG1zZy5zZW5kZXIpOw0KICAgICAgICByZXR1cm4gZGVwb3NpdENvdW50ZXI7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIHJldHVybiBwcmV2aW91c2x5IGNyZWF0ZWQgZGVwb3NpdCB0byB0aGUgdXNlci4gVXNlciBjYW4gY29sbGVjdCBvbmx5IG93biBkZXBvc2l0Lg0KICAgIC8vLyAgICAgICAgVGhlIHNlcnZpY2UgcHJvdmlkZXIgaXMgcmVzcG9uc2libGUgdG8gY2hlY2sgdGhlIGRlcG9zaXQgYmVmb3JlIHByb3ZpZGluZyB0aGUgc2VydmljZS4NCiAgICAvLy9AcGFyYW0gX2RlcG9zaXRJZCAtIGFuIGlkIG9mIHRoZSBkZXBvc2l0IHRvIGJlIGNvbGxlY3RlZC4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNsYWltRGVwb3NpdCh1aW50IF9kZXBvc2l0SWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgew0KICAgICAgICB2YXIgZGVwb3NpdCA9IGRlcG9zaXRzW19kZXBvc2l0SWRdOw0KICAgICAgICByZXF1aXJlIChkZXBvc2l0Lm93bmVyID09IG1zZy5zZW5kZXIpOw0KICAgICAgICBhc3NlcnQgKGRlcG9zaXQubG9ja1RpbWUgPT0gMCB8fCBkZXBvc2l0LmNyZWF0ZWRPbiArICBkZXBvc2l0LmxvY2tUaW1lIDwgbm93KTsNCiAgICAgICAgdmFyIHZhbHVlID0gZGVwb3NpdHNbX2RlcG9zaXRJZF0udmFsdWU7DQogICAgICAgIGRlbGV0ZSBkZXBvc2l0c1tfZGVwb3NpdElkXTsNCiAgICAgICAgc2FuLl9taW50RnJvbURlcG9zaXQobXNnLnNlbmRlciwgdmFsdWUpOw0KICAgICAgICBEZXBvc2l0UmV0dXJuZWQoX2RlcG9zaXRJZCwgbXNnLnNlbmRlcik7DQogICAgfQ0KDQoNCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgICAgc29tZSBpbnRlcm5hbCBmdW5jdGlvbnMgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgZnVuY3Rpb24gX2Ftb3VudFRvQ2hhcmdlKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgcmVlbnRyYW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIF9hcHBseVhjaGFuZ2VSYXRlKHN1Yi5wcmljZVBlckhvdXIgKiBzdWIuY2hhcmdlUGVyaW9kLCBzdWIpIC8gMSBob3VyczsgICAgICAgLy8gPD09PT0gcmVlbnRyYW50IGZ1bmN0aW9uIHVzYWdlDQogICAgfQ0KDQogICAgZnVuY3Rpb24gX2FwcGx5WGNoYW5nZVJhdGUodWludCBhbW91bnQsIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgcmVlbnRyYW50IHJldHVybnMgKHVpbnQpIHsgIC8vIDw9PSBhY3R1YWxseSBjYWxsZWQgZnJvbSByZWVudHJhbmN5IGd1YXJkZWQgY29udGV4dCBvbmx5IChpLmUuIGV4dGVybmFsbHkgc2VjdXJlZCkNCiAgICAgICAgaWYgKHN1Yi54cmF0ZVByb3ZpZGVySWQgPiAwKSB7DQogICAgICAgICAgICAvLyB4cmF0ZV9uOiBub21pbmF0b3INCiAgICAgICAgICAgIC8vIHhyYXRlX2Q6IGRlbm9taW5hdG9yIG9mIHRoZSBleGNoYW5nZSByYXRlIGZyYWN0aW9uLg0KICAgICAgICAgICAgdmFyICh4cmF0ZV9uLCB4cmF0ZV9kKSA9IFhSYXRlUHJvdmlkZXIoeHJhdGVQcm92aWRlcnNbc3ViLnhyYXRlUHJvdmlkZXJJZF0pLmdldFJhdGUoKTsgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQ0KICAgICAgICAgICAgYW1vdW50ID0gYW1vdW50ICogc3ViLmluaXRpYWxYcmF0ZV9uICogeHJhdGVfZCAvIHN1Yi5pbml0aWFsWHJhdGVfZCAvIHhyYXRlX247DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGFtb3VudDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfaXNPZmZlcihTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpew0KICAgICAgICByZXR1cm4gc3ViLnRyYW5zZmVyRnJvbSA9PSAwICYmIHN1Yi50cmFuc2ZlclRvICE9IDA7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gX2lzU3Vic2NyaXB0aW9uKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7DQogICAgICAgIHJldHVybiBzdWIudHJhbnNmZXJGcm9tICE9IDAgJiYgc3ViLnRyYW5zZmVyVG8gIT0gMDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfZXhpc3RzKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7DQogICAgICAgIHJldHVybiBzdWIudHJhbnNmZXJUbyAhPSAwOyAgIC8vZXhpc3Rpbmcgc3Vic2NyaXB0aW9uIG9yIG9mZmVyIGhhcyBhbHdheXMgdHJhbnNmZXJUbyBzZXQuDQogICAgfQ0KDQogICAgbW9kaWZpZXIgb25seVJlZ2lzdGVyZWRQcm92aWRlcigpew0KICAgICAgICBpZiAoIXByb3ZpZGVyUmVnaXN0cnlbbXNnLnNlbmRlcl0pIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG5vdFN1c3BlbmRlZCB7DQogICAgICAgIGlmIChzdXNwZW5kZWRVbnRpbCA+IG5vdykgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQp9IC8vU3Vic2NyaXB0aW9uTW9kdWxlSW1wbA=='