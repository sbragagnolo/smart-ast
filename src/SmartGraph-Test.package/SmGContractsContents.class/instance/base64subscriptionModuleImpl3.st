base 64 content
base64subscriptionModuleImpl3
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KY29udHJhY3QgQmFzZSB7DQoNCiAgICBmdW5jdGlvbiBtYXgodWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOyB9DQogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7IHJldHVybiBhIDw9IGIgPyBhIDogYjsgfQ0KDQogICAgbW9kaWZpZXIgb25seShhZGRyZXNzIGFsbG93ZWQpIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWxsb3dlZCkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQoNCiAgICAvLy9AcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0DQogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7DQogICAgICAgIHVpbnQgc2l6ZTsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKHNpemUgPiAwKTsNCiAgICB9DQoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy8gKiAgICAgICAgICByZWVudHJhbmN5IGhhbmRsaW5nICAgICAgICAgICAgICAgICAgKg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KICAgIC8vQGRldiBwcmVkZWZpbmVkIGxvY2tzICh1cCB0byB1aW50IGJpdCBsZW5ndGgsIGkuZS4gMjU2IHBvc3NpYmxlKQ0KICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDAwID0gMiAqKiAwOw0KICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDAxID0gMiAqKiAxOw0KICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDAyID0gMiAqKiAyOw0KICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDAzID0gMiAqKiAzOw0KICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDA0ID0gMiAqKiA0Ow0KICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDA1ID0gMiAqKiA1Ow0KDQogICAgLy9wcmV2ZW50cyByZWVudHJhbmN5IGF0dGFjczogc3BlY2lmaWMgbG9ja3MNCiAgICB1aW50IHByaXZhdGUgYml0bG9ja3MgPSAwOw0KICAgIG1vZGlmaWVyIG5vUmVlbnRyYW5jeSh1aW50IG0pIHsNCiAgICAgICAgdmFyIF9sb2NrcyA9IGJpdGxvY2tzOw0KICAgICAgICBpZiAoX2xvY2tzICYgbSA+IDApIHRocm93Ow0KICAgICAgICBiaXRsb2NrcyB8PSBtOw0KICAgICAgICBfOw0KICAgICAgICBiaXRsb2NrcyA9IF9sb2NrczsNCiAgICB9DQoNCiAgICBtb2RpZmllciBub0FueVJlZW50cmFuY3kgew0KICAgICAgICB2YXIgX2xvY2tzID0gYml0bG9ja3M7DQogICAgICAgIGlmIChfbG9ja3MgPiAwKSB0aHJvdzsNCiAgICAgICAgYml0bG9ja3MgPSB1aW50KC0xKTsNCiAgICAgICAgXzsNCiAgICAgICAgYml0bG9ja3MgPSBfbG9ja3M7DQogICAgfQ0KDQogICAgLy8vQGRldiBlbXB0eSBtYXJraW5nIG1vZGlmaWVyIHNpZ25hbGluZyB0byB1c2VyIG9mIHRoZSBtYXJrZWQgZnVuY3Rpb24gLCB0aGF0IGl0IGNhbiBjYXVzZSBhbiByZWVudHJhbnQgY2FsbC4NCiAgICAvLy8gICAgIGRldmVsb3BlciBzaG91bGQgbWFrZSB0aGUgY2FsbGVyIGZ1bmN0aW9uIHJlZW50cmFudC1zYWZlIGlmIGl0IHVzZSBhIHJlZW50cmFudCBmdW5jdGlvbi4NCiAgICBtb2RpZmllciByZWVudHJhbnQgeyBfOyB9DQoNCn0NCg0KY29udHJhY3QgT3duZWQgaXMgQmFzZSB7DQoNCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsNCg0KICAgIGZ1bmN0aW9uIE93bmVkKCkgew0KICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIG9ubHkob3duZXIpIHsNCiAgICAgICAgbmV3T3duZXIgPSBfbmV3T3duZXI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgb25seShuZXdPd25lcikgew0KICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOw0KICAgICAgICBvd25lciA9IG5ld093bmVyOw0KICAgIH0NCg0KICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90byk7DQoNCn0NCg0KDQpjb250cmFjdCBFUkMyMCBpcyBPd25lZCB7DQoNCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsNCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsNCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaXNTdGFydGVkT25seSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgew0KICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOw0KICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7DQogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaXNTdGFydGVkT25seSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7DQogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsNCiAgICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfdmFsdWU7DQogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7DQogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSB7IHJldHVybiBmYWxzZTsgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7DQogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIGlzU3RhcnRlZE9ubHkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgew0KICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsNCiAgICB9DQoNCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOw0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsNCg0KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5Ow0KICAgIGJvb2wgICAgcHVibGljIGlzU3RhcnRlZCA9IGZhbHNlOw0KDQogICAgbW9kaWZpZXIgb25seUhvbGRlcihhZGRyZXNzIGhvbGRlcikgew0KICAgICAgICBpZiAoYmFsYW5jZU9mKGhvbGRlcikgPT0gMCkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgbW9kaWZpZXIgaXNTdGFydGVkT25seSgpIHsNCiAgICAgICAgaWYgKCFpc1N0YXJ0ZWQpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KfQ0KDQovL0RlY2lzaW9uIG1hZGUuDQovLyAxIC0gUHJvdmlkZXIgaXMgc29sZWx5IHJlc3BvbnNpYmxlIHRvIGNvbnNpZGVyIGZhaWxlZCBzdWIgY2hhcmdlIGFzIGFuIGVycm9yIGFuZCBzdG9wIHRoZSBzZXJ2aWNlLA0KLy8gICAgdGhlcmVmb3JlIHRoZXJlIGlzIG5vIHNlcGFyYXRlIGVycm9yIHN0YXRlIG9yIGNvdW50ZXIgZm9yIHRoYXQgaW4gdGhpcyBUb2tlbiBDb250cmFjdC4NCi8vDQovLyAyIC0gQSBjYWxsIG9yaWdpbmF0ZWQgZnJvbSB0aGUgdXNlciAoaXNDb250cmFjdChtc2cuc2VuZGVyKT09ZmFsc2UpIHNob3VsZCB0aHJvdyBhbiBleGNlcHRpb24gb24gZXJyb3IsDQovLyAgICAgYnV0IGl0IHNob3VsZCByZXR1cm4gImZhbHNlIiBvbiBlcnJvciBpZiBjYWxsZWQgZnJvbSBvdGhlciBjb250cmFjdCAoaXNDb250cmFjdChtc2cuc2VuZGVyKT09dHJ1ZSkuDQovLyAgICAgUmVhc29uOiB0aHJvd24gZXhjZXB0aW9uIGFyZSBlYXNpZXIgdG8gc2VlIGluIHdhbGxldHMsIHJldHVybmVkIGJvb2xlYW4gdmFsdWVzIGFyZSBlYXNpZXIgdG8gZXZhbHVhdGUgaW4gdGhlIGNvZGUgb2YgdGhlIGNhbGxpbmcgY29udHJhY3QuDQovLw0KLy8gMyAtIFNlcnZpY2UgcHJvdmlkZXJzIGFyZSByZXNwb25zaWJsZSBmb3IgZmlyaW5nIGV2ZW50cyBpbiBjYXNlIG9mIG9mZmVyIGNoYW5nZXM7DQovLyAgICAgaXQgaXMgdGhlaXJzIGRlY2lzaW9uIHRvIGluZm9ybSBEQXBwcyBhYm91dCBvZmZlciBjaGFuZ2VzIG9yIG5vdC4NCi8vDQovL1RvRG86DQovLyA4IC0gdmFsaWRhdGUgbGlua2luZyBtb2R1bGVzIGFuZCBkZXBsb3ltZW50IHByb2Nlc3M6IGF0dGFjaFRva2VuKGFkZHJlc3MgdG9rZW4pIHB1YmxpYw0KDQoNCi8vL0BkZXYgYW4gYmFzZSBjbGFzcyB0byBpbXBsZW1lbnQgYnkgU2VydmljZSBQcm92aWRlciBjb250cmFjdCB0byBiZSBub3RpZmllZCBhYm91dCBzdWJzY3JpcHRpb24gY2hhbmdlcyAoaW4tVHggbm90aWZpY2F0aW9uKS4NCi8vLyAgICAgQWRkaXRpb25hbGx5IGl0IGNvbnRhaW5zIHN0YW5kYXJkIGV2ZW50cyB0byBiZSBmaXJlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIG9uIG9mZmVyIGNoYW5nZXMuDQovLy8gICAgIHNlZSBhbHNlIEVWTSBldmVudHMgbG9nZ2VkIGJ5IHN1YnNjcmlwdGlvbiBtb2R1bGUuDQovLw0KY29udHJhY3QgU2VydmljZVByb3ZpZGVyIHsNCg0KICAgIC8vL0BkZXYgZ2V0IGh1bWFuIHJlYWRhYmxlIGRlc2NyaXB0b3IgKG9yIHVybCkgZm9yIHRoaXMgU2VydmljZSBwcm92aWRlcg0KICAgIC8vDQogICAgZnVuY3Rpb24gaW5mbygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHN0cmluZyk7DQoNCiAgICAvLy9AZGV2IGNhbGxlZCB0byBwb3N0LWFwcHJvdmUvcmVqZWN0IGluY29taW5nIHNpbmdsZSBwYXltZW50Lg0KICAgIC8vL0ByZXR1cm4gYGZhbHNlYCBjYXVzZXMgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnRzIHRoZSBwYXltZW50Lg0KICAgIC8vDQogICAgZnVuY3Rpb24gb25QYXltZW50KGFkZHJlc3MgX2Zyb20sIHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEpIHB1YmxpYyByZXR1cm5zIChib29sKTsNCg0KICAgIC8vL0BkZXYgY2FsbGVkIHRvIHBvc3QtYXBwcm92ZS9yZWplY3Qgc3Vic2NyaXB0aW9uIGNoYXJnZS4NCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgb3BlcmF0aW9uLg0KICAgIC8vDQogICAgZnVuY3Rpb24gb25TdWJFeGVjdXRlZCh1aW50IHN1YklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy9AZGV2IGNhbGxlZCB0byBwb3N0LWFwcHJvdmUvcmVqZWN0IGEgY3JlYXRpb24gb2YgdGhlIHN1YnNjcmlwdGlvbi4NCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgb3BlcmF0aW9uLg0KICAgIC8vDQogICAgZnVuY3Rpb24gb25TdWJOZXcodWludCBuZXdTdWJJZCwgdWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy9AZGV2IGNhbGxlZCB0byBub3RpZnkgc2VydmljZSBwcm92aWRlciBhYm91dCBzdWJzY3JpcHRpb24gY2FuY2VsbGF0aW9uLg0KICAgIC8vLyAgICAgUHJvdmlkZXIgaXMgbm90IGFibGUgdG8gcHJldmVudCB0aGUgY2FuY2VsbGF0aW9uLg0KICAgIC8vL0ByZXR1cm4gPDxyZXNlcnZlZCBmb3IgZnV0dXJlIGltcGxlbWVudGF0aW9uPj4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIG9uU3ViQ2FuY2VsZWQodWludCBzdWJJZCwgYWRkcmVzcyBjYWxsZXIpIHB1YmxpYyByZXR1cm5zIChib29sKTsNCg0KICAgIC8vL0BkZXYgY2FsbGVkIHRvIG5vdGlmeSBzZXJ2aWNlIHByb3ZpZGVyIGFib3V0IHN1YnNjcmlwdGlvbiBnb3QgaG9sZC91bmhvbGQuDQogICAgLy8vQHJldHVybiBgZmFsc2VgIGNhdXNlcyBhbiBleGNlcHRpb24gYW5kIHJldmVydHMgdGhlIG9wZXJhdGlvbi4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIG9uU3ViVW5Ib2xkKHVpbnQgc3ViSWQsIGFkZHJlc3MgY2FsbGVyLCBib29sIGlzT25Ib2xkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCg0KICAgIC8vL0BkZXYgZm9sbG93aW5nIGV2ZW50cyBzaG91bGQgYmUgdXNlZCBieSBTZXJ2aWNlUHJvdmlkZXIgY29udHJhY3QgdG8gbm90aWZ5IERBcHBzIGFib3V0IG9mZmVyIGNoYW5nZXMuDQogICAgLy8vICAgICBTdWJzY3JpcHRpb25Nb2R1bGUgZG8gbm90IHRoaXMgbm90aWZpY2F0aW9uIGFuZCBleHBlY3RzIGl0IGZyb20gU2VydmljZSBQcm92aWRlciBpZiBkZXNpcmVkLg0KICAgIC8vLw0KICAgIC8vL0BkZXYgdG8gYmUgZmlyZWQgYnkgU2VydmljZVByb3ZpZGVyIG9uIG5ldyBPZmZlciBjcmVhdGVkIGluIGEgcGxhdGZvcm0uDQogICAgZXZlbnQgT2ZmZXJDcmVhdGVkKHVpbnQgb2ZmZXJJZCwgIGJ5dGVzIGRlc2NyaXB0b3IsIGFkZHJlc3MgcHJvdmlkZXIpOw0KDQogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gT2ZmZXIgdXBkYXRlZC4NCiAgICBldmVudCBPZmZlclVwZGF0ZWQodWludCBvZmZlcklkLCAgYnl0ZXMgZGVzY3JpcHRvciwgdWludCBvbGRFeGVjQ291bnRlciwgYWRkcmVzcyBwcm92aWRlcik7DQoNCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBPZmZlciBjYW5jZWxlZC4NCiAgICBldmVudCBPZmZlckNhbmNlbGVkKHVpbnQgb2ZmZXJJZCwgYnl0ZXMgZGVzY3JpcHRvciwgYWRkcmVzcyBwcm92aWRlcik7DQoNCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBPZmZlciBob2xkL3VuaG9sZCBzdGF0dXMgY2hhbmdlZC4NCiAgICBldmVudCBPZmZlclVuSG9sZCh1aW50IG9mZmVySWQsICAgYnl0ZXMgZGVzY3JpcHRvciwgYm9vbCBpc09uSG9sZE5vdywgYWRkcmVzcyBwcm92aWRlcik7DQp9IC8vU2VydmljZVByb3ZpZGVyDQoNCi8vL0Bub3RpY2UgWFJhdGVQcm92aWRlciBpcyBhbiBleHRlcm5hbCBzZXJ2aWNlIHByb3ZpZGluZyBhbiBleGNoYW5nZSByYXRlIGZyb20gZXh0ZXJuYWwgY3VycmVuY3kgdG8gU0FOIHRva2VuLg0KLy8vIGl0IHVzZWQgZm9yIHN1YnNjcmlwdGlvbnMgcHJpY2VkIGluIG90aGVyIGN1cnJlbmN5IHRoYW4gU0FOIChldmVuIGNhbGN1bGF0ZWQgYW5kIHBhaWQgZm9ybWFsbHkgaW4gU0FOKS4NCi8vLyBpZiBub24tZGVmYXVsdCBYUmF0ZVByb3ZpZGVyIGlzIHNldCBmb3Igc29tZSBzdWJzY3JpcHRpb24sIHRoZW4gdGhlIGFtb3VudCBpbiBTQU4gZm9yIGV2ZXJ5IHBlcmlvZGljIHBheW1lbnQNCi8vLyB3aWxsIGJlIHJlY2FsY3VsYXRlZCB1c2luZyBwcm92aWRlZCBleGNoYW5nZSByYXRlLg0KLy8vDQovLy8gUGxlYXNlIG5vdGUsIHRoYXQgdGhlIGV4Y2hhbmdlIHJhdGUgZnJhY3Rpb24gaXMgKHVpbnQzMix1aW50MzIpIG51bWJlci4gSXQgc2hvdWxkIGJlIGVub3VnaCB0byBleHByZXNzDQovLy8gYW55IHJlYWwgZXhjaGFuZ2UgcmF0ZSB2b2xhdGlsaXR5LiBOZXZlcnRoZWxlc3MgeW91IGFyZSBhZHZpc2VkIHRvIGF2b2lkIHRvbyBiaWcgbnVtYmVycyBpbiB0aGUgZnJhY3Rpb24uDQovLy8gUG9zc2lpYmx5IHlvdSBjb3VsZCBpbXBsZW1lbnQgdGhlIHJhdGlvIG9mIG11bHRpcGxlIHRva2VuIHBlciBTQU4gaW4gb3JkZXIgdG8ga2VlcCB0aGUgYXZlcmFnZSByYXRpbyBhcm91bmQgMToxLg0KLy8vDQovLy8gVGhlIGRlZmF1bHQgWFJhdGVQcm92aWRlciAod2l0aCBpZD09MCkgZGVmaW5lcyBleGNoYW5nZSByYXRlIDE6MSBhbmQgcmVwcmVzZW50cyBleGNoYW5nZSByYXRlIG9mIFNBTiB0b2tlbiB0byBpdHNlbGYuDQovLy8gdGhpcyBwcm92aWRlciBpcyBzZXQgYnkgZGVmYWx1bHQgYW5kIHRodXMgdGhlIHN1YnNjcmlwdGlvbiBiZWNvbWVzIG5vbWluYXRlZCBpbiBTQU4uDQovLw0KY29udHJhY3QgWFJhdGVQcm92aWRlciB7DQoNCiAgICAvL0BkZXYgcmV0dXJucyBjdXJyZW50IGV4Y2hhbmdlIHJhdGUgKGluIGZvcm0gb2YgYSBzaW1wbGUgZnJhY3Rpb24pIGZyb20gb3RoZXIgY3VycmVuY3kgdG8gU0FOIChmLmUuIEVUSDpTQU4pLg0KICAgIC8vQGRldiBmcmFjdGlvbiBudW1iZXJzIGFyZSByZXN0cmljdGVkIHRvIHVpbnQxNiB0byBwcmV2ZW50IG92ZXJmbG93IGluIGNhbGN1bGF0aW9uczsNCiAgICBmdW5jdGlvbiBnZXRSYXRlKCkgcHVibGljIHJldHVybnMgKHVpbnQzMiAvKm5vbWluYXRvciovLCB1aW50MzIgLypkZW5vbWluYXRvciovKTsNCg0KICAgIC8vQGRldiBwcm92aWRlcyBhIGNvZGUgZm9yIGFub3RoZXIgY3VycmVuY3ksIGYuZS4gIkVUSCIgb3IgIlVTRCINCiAgICBmdW5jdGlvbiBnZXRDb2RlKCkgcHVibGljIHJldHVybnMgKHN0cmluZyk7DQp9DQoNCg0KLy9AZGV2IGRhdGEgc3RydWN0dXJlIGZvciBTdWJzY3JpcHRpb25Nb2R1bGUNCmNvbnRyYWN0IFN1YnNjcmlwdGlvbkJhc2Ugew0KDQogICAgZW51bSBTdWJTdGF0ZSAgIHtOT1RfRVhJU1QsIEJFRk9SRV9TVEFSVCwgUEFJRCwgQ0hBUkdFQUJMRSwgT05fSE9MRCwgQ0FOQ0VMRUQsIEVYUElSRUQsIEZJTkFMSVpFRH0NCiAgICBlbnVtIE9mZmVyU3RhdGUge05PVF9FWElTVCwgQkVGT1JFX1NUQVJULCBBQ1RJVkUsIFNPTERfT1VULCBPTl9IT0xELCBFWFBJUkVEfQ0KDQogICAgc3RyaW5nW10gaW50ZXJuYWwgU1VCX1NUQVRFUyAgID0gWyJOT1RfRVhJU1QiLCAiQkVGT1JFX1NUQVJUIiwgIlBBSUQiLCAiQ0hBUkdFQUJMRSIsICJPTl9IT0xEIiwgIkNBTkNFTEVEIiwgIkVYUElSRUQiLCAiRklOQUxJWkVEIiBdOw0KICAgIHN0cmluZ1tdIGludGVybmFsIE9GRkVSX1NUQVRFUyA9IFsiTk9UX0VYSVNUIiwgIkJFRk9SRV9TVEFSVCIsICJBQ1RJVkUiLCAiU09MRF9PVVQiLCAiT05fSE9MRCIsICJFWFBJUkVEIl07DQoNCiAgICAvL0BkZXYgc3Vic2NyaXB0aW9uIGFuZCBzdWJzY3JpcHRpb24gb2ZmZXIgdXNlIHRoZSBzYW1lIHN0cnVjdHVyZS4gT2ZmZXIgaXMgdGVjaG5pY2FsbHkgYSB0ZW1wbGF0ZSBmb3Igc3Vic2NyaXB0aW9uLg0KICAgIHN0cnVjdCBTdWJzY3JpcHRpb24gew0KICAgICAgICBhZGRyZXNzIHRyYW5zZmVyRnJvbTsgICAvLyBjdXN0b21lciAodW5zZXQgaW4gc3Vic2NyaXB0aW9uIG9mZmVyKQ0KICAgICAgICBhZGRyZXNzIHRyYW5zZmVyVG87ICAgICAvLyBzZXJ2aWNlIHByb3ZpZGVyDQogICAgICAgIHVpbnQgcHJpY2VQZXJIb3VyOyAgICAgIC8vIHByaWNlIGluIFNBTiBwZXIgaG91ciAocG9zc2libHkgcmVjYWxjdWxhdGVkIHVzaW5nIGV4Y2hhbmdlIHJhdGUpDQogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfbjsgIC8vIG5vbWluYXRvcg0KICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX2Q7ICAvLyBkZW5vbWluYXRvcg0KICAgICAgICB1aW50MTYgeHJhdGVQcm92aWRlcklkOyAvLyBpZCBvZiBhIHJlZ2lzdGVyZWQgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlcg0KICAgICAgICB1aW50IHBhaWRVbnRpbDsgICAgICAgICAvLyBzdWJzY3JpcHRpb24gaXMgcGFpZCB1bnRpbCB0aW1lDQogICAgICAgIHVpbnQgY2hhcmdlUGVyaW9kOyAgICAgIC8vIHN1YnNjcmlwdGlvbiBjYW4ndCBiZSBjaGFyZ2VkIG1vcmUgb2Z0ZW4gdGhhbiB0aGlzIHBlcmlvZA0KICAgICAgICB1aW50IGRlcG9zaXRBbW91bnQ7ICAgICAvLyB1cGZyb250IGRlcG9zaXQgb24gY3JlYXRpbmcgc3Vic2NyaXB0aW9uIChwb3NzaWJseSByZWNhbGN1bGF0ZWQgdXNpbmcgZXhjaGFuZ2UgcmF0ZSkNCg0KICAgICAgICB1aW50IHN0YXJ0T247ICAgICAgICAgICAvLyBmb3Igb2ZmZXI6IGNhbid0IGJlIGFjY2VwdGVkIGJlZm9yZSAgPHN0YXJ0T24+IDsgZm9yIHN1YnNjcmlwdGlvbjogY2FuJ3QgYmUgY2hhcmdlZCBiZWZvcmUgPHN0YXJ0T24+DQogICAgICAgIHVpbnQgZXhwaXJlT247ICAgICAgICAgIC8vIGZvciBvZmZlcjogY2FuJ3QgYmUgYWNjZXB0ZWQgYWZ0ZXIgIDxleHBpcmVPbj4gOyBmb3Igc3Vic2NyaXB0aW9uOiBjYW4ndCBiZSBjaGFyZ2VkIGFmdGVyICA8ZXhwaXJlT24+DQogICAgICAgIHVpbnQgZXhlY0NvdW50ZXI7ICAgICAgIC8vIGZvciBvZmZlcjogbWF4IG51bSBvZiBzdWJzY3JpcHRpb25zIGF2YWlsYWJsZSAgOyBmb3Igc3Vic2NyaXB0aW9uOiBudW0gb2YgY2hhcmdlcyBtYWRlLg0KICAgICAgICBieXRlcyBkZXNjcmlwdG9yOyAgICAgICAvLyBzdWJzY3JpcHRpb24gcGF5bG9hZCAoc3ViamVjdCk6IGV2YWx1YXRlZCBieSBzZXJ2aWNlIHByb3ZpZGVyLg0KICAgICAgICB1aW50IG9uSG9sZFNpbmNlOyAgICAgICAvLyBzdWJzY3JpcHRpb246IG9uLWhvbGQgc2luY2UgdGltZSBvciAwIGlmIG5vdCBvbkhvbGQuIG9mZmVyOiB1bnVzZWQ6IC8vVG9EbzogdG8gYmUgaW1wbGVtZW50ZWQNCiAgICB9DQoNCiAgICBzdHJ1Y3QgRGVwb3NpdCB7DQogICAgICAgIHVpbnQgdmFsdWU7ICAgICAgICAgLy8gdmFsdWUgb24gZGVwb3NpdA0KICAgICAgICBhZGRyZXNzIG93bmVyOyAgICAgIC8vIHVzdWFsbHkgYSBjdXN0b21lcg0KICAgICAgICBieXRlcyBkZXNjcmlwdG9yOyAgIC8vIHNlcnZpY2UgcmVsYXRlZCBkZXNjcmlwdG9yIHRvIGJlIGV2YWx1YXRlZCBieSBzZXJ2aWNlIHByb3ZpZGVyDQogICAgfQ0KDQogICAgZXZlbnQgTmV3U3Vic2NyaXB0aW9uKGFkZHJlc3MgY3VzdG9tZXIsIGFkZHJlc3Mgc2VydmljZSwgdWludCBvZmZlcklkLCB1aW50IHN1YklkKTsNCiAgICBldmVudCBOZXdEZXBvc2l0KHVpbnQgZGVwb3NpdElkLCB1aW50IHZhbHVlLCBhZGRyZXNzIHNlbmRlcik7DQogICAgZXZlbnQgTmV3WFJhdGVQcm92aWRlcihhZGRyZXNzIGFkZHIsIHVpbnQxNiB4UmF0ZVByb3ZpZGVySWQsIGFkZHJlc3Mgc2VuZGVyKTsNCiAgICBldmVudCBEZXBvc2l0UmV0dXJuZWQodWludCBkZXBvc2l0SWQsIGFkZHJlc3MgcmV0dXJuZWRUbyk7DQogICAgZXZlbnQgU3Vic2NyaXB0aW9uRGVwb3NpdFJldHVybmVkKHVpbnQgc3ViSWQsIHVpbnQgYW1vdW50LCBhZGRyZXNzIHJldHVybmVkVG8sIGFkZHJlc3Mgc2VuZGVyKTsNCiAgICBldmVudCBPZmZlck9uSG9sZCh1aW50IG9mZmVySWQsIGJvb2wgb25Ib2xkLCBhZGRyZXNzIHNlbmRlcik7DQogICAgZXZlbnQgT2ZmZXJDYW5jZWxlZCh1aW50IG9mZmVySWQsIGFkZHJlc3Mgc2VuZGVyKTsNCiAgICBldmVudCBTdWJPbkhvbGQodWludCBvZmZlcklkLCBib29sIG9uSG9sZCwgYWRkcmVzcyBzZW5kZXIpOw0KICAgIGV2ZW50IFN1YkNhbmNlbGVkKHVpbnQgc3ViSWQsIGFkZHJlc3Mgc2VuZGVyKTsNCg0KfQ0KDQovLy9AZGV2IGFuIEludGVyZmFjZSBmb3IgU3Vic2NyaXB0aW9uTW9kdWxlLg0KLy8vICAgICBleHRyYWN0ZWQgaGVyZSBmb3IgYmV0dGVyIG92ZXJ2aWV3Lg0KLy8vICAgICBzZWUgZGV0YWlsZWQgZG9jdW1lbnRhdGlvbiBpbiBpbXBsZW1lbnRhdGlvbiBtb2R1bGUuDQpjb250cmFjdCBTdWJzY3JpcHRpb25Nb2R1bGUgaXMgU3Vic2NyaXB0aW9uQmFzZSwgQmFzZSB7DQoNCiAgICAvLy9AZGV2ICoqKioqIG1vZHVsZSBjb25maWd1cmF0aW9uICoqKioqDQogICAgZnVuY3Rpb24gYXR0YWNoVG9rZW4oYWRkcmVzcyB0b2tlbikgcHVibGljOw0KDQogICAgLy8vQGRldiAqKioqKiBzaW5nbGUgcGF5bWVudCBoYW5kbGluZyAqKioqKg0KICAgIGZ1bmN0aW9uIHBheW1lbnRUbyh1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhLCBTZXJ2aWNlUHJvdmlkZXIgX3RvKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gcGF5bWVudEZyb20odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgYWRkcmVzcyBfZnJvbSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KDQogICAgLy8vQGRldiAqKioqKiBzdWJzY3JpcHRpb24gaGFuZGxpbmcgKioqKioNCiAgICAvLy9AZGV2IHNvbWUgZnVuY3Rpb25zIGFyZSBtYXJrZWQgYXMgcmVlbnRyYW50LCBldmVuIHRoZWlycyBpbXBsZW1lbnRhdGlvbiBpcyBtYXJrZWQgd2l0aCBub1JlZW50cmFuY3koTE9DSykuDQogICAgLy8vICAgICBUaGlzIGlzIGludGVudGlvbmFsbHkgYmVjYXVzZSB0aGVzZSBub1JlZW50cmFuY3koTE9DSykgcmVzdHJpY3Rpb25zIGNhbiBiZSBsaWZ0ZWQgaW4gdGhlIGZ1dHVyZS4NCiAgICAvLyAgICAgIEZ1bmN0aW9ucyB3b3VsZCBiZWNvbWUgcmVlbnRyYW50Lg0KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbih1aW50IF9vZmZlcklkLCB1aW50IF9leHBpcmVPbiwgdWludCBfc3RhcnRPbikgcHVibGljIHJlZW50cmFudCByZXR1cm5zICh1aW50IG5ld1N1YklkKTsNCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcmVlbnRyYW50IHB1YmxpYzsNCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKSByZWVudHJhbnQgcHVibGljOw0KICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gZXhlY3V0ZVN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gcG9zdHBvbmVEdWVEYXRlKHVpbnQgc3ViSWQsIHVpbnQgbmV3RHVlRGF0ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQodWludCBzdWJJZCkgcHVibGljOw0KICAgIGZ1bmN0aW9uIGNsYWltU3Vic2NyaXB0aW9uRGVwb3NpdCh1aW50IHN1YklkKSBwdWJsaWM7DQogICAgZnVuY3Rpb24gc3RhdGUodWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHN0YXRlKTsNCiAgICBmdW5jdGlvbiBzdGF0ZUNvZGUodWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCBzdGF0ZUNvZGUpOw0KDQogICAgLy8vQGRldiAqKioqKiBzdWJzY3JpcHRpb24gb2ZmZXIgaGFuZGxpbmcgKioqKioNCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb25PZmZlcih1aW50IF9wcmljZSwgdWludDE2IF94cmF0ZVByb3ZpZGVySWQsIHVpbnQgX2NoYXJnZVBlcmlvZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX29mZmVyTGltaXQsIHVpbnQgX2RlcG9zaXRWYWx1ZSwgdWludCBfc3RhcnRPbiwgYnl0ZXMgX2Rlc2NyaXB0b3IpIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAodWludCBzdWJJZCk7DQogICAgZnVuY3Rpb24gdXBkYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkLCB1aW50IF9vZmZlckxpbWl0KSBwdWJsaWM7DQogICAgZnVuY3Rpb24gaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gdW5ob2xkU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sKTsNCg0KICAgIC8vL0BkZXYgKioqKiogc2ltcGxlIGRlcG9zaXQgaGFuZGxpbmcgKioqKioNCiAgICBmdW5jdGlvbiBjcmVhdGVEZXBvc2l0KHVpbnQgX3ZhbHVlLCBieXRlcyBfZGVzY3JpcHRvcikgcHVibGljIHJldHVybnMgKHVpbnQgc3ViSWQpOw0KICAgIGZ1bmN0aW9uIGNsYWltRGVwb3NpdCh1aW50IGRlcG9zaXRJZCkgcHVibGljOw0KDQogICAgLy8vQGRldiAqKioqKiBFeGNoYW5nZVJhdGUgcHJvdmlkZXIgKioqKioNCiAgICBmdW5jdGlvbiByZWdpc3RlclhSYXRlUHJvdmlkZXIoWFJhdGVQcm92aWRlciBhZGRyKSBwdWJsaWMgcmV0dXJucyAodWludDE2IHhyYXRlUHJvdmlkZXJJZCk7DQoNCiAgICAvLy9AZGV2ICoqKioqIFNlcnZpY2UgcHJvdmlkZXIgKHBheW1lbnQgcmVjZWl2ZXIpICoqKioqDQogICAgZnVuY3Rpb24gZW5hYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljOw0KICAgIGZ1bmN0aW9uIGRpc2FibGVTZXJ2aWNlUHJvdmlkZXIoU2VydmljZVByb3ZpZGVyIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKSBwdWJsaWM7DQoNCg0KICAgIC8vL0BkZXYgKioqKiogY29udmVuaWVuY2Ugc3Vic2NyaXB0aW9uIGdldHRlciAqKioqKg0KICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvbkRldGFpbHModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoDQogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJGcm9tLA0KICAgICAgICBhZGRyZXNzIHRyYW5zZmVyVG8sDQogICAgICAgIHVpbnQgcHJpY2VQZXJIb3VyLA0KICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX24sIC8vbm9taW5hdG9yDQogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfZCwgLy9kZW5vbWluYXRvcg0KICAgICAgICB1aW50MTYgeHJhdGVQcm92aWRlcklkLA0KICAgICAgICB1aW50IGNoYXJnZVBlcmlvZCwNCiAgICAgICAgdWludCBzdGFydE9uLA0KICAgICAgICBieXRlcyBkZXNjcmlwdG9yDQogICAgKTsNCg0KICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvblN0YXR1cyh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucygNCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50LA0KICAgICAgICB1aW50IGV4cGlyZU9uLA0KICAgICAgICB1aW50IGV4ZWNDb3VudGVyLA0KICAgICAgICB1aW50IHBhaWRVbnRpbCwNCiAgICAgICAgdWludCBvbkhvbGRTaW5jZQ0KICAgICk7DQoNCiAgICBlbnVtIFBheW1lbnRTdGF0dXMge09LLCBCQUxBTkNFX0VSUk9SLCBBUFBST1ZBTF9FUlJPUn0NCiAgICBldmVudCBQYXltZW50KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgdWludCBfZmVlLCBhZGRyZXNzIHNlbmRlciwgUGF5bWVudFN0YXR1cyBzdGF0dXMsIHVpbnQgc3ViSWQpOw0KICAgIGV2ZW50IFNlcnZpY2VQcm92aWRlckVuYWJsZWQoYWRkcmVzcyBhZGRyLCBieXRlcyBtb3JlSW5mbyk7DQogICAgZXZlbnQgU2VydmljZVByb3ZpZGVyRGlzYWJsZWQoYWRkcmVzcyBhZGRyLCBieXRlcyBtb3JlSW5mbyk7DQoNCn0gLy9TdWJzY3JpcHRpb25Nb2R1bGUNCg0KY29udHJhY3QgRVJDMjBNb2R1bGVTdXBwb3J0IHsNCiAgICBmdW5jdGlvbiBfZnVsZmlsbFByZWFwcHJvdmVkUGF5bWVudChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGFkZHJlc3MgbXNnX3NlbmRlcikgcHVibGljIHJldHVybnMoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiBfZnVsZmlsbFBheW1lbnQoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCB1aW50IHN1YklkLCBhZGRyZXNzIG1zZ19zZW5kZXIpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIF9taW50RnJvbURlcG9zaXQoYWRkcmVzcyBvd25lciwgdWludCBhbW91bnQpIHB1YmxpYzsNCiAgICBmdW5jdGlvbiBfYnVybkZvckRlcG9zaXQoYWRkcmVzcyBvd25lciwgdWludCBhbW91bnQpIHB1YmxpYyByZXR1cm5zKGJvb2wgc3VjY2Vzcyk7DQp9DQoNCi8vQGRldiBpbXBsZW1lbnRhdGlvbg0KY29udHJhY3QgU3Vic2NyaXB0aW9uTW9kdWxlSW1wbCBpcyBTdWJzY3JpcHRpb25Nb2R1bGUsIE93bmVkICB7DQoNCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFZFUlNJT04gPSAiMC4xLjAiOw0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgICAgICAgICAgIGNvbnRyYWN0IHN0YXRlcyAgICAgICAgICAgICAgICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICAvLy9AZGV2IGxpc3Qgb2YgYWxsIHJlZ2lzdGVyZWQgc2VydmljZSBwcm92aWRlciBjb250cmFjdHMgaW1wbGVtZW50ZWQgYXMgYSBtYXAgZm9yIGJldHRlciBsb29rdXAuDQogICAgbWFwcGluZyAoYWRkcmVzcz0+Ym9vbCkgcHVibGljIHByb3ZpZGVyUmVnaXN0cnk7DQoNCiAgICAvLy9AZGV2IGFsbCBzdWJzY3JpcHRpb25zIGFuZCBvZmZlcnMgKGluY2wuIEZJTkFMSVpFRCkuDQogICAgbWFwcGluZyAodWludCA9PiBTdWJzY3JpcHRpb24pIHB1YmxpYyBzdWJzY3JpcHRpb25zOw0KDQogICAgLy8vQGRldiBhbGwgYWN0aXZlIHNpbXBsZSBkZXBvc2l0cyBnaXZlZCBieSBkZXBvc2l0SWQuDQogICAgbWFwcGluZyAodWludCA9PiBEZXBvc2l0KSBwdWJsaWMgZGVwb3NpdHM7DQoNCiAgICAvLy9AZGV2IGFkZHJlc3NlcyBvZiByZWdpc3RlcmVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXJzLg0KICAgIFhSYXRlUHJvdmlkZXJbXSBwdWJsaWMgeHJhdGVQcm92aWRlcnM7DQoNCiAgICAvLy9AZGV2IG9uZ29pbmcgY291bnRlciBmb3Igc3Vic2NyaXB0aW9uIGlkcyBzdGFydGluZyBmcm9tIDEuDQogICAgLy8vICAgICBDdXJyZW50IHZhbHVlIHJlcHJlc2VudHMgYW4gaWQgb2YgbGFzdCBjcmVhdGVkIHN1YnNjcmlwdGlvbi4NCiAgICB1aW50IHB1YmxpYyBzdWJzY3JpcHRpb25Db3VudGVyID0gMDsNCg0KICAgIC8vL0BkZXYgb25nb2luZyBjb3VudGVyIGZvciBzaW1wbGUgZGVwb3NpdCBpZHMgc3RhcnRpbmcgZnJvbSAxLg0KICAgIC8vLyAgICAgQ3VycmVudCB2YWx1ZSByZXByZXNlbnRzIGFuIGlkIG9mIGxhc3QgY3JlYXRlZCBkZXBvc2l0Lg0KICAgIHVpbnQgcHVibGljIGRlcG9zaXRDb3VudGVyID0gMDsNCg0KICAgIC8vL0BkZXYgVG9rZW4gY29udHJhY3Qgd2l0aCBFUkMyME1vZHVsZVN1cHBvcnQgYWRkb24uDQogICAgLy8vICAgICBTdWJzY3JpcHRpb24gTW9kdWxlIG9wZXJhdGVzIG9uIGl0cyBiYWxhbmNlcyB2aWEgRVJDMjBNb2R1bGVTdXBwb3J0IGludGVyZmFjZSBhcyB0cnVzdGVkIG1vZHVsZS4NCiAgICBFUkMyME1vZHVsZVN1cHBvcnQgcHVibGljIHNhbjsNCg0KDQoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy8gKiAgICAgcmVqZWN0IGFsbCBldGhlciBzZW50IHRvIHRoaXMgY29udHJhY3QgICAgKg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KDQoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy8gKiAgICAgICAgICAgIHNldHVwIGFuZCBjb25maWd1cmF0aW9uICAgICAgICAgICAgKg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KICAgIC8vL0BkZXYgY29uc3RydWN0b3INCiAgICBmdW5jdGlvbiBTdWJzY3JpcHRpb25Nb2R1bGVJbXBsKCkgew0KICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7DQogICAgICAgIHhyYXRlUHJvdmlkZXJzLnB1c2goWFJhdGVQcm92aWRlcih0aGlzKSk7IC8vdGhpcyBpcyBhIGRlZmF1bHQgU0FOOlNBTiAoMToxKSBwcm92aWRlciB3aXRoIGRlZmF1bHQgaWQgPT0gMA0KICAgIH0NCg0KDQogICAgLy8vQGRldiBhdHRhY2ggU0FOIHRva2VuIHRvIHdvcmsgd2l0aDsgY2FuIGJlIGRvbmUgb25seSBvbmNlLg0KICAgIGZ1bmN0aW9uIGF0dGFjaFRva2VuKGFkZHJlc3MgdG9rZW4pIHB1YmxpYyB7DQogICAgICAgIGFzc2VydChhZGRyZXNzKHNhbikgPT0gMCk7IC8vb25seSBpbiBuZXcgZGVwbG95ZWQgc3RhdGUNCiAgICAgICAgc2FuID0gRVJDMjBNb2R1bGVTdXBwb3J0KHRva2VuKTsNCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgcmVnaXN0ZXIgYSBuZXcgc2VydmljZSBwcm92aWRlciB0byB0aGUgcGxhdGZvcm0uDQogICAgZnVuY3Rpb24gZW5hYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljIG9ubHkob3duZXIpIHsNCiAgICAgICAgcHJvdmlkZXJSZWdpc3RyeVthZGRyXSA9IHRydWU7DQogICAgICAgIFNlcnZpY2VQcm92aWRlckVuYWJsZWQoYWRkciwgbW9yZUluZm8pOw0KICAgIH0NCg0KDQogICAgLy8vQGRldiBkZS1yZWdpc3RlciB0aGUgc2VydmljZSBwcm92aWRlciB3aXRoIGdpdmVuIGBhZGRyYC4NCiAgICBmdW5jdGlvbiBkaXNhYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljIG9ubHkob3duZXIpIHsNCiAgICAgICAgZGVsZXRlIHByb3ZpZGVyUmVnaXN0cnlbYWRkcl07DQogICAgICAgIFNlcnZpY2VQcm92aWRlckRpc2FibGVkKGFkZHIsIG1vcmVJbmZvKTsNCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgcmVnaXN0ZXIgbmV3IGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXIuDQogICAgLy8vICAgICBYUmF0ZVByb3ZpZGVyIGNhbid0IGJlIGRlLXJlZ2lzdGVyZWQsIGJlY2F1c2UgdGhleSBjb3VsZCBiZSBzdGlsbCBpbiB1c2UgYnkgc29tZSBzdWJzY3JpcHRpb24uDQogICAgZnVuY3Rpb24gcmVnaXN0ZXJYUmF0ZVByb3ZpZGVyKFhSYXRlUHJvdmlkZXIgYWRkcikgcHVibGljIG9ubHkob3duZXIpIHJldHVybnMgKHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQpIHsNCiAgICAgICAgeHJhdGVQcm92aWRlcklkID0gdWludDE2KHhyYXRlUHJvdmlkZXJzLmxlbmd0aCk7DQogICAgICAgIHhyYXRlUHJvdmlkZXJzLnB1c2goYWRkcik7DQogICAgICAgIE5ld1hSYXRlUHJvdmlkZXIoYWRkciwgeHJhdGVQcm92aWRlcklkLCBtc2cuc2VuZGVyKTsNCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgeHJhdGVQcm92aWRlcnMgbGVuZ3RoIGFjY2Vzc29yLg0KICAgIGZ1bmN0aW9uIGdldFhSYXRlUHJvdmlkZXJMZW5ndGgoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4geHJhdGVQcm92aWRlcnMubGVuZ3RoOw0KICAgIH0NCg0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgICAgICAgIHNpbmdsZSBwYXltZW50IG1ldGhvZHMgICAgICAgICAgICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICAvLy9Abm90aWNlIG1ha2VzIHNpbmdsZSBwYXltZW50IHRvIHNlcnZpY2UgcHJvdmlkZXIuDQogICAgLy8vQHBhcmFtIF92YWx1ZSAtIGFtb3VudCBvZiBTQU4gdG9rZW4gdG8gc2VudA0KICAgIC8vL0BwYXJhbSBfcGF5bWVudERhdGEgLSAncGF5bWVudCBwdXJwb3NlJyBjb2RlIHVzdWFsbHkgaXNzdWVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIgdG8gY3VzdG9tZXIgYmVmb3JlIHBheW1lbnQuDQogICAgLy8vQHBhcmFtIF90byAtIHNlcnZpY2UgcHJvdmlkZXIgY29udHJhY3QNCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIHBheW1lbnRUbyh1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhLCBTZXJ2aWNlUHJvdmlkZXIgX3RvKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoc2FuLl9mdWxmaWxsUGF5bWVudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgMCwgbXNnLnNlbmRlcikpIHsNCiAgICAgICAgICAgIC8vIGEgU2VydmljZVByb3ZpZGVyIChhIFNlcnZpY2VQcm92aWRlcikgaGFzIGhlcmUgYW4gb3Bwb3J0dW5pdHkgdmVyaWZ5IGFuZCByZWplY3QgdGhlIHBheW1lbnQNCiAgICAgICAgICAgIGFzc2VydCAoU2VydmljZVByb3ZpZGVyKF90bykub25QYXltZW50KG1zZy5zZW5kZXIsIF92YWx1ZSwgX3BheW1lbnREYXRhKSk7ICAgICAgICAgICAgICAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQ0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBtYWtlcyBzaW5nbGUgcHJlYXBwcm92ZWQgcGF5bWVudCB0byBzZXJ2aWNlIHByb3ZpZGVyLiBBbiBhbW91bnQgbXVzdCBiZSBhbHJlYWR5IHByZWFwcHJvdmVkIGJ5IHBheW1lbnQgc2VuZGVyIHRvIHJlY2VwaWVudC4NCiAgICAvLy9AcGFyYW0gX3ZhbHVlIC0gYW1vdW50IG9mIFNBTiB0b2tlbiB0byBzZW50DQogICAgLy8vQHBhcmFtIF9wYXltZW50RGF0YSAtICdwYXltZW50IHB1cnBvc2UnIGNvZGUgdXN1YWxseSBpc3N1ZWQgYnkgc2VydmljZSBwcm92aWRlciB0byBjdXN0b21lciBiZWZvcmUgcGF5bWVudC4NCiAgICAvLy9AcGFyYW0gX2Zyb20gLSBzZW5kZXIgb2YgdGhlIHBheW1lbnQgKG90aGVyIHRoYW4gbXNnLnNlbmRlcikNCiAgICAvLy9AcGFyYW0gX3RvIC0gc2VydmljZSBwcm92aWRlciBjb250cmFjdA0KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQ0KICAgIC8vDQogICAgZnVuY3Rpb24gcGF5bWVudEZyb20odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgYWRkcmVzcyBfZnJvbSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKHNhbi5fZnVsZmlsbFByZWFwcHJvdmVkUGF5bWVudChfZnJvbSwgX3RvLCBfdmFsdWUsIG1zZy5zZW5kZXIpKSB7DQogICAgICAgICAgICAvLyBhIFNlcnZpY2VQcm92aWRlciAoYSBTZXJ2aWNlUHJvdmlkZXIpIGhhcyBoZXJlIGFuIG9wcG9ydHVuaXR5IHZlcmlmeSBhbmQgcmVqZWN0IHRoZSBwYXltZW50DQogICAgICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihfdG8pLm9uUGF5bWVudChfZnJvbSwgX3ZhbHVlLCBfcGF5bWVudERhdGEpKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0NCiAgICB9DQoNCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgICAgc3Vic2NyaXB0aW9uIGhhbmRsaW5nICAgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy8vQGRldiBjb252ZW5pZW5jZSBnZXR0ZXIgZm9yIHNvbWUgc3Vic2NyaXB0aW9uIGZpZWxkcw0KICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvbkRldGFpbHModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKA0KICAgICAgICBhZGRyZXNzIHRyYW5zZmVyRnJvbSwNCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlclRvLA0KICAgICAgICB1aW50IHByaWNlUGVySG91ciwNCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9uLCAvL25vbWluYXRvcg0KICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX2QsIC8vZGVub21pbmF0b3INCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZCwNCiAgICAgICAgdWludCBjaGFyZ2VQZXJpb2QsDQogICAgICAgIHVpbnQgc3RhcnRPbiwNCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcg0KICAgICkgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIHJldHVybiAoc3ViLnRyYW5zZmVyRnJvbSwgc3ViLnRyYW5zZmVyVG8sIHN1Yi5wcmljZVBlckhvdXIsIHN1Yi5pbml0aWFsWHJhdGVfbiwgc3ViLmluaXRpYWxYcmF0ZV9kLCBzdWIueHJhdGVQcm92aWRlcklkLCBzdWIuY2hhcmdlUGVyaW9kLCBzdWIuc3RhcnRPbiwgc3ViLmRlc2NyaXB0b3IpOw0KICAgIH0NCg0KDQogICAgLy8vQGRldiBjb252ZW5pZW5jZSBnZXR0ZXIgZm9yIHNvbWUgc3Vic2NyaXB0aW9uIGZpZWxkcw0KICAgIC8vLyAgICAgYSBjYWxsZXIgbXVzdCBrbm93LCB0aGF0IHRoZSBzdWJzY3JpcHRpb24gd2l0aCBnaXZlbiBpZCBleGlzdHMsIGJlY2F1c2UgYWxsIHRoZXNlIGZpZWxkcyBjYW4gYmUgMCBldmVuIHRoZSBzdWJzY3JpcHRpb24gd2l0aCBnaXZlbiBpZCBleGlzdHMuDQogICAgZnVuY3Rpb24gc3Vic2NyaXB0aW9uU3RhdHVzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKA0KICAgICAgICB1aW50IGRlcG9zaXRBbW91bnQsDQogICAgICAgIHVpbnQgZXhwaXJlT24sDQogICAgICAgIHVpbnQgZXhlY0NvdW50ZXIsDQogICAgICAgIHVpbnQgcGFpZFVudGlsLA0KICAgICAgICB1aW50IG9uSG9sZFNpbmNlDQogICAgKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsNCiAgICAgICAgcmV0dXJuIChzdWIuZGVwb3NpdEFtb3VudCwgc3ViLmV4cGlyZU9uLCBzdWIuZXhlY0NvdW50ZXIsIHN1Yi5wYWlkVW50aWwsIHN1Yi5vbkhvbGRTaW5jZSk7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGV4ZWN1dGUgcGVyaW9kaWMgc3Vic2NyaXB0aW9uIHBheW1lbnQuDQogICAgLy8vICAgICAgICBBbnkgb2YgY3VzdG9tZXIsIHNlcnZpY2UgcHJvdmlkZXIgYW5kIHBsYXRmb3JtIG93bmVyIGNhbiBleGVjdXRlIHRoaXMgZnVuY3Rpb24uDQogICAgLy8vICAgICAgICBUaGlzIGVuc3VyZXMsIHRoYXQgdGhlIHN1YnNjcmlwdGlvbiBjaGFyZ2UgZG9lc24ndCBiZWNvbWUgZGVsYXllZC4NCiAgICAvLy8gICAgICAgIEF0IGxlYXN0IHRoZSBwbGF0Zm9ybSBvd25lciBoYXMgYW4gaW5jZW50aXZlIHRvIGdldCBmZWUgYW5kIHRodXMgY2FuIHRyaWdnZXIgdGhlIGZ1bmN0aW9uLg0KICAgIC8vLyAgICAgICAgQW4gZXhlY3V0aW9uIGZhaWxzIGlmIHN1YnNjcmlwdGlvbiBpcyBub3QgaW4gc3RhdHVzIGBDSEFSR0VBQkxFYC4NCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gdG8gYmUgY2hhcmdlZC4NCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGV4ZWN1dGVTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vUmVlbnRyYW5jeShMMDApIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIGFzc2VydCAobXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJGcm9tIHx8IG1zZy5zZW5kZXIgPT0gc3ViLnRyYW5zZmVyVG8gfHwgbXNnLnNlbmRlciA9PSBvd25lcik7DQogICAgICAgIGlmIChfc3Vic2NyaXB0aW9uU3RhdGUoc3ViKT09U3ViU3RhdGUuQ0hBUkdFQUJMRSkgew0KICAgICAgICAgICAgdmFyIF9mcm9tID0gc3ViLnRyYW5zZmVyRnJvbTsNCiAgICAgICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsNCiAgICAgICAgICAgIHZhciBfdmFsdWUgPSBfYW1vdW50VG9DaGFyZ2Uoc3ViKTsNCiAgICAgICAgICAgIGlmIChzYW4uX2Z1bGZpbGxQYXltZW50KF9mcm9tLCBfdG8sIF92YWx1ZSwgc3ViSWQsIG1zZy5zZW5kZXIpKSB7DQogICAgICAgICAgICAgICAgc3ViLnBhaWRVbnRpbCAgPSBtYXgoc3ViLnBhaWRVbnRpbCwgc3ViLnN0YXJ0T24pICsgc3ViLmNoYXJnZVBlcmlvZDsNCiAgICAgICAgICAgICAgICArK3N1Yi5leGVjQ291bnRlcjsNCiAgICAgICAgICAgICAgICAvLyBhIFNlcnZpY2VQcm92aWRlciAoYSBTZXJ2aWNlUHJvdmlkZXIpIGhhcyBoZXJlIGFuIG9wcG9ydHVuaXR5IHRvIHZlcmlmeSBhbmQgcmVqZWN0IHRoZSBwYXltZW50DQogICAgICAgICAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblN1YkV4ZWN1dGVkKHN1YklkKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBtb3ZlIGBwYWlkVW50aWxgIGZvcndhcmQgdG8gZ2l2ZW4gYG5ld0R1ZURhdGVgLiBJdCB3YWl2ZXMgcGF5bWVudHMgZm9yIGdpdmVuIHRpbWUuDQogICAgLy8vICAgICAgICBUaGlzIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIGJ5IHNlcnZpY2UgcHJvdmlkZXIgdG8gYGdpdmUgYXdheWAgc29tZSBzZXJ2aWNlIHRpbWUgZm9yIGZyZWUuDQogICAgLy8vQHBhcmFtIHN1YklkIC0gaWQgb2Ygc3Vic2NyaXB0aW9uIHRvIGJlIHBvc3Rwb25lZC4NCiAgICAvLy9AcGFyYW0gbmV3RHVlRGF0ZSAtIG5ldyBgcGFpZFVudGlsYCBkYXRldGltZTsgcmVxdWlyZSBgbmV3RHVlRGF0ZSA+IHBhaWRVbnRpbGAuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBwb3N0cG9uZUR1ZURhdGUodWludCBzdWJJZCwgdWludCBuZXdEdWVEYXRlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKXsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOw0KICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIpOyAvL29ubHkgU2VydmljZSBQcm92aWRlciBpcyBhbGxvd2VkIHRvIHBvc3Rwb25lIHRoZSBEdWVEYXRlDQogICAgICAgIGlmIChzdWIucGFpZFVudGlsIDwgbmV3RHVlRGF0ZSkgew0KICAgICAgICAgICAgc3ViLnBhaWRVbnRpbCA9IG5ld0R1ZURhdGU7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQGRldiByZXR1cm4gY3VycmVudCBzdGF0dXMgYXMgYSBuYW1lIG9mIGEgc3Vic2NyaXB0aW9uIChvciBhbiBvZmZlcikgd2l0aCBnaXZlbiBpZDsNCiAgICBmdW5jdGlvbiBzdGF0ZSh1aW50IHN1Yk9yT2ZmZXJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHN0YXRlKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdWJPck9mZmVyID0gc3Vic2NyaXB0aW9uc1tzdWJPck9mZmVySWRdOw0KICAgICAgICByZXR1cm4gX2lzT2ZmZXIoc3ViT3JPZmZlcikNCiAgICAgICAgICAgICAgPyBPRkZFUl9TVEFURVNbdWludChfb2ZmZXJTdGF0ZShzdWJPck9mZmVyKSldDQogICAgICAgICAgICAgIDogU1VCX1NUQVRFU1t1aW50KF9zdWJzY3JpcHRpb25TdGF0ZShzdWJPck9mZmVyKSldOw0KICAgIH0NCg0KDQogICAgLy8vQGRldiByZXR1cm4gY3VycmVudCBzdGF0dXMgYXMgYSBjb2RlIG9mIGEgc3Vic2NyaXB0aW9uIChvciBhbiBvZmZlcikgd2l0aCBnaXZlbiBpZDsNCiAgICBmdW5jdGlvbiBzdGF0ZUNvZGUodWludCBzdWJPck9mZmVySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQgc3RhdGVDb2RlKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdWJPck9mZmVyID0gc3Vic2NyaXB0aW9uc1tzdWJPck9mZmVySWRdOw0KICAgICAgICByZXR1cm4gX2lzT2ZmZXIoc3ViT3JPZmZlcikNCiAgICAgICAgICAgICAgPyB1aW50KF9vZmZlclN0YXRlKHN1Yk9yT2ZmZXIpKQ0KICAgICAgICAgICAgICA6IHVpbnQoX3N1YnNjcmlwdGlvblN0YXRlKHN1Yk9yT2ZmZXIpKTsNCiAgICB9DQoNCg0KICAgIGZ1bmN0aW9uIF9vZmZlclN0YXRlKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhPZmZlclN0YXRlIHN0YXR1cykgew0KICAgICAgICBpZiAoIV9pc09mZmVyKHN1YikpIHsNCiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLk5PVF9FWElTVDsNCiAgICAgICAgfSBlbHNlIGlmIChzdWIuc3RhcnRPbiA+IG5vdykgew0KICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuQkVGT1JFX1NUQVJUOw0KICAgICAgICB9IGVsc2UgaWYgKHN1Yi5vbkhvbGRTaW5jZSA+IDApIHsNCiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLk9OX0hPTEQ7DQogICAgICAgIH0gZWxzZSBpZiAobm93IDw9IHN1Yi5leHBpcmVPbikgew0KICAgICAgICAgICAgcmV0dXJuIHN1Yi5leGVjQ291bnRlciA+IDANCiAgICAgICAgICAgICAgICA/IE9mZmVyU3RhdGUuQUNUSVZFDQogICAgICAgICAgICAgICAgOiBPZmZlclN0YXRlLlNPTERfT1VUOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuRVhQSVJFRDsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9zdWJzY3JpcHRpb25TdGF0ZShTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMoU3ViU3RhdGUgc3RhdHVzKSB7DQogICAgICAgIGlmICghX2lzU3Vic2NyaXB0aW9uKHN1YikpIHsNCiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5OT1RfRVhJU1Q7DQogICAgICAgIH0gZWxzZSBpZiAoc3ViLnN0YXJ0T24gPiBub3cpIHsNCiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5CRUZPUkVfU1RBUlQ7DQogICAgICAgIH0gZWxzZSBpZiAoc3ViLm9uSG9sZFNpbmNlID4gMCkgew0KICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLk9OX0hPTEQ7DQogICAgICAgIH0gZWxzZSBpZiAoc3ViLnBhaWRVbnRpbCA+PSBzdWIuZXhwaXJlT24pIHsNCiAgICAgICAgICAgIHJldHVybiBub3cgPCBzdWIuZXhwaXJlT24NCiAgICAgICAgICAgICAgICA/IFN1YlN0YXRlLkNBTkNFTEVEDQogICAgICAgICAgICAgICAgOiBzdWIuZGVwb3NpdEFtb3VudCA+IDANCiAgICAgICAgICAgICAgICAgICAgPyBTdWJTdGF0ZS5FWFBJUkVEDQogICAgICAgICAgICAgICAgICAgIDogU3ViU3RhdGUuRklOQUxJWkVEOw0KICAgICAgICB9IGVsc2UgaWYgKHN1Yi5wYWlkVW50aWwgPD0gbm93KSB7DQogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuQ0hBUkdFQUJMRTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5QQUlEOw0KICAgICAgICB9DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNyZWF0ZSBhIG5ldyBzdWJzY3JpcHRpb24gb2ZmZXIuDQogICAgLy8vQGRldiBvbmx5IHJlZ2lzdGVyZWQgc2VydmljZSBwcm92aWRlciBpcyBhbGxvd2VkIHRvIGNyZWF0ZSBvZmZlcnMuDQogICAgLy8vQGRldiBzdWJzY3JpcHRpb24gdXNlcyBTQU4gdG9rZW4gZm9yIHBheW1lbnQsIGJ1dCBhbiBleGFjdCBhbW91bnQgdG8gYmUgcGFpZCBvciBkZXBvc2l0IGlzIGNhbGN1bGF0ZWQgdXNpbmcgZXhjaGFuZ2UgcmF0ZSBmcm9tIGV4dGVybmFsIHhyYXRlUHJvdmlkZXIgKHByZXZpb3NseSByZWdpc3RlcmVkIG9uIHBsYXRmb3JtKS4NCiAgICAvLy8gICAgVGhpcyBhbGxvd3MgdG8gY3JlYXRlIGEgc3Vic2NyaXB0aW9uIGJvdW5kIHRvIGFub3RoZXIgdG9rZW4gb3IgZXZlbiBmaWF0IGN1cnJlbmN5Lg0KICAgIC8vL0BwYXJhbSBfcHJpY2VQZXJIb3VyIC0gc3Vic2NyaXB0aW9uIHByaWNlIHBlciBob3VyIGluIFNBTg0KICAgIC8vL0BwYXJhbSBfeHJhdGVQcm92aWRlcklkIC0gaWQgb2YgZXh0ZXJuYWwgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlciBmcm9tIHN1YnNjcmlwdGlvbiBjdXJyZW5jeSB0byBTQU47ICIwIiBtZWFucyBzdWJzY3JpcHRpb24gaXMgcHJpY2VkIGluIFNBTiBuYXRpdmVseS4NCiAgICAvLy9AcGFyYW0gX2NoYXJnZVBlcmlvZCAtIHRpbWUgcGVyaW9kIHRvIGNoYXJnZTsgc3Vic2NyaXB0aW9uIGNhbid0IGJlIGNoYXJnZWQgbW9yZSBvZnRlbiB0aGFuIHRoaXMgcGVyaW9kLiBUaW1lIHVuaXRzIGFyZSBuYXRpdmUgZXRoZXJldW0gdGltZSwgcmV0dXJuaW5nIGJ5IGBub3dgLCBpLmUuIHNlY29uZHMuDQogICAgLy8vQHBhcmFtIF9leHBpcmVPbiAtIG9mZmVyIGNhbid0IGJlIGFjY2VwdGVkIGFmdGVyIHRoaXMgdGltZS4NCiAgICAvLy9AcGFyYW0gX29mZmVyTGltaXQgLSBob3cgbWFueSBzdWJzY3JpcHRpb24gYXJlIGF2YWlsYWJsZSB0byBjcmVhdGVkIGZyb20gdGhpcyBvZmZlcjsgdGhlcmUgaXMgbm8gbWFnaWMgbnVtYmVyIGZvciB1bmxpbWl0ZWQgb2ZmZXIgLS0gdXNlIGJpZyBudW1iZXIgaW5zdGVhZC4NCiAgICAvLy9AcGFyYW0gX2RlcG9zaXRBbW91bnQgLSB1cGZyb250IGRlcG9zaXQgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIGEgc3Vic2NyaXB0aW9uOyB0aGlzIGRlcG9zaXQgYmVjb21lcyBmdWxseSByZXR1cm5lZCBvbiBzdWJzY3JpcHRpb24gaXMgb3Zlci4NCiAgICAvLy8gICAgICAgY3VycmVudGx5IHRoaXMgZGVwb3NpdCBpcyBub3Qgc3ViamVjdCBvZiBwbGF0Zm9ybSBmZWVzIGFuZCB3aWxsIGJlIHJlZnVuZGVkIGluIGZ1bGwuIE5leHQgdmVyc2lvbnMgb2YgdGhpcyBtb2R1bGUgY2FuIHVzZSBkZXBvc2l0IGluIGNhc2Ugb2Ygb3V0c3RhbmRpbmcgcGF5bWVudHMuDQogICAgLy8vQHBhcmFtIF9zdGFydE9uIC0gYSBzdWJzY3JpcHRpb24gZnJvbSB0aGlzIG9mZmVyIGNhbid0IGJlIGNyZWF0ZWQgYmVmb3JlIHRoaXMgdGltZS4gVGltZSB1bml0cyBhcmUgbmF0aXZlIGV0aGVyZXVtIHRpbWUsIHJldHVybmluZyBieSBgbm93YCwgaS5lLiBzZWNvbmRzLg0KICAgIC8vL0BwYXJhbSBfZGVzY3JpcHRvciAtIGFyYml0cmFyeSBieXRlcyBhcyBhbiBvZmZlciBkZXNjcmlwdG9yLiBUaGlzIGRlc2NyaXB0b3IgaXMgY29waWVkIGludG8gc3Vic2NyaXB0aW9uIGFuZCB0aGVuIHNlcnZpY2UgcHJvdmlkZXIgYmVjb21lcyBpdCBwYXNzZWQgaW4gbm90aWZpY2F0aW9ucy4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgX3ByaWNlUGVySG91ciwgdWludDE2IF94cmF0ZVByb3ZpZGVySWQsIHVpbnQgX2NoYXJnZVBlcmlvZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX29mZmVyTGltaXQsIHVpbnQgX2RlcG9zaXRBbW91bnQsIHVpbnQgX3N0YXJ0T24sIGJ5dGVzIF9kZXNjcmlwdG9yKQ0KICAgIHB1YmxpYw0KICAgIG5vUmVlbnRyYW5jeShMMDEpDQogICAgb25seVJlZ2lzdGVyZWRQcm92aWRlcg0KICAgIHJldHVybnMgKHVpbnQgc3ViSWQpIHsNCiAgICAgICAgYXNzZXJ0IChfc3RhcnRPbiA8IF9leHBpcmVPbik7DQogICAgICAgIGFzc2VydCAoX2NoYXJnZVBlcmlvZCA8PSAxMCB5ZWFycyk7IC8vc2FuaXR5IGNoZWNrDQogICAgICAgIHZhciAoX3hyYXRlX24sIF94cmF0ZV9kKSA9IF94cmF0ZVByb3ZpZGVySWQgPT0gMA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAoMSwxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBYUmF0ZVByb3ZpZGVyKHhyYXRlUHJvdmlkZXJzW194cmF0ZVByb3ZpZGVySWRdKS5nZXRSYXRlKCk7IC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQ0KICAgICAgICBhc3NlcnQgKF94cmF0ZV9uID4gMCAmJiBfeHJhdGVfZCA+IDApOw0KICAgICAgICBzdWJzY3JpcHRpb25zWysrc3Vic2NyaXB0aW9uQ291bnRlcl0gPSBTdWJzY3JpcHRpb24gKHsNCiAgICAgICAgICAgIHRyYW5zZmVyRnJvbSAgICA6IDAsICAgICAgICAgICAgICAgICAgLy8gZW1wdHkgdHJhbnNmZXJGcm9tIGZpZWxkIG1lYW5zIHdlIGhhdmUgYW4gb2ZmZXIsIG5vdCBhIHN1YnNjcmlwdGlvbg0KICAgICAgICAgICAgdHJhbnNmZXJUbyAgICAgIDogbXNnLnNlbmRlciwgICAgICAgICAvLyBzZXJ2aWNlIHByb3ZpZGVyIGlzIGEgYmVuZWZpY2lhcnkgb2Ygc3Vic2NyaXB0b24gcGF5bWVudHMNCiAgICAgICAgICAgIHByaWNlUGVySG91ciAgICA6IF9wcmljZVBlckhvdXIsICAgICAgLy8gcHJpY2UgcGVyIGhvdXIgaW4gU0FOIChyZWNhbGN1bGF0ZWQgZnJvbSBiYXNlIGN1cnJlbmN5IGlmIG5lZWRlZCkNCiAgICAgICAgICAgIHhyYXRlUHJvdmlkZXJJZCA6IF94cmF0ZVByb3ZpZGVySWQsICAgLy8gaWQgb2YgcmVnaXN0ZXJlZCBleGNoYW5nZSByYXRlIHByb3ZpZGVyIG9yIHplcm8gaWYgYW4gb2ZmZXIgaXMgbm9taW5hdGVkIGluIFNBTi4NCiAgICAgICAgICAgIGluaXRpYWxYcmF0ZV9uICA6IF94cmF0ZV9uLCAgICAgICAgICAgLy8gZnJhY3Rpb24gbm9taW5hdG9yIG9mIHRoZSBpbml0aWFsIGV4Y2hhbmdlIHJhdGUNCiAgICAgICAgICAgIGluaXRpYWxYcmF0ZV9kICA6IF94cmF0ZV9kLCAgICAgICAgICAgLy8gZnJhY3Rpb24gZGVub21pbmF0b3Igb2YgdGhlIGluaXRpYWwgZXhjaGFuZ2UgcmF0ZQ0KICAgICAgICAgICAgcGFpZFVudGlsICAgICAgIDogMCwgICAgICAgICAgICAgICAgICAvLyBzZXJ2aWNlIGlzIGNvbnNpZGVyZWQgdG8gYmUgcGFpZCB1bnRpbCB0aGlzIHRpbWU7IG5vIGNoYXJnZSBpcyBwb3NzaWJsZSB3aGlsZSBzdWJzY3JpcHRpb24gaXMgcGFpZCBmb3Igbm93Lg0KICAgICAgICAgICAgY2hhcmdlUGVyaW9kICAgIDogX2NoYXJnZVBlcmlvZCwgICAgICAvLyBwZXJpb2QgaW4gc2Vjb25kcyAoZXRoZXJldW0gYmxvY2sgdGltZSB1bml0KSB0byBjaGFyZ2UuDQogICAgICAgICAgICBkZXBvc2l0QW1vdW50ICAgOiBfZGVwb3NpdEFtb3VudCwgICAgIC8vIGRlcG9zaXQgcmVxdWlyZWQgZm9yIHN1YnNjcmlwdGlvbiBhY2NlcHQuDQogICAgICAgICAgICBzdGFydE9uICAgICAgICAgOiBfc3RhcnRPbiwNCiAgICAgICAgICAgIGV4cGlyZU9uICAgICAgICA6IF9leHBpcmVPbiwNCiAgICAgICAgICAgIGV4ZWNDb3VudGVyICAgICA6IF9vZmZlckxpbWl0LA0KICAgICAgICAgICAgZGVzY3JpcHRvciAgICAgIDogX2Rlc2NyaXB0b3IsDQogICAgICAgICAgICBvbkhvbGRTaW5jZSAgICAgOiAwICAgICAgICAgICAgICAgICAgIC8vIG9mZmVyIGlzIG5vdCBvbiBob2xkIGJ5IGRlZmF1bHQuDQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gc3Vic2NyaXB0aW9uQ291bnRlcjsgICAgICAgICAgICAgICAvLyByZXR1cm5zIGFuIGlkIG9mIHRoZSBuZXcgb2ZmZXIuDQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIHVwZGF0ZXMgY3VycmVudGx5IGF2YWlsYWJsZSBudW1iZXIgb2Ygc3Vic2NyaXB0aW9uIGZvciB0aGlzIG9mZmVyLg0KICAgIC8vLyAgICAgICAgT3RoZXIgb2ZmZXIncyBwYXJhbWV0ZXIgY2FuJ3QgYmUgdXBkYXRlZCBiZWNhdXNlIHRoZXkgYXJlIGNvbnNpZGVyZWQgdG8gYmUgYSBwdWJsaWMgb2ZmZXIgcmV2aWV3ZWQgYnkgY3VzdG9tZXJzLg0KICAgIC8vLyAgICAgICAgVGhlIHNlcnZpY2UgcHJvdmlkZXIgc2hvdWxkIHJlY3JlYXRlIHRoZSBvZmZlciBhcyBhIG5ldyBvbmUgaW4gY2FzZSBvZiBvdGhlciBjaGFuZ2VzLg0KICAgIC8vDQogICAgZnVuY3Rpb24gdXBkYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBfb2ZmZXJJZCwgdWludCBfb2ZmZXJMaW1pdCkgcHVibGljIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW19vZmZlcklkXTsNCiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOw0KICAgICAgICBhc3NlcnQgKG9mZmVyLnRyYW5zZmVyVG8gPT0gbXNnLnNlbmRlcik7IC8vb25seSBQcm92aWRlciBpcyBhbGxvd2VkIHRvIHVwZGF0ZSB0aGUgb2ZmZXIuDQogICAgICAgIG9mZmVyLmV4ZWNDb3VudGVyID0gX29mZmVyTGltaXQ7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGFjY2VwdCBnaXZlbiBvZmZlciBhbmQgY3JlYXRlIGEgbmV3IHN1YnNjcmlwdGlvbiBvbiB0aGUgYmFzZSBvZiBpdC4NCiAgICAvLy8NCiAgICAvLy9AZGV2IHRoZSBzZXJ2aWNlIHByb3ZpZGVyIChvZmZlci5gdHJhbnNmZXJUb2ApIGJlY29tZXMgbm90aWZpZWQgYWJvdXQgbmV3IHN1YnNjcmlwdGlvbiBieSBjYWxsIGBvblN1Yk5ldyhuZXdTdWJJZCwgX29mZmVySWQpYC4NCiAgICAvLy8gICAgIEl0IGlzIHByb3ZpZGVyJ3MgcmVzcG9uc2liaWxpdHkgdG8gcmV0cmlldmUgYW5kIHN0b3JlIGFueSBuZWNlc3NhcnkgaW5mb3JtYXRpb24gYWJvdXQgb2ZmZXIgYW5kIHRoaXMgbmV3IHN1YnNjcmlwdGlvbi4gU29tZSBvZiBpbmZvIGlzIG9ubHkgYXZhaWxhYmxlIGF0IHRoaXMgcG9pbnQuDQogICAgLy8vICAgICBUaGUgU2VydmljZSBQcm92aWRlciBjYW4gYWxzbyByZWplY3QgdGhlIG5ldyBzdWJzY3JpcHRpb24gYnkgdGhyb3dpbmcgYW4gZXhjZXB0aW9uIG9yIHJldHVybmluZyBgZmFsc2VgIGZyb20gYG9uU3ViTmV3KG5ld1N1YklkLCBfb2ZmZXJJZClgIGV2ZW50IGhhbmRsZXIuDQogICAgLy8vQHBhcmFtIF9vZmZlcklkICAgLSBpZCBvZiB0aGUgb2ZmZXIgdG8gYmUgYWNjZXB0ZWQNCiAgICAvLy9AcGFyYW0gX2V4cGlyZU9uICAtIHN1YnNjcmlwdGlvbiBleHBpcmF0aW9uIHRpbWU7IG5vIGNoYXJnZXMgYXJlIHBvc3NpYmxlIGJlaGluZCB0aGlzIHRpbWUuDQogICAgLy8vQHBhcmFtIF9zdGFydE9uICAgLSBzdWJzY3JpcHRpb24gc3RhcnQgdGltZTsgbm8gY2hhcmdlcyBhcmUgcG9zc2libGUgYmVmb3JlIHRoaXMgdGltZS4NCiAgICAvLy8gICAgICAgICAgICAgICAgICAgIElmIHRoZSBgX3N0YXJ0T25gIGlzIGluIHRoZSBwYXN0IG9yIGlzIHplcm8sIGl0IG1lYW5zIHN0YXJ0IHRoZSBzdWJzY3JpcHRpb24gQVNBUC4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbih1aW50IF9vZmZlcklkLCB1aW50IF9leHBpcmVPbiwgdWludCBfc3RhcnRPbikgcHVibGljIG5vUmVlbnRyYW5jeShMMDIpIHJldHVybnMgKHVpbnQgbmV3U3ViSWQpIHsNCiAgICAgICAgYXNzZXJ0IChfc3RhcnRPbiA8IF9leHBpcmVPbik7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tfb2ZmZXJJZF07DQogICAgICAgIGFzc2VydCAoX2lzT2ZmZXIob2ZmZXIpKTsNCiAgICAgICAgYXNzZXJ0IChvZmZlci5zdGFydE9uID09IDAgICAgIHx8IG9mZmVyLnN0YXJ0T24gIDw9IG5vdyk7DQogICAgICAgIGFzc2VydCAob2ZmZXIuZXhwaXJlT24gPT0gMCAgICB8fCBvZmZlci5leHBpcmVPbiA+PSBub3cpOw0KICAgICAgICBhc3NlcnQgKG9mZmVyLm9uSG9sZFNpbmNlID09IDApOw0KICAgICAgICBhc3NlcnQgKG9mZmVyLmV4ZWNDb3VudGVyID4gMCk7DQogICAgICAgIC0tb2ZmZXIuZXhlY0NvdW50ZXI7DQogICAgICAgIG5ld1N1YklkID0gKytzdWJzY3JpcHRpb25Db3VudGVyOw0KICAgICAgICAvL2NyZWF0ZSBhIGNsb25lIG9mIHRoZSBvZmZlci4uLg0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBuZXdTdWIgPSBzdWJzY3JpcHRpb25zW25ld1N1YklkXSA9IG9mZmVyOw0KICAgICAgICAvLy4uLiBhbmQgYWRqdXN0IHNvbWUgZmllbGRzIHNwZWNpZmljIHRvIHN1YnNjcmlwdGlvbg0KICAgICAgICBuZXdTdWIudHJhbnNmZXJGcm9tID0gbXNnLnNlbmRlcjsNCiAgICAgICAgbmV3U3ViLmV4ZWNDb3VudGVyID0gMDsNCiAgICAgICAgbmV3U3ViLnBhaWRVbnRpbCA9IG5ld1N1Yi5zdGFydE9uID0gbWF4KF9zdGFydE9uLCBub3cpOyAgICAgLy9ubyBkZWJ0cyBiZWZvcmUgYWN0dWFsIGNyZWF0aW9uIHRpbWUhDQogICAgICAgIG5ld1N1Yi5leHBpcmVPbiA9IF9leHBpcmVPbjsNCiAgICAgICAgbmV3U3ViLmRlcG9zaXRBbW91bnQgPSBfYXBwbHlYY2hhbmdlUmF0ZShuZXdTdWIuZGVwb3NpdEFtb3VudCwgbmV3U3ViKTsgICAgICAgICAgICAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQ0KICAgICAgICAvL2RlcG9zaXRBbW91bnQgaXMgbm93IHN0b3JlZCBpbiB0aGUgc3ViLCBzbyBidXJuIHRoZSBzYW1lIGFtb3VudCBmcm9tIGN1c3RvbWVyJ3MgYWNjb3VudC4NCiAgICAgICAgYXNzZXJ0IChzYW4uX2J1cm5Gb3JEZXBvc2l0KG1zZy5zZW5kZXIsIG5ld1N1Yi5kZXBvc2l0QW1vdW50KSk7DQogICAgICAgIGFzc2VydCAoU2VydmljZVByb3ZpZGVyKG5ld1N1Yi50cmFuc2ZlclRvKS5vblN1Yk5ldyhuZXdTdWJJZCwgX29mZmVySWQpKTsgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3k7IHNlcnZpY2UgcHJvdmlkZXIgY2FuIHN0aWxsIHJlamVjdCB0aGUgbmV3IHN1YnNjcmlwdGlvbiBoZXJlDQoNCiAgICAgICAgTmV3U3Vic2NyaXB0aW9uKG5ld1N1Yi50cmFuc2ZlckZyb20sIG5ld1N1Yi50cmFuc2ZlclRvLCBfb2ZmZXJJZCwgbmV3U3ViSWQpOw0KICAgICAgICByZXR1cm4gbmV3U3ViSWQ7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNhbmNlbCBhbiBvZmZlciBnaXZlbiBieSBgb2ZmZXJJZGAuDQogICAgLy8vQGRldiBzZXRzIG9mZmVyLmBleHBpcmVPbmAgdG8gYGV4cGlyZU9uYC4NCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW29mZmVySWRdOw0KICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7DQogICAgICAgIGFzc2VydCAob2ZmZXIudHJhbnNmZXJUbyA9PSBtc2cuc2VuZGVyIHx8IG93bmVyID09IG1zZy5zZW5kZXIpOyAvL29ubHkgc2VydmljZSBwcm92aWRlciBvciBwbGF0Zm9ybSBvd25lciBpcyBhbGxvd2VkIHRvIGNhbmNlbCB0aGUgb2ZmZXINCiAgICAgICAgaWYgKG9mZmVyLmV4cGlyZU9uPm5vdyl7DQogICAgICAgICAgICBvZmZlci5leHBpcmVPbiA9IG5vdzsNCiAgICAgICAgICAgIE9mZmVyQ2FuY2VsZWQob2ZmZXJJZCwgbXNnLnNlbmRlcik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNhbmNlbCBhbiBzdWJzY3JpcHRpb24gZ2l2ZW4gYnkgYHN1YklkYCAoYSBncmFjZWZ1bCB2ZXJzaW9uKS4NCiAgICAvLy9Abm90aWNlIElNUE9SVEFOVDogYSBtYWxpY2lvdXMgc2VydmljZSBwcm92aWRlciBjYW4gY29uc3VtZSBhbGwgZ2FzIGFuZCBwcmV2ZW50aW5nIHN1YnNjcmlwdGlvbiBmcm9tIGNhbmNlbGxhdGlvbi4NCiAgICAvLy8gICAgICAgIElmIHNvLCB1c2UgYGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkLCB1aW50IGdhc1Jlc2VydmUpYCBhcyB0aGUgZm9yY2VkIHZlcnNpb24uDQogICAgLy8vICAgICAgICAgc2VlIGBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKWAgZm9yIG1vcmUgZG9jdW1lbnRhdGlvbi4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgew0KICAgICAgICByZXR1cm4gY2FuY2VsU3Vic2NyaXB0aW9uKHN1YklkLCAwKTsNCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgY2FuY2VsIGFuIHN1YnNjcmlwdGlvbiBnaXZlbiBieSBgc3ViSWRgIChhIGZvcmNlZCB2ZXJzaW9uKS4NCiAgICAvLy8gICAgICAgIENhbmNlbGxhdGlvbiBtZWFucyBubyBmdXJ0aGVyIGNoYXJnZXMgdG8gdGhpcyBzdWJzY3JpcHRpb24gYXJlIHBvc3NpYmxlLiBUaGUgcHJvdmlkZWQgc3Vic2NyaXB0aW9uIGRlcG9zaXQgY2FuIGJlIHdpdGhkcmF3biBvbmx5IGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyLg0KICAgIC8vLyAgICAgICAgRGVwZW5kaW5nIG9uIG5hdHVyZSBvZiB0aGUgc2VydmljZSBwcm92aWRlZCwgdGhlIHNlcnZpY2UgcHJvdmlkZXIgY2FuIGFsbG93IGFuIGltbWVkaWF0ZSBkZXBvc2l0IHdpdGhkcmF3YWwgYnkgYHJldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQpYCBjYWxsLCBidXQgaXRzIG9uIGhpcyBvd24uDQogICAgLy8vICAgICAgICBJbiBzb21lIGJ1c2luZXNzIGNhc2VzIGEgZGVwb3NpdCBtdXN0IHJlbWFpbiBsb2NrZWQgdW50aWwgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIgZXZlbiwgdGhlIHN1YnNjcmlwdGlvbiBpcyBhbHJlYWR5IGNhbmNlbGVkLg0KICAgIC8vL0Bub3RpY2UgZ2FzUmVzZXJ2ZSBpcyBhIGdhcyBhbW91bnQgcmVzZXJ2ZWQgZm9yIGNvbnRyYWN0IGV4ZWN1dGlvbiBBRlRFUiBzZXJ2aWNlIHByb3ZpZGVyIGJlY29tZXMgYG9uU3ViQ2FuY2VsZWQodWludDI1NixhZGRyZXNzKWAgbm90aWZpY2F0aW9uLg0KICAgIC8vLyAgICAgICAgSXQgZ3VhcmFudGVlcywgdGhhdCBjYW5jZWxsYXRpb24gYmVjb21lcyBleGVjdXRlZCBldmVuIGEgKG1hbGljaW91cykgc2VydmljZSBwcm92aWRlciBjb25zdW1lcyBhbGwgZ2FzIHByb3ZpZGVkLg0KICAgIC8vLyAgICAgICAgSWYgc28sIHVzZSBgY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSlgIGFzIHRoZSBmb3JjZWQgdmVyc2lvbi4NCiAgICAvLy8gICAgICAgIFRoaXMgZGlmZmVyZW5jZSBpcyBiZWNhdXNlIHRoZSBjdXN0b21lciBtdXN0IGFsd2F5cyBoYXZlIGEgcG9zc2liaWxpdHkgdG8gY2FuY2VsIGhpcyBjb250cmFjdCBldmVuIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGRpc2FncmVlIG9uIGNhbmNlbGxhdGlvbi4NCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gdG8gYmUgY2FuY2VsbGVkDQogICAgLy8vQHBhcmFtIGdhc1Jlc2VydmUgLSBnYXMgcmVzZXJ2ZWQgZm9yIGNhbGwgZmluYWxpemF0aW9uIChtaW5pbXVtIHJlc2VydmF0aW9uIGlzIDEwMDAwIGdhcykNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkLCB1aW50IGdhc1Jlc2VydmUpIHB1YmxpYyBub1JlZW50cmFuY3koTDAzKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlckZyb20gPT0gbXNnLnNlbmRlciB8fCBvd25lciA9PSBtc2cuc2VuZGVyKTsgLy9vbmx5IHN1YnNjcmlwdGlvbiBvd25lciBvciBwbGF0Zm9ybSBvd25lciBpcyBhbGxvd2VkIHRvIGNhbmNlbCBpdA0KICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsNCiAgICAgICAgdmFyIF90byA9IHN1Yi50cmFuc2ZlclRvOw0KICAgICAgICBzdWIuZXhwaXJlT24gPSBtYXgobm93LCBzdWIucGFpZFVudGlsKTsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gX3RvKSB7DQogICAgICAgICAgICAvL3N1cHJlc3MgcmUtdGhyb3dpbmcgb2YgZXhjZXB0aW9uczsgcmVzZXJ2ZSBlbm91Z2ggZ2FzIHRvIGZpbmlzaCB0aGlzIGZ1bmN0aW9uDQogICAgICAgICAgICBnYXNSZXNlcnZlID0gbWF4KGdhc1Jlc2VydmUsMTAwMDApOyAgLy9yZXNlcnZlIG1pbmltdW0gMTAwMDAgZ2FzDQogICAgICAgICAgICBhc3NlcnQgKG1zZy5nYXMgPiBnYXNSZXNlcnZlKTsgICAgICAgLy9zYW5pdHkgY2hlY2sNCiAgICAgICAgICAgIGlmIChfdG8uY2FsbC5nYXMobXNnLmdhcy1nYXNSZXNlcnZlKShieXRlczQoc2hhMygib25TdWJDYW5jZWxlZCh1aW50MjU2LGFkZHJlc3MpIikpLCBzdWJJZCwgbXNnLnNlbmRlcikpIHsgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQ0KICAgICAgICAgICAgICAgIC8vZG8gbm90aGluZy4gaXQgaXMgbm90aWZpY2F0aW9uIG9ubHkuDQogICAgICAgICAgICAgICAgLy9MYXRlcjogaXMgaXQgcG9zc2libGUgdG8gZXZhbHVhdGUgcmV0dXJuIHZhbHVlIGhlcmU/IElmIGlzIGJldHRlciB0byByZXR1cm4gdGhlIHN1YnNjcmlwdGlvbiBkZXBvc2l0IGhlcmUuDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgU3ViQ2FuY2VsZWQoc3ViSWQsIG1zZy5zZW5kZXIpOw0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBwbGFjZSBhbiBhY3RpdmUgb2ZmZXIgb24gaG9sZDsgaXQgbWVhbnMgbm8gc3Vic2NyaXB0aW9ucyBjYW4gYmUgY3JlYXRlZCBmcm9tIHRoaXMgb2ZmZXIuDQogICAgLy8vICAgICAgICBPbmx5IHNlcnZpY2UgcHJvdmlkZXIgKG9yIHBsYXRmb3JtIG93bmVyKSBpcyBhbGxvd2VkIHRvIGhvbGQvdW5ob2xkIGEgc3Vic2NyaXB0aW9uIG9mZmVyLg0KICAgIC8vL0BwYXJhbSBvZmZlcklkIC0gaWQgb2YgdGhlIG9mZmVyIHRvIGJlIHBsYWNlZCBvbiBob2xkLg0KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQ0KICAgIC8vDQogICAgZnVuY3Rpb24gaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbb2ZmZXJJZF07DQogICAgICAgIGFzc2VydCAoX2lzT2ZmZXIob2ZmZXIpKTsNCiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvZmZlci50cmFuc2ZlclRvIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOyAvL29ubHkgb3duZXIgb3Igc2VydmljZSBwcm92aWRlciBjYW4gcGxhY2UgdGhlIG9mZmVyIG9uIGhvbGQuDQogICAgICAgIGlmIChvZmZlci5vbkhvbGRTaW5jZSA9PSAwKSB7DQogICAgICAgICAgICBvZmZlci5vbkhvbGRTaW5jZSA9IG5vdzsNCiAgICAgICAgICAgIE9mZmVyT25Ib2xkKG9mZmVySWQsIHRydWUsIG1zZy5zZW5kZXIpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSByZXN1bWUgb24taG9sZCBvZmZlcjsgc3Vic2NyaXB0aW9ucyBjYW4gYmUgY3JlYXRlZCBmcm9tIHRoaXMgb2ZmZXIgYWdhaW4gKGlmIG90aGVyIGNvbmRpdGlvbnMgYXJlIG1ldCkuDQogICAgLy8vICAgICAgICBPbmx5IHNlcnZpY2UgcHJvdmlkZXIgKG9yIHBsYXRmb3JtIG93bmVyKSBpcyBhbGxvd2VkIHRvIGhvbGQvdW5ob2xkIGEgc3Vic2NyaXB0aW9uIG9mZmVyLg0KICAgIC8vL0BwYXJhbSBvZmZlcklkIC0gaWQgb2YgdGhlIG9mZmVyIHRvIGJlIHJlc3VtZWQuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW29mZmVySWRdOw0KICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7DQogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb2ZmZXIudHJhbnNmZXJUbyB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsgLy9vbmx5IG93bmVyIG9yIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlYWN0aXZhdGUgdGhlIG9mZmVyLg0KICAgICAgICBpZiAob2ZmZXIub25Ib2xkU2luY2UgPiAwKSB7DQogICAgICAgICAgICBvZmZlci5vbkhvbGRTaW5jZSA9IDA7DQogICAgICAgICAgICBPZmZlck9uSG9sZChvZmZlcklkLCBmYWxzZSwgbXNnLnNlbmRlcik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNhbGxlZCBieSBjdXN0b21lciBvciBzZXJ2aWNlIHByb3ZpZGVyIHRvIHBsYWNlIGEgc3Vic2NyaXB0aW9uIG9uIGhvbGQuDQogICAgLy8vICAgICAgICBJZiBjYWxsIGlzIG9yaWdpbmF0ZWQgYnkgY3VzdG9tZXIgdGhlIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlamVjdCB0aGUgcmVxdWVzdC4NCiAgICAvLy8gICAgICAgIEEgc3Vic2NyaXB0aW9uIG9uIGhvbGQgd2lsbCBub3QgYmUgY2hhcmdlZC4gVGhlIHNlcnZpY2UgaXMgdXN1YWxseSBub3QgcHJvdmlkZWQgYXMgd2VsbC4NCiAgICAvLy8gICAgICAgIER1cmluZyBob2xkIHRpbWUgYSBzdWJzY3JpcHRpb24gcHJlc2VydmUgcmVtYWluaW5nIHBhaWQgdGltZSBwZXJpb2QsIHdoaWNoIGJlY29tZXMgYXZhaWxhYmxlIGFmdGVyIHVuaG9sZC4NCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vUmVlbnRyYW5jeShMMDQpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsNCiAgICAgICAgYXNzZXJ0IChfaXNTdWJzY3JpcHRpb24oc3ViKSk7DQogICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsNCiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBfdG8gfHwgbXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJGcm9tKTsgLy9vbmx5IGN1c3RvbWVyIG9yIHByb3ZpZGVyIGNhbiBwbGFjZSB0aGUgc3Vic2NyaXB0aW9uIG9uIGhvbGQuDQogICAgICAgIGlmIChzdWIub25Ib2xkU2luY2UgPT0gMCkgew0KICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gX3RvIHx8IFNlcnZpY2VQcm92aWRlcihfdG8pLm9uU3ViVW5Ib2xkKHN1YklkLCBtc2cuc2VuZGVyLCB0cnVlKSkgeyAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kNCiAgICAgICAgICAgICAgICBzdWIub25Ib2xkU2luY2UgPSBub3c7DQogICAgICAgICAgICAgICAgU3ViT25Ib2xkKHN1YklkLCB0cnVlLCBtc2cuc2VuZGVyKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNhbGxlZCBieSBjdXN0b21lciBvciBzZXJ2aWNlIHByb3ZpZGVyIHRvIHVuaG9sZCBzdWJzY3JpcHRpb24uDQogICAgLy8vICAgICAgICBJZiBjYWxsIGlzIG9yaWdpbmF0ZWQgYnkgY3VzdG9tZXIgdGhlIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlamVjdCB0aGUgcmVxdWVzdC4NCiAgICAvLy8gICAgICAgIEEgc3Vic2NyaXB0aW9uIG9uIGhvbGQgd2lsbCBub3QgYmUgY2hhcmdlZC4gVGhlIHNlcnZpY2UgaXMgdXN1YWxseSBub3QgcHJvdmlkZWQgYXMgd2VsbC4NCiAgICAvLy8gICAgICAgIER1cmluZyBob2xkIHRpbWUgYSBzdWJzY3JpcHRpb24gcHJlc2VydmUgcmVtYWluaW5nIHBhaWQgdGltZSBwZXJpb2QsIHdoaWNoIGJlY29tZXMgYXZhaWxhYmxlIGFmdGVyIHVuaG9sZC4NCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgbm9SZWVudHJhbmN5KEwwNSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsNCiAgICAgICAgdmFyIF90byA9IHN1Yi50cmFuc2ZlclRvOw0KICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IF90byB8fCBtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlckZyb20pOyAvL29ubHkgY3VzdG9tZXIgb3IgcHJvdmlkZXIgY2FuIHBsYWNlIHRoZSBzdWJzY3JpcHRpb24gb24gaG9sZC4NCiAgICAgICAgaWYgKHN1Yi5vbkhvbGRTaW5jZSA+IDApIHsNCiAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyID09IF90byB8fCBTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblN1YlVuSG9sZChzdWJJZCwgbXNnLnNlbmRlciwgZmFsc2UpKSB7ICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgICAgICAgICAgc3ViLnBhaWRVbnRpbCArPSBub3cgLSBzdWIub25Ib2xkU2luY2U7DQogICAgICAgICAgICAgICAgc3ViLm9uSG9sZFNpbmNlID0gMDsNCiAgICAgICAgICAgICAgICBTdWJPbkhvbGQoc3ViSWQsIGZhbHNlLCBtc2cuc2VuZGVyKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgICAgICBkZXBvc2l0IGhhbmRsaW5nICAgICAgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy8vQG5vdGljZSBjYW4gYmUgY2FsbGVkIGJ5IHByb3ZpZGVyIG9uIENBTkNFTEVEIHN1YnNjcmlwdGlvbiB0byByZXR1cm4gYSBzdWJzY3JpcHRpb24gZGVwb3NpdCB0byBjdXN0b21lciBpbW1lZGlhdGVseS4NCiAgICAvLy8gICAgICAgIEN1c3RvbWVyIGNhbiBhbnl3YXkgY29sbGVjdCBoaXMgZGVwb3NpdCBhZnRlciBgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3Zlci4NCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gaG9sZGluZyB0aGUgZGVwb3NpdA0KICAgIC8vDQogICAgZnVuY3Rpb24gcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQodWludCBzdWJJZCkgcHVibGljIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIGFzc2VydCAoX3N1YnNjcmlwdGlvblN0YXRlKHN1YikgPT0gU3ViU3RhdGUuQ0FOQ0VMRUQpOw0KICAgICAgICBhc3NlcnQgKHN1Yi5kZXBvc2l0QW1vdW50ID4gMCk7IC8vc2FuaXR5IGNoZWNrDQogICAgICAgIGFzc2VydCAoc3ViLnRyYW5zZmVyVG8gPT0gbXNnLnNlbmRlciB8fCBvd25lciA9PSBtc2cuc2VuZGVyKTsgLy9vbmx5IHN1YnNjcmlwdGlvbiBvd25lciBvciBwbGF0Zm9ybSBvd25lciBpcyBhbGxvd2VkIHRvIHJlbGVhc2UgZGVwb3NpdC4NCiAgICAgICAgc3ViLmV4cGlyZU9uID0gbm93Ow0KICAgICAgICBfcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQoc3ViSWQsIHN1Yik7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNhbGxlZCBieSBjdXN0b21lciBvbiBFWFBJUkVEIHN1YnNjcmlwdGlvbiAoYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIpIHRvIGNvbGxlY3QgYSBzdWJzY3JpcHRpb24gZGVwb3NpdC4NCiAgICAvLy8gICAgICAgIEN1c3RvbWVyIGNhbiBhbnl3YXkgY29sbGVjdCBoaXMgZGVwb3NpdCBhZnRlciBgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3Zlci4NCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gaG9sZGluZyB0aGUgZGVwb3NpdA0KICAgIC8vDQogICAgZnVuY3Rpb24gY2xhaW1TdWJzY3JpcHRpb25EZXBvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYyB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICBhc3NlcnQgKF9zdWJzY3JpcHRpb25TdGF0ZShzdWIpID09IFN1YlN0YXRlLkVYUElSRUQpOw0KICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlckZyb20gPT0gbXNnLnNlbmRlcik7DQogICAgICAgIGFzc2VydCAoc3ViLmRlcG9zaXRBbW91bnQgPiAwKTsNCiAgICAgICAgX3JldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHN1YklkLCBzdWIpOw0KICAgIH0NCg0KDQogICAgLy9AZGV2IHJldHVybnMgc3Vic2NyaXB0aW9uIGRlcG9zaXQgdG8gY3VzdG9tZXINCiAgICBmdW5jdGlvbiBfcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQodWludCBzdWJJZCwgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCB7DQogICAgICAgIHVpbnQgZGVwb3NpdEFtb3VudCA9IHN1Yi5kZXBvc2l0QW1vdW50Ow0KICAgICAgICBzdWIuZGVwb3NpdEFtb3VudCA9IDA7DQogICAgICAgIHNhbi5fbWludEZyb21EZXBvc2l0KHN1Yi50cmFuc2ZlckZyb20sIGRlcG9zaXRBbW91bnQpOw0KICAgICAgICBTdWJzY3JpcHRpb25EZXBvc2l0UmV0dXJuZWQoc3ViSWQsIGRlcG9zaXRBbW91bnQsIHN1Yi50cmFuc2ZlckZyb20sIG1zZy5zZW5kZXIpOw0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjcmVhdGUgc2ltcGxlIHVubG9ja2VkIGRlcG9zaXQsIHJlcXVpcmVkIGJ5IHNvbWUgc2VydmljZXMuIEl0IGNhbiBiZSBjb25zaWRlcmVkIGFzIHByb3ZlIG9mIGN1c3RvbWVyJ3Mgc3Rha2UuDQogICAgLy8vICAgICAgICBUaGlzIGRlc3Bvc2l0IGNhbiBiZSBjbGFpbWVkIGJhY2sgYnkgdGhlIGN1c3RvbWVyIGF0IGFueXRpbWUuDQogICAgLy8vICAgICAgICBUaGUgc2VydmljZSBwcm92aWRlciBpcyByZXNwb25zaWJsZSB0byBjaGVjayB0aGUgZGVwb3NpdCBiZWZvcmUgcHJvdmlkaW5nIHRoZSBzZXJ2aWNlLg0KICAgIC8vL0BwYXJhbSBfdmFsdWUgLSBub24gemVybyBkZXBvc2l0IGFtb3VudC4NCiAgICAvLy9AcGFyYW0gX2Rlc2NyaXB0b3IgLSBpcyBhIHVuaXEga2V5LCB1c3VhbGx5IGdpdmVuIGJ5IHNlcnZpY2UgcHJvdmlkZXIgdG8gdGhlIGN1c3RvbWVyIGluIG9yZGVyIHRvIG1ha2UgdGhpcyBkZXBvc2l0IHVuaXF1ZS4NCiAgICAvLy8gICAgICAgIFNlcnZpY2UgUHJvdmlkZXIgc2hvdWxkIHJlamVjdCBkZXBvc2l0IHdpdGggdW5rbm93biBkZXNjcmlwdG9yLCBiZWNhdXNlIG1vc3QgcHJvYmFibHkgaXQgaXMgaW4gdXNlIGZvciBzb21lIGFub3RoZXIgc2VydmljZS4NCiAgICAvLy9AcmV0dXJuIGRlcG9zaXRJZCAtIGEgaGFuZGxlIHRvIGNsYWltIGJhY2sgdGhlIGRlcG9zaXQgbGF0ZXIuDQogICAgLy8NCiAgICBmdW5jdGlvbiBjcmVhdGVEZXBvc2l0KHVpbnQgX3ZhbHVlLCBieXRlcyBfZGVzY3JpcHRvcikgcHVibGljIHJldHVybnMgKHVpbnQgZGVwb3NpdElkKSB7DQogICAgICAgIHJlcXVpcmUgKF92YWx1ZSA+IDApOw0KICAgICAgICBhc3NlcnQgKHNhbi5fYnVybkZvckRlcG9zaXQobXNnLnNlbmRlcixfdmFsdWUpKTsNCiAgICAgICAgZGVwb3NpdHNbKytkZXBvc2l0Q291bnRlcl0gPSBEZXBvc2l0ICh7DQogICAgICAgICAgICBvd25lciA6IG1zZy5zZW5kZXIsDQogICAgICAgICAgICB2YWx1ZSA6IF92YWx1ZSwNCiAgICAgICAgICAgIGRlc2NyaXB0b3IgOiBfZGVzY3JpcHRvcg0KICAgICAgICB9KTsNCiAgICAgICAgTmV3RGVwb3NpdChkZXBvc2l0Q291bnRlciwgX3ZhbHVlLCBtc2cuc2VuZGVyKTsNCiAgICAgICAgcmV0dXJuIGRlcG9zaXRDb3VudGVyOw0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSByZXR1cm4gcHJldmlvdXNseSBjcmVhdGVkIGRlcG9zaXQgdG8gdGhlIHVzZXIuIFVzZXIgY2FuIGNvbGxlY3Qgb25seSBvd24gZGVwb3NpdC4NCiAgICAvLy8gICAgICAgIFRoZSBzZXJ2aWNlIHByb3ZpZGVyIGlzIHJlc3BvbnNpYmxlIHRvIGNoZWNrIHRoZSBkZXBvc2l0IGJlZm9yZSBwcm92aWRpbmcgdGhlIHNlcnZpY2UuDQogICAgLy8vQHBhcmFtIF9kZXBvc2l0SWQgLSBhbiBpZCBvZiB0aGUgZGVwb3NpdCB0byBiZSBjb2xsZWN0ZWQuDQogICAgLy8NCiAgICBmdW5jdGlvbiBjbGFpbURlcG9zaXQodWludCBfZGVwb3NpdElkKSBwdWJsaWMgew0KICAgICAgICB2YXIgZGVwb3NpdCA9IGRlcG9zaXRzW19kZXBvc2l0SWRdOw0KICAgICAgICByZXF1aXJlIChkZXBvc2l0Lm93bmVyID09IG1zZy5zZW5kZXIpOw0KICAgICAgICB2YXIgdmFsdWUgPSBkZXBvc2l0c1tfZGVwb3NpdElkXS52YWx1ZTsNCiAgICAgICAgZGVsZXRlIGRlcG9zaXRzW19kZXBvc2l0SWRdOw0KICAgICAgICBzYW4uX21pbnRGcm9tRGVwb3NpdChtc2cuc2VuZGVyLCB2YWx1ZSk7DQogICAgICAgIERlcG9zaXRSZXR1cm5lZChfZGVwb3NpdElkLCBtc2cuc2VuZGVyKTsNCiAgICB9DQoNCg0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgICAgICAgICBzb21lIGludGVybmFsIGZ1bmN0aW9ucyAgICAgICAgICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICBmdW5jdGlvbiBfYW1vdW50VG9DaGFyZ2UoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCByZWVudHJhbnQgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gX2FwcGx5WGNoYW5nZVJhdGUoc3ViLnByaWNlUGVySG91ciAqIHN1Yi5jaGFyZ2VQZXJpb2QsIHN1YikgLyAxIGhvdXJzOyAgICAgICAvLyA8PT09PSByZWVudHJhbnQgZnVuY3Rpb24gdXNhZ2UNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfYXBwbHlYY2hhbmdlUmF0ZSh1aW50IGFtb3VudCwgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCByZWVudHJhbnQgcmV0dXJucyAodWludCkgeyAgLy8gPD09IGFjdHVhbGx5IGNhbGxlZCBmcm9tIHJlZW50cmFuY3kgZ3VhcmRlZCBjb250ZXh0IG9ubHkgKGkuZS4gZXh0ZXJuYWxseSBzZWN1cmVkKQ0KICAgICAgICBpZiAoc3ViLnhyYXRlUHJvdmlkZXJJZCA+IDApIHsNCiAgICAgICAgICAgIC8vIHhyYXRlX246IG5vbWluYXRvcg0KICAgICAgICAgICAgLy8geHJhdGVfZDogZGVub21pbmF0b3Igb2YgdGhlIGV4Y2hhbmdlIHJhdGUgZnJhY3Rpb24uDQogICAgICAgICAgICB2YXIgKHhyYXRlX24sIHhyYXRlX2QpID0gWFJhdGVQcm92aWRlcih4cmF0ZVByb3ZpZGVyc1tzdWIueHJhdGVQcm92aWRlcklkXSkuZ2V0UmF0ZSgpOyAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgICAgICBhbW91bnQgPSBhbW91bnQgKiBzdWIuaW5pdGlhbFhyYXRlX24gKiB4cmF0ZV9kIC8gc3ViLmluaXRpYWxYcmF0ZV9kIC8geHJhdGVfbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYW1vdW50Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9pc09mZmVyKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7DQogICAgICAgIHJldHVybiBzdWIudHJhbnNmZXJGcm9tID09IDAgJiYgc3ViLnRyYW5zZmVyVG8gIT0gMDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfaXNTdWJzY3JpcHRpb24oU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKXsNCiAgICAgICAgcmV0dXJuIHN1Yi50cmFuc2ZlckZyb20gIT0gMCAmJiBzdWIudHJhbnNmZXJUbyAhPSAwOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9leGlzdHMoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKXsNCiAgICAgICAgcmV0dXJuIHN1Yi50cmFuc2ZlclRvICE9IDA7ICAgLy9leGlzdGluZyBzdWJzY3JpcHRpb24gb3Igb2ZmZXIgaGFzIGFsd2F5cyB0cmFuc2ZlclRvIHNldC4NCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5UmVnaXN0ZXJlZFByb3ZpZGVyKCl7DQogICAgICAgIGlmICghcHJvdmlkZXJSZWdpc3RyeVttc2cuc2VuZGVyXSkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQp9IC8vU3Vic2NyaXB0aW9uTW9kdWxlSW1wbA=='