base 64 content
base64subscriptionModuleImpl4
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KLy8gPT09PSBESVNDTEFJTUVSID09PT0NCi8vDQovLyBFVEhFUkVVTSBJUyBTVElMTCBBTiBFWFBFUkVNRU5UQUwgVEVDSE5PTE9HWS4NCi8vIEFMVEhPVUdIIFRISVMgU01BUlQgQ09OVFJBQ1QgV0FTIENSRUFURUQgV0lUSCBHUkVBVCBDQVJFIEFORCBJTiBUSEUgSE9QRSBPRiBCRUlORyBVU0VGVUwsIE5PIEdVQVJBTlRFRVMgT0YgRkxBV0xFU1MgT1BFUkFUSU9OIENBTiBCRSBHSVZFTi4NCi8vIElOIFBBUlRJQ1VMQVIgLSBTVUJUSUxFIEJVR1MsIEhBQ0tFUiBBVFRBQ0tTIE9SIE1BTEZVTkNUSU9OIE9GIFVOREVSTFlJTkcgVEVDSE5PTE9HWSBDQU4gQ0FVU0UgVU5JTlRFTlRJT05BTCBCRUhBVklPVVIuDQovLyBZT1UgQVJFIFNUUk9OR0xZIEVOQ09VUkFHRUQgVE8gU1RVRFkgVEhJUyBTTUFSVCBDT05UUkFDVCBDQVJFRlVMTFkgSU4gT1JERVIgVE8gVU5ERVJTVEFORCBQT1NTSUJMRSBFREdFIENBU0VTIEFORCBSSVNLUy4NCi8vIERPTidUIFVTRSBUSElTIFNNQVJUIENPTlRSQUNUIElGIFlPVSBIQVZFIFNVQlNUQU5USUFMIERPVUJUUyBPUiBJRiBZT1UgRE9OJ1QgS05PVyBXSEFUIFlPVSBBUkUgRE9JTkcuDQovLw0KLy8gVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQ0KLy8gQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULA0KLy8gSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwNCi8vIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLA0KLy8gT1IgVE9SVCAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4NCi8vID09PT0NCi8vDQoNCi8vLyBAYXV0aG9yIFNhbnRpbWVudCBMTEMNCi8vLyBAdGl0bGUgIFN1YnNjcmlwdGlvbiBNb2R1bGUgZm9yIFNBTiAtIHNhbnRpbWVudCB0b2tlbg0KDQpjb250cmFjdCBCYXNlIHsNCg0KICAgIGZ1bmN0aW9uIG1heCh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgeyByZXR1cm4gYSA+PSBiID8gYSA6IGI7IH0NCiAgICBmdW5jdGlvbiBtaW4odWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIGEgPD0gYiA/IGEgOiBiOyB9DQoNCiAgICBtb2RpZmllciBvbmx5KGFkZHJlc3MgYWxsb3dlZCkgew0KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhbGxvd2VkKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCg0KICAgIC8vL0ByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QNCiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsNCiAgICAgICAgdWludCBzaXplOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAoc2l6ZSA+IDApOw0KICAgIH0NCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgIHJlZW50cmFuY3kgaGFuZGxpbmcgICAgICAgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy9AZGV2IHByZWRlZmluZWQgbG9ja3MgKHVwIHRvIHVpbnQgYml0IGxlbmd0aCwgaS5lLiAyNTYgcG9zc2libGUpDQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDAgPSAyICoqIDA7DQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDEgPSAyICoqIDE7DQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDIgPSAyICoqIDI7DQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDMgPSAyICoqIDM7DQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDQgPSAyICoqIDQ7DQogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDUgPSAyICoqIDU7DQoNCiAgICAvL3ByZXZlbnRzIHJlZW50cmFuY3kgYXR0YWNzOiBzcGVjaWZpYyBsb2Nrcw0KICAgIHVpbnQgcHJpdmF0ZSBiaXRsb2NrcyA9IDA7DQogICAgbW9kaWZpZXIgbm9SZWVudHJhbmN5KHVpbnQgbSkgew0KICAgICAgICB2YXIgX2xvY2tzID0gYml0bG9ja3M7DQogICAgICAgIGlmIChfbG9ja3MgJiBtID4gMCkgdGhyb3c7DQogICAgICAgIGJpdGxvY2tzIHw9IG07DQogICAgICAgIF87DQogICAgICAgIGJpdGxvY2tzID0gX2xvY2tzOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIG5vQW55UmVlbnRyYW5jeSB7DQogICAgICAgIHZhciBfbG9ja3MgPSBiaXRsb2NrczsNCiAgICAgICAgaWYgKF9sb2NrcyA+IDApIHRocm93Ow0KICAgICAgICBiaXRsb2NrcyA9IHVpbnQoLTEpOw0KICAgICAgICBfOw0KICAgICAgICBiaXRsb2NrcyA9IF9sb2NrczsNCiAgICB9DQoNCiAgICAvLy9AZGV2IGVtcHR5IG1hcmtpbmcgbW9kaWZpZXIgc2lnbmFsaW5nIHRvIHVzZXIgb2YgdGhlIG1hcmtlZCBmdW5jdGlvbiAsIHRoYXQgaXQgY2FuIGNhdXNlIGFuIHJlZW50cmFudCBjYWxsLg0KICAgIC8vLyAgICAgZGV2ZWxvcGVyIHNob3VsZCBtYWtlIHRoZSBjYWxsZXIgZnVuY3Rpb24gcmVlbnRyYW50LXNhZmUgaWYgaXQgdXNlIGEgcmVlbnRyYW50IGZ1bmN0aW9uLg0KICAgIG1vZGlmaWVyIHJlZW50cmFudCB7IF87IH0NCg0KfQ0KDQpjb250cmFjdCBPd25lZCBpcyBCYXNlIHsNCg0KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOw0KICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyOw0KDQogICAgZnVuY3Rpb24gT3duZWQoKSB7DQogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgb25seShvd25lcikgew0KICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBvbmx5KG5ld093bmVyKSB7DQogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7DQogICAgICAgIG93bmVyID0gbmV3T3duZXI7DQogICAgfQ0KDQogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvKTsNCg0KfQ0KDQoNCmNvbnRyYWN0IEVSQzIwIGlzIE93bmVkIHsNCg0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOw0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7DQogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7DQogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsNCiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsNCiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOw0KICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsNCiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsNCiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgaXNTdGFydGVkT25seSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7DQogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICAgIH0NCg0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7DQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOw0KDQogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7DQogICAgYm9vbCAgICBwdWJsaWMgaXNTdGFydGVkID0gZmFsc2U7DQoNCiAgICBtb2RpZmllciBvbmx5SG9sZGVyKGFkZHJlc3MgaG9sZGVyKSB7DQogICAgICAgIGlmIChiYWxhbmNlT2YoaG9sZGVyKSA9PSAwKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBpc1N0YXJ0ZWRPbmx5KCkgew0KICAgICAgICBpZiAoIWlzU3RhcnRlZCkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQp9DQoNCi8vRGVjaXNpb24gbWFkZS4NCi8vIDEgLSBQcm92aWRlciBpcyBzb2xlbHkgcmVzcG9uc2libGUgdG8gY29uc2lkZXIgZmFpbGVkIHN1YiBjaGFyZ2UgYXMgYW4gZXJyb3IgYW5kIHN0b3AgdGhlIHNlcnZpY2UsDQovLyAgICB0aGVyZWZvcmUgdGhlcmUgaXMgbm8gc2VwYXJhdGUgZXJyb3Igc3RhdGUgb3IgY291bnRlciBmb3IgdGhhdCBpbiB0aGlzIFRva2VuIENvbnRyYWN0Lg0KLy8NCi8vIDIgLSBBIGNhbGwgb3JpZ2luYXRlZCBmcm9tIHRoZSB1c2VyIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpPT1mYWxzZSkgc2hvdWxkIHRocm93IGFuIGV4Y2VwdGlvbiBvbiBlcnJvciwNCi8vICAgICBidXQgaXQgc2hvdWxkIHJldHVybiAiZmFsc2UiIG9uIGVycm9yIGlmIGNhbGxlZCBmcm9tIG90aGVyIGNvbnRyYWN0IChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpPT10cnVlKS4NCi8vICAgICBSZWFzb246IHRocm93biBleGNlcHRpb24gYXJlIGVhc2llciB0byBzZWUgaW4gd2FsbGV0cywgcmV0dXJuZWQgYm9vbGVhbiB2YWx1ZXMgYXJlIGVhc2llciB0byBldmFsdWF0ZSBpbiB0aGUgY29kZSBvZiB0aGUgY2FsbGluZyBjb250cmFjdC4NCi8vDQovLyAzIC0gU2VydmljZSBwcm92aWRlcnMgYXJlIHJlc3BvbnNpYmxlIGZvciBmaXJpbmcgZXZlbnRzIGluIGNhc2Ugb2Ygb2ZmZXIgY2hhbmdlczsNCi8vICAgICBpdCBpcyB0aGVpcnMgZGVjaXNpb24gdG8gaW5mb3JtIERBcHBzIGFib3V0IG9mZmVyIGNoYW5nZXMgb3Igbm90Lg0KLy8NCg0KDQovLy9AZGV2IGFuIGJhc2UgY2xhc3MgdG8gaW1wbGVtZW50IGJ5IFNlcnZpY2UgUHJvdmlkZXIgY29udHJhY3QgdG8gYmUgbm90aWZpZWQgYWJvdXQgc3Vic2NyaXB0aW9uIGNoYW5nZXMgKGluLVR4IG5vdGlmaWNhdGlvbikuDQovLy8gICAgIEFkZGl0aW9uYWxseSBpdCBjb250YWlucyBzdGFuZGFyZCBldmVudHMgdG8gYmUgZmlyZWQgYnkgc2VydmljZSBwcm92aWRlciBvbiBvZmZlciBjaGFuZ2VzLg0KLy8vICAgICBzZWUgYWxzZSBFVk0gZXZlbnRzIGxvZ2dlZCBieSBzdWJzY3JpcHRpb24gbW9kdWxlLg0KLy8NCmNvbnRyYWN0IFNlcnZpY2VQcm92aWRlciB7DQoNCiAgICAvLy9AZGV2IGdldCBodW1hbiByZWFkYWJsZSBkZXNjcmlwdG9yIChvciB1cmwpIGZvciB0aGlzIFNlcnZpY2UgcHJvdmlkZXINCiAgICAvLw0KICAgIGZ1bmN0aW9uIGluZm8oKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhzdHJpbmcpOw0KDQogICAgLy8vQGRldiBjYWxsZWQgdG8gcG9zdC1hcHByb3ZlL3JlamVjdCBpbmNvbWluZyBzaW5nbGUgcGF5bWVudC4NCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgcGF5bWVudC4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIG9uUGF5bWVudChhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy9AZGV2IGNhbGxlZCB0byBwb3N0LWFwcHJvdmUvcmVqZWN0IHN1YnNjcmlwdGlvbiBjaGFyZ2UuDQogICAgLy8vQHJldHVybiBgZmFsc2VgIGNhdXNlcyBhbiBleGNlcHRpb24gYW5kIHJldmVydHMgdGhlIG9wZXJhdGlvbi4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIG9uU3ViRXhlY3V0ZWQodWludCBzdWJJZCkgcHVibGljIHJldHVybnMgKGJvb2wpOw0KDQogICAgLy8vQGRldiBjYWxsZWQgdG8gcG9zdC1hcHByb3ZlL3JlamVjdCBhIGNyZWF0aW9uIG9mIHRoZSBzdWJzY3JpcHRpb24uDQogICAgLy8vQHJldHVybiBgZmFsc2VgIGNhdXNlcyBhbiBleGNlcHRpb24gYW5kIHJldmVydHMgdGhlIG9wZXJhdGlvbi4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIG9uU3ViTmV3KHVpbnQgbmV3U3ViSWQsIHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wpOw0KDQogICAgLy8vQGRldiBjYWxsZWQgdG8gbm90aWZ5IHNlcnZpY2UgcHJvdmlkZXIgYWJvdXQgc3Vic2NyaXB0aW9uIGNhbmNlbGxhdGlvbi4NCiAgICAvLy8gICAgIFByb3ZpZGVyIGlzIG5vdCBhYmxlIHRvIHByZXZlbnQgdGhlIGNhbmNlbGxhdGlvbi4NCiAgICAvLy9AcmV0dXJuIDw8cmVzZXJ2ZWQgZm9yIGZ1dHVyZSBpbXBsZW1lbnRhdGlvbj4+DQogICAgLy8NCiAgICBmdW5jdGlvbiBvblN1YkNhbmNlbGVkKHVpbnQgc3ViSWQsIGFkZHJlc3MgY2FsbGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy9AZGV2IGNhbGxlZCB0byBub3RpZnkgc2VydmljZSBwcm92aWRlciBhYm91dCBzdWJzY3JpcHRpb24gZ290IGhvbGQvdW5ob2xkLg0KICAgIC8vL0ByZXR1cm4gYGZhbHNlYCBjYXVzZXMgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnRzIHRoZSBvcGVyYXRpb24uDQogICAgLy8NCiAgICBmdW5jdGlvbiBvblN1YlVuSG9sZCh1aW50IHN1YklkLCBhZGRyZXNzIGNhbGxlciwgYm9vbCBpc09uSG9sZCkgcHVibGljIHJldHVybnMgKGJvb2wpOw0KDQoNCiAgICAvLy9AZGV2IGZvbGxvd2luZyBldmVudHMgc2hvdWxkIGJlIHVzZWQgYnkgU2VydmljZVByb3ZpZGVyIGNvbnRyYWN0IHRvIG5vdGlmeSBEQXBwcyBhYm91dCBvZmZlciBjaGFuZ2VzLg0KICAgIC8vLyAgICAgU3Vic2NyaXB0aW9uTW9kdWxlIGRvIG5vdCB0aGlzIG5vdGlmaWNhdGlvbiBhbmQgZXhwZWN0cyBpdCBmcm9tIFNlcnZpY2UgUHJvdmlkZXIgaWYgZGVzaXJlZC4NCiAgICAvLy8NCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBuZXcgT2ZmZXIgY3JlYXRlZCBpbiBhIHBsYXRmb3JtLg0KICAgIGV2ZW50IE9mZmVyQ3JlYXRlZCh1aW50IG9mZmVySWQsICBieXRlcyBkZXNjcmlwdG9yLCBhZGRyZXNzIHByb3ZpZGVyKTsNCg0KICAgIC8vL0BkZXYgdG8gYmUgZmlyZWQgYnkgU2VydmljZVByb3ZpZGVyIG9uIE9mZmVyIHVwZGF0ZWQuDQogICAgZXZlbnQgT2ZmZXJVcGRhdGVkKHVpbnQgb2ZmZXJJZCwgIGJ5dGVzIGRlc2NyaXB0b3IsIHVpbnQgb2xkRXhlY0NvdW50ZXIsIGFkZHJlc3MgcHJvdmlkZXIpOw0KDQogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gT2ZmZXIgY2FuY2VsZWQuDQogICAgZXZlbnQgT2ZmZXJDYW5jZWxlZCh1aW50IG9mZmVySWQsIGJ5dGVzIGRlc2NyaXB0b3IsIGFkZHJlc3MgcHJvdmlkZXIpOw0KDQogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gT2ZmZXIgaG9sZC91bmhvbGQgc3RhdHVzIGNoYW5nZWQuDQogICAgZXZlbnQgT2ZmZXJVbkhvbGQodWludCBvZmZlcklkLCAgIGJ5dGVzIGRlc2NyaXB0b3IsIGJvb2wgaXNPbkhvbGROb3csIGFkZHJlc3MgcHJvdmlkZXIpOw0KfSAvL1NlcnZpY2VQcm92aWRlcg0KDQovLy9Abm90aWNlIFhSYXRlUHJvdmlkZXIgaXMgYW4gZXh0ZXJuYWwgc2VydmljZSBwcm92aWRpbmcgYW4gZXhjaGFuZ2UgcmF0ZSBmcm9tIGV4dGVybmFsIGN1cnJlbmN5IHRvIFNBTiB0b2tlbi4NCi8vLyBpdCB1c2VkIGZvciBzdWJzY3JpcHRpb25zIHByaWNlZCBpbiBvdGhlciBjdXJyZW5jeSB0aGFuIFNBTiAoZXZlbiBjYWxjdWxhdGVkIGFuZCBwYWlkIGZvcm1hbGx5IGluIFNBTikuDQovLy8gaWYgbm9uLWRlZmF1bHQgWFJhdGVQcm92aWRlciBpcyBzZXQgZm9yIHNvbWUgc3Vic2NyaXB0aW9uLCB0aGVuIHRoZSBhbW91bnQgaW4gU0FOIGZvciBldmVyeSBwZXJpb2RpYyBwYXltZW50DQovLy8gd2lsbCBiZSByZWNhbGN1bGF0ZWQgdXNpbmcgcHJvdmlkZWQgZXhjaGFuZ2UgcmF0ZS4NCi8vLw0KLy8vIFBsZWFzZSBub3RlLCB0aGF0IHRoZSBleGNoYW5nZSByYXRlIGZyYWN0aW9uIGlzICh1aW50MzIsdWludDMyKSBudW1iZXIuIEl0IHNob3VsZCBiZSBlbm91Z2ggdG8gZXhwcmVzcw0KLy8vIGFueSByZWFsIGV4Y2hhbmdlIHJhdGUgdm9sYXRpbGl0eS4gTmV2ZXJ0aGVsZXNzIHlvdSBhcmUgYWR2aXNlZCB0byBhdm9pZCB0b28gYmlnIG51bWJlcnMgaW4gdGhlIGZyYWN0aW9uLg0KLy8vIFBvc3NpaWJseSB5b3UgY291bGQgaW1wbGVtZW50IHRoZSByYXRpbyBvZiBtdWx0aXBsZSB0b2tlbiBwZXIgU0FOIGluIG9yZGVyIHRvIGtlZXAgdGhlIGF2ZXJhZ2UgcmF0aW8gYXJvdW5kIDE6MS4NCi8vLw0KLy8vIFRoZSBkZWZhdWx0IFhSYXRlUHJvdmlkZXIgKHdpdGggaWQ9PTApIGRlZmluZXMgZXhjaGFuZ2UgcmF0ZSAxOjEgYW5kIHJlcHJlc2VudHMgZXhjaGFuZ2UgcmF0ZSBvZiBTQU4gdG9rZW4gdG8gaXRzZWxmLg0KLy8vIHRoaXMgcHJvdmlkZXIgaXMgc2V0IGJ5IGRlZmFsdWx0IGFuZCB0aHVzIHRoZSBzdWJzY3JpcHRpb24gYmVjb21lcyBub21pbmF0ZWQgaW4gU0FOLg0KLy8NCmNvbnRyYWN0IFhSYXRlUHJvdmlkZXIgew0KDQogICAgLy9AZGV2IHJldHVybnMgY3VycmVudCBleGNoYW5nZSByYXRlIChpbiBmb3JtIG9mIGEgc2ltcGxlIGZyYWN0aW9uKSBmcm9tIG90aGVyIGN1cnJlbmN5IHRvIFNBTiAoZi5lLiBFVEg6U0FOKS4NCiAgICAvL0BkZXYgZnJhY3Rpb24gbnVtYmVycyBhcmUgcmVzdHJpY3RlZCB0byB1aW50MTYgdG8gcHJldmVudCBvdmVyZmxvdyBpbiBjYWxjdWxhdGlvbnM7DQogICAgZnVuY3Rpb24gZ2V0UmF0ZSgpIHB1YmxpYyByZXR1cm5zICh1aW50MzIgLypub21pbmF0b3IqLywgdWludDMyIC8qZGVub21pbmF0b3IqLyk7DQoNCiAgICAvL0BkZXYgcHJvdmlkZXMgYSBjb2RlIGZvciBhbm90aGVyIGN1cnJlbmN5LCBmLmUuICJFVEgiIG9yICJVU0QiDQogICAgZnVuY3Rpb24gZ2V0Q29kZSgpIHB1YmxpYyByZXR1cm5zIChzdHJpbmcpOw0KfQ0KDQoNCi8vQGRldiBkYXRhIHN0cnVjdHVyZSBmb3IgU3Vic2NyaXB0aW9uTW9kdWxlDQpjb250cmFjdCBTdWJzY3JpcHRpb25CYXNlIHsNCg0KICAgIGVudW0gU3ViU3RhdGUgICB7Tk9UX0VYSVNULCBCRUZPUkVfU1RBUlQsIFBBSUQsIENIQVJHRUFCTEUsIE9OX0hPTEQsIENBTkNFTEVELCBFWFBJUkVELCBGSU5BTElaRUR9DQogICAgZW51bSBPZmZlclN0YXRlIHtOT1RfRVhJU1QsIEJFRk9SRV9TVEFSVCwgQUNUSVZFLCBTT0xEX09VVCwgT05fSE9MRCwgRVhQSVJFRH0NCg0KICAgIHN0cmluZ1tdIGludGVybmFsIFNVQl9TVEFURVMgICA9IFsiTk9UX0VYSVNUIiwgIkJFRk9SRV9TVEFSVCIsICJQQUlEIiwgIkNIQVJHRUFCTEUiLCAiT05fSE9MRCIsICJDQU5DRUxFRCIsICJFWFBJUkVEIiwgIkZJTkFMSVpFRCIgXTsNCiAgICBzdHJpbmdbXSBpbnRlcm5hbCBPRkZFUl9TVEFURVMgPSBbIk5PVF9FWElTVCIsICJCRUZPUkVfU1RBUlQiLCAiQUNUSVZFIiwgIlNPTERfT1VUIiwgIk9OX0hPTEQiLCAiRVhQSVJFRCJdOw0KDQogICAgLy9AZGV2IHN1YnNjcmlwdGlvbiBhbmQgc3Vic2NyaXB0aW9uIG9mZmVyIHVzZSB0aGUgc2FtZSBzdHJ1Y3R1cmUuIE9mZmVyIGlzIHRlY2huaWNhbGx5IGEgdGVtcGxhdGUgZm9yIHN1YnNjcmlwdGlvbi4NCiAgICBzdHJ1Y3QgU3Vic2NyaXB0aW9uIHsNCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlckZyb207ICAgLy8gY3VzdG9tZXIgKHVuc2V0IGluIHN1YnNjcmlwdGlvbiBvZmZlcikNCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlclRvOyAgICAgLy8gc2VydmljZSBwcm92aWRlcg0KICAgICAgICB1aW50IHByaWNlUGVySG91cjsgICAgICAvLyBwcmljZSBpbiBTQU4gcGVyIGhvdXIgKHBvc3NpYmx5IHJlY2FsY3VsYXRlZCB1c2luZyBleGNoYW5nZSByYXRlKQ0KICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX247ICAvLyBub21pbmF0b3INCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9kOyAgLy8gZGVub21pbmF0b3INCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZDsgLy8gaWQgb2YgYSByZWdpc3RlcmVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXINCiAgICAgICAgdWludCBwYWlkVW50aWw7ICAgICAgICAgLy8gc3Vic2NyaXB0aW9uIGlzIHBhaWQgdW50aWwgdGltZQ0KICAgICAgICB1aW50IGNoYXJnZVBlcmlvZDsgICAgICAvLyBzdWJzY3JpcHRpb24gY2FuJ3QgYmUgY2hhcmdlZCBtb3JlIG9mdGVuIHRoYW4gdGhpcyBwZXJpb2QNCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50OyAgICAgLy8gdXBmcm9udCBkZXBvc2l0IG9uIGNyZWF0aW5nIHN1YnNjcmlwdGlvbiAocG9zc2libHkgcmVjYWxjdWxhdGVkIHVzaW5nIGV4Y2hhbmdlIHJhdGUpDQoNCiAgICAgICAgdWludCBzdGFydE9uOyAgICAgICAgICAgLy8gZm9yIG9mZmVyOiBjYW4ndCBiZSBhY2NlcHRlZCBiZWZvcmUgIDxzdGFydE9uPiA7IGZvciBzdWJzY3JpcHRpb246IGNhbid0IGJlIGNoYXJnZWQgYmVmb3JlIDxzdGFydE9uPg0KICAgICAgICB1aW50IGV4cGlyZU9uOyAgICAgICAgICAvLyBmb3Igb2ZmZXI6IGNhbid0IGJlIGFjY2VwdGVkIGFmdGVyICA8ZXhwaXJlT24+IDsgZm9yIHN1YnNjcmlwdGlvbjogY2FuJ3QgYmUgY2hhcmdlZCBhZnRlciAgPGV4cGlyZU9uPg0KICAgICAgICB1aW50IGV4ZWNDb3VudGVyOyAgICAgICAvLyBmb3Igb2ZmZXI6IG1heCBudW0gb2Ygc3Vic2NyaXB0aW9ucyBhdmFpbGFibGUgIDsgZm9yIHN1YnNjcmlwdGlvbjogbnVtIG9mIGNoYXJnZXMgbWFkZS4NCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcjsgICAgICAgLy8gc3Vic2NyaXB0aW9uIHBheWxvYWQgKHN1YmplY3QpOiBldmFsdWF0ZWQgYnkgc2VydmljZSBwcm92aWRlci4NCiAgICAgICAgdWludCBvbkhvbGRTaW5jZTsgICAgICAgLy8gc3Vic2NyaXB0aW9uOiBvbi1ob2xkIHNpbmNlIHRpbWUgb3IgMCBpZiBub3Qgb25Ib2xkLiBvZmZlcjogdW51c2VkOiAvL1RvRG86IHRvIGJlIGltcGxlbWVudGVkDQogICAgfQ0KDQogICAgc3RydWN0IERlcG9zaXQgew0KICAgICAgICB1aW50IHZhbHVlOyAgICAgICAgIC8vIHZhbHVlIG9uIGRlcG9zaXQNCiAgICAgICAgYWRkcmVzcyBvd25lcjsgICAgICAvLyB1c3VhbGx5IGEgY3VzdG9tZXINCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcjsgICAvLyBzZXJ2aWNlIHJlbGF0ZWQgZGVzY3JpcHRvciB0byBiZSBldmFsdWF0ZWQgYnkgc2VydmljZSBwcm92aWRlcg0KICAgIH0NCg0KICAgIGV2ZW50IE5ld1N1YnNjcmlwdGlvbihhZGRyZXNzIGN1c3RvbWVyLCBhZGRyZXNzIHNlcnZpY2UsIHVpbnQgb2ZmZXJJZCwgdWludCBzdWJJZCk7DQogICAgZXZlbnQgTmV3RGVwb3NpdCh1aW50IGRlcG9zaXRJZCwgdWludCB2YWx1ZSwgYWRkcmVzcyBzZW5kZXIpOw0KICAgIGV2ZW50IE5ld1hSYXRlUHJvdmlkZXIoYWRkcmVzcyBhZGRyLCB1aW50MTYgeFJhdGVQcm92aWRlcklkLCBhZGRyZXNzIHNlbmRlcik7DQogICAgZXZlbnQgRGVwb3NpdFJldHVybmVkKHVpbnQgZGVwb3NpdElkLCBhZGRyZXNzIHJldHVybmVkVG8pOw0KICAgIGV2ZW50IFN1YnNjcmlwdGlvbkRlcG9zaXRSZXR1cm5lZCh1aW50IHN1YklkLCB1aW50IGFtb3VudCwgYWRkcmVzcyByZXR1cm5lZFRvLCBhZGRyZXNzIHNlbmRlcik7DQogICAgZXZlbnQgT2ZmZXJPbkhvbGQodWludCBvZmZlcklkLCBib29sIG9uSG9sZCwgYWRkcmVzcyBzZW5kZXIpOw0KICAgIGV2ZW50IE9mZmVyQ2FuY2VsZWQodWludCBvZmZlcklkLCBhZGRyZXNzIHNlbmRlcik7DQogICAgZXZlbnQgU3ViT25Ib2xkKHVpbnQgb2ZmZXJJZCwgYm9vbCBvbkhvbGQsIGFkZHJlc3Mgc2VuZGVyKTsNCiAgICBldmVudCBTdWJDYW5jZWxlZCh1aW50IHN1YklkLCBhZGRyZXNzIHNlbmRlcik7DQoNCn0NCg0KLy8vQGRldiBhbiBJbnRlcmZhY2UgZm9yIFN1YnNjcmlwdGlvbk1vZHVsZS4NCi8vLyAgICAgZXh0cmFjdGVkIGhlcmUgZm9yIGJldHRlciBvdmVydmlldy4NCi8vLyAgICAgc2VlIGRldGFpbGVkIGRvY3VtZW50YXRpb24gaW4gaW1wbGVtZW50YXRpb24gbW9kdWxlLg0KY29udHJhY3QgU3Vic2NyaXB0aW9uTW9kdWxlIGlzIFN1YnNjcmlwdGlvbkJhc2UsIEJhc2Ugew0KDQogICAgLy8vQGRldiAqKioqKiBtb2R1bGUgY29uZmlndXJhdGlvbiAqKioqKg0KICAgIGZ1bmN0aW9uIGF0dGFjaFRva2VuKGFkZHJlc3MgdG9rZW4pIHB1YmxpYzsNCg0KICAgIC8vL0BkZXYgKioqKiogc2luZ2xlIHBheW1lbnQgaGFuZGxpbmcgKioqKioNCiAgICBmdW5jdGlvbiBwYXltZW50VG8odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHBheW1lbnRGcm9tKHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEsIGFkZHJlc3MgX2Zyb20sIFNlcnZpY2VQcm92aWRlciBfdG8pIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCg0KICAgIC8vL0BkZXYgKioqKiogc3Vic2NyaXB0aW9uIGhhbmRsaW5nICoqKioqDQogICAgLy8vQGRldiBzb21lIGZ1bmN0aW9ucyBhcmUgbWFya2VkIGFzIHJlZW50cmFudCwgZXZlbiB0aGVpcnMgaW1wbGVtZW50YXRpb24gaXMgbWFya2VkIHdpdGggbm9SZWVudHJhbmN5KExPQ0spLg0KICAgIC8vLyAgICAgVGhpcyBpcyBpbnRlbnRpb25hbGx5IGJlY2F1c2UgdGhlc2Ugbm9SZWVudHJhbmN5KExPQ0spIHJlc3RyaWN0aW9ucyBjYW4gYmUgbGlmdGVkIGluIHRoZSBmdXR1cmUuDQogICAgLy8gICAgICBGdW5jdGlvbnMgd291bGQgYmVjb21lIHJlZW50cmFudC4NCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb24odWludCBfb2ZmZXJJZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX3N0YXJ0T24pIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAodWludCBuZXdTdWJJZCk7DQogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHJlZW50cmFudCBwdWJsaWM7DQogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSkgcmVlbnRyYW50IHB1YmxpYzsNCiAgICBmdW5jdGlvbiBob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIGV4ZWN1dGVTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHBvc3Rwb25lRHVlRGF0ZSh1aW50IHN1YklkLCB1aW50IG5ld0R1ZURhdGUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHJldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYzsNCiAgICBmdW5jdGlvbiBjbGFpbVN1YnNjcmlwdGlvbkRlcG9zaXQodWludCBzdWJJZCkgcHVibGljOw0KICAgIGZ1bmN0aW9uIHN0YXRlKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHN0cmluZyBzdGF0ZSk7DQogICAgZnVuY3Rpb24gc3RhdGVDb2RlKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQgc3RhdGVDb2RlKTsNCg0KICAgIC8vL0BkZXYgKioqKiogc3Vic2NyaXB0aW9uIG9mZmVyIGhhbmRsaW5nICoqKioqDQogICAgZnVuY3Rpb24gY3JlYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBfcHJpY2UsIHVpbnQxNiBfeHJhdGVQcm92aWRlcklkLCB1aW50IF9jaGFyZ2VQZXJpb2QsIHVpbnQgX2V4cGlyZU9uLCB1aW50IF9vZmZlckxpbWl0LCB1aW50IF9kZXBvc2l0VmFsdWUsIHVpbnQgX3N0YXJ0T24sIGJ5dGVzIF9kZXNjcmlwdG9yKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKHVpbnQgc3ViSWQpOw0KICAgIGZ1bmN0aW9uIHVwZGF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCwgdWludCBfb2ZmZXJMaW1pdCkgcHVibGljOw0KICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOw0KICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7DQoNCiAgICAvLy9AZGV2ICoqKioqIHNpbXBsZSBkZXBvc2l0IGhhbmRsaW5nICoqKioqDQogICAgZnVuY3Rpb24gY3JlYXRlRGVwb3NpdCh1aW50IF92YWx1ZSwgYnl0ZXMgX2Rlc2NyaXB0b3IpIHB1YmxpYyByZXR1cm5zICh1aW50IHN1YklkKTsNCiAgICBmdW5jdGlvbiBjbGFpbURlcG9zaXQodWludCBkZXBvc2l0SWQpIHB1YmxpYzsNCg0KICAgIC8vL0BkZXYgKioqKiogRXhjaGFuZ2VSYXRlIHByb3ZpZGVyICoqKioqDQogICAgZnVuY3Rpb24gcmVnaXN0ZXJYUmF0ZVByb3ZpZGVyKFhSYXRlUHJvdmlkZXIgYWRkcikgcHVibGljIHJldHVybnMgKHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQpOw0KDQogICAgLy8vQGRldiAqKioqKiBTZXJ2aWNlIHByb3ZpZGVyIChwYXltZW50IHJlY2VpdmVyKSAqKioqKg0KICAgIGZ1bmN0aW9uIGVuYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYzsNCiAgICBmdW5jdGlvbiBkaXNhYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljOw0KDQoNCiAgICAvLy9AZGV2ICoqKioqIGNvbnZlbmllbmNlIHN1YnNjcmlwdGlvbiBnZXR0ZXIgKioqKioNCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25EZXRhaWxzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKA0KICAgICAgICBhZGRyZXNzIHRyYW5zZmVyRnJvbSwNCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlclRvLA0KICAgICAgICB1aW50IHByaWNlUGVySG91ciwNCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9uLCAvL25vbWluYXRvcg0KICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX2QsIC8vZGVub21pbmF0b3INCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZCwNCiAgICAgICAgdWludCBjaGFyZ2VQZXJpb2QsDQogICAgICAgIHVpbnQgc3RhcnRPbiwNCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcg0KICAgICk7DQoNCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25TdGF0dXModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoDQogICAgICAgIHVpbnQgZGVwb3NpdEFtb3VudCwNCiAgICAgICAgdWludCBleHBpcmVPbiwNCiAgICAgICAgdWludCBleGVjQ291bnRlciwNCiAgICAgICAgdWludCBwYWlkVW50aWwsDQogICAgICAgIHVpbnQgb25Ib2xkU2luY2UNCiAgICApOw0KDQogICAgZW51bSBQYXltZW50U3RhdHVzIHtPSywgQkFMQU5DRV9FUlJPUiwgQVBQUk9WQUxfRVJST1J9DQogICAgZXZlbnQgUGF5bWVudChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIHVpbnQgX2ZlZSwgYWRkcmVzcyBzZW5kZXIsIFBheW1lbnRTdGF0dXMgc3RhdHVzLCB1aW50IHN1YklkKTsNCiAgICBldmVudCBTZXJ2aWNlUHJvdmlkZXJFbmFibGVkKGFkZHJlc3MgYWRkciwgYnl0ZXMgbW9yZUluZm8pOw0KICAgIGV2ZW50IFNlcnZpY2VQcm92aWRlckRpc2FibGVkKGFkZHJlc3MgYWRkciwgYnl0ZXMgbW9yZUluZm8pOw0KDQp9IC8vU3Vic2NyaXB0aW9uTW9kdWxlDQoNCmNvbnRyYWN0IEVSQzIwTW9kdWxlU3VwcG9ydCB7DQogICAgZnVuY3Rpb24gX2Z1bGZpbGxQcmVhcHByb3ZlZFBheW1lbnQoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBhZGRyZXNzIG1zZ19zZW5kZXIpIHB1YmxpYyByZXR1cm5zKGJvb2wgc3VjY2Vzcyk7DQogICAgZnVuY3Rpb24gX2Z1bGZpbGxQYXltZW50KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgdWludCBzdWJJZCwgYWRkcmVzcyBtc2dfc2VuZGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsNCiAgICBmdW5jdGlvbiBfbWludEZyb21EZXBvc2l0KGFkZHJlc3Mgb3duZXIsIHVpbnQgYW1vdW50KSBwdWJsaWM7DQogICAgZnVuY3Rpb24gX2J1cm5Gb3JEZXBvc2l0KGFkZHJlc3Mgb3duZXIsIHVpbnQgYW1vdW50KSBwdWJsaWMgcmV0dXJucyhib29sIHN1Y2Nlc3MpOw0KfQ0KDQovL0BkZXYgaW1wbGVtZW50YXRpb24NCmNvbnRyYWN0IFN1YnNjcmlwdGlvbk1vZHVsZUltcGwgaXMgU3Vic2NyaXB0aW9uTW9kdWxlLCBPd25lZCAgew0KDQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBWRVJTSU9OID0gIjAuMS4wIjsNCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgICAgICBjb250cmFjdCBzdGF0ZXMgICAgICAgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy8vQGRldiBsaXN0IG9mIGFsbCByZWdpc3RlcmVkIHNlcnZpY2UgcHJvdmlkZXIgY29udHJhY3RzIGltcGxlbWVudGVkIGFzIGEgbWFwIGZvciBiZXR0ZXIgbG9va3VwLg0KICAgIG1hcHBpbmcgKGFkZHJlc3M9PmJvb2wpIHB1YmxpYyBwcm92aWRlclJlZ2lzdHJ5Ow0KDQogICAgLy8vQGRldiBhbGwgc3Vic2NyaXB0aW9ucyBhbmQgb2ZmZXJzIChpbmNsLiBGSU5BTElaRUQpLg0KICAgIG1hcHBpbmcgKHVpbnQgPT4gU3Vic2NyaXB0aW9uKSBwdWJsaWMgc3Vic2NyaXB0aW9uczsNCg0KICAgIC8vL0BkZXYgYWxsIGFjdGl2ZSBzaW1wbGUgZGVwb3NpdHMgZ2l2ZWQgYnkgZGVwb3NpdElkLg0KICAgIG1hcHBpbmcgKHVpbnQgPT4gRGVwb3NpdCkgcHVibGljIGRlcG9zaXRzOw0KDQogICAgLy8vQGRldiBhZGRyZXNzZXMgb2YgcmVnaXN0ZXJlZCBleGNoYW5nZSByYXRlIHByb3ZpZGVycy4NCiAgICBYUmF0ZVByb3ZpZGVyW10gcHVibGljIHhyYXRlUHJvdmlkZXJzOw0KDQogICAgLy8vQGRldiBvbmdvaW5nIGNvdW50ZXIgZm9yIHN1YnNjcmlwdGlvbiBpZHMgc3RhcnRpbmcgZnJvbSAxLg0KICAgIC8vLyAgICAgQ3VycmVudCB2YWx1ZSByZXByZXNlbnRzIGFuIGlkIG9mIGxhc3QgY3JlYXRlZCBzdWJzY3JpcHRpb24uDQogICAgdWludCBwdWJsaWMgc3Vic2NyaXB0aW9uQ291bnRlciA9IDA7DQoNCiAgICAvLy9AZGV2IG9uZ29pbmcgY291bnRlciBmb3Igc2ltcGxlIGRlcG9zaXQgaWRzIHN0YXJ0aW5nIGZyb20gMS4NCiAgICAvLy8gICAgIEN1cnJlbnQgdmFsdWUgcmVwcmVzZW50cyBhbiBpZCBvZiBsYXN0IGNyZWF0ZWQgZGVwb3NpdC4NCiAgICB1aW50IHB1YmxpYyBkZXBvc2l0Q291bnRlciA9IDA7DQoNCiAgICAvLy9AZGV2IFRva2VuIGNvbnRyYWN0IHdpdGggRVJDMjBNb2R1bGVTdXBwb3J0IGFkZG9uLg0KICAgIC8vLyAgICAgU3Vic2NyaXB0aW9uIE1vZHVsZSBvcGVyYXRlcyBvbiBpdHMgYmFsYW5jZXMgdmlhIEVSQzIwTW9kdWxlU3VwcG9ydCBpbnRlcmZhY2UgYXMgdHJ1c3RlZCBtb2R1bGUuDQogICAgRVJDMjBNb2R1bGVTdXBwb3J0IHB1YmxpYyBzYW47DQoNCg0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgIHJlamVjdCBhbGwgZXRoZXIgc2VudCB0byB0aGlzIGNvbnRyYWN0ICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgZnVuY3Rpb24gKCkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQoNCg0KDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIC8vICogICAgICAgICAgICBzZXR1cCBhbmQgY29uZmlndXJhdGlvbiAgICAgICAgICAgICoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICAvLy9AZGV2IGNvbnN0cnVjdG9yDQogICAgZnVuY3Rpb24gU3Vic2NyaXB0aW9uTW9kdWxlSW1wbCgpIHsNCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KICAgICAgICB4cmF0ZVByb3ZpZGVycy5wdXNoKFhSYXRlUHJvdmlkZXIodGhpcykpOyAvL3RoaXMgaXMgYSBkZWZhdWx0IFNBTjpTQU4gKDE6MSkgcHJvdmlkZXIgd2l0aCBkZWZhdWx0IGlkID09IDANCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgYXR0YWNoIFNBTiB0b2tlbiB0byB3b3JrIHdpdGg7IGNhbiBiZSBkb25lIG9ubHkgb25jZS4NCiAgICBmdW5jdGlvbiBhdHRhY2hUb2tlbihhZGRyZXNzIHRva2VuKSBwdWJsaWMgew0KICAgICAgICBhc3NlcnQoYWRkcmVzcyhzYW4pID09IDApOyAvL29ubHkgaW4gbmV3IGRlcGxveWVkIHN0YXRlDQogICAgICAgIHNhbiA9IEVSQzIwTW9kdWxlU3VwcG9ydCh0b2tlbik7DQogICAgfQ0KDQoNCiAgICAvLy9AZGV2IHJlZ2lzdGVyIGEgbmV3IHNlcnZpY2UgcHJvdmlkZXIgdG8gdGhlIHBsYXRmb3JtLg0KICAgIGZ1bmN0aW9uIGVuYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYyBvbmx5KG93bmVyKSB7DQogICAgICAgIHByb3ZpZGVyUmVnaXN0cnlbYWRkcl0gPSB0cnVlOw0KICAgICAgICBTZXJ2aWNlUHJvdmlkZXJFbmFibGVkKGFkZHIsIG1vcmVJbmZvKTsNCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgZGUtcmVnaXN0ZXIgdGhlIHNlcnZpY2UgcHJvdmlkZXIgd2l0aCBnaXZlbiBgYWRkcmAuDQogICAgZnVuY3Rpb24gZGlzYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYyBvbmx5KG93bmVyKSB7DQogICAgICAgIGRlbGV0ZSBwcm92aWRlclJlZ2lzdHJ5W2FkZHJdOw0KICAgICAgICBTZXJ2aWNlUHJvdmlkZXJEaXNhYmxlZChhZGRyLCBtb3JlSW5mbyk7DQogICAgfQ0KDQoNCiAgICAvLy9AZGV2IHJlZ2lzdGVyIG5ldyBleGNoYW5nZSByYXRlIHByb3ZpZGVyLg0KICAgIC8vLyAgICAgWFJhdGVQcm92aWRlciBjYW4ndCBiZSBkZS1yZWdpc3RlcmVkLCBiZWNhdXNlIHRoZXkgY291bGQgYmUgc3RpbGwgaW4gdXNlIGJ5IHNvbWUgc3Vic2NyaXB0aW9uLg0KICAgIGZ1bmN0aW9uIHJlZ2lzdGVyWFJhdGVQcm92aWRlcihYUmF0ZVByb3ZpZGVyIGFkZHIpIHB1YmxpYyBvbmx5KG93bmVyKSByZXR1cm5zICh1aW50MTYgeHJhdGVQcm92aWRlcklkKSB7DQogICAgICAgIHhyYXRlUHJvdmlkZXJJZCA9IHVpbnQxNih4cmF0ZVByb3ZpZGVycy5sZW5ndGgpOw0KICAgICAgICB4cmF0ZVByb3ZpZGVycy5wdXNoKGFkZHIpOw0KICAgICAgICBOZXdYUmF0ZVByb3ZpZGVyKGFkZHIsIHhyYXRlUHJvdmlkZXJJZCwgbXNnLnNlbmRlcik7DQogICAgfQ0KDQoNCiAgICAvLy9AZGV2IHhyYXRlUHJvdmlkZXJzIGxlbmd0aCBhY2Nlc3Nvci4NCiAgICBmdW5jdGlvbiBnZXRYUmF0ZVByb3ZpZGVyTGVuZ3RoKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIHhyYXRlUHJvdmlkZXJzLmxlbmd0aDsNCiAgICB9DQoNCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgICBzaW5nbGUgcGF5bWVudCBtZXRob2RzICAgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgLy8vQG5vdGljZSBtYWtlcyBzaW5nbGUgcGF5bWVudCB0byBzZXJ2aWNlIHByb3ZpZGVyLg0KICAgIC8vL0BwYXJhbSBfdmFsdWUgLSBhbW91bnQgb2YgU0FOIHRva2VuIHRvIHNlbnQNCiAgICAvLy9AcGFyYW0gX3BheW1lbnREYXRhIC0gJ3BheW1lbnQgcHVycG9zZScgY29kZSB1c3VhbGx5IGlzc3VlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIGN1c3RvbWVyIGJlZm9yZSBwYXltZW50Lg0KICAgIC8vL0BwYXJhbSBfdG8gLSBzZXJ2aWNlIHByb3ZpZGVyIGNvbnRyYWN0DQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBwYXltZW50VG8odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgaWYgKHNhbi5fZnVsZmlsbFBheW1lbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIDAsIG1zZy5zZW5kZXIpKSB7DQogICAgICAgICAgICAvLyBhIFNlcnZpY2VQcm92aWRlciAoYSBTZXJ2aWNlUHJvdmlkZXIpIGhhcyBoZXJlIGFuIG9wcG9ydHVuaXR5IHZlcmlmeSBhbmQgcmVqZWN0IHRoZSBwYXltZW50DQogICAgICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihfdG8pLm9uUGF5bWVudChtc2cuc2VuZGVyLCBfdmFsdWUsIF9wYXltZW50RGF0YSkpOyAgICAgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0NCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgbWFrZXMgc2luZ2xlIHByZWFwcHJvdmVkIHBheW1lbnQgdG8gc2VydmljZSBwcm92aWRlci4gQW4gYW1vdW50IG11c3QgYmUgYWxyZWFkeSBwcmVhcHByb3ZlZCBieSBwYXltZW50IHNlbmRlciB0byByZWNlcGllbnQuDQogICAgLy8vQHBhcmFtIF92YWx1ZSAtIGFtb3VudCBvZiBTQU4gdG9rZW4gdG8gc2VudA0KICAgIC8vL0BwYXJhbSBfcGF5bWVudERhdGEgLSAncGF5bWVudCBwdXJwb3NlJyBjb2RlIHVzdWFsbHkgaXNzdWVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIgdG8gY3VzdG9tZXIgYmVmb3JlIHBheW1lbnQuDQogICAgLy8vQHBhcmFtIF9mcm9tIC0gc2VuZGVyIG9mIHRoZSBwYXltZW50IChvdGhlciB0aGFuIG1zZy5zZW5kZXIpDQogICAgLy8vQHBhcmFtIF90byAtIHNlcnZpY2UgcHJvdmlkZXIgY29udHJhY3QNCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIHBheW1lbnRGcm9tKHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEsIGFkZHJlc3MgX2Zyb20sIFNlcnZpY2VQcm92aWRlciBfdG8pIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIGlmIChzYW4uX2Z1bGZpbGxQcmVhcHByb3ZlZFBheW1lbnQoX2Zyb20sIF90bywgX3ZhbHVlLCBtc2cuc2VuZGVyKSkgew0KICAgICAgICAgICAgLy8gYSBTZXJ2aWNlUHJvdmlkZXIgKGEgU2VydmljZVByb3ZpZGVyKSBoYXMgaGVyZSBhbiBvcHBvcnR1bml0eSB2ZXJpZnkgYW5kIHJlamVjdCB0aGUgcGF5bWVudA0KICAgICAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblBheW1lbnQoX2Zyb20sIF92YWx1ZSwgX3BheW1lbnREYXRhKSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgZWxzZSB7IHRocm93OyB9DQogICAgfQ0KDQoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy8gKiAgICAgICAgICAgIHN1YnNjcmlwdGlvbiBoYW5kbGluZyAgICAgICAgICAgICAgKg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KICAgIC8vL0BkZXYgY29udmVuaWVuY2UgZ2V0dGVyIGZvciBzb21lIHN1YnNjcmlwdGlvbiBmaWVsZHMNCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25EZXRhaWxzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICgNCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlckZyb20sDQogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJUbywNCiAgICAgICAgdWludCBwcmljZVBlckhvdXIsDQogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfbiwgLy9ub21pbmF0b3INCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9kLCAvL2Rlbm9taW5hdG9yDQogICAgICAgIHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQsDQogICAgICAgIHVpbnQgY2hhcmdlUGVyaW9kLA0KICAgICAgICB1aW50IHN0YXJ0T24sDQogICAgICAgIGJ5dGVzIGRlc2NyaXB0b3INCiAgICApIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICByZXR1cm4gKHN1Yi50cmFuc2ZlckZyb20sIHN1Yi50cmFuc2ZlclRvLCBzdWIucHJpY2VQZXJIb3VyLCBzdWIuaW5pdGlhbFhyYXRlX24sIHN1Yi5pbml0aWFsWHJhdGVfZCwgc3ViLnhyYXRlUHJvdmlkZXJJZCwgc3ViLmNoYXJnZVBlcmlvZCwgc3ViLnN0YXJ0T24sIHN1Yi5kZXNjcmlwdG9yKTsNCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgY29udmVuaWVuY2UgZ2V0dGVyIGZvciBzb21lIHN1YnNjcmlwdGlvbiBmaWVsZHMNCiAgICAvLy8gICAgIGEgY2FsbGVyIG11c3Qga25vdywgdGhhdCB0aGUgc3Vic2NyaXB0aW9uIHdpdGggZ2l2ZW4gaWQgZXhpc3RzLCBiZWNhdXNlIGFsbCB0aGVzZSBmaWVsZHMgY2FuIGJlIDAgZXZlbiB0aGUgc3Vic2NyaXB0aW9uIHdpdGggZ2l2ZW4gaWQgZXhpc3RzLg0KICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvblN0YXR1cyh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucygNCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50LA0KICAgICAgICB1aW50IGV4cGlyZU9uLA0KICAgICAgICB1aW50IGV4ZWNDb3VudGVyLA0KICAgICAgICB1aW50IHBhaWRVbnRpbCwNCiAgICAgICAgdWludCBvbkhvbGRTaW5jZQ0KICAgICkgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIHJldHVybiAoc3ViLmRlcG9zaXRBbW91bnQsIHN1Yi5leHBpcmVPbiwgc3ViLmV4ZWNDb3VudGVyLCBzdWIucGFpZFVudGlsLCBzdWIub25Ib2xkU2luY2UpOw0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBleGVjdXRlIHBlcmlvZGljIHN1YnNjcmlwdGlvbiBwYXltZW50Lg0KICAgIC8vLyAgICAgICAgQW55IG9mIGN1c3RvbWVyLCBzZXJ2aWNlIHByb3ZpZGVyIGFuZCBwbGF0Zm9ybSBvd25lciBjYW4gZXhlY3V0ZSB0aGlzIGZ1bmN0aW9uLg0KICAgIC8vLyAgICAgICAgVGhpcyBlbnN1cmVzLCB0aGF0IHRoZSBzdWJzY3JpcHRpb24gY2hhcmdlIGRvZXNuJ3QgYmVjb21lIGRlbGF5ZWQuDQogICAgLy8vICAgICAgICBBdCBsZWFzdCB0aGUgcGxhdGZvcm0gb3duZXIgaGFzIGFuIGluY2VudGl2ZSB0byBnZXQgZmVlIGFuZCB0aHVzIGNhbiB0cmlnZ2VyIHRoZSBmdW5jdGlvbi4NCiAgICAvLy8gICAgICAgIEFuIGV4ZWN1dGlvbiBmYWlscyBpZiBzdWJzY3JpcHRpb24gaXMgbm90IGluIHN0YXR1cyBgQ0hBUkdFQUJMRWAuDQogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIHRvIGJlIGNoYXJnZWQuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBleGVjdXRlU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub1JlZW50cmFuY3koTDAwKSByZXR1cm5zIChib29sKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICBhc3NlcnQgKG1zZy5zZW5kZXIgPT0gc3ViLnRyYW5zZmVyRnJvbSB8fCBtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlclRvIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOw0KICAgICAgICBpZiAoX3N1YnNjcmlwdGlvblN0YXRlKHN1Yik9PVN1YlN0YXRlLkNIQVJHRUFCTEUpIHsNCiAgICAgICAgICAgIHZhciBfZnJvbSA9IHN1Yi50cmFuc2ZlckZyb207DQogICAgICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87DQogICAgICAgICAgICB2YXIgX3ZhbHVlID0gX2Ftb3VudFRvQ2hhcmdlKHN1Yik7DQogICAgICAgICAgICBpZiAoc2FuLl9mdWxmaWxsUGF5bWVudChfZnJvbSwgX3RvLCBfdmFsdWUsIHN1YklkLCBtc2cuc2VuZGVyKSkgew0KICAgICAgICAgICAgICAgIHN1Yi5wYWlkVW50aWwgID0gbWF4KHN1Yi5wYWlkVW50aWwsIHN1Yi5zdGFydE9uKSArIHN1Yi5jaGFyZ2VQZXJpb2Q7DQogICAgICAgICAgICAgICAgKytzdWIuZXhlY0NvdW50ZXI7DQogICAgICAgICAgICAgICAgLy8gYSBTZXJ2aWNlUHJvdmlkZXIgKGEgU2VydmljZVByb3ZpZGVyKSBoYXMgaGVyZSBhbiBvcHBvcnR1bml0eSB0byB2ZXJpZnkgYW5kIHJlamVjdCB0aGUgcGF5bWVudA0KICAgICAgICAgICAgICAgIGFzc2VydCAoU2VydmljZVByb3ZpZGVyKF90bykub25TdWJFeGVjdXRlZChzdWJJZCkpOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0NCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgbW92ZSBgcGFpZFVudGlsYCBmb3J3YXJkIHRvIGdpdmVuIGBuZXdEdWVEYXRlYC4gSXQgd2FpdmVzIHBheW1lbnRzIGZvciBnaXZlbiB0aW1lLg0KICAgIC8vLyAgICAgICAgVGhpcyBmdW5jdGlvbiBjYW4gYmUgdXNlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIGBnaXZlIGF3YXlgIHNvbWUgc2VydmljZSB0aW1lIGZvciBmcmVlLg0KICAgIC8vL0BwYXJhbSBzdWJJZCAtIGlkIG9mIHN1YnNjcmlwdGlvbiB0byBiZSBwb3N0cG9uZWQuDQogICAgLy8vQHBhcmFtIG5ld0R1ZURhdGUgLSBuZXcgYHBhaWRVbnRpbGAgZGF0ZXRpbWU7IHJlcXVpcmUgYG5ld0R1ZURhdGUgPiBwYWlkVW50aWxgLg0KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQ0KICAgIC8vDQogICAgZnVuY3Rpb24gcG9zdHBvbmVEdWVEYXRlKHVpbnQgc3ViSWQsIHVpbnQgbmV3RHVlRGF0ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyl7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsNCiAgICAgICAgYXNzZXJ0IChzdWIudHJhbnNmZXJUbyA9PSBtc2cuc2VuZGVyKTsgLy9vbmx5IFNlcnZpY2UgUHJvdmlkZXIgaXMgYWxsb3dlZCB0byBwb3N0cG9uZSB0aGUgRHVlRGF0ZQ0KICAgICAgICBpZiAoc3ViLnBhaWRVbnRpbCA8IG5ld0R1ZURhdGUpIHsNCiAgICAgICAgICAgIHN1Yi5wYWlkVW50aWwgPSBuZXdEdWVEYXRlOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgICBlbHNlIHsgdGhyb3c7IH0NCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgcmV0dXJuIGN1cnJlbnQgc3RhdHVzIGFzIGEgbmFtZSBvZiBhIHN1YnNjcmlwdGlvbiAob3IgYW4gb2ZmZXIpIHdpdGggZ2l2ZW4gaWQ7DQogICAgZnVuY3Rpb24gc3RhdGUodWludCBzdWJPck9mZmVySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHN0cmluZyBzdGF0ZSkgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3ViT3JPZmZlciA9IHN1YnNjcmlwdGlvbnNbc3ViT3JPZmZlcklkXTsNCiAgICAgICAgcmV0dXJuIF9pc09mZmVyKHN1Yk9yT2ZmZXIpDQogICAgICAgICAgICAgID8gT0ZGRVJfU1RBVEVTW3VpbnQoX29mZmVyU3RhdGUoc3ViT3JPZmZlcikpXQ0KICAgICAgICAgICAgICA6IFNVQl9TVEFURVNbdWludChfc3Vic2NyaXB0aW9uU3RhdGUoc3ViT3JPZmZlcikpXTsNCiAgICB9DQoNCg0KICAgIC8vL0BkZXYgcmV0dXJuIGN1cnJlbnQgc3RhdHVzIGFzIGEgY29kZSBvZiBhIHN1YnNjcmlwdGlvbiAob3IgYW4gb2ZmZXIpIHdpdGggZ2l2ZW4gaWQ7DQogICAgZnVuY3Rpb24gc3RhdGVDb2RlKHVpbnQgc3ViT3JPZmZlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50IHN0YXRlQ29kZSkgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3ViT3JPZmZlciA9IHN1YnNjcmlwdGlvbnNbc3ViT3JPZmZlcklkXTsNCiAgICAgICAgcmV0dXJuIF9pc09mZmVyKHN1Yk9yT2ZmZXIpDQogICAgICAgICAgICAgID8gdWludChfb2ZmZXJTdGF0ZShzdWJPck9mZmVyKSkNCiAgICAgICAgICAgICAgOiB1aW50KF9zdWJzY3JpcHRpb25TdGF0ZShzdWJPck9mZmVyKSk7DQogICAgfQ0KDQoNCiAgICBmdW5jdGlvbiBfb2ZmZXJTdGF0ZShTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMoT2ZmZXJTdGF0ZSBzdGF0dXMpIHsNCiAgICAgICAgaWYgKCFfaXNPZmZlcihzdWIpKSB7DQogICAgICAgICAgICByZXR1cm4gT2ZmZXJTdGF0ZS5OT1RfRVhJU1Q7DQogICAgICAgIH0gZWxzZSBpZiAoc3ViLnN0YXJ0T24gPiBub3cpIHsNCiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLkJFRk9SRV9TVEFSVDsNCiAgICAgICAgfSBlbHNlIGlmIChzdWIub25Ib2xkU2luY2UgPiAwKSB7DQogICAgICAgICAgICByZXR1cm4gT2ZmZXJTdGF0ZS5PTl9IT0xEOw0KICAgICAgICB9IGVsc2UgaWYgKG5vdyA8PSBzdWIuZXhwaXJlT24pIHsNCiAgICAgICAgICAgIHJldHVybiBzdWIuZXhlY0NvdW50ZXIgPiAwDQogICAgICAgICAgICAgICAgPyBPZmZlclN0YXRlLkFDVElWRQ0KICAgICAgICAgICAgICAgIDogT2ZmZXJTdGF0ZS5TT0xEX09VVDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLkVYUElSRUQ7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfc3Vic2NyaXB0aW9uU3RhdGUoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKFN1YlN0YXRlIHN0YXR1cykgew0KICAgICAgICBpZiAoIV9pc1N1YnNjcmlwdGlvbihzdWIpKSB7DQogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuTk9UX0VYSVNUOw0KICAgICAgICB9IGVsc2UgaWYgKHN1Yi5zdGFydE9uID4gbm93KSB7DQogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuQkVGT1JFX1NUQVJUOw0KICAgICAgICB9IGVsc2UgaWYgKHN1Yi5vbkhvbGRTaW5jZSA+IDApIHsNCiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5PTl9IT0xEOw0KICAgICAgICB9IGVsc2UgaWYgKHN1Yi5wYWlkVW50aWwgPj0gc3ViLmV4cGlyZU9uKSB7DQogICAgICAgICAgICByZXR1cm4gbm93IDwgc3ViLmV4cGlyZU9uDQogICAgICAgICAgICAgICAgPyBTdWJTdGF0ZS5DQU5DRUxFRA0KICAgICAgICAgICAgICAgIDogc3ViLmRlcG9zaXRBbW91bnQgPiAwDQogICAgICAgICAgICAgICAgICAgID8gU3ViU3RhdGUuRVhQSVJFRA0KICAgICAgICAgICAgICAgICAgICA6IFN1YlN0YXRlLkZJTkFMSVpFRDsNCiAgICAgICAgfSBlbHNlIGlmIChzdWIucGFpZFVudGlsIDw9IG5vdykgew0KICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLkNIQVJHRUFCTEU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuUEFJRDsNCiAgICAgICAgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjcmVhdGUgYSBuZXcgc3Vic2NyaXB0aW9uIG9mZmVyLg0KICAgIC8vL0BkZXYgb25seSByZWdpc3RlcmVkIHNlcnZpY2UgcHJvdmlkZXIgaXMgYWxsb3dlZCB0byBjcmVhdGUgb2ZmZXJzLg0KICAgIC8vL0BkZXYgc3Vic2NyaXB0aW9uIHVzZXMgU0FOIHRva2VuIGZvciBwYXltZW50LCBidXQgYW4gZXhhY3QgYW1vdW50IHRvIGJlIHBhaWQgb3IgZGVwb3NpdCBpcyBjYWxjdWxhdGVkIHVzaW5nIGV4Y2hhbmdlIHJhdGUgZnJvbSBleHRlcm5hbCB4cmF0ZVByb3ZpZGVyIChwcmV2aW9zbHkgcmVnaXN0ZXJlZCBvbiBwbGF0Zm9ybSkuDQogICAgLy8vICAgIFRoaXMgYWxsb3dzIHRvIGNyZWF0ZSBhIHN1YnNjcmlwdGlvbiBib3VuZCB0byBhbm90aGVyIHRva2VuIG9yIGV2ZW4gZmlhdCBjdXJyZW5jeS4NCiAgICAvLy9AcGFyYW0gX3ByaWNlUGVySG91ciAtIHN1YnNjcmlwdGlvbiBwcmljZSBwZXIgaG91ciBpbiBTQU4NCiAgICAvLy9AcGFyYW0gX3hyYXRlUHJvdmlkZXJJZCAtIGlkIG9mIGV4dGVybmFsIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXIgZnJvbSBzdWJzY3JpcHRpb24gY3VycmVuY3kgdG8gU0FOOyAiMCIgbWVhbnMgc3Vic2NyaXB0aW9uIGlzIHByaWNlZCBpbiBTQU4gbmF0aXZlbHkuDQogICAgLy8vQHBhcmFtIF9jaGFyZ2VQZXJpb2QgLSB0aW1lIHBlcmlvZCB0byBjaGFyZ2U7IHN1YnNjcmlwdGlvbiBjYW4ndCBiZSBjaGFyZ2VkIG1vcmUgb2Z0ZW4gdGhhbiB0aGlzIHBlcmlvZC4gVGltZSB1bml0cyBhcmUgbmF0aXZlIGV0aGVyZXVtIHRpbWUsIHJldHVybmluZyBieSBgbm93YCwgaS5lLiBzZWNvbmRzLg0KICAgIC8vL0BwYXJhbSBfZXhwaXJlT24gLSBvZmZlciBjYW4ndCBiZSBhY2NlcHRlZCBhZnRlciB0aGlzIHRpbWUuDQogICAgLy8vQHBhcmFtIF9vZmZlckxpbWl0IC0gaG93IG1hbnkgc3Vic2NyaXB0aW9uIGFyZSBhdmFpbGFibGUgdG8gY3JlYXRlZCBmcm9tIHRoaXMgb2ZmZXI7IHRoZXJlIGlzIG5vIG1hZ2ljIG51bWJlciBmb3IgdW5saW1pdGVkIG9mZmVyIC0tIHVzZSBiaWcgbnVtYmVyIGluc3RlYWQuDQogICAgLy8vQHBhcmFtIF9kZXBvc2l0QW1vdW50IC0gdXBmcm9udCBkZXBvc2l0IHJlcXVpcmVkIGZvciBjcmVhdGluZyBhIHN1YnNjcmlwdGlvbjsgdGhpcyBkZXBvc2l0IGJlY29tZXMgZnVsbHkgcmV0dXJuZWQgb24gc3Vic2NyaXB0aW9uIGlzIG92ZXIuDQogICAgLy8vICAgICAgIGN1cnJlbnRseSB0aGlzIGRlcG9zaXQgaXMgbm90IHN1YmplY3Qgb2YgcGxhdGZvcm0gZmVlcyBhbmQgd2lsbCBiZSByZWZ1bmRlZCBpbiBmdWxsLiBOZXh0IHZlcnNpb25zIG9mIHRoaXMgbW9kdWxlIGNhbiB1c2UgZGVwb3NpdCBpbiBjYXNlIG9mIG91dHN0YW5kaW5nIHBheW1lbnRzLg0KICAgIC8vL0BwYXJhbSBfc3RhcnRPbiAtIGEgc3Vic2NyaXB0aW9uIGZyb20gdGhpcyBvZmZlciBjYW4ndCBiZSBjcmVhdGVkIGJlZm9yZSB0aGlzIHRpbWUuIFRpbWUgdW5pdHMgYXJlIG5hdGl2ZSBldGhlcmV1bSB0aW1lLCByZXR1cm5pbmcgYnkgYG5vd2AsIGkuZS4gc2Vjb25kcy4NCiAgICAvLy9AcGFyYW0gX2Rlc2NyaXB0b3IgLSBhcmJpdHJhcnkgYnl0ZXMgYXMgYW4gb2ZmZXIgZGVzY3JpcHRvci4gVGhpcyBkZXNjcmlwdG9yIGlzIGNvcGllZCBpbnRvIHN1YnNjcmlwdGlvbiBhbmQgdGhlbiBzZXJ2aWNlIHByb3ZpZGVyIGJlY29tZXMgaXQgcGFzc2VkIGluIG5vdGlmaWNhdGlvbnMuDQogICAgLy8NCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb25PZmZlcih1aW50IF9wcmljZVBlckhvdXIsIHVpbnQxNiBfeHJhdGVQcm92aWRlcklkLCB1aW50IF9jaGFyZ2VQZXJpb2QsIHVpbnQgX2V4cGlyZU9uLCB1aW50IF9vZmZlckxpbWl0LCB1aW50IF9kZXBvc2l0QW1vdW50LCB1aW50IF9zdGFydE9uLCBieXRlcyBfZGVzY3JpcHRvcikNCiAgICBwdWJsaWMNCiAgICBub1JlZW50cmFuY3koTDAxKQ0KICAgIG9ubHlSZWdpc3RlcmVkUHJvdmlkZXINCiAgICByZXR1cm5zICh1aW50IHN1YklkKSB7DQogICAgICAgIGFzc2VydCAoX3N0YXJ0T24gPCBfZXhwaXJlT24pOw0KICAgICAgICBhc3NlcnQgKF9jaGFyZ2VQZXJpb2QgPD0gMTAgeWVhcnMpOyAvL3Nhbml0eSBjaGVjaw0KICAgICAgICB2YXIgKF94cmF0ZV9uLCBfeHJhdGVfZCkgPSBfeHJhdGVQcm92aWRlcklkID09IDANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gKDEsMSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogWFJhdGVQcm92aWRlcih4cmF0ZVByb3ZpZGVyc1tfeHJhdGVQcm92aWRlcklkXSkuZ2V0UmF0ZSgpOyAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kNCiAgICAgICAgYXNzZXJ0IChfeHJhdGVfbiA+IDAgJiYgX3hyYXRlX2QgPiAwKTsNCiAgICAgICAgc3Vic2NyaXB0aW9uc1srK3N1YnNjcmlwdGlvbkNvdW50ZXJdID0gU3Vic2NyaXB0aW9uICh7DQogICAgICAgICAgICB0cmFuc2ZlckZyb20gICAgOiAwLCAgICAgICAgICAgICAgICAgIC8vIGVtcHR5IHRyYW5zZmVyRnJvbSBmaWVsZCBtZWFucyB3ZSBoYXZlIGFuIG9mZmVyLCBub3QgYSBzdWJzY3JpcHRpb24NCiAgICAgICAgICAgIHRyYW5zZmVyVG8gICAgICA6IG1zZy5zZW5kZXIsICAgICAgICAgLy8gc2VydmljZSBwcm92aWRlciBpcyBhIGJlbmVmaWNpYXJ5IG9mIHN1YnNjcmlwdG9uIHBheW1lbnRzDQogICAgICAgICAgICBwcmljZVBlckhvdXIgICAgOiBfcHJpY2VQZXJIb3VyLCAgICAgIC8vIHByaWNlIHBlciBob3VyIGluIFNBTiAocmVjYWxjdWxhdGVkIGZyb20gYmFzZSBjdXJyZW5jeSBpZiBuZWVkZWQpDQogICAgICAgICAgICB4cmF0ZVByb3ZpZGVySWQgOiBfeHJhdGVQcm92aWRlcklkLCAgIC8vIGlkIG9mIHJlZ2lzdGVyZWQgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlciBvciB6ZXJvIGlmIGFuIG9mZmVyIGlzIG5vbWluYXRlZCBpbiBTQU4uDQogICAgICAgICAgICBpbml0aWFsWHJhdGVfbiAgOiBfeHJhdGVfbiwgICAgICAgICAgIC8vIGZyYWN0aW9uIG5vbWluYXRvciBvZiB0aGUgaW5pdGlhbCBleGNoYW5nZSByYXRlDQogICAgICAgICAgICBpbml0aWFsWHJhdGVfZCAgOiBfeHJhdGVfZCwgICAgICAgICAgIC8vIGZyYWN0aW9uIGRlbm9taW5hdG9yIG9mIHRoZSBpbml0aWFsIGV4Y2hhbmdlIHJhdGUNCiAgICAgICAgICAgIHBhaWRVbnRpbCAgICAgICA6IDAsICAgICAgICAgICAgICAgICAgLy8gc2VydmljZSBpcyBjb25zaWRlcmVkIHRvIGJlIHBhaWQgdW50aWwgdGhpcyB0aW1lOyBubyBjaGFyZ2UgaXMgcG9zc2libGUgd2hpbGUgc3Vic2NyaXB0aW9uIGlzIHBhaWQgZm9yIG5vdy4NCiAgICAgICAgICAgIGNoYXJnZVBlcmlvZCAgICA6IF9jaGFyZ2VQZXJpb2QsICAgICAgLy8gcGVyaW9kIGluIHNlY29uZHMgKGV0aGVyZXVtIGJsb2NrIHRpbWUgdW5pdCkgdG8gY2hhcmdlLg0KICAgICAgICAgICAgZGVwb3NpdEFtb3VudCAgIDogX2RlcG9zaXRBbW91bnQsICAgICAvLyBkZXBvc2l0IHJlcXVpcmVkIGZvciBzdWJzY3JpcHRpb24gYWNjZXB0Lg0KICAgICAgICAgICAgc3RhcnRPbiAgICAgICAgIDogX3N0YXJ0T24sDQogICAgICAgICAgICBleHBpcmVPbiAgICAgICAgOiBfZXhwaXJlT24sDQogICAgICAgICAgICBleGVjQ291bnRlciAgICAgOiBfb2ZmZXJMaW1pdCwNCiAgICAgICAgICAgIGRlc2NyaXB0b3IgICAgICA6IF9kZXNjcmlwdG9yLA0KICAgICAgICAgICAgb25Ib2xkU2luY2UgICAgIDogMCAgICAgICAgICAgICAgICAgICAvLyBvZmZlciBpcyBub3Qgb24gaG9sZCBieSBkZWZhdWx0Lg0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbkNvdW50ZXI7ICAgICAgICAgICAgICAgLy8gcmV0dXJucyBhbiBpZCBvZiB0aGUgbmV3IG9mZmVyLg0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSB1cGRhdGVzIGN1cnJlbnRseSBhdmFpbGFibGUgbnVtYmVyIG9mIHN1YnNjcmlwdGlvbiBmb3IgdGhpcyBvZmZlci4NCiAgICAvLy8gICAgICAgIE90aGVyIG9mZmVyJ3MgcGFyYW1ldGVyIGNhbid0IGJlIHVwZGF0ZWQgYmVjYXVzZSB0aGV5IGFyZSBjb25zaWRlcmVkIHRvIGJlIGEgcHVibGljIG9mZmVyIHJldmlld2VkIGJ5IGN1c3RvbWVycy4NCiAgICAvLy8gICAgICAgIFRoZSBzZXJ2aWNlIHByb3ZpZGVyIHNob3VsZCByZWNyZWF0ZSB0aGUgb2ZmZXIgYXMgYSBuZXcgb25lIGluIGNhc2Ugb2Ygb3RoZXIgY2hhbmdlcy4NCiAgICAvLw0KICAgIGZ1bmN0aW9uIHVwZGF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgX29mZmVySWQsIHVpbnQgX29mZmVyTGltaXQpIHB1YmxpYyB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tfb2ZmZXJJZF07DQogICAgICAgIGFzc2VydCAoX2lzT2ZmZXIob2ZmZXIpKTsNCiAgICAgICAgYXNzZXJ0IChvZmZlci50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIpOyAvL29ubHkgUHJvdmlkZXIgaXMgYWxsb3dlZCB0byB1cGRhdGUgdGhlIG9mZmVyLg0KICAgICAgICBvZmZlci5leGVjQ291bnRlciA9IF9vZmZlckxpbWl0Ow0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBhY2NlcHQgZ2l2ZW4gb2ZmZXIgYW5kIGNyZWF0ZSBhIG5ldyBzdWJzY3JpcHRpb24gb24gdGhlIGJhc2Ugb2YgaXQuDQogICAgLy8vDQogICAgLy8vQGRldiB0aGUgc2VydmljZSBwcm92aWRlciAob2ZmZXIuYHRyYW5zZmVyVG9gKSBiZWNvbWVzIG5vdGlmaWVkIGFib3V0IG5ldyBzdWJzY3JpcHRpb24gYnkgY2FsbCBgb25TdWJOZXcobmV3U3ViSWQsIF9vZmZlcklkKWAuDQogICAgLy8vICAgICBJdCBpcyBwcm92aWRlcidzIHJlc3BvbnNpYmlsaXR5IHRvIHJldHJpZXZlIGFuZCBzdG9yZSBhbnkgbmVjZXNzYXJ5IGluZm9ybWF0aW9uIGFib3V0IG9mZmVyIGFuZCB0aGlzIG5ldyBzdWJzY3JpcHRpb24uIFNvbWUgb2YgaW5mbyBpcyBvbmx5IGF2YWlsYWJsZSBhdCB0aGlzIHBvaW50Lg0KICAgIC8vLyAgICAgVGhlIFNlcnZpY2UgUHJvdmlkZXIgY2FuIGFsc28gcmVqZWN0IHRoZSBuZXcgc3Vic2NyaXB0aW9uIGJ5IHRocm93aW5nIGFuIGV4Y2VwdGlvbiBvciByZXR1cm5pbmcgYGZhbHNlYCBmcm9tIGBvblN1Yk5ldyhuZXdTdWJJZCwgX29mZmVySWQpYCBldmVudCBoYW5kbGVyLg0KICAgIC8vL0BwYXJhbSBfb2ZmZXJJZCAgIC0gaWQgb2YgdGhlIG9mZmVyIHRvIGJlIGFjY2VwdGVkDQogICAgLy8vQHBhcmFtIF9leHBpcmVPbiAgLSBzdWJzY3JpcHRpb24gZXhwaXJhdGlvbiB0aW1lOyBubyBjaGFyZ2VzIGFyZSBwb3NzaWJsZSBiZWhpbmQgdGhpcyB0aW1lLg0KICAgIC8vL0BwYXJhbSBfc3RhcnRPbiAgIC0gc3Vic2NyaXB0aW9uIHN0YXJ0IHRpbWU7IG5vIGNoYXJnZXMgYXJlIHBvc3NpYmxlIGJlZm9yZSB0aGlzIHRpbWUuDQogICAgLy8vICAgICAgICAgICAgICAgICAgICBJZiB0aGUgYF9zdGFydE9uYCBpcyBpbiB0aGUgcGFzdCBvciBpcyB6ZXJvLCBpdCBtZWFucyBzdGFydCB0aGUgc3Vic2NyaXB0aW9uIEFTQVAuDQogICAgLy8NCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb24odWludCBfb2ZmZXJJZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX3N0YXJ0T24pIHB1YmxpYyBub1JlZW50cmFuY3koTDAyKSByZXR1cm5zICh1aW50IG5ld1N1YklkKSB7DQogICAgICAgIGFzc2VydCAoX3N0YXJ0T24gPCBfZXhwaXJlT24pOw0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbX29mZmVySWRdOw0KICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7DQogICAgICAgIGFzc2VydCAob2ZmZXIuc3RhcnRPbiA9PSAwICAgICB8fCBvZmZlci5zdGFydE9uICA8PSBub3cpOw0KICAgICAgICBhc3NlcnQgKG9mZmVyLmV4cGlyZU9uID09IDAgICAgfHwgb2ZmZXIuZXhwaXJlT24gPj0gbm93KTsNCiAgICAgICAgYXNzZXJ0IChvZmZlci5vbkhvbGRTaW5jZSA9PSAwKTsNCiAgICAgICAgYXNzZXJ0IChvZmZlci5leGVjQ291bnRlciA+IDApOw0KICAgICAgICAtLW9mZmVyLmV4ZWNDb3VudGVyOw0KICAgICAgICBuZXdTdWJJZCA9ICsrc3Vic2NyaXB0aW9uQ291bnRlcjsNCiAgICAgICAgLy9jcmVhdGUgYSBjbG9uZSBvZiB0aGUgb2ZmZXIuLi4NCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2UgbmV3U3ViID0gc3Vic2NyaXB0aW9uc1tuZXdTdWJJZF0gPSBvZmZlcjsNCiAgICAgICAgLy8uLi4gYW5kIGFkanVzdCBzb21lIGZpZWxkcyBzcGVjaWZpYyB0byBzdWJzY3JpcHRpb24NCiAgICAgICAgbmV3U3ViLnRyYW5zZmVyRnJvbSA9IG1zZy5zZW5kZXI7DQogICAgICAgIG5ld1N1Yi5leGVjQ291bnRlciA9IDA7DQogICAgICAgIG5ld1N1Yi5wYWlkVW50aWwgPSBuZXdTdWIuc3RhcnRPbiA9IG1heChfc3RhcnRPbiwgbm93KTsgICAgIC8vbm8gZGVidHMgYmVmb3JlIGFjdHVhbCBjcmVhdGlvbiB0aW1lIQ0KICAgICAgICBuZXdTdWIuZXhwaXJlT24gPSBfZXhwaXJlT247DQogICAgICAgIG5ld1N1Yi5kZXBvc2l0QW1vdW50ID0gX2FwcGx5WGNoYW5nZVJhdGUobmV3U3ViLmRlcG9zaXRBbW91bnQsIG5ld1N1Yik7ICAgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kNCiAgICAgICAgLy9kZXBvc2l0QW1vdW50IGlzIG5vdyBzdG9yZWQgaW4gdGhlIHN1Yiwgc28gYnVybiB0aGUgc2FtZSBhbW91bnQgZnJvbSBjdXN0b21lcidzIGFjY291bnQuDQogICAgICAgIGFzc2VydCAoc2FuLl9idXJuRm9yRGVwb3NpdChtc2cuc2VuZGVyLCBuZXdTdWIuZGVwb3NpdEFtb3VudCkpOw0KICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihuZXdTdWIudHJhbnNmZXJUbykub25TdWJOZXcobmV3U3ViSWQsIF9vZmZlcklkKSk7ICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5OyBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBzdGlsbCByZWplY3QgdGhlIG5ldyBzdWJzY3JpcHRpb24gaGVyZQ0KDQogICAgICAgIE5ld1N1YnNjcmlwdGlvbihuZXdTdWIudHJhbnNmZXJGcm9tLCBuZXdTdWIudHJhbnNmZXJUbywgX29mZmVySWQsIG5ld1N1YklkKTsNCiAgICAgICAgcmV0dXJuIG5ld1N1YklkOw0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjYW5jZWwgYW4gb2ZmZXIgZ2l2ZW4gYnkgYG9mZmVySWRgLg0KICAgIC8vL0BkZXYgc2V0cyBvZmZlci5gZXhwaXJlT25gIHRvIGBleHBpcmVPbmAuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tvZmZlcklkXTsNCiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOw0KICAgICAgICBhc3NlcnQgKG9mZmVyLnRyYW5zZmVyVG8gPT0gbXNnLnNlbmRlciB8fCBvd25lciA9PSBtc2cuc2VuZGVyKTsgLy9vbmx5IHNlcnZpY2UgcHJvdmlkZXIgb3IgcGxhdGZvcm0gb3duZXIgaXMgYWxsb3dlZCB0byBjYW5jZWwgdGhlIG9mZmVyDQogICAgICAgIGlmIChvZmZlci5leHBpcmVPbj5ub3cpew0KICAgICAgICAgICAgb2ZmZXIuZXhwaXJlT24gPSBub3c7DQogICAgICAgICAgICBPZmZlckNhbmNlbGVkKG9mZmVySWQsIG1zZy5zZW5kZXIpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjYW5jZWwgYW4gc3Vic2NyaXB0aW9uIGdpdmVuIGJ5IGBzdWJJZGAgKGEgZ3JhY2VmdWwgdmVyc2lvbikuDQogICAgLy8vQG5vdGljZSBJTVBPUlRBTlQ6IGEgbWFsaWNpb3VzIHNlcnZpY2UgcHJvdmlkZXIgY2FuIGNvbnN1bWUgYWxsIGdhcyBhbmQgcHJldmVudGluZyBzdWJzY3JpcHRpb24gZnJvbSBjYW5jZWxsYXRpb24uDQogICAgLy8vICAgICAgICBJZiBzbywgdXNlIGBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKWAgYXMgdGhlIGZvcmNlZCB2ZXJzaW9uLg0KICAgIC8vLyAgICAgICAgIHNlZSBgY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSlgIGZvciBtb3JlIGRvY3VtZW50YXRpb24uDQogICAgLy8NCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHsNCiAgICAgICAgcmV0dXJuIGNhbmNlbFN1YnNjcmlwdGlvbihzdWJJZCwgMCk7DQogICAgfQ0KDQoNCiAgICAvLy9Abm90aWNlIGNhbmNlbCBhbiBzdWJzY3JpcHRpb24gZ2l2ZW4gYnkgYHN1YklkYCAoYSBmb3JjZWQgdmVyc2lvbikuDQogICAgLy8vICAgICAgICBDYW5jZWxsYXRpb24gbWVhbnMgbm8gZnVydGhlciBjaGFyZ2VzIHRvIHRoaXMgc3Vic2NyaXB0aW9uIGFyZSBwb3NzaWJsZS4gVGhlIHByb3ZpZGVkIHN1YnNjcmlwdGlvbiBkZXBvc2l0IGNhbiBiZSB3aXRoZHJhd24gb25seSBgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3Zlci4NCiAgICAvLy8gICAgICAgIERlcGVuZGluZyBvbiBuYXR1cmUgb2YgdGhlIHNlcnZpY2UgcHJvdmlkZWQsIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBhbGxvdyBhbiBpbW1lZGlhdGUgZGVwb3NpdCB3aXRoZHJhd2FsIGJ5IGByZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkKWAgY2FsbCwgYnV0IGl0cyBvbiBoaXMgb3duLg0KICAgIC8vLyAgICAgICAgSW4gc29tZSBidXNpbmVzcyBjYXNlcyBhIGRlcG9zaXQgbXVzdCByZW1haW4gbG9ja2VkIHVudGlsIGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyIGV2ZW4sIHRoZSBzdWJzY3JpcHRpb24gaXMgYWxyZWFkeSBjYW5jZWxlZC4NCiAgICAvLy9Abm90aWNlIGdhc1Jlc2VydmUgaXMgYSBnYXMgYW1vdW50IHJlc2VydmVkIGZvciBjb250cmFjdCBleGVjdXRpb24gQUZURVIgc2VydmljZSBwcm92aWRlciBiZWNvbWVzIGBvblN1YkNhbmNlbGVkKHVpbnQyNTYsYWRkcmVzcylgIG5vdGlmaWNhdGlvbi4NCiAgICAvLy8gICAgICAgIEl0IGd1YXJhbnRlZXMsIHRoYXQgY2FuY2VsbGF0aW9uIGJlY29tZXMgZXhlY3V0ZWQgZXZlbiBhIChtYWxpY2lvdXMpIHNlcnZpY2UgcHJvdmlkZXIgY29uc3VtZXMgYWxsIGdhcyBwcm92aWRlZC4NCiAgICAvLy8gICAgICAgIElmIHNvLCB1c2UgYGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkLCB1aW50IGdhc1Jlc2VydmUpYCBhcyB0aGUgZm9yY2VkIHZlcnNpb24uDQogICAgLy8vICAgICAgICBUaGlzIGRpZmZlcmVuY2UgaXMgYmVjYXVzZSB0aGUgY3VzdG9tZXIgbXVzdCBhbHdheXMgaGF2ZSBhIHBvc3NpYmlsaXR5IHRvIGNhbmNlbCBoaXMgY29udHJhY3QgZXZlbiB0aGUgc2VydmljZSBwcm92aWRlciBkaXNhZ3JlZSBvbiBjYW5jZWxsYXRpb24uDQogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIHRvIGJlIGNhbmNlbGxlZA0KICAgIC8vL0BwYXJhbSBnYXNSZXNlcnZlIC0gZ2FzIHJlc2VydmVkIGZvciBjYWxsIGZpbmFsaXphdGlvbiAobWluaW11bSByZXNlcnZhdGlvbiBpcyAxMDAwMCBnYXMpDQogICAgLy8NCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKSBwdWJsaWMgbm9SZWVudHJhbmN5KEwwMykgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsNCiAgICAgICAgYXNzZXJ0IChzdWIudHJhbnNmZXJGcm9tID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzdWJzY3JpcHRpb24gb3duZXIgb3IgcGxhdGZvcm0gb3duZXIgaXMgYWxsb3dlZCB0byBjYW5jZWwgaXQNCiAgICAgICAgYXNzZXJ0IChfaXNTdWJzY3JpcHRpb24oc3ViKSk7DQogICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsNCiAgICAgICAgc3ViLmV4cGlyZU9uID0gbWF4KG5vdywgc3ViLnBhaWRVbnRpbCk7DQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IF90bykgew0KICAgICAgICAgICAgLy9zdXByZXNzIHJlLXRocm93aW5nIG9mIGV4Y2VwdGlvbnM7IHJlc2VydmUgZW5vdWdoIGdhcyB0byBmaW5pc2ggdGhpcyBmdW5jdGlvbg0KICAgICAgICAgICAgZ2FzUmVzZXJ2ZSA9IG1heChnYXNSZXNlcnZlLDEwMDAwKTsgIC8vcmVzZXJ2ZSBtaW5pbXVtIDEwMDAwIGdhcw0KICAgICAgICAgICAgYXNzZXJ0IChtc2cuZ2FzID4gZ2FzUmVzZXJ2ZSk7ICAgICAgIC8vc2FuaXR5IGNoZWNrDQogICAgICAgICAgICBpZiAoX3RvLmNhbGwuZ2FzKG1zZy5nYXMtZ2FzUmVzZXJ2ZSkoYnl0ZXM0KHNoYTMoIm9uU3ViQ2FuY2VsZWQodWludDI1NixhZGRyZXNzKSIpKSwgc3ViSWQsIG1zZy5zZW5kZXIpKSB7ICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kNCiAgICAgICAgICAgICAgICAvL2RvIG5vdGhpbmcuIGl0IGlzIG5vdGlmaWNhdGlvbiBvbmx5Lg0KICAgICAgICAgICAgICAgIC8vTGF0ZXI6IGlzIGl0IHBvc3NpYmxlIHRvIGV2YWx1YXRlIHJldHVybiB2YWx1ZSBoZXJlPyBJZiBpcyBiZXR0ZXIgdG8gcmV0dXJuIHRoZSBzdWJzY3JpcHRpb24gZGVwb3NpdCBoZXJlLg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIFN1YkNhbmNlbGVkKHN1YklkLCBtc2cuc2VuZGVyKTsNCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgcGxhY2UgYW4gYWN0aXZlIG9mZmVyIG9uIGhvbGQ7IGl0IG1lYW5zIG5vIHN1YnNjcmlwdGlvbnMgY2FuIGJlIGNyZWF0ZWQgZnJvbSB0aGlzIG9mZmVyLg0KICAgIC8vLyAgICAgICAgT25seSBzZXJ2aWNlIHByb3ZpZGVyIChvciBwbGF0Zm9ybSBvd25lcikgaXMgYWxsb3dlZCB0byBob2xkL3VuaG9sZCBhIHN1YnNjcmlwdGlvbiBvZmZlci4NCiAgICAvLy9AcGFyYW0gb2ZmZXJJZCAtIGlkIG9mIHRoZSBvZmZlciB0byBiZSBwbGFjZWQgb24gaG9sZC4NCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW29mZmVySWRdOw0KICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7DQogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb2ZmZXIudHJhbnNmZXJUbyB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsgLy9vbmx5IG93bmVyIG9yIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHBsYWNlIHRoZSBvZmZlciBvbiBob2xkLg0KICAgICAgICBpZiAob2ZmZXIub25Ib2xkU2luY2UgPT0gMCkgew0KICAgICAgICAgICAgb2ZmZXIub25Ib2xkU2luY2UgPSBub3c7DQogICAgICAgICAgICBPZmZlck9uSG9sZChvZmZlcklkLCB0cnVlLCBtc2cuc2VuZGVyKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0NCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgcmVzdW1lIG9uLWhvbGQgb2ZmZXI7IHN1YnNjcmlwdGlvbnMgY2FuIGJlIGNyZWF0ZWQgZnJvbSB0aGlzIG9mZmVyIGFnYWluIChpZiBvdGhlciBjb25kaXRpb25zIGFyZSBtZXQpLg0KICAgIC8vLyAgICAgICAgT25seSBzZXJ2aWNlIHByb3ZpZGVyIChvciBwbGF0Zm9ybSBvd25lcikgaXMgYWxsb3dlZCB0byBob2xkL3VuaG9sZCBhIHN1YnNjcmlwdGlvbiBvZmZlci4NCiAgICAvLy9AcGFyYW0gb2ZmZXJJZCAtIGlkIG9mIHRoZSBvZmZlciB0byBiZSByZXN1bWVkLg0KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQ0KICAgIC8vDQogICAgZnVuY3Rpb24gdW5ob2xkU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tvZmZlcklkXTsNCiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOw0KICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IG9mZmVyLnRyYW5zZmVyVG8gfHwgbXNnLnNlbmRlciA9PSBvd25lcik7IC8vb25seSBvd25lciBvciBzZXJ2aWNlIHByb3ZpZGVyIGNhbiByZWFjdGl2YXRlIHRoZSBvZmZlci4NCiAgICAgICAgaWYgKG9mZmVyLm9uSG9sZFNpbmNlID4gMCkgew0KICAgICAgICAgICAgb2ZmZXIub25Ib2xkU2luY2UgPSAwOw0KICAgICAgICAgICAgT2ZmZXJPbkhvbGQob2ZmZXJJZCwgZmFsc2UsIG1zZy5zZW5kZXIpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb3Igc2VydmljZSBwcm92aWRlciB0byBwbGFjZSBhIHN1YnNjcmlwdGlvbiBvbiBob2xkLg0KICAgIC8vLyAgICAgICAgSWYgY2FsbCBpcyBvcmlnaW5hdGVkIGJ5IGN1c3RvbWVyIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGNhbiByZWplY3QgdGhlIHJlcXVlc3QuDQogICAgLy8vICAgICAgICBBIHN1YnNjcmlwdGlvbiBvbiBob2xkIHdpbGwgbm90IGJlIGNoYXJnZWQuIFRoZSBzZXJ2aWNlIGlzIHVzdWFsbHkgbm90IHByb3ZpZGVkIGFzIHdlbGwuDQogICAgLy8vICAgICAgICBEdXJpbmcgaG9sZCB0aW1lIGEgc3Vic2NyaXB0aW9uIHByZXNlcnZlIHJlbWFpbmluZyBwYWlkIHRpbWUgcGVyaW9kLCB3aGljaCBiZWNvbWVzIGF2YWlsYWJsZSBhZnRlciB1bmhvbGQuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiBob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub1JlZW50cmFuY3koTDA0KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07DQogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOw0KICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87DQogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gX3RvIHx8IG1zZy5zZW5kZXIgPT0gc3ViLnRyYW5zZmVyRnJvbSk7IC8vb25seSBjdXN0b21lciBvciBwcm92aWRlciBjYW4gcGxhY2UgdGhlIHN1YnNjcmlwdGlvbiBvbiBob2xkLg0KICAgICAgICBpZiAoc3ViLm9uSG9sZFNpbmNlID09IDApIHsNCiAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyID09IF90byB8fCBTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblN1YlVuSG9sZChzdWJJZCwgbXNnLnNlbmRlciwgdHJ1ZSkpIHsgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5DQogICAgICAgICAgICAgICAgc3ViLm9uSG9sZFNpbmNlID0gbm93Ow0KICAgICAgICAgICAgICAgIFN1Yk9uSG9sZChzdWJJZCwgdHJ1ZSwgbXNnLnNlbmRlcik7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb3Igc2VydmljZSBwcm92aWRlciB0byB1bmhvbGQgc3Vic2NyaXB0aW9uLg0KICAgIC8vLyAgICAgICAgSWYgY2FsbCBpcyBvcmlnaW5hdGVkIGJ5IGN1c3RvbWVyIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGNhbiByZWplY3QgdGhlIHJlcXVlc3QuDQogICAgLy8vICAgICAgICBBIHN1YnNjcmlwdGlvbiBvbiBob2xkIHdpbGwgbm90IGJlIGNoYXJnZWQuIFRoZSBzZXJ2aWNlIGlzIHVzdWFsbHkgbm90IHByb3ZpZGVkIGFzIHdlbGwuDQogICAgLy8vICAgICAgICBEdXJpbmcgaG9sZCB0aW1lIGEgc3Vic2NyaXB0aW9uIHByZXNlcnZlIHJlbWFpbmluZyBwYWlkIHRpbWUgcGVyaW9kLCB3aGljaCBiZWNvbWVzIGF2YWlsYWJsZSBhZnRlciB1bmhvbGQuDQogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpDQogICAgLy8NCiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vUmVlbnRyYW5jeShMMDUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsNCiAgICAgICAgYXNzZXJ0IChfaXNTdWJzY3JpcHRpb24oc3ViKSk7DQogICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsNCiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBfdG8gfHwgbXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJGcm9tKTsgLy9vbmx5IGN1c3RvbWVyIG9yIHByb3ZpZGVyIGNhbiBwbGFjZSB0aGUgc3Vic2NyaXB0aW9uIG9uIGhvbGQuDQogICAgICAgIGlmIChzdWIub25Ib2xkU2luY2UgPiAwKSB7DQogICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBfdG8gfHwgU2VydmljZVByb3ZpZGVyKF90bykub25TdWJVbkhvbGQoc3ViSWQsIG1zZy5zZW5kZXIsIGZhbHNlKSkgeyAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQ0KICAgICAgICAgICAgICAgIHN1Yi5wYWlkVW50aWwgKz0gbm93IC0gc3ViLm9uSG9sZFNpbmNlOw0KICAgICAgICAgICAgICAgIHN1Yi5vbkhvbGRTaW5jZSA9IDA7DQogICAgICAgICAgICAgICAgU3ViT25Ib2xkKHN1YklkLCBmYWxzZSwgbXNnLnNlbmRlcik7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9DQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQ0KICAgIH0NCg0KDQoNCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogICAgLy8gKiAgICAgICAgICAgICAgZGVwb3NpdCBoYW5kbGluZyAgICAgICAgICAgICAgICAgKg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KICAgIC8vL0Bub3RpY2UgY2FuIGJlIGNhbGxlZCBieSBwcm92aWRlciBvbiBDQU5DRUxFRCBzdWJzY3JpcHRpb24gdG8gcmV0dXJuIGEgc3Vic2NyaXB0aW9uIGRlcG9zaXQgdG8gY3VzdG9tZXIgaW1tZWRpYXRlbHkuDQogICAgLy8vICAgICAgICBDdXN0b21lciBjYW4gYW55d2F5IGNvbGxlY3QgaGlzIGRlcG9zaXQgYWZ0ZXIgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIuDQogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIGhvbGRpbmcgdGhlIGRlcG9zaXQNCiAgICAvLw0KICAgIGZ1bmN0aW9uIHJldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYyB7DQogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOw0KICAgICAgICBhc3NlcnQgKF9zdWJzY3JpcHRpb25TdGF0ZShzdWIpID09IFN1YlN0YXRlLkNBTkNFTEVEKTsNCiAgICAgICAgYXNzZXJ0IChzdWIuZGVwb3NpdEFtb3VudCA+IDApOyAvL3Nhbml0eSBjaGVjaw0KICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzdWJzY3JpcHRpb24gb3duZXIgb3IgcGxhdGZvcm0gb3duZXIgaXMgYWxsb3dlZCB0byByZWxlYXNlIGRlcG9zaXQuDQogICAgICAgIHN1Yi5leHBpcmVPbiA9IG5vdzsNCiAgICAgICAgX3JldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHN1YklkLCBzdWIpOw0KICAgIH0NCg0KDQogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb24gRVhQSVJFRCBzdWJzY3JpcHRpb24gKGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyKSB0byBjb2xsZWN0IGEgc3Vic2NyaXB0aW9uIGRlcG9zaXQuDQogICAgLy8vICAgICAgICBDdXN0b21lciBjYW4gYW55d2F5IGNvbGxlY3QgaGlzIGRlcG9zaXQgYWZ0ZXIgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIuDQogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIGhvbGRpbmcgdGhlIGRlcG9zaXQNCiAgICAvLw0KICAgIGZ1bmN0aW9uIGNsYWltU3Vic2NyaXB0aW9uRGVwb3NpdCh1aW50IHN1YklkKSBwdWJsaWMgew0KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsNCiAgICAgICAgYXNzZXJ0IChfc3Vic2NyaXB0aW9uU3RhdGUoc3ViKSA9PSBTdWJTdGF0ZS5FWFBJUkVEKTsNCiAgICAgICAgYXNzZXJ0IChzdWIudHJhbnNmZXJGcm9tID09IG1zZy5zZW5kZXIpOw0KICAgICAgICBhc3NlcnQgKHN1Yi5kZXBvc2l0QW1vdW50ID4gMCk7DQogICAgICAgIF9yZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdChzdWJJZCwgc3ViKTsNCiAgICB9DQoNCg0KICAgIC8vQGRldiByZXR1cm5zIHN1YnNjcmlwdGlvbiBkZXBvc2l0IHRvIGN1c3RvbWVyDQogICAgZnVuY3Rpb24gX3JldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQsIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgew0KICAgICAgICB1aW50IGRlcG9zaXRBbW91bnQgPSBzdWIuZGVwb3NpdEFtb3VudDsNCiAgICAgICAgc3ViLmRlcG9zaXRBbW91bnQgPSAwOw0KICAgICAgICBzYW4uX21pbnRGcm9tRGVwb3NpdChzdWIudHJhbnNmZXJGcm9tLCBkZXBvc2l0QW1vdW50KTsNCiAgICAgICAgU3Vic2NyaXB0aW9uRGVwb3NpdFJldHVybmVkKHN1YklkLCBkZXBvc2l0QW1vdW50LCBzdWIudHJhbnNmZXJGcm9tLCBtc2cuc2VuZGVyKTsNCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgY3JlYXRlIHNpbXBsZSB1bmxvY2tlZCBkZXBvc2l0LCByZXF1aXJlZCBieSBzb21lIHNlcnZpY2VzLiBJdCBjYW4gYmUgY29uc2lkZXJlZCBhcyBwcm92ZSBvZiBjdXN0b21lcidzIHN0YWtlLg0KICAgIC8vLyAgICAgICAgVGhpcyBkZXNwb3NpdCBjYW4gYmUgY2xhaW1lZCBiYWNrIGJ5IHRoZSBjdXN0b21lciBhdCBhbnl0aW1lLg0KICAgIC8vLyAgICAgICAgVGhlIHNlcnZpY2UgcHJvdmlkZXIgaXMgcmVzcG9uc2libGUgdG8gY2hlY2sgdGhlIGRlcG9zaXQgYmVmb3JlIHByb3ZpZGluZyB0aGUgc2VydmljZS4NCiAgICAvLy9AcGFyYW0gX3ZhbHVlIC0gbm9uIHplcm8gZGVwb3NpdCBhbW91bnQuDQogICAgLy8vQHBhcmFtIF9kZXNjcmlwdG9yIC0gaXMgYSB1bmlxIGtleSwgdXN1YWxseSBnaXZlbiBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIHRoZSBjdXN0b21lciBpbiBvcmRlciB0byBtYWtlIHRoaXMgZGVwb3NpdCB1bmlxdWUuDQogICAgLy8vICAgICAgICBTZXJ2aWNlIFByb3ZpZGVyIHNob3VsZCByZWplY3QgZGVwb3NpdCB3aXRoIHVua25vd24gZGVzY3JpcHRvciwgYmVjYXVzZSBtb3N0IHByb2JhYmx5IGl0IGlzIGluIHVzZSBmb3Igc29tZSBhbm90aGVyIHNlcnZpY2UuDQogICAgLy8vQHJldHVybiBkZXBvc2l0SWQgLSBhIGhhbmRsZSB0byBjbGFpbSBiYWNrIHRoZSBkZXBvc2l0IGxhdGVyLg0KICAgIC8vDQogICAgZnVuY3Rpb24gY3JlYXRlRGVwb3NpdCh1aW50IF92YWx1ZSwgYnl0ZXMgX2Rlc2NyaXB0b3IpIHB1YmxpYyByZXR1cm5zICh1aW50IGRlcG9zaXRJZCkgew0KICAgICAgICByZXF1aXJlIChfdmFsdWUgPiAwKTsNCiAgICAgICAgYXNzZXJ0IChzYW4uX2J1cm5Gb3JEZXBvc2l0KG1zZy5zZW5kZXIsX3ZhbHVlKSk7DQogICAgICAgIGRlcG9zaXRzWysrZGVwb3NpdENvdW50ZXJdID0gRGVwb3NpdCAoew0KICAgICAgICAgICAgb3duZXIgOiBtc2cuc2VuZGVyLA0KICAgICAgICAgICAgdmFsdWUgOiBfdmFsdWUsDQogICAgICAgICAgICBkZXNjcmlwdG9yIDogX2Rlc2NyaXB0b3INCiAgICAgICAgfSk7DQogICAgICAgIE5ld0RlcG9zaXQoZGVwb3NpdENvdW50ZXIsIF92YWx1ZSwgbXNnLnNlbmRlcik7DQogICAgICAgIHJldHVybiBkZXBvc2l0Q291bnRlcjsNCiAgICB9DQoNCg0KICAgIC8vL0Bub3RpY2UgcmV0dXJuIHByZXZpb3VzbHkgY3JlYXRlZCBkZXBvc2l0IHRvIHRoZSB1c2VyLiBVc2VyIGNhbiBjb2xsZWN0IG9ubHkgb3duIGRlcG9zaXQuDQogICAgLy8vICAgICAgICBUaGUgc2VydmljZSBwcm92aWRlciBpcyByZXNwb25zaWJsZSB0byBjaGVjayB0aGUgZGVwb3NpdCBiZWZvcmUgcHJvdmlkaW5nIHRoZSBzZXJ2aWNlLg0KICAgIC8vL0BwYXJhbSBfZGVwb3NpdElkIC0gYW4gaWQgb2YgdGhlIGRlcG9zaXQgdG8gYmUgY29sbGVjdGVkLg0KICAgIC8vDQogICAgZnVuY3Rpb24gY2xhaW1EZXBvc2l0KHVpbnQgX2RlcG9zaXRJZCkgcHVibGljIHsNCiAgICAgICAgdmFyIGRlcG9zaXQgPSBkZXBvc2l0c1tfZGVwb3NpdElkXTsNCiAgICAgICAgcmVxdWlyZSAoZGVwb3NpdC5vd25lciA9PSBtc2cuc2VuZGVyKTsNCiAgICAgICAgdmFyIHZhbHVlID0gZGVwb3NpdHNbX2RlcG9zaXRJZF0udmFsdWU7DQogICAgICAgIGRlbGV0ZSBkZXBvc2l0c1tfZGVwb3NpdElkXTsNCiAgICAgICAgc2FuLl9taW50RnJvbURlcG9zaXQobXNnLnNlbmRlciwgdmFsdWUpOw0KICAgICAgICBEZXBvc2l0UmV0dXJuZWQoX2RlcG9zaXRJZCwgbXNnLnNlbmRlcik7DQogICAgfQ0KDQoNCg0KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAgICAvLyAqICAgICAgICAgICAgc29tZSBpbnRlcm5hbCBmdW5jdGlvbnMgICAgICAgICAgICAqDQogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgZnVuY3Rpb24gX2Ftb3VudFRvQ2hhcmdlKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgcmVlbnRyYW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIF9hcHBseVhjaGFuZ2VSYXRlKHN1Yi5wcmljZVBlckhvdXIgKiBzdWIuY2hhcmdlUGVyaW9kLCBzdWIpIC8gMSBob3VyczsgICAgICAgLy8gPD09PT0gcmVlbnRyYW50IGZ1bmN0aW9uIHVzYWdlDQogICAgfQ0KDQogICAgZnVuY3Rpb24gX2FwcGx5WGNoYW5nZVJhdGUodWludCBhbW91bnQsIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgcmVlbnRyYW50IHJldHVybnMgKHVpbnQpIHsgIC8vIDw9PSBhY3R1YWxseSBjYWxsZWQgZnJvbSByZWVudHJhbmN5IGd1YXJkZWQgY29udGV4dCBvbmx5IChpLmUuIGV4dGVybmFsbHkgc2VjdXJlZCkNCiAgICAgICAgaWYgKHN1Yi54cmF0ZVByb3ZpZGVySWQgPiAwKSB7DQogICAgICAgICAgICAvLyB4cmF0ZV9uOiBub21pbmF0b3INCiAgICAgICAgICAgIC8vIHhyYXRlX2Q6IGRlbm9taW5hdG9yIG9mIHRoZSBleGNoYW5nZSByYXRlIGZyYWN0aW9uLg0KICAgICAgICAgICAgdmFyICh4cmF0ZV9uLCB4cmF0ZV9kKSA9IFhSYXRlUHJvdmlkZXIoeHJhdGVQcm92aWRlcnNbc3ViLnhyYXRlUHJvdmlkZXJJZF0pLmdldFJhdGUoKTsgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQ0KICAgICAgICAgICAgYW1vdW50ID0gYW1vdW50ICogc3ViLmluaXRpYWxYcmF0ZV9uICogeHJhdGVfZCAvIHN1Yi5pbml0aWFsWHJhdGVfZCAvIHhyYXRlX247DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGFtb3VudDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfaXNPZmZlcihTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpew0KICAgICAgICByZXR1cm4gc3ViLnRyYW5zZmVyRnJvbSA9PSAwICYmIHN1Yi50cmFuc2ZlclRvICE9IDA7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gX2lzU3Vic2NyaXB0aW9uKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7DQogICAgICAgIHJldHVybiBzdWIudHJhbnNmZXJGcm9tICE9IDAgJiYgc3ViLnRyYW5zZmVyVG8gIT0gMDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfZXhpc3RzKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7DQogICAgICAgIHJldHVybiBzdWIudHJhbnNmZXJUbyAhPSAwOyAgIC8vZXhpc3Rpbmcgc3Vic2NyaXB0aW9uIG9yIG9mZmVyIGhhcyBhbHdheXMgdHJhbnNmZXJUbyBzZXQuDQogICAgfQ0KDQogICAgbW9kaWZpZXIgb25seVJlZ2lzdGVyZWRQcm92aWRlcigpew0KICAgICAgICBpZiAoIXByb3ZpZGVyUmVnaXN0cnlbbXNnLnNlbmRlcl0pIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KfSAvL1N1YnNjcmlwdGlvbk1vZHVsZUltcGw='