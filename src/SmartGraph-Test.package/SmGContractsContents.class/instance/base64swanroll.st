base 64 content
base64swanroll
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4yOw0KDQoNCi8vIDxPUkFDTElaRV9BUEk+DQovKg0KQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMDQpDb3B5cmlnaHQgKGMpIDIwMTYgT3JhY2xpemUgTFREDQoNCg0KDQpQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5DQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbA0KaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cw0KdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbA0KY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzDQpmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOg0KDQoNCg0KVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4NCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KDQoNCg0KVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1INCklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLA0KRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4NClRIRSBTT0ZUV0FSRS4NCiovDQoNCnByYWdtYSBzb2xpZGl0eSBeMC40LjA7DQoNCg0KLy9wbGVhc2UgaW1wb3J0IG9yYWNsaXplQVBJX3ByZTAuNC5zb2wgd2hlbiBzb2xpZGl0eSA8IDAuNC4wDQoNCmNvbnRyYWN0IE9yYWNsaXplSSB7DQogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOw0KDQogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCg0KICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCg0KICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KDQogICAgZnVuY3Rpb24gcXVlcnkyX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCg0KICAgIGZ1bmN0aW9uIHF1ZXJ5Tih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04pIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KDQogICAgZnVuY3Rpb24gcXVlcnlOX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04sIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsNCg0KICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcmV0dXJucyAodWludCBfZHNwcmljZSk7DQoNCiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOw0KDQogICAgZnVuY3Rpb24gdXNlQ291cG9uKHN0cmluZyBfY291cG9uKTsNCg0KICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpOw0KDQogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7DQoNCiAgICBmdW5jdGlvbiBzZXRDdXN0b21HYXNQcmljZSh1aW50IF9nYXNQcmljZSk7DQoNCiAgICBmdW5jdGlvbiByYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIHJldHVybnMgKGJ5dGVzMzIpOw0KfQ0KDQoNCmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7DQogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOw0KfQ0KDQoNCmNvbnRyYWN0IHVzaW5nT3JhY2xpemUgew0KICAgIHVpbnQgY29uc3RhbnQgZGF5ID0gNjAgKiA2MCAqIDI0Ow0KDQogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAgKiA2MCAqIDI0ICogNzsNCg0KICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCAqIDYwICogMjQgKiAzMDsNCg0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOw0KDQogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsNCg0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0FuZHJvaWQgPSAweDIwOw0KDQogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTGVkZ2VyID0gMHgzMDsNCg0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05hdGl2ZSA9IDB4RjA7DQoNCiAgICBieXRlIGNvbnN0YW50IHByb29mU3RvcmFnZV9JUEZTID0gMHgwMTsNCg0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsNCg0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsNCg0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF90ZXN0bmV0ID0gMjsNCg0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOw0KDQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsNCg0KICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7DQoNCiAgICBPcmFjbGl6ZUkgb3JhY2xpemU7DQogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgew0KICAgICAgICBpZiAoKGFkZHJlc3MoT0FSKSA9PSAwKSB8fCAoZ2V0Q29kZVNpemUoYWRkcmVzcyhPQVIpKSA9PSAwKSkgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7DQogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOw0KICAgICAgICBfOw0KICAgIH0NCiAgICBtb2RpZmllciBjb3Vwb24oc3RyaW5nIGNvZGUpew0KICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsNCiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsodWludDggbmV0d29ya0lEKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsNCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCkgPiAwKSB7Ly9tYWlubmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKTsNCiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfbWFpbm5ldCIpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSkgPiAwKSB7Ly9yb3BzdGVuIHRlc3RuZXQNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpOw0KICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSkgPiAwKSB7Ly9rb3ZhbiB0ZXN0bmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsNCiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfa292YW4iKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpID4gMCkgey8vcmlua2VieSB0ZXN0bmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KTsNCiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfcmlua2VieSIpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSkgPiAwKSB7Ly9ldGhlcmV1bS1icmlkZ2UNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRikgPiAwKSB7Ly9ldGhlci5jYW1wIGlkZQ0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKSA+IDApIHsvL2Jyb3dzZXItc29saWRpdHkNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7DQogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgew0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3VzZUNvdXBvbihzdHJpbmcgY29kZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgew0KICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOw0KICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOw0KICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7DQogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7DQogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIDIwMDAwMCkgcmV0dXJuIDA7DQogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOw0KICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogZ2FzbGltaXQpIHJldHVybiAwOw0KICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsNCiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsNCiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsNCiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogZ2FzbGltaXQpIHJldHVybiAwOw0KICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogZ2FzbGltaXQpIHJldHVybiAwOw0KICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsNCiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOw0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsNCiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOw0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogZ2FzbGltaXQpIHJldHVybiAwOw0KICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogZ2FzbGltaXQpIHJldHVybiAwOw0KICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsNCiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOw0KICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsNCiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07DQogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOw0KICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsNCiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07DQogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgew0KICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7DQogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOw0KICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsNCiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07DQogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOw0KICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7DQogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsNCiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07DQogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOw0KICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsNCiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107DQogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOw0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX2NiQWRkcmVzcygpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGFkZHJlc3Mpew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuY2JBZGRyZXNzKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldFByb29mVHlwZShwcm9vZlApOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDb25maWcoYnl0ZXMzMiBjb25maWcpIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldENvbmZpZyhjb25maWcpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7DQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQgX3NpemUpIHsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3Mpew0KICAgICAgICBieXRlcyBtZW1vcnkgdG1wID0gYnl0ZXMoX2EpOw0KICAgICAgICB1aW50MTYwIGlhZGRyID0gMDsNCiAgICAgICAgdWludDE2MCBiMTsNCiAgICAgICAgdWludDE2MCBiMjsNCiAgICAgICAgZm9yICh1aW50IGkgPSAyOyBpIDwgMiArIDIgKiAyMDsgaSArPSAyKSB7DQogICAgICAgICAgICBpYWRkciAqPSAyNTY7DQogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsNCiAgICAgICAgICAgIGIyID0gdWludDE2MCh0bXBbaSArIDFdKTsNCiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpICYmIChiMSA8PSAxMDIpKSBiMSAtPSA4NzsNCiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA2NSkgJiYgKGIxIDw9IDcwKSkgYjEgLT0gNTU7DQogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpICYmIChiMSA8PSA1NykpIGIxIC09IDQ4Ow0KICAgICAgICAgICAgaWYgKChiMiA+PSA5NykgJiYgKGIyIDw9IDEwMikpIGIyIC09IDg3Ow0KICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDY1KSAmJiAoYjIgPD0gNzApKSBiMiAtPSA1NTsNCiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA0OCkgJiYgKGIyIDw9IDU3KSkgYjIgLT0gNDg7DQogICAgICAgICAgICBpYWRkciArPSAoYjEgKiAxNiArIGIyKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYWRkcmVzcyhpYWRkcik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3RyQ29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOw0KICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsNCiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsNCiAgICAgICAgaWYgKGIubGVuZ3RoIDwgbWluTGVuZ3RoKSBtaW5MZW5ndGggPSBiLmxlbmd0aDsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQ0KICAgICAgICBpZiAoYVtpXSA8IGJbaV0pDQogICAgICAgIHJldHVybiAtIDE7DQogICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQ0KICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpDQogICAgICAgIHJldHVybiAtIDE7DQogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpDQogICAgICAgIHJldHVybiAxOw0KICAgICAgICBlbHNlDQogICAgICAgIHJldHVybiAwOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHJldHVybnMgKGludCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBuID0gYnl0ZXMoX25lZWRsZSk7DQogICAgICAgIGlmIChoLmxlbmd0aCA8IDEgfHwgbi5sZW5ndGggPCAxIHx8IChuLmxlbmd0aCA+IGgubGVuZ3RoKSkNCiAgICAgICAgcmV0dXJuIC0gMTsNCiAgICAgICAgZWxzZSBpZiAoaC5sZW5ndGggPiAoMiAqKiAxMjggLSAxKSkNCiAgICAgICAgcmV0dXJuIC0gMTsNCiAgICAgICAgZWxzZQ0KICAgICAgICB7DQogICAgICAgICAgICB1aW50IHN1YmluZGV4ID0gMDsNCiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChoW2ldID09IG5bMF0pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCsrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChzdWJpbmRleCA9PSBuLmxlbmd0aCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gLSAxOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYSA9IGJ5dGVzKF9hKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZCA9IGJ5dGVzKF9kKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsNCiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOw0KICAgICAgICBieXRlcyBtZW1vcnkgYmFiY2RlID0gYnl0ZXMoYWJjZGUpOw0KICAgICAgICB1aW50IGsgPSAwOw0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JiLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYltpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JlLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZVtpXTsNCiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsIF9kLCAiIik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsICIiLCAiIik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOw0KICAgIH0NCg0KICAgIC8vIHBhcnNlSW50DQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIHJldHVybiBwYXJzZUludChfYSwgMCk7DQogICAgfQ0KDQogICAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikNCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EsIHVpbnQgX2IpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7DQogICAgICAgIHVpbnQgbWludCA9IDA7DQogICAgICAgIGJvb2wgZGVjaW1hbHMgPSBmYWxzZTsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYnJlc3VsdC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSAmJiAoYnJlc3VsdFtpXSA8PSA1NykpIHsNCiAgICAgICAgICAgICAgICBpZiAoZGVjaW1hbHMpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7DQogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCAqKiBfYjsNCiAgICAgICAgcmV0dXJuIG1pbnQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpew0KICAgICAgICBpZiAoaSA9PSAwKSByZXR1cm4gIjAiOw0KICAgICAgICB1aW50IGogPSBpOw0KICAgICAgICB1aW50IGxlbjsNCiAgICAgICAgd2hpbGUgKGogIT0gMCkgew0KICAgICAgICAgICAgbGVuKys7DQogICAgICAgICAgICBqIC89IDEwOw0KICAgICAgICB9DQogICAgICAgIGJ5dGVzIG1lbW9yeSBic3RyID0gbmV3IGJ5dGVzKGxlbik7DQogICAgICAgIHVpbnQgayA9IGxlbiAtIDE7DQogICAgICAgIHdoaWxlIChpICE9IDApIHsNCiAgICAgICAgICAgIGJzdHJbay0tXSA9IGJ5dGUoNDggKyBpICUgMTApOw0KICAgICAgICAgICAgaSAvPSAxMDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc3RyaW5nKGJzdHIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0cmEyY2JvcihzdHJpbmdbXSBhcnIpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7DQogICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsNCg0KICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgNCiAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOw0KICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOw0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgew0KICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOw0KICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpIC8gMjMgKyAzOw0KICAgICAgICAgICAgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMNCiAgICAgICAgfQ0KICAgICAgICB1aW50IGN0ciA9IDA7DQogICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7DQogICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOw0KDQogICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgew0KICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07DQogICAgICAgICAgICBjdHIrKzsNCiAgICAgICAgfQ0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsNCiAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsNCiAgICAgICAgICAgIGN0cisrOw0KICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7DQogICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdA0KICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4Ow0KICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOw0KICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07DQogICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7DQogICAgICAgICAgICBjdHIrKzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGJhMmNib3IoYnl0ZXNbXSBhcnIpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7DQogICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsNCg0KICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgNCiAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOw0KICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOw0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgew0KICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOw0KICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpIC8gMjMgKyAzOw0KICAgICAgICAgICAgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMNCiAgICAgICAgfQ0KICAgICAgICB1aW50IGN0ciA9IDA7DQogICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7DQogICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOw0KDQogICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgew0KICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07DQogICAgICAgICAgICBjdHIrKzsNCiAgICAgICAgfQ0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsNCiAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsNCiAgICAgICAgICAgIGN0cisrOw0KICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7DQogICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdA0KICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4Ow0KICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOw0KICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOw0KICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07DQogICAgICAgICAgICAgICAgY3RyKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7DQogICAgICAgICAgICBjdHIrKzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzOw0KICAgIH0NCg0KDQogICAgc3RyaW5nIG9yYWNsaXplX25ldHdvcmtfbmFtZTsNCg0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKHN0cmluZyBfbmV0d29ya19uYW1lKSBpbnRlcm5hbCB7DQogICAgICAgIG9yYWNsaXplX25ldHdvcmtfbmFtZSA9IF9uZXR3b3JrX25hbWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX25ldHdvcmtfbmFtZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9uZXdSYW5kb21EU1F1ZXJ5KHVpbnQgX2RlbGF5LCB1aW50IF9uYnl0ZXMsIHVpbnQgX2N1c3RvbUdhc0xpbWl0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsNCiAgICAgICAgaWYgKChfbmJ5dGVzID09IDApIHx8IChfbmJ5dGVzID4gMzIpKSB0aHJvdzsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IG5ieXRlcyA9IG5ldyBieXRlcygxKTsNCiAgICAgICAgbmJ5dGVzWzBdID0gYnl0ZShfbmJ5dGVzKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHVub25jZSA9IG5ldyBieXRlcygzMik7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uS2V5SGFzaCA9IG5ldyBieXRlcygzMik7DQogICAgICAgIGJ5dGVzMzIgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMiA9IG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgbXN0b3JlKHVub25jZSwgMHgyMCkNCiAgICAgICAgbXN0b3JlKGFkZCh1bm9uY2UsIDB4MjApLCB4b3IoYmxvY2toYXNoKHN1YihudW1iZXIsIDEpKSwgeG9yKGNvaW5iYXNlLCB0aW1lc3RhbXApKSkNCiAgICAgICAgbXN0b3JlKHNlc3Npb25LZXlIYXNoLCAweDIwKQ0KICAgICAgICBtc3RvcmUoYWRkKHNlc3Npb25LZXlIYXNoLCAweDIwKSwgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMikNCiAgICAgICAgfQ0KICAgICAgICBieXRlc1szXSBtZW1vcnkgYXJncyA9IFt1bm9uY2UsIG5ieXRlcywgc2Vzc2lvbktleUhhc2hdOw0KICAgICAgICBieXRlczMyIHF1ZXJ5SWQgPSBvcmFjbGl6ZV9xdWVyeShfZGVsYXksICJyYW5kb20iLCBhcmdzLCBfY3VzdG9tR2FzTGltaXQpOw0KICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KHF1ZXJ5SWQsIHNoYTMoYnl0ZXM4KF9kZWxheSksIGFyZ3NbMV0sIHNoYTI1NihhcmdzWzBdKSwgYXJnc1syXSkpOw0KICAgICAgICByZXR1cm4gcXVlcnlJZDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7DQogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPSBjb21taXRtZW50Ow0KICAgIH0NCg0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYnl0ZXMzMikgb3JhY2xpemVfcmFuZG9tRFNfYXJnczsNCg0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYm9vbCkgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWQ7DQoNCiAgICBmdW5jdGlvbiB2ZXJpZnlTaWcoYnl0ZXMzMiB0b3NpZ25oLCBieXRlcyBkZXJzaWcsIGJ5dGVzIHB1YmtleSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7DQogICAgICAgIGJvb2wgc2lnb2s7DQogICAgICAgIGFkZHJlc3Mgc2lnbmVyOw0KDQogICAgICAgIGJ5dGVzMzIgc2lncjsNCiAgICAgICAgYnl0ZXMzMiBzaWdzOw0KDQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdyXyA9IG5ldyBieXRlcygzMik7DQogICAgICAgIHVpbnQgb2Zmc2V0ID0gNCArICh1aW50KGRlcnNpZ1szXSkgLSAweDIwKTsNCiAgICAgICAgc2lncl8gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQsIDMyLCBzaWdyXywgMCk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdzXyA9IG5ldyBieXRlcygzMik7DQogICAgICAgIG9mZnNldCArPSAzMiArIDI7DQogICAgICAgIHNpZ3NfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0ICsgKHVpbnQoZGVyc2lnW29mZnNldCAtIDFdKSAtIDB4MjApLCAzMiwgc2lnc18sIDApOw0KDQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgc2lnciA6PSBtbG9hZChhZGQoc2lncl8sIDMyKSkNCiAgICAgICAgc2lncyA6PSBtbG9hZChhZGQoc2lnc18sIDMyKSkNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI3LCBzaWdyLCBzaWdzKTsNCiAgICAgICAgaWYgKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpIHJldHVybiB0cnVlOw0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyOCwgc2lnciwgc2lncyk7DQogICAgICAgICAgICByZXR1cm4gKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShieXRlcyBwcm9vZiwgdWludCBzaWcyb2Zmc2V0KSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIGJvb2wgc2lnb2s7DQoNCiAgICAgICAgLy8gU3RlcCA2OiB2ZXJpZnkgdGhlIGF0dGVzdGF0aW9uIHNpZ25hdHVyZSwgQVBQS0VZMSBtdXN0IHNpZ24gdGhlIHNlc3Npb25LZXkgZnJvbSB0aGUgY29ycmVjdCBsZWRnZXIgYXBwIChDT0RFSEFTSCkNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzIgPSBuZXcgYnl0ZXModWludChwcm9vZltzaWcyb2Zmc2V0ICsgMV0pICsgMik7DQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldCwgc2lnMi5sZW5ndGgsIHNpZzIsIDApOw0KDQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcHBrZXkxX3B1YmtleSA9IG5ldyBieXRlcyg2NCk7DQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMyArIDEsIDY0LCBhcHBrZXkxX3B1YmtleSwgMCk7DQoNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjIgPSBuZXcgYnl0ZXMoMSArIDY1ICsgMzIpOw0KICAgICAgICB0b3NpZ24yWzBdID0gMTsNCiAgICAgICAgLy9yb2xlDQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldCAtIDY1LCA2NSwgdG9zaWduMiwgMSk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBDT0RFSEFTSCA9IGhleCJmZDk0ZmE3MWJjMGJhMTBkMzlkNDY0ZDBkOGY0NjVlZmVlZjBhMjc2NGUzODg3ZmNjOWRmNDFkZWQyMGY1MDVjIjsNCiAgICAgICAgY29weUJ5dGVzKENPREVIQVNILCAwLCAzMiwgdG9zaWduMiwgMSArIDY1KTsNCiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjIpLCBzaWcyLCBhcHBrZXkxX3B1YmtleSk7DQoNCiAgICAgICAgaWYgKHNpZ29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7DQoNCg0KICAgICAgICAvLyBTdGVwIDc6IHZlcmlmeSB0aGUgQVBQS0VZMSBwcm92ZW5hbmNlIChtdXN0IGJlIHNpZ25lZCBieSBMZWRnZXIpDQogICAgICAgIGJ5dGVzIG1lbW9yeSBMRURHRVJLRVkgPSBoZXgiN2ZiOTU2NDY5YzVjOWI4OTg0MGQ1NWI0MzUzN2U2NmE5OGRkNDgxMWVhMGEyNzIyNDI3MmMyZTU2MjI5MTFlODUzN2EyZjhlODZhNDZiYWVjODI4NjRlOThkZDAxZTljY2MyZjhiYzVkZmM5Y2JlNWE5MWEyOTA0OThkZDk2ZTQiOw0KDQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24zID0gbmV3IGJ5dGVzKDEgKyA2NSk7DQogICAgICAgIHRvc2lnbjNbMF0gPSAweEZFOw0KICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMsIDY1LCB0b3NpZ24zLCAxKTsNCg0KICAgICAgICBieXRlcyBtZW1vcnkgc2lnMyA9IG5ldyBieXRlcyh1aW50KHByb29mWzMgKyA2NSArIDFdKSArIDIpOw0KICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMgKyA2NSwgc2lnMy5sZW5ndGgsIHNpZzMsIDApOw0KDQogICAgICAgIHNpZ29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24zKSwgc2lnMywgTEVER0VSS0VZKTsNCg0KICAgICAgICByZXR1cm4gc2lnb2s7DQogICAgfQ0KDQogICAgbW9kaWZpZXIgb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgew0KICAgICAgICAvLyBTdGVwIDE6IHRoZSBwcmVmaXggaGFzIHRvIG1hdGNoICdMUFx4MDEnIChMZWRnZXIgUHJvb2YgdmVyc2lvbiAxKQ0KICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpIHx8IChfcHJvb2ZbMV0gIT0gIlAiKSB8fCAoX3Byb29mWzJdICE9IDEpKSB0aHJvdzsNCg0KICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7DQogICAgICAgIGlmIChwcm9vZlZlcmlmaWVkID09IGZhbHNlKSB0aHJvdzsNCg0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1hdGNoQnl0ZXMzMlByZWZpeChieXRlczMyIGNvbnRlbnQsIGJ5dGVzIHByZWZpeCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7DQogICAgICAgIGJvb2wgbWF0Y2hfID0gdHJ1ZTsNCg0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByZWZpeC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGNvbnRlbnRbaV0gIT0gcHJlZml4W2ldKSBtYXRjaF8gPSBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBtYXRjaF87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsNCiAgICAgICAgYm9vbCBjaGVja29rOw0KDQoNCiAgICAgICAgLy8gU3RlcCAyOiB0aGUgdW5pcXVlIGtleWhhc2ggaGFzIHRvIG1hdGNoIHdpdGggdGhlIHNoYTI1NiBvZiAoY29udGV4dCBuYW1lICsgcXVlcnlJZCkNCiAgICAgICAgdWludCBsZWRnZXJQcm9vZkxlbmd0aCA9IDMgKyA2NSArICh1aW50KHByb29mWzMgKyA2NSArIDFdKSArIDIpICsgMzI7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBrZXloYXNoID0gbmV3IGJ5dGVzKDMyKTsNCiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIsIGtleWhhc2gsIDApOw0KICAgICAgICBjaGVja29rID0gKHNoYTMoa2V5aGFzaCkgPT0gc2hhMyhzaGEyNTYoY29udGV4dF9uYW1lLCBxdWVyeUlkKSkpOw0KICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcxID0gbmV3IGJ5dGVzKHVpbnQocHJvb2ZbbGVkZ2VyUHJvb2ZMZW5ndGggKyAoMzIgKyA4ICsgMSArIDMyKSArIDFdKSArIDIpOw0KICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoICsgKDMyICsgOCArIDEgKyAzMiksIHNpZzEubGVuZ3RoLCBzaWcxLCAwKTsNCg0KDQogICAgICAgIC8vIFN0ZXAgMzogd2UgYXNzdW1lIHNpZzEgaXMgdmFsaWQgKGl0IHdpbGwgYmUgdmVyaWZpZWQgZHVyaW5nIHN0ZXAgNSkgYW5kIHdlIHZlcmlmeSBpZiAncmVzdWx0JyBpcyB0aGUgcHJlZml4IG9mIHNoYTI1NihzaWcxKQ0KICAgICAgICBjaGVja29rID0gbWF0Y2hCeXRlczMyUHJlZml4KHNoYTI1NihzaWcxKSwgcmVzdWx0KTsNCiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsNCg0KDQogICAgICAgIC8vIFN0ZXAgNDogY29tbWl0bWVudCBtYXRjaCB2ZXJpZmljYXRpb24sIHNoYTMoZGVsYXksIG5ieXRlcywgdW5vbmNlLCBzZXNzaW9uS2V5SGFzaCkgPT0gY29tbWl0bWVudCBpbiBzdG9yYWdlLg0KICAgICAgICAvLyBUaGlzIGlzIHRvIHZlcmlmeSB0aGF0IHRoZSBjb21wdXRlZCBhcmdzIG1hdGNoIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkIGluIHRoZSBxdWVyeS4NCiAgICAgICAgYnl0ZXMgbWVtb3J5IGNvbW1pdG1lbnRTbGljZTEgPSBuZXcgYnl0ZXMoOCArIDEgKyAzMik7DQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGggKyAzMiwgOCArIDEgKyAzMiwgY29tbWl0bWVudFNsaWNlMSwgMCk7DQoNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25QdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOw0KICAgICAgICB1aW50IHNpZzJvZmZzZXQgPSBsZWRnZXJQcm9vZkxlbmd0aCArIDMyICsgKDggKyAxICsgMzIpICsgc2lnMS5sZW5ndGggKyA2NTsNCiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0IC0gNjQsIDY0LCBzZXNzaW9uUHVia2V5LCAwKTsNCg0KICAgICAgICBieXRlczMyIHNlc3Npb25QdWJrZXlIYXNoID0gc2hhMjU2KHNlc3Npb25QdWJrZXkpOw0KICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9PSBzaGEzKGNvbW1pdG1lbnRTbGljZTEsIHNlc3Npb25QdWJrZXlIYXNoKSkgey8vdW5vbmNlLCBuYnl0ZXMgYW5kIHNlc3Npb25LZXlIYXNoIG1hdGNoDQogICAgICAgICAgICBkZWxldGUgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHJldHVybiBmYWxzZTsNCg0KDQogICAgICAgIC8vIFN0ZXAgNTogdmFsaWRpdHkgdmVyaWZpY2F0aW9uIGZvciBzaWcxIChrZXloYXNoIGFuZCBhcmdzIHNpZ25lZCB3aXRoIHRoZSBzZXNzaW9uS2V5KQ0KICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMSA9IG5ldyBieXRlcygzMiArIDggKyAxICsgMzIpOw0KICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMiArIDggKyAxICsgMzIsIHRvc2lnbjEsIDApOw0KICAgICAgICBjaGVja29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24xKSwgc2lnMSwgc2Vzc2lvblB1YmtleSk7DQogICAgICAgIGlmIChjaGVja29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7DQoNCiAgICAgICAgLy8gdmVyaWZ5IGlmIHNlc3Npb25QdWJrZXlIYXNoIHdhcyB2ZXJpZmllZCBhbHJlYWR5LCBpZiBub3QuLiBsZXQncyBkbyBpdCENCiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9PSBmYWxzZSkgew0KICAgICAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShwcm9vZiwgc2lnMm9mZnNldCk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdOw0KICAgIH0NCg0KDQogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UNCiAgICBmdW5jdGlvbiBjb3B5Qnl0ZXMoYnl0ZXMgZnJvbSwgdWludCBmcm9tT2Zmc2V0LCB1aW50IGxlbmd0aCwgYnl0ZXMgdG8sIHVpbnQgdG9PZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7DQogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gbGVuZ3RoICsgdG9PZmZzZXQ7DQoNCiAgICAgICAgaWYgKHRvLmxlbmd0aCA8IG1pbkxlbmd0aCkgew0KICAgICAgICAgICAgLy8gQnVmZmVyIHRvbyBzbWFsbA0KICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICAvLyBTaG91bGQgYmUgYSBiZXR0ZXIgd2F5Pw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gTk9URTogdGhlIG9mZnNldCAzMiBpcyBhZGRlZCB0byBza2lwIHRoZSBgc2l6ZWAgZmllbGQgb2YgYm90aCBieXRlcyB2YXJpYWJsZXMNCiAgICAgICAgdWludCBpID0gMzIgKyBmcm9tT2Zmc2V0Ow0KICAgICAgICB1aW50IGogPSAzMiArIHRvT2Zmc2V0Ow0KDQogICAgICAgIHdoaWxlIChpIDwgKDMyICsgZnJvbU9mZnNldCArIGxlbmd0aCkpIHsNCiAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIGxldCB0bXAgOj0gbWxvYWQoYWRkKGZyb20sIGkpKQ0KICAgICAgICAgICAgbXN0b3JlKGFkZCh0bywgaiksIHRtcCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGkgKz0gMzI7DQogICAgICAgICAgICBqICs9IDMyOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHRvOw0KICAgIH0NCg0KICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlDQogICAgLy8gRHVwbGljYXRlIFNvbGlkaXR5J3MgZWNyZWNvdmVyLCBidXQgY2F0Y2hpbmcgdGhlIENBTEwgcmV0dXJuIHZhbHVlDQogICAgZnVuY3Rpb24gc2FmZXJfZWNyZWNvdmVyKGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsNCiAgICAgICAgLy8gV2UgZG8gb3VyIG93biBtZW1vcnkgbWFuYWdlbWVudCBoZXJlLiBTb2xpZGl0eSB1c2VzIG1lbW9yeSBvZmZzZXQNCiAgICAgICAgLy8gMHg0MCB0byBzdG9yZSB0aGUgY3VycmVudCBlbmQgb2YgbWVtb3J5LiBXZSB3cml0ZSBwYXN0IGl0IChhcw0KICAgICAgICAvLyB3cml0ZXMgYXJlIG1lbW9yeSBleHRlbnNpb25zKSwgYnV0IGRvbid0IHVwZGF0ZSB0aGUgb2Zmc2V0IHNvDQogICAgICAgIC8vIFNvbGlkaXR5IHdpbGwgcmV1c2UgaXQuIFRoZSBtZW1vcnkgdXNlZCBoZXJlIGlzIG9ubHkgbmVlZGVkIGZvcg0KICAgICAgICAvLyB0aGlzIGNvbnRleHQuDQoNCiAgICAgICAgLy8gRklYTUU6IGlubGluZSBhc3NlbWJseSBjYW4ndCBhY2Nlc3MgcmV0dXJuIHZhbHVlcw0KICAgICAgICBib29sIHJldDsNCiAgICAgICAgYWRkcmVzcyBhZGRyOw0KDQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgbGV0IHNpemUgOj0gbWxvYWQoMHg0MCkNCiAgICAgICAgbXN0b3JlKHNpemUsIGhhc2gpDQogICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgMzIpLCB2KQ0KICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDY0KSwgcikNCiAgICAgICAgbXN0b3JlKGFkZChzaXplLCA5NiksIHMpDQoNCiAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aA0KICAgICAgICAvLyAgICAgICB0aGUgcmV0dXJuIGNvZGUNCiAgICAgICAgcmV0IDo9IGNhbGwoMzAwMCwgMSwgMCwgc2l6ZSwgMTI4LCBzaXplLCAzMikNCiAgICAgICAgYWRkciA6PSBtbG9hZChzaXplKQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIChyZXQsIGFkZHIpOw0KICAgIH0NCg0KICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlDQogICAgZnVuY3Rpb24gZWNyZWNvdmVyeShieXRlczMyIGhhc2gsIGJ5dGVzIHNpZykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCwgYWRkcmVzcykgew0KICAgICAgICBieXRlczMyIHI7DQogICAgICAgIGJ5dGVzMzIgczsNCiAgICAgICAgdWludDggdjsNCg0KICAgICAgICBpZiAoc2lnLmxlbmd0aCAhPSA2NSkNCiAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7DQoNCiAgICAgICAgLy8gVGhlIHNpZ25hdHVyZSBmb3JtYXQgaXMgYSBjb21wYWN0IGZvcm0gb2Y6DQogICAgICAgIC8vICAge2J5dGVzMzIgcn17Ynl0ZXMzMiBzfXt1aW50OCB2fQ0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLg0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgIHIgOj0gbWxvYWQoYWRkKHNpZywgMzIpKQ0KICAgICAgICBzIDo9IG1sb2FkKGFkZChzaWcsIDY0KSkNCg0KICAgICAgICAvLyBIZXJlIHdlIGFyZSBsb2FkaW5nIHRoZSBsYXN0IDMyIGJ5dGVzLiBXZSBleHBsb2l0IHRoZSBmYWN0IHRoYXQNCiAgICAgICAgLy8gJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4NCiAgICAgICAgLy8gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcywgYnV0IHRoYXQgd291bGQgYmUgbmljZXIuDQogICAgICAgIHYNCiAgICAgICAgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQ0KDQogICAgICAgIC8vIEFsdGVybmF0aXZlIHNvbHV0aW9uOg0KICAgICAgICAvLyAnYnl0ZScgaXMgbm90IHdvcmtpbmcgZHVlIHRvIHRoZSBTb2xpZGl0eSBwYXJzZXIsIHNvIGxldHMNCiAgICAgICAgLy8gdXNlIHRoZSBzZWNvbmQgYmVzdCBvcHRpb24sICdhbmQnDQogICAgICAgIC8vIHYgOj0gYW5kKG1sb2FkKGFkZChzaWcsIDY1KSksIDI1NSkNCiAgICB9DQoNCg0KLy8gYWxiZWl0IG5vbi10cmFuc2FjdGlvbmFsIHNpZ25hdHVyZXMgYXJlIG5vdCBzcGVjaWZpZWQgYnkgdGhlIFlQLCBvbmUgd291bGQgZXhwZWN0IGl0DQovLyB0byBtYXRjaCB0aGUgWVAgcmFuZ2Ugb2YgWzI3LCAyOF0NCi8vDQovLyBnZXRoIHVzZXMgWzAsIDFdIGFuZCBzb21lIGNsaWVudHMgaGF2ZSBmb2xsb3dlZC4gVGhpcyBtaWdodCBjaGFuZ2UsIHNlZToNCi8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vZ28tZXRoZXJldW0vaXNzdWVzLzIwNTMNCmlmICh2IDwgMjcpDQp2ICs9IDI3Ow0KDQppZiAodiAhPSAyNyAmJiB2ICE9IDI4KQ0KcmV0dXJuIChmYWxzZSwgMCk7DQoNCnJldHVybiBzYWZlcl9lY3JlY292ZXIoaGFzaCwgdiwgciwgcyk7DQp9DQoNCn0NCi8vIDwvT1JBQ0xJWkVfQVBJPg0KDQovKg0KICogQHRpdGxlIFN0cmluZyAmIHNsaWNlIHV0aWxpdHkgbGlicmFyeSBmb3IgU29saWRpdHkgY29udHJhY3RzLg0KICogQGF1dGhvciBOaWNrIEpvaG5zb24gPGFyYWNobmlkQG5vdGRvdC5uZXQ+DQogKg0KICogQGRldiBGdW5jdGlvbmFsaXR5IGluIHRoaXMgbGlicmFyeSBpcyBsYXJnZWx5IGltcGxlbWVudGVkIHVzaW5nIGFuDQogKiAgICAgIGFic3RyYWN0aW9uIGNhbGxlZCBhICdzbGljZScuIEEgc2xpY2UgcmVwcmVzZW50cyBhIHBhcnQgb2YgYSBzdHJpbmcgLQ0KICogICAgICBhbnl0aGluZyBmcm9tIHRoZSBlbnRpcmUgc3RyaW5nIHRvIGEgc2luZ2xlIGNoYXJhY3Rlciwgb3IgZXZlbiBubw0KICogICAgICBjaGFyYWN0ZXJzIGF0IGFsbCAoYSAwLWxlbmd0aCBzbGljZSkuIFNpbmNlIGEgc2xpY2Ugb25seSBoYXMgdG8gc3BlY2lmeQ0KICogICAgICBhbiBvZmZzZXQgYW5kIGEgbGVuZ3RoLCBjb3B5aW5nIGFuZCBtYW5pcHVsYXRpbmcgc2xpY2VzIGlzIGEgbG90IGxlc3MNCiAqICAgICAgZXhwZW5zaXZlIHRoYW4gY29weWluZyBhbmQgbWFuaXB1bGF0aW5nIHRoZSBzdHJpbmdzIHRoZXkgcmVmZXJlbmNlLg0KICoNCiAqICAgICAgVG8gZnVydGhlciByZWR1Y2UgZ2FzIGNvc3RzLCBtb3N0IGZ1bmN0aW9ucyBvbiBzbGljZSB0aGF0IG5lZWQgdG8gcmV0dXJuDQogKiAgICAgIGEgc2xpY2UgbW9kaWZ5IHRoZSBvcmlnaW5hbCBvbmUgaW5zdGVhZCBvZiBhbGxvY2F0aW5nIGEgbmV3IG9uZTsgZm9yDQogKiAgICAgIGluc3RhbmNlLCBgcy5zcGxpdCgiLiIpYCB3aWxsIHJldHVybiB0aGUgdGV4dCB1cCB0byB0aGUgZmlyc3QgJy4nLA0KICogICAgICBtb2RpZnlpbmcgcyB0byBvbmx5IGNvbnRhaW4gdGhlIHJlbWFpbmRlciBvZiB0aGUgc3RyaW5nIGFmdGVyIHRoZSAnLicuDQogKiAgICAgIEluIHNpdHVhdGlvbnMgd2hlcmUgeW91IGRvIG5vdCB3YW50IHRvIG1vZGlmeSB0aGUgb3JpZ2luYWwgc2xpY2UsIHlvdQ0KICogICAgICBjYW4gbWFrZSBhIGNvcHkgZmlyc3Qgd2l0aCBgLmNvcHkoKWAsIGZvciBleGFtcGxlOg0KICogICAgICBgcy5jb3B5KCkuc3BsaXQoIi4iKWAuIFRyeSBhbmQgYXZvaWQgdXNpbmcgdGhpcyBpZGlvbSBpbiBsb29wczsgc2luY2UNCiAqICAgICAgU29saWRpdHkgaGFzIG5vIG1lbW9yeSBtYW5hZ2VtZW50LCBpdCB3aWxsIHJlc3VsdCBpbiBhbGxvY2F0aW5nIG1hbnkNCiAqICAgICAgc2hvcnQtbGl2ZWQgc2xpY2VzIHRoYXQgYXJlIGxhdGVyIGRpc2NhcmRlZC4NCiAqDQogKiAgICAgIEZ1bmN0aW9ucyB0aGF0IHJldHVybiB0d28gc2xpY2VzIGNvbWUgaW4gdHdvIHZlcnNpb25zOiBhIG5vbi1hbGxvY2F0aW5nDQogKiAgICAgIHZlcnNpb24gdGhhdCB0YWtlcyB0aGUgc2Vjb25kIHNsaWNlIGFzIGFuIGFyZ3VtZW50LCBtb2RpZnlpbmcgaXQgaW4NCiAqICAgICAgcGxhY2UsIGFuZCBhbiBhbGxvY2F0aW5nIHZlcnNpb24gdGhhdCBhbGxvY2F0ZXMgYW5kIHJldHVybnMgdGhlIHNlY29uZA0KICogICAgICBzbGljZTsgc2VlIGBuZXh0UnVuZWAgZm9yIGV4YW1wbGUuDQogKg0KICogICAgICBGdW5jdGlvbnMgdGhhdCBoYXZlIHRvIGNvcHkgc3RyaW5nIGRhdGEgd2lsbCByZXR1cm4gc3RyaW5ncyByYXRoZXIgdGhhbg0KICogICAgICBzbGljZXM7IHRoZXNlIGNhbiBiZSBjYXN0IGJhY2sgdG8gc2xpY2VzIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmcgaWYNCiAqICAgICAgcmVxdWlyZWQuDQogKg0KICogICAgICBGb3IgY29udmVuaWVuY2UsIHNvbWUgZnVuY3Rpb25zIGFyZSBwcm92aWRlZCB3aXRoIG5vbi1tb2RpZnlpbmcNCiAqICAgICAgdmFyaWFudHMgdGhhdCBjcmVhdGUgYSBuZXcgc2xpY2UgYW5kIHJldHVybiBib3RoOyBmb3IgaW5zdGFuY2UsDQogKiAgICAgIGBzLnNwbGl0TmV3KCcuJylgIGxlYXZlcyBzIHVubW9kaWZpZWQsIGFuZCByZXR1cm5zIHR3byB2YWx1ZXMNCiAqICAgICAgY29ycmVzcG9uZGluZyB0byB0aGUgbGVmdCBhbmQgcmlnaHQgcGFydHMgb2YgdGhlIHN0cmluZy4NCiAqLw0KbGlicmFyeSBzdHJpbmdzIHsNCnN0cnVjdCBzbGljZSB7DQp1aW50IF9sZW47DQp1aW50IF9wdHI7DQp9DQoNCmZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSB7DQovLyBDb3B5IHdvcmQtbGVuZ3RoIGNodW5rcyB3aGlsZSBwb3NzaWJsZQ0KZm9yICg7IGxlbiA+PSAzMjsgbGVuIC09IDMyKSB7DQphc3NlbWJseSB7DQptc3RvcmUoZGVzdCwgbWxvYWQoc3JjKSkNCn0NCmRlc3QgKz0gMzI7DQpzcmMgKz0gMzI7DQp9DQoNCi8vIENvcHkgcmVtYWluaW5nIGJ5dGVzDQp1aW50IG1hc2sgPSAyNTYgKiogKDMyIC0gbGVuKSAtIDE7DQphc3NlbWJseSB7DQpsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoc3JjKSwgbm90KG1hc2spKQ0KbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChkZXN0KSwgbWFzaykNCm1zdG9yZShkZXN0LCBvcihkZXN0cGFydCwgc3JjcGFydCkpDQp9DQp9DQoNCi8qDQogKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLg0KICogQHBhcmFtIHNlbGYgVGhlIHN0cmluZyB0byBtYWtlIGEgc2xpY2UgZnJvbS4NCiAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4NCiAqLw0KZnVuY3Rpb24gdG9TbGljZShzdHJpbmcgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCnVpbnQgcHRyOw0KYXNzZW1ibHkgew0KcHRyIDo9IGFkZChzZWxmLCAweDIwKQ0KfQ0KcmV0dXJuIHNsaWNlKGJ5dGVzKHNlbGYpLmxlbmd0aCwgcHRyKTsNCn0NCg0KLyoNCiAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIG9mIGEgbnVsbC10ZXJtaW5hdGVkIGJ5dGVzMzIgc3RyaW5nLg0KICogQHBhcmFtIHNlbGYgVGhlIHZhbHVlIHRvIGZpbmQgdGhlIGxlbmd0aCBvZi4NCiAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc3RyaW5nLCBmcm9tIDAgdG8gMzIuDQogKi8NCmZ1bmN0aW9uIGxlbihieXRlczMyIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCnVpbnQgcmV0Ow0KaWYgKHNlbGYgPT0gMCkNCnJldHVybiAwOw0KaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmID09IDApIHsNCnJldCArPSAxNjsNCnNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7DQp9DQppZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7DQpyZXQgKz0gODsNCnNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwKTsNCn0NCmlmIChzZWxmICYgMHhmZmZmZmZmZiA9PSAwKSB7DQpyZXQgKz0gNDsNCnNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMCk7DQp9DQppZiAoc2VsZiAmIDB4ZmZmZiA9PSAwKSB7DQpyZXQgKz0gMjsNCnNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwKTsNCn0NCmlmIChzZWxmICYgMHhmZiA9PSAwKSB7DQpyZXQgKz0gMTsNCn0NCnJldHVybiAzMiAtIHJldDsNCn0NCg0KLyoNCiAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBieXRlczMyLCBpbnRlcnByZXRlZCBhcyBhDQogKiAgICAgIG51bGwtdGVybWludGFlZCB1dGYtOCBzdHJpbmcuDQogKiBAcGFyYW0gc2VsZiBUaGUgYnl0ZXMzMiB2YWx1ZSB0byBjb252ZXJ0IHRvIGEgc2xpY2UuDQogKiBAcmV0dXJuIEEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHZhbHVlIG9mIHRoZSBpbnB1dCBhcmd1bWVudCB1cCB0byB0aGUNCiAqICAgICAgICAgZmlyc3QgbnVsbC4NCiAqLw0KZnVuY3Rpb24gdG9TbGljZUIzMihieXRlczMyIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHJldCkgew0KLy8gQWxsb2NhdGUgc3BhY2UgZm9yIGBzZWxmYCBpbiBtZW1vcnksIGNvcHkgaXQgdGhlcmUsIGFuZCBwb2ludCByZXQgYXQgaXQNCmFzc2VtYmx5IHsNCmxldCBwdHIgOj0gbWxvYWQoMHg0MCkNCm1zdG9yZSgweDQwLCBhZGQocHRyLCAweDIwKSkNCm1zdG9yZShwdHIsIHNlbGYpDQptc3RvcmUoYWRkKHJldCwgMHgyMCksIHB0cikNCn0NCnJldC5fbGVuID0gbGVuKHNlbGYpOw0KfQ0KDQovKg0KICogQGRldiBSZXR1cm5zIGEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyB0aGUgY3VycmVudCBzbGljZS4NCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5Lg0KICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgYHNlbGZgLg0KICovDQpmdW5jdGlvbiBjb3B5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQpyZXR1cm4gc2xpY2Uoc2VsZi5fbGVuLCBzZWxmLl9wdHIpOw0KfQ0KDQovKg0KICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuDQogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4NCiAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNsaWNlJ3MgdGV4dC4NCiAqLw0KZnVuY3Rpb24gdG9TdHJpbmcoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQp2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4pOw0KdWludCByZXRwdHI7DQphc3NlbWJseSB7cmV0cHRyIDo9IGFkZChyZXQsIDMyKX0NCg0KbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOw0KcmV0dXJuIHJldDsNCn0NCg0KLyoNCiAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIGluIHJ1bmVzIG9mIHRoZSBzbGljZS4gTm90ZSB0aGF0IHRoaXMgb3BlcmF0aW9uDQogKiAgICAgIHRha2VzIHRpbWUgcHJvcG9ydGlvbmFsIHRvIHRoZSBsZW5ndGggb2YgdGhlIHNsaWNlOyBhdm9pZCB1c2luZyBpdA0KICogICAgICBpbiBsb29wcywgYW5kIGNhbGwgYHNsaWNlLmVtcHR5KClgIGlmIHlvdSBvbmx5IG5lZWQgdG8ga25vdyB3aGV0aGVyDQogKiAgICAgIHRoZSBzbGljZSBpcyBlbXB0eSBvciBub3QuDQogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc2xpY2UgaW4gcnVuZXMuDQogKi8NCmZ1bmN0aW9uIGxlbihzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQovLyBTdGFydGluZyBhdCBwdHItMzEgbWVhbnMgdGhlIExTQiB3aWxsIGJlIHRoZSBieXRlIHdlIGNhcmUgYWJvdXQNCnZhciBwdHIgPSBzZWxmLl9wdHIgLSAzMTsNCnZhciBlbmQgPSBwdHIgKyBzZWxmLl9sZW47DQpmb3IgKHVpbnQgbGVuID0gMDsgcHRyIDwgZW5kOyBsZW4rKykgew0KdWludDggYjsNCmFzc2VtYmx5IHtiIDo9IGFuZChtbG9hZChwdHIpLCAweEZGKX0NCmlmIChiIDwgMHg4MCkgew0KcHRyICs9IDE7DQp9IGVsc2UgaWYgKGIgPCAweEUwKSB7DQpwdHIgKz0gMjsNCn0gZWxzZSBpZiAoYiA8IDB4RjApIHsNCnB0ciArPSAzOw0KfSBlbHNlIGlmIChiIDwgMHhGOCkgew0KcHRyICs9IDQ7DQp9IGVsc2UgaWYgKGIgPCAweEZDKSB7DQpwdHIgKz0gNTsNCn0gZWxzZSB7DQpwdHIgKz0gNjsNCn0NCn0NCnJldHVybiBsZW47DQp9DQoNCi8qDQogKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgaXMgZW1wdHkgKGhhcyBhIGxlbmd0aCBvZiAwKS4NCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSwgRmFsc2Ugb3RoZXJ3aXNlLg0KICovDQpmdW5jdGlvbiBlbXB0eShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQpyZXR1cm4gc2VsZi5fbGVuID09IDA7DQp9DQoNCi8qDQogKiBAZGV2IFJldHVybnMgYSBwb3NpdGl2ZSBudW1iZXIgaWYgYG90aGVyYCBjb21lcyBsZXhpY29ncmFwaGljYWxseSBhZnRlcg0KICogICAgICBgc2VsZmAsIGEgbmVnYXRpdmUgbnVtYmVyIGlmIGl0IGNvbWVzIGJlZm9yZSwgb3IgemVybyBpZiB0aGUNCiAqICAgICAgY29udGVudHMgb2YgdGhlIHR3byBzbGljZXMgYXJlIGVxdWFsLiBDb21wYXJpc29uIGlzIGRvbmUgcGVyLXJ1bmUsDQogKiAgICAgIG9uIHVuaWNvZGUgY29kZXBvaW50cy4NCiAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLg0KICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29tcGFyZS4NCiAqIEByZXR1cm4gVGhlIHJlc3VsdCBvZiB0aGUgY29tcGFyaXNvbi4NCiAqLw0KZnVuY3Rpb24gY29tcGFyZShzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQp1aW50IHNob3J0ZXN0ID0gc2VsZi5fbGVuOw0KaWYgKG90aGVyLl9sZW4gPCBzZWxmLl9sZW4pDQpzaG9ydGVzdCA9IG90aGVyLl9sZW47DQoNCnZhciBzZWxmcHRyID0gc2VsZi5fcHRyOw0KdmFyIG90aGVycHRyID0gb3RoZXIuX3B0cjsNCmZvciAodWludCBpZHggPSAwOyBpZHggPCBzaG9ydGVzdDsgaWR4ICs9IDMyKSB7DQp1aW50IGE7DQp1aW50IGI7DQphc3NlbWJseSB7DQphIDo9IG1sb2FkKHNlbGZwdHIpDQpiIDo9IG1sb2FkKG90aGVycHRyKQ0KfQ0KaWYgKGEgIT0gYikgew0KLy8gTWFzayBvdXQgaXJyZWxldmFudCBieXRlcyBhbmQgY2hlY2sgYWdhaW4NCnVpbnQgbWFzayA9IH4oMiAqKiAoOCAqICgzMiAtIHNob3J0ZXN0ICsgaWR4KSkgLSAxKTsNCnZhciBkaWZmID0gKGEgJiBtYXNrKSAtIChiICYgbWFzayk7DQppZiAoZGlmZiAhPSAwKQ0KcmV0dXJuIGludChkaWZmKTsNCn0NCnNlbGZwdHIgKz0gMzI7DQpvdGhlcnB0ciArPSAzMjsNCn0NCnJldHVybiBpbnQoc2VsZi5fbGVuKSAtIGludChvdGhlci5fbGVuKTsNCn0NCg0KLyoNCiAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSB0d28gc2xpY2VzIGNvbnRhaW4gdGhlIHNhbWUgdGV4dC4NCiAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLg0KICogQHBhcmFtIHNlbGYgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLg0KICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuDQogKi8NCmZ1bmN0aW9uIGVxdWFscyhzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KcmV0dXJuIGNvbXBhcmUoc2VsZiwgb3RoZXIpID09IDA7DQp9DQoNCi8qDQogKiBAZGV2IEV4dHJhY3RzIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSBpbnRvIGBydW5lYCwgYWR2YW5jaW5nIHRoZQ0KICogICAgICBzbGljZSB0byBwb2ludCB0byB0aGUgbmV4dCBydW5lIGFuZCByZXR1cm5pbmcgYHNlbGZgLg0KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogKiBAcGFyYW0gcnVuZSBUaGUgc2xpY2UgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIGZpcnN0IHJ1bmUuDQogKiBAcmV0dXJuIGBydW5lYC4NCiAqLw0KZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZiwgc2xpY2UgcnVuZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCnJ1bmUuX3B0ciA9IHNlbGYuX3B0cjsNCg0KaWYgKHNlbGYuX2xlbiA9PSAwKSB7DQpydW5lLl9sZW4gPSAwOw0KcmV0dXJuIHJ1bmU7DQp9DQoNCnVpbnQgbGVuOw0KdWludCBiOw0KLy8gTG9hZCB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgcnVuZSBpbnRvIHRoZSBMU0JzIG9mIGINCmFzc2VtYmx5IHtiIDo9IGFuZChtbG9hZChzdWIobWxvYWQoYWRkKHNlbGYsIDMyKSksIDMxKSksIDB4RkYpfQ0KaWYgKGIgPCAweDgwKSB7DQpsZW4gPSAxOw0KfSBlbHNlIGlmIChiIDwgMHhFMCkgew0KbGVuID0gMjsNCn0gZWxzZSBpZiAoYiA8IDB4RjApIHsNCmxlbiA9IDM7DQp9IGVsc2Ugew0KbGVuID0gNDsNCn0NCg0KLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzDQppZiAobGVuID4gc2VsZi5fbGVuKSB7DQpydW5lLl9sZW4gPSBzZWxmLl9sZW47DQpzZWxmLl9wdHIgKz0gc2VsZi5fbGVuOw0Kc2VsZi5fbGVuID0gMDsNCnJldHVybiBydW5lOw0KfQ0KDQpzZWxmLl9wdHIgKz0gbGVuOw0Kc2VsZi5fbGVuIC09IGxlbjsNCnJ1bmUuX2xlbiA9IGxlbjsNCnJldHVybiBydW5lOw0KfQ0KDQovKg0KICogQGRldiBSZXR1cm5zIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSwgYWR2YW5jaW5nIHRoZSBzbGljZSB0byBwb2ludA0KICogICAgICB0byB0aGUgbmV4dCBydW5lLg0KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogKiBAcmV0dXJuIEEgc2xpY2UgY29udGFpbmluZyBvbmx5IHRoZSBmaXJzdCBydW5lIGZyb20gYHNlbGZgLg0KICovDQpmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsNCm5leHRSdW5lKHNlbGYsIHJldCk7DQp9DQoNCi8qDQogKiBAZGV2IFJldHVybnMgdGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4NCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICogQHJldHVybiBUaGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLg0KICovDQpmdW5jdGlvbiBvcmQoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCByZXQpIHsNCmlmIChzZWxmLl9sZW4gPT0gMCkgew0KcmV0dXJuIDA7DQp9DQoNCnVpbnQgd29yZDsNCnVpbnQgbGVuOw0KdWludCBkaXZpc29yID0gMiAqKiAyNDg7DQoNCi8vIExvYWQgdGhlIHJ1bmUgaW50byB0aGUgTVNCcyBvZiBiDQphc3NlbWJseSB7d29yZCA6PSBtbG9hZChtbG9hZChhZGQoc2VsZiwgMzIpKSl9DQp2YXIgYiA9IHdvcmQgLyBkaXZpc29yOw0KaWYgKGIgPCAweDgwKSB7DQpyZXQgPSBiOw0KbGVuID0gMTsNCn0gZWxzZSBpZiAoYiA8IDB4RTApIHsNCnJldCA9IGIgJiAweDFGOw0KbGVuID0gMjsNCn0gZWxzZSBpZiAoYiA8IDB4RjApIHsNCnJldCA9IGIgJiAweDBGOw0KbGVuID0gMzsNCn0gZWxzZSB7DQpyZXQgPSBiICYgMHgwNzsNCmxlbiA9IDQ7DQp9DQoNCi8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cw0KaWYgKGxlbiA+IHNlbGYuX2xlbikgew0KcmV0dXJuIDA7DQp9DQoNCmZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7DQpkaXZpc29yID0gZGl2aXNvciAvIDI1NjsNCmIgPSAod29yZCAvIGRpdmlzb3IpICYgMHhGRjsNCmlmIChiICYgMHhDMCAhPSAweDgwKSB7DQovLyBJbnZhbGlkIFVURi04IHNlcXVlbmNlDQpyZXR1cm4gMDsNCn0NCnJldCA9IChyZXQgKiA2NCkgfCAoYiAmIDB4M0YpOw0KfQ0KDQpyZXR1cm4gcmV0Ow0KfQ0KDQovKg0KICogQGRldiBSZXR1cm5zIHRoZSBrZWNjYWstMjU2IGhhc2ggb2YgdGhlIHNsaWNlLg0KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGhhc2guDQogKiBAcmV0dXJuIFRoZSBoYXNoIG9mIHRoZSBzbGljZS4NCiAqLw0KZnVuY3Rpb24ga2VjY2FrKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgcmV0KSB7DQphc3NlbWJseSB7DQpyZXQgOj0gc2hhMyhtbG9hZChhZGQoc2VsZiwgMzIpKSwgbWxvYWQoc2VsZikpDQp9DQp9DQoNCi8qDQogKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAuDQogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuDQogKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuDQogKi8NCmZ1bmN0aW9uIHN0YXJ0c1dpdGgoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQppZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCnJldHVybiBmYWxzZTsNCn0NCg0KaWYgKHNlbGYuX3B0ciA9PSBuZWVkbGUuX3B0cikgew0KcmV0dXJuIHRydWU7DQp9DQoNCmJvb2wgZXF1YWw7DQphc3NlbWJseSB7DQpsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkNCmxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkNCmxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpDQplcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQ0KfQ0KcmV0dXJuIGVxdWFsOw0KfQ0KDQovKg0KICogQGRldiBJZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUNCiAqICAgICAgYmVnaW5uaW5nIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4NCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4NCiAqIEByZXR1cm4gYHNlbGZgDQogKi8NCmZ1bmN0aW9uIGJleW9uZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQppZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCnJldHVybiBzZWxmOw0KfQ0KDQpib29sIGVxdWFsID0gdHJ1ZTsNCmlmIChzZWxmLl9wdHIgIT0gbmVlZGxlLl9wdHIpIHsNCmFzc2VtYmx5IHsNCmxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQ0KbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCmVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQp9DQp9DQoNCmlmIChlcXVhbCkgew0Kc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOw0Kc2VsZi5fcHRyICs9IG5lZWRsZS5fbGVuOw0KfQ0KDQpyZXR1cm4gc2VsZjsNCn0NCg0KLyoNCiAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBlbmRzIHdpdGggYG5lZWRsZWAuDQogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuDQogKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuDQogKi8NCmZ1bmN0aW9uIGVuZHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7DQpyZXR1cm4gZmFsc2U7DQp9DQoNCnZhciBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47DQoNCmlmIChzZWxmcHRyID09IG5lZWRsZS5fcHRyKSB7DQpyZXR1cm4gdHJ1ZTsNCn0NCg0KYm9vbCBlcXVhbDsNCmFzc2VtYmx5IHsNCmxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCmVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQp9DQoNCnJldHVybiBlcXVhbDsNCn0NCg0KLyoNCiAqIEBkZXYgSWYgYHNlbGZgIGVuZHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQ0KICogICAgICBlbmQgb2YgYHNlbGZgLiBPdGhlcndpc2UsIGBzZWxmYCBpcyB1bm1vZGlmaWVkLg0KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICogQHJldHVybiBgc2VsZmANCiAqLw0KZnVuY3Rpb24gdW50aWwoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7DQpyZXR1cm4gc2VsZjsNCn0NCg0KdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsNCmJvb2wgZXF1YWwgPSB0cnVlOw0KaWYgKHNlbGZwdHIgIT0gbmVlZGxlLl9wdHIpIHsNCmFzc2VtYmx5IHsNCmxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCmVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQp9DQp9DQoNCmlmIChlcXVhbCkgew0Kc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOw0KfQ0KDQpyZXR1cm4gc2VsZjsNCn0NCg0KLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YNCi8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgYHNlbGZgIGlmIG5vdCBmb3VuZC4NCmZ1bmN0aW9uIGZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7DQp1aW50IHB0cjsNCnVpbnQgaWR4Ow0KDQppZiAobmVlZGxlbGVuIDw9IHNlbGZsZW4pIHsNCmlmIChuZWVkbGVsZW4gPD0gMzIpIHsNCi8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjggZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MNCmFzc2VtYmx5IHsNCmxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpDQpsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykNCmxldCBlbmQgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQ0KcHRyIDo9IHNlbGZwdHINCmxvb3AgOg0KanVtcGkoZXhpdCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkNCnB0ciA6PSBhZGQocHRyLCAxKQ0KanVtcGkobG9vcCwgbHQoc3ViKHB0ciwgMSksIGVuZCkpDQpwdHIgOj0gYWRkKHNlbGZwdHIsIHNlbGZsZW4pDQpleGl0Og0KfQ0KcmV0dXJuIHB0cjsNCn0gZWxzZSB7DQovLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZw0KYnl0ZXMzMiBoYXNoOw0KYXNzZW1ibHkge2hhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbil9DQpwdHIgPSBzZWxmcHRyOw0KZm9yIChpZHggPSAwOyBpZHggPD0gc2VsZmxlbiAtIG5lZWRsZWxlbjsgaWR4KyspIHsNCmJ5dGVzMzIgdGVzdEhhc2g7DQphc3NlbWJseSB7dGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbil9DQppZiAoaGFzaCA9PSB0ZXN0SGFzaCkNCnJldHVybiBwdHI7DQpwdHIgKz0gMTsNCn0NCn0NCn0NCnJldHVybiBzZWxmcHRyICsgc2VsZmxlbjsNCn0NCg0KLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZg0KLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgYWRkcmVzcyBvZiBgc2VsZmAgaWYgbm90IGZvdW5kLg0KZnVuY3Rpb24gcmZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7DQp1aW50IHB0cjsNCg0KaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7DQppZiAobmVlZGxlbGVuIDw9IDMyKSB7DQovLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY5IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzDQphc3NlbWJseSB7DQpsZXQgbWFzayA6PSBub3Qoc3ViKGV4cCgyLCBtdWwoOCwgc3ViKDMyLCBuZWVkbGVsZW4pKSksIDEpKQ0KbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spDQpwdHIgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQ0KbG9vcCA6DQpqdW1waShyZXQsIGVxKGFuZChtbG9hZChwdHIpLCBtYXNrKSwgbmVlZGxlZGF0YSkpDQpwdHIgOj0gc3ViKHB0ciwgMSkNCmp1bXBpKGxvb3AsIGd0KGFkZChwdHIsIDEpLCBzZWxmcHRyKSkNCnB0ciA6PSBzZWxmcHRyDQpqdW1wKGV4aXQpDQpyZXQgOg0KcHRyIDo9IGFkZChwdHIsIG5lZWRsZWxlbikNCmV4aXQgOg0KfQ0KcmV0dXJuIHB0cjsNCn0gZWxzZSB7DQovLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZw0KYnl0ZXMzMiBoYXNoOw0KYXNzZW1ibHkge2hhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbil9DQpwdHIgPSBzZWxmcHRyICsgKHNlbGZsZW4gLSBuZWVkbGVsZW4pOw0Kd2hpbGUgKHB0ciA+PSBzZWxmcHRyKSB7DQpieXRlczMyIHRlc3RIYXNoOw0KYXNzZW1ibHkge3Rlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pfQ0KaWYgKGhhc2ggPT0gdGVzdEhhc2gpDQpyZXR1cm4gcHRyICsgbmVlZGxlbGVuOw0KcHRyIC09IDE7DQp9DQp9DQp9DQpyZXR1cm4gc2VsZnB0cjsNCn0NCg0KLyoNCiAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gZXZlcnl0aGluZyBmcm9tIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mDQogKiAgICAgIGBuZWVkbGVgIHRvIHRoZSBlbmQgb2YgdGhlIHNsaWNlLiBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZQ0KICogICAgICBpZiBgbmVlZGxlYCBpcyBub3QgZm91bmQuDQogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuDQogKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuDQogKiBAcmV0dXJuIGBzZWxmYC4NCiAqLw0KZnVuY3Rpb24gZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQp1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQpzZWxmLl9sZW4gLT0gcHRyIC0gc2VsZi5fcHRyOw0Kc2VsZi5fcHRyID0gcHRyOw0KcmV0dXJuIHNlbGY7DQp9DQoNCi8qDQogKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIHRoZSBwYXJ0IG9mIHRoZSBzdHJpbmcgZnJvbSB0aGUgc3RhcnQgb2YNCiAqICAgICAgYHNlbGZgIHRvIHRoZSBlbmQgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAuIElmIGBuZWVkbGVgDQogKiAgICAgIGlzIG5vdCBmb3VuZCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UuDQogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuDQogKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuDQogKiBAcmV0dXJuIGBzZWxmYC4NCiAqLw0KZnVuY3Rpb24gcmZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCnNlbGYuX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsNCnJldHVybiBzZWxmOw0KfQ0KDQovKg0KICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdA0KICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYNCiAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwNCiAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuDQogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uDQogKiBAcmV0dXJuIGB0b2tlbmAuDQogKi8NCmZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQp1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQp0b2tlbi5fcHRyID0gc2VsZi5fcHRyOw0KdG9rZW4uX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsNCmlmIChwdHIgPT0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7DQovLyBOb3QgZm91bmQNCnNlbGYuX2xlbiA9IDA7DQp9IGVsc2Ugew0Kc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsNCnNlbGYuX3B0ciA9IHB0ciArIG5lZWRsZS5fbGVuOw0KfQ0KcmV0dXJuIHRva2VuOw0KfQ0KDQovKg0KICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdA0KICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZg0KICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLA0KICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4NCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4NCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCB1cCB0byB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgZGVsaW1gLg0KICovDQpmdW5jdGlvbiBzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHRva2VuKSB7DQpzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsNCn0NCg0KLyoNCiAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QNCiAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBhZnRlciBpdC4gSWYNCiAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwNCiAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuDQogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uDQogKiBAcmV0dXJuIGB0b2tlbmAuDQogKi8NCmZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCnRva2VuLl9wdHIgPSBwdHI7DQp0b2tlbi5fbGVuID0gc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0cik7DQppZiAocHRyID09IHNlbGYuX3B0cikgew0KLy8gTm90IGZvdW5kDQpzZWxmLl9sZW4gPSAwOw0KfSBlbHNlIHsNCnNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47DQp9DQpyZXR1cm4gdG9rZW47DQp9DQoNCi8qDQogKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIHRoZSBsYXN0DQogKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBhZnRlciBpdC4gSWYNCiAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwNCiAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuDQogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLg0KICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZiBgZGVsaW1gLg0KICovDQpmdW5jdGlvbiByc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgew0KcnNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOw0KfQ0KDQovKg0KICogQGRldiBDb3VudHMgdGhlIG51bWJlciBvZiBub25vdmVybGFwcGluZyBvY2N1cnJlbmNlcyBvZiBgbmVlZGxlYCBpbiBgc2VsZmAuDQogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoLg0KICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAqIEByZXR1cm4gVGhlIG51bWJlciBvZiBvY2N1cnJlbmNlcyBvZiBgbmVlZGxlYCBmb3VuZCBpbiBgc2VsZmAuDQogKi8NCmZ1bmN0aW9uIGNvdW50KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAodWludCBjb3VudCkgew0KdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47DQp3aGlsZSAocHRyIDw9IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgew0KY291bnQrKzsNCnB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0ciksIHB0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOw0KfQ0KfQ0KDQovKg0KICogQGRldiBSZXR1cm5zIFRydWUgaWYgYHNlbGZgIGNvbnRhaW5zIGBuZWVkbGVgLg0KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4NCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogKiBAcmV0dXJuIFRydWUgaWYgYG5lZWRsZWAgaXMgZm91bmQgaW4gYHNlbGZgLCBmYWxzZSBvdGhlcndpc2UuDQogKi8NCmZ1bmN0aW9uIGNvbnRhaW5zKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KcmV0dXJuIHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICE9IHNlbGYuX3B0cjsNCn0NCg0KLyoNCiAqIEBkZXYgUmV0dXJucyBhIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgY29uY2F0ZW5hdGlvbiBvZg0KICogICAgICBgc2VsZmAgYW5kIGBvdGhlcmAuDQogKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29uY2F0ZW5hdGUuDQogKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb25jYXRlbmF0ZS4NCiAqIEByZXR1cm4gVGhlIGNvbmNhdGVuYXRpb24gb2YgdGhlIHR3byBzdHJpbmdzLg0KICovDQpmdW5jdGlvbiBjb25jYXQoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuICsgb3RoZXIuX2xlbik7DQp1aW50IHJldHB0cjsNCmFzc2VtYmx5IHtyZXRwdHIgOj0gYWRkKHJldCwgMzIpfQ0KbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOw0KbWVtY3B5KHJldHB0ciArIHNlbGYuX2xlbiwgb3RoZXIuX3B0ciwgb3RoZXIuX2xlbik7DQpyZXR1cm4gcmV0Ow0KfQ0KDQovKg0KICogQGRldiBKb2lucyBhbiBhcnJheSBvZiBzbGljZXMsIHVzaW5nIGBzZWxmYCBhcyBhIGRlbGltaXRlciwgcmV0dXJuaW5nIGENCiAqICAgICAgbmV3bHkgYWxsb2NhdGVkIHN0cmluZy4NCiAqIEBwYXJhbSBzZWxmIFRoZSBkZWxpbWl0ZXIgdG8gdXNlLg0KICogQHBhcmFtIHBhcnRzIEEgbGlzdCBvZiBzbGljZXMgdG8gam9pbi4NCiAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgYWxsIHRoZSBzbGljZXMgaW4gYHBhcnRzYCwNCiAqICAgICAgICAgam9pbmVkIHdpdGggYHNlbGZgLg0KICovDQpmdW5jdGlvbiBqb2luKHNsaWNlIHNlbGYsIHNsaWNlW10gcGFydHMpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KaWYgKHBhcnRzLmxlbmd0aCA9PSAwKQ0KcmV0dXJuICIiOw0KDQp1aW50IGxlbiA9IHNlbGYuX2xlbiAqIChwYXJ0cy5sZW5ndGggLSAxKTsNCmZvciAodWludCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKQ0KbGVuICs9IHBhcnRzW2ldLl9sZW47DQoNCnZhciByZXQgPSBuZXcgc3RyaW5nKGxlbik7DQp1aW50IHJldHB0cjsNCmFzc2VtYmx5IHtyZXRwdHIgOj0gYWRkKHJldCwgMzIpfQ0KDQpmb3IgKGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsNCm1lbWNweShyZXRwdHIsIHBhcnRzW2ldLl9wdHIsIHBhcnRzW2ldLl9sZW4pOw0KcmV0cHRyICs9IHBhcnRzW2ldLl9sZW47DQppZiAoaSA8IHBhcnRzLmxlbmd0aCAtIDEpIHsNCm1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsNCnJldHB0ciArPSBzZWxmLl9sZW47DQp9DQp9DQoNCnJldHVybiByZXQ7DQp9DQp9DQoNCg0KY29udHJhY3QgRFNTYWZlQWRkU3ViIHsNCmZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCnJlcXVpcmUoYSArIGIgPj0gYSk7DQpyZXR1cm4gYSArIGI7DQp9DQoNCmZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCnJlcXVpcmUoYiA8PSBhKTsNCnJldHVybiBhIC0gYjsNCn0NCn0NCg0KDQoNCmNvbnRyYWN0IFN3YW5yb2xsIGlzIHVzaW5nT3JhY2xpemUsIERTU2FmZUFkZFN1YiB7DQoNCnVzaW5nIHN0cmluZ3MgZm9yICo7DQoNCi8qDQogKiBjaGVja3MgcGxheWVyIHByb2ZpdCwgYmV0IHNpemUgYW5kIHBsYXllciBudW1iZXIgaXMgd2l0aGluIHJhbmdlDQoqLw0KbW9kaWZpZXIgYmV0SXNWYWxpZCh1aW50IF9iZXRTaXplLCB1aW50IF9wbGF5ZXJOdW1iZXIpIHsNCmlmICgoKCgoX2JldFNpemUgKiAoMTAwLSAoc2FmZVN1YihfcGxheWVyTnVtYmVyLCAxKSkpKSAvIChzYWZlU3ViKF9wbGF5ZXJOdW1iZXIsIDEpKSsgX2JldFNpemUpKSAqIGhvdXNlRWRnZSAvIGhvdXNlRWRnZURpdmlzb3IpIC1fYmV0U2l6ZSA+IG1heFByb2ZpdCB8fCBfYmV0U2l6ZSA8IG1pbkJldCB8fCBfcGxheWVyTnVtYmVyIDwgbWluTnVtYmVyIHx8IF9wbGF5ZXJOdW1iZXIgPiBtYXhOdW1iZXIpIHJlcXVpcmUoZmFsc2UpOw0KXzsNCn0NCg0KLyoNCiAqIGNoZWNrcyBnYW1lIGlzIGN1cnJlbnRseSBhY3RpdmUNCiovDQptb2RpZmllciBnYW1lSXNBY3RpdmUgew0KcmVxdWlyZShnYW1lUGF1c2VkICE9IHRydWUpOw0KXzsNCn0NCg0KLyoNCiAqIGNoZWNrcyBwYXlvdXRzIGFyZSBjdXJyZW50bHkgYWN0aXZlDQoqLw0KbW9kaWZpZXIgcGF5b3V0c0FyZUFjdGl2ZSB7DQpyZXF1aXJlKHBheW91dHNQYXVzZWQgIT0gdHJ1ZSk7DQpfOw0KfQ0KDQovKg0KICogY2hlY2tzIG9ubHkgT3JhY2xpemUgYWRkcmVzcyBpcyBjYWxsaW5nDQoqLw0KbW9kaWZpZXIgb25seU9yYWNsaXplIHsNCnJlcXVpcmUobXNnLnNlbmRlciA9PSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSk7DQpfOw0KfQ0KDQovKg0KICogY2hlY2tzIG9ubHkgb3duZXIgYWRkcmVzcyBpcyBjYWxsaW5nDQoqLw0KbW9kaWZpZXIgb25seU93bmVyIHsNCnJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7DQpfOw0KfQ0KDQovKg0KICogY2hlY2tzIG9ubHkgdHJlYXN1cnkgYWRkcmVzcyBpcyBjYWxsaW5nDQoqLw0KbW9kaWZpZXIgb25seVRyZWFzdXJ5IHsNCnJlcXVpcmUobXNnLnNlbmRlciA9PSB0cmVhc3VyeSk7DQpfOw0KfQ0KDQovKg0KICogZ2FtZSB2YXJzDQoqLw0KdWludCBjb25zdGFudCBwdWJsaWMgbWF4UHJvZml0RGl2aXNvciA9IDEwMDAwMDA7DQp1aW50IGNvbnN0YW50IHB1YmxpYyBob3VzZUVkZ2VEaXZpc29yID0gMTAwMDsNCnVpbnQgY29uc3RhbnQgcHVibGljIG1heE51bWJlciA9IDk5Ow0KdWludCBjb25zdGFudCBwdWJsaWMgbWluTnVtYmVyID0gMjsNCmJvb2wgcHVibGljIGdhbWVQYXVzZWQ7DQp1aW50MzIgcHVibGljIGdhc0Zvck9yYWNsaXplOw0KYWRkcmVzcyBwdWJsaWMgb3duZXI7DQpib29sIHB1YmxpYyBwYXlvdXRzUGF1c2VkOw0KYWRkcmVzcyBwdWJsaWMgdHJlYXN1cnk7DQp1aW50IHB1YmxpYyBjb250cmFjdEJhbGFuY2U7DQp1aW50IHB1YmxpYyBob3VzZUVkZ2U7DQp1aW50IHB1YmxpYyBtYXhQcm9maXQ7DQp1aW50IHB1YmxpYyBtYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlOw0KdWludCBwdWJsaWMgbWluQmV0Ow0KLy9pbml0IGRpY29udGludWVkIGNvbnRyYWN0IGRhdGENCmludCBwdWJsaWMgdG90YWxCZXRzID0gMDsNCnVpbnQgcHVibGljIG1heFBlbmRpbmdQYXlvdXRzOw0KLy9pbml0IGRpY29udGludWVkIGNvbnRyYWN0IGRhdGENCnVpbnQgcHVibGljIHRvdGFsV2VpV29uID0gMDsNCi8vaW5pdCBkaWNvbnRpbnVlZCBjb250cmFjdCBkYXRhDQp1aW50IHB1YmxpYyB0b3RhbFdlaVdhZ2VyZWQgPSAwOw0KDQovKg0KICogcGxheWVyIHZhcnMNCiovDQptYXBwaW5nIChieXRlczMyID0+IGFkZHJlc3MpIHBsYXllckFkZHJlc3M7DQptYXBwaW5nIChieXRlczMyID0+IGFkZHJlc3MpIHBsYXllclRlbXBBZGRyZXNzOw0KbWFwcGluZyAoYnl0ZXMzMiA9PiBieXRlczMyKSBwbGF5ZXJCZXRJZDsNCm1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyQmV0VmFsdWU7DQptYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHBsYXllclRlbXBCZXRWYWx1ZTsNCm1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyRGllUmVzdWx0Ow0KbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJOdW1iZXI7DQptYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHBsYXllclBlbmRpbmdXaXRoZHJhd2FsczsNCm1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyUHJvZml0Ow0KbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJUZW1wUmV3YXJkOw0KDQovKg0KICogZXZlbnRzDQoqLw0KLyogbG9nIGJldHMgKyBvdXRwdXQgdG8gd2ViMyBmb3IgcHJlY2lzZSAncGF5b3V0IG9uIHdpbicgZmllbGQgaW4gVUkgKi8NCmV2ZW50IExvZ0JldChieXRlczMyIGluZGV4ZWQgQmV0SUQsIGFkZHJlc3MgaW5kZXhlZCBQbGF5ZXJBZGRyZXNzLCB1aW50IGluZGV4ZWQgUmV3YXJkVmFsdWUsIHVpbnQgUHJvZml0VmFsdWUsIHVpbnQgQmV0VmFsdWUsIHVpbnQgUGxheWVyTnVtYmVyKTsNCi8qIG91dHB1dCB0byB3ZWIzIFVJIG9uIGJldCByZXN1bHQqLw0KLyogU3RhdHVzOiAwPWxvc2UsIDE9d2luLCAyPXdpbiArIGZhaWxlZCBzZW5kLCAzPXJlZnVuZCwgND1yZWZ1bmQgKyBmYWlsZWQgc2VuZCovDQpldmVudCBMb2dSZXN1bHQodWludCBpbmRleGVkIFJlc3VsdFNlcmlhbE51bWJlciwgYnl0ZXMzMiBpbmRleGVkIEJldElELCBhZGRyZXNzIGluZGV4ZWQgUGxheWVyQWRkcmVzcywgdWludCBQbGF5ZXJOdW1iZXIsIHVpbnQgRGljZVJlc3VsdCwgdWludCBWYWx1ZSwgaW50IFN0YXR1cywgYnl0ZXMgUHJvb2YpOw0KLyogbG9nIG1hbnVhbCByZWZ1bmRzICovDQpldmVudCBMb2dSZWZ1bmQoYnl0ZXMzMiBpbmRleGVkIEJldElELCBhZGRyZXNzIGluZGV4ZWQgUGxheWVyQWRkcmVzcywgdWludCBpbmRleGVkIFJlZnVuZFZhbHVlKTsNCi8qIGxvZyBvd25lciB0cmFuc2ZlcnMgKi8NCmV2ZW50IExvZ093bmVyVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIFNlbnRUb0FkZHJlc3MsIHVpbnQgaW5kZXhlZCBBbW91bnRUcmFuc2ZlcnJlZCk7DQoNCg0KLyoNCiAqIGluaXQNCiovDQpmdW5jdGlvbiBTd2Fucm9sbCgpIHsNCg0Kb3duZXIgPSBtc2cuc2VuZGVyOw0KdHJlYXN1cnkgPSBtc2cuc2VuZGVyOw0KDQpvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsNCi8qIHVzZSBUTFNOb3RhcnkgZm9yIG9yYWNsaXplIGNhbGwgKi8NCm9yYWNsaXplX3NldFByb29mKHByb29mVHlwZV9UTFNOb3RhcnkgfCBwcm9vZlN0b3JhZ2VfSVBGUyk7DQovKiBpbml0IDk5MCA9IDk5JSAoMSUgaG91c2VFZGdlKSovDQpvd25lclNldEhvdXNlRWRnZSg5OTApOw0KLyogaW5pdCAxMCwwMDAgPSAxJSAgKi8NCm93bmVyU2V0TWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSgxMDAwMDApOw0KLyogaW5pdCBtaW4gYmV0ICgwLjEgZXRoZXIpICovDQpvd25lclNldE1pbkJldCgxMDAwMDAwMDAwMDAwMDAwMDApOw0KLyogaW5pdCBnYXMgZm9yIG9yYWNsaXplICovDQpnYXNGb3JPcmFjbGl6ZSA9IDI1MDAwMDsNCg0KfQ0KDQovKg0KICogcHVibGljIGZ1bmN0aW9uDQogKiBwbGF5ZXIgc3VibWl0IGJldA0KICogb25seSBpZiBnYW1lIGlzIGFjdGl2ZSAmIGJldCBpcyB2YWxpZCBjYW4gcXVlcnkgb3JhY2xpemUgYW5kIHNldCBwbGF5ZXIgdmFycw0KKi8NCmZ1bmN0aW9uIHBsYXllclJvbGxEaWNlKHVpbnQgcm9sbFVuZGVyKSBwdWJsaWMNCnBheWFibGUNCmdhbWVJc0FjdGl2ZQ0KYmV0SXNWYWxpZChtc2cudmFsdWUsIHJvbGxVbmRlcikNCnsNCg0KDQovKiBzYWZlbHkgdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2UgdG8gYWNjb3VudCBmb3IgY29zdCB0byBjYWxsIG9yYWNsaXplKi8NCmNvbnRyYWN0QmFsYW5jZSA9IHNhZmVTdWIoY29udHJhY3RCYWxhbmNlLCBvcmFjbGl6ZV9nZXRQcmljZSgiVVJMIiwgZ2FzRm9yT3JhY2xpemUpKTsNCg0KLyogdG90YWwgbnVtYmVyIG9mIGJldHMgKi8NCnRvdGFsQmV0cyArPSAxOw0KDQovKiB0b3RhbCB3YWdlcmVkICovDQp0b3RhbFdlaVdhZ2VyZWQgKz0gbXNnLnZhbHVlOw0KDQovKg0KKiBhc3NpZ24gcGFydGlhbGx5IGVuY3J5cHRlZCBxdWVyeSB0byBvcmFjbGl6ZQ0KKiBvbmx5IHRoZSBhcGlLZXkgaXMgZW5jcnlwdGVkDQoqIGludGVnZXIgcXVlcnkgaXMgaW4gcGxhaW4gdGV4dA0KKi8NCmJ5dGVzMzIgcm5nSWQgPSBvcmFjbGl6ZV9xdWVyeSgibmVzdGVkIiwgIltVUkxdIFsnanNvbihodHRwczovL2FwaS5yYW5kb20ub3JnL2pzb24tcnBjLzEvaW52b2tlKS5yZXN1bHQucmFuZG9tW1wic2VyaWFsTnVtYmVyXCIsXCJkYXRhXCJdJywgJ1xcbntcImpzb25ycGNcIjpcIjIuMFwiLFwibWV0aG9kXCI6XCJnZW5lcmF0ZVNpZ25lZEludGVnZXJzXCIsXCJwYXJhbXNcIjp7XCJhcGlLZXlcIjoke1tkZWNyeXB0XSBCR3JFeVRCQmJxeW5jaU9EbE9TZmN2aFF0cStwczRrSFhjanlZWWdHYWZ2RzFuaEkzcFVCZE5vSnBHaGdLNm81K05MdGhWRmZZQURvMlV5U1JXTXhnQlFtY3hUQzB3eFFYcUpsb1BDUG5PcVp4Q2xWbjdERHJSdTNCWkJBRDlNQjVVRmVHRzd5NWkyY09LbGU4NTFBNVdYM1QwK3F9LFwiblwiOjEsXCJtaW5cIjoxLFwibWF4XCI6MTAwLFwicmVwbGFjZW1lbnRcIjp0cnVlLFwiYmFzZVwiOjEwJHtbaWRlbnRpdHldIFwifVwifSxcImlkXCI6MSR7W2lkZW50aXR5XSBcIn1cIn0nXSIsIGdhc0Zvck9yYWNsaXplKTsNCg0KLyogbWFwIGJldCBpZCB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovDQpwbGF5ZXJCZXRJZFtybmdJZF0gPSBybmdJZDsNCi8qIG1hcCBwbGF5ZXIgbHVja3kgbnVtYmVyIHRvIHRoaXMgb3JhY2xpemUgcXVlcnkgKi8NCnBsYXllck51bWJlcltybmdJZF0gPSByb2xsVW5kZXI7DQovKiBtYXAgdmFsdWUgb2Ygd2FnZXIgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLw0KcGxheWVyQmV0VmFsdWVbcm5nSWRdID0gbXNnLnZhbHVlOw0KLyogbWFwIHBsYXllciBhZGRyZXNzIHRvIHRoaXMgb3JhY2xpemUgcXVlcnkgKi8NCnBsYXllckFkZHJlc3Nbcm5nSWRdID0gbXNnLnNlbmRlcjsNCi8qIHNhZmVseSBtYXAgcGxheWVyIHByb2ZpdCB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovDQpwbGF5ZXJQcm9maXRbcm5nSWRdID0gKCgoKG1zZy52YWx1ZSAqICgxMDAgLSAoc2FmZVN1Yihyb2xsVW5kZXIsIDEpKSkpIC8gKHNhZmVTdWIocm9sbFVuZGVyLDEpKSArIG1zZy52YWx1ZSkpICpob3VzZUVkZ2UgLyBob3VzZUVkZ2VEaXZpc29yKSAtIG1zZy52YWx1ZTsNCi8qIHNhZmVseSBpbmNyZWFzZSBtYXhQZW5kaW5nUGF5b3V0cyBsaWFiaWxpdHkgLSBjYWxjIGFsbCBwZW5kaW5nIHBheW91dHMgdW5kZXIgYXNzdW1wdGlvbiB0aGV5IHdpbiAqLw0KbWF4UGVuZGluZ1BheW91dHMgPSBzYWZlQWRkKG1heFBlbmRpbmdQYXlvdXRzLCBwbGF5ZXJQcm9maXRbcm5nSWRdKTsNCi8qIGNoZWNrIGNvbnRyYWN0IGNhbiBwYXlvdXQgb24gd2luICovDQpyZXF1aXJlKG1heFBlbmRpbmdQYXlvdXRzIDwgY29udHJhY3RCYWxhbmNlKTsNCi8qIHByb3ZpZGVzIGFjY3VyYXRlIG51bWJlcnMgZm9yIHdlYjMgYW5kIGFsbG93cyBmb3IgbWFudWFsIHJlZnVuZHMgaW4gY2FzZSBvZiBubyBvcmFjbGl6ZSBfX2NhbGxiYWNrICovDQpMb2dCZXQocGxheWVyQmV0SWRbcm5nSWRdLCBwbGF5ZXJBZGRyZXNzW3JuZ0lkXSwgc2FmZUFkZChwbGF5ZXJCZXRWYWx1ZVtybmdJZF0sIHBsYXllclByb2ZpdFtybmdJZF0pLCBwbGF5ZXJQcm9maXRbcm5nSWRdLCBwbGF5ZXJCZXRWYWx1ZVtybmdJZF0sIHBsYXllck51bWJlcltybmdJZF0pOw0KDQp9DQoNCg0KLyoNCiogc2VtaS1wdWJsaWMgZnVuY3Rpb24gLSBvbmx5IG9yYWNsaXplIGNhbiBjYWxsDQoqLw0KLypUTFNOb3RhcnkgZm9yIG9yYWNsaXplIGNhbGwgKi8NCmZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgcHVibGljDQpvbmx5T3JhY2xpemUNCnBheW91dHNBcmVBY3RpdmUNCnsNCg0KLyogcGxheWVyIGFkZHJlc3MgbWFwcGVkIHRvIHF1ZXJ5IGlkIGRvZXMgbm90IGV4aXN0ICovDQpyZXF1aXJlKHBsYXllckFkZHJlc3NbbXlpZF0gIT0gMHgwKTsNCg0KLyoga2VlcCBvcmFjbGl6ZSBob25lc3QgYnkgcmV0cmlldmluZyB0aGUgc2VyaWFsTnVtYmVyIGZyb20gcmFuZG9tLm9yZyByZXN1bHQgKi8NCnZhciBzbF9yZXN1bHQgPSByZXN1bHQudG9TbGljZSgpOw0Kc2xfcmVzdWx0LmJleW9uZCgiWyIudG9TbGljZSgpKS51bnRpbCgiXSIudG9TbGljZSgpKTsNCnVpbnQgc2VyaWFsTnVtYmVyT2ZSZXN1bHQgPSBwYXJzZUludChzbF9yZXN1bHQuc3BsaXQoJywgJy50b1NsaWNlKCkpLnRvU3RyaW5nKCkpOw0KDQovKiBtYXAgcmVzdWx0IHRvIHBsYXllciAqLw0KcGxheWVyRGllUmVzdWx0W215aWRdID0gcGFyc2VJbnQoc2xfcmVzdWx0LmJleW9uZCgiWyIudG9TbGljZSgpKS51bnRpbCgiXSIudG9TbGljZSgpKS50b1N0cmluZygpKTsNCg0KLyogZ2V0IHRoZSBwbGF5ZXJBZGRyZXNzIGZvciB0aGlzIHF1ZXJ5IGlkICovDQpwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSA9IHBsYXllckFkZHJlc3NbbXlpZF07DQovKiBkZWxldGUgcGxheWVyQWRkcmVzcyBmb3IgdGhpcyBxdWVyeSBpZCAqLw0KZGVsZXRlIHBsYXllckFkZHJlc3NbbXlpZF07DQoNCi8qIG1hcCB0aGUgcGxheWVyUHJvZml0IGZvciB0aGlzIHF1ZXJ5IGlkICovDQpwbGF5ZXJUZW1wUmV3YXJkW215aWRdID0gcGxheWVyUHJvZml0W215aWRdOw0KLyogc2V0ICBwbGF5ZXJQcm9maXQgZm9yIHRoaXMgcXVlcnkgaWQgdG8gMCAqLw0KcGxheWVyUHJvZml0W215aWRdID0gMDsNCg0KLyogc2FmZWx5IHJlZHVjZSBtYXhQZW5kaW5nUGF5b3V0cyBsaWFiaWxpdHkgKi8NCm1heFBlbmRpbmdQYXlvdXRzID0gc2FmZVN1YihtYXhQZW5kaW5nUGF5b3V0cywgcGxheWVyVGVtcFJld2FyZFtteWlkXSk7DQoNCi8qIG1hcCB0aGUgcGxheWVyQmV0VmFsdWUgZm9yIHRoaXMgcXVlcnkgaWQgKi8NCnBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSA9IHBsYXllckJldFZhbHVlW215aWRdOw0KLyogc2V0ICBwbGF5ZXJCZXRWYWx1ZSBmb3IgdGhpcyBxdWVyeSBpZCB0byAwICovDQpwbGF5ZXJCZXRWYWx1ZVtteWlkXSA9IDA7DQoNCi8qDQoqIHJlZnVuZA0KKiBpZiByZXN1bHQgaXMgMCByZXN1bHQgaXMgZW1wdHkgb3Igbm8gcHJvb2YgcmVmdW5kIG9yaWdpbmFsIGJldCB2YWx1ZQ0KKiBpZiByZWZ1bmQgZmFpbHMgc2F2ZSByZWZ1bmQgdmFsdWUgdG8gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzDQoqLw0KaWYgKHBsYXllckRpZVJlc3VsdFtteWlkXT09IDAgfHwgYnl0ZXMocmVzdWx0KS5sZW5ndGggPT0gMCB8fCBieXRlcyhwcm9vZikubGVuZ3RoID09IDApew0KDQpMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgMywgcHJvb2YpOw0KDQovKg0KKiBzZW5kIHJlZnVuZCAtIGV4dGVybmFsIGNhbGwgdG8gYW4gdW50cnVzdGVkIGNvbnRyYWN0DQoqIGlmIHNlbmQgZmFpbHMgbWFwIHJlZnVuZCB2YWx1ZSB0byBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbYWRkcmVzc10NCiogZm9yIHdpdGhkcmF3YWwgbGF0ZXIgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucw0KKi8NCmlmICghcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0uc2VuZChwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0pKXsNCkxvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdLCA0LCBwcm9vZik7DQovKiBpZiBzZW5kIGZhaWxlZCBsZXQgcGxheWVyIHdpdGhkcmF3IHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMgKi8NCnBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0gPSBzYWZlQWRkKHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSk7DQp9DQoNCnJldHVybjsNCn0NCg0KLyoNCiogcGF5IHdpbm5lcg0KKiB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSB0byBjYWxjdWxhdGUgbmV3IG1heCBiZXQNCiogc2VuZCByZXdhcmQNCiogaWYgc2VuZCBvZiByZXdhcmQgZmFpbHMgc2F2ZSB2YWx1ZSB0byBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHMNCiovDQppZiAocGxheWVyRGllUmVzdWx0W215aWRdIDwgcGxheWVyTnVtYmVyW215aWRdKXsNCg0KLyogc2FmZWx5IHJlZHVjZSBjb250cmFjdCBiYWxhbmNlIGJ5IHBsYXllciBwcm9maXQgKi8NCmNvbnRyYWN0QmFsYW5jZSA9IHNhZmVTdWIoY29udHJhY3RCYWxhbmNlLCBwbGF5ZXJUZW1wUmV3YXJkW215aWRdKTsNCg0KLyogdXBkYXRlIHRvdGFsIHdlaSB3b24gKi8NCnRvdGFsV2VpV29uID0gc2FmZUFkZCh0b3RhbFdlaVdvbiwgcGxheWVyVGVtcFJld2FyZFtteWlkXSk7DQoNCi8qIHNhZmVseSBjYWxjdWxhdGUgcGF5b3V0IHZpYSBwcm9maXQgcGx1cyBvcmlnaW5hbCB3YWdlciAqLw0KcGxheWVyVGVtcFJld2FyZFtteWlkXSA9IHNhZmVBZGQocGxheWVyVGVtcFJld2FyZFtteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdKTsNCg0KTG9nUmVzdWx0KHNlcmlhbE51bWJlck9mUmVzdWx0LCBwbGF5ZXJCZXRJZFtteWlkXSwgcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0sIHBsYXllck51bWJlcltteWlkXSwgcGxheWVyRGllUmVzdWx0W215aWRdLCBwbGF5ZXJUZW1wUmV3YXJkW215aWRdLCAxLCBwcm9vZik7DQoNCi8qIHVwZGF0ZSBtYXhpbXVtIHByb2ZpdCAqLw0Kc2V0TWF4UHJvZml0KCk7DQoNCi8qDQoqIHNlbmQgd2luIC0gZXh0ZXJuYWwgY2FsbCB0byBhbiB1bnRydXN0ZWQgY29udHJhY3QNCiogaWYgc2VuZCBmYWlscyBtYXAgcmV3YXJkIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1thZGRyZXNzXQ0KKiBmb3Igd2l0aGRyYXdhbCBsYXRlciB2aWEgcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zDQoqLw0KaWYgKCFwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXS5zZW5kKHBsYXllclRlbXBSZXdhcmRbbXlpZF0pKXsNCkxvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcFJld2FyZFtteWlkXSwgMiwgcHJvb2YpOw0KLyogaWYgc2VuZCBmYWlsZWQgbGV0IHBsYXllciB3aXRoZHJhdyB2aWEgcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zICovDQpwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dID0gc2FmZUFkZChwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dLCBwbGF5ZXJUZW1wUmV3YXJkW215aWRdKTsNCn0NCg0KcmV0dXJuOw0KDQp9DQoNCi8qDQoqIG5vIHdpbg0KKiBzZW5kIDEgd2VpIHRvIGEgbG9zaW5nIGJldA0KKiB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSB0byBjYWxjdWxhdGUgbmV3IG1heCBiZXQNCiovDQppZiAocGxheWVyRGllUmVzdWx0W215aWRdID49IHBsYXllck51bWJlcltteWlkXSl7DQoNCkxvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdLCAwLCBwcm9vZik7DQoNCi8qDQoqICBzYWZlIGFkanVzdCBjb250cmFjdEJhbGFuY2UNCiogIHNldE1heFByb2ZpdA0KKiAgc2VuZCAxIHdlaSB0byBsb3NpbmcgYmV0DQoqLw0KY29udHJhY3RCYWxhbmNlID0gc2FmZUFkZChjb250cmFjdEJhbGFuY2UsIChwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0gLSAxKSk7DQoNCi8qIHVwZGF0ZSBtYXhpbXVtIHByb2ZpdCAqLw0Kc2V0TWF4UHJvZml0KCk7DQoNCi8qDQoqIHNlbmQgMSB3ZWkgLSBleHRlcm5hbCBjYWxsIHRvIGFuIHVudHJ1c3RlZCBjb250cmFjdA0KKi8NCmlmICghcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0uc2VuZCgxKSl7DQovKiBpZiBzZW5kIGZhaWxlZCBsZXQgcGxheWVyIHdpdGhkcmF3IHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMgKi8NCnBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0gPSBzYWZlQWRkKHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0sIDEpOw0KfQ0KDQpyZXR1cm47DQoNCn0NCg0KfQ0KDQovKg0KKiBwdWJsaWMgZnVuY3Rpb24NCiogaW4gY2FzZSBvZiBhIGZhaWxlZCByZWZ1bmQgb3Igd2luIHNlbmQNCiovDQpmdW5jdGlvbiBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMoKSBwdWJsaWMNCnBheW91dHNBcmVBY3RpdmUNCnJldHVybnMgKGJvb2wpDQp7DQp1aW50IHdpdGhkcmF3QW1vdW50ID0gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdOw0KcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdID0gMDsNCi8qIGV4dGVybmFsIGNhbGwgdG8gdW50cnVzdGVkIGNvbnRyYWN0ICovDQppZiAobXNnLnNlbmRlci5jYWxsLnZhbHVlKHdpdGhkcmF3QW1vdW50KSgpKSB7DQpyZXR1cm4gdHJ1ZTsNCn0gZWxzZSB7DQovKiBpZiBzZW5kIGZhaWxlZCByZXZlcnQgcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdID0gMDsgKi8NCi8qIHBsYXllciBjYW4gdHJ5IHRvIHdpdGhkcmF3IGFnYWluIGxhdGVyICovDQpwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSB3aXRoZHJhd0Ftb3VudDsNCnJldHVybiBmYWxzZTsNCn0NCn0NCg0KLyogY2hlY2sgZm9yIHBlbmRpbmcgd2l0aGRyYXdhbHMgICovDQpmdW5jdGlvbiBwbGF5ZXJHZXRQZW5kaW5nVHhCeUFkZHJlc3MoYWRkcmVzcyBhZGRyZXNzVG9DaGVjaykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCnJldHVybiBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbYWRkcmVzc1RvQ2hlY2tdOw0KfQ0KDQovKg0KKiBpbnRlcm5hbCBmdW5jdGlvbg0KKiBzZXRzIG1heCBwcm9maXQNCiovDQpmdW5jdGlvbiBzZXRNYXhQcm9maXQoKSBpbnRlcm5hbCB7DQptYXhQcm9maXQgPSAoY29udHJhY3RCYWxhbmNlICogbWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSkgLyBtYXhQcm9maXREaXZpc29yOw0KfQ0KDQovKg0KKiBvd25lci90cmVhc3VyeSBhZGRyZXNzIG9ubHkgZnVuY3Rpb25zDQoqLw0KZnVuY3Rpb24gKCkNCnBheWFibGUNCm9ubHlUcmVhc3VyeQ0Kew0KLyogc2FmZWx5IHVwZGF0ZSBjb250cmFjdCBiYWxhbmNlICovDQpjb250cmFjdEJhbGFuY2UgPSBzYWZlQWRkKGNvbnRyYWN0QmFsYW5jZSwgbXNnLnZhbHVlKTsNCi8qIHVwZGF0ZSB0aGUgbWF4aW11bSBwcm9maXQgKi8NCnNldE1heFByb2ZpdCgpOw0KfQ0KDQovKiBzZXQgZ2FzIGZvciBvcmFjbGl6ZSBxdWVyeSAqLw0KZnVuY3Rpb24gb3duZXJTZXRPcmFjbGl6ZVNhZmVHYXModWludDMyIG5ld1NhZmVHYXNUb09yYWNsaXplKSBwdWJsaWMNCm9ubHlPd25lcg0Kew0KZ2FzRm9yT3JhY2xpemUgPSBuZXdTYWZlR2FzVG9PcmFjbGl6ZTsNCn0NCg0KLyogb25seSBvd25lciBhZGp1c3QgY29udHJhY3QgYmFsYW5jZSB2YXJpYWJsZSAob25seSB1c2VkIGZvciBtYXggcHJvZml0IGNhbGMpICovDQpmdW5jdGlvbiBvd25lclVwZGF0ZUNvbnRyYWN0QmFsYW5jZSh1aW50IG5ld0NvbnRyYWN0QmFsYW5jZUluV2VpKSBwdWJsaWMNCm9ubHlPd25lcg0Kew0KY29udHJhY3RCYWxhbmNlID0gbmV3Q29udHJhY3RCYWxhbmNlSW5XZWk7DQp9DQoNCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IGhvdXNlRWRnZSAqLw0KZnVuY3Rpb24gb3duZXJTZXRIb3VzZUVkZ2UodWludCBuZXdIb3VzZUVkZ2UpIHB1YmxpYw0Kb25seU93bmVyDQp7DQpob3VzZUVkZ2UgPSBuZXdIb3VzZUVkZ2U7DQp9DQoNCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IG1heFByb2ZpdEFzUGVyY2VudE9mSG91c2UgKi8NCmZ1bmN0aW9uIG93bmVyU2V0TWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSh1aW50IG5ld01heFByb2ZpdEFzUGVyY2VudCkgcHVibGljDQpvbmx5T3duZXINCnsNCi8qIHJlc3RyaWN0IGVhY2ggYmV0IHRvIGEgbWF4aW11bSBwcm9maXQgb2YgMTAlIGNvbnRyYWN0QmFsYW5jZSAqLw0KcmVxdWlyZShuZXdNYXhQcm9maXRBc1BlcmNlbnQgPD0gMTAwMDAwKTsNCm1heFByb2ZpdEFzUGVyY2VudE9mSG91c2UgPSBuZXdNYXhQcm9maXRBc1BlcmNlbnQ7DQpzZXRNYXhQcm9maXQoKTsNCn0NCg0KLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgbWluQmV0ICovDQpmdW5jdGlvbiBvd25lclNldE1pbkJldCh1aW50IG5ld01pbmltdW1CZXQpIHB1YmxpYw0Kb25seU93bmVyDQp7DQptaW5CZXQgPSBuZXdNaW5pbXVtQmV0Ow0KfQ0KDQovKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHRyYW5zZmVyIGV0aGVyICovDQpmdW5jdGlvbiBvd25lclRyYW5zZmVyRXRoZXIoYWRkcmVzcyBzZW5kVG8sIHVpbnQgYW1vdW50KSBwdWJsaWMNCm9ubHlPd25lcg0Kew0KLyogc2FmZWx5IHVwZGF0ZSBjb250cmFjdCBiYWxhbmNlIHdoZW4gc2VuZGluZyBvdXQgZnVuZHMqLw0KY29udHJhY3RCYWxhbmNlID0gc2FmZVN1Yihjb250cmFjdEJhbGFuY2UsIGFtb3VudCk7DQovKiB1cGRhdGUgbWF4IHByb2ZpdCAqLw0Kc2V0TWF4UHJvZml0KCk7DQpyZXF1aXJlKHNlbmRUby5zZW5kKGFtb3VudCkpOw0KTG9nT3duZXJUcmFuc2ZlcihzZW5kVG8sIGFtb3VudCk7DQp9DQoNCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gZG8gbWFudWFsIHJlZnVuZA0KKiB1c2VkIG9ubHkgaWYgYmV0IHBsYWNlZCArIG9yYWNsaXplIGZhaWxlZCB0byBfX2NhbGxiYWNrDQoqIGZpbHRlciBMb2dCZXQgYnkgYWRkcmVzcyBhbmQvb3IgcGxheWVyQmV0SWQ6DQoqIExvZ0JldChwbGF5ZXJCZXRJZFtybmdJZF0sIHBsYXllckFkZHJlc3Nbcm5nSWRdLCBzYWZlQWRkKHBsYXllckJldFZhbHVlW3JuZ0lkXSwgcGxheWVyUHJvZml0W3JuZ0lkXSksIHBsYXllclByb2ZpdFtybmdJZF0sIHBsYXllckJldFZhbHVlW3JuZ0lkXSwgcGxheWVyTnVtYmVyW3JuZ0lkXSk7DQoqIGNoZWNrIHRoZSBmb2xsb3dpbmcgbG9ncyBkbyBub3QgZXhpc3QgZm9yIHBsYXllckJldElkIGFuZC9vciBwbGF5ZXJBZGRyZXNzW3JuZ0lkXSBiZWZvcmUgcmVmdW5kaW5nOg0KKiBMb2dSZXN1bHQgb3IgTG9nUmVmdW5kDQoqIGlmIExvZ1Jlc3VsdCBleGlzdHMgcGxheWVyIHNob3VsZCB1c2UgdGhlIHdpdGhkcmF3IHBhdHRlcm4gcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zDQoqLw0KZnVuY3Rpb24gb3duZXJSZWZ1bmRQbGF5ZXIoYnl0ZXMzMiBvcmlnaW5hbFBsYXllckJldElkLCBhZGRyZXNzIHNlbmRUbywgdWludCBvcmlnaW5hbFBsYXllclByb2ZpdCwgdWludCBvcmlnaW5hbFBsYXllckJldFZhbHVlKSBwdWJsaWMNCm9ubHlPd25lcg0Kew0KLyogc2FmZWx5IHJlZHVjZSBwZW5kaW5nUGF5b3V0cyBieSBwbGF5ZXJQcm9maXRbcm5nSWRdICovDQptYXhQZW5kaW5nUGF5b3V0cyA9IHNhZmVTdWIobWF4UGVuZGluZ1BheW91dHMsIG9yaWdpbmFsUGxheWVyUHJvZml0KTsNCi8qIHNlbmQgcmVmdW5kICovDQpyZXF1aXJlKHNlbmRUby5zZW5kKG9yaWdpbmFsUGxheWVyQmV0VmFsdWUpKTsNCi8qIGxvZyByZWZ1bmRzICovDQpMb2dSZWZ1bmQob3JpZ2luYWxQbGF5ZXJCZXRJZCwgc2VuZFRvLCBvcmlnaW5hbFBsYXllckJldFZhbHVlKTsNCn0NCg0KLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgZW1lcmdlbmN5IHBhdXNlICMxICovDQpmdW5jdGlvbiBvd25lclBhdXNlR2FtZShib29sIG5ld1N0YXR1cykgcHVibGljDQpvbmx5T3duZXINCnsNCmdhbWVQYXVzZWQgPSBuZXdTdGF0dXM7DQp9DQoNCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IGVtZXJnZW5jeSBwYXVzZSAjMiAqLw0KZnVuY3Rpb24gb3duZXJQYXVzZVBheW91dHMoYm9vbCBuZXdQYXlvdXRTdGF0dXMpIHB1YmxpYw0Kb25seU93bmVyDQp7DQpwYXlvdXRzUGF1c2VkID0gbmV3UGF5b3V0U3RhdHVzOw0KfQ0KDQovKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCB0cmVhc3VyeSBhZGRyZXNzICovDQpmdW5jdGlvbiBvd25lclNldFRyZWFzdXJ5KGFkZHJlc3MgbmV3VHJlYXN1cnkpIHB1YmxpYw0Kb25seU93bmVyDQp7DQp0cmVhc3VyeSA9IG5ld1RyZWFzdXJ5Ow0KfQ0KDQovKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBvd25lciBhZGRyZXNzICovDQpmdW5jdGlvbiBvd25lckNoYW5nZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYw0Kb25seU93bmVyDQp7DQpvd25lciA9IG5ld093bmVyOw0KfQ0KDQovKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHN1aWNpZGUgLSBlbWVyZ2VuY3kgKi8NCmZ1bmN0aW9uIG93bmVya2lsbCgpIHB1YmxpYw0Kb25seU93bmVyDQp7DQpzdWljaWRlKG93bmVyKTsNCn0NCg0KDQp9'