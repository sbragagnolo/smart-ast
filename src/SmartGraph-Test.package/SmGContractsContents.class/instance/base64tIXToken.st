base 64 content
base64tIXToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KDQovKioNCiAqIEB0aXRsZSBTYWZlTWF0aA0KICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3INCiAqLw0KbGlicmFyeSBTYWZlTWF0aCB7DQogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1Nikgew0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOw0KICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDANCiAgICB1aW50MjU2IGMgPSBhIC8gYjsNCiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZA0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgdWludDI1NiBjID0gYSArIGI7DQogICAgYXNzZXJ0KGMgPj0gYSk7DQogICAgcmV0dXJuIGM7DQogIH0NCn0NCg0KDQovKioNCiAqIEB0aXRsZSBFUkMyMEJhc2ljDQogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UNCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMA0KICovDQpjb250cmFjdCBFUkMyMEJhc2ljIHsNCiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7DQogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7DQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpOw0KICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsNCn0NCg0KDQovKioNCiAqIEB0aXRsZSBCYXNpYyB0b2tlbg0KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4gDQogKi8NCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7DQogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2Ow0KDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsNCg0KICAvKioNCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzDQogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4NCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuDQogICovDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgew0KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7DQogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7DQogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4NCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4gDQogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4NCiAgKi8NCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgfQ0KDQp9DQoNCg0KLyoqDQogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlDQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqLw0KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7DQogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOw0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKTsNCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOw0KICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsNCn0NCg0KDQovKioNCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbg0KICoNCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLg0KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wNCiAqLw0KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7DQoNCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOw0KDQoNCiAgLyoqDQogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcg0KICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tDQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bw0KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkDQogICAqLw0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSB7DQogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsNCg0KICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldA0KICAgIC8vIGlmIChfdmFsdWUgPiBfYWxsb3dhbmNlKSB0aHJvdzsNCg0KICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOw0KICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsNCiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7DQogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLg0KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuDQogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuDQogICAqLw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSB7DQoNCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYA0KICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90DQogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6DQogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5DQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsNCg0KICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOw0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4NCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLg0KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4NCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLg0KICAgKi8NCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgew0KICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOw0KICB9DQoNCn0NCg0KDQovKioNCiAqIEB0aXRsZSBTdGFsbGVkIEVSQzIwIHRva2VuDQogKi8NCmNvbnRyYWN0IFRJWFN0YWxsZWRUb2tlbiB7DQogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZDsgLy8gc3dpdGNoZWQgdG8gdHJ1ZSBpbiBvcGVyYXRpb25hbCBzdGF0ZQ0KICBhZGRyZXNzIHB1YmxpYyBldGhGdW5kRGVwb3NpdDsgLy8gZGVwb3NpdCBhZGRyZXNzIGZvciBFVEggZm9yIEJsb2NrdGl4DQoNCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsNCn0NCg0KDQovKioNCiAqIEB0aXRsZSBCbG9ja3RpeCBUb2tlbiBHZW5lcmF0aW9uIEV2ZW50IGNvbnRyYWN0DQogKg0KICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEJBVDogaHR0cHM6Ly9naXRodWIuY29tL2JyYXZlLWludGwvYmFzaWMtYXR0ZW50aW9uLXRva2VuLWNyb3dkc2FsZS9ibG9iL21hc3Rlci9jb250cmFjdHMvQkFUb2tlbi5zb2wNCiAqLw0KY29udHJhY3QgVElYVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7DQogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIGNvbnZlcnRlZDsgLy8gQ29udmVydGluZyBmcm9tIG9sZCB0b2tlbiBjb250cmFjdA0KDQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkJsb2NrdGl4IFRva2VuIjsNCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJUSVgiOw0KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7DQogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gIjEuMC4xIjsNCg0KICAgIC8vIGNyb3dkc2FsZSBwYXJhbWV0ZXJzDQogICAgYm9vbCBwdWJsaWMgaXNGaW5hbGl6ZWQ7ICAgICAgICAgICAgICAgICAgICAgIC8vIHN3aXRjaGVkIHRvIHRydWUgaW4gb3BlcmF0aW9uYWwgc3RhdGUNCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWUgPSAxNTAxMjcxOTk5OyAgICAgICAgLy8gY3Jvd2RzYWxlIHN0YXJ0IHRpbWUgKGluIHNlY29uZHMpIC0gdGhpcyB3aWxsIGJlIHNldCBvbmNlIHRoZSBjb252ZXJzaW9uIGlzIGRvbmUNCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBlbmRUaW1lID0gMTUwMTI3MTk5OTsgLy8gY3Jvd2RzYWxlIGVuZCB0aW1lIChpbiBzZWNvbmRzKQ0KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHRva2VuR2VuZXJhdGlvbkNhcCA9ICA2Mi41ICogKDEwKio2KSAqIDEwKipkZWNpbWFsczsgLy8gNjIuNW0gVElYDQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdG9rZW5FeGNoYW5nZVJhdGUgPSAxMDQxOw0KDQogICAgLy8gYWRkcmVzc2VzDQogICAgYWRkcmVzcyBwdWJsaWMgdGl4R2VuZXJhdGlvbkNvbnRyYWN0OyAvLyBjb250cmFjdCBhZGRyZXNzIGZvciBUSVggdjEgRnVuZGluZw0KICAgIGFkZHJlc3MgcHVibGljIGV0aEZ1bmREZXBvc2l0OyAgICAgICAgLy8gZGVwb3NpdCBhZGRyZXNzIGZvciBFVEggZm9yIEJsb2NrdGl4DQoNCiAgICAvKioNCiAgICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIGZpbmFsaXplZA0KICAgICovDQogICAgbW9kaWZpZXIgd2hlbkZpbmFsaXplZCgpIHsNCiAgICAgICAgaWYgKCFpc0ZpbmFsaXplZCkgdGhyb3c7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLyoqDQogICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgZmluYWxpemVkDQogICAgKi8NCiAgICBtb2RpZmllciB3aGVuTm90RmluYWxpemVkKCkgew0KICAgICAgICBpZiAoaXNGaW5hbGl6ZWQpIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8vIGVuc3VyZXMgdGhhdCB0aGUgY3VycmVudCB0aW1lIGlzIGJldHdlZW4gX3N0YXJ0VGltZSAoaW5jbHVzaXZlKSBhbmQgX2VuZFRpbWUgKGV4Y2x1c2l2ZSkNCiAgICBtb2RpZmllciBiZXR3ZWVuKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSkgew0KICAgICAgICBhc3NlcnQobm93ID49IF9zdGFydFRpbWUgJiYgbm93IDwgX2VuZFRpbWUpOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8vIHZlcmlmaWVzIHRoYXQgYW4gYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiB6ZXJvDQogICAgbW9kaWZpZXIgdmFsaWRBbW91bnQoKSB7DQogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgLy8gdmFsaWRhdGVzIGFuIGFkZHJlc3MgLSBjdXJyZW50bHkgb25seSBjaGVja3MgdGhhdCBpdCBpc24ndCBudWxsDQogICAgbW9kaWZpZXIgdmFsaWRBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHsNCiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAweDApOw0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8vIGV2ZW50cw0KICAgIGV2ZW50IENyZWF0ZVRJWChhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7DQoNCiAgICAvKioNCiAgICAqIEBkZXYgQ29udHJ1Y3RvciB0aGF0IGFzc2lnbnMgYWxsIHByZXNhbGUgdG9rZW5zIGFuZCBzdGFydHMgdGhlIHNhbGUNCiAgICAqLw0KICAgIGZ1bmN0aW9uIFRJWFRva2VuKGFkZHJlc3MgX3RpeEdlbmVyYXRpb25Db250cmFjdCkNCiAgICB7DQogICAgICAgIGlzRmluYWxpemVkID0gZmFsc2U7IC8vIEluaXRpYWxpemUgcHJlc2FsZQ0KICAgICAgICB0aXhHZW5lcmF0aW9uQ29udHJhY3QgPSBfdGl4R2VuZXJhdGlvbkNvbnRyYWN0Ow0KICAgICAgICBldGhGdW5kRGVwb3NpdCA9IFRJWFN0YWxsZWRUb2tlbih0aXhHZW5lcmF0aW9uQ29udHJhY3QpLmV0aEZ1bmREZXBvc2l0KCk7DQogICAgfQ0KDQoNCiAgICAvKioNCiAgICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MNCiAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uDQogICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuDQogICAgKg0KICAgICogY2FuIG9ubHkgYmUgY2FsbGVkIGR1cmluZyBvbmNlIHRoZSB0aGUgZnVuZGluZyBwZXJpb2QgaGFzIGJlZW4gZmluYWxpemVkDQogICAgKi8NCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHdoZW5GaW5hbGl6ZWQgew0KICAgICAgICBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXINCiAgICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20NCiAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bw0KICAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZA0KICAgICoNCiAgICAqIGNhbiBvbmx5IGJlIGNhbGxlZCBkdXJpbmcgb25jZSB0aGUgdGhlIGZ1bmRpbmcgcGVyaW9kIGhhcyBiZWVuIGZpbmFsaXplZA0KICAgICovDQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgd2hlbkZpbmFsaXplZCB7DQogICAgICAgIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgQWNjZXB0cyBFVEggYW5kIGdlbmVyYXRlcyBUSVggdG9rZW5zDQogICAgICoNCiAgICAgKiBjYW4gb25seSBiZSBjYWxsZWQgZHVyaW5nIHRoZSBjcm93ZHNhbGUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucygpDQogICAgICAgIHB1YmxpYw0KICAgICAgICBwYXlhYmxlDQogICAgICAgIHdoZW5Ob3RGaW5hbGl6ZWQNCiAgICAgICAgYmV0d2VlbihzdGFydFRpbWUsIGVuZFRpbWUpDQogICAgICAgIHZhbGlkQW1vdW50DQogICAgew0KICAgICAgICBpZiAodG90YWxTdXBwbHkgPT0gdG9rZW5HZW5lcmF0aW9uQ2FwKQ0KICAgICAgICAgICAgdGhyb3c7DQoNCiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBTYWZlTWF0aC5tdWwobXNnLnZhbHVlLCB0b2tlbkV4Y2hhbmdlUmF0ZSk7IC8vIGNoZWNrIHRoYXQgd2UncmUgbm90IG92ZXIgdG90YWxzDQogICAgICAgIHVpbnQyNTYgY2hlY2tlZFN1cHBseSA9IFNhZmVNYXRoLmFkZCh0b3RhbFN1cHBseSwgdG9rZW5zKTsNCiAgICAgICAgdWludDI1NiBkaWZmOw0KDQogICAgICAgIC8vIHJldHVybiBpZiBzb21ldGhpbmcgZ29lcyB3cm9uZw0KICAgICAgICBpZiAodG9rZW5HZW5lcmF0aW9uQ2FwIDwgY2hlY2tlZFN1cHBseSkNCiAgICAgICAgew0KICAgICAgICAgICAgZGlmZiA9IFNhZmVNYXRoLnN1YihjaGVja2VkU3VwcGx5LCB0b2tlbkdlbmVyYXRpb25DYXApOw0KICAgICAgICAgICAgaWYgKGRpZmYgPiAxMCoqMTIpDQogICAgICAgICAgICAgICAgdGhyb3c7DQogICAgICAgICAgICBjaGVja2VkU3VwcGx5ID0gU2FmZU1hdGguc3ViKGNoZWNrZWRTdXBwbHksIGRpZmYpOw0KICAgICAgICAgICAgdG9rZW5zID0gU2FmZU1hdGguc3ViKHRva2VucywgZGlmZik7DQogICAgICAgIH0NCg0KICAgICAgICB0b3RhbFN1cHBseSA9IGNoZWNrZWRTdXBwbHk7DQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IHRva2VuczsNCiAgICAgICAgQ3JlYXRlVElYKG1zZy5zZW5kZXIsIHRva2Vucyk7IC8vIGxvZ3MgdG9rZW4gY3JlYXRpb24NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBoYXNDb252ZXJ0ZWQoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKGJvb2wpDQogICAgew0KICAgICAgcmV0dXJuIGNvbnZlcnRlZFt3aG9dOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNvbnZlcnQoYWRkcmVzcyBfb3duZXIpDQogICAgICAgIGV4dGVybmFsDQogICAgew0KICAgICAgICBUSVhTdGFsbGVkVG9rZW4gdGl4U3RhbGxlZCA9IFRJWFN0YWxsZWRUb2tlbih0aXhHZW5lcmF0aW9uQ29udHJhY3QpOw0KICAgICAgICBpZiAodGl4U3RhbGxlZC5pc0ZpbmFsaXplZCgpKSB0aHJvdzsgLy8gV2UgY2FuJ3QgY29udmVydCB0b2tlbnMgYWZ0ZXIgdGhlIGNvbnRyYWN0IGlzIGZpbmFsaXplZA0KICAgICAgICBpZiAoY29udmVydGVkW19vd25lcl0pIHRocm93OyAvLyBUaHJvdyBpZiB0aGV5IGhhdmUgYWxyZWFkeSBjb252ZXJ0ZWQNCiAgICAgICAgdWludDI1NiBiYWxhbmNlT2YgPSB0aXhTdGFsbGVkLmJhbGFuY2VPZihfb3duZXIpOw0KICAgICAgICBpZiAoYmFsYW5jZU9mIDw9IDApIHRocm93OyAvLyBUaHJvdyBpZiB0aGV5IGRvbid0IGhhdmUgYW4gZXhpc3RpbmcgYmFsYW5jZQ0KICAgICAgICBjb252ZXJ0ZWRbX293bmVyXSA9IHRydWU7DQogICAgICAgIHRvdGFsU3VwcGx5ICs9IGJhbGFuY2VPZjsNCiAgICAgICAgYmFsYW5jZXNbX293bmVyXSArPSBiYWxhbmNlT2Y7DQogICAgICAgIFRyYW5zZmVyKHRoaXMsIF9vd25lciwgYmFsYW5jZU9mKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjb250aW51ZUdlbmVyYXRpb24oKQ0KICAgICAgICBleHRlcm5hbA0KICAgIHsNCiAgICAgICAgVElYU3RhbGxlZFRva2VuIHRpeFN0YWxsZWQgPSBUSVhTdGFsbGVkVG9rZW4odGl4R2VuZXJhdGlvbkNvbnRyYWN0KTsNCiAgICAgICAgLy8gQWxsb3cgdGhlIHNhbGUgdG8gY29udGludWUNCiAgICAgICAgaWYgKHRvdGFsU3VwcGx5ID09IHRpeFN0YWxsZWQudG90YWxTdXBwbHkoKSAmJiB0aXhTdGFsbGVkLmlzRmluYWxpemVkKCkpDQogICAgICAgICAgc3RhcnRUaW1lID0gbm93Ow0KICAgICAgICBlbHNlDQogICAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgLyoqDQogICAgKiBAZGV2IEVuZHMgdGhlIGZ1bmRpbmcgcGVyaW9kIGFuZCBzZW5kcyB0aGUgRVRIIGhvbWUNCiAgICAqLw0KICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkNCiAgICAgICAgZXh0ZXJuYWwNCiAgICAgICAgd2hlbk5vdEZpbmFsaXplZA0KICAgIHsNCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gZXRoRnVuZERlcG9zaXQpIHRocm93OyAvLyBsb2NrcyBmaW5hbGl6ZSB0byB0aGUgdWx0aW1hdGUgRVRIIG93bmVyDQogICAgICAgIGlmIChub3cgPD0gZW5kVGltZSAmJiB0b3RhbFN1cHBseSAhPSB0b2tlbkdlbmVyYXRpb25DYXApIHRocm93Ow0KICAgICAgICAvLyBtb3ZlIHRvIG9wZXJhdGlvbmFsDQogICAgICAgIGlzRmluYWxpemVkID0gdHJ1ZTsNCiAgICAgICAgaWYoIWV0aEZ1bmREZXBvc2l0LnNlbmQodGhpcy5iYWxhbmNlKSkgdGhyb3c7ICAvLyBzZW5kIHRoZSBldGggdG8gQmxvY2t0aXgNCiAgICB9DQoNCiAgICAvLyBmYWxsYmFjaw0KICAgIGZ1bmN0aW9uKCkNCiAgICAgICAgcGF5YWJsZQ0KICAgICAgICB3aGVuTm90RmluYWxpemVkDQogICAgew0KICAgICAgICBnZW5lcmF0ZVRva2VucygpOw0KICAgIH0NCn0='