base 64 content
base64tombola
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC44Ow0KDQovLyA8T1JBQ0xJWkVfQVBJPg0KLyoNCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTA0KQ29weXJpZ2h0IChjKSAyMDE2IE9yYWNsaXplIExURA0KDQoNCg0KUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQ0Kb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwNCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMNCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwNCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcw0KZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoNCg0KDQoNClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluDQphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCg0KDQoNClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUNCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVINCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sDQpPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElODQpUSEUgU09GVFdBUkUuDQoqLw0KDQoNCmNvbnRyYWN0IE9yYWNsaXplSSB7DQogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7DQogICAgZnVuY3Rpb24gcXVlcnlfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZywgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOw0KICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7DQogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsNCiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOw0KICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7DQogICAgZnVuY3Rpb24gc2V0UHJvb2ZUeXBlKGJ5dGUgX3Byb29mVHlwZSk7DQogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7DQogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOw0KfQ0KY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsNCiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7DQp9DQpjb250cmFjdCB1c2luZ09yYWNsaXplIHsNCiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0Ow0KICAgIHVpbnQgY29uc3RhbnQgd2VlayA9IDYwKjYwKjI0Kjc7DQogICAgdWludCBjb25zdGFudCBtb250aCA9IDYwKjYwKjI0KjMwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOw0KICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX1RMU05vdGFyeSA9IDB4MTA7DQogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOw0KICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsNCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7DQogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsNCg0KICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7DQogICAgDQogICAgT3JhY2xpemVJIG9yYWNsaXplOw0KICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsNCiAgICAgICAgaWYoYWRkcmVzcyhPQVIpPT0wKSBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsNCiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7DQogICAgICAgIF87DQogICAgfQ0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7DQogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOw0KICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yayh1aW50OCBuZXR3b3JrSUQpIGludGVybmFsIHJldHVybnMoYm9vbCl7DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM2IyNjM4YTdjYzlmMmNiM2QyOThhM2RhN2E5MGI2N2U1NTA2ZWQpPjApeyAvL21haW5uZXQNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM2IyNjM4YTdjYzlmMmNiM2QyOThhM2RhN2E5MGI2N2U1NTA2ZWQpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4YzAzYTI2MTVkNWVmYWY1ZjQ5ZjYwYjdiYjY1ODNlYWVjMjEyZmRmMSk+MCl7IC8vcm9wc3RlbiB0ZXN0bmV0DQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNhMjYxNWQ1ZWZhZjVmNDlmNjBiN2JiNjU4M2VhZWMyMTJmZGYxKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyYTFmODU5YjNmZWFlNWZiMmEwYTMyYzE4ZjVhNjU1NTViYmYpPjApeyAvL2V0aGVyLmNhbXAgaWRlDQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgyMGUxMmExZjg1OWIzZmVhZTVmYjJhMGEzMmMxOGY1YTY1NTU1YmJmKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDkzYmJiZTVjZTc3MDM0ZTMwOTVmMDQ3OTkxOTk2MmE5MDNmODk4YWQpPjApeyAvL25vcnNib3JnIHRlc3RuZXQNCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDkzYmJiZTVjZTc3MDM0ZTMwOTVmMDQ3OTkxOTk2MmE5MDNmODk4YWQpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NTFlZmFmNGM4YjNjOWFmYmQ1YWI5ZjRiYmM4Mjc4NGFiNmVmOGZhYSk+MCl7IC8vYnJvd3Nlci1zb2xpZGl0eQ0KICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NTFlZmFmNGM4YjNjOWFmYmQ1YWI5ZjRiYmM4Mjc4NGFiNmVmOGZhYSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7DQogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZyk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsNCiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7DQogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7DQogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlDQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsNCiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsNCiAgICB9DQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpew0KICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOw0KICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQ0KICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRQcm9vZihieXRlIHByb29mUCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsNCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsNCiAgICB9ICAgIA0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgew0KICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q29uZmlnKGNvbmZpZyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0Q29kZVNpemUoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50IF9zaXplKSB7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIF9zaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQ0KICAgICAgICB9DQogICAgfQ0KDQoNCiAgICBmdW5jdGlvbiBwYXJzZUFkZHIoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRtcCA9IGJ5dGVzKF9hKTsNCiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7DQogICAgICAgIHVpbnQxNjAgYjE7DQogICAgICAgIHVpbnQxNjAgYjI7DQogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsNCiAgICAgICAgICAgIGlhZGRyICo9IDI1NjsNCiAgICAgICAgICAgIGIxID0gdWludDE2MCh0bXBbaV0pOw0KICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsNCiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpJiYoYjEgPD0gMTAyKSkgYjEgLT0gODc7DQogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpJiYoYjEgPD0gNTcpKSBiMSAtPSA0ODsNCiAgICAgICAgICAgIGlmICgoYjIgPj0gOTcpJiYoYjIgPD0gMTAyKSkgYjIgLT0gODc7DQogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNDgpJiYoYjIgPD0gNTcpKSBiMiAtPSA0ODsNCiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGFkZHJlc3MoaWFkZHIpOw0KICAgIH0NCg0KDQogICAgZnVuY3Rpb24gc3RyQ29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOw0KICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsNCiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsNCiAgICAgICAgaWYgKGIubGVuZ3RoIDwgbWluTGVuZ3RoKSBtaW5MZW5ndGggPSBiLmxlbmd0aDsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQ0KICAgICAgICAgICAgaWYgKGFbaV0gPCBiW2ldKQ0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQ0KICAgICAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICBpZiAoYS5sZW5ndGggPCBiLmxlbmd0aCkNCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgZWxzZSBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkNCiAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gMDsNCiAgIH0gDQoNCiAgICBmdW5jdGlvbiBpbmRleE9mKHN0cmluZyBfaGF5c3RhY2ssIHN0cmluZyBfbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpDQogICAgew0KICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBuID0gYnl0ZXMoX25lZWRsZSk7DQogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKSANCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQ0KICAgICAgICAgICAgcmV0dXJuIC0xOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgZWxzZQ0KICAgICAgICB7DQogICAgICAgICAgICB1aW50IHN1YmluZGV4ID0gMDsNCiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmIChoW2ldID09IG5bMF0pDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlKHN1YmluZGV4IDwgbi5sZW5ndGggJiYgKGkgKyBzdWJpbmRleCkgPCBoLmxlbmd0aCAmJiBoW2kgKyBzdWJpbmRleF0gPT0gbltzdWJpbmRleF0pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7DQogICAgICAgICAgICAgICAgICAgIH0gICANCiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgfSAgIA0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QsIHN0cmluZyBfZSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYSA9IGJ5dGVzKF9hKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZCA9IGJ5dGVzKF9kKTsNCiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsNCiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOw0KICAgICAgICBieXRlcyBtZW1vcnkgYmFiY2RlID0gYnl0ZXMoYWJjZGUpOw0KICAgICAgICB1aW50IGsgPSAwOw0KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JiLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYltpXTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JlLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZVtpXTsNCiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOw0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7DQogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsNCiAgICB9DQoNCiAgICAvLyBwYXJzZUludA0KICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOw0KICAgIH0NCg0KICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpDQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOw0KICAgICAgICB1aW50IG1pbnQgPSAwOw0KICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7DQogICAgICAgIGZvciAodWludCBpPTA7IGk8YnJlc3VsdC5sZW5ndGg7IGkrKyl7DQogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1Nykpew0KICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7DQogICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7DQogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsNCiAgICAgICAgcmV0dXJuIG1pbnQ7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIHVpbnQyc3RyKHVpbnQgaSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsNCiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsNCiAgICAgICAgdWludCBqID0gaTsNCiAgICAgICAgdWludCBsZW47DQogICAgICAgIHdoaWxlIChqICE9IDApew0KICAgICAgICAgICAgbGVuKys7DQogICAgICAgICAgICBqIC89IDEwOw0KICAgICAgICB9DQogICAgICAgIGJ5dGVzIG1lbW9yeSBic3RyID0gbmV3IGJ5dGVzKGxlbik7DQogICAgICAgIHVpbnQgayA9IGxlbiAtIDE7DQogICAgICAgIHdoaWxlIChpICE9IDApew0KICAgICAgICAgICAgYnN0cltrLS1dID0gYnl0ZSg0OCArIGkgJSAxMCk7DQogICAgICAgICAgICBpIC89IDEwOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzdHJpbmcoYnN0cik7DQogICAgfQ0KICAgIA0KICAgIA0KDQp9DQovLyA8L09SQUNMSVpFX0FQST4NCg0KDQpsaWJyYXJ5IHN0cmluZ3Mgew0KICAgIHN0cnVjdCBzbGljZSB7DQogICAgICAgIHVpbnQgX2xlbjsNCiAgICAgICAgdWludCBfcHRyOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSB7DQogICAgICAgIC8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlDQogICAgICAgIGZvcig7IGxlbiA+PSAzMjsgbGVuIC09IDMyKSB7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG1sb2FkKHNyYykpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBkZXN0ICs9IDMyOw0KICAgICAgICAgICAgc3JjICs9IDMyOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ29weSByZW1haW5pbmcgYnl0ZXMNCiAgICAgICAgdWludCBtYXNrID0gMjU2ICoqICgzMiAtIGxlbikgLSAxOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoc3JjKSwgbm90KG1hc2spKQ0KICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChkZXN0KSwgbWFzaykNCiAgICAgICAgICAgIG1zdG9yZShkZXN0LCBvcihkZXN0cGFydCwgc3JjcGFydCkpDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzdHJpbmcgdG8gbWFrZSBhIHNsaWNlIGZyb20uDQogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRvU2xpY2Uoc3RyaW5nIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGYsIDB4MjApDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHNsaWNlKGJ5dGVzKHNlbGYpLmxlbmd0aCwgcHRyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBvZiBhIG51bGwtdGVybWluYXRlZCBieXRlczMyIHN0cmluZy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgdmFsdWUgdG8gZmluZCB0aGUgbGVuZ3RoIG9mLg0KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc3RyaW5nLCBmcm9tIDAgdG8gMzIuDQogICAgICovDQogICAgZnVuY3Rpb24gbGVuKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgICAgICB1aW50IHJldDsNCiAgICAgICAgaWYgKHNlbGYgPT0gMCkNCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDE2Ow0KICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7DQogICAgICAgICAgICByZXQgKz0gODsNCiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmYgPT0gMCkgew0KICAgICAgICAgICAgcmV0ICs9IDQ7DQogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDApOw0KICAgICAgICB9DQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmID09IDApIHsNCiAgICAgICAgICAgIHJldCArPSAyOw0KICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDApOw0KICAgICAgICB9DQogICAgICAgIGlmIChzZWxmICYgMHhmZiA9PSAwKSB7DQogICAgICAgICAgICByZXQgKz0gMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMzIgLSByZXQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIGJ5dGVzMzIsIGludGVycHJldGVkIGFzIGENCiAgICAgKiAgICAgIG51bGwtdGVybWludGFlZCB1dGYtOCBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGJ5dGVzMzIgdmFsdWUgdG8gY29udmVydCB0byBhIHNsaWNlLg0KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgdmFsdWUgb2YgdGhlIGlucHV0IGFyZ3VtZW50IHVwIHRvIHRoZQ0KICAgICAqICAgICAgICAgZmlyc3QgbnVsbC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiB0b1NsaWNlQjMyKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7DQogICAgICAgIC8vIEFsbG9jYXRlIHNwYWNlIGZvciBgc2VsZmAgaW4gbWVtb3J5LCBjb3B5IGl0IHRoZXJlLCBhbmQgcG9pbnQgcmV0IGF0IGl0DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIGxldCBwdHIgOj0gbWxvYWQoMHg0MCkNCiAgICAgICAgICAgIG1zdG9yZSgweDQwLCBhZGQocHRyLCAweDIwKSkNCiAgICAgICAgICAgIG1zdG9yZShwdHIsIHNlbGYpDQogICAgICAgICAgICBtc3RvcmUoYWRkKHJldCwgMHgyMCksIHB0cikNCiAgICAgICAgfQ0KICAgICAgICByZXQuX2xlbiA9IGxlbihzZWxmKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIHRoZSBjdXJyZW50IHNsaWNlLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5Lg0KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIGBzZWxmYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb3B5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHJldHVybiBzbGljZShzZWxmLl9sZW4sIHNlbGYuX3B0cik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuDQogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgc2xpY2UncyB0ZXh0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4pOw0KICAgICAgICB1aW50IHJldHB0cjsNCiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0NCg0KICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggaW4gcnVuZXMgb2YgdGhlIHNsaWNlLiBOb3RlIHRoYXQgdGhpcyBvcGVyYXRpb24NCiAgICAgKiAgICAgIHRha2VzIHRpbWUgcHJvcG9ydGlvbmFsIHRvIHRoZSBsZW5ndGggb2YgdGhlIHNsaWNlOyBhdm9pZCB1c2luZyBpdA0KICAgICAqICAgICAgaW4gbG9vcHMsIGFuZCBjYWxsIGBzbGljZS5lbXB0eSgpYCBpZiB5b3Ugb25seSBuZWVkIHRvIGtub3cgd2hldGhlcg0KICAgICAqICAgICAgdGhlIHNsaWNlIGlzIGVtcHR5IG9yIG5vdC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHNsaWNlIGluIHJ1bmVzLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxlbihzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgICAgIC8vIFN0YXJ0aW5nIGF0IHB0ci0zMSBtZWFucyB0aGUgTFNCIHdpbGwgYmUgdGhlIGJ5dGUgd2UgY2FyZSBhYm91dA0KICAgICAgICB2YXIgcHRyID0gc2VsZi5fcHRyIC0gMzE7DQogICAgICAgIHZhciBlbmQgPSBwdHIgKyBzZWxmLl9sZW47DQogICAgICAgIGZvciAodWludCBsZW4gPSAwOyBwdHIgPCBlbmQ7IGxlbisrKSB7DQogICAgICAgICAgICB1aW50OCBiOw0KICAgICAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChwdHIpLCAweEZGKSB9DQogICAgICAgICAgICBpZiAoYiA8IDB4ODApIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gMTsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgew0KICAgICAgICAgICAgICAgIHB0ciArPSAyOw0KICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7DQogICAgICAgICAgICAgICAgcHRyICs9IDM7DQogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjgpIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gNDsNCiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGQykgew0KICAgICAgICAgICAgICAgIHB0ciArPSA1Ow0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBwdHIgKz0gNjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbGVuOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSAoaGFzIGEgbGVuZ3RoIG9mIDApLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2UgaXMgZW1wdHksIEZhbHNlIG90aGVyd2lzZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBlbXB0eShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiBzZWxmLl9sZW4gPT0gMDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgYSBwb3NpdGl2ZSBudW1iZXIgaWYgYG90aGVyYCBjb21lcyBsZXhpY29ncmFwaGljYWxseSBhZnRlcg0KICAgICAqICAgICAgYHNlbGZgLCBhIG5lZ2F0aXZlIG51bWJlciBpZiBpdCBjb21lcyBiZWZvcmUsIG9yIHplcm8gaWYgdGhlDQogICAgICogICAgICBjb250ZW50cyBvZiB0aGUgdHdvIHNsaWNlcyBhcmUgZXF1YWwuIENvbXBhcmlzb24gaXMgZG9uZSBwZXItcnVuZSwNCiAgICAgKiAgICAgIG9uIHVuaWNvZGUgY29kZXBvaW50cy4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29tcGFyZS4NCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLg0KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBvZiB0aGUgY29tcGFyaXNvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb21wYXJlKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsNCiAgICAgICAgdWludCBzaG9ydGVzdCA9IHNlbGYuX2xlbjsNCiAgICAgICAgaWYgKG90aGVyLl9sZW4gPCBzZWxmLl9sZW4pDQogICAgICAgICAgICBzaG9ydGVzdCA9IG90aGVyLl9sZW47DQoNCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHI7DQogICAgICAgIHZhciBvdGhlcnB0ciA9IG90aGVyLl9wdHI7DQogICAgICAgIGZvciAodWludCBpZHggPSAwOyBpZHggPCBzaG9ydGVzdDsgaWR4ICs9IDMyKSB7DQogICAgICAgICAgICB1aW50IGE7DQogICAgICAgICAgICB1aW50IGI7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgYSA6PSBtbG9hZChzZWxmcHRyKQ0KICAgICAgICAgICAgICAgIGIgOj0gbWxvYWQob3RoZXJwdHIpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYSAhPSBiKSB7DQogICAgICAgICAgICAgICAgLy8gTWFzayBvdXQgaXJyZWxldmFudCBieXRlcyBhbmQgY2hlY2sgYWdhaW4NCiAgICAgICAgICAgICAgICB1aW50IG1hc2sgPSB+KDIgKiogKDggKiAoMzIgLSBzaG9ydGVzdCArIGlkeCkpIC0gMSk7DQogICAgICAgICAgICAgICAgdmFyIGRpZmYgPSAoYSAmIG1hc2spIC0gKGIgJiBtYXNrKTsNCiAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPSAwKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGRpZmYpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2VsZnB0ciArPSAzMjsNCiAgICAgICAgICAgIG90aGVycHRyICs9IDMyOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBpbnQoc2VsZi5fbGVuKSAtIGludChvdGhlci5fbGVuKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgdHdvIHNsaWNlcyBjb250YWluIHRoZSBzYW1lIHRleHQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2VzIGFyZSBlcXVhbCwgZmFsc2Ugb3RoZXJ3aXNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVxdWFscyhzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gY29tcGFyZShzZWxmLCBvdGhlcikgPT0gMDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IEV4dHJhY3RzIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSBpbnRvIGBydW5lYCwgYWR2YW5jaW5nIHRoZQ0KICAgICAqICAgICAgc2xpY2UgdG8gcG9pbnQgdG8gdGhlIG5leHQgcnVuZSBhbmQgcmV0dXJuaW5nIGBzZWxmYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gcnVuZSBUaGUgc2xpY2UgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIGZpcnN0IHJ1bmUuDQogICAgICogQHJldHVybiBgcnVuZWAuDQogICAgICovDQogICAgZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZiwgc2xpY2UgcnVuZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsNCiAgICAgICAgcnVuZS5fcHRyID0gc2VsZi5fcHRyOw0KDQogICAgICAgIGlmIChzZWxmLl9sZW4gPT0gMCkgew0KICAgICAgICAgICAgcnVuZS5fbGVuID0gMDsNCiAgICAgICAgICAgIHJldHVybiBydW5lOw0KICAgICAgICB9DQoNCiAgICAgICAgdWludCBsZW47DQogICAgICAgIHVpbnQgYjsNCiAgICAgICAgLy8gTG9hZCB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgcnVuZSBpbnRvIHRoZSBMU0JzIG9mIGINCiAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChzdWIobWxvYWQoYWRkKHNlbGYsIDMyKSksIDMxKSksIDB4RkYpIH0NCiAgICAgICAgaWYgKGIgPCAweDgwKSB7DQogICAgICAgICAgICBsZW4gPSAxOw0KICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsNCiAgICAgICAgICAgIGxlbiA9IDI7DQogICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgew0KICAgICAgICAgICAgbGVuID0gMzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxlbiA9IDQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMNCiAgICAgICAgaWYgKGxlbiA+IHNlbGYuX2xlbikgew0KICAgICAgICAgICAgcnVuZS5fbGVuID0gc2VsZi5fbGVuOw0KICAgICAgICAgICAgc2VsZi5fcHRyICs9IHNlbGYuX2xlbjsNCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7DQogICAgICAgICAgICByZXR1cm4gcnVuZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYuX3B0ciArPSBsZW47DQogICAgICAgIHNlbGYuX2xlbiAtPSBsZW47DQogICAgICAgIHJ1bmUuX2xlbiA9IGxlbjsNCiAgICAgICAgcmV0dXJuIHJ1bmU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBSZXR1cm5zIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSwgYWR2YW5jaW5nIHRoZSBzbGljZSB0byBwb2ludA0KICAgICAqICAgICAgdG8gdGhlIG5leHQgcnVuZS4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcmV0dXJuIEEgc2xpY2UgY29udGFpbmluZyBvbmx5IHRoZSBmaXJzdCBydW5lIGZyb20gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG5leHRSdW5lKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHJldCkgew0KICAgICAgICBuZXh0UnVuZShzZWxmLCByZXQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLg0KICAgICAqIEByZXR1cm4gVGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBvcmQoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCByZXQpIHsNCiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIHVpbnQgd29yZDsNCiAgICAgICAgdWludCBsZW47DQogICAgICAgIHVpbnQgZGl2ID0gMiAqKiAyNDg7DQoNCiAgICAgICAgLy8gTG9hZCB0aGUgcnVuZSBpbnRvIHRoZSBNU0JzIG9mIGINCiAgICAgICAgYXNzZW1ibHkgeyB3b3JkOj0gbWxvYWQobWxvYWQoYWRkKHNlbGYsIDMyKSkpIH0NCiAgICAgICAgdmFyIGIgPSB3b3JkIC8gZGl2Ow0KICAgICAgICBpZiAoYiA8IDB4ODApIHsNCiAgICAgICAgICAgIHJldCA9IGI7DQogICAgICAgICAgICBsZW4gPSAxOw0KICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsNCiAgICAgICAgICAgIHJldCA9IGIgJiAweDFGOw0KICAgICAgICAgICAgbGVuID0gMjsNCiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7DQogICAgICAgICAgICByZXQgPSBiICYgMHgwRjsNCiAgICAgICAgICAgIGxlbiA9IDM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXQgPSBiICYgMHgwNzsNCiAgICAgICAgICAgIGxlbiA9IDQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMNCiAgICAgICAgaWYgKGxlbiA+IHNlbGYuX2xlbikgew0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPCBsZW47IGkrKykgew0KICAgICAgICAgICAgZGl2ID0gZGl2IC8gMjU2Ow0KICAgICAgICAgICAgYiA9ICh3b3JkIC8gZGl2KSAmIDB4RkY7DQogICAgICAgICAgICBpZiAoYiAmIDB4QzAgIT0gMHg4MCkgew0KICAgICAgICAgICAgICAgIC8vIEludmFsaWQgVVRGLTggc2VxdWVuY2UNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldCA9IChyZXQgKiA2NCkgfCAoYiAmIDB4M0YpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGtlY2Nhay0yNTYgaGFzaCBvZiB0aGUgc2xpY2UuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGhhc2guDQogICAgICogQHJldHVybiBUaGUgaGFzaCBvZiB0aGUgc2xpY2UuDQogICAgICovDQogICAgZnVuY3Rpb24ga2VjY2FrKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgcmV0KSB7DQogICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgIHJldCA6PSBzaGEzKG1sb2FkKGFkZChzZWxmLCAzMikpLCBtbG9hZChzZWxmKSkNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdGFydHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLl9wdHIgPT0gbmVlZGxlLl9wdHIpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgYm9vbCBlcXVhbDsNCiAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpDQogICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpDQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQ0KICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZXF1YWw7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBJZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUNCiAgICAgKiAgICAgIGJlZ2lubmluZyBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIGBzZWxmYA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGJleW9uZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIH0NCg0KICAgICAgICBib29sIGVxdWFsID0gdHJ1ZTsNCiAgICAgICAgaWYgKHNlbGYuX3B0ciAhPSBuZWVkbGUuX3B0cikgew0KICAgICAgICAgICAgYXNzZW1ibHkgew0KICAgICAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQ0KICAgICAgICAgICAgICAgIGxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkNCiAgICAgICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQ0KICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZXF1YWwpIHsNCiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSBuZWVkbGUuX2xlbjsNCiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBlbmRzIHdpdGggYG5lZWRsZWAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuDQogICAgICovDQogICAgZnVuY3Rpb24gZW5kc1dpdGgoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsNCg0KICAgICAgICBpZiAoc2VsZnB0ciA9PSBuZWVkbGUuX3B0cikgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICBib29sIGVxdWFsOw0KICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkNCiAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpDQogICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGVxdWFsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgSWYgYHNlbGZgIGVuZHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQ0KICAgICAqICAgICAgZW5kIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4NCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gYHNlbGZgDQogICAgICovDQogICAgZnVuY3Rpb24gdW50aWwoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsNCiAgICAgICAgYm9vbCBlcXVhbCA9IHRydWU7DQogICAgICAgIGlmIChzZWxmcHRyICE9IG5lZWRsZS5fcHRyKSB7DQogICAgICAgICAgICBhc3NlbWJseSB7DQogICAgICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpDQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkNCiAgICAgICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGVxdWFsKSB7DQogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICB9DQoNCiAgICAvLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZg0KICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgYHNlbGZgIGlmIG5vdCBmb3VuZC4NCiAgICBmdW5jdGlvbiBmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgew0KICAgICAgICB1aW50IHB0cjsNCiAgICAgICAgdWludCBpZHg7DQoNCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7DQogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7DQogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OCBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spDQogICAgICAgICAgICAgICAgICAgIGxldCBlbmQgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cg0KICAgICAgICAgICAgICAgICAgICBsb29wOg0KICAgICAgICAgICAgICAgICAgICBqdW1waShleGl0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQ0KICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgMSkNCiAgICAgICAgICAgICAgICAgICAganVtcGkobG9vcCwgbHQoc3ViKHB0ciwgMSksIGVuZCkpDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc2VsZmxlbikNCiAgICAgICAgICAgICAgICAgICAgZXhpdDoNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gRm9yIGxvbmcgbmVlZGxlcywgdXNlIGhhc2hpbmcNCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7DQogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0NCiAgICAgICAgICAgICAgICBwdHIgPSBzZWxmcHRyOw0KICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDw9IHNlbGZsZW4gLSBuZWVkbGVsZW47IGlkeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7DQogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgdGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbikgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaCA9PSB0ZXN0SGFzaCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHI7DQogICAgICAgICAgICAgICAgICAgIHB0ciArPSAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2VsZnB0ciArIHNlbGZsZW47DQogICAgfQ0KDQogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZg0KICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGFkZHJlc3Mgb2YgYHNlbGZgIGlmIG5vdCBmb3VuZC4NCiAgICBmdW5jdGlvbiByZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgdWludCBwdHI7DQoNCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7DQogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7DQogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OSBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spDQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc3ViKHNlbGZsZW4sIG5lZWRsZWxlbikpDQogICAgICAgICAgICAgICAgICAgIGxvb3A6DQogICAgICAgICAgICAgICAgICAgIGp1bXBpKHJldCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHN1YihwdHIsIDEpDQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGd0KGFkZChwdHIsIDEpLCBzZWxmcHRyKSkNCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHNlbGZwdHINCiAgICAgICAgICAgICAgICAgICAganVtcChleGl0KQ0KICAgICAgICAgICAgICAgICAgICByZXQ6DQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCBuZWVkbGVsZW4pDQogICAgICAgICAgICAgICAgICAgIGV4aXQ6DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nDQogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOw0KICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgaGFzaCA6PSBzaGEzKG5lZWRsZXB0ciwgbmVlZGxlbGVuKSB9DQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0ciArIChzZWxmbGVuIC0gbmVlZGxlbGVuKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAocHRyID49IHNlbGZwdHIpIHsNCiAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiB0ZXN0SGFzaDsNCiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9DQogICAgICAgICAgICAgICAgICAgIGlmIChoYXNoID09IHRlc3RIYXNoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB0ciArIG5lZWRsZWxlbjsNCiAgICAgICAgICAgICAgICAgICAgcHRyIC09IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzZWxmcHRyOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gZXZlcnl0aGluZyBmcm9tIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mDQogICAgICogICAgICBgbmVlZGxlYCB0byB0aGUgZW5kIG9mIHRoZSBzbGljZS4gYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UNCiAgICAgKiAgICAgIGlmIGBuZWVkbGVgIGlzIG5vdCBmb3VuZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLg0KICAgICAqIEByZXR1cm4gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgew0KICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQogICAgICAgIHNlbGYuX2xlbiAtPSBwdHIgLSBzZWxmLl9wdHI7DQogICAgICAgIHNlbGYuX3B0ciA9IHB0cjsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBNb2RpZmllcyBgc2VsZmAgdG8gY29udGFpbiB0aGUgcGFydCBvZiB0aGUgc3RyaW5nIGZyb20gdGhlIHN0YXJ0IG9mDQogICAgICogICAgICBgc2VsZmAgdG8gdGhlIGVuZCBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYC4gSWYgYG5lZWRsZWANCiAgICAgKiAgICAgIGlzIG5vdCBmb3VuZCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvci4NCiAgICAgKiBAcmV0dXJuIGBzZWxmYC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiByZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyID0gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQogICAgICAgIHNlbGYuX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdA0KICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmDQogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLA0KICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0Lg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uDQogICAgICogQHJldHVybiBgdG9rZW5gLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsNCiAgICAgICAgdG9rZW4uX3B0ciA9IHNlbGYuX3B0cjsNCiAgICAgICAgdG9rZW4uX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsNCiAgICAgICAgaWYgKHB0ciA9PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsNCiAgICAgICAgICAgIC8vIE5vdCBmb3VuZA0KICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47DQogICAgICAgICAgICBzZWxmLl9wdHIgPSBwdHIgKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdG9rZW47DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdA0KICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYNCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsDQogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCB1cCB0byB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgZGVsaW1gLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsNCiAgICAgICAgc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGJlZm9yZSB0aGUgbGFzdA0KICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBhZnRlciBpdC4gSWYNCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsDQogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4NCiAgICAgKiBAcmV0dXJuIGB0b2tlbmAuDQogICAgICovDQogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7DQogICAgICAgIHVpbnQgcHRyID0gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7DQogICAgICAgIHRva2VuLl9wdHIgPSBwdHI7DQogICAgICAgIHRva2VuLl9sZW4gPSBzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKTsNCiAgICAgICAgaWYgKHB0ciA9PSBzZWxmLl9wdHIpIHsNCiAgICAgICAgICAgIC8vIE5vdCBmb3VuZA0KICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRva2VuOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QNCiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBhZnRlciBpdC4gSWYNCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsDQogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuDQogICAgICovDQogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsNCiAgICAgICAgcnNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgQ291bnRzIHRoZSBudW1iZXIgb2Ygbm9ub3ZlcmxhcHBpbmcgb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgaW4gYHNlbGZgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guDQogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4NCiAgICAgKiBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgZm91bmQgaW4gYHNlbGZgLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNvdW50KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAodWludCBjb3VudCkgew0KICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgd2hpbGUgKHB0ciA8PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsNCiAgICAgICAgICAgIGNvdW50Kys7DQogICAgICAgICAgICBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpLCBwdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyBUcnVlIGlmIGBzZWxmYCBjb250YWlucyBgbmVlZGxlYC4NCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoLg0KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuDQogICAgICogQHJldHVybiBUcnVlIGlmIGBuZWVkbGVgIGlzIGZvdW5kIGluIGBzZWxmYCwgZmFsc2Ugb3RoZXJ3aXNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGNvbnRhaW5zKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgIT0gc2VsZi5fcHRyOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXYgUmV0dXJucyBhIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgY29uY2F0ZW5hdGlvbiBvZg0KICAgICAqICAgICAgYHNlbGZgIGFuZCBgb3RoZXJgLg0KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb25jYXRlbmF0ZS4NCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb25jYXRlbmF0ZS4NCiAgICAgKiBAcmV0dXJuIFRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZSB0d28gc3RyaW5ncy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjb25jYXQoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgew0KICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4gKyBvdGhlci5fbGVuKTsNCiAgICAgICAgdWludCByZXRwdHI7DQogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9DQogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsNCiAgICAgICAgbWVtY3B5KHJldHB0ciArIHNlbGYuX2xlbiwgb3RoZXIuX3B0ciwgb3RoZXIuX2xlbik7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQGRldiBKb2lucyBhbiBhcnJheSBvZiBzbGljZXMsIHVzaW5nIGBzZWxmYCBhcyBhIGRlbGltaXRlciwgcmV0dXJuaW5nIGENCiAgICAgKiAgICAgIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcuDQogICAgICogQHBhcmFtIHNlbGYgVGhlIGRlbGltaXRlciB0byB1c2UuDQogICAgICogQHBhcmFtIHBhcnRzIEEgbGlzdCBvZiBzbGljZXMgdG8gam9pbi4NCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIGFsbCB0aGUgc2xpY2VzIGluIGBwYXJ0c2AsDQogICAgICogICAgICAgICBqb2luZWQgd2l0aCBgc2VsZmAuDQogICAgICovDQogICAgZnVuY3Rpb24gam9pbihzbGljZSBzZWxmLCBzbGljZVtdIHBhcnRzKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsNCiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAwKQ0KICAgICAgICAgICAgcmV0dXJuICIiOw0KDQogICAgICAgIHVpbnQgbGVuID0gc2VsZi5fbGVuICogKHBhcnRzLmxlbmd0aCAtIDEpOw0KICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgbGVuICs9IHBhcnRzW2ldLl9sZW47DQoNCiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcobGVuKTsNCiAgICAgICAgdWludCByZXRwdHI7DQogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9DQoNCiAgICAgICAgZm9yKGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHBhcnRzW2ldLl9wdHIsIHBhcnRzW2ldLl9sZW4pOw0KICAgICAgICAgICAgcmV0cHRyICs9IHBhcnRzW2ldLl9sZW47DQogICAgICAgICAgICBpZiAoaSA8IHBhcnRzLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7DQogICAgICAgICAgICAgICAgcmV0cHRyICs9IHNlbGYuX2xlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KfQ0KDQogICAgICANCiAgICAgIA0KDQoNCg0KY29udHJhY3QgbW9ydGFsIHsNCglhZGRyZXNzIG93bmVyOw0KDQoJZnVuY3Rpb24gbW9ydGFsKCkgew0KCQlvd25lciA9IG1zZy5zZW5kZXI7DQoJfQ0KDQoJZnVuY3Rpb24ga2lsbCgpIHsNCgkJaWYgKG93bmVyID09IG1zZy5zZW5kZXIpDQoJCQlzdWljaWRlKG93bmVyKTsNCgl9DQp9DQoNCmNvbnRyYWN0IGFxdWFyaXVtIHsNCglmdW5jdGlvbiBnaXZlQW5pbWFscyh1aW50OCBhbmltYWxUeXBlLCBhZGRyZXNzIHJlY2VpdmVyKSBwYXlhYmxlIHt9DQp9DQoNCmNvbnRyYWN0IFRvbWJvbGEgaXMgbW9ydGFsLCB1c2luZ09yYWNsaXplIHsNCgl1c2luZyBzdHJpbmdzDQoJZm9yICogOw0KDQoJLy8gMCA9PiBibGFuaywgMSA9PiBidXR0ZXJmbHkgZmlzaCwgMiA9PiB0dW5hLCAzID0+IGdvbGRmaXNoLCA0ID0+IHRhbmcsIDUgPT4gZmFuZ3Rvb3RoDQoJdWludDhbMTAwMF0gcHVibGljIGxvdHM7DQoJdWludDE2IHB1YmxpYyBudW1Mb3RzID0gMTAwMDsNCgl1aW50MzIgcHVibGljIG9yYWNsaXplR2FzID0gMjAwMDAwOw0KCXVpbnQgcHVibGljIHByaWNlID0gNTAwMDAwMDAwMDAwMDAwMDA7DQoNCgltYXBwaW5nKGJ5dGVzMzIgPT4gYWRkcmVzcykgcGxheWVyczsNCgltYXBwaW5nKGJ5dGVzMzIgPT4gdWludDgpIG51bURyYXdzOw0KCW1hcHBpbmcoYWRkcmVzcyA9PiB1aW50OFtdKSBwdWJsaWMgcGxheWVyUHJpemVzOw0KCWFxdWFyaXVtIHA0cDsNCglldmVudCBkcmF3KGFkZHJlc3MgcGxheWVyLCB1aW50OFtdIHByaXplcyk7DQoJdWludDEyOFtdIHByaXplVmFsdWUgPSBbMTAwIGZpbm5leSwgMjAwIGZpbm5leSwgNTAwIGZpbm5leSwgMSBldGhlciwgNSBldGhlcl07DQoNCg0KCS8qKiBzZXRzIHRoZSBwcml6ZXMgKiovDQoJZnVuY3Rpb24gVG9tYm9sYSgpIHBheWFibGUgew0KCQl1aW50MTZbNDRdIG1lbW9yeSBwb3NpdGlvbnMgPSBbNDExLCA0NDIsIDUyNSwgMzMzLCAzOTYsIDUxMCwgODQxLCA0NzUsIDcwMSwgNTQ5LCA3NjMsIDM1NywgNDc0LCA4MDcsIDIxMSwgMzc1LCA3MjcsIDIxMSwgMjkwLCAyNTMsIDMyMSwgODY1LCAyNjUsIDI3NSwgODY0LCAxMDUsIDE5NCwgMjI4LCA4NTUsIDk1OCwgMzM3LCA3MzgsIDY3MSwgMTQsIDMyOSwgMTkwLCAxODcsIDY1OSwgNjQ3LCA3NDAsIDgzNCwgMywgNzc2LCA5MzRdOw0KCQlmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgMjU7IGkrKykNCgkJCWxvdHNbcG9zaXRpb25zW2ldXSA9IDE7DQoJCWZvciAoaSA9IDI1OyBpIDwgMzU7IGkrKykNCgkJCWxvdHNbcG9zaXRpb25zW2ldXSA9IDI7DQoJCWZvciAoaSA9IDM1OyBpIDwgNDA7IGkrKykNCgkJCWxvdHNbcG9zaXRpb25zW2ldXSA9IDM7DQoJCWZvciAoaSA9IDQwOyBpIDwgNDM7IGkrKykNCgkJCWxvdHNbcG9zaXRpb25zW2ldXSA9IDQ7DQoJCWxvdHNbcG9zaXRpb25zWzQzXV0gPSA1Ow0KCQlwNHAgPSBhcXVhcml1bSgweGM1YzQ5YzVmNTdkOWYxNjM1ZGRlOTU2YzY4NTgxNDY3MTc4Nzk2MDApOw0KCX0NCg0KCS8qKiBidXlzIGFzIG1hbnkgbG90cyBhcyBwb3NzaWJsZSB3aXRoIG1zZy52YWx1ZSAqKi8NCglmdW5jdGlvbigpIHBheWFibGUgew0KDQoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7DQoJCQlpZiAobXNnLnZhbHVlIDwgcHJpY2UpIHRocm93Ow0KCQkJdWludCBhbW91bnQgPSBtc2cudmFsdWUgLyBwcmljZTsNCgkJCWlmIChhbW91bnQgPiBudW1Mb3RzKSB0aHJvdzsNCgkJCWJ5dGVzMzIgb2lkID0gb3JhY2xpemVfcXVlcnkoIldvbGZyYW1BbHBoYSIsIHN0ckNvbmNhdCh1aW50MnN0cihhbW91bnQpLCAiIHJhbmRvbSBudW1iZXJzIGJldHdlZW4gMCBhbmQgOTk5IiksIGFtb3VudCAqIDIwMDAwICsgb3JhY2xpemVHYXMpOw0KCQkJcGxheWVyc1tvaWRdID0gbXNnLnNlbmRlcjsNCgkJCW51bURyYXdzW29pZF0gPSB1aW50OChhbW91bnQpOw0KCQl9DQoJfQ0KDQoNCgkvKiogZXZhbHVhdGVzIHRoZSBkcmF3cyAqKi8NCglmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgew0KCQlpZiAobXNnLnNlbmRlciAhPSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSkgdGhyb3c7DQoJCWlmIChwbGF5ZXJzW215aWRdID09IDB4MCkgdGhyb3c7DQoJCXVpbnQxNltdIG1lbW9yeSByYW5kb21OdW1iZXJzID0gZ2V0TnVtYmVyc0Zyb21TdHJpbmcocmVzdWx0LCAiLCIsIG51bURyYXdzW215aWRdKTsNCgkJdWludDhbXSBtZW1vcnkgZHJhd3MgPSBuZXcgdWludDhbXShudW1EcmF3c1tteWlkXSk7DQoJCXVpbnQxNiByYW5kOw0KCQl1aW50OCBwcml6ZTsNCgkJZm9yICh1aW50OCBpID0gMDsgaSA8IHJhbmRvbU51bWJlcnMubGVuZ3RoOyBpKyspIHsNCgkJCXJhbmQgPSBtYXBUb1JhbmdlKHJhbmRvbU51bWJlcnNbaV0pOw0KCQkJcHJpemUgPSBsb3RzW3JhbmRdOw0KCQkJbnVtTG90cy0tOw0KCQkJbG90c1tyYW5kXSA9IGxvdHNbbnVtTG90c107DQoJCQlpZiAocHJpemUgPiAwICYmIHByaXplIDw9IDUpIHsNCgkJCQlwbGF5ZXJQcml6ZXNbcGxheWVyc1tteWlkXV0ucHVzaChwcml6ZSk7DQoJCQkJZHJhd3NbaV0gPSBwcml6ZTsNCgkJCX0NCgkJfQ0KCQlkcmF3KHBsYXllcnNbbXlpZF0sIGRyYXdzKTsNCgl9DQoNCgkvKiogc2VuZHMgdGhlIHBsYXllciB0aGUgY29ycmVzcG9uZGluZyBwcml6ZXMgKiovDQoJZnVuY3Rpb24gY2xhaW1Qcml6ZXMoKSB7DQoJCXVpbnQ4W10gcHJpemVMaXN0ID0gcGxheWVyUHJpemVzW21zZy5zZW5kZXJdOw0KCQl1aW50OCBwcml6ZTsNCgkJZm9yICh1aW50IGkgPSAwOyBpIDwgcHJpemVMaXN0Lmxlbmd0aDsgaSsrKSB7DQoJCQlwcml6ZSA9IHByaXplTGlzdFtpXTsNCgkJCWlmIChwcml6ZSA+IDApIHsNCgkJCQlkZWxldGUgcHJpemVMaXN0W2ldOw0KCQkJCXA0cC5naXZlQW5pbWFscy52YWx1ZShwcml6ZVZhbHVlW3ByaXplIC0gMV0pKHByaXplIC0gMSwgbXNnLnNlbmRlcik7DQoJCQl9DQoJCX0NCgkJZGVsZXRlIHBsYXllclByaXplc1ttc2cuc2VuZGVyXTsNCgl9DQoNCgkvKiogc2V0cyB0aGUgcHJpY2Ugb2YgYSBsb3QgKiovDQoJZnVuY3Rpb24gc2V0UHJpY2UodWludCBuZXdQcmljZSkgew0KCQlwcmljZSA9IG5ld1ByaWNlOw0KCX0NCg0KCS8qKiByZXR1cm5zIGFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIHJlbWFpbmluZyBudW1iZXIgb2YgdGhlIGRpZmZlcmVudCBwcml6ZXMgKiovDQoJZnVuY3Rpb24gZ2V0UHJpemVOdW1iZXJzKCkgY29uc3RhbnQgcmV0dXJucyh1aW50OFs1XSBwcml6ZU51bWJlcnMpIHsNCgkJZm9yICh1aW50MTYgaSA9IDA7IGkgPCBudW1Mb3RzOyBpKyspIHsNCgkJCWlmIChsb3RzW2ldID4gMCkgew0KCQkJCXByaXplTnVtYmVyc1tsb3RzW2ldIC0gMV0rKzsNCgkJCX0NCgkJfQ0KCX0NCg0KCWZ1bmN0aW9uIG1hcFRvUmFuZ2UodWludDE2IG51bWJlcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50MTYpIHsNCgkJCQlyZXR1cm4gbnVtYmVyICogKG51bUxvdHMgLSAxKSAvIDk5OTsNCgkJfQ0KCQkvKioNCgkJICogY29udmVydHMgYSBzdHJpbmcgb2YgbnVtYmVycyBiZWluZyBzZXBhcmF0ZWQgYnkgYSBnaXZlbiBkZWxpbWl0ZXIgaW50byBhbiBhcnJheSBvZiBudW1iZXJzICgjaG93bWFueSkgDQoJCSAqLw0KCWZ1bmN0aW9uIGdldE51bWJlcnNGcm9tU3RyaW5nKHN0cmluZyBzLCBzdHJpbmcgZGVsaW1pdGVyLCB1aW50MTYgaG93bWFueSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50MTZbXSBudW1iZXJzKSB7DQoJCXN0cmluZ3Muc2xpY2UgbWVtb3J5IG15cmVzdWx0ID0gcy50b1NsaWNlKCk7DQoJCXN0cmluZ3Muc2xpY2UgbWVtb3J5IGRlbGltID0gZGVsaW1pdGVyLnRvU2xpY2UoKTsNCgkJbnVtYmVycyA9IG5ldyB1aW50MTZbXShob3dtYW55KTsNCgkJZm9yICh1aW50OCBpID0gMDsgaSA8IGhvd21hbnk7IGkrKykgew0KCQkJbnVtYmVyc1tpXSA9IHVpbnQxNihwYXJzZUludChteXJlc3VsdC5zcGxpdChkZWxpbSkudG9TdHJpbmcoKSkpOw0KCQl9DQoJCXJldHVybiBudW1iZXJzOw0KCX0NCg0KCWZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgYW1vdW50KSB7DQoJCWlmIChtc2cuc2VuZGVyID09IG93bmVyKQ0KCQkJb3duZXIuc2VuZChhbW91bnQpOw0KCX0NCg0KCWZ1bmN0aW9uIHNldE9yYWNsaXplR2FzKHVpbnQzMiBuZXdHYXMpIHsNCgkJb3JhY2xpemVHYXMgPSBuZXdHYXM7DQoJfQ0KfQ=='