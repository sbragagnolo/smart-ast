base 64 content
base64trivialToken
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4xMTsNCg0KY29udHJhY3QgRVJDMjBCYXNpYyB7DQogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5Ow0KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOw0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsNCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7DQp9DQoNCg0KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsNCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7DQoNCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOw0KDQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgew0KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7DQogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7DQogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsNCiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsNCiAgfQ0KDQp9DQoNCmNvbnRyYWN0IEVSQzIyM1Rva2VuSW50ZXJmYWNlIHsNCiAgICBmdW5jdGlvbiBuYW1lKCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIF9uYW1lKTsNCiAgICBmdW5jdGlvbiBzeW1ib2woKSBjb25zdGFudCByZXR1cm5zIChzdHJpbmcgX3N5bWJvbCk7DQogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBjb25zdGFudCByZXR1cm5zICh1aW50OCBfZGVjaW1hbHMpOw0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBfdG90YWxTdXBwbHkpOw0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkgcmV0dXJucyAoYm9vbCk7DQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSk7DQp9DQoNCmNvbnRyYWN0IEVSQzIyM1JlY2VpdmVySW50ZXJmYWNlIHsNCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgZnJvbSwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSk7DQp9DQoNCmNvbnRyYWN0IEVSQzIyM1Rva2VuIGlzIEJhc2ljVG9rZW4sIEVSQzIyM1Rva2VuSW50ZXJmYWNlIHsNCiAgICBzdHJpbmcgcHVibGljIG5hbWU7DQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7DQogICAgdWludDggcHVibGljIGRlY2ltYWxzOw0KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5Ow0KDQogICAgZnVuY3Rpb24gbmFtZSgpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBfbmFtZSkgew0KICAgICAgICByZXR1cm4gbmFtZTsNCiAgICB9DQogICAgZnVuY3Rpb24gc3ltYm9sKCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIF9zeW1ib2wpIHsNCiAgICAgICAgcmV0dXJuIHN5bWJvbDsNCiAgICB9DQogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBjb25zdGFudCByZXR1cm5zICh1aW50OCBfZGVjaW1hbHMpIHsNCiAgICAgICAgcmV0dXJuIGRlY2ltYWxzOw0KICAgIH0NCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgX3RvdGFsU3VwcGx5KSB7DQogICAgICAgIHJldHVybiB0b3RhbFN1cHBseTsNCiAgICB9DQoNCiAgICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBzaXplKSB7DQogICAgICAgIHJlcXVpcmUobXNnLmRhdGEubGVuZ3RoID49IHNpemUgKyA0KTsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKSBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKSByZXR1cm5zIChib29sKSB7DQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gU2FmZU1hdGguc3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCB2YWx1ZSk7DQogICAgICAgIGJhbGFuY2VzW3RvXSA9IFNhZmVNYXRoLmFkZChiYWxhbmNlc1t0b10sIHZhbHVlKTsNCiAgICAgICAgaWYgKGlzQ29udHJhY3QodG8pKXsNCiAgICAgICAgICAgIEVSQzIyM1JlY2VpdmVySW50ZXJmYWNlIHJlY2VpdmVyID0gRVJDMjIzUmVjZWl2ZXJJbnRlcmZhY2UodG8pOw0KICAgICAgICAgICAgcmVjZWl2ZXIudG9rZW5GYWxsYmFjayhtc2cuc2VuZGVyLCB2YWx1ZSwgZGF0YSk7DQogICAgICAgIH0NCiAgICAgICAgLy9FUkMyMjMgZXZlbnQNCiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgdG8sIHZhbHVlLCBkYXRhKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICBieXRlcyBtZW1vcnkgZW1wdHk7DQogICAgICAgIHRyYW5zZmVyKHRvLCB2YWx1ZSwgZW1wdHkpOw0KICAgICAgICAvL0VSQzIwIGxlZ2FjeSBldmVudA0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgdmFsdWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHJlc3MpIHByaXZhdGUgcmV0dXJucyAoYm9vbCBpc0NvbnRyYWN0KSB7DQogICAgICAgIHVpbnQgbGVuZ3RoOw0KICAgICAgICBfYWRkcmVzcyA9IF9hZGRyZXNzOyAvL1NpbGVuY2UgY29tcGlsZXIgd2FybmluZw0KICAgICAgICBhc3NlbWJseSB7IGxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfYWRkcmVzcykgfQ0KICAgICAgICByZXR1cm4gbGVuZ3RoID4gMDsNCiAgICB9DQp9DQoNCmNvbnRyYWN0IFB1bGxQYXltZW50IHsNCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7DQoNCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwYXltZW50czsNCiAgdWludDI1NiBwdWJsaWMgdG90YWxQYXltZW50czsNCg0KICBmdW5jdGlvbiBhc3luY1NlbmQoYWRkcmVzcyBkZXN0LCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgew0KICAgIHBheW1lbnRzW2Rlc3RdID0gcGF5bWVudHNbZGVzdF0uYWRkKGFtb3VudCk7DQogICAgdG90YWxQYXltZW50cyA9IHRvdGFsUGF5bWVudHMuYWRkKGFtb3VudCk7DQogIH0NCg0KDQogIGZ1bmN0aW9uIHdpdGhkcmF3UGF5bWVudHMoKSB7DQogICAgYWRkcmVzcyBwYXllZSA9IG1zZy5zZW5kZXI7DQogICAgdWludDI1NiBwYXltZW50ID0gcGF5bWVudHNbcGF5ZWVdOw0KDQogICAgcmVxdWlyZShwYXltZW50ICE9IDApOw0KICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IHBheW1lbnQpOw0KDQogICAgdG90YWxQYXltZW50cyA9IHRvdGFsUGF5bWVudHMuc3ViKHBheW1lbnQpOw0KICAgIHBheW1lbnRzW3BheWVlXSA9IDA7DQoNCiAgICBhc3NlcnQocGF5ZWUuc2VuZChwYXltZW50KSk7DQogIH0NCn0NCg0KbGlicmFyeSBTYWZlTWF0aCB7DQogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOw0KICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7DQogICAgcmV0dXJuIGM7DQogIH0NCg0KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsNCiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDANCiAgICB1aW50MjU2IGMgPSBhIC8gYjsNCiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZA0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgYXNzZXJ0KGIgPD0gYSk7DQogICAgcmV0dXJuIGEgLSBiOw0KICB9DQoNCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7DQogICAgdWludDI1NiBjID0gYSArIGI7DQogICAgYXNzZXJ0KGMgPj0gYSk7DQogICAgcmV0dXJuIGM7DQogIH0NCn0NCg0KDQpjb250cmFjdCBUcml2aWFsVG9rZW4gaXMgRVJDMjIzVG9rZW4sIFB1bGxQYXltZW50IHsNCg0KICAgIC8vQ29uc3RhbnRzDQogICAgdWludDggY29uc3RhbnQgREVDSU1BTFMgPSAwOw0KICAgIHVpbnQyNTYgY29uc3RhbnQgTUlOX0VUSF9BTU9VTlQgPSAwLjAwNSBldGhlcjsNCiAgICB1aW50MjU2IGNvbnN0YW50IE1JTl9CSURfUEVSQ0VOVEFHRSA9IDEwOw0KICAgIHVpbnQyNTYgY29uc3RhbnQgVE9UQUxfU1VQUExZID0gMTAwMDAwMDsNCiAgICB1aW50MjU2IGNvbnN0YW50IFRPS0VOU19QRVJDRU5UQUdFX0ZPUl9LRVlfSE9MREVSID0gMjU7DQogICAgdWludDI1NiBjb25zdGFudCBDTEVBTlVQX0RFTEFZID0gMTgwIGRheXM7DQoNCiAgICAvL0FjY291bnRzDQogICAgYWRkcmVzcyBwdWJsaWMgYXJ0aXN0Ow0KICAgIGFkZHJlc3MgcHVibGljIHRyaXZpYWw7DQoNCiAgICAvL1RpbWUgaW5mb3JtYXRpb24NCiAgICB1aW50MjU2IHB1YmxpYyBpY29FbmRUaW1lOw0KICAgIHVpbnQyNTYgcHVibGljIGF1Y3Rpb25EdXJhdGlvbjsNCiAgICB1aW50MjU2IHB1YmxpYyBhdWN0aW9uRW5kVGltZTsNCg0KICAgIC8vVG9rZW4gaW5mb3JtYXRpb24NCiAgICB1aW50MjU2IHB1YmxpYyB0b2tlbnNGb3JBcnRpc3Q7DQogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zRm9yVHJpdmlhbDsNCiAgICB1aW50MjU2IHB1YmxpYyB0b2tlbnNGb3JJY287DQoNCiAgICAvL0lDTyBhbmQgYXVjdGlvbiByZXN1bHRzDQogICAgdWludDI1NiBwdWJsaWMgYW1vdW50UmFpc2VkOw0KICAgIGFkZHJlc3MgcHVibGljIGhpZ2hlc3RCaWRkZXI7DQogICAgdWludDI1NiBwdWJsaWMgaGlnaGVzdEJpZDsNCiAgICBieXRlczMyIHB1YmxpYyBhdWN0aW9uV2lubmVyTWVzc2FnZUhhc2g7DQogICAgdWludDI1NiBwdWJsaWMgbmV4dENvbnRyaWJ1dG9ySW5kZXhUb0JlR2l2ZW5Ub2tlbnM7DQogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zRGlzdHJpYnV0ZWRUb0NvbnRyaWJ1dG9yczsNCg0KICAgIC8vRXZlbnRzDQogICAgZXZlbnQgSWNvU3RhcnRlZCh1aW50MjU2IGljb0VuZFRpbWUpOw0KICAgIGV2ZW50IEljb0NvbnRyaWJ1dGVkKGFkZHJlc3MgY29udHJpYnV0b3IsIHVpbnQyNTYgYW1vdW50Q29udHJpYnV0ZWQsIHVpbnQyNTYgYW1vdW50UmFpc2VkKTsNCiAgICBldmVudCBJY29GaW5pc2hlZCh1aW50MjU2IGFtb3VudFJhaXNlZCk7DQogICAgZXZlbnQgSWNvQ2FuY2VsbGVkKCk7DQogICAgZXZlbnQgQXVjdGlvblN0YXJ0ZWQodWludDI1NiBhdWN0aW9uRW5kVGltZSk7DQogICAgZXZlbnQgSGlnaGVzdEJpZENoYW5nZWQoYWRkcmVzcyBoaWdoZXN0QmlkZGVyLCB1aW50MjU2IGhpZ2hlc3RCaWQpOw0KICAgIGV2ZW50IEF1Y3Rpb25GaW5pc2hlZChhZGRyZXNzIGhpZ2hlc3RCaWRkZXIsIHVpbnQyNTYgaGlnaGVzdEJpZCk7DQogICAgZXZlbnQgV2lubmVyUHJvdmlkZWRIYXNoKCk7DQoNCiAgICAvL1N0YXRlDQogICAgZW51bSBTdGF0ZSB7IENyZWF0ZWQsIEljb1N0YXJ0ZWQsIEljb0ZpbmlzaGVkLCBBdWN0aW9uU3RhcnRlZCwgQXVjdGlvbkZpbmlzaGVkLCBJY29DYW5jZWxsZWQgfQ0KICAgIFN0YXRlIHB1YmxpYyBjdXJyZW50U3RhdGU7DQoNCiAgICAvL1Rva2VuIGNvbnRyaWJ1dG9ycyBhbmQgaG9sZGVycw0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgY29udHJpYnV0aW9uczsNCiAgICBhZGRyZXNzW10gcHVibGljIGNvbnRyaWJ1dG9yczsNCg0KICAgIC8vTW9kaWZpZmVycw0KICAgIG1vZGlmaWVyIG9ubHlJblN0YXRlKFN0YXRlIGV4cGVjdGVkU3RhdGUpIHsgcmVxdWlyZShleHBlY3RlZFN0YXRlID09IGN1cnJlbnRTdGF0ZSk7IF87IH0NCiAgICBtb2RpZmllciBvbmx5QmVmb3JlKHVpbnQyNTYgX3RpbWUpIHsgcmVxdWlyZShub3cgPCBfdGltZSk7IF87IH0NCiAgICBtb2RpZmllciBvbmx5QWZ0ZXIodWludDI1NiBfdGltZSkgeyByZXF1aXJlKG5vdyA+IF90aW1lKTsgXzsgfQ0KICAgIG1vZGlmaWVyIG9ubHlUcml2aWFsKCkgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gdHJpdmlhbCk7IF87IH0NCiAgICBtb2RpZmllciBvbmx5S2V5SG9sZGVycygpIHsgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBTYWZlTWF0aC5kaXYoDQogICAgICAgIFNhZmVNYXRoLm11bCh0b2tlbnNGb3JJY28sIFRPS0VOU19QRVJDRU5UQUdFX0ZPUl9LRVlfSE9MREVSKSwgMTAwKSk7IF87DQogICAgfQ0KICAgIG1vZGlmaWVyIG9ubHlBdWN0aW9uV2lubmVyKCkgew0KICAgICAgICByZXF1aXJlKGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5BdWN0aW9uRmluaXNoZWQpOw0KICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gaGlnaGVzdEJpZGRlcik7DQogICAgICAgIF87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gVHJpdmlhbFRva2VuKA0KICAgICAgICBzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLA0KICAgICAgICB1aW50MjU2IF9pY29FbmRUaW1lLCB1aW50MjU2IF9hdWN0aW9uRHVyYXRpb24sDQogICAgICAgIGFkZHJlc3MgX2FydGlzdCwgYWRkcmVzcyBfdHJpdmlhbCwNCiAgICAgICAgdWludDI1NiBfdG9rZW5zRm9yQXJ0aXN0LA0KICAgICAgICB1aW50MjU2IF90b2tlbnNGb3JUcml2aWFsLA0KICAgICAgICB1aW50MjU2IF90b2tlbnNGb3JJY28NCiAgICApIHsNCiAgICAgICAgcmVxdWlyZShub3cgPCBfaWNvRW5kVGltZSk7DQogICAgICAgIHJlcXVpcmUoDQogICAgICAgICAgICBUT1RBTF9TVVBQTFkgPT0gU2FmZU1hdGguYWRkKA0KICAgICAgICAgICAgICAgIF90b2tlbnNGb3JBcnRpc3QsDQogICAgICAgICAgICAgICAgU2FmZU1hdGguYWRkKF90b2tlbnNGb3JUcml2aWFsLCBfdG9rZW5zRm9ySWNvKQ0KICAgICAgICAgICAgKQ0KICAgICAgICApOw0KICAgICAgICByZXF1aXJlKE1JTl9CSURfUEVSQ0VOVEFHRSA8IDEwMCk7DQogICAgICAgIHJlcXVpcmUoVE9LRU5TX1BFUkNFTlRBR0VfRk9SX0tFWV9IT0xERVIgPCAxMDApOw0KDQogICAgICAgIG5hbWUgPSBfbmFtZTsNCiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsNCiAgICAgICAgZGVjaW1hbHMgPSBERUNJTUFMUzsNCg0KICAgICAgICBpY29FbmRUaW1lID0gX2ljb0VuZFRpbWU7DQogICAgICAgIGF1Y3Rpb25EdXJhdGlvbiA9IF9hdWN0aW9uRHVyYXRpb247DQogICAgICAgIGFydGlzdCA9IF9hcnRpc3Q7DQogICAgICAgIHRyaXZpYWwgPSBfdHJpdmlhbDsNCg0KICAgICAgICB0b2tlbnNGb3JBcnRpc3QgPSBfdG9rZW5zRm9yQXJ0aXN0Ow0KICAgICAgICB0b2tlbnNGb3JUcml2aWFsID0gX3Rva2Vuc0ZvclRyaXZpYWw7DQogICAgICAgIHRva2Vuc0ZvckljbyA9IF90b2tlbnNGb3JJY287DQoNCiAgICAgICAgY3VycmVudFN0YXRlID0gU3RhdGUuQ3JlYXRlZDsNCiAgICB9DQoNCiAgICAvKg0KICAgICAgICBJQ08gbWV0aG9kcw0KICAgICovDQogICAgZnVuY3Rpb24gc3RhcnRJY28oKQ0KICAgIG9ubHlJblN0YXRlKFN0YXRlLkNyZWF0ZWQpDQogICAgb25seVRyaXZpYWwoKSB7DQogICAgICAgIGN1cnJlbnRTdGF0ZSA9IFN0YXRlLkljb1N0YXJ0ZWQ7DQogICAgICAgIEljb1N0YXJ0ZWQoaWNvRW5kVGltZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY29udHJpYnV0ZUluSWNvKCkgcGF5YWJsZQ0KICAgIG9ubHlJblN0YXRlKFN0YXRlLkljb1N0YXJ0ZWQpDQogICAgb25seUJlZm9yZShpY29FbmRUaW1lKSB7DQogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gTUlOX0VUSF9BTU9VTlQpOw0KDQogICAgICAgIGlmIChjb250cmlidXRpb25zW21zZy5zZW5kZXJdID09IDApIHsNCiAgICAgICAgICAgIGNvbnRyaWJ1dG9ycy5wdXNoKG1zZy5zZW5kZXIpOw0KICAgICAgICB9DQogICAgICAgIGNvbnRyaWJ1dGlvbnNbbXNnLnNlbmRlcl0gPSBTYWZlTWF0aC5hZGQoY29udHJpYnV0aW9uc1ttc2cuc2VuZGVyXSwgbXNnLnZhbHVlKTsNCiAgICAgICAgYW1vdW50UmFpc2VkID0gU2FmZU1hdGguYWRkKGFtb3VudFJhaXNlZCwgbXNnLnZhbHVlKTsNCg0KICAgICAgICBJY29Db250cmlidXRlZChtc2cuc2VuZGVyLCBtc2cudmFsdWUsIGFtb3VudFJhaXNlZCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVRva2Vucyh1aW50MjU2IGNvbnRyaWJ1dG9yc051bWJlcikNCiAgICBvbmx5SW5TdGF0ZShTdGF0ZS5JY29TdGFydGVkKQ0KICAgIG9ubHlBZnRlcihpY29FbmRUaW1lKSB7DQogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGNvbnRyaWJ1dG9yc051bWJlciAmJiBuZXh0Q29udHJpYnV0b3JJbmRleFRvQmVHaXZlblRva2VucyA8IGNvbnRyaWJ1dG9ycy5sZW5ndGg7ICsraSkgew0KICAgICAgICAgICAgYWRkcmVzcyBjdXJyZW50Q29udHJpYnV0b3IgPSBjb250cmlidXRvcnNbbmV4dENvbnRyaWJ1dG9ySW5kZXhUb0JlR2l2ZW5Ub2tlbnMrK107DQogICAgICAgICAgICB1aW50MjU2IHRva2Vuc0ZvckNvbnRyaWJ1dG9yID0gU2FmZU1hdGguZGl2KA0KICAgICAgICAgICAgICAgIFNhZmVNYXRoLm11bCh0b2tlbnNGb3JJY28sIGNvbnRyaWJ1dGlvbnNbY3VycmVudENvbnRyaWJ1dG9yXSksDQogICAgICAgICAgICAgICAgYW1vdW50UmFpc2VkICAvLyBhbW91bnRSYWlzZWQgY2FuJ3QgYmUgMCwgSUNPIGlzIGNhbmNlbGxlZCB0aGVuDQogICAgICAgICAgICApOw0KICAgICAgICAgICAgYmFsYW5jZXNbY3VycmVudENvbnRyaWJ1dG9yXSA9IHRva2Vuc0ZvckNvbnRyaWJ1dG9yOw0KICAgICAgICAgICAgdG9rZW5zRGlzdHJpYnV0ZWRUb0NvbnRyaWJ1dG9ycyA9IFNhZmVNYXRoLmFkZCh0b2tlbnNEaXN0cmlidXRlZFRvQ29udHJpYnV0b3JzLCB0b2tlbnNGb3JDb250cmlidXRvcik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBmaW5pc2hJY28oKQ0KICAgIG9ubHlJblN0YXRlKFN0YXRlLkljb1N0YXJ0ZWQpDQogICAgb25seUFmdGVyKGljb0VuZFRpbWUpIHsNCiAgICAgICAgaWYgKGFtb3VudFJhaXNlZCA9PSAwKSB7DQogICAgICAgICAgICBjdXJyZW50U3RhdGUgPSBTdGF0ZS5JY29DYW5jZWxsZWQ7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLyBhbGwgY29udHJpYnV0b3JzIG11c3QgaGF2ZSByZWNlaXZlZCB0aGVpciB0b2tlbnMgdG8gZmluaXNoIElDTw0KICAgICAgICByZXF1aXJlKG5leHRDb250cmlidXRvckluZGV4VG9CZUdpdmVuVG9rZW5zID49IGNvbnRyaWJ1dG9ycy5sZW5ndGgpOw0KDQogICAgICAgIGJhbGFuY2VzW2FydGlzdF0gPSBTYWZlTWF0aC5hZGQoYmFsYW5jZXNbYXJ0aXN0XSwgdG9rZW5zRm9yQXJ0aXN0KTsNCiAgICAgICAgYmFsYW5jZXNbdHJpdmlhbF0gPSBTYWZlTWF0aC5hZGQoYmFsYW5jZXNbdHJpdmlhbF0sIHRva2Vuc0ZvclRyaXZpYWwpOw0KICAgICAgICB1aW50MjU2IGxlZnRvdmVycyA9IFNhZmVNYXRoLnN1Yih0b2tlbnNGb3JJY28sIHRva2Vuc0Rpc3RyaWJ1dGVkVG9Db250cmlidXRvcnMpOw0KICAgICAgICBiYWxhbmNlc1thcnRpc3RdID0gU2FmZU1hdGguYWRkKGJhbGFuY2VzW2FydGlzdF0sIGxlZnRvdmVycyk7DQoNCiAgICAgICAgaWYgKCFhcnRpc3Quc2VuZCh0aGlzLmJhbGFuY2UpKSB7DQogICAgICAgICAgICBhc3luY1NlbmQoYXJ0aXN0LCB0aGlzLmJhbGFuY2UpOw0KICAgICAgICB9DQogICAgICAgIGN1cnJlbnRTdGF0ZSA9IFN0YXRlLkljb0ZpbmlzaGVkOw0KICAgICAgICBJY29GaW5pc2hlZChhbW91bnRSYWlzZWQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNoZWNrQ29udHJpYnV0aW9uKGFkZHJlc3MgY29udHJpYnV0b3IpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCiAgICAgICAgcmV0dXJuIGNvbnRyaWJ1dGlvbnNbY29udHJpYnV0b3JdOw0KICAgIH0NCg0KICAgIC8qDQogICAgICAgIEF1Y3Rpb24gbWV0aG9kcw0KICAgICovDQogICAgZnVuY3Rpb24gc3RhcnRBdWN0aW9uKCkNCiAgICBvbmx5SW5TdGF0ZShTdGF0ZS5JY29GaW5pc2hlZCkNCiAgICBvbmx5S2V5SG9sZGVycygpIHsNCiAgICAgICAgLy8gMTAwJSB0b2tlbnMgb3duZXIgaXMgdGhlIG9ubHkga2V5IGhvbGRlcg0KICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPT0gVE9UQUxfU1VQUExZKSB7DQogICAgICAgICAgICAvLyBubyBhdWN0aW9uIHRha2VzIHBsYWNlLA0KICAgICAgICAgICAgaGlnaGVzdEJpZGRlciA9IG1zZy5zZW5kZXI7DQogICAgICAgICAgICBjdXJyZW50U3RhdGUgPSBTdGF0ZS5BdWN0aW9uRmluaXNoZWQ7DQogICAgICAgICAgICBBdWN0aW9uRmluaXNoZWQoaGlnaGVzdEJpZGRlciwgaGlnaGVzdEJpZCk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBhdWN0aW9uRW5kVGltZSA9IFNhZmVNYXRoLmFkZChub3csIGF1Y3Rpb25EdXJhdGlvbik7DQogICAgICAgIGN1cnJlbnRTdGF0ZSA9IFN0YXRlLkF1Y3Rpb25TdGFydGVkOw0KICAgICAgICBBdWN0aW9uU3RhcnRlZChhdWN0aW9uRW5kVGltZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYmlkSW5BdWN0aW9uKCkgcGF5YWJsZQ0KICAgIG9ubHlJblN0YXRlKFN0YXRlLkF1Y3Rpb25TdGFydGVkKQ0KICAgIG9ubHlCZWZvcmUoYXVjdGlvbkVuZFRpbWUpIHsNCiAgICAgICAgLy9NdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gbWluaW1hbCBhbW91bnQNCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gTUlOX0VUSF9BTU9VTlQpOw0KICAgICAgICB1aW50MjU2IGJpZCA9IGNhbGN1bGF0ZVVzZXJCaWQoKTsNCg0KICAgICAgICAvL0lmIHRoZXJlIHdhcyBhIGJpZCBhbHJlYWR5DQogICAgICAgIGlmIChoaWdoZXN0QmlkID49IE1JTl9FVEhfQU1PVU5UKSB7DQogICAgICAgICAgICAvL011c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byAxMDUlIG9mIHByZXZpb3VzIGJpZA0KICAgICAgICAgICAgdWludDI1NiBtaW5pbWFsT3ZlckJpZCA9IFNhZmVNYXRoLmFkZChoaWdoZXN0QmlkLCBTYWZlTWF0aC5kaXYoDQogICAgICAgICAgICAgICAgU2FmZU1hdGgubXVsKGhpZ2hlc3RCaWQsIE1JTl9CSURfUEVSQ0VOVEFHRSksIDEwMA0KICAgICAgICAgICAgKSk7DQogICAgICAgICAgICByZXF1aXJlKGJpZCA+PSBtaW5pbWFsT3ZlckJpZCk7DQogICAgICAgICAgICAvL1JldHVybiB0byBwcmV2aW91cyBiaWRkZXIgaGlzIGJhbGFuY2UNCiAgICAgICAgICAgIC8vVmFsdWUgdG8gcmV0dXJuOiBjdXJyZW50IGJhbGFuY2UgLSBjdXJyZW50IGJpZCAtIHBheW1lbnRzSW5Bc3luY1NlbmQNCiAgICAgICAgICAgIHVpbnQyNTYgYW1vdW50VG9SZXR1cm4gPSBTYWZlTWF0aC5zdWIoU2FmZU1hdGguc3ViKA0KICAgICAgICAgICAgICAgIHRoaXMuYmFsYW5jZSwgbXNnLnZhbHVlDQogICAgICAgICAgICApLCB0b3RhbFBheW1lbnRzKTsNCiAgICAgICAgICAgIGlmICghaGlnaGVzdEJpZGRlci5zZW5kKGFtb3VudFRvUmV0dXJuKSkgew0KICAgICAgICAgICAgICAgIGFzeW5jU2VuZChoaWdoZXN0QmlkZGVyLCBhbW91bnRUb1JldHVybik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBoaWdoZXN0QmlkZGVyID0gbXNnLnNlbmRlcjsNCiAgICAgICAgaGlnaGVzdEJpZCA9IGJpZDsNCiAgICAgICAgSGlnaGVzdEJpZENoYW5nZWQoaGlnaGVzdEJpZGRlciwgaGlnaGVzdEJpZCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2FsY3VsYXRlVXNlckJpZCgpIHByaXZhdGUgcmV0dXJucyAodWludDI1Nikgew0KICAgICAgICB1aW50MjU2IGJpZCA9IG1zZy52YWx1ZTsNCiAgICAgICAgdWludDI1NiBjb250cmlidXRpb24gPSBiYWxhbmNlT2YobXNnLnNlbmRlcik7DQogICAgICAgIGlmIChjb250cmlidXRpb24gPiAwKSB7DQogICAgICAgICAgICAvL0Zvcm11bGE6IChzZW50RVRIICogYWxsVG9rZW5zKSAvIChhbGxUb2tlbnMgLSB1c2VyVG9rZW5zKQ0KICAgICAgICAgICAgLy9Vc2VyIHNlbmRzIDE2RVRILCBoYXMgNDAgb2YgMjAwIHRva2Vucw0KICAgICAgICAgICAgLy8oMTYgKiAyMDApIC8gKDIwMCAtIDQwKSA9PiAzMjAwIC8gMTYwID0+IDIwDQogICAgICAgICAgICBiaWQgPSBTYWZlTWF0aC5kaXYoDQogICAgICAgICAgICAgICAgU2FmZU1hdGgubXVsKG1zZy52YWx1ZSwgVE9UQUxfU1VQUExZKSwNCiAgICAgICAgICAgICAgICBTYWZlTWF0aC5zdWIoVE9UQUxfU1VQUExZLCBjb250cmlidXRpb24pDQogICAgICAgICAgICApOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBiaWQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZmluaXNoQXVjdGlvbigpDQogICAgb25seUluU3RhdGUoU3RhdGUuQXVjdGlvblN0YXJ0ZWQpDQogICAgb25seUFmdGVyKGF1Y3Rpb25FbmRUaW1lKSB7DQogICAgICAgIHJlcXVpcmUoaGlnaGVzdEJpZCA+IDApOyAgLy8gYXVjdGlvbiBjYW5ub3QgYmUgZmluaXNoZWQgdW50aWwgYXQgbGVhc3Qgb25lIHBlcnNvbiBiaWRzDQogICAgICAgIGN1cnJlbnRTdGF0ZSA9IFN0YXRlLkF1Y3Rpb25GaW5pc2hlZDsNCiAgICAgICAgQXVjdGlvbkZpbmlzaGVkKGhpZ2hlc3RCaWRkZXIsIGhpZ2hlc3RCaWQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3U2hhcmVzKGFkZHJlc3MgaG9sZGVyKSBwdWJsaWMNCiAgICBvbmx5SW5TdGF0ZShTdGF0ZS5BdWN0aW9uRmluaXNoZWQpIHsNCiAgICAgICAgdWludDI1NiBhdmFpbGFibGVUb2tlbnMgPSBiYWxhbmNlc1tob2xkZXJdOw0KICAgICAgICByZXF1aXJlKGF2YWlsYWJsZVRva2VucyA+IDApOw0KICAgICAgICBiYWxhbmNlc1tob2xkZXJdID0gMDsNCg0KICAgICAgICBpZiAoaG9sZGVyICE9IGhpZ2hlc3RCaWRkZXIpIHsNCiAgICAgICAgICAgIGhvbGRlci50cmFuc2ZlcigNCiAgICAgICAgICAgICAgICBTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKGhpZ2hlc3RCaWQsIGF2YWlsYWJsZVRva2VucyksIFRPVEFMX1NVUFBMWSkNCiAgICAgICAgICAgICk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBpc0tleUhvbGRlcihhZGRyZXNzIHBlcnNvbikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICByZXR1cm4gYmFsYW5jZXNbcGVyc29uXSA+PSBTYWZlTWF0aC5kaXYodG9rZW5zRm9ySWNvLCBUT0tFTlNfUEVSQ0VOVEFHRV9GT1JfS0VZX0hPTERFUik7IH0NCg0KICAgIC8qDQogICAgICAgIEdlbmVyYWwgbWV0aG9kcw0KICAgICovDQoNCiAgICAvLyBDYW5jZWwgSUNPIHdpbGwgYmUgcmVkZXNpZ25lZCB0byBwcmV2ZW50DQogICAgLy8gcmlzayBvZiB1c2VyIGZ1bmRzIG92ZXJ0YWtlbg0KDQogICAgLypmdW5jdGlvbiBjYW5jZWxJY28oKQ0KICAgIG9ubHlJblN0YXRlKFN0YXRlLkljb1N0YXJ0ZWQpDQogICAgb25seVRyaXZpYWwoKSB7DQogICAgICAgIGN1cnJlbnRTdGF0ZSA9IFN0YXRlLkljb0NhbmNlbGxlZDsNCiAgICAgICAgSWNvQ2FuY2VsbGVkKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2xhaW1JY29Db250cmlidXRpb24oYWRkcmVzcyBjb250cmlidXRvcikgb25seUluU3RhdGUoU3RhdGUuSWNvQ2FuY2VsbGVkKSB7DQogICAgICAgIHVpbnQyNTYgY29udHJpYnV0aW9uID0gY29udHJpYnV0aW9uc1tjb250cmlidXRvcl07DQogICAgICAgIHJlcXVpcmUoY29udHJpYnV0aW9uID4gMCk7DQogICAgICAgIGNvbnRyaWJ1dGlvbnNbY29udHJpYnV0b3JdID0gMDsNCiAgICAgICAgY29udHJpYnV0b3IudHJhbnNmZXIoY29udHJpYnV0aW9uKTsNCiAgICB9Ki8NCg0KICAgIGZ1bmN0aW9uIHNldEF1Y3Rpb25XaW5uZXJNZXNzYWdlSGFzaChieXRlczMyIF9hdWN0aW9uV2lubmVyTWVzc2FnZUhhc2gpDQogICAgb25seUF1Y3Rpb25XaW5uZXIoKSB7DQogICAgICAgIGF1Y3Rpb25XaW5uZXJNZXNzYWdlSGFzaCA9IF9hdWN0aW9uV2lubmVyTWVzc2FnZUhhc2g7DQogICAgICAgIFdpbm5lclByb3ZpZGVkSGFzaCgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGtpbGxDb250cmFjdCgpDQogICAgb25seVRyaXZpYWwoKSB7DQogICAgICAgIHJlcXVpcmUoDQogICAgICAgICAgICAoDQogICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID09IFN0YXRlLkF1Y3Rpb25GaW5pc2hlZCAmJg0KICAgICAgICAgICAgICAgIG5vdyA+IFNhZmVNYXRoLmFkZChhdWN0aW9uRW5kVGltZSwgQ0xFQU5VUF9ERUxBWSkgLy8gRGVsYXkgaW4gY29ycmVjdCBzdGF0ZQ0KICAgICAgICAgICAgKSB8fA0KICAgICAgICAgICAgY3VycmVudFN0YXRlID09IFN0YXRlLkljb0NhbmNlbGxlZCAvLyBObyBkZWxheSBpbiBjYW5jZWxsZWQgc3RhdGUNCiAgICAgICAgKTsNCiAgICAgICAgc2VsZmRlc3RydWN0KHRyaXZpYWwpOw0KICAgIH0NCg0KICAgIC8vIGhlbHBlciBmdW5jdGlvbiB0byBhdm9pZCB0b28gbWFueSBjb250cmFjdCBjYWxscyBvbiBmcm9udGVuZCBzaWRlDQogICAgZnVuY3Rpb24gZ2V0Q29udHJhY3RTdGF0ZSgpIGNvbnN0YW50IHJldHVybnMgKA0KICAgICAgICB1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2LA0KICAgICAgICB1aW50MjU2LCB1aW50MjU2LCBhZGRyZXNzLCB1aW50MjU2LCBTdGF0ZSwNCiAgICAgICAgdWludDI1NiwgdWludDI1Ng0KICAgICkgew0KICAgICAgICByZXR1cm4gKA0KICAgICAgICAgICAgaWNvRW5kVGltZSwgYXVjdGlvbkR1cmF0aW9uLCBhdWN0aW9uRW5kVGltZSwNCiAgICAgICAgICAgIHRva2Vuc0ZvckFydGlzdCwgdG9rZW5zRm9yVHJpdmlhbCwgdG9rZW5zRm9ySWNvLA0KICAgICAgICAgICAgYW1vdW50UmFpc2VkLCBoaWdoZXN0QmlkZGVyLCBoaWdoZXN0QmlkLCBjdXJyZW50U3RhdGUsDQogICAgICAgICAgICBUT0tFTlNfUEVSQ0VOVEFHRV9GT1JfS0VZX0hPTERFUiwgTUlOX0JJRF9QRVJDRU5UQUdFDQogICAgICAgICk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgb25seUluU3RhdGUoU3RhdGUuSWNvRmluaXNoZWQpIHJldHVybnMgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIEVSQzIyM1Rva2VuLnRyYW5zZmVyKF90bywgX3ZhbHVlLCBfZGF0YSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7DQogICAgICAgIC8vIG9ubHlJblN0YXRlKEljb0ZpbmlzaGVkKSBjaGVjayBpcyBjb250YWluZWQgaW4gYSBjYWxsIGJlbG93DQogICAgICAgIGJ5dGVzIG1lbW9yeSBlbXB0eTsNCiAgICAgICAgcmV0dXJuIHRyYW5zZmVyKF90bywgX3ZhbHVlLCBlbXB0eSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7DQogICAgICAgIHJldmVydCgpOw0KICAgIH0NCn0='