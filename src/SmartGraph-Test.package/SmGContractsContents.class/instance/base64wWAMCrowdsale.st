base 64 content
base64wWAMCrowdsale
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC42Ow0KDQovKioNCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MNCiAqLw0KY29udHJhY3QgU2FmZU1hdGggew0KICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7DQogICAgdWludCBjID0gYSAqIGI7DQogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICBhc3NlcnQoYiA+IDApOw0KICAgIHVpbnQgYyA9IGEgLyBiOw0KICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOw0KICAgIHJldHVybiBjOw0KICB9DQoNCiAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgew0KICAgIGFzc2VydChiIDw9IGEpOw0KICAgIHJldHVybiBhIC0gYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsNCiAgICB1aW50IGMgPSBhICsgYjsNCiAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsNCiAgICByZXR1cm4gYzsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7DQogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsNCiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhID49IGIgPyBhIDogYjsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikgew0KICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOw0KICB9DQoNCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7DQogICAgaWYgKCFhc3NlcnRpb24pIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KfQ0KDQovKg0KICogT3duYWJsZQ0KICoNCiAqIEJhc2UgY29udHJhY3Qgd2l0aCBhbiBvd25lci4NCiAqIFByb3ZpZGVzIG9ubHlPd25lciBtb2RpZmllciwgd2hpY2ggcHJldmVudHMgZnVuY3Rpb24gZnJvbSBydW5uaW5nIGlmIGl0IGlzIGNhbGxlZCBieSBhbnlvbmUgb3RoZXIgdGhhbiB0aGUgb3duZXIuDQogKi8NCmNvbnRyYWN0IE93bmFibGUgew0KICBhZGRyZXNzIHB1YmxpYyBvd25lcjsNCg0KICBmdW5jdGlvbiBPd25hYmxlKCkgew0KICAgIG93bmVyID0gbXNnLnNlbmRlcjsNCiAgfQ0KDQogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsNCiAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgew0KICAgICAgdGhyb3c7DQogICAgfQ0KICAgIF87DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgew0KICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7DQogICAgICBvd25lciA9IG5ld093bmVyOw0KICAgIH0NCiAgfQ0KDQp9DQoNCg0KLyoNCiAqIEhhbHRhYmxlDQogKg0KICogQWJzdHJhY3QgY29udHJhY3QgdGhhdCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuDQogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuDQogKg0KICoNCiAqIE9yaWdpbmFsbHkgZW52aXNpb25lZCBpbiBGaXJzdEJsb29kIElDTyBjb250cmFjdC4NCiAqLw0KY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7DQogIGJvb2wgcHVibGljIGhhbHRlZDsNCg0KICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgew0KICAgIGlmIChoYWx0ZWQpIHRocm93Ow0KICAgIF87DQogIH0NCg0KICBtb2RpZmllciBvbmx5SW5FbWVyZ2VuY3kgew0KICAgIGlmICghaGFsdGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQoNCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUNCiAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7DQogICAgaGFsdGVkID0gdHJ1ZTsNCiAgfQ0KDQogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUNCiAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7DQogICAgaGFsdGVkID0gZmFsc2U7DQogIH0NCg0KfQ0KDQovKioNCiAqIEludGVyZmFjZSBmb3IgZGVmaW5pbmcgY3Jvd2RzYWxlIHByaWNpbmcuDQogKi8NCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7DQoNCiAgLyoqIEludGVyZmFjZSBkZWNsYXJhdGlvbi4gKi8NCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLyoqIFNlbGYgY2hlY2sgaWYgYWxsIHJlZmVyZW5jZXMgYXJlIGNvcnJlY3RseSBzZXQuDQogICAqDQogICAqIENoZWNrcyB0aGF0IHByaWNpbmcgc3RyYXRlZ3kgbWF0Y2hlcyBjcm93ZHNhbGUgcGFyYW1ldGVycy4NCiAgICovDQogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIGNyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0Lg0KICAgKg0KICAgKg0KICAgKiBAcGFyYW0gdmFsdWUgLSBXaGF0IGlzIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VuZCBpbiBhcyB3ZWkNCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXINCiAgICogQHBhcmFtIHdlaVJhaXNlZCAtIGhvdyBtdWNoIG1vbmV5IGhhcyBiZWVuIHJhaXNlZCB0aGlzIGZhcg0KICAgKiBAcGFyYW0gbXNnU2VuZGVyIC0gd2hvIGlzIHRoZSBpbnZlc3RvciBvZiB0aGlzIHRyYW5zYWN0aW9uDQogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcw0KICAgKiBAcmV0dXJuIEFtb3VudCBvZiB0b2tlbnMgdGhlIGludmVzdG9yIHJlY2VpdmVzDQogICAqLw0KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHdlaVJhaXNlZCwgdWludCB0b2tlbnNTb2xkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOw0KfQ0KDQovKioNCiAqIEZpbmFsaXplIGFnZW50IGRlZmluZXMgd2hhdCBoYXBwZW5zIGF0IHRoZSBlbmQgb2Ygc3VjY2VzZWZ1bCBjcm93ZHNhbGUuDQogKg0KICogLSBBbGxvY2F0ZSB0b2tlbnMgZm9yIGZvdW5kZXJzLCBib3VudGllcyBhbmQgY29tbXVuaXR5DQogKiAtIE1ha2UgdG9rZW5zIHRyYW5zZmVyYWJsZQ0KICogLSBldGMuDQogKi8NCmNvbnRyYWN0IEZpbmFsaXplQWdlbnQgew0KDQogIGZ1bmN0aW9uIGlzRmluYWxpemVBZ2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIC8qKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBjYW4gcnVuIGZpbmFsaXplQ3Jvd2RzYWxlKCkgcHJvcGVybHkuDQogICAqDQogICAqIFRoaXMgaXMgYSBzYWZldHkgY2hlY2sgZnVuY3Rpb24gdGhhdCBkb2Vzbid0IGFsbG93IGNyb3dkc2FsZSB0byBiZWdpbg0KICAgKiB1bmxlc3MgdGhlIGZpbmFsaXplciBoYXMgYmVlbiBzZXQgdXAgcHJvcGVybHkuDQogICAqLw0KICBmdW5jdGlvbiBpc1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7DQoNCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLiAqLw0KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpOw0KDQp9DQoNCi8qDQogKiBFUkMyMCBpbnRlcmZhY2UNCiAqIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjANCiAqLw0KY29udHJhY3QgRVJDMjAgew0KICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsNCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOw0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7DQogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOw0KICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsNCn0NCg0KDQovKioNCiAqIEEgdG9rZW4gdGhhdCBkZWZpbmVzIGZyYWN0aW9uYWwgdW5pdHMgYXMgZGVjaW1hbHMuDQogKi8NCmNvbnRyYWN0IEZyYWN0aW9uYWxFUkMyMCBpcyBFUkMyMCB7DQoNCiAgdWludCBwdWJsaWMgZGVjaW1hbHM7DQoNCn0NCg0KDQovKioNCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLg0KICoNCiAqIEhhbmRsZQ0KICogLSBzdGFydCBhbmQgZW5kIGRhdGVzDQogKiAtIGFjY2VwdGluZyBpbnZlc3RtZW50cw0KICogLSBtaW5pbXVtIGZ1bmRpbmcgZ29hbCBhbmQgcmVmdW5kDQogKiAtIHZhcmlvdXMgc3RhdGlzdGljcyBkdXJpbmcgdGhlIGNyb3dkZnVuZA0KICoNCiAqLw0KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIEhhbHRhYmxlLCBTYWZlTWF0aCB7DQoNCiAgLyogTWF4IGludmVzdG1lbnQgY291bnQgd2hlbiB3ZSBhcmUgc3RpbGwgYWxsb3dlZCB0byBjaGFuZ2UgdGhlIG11bHRpc2lnIGFkZHJlc3MgKi8NCiAgdWludCBwdWJsaWMgTUFYX0lOVkVTVE1FTlRTX0JFRk9SRV9NVUxUSVNJR19DSEFOR0UgPSA1Ow0KDQogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLw0KICBGcmFjdGlvbmFsRVJDMjAgcHVibGljIHRva2VuOw0KDQogIC8qIEhvdyB3ZSBhcmUgZ29pbmcgdG8gcHJpY2Ugb3VyIG9mZmVyaW5nICovDQogIFByaWNpbmdTdHJhdGVneSBwdWJsaWMgcHJpY2luZ1N0cmF0ZWd5Ow0KDQogIC8qIFBvc3Qtc3VjY2VzcyBjYWxsYmFjayAqLw0KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50Ow0KDQogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8NCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7DQoNCiAgLyogaWYgdGhlIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZCwgaW52ZXN0b3JzIG1heSB3aXRoZHJhdyB0aGVpciBmdW5kcyAqLw0KICB1aW50IHB1YmxpYyBtaW5pbXVtRnVuZGluZ0dvYWw7DQoNCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLw0KICB1aW50IHB1YmxpYyBzdGFydHNBdDsNCg0KICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLw0KICB1aW50IHB1YmxpYyBlbmRzQXQ7DQoNCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovDQogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOw0KDQogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovDQogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7DQoNCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8NCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7DQoNCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLw0KICB1aW50IHB1YmxpYyBsb2FkZWRSZWZ1bmQgPSAwOw0KDQogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIGdpdmVuIGJhY2sgdG8gaW52ZXN0b3JzLiovDQogIHVpbnQgcHVibGljIHdlaVJlZnVuZGVkID0gMDsNCg0KICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8NCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOw0KDQogIC8qKiBIb3cgbXVjaCBFVEggZWFjaCBhZGRyZXNzIGhhcyBpbnZlc3RlZCB0byB0aGlzIGNyb3dkc2FsZSAqLw0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOw0KDQogIC8qKiBIb3cgbXVjaCB0b2tlbnMgdGhpcyBjcm93ZHNhbGUgaGFzIGNyZWRpdGVkIGZvciBlYWNoIGludmVzdG9yIGFkZHJlc3MgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsNCg0KICAvKiogQWRkcmVzc2VzIHRoYXQgYXJlIGFsbG93ZWQgdG8gaW52ZXN0IGV2ZW4gYmVmb3JlIElDTyBvZmZpY2FsIG9wZW5zLiBGb3IgdGVzdGluZywgZm9yIElDTyBwYXJ0bmVycywgZXRjLiAqLw0KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0Ow0KDQogIC8qKiBUaGlzIGlzIGZvciBtYW51bCB0ZXN0aW5nIGZvciB0aGUgaW50ZXJhY3Rpb24gZnJvbSBvd25lciB3YWxsZXQuIFlvdSBjYW4gc2V0IGl0IHRvIGFueSB2YWx1ZSBhbmQgaW5zcGVjdCB0aGlzIGluIGJsb2NrY2hhaW4gZXhwbG9yZXIgdG8gc2VlIHRoYXQgY3Jvd2RzYWxlIGludGVyYWN0aW9uIHdvcmtzLiAqLw0KICB1aW50IHB1YmxpYyBvd25lclRlc3RWYWx1ZTsNCg0KICAvKiogU3RhdGUgbWFjaGluZQ0KICAgKg0KICAgKiAtIFByZXBhcmluZzogQWxsIGNvbnRyYWN0IGluaXRpYWxpemF0aW9uIGNhbGxzIGFuZCB2YXJpYWJsZXMgaGF2ZSBub3QgYmVlbiBzZXQgeWV0DQogICAqIC0gUHJlZnVuZGluZzogV2UgaGF2ZSBub3QgcGFzc2VkIHN0YXJ0IHRpbWUgeWV0DQogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQ0KICAgKiAtIFN1Y2Nlc3M6IE1pbmltdW0gZnVuZGluZyBnb2FsIHJlYWNoZWQNCiAgICogLSBGYWlsdXJlOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBub3QgcmVhY2hlZCBiZWZvcmUgZW5kaW5nIHRpbWUNCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZWQgaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZA0KICAgKiAtIFJlZnVuZGluZzogUmVmdW5kcyBhcmUgbG9hZGVkIG9uIHRoZSBjb250cmFjdCBmb3IgcmVjbGFpbS4NCiAgICovDQogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlcGFyaW5nLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGYWlsdXJlLCBGaW5hbGl6ZWQsIFJlZnVuZGluZ30NCg0KICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlDQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50KTsNCg0KICAvLyBSZWZ1bmQgd2FzIHByb2Nlc3NlZCBmb3IgYSBjb250cmlidXRvcg0KICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOw0KDQogIC8vIEFkZHJlc3MgZWFybHkgcGFydGljaXBhdGlvbiB3aGl0ZWxpc3Qgc3RhdHVzIGNoYW5nZWQNCiAgZXZlbnQgV2hpdGVsaXN0ZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cyk7DQoNCiAgLy8gQ3Jvd2RzYWxlIGVuZCB0aW1lIGhhcyBiZWVuIGNoYW5nZWQNCiAgZXZlbnQgRW5kc0F0Q2hhbmdlZCh1aW50IGVuZHNBdCk7DQoNCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKGFkZHJlc3MgX3Rva2VuLCBQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSwgYWRkcmVzcyBfbXVsdGlzaWdXYWxsZXQsIHVpbnQgX3N0YXJ0LCB1aW50IF9lbmQsIHVpbnQgX21pbmltdW1GdW5kaW5nR29hbCkgew0KDQogICAgb3duZXIgPSBtc2cuc2VuZGVyOw0KDQogICAgdG9rZW4gPSBGcmFjdGlvbmFsRVJDMjAoX3Rva2VuKTsNCg0KICAgIHNldFByaWNpbmdTdHJhdGVneShfcHJpY2luZ1N0cmF0ZWd5KTsNCg0KICAgIG11bHRpc2lnV2FsbGV0ID0gX211bHRpc2lnV2FsbGV0Ow0KICAgIGlmKG11bHRpc2lnV2FsbGV0ID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgaWYoX3N0YXJ0ID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgc3RhcnRzQXQgPSBfc3RhcnQ7DQoNCiAgICBpZihfZW5kID09IDApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgZW5kc0F0ID0gX2VuZDsNCg0KICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzDQogICAgaWYoc3RhcnRzQXQgPj0gZW5kc0F0KSB7DQogICAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8vIE1pbmltdW0gZnVuZGluZyBnb2FsIGNhbiBiZSB6ZXJvDQogICAgbWluaW11bUZ1bmRpbmdHb2FsID0gX21pbmltdW1GdW5kaW5nR29hbDsNCiAgfQ0KDQogIC8qKg0KICAgKiBTZW5kIGluIG1vbmV5IGFuZCBnZXQgdG9rZW5zLg0KICAgKi8NCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsNCiAgICBpbnZlc3RJbnRlcm5hbChtc2cuc2VuZGVyKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBNYWtlIGFuIGludmVzdG1lbnQuDQogICAqDQogICAqIENyb3dkc2FsZSBtdXN0IGJlIHJ1bm5pbmcgZm9yIG9uZSB0byBpbnZlc3QuDQogICAqIFdlIG11c3QgaGF2ZSBub3QgcHJlc3NlZCB0aGUgZW1lcmdlbmN5IGJyYWtlLg0KICAgKg0KICAgKiBAcGFyYW0gcmVjZWl2ZXIgVGhlIEV0aGVyZXVtIGFkZHJlc3Mgd2hvIHJlY2VpdmVzIHRoZSB0b2tlbnMNCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIpIHN0b3BJbkVtZXJnZW5jeSBwcml2YXRlIHsNCg0KICAgIC8vIERldGVybWluZSBpZiBpdCdzIGEgZ29vZCB0aW1lIHRvIGFjY2VwdCBpbnZlc3RtZW50IGZyb20gdGhpcyBwYXJ0aWNpcGFudA0KICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgew0KICAgICAgLy8gQXJlIHdlIHdoaXRlbGlzdGVkIGZvciBlYXJseSBkZXBvc2l0DQogICAgICBpZighZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0pIHsNCiAgICAgICAgdGhyb3c7DQogICAgICB9DQogICAgfSBlbHNlIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuRnVuZGluZykgew0KICAgICAgLy8gUmV0YWlsIHBhcnRpY2lwYW50cyBjYW4gb25seSBjb21lIGluIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyBydW5uaW5nDQogICAgICAvLyBwYXNzDQogICAgfSBlbHNlIHsNCiAgICAgIC8vIFVud2FudGVkIHN0YXRlDQogICAgICB0aHJvdzsNCiAgICB9DQoNCiAgICB1aW50IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsNCiAgICB1aW50IHRva2VuQW1vdW50ID0gcHJpY2luZ1N0cmF0ZWd5LmNhbGN1bGF0ZVByaWNlKHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsNCg0KICAgIGlmKHRva2VuQW1vdW50ID09IDApIHsNCiAgICAgIC8vIER1c3QgdHJhbnNhY3Rpb24NCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIGlmKGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID09IDApIHsNCiAgICAgICAvLyBBIG5ldyBpbnZlc3Rvcg0KICAgICAgIGludmVzdG9yQ291bnQrKzsNCiAgICB9DQoNCiAgICAvLyBVcGRhdGUgaW52ZXN0b3INCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IHNhZmVBZGQoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0sIHdlaUFtb3VudCk7DQogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSBzYWZlQWRkKHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLCB0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBVcGRhdGUgdG90YWxzDQogICAgd2VpUmFpc2VkID0gc2FmZUFkZCh3ZWlSYWlzZWQsIHdlaUFtb3VudCk7DQogICAgdG9rZW5zU29sZCA9IHNhZmVBZGQodG9rZW5zU29sZCwgdG9rZW5BbW91bnQpOw0KDQogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcA0KICAgIGlmKGlzQnJlYWtpbmdDYXAod2VpQW1vdW50LCB0b2tlbkFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkKSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7DQoNCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5DQogICAgaWYoIW11bHRpc2lnV2FsbGV0LnNlbmQod2VpQW1vdW50KSkgdGhyb3c7DQoNCiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2Vzcw0KICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50KTsNCiAgfQ0KDQogIC8qKg0KICAgKiBGaW5hbGl6ZSBhIHN1Y2NjZXNmdWwgY3Jvd2RzYWxlLg0KICAgKg0KICAgKiBUaGUgb3duZXIgY2FuIHRyaWdnZXIgYSBjYWxsIHRoZSBjb250cmFjdCB0aGF0IHByb3ZpZGVzIHBvc3QtY3Jvd2RzYWxlIGFjdGlvbnMsIGxpa2UgcmVsZWFzaW5nIHRoZSB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgew0KDQogICAgLy8gQWxyZWFkeSBmaW5hbGl6ZWQNCiAgICBpZihmaW5hbGl6ZWQpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCg0KICAgIC8vIEZpbmFsaXppbmcgaXMgb3B0aW9uYWwuIFdlIG9ubHkgY2FsbCBpdCBpZiB3ZSBhcmUgZ2l2ZW4gYSBmaW5hbGl6aW5nIGFnZW50Lg0KICAgIGlmKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgIT0gMCkgew0KICAgICAgZmluYWxpemVBZ2VudC5maW5hbGl6ZUNyb3dkc2FsZSgpOw0KICAgIH0NCg0KICAgIGZpbmFsaXplZCA9IHRydWU7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgdG8gKHJlKXNldCBmaW5hbGl6ZSBhZ2VudC4NCiAgICoNCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHNldHRpbmcgdGhpcywgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuDQogICAqLw0KICBmdW5jdGlvbiBzZXRGaW5hbGl6ZUFnZW50KEZpbmFsaXplQWdlbnQgYWRkcikgb25seU93bmVyIHsNCiAgICBmaW5hbGl6ZUFnZW50ID0gYWRkcjsNCg0KICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50DQogICAgaWYoIWZpbmFsaXplQWdlbnQuaXNGaW5hbGl6ZUFnZW50KCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4NCiAgICoNCiAgICogVE9ETzogRml4IHNwZWxsaW5nIGVycm9yIGluIHRoZSBuYW1lDQogICAqLw0KICBmdW5jdGlvbiBzZXRFYXJseVBhcmljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cykgb25seU93bmVyIHsNCiAgICBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdID0gc3RhdHVzOw0KICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7DQogIH0NCg0KICAvKioNCiAgICogQWxsb3cgY3Jvd2RzYWxlIG93bmVyIHRvIGNsb3NlIGVhcmx5IG9yIGV4dGVuZCB0aGUgY3Jvd2RzYWxlLg0KICAgKg0KICAgKiBUaGlzIGlzIHVzZWZ1bCBlLmcuIGZvciBhIG1hbnVhbCBzb2Z0IGNhcCBpbXBsZW1lbnRhdGlvbjoNCiAgICogLSBhZnRlciBYIGFtb3VudCBpcyByZWFjaGVkIGRldGVybWluZSBtYW51YWwgY2xvc2luZw0KICAgKg0KICAgKiBUaGlzIG1heSBwdXQgdGhlIGNyb3dkc2FsZSB0byBhbiBpbnZhbGlkIHN0YXRlLA0KICAgKiBidXQgd2UgdHJ1c3Qgb3duZXJzIGtub3cgd2hhdCB0aGV5IGFyZSBkb2luZy4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIHNldEVuZHNBdCh1aW50IHRpbWUpIG9ubHlPd25lciB7DQoNCiAgICBpZihub3cgPiB0aW1lKSB7DQogICAgICB0aHJvdzsgLy8gRG9uJ3QgY2hhbmdlIHBhc3QNCiAgICB9DQoNCiAgICBlbmRzQXQgPSB0aW1lOw0KICAgIEVuZHNBdENoYW5nZWQoZW5kc0F0KTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuDQogICAqDQogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiB0aGUgc2V0LCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4NCiAgICovDQogIGZ1bmN0aW9uIHNldFByaWNpbmdTdHJhdGVneShQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSkgb25seU93bmVyIHsNCiAgICBwcmljaW5nU3RyYXRlZ3kgPSBfcHJpY2luZ1N0cmF0ZWd5Ow0KDQogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQNCiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsNCiAgICAgIHRocm93Ow0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBBbGxvdyB0byBjaGFuZ2UgdGhlIHRlYW0gbXVsdGlzaWcgYWRkcmVzcyBpbiB0aGUgY2FzZSBvZiBlbWVyZ2VuY3kuDQogICAqDQogICAqIFRoaXMgYWxsb3dzIHRvIHNhdmUgYSBkZXBsb3llZCBjcm93ZHNhbGUgd2FsbGV0IGluIHRoZSBjYXNlIHRoZSBjcm93ZHNhbGUgaGFzIG5vdCB5ZXQgYmVndW4NCiAgICogKHdlIGhhdmUgZG9uZSBvbmx5IGZldyB0ZXN0IHRyYW5zYWN0aW9ucykuIEFmdGVyIHRoZSBjcm93ZHNhbGUgaXMgZ29pbmcNCiAgICogdGhlbiBtdWx0aXNpZyBhZGRyZXNzIHN0YXlzIGxvY2tlZCBmb3IgdGhlIHNhZmV0eSByZWFzb25zLg0KICAgKi8NCiAgZnVuY3Rpb24gc2V0TXVsdGlzaWcoYWRkcmVzcyBhZGRyKSBwdWJsaWMgb25seU93bmVyIHsNCg0KICAgIC8vIENoYW5nZQ0KICAgIGlmKGludmVzdG9yQ291bnQgPiBNQVhfSU5WRVNUTUVOVFNfQkVGT1JFX01VTFRJU0lHX0NIQU5HRSkgew0KICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgbXVsdGlzaWdXYWxsZXQgPSBhZGRyOw0KICB9DQoNCiAgLyoqDQogICAqIEFsbG93IGxvYWQgcmVmdW5kcyBiYWNrIG9uIHRoZSBjb250cmFjdCBmb3IgdGhlIHJlZnVuZGluZy4NCiAgICoNCiAgICogVGhlIHRlYW0gY2FuIHRyYW5zZmVyIHRoZSBmdW5kcyBiYWNrIG9uIHRoZSBzbWFydCBjb250cmFjdCBpbiB0aGUgY2FzZSB0aGUgbWluaW11bSBnb2FsIHdhcyBub3QgcmVhY2hlZC4uDQogICAqLw0KICBmdW5jdGlvbiBsb2FkUmVmdW5kKCkgcHVibGljIHBheWFibGUgaW5TdGF0ZShTdGF0ZS5GYWlsdXJlKSB7DQogICAgaWYobXNnLnZhbHVlID09IDApIHRocm93Ow0KICAgIGxvYWRlZFJlZnVuZCA9IHNhZmVBZGQobG9hZGVkUmVmdW5kLCBtc2cudmFsdWUpOw0KICB9DQoNCiAgLyoqDQogICAqIEludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kLg0KICAgKg0KICAgKiBOb3RlIHRoYXQgYW55IHJlZnVuZHMgZnJvbSBwcm94eSBidXllcnMgc2hvdWxkIGJlIGhhbmRsZWQgc2VwYXJhdGVseSwNCiAgICogYW5kIG5vdCB0aHJvdWdoIHRoaXMgY29udHJhY3QuDQogICAqLw0KICBmdW5jdGlvbiByZWZ1bmQoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5SZWZ1bmRpbmcpIHsNCiAgICB1aW50MjU2IHdlaVZhbHVlID0gaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXTsNCiAgICBpZiAod2VpVmFsdWUgPT0gMCkgdGhyb3c7DQogICAgaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXSA9IDA7DQogICAgd2VpUmVmdW5kZWQgPSBzYWZlQWRkKHdlaVJlZnVuZGVkLCB3ZWlWYWx1ZSk7DQogICAgUmVmdW5kKG1zZy5zZW5kZXIsIHdlaVZhbHVlKTsNCiAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh3ZWlWYWx1ZSkpIHRocm93Ow0KICB9DQoNCiAgLyoqDQogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY3Jvd2RzYWxlIGhhcyByYWlzZWQgZW5vdWdoIG1vbmV5IHRvIGJlIGEgc3VjY2Vzc2Z1bC4NCiAgICovDQogIGZ1bmN0aW9uIGlzTWluaW11bUdvYWxSZWFjaGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmVhY2hlZCkgew0KICAgIHJldHVybiB3ZWlSYWlzZWQgPj0gbWluaW11bUZ1bmRpbmdHb2FsOw0KICB9DQoNCiAgLyoqDQogICAqIENoZWNrIGlmIHRoZSBjb250cmFjdCByZWxhdGlvbnNoaXAgbG9va3MgZ29vZC4NCiAgICovDQogIGZ1bmN0aW9uIGlzRmluYWxpemVyU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsNCiAgICByZXR1cm4gZmluYWxpemVBZ2VudC5pc1NhbmUoKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuDQogICAqLw0KICBmdW5jdGlvbiBpc1ByaWNpbmdTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgc2FuZSkgew0KICAgIHJldHVybiBwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpOw0KICB9DQoNCiAgLyoqDQogICAqIENyb3dkZnVuZCBzdGF0ZSBtYWNoaW5lIG1hbmFnZW1lbnQuDQogICAqDQogICAqIFdlIG1ha2UgaXQgYSBmdW5jdGlvbiBhbmQgZG8gbm90IGFzc2lnbiB0aGUgcmVzdWx0IHRvIGEgdmFyaWFibGUsIHNvIHRoZXJlIGlzIG5vIGNoYW5jZSBvZiB0aGUgdmFyaWFibGUgYmVpbmcgc3RhbGUuDQogICAqLw0KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgew0KICAgIGlmKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsNCiAgICBlbHNlIGlmIChhZGRyZXNzKGZpbmFsaXplQWdlbnQpID09IDApIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7DQogICAgZWxzZSBpZiAoIWZpbmFsaXplQWdlbnQuaXNTYW5lKCkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7DQogICAgZWxzZSBpZiAoIXByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7DQogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDwgc3RhcnRzQXQpIHJldHVybiBTdGF0ZS5QcmVGdW5kaW5nOw0KICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsNCiAgICBlbHNlIGlmIChpc01pbmltdW1Hb2FsUmVhY2hlZCgpKSByZXR1cm4gU3RhdGUuU3VjY2VzczsNCiAgICBlbHNlIGlmICghaXNNaW5pbXVtR29hbFJlYWNoZWQoKSAmJiB3ZWlSYWlzZWQgPiAwICYmIGxvYWRlZFJlZnVuZCA+PSB3ZWlSYWlzZWQpIHJldHVybiBTdGF0ZS5SZWZ1bmRpbmc7DQogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsNCiAgfQ0KDQogIC8qKiBUaGlzIGlzIGZvciBtYW51YWwgdGVzdGluZyBvZiBtdWx0aXNpZyB3YWxsZXQgaW50ZXJhY3Rpb24gKi8NCiAgZnVuY3Rpb24gc2V0T3duZXJUZXN0VmFsdWUodWludCB2YWwpIG9ubHlPd25lciB7DQogICAgb3duZXJUZXN0VmFsdWUgPSB2YWw7DQogIH0NCg0KICAvKiogSW50ZXJmYWNlIG1hcmtlci4gKi8NCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLy8NCiAgLy8gTW9kaWZpZXJzDQogIC8vDQoNCiAgLyoqIE1vZGlmaWVkIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcuICAqLw0KICBtb2RpZmllciBpblN0YXRlKFN0YXRlIHN0YXRlKSB7DQogICAgaWYoZ2V0U3RhdGUoKSAhPSBzdGF0ZSkgdGhyb3c7DQogICAgXzsNCiAgfQ0KDQoNCiAgLy8NCiAgLy8gQWJzdHJhY3QgZnVuY3Rpb25zDQogIC8vDQoNCiAgLyoqDQogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGludmVzdGVkIGJyZWFrcyBvdXIgY2FwIHJ1bGVzLg0KICAgKg0KICAgKg0KICAgKiBUaGUgY2hpbGQgY29udHJhY3QgbXVzdCBkZWZpbmUgdGhlaXIgb3duIGNhcCBzZXR0aW5nIHJ1bGVzLg0KICAgKiBXZSBhbGxvdyBhIGxvdCBvZiBmbGV4aWJpbGl0eSB0aHJvdWdoIGRpZmZlcmVudCBjYXBwaW5nIHN0cmF0ZWdpZXMgKEVUSCwgdG9rZW4gY291bnQpDQogICAqIENhbGxlZCBmcm9tIGludmVzdCgpLg0KICAgKg0KICAgKiBAcGFyYW0gd2VpQW1vdW50IFRoZSBhbW91bnQgb2Ygd2VpIHRoZSBpbnZlc3RvciB0cmllcyB0byBpbnZlc3QgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24NCiAgICogQHBhcmFtIHRva2VuQW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHdlIHRyeSB0byBnaXZlIHRvIHRoZSBpbnZlc3RvciBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gd2VpUmFpc2VkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgcmFpc2VkIGJhbGFuY2UgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbg0KICAgKiBAcGFyYW0gdG9rZW5zU29sZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHNvbGQgdG9rZW5zIGNvdW50IGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24NCiAgICoNCiAgICogQHJldHVybiB0cnVlIGlmIHRha2luZyB0aGlzIGludmVzdG1lbnQgd291bGQgYnJlYWsgb3VyIGNhcCBydWxlcw0KICAgKi8NCiAgZnVuY3Rpb24gaXNCcmVha2luZ0NhcCh1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludCB3ZWlSYWlzZWRUb3RhbCwgdWludCB0b2tlbnNTb2xkVG90YWwpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgbGltaXRCcm9rZW4pOw0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBjcm93ZHNhbGUgaXMgZnVsbCBhbmQgd2UgY2FuIG5vIGxvbmdlciBzZWxsIGFueSB0b2tlbnMuDQogICAqLw0KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7DQoNCiAgLyoqDQogICAqIENyZWF0ZSBuZXcgdG9rZW5zIG9yIHRyYW5zZmVyIGlzc3VlZCB0b2tlbnMgdG8gdGhlIGludmVzdG9yIGRlcGVuZGluZyBvbiB0aGUgY2FwIG1vZGVsLg0KICAgKi8NCiAgZnVuY3Rpb24gYXNzaWduVG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIHByaXZhdGU7DQp9DQoNCi8qKg0KICogRml4ZWQgY3Jvd2RzYWxlIHByaWNpbmcgLSBldmVyeWJvZHkgZ2V0cyB0aGUgc2FtZSBwcmljZS4NCiAqLw0KY29udHJhY3QgV1dBTVByaWNpbmdTdHJhdGVneSBpcyBQcmljaW5nU3RyYXRlZ3ksIE93bmFibGUsIFNhZmVNYXRoIHsNCg0KICB1aW50IHJvdW5kMUJlZ2luc0F0Ow0KICB1aW50IHJvdW5kMkJlZ2luc0F0Ow0KICB1aW50IGZpbmFsUm91bmRCZWdpbnNBdDsNCiAgdWludCBiYXNlUmF0ZSA9IDUwMDAwMDAwMDAwMDA7IC8vd2VpIHBlciBXV0FNDQogIA0KICBlbnVtIEN1cnJlbnRSb3VuZCB7IFJvdW5kMSwgUm91bmQyLCBGaW5hbCB9DQogIA0KICBmdW5jdGlvbiBXV0FNUHJpY2luZ1N0cmF0ZWd5KHVpbnQgX3JvdW5kMUJlZ2luc0F0LCB1aW50IF9yb3VuZDJCZWdpbnNBdCwgdWludCBfZmluYWxSb3VuZEJlZ2luc0F0KSB7DQoJcm91bmQxQmVnaW5zQXQgPSBfcm91bmQxQmVnaW5zQXQ7DQoJcm91bmQyQmVnaW5zQXQgPSBfcm91bmQyQmVnaW5zQXQ7DQoJZmluYWxSb3VuZEJlZ2luc0F0ID0gX2ZpbmFsUm91bmRCZWdpbnNBdDsNCiAgfQ0KICANCiAgZnVuY3Rpb24gZ2V0Q3VycmVudFJvdW5kKCkgcHVibGljIHJldHVybnMgKEN1cnJlbnRSb3VuZCl7DQoJICBpZiAobm93IDwgcm91bmQyQmVnaW5zQXQpDQoJCSAgcmV0dXJuIEN1cnJlbnRSb3VuZC5Sb3VuZDE7DQoJICBlbHNlIGlmIChub3cgPCBmaW5hbFJvdW5kQmVnaW5zQXQpDQoJCSAgcmV0dXJuIEN1cnJlbnRSb3VuZC5Sb3VuZDI7DQoJICByZXR1cm4gQ3VycmVudFJvdW5kLkZpbmFsOw0KICB9DQogIA0KICBmdW5jdGlvbiB0b2tlbnNUb1dlaSh1aW50IHRva2VucykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsNCglyZXR1cm4gc2FmZU11bCh0b2tlbnMsIGJhc2VSYXRlKTsNCiAgfQ0KICANCiAgLyoqDQogICAqIENhbGN1bGF0ZSB0aGUgY3VycmVudCBwcmljZSBmb3IgYnV5IGluIGFtb3VudC4NCiAgICoNCiAgICovDQogIGZ1bmN0aW9uIGNhbGN1bGF0ZVByaWNlKHVpbnQgdmFsdWUsIHVpbnQgd2VpUmFpc2VkLCB1aW50IHRva2Vuc1NvbGQsIGFkZHJlc3MgbXNnU2VuZGVyLCB1aW50IGRlY2ltYWxzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgew0KCS8vTWluaW11bSBpbnZlc3RtZW50IGlzIDEwIGZpbm5leQ0KCWlmICh2YWx1ZSA8IDEwIGZpbm5leSkgDQoJCXJldHVybiAwOw0KCS8vMTUlIEJvbnVzIGZvciBSb3VuZDEgaW52ZXN0b3JzDQoJaWYgKGdldEN1cnJlbnRSb3VuZCgpID09IEN1cnJlbnRSb3VuZC5Sb3VuZDEpDQoJCXJldHVybiBzYWZlTXVsKHNhZmVEaXYoc2FmZURpdih2YWx1ZSwgYmFzZVJhdGUpLCAxMDApLCAxMTUpOw0KCS8vMTAlIEJvbnVzIGZvciBSb3VuZDIgaW52ZXN0b3JzDQoJZWxzZSBpZiAoZ2V0Q3VycmVudFJvdW5kKCkgPT0gQ3VycmVudFJvdW5kLlJvdW5kMikNCgkJcmV0dXJuIHNhZmVNdWwoc2FmZURpdihzYWZlRGl2KHZhbHVlLCBiYXNlUmF0ZSksIDEwMCksIDExMCk7DQoJLy9CYXNlIHJhdGUgZm9yIEZpbmFsIFJvdW5kIGludmVzdG9ycw0KCXJldHVybiB2YWx1ZSAvIGJhc2VSYXRlOw0KICB9DQoNCn0NCg0KDQovKioNCiAqIFN0YW5kYXJkIEVSQzIwIHRva2VuIHdpdGggU2hvcnQgSGFuZCBBdHRhY2sgYW5kIGFwcHJvdmUoKSByYWNlIGNvbmRpdGlvbiBtaXRpZ2F0aW9uLg0KICoNCiAqIEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDoNCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbA0KICovDQpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBTYWZlTWF0aCB7DQoNCiAgLyogVG9rZW4gc3VwcGx5IGdvdCBpbmNyZWFzZWQgYW5kIGEgbmV3IG93bmVyIHJlY2VpdmVkIHRoZXNlIHRva2VucyAqLw0KICBldmVudCBNaW50ZWQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOw0KDQogIC8qIEFjdHVhbCBiYWxhbmNlcyBvZiB0b2tlbiBob2xkZXJzICovDQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsNCg0KICAvKiBhcHByb3ZlKCkgYWxsb3dhbmNlcyAqLw0KICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7DQoNCiAgLyogSW50ZXJmYWNlIGRlY2xhcmF0aW9uICovDQogIGZ1bmN0aW9uIGlzVG9rZW4oKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCB3ZUFyZSkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7DQogICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsNCiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCiAgICB1aW50IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsNCg0KICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7DQogICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sIF92YWx1ZSk7DQogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBzYWZlU3ViKF9hbGxvd2FuY2UsIF92YWx1ZSk7DQogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7DQogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07DQogIH0NCg0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsNCg0KICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgDQogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QNCiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToNCiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkNCiAgICBpZiAoKF92YWx1ZSAhPSAwKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0gMCkpIHRocm93Ow0KDQogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7DQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7DQogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07DQogIH0NCg0KfQ0KDQovKioNCiAqIEEgdG9rZW4gdGhhdCBjYW4gYmUgcmV2b2tlZCBiZWZvcmUgdGhlbiBlbmQgb2YgdGhlIGNyb3dkc2FsZS4NCiAqLw0KY29udHJhY3QgV1dBTUJvdW50eVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgew0KDQogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIHJldm9rZSB0b2tlbnMgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgYm91bnR5QWdlbnRzOw0KICANCiAgZXZlbnQgQm91bnR5QWdlbnRDaGFuZ2VkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSAgKTsNCiAgDQogIC8qDQogICogRnVuY3Rpb24gdG8gcmV2b2tlIHRva2VucyBpbiBjYXNlIHRoZSB0ZXJtcyBhbmQgY29uZGl0aW9ucyBvZiB0aGUgYm91bnR5IGNhbXBhaWduIGFyZSB2aW9sYXRlZCBieSBhbiB1c2VyIGFmdGVyIHRva2VucyB3ZXJlIGFzc2lnbmVkDQogICovDQogIGZ1bmN0aW9uIHJldm9rZVRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBvbmx5Qm91bnR5QWdlbnQgew0KICAgICAgaWYgKGJhbGFuY2VzW3JlY2VpdmVyXSA+PSB0b2tlbkFtb3VudCkgew0KCSAgICB0b3RhbFN1cHBseSA9IHNhZmVTdWIodG90YWxTdXBwbHksIHRva2VuQW1vdW50KTsNCgkgICAgYmFsYW5jZXNbcmVjZWl2ZXJdID0gc2FmZVN1YihiYWxhbmNlc1tyZWNlaXZlcl0sIHRva2VuQW1vdW50KTsNCiAgICAgIH0NCiAgfQ0KICANCiAgIC8qKg0KICAgKiBPd25lciBjYW4gYWxsb3cgYSBjcm93ZHNhbGUgY29udHJhY3QgdG8gcmV2b2tlIHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIHNldEJvdW50eUFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIHB1YmxpYyB7DQogICAgYm91bnR5QWdlbnRzW2FkZHJdID0gc3RhdGU7DQogICAgQm91bnR5QWdlbnRDaGFuZ2VkKGFkZHIsIHN0YXRlKTsNCiAgfQ0KICANCiAgbW9kaWZpZXIgb25seUJvdW50eUFnZW50KCkgew0KICAgIC8vIE9ubHkgY3Jvd2RzYWxlIGNvbnRyYWN0cyBhcmUgYWxsb3dlZCB0byByZXZva2UgdG9rZW5zDQogICAgaWYoIWJvdW50eUFnZW50c1ttc2cuc2VuZGVyXSkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQogICAgXzsNCiAgfQ0KICANCn0NCg0KLyoqDQogKiBBIHRva2VuIHRoYXQgY2FuIGluY3JlYXNlIGl0cyBzdXBwbHkgYnkgYW5vdGhlciBjb250cmFjdC4NCiAqDQogKiBUaGlzIGFsbG93cyB1bmNhcHBlZCBjcm93ZHNhbGUgYnkgZHluYW1pY2FsbHkgaW5jcmVhc2luZyB0aGUgc3VwcGx5IHdoZW4gbW9uZXkgcG91cnMgaW4uDQogKiBPbmx5IG1pbnQgYWdlbnRzLCBjb250cmFjdHMgd2hpdGVsaXN0ZWQgYnkgb3duZXIsIGNhbiBtaW50IG5ldyB0b2tlbnMuDQogKg0KICovDQpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgew0KDQoNCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7DQoNCiAgLyoqIExpc3Qgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gY3JlYXRlIG5ldyB0b2tlbnMgKi8NCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsNCg0KICBldmVudCBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSAgKTsNCg0KICAvKioNCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgYW5kIGFsbG9jYXRlIHRoZW0gdG8gYW4gYWRkcmVzcy4uDQogICAqDQogICAqIE9ubHkgY2FsbGFibHkgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgKG1pbnQgYWdlbnQpLg0KICAgKi8NCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgb25seU1pbnRBZ2VudCBjYW5NaW50IHB1YmxpYyB7DQogICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBhbW91bnQpOw0KICAgIGJhbGFuY2VzW3JlY2VpdmVyXSA9IHNhZmVBZGQoYmFsYW5jZXNbcmVjZWl2ZXJdLCBhbW91bnQpOw0KDQogICAgLy8gVGhpcyB3aWxsIG1ha2UgdGhlIG1pbnQgdHJhbnNhY3Rpb24gYXBwZWFyIGluIEV0aGVyU2Nhbi5pbw0KICAgIC8vIFdlIGNhbiByZW1vdmUgdGhpcyBhZnRlciB0aGVyZSBpcyBhIHN0YW5kYXJkaXplZCBtaW50aW5nIGV2ZW50DQogICAgVHJhbnNmZXIoMCwgcmVjZWl2ZXIsIGFtb3VudCk7DQogIH0NCg0KICAvKioNCiAgICogT3duZXIgY2FuIGFsbG93IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHRvIG1pbnQgbmV3IHRva2Vucy4NCiAgICovDQogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7DQogICAgbWludEFnZW50c1thZGRyXSA9IHN0YXRlOw0KICAgIE1pbnRpbmdBZ2VudENoYW5nZWQoYWRkciwgc3RhdGUpOw0KICB9DQoNCiAgbW9kaWZpZXIgb25seU1pbnRBZ2VudCgpIHsNCiAgICAvLyBPbmx5IGNyb3dkc2FsZSBjb250cmFjdHMgYXJlIGFsbG93ZWQgdG8gbWludCBuZXcgdG9rZW5zDQogICAgaWYoIW1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KICAgIF87DQogIH0NCg0KICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovDQogIG1vZGlmaWVyIGNhbk1pbnQoKSB7DQogICAgaWYobWludGluZ0ZpbmlzaGVkKSB0aHJvdzsNCiAgICBfOw0KICB9DQp9DQoNCg0KY29udHJhY3QgV1dBTUNyb3dkc2FsZSBpcyBDcm93ZHNhbGUgew0KICANCiAgLyogVGhlIG1heGltdW0gYW1vdW50IHRoZSBjcm93ZHNhbGUgY2FuIHJhaXNlICovDQogIHVpbnQgaW52ZXN0bWVudENhcEluV2VpID0gNTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwOyAvLyA1MDAwMDAgRVRIIA0KICANCiAgLyogVGhlIG51bWJlciBvZiB0b2tlbnMgYXdhcmRlZCBmb3IgYm91bnR5IGNhbXBhaWduICovDQogIHVpbnQgcHVibGljIGJvdW50eVRva2VucyA9IDA7DQogIA0KICAvKiBQdWJsaWMgbGlzdCBvZiBib3VudHkgcmV3YXJkcyAqLw0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBib3VudHlSZXdhcmRzOw0KCQ0KICBmdW5jdGlvbiBXV0FNQ3Jvd2RzYWxlKGFkZHJlc3MgX3Rva2VuLCBQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSwgYWRkcmVzcyBfbXVsdGlzaWdXYWxsZXQsIHVpbnQgX3N0YXJ0LCB1aW50IF9lbmQpDQogICAgQ3Jvd2RzYWxlKF90b2tlbiwgX3ByaWNpbmdTdHJhdGVneSwgX211bHRpc2lnV2FsbGV0LCBfc3RhcnQsIF9lbmQsIDUwMDAwMDAwMDAwMDAwMDAwMDAwMCkgeyAvL01pbmltdW0gZnVuZGluZyBnb2FsIG9mIDUwMCBFVEgNCiAgfQ0KDQogICAvKioNCiAgICogRnVuY3Rpb24gYWxsb3dpbmcgdG8gY3JlZGl0IHRva2VucyB0byBwYXJ0aWNpcGFudCBpbiB0aGUgYm91bnR5IGNhbXBhaWduDQogICAqLw0KICBmdW5jdGlvbiBhc3NpZ25Cb3VudHlUb2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgb25seU93bmVyIHsNCgkgIHVpbnQgYm91bnR5V2VpQW1vdW50ID0gV1dBTVByaWNpbmdTdHJhdGVneShwcmljaW5nU3RyYXRlZ3kpLnRva2Vuc1RvV2VpKHRva2VuQW1vdW50KTsNCgkgIHVpbnQgdG90YWxCb3VudHlXZWlBbW91bnQgPSBXV0FNUHJpY2luZ1N0cmF0ZWd5KHByaWNpbmdTdHJhdGVneSkudG9rZW5zVG9XZWkoYm91bnR5VG9rZW5zKTsNCgkgIA0KCSAgLy9NYWtpbmcgc3VyZSB3ZSBkbyBub3QgZXhjZWVkIHRoZSAxJSBvZiBtYXhpbXVtIGludmVzdG1lbnQgYWxsb2NhdGVkIGZvciB0aGUgYm91bnR5IGNhbXBhaWduDQoJICBpZiAoc2FmZUFkZChib3VudHlXZWlBbW91bnQsIHRvdGFsQm91bnR5V2VpQW1vdW50KSA+PSAoaW52ZXN0bWVudENhcEluV2VpIC8gMTAwKSkNCgkJICB0aHJvdzsNCgkgIA0KCSAgYm91bnR5UmV3YXJkc1tyZWNlaXZlcl0gPSBzYWZlQWRkKGJvdW50eVJld2FyZHNbcmVjZWl2ZXJdLCB0b2tlbkFtb3VudCk7DQoJICBib3VudHlUb2tlbnMgPSBzYWZlQWRkKGJvdW50eVRva2VucywgdG9rZW5BbW91bnQpOw0KCSAgDQoJICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsNCiAgfQ0KICANCiAgLyoNCiAgKiBGdW5jdGlvbiB0byByZXZva2UgdG9rZW5zIGluIGNhc2UgdGhlIHRlcm1zIGFuZCBjb25kaXRpb25zIG9mIHRoZSBib3VudHkgY2FtcGFpZ24gYXJlIHZpb2xhdGVkIGJ5IGFuIHVzZXIgYWZ0ZXIgdG9rZW5zIHdlcmUgYXNzaWduZWQNCiAgKi8NCiAgZnVuY3Rpb24gcmV2b2tlQm91bnR5VG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIG9ubHlPd25lciB7DQoJICAvL0NoZWNraW5nIHRoYXQgd2UgY2FuIG9ubHkgcmV2b2tlIHRva2VucyBvZiBhIGJvdW50eSBjYW1wYWlnbiBwYXJ0aWNpcGFudC4gQWxzbyBtYWtpbmcgc3VyZSB0aGF0IHdlIGRvIG5vdCBlbmQgdXAgd2l0aCBhIG5lZ2F0aXZlIGJsYWFuY2UNCgkgIGlmIChib3VudHlSZXdhcmRzW3JlY2VpdmVyXSA8IHRva2VuQW1vdW50KQ0KCQkgIHRocm93Ow0KCSAgYm91bnR5VG9rZW5zID0gc2FmZVN1Yihib3VudHlUb2tlbnMsIHRva2VuQW1vdW50KTsNCgkgIGJvdW50eVJld2FyZHNbcmVjZWl2ZXJdID0gc2FmZVN1Yihib3VudHlSZXdhcmRzW3JlY2VpdmVyXSwgdG9rZW5BbW91bnQpOw0KCSAgDQoJICBXV0FNQm91bnR5VG9rZW4gYm91bnR5VG9rZW4gPSBXV0FNQm91bnR5VG9rZW4odG9rZW4pOw0KCSAgYm91bnR5VG9rZW4ucmV2b2tlVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7DQogIH0NCiAgDQogIC8qKg0KICAgKiBDaGVja2luZyB0aGF0IHdlIGRvIG5vdCBleGNlZWQgdGhlIGludmVzdG1lbnQgY2FwLg0KICAgKi8NCiAgZnVuY3Rpb24gaXNCcmVha2luZ0NhcCh1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludCB3ZWlSYWlzZWRUb3RhbCwgdWludCB0b2tlbnNTb2xkVG90YWwpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gd2VpUmFpc2VkVG90YWwgPiBpbnZlc3RtZW50Q2FwSW5XZWk7DQogIH0NCg0KICAvKioNCiAgICogQ29uZGl0aW9uIGlzIHRoZSBzYW1lIGFzIGFib3ZlDQogICAqLw0KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgIHJldHVybiB3ZWlSYWlzZWQgPj0gaW52ZXN0bWVudENhcEluV2VpOw0KICB9DQoNCiAgLyoqDQogICAqIENyZWF0aW5nIG5ldyB0b2tlbnMgZm9yIHRoZSBpbnZlc3RvciBhbmQgYXNzaWduaW5nIHRoZW0NCiAgICovDQogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBwcml2YXRlIHsNCiAgICBNaW50YWJsZVRva2VuIG1pbnRhYmxlVG9rZW4gPSBNaW50YWJsZVRva2VuKHRva2VuKTsNCiAgICBtaW50YWJsZVRva2VuLm1pbnQocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsNCiAgfQ0KDQp9'