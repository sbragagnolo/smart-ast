base 64 content
base64wallet24
	^'cHJhZ21hIHNvbGlkaXR5XjAuNC4wOw0KLyoNClRoaXMgdlNsaWNlIHRva2VuIGNvbnRyYWN0IGlzIGJhc2VkIG9uIHRoZSBFUkMyMCB0b2tlbiBjb250cmFjdC4gQWRkaXRpb25hbA0KZnVuY3Rpb25hbGl0eSBoYXMgYmVlbiBpbnRlZ3JhdGVkOg0KKiB0aGUgY29udHJhY3QgTG9ja2FibGUsIHdoaWNoIGlzIHVzZWQgYXMgYSBwYXJlbnQgb2YgdGhlIFRva2VuIGNvbnRyYWN0DQoqIHRoZSBmdW5jdGlvbiBtaW50VG9rZW5zKCksIHdoaWNoIG1ha2VzIHVzZSBvZiB0aGUgY3VycmVudFN3YXBSYXRlKCkgYW5kIHNhZmVUb0FkZCgpIGhlbHBlcnMNCiogdGhlIGZ1bmN0aW9uIGRpc2FibGVUb2tlblN3YXBMb2NrKCkNCiovDQoNCmNvbnRyYWN0IExvY2thYmxlIHsNCiAgICB1aW50IHB1YmxpYyBudW1PZkN1cnJlbnRFcG9jaDsNCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvblRpbWU7DQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgVU5MT0NLRURfVElNRSA9IDI1IGRheXM7DQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTE9DS0VEX1RJTUUgPSA1IGRheXM7DQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgRVBPQ0hfTEVOR1RIID0gMzAgZGF5czsNCiAgICBib29sIHB1YmxpYyBsb2NrOw0KICAgIGJvb2wgcHVibGljIHRva2VuU3dhcExvY2s7DQoNCiAgICBldmVudCBMb2NrZWQoKTsNCiAgICBldmVudCBVbmxvY2tlZCgpOw0KDQogICAgLy8gVGhpcyBtb2RpZmllciBzaG91bGQgcHJldmVudCB0b2tlbnMgdHJhbnNmZXJzIHdoaWxlIHRoZSB0b2tlbnN3YXANCiAgICAvLyBpcyBzdGlsbCBvbmdvaW5nDQogICAgbW9kaWZpZXIgaXNUb2tlblN3YXBPbiB7DQogICAgICAgIGlmICh0b2tlblN3YXBMb2NrKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICAvLyBUaGlzIG1vZGlmaWVyIGNoZWNrcyBhbmQsIGlmIG5lZWRlZCwgdXBkYXRlcyB0aGUgdmFsdWUgb2YgY3VycmVudA0KICAgIC8vIHRva2VuIGNvbnRyYWN0IGVwb2NoLCBiZWZvcmUgZXhlY3V0aW5nIGEgdG9rZW4gdHJhbnNmZXIgb2YgYW55DQogICAgLy8ga2luZA0KICAgIG1vZGlmaWVyIGlzTmV3RXBvY2ggew0KICAgICAgICBpZiAobnVtT2ZDdXJyZW50RXBvY2ggKiBFUE9DSF9MRU5HVEggKyBjcmVhdGlvblRpbWUgPCBub3cgKSB7DQogICAgICAgICAgICBudW1PZkN1cnJlbnRFcG9jaCA9IChub3cgLSBjcmVhdGlvblRpbWUpIC8gRVBPQ0hfTEVOR1RIICsgMTsNCiAgICAgICAgfQ0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIC8vIFRoaXMgbW9kaWZpZXIgY2hlY2sgd2hldGhlciB0aGUgY29udHJhY3Qgc2hvdWxkIGJlIGluIGEgbG9ja2VkDQogICAgLy8gb3IgdW5sb2NrZWQgc3RhdGUsIHRoZW4gYWN0cyBhbmQgdXBkYXRlcyBhY2NvcmRpbmdseSBpZg0KICAgIC8vIG5lY2Vzc2FyeQ0KICAgIG1vZGlmaWVyIGNoZWNrTG9jayB7DQogICAgICAgIGlmICgoY3JlYXRpb25UaW1lICsgbnVtT2ZDdXJyZW50RXBvY2ggKiBVTkxPQ0tFRF9USU1FKSArDQogICAgICAgIChudW1PZkN1cnJlbnRFcG9jaCAtIDEpICogTE9DS0VEX1RJTUUgPCBub3cpIHsNCiAgICAgICAgICAgIC8vIGF2b2lkcyBuZWVkbGVzcyBsb2NrIHN0YXRlIGNoYW5nZSBhbmQgZXZlbnQgc3BhbW1pbmcNCiAgICAgICAgICAgIGlmIChsb2NrKSB0aHJvdzsNCg0KICAgICAgICAgICAgbG9jayA9IHRydWU7DQogICAgICAgICAgICBMb2NrZWQoKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIG9ubHkgc2V0IHRvIGZhbHNlIGlmIGluIGEgbG9ja2VkIHN0YXRlLCB0byBhdm9pZA0KICAgICAgICAgICAgLy8gbmVlZGxlc3Mgc3RhdGUgY2hhbmdlIGFuZCBldmVudCBzcGFtDQogICAgICAgICAgICBpZiAobG9jaykgew0KICAgICAgICAgICAgICAgIGxvY2sgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBVbmxvY2tlZCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIF87DQogICAgfQ0KDQogICAgZnVuY3Rpb24gTG9ja2FibGUoKSB7DQogICAgICAgIGNyZWF0aW9uVGltZSA9IG5vdzsNCiAgICAgICAgbnVtT2ZDdXJyZW50RXBvY2ggPSAxOw0KICAgICAgICB0b2tlblN3YXBMb2NrID0gdHJ1ZTsNCiAgICB9DQp9DQoNCg0KY29udHJhY3QgRVJDMjAgew0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7DQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsNCg0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOw0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOw0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsNCg0KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOw0KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOw0KfQ0KDQpjb250cmFjdCBUb2tlbiBpcyBFUkMyMCwgTG9ja2FibGUgew0KDQogIG1hcHBpbmcoIGFkZHJlc3MgPT4gdWludCApIF9iYWxhbmNlczsNCiAgbWFwcGluZyggYWRkcmVzcyA9PiBtYXBwaW5nKCBhZGRyZXNzID0+IHVpbnQgKSApIF9hcHByb3ZhbHM7DQogIHVpbnQgX3N1cHBseTsNCiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0QWRkcmVzczsNCg0KICBldmVudCBUb2tlbk1pbnQoYWRkcmVzcyBuZXdUb2tlbkhvbGRlciwgdWludCBhbW91bnRPZlRva2Vucyk7DQogIGV2ZW50IFRva2VuU3dhcE92ZXIoKTsNCg0KICBtb2RpZmllciBvbmx5RnJvbVdhbGxldCB7DQogICAgICBpZiAobXNnLnNlbmRlciAhPSB3YWxsZXRBZGRyZXNzKSB0aHJvdzsNCiAgICAgIF87DQogIH0NCg0KICBmdW5jdGlvbiBUb2tlbiggdWludCBpbml0aWFsX2JhbGFuY2UsIGFkZHJlc3Mgd2FsbGV0KSB7DQogICAgX2JhbGFuY2VzW21zZy5zZW5kZXJdID0gaW5pdGlhbF9iYWxhbmNlOw0KICAgIF9zdXBwbHkgPSBpbml0aWFsX2JhbGFuY2U7DQogICAgd2FsbGV0QWRkcmVzcyA9IHdhbGxldDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCBzdXBwbHkpIHsNCiAgICByZXR1cm4gX3N1cHBseTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGJhbGFuY2VPZiggYWRkcmVzcyB3aG8gKSBjb25zdGFudCByZXR1cm5zICh1aW50IHZhbHVlKSB7DQogICAgcmV0dXJuIF9iYWxhbmNlc1t3aG9dOw0KICB9DQoNCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCBfYWxsb3dhbmNlKSB7DQogICAgcmV0dXJuIF9hcHByb3ZhbHNbb3duZXJdW3NwZW5kZXJdOw0KICB9DQoNCiAgLy8gQSBoZWxwZXIgdG8gbm90aWZ5IGlmIG92ZXJmbG93IG9jY3Vycw0KICBmdW5jdGlvbiBzYWZlVG9BZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsNCiAgICByZXR1cm4gKGEgKyBiID49IGEgJiYgYSArIGIgPj0gYik7DQogIH0NCg0KICBmdW5jdGlvbiB0cmFuc2ZlciggYWRkcmVzcyB0bywgdWludCB2YWx1ZSkNCiAgICBpc1Rva2VuU3dhcE9uDQogICAgaXNOZXdFcG9jaA0KICAgIGNoZWNrTG9jaw0KICAgIHJldHVybnMgKGJvb2wgb2spIHsNCg0KICAgIGlmKCBfYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCB2YWx1ZSApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KICAgIGlmKCAhc2FmZVRvQWRkKF9iYWxhbmNlc1t0b10sIHZhbHVlKSApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KDQogICAgX2JhbGFuY2VzW21zZy5zZW5kZXJdIC09IHZhbHVlOw0KICAgIF9iYWxhbmNlc1t0b10gKz0gdmFsdWU7DQogICAgVHJhbnNmZXIoIG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSApOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpDQogICAgaXNUb2tlblN3YXBPbg0KICAgIGlzTmV3RXBvY2gNCiAgICBjaGVja0xvY2sNCiAgICByZXR1cm5zIChib29sIG9rKSB7DQogICAgLy8gaWYgeW91IGRvbid0IGhhdmUgZW5vdWdoIGJhbGFuY2UsIHRocm93DQogICAgaWYoIF9iYWxhbmNlc1tmcm9tXSA8IHZhbHVlICkgew0KICAgICAgICB0aHJvdzsNCiAgICB9DQogICAgLy8gaWYgeW91IGRvbid0IGhhdmUgYXBwcm92YWwsIHRocm93DQogICAgaWYoIF9hcHByb3ZhbHNbZnJvbV1bbXNnLnNlbmRlcl0gPCB2YWx1ZSApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KICAgIGlmKCAhc2FmZVRvQWRkKF9iYWxhbmNlc1t0b10sIHZhbHVlKSApIHsNCiAgICAgICAgdGhyb3c7DQogICAgfQ0KICAgIC8vIHRyYW5zZmVyIGFuZCByZXR1cm4gdHJ1ZQ0KICAgIF9hcHByb3ZhbHNbZnJvbV1bbXNnLnNlbmRlcl0gLT0gdmFsdWU7DQogICAgX2JhbGFuY2VzW2Zyb21dIC09IHZhbHVlOw0KICAgIF9iYWxhbmNlc1t0b10gKz0gdmFsdWU7DQogICAgVHJhbnNmZXIoIGZyb20sIHRvLCB2YWx1ZSApOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpDQogICAgaXNUb2tlblN3YXBPbg0KICAgIGlzTmV3RXBvY2gNCiAgICBjaGVja0xvY2sNCiAgICByZXR1cm5zIChib29sIG9rKSB7DQogICAgX2FwcHJvdmFsc1ttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IHZhbHVlOw0KICAgIEFwcHJvdmFsKCBtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSApOw0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgLy8gVGhlIGZ1bmN0aW9uIGN1cnJlbnRTd2FwUmF0ZSgpIHJldHVybnMgdGhlIGN1cnJlbnQgZXhjaGFuZ2UgcmF0ZQ0KICAvLyBiZXR3ZWVuIHZTbGljZSB0b2tlbnMgYW5kIEV0aGVyIGR1cmluZyB0aGUgdG9rZW4gc3dhcCBwZXJpb2QNCiAgZnVuY3Rpb24gY3VycmVudFN3YXBSYXRlKCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7DQogICAgICBpZiAoY3JlYXRpb25UaW1lICsgMSB3ZWVrcyA+IG5vdykgew0KICAgICAgICAgIHJldHVybiAxMzA7DQogICAgICB9DQogICAgICBlbHNlIGlmIChjcmVhdGlvblRpbWUgKyAyIHdlZWtzID4gbm93KSB7DQogICAgICAgICAgcmV0dXJuIDEyMDsNCiAgICAgIH0NCiAgICAgIGVsc2UgaWYgKGNyZWF0aW9uVGltZSArIDQgd2Vla3MgPiBub3cpIHsNCiAgICAgICAgICByZXR1cm4gMTAwOw0KICAgICAgfQ0KICAgICAgZWxzZSB7DQogICAgICAgICAgcmV0dXJuIDA7DQogICAgICB9DQogIH0NCg0KICAvLyBUaGUgZnVuY3Rpb24gbWludFRva2VucyBpcyBvbmx5IHVzYWJsZSBieSB0aGUgY2hvc2VuIHdhbGxldA0KICAvLyBjb250cmFjdCB0byBtaW50IGEgbnVtYmVyIG9mIHRva2VucyBwcm9wb3J0aW9uYWwgdG8gdGhlDQogIC8vIGFtb3VudCBvZiBldGhlciBzZW50IHRvIHRoZSB3YWxsZXQgY29udHJhY3QuIFRoZSBmdW5jdGlvbg0KICAvLyBjYW4gb25seSBiZSBjYWxsZWQgZHVyaW5nIHRoZSB0b2tlbnN3YXAgcGVyaW9kDQogIGZ1bmN0aW9uIG1pbnRUb2tlbnMoYWRkcmVzcyBuZXdUb2tlbkhvbGRlciwgdWludCBldGhlckFtb3VudCkNCiAgICBleHRlcm5hbA0KICAgIG9ubHlGcm9tV2FsbGV0IHsNCg0KICAgICAgICB1aW50IHRva2Vuc0Ftb3VudCA9IGN1cnJlbnRTd2FwUmF0ZSgpICogZXRoZXJBbW91bnQ7DQogICAgICAgIGlmKCFzYWZlVG9BZGQoX2JhbGFuY2VzW25ld1Rva2VuSG9sZGVyXSx0b2tlbnNBbW91bnQgKSkgdGhyb3c7DQogICAgICAgIGlmKCFzYWZlVG9BZGQoX3N1cHBseSx0b2tlbnNBbW91bnQpKSB0aHJvdzsNCg0KICAgICAgICBfYmFsYW5jZXNbbmV3VG9rZW5Ib2xkZXJdICs9IHRva2Vuc0Ftb3VudDsNCiAgICAgICAgX3N1cHBseSArPSB0b2tlbnNBbW91bnQ7DQoNCiAgICAgICAgVG9rZW5NaW50KG5ld1Rva2VuSG9sZGVyLCB0b2tlbnNBbW91bnQpOw0KICB9DQoNCiAgLy8gVGhlIGZ1bmN0aW9uIGRpc2FibGVUb2tlblN3YXBMb2NrKCkgaXMgY2FsbGVkIGJ5IHRoZSB3YWxsZXQNCiAgLy8gY29udHJhY3Qgb25jZSB0aGUgdG9rZW4gc3dhcCBoYXMgcmVhY2hlZCBpdHMgZW5kIGNvbmRpdGlvbnMNCiAgZnVuY3Rpb24gZGlzYWJsZVRva2VuU3dhcExvY2soKQ0KICAgIGV4dGVybmFsDQogICAgb25seUZyb21XYWxsZXQgew0KICAgICAgICB0b2tlblN3YXBMb2NrID0gZmFsc2U7DQogICAgICAgIFRva2VuU3dhcE92ZXIoKTsNCiAgfQ0KfQ0KDQpwcmFnbWEgc29saWRpdHkgXjAuNC4wOw0KDQovKg0KVGhlIHN0YW5kYXJkIFdhbGxldCBjb250cmFjdCwgcmV0cmlldmFibGUgYXQNCmh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9kYXBwLWJpbi9ibG9iL21hc3Rlci93YWxsZXQvd2FsbGV0LnNvbCBoYXMgYmVlbg0KbW9kaWZpZWQgdG8gaW5jbHVkZSBhZGRpdGlvbmFsIGZ1bmN0aW9uYWxpdHksIGluIHBhcnRpY3VsYXI6DQoqIEFuIGFkZGl0aW9uYWwgcGFyZW50IG9mIHdhbGxldCBjb250cmFjdCBjYWxsZWQgdG9rZW5zd2FwLCBpbXBsZW1lbnRpbmcgYWxtb3N0DQphbGwgdGhlIGNoYW5nZXM6DQogICAgLSBGdW5jdGlvbnMgZm9yIHN0YXJ0aW5nIGFuZCBzdG9wcGluZyB0aGUgdG9rZW5zd2FwDQogICAgLSBBIHNldC1vbmx5LW9uY2UgZnVuY3Rpb24gZm9yIHRoZSB0b2tlbiBjb250cmFjdA0KICAgIC0gYnV5VG9rZW5zKCksIHdoaWNoIGNhbGxzIG1pbnRUb2tlbnMoKSBpbiB0aGUgdG9rZW4gY29udHJhY3QNCiAgICAtIE1vZGlmaWVycyBmb3IgZW5mb3JjaW5nIHRva2Vuc3dhcCB0aW1lIGxpbWl0cyBhbmQgbWF4IGV0aGVyIGNhcA0KKiB0aGUgd2FsbGV0IGZhbGxiYWNrIGZ1bmN0aW9uIGNhbGxzIHRoZSBidXlUb2tlbnMgZnVuY3Rpb24NCiogdGhlIHdhbGxldCBjb250cmFjdCBjYW5ub3Qgc2VsZmRlc3RydWN0IGR1cmluZyB0aGUgdG9rZW5zd2FwDQoqLw0KDQpjb250cmFjdCBtdWx0aW93bmVkIHsNCg0KCS8vIFRZUEVTDQoNCiAgICAvLyBzdHJ1Y3QgZm9yIHRoZSBzdGF0dXMgb2YgYSBwZW5kaW5nIG9wZXJhdGlvbi4NCiAgICBzdHJ1Y3QgUGVuZGluZ1N0YXRlIHsNCiAgICAgICAgdWludCB5ZXROZWVkZWQ7DQogICAgICAgIHVpbnQgb3duZXJzRG9uZTsNCiAgICAgICAgdWludCBpbmRleDsNCiAgICB9DQoNCgkvLyBFVkVOVFMNCg0KICAgIC8vIHRoaXMgY29udHJhY3Qgb25seSBoYXMgc2l4IHR5cGVzIG9mIGV2ZW50czogaXQgY2FuIGFjY2VwdCBhIGNvbmZpcm1hdGlvbiwgaW4gd2hpY2ggY2FzZQ0KICAgIC8vIHdlIHJlY29yZCBvd25lciBhbmQgb3BlcmF0aW9uIChoYXNoKSBhbG9uZ3NpZGUgaXQuDQogICAgZXZlbnQgQ29uZmlybWF0aW9uKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsNCiAgICBldmVudCBSZXZva2UoYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOw0KICAgIC8vIHNvbWUgb3RoZXJzIGFyZSBpbiB0aGUgY2FzZSBvZiBhbiBvd25lciBjaGFuZ2luZy4NCiAgICBldmVudCBPd25lckNoYW5nZWQoYWRkcmVzcyBvbGRPd25lciwgYWRkcmVzcyBuZXdPd25lcik7DQogICAgZXZlbnQgT3duZXJBZGRlZChhZGRyZXNzIG5ld093bmVyKTsNCiAgICBldmVudCBPd25lclJlbW92ZWQoYWRkcmVzcyBvbGRPd25lcik7DQogICAgLy8gdGhlIGxhc3Qgb25lIGlzIGVtaXR0ZWQgaWYgdGhlIHJlcXVpcmVkIHNpZ25hdHVyZXMgY2hhbmdlDQogICAgZXZlbnQgUmVxdWlyZW1lbnRDaGFuZ2VkKHVpbnQgbmV3UmVxdWlyZW1lbnQpOw0KDQoJLy8gTU9ESUZJRVJTDQoNCiAgICAvLyBzaW1wbGUgc2luZ2xlLXNpZyBmdW5jdGlvbiBtb2RpZmllci4NCiAgICBtb2RpZmllciBvbmx5b3duZXIgew0KICAgICAgICBpZiAoaXNPd25lcihtc2cuc2VuZGVyKSkNCiAgICAgICAgICAgIF87DQogICAgfQ0KICAgIC8vIG11bHRpLXNpZyBmdW5jdGlvbiBtb2RpZmllcjogdGhlIG9wZXJhdGlvbiBtdXN0IGhhdmUgYW4gaW50cmluc2ljIGhhc2ggaW4gb3JkZXINCiAgICAvLyB0aGF0IGxhdGVyIGF0dGVtcHRzIGNhbiBiZSByZWFsaXNlZCBhcyB0aGUgc2FtZSB1bmRlcmx5aW5nIG9wZXJhdGlvbiBhbmQNCiAgICAvLyB0aHVzIGNvdW50IGFzIGNvbmZpcm1hdGlvbnMuDQogICAgbW9kaWZpZXIgb25seW1hbnlvd25lcnMoYnl0ZXMzMiBfb3BlcmF0aW9uKSB7DQogICAgICAgIGlmIChjb25maXJtQW5kQ2hlY2soX29wZXJhdGlvbikpDQogICAgICAgICAgICBfOw0KICAgIH0NCg0KCS8vIE1FVEhPRFMNCg0KICAgIC8vIGNvbnN0cnVjdG9yIGlzIGdpdmVuIG51bWJlciBvZiBzaWdzIHJlcXVpcmVkIHRvIGRvIHByb3RlY3RlZCAib25seW1hbnlvd25lcnMiIHRyYW5zYWN0aW9ucw0KICAgIC8vIGFzIHdlbGwgYXMgdGhlIHNlbGVjdGlvbiBvZiBhZGRyZXNzZXMgY2FwYWJsZSBvZiBjb25maXJtaW5nIHRoZW0uDQogICAgZnVuY3Rpb24gbXVsdGlvd25lZChhZGRyZXNzW10gX293bmVycywgdWludCBfcmVxdWlyZWQpIHsNCiAgICAgICAgbV9udW1Pd25lcnMgPSBfb3duZXJzLmxlbmd0aCArIDE7DQogICAgICAgIG1fb3duZXJzWzFdID0gdWludChtc2cuc2VuZGVyKTsNCiAgICAgICAgbV9vd25lckluZGV4W3VpbnQobXNnLnNlbmRlcildID0gMTsNCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX293bmVycy5sZW5ndGg7ICsraSkNCiAgICAgICAgew0KICAgICAgICAgICAgbV9vd25lcnNbMiArIGldID0gdWludChfb3duZXJzW2ldKTsNCiAgICAgICAgICAgIG1fb3duZXJJbmRleFt1aW50KF9vd25lcnNbaV0pXSA9IDIgKyBpOw0KICAgICAgICB9DQogICAgICAgIG1fcmVxdWlyZWQgPSBfcmVxdWlyZWQ7DQogICAgfQ0KDQogICAgLy8gUmV2b2tlcyBhIHByaW9yIGNvbmZpcm1hdGlvbiBvZiB0aGUgZ2l2ZW4gb3BlcmF0aW9uDQogICAgZnVuY3Rpb24gcmV2b2tlKGJ5dGVzMzIgX29wZXJhdGlvbikgZXh0ZXJuYWwgew0KICAgICAgICB1aW50IG93bmVySW5kZXggPSBtX293bmVySW5kZXhbdWludChtc2cuc2VuZGVyKV07DQogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGV5J3JlIGFuIG93bmVyDQogICAgICAgIGlmIChvd25lckluZGV4ID09IDApIHJldHVybjsNCiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gMioqb3duZXJJbmRleDsNCiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX3BlbmRpbmdbX29wZXJhdGlvbl07DQogICAgICAgIGlmIChwZW5kaW5nLm93bmVyc0RvbmUgJiBvd25lckluZGV4Qml0ID4gMCkgew0KICAgICAgICAgICAgcGVuZGluZy55ZXROZWVkZWQrKzsNCiAgICAgICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSAtPSBvd25lckluZGV4Qml0Ow0KICAgICAgICAgICAgUmV2b2tlKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gUmVwbGFjZXMgYW4gb3duZXIgYF9mcm9tYCB3aXRoIGFub3RoZXIgYF90b2AuDQogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSBleHRlcm5hbCB7DQogICAgICAgIGlmIChpc093bmVyKF90bykpIHJldHVybjsNCiAgICAgICAgdWludCBvd25lckluZGV4ID0gbV9vd25lckluZGV4W3VpbnQoX2Zyb20pXTsNCiAgICAgICAgaWYgKG93bmVySW5kZXggPT0gMCkgcmV0dXJuOw0KDQogICAgICAgIGNsZWFyUGVuZGluZygpOw0KICAgICAgICBtX293bmVyc1tvd25lckluZGV4XSA9IHVpbnQoX3RvKTsNCiAgICAgICAgbV9vd25lckluZGV4W3VpbnQoX2Zyb20pXSA9IDA7DQogICAgICAgIG1fb3duZXJJbmRleFt1aW50KF90byldID0gb3duZXJJbmRleDsNCiAgICAgICAgT3duZXJDaGFuZ2VkKF9mcm9tLCBfdG8pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFkZE93bmVyKGFkZHJlc3MgX293bmVyKSBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgZXh0ZXJuYWwgew0KICAgICAgICBpZiAoaXNPd25lcihfb3duZXIpKSByZXR1cm47DQoNCiAgICAgICAgY2xlYXJQZW5kaW5nKCk7DQogICAgICAgIGlmIChtX251bU93bmVycyA+PSBjX21heE93bmVycykNCiAgICAgICAgICAgIHJlb3JnYW5pemVPd25lcnMoKTsNCiAgICAgICAgaWYgKG1fbnVtT3duZXJzID49IGNfbWF4T3duZXJzKQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICBtX251bU93bmVycysrOw0KICAgICAgICBtX293bmVyc1ttX251bU93bmVyc10gPSB1aW50KF9vd25lcik7DQogICAgICAgIG1fb3duZXJJbmRleFt1aW50KF9vd25lcildID0gbV9udW1Pd25lcnM7DQogICAgICAgIE93bmVyQWRkZWQoX293bmVyKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiByZW1vdmVPd25lcihhZGRyZXNzIF9vd25lcikgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsNCiAgICAgICAgdWludCBvd25lckluZGV4ID0gbV9vd25lckluZGV4W3VpbnQoX293bmVyKV07DQogICAgICAgIGlmIChvd25lckluZGV4ID09IDApIHJldHVybjsNCiAgICAgICAgaWYgKG1fcmVxdWlyZWQgPiBtX251bU93bmVycyAtIDEpIHJldHVybjsNCg0KICAgICAgICBtX293bmVyc1tvd25lckluZGV4XSA9IDA7DQogICAgICAgIG1fb3duZXJJbmRleFt1aW50KF9vd25lcildID0gMDsNCiAgICAgICAgY2xlYXJQZW5kaW5nKCk7DQogICAgICAgIHJlb3JnYW5pemVPd25lcnMoKTsgLy9tYWtlIHN1cmUgbV9udW1Pd25lciBpcyBlcXVhbCB0byB0aGUgbnVtYmVyIG9mIG93bmVycyBhbmQgYWx3YXlzIHBvaW50cyB0byB0aGUgb3B0aW1hbCBmcmVlIHNsb3QNCiAgICAgICAgT3duZXJSZW1vdmVkKF9vd25lcik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2hhbmdlUmVxdWlyZW1lbnQodWludCBfbmV3UmVxdWlyZWQpIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSBleHRlcm5hbCB7DQogICAgICAgIGlmIChfbmV3UmVxdWlyZWQgPiBtX251bU93bmVycykgcmV0dXJuOw0KICAgICAgICBtX3JlcXVpcmVkID0gX25ld1JlcXVpcmVkOw0KICAgICAgICBjbGVhclBlbmRpbmcoKTsNCiAgICAgICAgUmVxdWlyZW1lbnRDaGFuZ2VkKF9uZXdSZXF1aXJlZCk7DQogICAgfQ0KDQogICAgLy8gR2V0cyBhbiBvd25lciBieSAwLWluZGV4ZWQgcG9zaXRpb24gKHVzaW5nIG51bU93bmVycyBhcyB0aGUgY291bnQpDQogICAgZnVuY3Rpb24gZ2V0T3duZXIodWludCBvd25lckluZGV4KSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7DQogICAgICAgIHJldHVybiBhZGRyZXNzKG1fb3duZXJzW293bmVySW5kZXggKyAxXSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIF9hZGRyKSByZXR1cm5zIChib29sKSB7DQogICAgICAgIHJldHVybiBtX293bmVySW5kZXhbdWludChfYWRkcildID4gMDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBoYXNDb25maXJtZWQoYnl0ZXMzMiBfb3BlcmF0aW9uLCBhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgew0KICAgICAgICB2YXIgcGVuZGluZyA9IG1fcGVuZGluZ1tfb3BlcmF0aW9uXTsNCiAgICAgICAgdWludCBvd25lckluZGV4ID0gbV9vd25lckluZGV4W3VpbnQoX293bmVyKV07DQoNCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZXkncmUgYW4gb3duZXINCiAgICAgICAgaWYgKG93bmVySW5kZXggPT0gMCkgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgIC8vIGRldGVybWluZSB0aGUgYml0IHRvIHNldCBmb3IgdGhpcyBvd25lci4NCiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gMioqb3duZXJJbmRleDsNCiAgICAgICAgcmV0dXJuICEocGVuZGluZy5vd25lcnNEb25lICYgb3duZXJJbmRleEJpdCA9PSAwKTsNCiAgICB9DQoNCiAgICAvLyBJTlRFUk5BTCBNRVRIT0RTDQoNCiAgICBmdW5jdGlvbiBjb25maXJtQW5kQ2hlY2soYnl0ZXMzMiBfb3BlcmF0aW9uKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICAgIC8vIGRldGVybWluZSB3aGF0IGluZGV4IHRoZSBwcmVzZW50IHNlbmRlciBpczoNCiAgICAgICAgdWludCBvd25lckluZGV4ID0gbV9vd25lckluZGV4W3VpbnQobXNnLnNlbmRlcildOw0KICAgICAgICAvLyBtYWtlIHN1cmUgdGhleSdyZSBhbiBvd25lcg0KICAgICAgICBpZiAob3duZXJJbmRleCA9PSAwKSByZXR1cm47DQoNCiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX3BlbmRpbmdbX29wZXJhdGlvbl07DQogICAgICAgIC8vIGlmIHdlJ3JlIG5vdCB5ZXQgd29ya2luZyBvbiB0aGlzIG9wZXJhdGlvbiwgc3dpdGNoIG92ZXIgYW5kIHJlc2V0IHRoZSBjb25maXJtYXRpb24gc3RhdHVzLg0KICAgICAgICBpZiAocGVuZGluZy55ZXROZWVkZWQgPT0gMCkgew0KICAgICAgICAgICAgLy8gcmVzZXQgY291bnQgb2YgY29uZmlybWF0aW9ucyBuZWVkZWQuDQogICAgICAgICAgICBwZW5kaW5nLnlldE5lZWRlZCA9IG1fcmVxdWlyZWQ7DQogICAgICAgICAgICAvLyByZXNldCB3aGljaCBvd25lcnMgaGF2ZSBjb25maXJtZWQgKG5vbmUpIC0gc2V0IG91ciBiaXRtYXAgdG8gMC4NCiAgICAgICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSA9IDA7DQogICAgICAgICAgICBwZW5kaW5nLmluZGV4ID0gbV9wZW5kaW5nSW5kZXgubGVuZ3RoKys7DQogICAgICAgICAgICBtX3BlbmRpbmdJbmRleFtwZW5kaW5nLmluZGV4XSA9IF9vcGVyYXRpb247DQogICAgICAgIH0NCiAgICAgICAgLy8gZGV0ZXJtaW5lIHRoZSBiaXQgdG8gc2V0IGZvciB0aGlzIG93bmVyLg0KICAgICAgICB1aW50IG93bmVySW5kZXhCaXQgPSAyKipvd25lckluZGV4Ow0KICAgICAgICAvLyBtYWtlIHN1cmUgd2UgKHRoZSBtZXNzYWdlIHNlbmRlcikgaGF2ZW4ndCBjb25maXJtZWQgdGhpcyBvcGVyYXRpb24gcHJldmlvdXNseS4NCiAgICAgICAgaWYgKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPT0gMCkgew0KICAgICAgICAgICAgQ29uZmlybWF0aW9uKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOw0KICAgICAgICAgICAgLy8gb2sgLSBjaGVjayBpZiBjb3VudCBpcyBlbm91Z2ggdG8gZ28gYWhlYWQuDQogICAgICAgICAgICBpZiAocGVuZGluZy55ZXROZWVkZWQgPD0gMSkgew0KICAgICAgICAgICAgICAgIC8vIGVub3VnaCBjb25maXJtYXRpb25zOiByZXNldCBhbmQgcnVuIGludGVyaW9yLg0KICAgICAgICAgICAgICAgIGRlbGV0ZSBtX3BlbmRpbmdJbmRleFttX3BlbmRpbmdbX29wZXJhdGlvbl0uaW5kZXhdOw0KICAgICAgICAgICAgICAgIGRlbGV0ZSBtX3BlbmRpbmdbX29wZXJhdGlvbl07DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gbm90IGVub3VnaDogcmVjb3JkIHRoYXQgdGhpcyBvd25lciBpbiBwYXJ0aWN1bGFyIGNvbmZpcm1lZC4NCiAgICAgICAgICAgICAgICBwZW5kaW5nLnlldE5lZWRlZC0tOw0KICAgICAgICAgICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSB8PSBvd25lckluZGV4Qml0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcmVvcmdhbml6ZU93bmVycygpIHByaXZhdGUgew0KICAgICAgICB1aW50IGZyZWUgPSAxOw0KICAgICAgICB3aGlsZSAoZnJlZSA8IG1fbnVtT3duZXJzKQ0KICAgICAgICB7DQogICAgICAgICAgICB3aGlsZSAoZnJlZSA8IG1fbnVtT3duZXJzICYmIG1fb3duZXJzW2ZyZWVdICE9IDApIGZyZWUrKzsNCiAgICAgICAgICAgIHdoaWxlIChtX251bU93bmVycyA+IDEgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdID09IDApIG1fbnVtT3duZXJzLS07DQogICAgICAgICAgICBpZiAoZnJlZSA8IG1fbnVtT3duZXJzICYmIG1fb3duZXJzW21fbnVtT3duZXJzXSAhPSAwICYmIG1fb3duZXJzW2ZyZWVdID09IDApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgbV9vd25lcnNbZnJlZV0gPSBtX293bmVyc1ttX251bU93bmVyc107DQogICAgICAgICAgICAgICAgbV9vd25lckluZGV4W21fb3duZXJzW2ZyZWVdXSA9IGZyZWU7DQogICAgICAgICAgICAgICAgbV9vd25lcnNbbV9udW1Pd25lcnNdID0gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNsZWFyUGVuZGluZygpIGludGVybmFsIHsNCiAgICAgICAgdWludCBsZW5ndGggPSBtX3BlbmRpbmdJbmRleC5sZW5ndGg7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKQ0KICAgICAgICAgICAgaWYgKG1fcGVuZGluZ0luZGV4W2ldICE9IDApDQogICAgICAgICAgICAgICAgZGVsZXRlIG1fcGVuZGluZ1ttX3BlbmRpbmdJbmRleFtpXV07DQogICAgICAgIGRlbGV0ZSBtX3BlbmRpbmdJbmRleDsNCiAgICB9DQoNCiAgIAkvLyBGSUVMRFMNCg0KICAgIC8vIHRoZSBudW1iZXIgb2Ygb3duZXJzIHRoYXQgbXVzdCBjb25maXJtIHRoZSBzYW1lIG9wZXJhdGlvbiBiZWZvcmUgaXQgaXMgcnVuLg0KICAgIHVpbnQgcHVibGljIG1fcmVxdWlyZWQ7DQogICAgLy8gcG9pbnRlciB1c2VkIHRvIGZpbmQgYSBmcmVlIHNsb3QgaW4gbV9vd25lcnMNCiAgICB1aW50IHB1YmxpYyBtX251bU93bmVyczsNCg0KICAgIC8vIGxpc3Qgb2Ygb3duZXJzDQogICAgdWludFsyNTZdIG1fb3duZXJzOw0KICAgIHVpbnQgY29uc3RhbnQgY19tYXhPd25lcnMgPSAyNTA7DQogICAgLy8gaW5kZXggb24gdGhlIGxpc3Qgb2Ygb3duZXJzIHRvIGFsbG93IHJldmVyc2UgbG9va3VwDQogICAgbWFwcGluZyh1aW50ID0+IHVpbnQpIG1fb3duZXJJbmRleDsNCiAgICAvLyB0aGUgb25nb2luZyBvcGVyYXRpb25zLg0KICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBQZW5kaW5nU3RhdGUpIG1fcGVuZGluZzsNCiAgICBieXRlczMyW10gbV9wZW5kaW5nSW5kZXg7DQp9DQoNCi8vIGluaGVyaXRhYmxlICJwcm9wZXJ0eSIgY29udHJhY3QgdGhhdCBlbmFibGVzIG1ldGhvZHMgdG8gYmUgcHJvdGVjdGVkIGJ5IHBsYWNpbmcgYSBsaW5lYXIgbGltaXQgKHNwZWNpZmlhYmxlKQ0KLy8gb24gYSBwYXJ0aWN1bGFyIHJlc291cmNlIHBlciBjYWxlbmRhciBkYXkuIGlzIG11bHRpb3duZWQgdG8gYWxsb3cgdGhlIGxpbWl0IHRvIGJlIGFsdGVyZWQuIHJlc291cmNlIHRoYXQgbWV0aG9kDQovLyB1c2VzIGlzIHNwZWNpZmllZCBpbiB0aGUgbW9kaWZpZXIuDQpjb250cmFjdCBkYXlsaW1pdCBpcyBtdWx0aW93bmVkIHsNCg0KCS8vIE1PRElGSUVSUw0KDQogICAgLy8gc2ltcGxlIG1vZGlmaWVyIGZvciBkYWlseSBsaW1pdC4NCiAgICBtb2RpZmllciBsaW1pdGVkRGFpbHkodWludCBfdmFsdWUpIHsNCiAgICAgICAgaWYgKHVuZGVyTGltaXQoX3ZhbHVlKSkNCiAgICAgICAgICAgIF87DQogICAgfQ0KDQoJLy8gTUVUSE9EUw0KDQogICAgLy8gY29uc3RydWN0b3IgLSBzdG9yZXMgaW5pdGlhbCBkYWlseSBsaW1pdCBhbmQgcmVjb3JkcyB0aGUgcHJlc2VudCBkYXkncyBpbmRleC4NCiAgICBmdW5jdGlvbiBkYXlsaW1pdCh1aW50IF9saW1pdCkgew0KICAgICAgICBtX2RhaWx5TGltaXQgPSBfbGltaXQ7DQogICAgICAgIG1fbGFzdERheSA9IHRvZGF5KCk7DQogICAgfQ0KICAgIC8vIChyZSlzZXRzIHRoZSBkYWlseSBsaW1pdC4gbmVlZHMgbWFueSBvZiB0aGUgb3duZXJzIHRvIGNvbmZpcm0uIGRvZXNuJ3QgYWx0ZXIgdGhlIGFtb3VudCBhbHJlYWR5IHNwZW50IHRvZGF5Lg0KICAgIGZ1bmN0aW9uIHNldERhaWx5TGltaXQodWludCBfbmV3TGltaXQpIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSBleHRlcm5hbCB7DQogICAgICAgIG1fZGFpbHlMaW1pdCA9IF9uZXdMaW1pdDsNCiAgICB9DQogICAgLy8gcmVzZXRzIHRoZSBhbW91bnQgYWxyZWFkeSBzcGVudCB0b2RheS4gbmVlZHMgbWFueSBvZiB0aGUgb3duZXJzIHRvIGNvbmZpcm0uDQogICAgZnVuY3Rpb24gcmVzZXRTcGVudFRvZGF5KCkgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsNCiAgICAgICAgbV9zcGVudFRvZGF5ID0gMDsNCiAgICB9DQoNCiAgICAvLyBJTlRFUk5BTCBNRVRIT0RTDQoNCiAgICAvLyBjaGVja3MgdG8gc2VlIGlmIHRoZXJlIGlzIGF0IGxlYXN0IGBfdmFsdWVgIGxlZnQgZnJvbSB0aGUgZGFpbHkgbGltaXQgdG9kYXkuIGlmIHRoZXJlIGlzLCBzdWJ0cmFjdHMgaXQgYW5kDQogICAgLy8gcmV0dXJucyB0cnVlLiBvdGhlcndpc2UganVzdCByZXR1cm5zIGZhbHNlLg0KICAgIGZ1bmN0aW9uIHVuZGVyTGltaXQodWludCBfdmFsdWUpIGludGVybmFsIG9ubHlvd25lciByZXR1cm5zIChib29sKSB7DQogICAgICAgIC8vIHJlc2V0IHRoZSBzcGVuZCBsaW1pdCBpZiB3ZSdyZSBvbiBhIGRpZmZlcmVudCBkYXkgdG8gbGFzdCB0aW1lLg0KICAgICAgICBpZiAodG9kYXkoKSA+IG1fbGFzdERheSkgew0KICAgICAgICAgICAgbV9zcGVudFRvZGF5ID0gMDsNCiAgICAgICAgICAgIG1fbGFzdERheSA9IHRvZGF5KCk7DQogICAgICAgIH0NCiAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZXJlJ3MgZW5vdWdoIGxlZnQgLSBpZiBzbywgc3VidHJhY3QgYW5kIHJldHVybiB0cnVlLg0KICAgICAgICAvLyBvdmVyZmxvdyBwcm90ZWN0aW9uICAgICAgICAgICAgICAgICAgICAvLyBkYWlseUxpbWl0IGNoZWNrDQogICAgICAgIGlmIChtX3NwZW50VG9kYXkgKyBfdmFsdWUgPj0gbV9zcGVudFRvZGF5ICYmIG1fc3BlbnRUb2RheSArIF92YWx1ZSA8PSBtX2RhaWx5TGltaXQpIHsNCiAgICAgICAgICAgIG1fc3BlbnRUb2RheSArPSBfdmFsdWU7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIC8vIGRldGVybWluZXMgdG9kYXkncyBpbmRleC4NCiAgICBmdW5jdGlvbiB0b2RheSgpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCkgeyByZXR1cm4gbm93IC8gMSBkYXlzOyB9DQoNCgkvLyBGSUVMRFMNCg0KICAgIHVpbnQgcHVibGljIG1fZGFpbHlMaW1pdDsNCiAgICB1aW50IHB1YmxpYyBtX3NwZW50VG9kYXk7DQogICAgdWludCBwdWJsaWMgbV9sYXN0RGF5Ow0KfQ0KDQovLyBpbnRlcmZhY2UgY29udHJhY3QgZm9yIG11bHRpc2lnIHByb3h5IGNvbnRyYWN0czsgc2VlIGJlbG93IGZvciBkb2NzLg0KY29udHJhY3QgbXVsdGlzaWcgew0KDQoJLy8gRVZFTlRTDQoNCiAgICAvLyBsb2dnZWQgZXZlbnRzOg0KICAgIC8vIEZ1bmRzIGhhcyBhcnJpdmVkIGludG8gdGhlIHdhbGxldCAocmVjb3JkIGhvdyBtdWNoKS4NCiAgICBldmVudCBEZXBvc2l0KGFkZHJlc3MgX2Zyb20sIHVpbnQgdmFsdWUpOw0KICAgIC8vIFNpbmdsZSB0cmFuc2FjdGlvbiBnb2luZyBvdXQgb2YgdGhlIHdhbGxldCAocmVjb3JkIHdobyBzaWduZWQgZm9yIGl0LCBob3cgbXVjaCwgYW5kIHRvIHdob20gaXQncyBnb2luZykuDQogICAgZXZlbnQgU2luZ2xlVHJhbnNhY3QoYWRkcmVzcyBvd25lciwgdWludCB2YWx1ZSwgYWRkcmVzcyB0bywgYnl0ZXMgZGF0YSk7DQogICAgLy8gTXVsdGktc2lnIHRyYW5zYWN0aW9uIGdvaW5nIG91dCBvZiB0aGUgd2FsbGV0IChyZWNvcmQgd2hvIHNpZ25lZCBmb3IgaXQgbGFzdCwgdGhlIG9wZXJhdGlvbiBoYXNoLCBob3cgbXVjaCwgYW5kIHRvIHdob20gaXQncyBnb2luZykuDQogICAgZXZlbnQgTXVsdGlUcmFuc2FjdChhZGRyZXNzIG93bmVyLCBieXRlczMyIG9wZXJhdGlvbiwgdWludCB2YWx1ZSwgYWRkcmVzcyB0bywgYnl0ZXMgZGF0YSk7DQogICAgLy8gQ29uZmlybWF0aW9uIHN0aWxsIG5lZWRlZCBmb3IgYSB0cmFuc2FjdGlvbi4NCiAgICBldmVudCBDb25maXJtYXRpb25OZWVkZWQoYnl0ZXMzMiBvcGVyYXRpb24sIGFkZHJlc3MgaW5pdGlhdG9yLCB1aW50IHZhbHVlLCBhZGRyZXNzIHRvLCBieXRlcyBkYXRhKTsNCg0KICAgIC8vIEZVTkNUSU9OUw0KDQogICAgLy8gVE9ETzogZG9jdW1lbnQNCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykgZXh0ZXJuYWw7DQogICAgZnVuY3Rpb24gZXhlY3V0ZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBleHRlcm5hbCByZXR1cm5zIChieXRlczMyKTsNCiAgICBmdW5jdGlvbiBjb25maXJtKGJ5dGVzMzIgX2gpIHJldHVybnMgKGJvb2wpOw0KfQ0KDQpjb250cmFjdCB0b2tlbnN3YXAgaXMgbXVsdGlzaWcsIG11bHRpb3duZWQgew0KICAgIFRva2VuIHB1YmxpYyB0b2tlbkN0cjsNCiAgICBib29sIHB1YmxpYyB0b2tlblN3YXA7DQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgU1dBUF9MRU5HVEggPSA0ICB3ZWVrczsNCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNQVhfRVRIID0gNzAwMDAwIGV0aGVyOw0KICAgIHVpbnQgcHVibGljIGFtb3VudFJhaXNlZDsNCg0KICAgIG1vZGlmaWVyIGlzWmVyb1ZhbHVlIHsNCiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSAwKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBpc092ZXJDYXAgew0KCWlmIChhbW91bnRSYWlzZWQgKyBtc2cudmFsdWUgPiBNQVhfRVRIKSB0aHJvdzsNCiAgICAgICAgXzsNCiAgICB9DQoNCiAgICBtb2RpZmllciBpc1N3YXBTdG9wcGVkIHsNCiAgICAgICAgaWYgKCF0b2tlblN3YXApIHRocm93Ow0KICAgICAgICBfOw0KICAgIH0NCg0KICAgIG1vZGlmaWVyIGFyZUNvbmRpdGlvbnNTYXRpc2ZpZWQgew0KCS8vIEVuZCB0b2tlbiBzd2FwIGlmIHNhbGUgcGVyaW9kIGVuZGVkDQoJaWYgKHRva2VuQ3RyLmNyZWF0aW9uVGltZSgpICsgU1dBUF9MRU5HVEggPCBub3cpIHsNCiAgICAgICAgICAgIHRva2VuQ3RyLmRpc2FibGVUb2tlblN3YXBMb2NrKCk7DQogICAgICAgICAgICB0b2tlblN3YXAgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIF87DQoJICAgICAgICAvLyBDaGVjayBpZiBjYXAgaGFzIGJlZW4gcmVhY2hlZCBpbiB0aGlzIHR4DQogICAgICAgICAgICBpZiAoYW1vdW50UmFpc2VkID09IE1BWF9FVEgpIHsNCiAgICAgICAgICAgICAgICB0b2tlbkN0ci5kaXNhYmxlVG9rZW5Td2FwTG9jaygpOw0KICAgICAgICAgICAgICAgIHRva2VuU3dhcCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2FmZVRvQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7DQogICAgICByZXR1cm4gKGEgKyBiID49IGEgJiYgYSArIGIgPj0gYik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3RhcnRUb2tlblN3YXAoKSBvbmx5b3duZXIgew0KICAgICAgICB0b2tlblN3YXAgPSB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0b3BUb2tlblN3YXAoKSBvbmx5b3duZXIgew0KICAgICAgICB0b2tlblN3YXAgPSBmYWxzZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZXRUb2tlbkNvbnRyYWN0KGFkZHJlc3MgbmV3VG9rZW5Db250cmFjdEFkZHIpIG9ubHlvd25lciB7DQogICAgICAgIGlmIChuZXdUb2tlbkNvbnRyYWN0QWRkciA9PSBhZGRyZXNzKDB4MCkpIHRocm93Ow0KICAgICAgICAvLyBBbGxvdyBzZXR0aW5nIG9ubHkgb25jZQ0KICAgICAgICBpZiAodG9rZW5DdHIgIT0gYWRkcmVzcygweDApKSB0aHJvdzsNCg0KICAgICAgICB0b2tlbkN0ciA9IFRva2VuKG5ld1Rva2VuQ29udHJhY3RBZGRyKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnkpDQogICAgcGF5YWJsZQ0KICAgIGlzWmVyb1ZhbHVlDQogICAgaXNPdmVyQ2FwDQogICAgaXNTd2FwU3RvcHBlZA0KICAgIGFyZUNvbmRpdGlvbnNTYXRpc2ZpZWQgew0KICAgICAgICBEZXBvc2l0KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7DQogICAgICAgIHRva2VuQ3RyLm1pbnRUb2tlbnMoX2JlbmVmaWNpYXJ5LCBtc2cudmFsdWUpOw0KICAgICAgICBpZiAoIXNhZmVUb0FkZChhbW91bnRSYWlzZWQsIG1zZy52YWx1ZSkpIHRocm93Ow0KICAgICAgICBhbW91bnRSYWlzZWQgKz0gbXNnLnZhbHVlOw0KICAgIH0NCn0NCg0KLy8gdXNhZ2U6DQovLyBieXRlczMyIGggPSBXYWxsZXQodykuZnJvbShvbmVPd25lcikudHJhbnNhY3QodG8sIHZhbHVlLCBkYXRhKTsNCi8vIFdhbGxldCh3KS5mcm9tKGFub3RoZXJPd25lcikuY29uZmlybShoKTsNCmNvbnRyYWN0IFdhbGxldCBpcyBtdWx0aXNpZywgbXVsdGlvd25lZCwgZGF5bGltaXQsIHRva2Vuc3dhcCB7DQoNCgkvLyBUWVBFUw0KDQogICAgLy8gVHJhbnNhY3Rpb24gc3RydWN0dXJlIHRvIHJlbWVtYmVyIGRldGFpbHMgb2YgdHJhbnNhY3Rpb24gbGVzdCBpdCBuZWVkIGJlIHNhdmVkIGZvciBhIGxhdGVyIGNhbGwuDQogICAgc3RydWN0IFRyYW5zYWN0aW9uIHsNCiAgICAgICAgYWRkcmVzcyB0bzsNCiAgICAgICAgdWludCB2YWx1ZTsNCiAgICAgICAgYnl0ZXMgZGF0YTsNCiAgICB9DQoNCiAgICAvLyBNRVRIT0RTDQoNCiAgICAvLyBjb25zdHJ1Y3RvciAtIGp1c3QgcGFzcyBvbiB0aGUgb3duZXIgYXJyYXkgdG8gdGhlIG11bHRpb3duZWQgYW5kDQogICAgLy8gdGhlIGxpbWl0IHRvIGRheWxpbWl0DQogICAgZnVuY3Rpb24gV2FsbGV0KGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCwgdWludCBfZGF5bGltaXQpDQogICAgICAgICAgICBtdWx0aW93bmVkKF9vd25lcnMsIF9yZXF1aXJlZCkgZGF5bGltaXQoX2RheWxpbWl0KSB7DQogICAgfQ0KDQogICAgLy8ga2lsbHMgdGhlIGNvbnRyYWN0IHNlbmRpbmcgZXZlcnl0aGluZyB0byBgX3RvYC4NCiAgICBmdW5jdGlvbiBraWxsKGFkZHJlc3MgX3RvKSBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgZXh0ZXJuYWwgew0KICAgICAgICAvL2Vuc3VyZSBvd25lcnMgY2FuJ3QgcHJlbWF0dXJlbHkgc3RvcCB0b2tlbiBzYWxlDQogICAgICAgIC8vYW5kIHRoZW4gcmVuZGVyIHRva2VucyB1bnRyYWRhYmxlLCBhcyB3aXRob3V0IHRoaXMNCiAgICAgICAgLy9jaGVjaywgdGhlIHRva2VuU3dhcExvY2sgd291bGQgbmV2ZXIgZ2V0IGRpc2lhYmxlZA0KICAgICAgICAvL2lmIHRoaXMgZmlyZXMNCiAgICAgICAgaWYgKHRva2VuQ3RyLnRva2VuU3dhcExvY2soKSkgdGhyb3c7DQoNCiAgICAgICAgc3VpY2lkZShfdG8pOw0KICAgIH0NCg0KICAgIC8vIGdldHMgY2FsbGVkIHdoZW4gbm8gb3RoZXIgZnVuY3Rpb24gbWF0Y2hlcw0KICAgIGZ1bmN0aW9uKCkNCiAgICBwYXlhYmxlIHsNCiAgICAgICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOw0KICAgIH0NCg0KICAgIC8vIE91dHNpZGUtdmlzaWJsZSB0cmFuc2FjdCBlbnRyeSBwb2ludC4gRXhlY3V0ZXMgdHJhbnNhY3Rpb24gaW1tZWRpYXRlbHkgaWYgYmVsb3cgZGFpbHkgc3BlbmQgbGltaXQuDQogICAgLy8gSWYgbm90LCBnb2VzIGludG8gbXVsdGlzaWcgcHJvY2Vzcy4gV2UgcHJvdmlkZSBhIGhhc2ggb24gcmV0dXJuIHRvIGFsbG93IHRoZSBzZW5kZXIgdG8gcHJvdmlkZQ0KICAgIC8vIHNob3J0Y3V0cyBmb3IgdGhlIG90aGVyIGNvbmZpcm1hdGlvbnMgKGFsbG93aW5nIHRoZW0gdG8gYXZvaWQgcmVwbGljYXRpbmcgdGhlIF90bywgX3ZhbHVlDQogICAgLy8gYW5kIF9kYXRhIGFyZ3VtZW50cykuIFRoZXkgc3RpbGwgZ2V0IHRoZSBvcHRpb24gb2YgdXNpbmcgdGhlbSBpZiB0aGV5IHdhbnQsIGFueXdheXMuDQogICAgZnVuY3Rpb24gZXhlY3V0ZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBleHRlcm5hbCBvbmx5b3duZXIgcmV0dXJucyAoYnl0ZXMzMiBfcikgew0KICAgICAgICAvLyBEaXNhbGxvdyB0aGUgd2FsbGV0IGNvbnRyYWN0IGZyb20gY2FsbGluZyB0b2tlbiBjb250cmFjdCBvbmNlIGl0J3Mgc2V0DQogICAgICAgIC8vIHNvIHRva2VucyBjYW4ndCBiZSBtaW50ZWQgYXJiaXRyYXJpbHkgb25jZSB0aGUgc2FsZSBzdGFydHMuDQogICAgICAgIC8vIFRva2VucyBjYW4gYmUgbWludGVkIGZvciBwcmVtaW5lIGJlZm9yZSB0aGUgc2FsZSBvcGVucyBhbmQgdG9rZW5DdHIgaXMgc2V0Lg0KICAgICAgICBpZiAoX3RvID09IGFkZHJlc3ModG9rZW5DdHIpKSB0aHJvdzsNCg0KICAgICAgICAvLyBmaXJzdCwgdGFrZSB0aGUgb3Bwb3J0dW5pdHkgdG8gY2hlY2sgdGhhdCB3ZSdyZSB1bmRlciB0aGUgZGFpbHkgbGltaXQuDQogICAgICAgIGlmICh1bmRlckxpbWl0KF92YWx1ZSkpIHsNCiAgICAgICAgICAgIFNpbmdsZVRyYW5zYWN0KG1zZy5zZW5kZXIsIF92YWx1ZSwgX3RvLCBfZGF0YSk7DQogICAgICAgICAgICAvLyB5ZXMgLSBqdXN0IGV4ZWN1dGUgdGhlIGNhbGwuDQogICAgICAgICAgICBpZighX3RvLmNhbGwudmFsdWUoX3ZhbHVlKShfZGF0YSkpDQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KICAgICAgICAvLyBkZXRlcm1pbmUgb3VyIG9wZXJhdGlvbiBoYXNoLg0KICAgICAgICBfciA9IHNoYTMobXNnLmRhdGEsIGJsb2NrLm51bWJlcik7DQogICAgICAgIGlmICghY29uZmlybShfcikgJiYgbV90eHNbX3JdLnRvID09IDApIHsNCiAgICAgICAgICAgIG1fdHhzW19yXS50byA9IF90bzsNCiAgICAgICAgICAgIG1fdHhzW19yXS52YWx1ZSA9IF92YWx1ZTsNCiAgICAgICAgICAgIG1fdHhzW19yXS5kYXRhID0gX2RhdGE7DQogICAgICAgICAgICBDb25maXJtYXRpb25OZWVkZWQoX3IsIG1zZy5zZW5kZXIsIF92YWx1ZSwgX3RvLCBfZGF0YSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBjb25maXJtIGEgdHJhbnNhY3Rpb24gdGhyb3VnaCBqdXN0IHRoZSBoYXNoLiB3ZSB1c2UgdGhlIHByZXZpb3VzIHRyYW5zYWN0aW9ucyBtYXAsIG1fdHhzLCBpbiBvcmRlcg0KICAgIC8vIHRvIGRldGVybWluZSB0aGUgYm9keSBvZiB0aGUgdHJhbnNhY3Rpb24gZnJvbSB0aGUgaGFzaCBwcm92aWRlZC4NCiAgICBmdW5jdGlvbiBjb25maXJtKGJ5dGVzMzIgX2gpIG9ubHltYW55b3duZXJzKF9oKSByZXR1cm5zIChib29sKSB7DQogICAgICAgIGlmIChtX3R4c1tfaF0udG8gIT0gMCkgew0KICAgICAgICAgICAgaWYoIW1fdHhzW19oXS50by5jYWxsLnZhbHVlKG1fdHhzW19oXS52YWx1ZSkobV90eHNbX2hdLmRhdGEpKQ0KICAgICAgICAgICAgTXVsdGlUcmFuc2FjdChtc2cuc2VuZGVyLCBfaCwgbV90eHNbX2hdLnZhbHVlLCBtX3R4c1tfaF0udG8sIG1fdHhzW19oXS5kYXRhKTsNCiAgICAgICAgICAgIGRlbGV0ZSBtX3R4c1tfaF07DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIElOVEVSTkFMIE1FVEhPRFMNCg0KICAgIGZ1bmN0aW9uIGNsZWFyUGVuZGluZygpIGludGVybmFsIHsNCiAgICAgICAgdWludCBsZW5ndGggPSBtX3BlbmRpbmdJbmRleC5sZW5ndGg7DQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKQ0KICAgICAgICAgICAgZGVsZXRlIG1fdHhzW21fcGVuZGluZ0luZGV4W2ldXTsNCiAgICAgICAgc3VwZXIuY2xlYXJQZW5kaW5nKCk7DQogICAgfQ0KDQoJLy8gRklFTERTDQoNCiAgICAvLyBwZW5kaW5nIHRyYW5zYWN0aW9ucyB3ZSBoYXZlIGF0IHByZXNlbnQuDQogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBUcmFuc2FjdGlvbikgbV90eHM7DQp9'